/*!
*  filename: ej.listbox.min.js
*  version : 14.3.0.49
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.scroller.min","./../common/ej.draggable.min","./ej.checkbox.min"],n):n()})(function(){(function(n,t,r){t.widget("ejListBox","ej.ListBox",{element:null,ignoreOnPersist:["dataSource","query","itemRequestCount","fields","create","change","select","unselect","itemDragStart","itemDrag","itemDragStop","itemDrop","checkChange","destroy","actionComplete","actionFailure","actionSuccess","actionBegin","itemDropped","selected"],model:null,validTags:["ul"],_setFirst:!1,_rootCSS:"e-listbox",defaults:{itemsCount:null,totalItemsCount:null,dataSource:null,query:t.Query(),itemRequestCount:5,fields:{id:null,text:null,imageUrl:null,imageAttributes:null,spriteCssClass:null,htmlAttributes:null,tooltipText:null,selectBy:null,checkBy:null,groupBy:null,tableName:null,selected:null,category:null,toolTipText:null},height:"auto",width:"200",template:null,text:"",selectedIndex:null,checkedIndices:[],selectedIndices:[],cascadeTo:null,value:"",cssClass:"",targetID:null,htmlAttributes:{},showRoundedCorner:!1,enableRTL:!1,enabled:!0,showCheckbox:!1,allowVirtualScrolling:!1,virtualScrollMode:"normal",enablePersistence:!1,allowMultiSelection:!1,allowDrag:!1,allowDrop:!1,enableIncrementalSearch:!1,enableWordWrap:!0,caseSensitiveSearch:!1,loadDataOnInit:!0,create:null,change:null,select:null,unselect:null,itemDragStart:null,itemDrag:null,itemDragStop:null,itemDrop:null,checkChange:null,destroy:null,actionComplete:null,actionSuccess:null,actionBeforeSuccess:null,focusIn:null,focusOut:null,actionFailure:null,actionBegin:null,enableVirtualScrolling:!1,checkAll:!1,uncheckAll:!1,enableLoadOnDemand:!1,itemRequest:null,allowDragAndDrop:r,selectedItemIndex:null,enableItemsByIndex:null,checkItemsByIndex:null,disableItemsByIndex:null,uncheckItemsByIndex:null,itemDropped:null,selected:null,selectIndexChanged:null,selectedItems:[],checkedItems:[],checkedItemlist:[],selectedItemlist:[]},dataTypes:{cssClass:"string",itemsCount:"number",itemRequestCount:"number",allowDrag:"boolean",allowDrop:"boolean",enableWordWrap:"boolean",enableIncrementalSearch:"boolean",caseSensitiveSearch:"boolean",template:"string",targetID:"string",cascadeTo:"string",showRoundedCorner:"boolean",enableRTL:"boolean",enablePersistence:"boolean",enabled:"boolean",allowMultiSelection:"boolean",dataSource:"data",query:"data",checkedIndices:"data",selectedIndices:"data",htmlAttributes:"data",loadDataOnInit:"boolean",showCheckbox:"boolean"},observables:["value","dataSource"],value:t.util.valueFunction("value"),dataSource:t.util.valueFunction("dataSource"),enable:function(){if(this.listContainer.hasClass("e-disable")){this.target.disabled=!1;this.model.enabled=this.model.enabled=!0;this.element.removeAttr("disabled");this.listContainer.removeClass("e-disable");this.model.allowMultiSelection&&this.listContainer.removeClass("e-disable");var n=this.listContainer.find(".e-vscrollbar,.e-hscrollbar");this.model.showCheckbox&&this.element.find(".listcheckbox").ejCheckBox("enable");n.length>0&&this.scrollerObj.enable()}},disable:function(){if(!this.listContainer.hasClass("e-disable")){this.target.disabled=!0;this.model.enabled=this.model.enabled=!1;this.element.attr("disabled","disabled");this.listContainer.addClass("e-disable");this.model.allowMultiSelection&&this.listContainer.addClass("e-disable");var n=this.listContainer.find(".e-vscrollbar,.e-hscrollbar");this.model.showCheckbox&&this.element.find(".listcheckbox").ejCheckBox("disable");n.length>0&&this.scrollerObj.disable()}},selectItemByIndex:function(t){var u=this.model.selectedIndex,t=parseInt(t),i,r;t==null||this.model.showCheckbox||(i=n(this.element.children("li")[t]),i.hasClass("e-select")||(this._activeItem=t,this.element.children("li").removeClass("e-select"),this._selectedItems=[],this.model.selectedIndices=[],i.addClass("e-select"),this._selectedItems.push(i),this.model.selectedIndices.push(t),r=this._getItemObject(i,null),r.isInteraction=!1,this.model.select&&this._trigger("select",r)));this.model.cascadeTo&&(this._activeItem=t,this._cascadeAction());this._setSelectionValues()._OnListSelect(u,this._activeItem)},checkItemByIndex:function(n){typeof n=="number"&&this.checkItemsByIndices(n.toString())},uncheckItemByIndex:function(n){typeof n=="number"&&this.uncheckItemsByIndices(n.toString())},checkItemsByIndices:function(i){var r,u,f,e;if(t.isNullOrUndefined(i))return!1;if(r=i.toString().split(","),r.length>0)for(u=0;u<r.length;u++)r[u]!=null&&(this._activeItem=parseInt(r[u]),this._activeItem<0&&(this._activeItem=0),f=n(this.element.children("li")[this._activeItem]),this.model.showCheckbox&&(n(f).find(".listcheckbox").ejCheckBox("isChecked")||(n(f).find(".listcheckbox").ejCheckBox("option","checked",!0),this.checkedStatus=!0,n.inArray(this._activeItem,this._checkedItems)>-1||this._checkedItems.push(this._activeItem),n.inArray(f[0],this.model.checkedIndices)>-1||this.model.checkedIndices.push(this._activeItem),e=this._getItemObject(f,null),e.isInteraction=!1,this.model.checkChange&&this._trigger("checkChange",e))));this._setSelectionValues()},uncheckItemsByIndices:function(i){var r,u,e,f,o,s;if(t.isNullOrUndefined(i))return!1;if(r=i.toString().split(","),r.length>0)for(u=0;u<r.length;u++)r[u]!=null&&(e=parseInt(r[u]),f=n(this.element.children("li")[parseInt(e)]),this.model.showCheckbox&&n(f).find(".listcheckbox").ejCheckBox("isChecked")&&!n(f).hasClass("e-disable")&&(n(f).find(".listcheckbox").ejCheckBox("option","checked",!1),this.checkedStatus=!1,o=n.inArray(e,this.model.checkedIndices),n.inArray(e,this._checkedItems)>-1&&this._checkedItems.splice(o,1),o>-1&&this.model.checkedIndices.splice(o,1),s=this._getItemObject(f,null),s.isInteraction=!1,this.model.checkChange&&this._trigger("checkChange",s)));this._setSelectionValues()},selectAll:function(){var i,t,r;if(!this.model.showCheckbox&&this.model.allowMultiSelection)for(i=this.element.children("li"),t=0;t<i.length;t++)n(i[t]).hasClass("e-select")||n(i[t]).hasClass("e-disable")||(n(i[t]).addClass("e-select"),this._selectedItems.push(n(i[t])),this.model.selectedIndices.push(t),r=this._getItemObject(i,null),r.isInteraction=!1,this.model.select&&this._trigger("select",r));this._setSelectionValues()},unSelectAll:function(){this.unselectAll()},unselectAll:function(){return this.model.showCheckbox||this._removeListHover(),this._setSelectionValues(),this},selectItemsByIndex:function(n){this.selectItemsByIndices(n)},selectItemsByIndices:function(i){var u,r,e,f,o;if(t.isNullOrUndefined(i))return!1;if(u=i.toString().split(","),!this.model.showCheckbox&&this.model.allowMultiSelection)for(r=0;r<u.length;r++)u[r]==null||isNaN(parseInt(u[r]))||(e=parseInt(u[r]),this._activeItem=e,this._activeItem<0?this._activeItem=0:this._activeItem==this._listSize-1&&(this._activeItem=this._listSize-1),f=n(this.element.children("li")[this._activeItem]),f.hasClass("e-select")||(f.addClass("e-select"),this._selectedItems.push(f),this.model.selectedIndices.push(e),o=this._getItemObject(f,null),o.isInteraction=!1,this.model.select&&this._trigger("select",o)));this._setSelectionValues()},unselectItemsByIndex:function(n){this.unselectItemsByIndices(n)},unselectItemsByIndices:function(t){var r,i,u,f,e,o;if(this.model.showCheckbox)return!1;for(r=t.toString().split(","),i=0;i<r.length;i++)r[i]!=null&&(u=parseInt(r[i]),f=n(this.element.children("li")[u]),this._activeItem=u,f.removeClass("e-active e-select"),this.model.selectedIndex==u&&(this.model.selectedIndex=this._activeItem=null),e=this._selectedItems.indexOf(f[0]),this._selectedItems.splice(this.model.selectedIndices.indexOf(e),1),this.model.selectedIndices.splice(this.model.selectedIndices.indexOf(e),1),o=this._getItemObject(f,null),o.isInteraction=!1,this.model.unselect&&this._trigger("unselect",o));this._setSelectionValues()},unselectItemByIndex:function(t){var i,r,u;if(this.model.showCheckbox)return!1;t=parseInt(t);i=n(this.element.children("li")[t]);i.hasClass("e-select")&&(i.removeClass("e-active e-select"),this.model.selectedIndex==t&&(this.model.selectedIndex=this._activeItem=null),r=this._selectedItems.indexOf(i[0]),this._selectedItems.splice(this.model.selectedIndices.indexOf(r),1),this.model.selectedIndices.splice(this.model.selectedIndices.indexOf(r),1),u=this._getItemObject(i,null),u.isInteraction=!1,this.model.unselect&&this._trigger("unselect",u));this._setSelectionValues()},selectItemByText:function(n){t.isNullOrUndefined(n)||this[this.model.allowMultiSelection?"selectItemsByIndices":"selectItemByIndex"](this.getIndexByText(n))},selectItemByValue:function(n){this[this.model.allowMultiSelection?"selectItemsByIndices":"selectItemByIndex"](this.getIndexByValue(n))},unselectItemByText:function(n){this[this.model.allowMultiSelection?"unselectItemsByIndices":"unselectItemByIndex"](this.getIndexByText(n))},unselectItemByValue:function(n){this[this.model.allowMultiSelection?"unselectItemsByIndices":"unselectItemByIndex"](this.getIndexByValue(n))},getSelectedItems:function(){var t=[],i=this;return n(i.model.selectedIndices).each(function(n,r){t.push(i.getItemByIndex(r))}),t},getCheckedItems:function(){var t=[],i=this;return n(i.model.checkedIndices).each(function(n,r){t.push(i.getItemByIndex(r))}),t},removeItem:function(){return this.removeSelectedItems()},removeItemByText:function(n){return t.isNullOrUndefined(this.getItemByText(n))?!1:this.removeItemByIndex(this.getItemByText(n).index)},hideSelectedItems:function(){var n=this.getSelectedItems();this._hideOrShowItemsByIndex(n,"hide")},hideCheckedItems:function(){var n=this.getCheckedItems();this._hideOrShowItemsByIndex(n,"hide")},_hideOrShowItemsByIndex:function(t,i){if(n.type(t)=="number")i=="hide"?n(this.element.find("li")[t]).hide():n(this.element.find("li")[t]).show();else for(var r=0;r<t.length;r++)i=="hide"?t[r].item?t[r].item.hide():n(this.element.find("li")[t[r]]).hide():t[r].item?t[r].item.show():n(this.element.find("li")[t[r]]).show();this._refreshScroller()},showItemsByIndices:function(n){this._hideOrShowItemsByIndex(n,"show")},hideItemsByIndices:function(n){this._hideOrShowItemsByIndex(n,"hide")},_hideOrShowItemsByValue:function(t,i){n.type(t)=="array"?this.element.find("li").each(function(){for(var r=0;r<=t.length;r++)n(this).text()==t[r]&&(i=="hide"?n(this).hide():n(this).show())}):this.element.find("li").each(function(){n(this).text()==t&&(i=="hide"?n(this).hide():n(this).show())});this._refreshScroller()},showItemsByValues:function(n){this._hideOrShowItemsByValue(n,"show")},hideItemsByValues:function(n){this._hideOrShowItemsByValue(n,"hide")},showItemByValue:function(n){this._hideOrShowItemsByValue(n,"show")},hideItemByValue:function(n){this._hideOrShowItemsByValue(n,"hide")},showItemByIndex:function(n){this._hideOrShowItemsByIndex(n,"show")},hideItemByIndex:function(n){this._hideOrShowItemsByIndex(n,"hide")},hide:function(){this.listContainer.hide()},show:function(){this.listContainer.show()},hideAllItems:function(){this.element.find("li:visible").hide();this._refreshScroller()},showAllItems:function(){this.element.find("li:hidden").show();this._refreshScroller()},_stateMaintained:function(t){var e,f,r,u;if(this.model.disableItemsByIndex=[],this.model.selectedIndices=[],this.model.checkedIndices=[],this.model.selectedIndex>=t&&this.model.selectedIndex!=null&&(this.model.selectedIndex==t||n(this.element.children()[t-1]).hasClass("e-disable")?this.model.selectedIndex=null:this.model.selectedIndex!=t&&(this.model.selectedIndex-=1)),f=n(t).length,f>1){for(i=f;i>=0;i--)n(this.element.children()[t[i]]).remove();for(e=this.element.children().length,u=0;u<e;u++)n(this.element.children()[u]).hasClass("e-disable")&&this.model.disableItemsByIndex.push(u)}else{for(r=t-1,r;r>=0;r--)n(this.element.children()[r]).hasClass("e-disable")&&this.model.disableItemsByIndex.push(r),n(this.element.children()[r]).hasClass("e-select")&&this.model.selectedIndices.push(r),n(this.element.children()[r]).find(".listcheckbox").ejCheckBox("isChecked")&&this.model.checkedIndices.push(r);for(t=parseInt(t)+1,t;t<this._listSize;t++)n(this.element.children()[t]).hasClass("e-disable")&&this.model.disableItemsByIndex.push(t-1),n(this.element.children()[t]).hasClass("e-select")&&this.model.selectedIndices.push(t-1),n(this.element.children()[t]).find(".listcheckbox").ejCheckBox("isChecked")&&this.model.checkedIndices.push(t-1)}},removeAll:function(){var i,r,f,u;if(t.isNullOrUndefined(this.dataSource()))return i=[],n(this.element.find("li")).each(function(t,r){i.push(n(this).text());r.remove()}),this._refreshItems(),i;if(!(this.dataSource()instanceof t.DataManager)){for(r=[],f=n(this.element.find("li")).length,u=0;u<f;u++)r.push(this._getRemovedItems([parseInt(0)]));return r}},removeItemByIndex:function(i){if(t.isNullOrUndefined(this.dataSource())){var r=n(this.element.find("li")[i]).remove().text();return this._refreshItems(),r}if(!(this.dataSource()instanceof t.DataManager))return this._getRemovedItems([parseInt(i)])},removeSelectedItems:function(){if(this.model.showCheckbox)return!1;if(t.isNullOrUndefined(this.dataSource())){var i=this.value();return n(this.getSelectedItems()).each(function(n,t){t.item.remove()}),this._refreshItems(),i}if(!(this.dataSource()instanceof t.DataManager))return this._getRemovedItems(this.model.selectedIndices)},_getRemovedItems:function(n){var t=[];return this._stateMaintained(n),this.value(null),this.model.selectedIndices=[],this.model.selectedIndex=this._activeItem=null,this.dataSource(this.dataSource().filter(function(i,r){if(n.indexOf(r)!=-1)t.push(i);else return!0})),this.refresh(!0),t},getIndexByValue:function(t){var i;return this.element.find("li").each(function(){if(n(this).attr("value")==t)return i=n(this).index(),!1}),i},getIndexByText:function(t){var i,t;return this.model.allowMultiSelection&&(t=t.split(","),i=[]),this.element.find("li").each(function(){if(typeof t=="object"){for(var r=0;r<t.length;r++)if(n(this).text()==t[r]&&(i.push(n(this).index()),i.length==t.length))return!1}else if(n(this).text()==t)return i=n(this).index(),!1}),i},getTextByIndex:function(t){return n(this.element.find("li")[t]).text()},getItemByText:function(t){var r=this,i;return this.element.find("li").each(function(){if(n(this).text()==t)return i=r._getItemObject(n(this)),!1}),i},getItemByIndex:function(t){return this._getItemObject(n(this.element.find("li")[t]))},getListData:function(){return t.DataManager&&this.dataSource()instanceof t.DataManager?this.listitems:this.dataSource()?this.dataSource():void 0},enableItem:function(t){var i=this;this.element.find("li").each(function(){if(n(this).text()==t)return n(this).removeClass("e-disable"),i.model.showCheckbox&&n(this).find(".listcheckbox").ejCheckBox("enable"),i._disabledItems.splice(n(this).index().toString()),!1})},disableItem:function(t){var i=this;this.element.find("li").each(function(){if(n(this).text()==t)return n(this).addClass("e-disable"),i.model.showCheckbox&&n(this).find(".listcheckbox").ejCheckBox("disable"),i._disabledItems.push(n(this).index().toString()),!1})},moveUp:function(){if(!t.isNullOrUndefined(this.model.selectedIndex)){var n=this._getItem(this.model.selectedIndex).prev();this._moveItem(n,"up")}},moveDown:function(){if(!t.isNullOrUndefined(this.model.selectedIndex)){var n=this._getItem(this.model.selectedIndex).next();this._moveItem(n,"down")}},_moveItem:function(t,i){var u=this._getItem(this.model.selectedIndex),f=this.element.children().length,e=i=="up"&&0<this.model.selectedIndex,o=i=="down"&&f-1>this.model.selectedIndex,r;if(this._addListHover(),this._getItem(this._selectedItem).removeClass("e-hover"),e?(t.insertAfter(u),this.model.selectedIndex-=1,this._selectedItem-=1):o&&(t.insertBefore(u),this.model.selectedIndex+=1,this._selectedItem+=1),e||o)for(this.model.selectedIndices=[],r=0;r<f;r++)n(this.element.children()[r]).hasClass("e-select")&&this.model.selectedIndices.push(r)},checkAll:function(){if(!this.model.showCheckbox)return!1;var t=this.element.find("li");for(i=0;i<t.length;i++)n(t[i].firstChild).find(".listcheckbox").ejCheckBox("isChecked")||(n(t[i].firstChild).find(".listcheckbox").ejCheckBox("option","checked",!0),this._checkedItems.push(t[i]),this.model.checkedIndices.push(i));this.model.uncheckAll=!1},unCheckAll:function(){this.uncheckAll()},uncheckAll:function(){if(!this.model.showCheckbox)return!1;var t=this.element.find("li");for(i=0;i<t.length;i++)n(t[i].firstChild).find(".listcheckbox").ejCheckBox("isChecked")&&n(t[i].firstChild).find(".listcheckbox").ejCheckBox("option","checked",!1);this._checkedItems=[];this.model.checkedIndices=[];this.model.checkAll=!1},addItem:function(i,r){var r=!t.isNullOrUndefined(r)&&r<=this.element.find("li").length?r:this.element.find("li").length,e=this,u=r,f;if(t.isNullOrUndefined(this.dataSource()))i instanceof Array?n(i).each(function(n,t){e.addItem(t,r);r=r+1}):(this.listitem=this.element.find("li").length?r-1<0?n(this.element.find("li")[0]).before('<li role="option">'+i+"<\/li>"):n(this.element.find("li")[r-1]).after('<li role="option">'+i+"<\/li>"):n(this.element).html('<li role="option">'+i+"<\/li>"),this.listitems=this.element.find("li"),this._addItemIndex=r,this.model.showCheckbox&&($checkbox=t.buildTag("input.listcheckbox e-align#popuplist"+(this.listitems.length-1)+"_"+this._id,"",{},{type:"checkbox",name:"list"+(this.listitems.length-1)}),n(this.listitems[r]).prepend($checkbox),n(n(this.listitems[r]).find(".listcheckbox")).ejCheckBox({change:n.proxy(this._onClickCheckList,this)})),(this.model.allowDrag||this.model.allowDrop)&&this._enableDragDrop(),this._addItemIndex=null,this._refreshItems());else if(!(this.dataSource()instanceof t.DataManager)){for(e.dataSource()instanceof Object?(dup={},i instanceof Object||(dup[e.model.fields.text]=i,i=dup)):i instanceof Array||(i=[i]),n(i).each(function(n,t){e.dataSource().splice(r,0,t);r=r+1}),this.model.disableItemsByIndex=[],this.model.selectedIndices=[],this.model.checkedIndices=[],this.model.selectedIndex>=u&&(this.model.selectedIndex+=1),f=u-1,f;f>=0;f--)n(this.element.children()[f]).hasClass("e-disable")&&this.model.disableItemsByIndex.push(f),n(this.element.children()[f]).hasClass("e-select")&&this.model.selectedIndices.push(f),n(this.element.children()[f]).find(".listcheckbox").ejCheckBox("isChecked")&&this.model.checkedIndices.push(f);for(u;u<this._listSize;u++)n(this.element.children()[u]).hasClass("e-disable")&&this.model.disableItemsByIndex.push(u+1),n(this.element.children()[u]).hasClass("e-select")&&this.model.selectedIndices.push(u+1),n(this.element.children()[u]).find(".listcheckbox").ejCheckBox("isChecked")&&this.model.checkedIndices.push(u+1);this.refresh(!0)}},enableItemByIndex:function(n){typeof n=="number"&&this.enableItemsByIndices(n.toString())},disableItemByIndex:function(n){typeof n=="number"&&this.disableItemsByIndices(n.toString())},disableItemsByIndices:function(i){var r,u,f;if(t.isNullOrUndefined(i))return!1;for(r=i.toString().split(","),u=0;u<r.length;u++)r.length>0&&!(n.inArray(r[u],this._disabledItems)>-1)&&(f=n(this.element.children("li")[parseInt(r[u])]).addClass("e-disable"),f.find(".listcheckbox").ejCheckBox("disable"),this._disabledItems.push(r[u]))},enableItemsByIndices:function(t){for(var f,i=t.toString().split(","),u,r=0;r<i.length;r++)i.length>0&&n.inArray(i[r],this._disabledItems)>-1&&(u=n.inArray(i[r],this._disabledItems),f=n(this.element.children("li")[parseInt(i[r])]).removeClass("e-disable"),f.find(".listcheckbox").ejCheckBox("enable"),this._disabledItems.splice(u,1))},_init:function(){this._id=this.element[0].id;this._isMozilla=t.browserInfo().name=="mozilla"?!0:!1;this._cloneElement=this.element.clone();this._deprecatedValue()._initialize()._render()._wireEvents();this._initValue=this.focused=!1;this._typeInterval=null;this._typingThreshold=2e3;this.model.checkAll&&this.checkAll();this.model.uncheckAll&&this.uncheckAll();this.model.disableItemsByIndex&&this.disableItemsByIndices(this.model.disableItemsByIndex.toString());this.model.enableItemsByIndex&&this.enableItemsByIndices(this.model.enableItemsByIndex.toString());this.model.uncheckItemsByIndex&&this.uncheckItemsByIndices(this.model.uncheckItemsByIndex.toString());this._deprecatedValue()._enabled(this.model.enabled)},_deprecatedValue:function(){return this.model.itemDrop=this.model.itemDrop||this.model.itemDropped,this.model.change=this.model.change||this.model.selectIndexChanged,this.model.fields.checkBy=this.model.fields.selected||this.model.fields.checkBy,this.model.fields.tooltipText=this.model.fields.toolTipText||this.model.fields.tooltipText,this.model.fields.groupBy=this.model.fields.category||this.model.fields.groupBy,this.model.select=this.model.select||this.model.selected,this.model.allowDragAndDrop!=r&&(this.model.allowDrag=this.model.allowDrop=!0),this.model.selectedIndex=this.model.selectedIndex!=null?this.model.selectedIndex:this.model.selectedItemIndex,this.model.checkedIndices=(this.model.checkedIndices.length?this.model.checkedIndices:null)||(this.model.checkItemsByIndex?this.model.checkItemsByIndex:null)||(this.model.checkedItems.length?this.model.checkedItems:null)||(this.model.checkedItemlist.length?this.model.checkedItemlist:[]),this.model.selectedIndices=(this.model.selectedIndices.length?this.model.selectedIndices:null)||(this.model.selectedItems.length?this.model.selectedItems:null)||(this.model.selectedItemlist.length?this.model.selectedItemlist:[]),this},_setModel:function(n){var i,r=!1,f,u;for(i in n)switch(i){case"value":this._setText(t.util.getVal(n[i]));break;case"dataSource":this.model.selectedIndex=null;n[i]=t.util.getVal(n[i]);this._checkModelDataBinding(n[i]);break;case"query":this._queryCheck(n[i]);break;case"fields":this.model.fields=n[i];this._checkModelDataBinding(this.dataSource());break;case"template":this.model.template=n[i];this.refresh(!0);break;case"loadDataOnInit":this._loadContent=n[i];this._checkModelDataBinding(this.dataSource());break;case"enableRTL":this.model.enableRTL=n[i];this.model.enableRTL?this.listContainer.addClass("e-rtl"):this.listContainer.removeClass("e-rtl");break;case"enabled":this.model.enabled=n[i];this._enabled(n[i]);break;case"enableWordWrap":this.model.enableWordWrap=n[i];this._wordWrapItems(n[i]);break;case"height":case"width":this.model[i]=n[i];this._setDimensions();break;case"cssClass":this.model.cssClass=n[i];this.listContainer.addClass(this.model.cssClass);break;case"showCheckbox":this._checkboxHideShow(n[i]);n[i]&&this._removeListHover();break;case"showRoundedCorner":this._roundedCorner(n[i]);break;case"selectedItemIndex":case"selectedIndex":this.listitem[n[i]]||n[i]==null?(this.selectItemByIndex(n[i]),this.model.selectedIndex=this.model.selectedItemIndex=n[i]):n[i]=this.model.selectedIndex;break;case"checkItemsByIndex":case"checkedItemlist":case"checkedItems":case"checkedIndices":this.uncheckAll();this.checkItemsByIndices(n[i].toString());n[i]=this.model[i]=this.model.checkedIndices;break;case"uncheckItemsByIndex":this.uncheckItemsByIndices(n[i].toString());this.model[i]=n[i];break;case"selectedItemlist":case"selectedItems":case"selectedIndices":this.unselectAll();this.selectItemsByIndices(n[i].toString());n[i]=this.model.selectedIndices;break;case"enableItemsByIndex":this.model[i]=n[i];this.enableItemsByIndices(n[i].toString());break;case"disableItemsByIndex":this.model[i]=n[i];this.disableItemsByIndices(n[i].toString());break;case"enableVirtualScrolling":this.model.allowVirtualScrolling=n[i];r=!0;break;case"allowDrag":case"allowDrop":case"allowDragAndDrop":case"allowVirtualScrolling":case"virtualScrollMode":this.model[i]=n[i];r=!0;break;case"checkAll":this.model[i]=n[i];n[i]?this.checkAll():this.uncheckAll();break;case"uncheckAll":this.model[i]=n[i];n[i]?this.uncheckAll():this.checkAll();break;case"htmlAttributes":this._addAttr(n[i]);break;case"itemsCount":f=this.model.itemsCount;this.model.height=="auto"?(this.model.itemsCount=n[i],this._setItemsCount()._setDimensions()):n[i]=f;break;case"allowMultiSelection":this.model.allowMultiSelection=n[i];n[i]||(u=this.model.selectedIndex,this._removeListHover(),t.isNullOrUndefined(u)?"":this.selectItemByIndex(u));break;case"totalItemsCount":t.isNullOrUndefined(this.dataSource())||(this.model.totalItemsCount=n[i],this.model.query&&this._queryCheck(this.model.query))}r&&this._refresh()},_destroy:function(){return t.isNullOrUndefined(this._lilist)||n(this._lilist).ejDraggable("destroy"),this.element.insertAfter(this.listContainer),this.element.find(".e-chkbox-wrap").remove(),this.listContainer.remove(),this._isList||this.element.empty(),n(window).off("resize",n.proxy(this._OnWindowResize,this)),this._ListEventUnbind(this.element.children("li")),this},_ListEventUnbind:function(t){t.off("contextmenu",n.proxy(this._OnMouseContext,this));t.off("click",n.proxy(this._OnMouseClick,this));t.off("touchstart mouseenter",n.proxy(this._OnMouseEnter,this));t.off("touchend mouseleave",n.proxy(this._OnMouseLeave,this))},_refresh:function(){this._destroy()._init()},_finalize:function(){return this.model.selectedIndex!=null?this.selectItemByIndex(this.model.selectedIndex):this.model.showCheckbox==!0&&this._selectedItems.length>0&&this._selectCheckedItem(this._selectedItems),this.model.checkedIndices!=null&&this.checkItemsByIndices(this.model.checkedIndices.toString()),this},_initialize:function(){return this._isList=this.element.children().length?!0:!1,this.target=this.element[0],this._queryString=null,this._disabledItems=[],this._itemId=null,this._up=this._down=this._ctrlClick=!1,this.checkedStatus=this._isScrollComplete=!1,this._incqueryString="",this._activeItem=null,this._initValue=!0,this.model.allowVirtualScrolling=this.model.allowVirtualScrolling?this.model.allowVirtualScrolling:this.model.enableLoadOnDemand,this.model.virtualScrollMode=this.model.enableVirtualScrolling?"continuous":this.model.virtualScrollMode,this._selectedItems=[],this._checkedItems=[],this._loadContent=this.model.loadDataOnInit,this._loadInitialRemoteData=!0,this._skipInitialRemoteData=!1,this.model.enableVirtualScrolling&&(this.model.allowVirtualScrolling=!0),this._setItemsCount(),this},_render:function(){return this._savedQueries=this.model.query.clone(),this.model.totalItemsCount&&this._savedQueries.take(this.model.totalItemsCount),this._renderContainer()._addAttr(this.model.htmlAttributes),t.DataManager&&this.dataSource()instanceof t.DataManager?(this.model.actionBegin&&this._trigger("actionBegin",{}),this._loadInitialRemoteData&&this._initDataSource(this.dataSource())):this._showFullList(),this.dataSource()||this._finalize(),this.model.showRoundedCorner&&this._roundedCorner(!0),this},_queryCheck:function(n){this._savedQueries=n.clone();this.element.empty();this.dataSource()&&this._checkModelDataBinding(this.dataSource())},_checkModelDataBinding:function(n){this.mergeValue=null;this.dataSource(n);n!=null?n.length!=0?t.DataManager&&n instanceof t.DataManager?this._initDataSource(n):this._showFullList():this.element.empty():this.element.empty()},_initDataSource:function(n){var t=this,i;t.listitems=t.dataSource();t._updateLoadingClass(!0);i=n.executeQuery(this._getQuery());i.done(function(n){t.listitems=n.result;t._updateLoadingClass()._showFullList()._trigger("actionSuccess",n);t._finalize()}).fail(function(n){t.dataSource(null);t._updateLoadingClass(!0)._trigger("actionFailure",n)}).always(function(n){t.model.checkAll&&t.checkAll();t.model.uncheckAll&&t.uncheckAll();t._trigger("actionComplete",n)})},_getQuery:function(){var i,r,n,u;if(t.isNullOrUndefined(this.model.query)){r=[];n=this.model.fields;i=t.Query();for(u in n)u!=="tableName"&&r.push(n[u]);r.length>0&&i.select(r);this.dataSource().dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||i.from(n.tableName)}else i=this._savedQueries;return i},_addDragableClass:function(){if(this.model.allowDrag||this.model.allowDrop){this.element.css("cursor","pointer");this.model.allowDrop&&(this.listContainer.addClass("e-droppable"),this.listBoxScroller.addClass("e-droppable"));var t=this;this.element.children("li").each(function(){t.model.allowDrag&&n(this).addClass("e-draggable");t.model.allowDrop&&n(this).addClass("e-droppable")})}return this},_enableDragDrop:function(){(this.model.allowDrag||this.model.allowDrop)&&this._drag()},_updateLoadingClass:function(n){return this.listContainer[n?"addClass":"removeClass"]("e-load"),this},_addAttr:function(t){var i=this;n.map(t,function(n,t){t=="class"?i.listContainer.addClass(n):t=="required"?i.element.attr(t,n):t=="disabled"&&n=="disabled"?i._enabled(!1):i.listContainer.attr(t,n)})},_renderContainer:function(){return this.listContainer=t.buildTag("div.e-ddl-popup e-box e-popup e-widget "+this.model.cssClass,"",{visibility:"hidden"},{tabIndex:0,id:this._id+"_container"}),this.listBoxScroller=t.buildTag("div"),this.ultag=t.buildTag("ul.e-ul","",{},{role:"listbox"}),this.element=this.element.addClass("e-ul"),this.listContainer.append(this.listBoxScroller).insertAfter(this.element),this.listBoxScroller.append(this.element),this.element.attr("unselectable","on").css("user-select","none"),this._hiddenInput=t.buildTag("input#"+this._id+"_hidden","",{},{type:"hidden"}).insertBefore(this.element),this._hiddenInput.attr("name",this._id),this},_setMapFields:function(){mapper=this.model.fields;this.mapFld={_id:null,_imageUrl:null,_imageAttributes:null,_tooltipText:null,_spriteCSS:null,_text:null,_value:null,_htmlAttributes:null,_selectBy:null,_checkBy:null};this.mapFld._id=mapper&&mapper.id?mapper.id:"id";this.mapFld._imageUrl=mapper&&mapper.imageUrl?mapper.imageUrl:"imageUrl";this.mapFld._tooltipText=mapper&&mapper.tooltipText?mapper.tooltipText:"tooltipText";this.mapFld._imageAttributes=mapper&&mapper.imageAttributes?mapper.imageAttributes:"imageAttributes";this.mapFld._spriteCSS=mapper&&mapper.spriteCssClass?mapper.spriteCssClass:"spriteCssClass";this.mapFld._text=mapper&&mapper.text?mapper.text:this.listitems[0].text?"text":this._getObjectKey(this.listitems[0])[0];this.mapFld._value=mapper&&mapper.value?mapper.value:"value";this.mapFld._htmlAttributes=mapper&&mapper.htmlAttributes?mapper.htmlAttributes:"htmlAttributes";this.mapFld._checkBy=mapper&&mapper.checkBy?mapper.checkBy:"checkBy";this.mapFld._selectBy=mapper&&mapper.selectBy?mapper.selectBy:"selectBy";this.mapCateg=mapper&&mapper.groupBy?mapper.groupBy:""},_getObjectKey:function(n){var t,i;if(Object.keys)return Object.keys(n);t=[];for(i in n)n.hasOwnProperty(i)&&t.push(i);return t},_renderlistContainer:function(){var e,i,o,y,c,f,s,a,v,h,l,u;if(this.hold=this.touchhold=!1,this.item="",this.startime=0,this.listitemheight=24,e=this.listitems,y=this.model.fields,this.lastScrollTop=-1,this.dummyUl=n(),this.model.enableRTL&&this.listContainer.addClass("e-rtl"),this._wordWrapItems(),this.dataSource()==null||this.dataSource().length<1)c=this.element.parents().last(),this.docbdy=this.model.targetID?c.find("#"+this.model.targetID):c.find("#"+this._id),this.itemsContainer=this.docbdy,this.itemsContainer.children("ol,ul").remove(),this.items=this.itemsContainer.children("li"),this.items.children("img").addClass("e-align"),this.items.children("div").addClass("e-align"),this.itemsContainer.children("span").addClass("e-ghead"),this.element.append(this.itemsContainer.children());else if(this.dataSource()!=null&&typeof e[0]!="object")if(this._loadInitialRemoteData&&this.mergeValue&&this.model.virtualScrollMode=="continuous"&&this.model.totalItemsCount)this._loadlist(this.mergeValue);else if(this._loadInitialRemoteData&&this.mergeValue&&this.model.virtualScrollMode=="normal"&&this.model.totalItemsCount){for(this.realUllength=0,this.mergeUl=[],i=0;i<this.mergeValue.length;i++)this.mergeUl.push(t.buildTag("li",this.mergeValue[i][this.model.fields.text],null,{style:"min-height:20px;"})[0]);for(this.element.append(this.mergeUl),i=0;i<this.model.totalItemsCount-this.mergeValue.length;i++)this.dummyUl.push(t.buildTag("li",null,null,{style:"min-height:20px;"})[0]);this.element.append(this.dummyUl);this._refreshScroller()}else this._loadInitialRemoteData&&this.mergeValue&&!this.model.totalItemsCount&&this._initDataSource(this.dataSource());else if(this._setMapFields(),s=this._savedQueries,this.listContainer.height(this.model.height),this.listitemheight=24,this.model.allowVirtualScrolling){if(this.model.virtualScrollMode=="normal"){if(this.realUllength=0,this.dataSource().length<0&&(query=this._savedQueries.take(parseInt(this.listContainer.height()/this.listitemheight)),u=this,t.DataManager&&this.dataSource()instanceof t.DataManager&&(u.listitems=u.dataSource(),a=this.dataSource().executeQuery(query),a.done(function(n){u._trigger("actionBeforeSuccess",n);u.listitems=n.result;u._trigger("actionSuccess",n)}).fail(function(n){u._trigger("actionFailure",n)}).always(function(n){u._trigger("actionComplete",n)}))),this.mergeValue&&this.mergeValue!=f&&this.mergeValue!=r){for(this.mergeUl=[],i=0;i<this.mergeValue.length;i++)this.mergeUl.push(t.buildTag("li",this.mergeValue[i][this.model.fields.text],null,{style:"min-height:20px;"})[0]);this.element.append(this.mergeUl)}for(v=this.model.totalItemsCount?this.mergeValue?this.model.totalItemsCount-this.mergeValue.length:this.model.totalItemsCount:this.listitems.length,i=0;i<v;i++)this.dummyUl.push(t.buildTag("li",null,null,{style:"min-height:20px;"})[0]);this.element.append(this.dummyUl)}this._loadInitialData(s,e)}else if(this.mapCateg&&this.mapCateg!="")for(s=t.Query().group(this.mapCateg),f=t.DataManager(e).executeLocal(s),this.dataSource([]),i=0;i<f.length;i++)this.dummyUl.push(t.buildTag("span.e-ghead",f[i].key)[0]),this._loadlist(f[i].items),this.dataSource(this.dataSource().concat(f[i].items));else if(f=t.DataManager(e).executeLocal(s),f.length>0){if(this.mergeValue&&this.mergeValue!=f&&this.mergeValue!=r)for(this.mergeUl=[],i=0;i<this.mergeValue.length;i++)this.mergeUl.push(t.buildTag("li",this.mergeValue[i][this.model.fields.text],null,{style:"min-height:20px;"})[0]),f.push(this.mergeValue[i]);if(this.model.template!=null){for(i=0;i<e.length;i++)h=this._getField(e[i],this.mapFld._htmlAttributes),l=this._getField(e[i],this.mapFld._id),o=t.buildTag("li"),h&&h!=""&&o.attr(h),l&&o.attr("id",l),this.model.template&&o.append(this._getTemplatedString(e[i])),this.dummyUl.push(o[0]);this.element.append(this.dummyUl)}else this.realUllength=0,this._loadlist(f)}u=this;this._setDimensions();this.listContainer.css({position:"relative",height:""});this.listBoxScroller.css({height:"",width:""});this.listContainer.ejScroller({height:this.listContainer.height(),width:0,scrollerSize:20,scroll:function(n){(n.source=="key"||n.source=="wheel"||n.source!="button"&&n.source!="thumb"&&n.source!="custom")&&u.model!=null&&u._onScroll(n)},thumbEnd:function(n){u.model!=null&&u._onScroll(n)},scrollEnd:function(n){n.scrollData.source=="button"&&u.model!=null&&u._onScroll(n)}});this.scrollerObj=this.listContainer.ejScroller("instance");this._setDimensions();this.listContainer.css({display:"none",visibility:"visible"});this._checkboxHideShow(this.model.showCheckbox)._checkitems()._showResult();this.model.totalItemsCount&&this._setTotalItemsCount()},_wordWrapItems:function(){this.model.enableWordWrap?this.listContainer.addClass("e-wrap").removeClass("e-nowrap"):this.listContainer.addClass("e-nowrap").removeClass("e-wrap")},_loadInitialData:function(n,u){var f=n.clone();if(this.realUllength=0,f=t.DataManager&&this.dataSource()instanceof t.DataManager?f.range(0,parseInt(this.listContainer.height()/this.listitemheight)):f.range(0,this.listitems.length),groupedList=t.DataManager(u).executeLocal(f),this.mergeValue&&this.mergeValue!=groupedList&&this.mergeValue!=r&&this.model.virtualScrollMode=="continuous"){for(this.mergeUl=[],i=0;i<this.mergeValue.length;i++)this.mergeUl.push(t.buildTag("li",this.mergeValue[i][this.model.fields.text],null,{style:"min-height:20px;"})[0]);this.element.append(this.mergeUl)}(!this.mergeValue||this.mergeValue&&this._loadInitialRemoteData)&&this._loadlist(groupedList)},_loadlist:function(i){var e,r,s,u,f;if(this.element!=null){for(e=[],r=0;r<i.length;r++){var w=this._getField(i[r],this.mapFld._id),c=this._getField(i[r],this.mapFld._imageUrl),l=this._getField(i[r],this.mapFld._imageAttributes),a=this._getField(i[r],this.mapFld._spriteCSS),h=this._getField(i[r],this.mapFld._text),v=this._getField(i[r],this.mapFld._value),y=this._getField(i[r],this.mapFld._htmlAttributes),b=this._getField(i[r],this.mapFld._selectBy),k=this._getField(i[r],this.mapFld._checkBy),p=this._getField(i[r],this.mapFld._tooltipText),o=this.model.virtualScrollMode=="continuous"&&this.mergeValue?this.realUllength+this.mergeValue.length:this.realUllength;litag=v&&v!=""?t.buildTag("li","","",{value:v,style:"min-height:20px;"}):t.buildTag("li",null,null,{style:"min-height:20px;"});w&&litag.attr("id",w);c&&c!=""&&(imgtag=t.buildTag("img.e-align","",{},{src:c,alt:h}),l&&l!=""&&imgtag.attr(l),litag.append(imgtag));a&&a!=""&&(divtag=t.buildTag("div.e-align "+a+" sprite-image"),litag.append(divtag));h&&h!=""&&litag.append(h);y&&y!=""&&litag.attr(y);p&&p!=""&&litag.attr("data-content",p).addClass("e-tooltip");(k||this.model.checkAll)&&litag.addClass("checkItem");(b||this.model.selectAll)&&litag.addClass("selectItem");this.element.children()[o]!=null&&this.model.allowVirtualScrolling&&n(this.element.children()[o]).text()==""?n(this.element.children()[o]).replaceWith(litag[0]):this.model.allowVirtualScrolling&&this.model.virtualScrollMode=="normal"?n(this.dummyUl[o]).text(n(litag[0]).text()):this.dummyUl.push(litag[0]);this.realUllength+=1}if(this.model.allowVirtualScrolling||this.element.children().remove(),this.element.children()[o]==null&&(!this.model.allowVirtualScrolling||this.model.virtualScrollMode==t.VirtualScrollMode.Continuous)&&this._loadContent&&this.element.append(this.dummyUl),s=this.element.find("li"),this.model.showCheckbox&&this.model.checkedIndices)for(u=0;u<s.length;u++)this.model.checkedIndices.indexOf(u)!=-1&&n(s[u]).addClass("checkItem");else if(!this.model.showCheckbox)for(this.value()!=""&&this.selectItemByText(this.value()),u=0;u<s.length;u++)(this.model.selectedIndices.indexOf(u)!=-1||this.model.selectedIndex==u)&&n(s[u]).addClass("selectItem");this.element.find(".selectItem").each(function(t,i){e.push(n(i).index())});f=this;f.model.showCheckbox||f._selectListItems();this.element.find(".checkItem").each(function(n,t){f.model.checkedIndices.push(f._elementIndex(t))});e.length&&(this.model.allowMultiSelection?this.model.selectedIndices=e:this.model.selectedIndex=e[0]);this.model.checkedIndices?this.model.checkedIndices=n.grep(f.model.checkedIndices,function(t,i){return i==n.inArray(t,f.model.checkedIndices)}):this.model.selectedIndices&&(this.model.selectedIndices=n.grep(f.model.selectedIndices,function(t,i){return i==n.inArray(t,f.model.selectedIndices)}));this._loadContent=!0}return this},_applySelection:function(){if(!(this.model.fields.checkBy||this.model.fields.selectBy))return!1;this.model.showCheckbox?(this.uncheckAll(),this.checkItemsByIndices(this.model.checkedIndices)):this.model.allowMultiSelection?this.selectItemsByIndices(this.model.selectedIndices):(this.unselectAll(),this.selectItemByIndex(this.model.selectedIndex))},_getField:function(n,i){return t.pvt.getObject(i,n)},_getTemplatedString:function(n){for(var t=this.model.template,i=t.indexOf("${"),r=t.indexOf("}"),u,f;i!=-1&&r!=-1;)u=t.substring(i,r+1),f=u.replace("${","").replace("}",""),t=t.replace(u,this._getField(n,f)),i=t.indexOf("${"),r=t.indexOf("}");return t},_checkboxHideShow:function(n){return this.model.showCheckbox=n,n?this._createCheckbox():this._removeCheckbox(),this},_createCheckbox:function(){var i,f,e=this,r,u;for(this._listitems=this.listContainer.find("ol,ul").children("li"),f=this._listitems.find("input[type=checkbox]"),i=0;i<this._listitems.length;i++)n(this._listitems[i]).text()!=""&&($checkbox=t.buildTag("input.listcheckbox e-align#popuplist"+i+"_"+this._id,"",{},{type:"checkbox",name:"list"+i}),n(this._listitems[i]).find("input[type=checkbox]").length||n(this._listitems[i]).prepend($checkbox));for(this.listContainer.find(".listcheckbox").ejCheckBox({cssClass:this.model.cssClass,change:n.proxy(this._onClickCheckList,this)}),i=0;i<this._listitems.length;i++)r=n(this._listitems[i]).find(".listcheckbox"),n(this._listitems[i]).hasClass("e-disable")?r.ejCheckBox("disable"):n(this._listitems[i]).hasClass("checkItem")&&!r.ejCheckBox("isChecked")&&(r.ejCheckBox({checked:!0}),this._activeItem=i,this.checkedStatus=!0,u=this._getItemObject(n(this._listitems[i]),null),u.isInteraction=!0,this._initValue||this._trigger("checkChange",u),n(this._listitems[i]).removeClass("checkItem"));for(i=0;i<this.model.selectedIndices.length;i++)this.checkItemsByIndices(this.model.selectedIndices)},_removeCheckbox:function(){var n,t;if(this.listitem=this.listContainer.find("ol,ul").children("li"),t=this.listitem.find(".listcheckbox"),t.length>0){if(this.listitem.find(".listcheckbox").ejCheckBox("destroy"),this.listitem.find("input[type=checkbox]").remove(),this.model.allowMultiSelection)for(n=0;n<this.model.checkedIndices.length;n++)this.selectItemsByIndices(this.model.checkedIndices);else this.selectItemByIndex(this.model.checkedIndices[0]);this._checkedItems=this.model.checkedIndices=[]}},_selectCheckedItem:function(n){if(n.length>0)for(i=0;i<n.length;i++)this._selectedItems.push(n[i])},_refreshScroller:function(){if(this.model.virtualScrollMode=="continuous")this.listContainer.find(".e-content, .e-vhandle,.e-vhandle div").removeAttr("style"),this.listContainer.css({display:"block"}),this.scrollerObj&&(this.scrollerObj.model.height=this.listContainer.height(),this.scrollerObj.refresh(),this.scrollerObj.option("scrollTop",0));else{this.listContainer.find(".e-vhandle div").removeAttr("style");var n=this.listBoxScroller.height();this.listContainer.css({display:"block"});this.scrollerObj&&(this.scrollerObj.model.height=this.listContainer.css("height"),this.scrollerObj.refresh());this.listBoxScroller.css("height","100%")}this.model.enabled||this.scrollerObj&&this.scrollerObj.disable();this.listContainer.css("height",this.model.height)},_setDimensions:function(){return this.listContainer.css({width:this.model.width,height:this.model.height}),this._refreshScroller(),this},_setItemsCount:function(){return this.model.height=this.model.itemsCount&&this.model.itemsCount!=0&&this.model.height=="auto"?this.model.itemsCount*30:this.model.height=="auto"?"220":this.model.height,this},_setTotalItemsCount:function(){this.model.virtualScrollMode!="continuous"&&(this.element.height(this.element.find("li").outerHeight()*this.model.totalItemsCount),this.scrollerObj.refresh())},_refreshContainer:function(){this.listContainer.css({position:"relative"});this._setDimensions()._roundedCorner()._refreshScroller()},_drag:function(){var i=this,u=!1,r=null;this._listitem=this.element.parent();this._lilist=this._addItemIndex?n(n(this._listitem).find("li")[this._addItemIndex]):n(this._listitem).find("li");this._lilist.not(".e-js").ejDraggable({dragArea:null,clone:!0,dragStart:function(t){var f,u;if(i.model.allowDrag||i.model.allowDragAndDrop){if(n(t.element.closest(".e-ddl-popup.e-js")).hasClass("e-disable")||t.element.hasClass("e-disable"))return r&&r.remove(),!1;if(f=n("#"+this.element.parent()[0].id).data("ejListBox"),f._refreshItems(),u=i.getSelectedItems(),u.length>1?i._onDragStarts(u,t.target):i._onDragStarts([i._getItemObject(t.element,t)],t.target))return t.cancel=!0,r&&r.remove(),!1}else return!1},drag:function(t){var r=t.target,u=i.getSelectedItems();if(u.length>1?i._onDrag(u,r):i._onDrag([i._getItemObject(t.element,t)],r))return!1;(n(r).hasClass("e-droppable")||n(r).parent().hasClass("e-droppable"))&&n(r).addClass("allowDrop")},dragStop:function(t){t.element.dropped||r&&r.remove();var f=t.target,o=i,s=u?"Before":"After",e=i.getSelectedItems();if((e.length>1?i._onDragStop(e,f):i._onDragStop([i._getItemObject(t.element,t)],f))||(n(t.element).removeClass("e-active"),f.nodeName=="UL"&&(f=n(f).children()[0]),n(f).closest("li").length?f=n(t.target).closest("li")[0]:f.nodeName!="LI"&&(f=n(f).closest(".e-ddl-popup.e-droppable")[0]),f&&f.nodeName=="LI"&&n(f).hasClass("e-droppable")&&n(f).closest(".e-ddl-popup.e-droppable").length?i._dropItem(f,t.element,u,t.event):n(f).hasClass("e-droppable")&&n(f).closest(".e-ddl-popup.e-droppable").length&&i._dropItemContainer(f,t.element,t.event),n(".allowDrop").removeClass("allowDrop"),t.target!=i.element[0]&&t.element.parent().length&&n(t.element.parent()[0]).data().ejWidgets[0]=="ejListBox"&&(i=n("#"+t.element.parent()[0].id).data(n(t.element.parent()[0]).data().ejWidgets[0]),e.length>1?i._onDropped(e,f):i._onDropped([i._getItemObject(t.element),t],t.target))))return!1;i.model.allowDrag||i.model.allowDragAndDrop||i.element.children().removeClass("e-draggable")},helper:function(u){if(!t.isNullOrUndefined(u.element)&&!n(u.element.closest(".e-ddl-popup.e-js")).hasClass("e-disable")&&n(u.element).hasClass("e-draggable")&&(i=n(u.element).closest(".e-listbox.e-js").data("ejListBox"),i._tempTarget=n(u.element).text(),(i.model.allowDrag||i.model.allowDragAndDrop)&&i))return r=n(u.sender.target).clone().addClass("dragClone dragClonelist"),r.addClass(i.model.cssClass+(i.model.enableRTL?" e-rtl":"")),r.css({width:i.element.width(),padding:"5px 5px 5px 0.857em","list-style":"none","text-align":i.model.enableRTL?"right":"left",opacity:"1"}),r.appendTo(n("body"))}})},_dropItem:function(t,i,r,u){var o;i.addClass("e-droppable");var h=n(t).closest(".e-ddl-popup.e-droppable")[0].id.replace("_container",""),s=[],f=[],e=n("#"+h).data("ejListBox"),c=e.model.showCheckbox?!this.model.showCheckbox:this.model.showCheckbox;c||(o=this._getDropObject(t,i,u),s=o.dataIndex,f=o.dataObj,r?n(li).insertBefore(t):n(li).insertAfter(t),this._refreshItems(),f&&this.dataSource()&&this._dropDataSource(e,s,f,li.index()),e._refreshItems())},_dropItemContainer:function(t,i,r){i.addClass("e-droppable");var s=n(t)[0].id.replace("_container",""),u=n("#"+s).data("ejListBox"),h=u.model.showCheckbox?!this.model.showCheckbox:this.model.showCheckbox;if(!h){var e=[],f=[],o=this._getDropObject(t,i,r);e=o.dataIndex;f=o.dataObj;li.insertAfter(n(n(t).find("li")).last());n(t).find("ul").append(li);this._refreshItems();f&&this.dataSource()&&this._dropDataSource(u,e,f,u.dataSource()?u.dataSource().length:0);u.model.allowDrag||n(li).ejDraggable("instance")._destroy();u._refreshItems()}},_dropDataSource:function(i,r,u,f){var o=t.DataManager&&this.dataSource()instanceof t.DataManager,e;o||(r instanceof Array?(e=this,n.each(u,function(n){indx=e.dataSource().indexOf(u[n]);e.dataSource().splice(indx,1)})):this.dataSource().splice(r,1),i.dataSource()instanceof Array?i.dataSource().splice.apply(i.dataSource(),[f,0].concat(u)):i.dataSource(u))},_getDropObject:function(t,i){var r=[],u=[];return this.model.allowMultiSelection?(li=n(i).parent().find(".e-select").removeClass("e-select e-hover"),li.length||(li=i.removeClass("e-select e-hover"))):li=i.removeClass("e-select e-hover"),li.length?(proxy=this,n.each(li,function(){r.push(n(this).index());u.push(proxy.dataSource()?proxy.dataSource()[n(this).index()]:null)})):(r=li.index(),u=this.dataSource()?this.dataSource()[r]:null),{dataIndex:r,dataObj:u}},_showResult:function(){var i=this,t;this._refreshContainer();this.element.attr({"aria-expanded":!0});t=this.element.children("li");this._listSize=t.length;this._ListEventUnbind(t);t.on("touchstart mouseenter",n.proxy(this._OnMouseEnter,this));t.on("touchend mouseleave",n.proxy(this._OnMouseLeave,this));t.on("click",n.proxy(this._OnMouseClick,this));t.on("contextmenu",n.proxy(this._OnMouseContext,this));return i.model.showCheckbox&&i.element.find(".listcheckbox").ejCheckBox({enabled:i.model.enabled}),this},_OnWindowResize:function(){this._refreshContainer();this.listContainer.css("display","block")},refresh:function(n){t.isNullOrUndefined(this.model.query)||(this._savedQueries=this.model.query);n||t.isNullOrUndefined(n)?(this.model.template&&this.element.empty(),this._checkModelDataBinding(this.dataSource())):(this.listContainer.css({height:this.model.height,width:this.model.width}),this._refreshScroller())},_removeListHover:function(){return this._selectedItems=[],this.model.selectedIndices=[],this.model.selectedIndex=null,this.element.children("li").removeClass("e-hover e-select selectItem"),this},_addListHover:function(){this._activeItem=this._selectedItem;var n=this._getItem(this._selectedItem);n.addClass("e-select e-hover");this.scrollerObj.setModel({scrollTop:this._calcScrollTop()});n.focus();this._OnListSelect(this.prevselectedItem,this._selectedItem)},_calcScrollTop:function(n){for(var f=this.element.outerHeight(),r=this.element.find("li"),u=0,i=n?n:this.element.find("li.e-select").index(),t=0;t<i;t++)u+=r.eq(t).outerHeight();return u-(this.listContainer.outerHeight()-r.eq(i).outerHeight())/2},_refreshItems:function(){this.listBoxScroller.append(this.element);this.listContainer.append(this.listBoxScroller);this._refreshContainer();this._showResult();this._setSelectionValues();this._setDisableValues()},_selectedIndices:function(){var t;return this.element.children("li").each(function(i){if(n(this).hasClass("e-select"))return t=i,!1}),this._selectedItem=t,t},_addSelectedItem:function(t){(!n.isArray(this.model.disableItemsByIndex)&&this.model.disableItemsByIndex!=null||n.isArray(this.model.disableItemsByIndex)&&this.model.disableItemsByIndex.length>0)&&(t.keyCode==40||t.keyCode==39?this._disableItemSelectDown():this._disableItemSelectUp(),this._selectedItem=this._activeItem);var i=this._getItem(this._selectedItem);this._selectedItems.push(i)},_getItem:function(t){return n(this.element.children("li")[t])},_getItemObject:function(n,t){var i=this._elementIndex(n);return{item:n,index:i,text:n.text(),value:n.attr("value")?n.attr("value"):n.text(),isEnabled:!n.hasClass("e-disable"),isSelected:n.hasClass("e-select"),isChecked:n.find(".e-chk-image").hasClass("e-checkmark"),data:this.dataSource()?this.getListData()[i]:null,event:t?t:null}},_roundedCorner:function(n){return this.listContainer[n?"addClass":"removeClass"]("e-corner-all"),this},_enabled:function(n){return n?this.enable():this.disable(),this},_showFullList:function(){return this.dataSource()!=null&&(t.DataManager&&this.dataSource()instanceof t.DataManager||(this.listitems=this.dataSource()),!this._savedQueries.queries.length||t.DataManager&&this.dataSource()instanceof t.DataManager||(this.listitems=t.DataManager(this.dataSource()).executeLocal(this._savedQueries))),this._renderlistContainer(),this.dataSource()instanceof t.DataManager||this._trigger("actionComplete"),this._addDragableClass()._enableDragDrop(),this._disabledItems=[],this.disableItemsByIndices(this.model.disableItemsByIndex),this.model.selectedIndex&&this.selectItemByIndex(this.model.selectedIndex),this.selectItemsByIndices(this.model.selectedIndices),this.checkItemsByIndices(this.model.checkedIndices),this._tooltipList(),this},_tooltipList:function(){this.listContainer.find("li").hasClass("e-tooltip")&&n(this.listContainer).ejTooltip({target:".e-tooltip",isBalloon:!1,position:{target:{horizontal:"center",vertical:"bottom"},stem:{horizontal:"left",vertical:"top"}}})},_cascadeAction:function(){this.model.cascadeTo&&(this._currentValue=this._getField(this.listitems[this._activeItem],this.mapFld._value),this.selectDropObj=n("#"+this.model.cascadeTo).ejListBox("instance"),t.isNullOrUndefined(this._dSource)&&(this._dSource=this.selectDropObj.dataSource()),this._performJsonDataInit())},_performJsonDataInit:function(){this._changedSource=t.DataManager(this._dSource).executeLocal(t.Query().where(this.mapFld._value,"==",this._currentValue));this.selectDropObj.setModel({dataSource:this._changedSource,enable:!0,value:"",selectedIndex:-1})},_OnMouseContext:function(n){return n.preventDefault(),!1},_OnMouseEnter:function(t){var i,r,u;this.startime=0;this.item="";t.type=="touchstart"&&(this.item=n(t.target).text(),this.startime=(new Date).getTime());this.model.enabled&&(this.element.children("li").removeClass("e-hover"),n(t.target).is("li")&&n(t.target).addClass("e-hover"),n(t.target).hasClass("e-disable")?n(t.target).removeClass("e-hover"):t.target.tagName!="li"&&(i=n(t.target).parents("li"),n(i).addClass("e-hover")),u=0,this.element.children("li").each(function(t){if(n(this).hasClass("e-hover"))return r=t,!1}),this._hoverItem=r)},_OnMouseLeave:function(t){this.element.children("li").removeClass("e-hover");this.endtime=(new Date).getTime();(this.endtime-this.startime)/200>2&&this.item==n(t.target).text()&&(this.hold=(this.endtime-this.startime)/200>2?!this.hold:!1)},_OnMouseClick:function(i){var u,o,s,e,f,c,h;if(i.which==3&&(this.hold=!0),this.endtime=(new Date).getTime(),(this.endtime-this.startime)/200>2&&(this.model.template||this.item!=n(i.target).text()||this.hold||(this.hold=(this.endtime-this.startime)/200>2)),i.shiftKey&&this._shiftkey&&(this._shiftkey=!1,this.prevselectedItem=this._activeItem),t.isNullOrUndefined(this._hoverItem)||(this._activeItem=this._hoverItem),this.model.enabled&&this._activeItem!=r){if((!i.shiftKey||isNaN(this.prevselectedItem))&&(this._shiftkey=!0,this.prevselectedItem=this._lastEleSelect?this._lastEleSelect:this._activeItem),this.model.showCheckbox){if(n(i.currentTarget).is("li")&&n(i.target).is("li"))n(i.currentTarget.firstChild).find(".listcheckbox").ejCheckBox("isChecked")?(n(i.currentTarget.firstChild).find(".listcheckbox").ejCheckBox("option","checked",!1),f=this.model.checkedIndices.indexOf(n(i.currentTarget).index()),this._checkedItems.splice(f,1),this.model.checkedIndices.splice(f,1),this.checkedStatus=!1):(n(i.currentTarget.firstChild).find(".listcheckbox").ejCheckBox("option","checked",!0),this._checkedItems.push(this._activeItem),this.model.checkedIndices.push(this._elementIndex(i.currentTarget)),this.checkedStatus=!0);else if(n(i.currentTarget).is("li")&&n(i.target).is("span"))n(i.currentTarget.firstChild).find(".listcheckbox").ejCheckBox("isChecked")?(this._checkedItems.push(this._activeItem),this.model.checkedIndices.push(n(i.currentTarget).index()),this.checkedStatus=!0):(f=this.model.checkedIndices.indexOf(n(i.currentTarget).index()),this._checkedItems.splice(f,1),this.model.checkedIndices.splice(f,1),this.checkedStatus=!1);else return!1;this.selectedTextValue=n(i.currentTarget).text();!this.element.hasClass("e-disable")&&n(i.target).is("li")&&(c={status:this.model.enabled,isChecked:this.checkedStatus,selectedTextValue:this.selectedTextValue},h=this._getItemObject(n(i.target),i),h.isInteraction=!0,this._trigger("checkChange",h));this._lastEleSelect=n(i.currentTarget).index()}else u=n(this.element.children("li")[this._hoverItem]),this.model.allowMultiSelection&&(i.ctrlKey||this.touchhold||this.hold||i.shiftKey)||this._removeListHover(),this.element.children("li").removeClass("e-hover"),!u.hasClass("e-select")||i.shiftKey&&this.model.allowMultiSelection?(u.addClass("e-select"),this._selectedItems.push(u),this.model.selectedIndices.push(this._activeItem),i.shiftKey&&this.model.allowMultiSelection&&(i.ctrlKey||this._removeListHover(),this.prevselectedItem<this._activeItem?(o=this.prevselectedItem,s=this._activeItem):(o=this._activeItem,s=this.prevselectedItem),this._activeItemLoop(o,s))):(u.removeClass("e-select"),this._selectedItems.splice(this.model.selectedIndices.indexOf(this._activeItem),1),this.model.selectedIndices.splice(this.model.selectedIndices.indexOf(this._activeItem),1)),this._selectedItem=this._selectedIndices(),this.model.selectedIndex=this._activeItem,this._cascadeAction(),e=n(this.element.children("li")[this._selectedItem]),n(e).text()!=""&&(this.element.val(n(e).text()),this.element.attr({value:this.element.val()})),this.model.selectedText=u.text(),this._selectedData=this._getItemObject(n(e),i),this._selectedData.isInteraction=!0,this._prevSelectedData&&this._selectedData.text!=this._prevSelectedData.text&&this._trigger("unselect",this._prevSelectedData),this._trigger("select",this._selectedData),this._prevSelectedData=this._selectedData,this._lastEleSelect=this._activeItem,this._selectedItems&&this._selectedItems.length!=1&&(this._ctrlClick=!0);this._setSelectionValues()._OnListSelect(this.prevselectedItem,this._activeItem)}i.target.nodeName!="INPUT"&&this.listContainer.focus();this._pageUpStep=this._pageDownStep=null},_activeItemLoop:function(t,i){this.model.showCheckbox&&(this.element.find(".listcheckbox").ejCheckBox("option","checked",!1),this._checkedItems=[],this.model.checkedIndices=[]);for(var r=t;r<=i;r++)this.model.showCheckbox?(this.element.find(".listcheckbox").eq(r).ejCheckBox("option","checked",!0),this._checkedItems.push(this._activeItem),this.model.checkedIndices.push(r),this.checkedStatus=!0):(activeitem=n(this.element.children("li")[r]),activeitem.hasClass("e-disable")||(activeitem.hasClass("e-select")||activeitem.addClass("e-select"),this._selectedItems.push(activeitem),this.model.selectedIndices.push(this._activeItem)))},_setSelectionValues:function(){var u=[],f=this.model.selectedIndices,e=this.model.checkedIndices,r,o,i;if(this.model.selectedIndices=[],this.model.checkedIndices=[],r=this,this.model.showCheckbox?this.element.find("li .listcheckbox:checked").closest("li").each(function(t,i){u.push(n(i).attr("value")?n(i).attr("value"):n(i).text());r.model.checkedIndices.push(r._elementIndex(i))}):(!t.isNullOrUndefined(this._activeItem)&&this._activeItem>=0&&(this.model.selectedIndex=this._activeItem),o=this.element.children("li"),this.element.children("li.e-select").each(function(t,i){u.push(n(i).attr("value")?n(i).attr("value"):n(i).text());r.model.selectedIndices.push(o.index(i))})),t.DataManager&&t.DataManager&&this.dataSource()instanceof t.DataManager&&this.model.allowVirtualScrolling)if(this.model.showCheckbox)for(i=0;i<e.length;i++)this.model.checkedIndices.indexOf(e[i])==-1&&this.model.checkedIndices.push(e[i]);else for(i=0;i<f.length;i++)this.model.selectedIndices.indexOf(f[i])==-1&&this.model.selectedIndices.push(f[i]);return this.model.selectedItemIndex=this.model.selectedIndex,this.model.selectedItems=this.model.selectedItemlist=this.model.selectedIndices,this.model.checkedItems=this.model.checkedItemlist=this.model.checkItemsByIndex=this.model.checkedIndices,this.value(u.toString()),this._hiddenInput.val(this.value()),this},_setDisableValues:function(){this._disabledItems=[];this.model.disableItemsByIndex=[];for(var i=this.element.children().length,t=0;t<i;t++)n(this.element.children()[t]).hasClass("e-disable")&&this.model.disableItemsByIndex.push(t);this.disableItemsByIndices(this.model.disableItemsByIndex)},_onClickCheckList:function(t){if(t.isChecked||n("#"+t.model.id).closest("li").removeClass("checkItem"),t.isInteraction&&(this.checkedStatus=t.isChecked?!0:!1,!this._initValue)){this.checkedStatus?this.model.checkedIndices.push(n(t.event.target).closest("li").index()):this.model.checkedIndices.splice(n.inArray(n(t.event.target).closest("li").index(),this.model.checkedIndices),1);var i=this._getItemObject(n(t.event.target).closest("li"),t);i.isInteraction=!0;this._trigger("checkChange",i)}},_elementIndex:function(t){return n(t).parent().children("li").index(t)},_disableItemSelectCommon:function(){this.listitems=this.element.find("li");this._activeItem=this.listitems.index(this.element.find(".e-select"))},_disableItemSelectUp:function(){var t,i;for(this._disableItemSelectCommon(),t=typeof this.model.disableItemsByIndex!="object"?this.model.disableItemsByIndex.split(",").sort().reverse():this.model.disableItemsByIndex,this._activeItem==0?this._activeItem=this.listitems.length-1:this._activeItem--,i=0;n.inArray(this._activeItem.toString(),t.toString())>-1;i++)this._activeItem--,this._activeItem<0&&(this._activeItem=this.listitems.length-1);n(this.element.children("li")[this._activeItem]).addClass("e-select")},_disableItemSelectDown:function(){var t,i;for(this._disableItemSelectCommon(),t=typeof this.model.disableItemsByIndex!="object"?this.model.disableItemsByIndex.split(",").sort():this.model.disableItemsByIndex,this.listitems.length-1==this._activeItem?this._activeItem=0:this._activeItem++,i=0;n.inArray(this._activeItem.toString(),t.toString())>-1;i++)this._activeItem++,this.listitems.length==this._activeItem&&(this._activeItem=0);n(this.element.children("li")[this._activeItem]).addClass("e-select")},_checkitems:function(){var r,t;if(this.model.showCheckbox)for(r=this.element.find("li"),i=0;i<this.model.checkedIndices.length;i++)t=this.model.checkedIndices[i],n(r[t]).find(".listcheckbox").ejCheckBox("option","checked",!0),this._checkedItems.push(r[t]);else if(this.model.allowMultiSelection)for(i=0;i<this.model.selectedIndices.length;i++)t=this.model.selectedIndices[i],n(this.listitem[t]).hasClass("e-select")||(n(this.listitem[t]).addClass("e-select"),this._selectedItems.push(n(this.listitem[t])));else n(this.listitem[this.model.selectedIndex]).hasClass("e-select")||n(this.listitem[this.model.selectedIndex]).addClass("e-select"),this._selectedItems.push(n(this.listitem[this.model.selectedIndex]));return this._setSelectionValues(),this},_OnListSelect:function(i,r,u){if(!t.isNullOrUndefined(i)&&i!=r&&!this.model.showCheckbox){var f=this._getItemObject(n(this.element.find("li")[r]),u);f.isInteraction=!0;this._trigger("change",f)}},_OnKeyDown:function(t){var r,a,h,c,l,o,i,e,f,s,u;if(this.model.enabled){this._selectedItems&&this._selectedItems.length==1&&!this.model.showCheckbox&&(this._lastEleSelect=n(this.element.children("li.e-select")).index());this._itemId=null;r=this.element.children("li");a=this;c=this.listContainer.height();h=r.outerHeight();l=Math.round(c/h)!=0?Math.round(c/h):7;this._listSize=this.element.children("li").length;t.shiftKey||(this._up=this._down);t.keyCode!=33&&t.keyCode!=34&&(this._pageUpStep=this._pageDownStep=null);switch(t.keyCode){case 37:case 38:if(o=this.element.find("li"),i=this.model.showCheckbox?this._lastEleSelect||0:o.index(this.element.find("li.e-select")),t.shiftKey&&this.model.allowMultiSelection&&!this.model.showCheckbox){if(this._lastEleSelect==0)return!1;for(this._lastEleSelect=this._ctrlClick?this._lastEleSelect-1:this._lastEleSelect,i=this._lastEleSelect,this._selectedItem=i||i==0?i==0?this._listSize-1:this._down?i:i-1:0,f=this._selectedItem;n(r[f]).hasClass("e-disable");f--)this._selectedItem-=1;if(n(r[this._selectedItem]).hasClass("e-select")&&this.element.find("li.e-select").length==1&&(this._selectedItem-=1),e=n(r[this._selectedItem]),e.hasClass("e-select")){if(this._selectedItem==0)return;e.removeClass("e-select");this._selectedItems.pop()}else e.addClass("e-select"),this._selectedItems.push(e);this.scrollerObj.setModel({scrollTop:this._calcScrollTop(this._selectedItem)});this._up=!0;this._down=!1;this._ctrlClick=!1}else{for(this._selectedItem=i||i==0?i==0?this._listSize-1:i-1:0,f=this._selectedItem;n(r[f]).hasClass("e-disable");f--)this._selectedItem-=1;this._selectedItem==-1&&(this._selectedItem=this._listSize-1);this._addSelectedItem(t);n(r).removeClass("e-hover e-select");s=this.model.showCheckbox?"e-hover":"e-select";n(r[this._selectedItem]).addClass(s);this.scrollerObj.setModel({scrollTop:this._calcScrollTop(this._selectedItem)})}return this._activeItem=this.prevselectedItem=this._selectedItem,this._OnListSelect(this._selectedItem+1,this._selectedItem,t),this._lastEleSelect=this._selectedItem,this._keyCascade(r[this._selectedItem]),this._setSelectionValues(),t.preventDefault(),!1;case 39:case 40:if(o=this.element.find("li"),i=this.model.showCheckbox?this._lastEleSelect||0:o.index(this.element.find("li.e-select")),t.shiftKey&&this.model.allowMultiSelection&&!this.model.showCheckbox){if(this._lastEleSelect==this._listSize-1)return!1;for(this._lastEleSelect=this._ctrlClick?this._lastEleSelect+1:this._lastEleSelect,i=this._lastEleSelect,this._selectedItem=i||i==0?i==this._listSize-1?0:this._up||this._ctrlClick?i:i+1:0,f=this._selectedItem;n(r[f]).hasClass("e-disable");f++)this._selectedItem+=1;n(r[this._selectedItem]).hasClass("e-select")&&this.element.find("li.e-select").length==1&&(this._selectedItem+=1);e=n(r[this._selectedItem]);e.hasClass("e-select")?(e.removeClass("e-select"),this._selectedItems.pop()):(e.addClass("e-select"),this._selectedItems.push(e));this.scrollerObj.setModel({scrollTop:this._calcScrollTop(this._selectedItem)});this._up=!1;this._down=!0;this._ctrlClick=!1}else{for(this._selectedItem=i||i==0?i==this._listSize-1?0:i+1:0,f=this._selectedItem;n(r[f]).hasClass("e-disable");f++)this._selectedItem+=1;this._selectedItem==this._listSize&&(this._selectedItem=0);this._addSelectedItem(t);n(r).removeClass("e-hover e-select");s=this.model.showCheckbox?"e-hover":"e-select";n(r[this._selectedItem]).addClass(s);this.scrollerObj.setModel({scrollTop:this._calcScrollTop(this._selectedItem)});this.element.find("li").removeClass("selectItem");this.model.selectedIndices.length=0;this.model.selectedIndices.push(this._selectedItem)}return this._activeItem=this.prevselectedItem=this._selectedItem,this._OnListSelect(this._selectedItem-1,this._selectedItem),this._lastEleSelect=this._selectedItem,this._keyCascade(r[this._selectedItem]),this._setSelectionValues(),!1;case 8:case 9:case 13:this.model.showCheckbox&&(this.model.checkedIndices.indexOf(this._selectedItem)<0?this.checkItemByIndex(this._selectedItem):this.uncheckItemByIndex(this._selectedItem));break;case 18:case 33:u=t.keyCode==33?l:1;t.shiftKey&&this.model.allowMultiSelection?(this._pageUpStep==null&&(this._pageUpStep=this.prevselectedItem),this._pageDownStep==null&&(this._pageDownStep=this.prevselectedItem),this._pageDownStep<=this.prevselectedItem?(start=this._pageUpStep-u>0?this._pageUpStep-u:0,end=this._pageDownStep):(start=this.prevselectedItem,end=this._pageDownStep-u>this.prevselectedItem?this._pageDownStep-u:this.prevselectedItem),this._shiftHomeAndEndKeyProcess(start,end,end>this.prevselectedItem?end:start),this._pageUpStep=start,this._pageDownStep=end):this._moveUp(this._activeItem,u);this._preventDefaultAction(t);break;case 34:u=t.keyCode==34?l:1;t.shiftKey&&this.model.allowMultiSelection?(this._pageUpStep==null&&(this._pageUpStep=this.prevselectedItem),this._pageDownStep==null&&(this._pageDownStep=this.prevselectedItem),this._pageUpStep==0&&this.prevselectedItem!=0?this._pageUpStep+u>=this.prevselectedItem?start=end=this.prevselectedItem:(start=this._pageUpStep+u,end=this._pageDownStep+u<this.element.children("li").length?this._pageDownStep+u:this.element.children("li").length-1):this._pageUpStep!=this.prevselectedItem&&this._pageUpStep+u>=this.prevselectedItem?start=end=this.prevselectedItem:(start=this._pageUpStep,end=this._pageDownStep+u<this.element.children("li").length?this._pageDownStep+u:this.element.children("li").length-1),start<this.prevselectedItem&&end>this.prevselectedItem&&(end=this.prevselectedItem),this._shiftHomeAndEndKeyProcess(start,end,start<this.prevselectedItem?start:end),this._pageUpStep=start,this._pageDownStep=end):this._moveDown(this._activeItem,u);this._preventDefaultAction(t);break;case 35:t.shiftKey&&this.model.allowMultiSelection?this._shiftHomeAndEndKeyProcess(this.prevselectedItem,this._listSize-1,this._listSize-1):this._homeAndEndKeyProcess(t,r,this._listSize-1);this._preventDefaultAction(t);break;case 36:t.shiftKey&&this.model.allowMultiSelection?this._shiftHomeAndEndKeyProcess(0,this.prevselectedItem,0):this._homeAndEndKeyProcess(t,r,0);this._preventDefaultAction(t)}}},_moveUp:function(n,t){n==null||n<=0?this._checkDisableStep(0,t,!1):n>this._listSize-1?this._checkDisableStep(this._listSize-1,t,!1):n>0&&n<=this._listSize-1&&this._checkDisableStep(n,t,!1)},_moveDown:function(n,t){n==null||n<0?this._checkDisableStep(-1,t,!0):n==0?this._checkDisableStep(0,t,!0):n>=this._listSize-1?this._checkDisableStep(this._listSize-1,t,!0):n<this._listSize-1&&this._checkDisableStep(n,t,!0)},_checkDisableStep:function(n,t,i){var e=i?"_disableItemSelectDown":"_disableItemSelectUp",f=i?n+t:n-t,r=this[e](f),u;if(r==null)for(u=t;u>=0;u--)if(f=i?n+u:n-u,r=this[e](f),r!=null)break;r!=null&&this.selectItemByIndex(r)},_disableItemSelectDown:function(t){return(t==null||t<0)&&(t=0),t<this._listSize?n.inArray(t,this._disabledItems)<0?t:this._disableItemSelectDown(t+1):this._listSize-1},_disableItemSelectUp:function(t){if((t==null||t<0)&&(t=0),t<this._listSize){if(n.inArray(t,this._disabledItems)<0)return t;if(t>0)return this._disableItemSelectUp(t-1)}},_preventDefaultAction:function(n,t){n.preventDefault?n.preventDefault():n.returnValue=!1;t&&(n.stopPropagation?n.stopPropagation():n.cancelBubble=!0)},_homeAndEndKeyProcess:function(t,i,r){if(n(":focus").length&&n(":focus")[0].nodeName!="INPUT")return this._OnListSelect(this._selectedItem,r),this.selectItemByIndex(r),this._selectedItem=r,this.scrollerObj.setModel({scrollTop:this._calcScrollTop(r)}),this.model.showCheckbox&&(this._removeListHover(),n(i[r]).addClass("e-hover"),this._lastEleSelect=this._selectedItem=r),this._keyCascade(i[r],t),t.preventDefault(),!1},_shiftHomeAndEndKeyProcess:function(n,t,i){return this._removeListHover(),this._activeItemLoop(n,t),this.scrollerObj.setModel({scrollTop:this._calcScrollTop(i)}),!1},_keyCascade:function(t,i){var r=this._getItemObject(n(t),i);this.model.selectedText=r.text;r.isInteraction=!0;this._trigger("select",r);this.model.cascadeTo&&(this._activeItem=this._selectedItem,this._cascadeAction())},mergeData:function(i,r){var u,f;this.mergeUl=n();this._setMapFields();u=this;this._skipInitialRemoteData=r?r:!1;t.DataManager&&i instanceof t.DataManager?(f=i.executeQuery(this._getQuery()),f.done(function(n){u.mergeValue=n.result;u._renderlistContainer()})):(this.mergeValue=i,this.listitems=this.listitems?this.listitems:this.dataSource(),this._renderlistContainer());this._loadInitialRemoteData=!1},_onScroll:function(i){var f,o,u,s,e;if(this._temp=this.dataSource(),this.model.actionBegin&&this._trigger("actionBegin",{}),this._temp!=this.dataSource()&&(t.DataManager&&this.dataSource()instanceof t.DataManager?this._initDataSource(this.dataSource()):this._showFullList()),f=this,o=this.element.find("li")[0],this.model.allowVirtualScrolling&&this.model.virtualScrollMode=="normal")this.itemIndex=parseInt(this.scrollerObj.scrollTop()/n(o).outerHeight()),this.realUllength=this.itemIndex,u=this.itemIndex,this.itemIndex>this.listContainer.outerHeight()/n(o).outerHeight()&&(u=this.mergeValue&&u>=this.mergeValue.length?u-this.mergeValue.length:u,e=this.itemIndex+this._getLiCount()),(this.mergeValue&&this.itemIndex<=this.mergeValue.length||u<=0)&&(u=0),this.dataSource().length==r&&this._temp==this.dataSource()?t.DataManager&&this.dataSource()instanceof t.DataManager&&this._queryPromise(u,f,u+Math.round(this.model.height/this.listitemheight),i):this._temp!=this.dataSource()?this._queryPromise(u,f,this._listitems.length,i):this.dataSource().length>0&&this._loadQueryData(u,e,f);else if(this.model.allowVirtualScrolling&&this.model.virtualScrollMode=="continuous"&&this.element.find("li").length-2<=(this.scrollerObj.scrollTop()+this.listContainer.height())/this.element.find("li").outerHeight()&&(this.lastScrollPosition=this.scrollerObj.scrollTop(),u=this.mergeValue&&!this._skipInitialRemoteData?this.element.children().length-this.mergeValue.length:this.element.children().length,u<=0&&(u=0),this._oldStartValue&&(u=this._oldStartValue),s=this.model.totalItemsCount?this.model.totalItemsCount:this.listitems.length,this.element.find("li").length<s))if(this.dataSource().length==r){if(e=this.mergeValue&&!this._skipInitialRemoteData?this.model.totalItemsCount&&u+this.model.itemRequestCount+this.mergeValue.length>this.model.totalItemsCount?this.model.totalItemsCount-this.mergeValue.length:u+this.model.itemRequestCount:this.model.totalItemsCount&&u+this.model.itemRequestCount>this.model.totalItemsCount?this.model.totalItemsCount:u+this.model.itemRequestCount,t.DataManager&&this.dataSource()instanceof t.DataManager)if(u<=e)this._queryPromise(u,f,e,i);else return!1;this._oldStartValue=u+this.model.itemRequestCount}else if(this.dataSource().length>0){if(this._isScrollComplete)return;this._loadQueryData(f.realUllength,f.realUllength+this.model.itemRequestCount,f)}},_queryPromise:function(n,t,i,r){this._trigger("itemRequest",{event:r,isInteraction:!0});this._setMapFields();var u=this._savedQueries.clone(),f=this.dataSource().executeQuery(u.range(n,i));this._updateLoadingClass(!0);f.done(function(i){t._trigger("actionBeforeSuccess",i);t.realUllength=r.source!="wheel"?t.mergeValue?t.mergeValue.length+n:n:n;t._loadlist(i.result)._checkboxHideShow(t.model.showCheckbox)._showResult()._updateLoadingClass();t._applySelection();t.model.virtualScrollMode=="continuous"&&(t.scrollerObj.refresh(),t.scrollerObj.option("scrollTop",t.lastScrollPosition));t._trigger("actionSuccess",i)}).fail(function(n){t._trigger("actionFailure",n)}).always(function(n){t._trigger("actionComplete",n)})},_selectListItems:function(){var t=this.element.find("li");for(i=0;i<t.length;i++)n(t[i]).hasClass("selectItem")&&!n(t[i]).hasClass("e-select")&&n(t[i]).addClass("e-select").removeClass("selectItem")},_loadQueryData:function(n,t,i){this._isScrollComplete=t>=this.listitems.length?!0:!1;this._updateLoadingClass(!0);var r=this.dataSource();this._loadlist(r.slice(n,t))._showResult()._updateLoadingClass();i._applySelection();i.model.virtualScrollMode=="continuous"&&(i.scrollerObj.option("scrollTop",i.lastScrollPosition),i.scrollerObj.refresh())},_setText:function(t){for(i=0;i<this.listitems.length;i++)n(this.element.children("li")[i]).text()==t&&this.unselectAll().selectItemByIndex(i)},_getLiCount:function(){return parseInt(this.listContainer.height()/this.element.find("li").height())},_onDragStarts:function(n,t){return this._trigger("itemDragStart",{items:n,target:t})},_onDrag:function(n,t){return this._trigger("itemDrag",{items:n,target:t})},_onDragStop:function(n,t){return this._trigger("itemDragStop",{items:n,target:t})},_onDropped:function(n,t){return this._trigger("itemDrop",{items:n,target:t})},_OnKeyPress:function(n){this.model.enableIncrementalSearch&&this.model.enabled&&this._incrementalSearch(this._isMozilla?n.charCode:n.keyCode)},_incrementalSearch:function(t){var u,o,s,i;_proxy=this;u=String.fromCharCode(t);this._incqueryString!=u?this._incqueryString+=u:this._incqueryString=u;this._incqueryString.length>0&&this._typeInterval==null&&(this._typeInterval=setTimeout(function(){_proxy._incqueryString="";_proxy._typeInterval=null},_proxy._typingThreshold));var f=this.listContainer.find("ol,ul").children("li:not('.e-category')"),i,c=this.model.caseSensitiveSearch,r,h=this._incqueryString,l=this._incqueryString.length,e=!1;for(c||(h=h.toLowerCase()),o=this._activeItem,--o,s=this._activeItem!=f.length-1?this._activeItem+1:0,this._incqueryString.length>1&&(s=this._activeItem),i=s;i<f.length&&o!=i;i++)if(r=n.trim(n(f[i]).text()),r=c?r:r.toLowerCase(),r.substr(0,l)===h?(this._removeListHover(),this.element.children("li").removeClass("e-active"),this._selectedItem=i,this._addListHover(),e=!0):i==f.length-1&&e==!1&&(s!=0?(i=-1,++o):e=!0),e)break},_wireEvents:function(){this._on(this.listContainer,"focus",this._OnFocusIn);this._on(this.listContainer,"blur",this._OnFocusOut);n(window).on("resize",n.proxy(this._OnWindowResize,this))},_OnFocusIn:function(){this._focused||(this._trigger("focusIn"),this._on(this.listContainer,"keydown",this._OnKeyDown),this._on(this.listContainer,"keypress",this._OnKeyPress),this._focused=!0)},_OnFocusOut:function(){this._focused&&(this._trigger("focusOut"),this._off(this.listContainer,"keydown",this._OnKeyDown),this._off(this.listContainer,"keypress",this._OnKeyPress),this._focused=!1)}});t.VirtualScrollMode={Normal:"normal",Continuous:"continuous"}})(jQuery,Syncfusion)});
