/*!
*  filename: ej.olapgauge.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./ej.waitingpopup.min","./ej.olapgauge.min","./../datavisualization/ej.circulargauge.min"],n):n()})(function(){(function(n,t,i){t.widget("ejOlapGauge","ej.olap.OlapGauge",{_rootCSS:"e-olapgauge",element:null,model:null,validTags:["div","span"],defaults:n.extend({},t.datavisualization.CircularGauge.prototype.defaults,{url:"",cssClass:"",rowsCount:0,columnsCount:0,enableTooltip:!1,showHeaderLabel:!0,scales:t.datavisualization.CircularGauge.prototype._defaultScaleValues(),customObject:{},progressMode:"infinite",locale:"en-US",serviceMethodSettings:{initialize:"InitializeGauge"},renderSuccess:null,renderComplete:null,renderFailure:null,beforeServiceInvoke:null,afterServiceInvoke:null,load:null}),dataTypes:{serviceMethodSettings:"data",customObject:"data",scales:"data",progressMode:"enum"},observables:["rowsCount","columnsCount","showHeaderLabel","locale","radius","frameType"],rowsCount:t.util.valueFunction("rowsCount"),columnsCount:t.util.valueFunction("columnsCount"),showHeaderLabel:t.util.valueFunction("showHeaderLabel"),locale:t.util.valueFunction("locale"),radius:t.util.valueFunction("radius"),frameType:t.util.valueFunction("frameType"),getOlapReport:function(){return this._olapReport},setOlapReport:function(n){this._olapReport=n},getJSONRecords:function(){return this._JSONRecords},setJSONRecords:function(t){this._JSONRecords=n.parseJSON(t)},_init:function(){this.model=n.extend(t.datavisualization.CircularGauge.prototype.defaults,this.model);this._scalesInitialize();this._initPrivateProperties();this._load()},_scalesInitialize:function(){this.model.scales!=null?n.each(this.model.scales,t.proxy(function(i,r){var u=t.datavisualization.CircularGauge.prototype._defaultScaleValues();n.extend(u,r);n.extend(r,u)},this)):this.model.scales=[t.datavisualization.CircularGauge.prototype._defaultScaleValues()]},_destroy:function(){this._unWireEvents();this.element.empty().removeClass("e-olapgauge"+this.model.cssClass);this._ogaugeWaitingPopup!=i&&this._ogaugeWaitingPopup._destroy()},_initPrivateProperties:function(){this._id=this.element.attr("id");this._olapReport="";this._JSONRecords=null;this._maximum=[];this._maxValue=0;this._pointerValue_0=0;this._pointerValue_1=0;this._currentLayout="";this._defaultArea=0;this._defaultWidth=0;this._gaugeObj={};this._ogaugeWaitingPopup=null;this._ogaugeProgressBar=null;this._ogaugeProgressText=null;this._ogaugeTimer=null},_load:function(){this.element.addClass(this.model.cssClass);this.model.progressMode=="infinite"?(n("#"+this._id).ejWaitingPopup({showOnInit:!0}),this._ogaugeWaitingPopup=n("#"+this._id).data("ejWaitingPopup")):(n("#"+this._id+"progressContainer").remove(),this._createProgressBar(),this._progressStatus(0,70,140));this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{element:this.element,customObject:this.model.customObject});var t=JSON.stringify(this.model.customObject);this.model.progressMode=="progress"&&(n("#"+this._id+"progressText")[0].innerHTML=this._getLocalizedLabels("PreparingAndExecutingMDXquery"));this.model.customObject!=null&&this.model.customObject!=i&&this.model.customObject!={}?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGauge",customObject:t}),this._renderControlSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGauge"}),this._renderControlSuccess)},_setFirst:!0,_setModel:function(n){for(var t in n)switch(t){case"OlapReport":this.setOlapReport(n[t]);break;case"JsonData":this.setOlapReport(n[t]);break;case"RefreshOlapGauge":this.element.renderControlFromJSON(n[t]);break;case"customObject":this.model.customObject=n[t];break;case"locale":this.locale();break;case"rowsCount":this.rowsCount();break;case"columnsCount":this.columnsCount();break;case"showHeaderLabel":this.showHeaderLabel();break;case"locale":this.locale();break;case"radius":this.radius();break;case"frameType":this.frameType()}this._gaugeObj.obj0&&this._renderControlSuccess({PivotRecords:JSON.stringify(this.getJSONRecords()),OlapReport:this.getOlapReport()})},_wireEvents:function(){this.model.enableTooltip&&this.element.find("canvas").mouseenter(t.proxy(function(n){this._showTooltip(n)},this)).mouseout(t.proxy(function(){n(this._tooltip).fadeOut("slow")},this)).mousemove(t.proxy(function(n){this._showTooltip(n);this._hideTooltip()},this))},_getLocalizedLabels:function(n){return t.olap.OlapGauge.locale[this.locale()][n]===i?t.olap.OlapGauge.locale["en-US"][n]:t.olap.OlapGauge.locale[this.locale()][n]},_unWireEvents:function(){},_showTooltip:function(i){n(this._tooltip).remove();var u=i.target.parentNode.id.split("_")==""?i.target.parentNode.parentNode.id.split("_"):i.target.parentNode.id.split("_"),r=u[u.length-1],f=this._JSONRecords[r].GoalValue||0,e=this._JSONRecords[r].MeasureValue||this._JSONRecords[r].Value,o=this._JSONRecords[r].MemberName||this._JSONRecords[r].Measure,s=o+"<br/>"+this._getLocalizedLabels("RevenueGoal")+": "+f+"<br/>"+this._getLocalizedLabels("RevenueValue")+": "+e;this._tooltip=t.buildTag("div.e-olapgauge-tooltip",s);n(this._tooltip).appendTo("body");n(this._tooltip).addClass(".e-olapgauge-active");this._changeTooltipPos(i)},_changeTooltipPos:function(t){var i=t.pageX-8,r=t.pageY+8;n(this._tooltip).css({top:r,left:i})},_hideTooltip:function(){window.setTimeout(t.proxy(function(){n(this._tooltip).fadeOut(1500,"linear")},this),3e3)},_createProgressBar:function(){var f=t.buildTag("div#"+this._id+"progressContainer.progressContainer","",{top:n("#"+this._id).position().top+n("#"+this._id).height()/2-30,left:n("#"+this._id).position().left+n("#"+this._id).width()/3-50})[0].outerHTML,i=t.buildTag("div#"+this._id+"progressBar.progressBar","")[0].outerHTML,r=t.buildTag("div#"+this._id+"blockDiv.blockDiv","",{width:n("#"+this._id).width(),display:"block",opacity:"0.3",backgroundColor:"#E9E9E9",height:n("#"+this._id).height(),position:"fixed",top:n("#"+this._id).position().top,left:n("#"+this._id).position().left})[0].outerHTML,u;n("#"+this._id).after(f);this.model.progressMode=="normal"?(n("#"+this._id+"progressContainer").css({width:0,height:0}),n("#"+this._id+"progressContainer").append(i).append(r)):(u=t.buildTag("span#"+this._id+"progressText.progressText","OlapGauge initial loading...")[0].outerHTML,n("#"+this._id+"progressContainer").append(i).append(u).append(r));n("#"+this._id+"progressBar").ejProgressBar({value:0,text:"0 %",complete:"progressbarCompleted"});this._ogaugeProgressBar=n("#"+this._id+"progressBar").data("ejProgressBar");this._ogaugeProgressText=n("#"+this._id+"progressText")},_progressStatus:function(r,u,f){if(jQuery.type(u)==="string"){var e=u.split(":");e!=i&&(u=parseInt(e[0]))}this._ogaugeProgressBar.setModel({value:r,text:r+" %"});n("#"+this._id+"progressContainer").show();n("#"+this._id+"blockDiv").position=n("#"+this._id).position();this._ogaugeTimer=window.setInterval(t.proxy(function(){this._ogaugeProgressBar.setModel({value:r,text:r+" %"});r++;r>=u&&(window.clearInterval(this._ogaugeTimer),e!=i&&this._ogaugeProgressBar.setModel({value:100,text:e[1]}))},this),f)},_renderControlSuccess:function(i){this.model.progressMode!="infinite"&&(this.model.progressMode=="progress"&&(n("#"+this._id+"progressText")[0].innerHTML=this._getLocalizedLabels("MDXqueryExecutedSuccessfully")+"..."),window.clearInterval(this._ogaugeTimer));try{this.model.progressMode!="infinite"?(this.model.progressMode=="progress"&&(n("#"+this._id+"progressText")[0].innerHTML=this._getLocalizedLabels("RenderingStarted")+"..."),this._progressStatus(70,100,50),window.setTimeout(t.proxy(this.progressStatus(i),this),300)):window.setTimeout(t.proxy(this.progressStatus(i),this),1)}catch(r){this.model.progressMode!="infinite"&&(this.model.progressMode=="progress"&&(n("#"+this._id+"progressText")[0].innerHTML=this._getLocalizedLabels("RenderingFailed")+"!!!"),window.clearInterval(this._ogaugeTimer),this._ogaugeProgressBar.setModel({value:70,text:" Failed"}))}},doAjaxPost:function(i,r,u,f){n.ajax({type:i,url:r,contentType:"application/json; charset=utf-8",dataType:"json",data:u,success:n.proxy(f,this),complete:t.proxy(function(){var n={element:this.element,customObject:this.model.customObject};this._trigger("renderComplete",n)},this),error:t.proxy(function(t,i,r){this.model.progressMode!="infinite"?(window.clearInterval(this._ogaugeTimer),this.model.progressMode=="progress"&&(n("#"+this._id+"progressText")[0].innerHTML=this._getLocalizedLabels("MDXqueryExecutionFailed")+"!!!"),n("#"+this._ogaugeProgressBar._id).show(),this._ogaugeProgressBar.setModel({value:0,text:r})):this._ogaugeWaitingPopup.hide();var u={element:this.element,customObject:this.model.customObject,Message:t};this._trigger("renderFailure",u)},this)})},progressStatus:function(r){var u="",o="",s="",a="",h=0,f,e,c,l,v;if(r[0]!=i&&r.length>0?(this.setJSONRecords(r[0].Value),this.setOlapReport(r[1].Value),r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value)):r.d!=i&&r.d.length>0?(this.setJSONRecords(r.d[0].Value),this.setOlapReport(r.d[1].Value),r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value)):r.PivotRecords&&r.OlapReport&&(this.setJSONRecords(r.PivotRecords),this.setOlapReport(r.OlapReport),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject)),this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{element:this.element,customObject:this.model.customObject}),f=this.getJSONRecords(),f!=null&&f.length>0){if(this.rowsCount()<1&&this.columnsCount()<1){for(this._currentLayout="WrapPanel",e=0;e<f.length;e++)o=t.buildTag("img#stausIndicator_"+e+".kpiiconvalue")[0].outerHTML,s=t.buildTag("img#trendIndicator_"+e+".kpiiconvalue")[0].outerHTML,a+=t.buildTag("li",t.buildTag("div#"+this._id+"_"+e,o+s)[0].outerHTML)[0].outerHTML;u=t.buildTag("ul.wrapLayout",a)[0].outerHTML}else{for(this._currentLayout="Table",(this.columnsCount()==i||this.columnsCount()<1)&&this.columnsCount((f.length/this.rowsCount()).toFixed()),(this.rowsCount()==i||this.rowsCount()<1)&&this.rowsCount((f.length/this.columnsCount()).toFixed()),u="<table><tbody>",c=0;c<this.rowsCount();c++){for(u+="<tr>",l=0;l<this.columnsCount();l++)o=t.buildTag("img#stausIndicator_"+h+".kpiiconvalue")[0].outerHTML,s=t.buildTag("img#trendIndicator_"+h+".kpiiconvalue")[0].outerHTML,u+="<td>"+t.buildTag("div#"+this._id+"_"+h,o+s)[0].outerHTML+"<\/td>",h++;u+="<\/tr>"}u+="<\/tbody><\/table>"}this.element.html(u);this.renderControlFromJSON(f);this._defaultWidth=this.element.find("canvas").width();this._defaultArea=this.element.find("table").height()*this.element.find("table").width()}this.model.progressMode!="infinite"?this.model.progressMode=="normal"?n("#"+this._id+"progressContainer").delay(1500).fadeOut("slow"):this.model.progressMode=="progress"&&(n("#"+this._id+"progressText")[0].innerHTML=this._getLocalizedLabels("RenderingSucceeded")+"...",n("#"+this._id+"progressContainer").delay(2e3).fadeOut("slow")):this._ogaugeWaitingPopup.hide();v={element:this.element,customObject:this.model.customObject};this._trigger("renderSuccess",v)},_getCalculatedValue:function(n){var t=n.toString(),r=1,f,i,u;for(f=t.indexOf(".")>-1?t.split(".")[0].length:t.length,i=parseInt(t),u=0;u<f;u++)i>this._maxValue&&(i=i/10,r=r*10);return r},_findNearestUpperLimit:function(n,t){var r=n.toString(),i=parseInt(r),u=i%t;return i+(t-u)},_setMaxScaleValue:function(n,t,i){var r;return t>n?(r=this._getCalculatedValue(t),this._maximum[i]=this._findNearestUpperLimit(t/r,10)):(r=this._getCalculatedValue(n),this._maximum[i]=this._findNearestUpperLimit(n/r*4/3,10)),r},removeImg:function(){this.element.find("img").remove()},renderControlFromJSON:function(r){var b,u,p,ot,w,st,ht,f;for(this._maxValue=99,maxGaugeCount=0,b=this.radius()/22,this._currentLayout=="Table"&&this.rowsCount()*this.columnsCount()<=r.length?maxGaugeCount=this.rowsCount()*this.columnsCount():(this._currentLayout=="WrapPanel"||this.rowsCount()*this.columnsCount()>r.length)&&(maxGaugeCount=r.length),u=0;u<maxGaugeCount;u++){var h=0,c=0,nt=0,s=0,tt=0,l=0,a=0,k=0,v="",e,it=[],rt=[],d=[],ut=[],ft=[],et=[],g=[],o="",y="";if(r[u].MeasureValue!=null&&r[u].MeasureValue!=i?(c=parseFloat(r[u].MeasureValue)||0,h=parseFloat(r[u].GoalValue)||0,v=r[u].MeasureCaption+" - "+r[u].MemberName):(c=parseFloat(r[u].Value),h=0,v=r[u].Measure,this.model.scales[0].showIndicators=!1),l=this._setMaxScaleValue(h,c,u),tt=c,a=h/l,k=tt/l,this._pointerValue_0=s+k,this._pointerValue_1=a+s,nt=s,s=s+k,r[u].StatusGraphic=="Traffic Signals"?r[u].StatusValue==-1?o="kpiredroad":r[u].StatusValue==0?o="kpiallcolor":r[u].StatusValue==1&&(o="kpigreenroad"):r[u].StatusValue==-1?o="kpidiamond":r[u].StatusValue==0?o="kpitriangle":r[u].StatusValue==1&&(o="kpicircle"),e=this.element.find("#statusIndicator_"+[u]).addClass(o),e!=null&&e!=i&&(p=n(e).css("background-image"),ot={height:15,width:15,type:"image",imageUrl:!t.isNullOrUndefined(p)&&p!="none"?p.split("(")[1].split(")")[0].replace('"',"").replace('"',""):"",position:{x:this.radius()-20,y:260}}),r[u].TrendGraphic!=null&&r[u].TrendGraphic!=i&&r[u].TrendGraphic!=""&&r[u].TrendGraphic.toLowerCase()=="standard arrow"&&(r[u].TrendValue==-1?y="kpidownarrow":r[u].TrendValue==0?y="kpirightarrow":r[u].TrendValue==1&&(y="kpiuparrow"),e=this.element.find("#trendIndicator_"+[u]).toggleClass(y)),t.isNullOrUndefined(e)||(w=n(e).css("background-image"),st={height:15,width:15,type:"image",imageUrl:!t.isNullOrUndefined(w)&&w!="none"?w.split("(")[1].split(")")[0].replace('"',"").replace('"',""):"",position:{x:this.radius(),y:260}}),!t.isNullOrUndefined(this.model.scales[0])){for(this.frameType()=="fullcircle"?(this.model.scales[0].startAngle=122,this.model.scales[0].sweepAngle=296):this.frameType()=="halfcircle"&&(this.model.scales[0].startAngle=180,this.model.scales[0].sweepAngle=180),this.model.scales[0].indicators=this.model.scales[0].showIndicators?[ot,st]:this.model.scales[0].indicators,t.isNullOrUndefined(this.model.scales[0].pointers[0])||(ht=t.datavisualization.CircularGauge.prototype._defaultScaleValues().pointerCap,this.model.scales[0].pointers[0].value=this._pointerValue_0,this.model.scales[0].pointers[0].pointerCap=ht,this.model.scales[0].pointers[0].pointerCap.radius=b),t.isNullOrUndefined(this.model.scales[0].pointers[1])||(this.model.scales[0].pointers[1].value=this._pointerValue_1,this.model.scales[0].pointers[1].type=this.model.scales[0].pointers[1].type||"marker",this.model.scales[0].pointers[1].markerType=this.model.scales[0].pointers[1].markerType||"diamond",this.model.scales[0].pointers[1].placement=this.model.scales[0].pointers[1].placement||"center"),t.isNullOrUndefined(this.model.scales[0].ranges[0])||(this.model.scales[0].ranges[0].startValue=nt,this.model.scales[0].ranges[0].endValue=a),t.isNullOrUndefined(this.model.scales[0].ranges[1])||(this.model.scales[0].ranges[1].startValue=a,this.model.scales[0].ranges[1].endValue=this._maximum[u]),t.isNullOrUndefined(this.model.scales[0].customLabels[0])||(this.model.scales[0].customLabels[0].value=this.showHeaderLabel()?"X "+l:""),t.isNullOrUndefined(this.model.scales[0].customLabels[1])||(this.model.scales[0].customLabels[1].value=this.showHeaderLabel()?v:""),t.isNullOrUndefined(this.model.scales[0].customLabels[2])||(this.model.scales[0].customLabels[2].value=this.showHeaderLabel()?v:""),f=0;f<this.model.scales[0].ranges.length;f++)it.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().ranges[0],this.model.scales[0].ranges[f]));for(f=0;f<this.model.scales[0].pointers.length;f++)rt.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().pointers[0],this.model.scales[0].pointers[f]));for(f=0;f<this.model.scales[0].labels.length;f++)d.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().labels[0],this.model.scales[0].labels[f]));for(f=0;f<this.model.scales[0].labels.length;f++)d.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().labels[0],this.model.scales[0].labels[f]));for(f=0;f<this.model.scales[0].customLabels.length;f++)ut.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().customLabels[0],this.model.scales[0].customLabels[f]));for(f=0;f<this.model.scales[0].ticks.length;f++)ft.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().ticks[0],this.model.scales[0].ticks[f]));if(this.model.scales[0].indicators)for(f=0;f<this.model.scales[0].indicators.length;f++)et.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().indicators[0],this.model.scales[0].indicators[f]));for(newScale={pointerCap:{radius:b||this.model.scales[0].pointerCap.radius,borderWidth:this.model.scales[0].pointerCap.borderWidth,interiorGradient:this.model.scales[0].pointerCap.interiorGradient,borderColor:this.model.scales[0].pointerCap.borderColor,backgroundColor:this.model.scales[0].pointerCap.backgroundColor},border:{color:this.model.scales[0].border.color,width:this.model.scales[0].border.width},majorIntervalValue:this.model.scales[0].majorIntervalValue,minorIntervalValue:this.model.scales[0].minorIntervalValue,minimum:this.model.scales[0].minimum,backgroundColor:this.model.scales[0].backgroundColor,direction:this.model.scales[0].direction,showPointers:this.model.scales[0].showPointers,showTicks:this.model.scales[0].showTicks,showLabels:this.model.scales[0].showLabels,showIndicators:this.model.scales[0].showIndicators,showRanges:this.model.scales[0].showRanges,showScaleBar:this.model.scales[0].showScaleBar,startAngle:this.model.scales[0].startAngle,sweepAngle:this.model.scales[0].sweepAngle,radius:this.model.scales[0].radius,size:this.model.scales[0].size,maximum:this.model.scales[0].maximum||this._maximum[u],pointers:rt,ticks:ft,labels:d,ranges:it,customLabels:ut,indicators:et},f=0;f<this.model.scales.length;f++)f==0?g.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues(),newScale)):g.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues(),this.model.scales[f]))}n("#"+this._id+"_"+u).ejCircularGauge({backgroundColor:this.model.backgroundColor,frame:{frameType:this.model.frame.frameType,halfCircleFrameStartAngle:this.model.halfCircleFrameStartAngle,halfCircleFrameEndAngle:this.model.halfCircleFrameEndAngle},radius:this.radius(),width:this.model.width,height:this.model.height,interiorGradient:this.model.interiorGradient,readOnly:this.model.readOnly,enableResize:this.model.enableResize,enableAnimation:!0,animationSpeed:this.model.animationSpeed,theme:this.model.theme,isRadialGradient:this.model.isRadialGradient,load:this.model.load,drawTicks:this.model.drawTicks,drawLabels:this.model.drawLabels,drawPointers:this.model.drawPointers,drawRange:this.model.drawRange,drawCustomLabel:this.model.drawCustomLabel,drawIndicators:this.model.drawIndicators,drawPointerCap:this.model.drawPointerCap,renderComplete:this.model.renderComplete,mouseClick:this.model.mouseClick,mouseClickMove:this.model.mouseClickMove,mouseClickUp:this.model.mouseClickUp,scales:g});this._gaugeObj["obj"+u]=n("#"+this._id+"_"+u).data("ejCircularGauge")}this.removeImg();this._wireEvents()},refresh:function(){if(this._gaugeObj==null||this._gaugeObj==i)for(var t=0;t<this._JSONRecords.length;t++)this._gaugeObj["obj"+t]=n("#"+this._id+"_"+t).data("ejCircularGauge"),this._gaugeObj["obj"+t].refresh();else for(key in this._gaugeObj)this._gaugeObj[key].refresh()}});t.olap.OlapGauge.locale={};t.olap.OlapGauge.locale["en-US"]={RevenueGoal:"Revenue Goals",RevenueValue:"Revenue Values",MDXqueryExecutionFailed:"MDX query execution failed",PreparingAndExecutingMDXquery:"Preparing and executing MDX query",MDXqueryExecutedSuccessfully:"MDX query executed successfully",RenderingStarted:"Rendering Started",RenderingSucceeded:"Rendering Succeeded",RenderingFailed:"Rendering failed"};t.olap.OlapGauge.ProgressMode={Infinite:"infinite",Normal:"normal",Progress:"progress"}})(jQuery,Syncfusion)})