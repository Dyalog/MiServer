/*!
*  filename: ej.treeview.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.draggable.min","./ej.checkbox.min","./ej.waitingpopup.min"],n):n()})(function(){(function(n,t,i){t.widget("ejTreeView","ej.TreeView",{_rootCSS:"e-treeview",element:null,model:null,validTags:["ul","div"],_setFirst:!1,defaults:{showCheckbox:!1,enableAnimation:!0,allowDragAndDrop:!1,allowDropChild:!0,allowDropSibling:!0,allowDragAndDropAcrossControl:!0,allowEditing:!1,allowKeyboardNavigation:!0,items:null,fields:{dataSource:null,query:null,tableName:null,child:null,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass",expanded:"expanded",hasChild:"hasChild",selected:"selected",linkAttribute:"linkAttribute",imageAttribute:"imageAttribute",htmlAttribute:"htmlAttribute",imageUrl:"imageUrl",isChecked:"isChecked"},autoCheckParentNode:!1,loadOnDemand:!1,cssClass:"",template:null,enableRTL:!1,expandOn:"dblclick",enablePersistence:!1,enabled:!0,expandedNodes:[],checkedNodes:[],width:null,height:null,nodeClick:null,beforeExpand:null,nodeExpand:null,beforeCollapse:null,nodeCollapse:null,nodeSelect:null,nodeCheck:null,nodeUncheck:null,inlineEditValidation:null,beforeEdit:null,keyPress:null,nodeDragStart:null,nodeDrag:null,nodeDragStop:null,nodeDropped:null,create:null,destroy:null},dataTypes:{showCheckbox:"boolean",enableAnimation:"boolean",allowDragAndDrop:"boolean",allowDropChild:"boolean",allowDragAndDropAcrossControl:"boolean",allowEditing:"boolean",allowKeyboardNavigation:"boolean",autoCheckParentNode:"boolean",loadOnDemand:"boolean",enableRTL:"boolean",expandOn:"string",enablePersistence:"boolean",items:"data",fields:{dataSource:"data",query:"data",child:"data"},expandedNodes:"array",checkedNodes:"array"},_setModel:function(i){var r,e,o,s,u,f,h;if(!this.model.enabled&&t.isNullOrUndefined(i.enabled))return!1;for(r in i)switch(r){case"cssClass":this._changeSkin(i[r]);break;case"fields":this._unWireEvents();e=this.element.hasClass("e-js")?!1:!0;o=e?this.element.children("ul"):this.element;o.empty();n.extend(this.model.fields,i[r]);this._checkDataBinding();e&&(s=this.element.children(".e-treeview-ul"),o.append(s.children()),s.remove());break;case"allowDragAndDropAcrossControl":this.model.allowDragAndDropAcrossControl=i[r];this._enableDragDrop();break;case"enabled":this._enabledAction(i[r]);break;case"showCheckbox":i[r]?(this.model.showCheckbox=i[r],this._showCheckBox()):(this.element.find("span.e-chkbox-wrap").next().remove(),this.element.find("span.e-chkbox-wrap").remove());break;case"enableAnimation":this.model.enableAnimation=i[r];break;case"expandedNodes":for(this._collapseAll(),this.model.expandedNodes=[],u=0;u<i[r].length;u++)this._expandNode(this._liList[i[r][u]]);break;case"checkedNodes":if(this.model.showCheckbox)for(this._unCheckAll(),this.model.checkedNodes=[],f=0;f<i[r].length;f++)h=this._liList[i[r][f]],this._nodeCheckedAction(n(h).find("span.e-chkbox-wrap").first());break;case"expandOn":this._on(this.element,i[r],this._expandEventHandler);break;case"allowEditing":i[r]?(this._enableAllowEdit(),this._allowEditable()):(this._disableAllowEdit(),this._preventEditable());break;case"allowKeyboardNavigation":i[r]?this._on(this.element,"keydown",this._KeyPress):this._off(this.element,"keydown",this._KeyPress);break;case"allowDragAndDrop":i[r]&&this._enableDragDrop();break;case"enableRTL":i[r]?this.element.addClass("e-rtl"):this.element.removeClass("e-rtl");break;case"height":this.element.height(i[r]);break;case"width":this.element.width(i[r])}},_destroy:function(){this.element.html("");this.element.parent().append(this._cloneElement);this.element.remove();this.element=this._cloneElement;this.element.removeClass("e-treeview e-widget")},_init:function(){this._dataSource=[];this._fragment=[];this._templateType="";this._id=this.element.prop("id");t.isNullOrUndefined(this.model.fields)||this.model.fields.dataSource==null?this.initialize():this._checkDataBinding()},initialize:function(){this._cloneElement=n(this.element).clone();this._cutCopyNodeText=null;this.beforeEditText=null;this._CurrenctSelectedNodes=[];this.element.is("ul")?this._createWrapper():(this.element.addClass("e-treeview-wrap e-widget"),this.model.width!=null&&this.element.width(this.model.width),this.model.height!=null&&this.element.height(this.model.height),this.model.enableRTL&&this.element.addClass("e-rtl"),this.model.cssClass!=null&&this.element.addClass(this.model.cssClass));this.model.fields.dataSource==null&&(this._beforeBaseClass(),this._addBaseClass(),this._controlRender());this._addDragableClass();this._finalize();this._enabledAction(this.model.enabled)},_beforeBaseClass:function(){this.element.attr("role","tree").attr("aria-activedescendant",this._id+"_active");this._ulList=n("ul",this.element);this._liList=n("li",this.element).attr("tabindex",-1)},_createWrapper:function(){var n=t.buildTag("div.e-treeview-wrap e-widget "+this.model.cssClass,"","",{tabindex:0});t.isNullOrUndefined(this.element.attr("accesskey"))||n.attr("accesskey",this.element.attr("accesskey"));this.model.width!=null&&n.width(this.model.width);this.model.height!=null&&n.height(this.model.height);this.model.enableRTL&&n.addClass("e-rtl");n.insertAfter(this.element);n.append(this.element.addClass("e-ul"));this.element=n},_changeSkin:function(n){this.model.cssClass!=n&&this.element.removeClass(this.model.cssClass).addClass(n)},_enabledAction:function(n){n?(this.element.removeClass("e-disable"),this._wireEvents()):(this.element.addClass("e-disable"),this._unWireEvents())},_checkDataBinding:function(){this.model.fields.dataSource instanceof t.DataManager?this._initDataSource():(this._ensureDataSource(this.model.fields.dataSource),this.initialize())},_initDataSource:function(){var t;this.element.ejWaitingPopup();t=this.element.ejWaitingPopup("instance");this.element.ejWaitingPopup("refresh");this.element.ejWaitingPopup("show");var i=this._columnToSelect(this.model.fields),n=this,r=this.model.fields.dataSource.executeQuery(i);r.done(function(t){n.element.ejWaitingPopup("hide");n.retriveData=t.result;n._ensureDataSource(t.result);n.initialize()})},_columnToSelect:function(n){var u=[],r=t.Query(),i;if(t.isNullOrUndefined(n.query)){for(i in n)i!=="tableName"&&i!=="child"&&i!=="dataSource"&&n[i]&&u.push(n[i]);u.length>0&&r.select(u);this.model.fields.dataSource.dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||r.from(n.tableName)}else r=n.query;return r},_ensureDataSource:function(n){this.currentSelectedData=n;this._renderTemplate(n);this.element.html(this._fragment);this._beforeBaseClass()},_getTemplateType:function(n,t){for(var i=0,r=n.length;i<r;i++){if(n[i].hasOwnProperty(t.parentId)||n[i].hasOwnProperty(t.hasChild))return 1;if(n[i].hasOwnProperty("child"))return 2}return 1},_groupingObjects:function(n,t){for(var u,r={},f=[],i=0,e=n.length;i<e;i++)u=JSON.stringify(t(n[i])),r[u]=r[u]||[],r[u].push(n[i]);for(i in r)f.push(r[i]);return f},_renderTemplate:function(n){this._onlineData=!1;var i=this;if(this.model.fields.dataSource instanceof t.DataManager)this._dataSource=n;else{this._templateType=this._getTemplateType(n,this.model.fields);switch(this._templateType){case 1:this._dataSource=this._groupingObjects(n,function(n){return[!t.isNullOrUndefined(n)&&[n[i.model.fields.parentId]]]});break;case 2:this._dataSource=n}}this._templateNodeCreation(n,this.model.fields)},_templateNodeCreation:function(i,r){var f,u,e;if(this._fragment=document.createDocumentFragment(),f=document.createElement("ul"),this._fragment.appendChild(f),this._onlineData&&(this._fragment.firstChild.className="e-treeview-ul",this._fragment.firstChild.setAttribute("role","group"),n(this._fragment.firstChild).attr("style","display:none")),this.model.fields.dataSource!=null){for(u=0,e=i.length;u<e;u++)(t.isNullOrUndefined(i[u][this.model.fields.parentId])||i[u][this.model.fields.parentId]==0||this._loadOnDemandNodes)&&this._fragment.firstChild.appendChild(this._tempalteSub(i[u],i,r));n(this._fragment.firstChild).find(">li:first").addClass("first");n(this._fragment.firstChild).find(">li:last").addClass("last")}},_onlineDataSource:function(n,t,i){this._templateNodeCreation(n,i);var r=this.element.find("li#"+t);r.append(this._fragment);r.children().find("> div:first").addClass("e-icon e-plus");this.model.allowEditing&&this._enableAllowEdit();this._onlineData=!1},_tempalteSub:function(i,r,u){var a,l,o,e,y,s,v=document.createDocumentFragment(),f,h,c;if(a=document.createElement("li"),v.appendChild(a),f=v.firstChild,i[u.id]&&(f.id=i[u.id]),this._addFirst?(n(f).addClass("e-item first"),this._addFirst=!1):this._addLast?(n(f).addClass("e-item last"),this._addLast=!1):n(f).addClass("e-item"),f.setAttribute("role","treeitem"),f.setAttribute("tabindex",-1),i[u.htmlAttribute]&&this._setAttributes(i[u.htmlAttribute],f),i[u.imageUrl]?(o=document.createElement("img"),o.className="e-align",o.src=i[u.imageUrl],i[u.imageAttribute]&&this._setAttributes(i[u.imageAttribute],o),f.appendChild(o)):i[u.spriteCssClass]&&(l=document.createElement("span"),l.className=i[u.spriteCssClass],f.appendChild(l)),this.model.template||i[u.text]){if(e=document.createElement("a"),this.model.template){if(typeof n.fn.render!="function")throw"Error : JsRender dependecy script missing";e.innerHTML=n(this.model.template).render(i)}else e.innerHTML=i[u.text];e.href="#";i[u.linkAttribute]&&(e.href=i[u.linkAttribute]);i[u.selected]&&(e.className="e-text CanSelect e-active");f.appendChild(e)}return this._hasExpanded=!1,i[u.expanded]&&(n(f).addClass("expanded"),this._hasExpanded=!0),i[u.isChecked]&&n(f).addClass("ischecked"),!1&&f.appendChild(y),t.isNullOrUndefined(u.child)?this.model.fields.dataSource instanceof t.DataManager?(this._updateElement(f,!1),this.model.showCheckbox&&this._checkboxOnTemplate(f.children[0])):this.model.loadOnDemand?(this._updateElement(f,!0),f.setAttribute("aria-selected",!1),f.setAttribute("aria-expanded",!1),(i[u.hasChild]||i.hasOwnProperty("child"))&&(f.children[0].firstChild.className="e-icon e-plus"),this.model.showCheckbox&&(this._checkboxOnTemplate(f.children[0]),this._checkboxChecked&&this._currentDataSource&&n(f).addClass("ischecked")),i[u.expanded]&&this._childNodeCreation(i,f,r,u)):this._onlineData||(this._updateElement(f,!0),this.model.showCheckbox&&this._checkboxOnTemplate(f.children[0]),this._childNodeCreation(i,f,r,u)):u.child.dataSource instanceof t.DataManager&&(this._updateElement(f,!0),f.setAttribute("aria-selected",!1),f.setAttribute("aria-expanded",!1),this.model.showCheckbox&&this._checkboxOnTemplate(f.children[0]),this.model.loadOnDemand||(h=this,c=t.Query(),c=h._columnToSelect(u.child),c.where(u.child.parentId,t.FilterOperators.equal,i[u.id]),queryPromise=u.child.dataSource.executeQuery(c),queryPromise.done(function(n){s=n.result;s&&s.length>0&&(h._onlineData=!0,h._onlineDataSource(s,s[0][u.id],u.child))}))),f},_childNodeCreation:function(i,r,u,f){var s=this._templateType==2?!t.isNullOrUndefined(i.child)&&i.child.length>0&&i.child:this._getChildNodes(this._dataSource,i),e,h,o,c;if(!t.isNullOrUndefined(s)&&s.length>0){for(r.setAttribute("aria-selected",!1),r.children[0].firstChild.className="e-icon e-plus",r.setAttribute("aria-expanded",!1),e=document.createDocumentFragment(),h=document.createElement("ul"),e.appendChild(h),e.firstChild.className="e-treeview-ul",e.firstChild.setAttribute("role","group"),n(e.firstChild).attr("style","display:none"),o=0,c=s.length;o<c;o++)o==0&&(this._addFirst=!0),o==c-1&&(this._addLast=!0),e.firstChild.appendChild(this._tempalteSub(s[o],u,f));r.appendChild(h)}},_checkboxOnTemplate:function(i){var r=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:"TreeView_Checkbox",value:"False"}),u=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox1",value:"False"});i.insertBefore(r.get(0),i.lastChild);i.insertBefore(u.get(0),i.lastChild);n(i.querySelector(".nodecheckbox")).ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})},_updateElement:function(i,r){var e,u,f,o;i.firstChild.nodeName=="SPAN"?(e=i.firstChild,u=i.lastChild):u=i.lastChild;u&&(nodeText=u.innerHTML,textElement=u.cloneNode(),n(u).remove(),textElement.className=u.className?"e-text CanSelect e-active":"e-text CanSelect",textElement.innerHTML=nodeText,customElement=i.cloneNode(),i.innerHTML="",this._on(n(textElement),"mouseenter",this._mouseEnterEvent),this._on(n(textElement),"mouseleave",this._mouseLeaveEvent));f=t.buildTag("div","",{},{role:"presentation"});o="";r?(o=t.buildTag("div","",{},{role:"presentation"}),n(f).append(o).append(customElement.children).append(e).append(textElement)):n(f).append(customElement.children).append(e).append(textElement);i.appendChild(f.get(0))},_setAttributes:function(n,t){for(var i in n)t.attr(i,n[i])},_addDragableClass:function(){this.model.allowDragAndDrop&&(this._anchors=this._liList.map(function(){return n("a",this)[0]}),this._anchors.addClass("e-draggable e-droppable"))},_addBaseClass:function(){this._ulList.addClass("e-treeview-ul").attr("role","group");this._liList.addClass("e-item").attr("role","treeitem");this.element.find("ul").first().removeClass("e-treeview-ul")},_controlRender:function(){var h,r,o,v,c,f,y,s,l,b,p,u,k;if(this.element!=null){var e=this.element.find("> ul"),w=e.find("li"),a=-1;for(h=0;h<w.length;h++)r=n(w[h]),f=r.children("ul")[0],this.model.showCheckbox==!0&&n(f).length!=0&&(y=e.find(">li"),y.each(function(t){n(f).parents("li.e-item").first()[0]==n(y[t])[0]&&(a=a+1)}),this._checkboxrecursive(e,f,a)),f&&n(r.children("ul")[0]).remove(),s=r.children("a")[0],s?(c=n(s).text(),o=n(s).clone(),n(s).remove(),n(o).addClass("e-text"),n(o).addClass("CanSelect"),v=r.clone(),r.html("")):(c=this._getText(r),v=r.clone(),r.html(""),o=t.buildTag("a.e-text CanSelect",c,"",{href:"#",alt:""})),l=t.buildTag("span"),f?n(l).addClass("collapseimg"):n(l).addClass("child"),b=t.buildTag("div","",{},{role:"presentation"}),p=t.buildTag("div","",{},{role:"presentation"}),n(p).append(b).append(l).append(v.children()).append(o),r.prepend(p),f&&r.append(f),r.prop("name")==i&&r.prop("name",c);this.model.showCheckbox&&(this._addCheckBox(e),this.element.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}))}u=e.find("li");u.find(">ul").hide();k=u.find("a");k.focus(function(){n(this).blur()});u.filter("li:last-child").addClass("last");n(u[0]).addClass("first");n(u[0]).hasClass("first")&&n(u[0]).hasClass("last")&&n(u[0]).removeClass("first");n(u.filter(":has(ul)")).each(function(){n(this).attr("aria-expanded",!1).attr("aria-selected",!1);var t=n(n(this).children()).filter("ul");n(t).is(":hidden")?n(n(this).children().find("div")[0]).removeClass("e-icon e-minus").addClass("e-icon e-plus"):n(this.childNodes[1]).removeClass("e-icon e-plus").addClass("e-icon e-minus")})},_getText:function(t){return n(t).clone().children().remove().end().text()},_finalize:function(){var r,t,i,u;if(this._isFocus=!0,this._isRender=!1,this.model.loadOnDemand||!(this.model.expandedNodes instanceof Array&&this.model.expandedNodes.length>0))for(r=this.element.find(".expanded"),t=0;t<r.length;t++)this._expandNode(r[t]);if(!this.model.loadOnDemand&&this.model.checkedNodes instanceof Array&&this.model.checkedNodes.length>0||this.model.showCheckbox&&this._isCheckedAction(),!this.model.loadOnDemand){for(t=0;t<this.model.expandedNodes.length;t++)this._expandNode(this._liList[this.model.expandedNodes[t]]);if(this.model.showCheckbox)for(i=0;i<this.model.checkedNodes.length;i++)u=this._liList[this.model.checkedNodes[i]],this._nodeCheckedAction(n(u).find("span.e-chkbox-wrap").first())}this._isRender=!0;this.model.allowEditing&&this._enableAllowEdit();n(this._liList[0]).find("a.e-text").attr("id",this._id+"_active");this.element.attr("tabindex",0)},_isCheckedAction:function(){for(var i=this.element.find(".ischecked"),t=0;t<i.length;t++)this._nodeCheckedAction(n(i[t]).find("span.e-chkbox-wrap").first());this.element.find(".ischecked").removeClass("ischecked")},_addCheckBox:function(i){for(var f,e,u=i.find(">li"),r=0;r<u.length;r++)f=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:"TreeView_Checkbox"+r,value:"False"}),e=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox1",value:r}),n(u[r]).children("div").children("span").first().after(n(e)),n(u[r]).children("div").children("span").first().after(n(f))},_checkboxrecursive:function(i,r,u){var o=this,f,e=n(r).find(">li");f=n(n(n(r).parents("li.e-item")[0]).find(">input[type= hidden]")[0]).length==0?u:n(n(r).parents("li.e-item")[0]).find(">input[type=hidden]")[0].value;e.each(function(i){var l=u,s=f+"."+i;o._checkboxrecursive(f,this,l);var h=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:"TreeView_Checkbox"+s,value:"False"}),c=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox"+s,value:s}),r=n(e[i]);r.find("a.e-text ").length>0?(h.insertBefore(r.find("a.e-text ")[0]),c.insertBefore(r.find("a.e-text ")[0])):r.prepend(h).prepend(c)})},_checkedChange:function(t){var i=n(this.element).closest(".e-treeview").data("ejTreeView");t.isChecked?i._nodeCheckedAction(this.element,t):i._nodeUnCheckedAction(this.element,t)},_ClickEventHandler:function(i){var e=this,r=i.target,u;if(!this._isclicked){if(this._isclicked=!0,this._onClick({event:i,currentElement:r}),!t.isNullOrUndefined(r)&&r.tagName.toUpperCase()=="DIV"&&(n(r).hasClass("e-plus")||n(r).hasClass("e-minus")))if(u=null,r.tagName.toUpperCase()=="SPAN"?(u=n(r.parentNode).parent().children().filter("ul"),r=n(r.parentNode).children().filter("div")[0]):u=n(r.parentNode).parent().children().filter("ul"),this.isExpanded=n(u).children().filter("li").length>0?!0:!1,!this.isExpanded&&this.model.loadOnDemand){n(r).addClass("e-load");this._checkboxChecked=n(r).siblings().find("input[type=checkbox]").prop("checked")?!0:!1;var o=n(n(r).parents("li.e-item")[0]).attr("id"),s=n(n(n(n(r).parents("li.e-item")[0]).children("div")[0]).children("a[class*=e-text]")[0]).text(),f={id:o,value:s,isChildLoaded:this.isExpanded};this._onBeforeExpand(f);this._loadOnDemand(f,r)}else this._expandCollapseAction(r);t.isNullOrUndefined(r)||r.tagName.toUpperCase()!="A"||n(r).hasClass("CanSelect")&&!n(r).hasClass("e-active")&&this._nodeSelectionAction(r)}setTimeout(function(){e._isclicked=!1},300);t.isNullOrUndefined(r)||r.tagName.toUpperCase()!="A"||(n(r).attr("href")=="#"&&i.preventDefault(),this.element.focus())},_loadOnDemand:function(n,i){var u,r=this,f;this.model.fields.dataSource instanceof t.DataManager?(r=this,f=t.Query(),f=r._columnToSelect(r.model.fields.child),f.where(r.model.fields.child.parentId,t.FilterOperators.equal,n.id),queryPromise=r.model.fields.child.dataSource.executeQuery(f),queryPromise.done(function(n){u=n.result;u.length>0&&(r._onlineData=!0,r._onlineDataSource(u,u[0][r.model.fields.id],r.model.fields.child))})):(r._currentDataSource=!1,u=this._getChildNodes(this._dataSource,n),!t.isNullOrUndefined(u)&&u.length>0&&setTimeout(function(){r._currentDataSource=!0;r._createSubNodesWhenLoadOnDemand(u,i,r.model.fields)},400))},_createSubNodesWhenLoadOnDemand:function(t,i,r){this._loadOnDemandNodes=!0;this._templateNodeCreation(t,r);n(this._fragment.firstChild).attr("style","display:none");this._fragment.firstChild.className="e-treeview-ul";this._fragment.firstChild.setAttribute("role","group");i.parentNode.parentNode.appendChild(this._fragment);var u=n(n(i).parents("li.e-item")[0]);u.attr("aria-expanded",!1).attr("aria-expanded",!0);n(i).removeClass("e-load");this._beforeBaseClass();this._isRender=!1;this._isCheckedAction();this._isRender=!0;this._enableDragDrop();this.model.allowEditing&&this._enableAllowEdit();this._expandCollapseAction(i)},_getChildNodes:function(n,i){var u=[],e=this.model.loadOnDemand?i.id:i[this.model.fields.id],r,f;if(this._templateType==1){for(r=0,f=n.length;r<f;r++)if(!t.isNullOrUndefined(n[r][0][this.model.fields.parentId])&&n[r][0][this.model.fields.parentId]==e)return n[r]}else{for(r=0,f=n.length;r<f;r++){if(n[r][this.model.fields.id]==i.id)return n[r].child;if(n[r].hasOwnProperty("child")&&(u=this._getChildNodes(n[r].child,i),!t.isNullOrUndefined(u)&&u.length>0))break}return u}},_getPath:function(t){for(var r=n(t).prop("name"),i=n(t).parents("li")[0];i!=null&&i.parentNode.id!=this._id;)r=n(i).prop("name")+"/"+r,i=n(i).parents("li")[0];return this._id+"/"+r},_nodeSelectionAction:function(t){var i,r,u;n(t)!=null&&(n(n(t).parents("li")).hasClass("e-node-disable")||(n(n(this.element).find(".e-active")).removeClass("e-active"),n(this.element).find("#"+this._id+"_active").removeAttr("id"),n(this.element).find("[aria-selected=true]").attr("aria-selected",!1),n(t).addClass("e-active"),i=n(n(t).parents("li.e-item")[0]),i.attr("aria-selected",!0).find("a.e-text").attr("id",this._id+"_active"),r=n(t).text(),u={currentElement:i,value:r},this._onNodeSelect(u)))},_nodeUnSelectionAction:function(t){t[0]!=null&&n(t).removeClass("e-active")},_nodeEnableAction:function(t){t[0]!=null&&(t=n(t),this.model.showCheckbox&&n(n(t.parents("li.e-item")[0]).find("input")[0]).prop("disabled",!1),n(t.parents("li.e-item")[0]).removeClass("e-node-disable"),n(t.parents("li.e-item")[0]).find("a").removeClass("e-node-disable"),n(t.parents("li.e-item")[0])[0].disabled=!1)},_nodeDisableAction:function(t){t[0]!=null&&(t=n(t),this._collpaseNode(t.parents("li.e-item")[0]),this.model.showCheckbox&&n(n(t.parents("li.e-item")[0]).find("input")[0]).prop("disabled",!0),n(t.parents("li.e-item")[0]).addClass("e-node-disable"),n(t.parents("li.e-item")[0]).find("a").addClass("e-node-disable"),n(t.parents("li.e-item")[0]).find("a").hasClass("e-active")&&n(t.parents("li.e-item")[0]).find("a").removeClass("e-active"),n(t.parents("li.e-item")[0])[0].disabled=!0)},_expandCollapseAction:function(i){var e,u=this,s,f,o,r;if(!n(i.parentNode).parent().hasClass("e-node-disable"))if(t.isNullOrUndefined(i.tagName)||i.tagName.toUpperCase()!="SPAN"?e=n(i.parentNode).parent().children().filter("ul"):(e=n(i.parentNode).parent().children().filter("ul"),i=n(i.parentNode).children().filter("div")[0]),s=i.tagName=="DIV"?n(i.parentNode.parentNode)[0]:i,f=n(n(i).parents("li.e-item")[0]),this._isExpanded(s)){if(f.attr("aria-expanded",!1).attr("tabindex",-1),o=n(n(n(n(i).parents("li.e-item")[0]).children("div")[0]).children("a[class*=e-text]")[0]).text(),r={currentElement:n(n(i).parents("li.e-item")[0]),value:o},this._onBeforeCollapse(r)===!0)return!1;n(e).animate({height:"toggle"},this.model.enableAnimation?200:0,"linear",function(){u._onNodeCollapse(r);u._removeExpandedNodes(u._liList.index(r.currentElement))});n(i).removeClass("e-icon e-minus").addClass("e-icon e-plus");i.parentNode!=null&&(n(i.parentNode.parentNode).removeClass("e-collapse"),n(n(i.parentNode).children()[1]).addClass("collapseimg").removeClass("expandimg"))}else f.attr("aria-expanded",!0).attr("tabindex",0),o=n(n(n(n(i).parents("li.e-item")[0]).children("div")[0]).children("a[class*=e-text]")[0]).text(),r={currentElement:f,value:o,isChildLoaded:this.isExpanded},this.model.loadOnDemand?this.isExpanded?this._onBeforeExpand(r)?!0:!1:!1:this._onBeforeExpand(r)?!0:!1,n(e).animate({height:"toggle"},this.model.enableAnimation?350:0,"linear",function(){u._onNodeExpand(r);u._addExpandedNodes(u._liList.index(f))}),n(i).removeClass("e-icon e-plus").addClass("e-icon e-minus"),n(i.parentNode.parentNode).addClass("e-collapse"),n(n(i.parentNode).children()[1]).removeClass("collapseimg").addClass("expandimg")},_isExpanded:function(t){t.tagName=="A"&&(t=n(t.parentNode.parentNode)[0]);var i=this._isNodeExpanded(t);return n(n(t).children().filter("ul"))!=null&&(i=n(n(t).children().filter("ul").find("li"))!=null?n(n(t).children().filter("ul").find("li")).is(":not(:hidden)"):!1),i},_isChecked:function(t){return n(t).val()==="True"?!0:!1},_nodeCheckedAction:function(i,r){var c,l,o,f,u;this._CurrenctSelectedNodes=[];var s=this,h=[],e=n(n(i).find("input.nodecheckbox[type=checkbox]")[0]);for(e.addClass("checked").prop("value","True"),e.ejCheckBox({enableTriState:!1}),e.ejCheckBox({checked:!0}),h.push(n(e).parents("li.e-item").first().find(".e-text").first().text()),n(n(i).parents("li.e-item")[0]).children("ul").find("input.nodecheckbox[type=checkbox]").prop("checked",!0).addClass("checked").prop("value","True"),c=n(n(i).parents("li.e-item")[0]).children("ul").find("input.nodecheckbox[type=checkbox]"),c.each(function(){n(this).ejCheckBox({checked:!0});var t=n(this).parents("li.e-item").first();s._addCheckNodes(s._liList.index(t));h.push(t.find(".e-text").first().text())}),l=this.model.autoCheckParentNode,o=n(n(i).parents("li.e-item")[0]).parents("li.e-item"),o.each(function(t){var u=n(o[t]).children("ul").find("li.e-item"),f=n(o[t]).children("ul").find("li.e-item").find('input.nodecheckbox[value="True"]').length,i=n(n(o[t]).find("> div")).find("input.nodecheckbox[type=checkbox]"),r;f==u.length||l?(i.addClass("checked").prop("value","True"),i.ejCheckBox({enableTriState:!1}),i.ejCheckBox({checked:!0}),r=n(i).parents("li.e-item").first(),s._addCheckNodes(s._liList.index(r)),h.push(r.find(".e-text").first().text())):i.length>0&&(i.ejCheckBox({enableTriState:!0}),i.ejCheckBox({checkState:"indeterminate"}),i.val("False"))}),r&&(r.checknode=h),this._onChecked(e,r),f=this.element.find('input.nodecheckbox[value="True"]'),u=0;u<f.length;u++){var e=n(f[u]).parents(".e-chkbox-wrap"),a=n(e.next()[0])[0].value,v=n(n(f[u]).parents("li.e-item")[0]).attr("id"),y=n(f[u]).parents("li.e-item").first().find(".e-text").first().text(),p=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox"+a+".Value",value:v}),w=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox"+a+".Text",value:y});try{n(f[u]).append(n(p));n(f[u]).append(n(w))}catch(b){}}},_nodeUnCheckedAction:function(t,i){var u=this,f=[],r,o,s,e;t=n(t);r=n(n(t).find("input.nodecheckbox[type=checkbox]")[0]);r.removeClass("checked").prop("value","False").children().remove();r.ejCheckBox({enableTriState:!1});r.ejCheckBox({checked:!1});f.push(n(r).parents("li.e-item").first().find(".e-text").first().text());o=n(t.parents("li.e-item")[0]).children("ul").find("input.nodecheckbox[type=checkbox].checked");o.removeClass("checked").prop("value","False").children().remove();o.each(function(){n(this).ejCheckBox({checked:!1});var t=n(this).parents("li.e-item").first();u._removeCheckNodes(u._liList.index(t));f.push(t.find(".e-text").first().text())});s=this.model.autoCheckParentNode;e=n(t.parents("li.e-item")[0]).parents("li.e-item");e.each(function(t){var r=n(e[t]).find('input.nodecheckbox[value="True"]').length,i=n(n(e[t]).find("> div")).find("input.nodecheckbox[type=checkbox]"),o;r<=0&&(i.ejCheckBox({enableTriState:!1}),i.ejCheckBox({checked:!1}),o=n(i).parents("li.e-item").first(),u._removeCheckNodes(u._liList.index(o)),f.push(o.find(".e-text").first().text()));r>1&&s?(i.addClass("checked").prop("value","True"),i.ejCheckBox({checked:!0})):r==1&&s?(i.addClass("checked").prop("value","False"),i.ejCheckBox({checked:!1})):r>0&&(i.removeClass("checked").prop("value","False").children().remove(),i.ejCheckBox({enableTriState:!0}),i.ejCheckBox({checkState:"indeterminate"}))});i&&(i.unchecknode=f);this._onUnChecked(r,i)},_enableAllowEdit:function(){var t=this.element,i=n(t).find("li");i.each(function(){n(this).addClass("AllowEdit")})},_disableAllowEdit:function(){var t=this.element.find("li");t.each(function(){n(this).removeClass("AllowEdit")})},_expandNode:function(t){if(t!=null)if(this.model.loadOnDemand)this._expandCollapseAction(n(n(t).children("div")).children()[0]);else if(n(n(n(t).children("div")).children()[0]).hasClass("e-plus")){var i=n(t).children("ul").find("li").length>0?!0:!1;i&&this._expandCollapseAction(n(n(t).children("div")).children()[0])}return!0},_collpaseNode:function(t){var i=t;i!=null&&n(i).find("ul").length>0&&n(n(n(i).children("div")).children()[0]).hasClass("e-minus")&&this._expandCollapseAction(n(n(i).children("div")).children()[0])},_expandAll:function(){var i=this,r=this.element,t=n(r).find("li:not([class*='e-node-disable'])"),u=t.find(">ul:hidden").parents("li.e-item");t.find(">ul:hidden").find("li").length>0&&t.find(">ul:hidden").animate({height:"toggle"},this.model.enableAnimation?350:0);n(u).each(function(){if(!n(this).hasClass("e-node-disable")){var r=n(n(this).parents("li.e-item")[0]),u=n(n(this).find(">div >a")[0]).text(),t={currentElement:r,value:u};if(i._onBeforeExpand(t)===!0)return!1;n(this).find("li").length>0&&(n(this).addClass("expand"),n(n(n(this).children("div")[0]).children()[1]).removeClass("collapseimg").addClass("expandimg"),n(n(n(this).children("div")[0]).children()[0]).removeClass("e-icon e-plus").addClass("e-icon e-minus"));i._onNodeExpand(t)}})},_collapseAll:function(){var n=this.element.find("li");this._collapseNodes(n)},_checkAll:function(){var u,r,i,t;if(this.model.showCheckbox)for(this._CurrenctSelectedNodes=[],u=this.element,r=n(u).find("li"),i=0;i<r.length;i++)t=n(r[i]).children().find("input.nodecheckbox")[0],n(t)[0].disabled?n(t).ejCheckBox("setModel",{checked:!1}):(n(t).ejCheckBox("setModel",{checked:!0}),n(t).attr("value","True"),this._onChecked(t));else alert("Please Enable the ShowCheckbox property")},_unCheckAll:function(){var u,r,t,i;if(this.model.showCheckbox)for(u=this.element,r=n(u).find("li"),t=0;t<r.length;t++)i=n(r[t]).find("input.nodecheckbox")[0],n(i).ejCheckBox("setModel",{checked:!1}),n(i).attr("value","False"),this._onUnChecked(i);else alert("Please Enable the ShowCheckbox property")},_collapseNodes:function(t){var i=this,r=t.find(">ul:not(:hidden)").parents("li.e-item");t.find(">ul:not(:hidden)").animate({height:"toggle"},this.model.enableAnimation?350:0);n(r).each(function(){var r=n(n(this).find(">div >a")[0]).text(),t={currentElement:this,value:r};if(i._onBeforeCollapse(t)==!0)return!1;n(this).find("li").length>0&&(n(this).removeClass("e-collapse"),n(n(n(this).children("div")[0]).children()[1]).removeClass("expandimg").addClass("collapseimg"),n(n(n(this).children("div")[0]).children()[0]).removeClass("e-icon e-minus").addClass("e-icon e-plus"));i._onNodeCollapse(t)})},_showCheckBox:function(){for(var f,t=this.element.find("> ul"),e=t.find("li"),i=0;i<e.length;i++){var r=-1,o=e[i],u=n(o).children("ul")[0];this.model.showCheckbox==!0&&n(u).length!=0&&(f=t.find(">li"),f.each(function(t){n(n(u).parents("li.e-item")[0])[0].id==n(f[t])[0].id&&(r=r+1)}),this._checkboxrecursive(t,u,r))}this._addCheckBox(t);t.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})},_drag:function(){var r=this,u=!1,i=null,f=null;this._treeView=this.element.parent();this.model.allowDragAndDropAcrossControl||(f=this.element.parent());n(this._treeView).find("ul li div a").not(".e-js").ejDraggable({dragArea:f,clone:!0,dragStart:function(n){var t={target:n.target,event:n.event};if(r._onDragStarts(t))return n.cancel=!0,i&&i.remove(),!1},drag:function(f){var e,s,o,h;if(u=!1,n(".e-sibling").remove(),e=f.target,n(i).css({"margin-left":"20px","margin-top":f.event.clientY-20<0?"0px":"-20px"}),s={target:e,event:f.event},r._onDrag(s))return!1;n(e).hasClass("e-droppable")||n(e).parent().hasClass("e-droppable")?(document.body.style.cursor="",n(i).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"),n(e).addClass("allowDrop")):n(e).hasClass("e-sibling")||(document.body.style.cursor="not-allowed",n(i).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-minus"),n(e).removeClass("showline-hover"),n(e).removeClass("noline-hover"));e.nodeName!="A"?(e.nodeName=="UL"&&n(e).children()[0]!=null&&(e=n(e).children()[0],u=!0),e.nodeName!="LI"&&(e=n(e).closest("li.e-droppable")[0]||n(e).parent()),e.nodeName=="LI"&&n(e).hasClass("e-droppable")&&r.model.allowDropSibling&&(o=t.buildTag("div.e-sibling"),h=n(".e-treeview").has(e).offset().top+n(e).children().find("a")[0].offsetTop||-1,u||(u=f.event.pageY>h?!1:!0),u?n(e).prepend(o):n(e).append(o),n(e).parents().hasClass("e-rtl")?n(i).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-insertInbetween-rtl"):n(i).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-insertInbetween"))):n(".e-sibling").remove()},dragStop:function(t){var f,s,e,o;if((t.element.dropped||(i&&i.remove(),document.body.style.cursor=""),f=t.target,f.className=="e-sibling"&&(f=n(f).parent("li")[0]),s=r,e=u?"Before":"After",e=f.nodeName=="A"?"Over":e,o={target:f,position:e,event:t.event},r._onDragStop(o))||(n(t.element).removeClass("e-active"),f.nodeName=="A"&&r.model.allowDropChild&&n(f).hasClass("e-droppable")||f.nodeName=="UL"&&n(f).children().length==0?(e="Over",n(t.element).parent().parent().has(n(f)).length==0&&(n(f).parent().parent().has(n(t.element)).length==0||r._isDescendant(n(f).parents("li:last").find(">ul>li"),n(t.element).parents("li:first")[0]))&&(r._dropAsChildNode(f,t.element,t.event),s._applyFirstLastChildClass())):(f.nodeName=="UL"&&(f=n(f).children()[0]),f.nodeName!="LI"&&(f=n(f).parent(".e-droppable")[0]||n(f).parent()),f.nodeName=="LI"&&r.model.allowDropSibling&&n(f).hasClass("e-droppable")&&(n(".e-sibling").remove(),n(t.element).parent().parent().has(n(f)).length<1&&(r._dropAsSublingNode(f,t.element,u,t.event),s._applyFirstLastChildClass()))),n(".e-sibling").remove(),n(".allowDrop").removeClass("allowDrop"),r.model.allowDropChild||i&&i.remove(),o={target:f,event:t.event,dropedElement:t.element},r._onDropped(o)))return!1;document.body.style.cursor=""},helper:function(r){return i=n(r.element).clone().addClass("dragClone e-dragedNode"),this.spanEle=t.buildTag("span.e-icon e-plus e-dropedStatus"),i.append(this.spanEle),i.appendTo(n("body"))}})},_isDescendant:function(t,i){var r=!0;return n(t).each(function(n,t){if(t==i)return r=!1,!1;r=!0}),r},_childDrop:function(){n(this._treeView).find("ul li div a").ejDroppable({accept:n(this._treeView).find("ul li div a"),drop:function(t,i){n(i.helper).hide()}})},_siblingDrop:function(){n(this._treeView).find("ul li").ejDroppable({drop:function(t,i){n(i.helper).hide()}})},_dropAsSublingNode:function(t,i,r,u){var f=u.ctrlKey?n(i).parent().parent().clone():n(i).parent().parent(),e=n(i).parents("li.e-item")[1];r?n(f).insertBefore(t):n(f).insertAfter(t);this._modifiCss(e);this._applyFirstLastChildClass()},_dropAsChildNode:function(t,i,r){var u=r.ctrlKey?n(i).parent().parent().clone():n(i).parent().parent(),f=n(i).parents("li.e-item")[1];t.nodeName=="UL"?n(t).append(u):this._appendNode(t,u);this._modifiCss(f);this._applyFirstLastChildClass();this._expandNode(n(t).parent().parent()[0])},_appendNode:function(i,r){var u,e,f;i.length!=0&&(u=n(n(i).parents("li.e-item")[0]),this._showline&&(n(u.find("li")).hasClass("last")&&n(u.find("li")).removeClass("last"),n(r).addClass("last")),u.find("ul")[0]==null?(e=t.buildTag("ul.e-treeview-ul"),n(e).append(n(r)),n(u.find("div")[1]).length==0&&(f=document.createElement("div"),f.setAttribute("role","presentation"),f.className="e-icon e-minus",n(u.find("div")).append(n(f))),n(u.find("div")[1]).hasClass("e-minus")||n(u.find("div")[1]).addClass("e-icon e-minus"),u.append(n(e))):n(u.find("ul")[0]).append(n(r)))},_checkBox:function(t,i){var r;if(!n(i).hasClass("nodecheckbox")&&n(i).find(".nodecheckbox").length>0&&(n(i).find(".e-chkbox-wrap").next().remove(),n(i).find(".e-chkbox-wrap").remove()),n(t).find(".e-checkbox").length>0){r=n(".e-treeview").has(t).find("ul")[0];n(r).find(".e-checkbox").next().remove();n(r).find(".e-checkbox").remove();var f=this,u=-1,e=n(r).find("li");e.each(function(){var t=n(this).children("ul")[0],i;n(t).length!=0&&(i=n(r).find(">li"),i.each(function(r){n(n(t).parents("li.e-item")[0])[0].id==n(i[r])[0].id&&(u=u+1)}),f._childcheckbox(r,t,u))});this._addCheckBox(n(r));this.element.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});n(t).closest(".e-treeview").find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})}},_childcheckbox:function(i,r,u){var o=this,f,e=n(r).find(">li");f=n(n(n(n(r).parents("li.e-item")[0]).children()[0]).find(">input[type= hidden]")[0]).length==0?u:n(n(n(r).parents("li.e-item")[0]).children()[0]).find(">input[type= hidden]")[0].value;e.each(function(i){var c=u,r=f+"."+i,s,h;o._childcheckbox(f,this,c);s=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:"TreeView_Checkbox"+r,value:"False"});h=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox.Index",value:r});n(e[i]).children("div").children("span").after(n(h));n(e[i]).children("div").children("span").after(n(s))})},_modifiCss:function(t){n(t).find("li").length==0?(n(t).find("ul").remove(),n(t).removeClass("e-collapse"),n(t).find("div.e-icon").removeClass("e-icon e-minus")):n(n(t).find("li")[n(t).find("li").length-1]).hasClass("last")||n(n(t).find("li")[n(t).find("li").length-1]).addClass("last")},_applyFirstLastChildClass:function(){var i=this.element,t=i.find("li");t.removeClass("first");t.removeClass("last");t.filter("li:last-child").addClass("last");n(t[0]).addClass("first");n(t[0]).hasClass("first")&&n(t[0]).hasClass("last")&&n(t[0]).removeClass("first")},_expandEventHandler:function(t){var r=n(t.target),i,u;r.hasClass("e-icon")||t.type==="dblclick"&&this.model.allowEditing||(t.preventDefault(),i=n(r.siblings("div")),u=r.parent().parent(),i.hasClass("e-minus")?this._collpaseNode(u):this.model.loadOnDemand&&i.find(".e-item").length==0?(this._isclicked=!1,this._ClickEventHandler({target:i[0]})):this._expandNode(u))},_inlineEdit:function(t){return t.preventDefault(),t.target.tagName!="A"||n(t.target).hasClass("e-node-disable")||n(n(t.target).parents("li.e-item")[0]).hasClass("AllowEdit")&&n(t.target).hasClass("e-text")&&(n(t.target).removeClass("e-active"),this._inlineEditAction(t.target)),!1},_inlineEditAction:function(t){var i=n("#Edit_Input")[0];i==null?this._createEditTextBox(t):(i=n("#Edit_Input")[0],n(i.parentNode).html(i.value),n(i).remove(),this._createEditTextBox(t))},_createEditTextBox:function(i){var o={currentElement:i},r,u,e,f;return this._trigger("beforeEdit",o)?!1:(r=n("#Edit_Input")[0],r==null&&(u=t.buildTag("Input.Input_Text#Edit_Input","","",{type:"text",value:n.trim(i.innerHTML).replace(/\n\s+/g," "),name:"inplace_value"}),n(u).width(n(i).outerWidth()+5),n(u).height(n(i).outerHeight()-2),this.beforeEditText=n(i).text(),n(i).html(""),n(i).before(u),e=0,r=n("#Edit_Input")[0],e=r.value.length==""?3:n(i).outerWidth()+20,this._mousePositionAtEnd(r),this._currentEditableNode=i,f=n(r),this._on(f,"keypress",this._editTextBoxKeyPress),this._on(f,"keydown",this,this._pressEscKey),this._on(f,"blur",this._focusout)),r)},_editTextBoxKeyPress:function(n){n.target.size=n.target.value.length+1},_mousePositionAtEnd:function(n){return n.focus&&n.focus(),n.select&&n.select(),!0},_focusout:function(){var t=n("#Edit_Input")[0],i=t.value,r=n(n(t).parents("li.e-item")[0]).attr("id"),u={nodeId:r,oldText:this.beforeEditText,newText:i},f=n(t).siblings().closest("a");this._trigger("inlineEditValidation",u)==!0?this._cancelAction(t):this._saveAction(t);this._nodeSelectionAction(f)},_pressEscKey:function(t){t.cancelBubble=!0;t.returnValue=!1;var i=n("#Edit_Input")[0];i!=null&&(t.keyCode==13&&(t.stopPropagation(),this._focusout()),t.keyCode==27&&this._cancelAction(i))},_onFocusHandler:function(t){this.model.allowKeyboardNavigation&&this._isFocus&&(this.element.find(".e-active").length==0&&(this.element.find(".e-active").removeClass("e-active"),nextElement=this.element.find("li").first().find("a").first(),n(nextElement).addClass("e-active")),t.preventDefault(),this._isFocus=!1)},_KeyPress:function(i){var u,l,f=this,a,v,e,r,h,o,y,b,c,p,w,g,k,s,nt,tt,d;if(this._isFocus=!0,a=this.element.find("> ul"),u=i.keyCode?i.keyCode:i.which?i.which:i.charCode,u==113&&(i.preventDefault(),this._isFocus=!1,v=a.find(".e-active")[0],v!=null&&n(n(v).parents("li.e-item")[0]).hasClass("AllowEdit")&&(n(v).removeClass("e-active"),this._createEditTextBox(v))),f.model.allowKeyboardNavigation&&f.element.find("#Edit_Input").length<1)if(r=n(n(a).find(".e-active").parents("li.e-item")[0]),h=n(a).find("li").not(":hidden"),u!=40||i.ctrlKey||i.altKey||i.shiftKey){if(u!=38||i.ctrlKey||i.altKey||i.shiftKey)u!=39||i.ctrlKey||i.altKey||i.shiftKey?u!=37||i.ctrlKey||i.altKey||i.shiftKey?u==13?r.length>0&&(c=n(r).children("div").find("div"),c.hasClass("e-minus")?this._collpaseNode(r):this.model.loadOnDemand&&r.find(".e-item").length==0?this._ClickEventHandler({target:c[0]}):this._expandNode(r),e=n(r.find("a")[0]),f._KeyPressEventHandler(e,f,u,i)):u==32?r.length>0&&this.model.showCheckbox&&(i.preventDefault(),p=r.find("input.nodecheckbox[type=checkbox]").first(),p[0].checked?this._nodeUnCheckedAction(p.parent().parent()):this._nodeCheckedAction(p.parent().parent())):u==46?r.length>0&&(i.preventDefault(),this._removeNode(r.find("a.e-text").first())):i&&i.ctrlKey==!0?u==88?(n(r).hasClass("first")?(w=n(r).removeClass("first").addClass("last"),n(r).next().addClass("first")):n(r).hasClass("last")?(w=n(r),n(r).prev().addClass("last")):w=n(r).addClass("last"),this._cutCopyNodeText=w,f._removeNode(),this.element.focus()):u==67?(g=n(r).clone(),this._cutCopyNodeText=g):u==86&&this._cutCopyNodeText!=null&&(n(r).length===0&&(r=this.element),s=n(this._cutCopyNodeText).clone(),n(s.find("a")[0]).hasClass("e-active")&&n(s.find("a")[0]).removeClass("e-active"),k=n(s).hasClass("first")?n(s).removeClass("first").addClass("last"):n(s).hasClass("last")?n(s):n(s).addClass("last"),this.model.showCheckbox&&(nt=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:"TreeView_Checkbox"}),nt.insertAfter(s.find(".e-chkbox-wrap")),s.find(".e-chkbox-wrap").remove(),s.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})),this._on(s.find(".e-text"),"mouseenter",this._mouseEnterEvent),this._on(s.find(".e-text"),"mouseleave",this._mouseLeaveEvent),n(r).children("div").children("span").hasClass("child")&&n(r).children("div").children("span").removeClass("child").addClass("expandimg"),n(r).children("ul").length!=0?(n(r).children("ul").find(">li").last().removeClass("last"),n(r).find(">ul").append(n(k))):(tt=t.buildTag("ul.e-treeview-ul"),l=n(tt).append(n(k)),n(r).append(n(l)),n(r).children("div").find(">div").first().addClass("e-icon e-minus")),d=n(r).parents("li.e-item"),d.each(function(t){var i=n(d[t]).children("ul").find(">li");i.length==1&&n(i).addClass("last")}),this._expandNode(r)):u!=36||i.ctrlKey||i.altKey||i.shiftKey?u!=35||i.ctrlKey||i.altKey||i.shiftKey||(n(n(r).find("a")[0]).removeClass("e-active"),l=n(a).find(">li").last(),n(l).find("div").hasClass("e-minus")?(e=n(n(l).find("li").last().find("a")[0]),n(e).addClass("e-active")):(e=n(l.find("a")[0]),n(e).addClass("e-active")),f._KeyPressEventHandler(e,f,u,i),i.preventDefault()):(n(n(r).find("a")[0]).removeClass("e-active"),e=n(n(a).find(">li")[0]).find("a")[0],n(e).addClass("e-active"),f._KeyPressEventHandler(e,f,u,i),i.preventDefault()):(c=n(r).children("div").find("div"),c.hasClass("e-minus")?(i.preventDefault(),this._collpaseNode(r)):n(r).parents().first().parents("li").first().length>0&&(n(r).find("a.e-active").first().removeClass("e-active"),n(r).parents().first().parents("li").first().find("a").first().addClass("e-active")),e=n(r.find("a")[0]),f._KeyPressEventHandler(e,f,u,i)):(c=n(r).children("div").find("div"),c.hasClass("e-plus")?(i.preventDefault(),this.model.loadOnDemand&&r.find(".e-item").length==0?this._ClickEventHandler({target:c[0]}):this._expandNode(r)):n(r).find("div.e-icon e-plus,div.e-icon e-minus").first().length>0?this.selectNode(n(r).children("ul").find("li").first()[0]):(y=n(r).parent().find("li"),b=y.index(r),!t.isNullOrUndefined(y[b+1])&&n(r).children("ul").length>0&&this.selectNode(y[b+1])),e=n(r.find("a")[0]),f._KeyPressEventHandler(e,f,u,i));else if(r.length>0){for(i.preventDefault(),o=0;o<h.length;o++)if(n(n(h[o]).find("a")[0]).hasClass("e-active"))if(o==0)this._nodeSelectionAction(n(r.find("a")[0]).addClass("e-active"));else{n(n(h[o]).find("a")[0]).removeClass("e-active");this._nodeSelectionAction(n(n(h[o-1]).find("a")[0]).addClass("e-active"));break}f._KeyPressEventHandler(e,f,u,i)}}else if(r.length>0){for(i.preventDefault(),o=0;o<h.length;o++)if(n(n(h[o]).find("a")[0]).hasClass("e-active"))if(o==h.length-1)this._nodeSelectionAction(n(r.find("a")[0]).addClass("e-active"));else{n(n(h[o]).find("a")[0]).removeClass("e-active");this._nodeSelectionAction(n(n(h[o+1]).find("a")[0]));break}f._KeyPressEventHandler(e,f,u,i)}},_removeNode:function(i){var u=t.isNullOrUndefined(i)?this.element.find(".e-active"):i;if(u!=null){var f=n(n(u).parents("li.e-item")[1]),r=n(n(u).parents("li.e-item")[0]),e=n(f).find("li").not(":hidden");e.length>0?r.next().length>0?n(r.next().find("a")[0]).addClass("e-active"):r.prev().length>0?n(r.prev().find("a")[0]).addClass("e-active"):n(f.find("a")[0]).addClass("e-active"):r.next().length>0?n(r.next().find("a")[0]).addClass("e-active"):n(r.prev().find("a")[0]).addClass("e-active");r.remove();this._modifiCss(f)}},_KeyPressEventHandler:function(t,i,r,u){var f,o=n(n(t).parents("li.e-item")[0]),s=i._getPath(n(t).parents("li.e-item")[0]),h=n(t).text(),e;f=n(n(t).parents("li.e-item")[0]).children("div").find("div").hasClass("e-minus")?!0:!1;e={keyCode:r,currentElement:o,value:h,isExpanded:f,path:s,event:u};this._trigger("keyPress",e)},_documentClick:function(t){if(t.target.id!="Edit_Input")var i=n("#Edit_Input")[0];i!=null&&(n(i).next().html(i.value).removeAttr("style"),n(i).remove())},_saveAction:function(t){n(t).next().html(t.value).removeAttr("style");n(t).remove()},_cancelAction:function(t){n(t).next().html(this.beforeEditText).removeClass("e-node-hover").addClass("e-active").removeAttr("style");this._hideEditTextBox()},_hideEditTextBox:function(){var t=n("#Edit_Input")[0];t!=null&&n(t).remove()},_mouseEnterEvent:function(t){n(t.currentTarget).hasClass("e-text")&&!n(t.currentTarget).hasClass("e-node-disable")&&n(t.currentTarget).addClass("e-node-hover")},_mouseLeaveEvent:function(t){n(t.currentTarget).removeClass("e-node-hover")},_createTreeElement:function(i,r,u){var e,a,v,y,o,c,s;if(this.model.showCheckbox){if(t.isNullOrUndefined(r))a=this.element.find(">li"),e=a.length+1;else if(n(r.parents("li.e-item")[0]).children("ul").length==0)e=n(n(r.parents("li.e-item")[0]).find("div")[0]).find(">input[type=hidden]")[0].value+".0";else{var h=n(n(r.parents("li.e-item")[0]).children("ul").find("li").last().find("div").find(">input[type=hidden]")[0]).val(),l=h.split("."),p=parseInt(l[l.length-1])+1,w=h.substring(0,h.length-1);e=w+p}v=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:"TreeView_Checkbox"+e+".Checked",value:"False"});y=t.buildTag("input","",{},{type:"hidden",name:"TreeView_Checkbox.Index",value:e})}o=t.buildTag("a.e-text CanSelect",i,"",{href:"#",id:this._id+"_active"});t.isNullOrUndefined(u)||o.attr("href",u);c=n(o);this._on(c,"mouseenter",this._mouseEnterEvent);this._on(c,"mouseleave",this._mouseLeaveEvent);var b=t.buildTag("span.child"),k=t.buildTag("div","",{},{role:"presentation"}),f=t.buildTag("div","",{},{role:"presentation"});return n(f).append(k),n(f).append(b),this.model.showCheckbox&&(n(f).append(v),n(f).append(y)),n(f).append(o),s=t.buildTag("li.e-item#"+i,"",{role:"treeitem",tabindex:-1}),this.model.allowEditing&&s.addClass("AllowEdit"),s.append(n(f)),n(s)},_addExpandedNodes:function(t){var i=this.model.expandedNodes;this._removeNullInArray(i);n.inArray(t,i)==-1&&this.model.expandedNodes.push(t)},_removeExpandedNodes:function(t){var i=this.model.expandedNodes;n.inArray(t,i)>-1&&(this.model.expandedNodes.splice(n.inArray(t,i),1),i.length==0&&i.push(-1))},_wireEvents:function(){this._on(this.element,"click",this._ClickEventHandler);this._on(this.element.find(".e-text"),"mouseenter",this._mouseEnterEvent);this._on(this.element.find(".e-text"),"mouseleave",this._mouseLeaveEvent);this.model.allowEditing&&this._allowEditable();this._on(this.element,this.model.expandOn,this._expandEventHandler);this.model.allowKeyboardNavigation&&this._on(this.element,"keydown",this._KeyPress);this._on(this.element,"focus",this._onFocusHandler);this._enableDragDrop()},_unWireEvents:function(){this._off(this.element,"click");this._off(this.element.find(".e-text"),"mouseenter");this._off(this.element.find(".e-text"),"mouseleave");this._preventEditable();this._off(this.element,this.model.expandOn);this.model.allowKeyboardNavigation&&this._off(this.element,"keydown");this._on(this.element,"focus")},_enableDragDrop:function(){this.model.allowDragAndDrop&&(this._drag(),this.model.allowDropChild&&this._childDrop(),this.model.allowDropSibling&&this._siblingDrop())},_allowEditable:function(){this._on(n(document),"click",this._documentClick);this._on(this.element.parent(),"dblclick",this._inlineEdit)},_preventEditable:function(){this._off(n(document),"click");this._off(this.element.parent(),"dblclick")},refresh:function(){this._unWireEvents();this._init()},expandAll:function(){this.model.enabled&&this._expandAll()},collapseAll:function(){this.model.enabled&&this._collapseAll()},checkAll:function(){this.model.showCheckbox&&this.model.enabled&&this._checkAll()},unCheckAll:function(){this.model.showCheckbox&&this.model.enabled&&this._unCheckAll()},getSelectedNode:function(){var t=this.element.find(".e-active");return n(n(t).parents("li.e-item")[0])},getText:function(i){if(t.isNullOrUndefined(i))return!1;return n(n(i).find("a")[0]).text()},selectNode:function(i){var r;!t.isNullOrUndefined(i)&&this.model.enabled&&(r=n(i).hasClass("e-text")?n(i):n(n(i).find(">div >a")[0]),this._nodeSelectionAction(r))},unselectNode:function(i){var r;!t.isNullOrUndefined(i)&&this.model.enabled&&(r=n(i).hasClass("e-text")?n(i):n(n(i).find(">div >a")[0]),this._nodeUnSelectionAction(r))},enableNode:function(i){var r;!t.isNullOrUndefined(i)&&this.model.enabled&&(r=n(i).hasClass("e-text")?n(i):n(n(i).find("a.e-text")[0]),this._nodeEnableAction(r),n(i).parent().find(".nodecheckbox").ejCheckBox("enable"))},disableNode:function(i){var r;!t.isNullOrUndefined(i)&&this.model.enabled&&(r=n(i).hasClass("e-text")?n(i):n(n(i).find(">div >a")[0]),this._nodeDisableAction(r),n(i).find(".nodecheckbox").ejCheckBox("disable"))},addNodes:function(n,i){var r,e,u,h,s,f;if(n&&n.length>0)for(r=this.model.fields,e=0;e<n.length;e++)if(u=n[e],h=u[r.text],h){var c=u[r.id],l=u[r.parentId],a=u[r.linkAttribute]?u[r.linkAttribute]:"#",o=i&&i.length!=0?i:null;if(t.isNullOrUndefined(o)&&(s=l?this.element.find("#"+l):null,o=s&&s.length!=0?s.children("div").find("a"):null),t.isNullOrUndefined(o))continue;f=this._createTreeElement(h,null,a);c?f.attr("id",c):f.removeAttr("id");this._appendNode(o,f);f.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});this.model.allowDragAndDrop&&f.find("a").addClass("e-draggable e-droppable")}},addNode:function(i,r,u){if(this.model.enabled){var f=null,s=null,o=this.element,h=o.children().length,e=t.isNullOrUndefined(u)?o.find(".e-active"):u;e.length==0?(s=h==0||o.children().children().length==0?t.buildTag("ul"):o.children()[h-1],f=this._createTreeElement(i,null,r),n(s).append(f),this._appendNode(e,s),n(f).find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})):(this._expandNode(n(n(e).parents("li.e-item")[0])),f=this._createTreeElement(i,e,r),this._appendNode(e,f),this.model.showCheckbox&&n(f).find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}));this._applyFirstLastChildClass();this._enableDragDrop();this._modifiCss()}},removeNode:function(i){this.model.enabled&&(t.isNullOrUndefined(i)||(element=n(i).hasClass("e-text")?n(i):n(n(i).find(">div >a")[0])),this._removeNode(element))},getCheckedNodes:function(){return this.element.find('input.nodecheckbox[value="True"]').closest("li")},checkNode:function(i){!t.isNullOrUndefined(i)&&this.model.enabled&&this._nodeCheckedAction(n(i).find("span.e-chkbox-wrap").first())},unCheckNode:function(i){!t.isNullOrUndefined(i)&&this.model.enabled&&this._nodeUnCheckedAction(n(i).find("span.e-chkbox-wrap").first())},expandNode:function(n){!t.isNullOrUndefined(n)&&this.model.enabled&&this._expandNode(n)},collapseNode:function(n){!t.isNullOrUndefined(n)&&this.model.enabled&&this._collpaseNode(n)},showNode:function(n){!t.isNullOrUndefined(n)&&this.model.enabled&&n.css("visibility","")},hideNode:function(n){!t.isNullOrUndefined(n)&&this.model.enabled&&n.css("visibility","hidden")},show:function(){this.element.css("visibility","")},hide:function(){this.element.css("visibility","hidden")},isNodeChecked:function(t){return this._isChecked(n(t).find("input.nodecheckbox")[0])},isExpanded:function(n){return this._isExpanded(n)},_isNodeExpanded:function(i){if(!t.isNullOrUndefined(i)){var r=n(i).children().filter("ul");return n(r).is(":not(:hidden)")}},hasChildNode:function(i){var r=!1;return t.isNullOrUndefined(i)||(r=n(i).children().length<2?!1:!0),r},_onNodeExpand:function(n){this._trigger("nodeExpand",n)},_onNodeCollapse:function(n){this._trigger("nodeCollapse",n)},_onBeforeExpand:function(n){return this._trigger("beforeExpand",n)},_onBeforeCollapse:function(n){return this._trigger("beforeCollapse",n)},_onNodeSelect:function(n){this._trigger("nodeSelect",n)},_onChecked:function(i,r){var u=n(i).parents("li").first(),f=u.find(".e-text").first().text(),e;this._CurrenctSelectedNodes.push(f);var o=this._isChecked(i),s=t.isNullOrUndefined(r)?"":t.isNullOrUndefined(r.event)?"":r.event,h=t.isNullOrUndefined(r)?"":t.isNullOrUndefined(r.checknode)?"":r.checknode;this._addCheckNodes(this._liList.index(u));e={currentElement:u,value:f,currentNode:this._CurrenctSelectedNodes,currentCheckedNodes:h,isChecked:o,event:s};this._isRender&&this._trigger("nodeCheck",e)},_onUnChecked:function(i,r){var u=n(i).parents("li").first(),e=u.find(".e-text").first().text(),s=this._isChecked(i),h=t.isNullOrUndefined(r)?"":t.isNullOrUndefined(r.event)?"":r.event,c=t.isNullOrUndefined(r)?"":t.isNullOrUndefined(r.unchecknode)?"":r.unchecknode,f,o;this._removeCheckNodes(this._liList.index(u));f=u.parents("li").first();u.parent().parent().is(this.element)||f.length==0||this._removeCheckNodes(this._liList.index(f));o={currentElement:u,value:e,currentNode:e,currentUncheckedNodes:c,isChecked:s,event:h};this._trigger("nodeUncheck",o)},_addCheckNodes:function(n){var t=this.model.checkedNodes;this._removeNullInArray(t);!t instanceof Array&&(t=[]);t.indexOf(n)==-1&&t.push(n)},_removeCheckNodes:function(n){var t=this.model.checkedNodes,i;!t instanceof Array&&(t=[]);i=t.indexOf(n);i!=-1&&(t.splice(i,1),t.length==0&&t.push(-1))},_removeNullInArray:function(n){var t=n.indexOf(-1);t!=-1&&n.splice(t,1)},_onDragStarts:function(n){return this._trigger("nodeDragStart",n)},_onDrag:function(n){return this._trigger("nodeDrag",n)},_onDragStop:function(n){return this._trigger("nodeDragStop",n)},_onDropped:function(n){return this._trigger("nodeDropped",n)},_onClick:function(n){this._trigger("nodeClick",n)}})})(jQuery,Syncfusion)})