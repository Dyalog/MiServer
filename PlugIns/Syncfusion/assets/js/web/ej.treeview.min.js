/*!
*  filename: ej.treeview.min.js
*  version : 13.2.0.39
*  Copyright Syncfusion Inc. 2001 - 2015. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.draggable.min","./ej.checkbox.min","./ej.waitingpopup.min"],n):n()})(function(){(function(n,t,r){t.widget("ejTreeView","ej.TreeView",{_rootCSS:"e-treeview",element:null,model:null,validTags:["ul","div"],_ignoreOnPersist:["fields","nodeClick","beforeExpand","nodeExpand","beforeCollapse","nodeCollapse","nodeSelect","nodeCheck","nodeUncheck","inlineEditValidation","beforeEdit","keyPress","nodeDragStart","nodeDrag","nodeDragStop","nodeDropped","create","destroy"],_setFirst:!1,defaults:{showCheckbox:!1,enableAnimation:!0,allowDragAndDrop:!1,htmlAttributes:{},allowDropChild:!0,allowDropSibling:!0,allowDragAndDropAcrossControl:!0,allowEditing:!1,allowKeyboardNavigation:!0,items:null,fields:{dataSource:null,query:null,tableName:null,child:null,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass",expanded:"expanded",hasChild:"hasChild",selected:"selected",linkAttribute:"linkAttribute",imageAttribute:"imageAttribute",htmlAttribute:"htmlAttribute",imageUrl:"imageUrl",isChecked:"isChecked"},autoCheckParentNode:!1,loadOnDemand:!1,cssClass:"",template:null,enableRTL:!1,expandOn:"dblclick",enablePersistence:!1,enabled:!0,expandedNodes:[],checkedNodes:[],selectedNode:-1,width:null,height:null,autoCheck:!0,nodeClick:null,beforeExpand:null,nodeExpand:null,beforeCollapse:null,nodeCollapse:null,nodeSelect:null,nodeCheck:null,nodeUncheck:null,inlineEditValidation:null,beforeEdit:null,keyPress:null,nodeDragStart:null,nodeDrag:null,nodeDragStop:null,nodeDropped:null,create:null,destroy:null},dataTypes:{cssClass:"string",showCheckbox:"boolean",enableAnimation:"boolean",allowDragAndDrop:"boolean",allowDropChild:"boolean",allowDragAndDropAcrossControl:"boolean",allowEditing:"boolean",allowKeyboardNavigation:"boolean",autoCheckParentNode:"boolean",loadOnDemand:"boolean",enableRTL:"boolean",expandOn:"string",enablePersistence:"boolean",items:"data",fields:{dataSource:"data",query:"data",child:"data"},expandedNodes:"array",checkedNodes:"array",selectedNode:"number",htmlAttributes:"data"},observables:["fields.dataSource"],dataSource:t.util.valueFunction("fields.dataSource"),_setModel:function(i){var r,o,s,f,e,h,u;for(r in i)switch(r){case"cssClass":this._changeSkin(i[r]);break;case"fields":this._unWireEvents();o=this.element.hasClass("e-js")?!1:!0;u=o?this.element.children("ul"):this.element;u.empty();n.extend(this.model.fields,i[r]);this.model.expandedNodes=[];this.model.checkedNodes=[];this.model.selectedNode=-1;this._checkDataBinding();o&&(s=this.element.children(".e-treeview-ul"),u.append(s.children()),s.remove());break;case"allowDragAndDropAcrossControl":this.model.allowDragAndDropAcrossControl=i[r];this._enableDragDrop();break;case"enabled":this._enabledAction(i[r]);break;case"showCheckbox":i[r]?(this.model.showCheckbox=i[r],this._showCheckBox(),this.model.enabled||this.element.find(".nodecheckbox").ejCheckBox("disable")):this.element.find("li > div > span.e-chkbox-wrap").remove();break;case"autoCheck":this.model.autoCheck=i[r];break;case"autoCheckParentNode":this.model.autoCheckParentNode=i[r];break;case"expandedNodes":for(this._collapseAll(),this.model.expandedNodes=[],f=0;f<i[r].length;f++)this.model.loadOnDemand?this._createChildNodesWhenExpand(n(this._liList[i[r][f]])):this._expandNode(n(this._liList[i[r][f]]));break;case"checkedNodes":if(this.model.showCheckbox)for(this._unCheckAll(),this.model.checkedNodes=[],e=0;e<i[r].length;e++)h=this._liList[i[r][e]],this._nodeCheckedAction(n(h).find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0]);break;case"expandOn":this._on(this.element,i[r],this._expandEventHandler);break;case"allowEditing":this._preventEditable();i[r]&&this._allowEditable();break;case"allowKeyboardNavigation":i[r]?this._on(this.element,"keydown",this._KeyPress):this._off(this.element,"keydown",this._KeyPress);break;case"allowDragAndDrop":this.model.allowDragAndDrop=i[r];i[r]?this._addDragableClass():this._preventDraggable();break;case"allowDropChild":this.model.allowDropChild=i[r];i[r]?this._addDragableClass():this._preventDropChild();break;case"allowDropSibling":this.model.allowDropSibling=i[r];i[r]?this._addDragableClass():this._preventDropSibling();break;case"enableRTL":this.model.enableRTL=i[r];this.model.enableRTL?this.element.is("UL")?this.element.parent(".e-treeview-wrap").addClass("e-rtl"):this.element.addClass("e-rtl"):this.element.is("UL")?this.element.parent(".e-treeview-wrap").removeClass("e-rtl"):this.element.removeClass("e-rtl");break;case"height":this.element.height(i[r]);break;case"width":this.element.width(i[r]);break;case"selectedNode":this.model.selectedNode=i[r];this.model.selectedNode>=0?(u=n(this._liList[this.model.selectedNode]),t.isNullOrUndefined(u)||this._nodeSelectionAction(u.find("> div > a.e-text:first"))):this.element.find("li > div > a.e-active").removeClass("e-active");break;case"htmlAttributes":this._addAttr(i[r])}},_destroy:function(){this.element.html("");this._cloneElement.removeClass("e-treeview e-js e-treeview-wrap");this.element.is("ul")?this.element.closest(".e-treeview-wrap").replaceWith(this._cloneElement):this.element.replaceWith(this._cloneElement);window.localStorage?window.localStorage.removeItem(this._id+"_childNodes"):window.cookie&&(document.cookie=this._id+"_childNodes=; expires=Thu, 01 Jan 1970 00:00:00 UTC")},_init:function(){this._cloneElement=n(this.element).clone();this._dataSource=[];this._fragment=[];this._templateType="";this._indexID=0;this._animating=!1;this._newDataSource=this.dataSource();this._id=this.element.prop("id");t.isNullOrUndefined(this.model.fields)||this.dataSource()==null?this.initialize():this._checkDataBinding()},initialize:function(){this._cutCopyNodeText=null;this.beforeEditText=null;this._CurrenctSelectedNodes=[];this.element.is("ul")?this._createWrapper():(this.element.addClass("e-treeview-wrap e-widget").attr("tabindex",0),this.element.children("ul:first").addClass("e-ul"),this.model.width!=null&&this.element.width(this.model.width),this.model.height!=null&&this.element.height(this.model.height),this.model.enableRTL&&this.element.addClass("e-rtl"),this.model.cssClass!=null&&this.element.addClass(this.model.cssClass));this._beforeBaseClass();this.dataSource()==null&&(this._addBaseClass(),this._controlRender());this._addDragableClass();this._finalize();this._enabledAction(this.model.enabled)},_beforeBaseClass:function(){var t;this.element.is("ul")?(t=this.element.parent(".e-treeview-wrap"),t.attr("role","tree")):(t=this.element,t.attr("aria-activedescendant",this._id+"_active").children("ul:first").attr("role","tree"));this._ulList=n(t[0].querySelectorAll("ul"));this._liList=n(t[0].querySelectorAll("li")).attr("tabindex",-1)},_createWrapper:function(){var n=t.buildTag("div.e-treeview-wrap e-widget "+this.model.cssClass,"","",{tabindex:0,"aria-activedescendant":this._id+"_active"});this.model.width!=null&&n.width(this.model.width);this.model.height!=null&&n.height(this.model.height);this.model.enableRTL&&n.addClass("e-rtl");n.insertAfter(this.element);n.append(this.element.addClass("e-ul").attr("tabindex",0));this._addAttr(this.model.htmlAttributes)},_addAttr:function(t){var i=this;n.map(t,function(n,t){t=="class"?i.element.addClass(n):t=="disabled"&&n=="disabled"?i._enabledAction(!1):i.element.attr(t,n)})},_changeSkin:function(n){this.model.cssClass!=n&&(this.element.is("ul")?this.element.parent(".e-treeview-wrap").removeClass(this.model.cssClass).addClass(n):this.element.removeClass(this.model.cssClass).addClass(n))},_enabledAction:function(n){this.model.enabled=n;n?(this.element.removeClass("e-disable"),this._wireEvents()):(this.element.addClass("e-disable"),this._unWireEvents())},_checkDataBinding:function(){this.dataSource()instanceof t.DataManager?this._initDataSource():!t.isNullOrUndefined(this.dataSource())&&this.dataSource().length>0&&(this._ensureDataSource(this.dataSource()),this.initialize())},_initDataSource:function(){this.element.ejWaitingPopup();var r=this.element.ejWaitingPopup("instance"),t,n=this,i;this.element.ejWaitingPopup("refresh");this.element.ejWaitingPopup("show");t=this._columnToSelect(this.model.fields);i=this.dataSource().executeQuery(t);i.done(function(t){n.element.ejWaitingPopup("hide");n.retriveData=t.result;n._ensureDataSource(t.result);n.initialize()})},_columnToSelect:function(n){var u=[],r=t.Query(),i;if(t.isNullOrUndefined(n.query)){for(i in n)i!=="tableName"&&i!=="child"&&i!=="dataSource"&&n[i]&&u.push(n[i]);u.length>0&&r.select(u);this.dataSource().dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||r.from(n.tableName)}else r=n.query;return r},_ensureDataSource:function(n){this.currentSelectedData=n;this._renderTemplate(n);this.element.is("ul")?this.element.html(this._fragment.firstChild.children):this.element.html(this._fragment)},_getTemplateType:function(n,t){for(var i=0,r=n.length;i<r;i++){if(n[i].hasOwnProperty(t.parentId)||n[i].hasOwnProperty(t.hasChild))return 1;if(n[i].hasOwnProperty("child"))return 2}return 1},_groupingObjects:function(n,t){for(var u,r={},f=[],i=0,e=n.length;i<e;i++)u=JSON.stringify(t(n[i])),r[u]=r[u]||[],r[u].push(n[i]);for(i in r)f.push(r[i]);return f},_renderTemplate:function(n){this._onlineData=!1;this._loadOnDemandNodes=!1;var i=this;if(this.dataSource()instanceof t.DataManager)this._dataSource=n;else{this._templateType=this._getTemplateType(n,this.model.fields);switch(this._templateType){case 1:this._dataSource=this._groupingObjects(n,function(n){return[!t.isNullOrUndefined(n)&&[n[i.model.fields.parentId]].toString()]});break;case 2:this._dataSource=n}}this._templateNodeCreation(n,this.model.fields)},_templateNodeCreation:function(i,r){var e,u,f,o;if(this._fragment=document.createDocumentFragment(),e=document.createElement("ul"),this._fragment.appendChild(e),u=this._fragment.firstChild,(this._onlineData||this._loadOnDemandNodes)&&(u.className="e-treeview-ul",u.setAttribute("role","group"),n(u).attr("style","display:none")),this.dataSource()!=null){for(f=0,o=i.length;f<o;f++)t.isNullOrUndefined(i[f])||(t.isNullOrUndefined(i[f][this.model.fields.parentId])||i[f][this.model.fields.parentId]==0||this._loadOnDemandNodes)&&u.appendChild(this._tempalteSub(i[f],i,r));n(u).find(">li:first").addClass("first");n(u).find(">li:last").addClass("last")}},_onlineDataSource:function(n,t,i){this._templateNodeCreation(n,i);var r=this.element.find("li#"+t);r.append(this._fragment);r.children().find("> div:first").addClass("e-icon e-plus");this.model.showCheckbox&&(this.element.find("li").children("div").find("input.nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),this._isCheckedAction());this._preventEditable();this.model.allowEditing&&this._allowEditable();this.model.allowDragAndDrop&&this._addDragableClass();this._onlineData=!1},_tempalteSub:function(i,r,u){var p=document.createDocumentFragment(),f,w,a,o,e,b,s,h,c,v,y,l;if(w=document.createElement("li"),p.appendChild(w),f=p.firstChild,f.id=i[u.id]?i[u.id]:!this.model.template&&!this.model.showCheckbox?i[u.text]:"",this._addFirst?(n(f).addClass("e-item first"),this._addFirst=!1):this._addLast?(n(f).addClass("e-item last"),this._addLast=!1):n(f).addClass("e-item"),f.setAttribute("role","treeitem"),i[u.htmlAttribute]&&this._setAttributes(i[u.htmlAttribute],f),this.model.template||i[u.text]){if(e=document.createElement("a"),i[u.imageUrl]?(o=document.createElement("img"),o.className="e-align",o.src=i[u.imageUrl],i[u.imageAttribute]&&this._setAttributes(i[u.imageAttribute],o),e.appendChild(o)):i[u.spriteCssClass]&&(a=document.createElement("span"),a.className=i[u.spriteCssClass],e.appendChild(a)),this.model.template){if(typeof n.fn.render!="function")throw"Error : JsRender dependecy script missing";e.innerHTML+=this._renderEjTemplate(this.model.template,i)}else e.innerHTML+=i[u.text];i[u.linkAttribute]&&(e.href=i[u.linkAttribute]);i[u.selected]&&(e.className="e-text CanSelect e-active");f.appendChild(e)}if(this._hasExpanded=!1,i[u.expanded]&&(n(f).addClass("expanded"),this._hasExpanded=!0),i[u.isChecked]&&n(f).addClass("ischecked"),!1&&f.appendChild(b),f.setAttribute("aria-selected",!1),f.setAttribute("aria-expanded",!1),this.dataSource()instanceof t.DataManager&&!t.isNullOrUndefined(u.child))u.child.dataSource instanceof t.DataManager&&(this._updateElement(f,!0),this.model.showCheckbox&&(this._checkboxOnTemplate(f.children[0]),this._checkboxChecked&&this.model.autoCheck&&this._currentDataSource&&n(f).addClass("ischecked")),this.model.loadOnDemand?(i[u.hasChild]||i.hasOwnProperty("child"))&&(f.children[0].firstChild.className="e-icon e-plus"):(h=this,c=t.Query(),c=h._columnToSelect(u.child),t.isNullOrUndefined(u.child.parentId)||c.where(u.child.parentId,t.FilterOperators.equal,i[u.id]),queryPromise=u.child.dataSource.executeQuery(c),queryPromise.done(function(n){s=n.result;s&&s.length>0&&(h._onlineData=!0,h._onlineDataSource(s,s[0][u.id],u.child))})));else if(this.dataSource()instanceof t.DataManager)this._updateElement(f,!0),this.model.showCheckbox&&(this._checkboxOnTemplate(f.children[0]),this._checkboxChecked&&this.model.autoCheck&&this._currentDataSource&&n(f).addClass("ischecked"));else if(this.model.loadOnDemand){if(this._updateElement(f,!0),(i[u.hasChild]||i.hasOwnProperty("child"))&&(f.children[0].firstChild.className="e-icon e-plus"),this.model.showCheckbox&&(this._checkboxOnTemplate(f.children[0]),this._checkboxChecked&&this.model.autoCheck&&this._currentDataSource&&n(f).addClass("ischecked")),i[u.expanded]&&this._childNodeCreation(i,f,r,u),this.model.enablePersistence&&(v=this._getCookies("_childNodes"),v))for(y=JSON.parse(v),l=0,objlen=y.length;l<objlen;l++)if(y[l].toString()==i[u.id].toString()){this._childNodeCreation(i,f,r,u);break}}else this._onlineData||(this._updateElement(f,!0),this.model.showCheckbox&&this._checkboxOnTemplate(f.children[0]),this._childNodeCreation(i,f,r,u));return f},_childNodeCreation:function(i,r,u,f){var o,h,c,s,e,l;if(o=this._templateType==2?!t.isNullOrUndefined(i.child)&&i.child.length>0&&i.child:this._getChildNodes(this._dataSource,{id:i[f.id]}),!t.isNullOrUndefined(o)&&o.length>0){for(r.children[0].firstChild.className="e-icon e-plus",h=document.createDocumentFragment(),c=document.createElement("ul"),h.appendChild(c),s=h.firstChild,s.className="e-treeview-ul",s.setAttribute("role","group"),n(s).attr("style","display:none"),e=0,l=o.length;e<l;e++)e==0&&(this._addFirst=!0),e==l-1&&(this._addLast=!0),s.appendChild(this._tempalteSub(o[e],u,f));r.appendChild(c)}},_checkboxOnTemplate:function(n){n.parentElement.id==""&&(n.parentElement.id=this._id+"_"+this._indexID,this._indexID++);var t=document.createElement("input");t.setAttribute("type","checkbox");t.setAttribute("class","nodecheckbox");t.setAttribute("name",this._id+"_Checkbox_"+n.parentElement.id);t.setAttribute("value",n.parentElement.id);n.insertBefore(t,n.children[1])},_updateElement:function(t,i){var f,o,u,e,s=t.firstChild,h,c,l;s&&(h=s.nodeName,h=="SPAN"||h=="IMG"?(e=s,u=t.lastChild):u=t.lastChild,u&&(l=u.lastChild!=null?u.lastChild.nodeValue:"",c=u.innerHTML,textElement=n(u).clone()[0],n(u).remove(),textElement.className=u.className?"e-text CanSelect e-active":"e-text CanSelect",textElement.innerHTML=c,t.innerHTML="",this._on(n(textElement),"mouseenter",this._mouseEnterEvent),this._on(n(textElement),"mouseleave",this._mouseLeaveEvent)),f=document.createElement("div"),f.setAttribute("role","presentation"),i?(o=document.createElement("div"),o.setAttribute("role","presentation"),f.appendChild(o),e&&f.appendChild(e),f.appendChild(textElement)):(e&&f.appendChild(e),f.appendChild(textElement)),n(t).prop("name")==r&&n(t).prop("name",l),t.appendChild(f))},_setAttributes:function(t,i){for(var r in t)n(i).attr(r,t[r])},_addDragableClass:function(){this.model.allowDragAndDrop&&(this._anchors=this._liList.map(function(){return n("a",this)[0]}),this._anchors.addClass("e-draggable e-droppable"),this._enableDragDrop())},_addBaseClass:function(){this._ulList.addClass("e-treeview-ul").attr("role","group");this._liList.addClass("e-item").attr("role","treeitem");this.element.is("ul")||this.element.find("ul:first").removeClass("e-treeview-ul").addClass("e-ul")},_controlRender:function(){var h=this.element,c,e,i,f,v,o,l,s,y,a,u,p;if(h!=null){for(c=h.find("li"),e=0;e<c.length;e++)i=n(c[e]),l=i.children("ul")[0],l&&n(i.children("ul")[0]).remove(),s=i.children("a")[0],s?(o=n(s).text(),f=n(s).clone(),n(s).remove(),n(f).addClass("e-text CanSelect"),i.html("")):(o=this._getText(i),v=i.clone(),i.html(""),f=t.buildTag("a.e-text CanSelect","","",{alt:""}),f.append(v.children()),f[0].innerHTML+=o),y=t.buildTag("div","",{},{role:"presentation"}),a=t.buildTag("div","",{},{role:"presentation"}),n(a).append(y).append(f),i.prepend(a),l&&i.append(l),i.prop("name")==r&&i.prop("name",o),i.attr("id")==r&&i.attr("id",o),this.model.showCheckbox&&this._checkboxOnTemplate(c[e].children[0]);this.model.showCheckbox&&h.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})}u=h.find("li");u.find(">ul").hide();p=u.find("a");p.focus(function(){n(this).blur()});u.filter("li:last-child").addClass("last");n(u[0]).addClass("first");n(u[0]).hasClass("first")&&n(u[0]).hasClass("last")&&n(u[0]).removeClass("first");n(u.filter(":has(ul)")).each(function(){n(this).attr("aria-expanded",!1).attr("aria-selected",!1);var t=n(this).children("ul:first");n(t).is(":hidden")?n(this).find("> div > div:first").removeClass("e-icon e-minus").addClass("e-icon e-plus"):n(this.childNodes[1]).removeClass("e-icon e-plus").addClass("e-icon e-minus")})},_getText:function(t){return n(t).clone().children().remove().end().text()},_finalize:function(){var r,f,i,u,o,e;if(this._isRender=!1,r=this.element,!(this.model.expandedNodes instanceof Array&&this.model.expandedNodes.length>0))for(f=r.find("li.expanded"),i=0;i<f.length;i++)this._expandNode(n(f[i]));for(i=0;i<this.model.expandedNodes.length;i++)!this.model.loadOnDemand||this.dataSource()instanceof t.DataManager?this._expandNode(n(this._liList[this.model.expandedNodes[i]])):this._createChildNodesWhenExpand(n(this._liList[this.model.expandedNodes[i]]));if(this.model.showCheckbox)for(r.find("li").children("div").find("input.nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),u=0;u<this.model.checkedNodes.length;u++)o=this._liList[this.model.checkedNodes[u]],this.dataSource()instanceof t.DataManager||this._nodeCheckedAction(n(o).find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0]);this.model.checkedNodes instanceof Array&&this.model.checkedNodes.length>0||this.model.showCheckbox&&this._isCheckedAction();e=this.model.selectedNode>=0?n(this._liList[this.model.selectedNode]):r.find("li > div > a.e-text.e-active").closest("li.e-item");t.isNullOrUndefined(e)||this._nodeSelectionAction(e.find("> div > a.e-text:first"));this._isRender=!0;this.model.allowEditing&&this._allowEditable();n(this._liList).find("a.e-text").attr("id",this._id+"_active");r.find("li.ischecked, li.expanded").removeClass("ischecked expanded")},_updateSelectedNode:function(){var i=n(this._liList).find("a.e-active").closest("li.e-item"),r;!t.isNullOrUndefined(i)&&i.length>0&&(this.model.selectedNode=n(this._liList).index(i));this.model.selectedNode>=0&&(r=n(this._liList[this.model.selectedNode]),t.isNullOrUndefined(r)||n(r.children().find("a")[0]).removeClass("e-active").addClass("e-active"))},_setCookies:function(n,i){window.localStorage?window.localStorage.setItem(this._id+n,i):document.cookie&&t.cookie.set(this._id+n,i)},_getCookies:function(n){return window.localStorage?window.localStorage.getItem(this._id+n):window.cookie?t.cookie.get(this._id+n):void 0},_updateCheckedNodes:function(){for(var r=[],i=this.element.find("li input.nodecheckbox[type=checkbox].checked"),t=0;t<i.length;t++)r.push(n(this._liList).index(n(i[t]).parents("li:first")[0]));r.length>0&&(this.model.checkedNodes=r)},_updateExpandedNodes:function(){var n,i=[],t,r;for(n=this.element.find("li > div > div.e-minus"),n=n.closest("li.e-item").addClass("e-collapse"),t=0,r=n.length;t<r;t++)i.push(this._liList.index(n[t]));i.length>0&&(this.model.expandedNodes=i);this._removeNullInArray(this.model.expandedNodes)},_isCheckedAction:function(){for(var t=this.element.find("li.ischecked"),i=0;i<t.length;i++)this._nodeCheckedAction(n(t[i]).find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0]);t.removeClass("ischecked")},_checkedChange:function(t){var i=this.element.closest(".e-treeview.e-js").data("ejTreeView");t.isChecked?i._nodeCheckedAction(n(this.element)[0],t):i._nodeUnCheckedAction(n(this.element)[0],t)},_ClickEventHandler:function(i){var s=this,u,r=n(i.target),e,o,f;this._isclicked||(u=r.closest("li.e-item"),u.hasClass("e-node-disable")||(this._isclicked=!0,this._onClick({event:i,currentElement:r[0]}),!t.isNullOrUndefined(r)&&r.is("DIV")&&(r.hasClass("e-plus")||r.hasClass("e-minus"))&&(e=null,r.is("SPAN")&&(r=r.parent("div").find("div:first")),e=u.children("ul:first"),this._isExpanded=e.find("li").length>0?!0:!1,!this._isExpanded&&this.model.loadOnDemand?(r.removeClass("e-plus").addClass("e-load"),this._checkboxChecked=r.parent().find("input[type=checkbox]").hasClass("checked"),f=this._getNodeDetails(u),o={currentElement:u,targetElement:r[0],id:f.nodeId,value:f.nodeText,parentId:f.parentId,isChildLoaded:this._isExpanded,hasParent:!0,async:!0},this._onBeforeExpand(o),this._loadOnDemand(o,r[0])):this._expandCollapseAction(r)),r.is("A")||r.hasClass("input-text")||(r=r.parent()),!t.isNullOrUndefined(r)&&r.is("A")&&r.hasClass("CanSelect")&&!r.hasClass("e-active")&&this._nodeSelectionAction(r)));setTimeout(function(){s._isclicked=!1},300)},_getChildTables:function(n,i,r){return t.isNullOrUndefined(n.child)?this.model.fields:i==r?n.child:this._getChildTables(n.child,i,r+1)},_checkMapperFields:function(n){for(var t in this.model.fields)n[t]||t=="dataSource"||t=="child"||t=="tableName"||t=="query"||(n[t]=this.model.fields[t])},_loadOnDemand:function(n){var r,e,u,i=this,f;this.dataSource()instanceof t.DataManager?(e=n.currentElement.parents("ul").length,u=this._getChildTables(i.model.fields,e,1),f=t.Query(),f=i._columnToSelect(u),t.isNullOrUndefined(u.parentId)||f.where(u.parentId,t.FilterOperators.equal,parseInt(n.currentElement[0].id)),queryPromise=u.dataSource.executeQuery(f),queryPromise.done(function(t){r=t.result;r.length>0&&(i._onlineData=!0,i._currentDataSource=!0,i._loadChildNodeWhenOnDemand(r,n,u))})):(i._currentDataSource=!1,r=this._getChildNodes(this._dataSource,n),!t.isNullOrUndefined(r)&&r.length>0&&setTimeout(function(){i._currentDataSource=!0;i._createSubNodesWhenLoadOnDemand(r,n.targetElement,i.model.fields)},400))},_loadChildNodeWhenOnDemand:function(n,i,r){var u=this;!t.isNullOrUndefined(n)&&n.length>0&&setTimeout(function(){u._createSubNodesWhenLoadOnDemand(n,i.targetElement,r)},100)},_createSubNodesWhenLoadOnDemand:function(t,i,r){this._loadOnDemandNodes=!0;this._templateNodeCreation(t,r);n(this._fragment.firstChild).attr("style","display:none");this._fragment.firstChild.className="e-treeview-ul";this._fragment.firstChild.setAttribute("role","group");i.parentNode.parentNode.appendChild(this._fragment);var u=n(i).closest("li.e-item");u.attr({"aria-expanded":!1,"aria-expanded":!0});n(i).removeClass("e-load").addClass("e-plus");n(i).hasClass("e-plus")&&this._expandCollapseAction(n(i));this._finalizeLoadOnDemand(u)},_finalizeLoadOnDemand:function(n){if(this._beforeBaseClass(),this._isRender=!1,this.model.showCheckbox&&(n.children("ul").find("li > div > input.nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),this._isCheckedAction(),this._updateCheckedNodes()),this._isRender=!0,this._addDragableClass(),this._preventEditable(),this.model.allowEditing&&this._allowEditable(),this._updateSelectedNode(),this._updateExpandedNodes(),this.model.loadOnDemand&&this.model.enablePersistence){var i,r;r=this._getCookies("_childNodes");r&&(i=JSON.parse(r));!t.isNullOrUndefined(i)&&i.indexOf(n[0].id)==-1?i.push(n[0].id):i=[n[0].id];this._setCookies("_childNodes",JSON.stringify(i))}},_getChildNodes:function(n,i){var u=[],r,f;if(this._templateType==1){for(r=0,f=n.length;r<f;r++)if(!t.isNullOrUndefined(n[r][0])&&!t.isNullOrUndefined(n[r][0][this.model.fields.parentId])&&n[r][0][this.model.fields.parentId]==i.id)return n[r]}else{for(r=0,f=n.length;r<f;r++){if(n[r][this.model.fields.id]==i.id)return n[r].child;if(n[r].hasOwnProperty("child")&&(u=this._getChildNodes(n[r].child,i),!t.isNullOrUndefined(u)&&u.length>0))break}return u}},_getPath:function(n){for(var i=n.prop("name"),t=n.parents("li:first");t[0]!=null&&t[0].parentNode.id!=this._id;)i=t.prop("name")+"/"+i,t=t.parents("li:first");return this._id+"/"+i},_nodeSelectionAction:function(n){if(n[0]!=null||n.length!=0){var t,i,r;this.element.find("li > div > a").removeClass("e-node-focus e-active").closest("li").find("[aria-selected=true]").attr("aria-selected",!1);t=n.addClass("e-active").attr("id",this._id+"_active").closest("li.e-item").attr("aria-selected",!0);this.model.selectedNode=this._liList.index(t[0]);i=this._getNodeDetails(t);r={currentElement:t,value:i.nodeText,id:i.nodeId,parentId:i.parentId};this._onNodeSelect(r);this.element.focus()}},_nodeUnSelectionAction:function(n){(n[0]!=null||n.length!=0)&&(n.removeClass("e-active").closest("li.e-item").attr("aria-selected",!1),this.model.selectedNode=-1)},_nodeEnableAction:function(n){if(n[0]!=null||n.length!=0){var t=n.closest("li.e-item");this.model.showCheckbox&&t.find("div > .e-chkbox-wrap > .nodecheckbox[type=checkbox]").ejCheckBox("enable").prop("disabled",!1);t.find(".e-text").removeClass("e-node-disable").closest(".e-item").removeClass("e-node-disable").prop("disabled",!0)}},_nodeDisableAction:function(t){if(t[0]!=null||t.length!=0){var i=t.closest("li.e-item");this._collpaseNode(i);this.model.showCheckbox&&i.find("div > .e-chkbox-wrap > .nodecheckbox[type=checkbox]").ejCheckBox("disable").prop("disabled",!0);i.addClass("e-node-disable").prop("disabled",!0).find("li.e-item, a").addClass("e-node-disable").removeClass("e-active");n(this._liList).index(i)==this.model.selectedNode&&(this.model.selectedNode=-1)}},_getNodeDetails:function(n){if(n[0]!=null&&n.length>0){var t,i;return t=n.attr("id"),i=n.children("div").find("a.e-text:first").text(),pid=n.closest("ul").closest("li").attr("id"),{nodeId:t,nodeText:i,parentId:pid?pid:""}}return{nodeId:"",nodeText:"",parentId:""}},_expandCollapseAction:function(t){if(t&&!this._animating){var f,r=this,i,e,u;if(i=t.closest("li"),t.is("SPAN")&&(t=n(t).parent("div").find("div:first")),f=i.children("ul:first"),f.find("> li").length>0)if(this._animating=this.model.enableAnimation?!0:!1,e=this._getNodeDetails(i),u={currentElement:i,value:e.nodeText,isChildLoaded:this._isExpanded,id:e.nodeId,parentId:e.parentId},this._isNodeExpanded(i)){if(i.attr("aria-expanded",!1).attr("tabindex",-1),this._onBeforeCollapse(u)===!0)return!1;f.animate({height:"toggle"},this.model.enableAnimation?200:0,"linear",function(){r._animating=!1;r._onNodeCollapse(u);r._removeExpandedNodes(r._liList.index(u.currentElement))});n(t).removeClass("e-icon e-minus").addClass("e-icon e-plus");i.removeClass("e-collapse")}else i.attr("aria-expanded",!0).attr("tabindex",0),this.model.loadOnDemand?this._isExpanded?this._onBeforeExpand(u)?!0:!1:!1:this._onBeforeExpand(u)?!0:!1,f.animate({height:"toggle"},this.model.enableAnimation?350:0,"linear",function(){r._animating=!1;r._onNodeExpand(u);r._addExpandedNodes(r._liList.index(i))}),n(t).removeClass("e-icon e-plus").addClass("e-icon e-minus"),i.addClass("e-collapse")}},_isChecked:function(n){return n.attr("aria-checked")==="true"?!0:!1},_doRecursiveCheck:function(t,i){var o,r,f,t,u,e;u=t.children[1];o=u?u.querySelectorAll('.e-chkbox-wrap[aria-checked="true"]').length:0;allChkEle=u?u.querySelectorAll("li > div > span > input.nodecheckbox[type=checkbox]"):[];r=t.firstChild.querySelector("input.nodecheckbox");r&&r.nodeName.toUpperCase()=="INPUT"&&(e=n(r).data("ejCheckBox"),o==allChkEle.length||this.model.autoCheckParentNode?(e.setModel({enableTriState:!1,checked:!0}),r.className+=" checked",f=t.firstChild.getElementsByTagName("a")[0].innerHTML,i.push({nodeId:t.id,nodeText:f}),this._addHiddenInputElement(r,f),this._addCheckNodes(this._liList.index(t))):e.setModel({enableTriState:!0,checkState:"indeterminate"}),t=t.parentNode.parentNode,t.nodeName.toUpperCase()=="LI"&&this._doRecursiveCheck(t,i))},_nodeCheckedAction:function(t,i){var e,h,r,u,a,c,o,f,s,l;if(this._CurrenctSelectedNodes=[],e=[],t.className+=" checked",h=n(t).data("ejCheckBox"),h){if(h.setModel({enableTriState:!1,checked:!0}),r=t.parentNode.parentNode.parentNode,u=r.firstChild.getElementsByTagName("a")[0].innerHTML,e.push({nodeId:r.id,nodeText:u}),this._addHiddenInputElement(t,u),this._addCheckNodes(this._liList.index(r)),this.model.autoCheck){for(l=r.children[1],o=l?l.querySelectorAll("li > div > span > input.nodecheckbox[type=checkbox]"):[],f=0,a=o.length;f<a;f++)n(o[f]).ejCheckBox({checked:!0,enableTriState:!1})[0].className+=" checked",s=o[f].parentNode.parentNode.parentNode,u=s.firstChild.getElementsByTagName("a")[0].innerHTML,e.push({nodeId:s.id,nodeText:u}),this._addHiddenInputElement(o[f],u),this._addCheckNodes(this._liList.index(s));c=r.parentNode.parentNode;c.nodeName.toUpperCase()=="LI"&&this._doRecursiveCheck(c,e)}i&&(i.checknode=e);this._onChecked(n(t),i)}},_addHiddenInputElement:function(n,t){if(n.firstChild==null){var i=document.createElement("input");i.setAttribute("type","hidden");i.setAttribute("name",this._id+"_Checkbox_"+n.value+".Text");i.setAttribute("value",t);try{n.appendChild(i)}catch(r){}}},_doRecursiveUncheck:function(t,i){var f,r,o,t,e,u;e=t.children[1];f=e?e.querySelectorAll('.e-chkbox-wrap[aria-checked="true"]').length:0;allChkEle=e?e.querySelectorAll("li > div > span > input.nodecheckbox[type=checkbox]"):[];r=t.firstChild.querySelector("input.nodecheckbox");r&&r.nodeName.toUpperCase()=="INPUT"&&(u=n(r).data("ejCheckBox"),f<=0&&(u.setModel({enableTriState:!1,checked:!1}),n(r).removeClass("checked").removeClass("checked").children().remove(),o=t.firstChild.getElementsByTagName("a")[0].innerHTML,this._removeCheckNodes(this._liList.index(t)),i.push({nodeId:t.id,nodeText:o})),f>1&&this.model.autoCheckParentNode?(u.setModel({checked:!0}),r.className+=" checked",o=t.firstChild.getElementsByTagName("a")[0].innerHTML,this._addHiddenInputElement(t,o)):f==1&&this.model.autoCheckParentNode?(u.setModel({checked:!1}),n(r).removeClass("checked").removeClass("checked").children().remove(),this._removeCheckNodes(this._liList.index(t))):f>0&&(allChkEle.length>1?u.setModel({enableTriState:!0,checkState:"indeterminate"}):u.setModel({checked:!1}),n(r).removeClass("checked").removeClass("checked").children().remove(),this._removeCheckNodes(this._liList.index(t))),t=t.parentNode.parentNode,t.nodeName.toUpperCase()=="LI"&&this._doRecursiveUncheck(t,i))},_nodeUnCheckedAction:function(t,r){var f=this,u=[];if(currentLi=t.parentNode.parentNode.parentNode,n(currentLi).find("div > span > input.nodecheckbox").removeClass("checked").children().remove(),chkObj=n(t).data("ejCheckBox"),this._removeCheckNodes(this._liList.index(currentLi)),chkObj){if(chkObj.setModel({enableTriState:!1,checked:!1}),textvalue=currentLi.firstChild.getElementsByTagName("a")[0].innerHTML,u.push({nodeId:currentLi.id,nodeText:textvalue}),this.model.autoCheck){for(childUl=currentLi.children[1],allChkEle=childUl?childUl.querySelectorAll("li > div > span > input.nodecheckbox[type=checkbox]"):[],i=0,chklen=allChkEle.length;i<chklen;i++)n(allChkEle[i]).ejCheckBox({enableTriState:!1,checked:!1}),liElement=allChkEle[i].parentNode.parentNode.parentNode,textvalue=liElement.firstChild.getElementsByTagName("a")[0].innerHTML,u.push({nodeId:liElement.id,nodeText:textvalue}),this._removeCheckNodes(this._liList.index(liElement));parentLi=currentLi.parentNode.parentNode;parentLi.nodeName.toUpperCase()=="LI"&&this._doRecursiveUncheck(parentLi,u)}r&&(r.unchecknode=u);this._onUnChecked(n(t),r)}},_createChildNodesWhenExpand:function(n){var o,s,f,h,c,u,i,e,r;n.length>0&&n.find("ul li").length==0?(o=n.attr("id"),s=n.children("div").find("a.e-text:first").text(),h=n.children("div").find("div.e-plus:first"),f={currentElement:n,targetElement:h[0],id:o,value:s,isChildLoaded:!1,hasParent:!0,async:!1},i=this,this._onBeforeExpand(f),this.dataSource()instanceof t.DataManager?(c=f.currentElement.parents("ul").length,u=this._getChildTables(this.model.fields,c,1),e=t.Query(),e=i._columnToSelect(u),e.where(u.parentId,t.FilterOperators.equal,parseInt(f.currentElement[0].id)),queryPromise=u.dataSource.executeQuery(e),queryPromise.done(function(f){r=f.result;!t.isNullOrUndefined(r)&&r.length>0&&(i._checkboxChecked=n.find("> div > span > input[type=checkbox]").hasClass("checked"),i._currentDataSource=!0,i._loadOnDemandNodes=!0,n.find("ul li").length==0&&(i._templateNodeCreation(r,u),n.append(i._fragment)),i._finalizeLoadOnDemand(n),i._expandNode(n))})):(r=this._getChildNodes(this._dataSource,{id:n[0].id}),!t.isNullOrUndefined(r)&&r.length>0&&(this._checkboxChecked=n.find("> div > span > input[type=checkbox]").hasClass("checked"),this._currentDataSource=!0,this._loadOnDemandNodes=!0,this._templateNodeCreation(r,this.model.fields),n.append(this._fragment),this._finalizeLoadOnDemand(n),this._expandNode(n)))):this._expandNode(n)},_expandNode:function(n){var t,i;return n[0]!=null&&n.length>0&&(this.model.loadOnDemand&&!this.model.enablePersistence?n.find("> ul > li.e-item").length>0&&(this._animating=!1,this._expandCollapseAction(n.find("> div > div.e-plus:first"))):(t=n.find("> div > div:first"),t.hasClass("e-plus")&&(i=n.find("> ul > li.e-item").length>0?!0:!1,i&&(this._animating=!1,this._expandCollapseAction(t))))),!0},_collpaseNode:function(n){if(n[0]!=null&&n.length>0&&n.find("> ul > li").length>0){var t=n.find("> div > div:first");t.hasClass("e-minus")&&this._expandCollapseAction(t)}},_expandAll:function(){var i=this.element,t,r;if(this.model.loadOnDemand)for(r=n(i).find("li"),t=0,len=r.length;t<len;t++)this._createChildNodesWhenExpand(n(r[t]));else if(expandCollapseIcon=i.find("li > div > div.e-plus"),i.find("ul:hidden").length==expandCollapseIcon.length)for(t=0,len=expandCollapseIcon.length;t<len;t++)this._animating=!1,this._expandCollapseAction(n(expandCollapseIcon[t]))},_collapseAll:function(){var r=this.element,t,i;if(i=r.find("li > ul:not(:hidden)").closest("li"),expandCollapseIcon=i.find("> div > div.e-minus"),expandCollapseIcon.length>0)for(t=0,len=expandCollapseIcon.length;t<len;t++)this._animating=!1,this._expandCollapseAction(n(expandCollapseIcon[t]))},_checkAll:function(){this._CurrenctSelectedNodes=[];var r=this.element,t;for(t=r.find("li > div > span > input.nodecheckbox"),t.addClass("checked"),i=0,len=t.length;i<len;i++)t[i].disabled?n(t[i]).ejCheckBox("setModel",{checked:!1}):(n(t[i]).ejCheckBox("setModel",{checked:!0}),this._addHiddenInputElement(t[i],n(t[i]).parent().siblings("a.e-text").text()),this._onChecked(n(t[i])))},_unCheckAll:function(){var r=this.element,t;for(t=r.find("li > div > span > input.nodecheckbox"),t.removeClass("checked").children().remove(),i=0,len=t.length;i<len;i++)n(t[i]).ejCheckBox("setModel",{checked:!1})},_isNodeExpanded:function(n){if(n[0]!=null)return n.children("ul:first").length>0&&n.find("> div > div.e-minus").length>0},_showCheckBox:function(){for(var t=this.element,i=t.find("li"),n=0;n<i.length;n++)this._checkboxOnTemplate(i[n].children[0]);t.find("li > div > input.nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});t.find("li.e-node-disable > div > span > input.nodecheckbox").ejCheckBox("disable")},_drag:function(){var i,u=!1,o=t.browserInfo(),r=null,s=null,f=null,e;e=o.name=="msie"&&o.version=="8.0"?!0:!1;this.element.is("ul")?(this._treeView=this.element.parent(),this.model.allowDragAndDropAcrossControl||(f=this.element.parent())):(this._treeView=this.element,this.model.allowDragAndDropAcrossControl||(f=this.element));n(this._treeView).find("ul li div a").not(".e-js").ejDraggable({dragArea:f,clone:!0,dragStart:function(u){if(t.isNullOrUndefined(u.target)||n(u.target).hasClass("e-node-disable")||n(u.target).closest(".e-text").find(".input-text").length!=0||n(u.target).is("A")&&!n(u.target).hasClass("e-draggable"))return!1;e&&(document.ondragstart=function(){return!1});var f={dragElement:i._getNodeDetails(n(u.target).closest("li.e-item")),target:u.target,event:u.event};if(i._onDragStarts(f))return u.cancel=!0,r&&r.remove(),!1},drag:function(f){var e,s,o,h;return u=!1,n(".e-sibling").remove(),e=f.target,n(r).css({"margin-left":"20px","margin-top":f.event.clientY-20<0?"0px":"-20px"}),s={dragElement:i._getNodeDetails(n(f.element).closest("li.e-item")),target:e,event:f.event},(n(e).hasClass("e-droppable")||n(e).parent().hasClass("e-droppable"))&&n(e).hasClass("e-dropchild")?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"),n(e).addClass("allowDrop")):!n(e).hasClass("e-droppable")||n(e).hasClass("e-item")||n(e).hasClass("e-text")?(n(e).hasClass("e-sibling")||n(e).find("a").hasClass("e-text"))&&(n(e).hasClass("e-sibling")||n(e).parent().parent().hasClass("e-item")||n(e).parent().hasClass("e-item")||n(e).hasClass("e-item")||n(e).hasClass("e-text"))||(document.body.style.cursor="not-allowed",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-minus"),n(e).removeClass("showline-hover"),n(e).removeClass("noline-hover")):(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus")),e.nodeName!="A"?(e.nodeName=="UL"&&n(e).children()[0]!=null&&(e=n(e).children()[0],u=!0),e.nodeName!="LI"&&(e=n(e).closest(".e-droppable")[0]||n(e).parent()),e.nodeName=="LI"&&n(e).hasClass("e-droppable")&&n(e).hasClass("e-dropsibling")?(o=t.buildTag("div.e-sibling"),h=n(".e-treeview").has(e).offset().top+n(e).children().find("a")[0].offsetTop||-1,u||(u=f.event.pageY>h?!1:!0),u?n(e).find("> div > a").prepend(o):n(e).find("> div > a").append(o),n(e).parents().hasClass("e-rtl")?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-insertInbetween-rtl")):(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-insertInbetween"))):e.nodeName=="A"&&n(e)&&n(e).hasClass("e-droppable")&&n(e).hasClass("e-dropchild")?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"),n(e).addClass("allowDrop")):!n(e).hasClass("e-droppable")||n(e).hasClass("e-item")||n(e).hasClass("e-text")||(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"))):n(".e-sibling").remove(),i._onDrag(s)?!1:void 0},dragStop:function(t){var f,s,o,h;if((e&&(document.ondragstart=function(){return!0}),t.element.dropped||(r&&r.remove(),document.body.style.cursor=""),f=t.target,f.className=="e-sibling"&&(f=n(f).closest(".e-item")[0]),s=i,n(".e-sibling").remove(),o=u?"Before":"After",o=f.nodeName=="A"?"Over":o,h={dragElement:i._getNodeDetails(t.element.closest("li.e-item")),targetElement:i._getNodeDetails(n(t.target).closest("li.e-item")),target:f,position:o,event:t.event},i._onDragStop(h))||(n(t.element).removeClass("e-active"),f.nodeName=="A"&&n(f).hasClass("e-dropchild")&&n(f).hasClass("e-droppable")||f.nodeName=="UL"&&n(f).children().length==0?(o="Over",n(t.element).parent().parent().has(n(f)).length==0&&(n(f).parent().parent().has(n(t.element)).length==0||i._isDescendant(n(f).parents("li:last").find(">ul>li"),n(t.element).parents("li:first")[0]))&&(i._dropAsChildNode(n(f),n(t.element),t.event),s._applyFirstLastChildClass())):(f.nodeName=="UL"&&(f=n(f).children()[0]),f.nodeName!="LI"&&(f=n(f).closest(".e-droppable")[0]||n(f).parent()),f.nodeName=="LI"&&n(f).hasClass("e-dropsibling")&&n(f).hasClass("e-droppable")?n(t.element).parent().parent().has(n(f)).length<1&&(i._dropAsSublingNode(n(f),n(t.element),u,t.event),s._applyFirstLastChildClass()):f.nodeName=="A"&&n(f).hasClass("e-dropchild")&&n(f).hasClass("e-droppable")&&(o="Over",n(t.element).parent().parent().has(n(f)).length==0&&(n(f).parent().parent().has(n(t.element)).length==0||i._isDescendant(n(f).parents("li:last").find(">ul>li"),n(t.element).parents("li:first")[0]))&&(i._dropAsChildNode(n(f),n(t.element),t.event),s._applyFirstLastChildClass()))),n(".allowDrop").removeClass("allowDrop"),n(f).hasClass("e-dropchild")||r&&r.remove(),h={targetElement:i._getNodeDetails(n(t.target).closest("li.e-item")),dragElement:i._getNodeDetails(n(t.element).closest("li.e-item")),dropPosition:o,dropedElement:n(t.element).closest(".e-item"),dropTarget:n(f),target:n(f).parents(".e-item:first").length>0?n(f).parents(".e-item:first"):n(f).parents("ul"),event:t.event},i._onDropped(h)))return!1;document.body.style.cursor=""},helper:function(u){if(!t.isNullOrUndefined(u.element)&&!n(u.element).hasClass("e-node-disable")&&n(u.element).hasClass("e-draggable")&&(i=n(u.element).closest(".e-treeview.e-js").data("ejTreeView"),i))return r=t.buildTag("div.e-dragedNode"),r.addClass(i.model.cssClass),s=n(u.element).clone().addClass("dragClone"),this.spanEle=t.buildTag("span.e-icon e-plus e-dropedStatus"),r.append(this.spanEle),r.append(s),r.appendTo(n("body"))}})},_isDescendant:function(t,i){var r=!0;return n(t).each(function(n,t){if(t==i)return r=!1,!1;r=!0}),r},_childDrop:function(){n(this._treeView).find("ul li div a").ejDroppable({accept:n(this._treeView).find("ul li div a").addClass("e-dropchild"),drop:function(t,i){n(i.helper).hide()}})},_siblingDrop:function(){n(this._treeView).find("ul li").addClass("e-dropsibling").ejDroppable({drop:function(t,i){n(i.helper).hide()}})},_dropAsSublingNode:function(i,r,u,f){var e=f.ctrlKey?r.parent().parent().clone():r.parent().parent(),o=r.parents(".e-item")[1],h=n(o),s;t.isNullOrUndefined(this.model.fields)||this.dataSource()==null||this.dataSource()instanceof t.DataManager||this._updateDataSource(r.parents(".e-item:first"),n(i),u);u?n(e).insertBefore(i):n(e).insertAfter(i);this.model.template||this._autoGenerateNodes(r.parents(".e-item:first"));this._modifiCss(o);this._finalizeEditing(e);s=n(o).children("ul").find(".e-item > div > span > input.checked");s.length>0&&(h=s.closest(".e-item:first"));this._updateCheckState(h);this._updateCheckState(n(e));this._updateChanges(n(i))},_dropAsChildNode:function(i,r){var u=r.parent().parent(),f=r.parents(".e-item")[1],o=n(f),e;t.isNullOrUndefined(this.model.fields)||this.dataSource()==null||this.dataSource()instanceof t.DataManager||this._updateDataSource(r.parents(".e-item:first"),n(i),"");n(i).is("UL")?n(i).append(u):this._appendNode(i,u);this.model.template||this._autoGenerateNodes(r.parents(".e-item:first"));this._modifiCss(f);this._finalizeEditing(u);e=n(f).children("ul").find(".e-item > div > span > input.checked");e.length>0&&(o=e.closest(".e-item:first"));!n(f).find("li").filter(u).length>0&&this._updateCheckState(o);this._updateCheckState(r.parents(".e-item:first"));this._updateChanges(n(i));i.parent().children(".e-icon.e-plus:first").length>0&&this._expandNode(i.parents(".e-item:first"))},_updateChanges:function(t){if(n(t)[0]!=null){var i=this,r=0;do i._beforeBaseClass(),i._updateExpandedNodes(),i._updateCheckedNodes(),i._applyFirstLastChildClass(),r++,i=t.closest(".e-treeview.e-js").data("ejTreeView");while(i&&this._id!=i._id&&r==1)}},_orderDataSource:function(){var f,r,u,e,i,o;for(this._beforeBaseClass(),f=[],r=this._newDataSource,u=0,e=this._liList.length;u<e;u++)for(i=0,o=r.length;i<o;i++)if(!t.isNullOrUndefined(r[i])&&!t.isNullOrUndefined(r[i][this.model.fields.id])&&r[i][this.model.fields.id].toString()==n(this._liList[u]).attr("id")){n(this._liList[u]).find("> ul li").length==0?delete r[i][this.model.fields.hasChild]:this._templateType==1&&(r[i][this.model.fields.hasChild]=!0);f.push(r[i]);break}return f},_updateDataSource:function(t,i,r){var e,o,s,u,h,f,c;n(t)[0]!=null&&n(i)[0]!=null&&(e=t.closest(".e-treeview.e-js").data("ejTreeView"),o=i.closest(".e-treeview.e-js").data("ejTreeView"),i.is("A")?(s=i.closest("li.e-item").attr("id"),h=i.closest("li.e-item").find("> ul > li"),u=h.length>0?h.length:i.closest("li.e-item").index()):(s=i.parents("li:first").attr("id"),f=i.next("li"),c=i.prev("li"),u=f.length>0?u=c.length>0?f.index()-1:r?i.index():f.index():r?i.index():i.index()+1),o&&e._findAndUpdate(t.attr("id"),s,e._newDataSource,u,o))},_removeObject:function(n,i,r){for(var u=0,f=n.length;u<f;u++)if(!t.isNullOrUndefined(n[u])&&!t.isNullOrUndefined(n[u][r])&&n[u][r].toString()==i){n.splice(u,1);break}},_convertDataSourceTypes:function(n,t){for(var i=0;i<n.child.length;i++)n.child[i][this.model.fields.parentId]=n[this.model.fields.id],t.push(n.child[i]),n.child[i].hasOwnProperty("child")&&n.child[i].child.length>0&&this._convertDataSourceTypes(n.child[i],t);return n.child&&(delete n.child,n[this.model.fields.hasChild]=!0),t},_childObjectCollection:function(n,t,i){for(var u,r=0,f=n.length;r<f;r++)u=this._getChildNodes(t,{id:n[r][this.model.fields.id]}),u&&(i=i.concat(u),i=this._childObjectCollection(u,t,i));return i},_findAndUpdate:function(n,i,r,u,f){var o,y,v,h,a,s,c,e,l;if(this._templateType==1){for(s=0,c=r.length;s<c;s++)if(!t.isNullOrUndefined(r[s])&&!t.isNullOrUndefined(r[s][this.model.fields.id])&&r[s][this.model.fields.id].toString()==n){if(this._id==f._id)r[s][this.model.fields.parentId]=i;else if(y=this,l=[],v=this._groupingObjects(r,function(n){return[!t.isNullOrUndefined(n)&&[n[y.model.fields.parentId]].toString()]}),e=r.splice(s,1),o=this._getChildNodes(v,{id:n}),o&&o.length>0&&(o=this._childObjectCollection(o,v,o)),f._templateType==2){if(o&&o.length>0){for(h=0,a=o.length;h<a;h++)this._removeObject(r,n,this.model.fields.parentId),delete o[h][f.model.fields.parentId],delete o[h][f.model.fields.hasChild];e[0].hasOwnProperty("child")||(e[0].child=[]);e[0].child=o}delete e[0][f.model.fields.parentId];delete e[0][f.model.fields.hasChild];i?this._changeObjectPos(i,e,f._newDataSource,u):f._newDataSource.splice(u,0,e[0])}else{if(o&&o.length>0)for(h=0,a=o.length;h<a;h++)this._removeObject(r,n,this.model.fields.parentId);i?e[0][f.model.fields.parentId]=i:delete e[0][f.model.fields.parentId];f._newDataSource.push(e[0]);o&&o.length>0&&(f._newDataSource=f._newDataSource.concat(o))}break}}else for(s=0,c=r.length;s<c;s++){if(r[s][this.model.fields.id].toString()==n)return e=r.splice(s,1),this._id==f._id?i?this._changeObjectPos(i,e,this._newDataSource,u):this._newDataSource.splice(u,0,e[0]):f._templateType==1?(l=[],e[0].hasOwnProperty("child")?(f._convertDataSourceTypes(e[0],l),e[0]=e.concat(l)):e[0]=e.concat(),i?e[0][0][f.model.fields.parentId]=i:delete e[0][0][f.model.fields.parentId],f._newDataSource=f._newDataSource.concat(e[0])):i?this._changeObjectPos(i,e,f._newDataSource,u):f._newDataSource.splice(u,0,e[0]),!0;if(r[s].hasOwnProperty("child")&&this._findAndUpdate(n,i,r[s].child,u,f))break}},_changeObjectPos:function(n,t,i,r){for(var u=0,f=i.length;u<f;u++){if(i[u][this.model.fields.id].toString()==n)return i[u].hasOwnProperty("child")?i[u].child.splice(r,0,t[0]):(i[u].child=[],i[u].child.push(t[0])),!0;if(i[u].hasOwnProperty("child")&&this._changeObjectPos(n,t,i[u].child,r))break}},_finalizeEditing:function(t){if(n(t)[0]!=null){var i=t.closest(".e-treeview.e-js").data("ejTreeView");i&&(i._preventEditable(),i.model.allowEditing&&i._allowEditable())}},_updateCheckState:function(t){if(n(t)[0]!=null){var i=t.closest(".e-treeview.e-js").data("ejTreeView");i&&i.model.showCheckbox&&(i.isNodeChecked(t)?i._nodeCheckedAction(t.find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0]):i._nodeUnCheckedAction(t.find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0]))}},_autoGenerateNodes:function(t){var i,u,r,f;if(n(t)[0]!=null)if(i=t.closest(".e-treeview.e-js").data("ejTreeView"),i&&i.model.showCheckbox){if(t.find(".e-chkbox-wrap").length==0){for(this._checkboxOnTemplate(t[0].children[0]),u=t.find("li"),r=0,f=u.length;r<f;r++)this._checkboxOnTemplate(u[r].children[0]);t.find(".nodecheckbox").ejCheckBox({cssClass:i.model.cssClass,change:i._checkedChange})}}else t.find("span.e-chkbox-wrap").remove()},_appendNode:function(i,r){var u,f,h,e,o,s;for(i.length!=0?(u=n(i).closest("li.e-item"),this._showline&&(n(u.find("li")).hasClass("last")&&n(u.find("li")).removeClass("last"),n(r).addClass("last")),u.find("ul")[0]==null?(f=u.closest(".e-treeview.e-js").data("ejTreeView"),f&&(f._isExpanded=this._isNodeExpanded(n(i).parents("li:first")),f._isExpanded||!f.model.loadOnDemand||this.dataSource()instanceof t.DataManager||!n(i).parents("li:first").find("> div > div").first().hasClass("e-plus")||f._createChildNodesWhenExpand(u)),e=t.buildTag("ul.e-treeview-ul","",{},{role:"group",style:"display:none"}),n(e).append(n(r)),n(u.find("div")[1]).length==0?(h=document.createElement("div"),h.setAttribute("role","presentation"),h.className="e-icon e-minus",n(u.find("div")).append(n(h))):n(u.find("div")[1]).hasClass("e-minus")||n(u.find("div")[1]).addClass("e-icon e-plus"),f&&f.model.loadOnDemand&&!(this.dataSource()instanceof t.DataManager)&&n(i).parents("li:first").find("ul").length>0?n(i).parents("li:first").children("ul").append(n(r)):u.append(n(e))):n(u.find("ul")[0]).append(r),this._expandNode(u)):this.element.is("UL")?this.element.append(r):this.element.children("ul:first").length>0?this.element.children("ul:first").append(r):(e=t.buildTag("ul.e-treeview-ul","",{},{role:"group"}),e.append(r),this.element.append(e)),o=this.element.find("li.expanded"),s=0;s<o.length;s++)!this.model.loadOnDemand||this.dataSource()instanceof t.DataManager?this._expandNode(n(o[s])):this._createChildNodesWhenExpand(n(o[s]));o.removeClass("expanded");this.model.showCheckbox&&this._isCheckedAction()},_modifiCss:function(t){n(t).find("li").length==0&&(n(t).find("ul").remove(),n(t).removeClass("e-collapse"),n(t).find("div.e-icon").removeClass("e-icon e-minus"));n(t)[0]!=null&&n(t).length>0&&(n(t).find("ul > li:first-child").addClass("first"),n(t).find("ul > li:last-child").addClass("last").removeClass("first"))},_applyFirstLastChildClass:function(){var i=this.element,t=i.find("li");t.removeClass("first");t.removeClass("last");t.filter("li:last-child").addClass("last");n(t[0]).addClass("first");n(t[0]).hasClass("first")&&n(t[0]).hasClass("last")&&n(t[0]).removeClass("first")},_expandEventHandler:function(t){var i=n(t.target),r,u;i.hasClass("e-icon")||t.type==="dblclick"&&this.model.allowEditing||(t.preventDefault(),r=i.is("A")?n(i.siblings("div")):n(i.parent().siblings("div")),u=i.closest(".e-item"),r.hasClass("e-minus")?this._collpaseNode(u):this.model.loadOnDemand&&r.find(".e-item").length==0?(this._isclicked=!1,this._ClickEventHandler({target:r[0]})):this._expandNode(u))},_inlineEdit:function(t){t.preventDefault();var i=n(t.target);return i.hasClass("input-text")||i.hasClass("e-node-disable")||!i.closest("li.e-item").hasClass("AllowEdit")||(i.is("A")||(i=i.closest(".e-text")),i.is("A")&&!i.hasClass("e-node-disable")&&i.closest("li.e-item").hasClass("AllowEdit")&&(i.removeClass("e-active"),this._inlineEditAction(i))),!1},_inlineEditAction:function(t){var i=this.element.find("li > div > #Edit_Input");i[0]==null?this._createEditTextBox(t):(i=this.element.find("li > div > #Edit_Input"),n(i.parentNode).html(i.value),n(i).remove(),this._createEditTextBox(t))},_createEditTextBox:function(i){var e={currentElement:i},r,u,f;return this._trigger("beforeEdit",e)?!1:(r=this.element.find("li > div > #Edit_Input"),r[0]==null&&(u=t.buildTag("Input.input-text#Edit_Input","","",{type:"text",value:n.trim(i.text()).replace(/\n\s+/g," "),name:"inplace_value"}),u.width(i.outerWidth()+5),u.height(i.outerHeight()-2),this.beforeEditText=i.text(),i[0].lastChild.nodeValue="",this.element.find(".e-active").removeClass("e-active"),i.addClass("e-editable").append(u),f=0,r=u,f=r.val().length==""?3:i.outerWidth()+20,this._mousePositionAtEnd(r),this._currentEditableNode=i,this._on(r,"keypress",this._editTextBoxKeyPress),this._on(r,"keydown",this,this._pressEscKey),this._on(r,"blur",this._focusout)),r)},_editTextBoxKeyPress:function(n){n.target.size=n.target.value.length+1},_mousePositionAtEnd:function(n){return n.focus&&n.focus(),n.select&&n.select(),!0},_focusout:function(t){var i=n(t.currentTarget),r,u;r={nodeId:i.closest("li.e-item").attr("id"),oldText:this.beforeEditText,newText:i.val()};u=i.closest(".e-text");this._nodeSelectionAction(u);this._trigger("inlineEditValidation",r)==!0?this._cancelAction(i):this._saveAction(i)},_pressEscKey:function(i){var r,u,f;i.cancelBubble=!0;i.returnValue=!1;r=n(i.currentTarget);r[0]!=null&&(i.keyCode==13&&(i.stopPropagation(),this._focusout(i)),i.keyCode==27&&this._cancelAction(r),(i.keyCode==13||i.keyCode==27)&&(u=t.browserInfo(),f=u.name=="msie"&&u.version=="8.0"?!0:!1,f&&this.element.focus()))},_onFocusHandler:function(t){this.model.allowKeyboardNavigation&&this._isFocus&&(this.element.find(".e-active").length==0&&(this.element.find(".e-active").removeClass("e-active").closest("li.e-item").attr("aria-selected",!1),nextElement=this.element.find("li:first > div > a:first"),n(nextElement).addClass("e-active"),this._updateSelectedNode()),t.preventDefault(),this._isFocus=!1)},_onKeyDown:function(n,t){n.find("> div > a.e-text").removeClass("e-node-focus");t.find("> div > a.e-text").addClass("e-node-focus")},_KeyPress:function(t){var e,u=this,h,i,r,f,l,y,a,v,p,b,w,o,s,k,c;if(this._isFocus=!0,c=this.element.is("ul")?this.element:this.element.find("> ul"),e=t.keyCode?t.keyCode:t.which?t.which:t.charCode,e==113&&(t.preventDefault(),this._isFocus=!1,h=c.find("li > div > a.e-active"),h.length>0&&!h.hasClass("e-node-disable")&&h.hasClass("e-text")&&h.closest("li.e-item").hasClass("AllowEdit")&&(h.removeClass("e-active"),this._createEditTextBox(h))),u.model.allowKeyboardNavigation&&u.element.find("#Edit_Input").length<1)if(i=c.find("li > div > a.e-active").closest("li.e-item"),r=c.find('li.e-item:not([class*="e-node-disable"])').not(":hidden"),f=n(r).find("a.e-node-focus").closest("li"),e!=40||t.ctrlKey||t.altKey||t.shiftKey)if(e!=38||t.ctrlKey||t.altKey||t.shiftKey)if(e!=39||t.ctrlKey||t.altKey||t.shiftKey)if(e!=37||t.ctrlKey||t.altKey||t.shiftKey){if(e!=36||t.ctrlKey||t.altKey||t.shiftKey){if(e!=35||t.ctrlKey||t.altKey||t.shiftKey){if(e==13)b=f.length>0?f:i,b.find("> div > a.e-text").removeClass("e-node-focus"),this._nodeSelectionAction(b.find("> div > a.e-text").first());else if(e==32)i.length>0&&this.model.showCheckbox&&(t.preventDefault(),w=i.find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0],w.checked?this._nodeUnCheckedAction(w):this._nodeCheckedAction(w));else if(e==46){if(i.length>0){if(t.preventDefault(),u._KeyPressEventHandler(i,u,e,t))return;this._removeNode(i.find("> div > a.e-text").first())}}else if(t&&t.ctrlKey==!0)if(e==88&&this.model.allowDragAndDrop&&this.model.allowDropChild){if(i.length>0){if(this._cutCopyNodeText=n(r[r.index(i)]),u._KeyPressEventHandler(i,u,e,t))return;i.css("display","none").attr({"aria-selected":!0,"aria-selected":!1}).find("div > a.e-text").removeClass("e-active");i.find("ul li").css("display","none");o=n(r[r.index(i.next('li.e-item:not([class*="e-node-disable"])'))]);s=n(r[r.index(i)-1]);o.length>0&&!i.hasClass("last")?o.attr({"aria-selected":!1,"aria-selected":!0}).find("> div > a.e-text").addClass("e-active"):s&&s.length>0&&s.attr({"aria-selected":!1,"aria-selected":!0}).find("> div > a.e-text").addClass("e-active");this.element.focus()}}else if(e==86&&this._cutCopyNodeText!=null&&this.model.allowDragAndDrop&&this.model.allowDropChild&&(i.length===0&&(i=this.element),k=i.find("> div > a.e-text").first(),c=this._cutCopyNodeText.find(" > div > a.e-text").first(),n(r).length>0)){if(u._KeyPressEventHandler(i,u,e,t))return;this._cutCopyNodeText.css("display","block").find("ul li").css("display","block");this._dropAsChildNode(k,c,t);this._cutCopyNodeText=null}}else if(t.preventDefault(),p=f.length>0?f:i,v=n(r).last(),i.length>0&&f.length==0&&i[0]!=v[0]||f.length>0&&f[0]!=v[0]){if(u._KeyPressEventHandler(v,u,e,t))return;u._onKeyDown(p,v)}}else if(t.preventDefault(),p=f.length>0?f:i,a=n(r).first(),i.length>0&&f.length==0&&i[0]!=a[0]||f.length>0&&f[0]!=a[0]){if(u._KeyPressEventHandler(a,u,e,t))return;u._onKeyDown(p,a)}}else if(t.preventDefault(),y=f.length>0?f.find("> div > div").first():i.find("> div > div").first(),s=y.closest("li"),y.hasClass("e-minus"))this._collpaseNode(n(r[r.index(y.closest("li"))]));else{if(s=n(r[r.index(s)]).closest("ul").closest("li"),u._KeyPressEventHandler(s.length>0?s:"",u,e,t))return;s.length>0&&u._onKeyDown(f,s)}else if(t.preventDefault(),l=f.length>0?f.find("> div > div").first():i.find("> div > div").first(),o=l.closest("li"),l.hasClass("e-plus"))this.model.loadOnDemand&&o.find("> ul li.e-item").length==0?this._ClickEventHandler({target:l[0]}):this._expandNode(n(r[r.index(o)]));else{if(o=n(r[r.index(o)+1]),u._KeyPressEventHandler(o.length>0?o:"",u,e,t))return;(o.length>0&&o[0]==l.closest("li").find("ul > li:first")[0]||o.find("ul > li").first().hasClass("e-node-disable"))&&u._onKeyDown(f,o)}else{if(t.preventDefault(),s=f.length>0?n(r[r.index(f)-1]):n(r[r.index(i)-1]),u._KeyPressEventHandler(s.length>0?s:null,u,e,t))return;s.length>0&&u._onKeyDown(f,s)}else{if(t.preventDefault(),o=f.length>0?n(r[r.index(f)+1]):n(r[r.index(i)+1]),u._KeyPressEventHandler(o.length>0?o:null,u,e,t))return;o.length>0&&u._onKeyDown(f,o)}},_removeChildNodes:function(n,i,r){for(var e=0,f,o,u=0;u<i.length;u++)if(!t.isNullOrUndefined(i[u][0][this.model.fields.parentId])&&i[u][0][this.model.fields.parentId].toString()==r){e=i[u].length;break}for(u=0;u<e;u++)for(f=0;f<n.length;f++)if(!t.isNullOrUndefined(n[f][this.model.fields.parentId])&&n[f][this.model.fields.parentId].toString()==r){t.isNullOrUndefined(n[f])||(o=n[f][this.model.fields.id].toString());n.splice(f,1);this._removeChildNodes(n,i,o);break}},_removeNode:function(i){if(i=i[0]==null?this.element.find(".e-active"):i,i[0]!=null&&i.length>0){var f,e,r,u,o,s,c=this,h;if(f=i.closest("ul").closest("li.e-item"),e=i.closest("li.e-item"),!t.isNullOrUndefined(this.dataSource())&&this.dataSource().length>0)for(r=this.dataSource(),u=0;u<r.length;u++)if(o=e.attr("id"),r[u][this.model.fields.id].toString()==o){h=this._groupingObjects(r,function(n){return[!t.isNullOrUndefined(n)&&[n[c.model.fields.parentId]].toString()]});r.splice(u,1);this._removeChildNodes(r,h,o);break}n(this._liList).index(e)==this.model.selectedNode&&(this.model.selectedNode=-1);e.remove();this._applyFirstLastChildClass();this._modifiCss(f);this._beforeBaseClass();this._updateExpandedNodes();this._updateSelectedNode();s=f.children("ul").find("li > div > span > input.checked");s.length>0?this._updateCheckState(s.closest("li")):this._updateCheckState(f)}},_updateText:function(n,i,r){var u,f,e;if(this._templateType==1){for(u=0,f=n.length;u<f;u++)if(!t.isNullOrUndefined(n[u])&&!t.isNullOrUndefined(n[u][this.model.fields.id])&&n[u][this.model.fields.id].toString()==i){n[u][this.model.fields.text]=r;e=n[u];n.splice(u,1,e);break}}else for(u=0,f=n.length;u<f;u++){if(n[u][this.model.fields.id].toString()==i){n[u][this.model.fields.text]=r;e=n[u];n.splice(u,1,e);break}n[u].hasOwnProperty("child")&&this._updateText(n[u].child,i,r)}},_KeyPressEventHandler:function(t,i,r,u){var f,e,o,s;return n(t)[0]!=null?(s=this._isNodeExpanded(t),f=this._getNodeDetails(t),o=i._getPath(t),e={keyCode:r,currentElement:t,value:f.nodeText,isExpanded:s,path:o,event:u,id:f.nodeId,parentId:f.parentId}):e={keyCode:r,currentElement:t,value:"",isExpanded:"",path:"",event:u,id:"",parentId:""},this._trigger("keyPress",e)},_documentClick:function(t){if(t.target.id!="Edit_Input")var i=n("#Edit_Input")[0],r,u;i!=null&&(r=n(i).closest(".e-text")[0],u=i.value,n(i).remove(),r.lastChild.nodeValue=u,n(r).removeClass("e-editable").removeAttr("style"));this.element.find("a.e-node-focus").removeClass("e-node-focus")},_saveAction:function(i){var u=i.val(),f=i.closest(".e-item").attr("id"),r=i.closest(".e-text")[0];i.remove();r!=null&&(r.lastChild.nodeValue=u,n(r).removeClass("e-editable"));this.element.focus();t.isNullOrUndefined(this.model.fields)||this.dataSource()==null||this.dataSource()instanceof t.DataManager||this._updateText(this._newDataSource,f,u)},_cancelAction:function(t){var i=t.closest(".e-text")[0];t.remove();i.lastChild.nodeValue=this.beforeEditText;n(i).removeClass("e-node-hover e-editable").addClass("e-active").removeAttr("style");this.element.focus()},_mouseEnterEvent:function(t){this.element.find(".e-node-hover").removeClass("e-node-hover");n(t.currentTarget).hasClass("e-text")&&!n(t.currentTarget).hasClass("e-node-disable")&&n(t.currentTarget).addClass("e-node-hover")},_mouseLeaveEvent:function(t){n(t.currentTarget).removeClass("e-node-hover")},_createTreeElement:function(i){var o,f,e,s,r,u;return this.model.showCheckbox&&(o=t.buildTag("input.nodecheckbox","",{},{type:"checkbox",name:this._id+"_Checkbox_"+this._indexID,value:this._id+"_"+this._indexID})),f=t.buildTag("a.e-text CanSelect",i,"",{id:this._id+"_active"}),e=n(f),this._on(e,"mouseenter",this._mouseEnterEvent),this._on(e,"mouseleave",this._mouseLeaveEvent),s=t.buildTag("div","",{},{role:"presentation"}),r=t.buildTag("div","",{},{role:"presentation"}),n(r).append(s),this.model.showCheckbox&&n(r).append(o),n(r).append(f),this.model.showCheckbox?(u=t.buildTag("li.e-item#"+this._id+"_"+this._indexID,"","",{role:"treeitem",tabindex:-1,"aria-selected":!1,"aria-expanded":!1}),this._indexID++):u=t.buildTag("li.e-item#"+i,"","",{role:"treeitem",tabindex:-1,"aria-selected":!1,"aria-expanded":!1}),this.model.allowEditing&&u.addClass("AllowEdit"),u.append(n(r)),n(u)},_addNodesWhenObject:function(i,r){var l=JSON.stringify(this._dataSource),s=this.dataSource(),o,h,u,f,e,c;if(this._dataSource=[],n(r)[0]!=null&&r.length>0&&(o=n(r).closest("li.e-item").attr("id")),t.isNullOrUndefined(i.length))this._dataSource.push(i),!t.isNullOrUndefined(this.dataSource())&&this.dataSource().length>0&&(i[this.model.fields.parentId]=o,s.push(i));else if(this._dataSource=i,!t.isNullOrUndefined(this.dataSource())&&this.dataSource().length>0)for(u=0;u<i.length;u++)t.isNullOrUndefined(i[u][this.model.fields.parentId])&&(i[u][this.model.fields.parentId]=o),s.push(i[u]);for(h=this._templateType,this._templateType=2,this._liList||(this._liList=n("li",this.element).attr("tabindex",-1)),f=document.createDocumentFragment(),e=0,c=this._dataSource.length;e<c;e++)f.appendChild(this._tempalteSub(this._dataSource[e],this._dataSource,this.model.fields)),this._liList.push(n(f).children()[0]);return this._templateType=h,this._dataSource=JSON.parse(l),f},_addExpandedNodes:function(t){var i=this.model.expandedNodes;this._removeNullInArray(i);n.inArray(t,i)==-1&&this.model.expandedNodes.push(t)},_removeExpandedNodes:function(t){var i=this.model.expandedNodes;n.inArray(t,i)>-1&&(this.model.expandedNodes.splice(n.inArray(t,i),1),i.length==0&&i.push(-1))},_onChecked:function(n,i){var r=n.closest("li.e-item"),u,f,e,o;nodeDetails=this._getNodeDetails(r);this._CurrenctSelectedNodes.push(nodeDetails.nodeText);u=this._isChecked(n.parent(".e-chkbox-wrap"));f=t.isNullOrUndefined(i)?"":t.isNullOrUndefined(i.event)?"":i.event;e=t.isNullOrUndefined(i)?"":t.isNullOrUndefined(i.checknode)?"":i.checknode;o={currentElement:r,id:nodeDetails.nodeId,parentId:nodeDetails.parentId,value:nodeDetails.nodeText,currentNode:this._CurrenctSelectedNodes,currentCheckedNodes:e,isChecked:u,event:f};this._isRender&&this._onNodeCheck(o)},_onUnChecked:function(n,i){var r=n.closest("li.e-item"),u,f,e,o;nodeDetails=this._getNodeDetails(r);this._CurrenctSelectedNodes.push(nodeDetails.nodeText);u=this._isChecked(n.parent(".e-chkbox-wrap"));f=t.isNullOrUndefined(i)?"":t.isNullOrUndefined(i.event)?"":i.event;e=t.isNullOrUndefined(i)?"":t.isNullOrUndefined(i.unchecknode)?"":i.unchecknode;o={currentElement:r,id:nodeDetails.nodeId,parentId:nodeDetails.parentId,value:nodeDetails.nodeText,currentNode:nodeDetails.nodeText,currentUncheckedNodes:e,isChecked:u,event:f};this._onNodeUncheck(o)},_addCheckNodes:function(n){var t=this.model.checkedNodes;this._removeNullInArray(t);!t instanceof Array&&(t=[]);t.indexOf(n)==-1&&t.push(n)},_removeCheckNodes:function(n){var t=this.model.checkedNodes,i;!t instanceof Array&&(t=[]);i=t.indexOf(n);i!=-1&&(t.splice(i,1),t.length==0&&t.push(-1))},_removeNullInArray:function(n){var t=n.indexOf(-1);t!=-1&&n.splice(t,1)},_afterInsertingNode:function(n){this._beforeBaseClass();this._applyFirstLastChildClass();this._addDragableClass();parentLi=n.parents("li:first");this._modifiCss(parentLi);this._updateExpandedNodes();this._finalizeEditing(n);this._updateCheckState(n);activeNode=n.find("a.e-active");activeNode.length>0&&this._nodeSelectionAction(activeNode);parentLi.length>0&&parentLi.hasClass("e-node-disable")&&n.addClass("e-node-disable").prop("disabled",!0).find("> div > a").addClass("e-node-disable").removeClass("e-active");this._updateSelectedNode()},_insertBeforeOrAfter:function(t,i,r){return typeof i!="object"&&(i=this.element.find(".e-item#"+i)),i=n(i),i[0]!=null?(typeof t!="object"?outerLi=this._createTreeElement(t):(t[this.model.parentId]&&delete t[this.model.parentId],outerLi=this._addNodesWhenObject(t,i),temp=document.createElement("ul"),n(temp).append(outerLi),outerLi=n(temp.children)),this.model.showCheckbox&&outerLi.children().find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),i.parents(".e-item:first").length>0?i.parents(".e-item:first").append(outerLi):this.element.append(outerLi),this.model.showCheckbox&&this._isCheckedAction(),this._dropAsSublingNode(i,outerLi.find("> div > .e-text"),r,""),this._afterInsertingNode(outerLi),!0):!1},_wireEvents:function(){this._on(this.element,"click",this._ClickEventHandler);this._on(this.element.find(".e-text"),"mouseenter",this._mouseEnterEvent);this._on(this.element.find(".e-text"),"mouseleave",this._mouseLeaveEvent);this._on(this.element,this.model.expandOn,this._expandEventHandler);this.model.allowKeyboardNavigation&&this._on(this.element,"keydown",this._KeyPress);this._on(this.element,"focus",this._onFocusHandler)},_unWireEvents:function(){this._off(this.element,"click");this._off(this.element.find(".e-text"),"mouseenter");this._off(this.element.find(".e-text"),"mouseleave");this._preventEditable();this._off(this.element,this.model.expandOn);this.model.allowKeyboardNavigation&&this._off(this.element,"keydown");this._off(this.element,"focus");this.model.showCheckbox&&this.element.find(".nodecheckbox").ejCheckBox("disable");this._preventDraggable()},_enableDragDrop:function(){this.model.allowDragAndDrop&&(this._drag(),this.model.allowDropChild&&this._childDrop(),this.model.allowDropSibling&&this._siblingDrop())},_allowEditable:function(){this.model.template||(this.element.find("li").addClass("AllowEdit"),this._on(n(document),"click",this._documentClick),this._on(this.element.find("li > div > a.e-text"),"dblclick",this._inlineEdit))},_preventEditable:function(){this.element.find("li").removeClass("AllowEdit");this._off(n(document),"click");this._off(this.element.find("li > div > a.e-text"),"dblclick")},_preventDraggable:function(){this.element.find(".e-draggable").removeClass("e-draggable");this.element.find(".e-droppable").removeClass("e-droppable");this._preventDropSibling();this._preventDropChild()},_preventDropSibling:function(){this.element.find("li.e-dropsibling").removeClass("e-dropsibling")},_preventDropChild:function(){this.element.find("li.e-item > div > a.e-dropchild").removeClass("e-dropchild")},refresh:function(){this._unWireEvents();this.element.html("");this._init()},expandAll:function(){this._expandAll()},collapseAll:function(){this._collapseAll()},checkAll:function(){this.model.showCheckbox&&this._checkAll()},unCheckAll:function(){this.model.showCheckbox&&this._unCheckAll()},getSelectedNode:function(){return this.element.find("li > div > a.e-active").closest("li.e-item")},getText:function(n){return this.element.find(n).find("> div > a.e-text:first").text()},selectNode:function(t){t=n(t);t[0]!=null&&this.model.enabled&&(t.is("A")&&t.hasClass("e-text")?this._nodeSelectionAction(n(t)):this._nodeSelectionAction(n(t).find(">div > a:first")))},unselectNode:function(t){t=n(t);t[0]!=null&&this.model.enabled&&(t.is("A")&&t.hasClass("e-text")?this._nodeUnSelectionAction(n(t)):this._nodeUnSelectionAction(n(t).find(">div > a:first")))},enableNode:function(t){t=n(t);t[0]!=null&&this.model.enabled&&(t.is("A")&&t.hasClass("e-text")?this._nodeEnableAction(n(t)):this._nodeEnableAction(n(t).find(">div > a:first")))},disableNode:function(t){t=n(t);t[0]!=null&&this.model.enabled&&(t.is("A")&&t.hasClass("e-text")?this._nodeDisableAction(n(t)):this._nodeDisableAction(n(t).find(">div > a:first")))},addNodes:function(i,r){var e,l,o,f,c,h,u;if(i&&i.length>0)for(e=this.model.fields,l=this.dataSource(),this._liList||(this._liList=n("li",this.element).attr("tabindex",-1)),o=0;o<i.length;o++)if(f=i[o],c=f[e.text],c){this.dataSource()&&l.push(f);var a=f[e.id],v=f[e.parentId],s=r&&r.length!=0?r:null;if(t.isNullOrUndefined(s)&&(h=v?this.element.find("#"+v):null,s=h&&h.length!=0?h.children("div").find("a"):null),t.isNullOrUndefined(s))continue;u=this._createTreeElement(c);this._liList.push(u[0]);a?u.attr("id",a):u.removeAttr("id");this._appendNode(n(s),n(u));u.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});this.model.allowDragAndDrop&&u.find("a").addClass("e-draggable e-droppable")}},addNode:function(i,r){if(this.model.enabled){var u=null,s,e=this.element,o,f;e.is("UL")||(e=this.element.children("ul:first"));f=n(r)[0]==null?e.find(".e-active"):n(r).hasClass("e-text")?n(r):n(r).find("> div > a:first");typeof i=="object"&&(t.isNullOrUndefined(i.length)&&!t.isNullOrUndefined(i[this.model.fields.parentId])?o=i[this.model.fields.parentId]:t.isNullOrUndefined(i[0])||t.isNullOrUndefined(i[0][this.model.fields.parentId])?f=n(r)[0]==null?e.find(".e-active"):n(r).hasClass("e-text")?n(r):n(r).find("> div > a:first"):o=i[0][this.model.fields.parentId],o&&(f=e.find("li#"+o).find("> div > a:first")));f.length!=0&&this._expandNode(f.closest("li.e-item"));typeof i!="object"?u=this._createTreeElement(i):(u=this._addNodesWhenObject(i,f),s=document.createElement("ul"),n(s).append(u),u=n(s.children));this.model.showCheckbox&&u.children().find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});this._appendNode(f,u);this._afterInsertingNode(u)}},removeNode:function(t){t=n(t);t[0]!=null&&this.model.enabled&&(t.is("A")&&t.hasClass("e-text")?this._removeNode(n(t)):this._removeNode(n(t).find(">div > a:first")))},getCheckedNodes:function(){if(this.model.showCheckbox)return this.element.find('li > div > span.e-chkbox-wrap[aria-checked="true"]').closest("li")},checkNode:function(t){n(t)[0]!=null&&this._nodeCheckedAction(n(t).find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0])},uncheckNode:function(t){n(t)[0]!=null&&this._nodeUnCheckedAction(n(t).find("> div > span.e-chkbox-wrap > input.nodecheckbox:first")[0])},expandNode:function(t){n(t)[0]!=null&&this._expandNode(n(t))},collapseNode:function(t){n(t)[0]!=null&&this._collpaseNode(n(t))},showNode:function(t){n(t)[0]!=null&&this.model.enabled&&n(t).css("visibility","")},hideNode:function(t){n(t)[0]!=null&&this.model.enabled&&n(t).css("visibility","hidden")},show:function(){this.element.css("visibility","")},hide:function(){this.element.css("visibility","hidden")},isNodeChecked:function(t){return this._isChecked(n(t).find("> div > span.e-chkbox-wrap:first"))},isExpanded:function(t){return t=n(t),t[0]!=null&&this.model.enabled?t.is("A")&&t.hasClass("e-text")?this._isNodeExpanded(t.closest("li")):this._isNodeExpanded(t):void 0},hasChildNode:function(t){return n(t).find("> ul > li.e-item").length>0?!0:!1},getTreeData:function(){if(!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null&&!(this.dataSource()instanceof t.DataManager))return this._orderDataSource()},insertAfter:function(n,t){return this._insertBeforeOrAfter(n,t,!1)},insertBefore:function(n,t){return this._insertBeforeOrAfter(n,t,!0)},_onNodeExpand:function(n){this._trigger("nodeExpand",n)},_onNodeCollapse:function(n){this._trigger("nodeCollapse",n)},_onBeforeExpand:function(n){if(this._isRender)return this._trigger("beforeExpand",n)},_onBeforeCollapse:function(n){return this._trigger("beforeCollapse",n)},_onNodeSelect:function(n){this._isRender&&this._trigger("nodeSelect",n)},_onNodeCheck:function(n){this._trigger("nodeCheck",n)},_onNodeUncheck:function(n){this._trigger("nodeUncheck",n)},_onDragStarts:function(n){return this._trigger("nodeDragStart",n)},_onDrag:function(n){return this._trigger("nodeDrag",n)},_onDragStop:function(n){return this._trigger("nodeDragStop",n)},_onDropped:function(n){return this._trigger("nodeDropped",n)},_onClick:function(n){this._trigger("nodeClick",n)}})})(jQuery,Syncfusion)});