/*!
*  filename: ej.treegrid.min.js
*  version : 12.4.0.24
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.scroller.min","./ej.datepicker.min","./ej.checkbox.min","./ej.dropdownlist.min","./ej.editor.min"],n):n()})(function(){(function(n,t,r){t.widget("ejTreeGrid","ej.TreeGrid",{_rootCSS:"e-treegrid",element:null,validTags:["div"],model:null,_tags:[{tag:"columns",attr:["field","headerText","allowSorting","editType","allowFiltering","filterEditType","width"],content:"template"},{tag:"sortSettings.sortedColumns",attr:["field","direction"]}],_columns:function(n,t,i){var r=this.element.find(".e-headercelldiv");r[n.columns].innerHTML=i;this._trigger("refresh")},keyConfigs:{focus:"e",editRecord:"113",saveRequest:"13",cancelRequest:"27",firstRowSelection:"36",lastRowSelection:"35",leftArrow:"37",upArrow:"38",rightArrow:"39",downArrow:"40",moveCellRight:"9",moveCellLeft:"shift+9",selectedRowExpand:"alt+40",totalRowExpand:"ctrl+40",selectedRowCollapse:"alt+38",totalRowCollapse:"ctrl+38"},defaults:{allowFiltering:!1,filterBarMode:"immediate",allowSorting:!1,allowColumnResize:!1,allowSelection:!0,dataSource:null,query:t.Query(),idMapping:"",parentIdMapping:"",showGridCellTooltip:!1,showGridExpandCellTooltip:!1,enableAltRow:!0,selectedItem:null,toolbarSettings:{showToolbar:!1,toolbarItems:[]},editSettings:{allowEditing:!1,allowAdding:!0,allowDeleting:!0,editMode:"cellEditing",rowPosition:"top"},enableVirtualization:!1,allowMultiSorting:!1,sortSettings:{sortedColumns:[]},selectionType:"single",selectedRowIndex:-1,allowKeyboardNavigation:!0,cssClass:"",locale:"en-US",isEdit:!1,allowScrolling:!1,groupSettings:{groupedColumns:[]},sizeSettings:{height:null,width:null},enableResize:!1,rowDataBound:null,load:null,queryCellInfo:null,rowSelecting:null,rowSelected:null,beginEdit:null,endEdit:null,expanding:null,expanded:null,collapsing:null,collapsed:null,currentViewData:[],flatRecords:[],parentRecords:[],records:[],columns:[],commonWidth:150,dateFormat:"MM/dd/yyyy",rowHeight:30,emptyRecordText:"No Records To Display",treeColumnIndex:0,workingTimeScale:"TimeScale8Hours",childMapping:"",enableCollapseAll:!1,rowTemplateID:"",altRowTemplateID:"",contextMenuSettings:{showContextMenu:!1,contextMenuItems:[]},contextMenuOpen:null},dataTypes:{columns:"array",sortSettings:{sortedColumns:"array"},currentViewData:"array",flatRecords:"array",parentRecords:"array",records:"array",contextMenuSettings:{contextMenuItems:"array"},toolbarSettings:{toolbarItems:"array"},selectedItem:"data"},observables:["selectedRowIndex","dataSource"],selectedItem:t.util.valueFunction("selectedItem"),selectedRowIndex:t.util.valueFunction("selectedRowIndex"),dataSource:t.util.valueFunction("dataSource"),getHeaderTable:function(){return this._$gridHeaderTable},setGridHeaderTable:function(n){this._$gridHeaderTable=n},getHeaderContent:function(){return this._$gridHeaderContent},setGridHeaderContent:function(n){this._$gridHeaderContent=n},getContentTable:function(){return this._$gridContentTable},getContent:function(){return this._$gridContent},setGridContentTable:function(n){this._$gridContentTable=n},getRows:function(){return this._$gridRows},setGridRows:function(n){this._$gridRows=n},getCurrentViewData:function(){return this.model.currentViewData},getUpdatedCurrentViewData:function(){return this._updateCurrentViewData(),this.model.currentViewData},getFlatRecords:function(){return this.model.records},setHeight:function(n){this._totalHeight=n},getUpdatedRecords:function(){return this._updatedRecords},getDataSource:function(){return this.dataSource()},getUpdatedIds:function(){return this.model.ids},getRecordsCount:function(){return this._recordsCount},setRecordsCount:function(n){this._recordsCount=n},getExpandCollapseRecordsCount:function(){return this._expandCollapseRecordCount},setCollapsedRecordCount:function(n){this._totalCollapseRecordCount=n},getCollapsedRecordCount:function(){return this._totalCollapseRecordCount},_colgroupRefresh:function(){var t=n(this.getHeaderTable()).find("colgroup")[0],i=n(this.getContentTable()).find("colgroup")[0],r=n(t).clone(),u=n(i).clone();n(i).remove();n(t).remove();n(r).prependTo(this.getHeaderTable());n(u).prependTo(this.getContentTable())},_init:function(){var t=this,r,i;if(t._trigger("load"),t._initPrivateProperties(),t.model.isdesignMode&&(t.element.css({height:"250px"}),t.model.columns.length===0&&(t.model.columns=[{field:"Column1",HeaderText:"Column1"},{field:"Column2",HeaderText:"Column2"},{field:"Column3",HeaderText:"Column3"}]),t.model.childMapping.length==0&&(t.model.childMapping="Children")),t._processEditing(),t._initDatasource(),t._createTooltipTemplate(),!t.model.isFromGantt&&t.model.enableCollapseAll&&t.collapseAll(),r=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),r&&!t.model.isFromGantt){if(treeGridHeader=t._$gridHeaderContent,treeGridContent=n("#"+t._id+"e-gridcontent"),sizeSettingsWidth=t.model.sizeSettings.width,elementStyleWidth=t.element[0].style.width,sizeSettingsWidth&&sizeSettingsWidth.indexOf("%")!=-1||elementStyleWidth.indexOf("%")!=-1){var u=sizeSettingsWidth?sizeSettingsWidth:elementStyleWidth,f=n(t.element).parent().width()?n(t.element).parent().width():n(t.element).width(),e=f/100*parseInt(u);i=e}else i=n(t.element).width();i=i-t._totalBorderWidth;t._updateScrollCss();n(treeGridHeader).hasClass("e-scrollcss")&&t._$gridContent.children(".e-vscroll").length>0?n(treeGridHeader).width(i-18):n(treeGridHeader).width(i)}},_setModel:function(i){var r=this,f=r.model;for(var u in i)switch(u){case"enableAltRow":f.enableAltRow=i[u];r._addInitTemplate();r.refreshContent();break;case"enableVirtualization":f.enableVirtualization=i[u];r.refreshContent();break;case"allowColumnResize":f.allowColumnResize=i[u];r._enableColumnResizeEvents();break;case"allowSorting":f.allowSorting=i[u];break;case"sortSettings":n.extend(f.sortSettings,i[u]);r.refreshContent();break;case"allowSelection":r.clearSelection();f.allowSelection=i[u];break;case"selectionType":r.clearSelection();f.selectionType=i[u];break;case"selectedRowIndex":this.selectedRowIndex()!=-1&&n.inArray(this.selectedRowIndex(),r._selctedRowsIndexes==-1)&&!t.isNullOrUndefined(this.selectedRowIndex())&&r.selectRows(this.selectedRowIndex());break;case"editSettings":n.extend(f.editSettings,i[u]);r._processEditing();r._enableEditingEvents();break;case"allowKeyboardNavigation":f.allowKeyboardNavigation=i[u];break;case"dataSource":r._refreshDataSource();break;case"columns":n.extend(f.columns,i[u]);r._addInitTemplate();r.refreshContent();break;case"rowHeight":f.rowHeight=i[u];r._addInitTemplate();r.refreshContent();break;case"treeColumnIndex":f.treeColumnIndex=i[u];r._addInitTemplate();r.refreshContent()}},_refreshDataSource:function(){var i=this,r=this.model,u,f;i.resetModelCollections();i._createdAt="load";this.dataSource()instanceof t.DataManager?(u=this.dataSource().executeQuery(r.query),u.done(t.proxy(function(u){if(i._retrivedData=i.dataSource().dataSource.offline?i.dataSource().dataSource.json:u.result,r.idMapping&&r.parentIdMapping){var e=u.result.slice(0),f=[];n.each(e,function(n,t){f.push(jQuery.extend(!0,{},t))});i._reconstructDatasource(f)}else i._reconstructDatasource(u.result);i._createRecords(i.secondaryDatasource);args={};args.requestType=t.TreeGrid.Actions.RefreshDataSource;i._ensureDataSource(args);i.selectedRowIndex()!==-1&&i.selectedRowIndex()<i.model.currentViewData.length&&i.selectRows(i.selectedRowIndex());this._$gridContent.hasClass("e-scroller")&&i._$gridContent.ejScroller("refresh");i._createdAt=null}))):this.dataSource()&&(r.idMapping&&r.parentIdMapping?r.idMapping.length>0&&r.parentIdMapping.length>0&&(f=this.dataSource().slice(0),i._reconstructDatasource(f),i._createRecords(i.secondaryDatasource)):r.flatRecords.length===0&&this.dataSource()!==null&&i._createRecords(this.dataSource()),args={},args.requestType=t.TreeGrid.Actions.RefreshDataSource,i._ensureDataSource(args),this.selectedRowIndex()!==-1&&this.selectedRowIndex()<i.model.currentViewData.length&&i.selectRows(this.selectedRowIndex()),this._$gridContent.hasClass("e-scroller")&&i._$gridContent.ejScroller("refresh"),i._createdAt=null);n(".e-tooltiptable").remove()},refreshContent:function(){var i=this,n={};n.requestType=t.TreeGrid.Actions.Refresh;i.processBindings(n)},resetModelCollections:function(){var t=this,n=t.model;n.currentViewData=[];n.flatRecords=[];n.parentRecords=[];n.records=[];t.secondaryDatasource=[]},_initPrivateProperties:function(){var i=this;i._id=i.element.attr("id");i._columnsWidthCollection=[];i._cSortedColumn=null;i._cSortedDirection=null;i._dataManager=null;i._disabledSortableColumns=[];i._filteredRecords=[];i._disabledToolItems=[];i._filteredColumns=[];proxy_currentFilterColumn=[];i._fieldColumnNames=[];i._multiSortRequest=null;i._$gridContainer=null;i._$gridContent=null;i._$gridContentTable=null;i._$gridHeaderTable=null;i._$gridHeaderContainer=null;i._recordsCount=null;i._$gridRows=null;i._gridRows=null;i._calculateDimensions();i._headerColumnNames=[];i._hiddenColumns=[];i._multiSelectCtrlRequest=!1;i._multiSelectShiftRequest=!1;i._offset=0;i._previousIndex=-1;i._prevRBottom=0;i._prevRTop=0;i._prevScrollTop=0;i._prevScrollLeft=0;i._prevVBottom=0;i._resizer=null;i._scrollTop=0;i._searchString="";i._fieldName="";i._selectedRowsIndexes=[];i._sortedRecords=[];i._storedIndex=-1;i._$tableContent=null;i._tempsortedrecords=[];i._totalHeight=0;i._viewPortHeight=0;i._recordIndexCount=0;i._visibleColumns=[];i._visibleRange=null;i._vScrollDir=1;i._vScrollDist=0;i._cellEditTemplate=n();i._totalBorderWidth=2;i._totalBorderHeight=1;i._cellEditingDetails={cellValue:null,rowIndex:-1,columnIndex:-1,fieldName:null,_data:null,cellEditType:"",cancelSave:!1,defaultData:null,insertedTrCollection:[],data:null};i._tdsOffsetWidth=[];i._isEnterKeyPressed=!1;i._updatedRecords=[];i._scrollBarHeight=18;i._expandCollapseRecordCount=0;i._removedCount=0;i._$gridHeaderContent=null;i._expandedRecordsCount=0;i._totalCollapseRecordCount=0;i._collapsedRecordCount=0;i.secondaryDatasource=[];i._contextMenuItems=i._getContextMenuItems();i._subContextMenuItems=i._getsubContextMenuItems();i._dropDownTemplate=i._compiledDropDownTemplate();i._createSubContextMenuTemplate();i._createContextMenuTemplate();i._retrivedData=this.dataSource();i._createdAt="load";i._dataManager=i.dataSource()instanceof t.DataManager?i.dataSource():i.dataSource()!=null?t.DataManager(i.dataSource()):null},_calculateDimensions:function(){var n=this,t=this.model;t.isFromGantt||(t.sizeSettings.width&&n.element.css("width",t.sizeSettings.width),t.sizeSettings.height?n.element.css("height",t.sizeSettings.height):n.element[0].style.height||n.element.height(350));n._gridHeight=n.element.height();n._gridWidth=n.element.width()},_checkDataBinding:function(){var t=this,i=t.model;t._createdAt=null;t.element.addClass("e-treegrid-core");t.element.attr("tabindex","0");t._renderToolbar();t._renderAfterColumnInitialize();t._viewPortHeight=t._getViewPortHeight();t._ensureDataSource();t._initGridRender();t._$gridContent=n("#"+t._id+"e-gridcontent");t._$gridContainer=n("#"+t._id+"e-gridcontainer");t._$tableContent=n("#"+t._id+"e-table");t._wireEvents();t.setWidthToColumns();t._renderScroller();t._resizeFilteringElements();i.isFromGantt&&t._addEmptyColumntoGrid()},_initDatasource:function(){var i=this,r=i.model,f,e,u;r.isFromGantt?i._checkDataBinding():this.dataSource()instanceof t.DataManager?(f=this.dataSource().executeQuery(r.query),f.done(t.proxy(function(t){if(i._retrivedData=i.dataSource().dataSource.offline?i.dataSource().dataSource.json:t.result,r.idMapping&&r.parentIdMapping){var f=t.result.slice(0),u=[];n.each(f,function(n,t){u.push(jQuery.extend(!0,{},t))});i._reconstructDatasource(u)}else i._reconstructDatasource(t.result);i._createRecords(i.secondaryDatasource);i._checkDataBinding()}))):this.dataSource()?(r.idMapping&&r.parentIdMapping?(e=this.dataSource().slice(0),u=[],n.each(e,function(n,t){u.push(jQuery.extend(!0,{},t))}),i._reconstructDatasource(u),i._createRecords(i.secondaryDatasource)):r.flatRecords.length===0&&this.dataSource()!==null&&i._createRecords(this.dataSource()),i._checkDataBinding()):i._checkDataBinding()},_reconstructDatasource:function(n){for(var r,f=this,u=f.model,e=[],i=0;i<n.length;i++)r={},r=t.DataManager(n).executeLocal(t.Query().where(u.parentIdMapping,t.FilterOperators.equal,n[i][u.idMapping])),(t.isNullOrUndefined(n[i][u.parentIdMapping])||n[i][u.parentIdMapping]==0)&&r.length>0?(n[i][u.childMapping]=r,f.secondaryDatasource.push(n[i])):!t.isNullOrUndefined(n[i][u.parentIdMapping])||r&&r.length>0?r&&r.length>0&&!t.isNullOrUndefined(r[0][u.parentIdMapping])?f._appendChildDataItems(f.secondaryDatasource,r):(t.isNullOrUndefined(n[i][u.parentIdMapping])||n[i][u.parentIdMapping]==0)&&r.length==0&&f.secondaryDatasource.push(n[i]):f.secondaryDatasource.push(n[i]),r&&r.length>0?(f._datasourceChildItems=f._reconstructDatasource(r),t.isNullOrUndefined(n[i][u.childMapping])&&(n[i][u.childMapping]=f._datasourceChildItems,f._getParentIndex(n)),f._datasourceChildItems=[]):t.isNullOrUndefined(n[i][u.parentIdMapping])||e.push(n[i]);if(e&&e.length>0)return e},_appendChildDataItems:function(n,i){for(var f=this,r=f.model,u=0;u<n.length;u++)n[u][r.idMapping]===i[0][r.parentIdMapping]?n[u][r.childMapping]=i:!t.isNullOrUndefined(n[u][r.childMapping])&&n[u][r.childMapping].length>0&&f._appendChildDataItems(n[u],i);t.isNullOrUndefined(n.length)&&n&&(n[r.idMapping]===i[0][r.parentIdMapping]?n[r.childMapping]=i:!t.isNullOrUndefined(n[r.childMapping])&&n[r.childMapping].length>0&&f._appendChildDataItems(n[r.childMapping],i))},_getParentIndex:function(n){var o=this,r=o.model,f=o.secondaryDatasource,e=0,u,i;for(n.length>0&&(e=n[0][r.parentIdMapping]),i=0;i<f.length;i++){if(f[i][r.idMapping]==e&&t.isNullOrUndefined(f[i][r.childMapping]))return f[i][r.childMapping]=n,!0;if(u=f[i][r.childMapping],u)for(i=0;i<u.length;i++)if(u[i][r.idMapping]==e&&t.isNullOrUndefined(u[i][r.childMapping]))return u[i][r.childMapping]=n,!0}},_windowResize:function(){var i=this,f=i._$gridHeaderContent,nt=n("#"+i._id+"e-gridcontent"),e=n("#"+i._id+"_toolbarItems"),o=i.model.sizeSettings.height,s=i.model.sizeSettings.width,v=i.element[0].style.width,y=i.element[0].style.height,r,u,p,w,b,c,l,a,h;if(s&&s.indexOf("%")!=-1||v.indexOf("%")!=-1){var k=s?s:v,d=n(i.element).parent().width()?n(i.element).parent().width():n(i.element).width(),g=d/100*parseInt(k);r=g}else r=n(i.element).width();o&&o.indexOf("%")!=-1||y.indexOf("%")!=-1?(p=o?o:y,w=n(i.element).parent().height()?n(i.element).parent().height():n(i.element).height(),b=n(i.element).parent().height()?w/100*parseInt(p):n(i.element).height(),u=b):u=n(i.element).height();u=u-i._totalBorderHeight;r=Math.round(r-i._totalBorderWidth);c=i._$gridContent.ejScroller("option","scrollTop");l=i._$gridContent.ejScroller("option","scrollLeft");i._$gridContent.ejScroller({width:r,height:u-n(f).outerHeight()-e.outerHeight()});i._updateScrollCss();n(f).hasClass("e-scrollcss")&&i._$gridContent.children(".e-vscroll").length>0?n(f).width(r-18):n(f).width(r);i.model.toolbarSettings.showToolbar&&e.length>0&&(e.width(r),e.children(".e-ul:first-child").width(r));i._$gridContent.ejScroller("refresh");i.updateViewPortHeight();i._$gridContent.ejScroller("option","scrollTop",c);i._$gridContent.ejScroller("option","scrollLeft",l);i._$gridHeaderContainer.scrollLeft(l);i.model.enableVirtualization&&(i.processBindings(),a={},a.requestType=t.TreeGrid.Actions.Refresh,i.sendDataRenderingRequest(a),i.model.currentViewData.length*i.model.rowHeight<i._viewPortHeight&&(h=c-(i._viewPortHeight-i.model.currentViewData.length*i.model.rowHeight),h<0&&(h=0),i._$gridContent.ejScroller("scrollY",h,!0)));i._resizeFilteringElements()},processBindings:function(n){var i=this,r=i.model;if(r.query=new t.Query,i._trigger("actionBegin",n))return!0;i._ensureDataSource(n)},_ensureDataSource:function(i){var r=this,u=r.model,tt=u.sortSettings.sortedColumns,h=!1,e,s,v,w,f,b,l,k,nt,d,g,a,y,c,o,p;if(u.query.requiresCount(),r._queryManagar=u.query,(u.editSettings.allowEditing||u.editSettings.allowAdding)&&i&&i.requestType==t.TreeGrid.Actions.Save&&(!t.isNullOrUndefined(i._cModifiedData)||!t.isNullOrUndefined(i._cAddedRecord))&&(t.isNullOrUndefined(i._cAddedRecord)?n.extend(u.flatRecords[n.inArray(u.selectedItem,u.flatRecords)],i._cModifiedData):(this.selectedRowIndex()===-1?(i._cAddedRecord.hasChildRecords=!1,u.flatRecords.unshift(i._cAddedRecord),u.records.unshift(i._cAddedRecord),this.dataSource().unshift(i._cAddedRecord.item),u.isFromGantt&&u.ids.unshift(i._cAddedRecord.taskId),i.recordIndex=0):(i._cAddedRecord.level=u.selectedItem.level,e=u.selectedItem?u.flatRecords.indexOf(u.selectedItem):0,i._cAddedRecord.level===0&&(e=e>0?e-1:e),i.actionRequestType!=t.TreeGrid.Actions.ContextMenuAdd&&(i.recordIndex=e>0?e-1:0),u.flatRecords.splice(e,0,i._cAddedRecord),w=u.records.indexOf(u.selectedItem),u.records.splice(w,0,i._cAddedRecord),u.isFromGantt&&u.ids.splice(w,0,i._cAddedRecord.taskId.toString()),i._cAddedRecord.level>0&&(v=u.selectedItem.parentItem,v&&(s=v.childRecords?v.childRecords.indexOf(u.selectedItem):-1,s!==-1&&(s=s===0?0:s-1),v.childRecords.splice(s,0,i._cAddedRecord))),r.setRecordsCount(u.flatRecords.length),r.setHeight(u.flatRecords.length*u.rowHeight),r.updateHeight(),h=!0),r._queryManagar.queries=[],u.isEdit=!1,r._updatedGanttRecords=u.flatRecords)),i&&i.requestType===t.TreeGrid.Actions.ExpandCollapse&&(h=!0,r._filteredRecords=[],r._expandCollapseRecordCount=0,r.updateExpandCollapseRecords(i.data,i.expanded),r.setRecordsCount(u.flatRecords.length),r.setHeight(u.flatRecords.length*u.rowHeight),r._updatedRecords=u.flatRecords,u.enableVirtualization||(u.allowSearching&&r._searchString.length&&(r._updateFilteredRecords(r._tempfilteredrecords),r.setRecordsCount(r._filteredRecords.length),r.setHeight(r._filteredRecords*u.rowHeight),r._updatedRecords=r._filteredRecords),u.allowSorting&&u.sortSettings.sortedColumns.length&&(r._updateExpandCollapseForSortedRecords(i.data,i.expanded),r.setHeight(r._sortedRecords*u.rowHeight),r._updatedRecords=r._sortedRecords)),r.updateHeight(),u.enableAltRow&&r._updateAltRow()),u.editSettings.allowDeleting&&i&&i.requestType===t.TreeGrid.Actions.Delete&&(f=i.data,r._removedCount=0,k=r._getFilteredChildRecordsCount(f),k+=1,r._removedCount=0,f.parentItem&&(nt=f.parentItem.childRecords,s=nt.indexOf(f),f.parentItem.childRecords.splice(s,1),u.parentIdMapping||f.parentItem.item[r.model.childMapping].splice(s,1)),d=u.parentRecords.indexOf(f),d!==-1&&u.parentRecords.splice(d,1),b=r.model.flatRecords.indexOf(f),b!==-1&&r.model.flatRecords.splice(b,k),r.setRecordsCount(u.flatRecords.length),r.setHeight((u.flatRecords.length-r._totalCollapseRecordCount)*u.rowHeight),h=!1,e=u.records.indexOf(f),g=r.getChildCount(f,0),u.records.splice(e,g+1),u.ids&&u.ids.splice(e,g+1),r._updatedRecords=u.flatRecords,u.parentIdMapping?(f.hasChildRecords&&f.childRecords.length>0&&r._removeChildItem(f),this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&(a=this.dataSource().dataSource.json.indexOf(f.item),a!==-1&&this.dataSource().dataSource.json.splice(a,1)):(a=this.dataSource().indexOf(f.item),a!==-1&&this.dataSource().splice(a,1))):this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&(l=this.dataSource().dataSource.json.indexOf(f.item),l!==-1&&r.dataSource().dataSource.json.splice(l,1)):(l=this.dataSource().indexOf(f.item),l!==-1&&r.dataSource().splice(l,1)),u.selectedItem=null,this.selectedRowIndex(-1),!u.isFromGantt&&f.parentItem&&f.parentItem.childRecords.length==0&&(f.parentItem.expanded=!1,f.parentItem.hasChildRecords=!1)),u.allowFiltering&&!u.isFromGantt&&this._filteredColumns.length){for(c=this._filteredColumns[0],y=c.isComplex?c:t.Predicate(c.field,c.operator,c.value,!c.matchcase),o=1;o<this._filteredColumns.length;o++)y=this._filteredColumns[o].isComplex?y.and(this._filteredColumns[o]):y[this._filteredColumns[o].predicate](this._filteredColumns[o].field,this._filteredColumns[o].operator,this._filteredColumns[o].value,!this._filteredColumns[o].matchcase);r._queryManagar.where(y);r._filteredRecords=u.records.filter(function(n){return n.hasChildRecords===!1});p=new t.DataManager(r._filteredRecords);r._tempfilteredrecords=p.executeLocal(r._queryManagar).result;r._updateFilteredRecords(r._tempfilteredrecords);r.setRecordsCount(r._filteredRecords.length);r._updatedRecords=r._filteredRecords;u.allowSorting&&u.sortSettings.sortedColumns.length>0&&r._sortingRecords();r.setHeight(r._updatedRecords.length*u.rowHeight);r.updateHeight();h=!0;u.enableAltRow&&r._updateAltRow()}u.allowSearching&&r._searchString.length||i&&i.requestType==="searching"?(r._queryManagar.search(r._searchString,r.getColumnFieldNames(),t.FilterOperators.contains,!0),r._filteredRecords=u.records.filter(function(n){return n.hasChildRecords===!1}),p=new t.DataManager(r._filteredRecords),r._tempfilteredrecords=p.executeLocal(r._queryManagar).result,r._updateFilteredRecords(r._tempfilteredrecords),r.setRecordsCount(r._filteredRecords.length),r._updatedRecords=r._filteredRecords,u.allowSorting&&u.sortSettings.sortedColumns.length>0&&r._sortingRecords(),r.setHeight(r._updatedRecords.length*u.rowHeight),r.updateHeight(),h=!0,u.enableAltRow&&r._updateAltRow()):u.allowSorting&&tt.length>0&&(h=r._sortingRecords());i&&i.requestType==="outdent"&&(i={},i.requestType=t.TreeGrid.Actions.Refresh,h=!0);h||(r.setRecordsCount(u.flatRecords.length),r.setHeight((u.flatRecords.length-r._totalCollapseRecordCount)*u.rowHeight),r._updatedRecords=u.flatRecords,r.updateHeight());i||(i={},i.requestType=t.TreeGrid.Actions.Refresh);r._updateCurrentViewData();(u.isFromGantt||i.requestType!=="save")&&i.requestType!=="sorting"&&i.requestType!=="searching"&&i.requestType!=="delete"&&i.requestType!=="refreshDataSource"&&i.requestType!="filtering"||(r.renderRecords(i),r._setScrollTop(),r._$gridContent.ejScroller("refresh"),r._updateScrollCss())},_removeChildItem:function(n){for(var r,i,f=this,u=0;u<n.childRecords.length;u++)i=n.childRecords[u],this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&(r=this.dataSource().dataSource.json.indexOf(i.item),r!==-1&&this.dataSource().dataSource.json.splice(r,1),i.hasChildRecords&&f._removeChildItem(i)):(r=this.dataSource().indexOf(i.item),r!==-1&&this.dataSource().splice(r,1),i.hasChildRecords&&f._removeChildItem(i))},_processEditing:function(){var t=this,n=t.model;(n.editSettings.allowEditing||n.editSettings.allowAdding)&&(n.editSettings.editMode==="cellEditing"||n.editSettings.editMode.toLowerCase()==="rowediting")&&t._addCellEditTemplate()},_toolBarClick:function(t){var e=this,o=e.model,f=n(this.itemsContainer).closest(".e-treegrid"),u=f.ejTreeGrid("instance"),i=f.attr("id");if(t.event==r&&t.target.tagName=="INPUT"&&t.currentTarget.id==i+"_search"||(u.model.dateFormat.indexOf("hh")!=-1?n.isFunction(n.fn.ejDateTimePicker)&&n("#"+i+"EditForm").find(".e-datepicker").ejDateTimePicker("hide"):n.isFunction(n.fn.ejDatePicker)&&n("#"+i+"EditForm").find(".e-datepicker").ejDatePicker("hide"),f.ejTreeGrid("instance")._trigger("toolBarClick",t)))return!1;switch(t.currentTarget.id){case i+"_add":u._toolbarOperation(i+"_add",t);break;case i+"_edit":u._toolbarOperation(i+"_edit",t);break;case i+"_delete":u._toolbarOperation(i+"_delete",t);break;case i+"_update":u._toolbarOperation(i+"_update",t);break;case i+"_cancel":u._toolbarOperation(i+"_cancel",t);break;case i+"_expandAll":u._toolbarOperation(i+"_expandAll",t);break;case i+"_collapseAll":u._toolbarOperation(i+"_collapseAll",t)}return!1},_toolbarOperation:function(n,t){var u=this.element,o=u.ejTreeGrid("instance"),r=u.attr("id"),i=this,s=this.selectedItem(),f=t.target,e=this.selectedRowIndex();switch(n){case r+"_add":i._startAdd(f);break;case r+"_edit":i._editRow(e);break;case r+"_delete":i.deleteRow();i._cancelSaveTools();break;case r+"_update":i._endEdit();i._cancelSaveTools();break;case r+"_cancel":i.cancelRowEditCell();i._cancelSaveTools();break;case r+"_expandAll":i._expandAll();break;case r+"_collapseAll":i.collapseAll()}return i._refreshToolBar(),!1},_createNewRowInstance:function(n){var t=[];for(var i in n)t.push(i);return t},_startAdd:function(){for(var e,a,t,f,v,i=this,h=this.selectedRowIndex(),o=i.model.editSettings.rowPosition,l=i.model.currentViewData.length,s,w=i._headerColumnNames,c={},p=i._createNewRowInstance(w),y=0;y<p.length;y++)c[p[y]]=null;if(l>0){h==-1&&o!="bottom"&&(o="top");o=="bottom"?(f=l,s=l-1):h!=-1&&o=="aboveSelectedRow"?(f=h,s=h):h!=-1&&o=="belowSelectedRow"?(f=h+1,s=h):(f=0,s=0);var u=i.model.currentViewData[s],b=i._createNewRowInstance(u),t={};(u.parentItem||o=="bottom")&&(t=i._createRecord(c),t.parentItem=u.parentItem,t.level=u.level,t.isAltRow=u.isAltRow,t.index=l+1,u.fromEmpty&&(t.fromEmpty=!0),u.hasChildRecords?o=="belowSelectedRow"?(t.parentItem=u,t.level=u.level+1,u.childRecords.splice(0,0,t)):o=="aboveSelectedRow"&&(e=i.model.currentViewData[s-1],e.hasChildRecords?(t.parentItem=u.parentItem,t.level=u.level,e.childRecords.splice(0,0,t)):(t.parentItem=e.parentItem,t.level=e.level,e.parentItem.childRecords.splice(f,0,t))):u.fromEmpty||(u.parentItem.childRecords.splice(f,0,t),u.parentItem[i.model.childMapping].splice(f,0,t.item)));u.parentItem||(s!=0&&o=="aboveSelectedRow"&&(t=i._createRecord(c),e=i.model.currentViewData[s-1],u.fromEmpty&&(t.fromEmpty=!0,e=i.model.currentViewData[0]),t.parentItem=e.parentItem,t.level=e.level,u.fromEmpty||(e.parentItem?(e.parentItem.childRecords.splice(f,0,t),e.parentItem[i.model.childMapping].splice(f,0,t.item)):i.model.parentRecords.splice(f,0,t))),o=="belowSelectedRow"&&(t=i._createRecord(c),refbelow=i.model.currentViewData[s+1],u.fromEmpty&&(t.fromEmpty=!0,refbelow=i.model.currentViewData[0]),t.parentItem=refbelow.parentItem,t.level=refbelow.level,!u.fromEmpty&&refbelow.parentItem&&(refbelow.parentItem.childRecords.splice(f,0,t),refbelow.parentItem[i.model.childMapping].splice(f,0,t.item))),s==0&&(o=="top"||o=="aboveSelectedRow")&&(t=i._createRecord(c),t.parentItem=u.parentItem,t.childRecords=r,t.level=0,t.index=0,i.model.parentRecords.splice(f,0,t)));a=i._previousIndex;i.clearSelection(a);a!=-1&&(i._updatedRecords[a].isSelected=!1);i.model.currentViewData.splice(f,0,t)}else t=i._createRecord(c),t.parentItem=null,t.level=0,t.index=0,t.fromEmpty=!0,f=t.index,i.model.currentViewData.push(t);t.fromEmpty&&(i.model.parentRecords.splice(f,0,t),v=[],n(n(".e-expandall")[0]).parent("li").hasClass("e-disable")||v.push(n(n(".e-expandall")[0]).parent()[0]),n(n(".e-collapseall")[0]).parent("li").hasClass("e-disable")||v.push(n(n(".e-collapseall")[0]).parent()[0]),n(".e-treegridtoolbar").ejToolbar("disableItem",v));i.selectRows(f);i.renderRecords();i._editRow(f,t)},_editAddTools:function(){var u=this,r=u.model.editSettings,t=[],i;r.allowAdding&&t.push(n(n(".e-addnew")[0]).parent()[0]);r.allowEditing&&!n(n(".e-edit")[0]).parent("li").hasClass("e-disable")&&t.push(n(n(".e-edit")[0]).parent()[0]);r.allowDeleting&&!n(n(".e-delete")[0]).parent("li").hasClass("e-disable")&&t.push(n(n(".e-delete")[0]).parent()[0]);n(".e-treegridtoolbar").ejToolbar("disableItem",t);i=[];i.push(n(n(".e-cancel")[0]).parent()[0]);i.push(n(n(".e-save")[0]).parent()[0]);n(".e-treegridtoolbar").ejToolbar("enableItem",i)},_cancelSaveTools:function(){var t=this,f=t.model,u=t.model.editSettings,i,r;f.isFromGantt?(i=[],u.allowAdding&&t.model.toolbarSettings.toolbarItems.indexOf("add")!==-1&&i.push(n(n(".e-addnewitem")[0]).parent()[0]),u.allowEditing&&t.model.toolbarSettings.toolbarItems.indexOf("edit")!==-1&&t.model.selectedRowIndex!=-1&&i.push(n(n(".e-edititem")[0]).parent()[0]),u.allowDeleting&&t.model.toolbarSettings.toolbarItems.indexOf("delete")!==-1&&t.model.selectedRowIndex!=-1&&i.push(n(n(".e-deleteitem")[0]).parent()[0]),n(".e-gantttoolbar").ejToolbar("enableItem",i),r=[],t.model.toolbarSettings.toolbarItems.indexOf("cancel")!==-1&&r.push(n(n(".e-cancel")[0]).parent()[0]),t.model.toolbarSettings.toolbarItems.indexOf("update")!==-1&&r.push(n(n(".e-saveitem")[0]).parent()[0]),n(".e-gantttoolbar").ejToolbar("disableItem",r)):(i=[],r=[],u.allowAdding&&t.model.toolbarSettings.toolbarItems.indexOf("add")!==-1&&i.push(n(n(".e-addnew")[0]).parent()[0]),u.allowEditing&&t.model.toolbarSettings.toolbarItems.indexOf("edit")!==-1&&(t.model.selectedRowIndex!=-1?i.push(n(n(".e-edit")[0]).parent()[0]):n(n(".e-delete")[0]).parent("li").hasClass("e-disable")||r.push(n(n(".e-edit")[0]).parent()[0])),u.allowDeleting&&t.model.toolbarSettings.toolbarItems.indexOf("delete")!==-1&&(t.model.selectedRowIndex!=-1?i.push(n(n(".e-delete")[0]).parent()[0]):n(n(".e-delete")[0]).parent("li").hasClass("e-disable")||r.push(n(n(".e-delete")[0]).parent()[0])),n(n(".e-cancel")[0]).parent("li").hasClass("e-disable")||r.push(n(n(".e-cancel")[0]).parent()[0]),n(n(".e-save")[0]).parent("li").hasClass("e-disable")||r.push(n(n(".e-save")[0]).parent()[0]),n(".e-treegridtoolbar").ejToolbar("disableItem",r),n(".e-treegridtoolbar").ejToolbar("enableItem",i))},_checkIsEmptyRow:function(n){var i,t;for(i in n)if(t=n[i],t!=" "&&t!=null&&t!="")return!1;return!0},_beginEdit:function(){var n=this;n._trigger("beginEdit",args);n._isinBeginEdit=!0},_endEdit:function(){var t=this,i,r;t._isinBeginEdit=!1;t._trigger("endEdit");i=this.selectedRowIndex();r=t._$gridRows[i];n("tr").hasClass("e-addedrow")||n("tr").hasClass("e-rowedit")?t._saveRow():t.saveCell();t.getUpdatedRecords(i)},_expandAll:function(){var n=this,f=n.model,r=0,i,u={},e=f.enableVirtualization;for(n._isInExpandCollapse=!0,r=0;r<n._updatedRecords.length;r++)i=n._updatedRecords[r],u.data=i,u.recordIndex=r,u.expanded=!0,e?i.hasChildRecords&&!i.expanded&&t.TreeGrid.sendExpandCollapseRequest(n,u):i.hasChildRecords&&!i.expanded&&t.TreeGrid.sendExpandCollapseRequest(n,u);n._isInExpandCollapse=!1;(n._isRowEdit||n.model.isEdit)&&(n.cancelRowEditCell(),n._cancelSaveTools())},_refreshToolBar:function(){var t=n("#"+this._id+"_toolbarItems");t.find("li").removeClass("e-hover")},_renderToolbar:function(){var n=this,i=n.model;if(!i.isFromGantt){var n=this,r=n.element,i=n.model;n.model.toolbarSettings.showToolbar&&(n.model.toolbarSettings.toolbarItems.length==0&&(n.model.toolbarSettings.toolbarItems=[t.TreeGrid.ToolbarItems.Add,t.TreeGrid.ToolbarItems.Edit,]),r.append(n._renderToolbarTemplate()))}},_renderToolbarTemplate:function(){var i=this,f=i.model,u=t.buildTag("div.e-treegridtoolbar#"+i._id+"_toolbarItems","",{height:"36px",border:"1px solid"},{}),e=t.buildTag("ul","",{width:i._gridWidth,"box-sizing":" "},{}),o,r;return!t.isNullOrUndefined(f.toolbarSettings.toolbarItems)&&f.toolbarSettings.toolbarItems.length&&i._renderLi(e),u.append(e),o=t.buildTag("ul"),u.append(o),r={},r.click=i._toolBarClick,r.cssClass="",r.rtl=!1,r.itemSeparator=!1,r.itemLeave=i._toolbarItemLeave,r.width=i._gridWidth,r.fields={id:"",tooltipText:"",imageUrl:"",text:"",imageAttributes:"",spriteCSS:"",htmlAttributes:""},u.ejToolbar(r),u.ejToolbar("disableItem",i._disabledToolItems),i._disabledToolItems=n(),u},_renderLi:function(n){var f=this,r=f.model.toolbarSettings.toolbarItems,e=r.length,i=0,u;for(i;i<e;i++)u=t.buildTag("li","",{},{id:f._id+"_"+r[i],tabindex:"0"}),r[i]!=="search"&&u.css({width:"30px",height:"24px"}),f._renderLiContent(u,r[i]),n.append(u)},_renderLiContent:function(n,i){var r,u,f=this.model.selectedRowIndex,e=this.model.editSettings;switch(i){case"add":r=t.buildTag("span.e-addnew e-toolbaricons e-icon e-treegrid-add","",{});n.attr("title","Add");this.model.editSettings.allowAdding||this._disabledToolItems.push(n.get(0));break;case"edit":r=t.buildTag("span.e-edit e-toolbaricons e-icon e-treegrid-edit","",{});n.attr("title","Edit");this.model.editSettings.allowEditing&&f!=-1||this._disabledToolItems.push(n.get(0));break;case"delete":n.attr("title","Delete");r=t.buildTag("span.e-delete e-toolbaricons e-icon e-treegrid-delete","",{});this.model.editSettings.allowDeleting&&f!=-1||this._disabledToolItems.push(n.get(0));break;case"update":n.attr("title","Update");r=t.buildTag("span.e-save e-toolbaricons e-icon e-treegrid-save e-disabletool","",{});this._disabledToolItems.push(n.get(0));break;case"cancel":n.attr("title","Cancel");r=t.buildTag("span.e-cancel e-toolbaricons e-icon e-treegrid-cancel e-disabletool","",{});this._disabledToolItems.push(n.get(0));break;case"expandAll":n.attr("title","ExpandAll");u=t.buildTag("span.e-expandall e-toolbaricons e-icon e-treegrid-expandall","",{},{});n.append(u);break;case"collapseAll":n.attr("title","CollapseAll");u=t.buildTag("span.e-collapseall e-toolbaricons e-icon e-treegrid-collapseall","",{},{});n.append(u)}n.append(r)},_renderAfterColumnInitialize:function(){var n=this;n.element.append(n._renderGridHeader())},filterEditType:function(n,i){var e=this,o=e.model,r,u,f;t.isNullOrUndefined(n.filterEditType)&&(n.filterEditType="stringedit");switch(n.filterEditType){case"stringedit":i.html(t.buildTag("input.e-ejinputtext e-filtertext e-field e-filterwidth","",{},{id:n.field+"_filterbarcell",name:n.field}));break;case"booleanedit":i.html('<input class="e-field e-checkbox e-filtertext" type ="checkbox" id='+n.field+"_filterbarcell name="+n.field+" />");break;case"numericedit":r=t.buildTag("input.e-numerictextbox e-field","",{width:n.width-15},{type:"text",id:n.field+"_filterbarcell",name:n.field});i.append(r);break;case"datepicker":case"datetimepicker":u=t.buildTag("input.e-"+n.filterEditType+" e-field","",{},{type:"text",id:n.field+"_filterbarcell",name:n.field});i.append(u);break;case"dropdownedit":f=t.buildTag("input.e-field .e-dropdownlist e-field","",{},{type:"text",id:n.field+"_filterbarcell",name:n.field});i.append(f)}},_filteringElements:function(i){var o=this,e=o.model,d=!1,p,l=0,g,nt,u,h,f={},w,a,v,y,s,c,b,k;for(selectedItem=e.selectedItem,i.requestType=="filtering"&&(g=document.getElementById(o._id+"_filterBar"+i.fieldname)),s=a=t.TreeGrid.getColumnByField(e.columns,i.fieldname),p=n(g).find("input,select"),nt=p.length,l;l<nt;l++){if(u=p.eq(l),f={},inputWidth=u.closest("div").width()-2,u.hasClass("e-numerictextbox"))h=inputWidth,w=u.val(),f.width=h,f.showSpinButton=!0,f.cssClass=e.cssClass,f.height=28,c=u[0].id,c=c.replace(o._id,""),e.filterBarMode=="immediate"&&(f.change=n.proxy(o._filterBarHandler,o,u)),f.value=w.length?parseFloat(w):null,a=t.TreeGrid.getColumnByField(o.model.columns,u.prop("name")),t.isNullOrUndefined(a.editParams)||n.extend(f,a.editParams),u.ejNumericTextbox(f),u.prop("name",u.prop("name").replace(o._id,""));else if(u.hasClass("e-datepicker"))h=inputWidth,f.width=h,f.cssClass=e.cssClass,f.dateFormat=e.dateFormat,f.locale=e.locale,f.displayDefaultDate=!0,f.height=28,c=u[0].id,c=c.replace(o._id,""),e.filterBarMode=="immediate"&&(f.select=n.proxy(o._filterBarHandler,o,u)),s=t.TreeGrid.getColumnByField(o.model.columns,u.prop("name")),s.format!==r&&s.format.length>0&&(v=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),y=v.exec(s.format),f.dateFormat=y[2]),t.isNullOrUndefined(s.editParams)||n.extend(f,s.editParams),e.dateFormat.indexOf("hh")!=-1?u.ejDateTimePicker(f):u.ejDatePicker(f);else if(u.hasClass("e-datetimepicker"))h=inputWidth,f={width:h,rtl:e.rtl,locale:e.locale,cssClass:e.cssClass,showButton:!1},f.height=28,s=t.TreeGrid.getColumnByField(o.model.columns,u.prop("name")),s.format!==r&&s.format.length>0&&(v=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),y=v.exec(s.format),f.dateTimeFormat=y[2]),t.isNullOrUndefined(s.editParams)||n.extend(f,s.editParams),e.dateFormat.indexOf("hh")!=-1?u.ejDateTimePicker(f):u.ejDatePicker(f);else if(u.hasClass("e-dropdownlist"))s=t.TreeGrid.getColumnByField(o.model.columns,u.prop("name")),b=s.dropdownData,k=!1,selectedItem!==null&&selectedItem.hasChildRecords&&i.requestType!=="add"&&(k=!0),u.ejDropDownList({width:inputWidth,showCheckbox:!0,dataSource:b,readOnly:k,height:28,fields:{id:e.resourceIdMapping,text:e.resourceNameMapping,value:e.resourceNameMapping},selectedItems:o.getIndexofresourceInfo(b,i.data)}),u.ejDropDownList("setSelectedValue",u.val());else switch(u.prop("tagName")){case"INPUT":u.width(inputWidth-4);break;case"SELECT":u.width(inputWidth).height(15)}u.is(":disabled")||d||u.is(":hidden")&&typeof u.data("ejDropDownList")!="object"||o._isEnterKeyPressed||(d=!0)}},_renderFiltering:function(){for(var r,e,u=this,i=this.model.columns,f=t.buildTag("tr.e-filterbar","",{},{}),n=0;n<this.model.columns.length;n++)if(u.model.allowFiltering)if(r=t.buildTag("th.e-filterbarcell .e-editValue","",{},{}),$div=t.buildTag("div.e-filterdiv","",{},{id:u._id+"_filterBar"+i[n].field}),f.append(r.append($div)),i[n].allowFiltering==!1)continue;else this.filterEditType(i[n],$div,n),e=t.buildTag("span.e-cancel e-icon e-hide e-spanstyle"),this.model.columns[n].visible===!1&&r.addClass("e-hide"),$div.append(e);return f},_renderGridHeader:function(){var f=this,e=f.model,s=document,h=t.buildTag("div.e-gridheadercontainer","",{overflow:"hidden"},{}),c=t.buildTag("table.e-table","",{},{cellspacing:"0px","border-spacing":"0px"}),p=t.buildTag("thead"),g=t.buildTag("tbody.e-hide"),l=t.buildTag("tr.e-columnheader"),w=n(s.createElement("colgroup")),k=n(s.createElement("tr")),i=0,u=e.columns,d=u.length,o,b,a,v,y=e.isFromGantt?t.buildTag("div.e-gridheader#"+f._id+"e-gridheader","",{},""):t.buildTag("div.e-gridheader#"+f._id+"e-gridheader","",{"border-top-style":"solid","border-left-style":"solid","border-right-style":"solid","border-top-width":"1px","border-left-width":"1px","border-right-width":"1px",width:f._gridWidth},"");for(f.setGridHeaderContent(y),f._$gridHeaderContainer=h,f._hiddenColumns=[],e.allowSorting&&l.css({cursor:"pointer"}),i;i<d;i++)u[i]&&(o=t.buildTag("th.e-headercell","",{height:"45px"},{}),b=s.createElement("td"),a=t.buildTag("div.e-headercelldiv",u[i].headerText==r?u[i].headerText=u[i].field:u[i].headerText,{},{unselectable:"on"}),o.append(a),v=s.createElement("col"),k.append(b),l.append(o),w.append(v),u[i].visible===!1?o.addClass("e-hide")&&n(v).css("display","none")&&f._hiddenColumns.push(u[i].headerText):(f._visibleColumns.push(u[i].headerText),u[i].visible=!0),u[i].allowSorting===!1&&(f._disabledSortableColumns.push(u[i].headerText),o.css({cursor:"normal"})),t.isNullOrUndefined(u[i].headerTemplateID)||a.html(n(u[i].headerTemplateID).hide().html()).parent().addClass("headertemplate"),u[i].width==r&&e.commonWidth!==r?f._columnsWidthCollection[i]=e.commonWidth:f._columnsWidthCollection.push(u[i].width),f._fieldColumnNames[u[i].headerText]=u[i].field,f._headerColumnNames[u[i].field]=u[i].headerText);return $filterHeader=t.buildTag("tr.e-filterbar"),this.model.allowFiltering&&!f.model.isFromGantt&&($filterHeader=this._renderFiltering()),p.append(l).append($filterHeader),c.append(w).append(p),h.html(c),y.html(h),f.setGridHeaderTable(c),y},_initGridRender:function(){var n=this;n._addInitTemplate();n._renderGrid();n.model.allowColumnResize&&(n._resizer=new t.Grid.gridResize(n))},_renderGrid:function(){var n=this;n._renderGridContent().insertAfter(n.element.children(".e-gridheader"));n._initialEndRendering()},_renderGridContent:function(){var i=this,o=document,r=i.model,s=n(o.createElement("tbody")),e=t.buildTag("div.e-gridcontent#"+i._id+"e-gridcontent","",{height:i._viewPortHeight},{unselectable:"on"}),f=t.buildTag("div.e-gridcontainer#"+i._id+"e-gridcontainer","",{},{}),u,h;return r.enableVirtualization&&f.css({height:i._totalHeight}),u=t.buildTag("table.e-table#"+i._id+"e-table","",{top:"0px"},{cellspacing:"0px"}),u.append(i.getHeaderTable().find("colgroup").clone()).append(s),f.html(u),e.html(f),i.setGridContentTable(u),this.dataSource()===null?(h=t.buildTag("td",r.emptyRecordText,{},{colSpan:r.columns.length}),s.append(n(o.createElement("tr")).append(h)),f.css("height",r.rowHeight)):i.renderRecords(),r.isFromGantt||e.css({"border-bottom-style":"solid","border-bottom-width":"1px","border-left-style":"solid","border-left-width":"1px","border-right-style":"solid","border-right-width":"1px",width:"auto",height:"auto"}),u.css({position:"relative"}),e},_initialEndRendering:function(){var n=this,t=n.selectedRowIndex();t!=-1&&n.model.allowSelection&&(n._rowSelectingEventTrigger()||(n.selectRows(t),n._rowSelectedEventTrigger(t)))},_addCellEditTemplate:function(){for(var i=this,e=i.model,r=e.columns,n=0,u=t.buildTag("div","",{display:"none"},{id:i._id+"_CellEditTemplate"}),f,o=r&&r.length,n=0;n<o;n++)r[n]&&(f=t.buildTag("div","",{},{id:r[n].field+"_CellEdit"}),t.TreeGrid._initCellEditType(i,f,i._id,n),u.append(f));u.children().length&&(i._cellEditTemplate=u)},_addInitTemplate:function(){var i=this,r=i.model,c=r.columns,e=0,ut=c.length,s,v,o={},f,a,y,u,b,k,p,nt,w,tt;if(c.length===0)return!1;if(o["_"+i._id+"rowClassName"]=t.TreeGrid._getrowClassName,o["_"+i._id+"expandStatus"]=n.proxy(i._getExpandStatusRecord,i),o["_"+i._id+"cellValue"]=i._getCellValue,o["_"+i._id+"getIndentWidth"]=n.proxy(i._getIndentWidth,i),o["_"+i._id+"checkColumn"]=n.proxy(i._getCellColumn,i),o._treeGridTemplating=t.proxy(i._gridTemplate,null,i),o["_"+i._id+"itemDetails"]=n.proxy(i._convertItemToString,i),n.views.helpers(o),r.rowTemplateID.length>0){var l=t.buildTag("tbody","",{},{}),h=t.buildTag("tbody","",{},{}),d="",g="",ft=r.altRowTemplateID.length>0?n("#"+r.altRowTemplateID)[0].innerHTML:n("#"+r.rowTemplateID)[0].innerHTML;if(n(l[0]).html(ft),n(h[0]).html(n("#"+r.rowTemplateID)[0].innerHTML),h[0].childNodes.length>0)for(f=0;f<h[0].childNodes.length;f++)if(h[0].childNodes[f].nodeName=="TR"&&(h[0].className=h[0].childNodes[f].className,h[0].style.cssText=h[0].childNodes[f].style.cssText,h[0].childNodes[f].childNodes.length>0))for(a=0,y=0;y<h[0].childNodes[f].childNodes.length;y++)u=h[0].childNodes[f].childNodes[y],u.nodeName=="TD"&&(b=u.innerHTML,n("#"+i._id+"RowTemplateElement"+a).remove(),w=this._createRowTemplateElement(b,a),u.innerHTML="{{:~_treeGridTemplating('"+w.id+"')}}",u.className+=" e-rowcell e-templatecell",a==r.treeColumnIndex?(k="<div  style='height:20px;' unselectable='on'><div class='intend' style='height:1px; float:left;width:{{:~_"+i._id+"getIndentWidth(#data)}}; display:inline-block;'><\/div><div class='{{if expanded}}e-treegridexpand e-icon{{else hasChildRecords}}e-treegridcollapse e-icon{{/if}}' style='height:20px;width:30px;margin:auto;float:left;margin-left:10px;style='float: left;display:inline-block; unselectable='on'><\/div><div class='e-cell' style='display:inline-block;width:100%' unselectable='on'>",d+="<td class='"+u.className+"{{if isSelected}}e-selectionbackground{{/if}}' style='"+u.style.cssText+"'>"+k+u.innerHTML+"<\/div><\/div><\/td>"):d+=u.outerHTML,a++);if(l[0].childNodes.length>0)for(f=0;f<l[0].childNodes.length;f++)if(l[0].childNodes[f].nodeName=="TR")for(l[0].className=l[0].childNodes[f].className,l[0].style.cssText=l[0].childNodes[f].style.cssText,a=0,y=0;y<l[0].childNodes[f].childNodes.length;y++)u=l[0].childNodes[f].childNodes[y],u.nodeName=="TD"&&(b=u.innerHTML,n("#"+i._id+"RowTemplateElement"+a).remove(),w=this._createRowTemplateElement(b,a),u.innerHTML="{{:~_treeGridTemplating('"+w.id+"')}}",u.className+=" e-rowcell e-templatecell",a==r.treeColumnIndex?(k="<div  style='height:20px;' unselectable='on'><div class='intend' style='height:1px; float:left;width:{{:~_"+i._id+"getIndentWidth(#data)}}; display:inline-block;'><\/div><div class='{{if expanded}}e-treegridexpand e-icon{{else hasChildRecords}}e-treegridcollapse e-icon{{/if}}' style='height:20px;width:30px;margin:auto;float:left;margin-left:10px;style='float: left;display:inline-block; unselectable='on'><\/div><div class='e-cell' style='display:inline-block;width:100%' unselectable='on'>",g+="<td class='"+u.className+"{{if isSelected}}e-selectionbackground{{/if}}' style='"+u.style.cssText+"'>"+k+u.innerHTML+"<\/div><\/div><\/td>"):g+=u.outerHTML,a++);p="{{if isAltRow}}<tr class='{{:~_"+i._id+"rowClassName()}} {{if expanded}}e-treegridrowexpand {{else hasChildRecords}} e-treegridrowcollapse {{/if}} e-templaterow"+l[0].className+"'  style='"+l[0].style.cssText+"'>"+g+"<\/tr>{{else}}<tr class='{{:~_"+i._id+"rowClassName()}} {{if expanded}}e-treegridrowexpand {{else hasChildRecords}} e-treegridrowcollapse {{/if}} e-templaterow"+h[0].className+"'  style='"+h[0].style.cssText+"'>"+d+"<\/tr>{{/if}}"}else{for(p="<tr class='e-treegridrows {{:~_"+i._id+"rowClassName()}} ",r.enableAltRow&&(p+="{{if isAltRow}}e-alt-row{{/if}} "),nt="",e=0;e<ut;e++)if(c[e]){if(s=c[e].field,c[e].isTemplateColumn){p+="e-templaterow ";var it=c[e].templateID,rt=c[e].template,et=c[e].angularTemplate;et?(n("#"+i._id+c[e].headerText+e+"_Template").remove(),w=this._createTemplateElement(c[e]),v="<td style=''class='{{if isSelected}}e-rowcell e-selectionbackground e-intend {{else}}e-rowcell e-intend {{/if}} e-templatecell'role='gridcell''tabindex='-1'>{{:~_treeGridTemplating('"+w.id+"')}}<\/td>"):it?v="<td style=''class='{{if isSelected}}e-rowcell e-selectionbackground e-intend {{else}}e-rowcell e-intend {{/if}} e-templatecell'role='gridcell''tabindex='-1'aria-label={{:~_"+i._id+"itemDetails(#data)}}>"+n("#"+it)[0].innerHTML+"<\/td>":rt&&(v="<td class='{{if isSelected}}e-rowcell e-selectionbackground e-intend {{else}}e-rowcell e-intend {{/if}} e-templatecell'role='gridcell'tabindex='-1'aria-label={{:~_"+i._id+"itemDetails(#data)}}>"+rt+"<\/td>")}else e===r.treeColumnIndex?v="<td class='{{if isSelected}}e-rowcell e-selectionbackground e-intend {{else}}e-rowcell e-intend {{/if}}'style='background-color:{{if cellBackgroundColor && ~_"+i._id+"checkColumn('"+s+"',#data)=='"+s+"'}}{{:cellBackgroundColor}}{{else}}none{{/if}};'role='gridcell'tabindex='-1'aria-label={{:~_"+i._id+"itemDetails(#data)}}><div  style='height:20px;' unselectable='on'>{{if hasChildRecords}}<div class='intend'style='height:1px; float:left; width:{{:level*20}}px; display:inline-block;'><\/div>{{else !hasChildRecords}}<div class='intend'style='height:1px; float:left; width:{{:(level+1)*20}}px; display:inline-block;'><\/div>{{/if}}<div class='{{if expanded}}e-treegridexpand e-icon{{else hasChildRecords}}e-treegridcollapse e-icon{{/if}}'style='float: left;display:inline-block; font-size:10px; unselectable='on''><\/div><div class='e-cell'style='display:inline-block;width:100%;' unselectable='on'>{{:#data['"+s+"']}}<\/div><\/div><\/td>":r.isFromGantt&&c[e].mappingName===r.resourceInfoMapping?(o={},o["_"+i._id+"resourceName"]=i._getResourceName,n.views.helpers(o),v="<td  class='{{if isSelected}}e-rowcell e-selectionbackground{{else}}e-rowcell {{/if}}'style='background-color:{{if cellBackgroundColor && ~_"+i._id+"checkColumn('"+s+"',#data)=='"+s+"'}}{{:cellBackgroundColor}}{{else}}none{{/if}};'role='gridcell'tabindex='-1'aria-label={{:~_"+i._id+"itemDetails(#data)}}>{{:~_"+i._id+"resourceName('"+i._id+"Object','"+r.resourceNameMapping+"','"+s+"')}}<\/td>"):r.isFromGantt&&c[e].mappingName===r.predecessorMapping?(o={},o["_"+i._id+"predecessor"]=i._getPredecessorsValue,n.views.helpers(o),v="<td class='{{if isSelected}}e-rowcell e-selectionbackground{{else}}e-rowcell {{/if}}' style='background-color:{{if cellBackgroundColor && ~_"+i._id+"checkColumn('"+s+"',#data)=='"+s+"'}}{{:cellBackgroundColor}}{{else}}none{{/if}};'role='gridcell'tabindex='-1'aria-label={{:~_"+i._id+"itemDetails(#data)}}>{{:~_"+i._id+"predecessor('"+i._id+"Object','"+r.predecessorMapping+"','"+s+"')}}<\/td>"):v="<td class='{{if isSelected}}e-rowcell e-selectionbackground{{else}}e-rowcell{{/if}}'style='background-color:{{if cellBackgroundColor && ~_"+i._id+"checkColumn('"+s+"',#data)=='"+s+"'}}{{:cellBackgroundColor}}{{else}}none{{/if}};'role='gridcell'tabindex='-1'aria-label={{:~_"+i._id+"itemDetails(#data)}} unselectable='on'>{{:~_"+i._id+"cellValue('"+s+"')}}<\/td>";nt+=v}p+="{{if expanded}}e-treegridrowexpand {{else hasChildRecords}} e-treegridrowcollapse {{/if}} 'style='background-color:{{if rowBackgroundColor }}{{:rowBackgroundColor}}{{else}}none{{/if}}; height:"+r.rowHeight+"px;display:{{:~_"+i._id+"expandStatus(#data)}}'role='row'>";p+=nt;r.isFromGantt&&(p+="<td class='e-extendcolumn'><\/td><\/tr>")}tt={};tt[i._id+"_Template"]=p;n.templates(tt)},_gridTemplate:function(n,t){return n._renderEjTemplate("#"+t,this.data,this.data.index)},_getIndentWidth:function(n){var t=n.level;return n.hasChildRecords?t*20+"px":(t+1)*20+"px"},_createRowTemplateElement:function(t,i){var r=document.createElement("script");return r.id=("treeGridRowTemplateElement"+i).split("").join(""),r.type="text/x-template",r.text=t,n("body").append(r),r},_createTemplateElement:function(t){var i=document.createElement("script");return i.id=("treeGrid"+t.headerText+n.inArray(t,this.model.columns)+"_Template").split(" ").join(""),i.type="text/x-template",i.text=n(t.angularTemplate).html(),n("body").append(i),i},_convertItemToString:function(n){for(var u,f="",i={},r=this.model.columns,t=0;t<r.length;t++)r[t]&&(i[r[t].field]=n.item[r[t].field]);for(u in i)i.hasOwnProperty(u)&&(f+=u+""+i[u]+"\n");return f},_getCellValue:function(n){var t=this.data[n];return t||t===0?t:this.data.item&&this.data.item[n]},_getCellColumn:function(n,t){var i=this;return t.treeMappingName.indexOf(n)!==-1?n:"none"},_getResourceName:function(n,t,i){var e=this,r=e.data[i],u=0,o=r&&r.length,f=[];if(r&&r.length>0)for(u;u<o;u++)f.push(r[u][t]);return f},_getPredecessorsValue:function(n,t){return this.data.item[t]},_getExpandStatusRecord:function(n){var t=this;return t.getExpandStatus(n)?"table-row":"none"},_createRecords:function(n){var i=this,u=i.model,f=u.flatRecords,e=n.length,r=0,t,o=u.parentRecords,s=u.records;for(r;r<e;r++)t=i._createRecord(n[r],0,null),i._storedIndex++,t.isAltRow=i._storedIndex%2==0?!1:!0,o.push(t),t.index=i._storedIndex,s[i._storedIndex]=t,f.push(t),t.childRecords&&i._addNestedRecords(t.childRecords)},_createRecord:function(i,u,f,e){var s=this,o,h=i[s.model.childMapping],c=this.model,l;return o=n.extend({},i),c.parentIdMapping&&s._createdAt==="load"?(l=t.DataManager(s._retrivedData).executeLocal(t.Query().where(c.idMapping,t.FilterOperators.equal,o[c.idMapping])),o.item=l[0]):this.dataSource()instanceof t.DataManager&&this.dataSource().dataSource.json&&this.dataSource().dataSource.offline&&s._createdAt==="load"?(l=t.DataManager(s._retrivedData).executeLocal(t.Query().where(c.idMapping,t.FilterOperators.equal,o[c.idMapping])),o.item=l.length>0?l[0]:i):o.item=i,o.parentItem=f,o.childRecords=h&&s._createChildRecords(h,u+1,o),o.hasChildRecords=h?!0:!1,o.expanded=e!==r?e:h?h.length>0:!1,o.isSelected=!1,o.level=u,o.cellBackgroundColor=null,o.rowBackgroundColor=null,o.treeMappingName=[],o},_createChildRecords:function(n,t,i){for(var o=this,f=[],r=0,s=n.length,u=null,e,r=0;r<s;r++)u=n[r],u&&(e=o._createRecord(u,t,i),f.push(e));return f},_addNestedRecords:function(n){for(var t=this,o=t.model,s=o.flatRecords,u=0,c=n.length,h=o.records,f=[],r,u=0;u<c;u++)if(r=n[u],t._storedIndex++,r.isAltRow=t._storedIndex%2==0?!1:!0,r.index=t._storedIndex,h[t._storedIndex]=r,s.push(r),f=r.childRecords,f)for(var e=0,l=f.length,i=null,e=0;e<l;e++)i=f[e],t._storedIndex++,i.index=t._storedIndex,i.isAltRow=t._storedIndex%2==0?!1:!0,h[t._storedIndex]=i,s.push(i),i.childRecords&&t._addNestedRecords(i.childRecords)},_wireEvents:function(){var i=this,r=i.model;i._$gridContent.bind("scroll",n.proxy(i._onScroll,i));i._on(i.element,"click",i._onClick);i._on(i.element,"click","#"+i._id+"e-gridheader",i._onHeaderClick);i._on(i.element,"mousedown","#"+i._id+"e-gridheader",i._headerMouseDown);r.filterBarMode=="immediate"&&(this._on(this.element,"keyup",".e-filterbarcell input",this._filterBarHandler),this._off(this.element,"click",".e-checkbox")._on(this.element,"click",".e-checkbox",this._filterBarHandler));this._on(this.element,"focus click",".e-filterbarcell input",this._filterBarClose);this._on(this.element,"click",".e-filterbarcell .e-cancel",this._filterBarClose);i.model.showGridCellTooltip&&!i.model.showGridExpandCellTooltip?t.browserInfo().name=="msie"?i._on(i.element,"mouseenter",".e-rowcell",i._mouseHover):i._on(i.element,"mousemove",".e-rowcell",i._mouseHover):i._on(i.element,"mouseenter",".e-rowcell",i._mouseHover);i._on(i.element,"mouseleave",".e-rowcell",i._cellMouseLeave);i._enableColumnResizeEvents();r.isFromGantt&&i._on(i.element,"mousewheel DOMMouseScroll",i._mouseWheel);r.enableResize&&!r.isFromGantt&&i._on(n(window),"resize",i._windowResize);i._enableEditingEvents();!i.model.isFromGantt&&r.contextMenuSettings.showContextMenu&&i._on(i.element,"contextmenu",i._rightClick)},_filterBarClose:function(t){var i=n(t.target),r;t.type=="click"&&i.hasClass("e-cancel")&&(r=i.prev(),r.focus().val(""),r.prop("checked",!1),r.trigger("keyup"),t.stopPropagation());t.type=="focusin"&&(i=n(t.target).next(),this.getHeaderTable().find(".e-cancel").addClass("e-hide"),i.removeClass("e-hide"))},_filterBarHandler:function(i){var u=this,e,o,h,c,s,f;if(u.clearSelection(u.selectedRowIndex),e=i.target==r?n(i):n(i.target),this.model.allowFiltering){for(o=u.model.columns,h=u._cellEditingDetails,c=u._queryManagar.queries[0],u._searchString=e.hasClass("e-checkbox")?e[0].checked:e.closest("input").val(),s=e[0].id.split("_"),u._fieldName=s[0],this._currentFilterColumn=o[f],f=0;f<o.length;f++)if(o[f].field==s[0]){this._currentFilterColumn=o[f];break}u._validateFilterValue(u._searchString);u.filterColumn(u._fieldName,this._operator,u._searchString,this._predicate);u.model.currentViewData.length>0&&t.TreeGrid.updateAltRow(u,u.model.currentViewData[0],0,0)}},_validateFilterValue:function(n){var i=this,u;this._predicate="and";switch(this._currentFilterColumn.filterEditType){case"numericedit":this._operator=t.FilterOperators.equal;break;case"datepicker":this._operator=t.FilterOperators.equal;u=this._currentFilterColumn.format==""||this._currentFilterColumn.format==r?Globalize.culture().calendar.patterns.d:this._currentFilterColumn.format.split(":")[1].replace("}","");this._currentFilterbarValue!=""&&(this._currentFilterbarValue=Globalize.format(n,u));break;case"datetimepicker":this._operator=t.FilterOperators.equal;u=this._currentFilterColumn.format==""?Globalize.culture().calendar.patterns.f:this._currentFilterColumn.format.split(":")[1].replace("}","");this._searchstring!=""&&(this._searchstring=Globalize.format(n,u));break;case"stringedit":this._operator=t.FilterOperators.startsWith;break;case"booleanedit":i._searchString==!0||i._searchString=="1"?i._searchString=!0:(i._searchString=="false"||i._searchString=="0")&&(i._searchString=!1);this._operator=t.FilterOperators.equal;break;default:this._operator=t.FilterOperators.equal}},_mouseHover:function(i){i.preventDefault();var u=n(i.target),r=this,f=0,e=0,l=r.getRows(),a=u.closest("tr"),s=u[0].parentNode,v=l.index(a),c=r.model.currentViewData[v],y,h,o;r._cellMouseLeave();i||(i=window.event);i.originalEvent.pageX||i.originalEvent.pageY?(f=i.originalEvent.pageX,e=i.originalEvent.pageY):(i.originalEvent.clientX||i.originalEvent.clientY)&&(f=i.originalEvent.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=i.originalEvent.clientY+document.body.scrollTop+document.documentElement.scrollTop);f+200>r._windowWidth&&(f-=f+200-r._windowWidth);e+150>r._windowHeight&&(e-=e+150-r._windowHeight);c&&(y={ttiptaskname:c.taskName},h=t.buildTag("table.e-tooltiptable","",{padding:"0"},{cellspacing:"1"}),r.model.showGridExpandCellTooltip==!1?u[0].firstChild&&u[0].firstChild.textContent?o=t.buildTag("tbody",u[0].firstChild.textContent,{},{}):s.childNodes.length>0&&s.childNodes[1]&&s.childNodes[1].textContent&&(o=t.buildTag("tbody",s.childNodes[1].textContent,{},{})):r.model.showGridExpandCellTooltip==!0&&u[0].firstChild&&u[0].firstChild.childNodes.length>0&&u[0].firstChild&&u[0].firstChild.textContent&&(o=t.buildTag("tbody",u[0].firstChild.textContent,{},{})),h.append(o),o&&(!r.model.showGridExpandCellTooltip&&r.model.showGridCellTooltip==!0&&u[0].firstChild||r.model.showGridExpandCellTooltip&&r.model.showGridCellTooltip==!0)&&(r._mouseOverTooltip=t.buildTag("div.e-tooltipgantt#tooltipgantt"+r._id+"",h,{top:e+10+"px",left:f+15+"px",position:"absolute","z-index":"5",padding:"0","border-radius":"3px"},{}),n(document.body).append(r._mouseOverTooltip)))},_cellMouseLeave:function(){var t=this;n("#tooltipgantt").remove();n(t._mouseOverTooltip).remove()},disableTooltip:function(){this._cellMouseLeave()},_createTooltipTemplate:function(){var i=this,u,e=i.model.columnHeaderTexts,f={_getTaskName:i._tooltipTaskName},t,r;n.views.helpers(f);t="<tr class='e-tooltip_rowcell'>";u="{{if ~_getTaskName()}}<td class='e-tooltiptaskname' style='height:auto;width:auto;font-weight:normal;'>{{:ttiptaskname}}<\/td>{{/if}}";t+=u;t+="<\/tr>";r={};r[i._id+"tooltipTemplate"]=t;n.templates(r)},_tooltipTaskName:function(){return this.data.ttiptaskname},_onScroll:function(n){var t=this,i;t._popupHide();t.model.showGridCellTooltip&&t._cellMouseLeave();n.scrollLeft!=r&&(t._scrollLeft=n.scrollLeft,i=Math.abs(t._scrollLeft-t._prevScrollLeft));i&&(t._$gridHeaderContainer.scrollLeft(t._scrollLeft),t._prevScrollLeft=t._scrollLeft);n.scrollTop!=r&&t.model.enableVirtualization&&(t._scrollTop=n.scrollTop,t._vScrollDir=t._prevScrollTop<=t._scrollTop?1:-1,t._vScrollDist=Math.abs(t._scrollTop-t._prevScrollTop),t._vScrollDist&&(t._updateCurrentViewData(),t._prevScrollTop=t._scrollTop))},_saveRow:function(){var r,f,u;for(proxy=this,form=n(document.getElementById(proxy._id+"EditForm")),formElement=n(form).find("td"),r=proxy.selectedRowIndex(),form.closest("tr").hasClass("e-addedrow")&&(r=form.closest("tr").index()),proxy._currentViewData=proxy.getCurrentViewData(),i=0;i<this.model.columns.length;i++)column=this.model.columns[i],value=proxy.getCurrentEditCellDataForRowEdit(column.field,column.editType,i),proxy._currentViewData[r][column.field]=proxy._currentViewData[r].item[column.field]=value;f=proxy._currentViewData[r].item;u=proxy._checkIsEmptyRow(f);u&&proxy.cancelRowEditCell();proxy.refreshRow(r);proxy._isRowEdit=!1;proxy.model.currentViewData.length>0&&t.TreeGrid.updateAltRow(proxy,proxy._currentViewData[0],0,0);proxy._cancelSaveTools();u||proxy.selectRows(r);proxy.refreshContent()},_onClick:function(r){var u=this,o=u.model,f=n(r.target),a,y,s,e;if(u._popupHide(),f.hasClass("e-icon")&&f.hasClass("e-down-arrow"))for(column=u.model.columns,object=null,i=0;i<column.length;i++)column[i].editType=="dropdownedit"&&(a=n("#"+u._id+column[i].field).data("ejDropDownList"),a&&(object=a.popupList),object&&object.hide()&&(n(object.show()),topposition=r.clientY+15,n(object).css({top:topposition})));for(y="",s=u.model.columns,n("#"+u._id+"EditForm").length==0&&u.element[0].focus(),u._clearContextMenu(),i=0;i<s.length;i++)s[i]&&(s[i].filterEditType=="datepicker"||s[i].filterEditType=="datetimepicker")&&(dateobj=n("#"+s[i].field+"_filterbarcell").data("ejDatePicker"),dateobj&&dateobj.length>0&&dateobj.hide());if(this.getHeaderTable().find(".e-cancel").addClass("e-hide"),f.hasClass("e-treegridexpand")||f.hasClass("e-treegridcollapse")){var c=f.closest("tr"),p=u.getRows(),w=p.index(c),h=o.currentViewData&&o.currentViewData[w],l=u._updatedRecords.indexOf(h),e={},v;e.data=h;e.recordIndex=l;e.expanded=c.hasClass("e-treegridrowexpand")?!1:!0;v=e.expanded?u._trigger("expanding",e):u._trigger("collapsing",e);v||o.isFromGantt||t.TreeGrid.sendExpandCollapseRequest(u,e)}else if(f.hasClass("e-rowcell")||f.parent().hasClass("e-rowcell")||f.closest("tr").hasClass("e-templaterow")||f.closest("td").hasClass("e-rowcell")&&f.hasClass("e-cell")){if(!o.allowSelection)return;o.selectionType==t.TreeGrid.SelectionType.Multiple&&(r.ctrlKey&&(u._multiSelectCtrlRequest=!0),r.shiftKey&&(u._multiSelectShiftRequest=!0,u.selectRows(u._previousIndex,u.getRows().index(f.closest("tr")))));u._multiSelectShiftRequest||n("#"+u._id+"EditForm").length!=0||(l=u.getRows().index(f.closest("tr")),l!=-1&&(h=o.currentViewData[l],e={rowElement:c,recordIndex:this.selectedRowIndex()},u._trigger("rowSelecting",e)||(o.selectedItem=h,this.selectedRowIndex(u._updatedRecords.indexOf(h)),u.selectRows(this.selectedRowIndex()),e={rowElement:c,data:u.model.selectedItem,target:"ejTreeGrid",recordIndex:this.selectedRowIndex()},u._cancelSaveTools(),u._trigger("rowSelected",e))));u._multiSelectShiftRequest=!1;u._isRowEdit&&(f.focus(),f.parents("form").length==0&&u._saveRow())}u._isRowEdit&&f.focus()},_onHeaderClick:function(i){var r=this,e=r.model,u,o,s,h,f;if(r._cellMouseLeave(),r._clearContextMenu(),n(i.target).is(".e-ascending, .e-descending")&&(i.target=i.target.parentNode),u=n(i.target),r.getHeaderTable().find(".e-columnheader").find(".e-headercellactive").removeClass("e-headercellactive"),u.hasClass("e-headercelldiv")){if(!e.allowSorting)return!1;r._isRowEdit=!1;o=n.trim(u.text());s=u.find("span").hasClass("e-ascending")?t.sortOrder.Descending:t.sortOrder.Ascending;e.allowMultiSorting&&i.ctrlKey&&(r._multiSortRequest=!0);r.sortColumn(o,s);h=r.selectedRowIndex();r.selectRows(h);r.model.isFromGantt&&this.selectedRowIndex()>=0&&(f={},f.data=r.model.selectedItem,f.target="ejTreeGrid",f.recordIndex=this.selectedRowIndex(),r._trigger("rowSelected",f))}return u.hasClass("e-checkbox")?!0:!1},_headerMouseDown:function(t){var i=this,r=i.model,u;i._cellMouseLeave();r.allowColumnResize&&i._resizer._mouseDown(t);n(t.target).hasClass("headercelldiv")&&n(t.target).hasClass("headercell")&&(u=n(t.target).hasClass("headercelldiv")?n(t.target).parent():n(t.target),r.headerEffects&&u.addClass("headercellactive"))},_enableColumnResizeEvents:function(){var n=this;n.model.allowColumnResize?(n._on(n.element,"mousemove",n._mouseMove),n._on(n.element,"mouseup",n._mouseUp)):(n._off(n.element,"mousemove",n._mouseMove),n._off(n.element,"mouseup",n._mouseUp))},_mouseMove:function(n){var t=this;t.model.allowColumnResize&&(t._resizer._mouseMove(n),t._$gridHeaderContainer.scrollLeft(t._$gridContent.ejScroller("option","scrollLeft")))},_mouseUp:function(t){var i=this;i.model.allowColumnResize&&((n(t.target).hasClass("e-headercelldiv")||n(t.target).hasClass("e-reSizeColbg"))&&(i.model.isEdit?i.saveCell():i._isRowEdit&&i._saveRow(),i.element.focus()),i._resizer._mouseUp(t),i._$gridHeaderContainer.scrollLeft(i._$gridContent.ejScroller("option","scrollLeft")),i._resizeFilteringElements())},_resizeFilteringElements:function(){var n=this,r;if(n.model.allowFiltering)for(r={},t.TreeGrid.Actions.Filter="filtering",r.requestType=t.TreeGrid.Actions.Filter,i=0;i<n.model.columns.length;i++)n.model.columns[i].width=n._columnsWidthCollection[i],r.fieldname=n.model.columns[i].field,this._filteringElements(r)},_enableEditingEvents:function(){var n=this,t=n.model;t.editSettings.allowEditing?((t.editSettings.editMode=="cellEditing"||t.editSettings.editMode.toLowerCase()=="rowediting")&&n._on(n.element,"mousedown",".e-gridcontent",n._saveCellHandler),n._on(this.element,"dblclick",".e-gridcontent",n._editdblClickHandler)):((t.editSettings.editMode=="cellEditing"||t.editSettings.editMode.toLowerCase()=="rowediting")&&n._off(n.element,"mousedown",".e-gridcontent",n._saveCellHandler),n._off(this.element,"dblclick",".e-gridcontent",n._editdblClickHandler))},_saveCellHandler:function(t){var i=n(t.target),r=this;i.hasClass("e-vhandle")||i.hasClass("e-vscroll")||i.hasClass("e-vup")||i.hasClass("e-vdown")||i.hasClass("e-vhandlespace")||i.hasClass("e-hhandle")||i.hasClass("e-hscroll")||i.hasClass("e-hup")||i.hasClass("e-hdown")||i.hasClass("e-hhandlespace")||(t.stopPropagation(),r._isRowEdit?i.closest("form#"+r._id+"EditForm").length==0&&r._saveRow():i.closest(".e-popup").length==0&&i.closest(".e-rowcell").find("#"+r._id+"EditForm").length==0&&r.saveCell())},_rightClick:function(t){var i=this,f=n(t.target),e=f[0].parentNode,o,s,r,u,h={};i._clearContextMenu();i.disableTooltip();(f.hasClass("e-cell")||f.hasClass("e-treegridexpand"))&&(e=f.closest("tr"));o=n(e).hasClass("e-treegridrows")||n(e).hasClass("e-rowcell")?i.getRows():n(i.getRows());s=f.closest("tr");r=o.index(s);i._currentViewData=i.getCurrentViewData();u=i._currentViewData[r];r=i._updatedRecords.indexOf(u);h.data=u;h.recordIndex=r;i.dataSource()==null||i.dataSource().length==0||f.closest("form#"+i._id+"EditForm").length>0?(i._contextMenuItems=[],i._contextMenuItems=i._getContextMenuItems(),i._subContextMenuItems=[],i._updateContextmenuOption(r,u),i._clearContextMenu(),i._contextMenuItems.length>0&&i._renderContextMenu(t,r,u)):u&&(t.preventDefault(),i._contextMenuItems=[],i._contextMenuItems=i._getContextMenuItems(),i._subContextMenuItems=[],i._subContextMenuItems=i._getsubContextMenuItems(),i._updateContextmenuOption(r,u),i._clearContextMenu(),i._contextMenuItems.length>0&&i._renderContextMenu(t,r,u),i.selectRows(r))},_editdblClickHandler:function(i){var r=this,f=r.model,e=n("#"+r._id+"EditForm"),o={},u=n(i.target);if(!u.hasClass("e-vhandle")&&!u.hasClass("e-vscroll")&&!u.hasClass("e-vup")&&!u.hasClass("e-vdown")&&!u.hasClass("e-vhandlespace")&&!u.hasClass("e-hhandle")&&!u.hasClass("e-hscroll")&&!u.hasClass("e-hup")&&!u.hasClass("e-hdown")&&!u.hasClass("e-hhandlespace")){if(f.editSettings.editMode==="normal"&&(o.requestType=t.TreeGrid.Actions.BeginEdit,r._trigger("actionBegin",o)),r._cellEditingDetails.cancelSave){r._cellEditingDetails.cancelSave=!1;return}e.length===0&&r.getRows()!==null&&(f.editSettings.editMode=="cellEditing"?(r.element.focus(),r._cellEditingDetails.columnIndex=r.getCellIndex(i),r._cellEditingDetails.rowIndex=r.getRowIndex(i),fieldName=r._cellEditingDetails.columnIndex>=0&&f.columns[r._cellEditingDetails.columnIndex].field,fieldName&&f.editSettings.allowEditing&&f.editSettings.editMode==t.TreeGrid.EditMode.CellEditing&&r.cellEdit(r._cellEditingDetails.rowIndex,fieldName)):f.editSettings.editMode.toLowerCase()=="rowediting"&&(r._currentViewData=r.getCurrentViewData(),r.getCellIndex(i)!=-1&&r.getRowIndex(i)!=-1&&r._editRow(r.getRowIndex(i))),e=n("#"+r._id+"EditForm"),e.length>0&&r._editAddTools());r._clearContextMenu()}},_popupHide:function(){var u=this,t=u.model.columns,r=null,f;for(i=0;i<t.length;i++)t[i]&&(t[i].editType=="datepicker"||t[i].editType=="datetimepicker"?r=n("#"+u._id+t[i].field).data("ejDatePicker"):t[i].editType=="dropdownedit"&&(f=n("#"+u._id+t[i].field).data("ejDropDownList"),f&&(r=f.popupList)),r&&r.hide())},_mouseWheel:function(n){var t=this,i=null,f=n;t._popupHide();n=n.originalEvent;try{n.preventDefault?n.preventDefault():f.preventDefault()}catch(o){}if(t._$gridContent.height()>t._$gridContainer.height()){t._$gridContent.ejScroller("scrollY",0,!0);return}if(n.wheelDelta?(i=-n.wheelDelta/120,window.opera&&parseFloat(window.opera.version,10)<10&&(i=-i)):n.detail&&(i=n.detail/3),!i)return!1;var e=t._$gridContent.ejScroller("option","scrollTop"),r=e+i*57,u=parseInt(t._updatedRecords.length*30)-(t._viewPortHeight-18);return r>u&&(r=u),r<0&&(r=0),t._updateScrollTop(r),!0},_getCollapsedParentItem:function(n){var t=n.parentItem;return t?t.expanded===!1?t:this._getCollapsedParentItem(t):null},_keyPressed:function(i,r,u){var f=this,ft=f.element,l=ft.ejTreeGrid("instance"),e=l.model,w,k,it,a,tt,rt,v,y,et,d,b,h;if(!e.allowKeyboardNavigation)return!1;w=!1;k=n(r);$form=n("#"+f._id+"EditForm");switch(i){case"saveRequest":f._isRowEdit?f._saveRow():e.editSettings.editMode=="cellEditing"&&$form.length>0&&l._moveCurrentCell("down");e.filterBarMode=="onEnter"&&e.allowFiltering&&f._filterBarHandler(r);break;case"cancelRequest":$form.length>0&&(e.editSettings.editMode=="cellEditing"?f._isRowEdit?f.cancelRowEditCell():l.cancelEditCell():e.editSettings.editMode.toLowerCase()=="rowediting"&&(f.refreshRow(f._editedRowIndex),f._isRowEdit=!1));break;case"editRecord":e.editSettings.allowEditing&&e.editSettings.editMode=="cellEditing"&&(l._cellEditingDetails.rowIndex=this.selectedRowIndex(),l._cellEditingDetails.columnIndex=f.getCellIndex(u,r),l._cellEditingDetails.columnIndex!==-1&&(fieldName=l.model.columns[l._cellEditingDetails.columnIndex].field,fieldName&&l.cellEdit(l._cellEditingDetails.rowIndex,fieldName)));break;case"firstRowSelection":if(f._isRowEdit||f.model.isEdit)return!0;f._rowSelectingEventTrigger()||(f.selectRows(0),c=f._updatedRecords.indexOf(e.selectedItem),s=c!==-1&&c*e.rowHeight,it=f._$gridContainer.height(),it>f._viewPortHeight&&(o={requestType:"scroll",delta:s},f._scrollTop=s,f._completeAction(o),f._$gridContent.children(".e-content").scrollTop(s)),e.enableVirtualization&&(f.selectRows(0),f.element[0].focus()),f._rowSelectedEventTrigger(0));break;case"lastRowSelection":if(f._isRowEdit||f.model.isEdit)return!0;f._rowSelectedEventTrigger()||(a=f._updatedRecords.length-1,v=f._updatedRecords[a],!e.enableVirtualization&&v.parentItem?(y=f._getCollapsedParentItem(v),y?(d=f.getChildCount(y,0),f.selectRows(a-d)):f.selectRows(a)):f.selectRows(a),c=e.selectedItem&&f._updatedRecords.indexOf(e.selectedItem),s=a!==-1&&c*e.rowHeight,s+f.model.rowHeight>=f._viewPortHeight&&(h=s+f.model.rowHeight-(f._viewPortHeight-f._scrollBarHeight)-f.getCollapsedRecordCount()*e.rowHeight,h>=0&&(o={requestType:"scroll",delta:h},f._scrollTop=h,f._completeAction(o)),e.enableVirtualization&&(f.selectRows(c),f.element[0].focus())),f._rowSelectedEventTrigger(c));break;case"moveCellLeft":f._isRowEdit?(previousElement=k.closest("td").prev("td"),previousElement.length&&f._focusElementsForRowEdit(previousElement)):e.editSettings.allowEditing&&e.editSettings.editMode=="cellEditing"&&$form.length>0&&(w=f._moveCurrentCell("left"));break;case"moveCellRight":f._isRowEdit?(nextElement=k.closest("td").next("td"),nextElement.length&&f._focusElementsForRowEdit(nextElement)):e.editSettings.allowEditing&&e.editSettings.editMode=="cellEditing"&&k&&$form.length>0&&(w=f._moveCurrentCell("right"));break;case"downArrow":if(f._isRowEdit||f.model.isEdit)return!1;if(!f._rowSelectingEventTrigger()&&(a=f._updatedRecords.length-1,f.selectedRowIndex()!=a)){e.enableVirtualization||e.selectedItem.expanded?f.selectRows(f.selectedRowIndex()+1):(tt=f.getChildCount(e.selectedItem,0),rt=f.selectedRowIndex()+tt+1,a>=rt&&f.selectRows(f.selectedRowIndex()+tt+1));e.selectedItem.isSelected=!0;var c=e.selectedItem&&f._updatedRecords.indexOf(e.selectedItem),s=a!==-1&&c*e.rowHeight,h,ut,b=f._$gridContent.children(".e-content").length;h=b?f._$gridContent.children(".e-content").scrollTop():f._$gridContent.scrollTop();ut=h+f._viewPortHeight-f._scrollBarHeight-e.rowHeight+f.getCollapsedRecordCount()*e.rowHeight;ut<s&&(o={requestType:"scroll",delta:h+e.rowHeight},f._completeAction(o),b?f._$gridContent.children(".e-content").scrollTop(h+e.rowHeight):f._$gridContent.scrollTop(h+e.rowHeight),e.enableVirtualization&&f.element[0].focus());f._rowSelectedEventTrigger(f.selectedRowIndex())}break;case"rightArrow":if(f._isRowEdit||f.model.isEdit)return!0;var g=f.selectedRowIndex(),p=f._updatedRecords[g],o={},nt;o.data=p;o.recordIndex=g;o.expanded=!0;f._rowSelectingEventTrigger()||!p.hasChildRecords||p.expanded||f.selectedRowIndex()>=0&&(nt=f._trigger("expanding",o),nt||e.isFromGantt||t.TreeGrid.sendExpandCollapseRequest(f,o));break;case"leftArrow":if(f._isRowEdit||f.model.isEdit)return!0;var g=f.selectedRowIndex(),p=f._updatedRecords[g],o={},nt;o.data=p;o.recordIndex=g;o.expanded=!1;!f._rowSelectingEventTrigger()&&p.hasChildRecords&&p.expanded&&f.selectedRowIndex()>=0&&(nt=f._trigger("collapsing",o),nt||e.isFromGantt||t.TreeGrid.sendExpandCollapseRequest(f,o));break;case"upArrow":if(f._isRowEdit||f.model.isEdit)return!1;f._rowSelectingEventTrigger()||f.selectedRowIndex()!==0&&(v=f._updatedRecords[f.selectedRowIndex()-1],!e.enableVirtualization&&v.parentItem?(y=f._getCollapsedParentItem(v),y?(d=f.getChildCount(y,0),f.selectRows(f.selectedRowIndex()-d-1)):f.selectRows(f.selectedRowIndex()-1)):f.selectRows(f.selectedRowIndex()-1),e.selectedItem.isSelected=!0,c=f._updatedRecords.indexOf(e.selectedItem),s=c!==-1&&c*e.rowHeight-f.getCollapsedRecordCount()*e.rowHeight,b=f._$gridContent.children(".e-content").length,h=b?f._$gridContent.children(".e-content").scrollTop():f._$gridContent.scrollTop(),h&&h>s&&(o=s>=0?{requestType:"scroll",delta:s}:{requestType:"scroll",delta:0},b?f._$gridContent.children(".e-content").scrollTop(o.delta):f._$gridContent.scrollTop(o.delta),f._completeAction(o),e.enableVirtualization&&(f.selectRows(f.selectedRowIndex()),f.element[0].focus())),f._rowSelectedEventTrigger(f.model.selectedRowIndex));break;default:w=!0}return w},filterColumn:function(i,r,u,f,e,o){var h,a,w,c,s,b,l,v,p;if(this.model.allowFiltering){for(h={},t.TreeGrid.Actions.Filter="filtering",h.requestType=t.TreeGrid.Actions.Filter,h.currentFilterObject=[],n.isArray(r)||(r=n.makeArray(r)),n.isArray(u)||(u=n.makeArray(u)),a=!1,w=this._filterCollection,t.util.isNullOrUndefined(this._currentFilterColumn)&&(this._currentFilterColumn=this.getColumnByField(i)),c=0;c<r.length;c++){if(s={field:i,operator:r[c],value:u[c],matchcase:e,predicate:f,actualFilterValue:o},this._$colType="string",this._filteredColumns.length==0&&s.value!=="")this._$colType=="date"&&(r=="equal"||r=="notequal")&&typeof s.value!="string"?this._setDateFilters(s):this._filteredColumns.push(s);else{if(b=this,!a){var k=t.DataManager(this._filteredColumns),d=(new t.Query).where("field",t.FilterOperators.equal,s.field),y=k.executeLocal(d);for(l=0;l<y.length;l++)v=n.inArray(y[l],this._filteredColumns),v!=-1&&this._filteredColumns.splice(v,1)}s.value!==""&&(this._$colType=="date"&&(r=="equal"||r=="notequal")&&typeof s.value!="string"?this._setDateFilters(s):this._filteredColumns.push(s))}a=!0;h.currentFilterObject.push(s)}h.filterCollection=this._filteredColumns;h.currentFilteringColumn=i;h.fieldName=i;p=this.processBindings(h);p&&(this._filteredColumns.reverse().splice(0,r.length),this._filteredColumns.reverse())}},_rowSelectingEventTrigger:function(){var t=this,n=t.model,r={},i,u;return n.currentViewData.length<=0&&this.selectedRowIndex(-1),this.selectedRowIndex()!==-1&&n.currentViewData.length>0&&(u=t.getRows(),i=n.currentViewData[this.selectedRowIndex()],n.selectedItem=i,r={rowElement:u.eq(this.selectedRowIndex()),data:i,recordIndex:this.selectedRowIndex()}),t._trigger("rowSelecting",r)},_rowSelectedEventTrigger:function(n){var t=this,r=t.model,i={},u=t.getRows();r.currentViewData.length>0&&(i={rowElement:u.eq(n),data:t.model.selectedItem,target:"ejTreeGrid",recordIndex:n},t._trigger("rowSelected",i))},_eventBindings:function(){var t=this,i=t.model,n=0,r=t._gridRows,u=r.length;if(i.queryCellInfo!=null||i.rowDataBound!=null)for(n;n<u;n++)t._rowEventTrigger(r[n],i.flatRecords[n])},_rowEventTrigger:function(t,i){var f=this;f._trigger("rowDataBound",{rowElement:t,data:i});var u=t.cells,o=n(t).find(".e-rowcell"),r=0,s=u.length,e,h=f.model.columns;for(r;r<s;r++)n(u[r]).hasClass("e-rowcell")&&(e=h[o.index(u[r])]),e&&f._cellEventTrigger(u[r],i,e)},_cellEventTrigger:function(n,t,i){var r={cellElement:n,data:t,column:i};r.cellValue=r.column&&t[r.column.field];this._trigger("queryCellInfo",r)},_completeAction:function(i){var r=this,f=r.model,e=f.sortSettings.sortedColumns,u,o;if(f.isEdit=!1,t.TreeGrid.Actions.Sorting==i.requestType&&f.allowSorting||t.TreeGrid.Actions.Refresh==i.requestType){if(f.allowSorting)for(r._multiSortRequest||(r.getHeaderTable().find(".e-columnheader").find(".e-headercelldiv").find(".e-ascending,.e-descending").remove(),r.getHeaderTable().find("[aria-sort]").removeAttr("aria-sort")),u=0;u<e.length;u++)r._addSortElementToColumn(e[u].field,e[u].direction);r._multiSortRequest=!1}else t.TreeGrid.Actions.BeginEdit==i.requestType||t.TreeGrid.Actions.Add==i.requestType?(o=n("#"+r._id+"EditForm"),r.model.isEdit=!0,r.setWidthToColumns(),t.TreeGrid.Actions.Add==i.requestType&&o.find(".e-field:disabled").not(".e-identity").removeAttr("disabled").removeClass("e-disable")):i.requestType==="scroll"&&(r._updateCurrentViewData(),!r.model.isFromGantt&&i.delta>=0&&r.isVScroll()&&r.model.enableVirtualization&&(!r._$gridContent.ejScroller("isHScroll")&&i.delta>=18&&(i.delta-=r._scrollBarHeight,r._scrollTop=i.delta),r._$gridContent.ejScroller("scrollY",i.delta,!0)));r._trigger("actionComplete",i)},sendDataRenderingRequest:function(i){var r=this,u,f;if(r.model.currentViewData.length)switch(i.requestType){case t.TreeGrid.Actions.Delete:case t.TreeGrid.Actions.Refresh:case t.TreeGrid.Actions.Save:case t.TreeGrid.Actions.Filter:case t.TreeGrid.Actions.Sorting:case t.TreeGrid.Actions.Searching:case t.TreeGrid.Actions.ExpandCollapse:case t.TreeGrid.Actions.RefreshDataSource:u=document.createElement("div");r.getContentTable().find("colgroup").first().replaceWith(r._getMetaColGroup());f=r.getContentTable().children("tbody");f.empty();u.innerHTML=["<table>",n.render[r._id+"_Template"](r.model.currentViewData),"<\/table>"].join("");r.getContentTable().get(0).replaceChild(u.firstChild.firstChild,r.getContentTable().get(0).lastChild);r._gridRows=r.getContentTable().get(0).rows;r.setGridRows(n(r.getContentTable().get(0).rows));r._eventBindings()}else r.getContentTable().find("tbody").empty().append(r._getEmptyTbody()),r._gridRows=null,r.setGridRows(null);r._completeAction(i)},sortColumn:function(i,u){var f=this,o=f.model,h=o.sortSettings.sortedColumns,s={},e=0,l=h.length,c;if(o.allowSorting&&n.inArray(i,f._disabledSortableColumns)==-1&&i.length!=0){for(f._multiSortRequest||(o.sortSettings.sortedColumns=[]),s.requestType=t.TreeGrid.Actions.Sorting,s.columnName=i,f._cSortedColumn=f.getFieldNameByHeaderText(i),f._cSortedDirection=s.columnSortDirection=u===r?t.sortOrder.Ascending:u,e;e<l;e++)if(h[e].field==f._cSortedColumn){h.splice(e,1);break}o.sortSettings.sortedColumns.push({field:f._cSortedColumn,direction:f._cSortedDirection});c=f.processBindings(s);c&&(f._cSortedDirection=f._cSortedColumn=null)}},deleteRow:function(n){var i=this,e,o,r={},f,u;for(length=i._selectedRowsIndexes.length,i._selectedRowsIndexes.sort(),f=0,u=0;u<length;u++){if(n=t.isNullOrUndefined(n)?i.getRowByIndex(i._selectedRowsIndexes[u]):i.getRowByIndex(i._selectedRowsIndexes[u]-f),e=i.getRows().index(n),o=i.model.currentViewData[e],r.tr=n,r.data=o,r.requestType=t.TreeGrid.Actions.Delete,i._trigger("actionBegin",r))return!0;i.processBindings(r);f++;i.model.currentViewData.length>0&&t.TreeGrid.updateAltRow(i,i.model.currentViewData[0],0,0)}i._selectedRowsIndexes=[];i._previousIndex=-1},search:function(n){var r=this,i={};i.requestType=t.TreeGrid.Actions.Searching;i.keyValue=n;r._searchString=n;r.processBindings(i)},endEdit:function(){var n=this;return n.model.editSettings.editMode=="cellEditing"&&!n._isRowEdit?n.saveCell():!0},getVisibleRange:function(){var n=this,r=n._scrollTop/n.model.rowHeight,u=r-Math.floor(r),t,i,f=n.model;return n._offset=u*f.rowHeight,t=Math.floor(r),i=n._getRowPosition(n._scrollTop+n._viewPortHeight),t=Math.max(0,t),i=Math.min(n.getRecordsCount(),i),n._visibleRange={top:t,bottom:i},n._visibleRange},setWidthToColumns:function(){var i=this,s=i.model,f=i.getContentTable().children("colgroup").find("col"),r=i.getHeaderTable().children("colgroup").find("col"),o=i._gridWidth,u=s.columns.length,n,e;for(f.length>u&&f.splice(0,f.length-u),r.length>u&&r.splice(0,r.length-u),n=0;n<r.length;n++)t.isNullOrUndefined(i._columnsWidthCollection[n])?(e=(o/u).toFixed(2)+"px",f.eq(n).css("width",e),r.eq(n).css("width",e),i._columnsWidthCollection[n]=(o/u).toFixed(2)):(f.eq(n).width(i._columnsWidthCollection[n]),r.eq(n).width(i._columnsWidthCollection[n]))},cellEdit:function(i,r){var u=this,o,s=u.model,f,e;return(u.model.showGridCellTooltip&&u._cellMouseLeave(),u.model.isEdit&&u.saveCell(),o=n("#"+u._id+"EditForm"),o.length>0)?!0:u.model.selectedItem?s.isFromGantt&&(r==="status"||r==="startDate"||r==="endDate"||r==="duration"||r==="predecessor")&&u.model.selectedItem.hasChildRecords||r==="baselineStartDate"||r==="baselineEndDate"||r==="taskId"?!1:u.getRows()[i]?(f=n(u.getRows()[i]),columnIndex=u.getColumnIndexByField(r),$targetTd=f.find(".e-rowcell").eq(columnIndex),column=u.model.columns[columnIndex],data=u.model.selectedItem,beginEditArgs={},args={validationRules:t.isNullOrUndefined(column.validationRules)?{}:n.extend(!0,{},column.validationRules),columnName:column.field,value:t.isNullOrUndefined(data[r])?data.item&&data.item[r]:data[r],data:data,columnObject:column,cell:$targetTd},isEditable=!0,s.isFromGantt&&args.columnName==="predecessor"&&(e=args.data.item[u.model.predecessorMapping],args.value=e?e:""),beginEditArgs.data=data,beginEditArgs.columnIndex=columnIndex,beginEditArgs.rowElement=f,beginEditArgs.cellElement=$targetTd,u._cellEventTrigger(f[0].cells[u._cellEditingDetails.columnIndex],data,args.columnObject),u._trigger("beginEdit",beginEditArgs))?!1:((n.inArray(r,u._primaryKeys)!=-1||args.columnObject.allowEditing===!1)&&(n.extend(u._cellEditingDetails,{cellValue:args.value,rowIndex:i,fieldName:r,data:args.data,columnIndex:columnIndex}),isEditable=!1),f.hasClass("e-insertedrow")&&!args.columnObject.isTemplateColumn&&(isEditable=!0),isEditable&&n.extend(u._cellEditingDetails,{rowIndex:i,cellValue:args.value,columnIndex:columnIndex,fieldName:r,cellEditType:args.columnObject.editType,data:data}),u._renderCellEditObject(args,$targetTd),f.hasClass("e-templaterow")||(f.addClass("e-editedrow"),args.cell&&args.cell.addClass("e-editedcell")),!0):void 0:!1},_validatePredecessorString:function(n){var i=this,t;if(n.length>0)n.split(",").forEach(function(n){values=n.split("+");offsetvalue="+";n.indexOf("-")>=0&&(values=n.split("-"),offsetvalue="-");match=values[0].match(/(\d+|[A-z]+)/g);i.model.ids.indexOf(match[0])!=-1?match[1]&&(match[1].toUpperCase()=="FS"||match[1].toUpperCase()=="FF"||match[1].toUpperCase()=="SF"||match[1].toUpperCase()=="SS"||(t=!1)):t=!1});else return!0;return t===r||t?!0:!1},saveCell:function(){var r=this,u=r.model,l,d,s,f,g,nt,e,rt;if(n("#"+r._id+"EditForm").length>0){if(!r.editFormValidate())return!0;if(r._cellEditingDetails.columnIndex>=0){var p=n("#"+r._id+"EditForm"),w=p.closest("tr"),ut=p.closest("td"),b,i={},o=u.columns[r._cellEditingDetails.columnIndex],c=n("#"+r._id+r._cellEditingDetails.fieldName),k;if(i={columnName:o.field,value:r.getCurrentEditCellData(),data:r._cellEditingDetails.data,previousValue:r._cellEditingDetails.cellValue,columnObject:o,cellElement:ut,rowElement:w},(r._cellEditingDetails.cellEditType=="datetimepicker"||r._cellEditingDetails.cellEditType=="dropdownedit"||r._cellEditingDetails.cellEditType=="datepicker")&&c.data("ejWidgets")&&c[c.data("ejWidgets")[0]]("destroy"),r._cellEditingDetails.cellEditType==="datepicker"&&(i.value=r.getFormatedDate(i.value)),t.isNullOrUndefined(o.format)?i.columnObject.type=="boolean"?(l={},l[i.columnObject.field]=i.value,i.cellElement.empty().html(n(n.templates.Grid_JSONTemplate.render(l))[0].cells[r._cellEditingDetails.columnIndex].innerHTML)):i.cellElement.empty().html(i.value):(b=r.formatting(o.format,i.value),i.cellElement.empty().html(b)),d=(r._cellEditingDetails.cellEditType=="datepicker"||r._cellEditingDetails.cellEditType=="datetimepicker")&&i.value instanceof Date&&i.previousValue instanceof Date?i.value.getTime()!==i.previousValue.getTime():i.value!==i.previousValue,u.isEdit=!1,s=r._cellEditingDetails.fieldName,u.isFromGantt&&s==="predecessor"){f={};g=r._validatePredecessorString(i.value);g?(f.predecessorString=i.value.split(","),f.data={},f.data[u.taskIdMapping]=i.data.taskId,f.requestType="validatePredecessor",r._trigger("actionComplete",f),nt=f.result,nt||(i.value=i.previousValue)):i.value=i.previousValue;i.value=i.value.toUpperCase();var a=[],tt=[],v=[],h=0,it,y;for(i.previousValue=i.data.predecessor,tt=i.previousValue,i.value.length>0&&(v=i.data._calculatePredecessor(i.value)),it=v.length,e=0,rt=i.previousValue&&i.previousValue.length,e=0;e<rt;e++)y=tt[e],y.from===i.data.taskId.toString()&&a.push(y);for(h=0;h<it;h++)a.push(v[h]);i.data[r._cellEditingDetails.fieldName]=a;i.data.item[u.predecessorMapping]=i.value}else if(d){if(u.isFromGantt)switch(s){case"taskId":i.data.item[u.taskIdMapping]=i.value;break;case"taskName":i.data.item[u.taskNameMapping]=i.value;break;case"startDate":i.data.item[u.startDateMapping]=i.value;break;case"endDate":i.data.item[u.endDateMapping]=i.value;break;case"resourceInfo":i.data.item[u.resourceInfoMapping]=r._getResourceId(i.value);break;case"duration":i.data.item[u.durationMapping]=i.value;break;case"status":i.data.item[u.progressMapping]=i.value;break;default:i.data.item[r._cellEditingDetails[s]]=i.value}else i.data.item[r._cellEditingDetails.fieldName]=i.value;i.data[r._cellEditingDetails.fieldName]=i.value}u.isFromGantt&&(i.columnName==="startDate"||i.columnName==="endDate"||i.columnName==="duration"||i.columnName==="predecessor"||i.columnName=="status")&&(i.isModified=!0);k=n(n.render[r._id+"_Template"](i.data))[0].cells[r._cellEditingDetails.columnIndex];i.cellElement.removeClass("e-editedcell").replaceWith(k);r._trigger("refresh");i.data.treeMappingName||(i.data.treeMappingName=[]);i.data.treeMappingName.push(i.columnName);r._trigger("endEdit",i)&&(i.data[i.columnName]=i.previousValue,i.data.item[i.columnObject.field]=i.previousValue,r.selectRows(this.selectedRowIndex()),r.refreshRow(this.selectedRowIndex()));r._cellEventTrigger(i.rowElement[0].cells[r._cellEditingDetails.columnIndex],i.data,i.columnObject);w.removeClass("e-editedrow")}}return r._cancelSaveTools(),!1},editFormValidate:function(){return n.isFunction(n.validator)?n("#"+this._id+"EditForm").validate({onsubmit:!1}).form():!0},getCurrentEditCellData:function(){var u=this,f=u.model,r,i;if(n("#"+u._id+"EditForm").length){r=n("#"+u._id+u._cellEditingDetails.fieldName);switch(u._cellEditingDetails.cellEditType){case t.TreeGrid.EditingType.String:i=r.val();break;case t.TreeGrid.EditingType.Numeric:i=r.ejNumericTextbox("getValue");r.ejNumericTextbox("getValue");break;case t.TreeGrid.EditingType.Dropdown:i=f.isFromGantt?u._getSelectedItem(r.ejDropDownList("model.selectedItems")):r.ejDropDownList("model.value");break;case t.TreeGrid.EditingType.Boolean:i=r.is(":checked");break;case t.TreeGrid.EditingType.DatePicker:i=f.dateFormat.indexOf("hh")==-1?r.ejDatePicker("model.value"):r.ejDateTimePicker("model.value");break;case t.TreeGrid.EditingType.DateTimePicker:i=Globalize.format(r.ejDateTimePicker("model.value"),"MM/dd/yyyy hh:mm tt")}return typeof i=="string"&&i.length&&f.columns[u._cellEditingDetails.columnIndex].type=="number"&&(i=parseFloat(i)),i}return null},getCurrentEditCellDataForRowEdit:function(i,r,u){var o=this,s=o.model,f,e;if(n("#"+o._id+"EditForm").length){f=n("#"+o._id+i);switch(r){case t.TreeGrid.EditingType.String:e=f.val();break;case t.TreeGrid.EditingType.Numeric:e=f.ejNumericTextbox("getValue");f.ejNumericTextbox("getValue");break;case t.TreeGrid.EditingType.Dropdown:e=f.ejDropDownList("model.value");f.data("ejWidgets")&&f[f.data("ejWidgets")[0]]("destroy");break;case t.TreeGrid.EditingType.Boolean:e=f.is(":checked");break;case t.TreeGrid.EditingType.DatePicker:e=Globalize.format(f.ejDatePicker("model.value"),this.model.dateFormat);f.data("ejWidgets")&&f[f.data("ejWidgets")[0]]("destroy");break;case t.TreeGrid.EditingType.DateTimePicker:e=Globalize.format(f.ejDateTimePicker("model.value"),"MM/dd/yyyy hh:mm tt");f.data("ejWidgets")&&f[f.data("ejWidgets")[0]]("destroy")}return typeof e=="string"&&e.length&&s.columns[u].type=="number"&&(e=parseFloat(e)),e}return null},_getResourceId:function(n){for(var i=[],t=0,r=n.length,t=0;t<r;t++)i.push(n[t][this.model.resourceIdMapping]);return i},_getSelectedItem:function(t){var r=this,i=0,e=t.length,u=r.model.columns[r._cellEditingDetails.columnIndex].dropdownData,f=[];if(u)for(i=0;i<e;i++)n.each(u,function(n,r){t[i]===n&&f.push(r)});return f},getFormatedDate:function(n){return Globalize.format(n,this.model.dateFormat)},formatting:function(t,i){var r,u,s,e,o,h,c,f;return t=t.replace(/%280/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=this,u=t,s=t.split("{0:"),h=t.split("}"),e=s[0],o=h[1],t.indexOf("{0:")!=-1?(c=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),f=c.exec(t),f!=null&&i!=null?e!=null&&o!=null?e+Globalize.format(i,f[2])+o:Globalize.format(i,f[2]):i!=null?i:""):r.data!=null&&r.data.Value==null?(n.each(r.data,function(n,t){u=u.replace(new RegExp("\\{"+n+"\\}","gm"),t)}),u):r.data.Value},getColumnIndexByField:function(n){var r=this,i=r.model.columns,u=i.length,t=0;for(t;t<u;t++)if(i[t].field==n)break;return t},getBrowserDetails:function(){var n=navigator.userAgent.match(/(firefox|chrome|opera|msie|safari)\s?\/?(\d+(.\d+)*)/i);return!navigator.userAgent.match(/Trident\/7\./)?{browser:n[1].toLowerCase(),version:n[2]}:{browser:"msie",version:jQuery.uaMatch(navigator.userAgent).version}},setValidation:function(){var r=this,i=r.model.columns,u=i.length,n=0;for(r._initValidator(),n;n<u;n++)t.isNullOrUndefined(i[n].validationRules)||r.setValidationToField(i[n].field,i[n].validationRules)},setValidationToField:function(i,r){var u=this,e=n("#"+u._id+i).length>0?n("#"+u._id+i):n("#"+i),f;e.rules("add",r);f=n("#"+u._id+"EditForm").validate({onsubmit:!1});t.isNullOrUndefined(r.required)||(f.settings.messages[i]={},f.settings.messages[i].required=t.TreeGrid.getColumnByField(u.model.columns,i).headerText+" is required")},getFieldNameByHeaderText:function(n){var i=this;return t.isNullOrUndefined(i._fieldColumnNames[n])?null:i._fieldColumnNames[n]},clearSelection:function(n){var r=this,c=r.model,e,n,o,l,s,f,h,u;if(this.selectedRowIndex()!=-1&&(e=r.getRows(),!t.isNullOrUndefined(n))){for(i=0;i<this._selectedRowsIndexes.length;i++)r.getRowByIndex(this._selectedRowsIndexes[i]).removeAttr("aria-selected").find(".e-selectionbackground").removeClass("e-selectionbackground").removeClass("e-active");if(o=c.flatRecords[n],o)o.isSelected=!1;else if(e&&e.removeAttr("aria-selected").find(".e-rowcell").removeClass("e-selectionbackground").removeClass("e-active"),l=new t.DataManager(c.flatRecords),s=new t.Query,s.search(!0,["isSelected"],t.FilterOperators.Equals,!0),f=l.executeLocal(s),h=f&&f.length,h>0)for(u=0,u=0;u<h;u++)f[u].isSelected=!1;r._selectedRowsIndexes.length||(r.selectedRowIndex(-1),r.model.selectedItem=null)}},updateExpandCollapseRecords:function(n,t){var i=this;n.expanded=t;i._removedCount=0;i._expandCollapseRecordCount=i.getChildRecordsCount(n);index=i.model.flatRecords.indexOf(n);t?(i._tempRecordIndex=i.model.records.indexOf(n),n.hasChildRecords&&i._addNestedExpandCollapseRecords(n.childRecords,n.level,n,index)):i.model.flatRecords.splice(index+1,i._expandCollapseRecordCount)},getChildRecordsCount:function(n){var r=this,i=n.childRecords,t=0,f=i?i.length:0,u;for(t;t<f;t++)r._filteredRecords.length>0?(u=r._filteredRecords.indexOf(i[t]),u!=-1&&(++r._removedCount,i[t].hasChildRecords&&i[t].expanded&&r.getChildRecordsCount(i[t]))):(++r._removedCount,i[t].hasChildRecords&&i[t].expanded&&r.getChildRecordsCount(i[t]));return r._removedCount},getExpandStatus:function(n){var t=n.parentItem;return t!=null?t.expanded===!1?!1:t.parentItem?t.parentItem.expanded===!1?!1:this.getExpandStatus(t.parentItem):!0:!0},getColumnFieldNames:function(){var i=[],t=this.model.columns,n=0,r=t.length;for(n;n<r;n++)t[n].field&&t[n].field!="resourceInfo"&&t[n].field!="predecessor"?i.push(t[n].field):t[n].field=="resourceInfo"?i.push("resourceNames"):t[n].field=="predecessor"&&i.push("predecessorsName");return i},renderRecords:function(n){var i=this;n||(n={},n.requestType=t.TreeGrid.Actions.Refresh);this.sendDataRenderingRequest(n)},selectRows:function(i,u){var f=this,e=f.model,c=f.getRows(),s;if((e.editSettings.allowEditing||e.editSettings.allowAdding)&&!f._isRowEdit&&n("#"+f._id+"EditForm").length>0&&f.endEdit()){c=f.getRows();return}if(t.isNullOrUndefined(u)||t.isNullOrUndefined(i)){i=t.isNullOrUndefined(i)?u:i;switch(e.selectionType){case t.TreeGrid.SelectionType.Multiple:if(f._multiSelectCtrlRequest){s=n.inArray(i,f._selectedRowsIndexes);s!=-1&&f.clearSelection(i)&&f._selectedRowsIndexes.splice(s,0);s==-1&&(f._selectedRowsIndexes.push(i),f.getRowByIndex(i).attr("aria-selected","true").find(".e-rowcell").addClass("e-selectionbackground e-active").attr("tabindex","0"));break}case t.TreeGrid.SelectionType.Single:f.clearSelection(f._previousIndex);e.selectedItem=null;i<=f._updatedRecords.length-1&&(f._selectedRowsIndexes=[],f._selectedRowsIndexes.push(i),f.getRowByIndex(i).attr("aria-selected","true").find(".e-rowcell").addClass("e-selectionbackground e-active").attr("tabindex",0),f._updatedRecords[i]&&(f._updatedRecords[i].isSelected=!0,e.selectedItem=f._updatedRecords[i]),f._updatedRecords[f._previousIndex]&&i!=f._previousIndex&&(f._updatedRecords[f._previousIndex].isSelected=!1))}}else if(e.selectionType==t.TreeGrid.SelectionType.Multiple){f.clearSelection();f._selectedRowsIndexes=[];var h=i-u<0?c.slice(i,u+1):c.slice(u,i+1),o=0,l=h.length;for(o;o<l;o++)f._selectedRowsIndexes.push(h[o].rowIndex),e.flatRecords[h[o].rowIndex].isSelected=!0;n(h).attr("aria-selected","true").find(".e-rowcell").addClass("e-selectionbackground e-active").attr("tabindex","0")}return f._previousIndex=f._selectedRowsIndexes.length?i:r,this.selectedRowIndex()!=i&&this.selectedRowIndex(i),f._multiSelectCtrlRequest=!1,!1},getCellIndex:function(t,i){var r=n(t.target),u;return(i&&(r=n(i)),r.prop("tagName")=="TD")?r.index():r.prop("tagName")=="DIV"&&r.hasClass("e-cell")||r.prop("tagName")=="DIV"&&n(r.closest("td")[0]).hasClass("e-templatecell")||n(r.closest("td")[0]).hasClass("e-templatecell")&&n(r.closest("tr")[0]).hasClass("e-templaterow")?(u=r.closest("td"),u.index()):-1},getRowIndex:function(t){var e=this,r=n(t.target),u=e.getRows(),i=u.index(r.parent()),f;return i==-1&&(f=r.closest("tr"),i=u.index(f)),i},getRowByIndex:function(i,r){var f,e;try{var u=this,o=u.getRows(),s=u._gridRows,h=n();return u.model.enableVirtualization&&(f=u._updatedRecords[i],i=u.model.currentViewData.indexOf(f)),t.isNullOrUndefined(r)?(u.model.enableVirtualization&&(e=u._updatedRecords[r],r=u.model.currentViewData.indexOf(e)),n(s[i])):n(o.slice(i,r))}catch(c){return n()}},cancelEditCell:function(){var t=this,i=t._gridRows[t.selectedRowIndex()],r;({})[t._cellEditingDetails.fieldName]=t._cellEditingDetails.cellValue;data=t.model.selectedItem;r=n(i).hasClass("e-insertedrow")?i.cells[t._cellEditingDetails.columnIndex]:i.cells[t._cellEditingDetails.columnIndex];n(r).removeClass("e-editedcell").empty().html(n(n.render[t._id+"_Template"](data))[0].cells[t._cellEditingDetails.columnIndex].innerHTML);t.element.focus();t.model.isEdit=!1;t._cancelSaveTools()},cancelRowEditCell:function(){var t=this,s=t.model.editSettings.allowDeleting,i,f,e,r,o,u;form=n(document.getElementById(t._id+"EditForm"));form.closest("tr").hasClass("e-addedrow")&&(i=form.closest("tr").index(),t._currentViewData=t.getCurrentViewData(),f=t._currentViewData[i].item,e=t._checkIsEmptyRow(f),e&&(t.model.editSettings.allowDeleting||(t.model.editSettings.allowDeleting=!0)));r=this.selectedRowIndex();form.closest("tr").hasClass("e-addedrow")&&(r=i);tr=t._gridRows[r];data=t.model.selectedItem;n(tr).hasClass("e-editedrow")?(n(tr).removeClass("e-editedrow").empty().html(n(n.render[t._id+"_Template"](data))[0].innerHTML),i=r):n(tr).hasClass("e-rowedit")?(n(tr).removeClass("e-rowedit").empty().html(n(n.render[t._id+"_Template"](data))[0].innerHTML),i=r):(o=t._$gridRows.length,u=t.model.editSettings.rowPosition,i=u=="bottom"?o-1:u=="top"?0:r,tr=t._gridRows[i],t.deleteRow(n(tr)));t.model.isEdit=t._isRowEdit=!1;(u=="bottom"||u=="belowSelectedRow")&&(i=i-1);t.selectRows(i);t.model.editSettings.allowDeleting=s;t._$gridRows==null&&t.selectRows(-1)},refreshRow:function(t){var i=this,r=i.model.currentViewData[t];r&&n(i._gridRows[t]).replaceWith(n(n.render[i._id+"_Template"](r)));i.setGridRows(n(i.getContentTable().get(0).rows))},renderRecord:function(i){var u=this,l=n.render[this._id+"_Template"](i._cAddedRecord),r=u.model,o,s,c,f,e,h,a,v,y,p,w;u._gridRows!=null&&u._gridRows.length>0?(c=r.currentViewData.indexOf(r.selectedItem),i.position?i.position=="Above"?u.getRows().eq(c).before(l):i.position=="Below"&&u.getRows().eq(c).after(l):c===-1?(i._cAddedRecord.index=0,u.getRows().eq(0).before(l)):u.getRows().eq(c).after(l),u.setGridRows(n(u.getContentTable().get(0).rows)),i._cAddedRecord.hasChildRecords=!1,i._cAddedRecord.expanded=!1,r.parentIdMapping&&(i._cAddedRecord.parentItem?i._cAddedRecord.item[r.parentIdMapping]=i._cAddedRecord.parentItem.taskId:delete i._cAddedRecord.item[r.parentIdMapping],this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&this.dataSource().dataSource.json.push(i._cAddedRecord.item):this.dataSource().push(i._cAddedRecord.item)),i._cAddedRecord.parentItem&&r.selectedItem?i._cAddedRecord.parentItem.hasChildRecords&&(i.position=="Below"||!i.position)?(f=r.flatRecords.indexOf(i._cAddedRecord.parentItem),e=r.flatRecords[f].childRecords.indexOf(r.selectedItem),e===-1?(r.flatRecords[f].childRecords.splice(0,0,i._cAddedRecord),r.parentIdMapping||r.flatRecords[f].item[r.childMapping].splice(0,0,i._cAddedRecord.item)):(r.flatRecords[f].childRecords.splice(e+1,0,i._cAddedRecord),r.parentIdMapping||r.flatRecords[f].item[r.childMapping].splice(e+1,0,i._cAddedRecord.item))):i._cAddedRecord.parentItem.hasChildRecords&&i.position=="Above"&&(f=r.flatRecords.indexOf(i._cAddedRecord.parentItem),e=r.flatRecords[f].childRecords.indexOf(r.selectedItem),e===-1?(r.flatRecords[f].childRecords.push(i._cAddedRecord),r.parentIdMapping||r.flatRecords[f].item[r.childMapping].push(i._cAddedRecord.item)):(r.flatRecords[f].childRecords.splice(e,0,i._cAddedRecord),r.parentIdMapping||r.flatRecords[f].item[r.childMapping].splice(e,0,i._cAddedRecord.item))):!i._cAddedRecord.parentItem&&r.selectedItem?(r.parentRecords.splice(i._cAddedRecord.index,0,i._cAddedRecord),this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&(h=this.dataSource().dataSource.json):h=this.dataSource(),h&&(a=h.indexOf(r.selectedItem.item),i.position=="Above"?r.parentIdMapping||h.splice(a,0,i._cAddedRecord.item):i.position!="Below"&&i.position||r.parentIdMapping||h.splice(a+1,0,i._cAddedRecord.item))):!r.selectedItem&&i._cAddedRecord&&(this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&(r.parentIdMapping||this.dataSource().dataSource.json.splice(0,0,i._cAddedRecord.item)):r.parentIdMapping||this.dataSource().splice(0,0,i._cAddedRecord.item)),r.selectedItem?(v=r.records.indexOf(r.selectedItem),y=r.flatRecords.indexOf(r.selectedItem),i.position=="Above"?(s=v,o=y):(s=v+1,o=y+1)):(s=0,o=0),u.getExpandStatus(i._cAddedRecord)&&r.enableVirtualization?o===r.flatRecords.length?r.flatRecords.push(i._cAddedRecord):(u._recordIndexCount=0,r.flatRecords.splice(o,0,i._cAddedRecord)):r.enableVirtualization||(o===r.flatRecords.length?r.flatRecords.push(i._cAddedRecord):(u._recordIndexCount=0,r.flatRecords.splice(o,0,i._cAddedRecord))),s===r.records.length?(r.records.push(i._cAddedRecord),r.isFromGantt&&r.ids.push(i._cAddedRecord.taskId.toString())):(r.records.splice(s,0,i._cAddedRecord),r.isFromGantt&&r.ids.splice(s,0,i._cAddedRecord.taskId.toString())),u.setRecordsCount(r.flatRecords.length),u.setHeight(r.flatRecords.length*r.rowHeight),r.allowSorting&&r.sortSettings.sortedColumns.length>0||(u._updatedRecords=r.flatRecords,u._updateCurrentViewData())):(u._gridRows==null||u._gridRows.length==0)&&(this.selectedRowIndex()===-1&&(i._cAddedRecord.hasChildRecords=!1,i.recordIndex=0),r.flatRecords.push(i._cAddedRecord),this.dataSource()==null&&this.dataSource([]),this.dataSource()instanceof t.DataManager?this.dataSource().dataSource.offline&&this.dataSource().dataSource.json&&this.dataSource().dataSource.json.push(i._cAddedRecord.item):this.dataSource().push(i._cAddedRecord.item),r.records.push(i._cAddedRecord),r.isFromGantt&&r.ids.push(i._cAddedRecord.taskId.toString()),u._updatedGanttRecords=r.flatRecords,u._updatedRecords=r.flatRecords,u.setRecordsCount(r.flatRecords.length),u.setHeight(r.flatRecords.length*r.rowHeight),u._updateCurrentViewData(),r.parentRecords.push(i._cAddedRecord),u.getContentTable().find("tbody").empty().append(u._getEmptyTbody()),p=document.createElement("div"),u.getContentTable().find("colgroup").first().replaceWith(u._getMetaColGroup()),w=u.getContentTable().children("tbody"),w.empty(),p.innerHTML=["<table>",n.render[u._id+"_Template"](u.model.currentViewData),"<\/table>"].join(""),u.getContentTable().get(0).replaceChild(p.firstChild.firstChild,u.getContentTable().get(0).lastChild),u._gridRows=u.getContentTable().get(0).rows,u.setGridRows(n(u.getContentTable().get(0).rows)),u._eventBindings())},onScrollHelper:function(n){var t=this,i;t._$gridContent.ejScroller("scrollY",n,!0);i=t._$gridContent.ejScroller("isHScroll");i||t._$gridContent.scrollTop(n)},isVScroll:function(){return this._$gridContent.hasClass("e-scroller")?this._$gridContent.ejScroller("isVScroll"):!1},refreshScroller:function(n){var t=this,u,i,r,f;t._$gridContent.removeClass("e-borderbox");u=t._$gridContent.ejScroller("option","scrollTop");i=t._$gridContent.ejScroller("option","scrollLeft");t._$gridContent.ejScroller("option",{persist:!0});t._$gridContent.ejScroller("option",{width:n});r=t.getMaxScrollWidth();i>r&&(i=r>0?r:0);t._$gridContent.css("height",t._viewPortHeight);t._$gridContent.ejScroller("refresh");f=t._$gridContent.ejScroller("isHScroll");t.model.isFromGantt&&(f?t._$gridContent.removeClass("e-borderbox"):t._$gridContent.addClass("e-borderbox"));t._$gridContent.ejScroller("option",{scrollTop:u});t._$gridContent.ejScroller("option",{scrollLeft:i});t._$gridHeaderContainer.scrollLeft(i);f||t._$gridContent.scrollTop(u)},getMaxScrollWidth:function(){var n=this;return n._$gridContent.children(".e-content").children(".e-gridcontainer").children(".e-table").width()-n._$gridContent.children(".e-content").width()},refreshHeight:function(){var n=this;n._$gridContent.ejScroller("refresh")},_getViewPortHeight:function(){var t=this,i=0,r=0;return r=t.model.isFromGantt?0:1,i=t.element.height()-t._$gridHeaderContent.height()-parseFloat(r)-parseFloat(t._$gridHeaderContent.css("border-bottom-width")),t.model.toolbarSettings.showToolbar&&(i-=n("#"+t._id+"_toolbarItems").outerHeight()),t.model.isFromGantt||(i-=1),i},updateViewPortHeight:function(){var n=this;n._viewPortHeight=n._getViewPortHeight()},_updateScrollCss:function(){var n=this,t;n.model.isFromGantt||(t=n.isVScroll(),t?n._$gridHeaderContent.addClass("e-scrollcss"):n._$gridHeaderContent.removeClass("e-scrollcss"),n._resizeFilteringElements())},_updateCurrentViewData:function(){var n=this,i=n.model,r={},u,f=!1;i.enableVirtualization?(n.getVisibleRange(),i.currentViewData=n._updatedRecords.slice(n._visibleRange.top,n._visibleRange.bottom),n._vScrollDist!==0&&(u=n._scrollTop-n._offset,(n._prevRTop-n._visibleRange.top!=0||n._prevRBottom-n._visibleRange.bottom!=0)&&(r.requestType=t.TreeGrid.Actions.Refresh,n.sendDataRenderingRequest(r),f=!0),n._$tableContent.css({top:u}),n._prevRTop=n._visibleRange.top,n._prevRBottom=n._visibleRange.bottom)):i.currentViewData=n._updatedRecords;n._isEnterKeyPressed&&(n._isEnterKeyPressed=!1,i.allowSelection&&i.editSettings.allowEditing&&(f||(n._cellEditingDetails.rowIndex+=1),n._rowSelectingEventTrigger()||(n.selectRows(n._cellEditingDetails.rowIndex),n._rowSelectedEventTrigger(n._cellEditingDetails.rowIndex)),n.cellEdit(n._cellEditingDetails.rowIndex,n.model.columns[n._cellEditingDetails.columnIndex].field)))},_getRowPosition:function(n){return Math.ceil(n/this.model.rowHeight)},_getMetaColGroup:function(){return this.getHeaderTable().find("colgroup").clone()},_getEmptyTbody:function(){var i=this,r=t.buildTag("td",i.model.emptyRecordText,{},{colSpan:i.model.columns.length});return n(document.createElement("tr")).append(r)},_addSortElementToColumn:function(i,r){var u=this,e=t.TreeGrid.getColumnByField(u.model.columns,i),o=n.inArray(e,u.model.columns),f=u.getHeaderTable().find("thead").find(".e-headercell").eq(o).find(".e-headercelldiv");f.find(".e-ascending,.e-descending").remove();f.append(u._createSortElement().addClass("e-"+r).addClass("e-icon"));f.parent().attr("aria-sort",r)},_createSortElement:function(){return t.buildTag("span","&nbsp;")},_renderCellEditObject:function(i,r){var u=this,e=t.buildTag("form.#"+u._id+"EditForm","",{},{}),h=u._cellEditTemplate,f,o,s={};s[i.columnObject.field]=i.value;columnIndex=u.getColumnIndexByField(i.columnObject.field);columnIndex===u.model.treeColumnIndex?r.find(".e-cell").empty():r.empty();o=h.find("#"+i.columnObject.field+"_CellEdit").html();f=i.columnObject.field==="predecessor"?n(n.templates(o).render(i.data)):n(n.templates(o).render(s));f.get(0).tagName=="SELECT"&&(f.val(s[i.columnObject.field]),f.val()==null&&f.val(f.find("option").first().val()));e.append(f);columnIndex===u.model.treeColumnIndex?r.find(".e-cell").append(e):r.append(e);u._setoffsetWidth();u._refreshEditForm();n.isFunction(n.validator)&&!n.isEmptyObject(i.validationRules)&&(u._initValidator(),u.setValidationToField(i.columnObject.field,i.validationRules));u.model.isEdit=!0},_setoffsetWidth:function(){var r=this,i,f=n("#"+r._id+"EditForm"),t=0,e,u;for(i=r.model.editSettings.editMode!="cellEditing"||r._isRowEdit?f.find("tr").find(".e-rowcell"):f.closest("td"),e=i.length,t;t<e;t++)u=n(i.children()[0]).children(),r._tdsOffsetWidth[t]=u.length>1?i.get(t).offsetWidth-u[0].offsetWidth-u[1].offsetWidth:i.get(t).offsetWidth},getIndexofresourceInfo:function(n){var u=this,f=u._cellEditingDetails.data,i=f.resourceInfo,t=0,e=i&&i.length,r=[];for(t;t<e;t++)r.push(n.indexOf(i[t]));return r},_refreshEditForm:function(){var e=this,nt=document.getElementById(e._id+"EditForm"),k=!1,d=n(nt).find("input,select"),g=86,h=0,tt=d.length,i,s,f=e.model,c,u={},w,o,l,y,p,a=e.model.rowHeight,v,b;for(h;h<tt;h++){if(i=d.eq(h),f.editSettings.editMode=="cellEditing"&&(g=95),s=e._isRowEdit&&i.attr("type")!="checkbox"?"100%":e._tdsOffsetWidth[h]*(g/100),i.hasClass("e-numerictextbox"))c=s,w=i.val(),u.width=c,u.height=a-5,u.showSpinButton=!0,u.cssClass=f.cssClass,w.length&&(u.value=parseFloat(w)),l=t.TreeGrid.getColumnByField(f.columns,i.prop("name")),f.isFromGantt&&(l.field==="duration"||l.field==="status")&&(u.minValue=0,l.field=="status"&&(u.maxValue=100)),t.isNullOrUndefined(l.editParams)||n.extend(u,l.editParams),i.ejNumericTextbox(u),i.prop("name",i.prop("name").replace(e._id,""));else if(i.hasClass("e-datepicker"))c=s,u.width=c,u.height=a-5,u.locale=f.locale,u.cssClass=f.cssClass,u.displayDefaultDate=!0,u.dateFormat=f.dateFormat,i.val().length&&(u.value=new Date(i.val())),o=t.TreeGrid.getColumnByField(f.columns,i.prop("name")),o.format!==r&&o.format.length>0&&(y=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),p=y.exec(o.format),u.dateFormat=p[2]),t.isNullOrUndefined(o.editParams)||n.extend(u,o.editParams),f.dateFormat.indexOf("hh")==-1?i.ejDatePicker(u):i.ejDateTimePicker(u);else if(i.hasClass("e-datetimepicker"))c=s,u={width:c,height:a-5,locale:f.locale,cssClass:f.cssClass,showButton:!1},i.val().length&&(u.value=new Date(i.val())),o=t.TreeGrid.getColumnByField(f.columns,i.prop("name")),o.format!==r&&o.format.length>0&&(y=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),p=y.exec(o.format),u.dateTimeFormat=p[2]),t.isNullOrUndefined(o.editParams)||n.extend(u,o.editParams),e.model.isFromGantt?f.dateFormat.indexOf("hh")==-1?i.ejDatePicker(u):i.ejDateTimePicker(u):i.ejDateTimePicker(u);else if(i.hasClass("e-dropdownlist"))e._isRowEdit?(v=f.columns[h].dropdownData,b=f.columns[h].field):(v=f.columns[e._cellEditingDetails.columnIndex].dropdownData,b=f.columns[e._cellEditingDetails.columnIndex].field),f.isFromGantt?i.ejDropDownList({width:s+"px",height:a-5,showCheckbox:!0,dataSource:v,popupWidth:"auto",fields:{id:f.resourceIdMapping,text:f.resourceNameMapping,value:f.resourceNameMapping},selectedItems:e.getIndexofresourceInfo(v)}):(i.css({position:"absolute","margin-top":"-13px"}),i.ejDropDownList({width:s,height:a-5,dataSource:v})),i.ejDropDownList("setSelectedValue",i.val()),n("#"+e._id+b+"_list").hide();else switch(i.prop("tagName")){case"INPUT":i.attr("type")!="checkbox"?(i.css("text-align",i.attr("name")!=null&&t.TreeGrid.getColumnByField(f.columns,i.attr("name"))!=null?t.TreeGrid.getColumnByField(f.columns,i.attr("name")).textAlign:"center"),i.outerWidth(s).height(f.rowHeight-9)):i.width(s>0?i.width()>s?s:i.width():1);break;case"SELECT":i.width(s).height(20)}i.is(":disabled")||k||i.is(":hidden")&&typeof i.data("ejDropDownList")!="object"||e._isEnterKeyPressed||(e._focusElements(i.closest("td")),k=!0)}},_initValidator:function(){var i=this;n("#"+i._id+"EditForm").validate({onclick:!1,onfocusout:!1,errorClass:"e-field-validation-error",errorElement:"div",wrapper:"div",errorPlacement:function(r,u){var e=u.closest("td"),f=n(r).addClass("e-error"),o=t.buildTag("div.e-errortail e-toparrow");e.find(".e-error").remove();u.hasClass("e-numerictextbox")?f.insertAfter(u.closest(".e-numeric")):f.insertAfter(u);f.prepend(o);i.model.editSettings.editMode!="normal"&&f.offset({left:u.offset().left});f.fadeIn("slow")}})},_focusElements:function(n){var i=this,t;n.length&&(n.focus(),t=n.children(),t[0]&&(t[0].tagName.toLowerCase()=="select"||t[0].tagName.toLowerCase()=="input"?(t.focus().select(),t[0].focus()):t.find(".e-field.e-dropdownlist").length?t.find(".e-ddl").focus():t.find(".e-datewidget.e-widget").length?t.find(".e-datewidget.e-widget").focus():t.find("input,select").select().focus()));i._$gridHeaderContainer.scrollLeft(i._$gridContent.children(".e-content").scrollLeft())},_focusElementsForRowEdit:function(n){if(n.length){var t=n.children();t[0].tagName.toLowerCase()=="select"||t[0].tagName.toLowerCase()=="input"?(t.focus().select(),t[0].focus()):t.find(".e-field.e-dropdownlist").length?t[0].focus():t.find("input:visible,select").first().select().focus()}},updateHeight:function(n){var t=this;t._$gridContainer&&t._$gridContent&&(n?(t._$gridContainer.css({height:n+"px",width:"auto"}),t._$gridContent.ejScroller("refresh")):t._$gridContainer.css({height:t._totalHeight+"px"}),t._$gridContent.hasClass("e-scroller")&&(t._$gridContent.ejScroller("refresh"),t._updateScrollCss()))},_setScrollTop:function(){var n=this,i=this.model,r=n._scrollTop,t;i.enableVirtualization&&r!==0&&!i.isFromGantt&&n.model.currentViewData.length*n.model.rowHeight<n._viewPortHeight&&(t=r-(n._viewPortHeight-n.model.currentViewData.length*n.model.rowHeight),t<0&&(t=0),n._$gridContent.ejScroller("scrollY",t,!0))},_addNestedExpandCollapseRecords:function(t,i,r,u){var f=this,l=f.model,h=l.flatRecords,a=l.records,c=0,y=t.length,e,v,s,o;for(c;c<y;c++)if(u++,f._tempRecordIndex++,e=a[f._tempRecordIndex],n.inArray(e,h)===-1&&h.splice(u,0,e),e&&e.isExpanded===!1&&(e.isExpanded=!0),e.hasChildRecords)if(e.expanded)for(v=e.childRecords.length,s=0,s;s<v;s++)u++,f._tempRecordIndex++,o=a[f._tempRecordIndex],h.splice(u,0,o),o.hasChildRecords&&(o.expanded?u=f._addNestedExpandCollapseRecords(o.childRecords,i+1,o,u):f._tempRecordIndex+=f.getChildCount(o,0));else f._tempRecordIndex+=f.getChildCount(e,0);return u},getChildCount:function(n,t){var r,u=this,i;if(!n.hasChildRecords)return 0;for(i=0;i<n.childRecords.length;i++)r=n.childRecords[i],t++,r.hasChildRecords&&(t=u.getChildCount(r,t));return t},_updateFilteredRecords:function(t){var i=this,u=0,e=t.length,r,f=i.model.enableVirtualization;for(i._filteredRecords=[],i._filteredGanttRecords=[],u;u<e;u++)r=t[u],r.parentItem!=null?(i._addParentRecord(r.parentItem),n.inArray(r,i._filteredRecords)===-1&&(f?i.getExpandStatus(r)&&i._filteredRecords.push(r):i._filteredRecords.push(r))):n.inArray(r,i._filteredRecords)===-1&&(f?i.getExpandStatus(r)&&i._filteredRecords.push(r):i._filteredRecords.push(r))},_addParentRecord:function(t){var i=this,r=i.model.enableVirtualization;t.parentItem?(i._addParentRecord(t.parentItem),n.inArray(t,i._filteredRecords)===-1&&(r?i.getExpandStatus(t)&&i._filteredRecords.push(t):i._filteredRecords.push(t))):n.inArray(t,i._filteredRecords)===-1&&(r?i.getExpandStatus(t)&&i._filteredRecords.push(t):i._filteredRecords.push(t))},_updateExpandCollapseForSortedRecords:function(n,t){var i=this,r=0,o=i._sortedRecords.length,u,f=i._sortedRecords.indexOf(n),e;if(t)i._addNestedSortRecords(n,f);else{for(e=0,r=f+1;r<o;r++)if(u=i._sortedRecords[r],u.level===n.level)break;else i.getExpandStatus(u)||e++;i._sortedRecords.splice(f+1,e)}},_addNestedSortRecords:function(i,r){var u=this,c,o=u.model.sortSettings.sortedColumns,s,e,l,h,f;if(o.length)for(s=o.length-1,u._queryManagar.queries=[],e=s;e>=0;e--)u._queryManagar.sortBy(o[e].field,o[e].direction);if(i.hasChildRecords)for(l=t.DataManager(i.childRecords),c=l.executeLocal(u._queryManagar).result,s=c.length,h=0;h<s;h++)f=c[h],u._filteredRecords.length?n.inArray(f,u._filteredRecords)!==-1&&u._sortedRecords.splice(++r,0,f):u._sortedRecords.splice(++r,0,f),f.hasChildRecords&&f.expanded&&u._addNestedSortRecords(f,r)},_updateAltRow:function(){for(var r=this,n=0,t=r._updatedRecords,u=t.length,i,n=0;n<u;n++)i=t[n],i.isAltRow=n%2==0?!0:!1},_getFilteredChildRecordsCount:function(n){for(var t=this,u=t.model,f=n&&n.childRecords&&n.childRecords.length,i=0,r,i=0;i<f;i++)r=n.childRecords[i],u.enableVirtualization?t.getExpandStatus(r)&&t._removedCount++:t._removedCount++,r.childRecords&&t._getFilteredChildRecordsCount(r);return t._removedCount},_sortingRecords:function(){var n=this,u=n.model,r=u.sortSettings.sortedColumns,e,i,f,o,s,h,c;if(n._queryManagar.queries=[],r.length)for(e=r.length-1,i=e;i>=0;i--)u.isFromGantt&&(f=t.TreeGrid.getColumnByMappingName(u.columns,r[i].field)),f?(n._queryManagar.sortBy(f.field,r[i].direction),r[i].field=f.field):n._queryManagar.sortBy(r[i].field,r[i].direction);return o=new t.DataManager(u.parentRecords),s=o.executeLocal(n._queryManagar).result,n._sortedRecords=[],n._storedIndex=-1,n._createSortedRecords(s),n._tempsortedrecords=n._sortedRecords,n.setRecordsCount(n._sortedRecords.length),n.model.selectedRowIndex>=0&&(h=n._selectedRowsIndexes.indexOf(n.model.selectedRowIndex),c=n._updatedRecords[n.model.selectedRowIndex],n._previousIndex=n.model.selectedRowIndex=n._sortedRecords.indexOf(c),n._selectedRowsIndexes[h]=n._previousIndex),n._updatedRecords=n._sortedRecords,!0},_createSortedRecords:function(i){var r=this,u=r._sortedRecords,f,e=r.model.enableAltRow,o=this.model;n.each(i,function(n,i){if(r._searchString.length>0?r._filteredRecords.length>0&&r._filteredRecords.indexOf(i)!==-1&&(r._storedIndex++,e&&(i.isAltRow=r._storedIndex%2==0?!1:!0),u[r._storedIndex]=i):(r._storedIndex++,e&&(i.isAltRow=r._storedIndex%2==0?!1:!0),u[r._storedIndex]=i),i.hasChildRecords&&i.expanded){f=t.DataManager(i.childRecords);var s=f.executeLocal(r._queryManagar).result;r._createSortedRecords(s)}else!i.hasChildRecords||i.expanded||o.enableVirtualization||r._setChildRecords(i,u)})},_setChildRecords:function(n,i){var u=this,e=u.model.enableAltRow,o=n.childRecords.length,f,r;for(dataManager=t.DataManager(n.childRecords),f=dataManager.executeLocal(u._queryManagar).result,r=0;r<o;r++)u._filteredRecords.length>0?u._filteredRecords.length>0&&u._filteredRecords.indexOf(f[r])!==-1&&(u._storedIndex++,e&&(f[r].isAltRow=u._storedIndex%2==0?!1:!0),i[u._storedIndex]=f[r],f[r].hasChildRecords&&this._setChildRecords(f[r],i)):(u._storedIndex++,e&&(f[r].isAltRow=u._storedIndex%2==0?!1:!0),i[u._storedIndex]=f[r],f[r].hasChildRecords&&this._setChildRecords(f[r],i))},_updateSortedRecords:function(i){var u=this,f=0,s=i.length,r,h=this.model,e,o;for(f;f<s;f++)r=i[f],h.enableVirtualization||(u._filteredRecords.length>0?n.inArray(r,u._filteredRecords)!==-1&&n.inArray(r,u._sortedRecords)===-1&&u._sortedRecords.push(r):n.inArray(r,u._sortedRecords)===-1&&u._sortedRecords.push(r),r.hasChildRecords&&r.childRecords.length>0&&(e=t.DataManager(r.childRecords),o=e.executeLocal(u._queryManagar).result,u._updateSortedRecords(o)))},_removeSortElementFromColumn:function(i){var r=this,f=t.TreeGrid.getColumnByField(r.model.columns,i),e=n.inArray(f,r.model.columns),u=r.getHeaderTable().find("thead").find(".e-headercell").eq(e).find(".e-headercelldiv");u.find(".ascending,.descending").remove();u.parent().removeAttr("aria-sort")},_addEmptyColumntoGrid:function(){n(".e-gridheadercontainer table colgroup").append(t.buildTag("col","",{width:"auto"},{}));n(".e-gridheadercontainer table thead tr").append(t.buildTag("th.e-headercell"))},_updateScrollTop:function(n){var i={},t=this,r;i.requestType="scroll";i.delta=n;r=t._$gridContent.ejScroller("isHScroll");r?t._$gridContent.scrollTop(0):t._$gridContent.scrollTop(n);t._$gridContent.ejScroller("scrollY",n,!0);t._completeAction(i)},_moveCurrentCell:function(n){var t=this,i=t._cellEditingDetails.rowIndex,u=t._cellEditingDetails.columnIndex,r=t.model;if(i==-1&&u==-1)return!1;t.model.isEdit&&(t.saveCell(),t.model.isEdit=!1);switch(n){case"right":if(!t._rowSelectingEventTrigger()&&!t.selectRows(t._cellEditingDetails.rowIndex)){if(i==t._gridRows.length-1&&u==r.columns.length-1)return!0;u==r.columns.length-1?(t._cellEditingDetails.columnIndex=0,t._cellEditingDetails.rowIndex=i+1):t._cellEditingDetails.columnIndex=u+1;t.selectRows(t._cellEditingDetails.rowIndex);t.cellEdit(t._cellEditingDetails.rowIndex,r.columns[t._cellEditingDetails.columnIndex].field)}break;case"left":if(i==0&&u==0)return!0;u==0?(t._cellEditingDetails.columnIndex=r.columns.length-1,t._cellEditingDetails.rowIndex=i-1):t._cellEditingDetails.columnIndex=u-1;t.selectRows(t._cellEditingDetails.rowIndex);t.cellEdit(t._cellEditingDetails.rowIndex,r.columns[t._cellEditingDetails.columnIndex].field);break;case"up":if(i==0)return!0;t._cellEditingDetails.rowIndex=i-1;t.selectRows(t._cellEditingDetails.rowIndex);t._rowSelectedEventTrigger(t._cellEditingDetails.rowIndex);t.cellEdit(t._cellEditingDetails.rowIndex,r.columns[t._cellEditingDetails.columnIndex].field);break;case"down":i+1==t.getRows().length-1&&t.model.enableVirtualization&&(t._isEnterKeyPressed=!0,t._updateScrollTop(t._$gridContent.scrollTop()+r.rowHeight-t._offset));t._isEnterKeyPressed||t._updatedRecords.length>i+1&&(t.selectRows(i+1)||(t._rowSelectedEventTrigger(t._cellEditingDetails.rowIndex+1),t._cellEditingDetails.rowIndex=i+1,t.cellEdit(t._cellEditingDetails.rowIndex,r.columns[t._cellEditingDetails.columnIndex].field),args={},args.requestType="scroll",args.delta=t._$gridContent.children(".e-content").scrollTop(),t._trigger("actionComplete",args)))}return!1},_findColumnsWidth:function(){for(var t=this,i=t.model.columns.length,r=t.getHeaderTable().find("colgroup").find("col"),n=0;n<i;n++)t._columnsWidthCollection[n]=r.eq(n).width()},_calculateWidth:function(){for(var t=this.getHeaderTable().find("colgroup").find("col"),i=0,n=0;n<t.length;n++)i+=t.eq(n).width();return i},_compiledDropDownTemplate:function(){var i=t.buildTag("select"),r=t.buildTag("option","{{:text}}",{},{value:"{{:value}}"});return i.append(r),n.templates(i.html())},_updateElementHeight:function(){var n=this;n.element.height(450);n._calculateDimensions();n.updateViewPortHeight()},_renderScroller:function(){var i=this,r=i.model,s=r.flatRecords.length*r.rowHeight,u,e,f,o;!r.isFromGantt&&i._viewPortHeight<0&&i._updateElementHeight();u=i._viewPortHeight;i._$gridContent.css({height:u+"px"});i._$gridContainer.css({height:s+"px"});i._$gridContent.hasClass("e-scroller")?i._$gridContent.ejScroller("refresh"):($div=t.buildTag("div",{},{width:"auto",height:"auto"}),$div.append(i._$gridContainer),i._$gridContent.append($div),e=i._gridHeight?u:"auto",f=i.element.width(),i._$gridContent.ejScroller({height:i.model.isFromGantt?0:e,width:i.model.isFromGantt?f:f-i._totalBorderWidth,scroll:n.proxy(i._onScroll,i)}),i._$gridContent.ejScroller("refresh"));i._$gridContent.ejScroller("model.keyConfigs",{up:"",down:""});i._updateScrollCss();o=i._$gridContent.ejScroller("isHScroll");i.model.isFromGantt&&(o?i._$gridContent.removeClass("e-borderbox"):i._$gridContent.addClass("e-borderbox"))},_destroy:function(){var n=this;n.element.empty().removeClass("e-treegrid-core e-treegrid "+n.model.cssClass)},collapseAll:function(){var n=this,f=n.model,r=0,i,u={},e=f.enableVirtualization,o=n.getRows();for(n._gridRows=o,(n._isRowEdit||n.model.isEdit)&&(n.cancelRowEditCell(),n.selectRows(-1),n._cancelSaveTools()),r=0;r<n.model.parentRecords.length;r++)i=n.model.parentRecords[r],u.data=i,u.recordIndex=r,u.expanded=!1,e?i.hasChildRecords&&i.expanded&&t.TreeGrid.sendExpandCollapseRequest(n,u):i.hasChildRecords&&i.expanded&&t.TreeGrid.sendExpandCollapseRequest(n,u)},_getContextMenuItems:function(){return[{headerText:"Add Row",eventHandler:null,isDefault:!0,disable:!1},{iconClass:"e-edit",headerText:"Edit",eventHandler:null,isDefault:!0,isEdit:!0,disable:!1},{headerText:"Delete",eventHandler:null,isDefault:!0,disable:!1},{iconClass:"e-save",headerText:"Save",eventHandler:null,isDefault:!0,isEdit:!0,disable:!1},{iconClass:"e-cancel",headerText:"Cancel",eventHandler:null,isDefault:!0,isEdit:!0,disable:!1},]},_getsubContextMenuItems:function(){return[{iconPath:null,headerText:"Above",eventHandler:null},{iconPath:null,headerText:"Below",eventHandler:null}]},_clearContextMenu:function(){n(".e-contextmenu").remove();n(".e-innerContextmenu").remove()},_renderContextMenu:function(i,r,u){var f=this,o=f.model,p={},e={},s,h,c,l,v,a,y;i||(i=window.event);i.pageX||i.pageY?(c=s=i.pageX,h=i.pageY):(i.clientX||i.clientY)&&(c=s=i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h=i.clientY+document.body.scrollTop+document.documentElement.scrollTop);n(window).width()<s+130?(s=s-130,c=s-102):c=c+132;n(window).height()<h+25*f._contextMenuItems.length&&(h=h-25*f._contextMenuItems.length);e.targetElement=i;e.item=u;e.index=r;e.requestType="ContextMenuOpen";e.contextMenuItems=f._contextMenuItems;e.innerContextMenuItems=f._subContextMenuItems;f._trigger("contextMenuOpen",e);l=t.buildTag("div.e-contextmenu","",{height:"auto",width:"130px",position:"absolute",left:s+"px",top:h+"px","background-color":"#F0F0F0",border:"1px solid #99bce8","z-index":"10033"},{});v=t.buildTag("ul",n.render[f._id+"contextMenuTemplate"](e.contextMenuItems),{height:"auto",width:"auto",top:"0px",display:"inline"},{"data-icon":!1,type:"none","data-role":"list-divider"});a=t.buildTag("div.e-innerContextmenu","",{height:"auto",width:"100px",position:"absolute",left:c+"px",top:h+f._contextAddMenuIndex*30+"px","background-color":"#F0F0F0",border:"1px solid #99bce8","z-index":"10",visibility:"hidden"},{});y=t.buildTag("ul",n.render[f._id+"subContextMenuTemplate"](e.innerContextMenuItems),{height:"auto",width:"auto",top:"0px",display:"inline"},{"data-icon":!1,type:"none","data-role":"list-divider"});l.append(v);n(document.body).append(l);e.innerContextMenuItems.length>0&&(a.append(y),n(document.body).append(a));n(l).css({height:"auto"});f._on(l,"contextmenu",function(n){n.preventDefault()});n(".e-menuitem").click(function(){var s=n(this).attr("id");if(!n(this).hasClass("e-disable")){switch(s){case"Delete":p.requestType="contextMenuDelete";f.deleteRow();f._clearContextMenu();break;case"Above":f._subContextMenuAction(u,r,"Above");n(f.element).focus();break;case"Below":f._subContextMenuAction(u,r,"Below");n(f.element).focus();break;case"Add":f._setInitialData();f._clearContextMenu();break;case"Edit":o.editSettings.editMode=="cellEditing"?(f.element.focus(),f._cellEditingDetails.columnIndex=f.getCellIndex(i),f._editedRowIndex=f._cellEditingDetails.rowIndex=f.getRowIndex(i),fieldName=f._cellEditingDetails.columnIndex>=0&&o.columns[f._cellEditingDetails.columnIndex].field,fieldName&&(o.editSettings.allowEditing&&o.editSettings.editMode==t.TreeGrid.EditMode.CellEditing&&f.cellEdit(f._cellEditingDetails.rowIndex,fieldName),f._editAddTools())):o.editSettings.editMode.toLowerCase()=="rowediting"&&f._editRow(r);f._clearContextMenu();break;case"Save":o.editSettings.editMode=="cellEditing"?f._isRowEdit?f._endEdit():f.saveCell():o.editSettings.editMode.toLowerCase()=="rowediting"&&f._saveRow();f._cancelSaveTools();f._clearContextMenu();n(f.element).focus();break;case"Cancel":f.cancelRowEditCell();f._cancelSaveTools();f._clearContextMenu();n(f.element).focus();break;default:n.each(f._contextMenuItems,function(n,t){t.headerText===s&&(f.model.customEvent=t.eventHandler,f._trigger("customEvent",e))});f._clearContextMenu()}f.model.enableAltRow&&f._currentViewData[0]&&t.TreeGrid.updateAltRow(f,f._currentViewData[0],0,0);f.updateHeight()}});n(".e-menuitem").mouseenter(function(){n(this).hasClass("e-disable")||(n(".e-contextmenu-mouseover").removeClass("e-contextmenu-mouseover"),n(this).addClass("e-contextmenu-mouseover"),n(this).attr("id")=="Add"||n(this).attr("id")=="Above"||n(this).attr("id")=="Below"?(n(".e-innerContextmenu").css({visibility:"visible"}),n("#Add").addClass("e-contextmenu-mouseover")):n(".e-innerContextmenu").css({visibility:"hidden"}))});n(".e-menuitem").mouseleave(function(){n(this).removeClass("e-contextmenu-mouseover")});i.preventDefault()},_createContextMenuTemplate:function(){var i=this,t,u,r;helpers={getHeaderName:n.proxy(i._getHeaderName,i)};n.views.helpers(helpers);t="<li style='list-style-type:none;width:92px;height:25px;display:inline-block;'>";u="<div class='e-menuitem {{if disable}}e-disable{{/if}}' id={{:headerText}}  style='left:0px;padding-top:3px;height:25px;width:130px;cursor:{{if disable}}default{{else}}pointer{{/if}};display:block;position:absolute;'  {{if !isDefault}}onClick='{{:eventHandler}}'{{/if}}>{{if !isEdit}}<div class='e-icon' style='left:10px;top:4px;height:20px;position:absolute;background-image:{{:iconPath}};background-repeat:no-repeat;'/> {{else}}<span class='e-icon {{:iconClass}}' style='left:10px;top:7px;height:20px;position:absolute;opacity:0.5'/>{{/if}}<div style='left:35px;position:absolute;'><span style='font-family:Segoe UI;font-size:12px;padding-left:5px;'>{{:headerText}}<\/span><\/div>{{if ~getHeaderName(#data)}}<span class='e-icon e-expander' style='height:16px;width:16px;right:5px;top:7px;position:absolute;'><\/span>{{/if}}";t+=u;t+="<\/div><\/li>";r={};r[i._id+"contextMenuTemplate"]=t;n.templates(r)},_createSubContextMenuTemplate:function(){var r=this,f={getHeaderName:r._getHeaderName},t,u,i;n.views.helpers(f);t="<li style='list-style-type:none;width:100px;height:25px;display:inline-block;'>";u="<div class='e-menuitem' id={{:headerText}} style='left:0px;padding-top:3px;height:25px;width:100px;cursor: pointer;display:block;position:absolute;'><div style='left:10px;height:20px;width:16px;position:absolute;padding-top:5px;background-image:{{:iconPath}};background-repeat:no-repeat;'/><div style='left:10px;position:absolute;'><span style='font-family:Segoe UI;font-size:12px;padding-left:5px;'>{{:headerText}}<\/span><\/div><\/div>";t+=u;t+="<\/li>";i={};i[r._id+"subContextMenuTemplate"]=t;n.templates(i)},_getHeaderName:function(n){return n.headerText=="Add Row"&&this._subContextMenuItems.length>0?!0:!1},_updateContextmenuOption:function(t){var u,s;if(Array.prototype.clean=function(n){for(var t=0;t<this.length;t++)this[t]==n&&(this.splice(t,1),t--);return this},u=this,u._isRowEdit||u.model.isEdit)u._contextMenuItems.splice(0,3);else{u._contextMenuItems.splice(3,2);var e=u.model.editSettings,o=n.extend(!0,[],u._contextMenuItems),h=u.model.contextMenuSettings.contextMenuItems.clean("").clean(r),f=[];if(n.each(h,function(t,i){n.inArray(i.toLowerCase(),f)===-1&&f.push(i.toLowerCase())}),u._contextMenuItems=[],t==-1)(f.indexOf("add")!=-1||f.length==0)&&(u._contextMenuItems[0]=o[0]),e.allowAdding||(u._contextMenuItems[0].disable=!0),u._contextAddMenuIndex=0;else if(f.length==0)u._contextMenuItems[0]=o[0],e.allowAdding||(u._contextMenuItems[0].disable=!0),u._contextAddMenuIndex=0,u._contextMenuItems[1]=o[2],e.allowDeleting||(u._contextMenuItems[1].disable=!0);else for(i=0;i<f.length;i++){s=f[i];switch(s.toLowerCase()){case"add":u._contextMenuItems[i]=o[0];u._contextAddMenuIndex=i;e.allowAdding||(u._contextMenuItems[i].disable=!0);break;case"delete":u._contextMenuItems[i]=o[2];e.allowDeleting||(u._contextMenuItems[i].disable=!0);break;case"edit":u._contextMenuItems[i]=o[1];e.allowEditing||(u._contextMenuItems[i].disable=!0)}}}},_setInitialData:function(){var r={},u=this,e=u.model,o=[],f,t={},n;for(i=0;i<e.columns.length;i++){n=e.columns[i];switch(n.editType){case"booleanedit":t[n.field]=!1;break;case"stringedit":t[n.field]=null;break;case"datepicker":t[n.field]=Globalize.format(new Date,this.model.dateFormat);break;case"datetimepicker":today=new Date;t[n.field]=Globalize.format(new Date,"MM/dd/yyyy hh:mm tt");break;case"numericedit":t[n.field]=0;break;default:t[n.field]=null}}o.push(t);(u.dataSource()==null||u.dataSource().length==0)&&(f=u._createRecord(o[0],0,null),f.index=0,r._cAddedRecord=jQuery.extend(!0,{},f),r.data=r._cAddedRecord.item,r.requestType="save",r.actionRequestType="contextMenuAdd",u.renderRecord(r),u._clearContextMenu())},_subContextMenuAction:function(n,i,r){proxy=this;eventArgs={};eventArgs.requestType="save";newItem=jQuery.extend(!0,{},n.item);newItem[proxy.model.childMapping]=null;eventArgs._cAddedRecord=jQuery.extend({},n);eventArgs._cAddedRecord.isSelected=!1;eventArgs._cAddedRecord.hasChildRecords&&r=="Below"&&(eventArgs._cAddedRecord.parentItem=n,eventArgs._cAddedRecord.level+=1);eventArgs._cAddedRecord.hasChildRecords=!1;eventArgs._cAddedRecord.expanded=!1;eventArgs._cAddedRecord.childRecords=null;eventArgs._cAddedRecord.item=newItem;eventArgs.recordIndex=i==0?0:i;eventArgs.position=r;eventArgs.data=eventArgs._cAddedRecord.item;eventArgs.actionRequestType="contextMenuAdd";eventArgs.selectedItem=proxy.model.selectedItem;proxy.renderRecord(eventArgs);proxy._clearContextMenu();selectionIndex=proxy._currentViewData.indexOf(proxy.model.selectedItem);proxy.selectRows(selectionIndex);proxy.model.enableAltRow&&t.TreeGrid.updateAltRow(proxy,proxy._currentViewData[0],0,0)},_editRow:function(i,r){var o,f,c,s,u,e,h;for(proxy=this,proxy._editedRowIndex=i,o=proxy.model.rowHeight,$form=t.buildTag("form.#"+proxy._id+"EditForm","",{margin:"-1px"},{}),$table=t.buildTag("table.e-table","",{},{cellspacing:"0px",cellpadding:"0"}),$table.append(proxy.getHeaderTable().find("colgroup").clone()),f=n(proxy.getRows()[i]),f.empty(),r?f.addClass("e-addedrow"):f.addClass("e-rowedit"),$mainTd=t.buildTag("td","",{},{colspan:proxy.model.columns.length}),c=proxy.getHeaderTable(),s=t.buildTag("tr.e-treegridrows e-selectionbackground e-active",{height:o},{}),$tbody=t.buildTag("tbody"),$cellEditTemplate=proxy._cellEditTemplate,u=0;u<proxy.model.columns.length;u++)e={},htmlString=$cellEditTemplate.find("#"+proxy.model.columns[u].field+"_CellEdit").html(),e[proxy.model.columns[u].field]=proxy._updatedRecords[i][proxy.model.columns[u].field],$element=n(n.templates(htmlString).render(e)),h=t.buildTag("td.e-rowcell","",{height:o,"vertical-align":"middle;",overflow:"hidden"},{}),$element.get(0).tagName=="SELECT"&&($element.val(e[proxy.model.columns[u].field]),$element.val()==null&&$element.val($element.find("option").first().val())),s.append(h.append($element)),$tbody.append(s);$table.append($tbody);$form.append($table);$mainTd.append($form);f.append($mainTd);proxy._isRowEdit=!0;proxy._setoffsetWidth();proxy._editAddTools();proxy._refreshEditForm()}});t.TreeGrid.Actions={Sorting:"sorting",BeginEdit:"beginedit",Save:"save",Add:"add",Delete:"delete",Cancel:"cancel",Refresh:"refresh",Searching:"searching",ExpandCollapse:"expandcollapse",Selection:"selection",rowHover:"rowHover",Scroll:"scroll",ContextMenuAdd:"contextMenuAdd",RefreshDataSource:"refreshDataSource"};t.TreeGrid.SelectionType={Single:"single",Multiple:"multiple"};t.TreeGrid.EditMode={Normal:"normal",CellEditing:"cellEditing",RowEditing:"rowEditing"};t.TreeGrid.RowPosition={Top:"top",Bottom:"bottom",Above:"aboveSelectedRow",Below:"belowSelectedRow"};t.TreeGrid.EditingType={String:"stringedit",Boolean:"booleanedit",Numeric:"numericedit",Dropdown:"dropdownedit",DatePicker:"datepicker",DateTimePicker:"datetimepicker"};t.TreeGrid.ContextMenuItems={Add:"add",Edit:"edit",Delete:"delete"};t.TreeGrid=t.TreeGrid||{};t.TreeGrid._initCellEditType=function(i,r,u,f){var s=i,h=s.model,e=h.columns,o=e[f],c,l,a,v,y,p,w;t.isNullOrUndefined(e[f].editType)&&(o.editType="stringedit");switch(o.editType){case"stringedit":h.isFromGantt?(c={},c["_"+u+"cellValue"]=t.TreeGrid._getCellValue,o.field==="predecessor"&&(c["_"+u+"predecessorCell"]=t.Gantt._getPredecessorsValue),n.views.helpers(c),l=o.field==="predecessor"?t.buildTag("input.e-field e-ejinputtext","",{},{value:"{{:~_"+u+"predecessorCell('"+h.predecessorMapping+"')}}",id:u+o.field,name:o.field}):t.buildTag("input.e-field e-ejinputtext","",{},{value:"{{:~_"+s._id+"cellValue('"+e[f].field+"')}}",id:s._id+h.columns[f].field,name:h.columns[f].field})):l=t.buildTag("input.e-field e-ejinputtext","",{},{value:"{{:#data['"+o.field+"']}}",id:u+o.field,name:o.field});r.html(l);break;case"booleanedit":r.html("{{if "+e[f].field+'}} <input class="e-field e-checkbox" type ="checkbox" id='+s._id+e[f].field+" name="+e[f].field+' checked="checked"><\/input> {{else}}  <input class="e-field e-checkbox" type ="checkbox"  id='+s._id+e[f].field+" name="+e[f].field+" >  {{/if}}");break;case"numericedit":a=t.buildTag("input.e-numerictextbox e-field","",{},{type:"text",value:"{{:#data['"+e[f].field+"']}}",id:s._id+e[f].field,name:e[f].field});r.append(a);break;case"datepicker":case"datetimepicker":v=t.buildTag("input.e-"+e[f].editType+" e-field","",{},{type:"text",value:"{{:#data['"+e[f].field+"']}}",id:u+e[f].field,name:e[f].field});r.append(v);break;case"dropdownedit":h.isFromGantt?(y=t.buildTag("input.e-field e-dropdownlist e-field","",{},{type:"text",value:"{{:#data['"+e[f].field+"']}}",id:u+e[f].field,name:e[f].field}),r.append(y)):t.isNullOrUndefined(o.dropdownData)||(p=o.dropdownData,w=s._compiledDropDownTemplate(),r.get(0).innerHTML=["<select>",w.render(p),"<\/select>"].join(""),r.find("select").prop({id:s._id+o.field,name:o.field}).addClass("e-field e-dropdownlist"))}};t.TreeGrid._getCellValue=function(n){var t=this.data[n];return t?t:this.data.item&&this.data.item[n]};t.TreeGrid.ToolbarItems={Add:"add",Edit:"edit",Delete:"delete",Update:"update",Cancel:"cancel",ExpandAll:"expandAll",CollapseAll:"collapseAll"};t.TreeGrid._getrowClassName=function(){var n="gridrowIndex",t=this;return t.data.parentItem&&(n+=t.data.parentItem.index.toString()),n+="level",n+t.data.level.toString()};t.TreeGrid.getColumnByField=function(n,t){var i=0;for(i;i<n.length;i++)if(n[i].field==t)break;return i==n.length?null:n[i]};t.TreeGrid.getColumnByMappingName=function(n,t){var i=0;for(i;i<n.length;i++)if(n[i].mappingName==t)break;return i==n.length?null:n[i]};t.TreeGrid.sendExpandCollapseRequest=function(i,r){var u=i,e=u.model,v,a,p,c,o;if(r.requestType=t.TreeGrid.Actions.ExpandCollapse,(u._isRowEdit||u.model.isEdit)&&(u.cancelRowEditCell(),u._cancelSaveTools()),e.enableVirtualization)u._isFromGantt?u._$treegridHelper.ejTreeGrid("processBindings",r):u.processBindings(r),r.expanded?u._trigger("expanded",r):u._trigger("collapsed",r),u._isFromGantt?(u._$treegridHelper.ejTreeGrid("sendDataRenderingRequest",r),u._updatedGanttRecords=u.getUpdatedRecords(),u._currentViewData=u.getCurrentViewData(),u.model.enableVirtualization&&(u.model.predecessorMapping&&(u._isValidationEnabled=!1,u._connectorlineIds=[],u._connectorLinesCollection=[],u._$ganttchartHelper.ejGanttChart("clearConnectorLines"),u._createConnectorLinesCollection()),u._$ganttchartHelper.ejGanttChart("refreshHelper",u._currentViewData,u._updatedGanttRecords),u._$treegridHelper.ejTreeGrid("refreshHeight"))):(u.sendDataRenderingRequest(r),u._setScrollTop(),u._$gridContent.ejScroller("refresh"),u._updateScrollCss());else{var f=r.data,l,s,h=0,y=f.expanded!==r.expanded;l=u._isFromGantt?u._currentViewData.indexOf(f):u.model.currentViewData.indexOf(f);s=n(u.getRows()[l]);r.expanded?(f.expanded=r.expanded,u._expandedRecordsCount=0,t.TreeGrid.expandRecord(u,f,r.expanded,r),y&&(u._totalCollapseRecordCount-=u._expandedRecordsCount),s.find(".e-treegridcollapse").removeClass("e-treegridcollapse").addClass("e-treegridexpand"),s.removeClass("e-treegridrowcollapse").addClass("e-treegridrowexpand"),e.enableAltRow&&t.TreeGrid.updateAltRow(u,f,l,1)):(u._collapsedRecordCount=0,t.TreeGrid.collapseRecord(u,f,r.expanded),y&&(u._totalCollapseRecordCount+=u._collapsedRecordCount),f.expanded=r.expanded,s.find(".e-treegridexpand").removeClass("e-treegridexpand").addClass("e-treegridcollapse"),s.removeClass("e-treegridrowexpand").addClass("e-treegridrowcollapse"),e.enableAltRow&&t.TreeGrid.updateAltRow(u,f,l,u._collapsedRecordCount+1));v=0;u._searchString?(v=u.getUpdatedRecords().filter(function(n){return u.getExpandStatus(n)===!1}),h=(u.getUpdatedRecords().length-v.length)*e.rowHeight):h=(u.getUpdatedRecords().length-u._totalCollapseRecordCount)*e.rowHeight;u._isFromGantt?(u._$treegridHelper.ejTreeGrid("updateHeight",h),u._$ganttchart.ejGanttChart("updateHeight",h),u._$ganttchart.ejGanttChart("setCollapsedRecordCount",u._totalCollapseRecordCount),u._$treegridHelper.ejTreeGrid("setCollapsedRecordCount",u._totalCollapseRecordCount)):u.updateHeight(h);r.expanded?u._trigger("expanded",r):u._trigger("collapsed",r)}if(u._isFromGantt){var w=u._$treegridHelper.ejTreeGrid("instance"),b=u._$ganttchart.ejGanttChart("instance"),k=w._$gridContent.ejScroller("option","scrollTop");b._$bodyContainer.ejScroller("option","scrollTop",k)}a=u.selectedItem();u._isFromGantt||r.expanded||!a||(p=u.getExpandStatus(a),p||(u.selectRows(-1),u.selectedRowIndex(-1),a.isSelected=!1,e.selectedItem=null,c=u.model.editSettings,o=[],c.allowEditing&&!n(n(".e-edit")[0]).parent("li").hasClass("e-disable")&&o.push(n(n(".e-edit")[0]).parent()[0]),c.allowDeleting&&!n(n(".e-delete")[0]).parent("li").hasClass("e-disable")&&o.push(n(n(".e-delete")[0]).parent()[0]),c.allowDeleting&&!n(n(".e-cancel")[0]).parent("li").hasClass("e-disable")&&o.push(n(n(".e-cancel")[0]).parent()[0]),c.allowDeleting&&!n(n(".e-save")[0]).parent("li").hasClass("e-disable")&&o.push(n(n(".e-save")[0]).parent()[0]),n(".e-treegridtoolbar").ejToolbar("disableItem",o)))};t.TreeGrid.expandRecord=function(i,r,u,f){var e=i,a=".gridrowIndex"+r.index.toString()+"level"+(r.level+1).toString(),v=n(a),h=0,l=v.length,y,c,b=e.model,s=n(a),o,p=e.getRows(),w=n(p[o]);for(o=e._isFromGantt?e._currentViewData.indexOf(r):b.currentViewData.indexOf(r),r.hasChildRecords&&r.childRecords.length>0&&(w.find(".e-treegridcollapse").removeClass("e-treegridcollapse").addClass("e-treegridexpand"),w.removeClass("e-treegridrowcollapse").addClass("e-treegridrowexpand")),e._expandedRecordsCount+=e._isFromGantt?s.length/2:s.length,s.length===0&&e.model.allowSearching&&e._searchString&&e._searchString.length>0&&f&&t.TreeGrid.sendExpandCollapseRequest(e,f),s.css({display:"table-row"}),e._isFromGantt&&(l=l/2),h;h<l;h++)y=v[h],o=p.index(y),o!==-1&&(c=e._isFromGantt?e._updatedGanttRecords[o]:e._updatedRecords[o],c.isExpanded=!0,c.expanded&&t.TreeGrid.expandRecord(e,c,u));e._isFromGantt&&e.updateConnectorLines(s,u)};t.TreeGrid.collapseRecord=function(i,r,u){var f=i,p=f.model,l=".gridrowIndex"+r.index.toString()+"level"+(r.level+1).toString(),a=n(l),e=0,s=a.length,v,h,c,o=n(l),w=f.getRows(),y;for(f._collapsedRecordCount+=f._isFromGantt?o.length/2:o.length,o.css({display:"none"}),f._isFromGantt&&(f.updateConnectorLines(o,u),s=s/2),e;e<s;e++)v=a[e],y=f.getRows(),h=f.getRows().index(v),h!==-1&&(c=f.getUpdatedRecords()[h],c.expanded&&t.TreeGrid.collapseRecord(f,c,u))};t.TreeGrid.updateAltRow=function(t,i,r,u){for(var e=t,f=0,l=e.model,c=e._isFromGantt?e._currentViewData:l.currentViewData,a=c.length,o=i.isAltRow,s,h=e.getRows(),f=r+u;f<a;f++)n(h[f]).css("display")!=="none"&&(s=c[f],f!=0&&(s.isAltRow=!o),o=s.isAltRow,o?n(h[f]).addClass("e-alt-row"):n(h[f]).removeClass("e-alt-row"))};jQuery.uaMatch=function(n){n=n.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:t[1]||"",version:t[2]||"0"}}})(jQuery,Syncfusion),function(n,t){t.Grid=t.Grid||{};t.Grid.gridResize=function(t){this.$headerTable=t.getHeaderTable();this.gridInstance=t;this._colMinWidth=15;this._$visualElement=n();this._currentCell=-1;this._allowStart=!1;this._oldWidth=null;this._orgX=null;this._orgY=null;this._extra=null;this._expand=!1;this._target=null};t.Grid.gridResize.prototype={_mouseHover:function(t){var r,o;if(!this._$visualElement.is(":visible")&&(n(t.target).is(".e-headercelldiv")&&(t.target=t.target.parentNode),r=n(t.target),r.hasClass("e-headercell"))){var u=t.target,f=u.getBoundingClientRect(),i=0,e=0;(t.type="mousemove")?(i=t.clientX,e=t.clientY):(t.type="touchmove")?(i=evt.originalEvent.changedTouches[0].clientX,e=evt.originalEvent.changedTouches[0].clientY):(t.type="MSPointerMove")&&(i=t.originalEvent.clientX,e=t.originalEvent.clientY);o=this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns?this.gridInstance.getHeaderContent().width()+this.gridInstance.element.children(".e-gridheader").find(".e-columnheader").offset().left:this.gridInstance.getHeaderTable().width()+this.gridInstance.element.children(".e-gridheader").find(".e-columnheader").offset().left;(i>=f.left+document.documentElement.scrollLeft+u.offsetWidth-5||i<=f.left+3)&&i<o&&i>=f.left&&e<=f.top+document.documentElement.scrollTop+t.target.offsetHeight?(this.gridInstance.model.showStackedHeader&&n(r.parents("thead")).find("tr").css("cursor","col-resize"),this.gridInstance.model.showStackedHeader||r.parent().css("cursor","col-resize"),this._currentCell=n(t.target).hasClass("e-stackedHeaderCell")?this.gridInstance.getHeaderContent().find(".e-headercell:visible").index(u):this.gridInstance.getHeaderContent().find(".e-headercell:visible").not(".e-stackedHeaderCell").index(u),this._allowStart=!0):(r.parent().css("cursor","pointer"),this._allowStart=!1,this._currentCell=-1)}},_start:function(t,i){var e=this.gridInstance.getHeaderTable().find(".e-columnheader"),f,r,o,u;if(f=n(this._target).hasClass("e-stackedHeaderCell")?e.find(".e-headercell"):e.find(".e-headercell").not(".e-stackedHeaderCell"),this._currentCell!=-1&&this._currentCell<f.length&&(r=f[this._currentCell]),typeof r!="undefined")if(o=r.getBoundingClientRect(),this._tableY=o.top+parseInt(navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollTop:document.documentElement.scrollTop),this._allowStart){if(this._$visualElement=n(document.createElement("div")),_height=this.gridInstance.element.find(".e-gridcontent").first().height()+this.gridInstance.element.find(".e-gridheader").height(),this.gridInstance.model.showStackedHeader&&this.gridInstance.model.stackedHeaderRows.length>0){var s=this.gridInstance.getHeaderTable().find("tr.e-columnheader"),c=s.length,h=n(this._target).parent("tr")[0].rowIndex;for(u=0;u<h;u++)_height=_height-n(s[u]).height()}this._$visualElement.addClass("e-reSizeColbg").appendTo(this.gridInstance.element).css({height:_height+"px",cursor:"col-resize"});this._$visualElement.css({left:t,top:this._tableY});this._oldWidth=r.offsetWidth;this._orgX=t;this._orgY=i;this._extra=t-this._orgX;this._expand=!0}else this._currentCell=-1},_mouseMove:function(n){if(this._expand){var t=0,i=0;(n.type="mousemove")?(t=n.clientX,i=n.clientY):(n.type="touchmove")?(t=evt.originalEvent.changedTouches[0].clientX,i=evt.originalEvent.changedTouches[0].clientY):(n.type="MSPointerMove")&&(t=n.originalEvent.clientX,i=n.originalEvent.clientY);navigator.userAgent.indexOf("WebKit")!=-1&&(t=n.pageX,i=n.pageY);t+=document.documentElement.scrollLeft;n.preventDefault();this._moveVisual(t)}else this._mouseHover(n)},_getCellIndex:function(t){var f=n(t._target),u=t._target,i=u.cellIndex,r=i;return t.gridInstance.model.groupSettings.groupedColumns.length&&(r=i-t.gridInstance.model.groupSettings.groupedColumns.length),r},_reSize:function(t){var p=this,r,o,e,h,i,s;if(this._initialTableWidth=this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns?this.gridInstance.getHeaderTable().first().parent().width()+this.gridInstance.getHeaderTable().last().parent().width():this.gridInstance.getHeaderTable().parent().width(),this.gridInstance.model.enableRTL||this._getResizableCell(),o=n(this._target).closest("tr"),this._currentCell!=-1&&this._expand){this._expand=!1;var l=o.find(".e-headercell").filter(":visible"),a=l[this._currentCell],u=a.offsetWidth,f=t-this._orgX;if(parseInt(f)+parseInt(u)>this._colMinWidth&&(f!=0&&o.css("cursor","default"),this._resizeColumnUsingDiff(u,f),r=this.gridInstance.element.find(".e-gridcontent").first(),this.gridInstance.model.allowScrolling&&r.ejScroller("refresh"),e=this.gridInstance.getBrowserDetails(),e.browser=="msie"&&this.gridInstance.model.allowScrolling&&(h=this.gridInstance.getContentTable().width(),i=this.gridInstance._calculateWidth(),this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns>0?(this.gridInstance.getHeaderTable().last().width(i-this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width()),this.gridInstance.getContentTable().last().width(i-this.gridInstance.getContent().find(".e-frozencontentdiv").width()),this.gridInstance.model.showSummary&&this.gridInstance.getFooterTable().last().width(i-this.gridInstance.getFooterContent().find(".e-frozenfootertdiv").width())):(this.gridInstance.getHeaderTable().width(i),this.gridInstance.model.showSummary&&this.gridInstance.getFooterTable().width(i)),parseInt(e.version,10)>8&&this.gridInstance.model.groupSettings&&this.gridInstance.model.groupSettings.groupedColumns.length&&(i>h?(this.gridInstance.getContentTable().width(i),this.gridInstance.getContentTable().children("colgroup").find("col").first().css("width",2e3/r.find("table").first().width()+"%")):(this.gridInstance.getContentTable().css("width","100%"),this.gridInstance._groupingAction(),this.gridInstance.getContentTable().children("colgroup").find("col").first().css("width",(this.gridInstance.getHeaderTable().find("colgroup").find("col").first().width()/r.find("table").first().width()*100).toFixed(2)+"%"))),this.gridInstance.getHeaderTable().parent().scrollLeft(r.find(".e-content").scrollLeft()-1)),this.gridInstance._colgroupRefresh(),this.gridInstance.model.groupSettings.groupedColumns.length&&this.gridInstance.model.groupSettings.showGroupedColumn&&this.gridInstance._recalculateIndentWidth(),e.browser=="msie"||!this.gridInstance.model.allowScrolling||this.gridInstance.model.scrollSettings.frozenColumns!=0||(s=this.gridInstance._calculateWidth(),this.gridInstance.getHeaderTable().width(s),this.gridInstance.getContentTable().width(s)),this.gridInstance.model.allowResizing&&this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor")=="default")){var c=this._getCellIndex(this),v=u+f,y={columnIndex:c,column:this.gridInstance.model.columns[c],oldWidth:u,newWidth:v};this.gridInstance._trigger("resized",y)}}this._target=null;this._$visualElement.remove();this._expand=!1;this._currentCell=-1;this._allowStart=!1},_getFrozenResizeWidth:function(){for(var t=this.gridInstance.getHeaderTable().find("colgroup").find("col").slice(0,this.gridInstance.model.scrollSettings?this.gridInstance.model.scrollSettings.frozenColumn:0),i=0,n=0;n<t.length;n++)t.eq(n).css("display")!="none"&&(i+=parseInt(t[n].style.width.replace("px","")));return i},_diaplayFinder:function(){return n(this).css("display")!="none"},_resizeColumnUsingDiff:function(t,i){var ft=this,h=this._currntCe=this._currentCell,o,b,f,i,tt,ut,l,a,e,s,r,v,u,y;if(n(this._target).parent("tr").hasClass("e-stackedHeaderRow")){for(var p=0,w=n(this._target),et=n(w).attr("colspan"),it=n(w).parent("tr");h>0;)h--,b=n(it).children("th")[h],p+=parseInt(n(b).attr("colspan"));this._currentCell=p}var k=this.gridInstance.getHeaderTable().find("colgroup").find("col"),d=k.filter(this._diaplayFinder).eq(this.gridInstance.model.allowGrouping?this._currentCell+this.gridInstance.model.groupSettings.groupedColumns.length:this._currentCell),c,g,ot=k.slice(0,this.gridInstance.model.scrollSettings?this.gridInstance.model.scrollSettings.frozenColumns:0),nt=d[0].style.width,rt=t/parseInt(nt);if(o=i=i/rt,f=parseInt(i)+parseInt(nt),f>0&&i!=0){if(f<this._colMinWidth&&(f=this._colMinWidth),i=f-t,this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns){if(this._currentCell>=0&&this._currentCell<this.gridInstance.model.scrollSettings.frozenColumns&&this._getFrozenResizeWidth()+i>this.gridInstance.element.find(".e-headercontent").first().width())return;c=this.gridInstance.getContentTable().find("colgroup").find("col").filter(this._diaplayFinder).eq(this._currentCell)}else c=this.gridInstance.getContentTable().find("colgroup").first().find("col").filter(this._diaplayFinder).eq(this.gridInstance.model.allowGrouping?this._currentCell+this.gridInstance.model.groupSettings.groupedColumns.length:this._currentCell);if(this.gridInstance.model.showSummary&&(g=this.gridInstance.getFooterTable().find("colgroup").find("col").filter(this._diaplayFinder).eq(this._currentCell),g.outerWidth(f)),n(this._target).parent("tr").hasClass("e-stackedHeaderRow")?this._resizeStackedHeaderColumn(n(this._target).parent("tr"),o,this._currntCe):d.outerWidth(f),this.gridInstance.model.isEdit&&(tt=this.gridInstance.getContentTable().find(".e-editedrow,.e-addedrow").find("table").find("colgroup"),n(tt[0].children[this._currentCell-this.gridInstance.model.groupSettings?this.gridInstance.model.groupSettings.groupedColumns.length:0]).width(f)),n(this._target).parent("tr").hasClass("e-stackedHeaderRow"))if(this.gridInstance.model.groupSettings.groupedColumns.length<1)for(ut=this.gridInstance.getContentTable().find("colgroup").find("col").filter(this._diaplayFinder).length,r=0;r<this._changedcell.length;r++)l=this.gridInstance.getContentTable().find("colgroup").find("col").filter(this._diaplayFinder)[this._changedcell[r]],u=parseInt(o)+parseInt(l.style.width),n(l).width(u);else for(a=this.gridInstance.getContentTable().find(".e-recordtable"),e=a.find("colgroup"),r=0;r<this._changedcell.length;r++)for(s=this._changedcell[r],r=0;r<e.length;r++)u=parseInt(o)+parseInt(n(e[r].children[s]).width()),n(e[r].children[s]).width(u);else if(this.gridInstance.model.groupSettings&&this.gridInstance.model.groupSettings.groupedColumns.length){var a=this.gridInstance.getContentTable().find(".e-recordtable"),e=a.find("colgroup"),s=this._currentCell+this.gridInstance._hiddenColumns.length;for(r=0;r<e.length;r++)n(e[r].children[s]).width(f)}else c.width(f);if(this.gridInstance._findColumnsWidth(),this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns){for(v=this.gridInstance.getContentTable().find("colgroup").find("col").slice(0,this.gridInstance.model.scrollSettings.frozenColumns),u=0,r=0;r<v.length;r++)u+=parseInt(v[r].style.width.replace("px",""));this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(u);y=this.gridInstance.model.enableRTL?"margin-right":"margin-left";this.gridInstance.getContent().find(".e-frozencontentdiv").width(u).next().css(y,u+"px");this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(u).next().css(y,u+"px");this.gridInstance.model.showSummary&&this.gridInstance.getFooterContent().find(".e-frozenfooterdiv").width(u)}this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor","default")}},_resizeStackedHeaderColumn:function(t,i,r){var l,a,u,h,v,f,e;this._changedcell=[];this.gridInstance.model.groupSettings.showGroupedColumn&&this.gridInstance.model.groupSettings.groupedColumns.length>0&&(this._currentCell++,r++);var o=this._currentCell,c=n(t).find("th")[r],s=n(c).attr("colspan"),y=i/s,p=n(c).parent("tr");if(s>1)for(l=p.next(),a=o+parseInt(s),u=o;u<a;u++)h=n(n(l).find("th"))[u],v=n(h).attr("colspan"),v>1?this._resizeStackedHeaderColumn(n(h).parent("tr"),y,u):(f=this.gridInstance.getHeaderTable().find("col")[u],this._changedcell.push(u),e=parseInt(i)+parseInt(f.style.width),n(f).outerWidth(e));else f=this.gridInstance.getHeaderTable().find("col")[this._currentCell],e=parseInt(i)+parseInt(f.style.width),this._changedcell.push(o),n(f).outerWidth(e)},_triggerResizeEvents:function(t,i){var h=this.gridInstance.getHeaderTable().find(".e-columnheader"),c=h.find(".e-headercell").filter(":visible"),f=c[this._currentCell],e=f.offsetWidth,r=this._getCellIndex(this),o,s,u;t=="resizeStart"?(u={columnIndex:r,column:this.gridInstance.model.columns[r],target:n(f),oldWidth:e},this.gridInstance._trigger("resizeStart",u)):(o=i-this._orgX,s=e+o,this.gridInstance._colgroupRefresh(),u={columnIndex:r,column:this.gridInstance.model.columns[r],target:n(f),oldWidth:e,newWidth:s,extra:o},this.gridInstance._trigger("resizeEnd",u))},_mouseUp:function(n){if(this._expand){var t=n.clientX,i=n.clientY;navigator.userAgent.indexOf("WebKit")!=-1&&(t=n.pageX,i=n.pageY);this.gridInstance.model.allowResizing&&this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor")=="col-resize"&&this._triggerResizeEvents("resizeEnd",t);t+=document.documentElement.scrollLeft;this._reSize(t,i)}},_getResizableCell:function(){for(var i,r=this.gridInstance.getHeaderTable().find(".e-columnheader"),t=r.find(".e-headercell").not(".e-hide"),u=navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollLeft:document.documentElement.scrollLeft,n=0;n<t.length;n++)if(point=t[n].getBoundingClientRect(),i=point.left+u+5,i>this._orgX){this._currentCell=n-1;return}},_moveVisual:function(n){var t=this.gridInstance.getHeaderContent().find("div").first()[0].getBoundingClientRect();t.left+document.documentElement.scrollLeft+t.width<n||n<t.left+document.documentElement.scrollLeft?this._$visualElement.remove():this._currentCell!=-1&&this._$visualElement.css({left:n,top:this._tableY})},_mouseDown:function(t){var r,u,i;return this._allowStart&&n(t.target).closest("tr").css("cursor")=="col-resize"&&(this._target=t.target,r=t.clientX,u=t.clientY,navigator.userAgent.indexOf("WebKit")!=-1&&(r=t.pageX,u=t.pageY),this.gridInstance.model.allowResizing&&this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor")=="col-resize"&&(n(t.target).is(".e-headercelldiv")&&(t.target=t.target.parentNode),this._target=t.target,this._triggerResizeEvents("resizeStart",r)),i=this,r+=document.documentElement.scrollLeft,t.button!=2&&(this.gridInstance.model.allowResizing&&this.gridInstance.model.allowResizeToFit?(i.gridInstance._click++,setTimeout(function(){i.gridInstance._click==1?i._start(r,u):i.gridInstance._click==2&&i._columnResizeToFit(t);i.gridInstance._click=0},400)):this._start(r,u)),t.preventDefault()),!1},_columnResizeToFit:function(t){var f,a,o,e,v,s;if(this.gridInstance.model.allowResizeToFit&&this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor")=="col-resize"&&(n(t.target).is(".e-headercelldiv")&&(t.target=t.target.parentNode),f=n(t.target),this._target=f,f.hasClass("e-headercell"))){var h=t.target,u=h.cellIndex,i=u;this._orgX=t.pageX;this._getResizableCell();u!=this._currentCell&&(u=i=this._currentCell,h=t.target.previousSibling);a=n(h).children(".e-headercelldiv");this.gridInstance.model.groupSettings.groupedColumns.length&&(i=u-this.gridInstance.model.groupSettings.groupedColumns.length);var r=0,c=0,l=0;i!=-1&&(l=this._getContentWidth(i),c=this._getHeaderContentWidth(a),r=c>l?c:l,r=r+r*.2,o=this.gridInstance.getHeaderTable().find("col").eq(u).width(),e={columnIndex:i,column:this.gridInstance.model.columns[i],target:f,oldWidth:o},this.gridInstance._trigger("resizeStart",e),this.gridInstance.getHeaderTable().find("col").eq(u).width(r),this.gridInstance.model.groupSettings.groupedColumns.length?(v=this.gridInstance.getContentTable().find(".e-recordtable").find("colgroup"),n.each(v,function(t,u){n(u).find("col").eq(i).width(r)})):this.gridInstance.getContentTable().find("col").eq(i).width(r),s=this.gridInstance.getHeaderTable().find("col").eq(u).width(),this.gridInstance._colgroupRefresh(),e={columnIndex:i,column:this.gridInstance.model.columns[i],target:f,oldWidth:o,newWidth:s,extra:Math.abs(s-o)},this.gridInstance._trigger("resizeEnd",e),this.gridInstance._columnsWidthCollection[i]=r,this.gridInstance.model.columns[i].width=r,e={columnIndex:i,column:this.gridInstance.model.columns[i],target:f,oldWidth:o,newWidth:s},this.gridInstance._trigger("resized",e))}},_getContentWidth:function(i){var r=0,u=t.buildTag("span",{},{}),f=this.gridInstance,e;return n.each(f._gridRows,function(t,o){var s=n(o).find("td.e-rowcell").eq(i),h=n(s).html();f.model.columns[i].isUnbound?u.html(n(h).children()):u.html(h);n(s).html(u);e=s.find("span:first").width();e>r&&(r=e);n(s).html(h)}),f._refreshUnboundTemplate(this.gridInstance.getContentTable()),r},_getHeaderContentWidth:function(n){var i=0,r=t.buildTag("span",{},{}),u=n.html();return r.html(u),n.html(r),i=n.find("span:first").width(),n.html(u),i}}}(jQuery,Syncfusion)})