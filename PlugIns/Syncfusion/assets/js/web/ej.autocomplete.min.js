/*!
*  filename: ej.autocomplete.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.scroller.min"],n):n()})(function(){(function(n,t){t.widget("ejAutocomplete","ej.Autocomplete",{element:null,model:null,validTags:["input"],_setFirst:!1,_rootCSS:"e-autocomplete",type:"editor",defaults:{dataSource:null,query:null,fields:{text:null,key:null,category:null,htmlAttributes:null},template:null,allowGrouping:!1,enableDistinct:!1,allowSorting:!0,sortOrder:"ascending",multiSelectMode:"none",delimiterChar:",",allowAddNew:!1,addNewText:"Add New",showRoundedCorner:!1,readOnly:!1,cssClass:"",watermarkText:null,value:"",filterType:"startswith",caseSensitiveSearch:!1,showLoadingIcon:!0,itemsCount:0,minCharacter:1,delaySuggestionTimeout:200,showPopupButton:!1,highlightSearch:!1,enableAutoFill:!1,enableRTL:!1,enabled:!0,height:"",width:"",emptyResultText:"No suggestions",showEmptyResultText:!0,enablePersistence:!1,popupHeight:"152px",popupWidth:"auto",focusIn:null,focusOut:null,change:null,select:null,create:null,destroy:null},dataTypes:{cssClass:"string",filterType:"enum",caseSensitiveSearch:"boolean",showLoadingIcon:"boolean",template:"string",allowGrouping:"boolean",enableDistinct:"boolean",allowSorting:"boolean",sortOrder:"enum",allowAddNew:"boolean",addNewText:"string",showRoundedCorner:"boolean",readOnly:"boolean",itemsCount:"number",minCharacter:"number",showPopupButton:"boolean",highlightSearch:"boolean",enableAutoFill:"boolean",enableRTL:"boolean",multiSelectMode:"enum",delimiterChar:"string",emptyResultText:"string",showEmptyResultText:"boolean",enabled:"boolean",enablePersistence:"boolean",dataSource:"data",query:"data",fields:"data"},observables:["value"],enable:function(){this.model.enabled||(this.model.enabled=!0,this.target.disabled=!1,this.element.removeClass("e-disable").attr({"aria-disabled":!1}),this.model.showPopupButton&&this.dropdownbutton.removeClass("e-disable").attr({"aria-disabled":!1}),this.model.multiSelectMode=="visualmode"&&this._ulBox.removeClass("e-disable").attr({"aria-disabled":!1}))},disable:function(){this.model.enabled&&(this._hideResult(),this.element.attr("aria-expanded",!1),this.model.enabled=!1,this.target.disabled=!0,this.element.addClass("e-disable").attr({"aria-disabled":!0}),this.model.showPopupButton&&this.dropdownbutton.addClass("e-disable").attr({"aria-disabled":!0}),this.model.multiSelectMode=="visualmode"&&this._ulBox.addClass("e-disable").attr({"aria-disabled":!0}))},clearText:function(){this.model.enabled&&(this.model.multiSelectMode=="visualmode"&&this._deleteBox(this._ulBox.children("li")),this.element.val(""),this._valueChange(),this._isFocused?this.element.blur():this._targetBlur())},getValue:function(){return this.model.multiSelectMode=="visualmode"?this._hiddenInput.val():this.element.hasClass("e-watermark")?"":this.target.value},getSelectedItems:function(){return this._selectedItems},_setValue:function(i){var r,u;if(this.element.hasClass("e-watermark")&&this.element.removeClass("e-watermark"),(typeof i=="object"||typeof i=="number"&&isNaN(i))&&(i=""),i=n.trim(i),this.element.val(""),i)if(this.model.multiSelectMode=="visualmode")if(this._selectedItems=[],this._deleteBox(this._ulBox.children("li")),this._hiddenInput.val(i),r=i.split(this.model.delimiterChar),t.DataManager&&this.model.dataSource instanceof t.DataManager)this._createBoxForObjectType(r);else if(this.suggestionListItems=this.model.dataSource,typeof this.suggestionListItems[0]!="object")for(u=0;u<r.length;u++)r[u]&&(this._ulBox.append(this._createBox(r[u])),this._selectedItems.push(r[u]));else this._createBoxForObjectType(r);else this.element.val(i),this._hiddenInput.val(i),this._updateSelectedItemArray();else this._hiddenInput.val("");return this.model.value=this.model.multiSelectMode=="visualmode"?this._hiddenInput.val():this.element.val(),this._preVal=this.element.val(),this._isWatermark||this._setWatermarkTxt(),i},_createBoxForObjectType:function(i){var f,u,e,o,h=this,s,r;for(e=this.model.fields,mapFld={_key:null,_text:null,_attr:null},mapFld._text=e&&e.text?e.text:"text",s=0;s<i.length;s++)r=n.trim(i[s]),t.DataManager&&this.model.dataSource instanceof t.DataManager?(f=this._getQuery().where(mapFld._text,"equal",r,!1),u=this.model.dataSource.executeQuery(f),u.done(function(n){var t=n.result;o=t instanceof Array&&t.length?t[0]:r;h._selectedItems.push(o)}).fail(function(){h._selectedItems.push(r)})):(f=t.Query().where(mapFld._text,"equal",r,!1),u=t.DataManager(this.suggestionListItems).executeLocal(f),o=u instanceof Array&&u.length?u[0]:r,this._selectedItems.push(o)),this._ulBox.append(this._createBox(r))},selectValueByKey:function(n){this._setOperation(n,"key")},selectValueByText:function(n){this._setOperation(n,"text")},_setOperation:function(n,i){var e;if(!this.model.enabled)return!1;var o="",u,f,s=this,r=this.model.dataSource;if(t.isNullOrUndefined(r))return!1;if(typeof r[0]=="object"||r instanceof t.DataManager)e=this.model.fields,o=e&&e[i]?e[i]:i;else if(i=="key")return!1;if(t.DataManager&&r instanceof t.DataManager)f=this._getQuery().where(o,"equal",n,!this.model.caseSensitiveSearch),u=r.executeQuery(f),u.done(function(n){s._setText(n.result[0])});else{if(!r||!r.length||r.length<1)return!1;f=t.Query().where(o,"equal",n,!this.model.caseSensitiveSearch);u=t.DataManager(r).executeLocal(f);this._setText(u[0])}},_setText:function(n){if(!n)return!1;var t,i=this.model.fields;if(t=typeof this.model.dataSource[0]=="object"||typeof n=="object"?i&&i.text?n[i.text]:n.text:n,t){if(this.model.multiSelectMode=="visualmode"&&this._removeDuplicates(n))return!1;this._valueToTextBox(t,n,!0);this.model.value=this.model.multiSelectMode=="visualmode"?this._hiddenInput.val():this.element.val()}},_valueToTextBox:function(n,t,i){var r;this.model.multiSelectMode=="visualmode"?(this._addNewTemplate&&(n=n.substr(0,n.length-this._addNewTemplate.length)),r=this._hiddenInput.val()?this.model.delimiterChar:"",this._hiddenInput.val(this._hiddenInput.val()+r+n),this.element.val(""),this._ulBox.append(this._createBox(n))):this.model.multiSelectMode=="delimiter"?(r=this.target.value.lastIndexOf(this.model.delimiterChar),i?this.element.val(this.element.val()==""?n:this.element.val()+this.model.delimiterChar+n):this.element.val(this._queryString.substr(0,r+1)+n+this.model.delimiterChar+" ")):this.element.val(n);this._selectedItems.push(t);this._moveCaretToEnd(this.element[0])},_removeDuplicates:function(n){return this._selectedItems.length==0?!1:this._selectedItems.indexOf(n)!=-1?!0:void 0},search:function(){this.model.enabled&&this._checkDelimiter()&&(this._hideResult(),this.element.attr("aria-expanded",!1),this._autoFill=!1,this._queryString=n.trim(this._queryString),this._queryString.length>0&&this._OnTextEnter())},hide:function(){this._hideResult();this.element.attr("aria-expanded",!1)},_changeWatermark:function(n){this._isWatermark?this.element.attr("placeholder",n):this.element.hasClass("e-watermark")&&this.element.val(n)},_changeSkin:function(n){this.wrapper.removeClass(this.model.cssClass).addClass(n);this.suggestionList.removeClass(this.model.cssClass).addClass(n)},_setDropdown:function(n){this.model.showPopupButton=n;n?this._renderDropdown():this._destroyDropdown()},_changeHeight:function(n){this.wrapper.height(n)},_changeWidth:function(n){this.wrapper.width(n);this._setListWidth()},_init:function(){if(!this.element.is("input")||this.element.attr("type")&&this.element.attr("type")!="text")return!1;this._initialize();this._render();this._wireEvents()},_setModel:function(n){if(!this.model.enabled&&t.isNullOrUndefined(n.enabled))return!1;for(var i in n)switch(i){case"dataSource":this.model.dataSource=null;break;case"watermarkText":this._changeWatermark(n[i]);break;case"delaySuggestionTimeout":this.model.delaySuggestionTimeout=parseInt(n[i]);break;case"value":n[i]=this._setValue(n[i]);this._valueChange();break;case"showPopupButton":this._setDropdown(n[i]);break;case"enableRTL":this._RightToLeft(n[i]);break;case"showRoundedCorner":this._setRoundedCorner(n[i]);break;case"readOnly":this.model.readOnly=n[i];this._checkReadOnly();break;case"delimiterChar":n[i]=this._validateDelimiter(n[i]);break;case"multiSelectMode":this.model.multiSelectMode=n[i];n[i]=="visualmode"?this._renderBoxModel():this.element.hasClass("e-visual-mode")&&this._destroyBoxModel();this._setValue(this.model.value);break;case"enabled":this._disabled(!n[i]);break;case"height":this._changeHeight(n[i]);break;case"width":this._changeWidth(n[i]);break;case"cssClass":this._changeSkin(n[i]);break;case"itemsCount ":(n[i]<=0||isNaN(n[i]))&&(n[i]=0);break;case"popupHeight":this.suggestionList.css({"max-height":n[i]});break;case"popupWidth":this.model.popupWidth=n[i];this._setListWidth()}},_destroy:function(){this.element.insertAfter(this.wrapper);this.wrapper.remove();this.element.removeClass("e-input e-watermark").val("");this._isWatermark&&this.element.removeAttr("placeholder");this.suggestionList.remove()},_initialize:function(){this.element.attr("role","combobox").attr("aria-label","Autocomplete textbox").attr("aria-expanded",!1).attr("tabindex",0).attr("aria-autocomplete","list").attr("value",this.model.value);this.target=this.element[0];this.dropdownbutton=null;this.showSuggestionBox=!1;this.noresult=!0;this._queryString=null;this.suggLen=0;this._selectedItems=[];this._activeItem=0;this.ctrlKeyPressed=!1;this._isFocused=!1;this._isOpened=!1;this._isWatermark=this._checkWatermarkSupport()},_render:function(){this._renderWrapper();this._setDimentions();this._renderDropdown();this._checkProperties();this._setWatermark();this._renderSuggestionList();this._RightToLeft(this.model.enableRTL);this._setRoundedCorner(this.model.showRoundedCorner)},_renderWrapper:function(){this.element.addClass("e-input").attr("autocomplete","off");this.wrapper=t.buildTag("span.e-atc e-widget "+this.model.cssClass+"#"+this.target.id+"_wrapper").insertAfter(this.element);this.container=t.buildTag("span.e-in-wrap e-box").append(this.element);this.wrapper.append(this.container);this._hiddenInput=t.buildTag("input#"+this.target.id+"_hidden","",{},{type:"hidden"}).insertBefore(this.element)},_renderDropdown:function(){if(this.model.showPopupButton){var i=t.buildTag("span.e-icon e-search");this.dropdownbutton=t.buildTag("span.e-select#"+this.target.id+"_dropdown").append(i);this.container.append(this.dropdownbutton).addClass("e-padding");this.dropdownbutton.bind("mousedown",n.proxy(this._OnDropdownClick,this))}},_setDimentions:function(){this.model.height&&this.wrapper.height(this.model.height);this.model.width&&this.wrapper.width(this.model.width)},_renderBoxModel:function(){this._ulBox=t.buildTag("ul.e-ul e-boxes");this.element.val("").removeAttr("name").width(1).addClass("e-visual-mode");this.container.prepend(this._hiddenInput,this._ulBox);this.wrapper.height("auto");this._on(this.container,"mousedown",function(t){if(!this.model.enabled)return!1;var i=n(t.target);i.is(this.element)||(t.preventDefault(),this._isFocused||this.element.focus(),i.hasClass("e-options")?(!t.ctrlKey&&i.siblings().hasClass("e-active")&&this._removeActive(),i.hasClass("e-active")?i.removeClass("e-active"):i.addClass("e-active")):this._moveCaretToEnd(this.element[0]));!t.ctrlKey&&(i.hasClass("e-boxes")||i.hasClass("e-input"))&&this._removeActive()})},_destroyBoxModel:function(){this.container.prepend(this.element);this.element.attr({name:this._hiddenInput.attr("name")}).removeAttr("style").removeClass("e-visual-mode");this.wrapper.height(this.model.height);this._hiddenInput.remove();this._ulBox.remove();this._off(this.container,"mousedown")},_deleteLastBox:function(){var t=this._ulBox.children(),n=t.last(),i=n.hasClass("e-active");this._removeActive();i?this._deleteBox(n):n.addClass("e-active")},_deleteBox:function(t){for(var e,r,u,f,i=0;i<t.length;i++)e=this._ulBox.children(),r=e.index(t[i]),this._selectedItems.splice(r,1),u=this.model.delimiterChar,f=this._hiddenInput.val().split(u),f.splice(r,1),this._hiddenInput.val(f.join(u)),n(t[i]).remove();this.showSuggestionBox&&this._refreshPopup();this._valueChange()},_removeActive:function(){this._ulBox.children("li.e-active").removeClass("e-active")},_adjustWidth:function(){var n=t.buildTag("span",this.element.val()),i,r;this.container.append(n);r=30;i=n.width()+r;this.element.width()!=i&&this.element.width(i);n.remove()},_checkProperties:function(){this._checkReadOnly();this.model.delimiterChar=this._validateDelimiter(this.model.delimiterChar);this.model.enabled||(this.model.enabled=!0,this._disabled(!0));this.model.multiSelectMode=="visualmode"&&this._renderBoxModel();this._checkNameAttr();this.model.value=this._setValue(this.model.value)},_checkNameAttr:function(){this.element.attr("name")?this._hiddenInput.attr("name",this.element.attr("name")):(this._hiddenInput.attr("name",this.element[0].id),this.element.attr("name",this.element[0].id))},_disabled:function(n){n?this.disable():this.enable()},_destroyDropdown:function(){this.dropdownbutton.unbind("mousedown",n.proxy(this._OnDropdownClick,this));this.dropdownbutton.remove();this.dropdownbutton=null;this.container.removeClass("e-padding")},_validateDelimiter:function(n){if(n.length==1)if(!/^[a-zA-Z0-9]+$/.test(n))return n;return","},_checkWatermarkSupport:function(){return"placeholder"in document.createElement("input")},_setWatermark:function(){this._isWatermark&&this.element.attr("placeholder",this.model.watermarkText)},_setWatermarkTxt:function(){this.model.watermarkText!=null&&n.trim(this.element.val())==""&&(this.element.addClass("e-watermark"),this.element.val(this.model.watermarkText))},_renderSuggestionList:function(){var r=n("#"+this.element.context.id+"_suggestion").get(0),i;r&&n(r).remove();this.suggestionList=t.buildTag("div.e-atc-popup e-popup e-widget e-box "+this.model.cssClass+"#"+this.target.id+"_suggestion","",{display:"none"}).attr("role","listbox");this.element.attr("aria-owns",this.target.id+"_suggestion");this.popup=this.suggestionList;i=t.buildTag("div");this.ul=t.buildTag("ul.e-ul").attr("role","listbox");i.append(this.ul);this.suggestionList.append(i);n("body").append(this.suggestionList);this._setListWidth();this._setListHeight();this.suggestionList.ejScroller({height:this.suggestionList.height(),width:0,scrollerSize:20});this.scrollerObj=this.suggestionList.ejScroller("instance")},_checkEmptyList:function(){this.model.multiSelectMode=="visualmode"&&this._removeRepeated();this.suggestionListItems.length==0?(this.suggestionListItems.push(this.model.emptyResultText),this.noresult=!0):this.noresult=!1},_showSuggestionList:function(){this._checkEmptyList();this._addNewTemplate=null;this.noresult&&this.model.multiSelectMode=="visualmode"&&this.model.allowAddNew&&this.element.val()!=""&&(this.noresult=!1,this.suggestionListItems.pop(),this._addNewTemplate="   ("+this.model.addNewText+")",this.suggestionListItems.push(this.element.val()+this._addNewTemplate),this._checkEmptyList());(!this.noresult||this.model.showEmptyResultText)&&this._generateSuggestionList()},_generateSuggestionList:function(){var i=this.suggestionListItems,r,o,n,u,s,f,e;if(this.ul.empty(),typeof i[0]!="object"){for(this.model.enableDistinct&&(i=t.dataUtil.distinct(i,"",!0)),r=0;r<i.length;r++)o=this.model.highlightSearch&&!this.noresult?this._highlightSuggestion(i[r]):i[r],this.ul.append(t.buildTag("li",o).attr("role","option"));this._currList=i;this._mapper={txt:null,key:null}}else if(n=this.model.fields,u={_key:null,_text:null,_attr:null},u._key=n&&n.key?n.key:"key",u._text=n&&n.text?n.text:"text",u._attr=n&&n.htmlAttributes?n.htmlAttributes:"htmlAttributes",this._mapper={txt:u._text,key:u._key},this._currList=[],this.model.enableDistinct&&(i=t.dataUtil.distinct(i,u._text,!0)),this.model.allowGrouping)for(s=n&&n.category?n.category:"category",e=t.Query().group(s),this._addSortingQuery(e,"key"),f=t.DataManager(i).executeLocal(e),this._swapUnCategorized(f),r=0;r<f.length;r++)f[r].key&&this.ul.append(t.buildTag("li.e-category",f[r].key).attr("role","option")),this._generateLi(f[r].items,u);else this._generateLi(i,u);this._getLiTags().length>0&&this._showResult()},_swapUnCategorized:function(t){n(t).each(function(n,i){if(!i.key){for(var r=n;r>0;r--)t[r]=t[r-1];return t[r]=i,!1}})},_generateLi:function(i,r){for(var f,e,u=0;u<i.length;u++)f=this._getField(i[u],r._text),t.isNullOrUndefined(f)||(this.model.highlightSearch&&(f=this._highlightSuggestion(f)),this.model.template&&(f=this._getTemplatedString(i[u],r._text,f)),e=n(document.createElement("li")).append(f),this._setAttributes(this._getField(i[u],r._attr),e),this.ul.append(e),this._currList=n.merge(this._currList,[i[u]]))},_getLiTags:function(){return this.ul.children("li:not('.e-category')")},_getTemplatedString:function(n,t,i){for(var r=this.model.template,f=r.indexOf("${"),e=r.indexOf("}");f!=-1&&e!=-1;){var o=r.substring(f,e+1),s=o.replace("${","").replace("}",""),u=this._getField(n,s);t==s&&(u=i);u||(u="");r=r.replace(o,u);f=r.indexOf("${");e=r.indexOf("}")}return r},_getField:function(n,i){return t.pvt.getObject(i,n)},_setAttributes:function(n,t){if(n)for(var i in n)t.attr(i,n[i])},_setListWidth:function(){var n=this.model.popupWidth;n&&n!="auto"?this.suggestionList.css({width:n}):this.suggestionList.css({width:this.wrapper.width()})},_setListHeight:function(){this.suggestionList.css({"max-height":this.model.popupHeight})},_refreshPopup:function(){this.model.popupWidth=="auto"&&this.wrapper.outerWidth()!=this.suggestionList.outerWidth()&&(this.suggestionList.css({width:this.wrapper.width()}),this._refreshScroller());this._setListPosition()},_showResult:function(){var i,t;this._refreshPopup();this._refreshScroller();this._isOpened?n(document).bind("mousedown",n.proxy(this._OnDocumentClick,this)):(this.suggestionList.css("display","none"),i=this,clearTimeout(this._typing),this._typing=setTimeout(function(){i.suggestionList.slideDown(200,"easeOutQuad",function(){n(document).bind("mousedown",n.proxy(i._OnDocumentClick,i))})},this.model.delaySuggestionTimeout));this._isOpened=!0;this.showSuggestionBox=!0;t=this._getLiTags();this._listSize=t.size();t.bind("mouseenter",n.proxy(this._OnMouseEnter,this));t.bind("mouseleave",n.proxy(this._OnMouseLeave,this));t.bind("click",n.proxy(this._OnMouseClick,this));n(window).bind("resize",n.proxy(this._OnWindowResize,this))},_hideResult:function(){this.showSuggestionBox&&(this.showSuggestionBox=!1,this._activeItem=0,this._isOpened?this.suggestionList.css("display","none"):this.suggestionList.slideUp(100,"easeOutQuad"),n(document).unbind("mousedown",n.proxy(this._OnDocumentClick,this)),n(window).unbind("resize",n.proxy(this._OnWindowResize,this)))},_refreshScroller:function(){this.suggestionList.css("height","auto");this.suggestionList.find(".e-content, .e-vscroll").removeAttr("style");this.suggestionList.find(".e-vscroll div").removeAttr("style");this.suggestionList.find(".e-content, .e-vhandle").removeAttr("style");this.suggestionList.find(".e-vhandle div").removeAttr("style");this.suggestionList.css("display","block");this.suggestionList.height()>parseInt(this.model.popupHeight.replace("px",""))-4?(this.scrollerObj.model.height=this.suggestionList.height(),this.scrollerObj.refresh(),this.scrollerObj.option("scrollTop",0),this.suggestionList.addClass("e-scroller")):this.suggestionList.removeClass("e-scroller");this.suggestionList.css("height","auto")},_setListPosition:function(){var n=this.wrapper,t=this._getOffset(n),i=t.left,r=n.outerHeight(),u=(r-n.height())/2,f=this._getZindexPartial();this.model.enableRTL&&(i-=this.suggestionList.outerWidth()-n.outerWidth());this.suggestionList.css({left:i+"px",top:t.top+r-u+3+"px","z-index":f})},_getOffset:function(t){var i=t.offset(),r;return n("body").css("position")!="static"&&(r=n("body").offset(),i.left-=r.left,i.top-=r.top),i},_getZindexPartial:function(){var r=this.element.parents(),i,t;return i=n("body").children(),index=i.index(this.popup),i.splice(index,1),n(i).each(function(n,t){r.push(t)}),t=Math.max.apply(t,n.map(r,function(t){if(n(t).css("position")!="static")return parseInt(n(t).css("z-index"))||1})),!t||t<1e4?t=1e4:t+=1,t},_targetFocus:function(){this.model.multiSelectMode=="visualmode"&&this.element.width(30);this.element.hasClass("e-watermark")&&(this.element.removeClass("e-watermark"),this.element.val(""));this.wrapper.addClass("e-focus");this._isFocused=!0;this._trigger("focusIn",{value:this.model.value})},_targetBlur:function(){if(this._isFocused=!1,this.wrapper.removeClass("e-focus"),this._isWatermark||this._setWatermarkTxt(),this._removeSelection(),this.model.multiSelectMode=="visualmode")this._removeActive(),this.element.val("").width(1),this._preVal="";else{if(this.model.multiSelectMode=="delimiter"){var t,i,r;t=n.trim(this.element.val());i=this.model.delimiterChar;r=t.substr(t.length-i.length,t.length);r==i&&(this.element.val(t.substr(0,t.length-i.length)),this._valueChange())}this._updateSelectedItemArray()}this.model.multiSelectMode!="visualmode"&&this._hiddenInput.val(this.element.val());this._trigger("focusOut",{value:this.model.value})},_removeSelection:function(){if(this.model.enableAutoFill){this.element.attr("aria-autocomplete","both");var n=this._getCaretSelection();n.end-n.start!=0&&n.end-n.start!=this.element.val().length&&(this.target.value=this.target.value.substr(0,n.start))}},_removeListHover:function(){this._getLiTags().removeClass("e-hover")},_addListHover:function(){var t=n(this._getLiTags()[this._activeItem-1]);t.addClass("e-hover");this.scrollerObj.setModel({scrollTop:this._calcScrollTop()});t.focus()},_calcScrollTop:function(){for(var u=this.ul.outerHeight(),i=this.ul.find("li"),r=0,t=this.ul.find("li.e-hover").index(),n=0;n<t;n++)r+=i.eq(n).outerHeight();return r-(this.suggestionList.outerHeight()-i.eq(t).outerHeight())/2},_getActiveText:function(){return this._mapper.txt?this._getField(this._currList[this._activeItem-1],this._mapper.txt):this._currList[this._activeItem-1]},_getUniqueKey:function(){var n=null;return this._mapper.key&&(n=this._getField(this._currList[this._activeItem-1],this._mapper.key)),t.isNullOrUndefined(n)&&(n=null),n},_setTextBoxValue:function(){var i,u,t,r,f,e;this._activeItem&&!this.noresult&&(i=this._getActiveText(),u=this._getCaretSelection(),this.suggLen=u.start,t=this.target.value.substr(0,this.suggLen),t&&t.toLowerCase()==i.substr(0,this.suggLen).toLowerCase()?(this.model.multiSelectMode=="delimiter"?(f=this.target.value.lastIndexOf(this.model.delimiterChar),e=n.trim(t.substr(f+1,this.suggLen)),r=t+i.substr(e.length,i.length)):r=t+i.substr(t.length,i.length),this.element.val(r),this._autofilSelection(),this.model.multiSelectMode=="visualmode"&&this._adjustWidth()):this._removeSelection())},_enterTextBoxValue:function(){var n,t,i;this.element.removeClass("e-watermark");!this._activeItem||this.noresult||this.model.readOnly||(n=this._getActiveText(),t=this._currList[this._activeItem-1],this._valueToTextBox(n,t,!1),i=this.model.multiSelectMode=="visualmode"?this._hiddenInput.val():this.element.val(),this._trigger("select",{value:i,text:n,key:this._getUniqueKey()}),this._valueChange())},_createBox:function(i){var r=t.buildTag("span.e-icon e-close"),u=t.buildTag("li.e-options",i).append(r);return this._on(r,"click",function(t){if(!this.model.enabled)return!1;this._deleteBox(n(t.target).parent())}),u},_addLoadingClass:function(){this.model.showLoadingIcon&&this.element.addClass("e-load")},_removeLoadingClass:function(){this.element.removeClass("e-load")},_highlightSuggestion:function(t){if(n.trim(this._queryString)!=""){var f,e,i,r,o,u;f=this.model.caseSensitiveSearch?"g":"gi";u=n.trim(this._queryString);e=this.model.filterType=="startswith"?"^"+u:u;i=new RegExp(e,f);i.test(t)&&(r=t.match(i),o=t.split(i),t="",n(o).each(function(n,i){t+=r[n]?i+"<span class='e-hilight-txt'>"+r[n]+"<\/span>":i}))}return t},_RightToLeft:function(n){n?(this.wrapper.addClass("e-rtl"),this.suggestionList.addClass("e-rtl")):(this.wrapper.removeClass("e-rtl"),this.suggestionList.removeClass("e-rtl"))},_setRoundedCorner:function(n){n?(this.container.addClass("e-corner-all"),this.suggestionList.addClass("e-corner-all")):(this.container.removeClass("e-corner-all"),this.suggestionList.removeClass("e-corner-all"))},_checkReadOnly:function(){this.model.readOnly?(this.element.attr({readonly:"readonly","aria-readonly":!0}),this._off(this.element,"keydown",this._OnKeyDown),this._off(this.element,"keyup",this._OnKeyUp)):(this.element.removeAttr("readonly").removeAttr("aria-readonly"),this._on(this.element,"keydown",this._OnKeyDown),this._on(this.element,"keyup",this._OnKeyUp))},_OnKeyDown:function(t){this.model.filterType!="startswith"&&(this.model.enableAutoFill=!1);switch(t.keyCode){case 37:case 35:case 36:this._removeSelection();break;case 38:t.preventDefault();this.showSuggestionBox&&this.suggestionList&&(this._removeListHover(),this._activeItem>1?this._activeItem-=1:this._activeItem=this._listSize,this._addListHover(),this.model.enableAutoFill&&(this.element.attr("aria-autocomplete","both"),this._queryString=this.target.value,this._setTextBoxValue()));break;case 40:t.preventDefault();this.showSuggestionBox&&this.suggestionList&&(this._removeListHover(),this._activeItem<this._listSize?this._activeItem+=1:this._activeItem=1,this._addListHover(),this.model.enableAutoFill&&(this.element.attr("aria-autocomplete","both"),this._queryString=this.target.value,this._setTextBoxValue()));break;case 8:n.trim(this.element.val())==""&&(this._isOpened=!1);this.model.multiSelectMode=="visualmode"&&this.element.val()==""&&this._deleteLastBox();break;case 17:this.ctrlKeyPressed=!0;break;case 9:this.showSuggestionBox&&(t.preventDefault(),this._queryString=this.element.val(),this._enterTextBoxValue(),this._hideResult(),this.element.attr("aria-expanded",!1));break;case 27:this._isOpened=!1;this._hideResult();this.element.attr("aria-expanded",!1)}this.model.multiSelectMode=="visualmode"&&(t.keyCode!=17&&t.keyCode!=8&&t.keyCode!=46&&this._removeActive(),this._adjustWidth())},_OnKeyUp:function(t){if(this._keyDownComplete(),this.ctrlKeyPressed)return t.keyCode==17&&(this.ctrlKeyPressed=!1),!1;if(n.trim(this.element.val())==""&&t.keyCode==38&&t.keyCode==40)return this._hideResult(),this.element.attr("aria-expanded",!1),!1;if(!this._checkDelimiter())return!1;this._queryString=n.trim(this._queryString);switch(t.keyCode){case 38:case 40:case 37:case 39:case 20:case 16:case 17:case 18:case 35:case 36:case 144:case 9:case 27:break;case 13:t.preventDefault();this._queryString=this.element.val();this._enterTextBoxValue();this.model.enableAutoFill&&(this.element.attr("aria-autocomplete","both"),this.suggLen=this.element.val().length,this._autofilSelection());this._isOpened=!1;this._hideResult();this.element.attr("aria-expanded",!1);break;case 46:if(this.model.multiSelectMode=="visualmode"&&this.element.val()==""){this._deleteBox(this._ulBox.children("li.e-active"));break}case 8:this._queryString.length>=this.model.minCharacter?(this._autoFill=!1,this._OnTextEnter()):(this.noresult=!0,this._hideResult(),this.element.attr("aria-expanded",!1),n.trim(this.element.val())==""&&(this._isOpened=!1));break;default:this._queryString.length>=this.model.minCharacter?(this._autoFill=!0,this._OnTextEnter()):this.noresult=!0}},_getFilteredList:function(n){if(!n||!n.length||n.length<1)this.suggestionListItems=[];else{var i=t.Query();this._addQuery(i,typeof n[0]=="object");this.suggestionListItems=t.DataManager(n).executeLocal(i)}this._doneRemaining()},_performSearch:function(){var n=this.model.dataSource,i;t.DataManager&&n instanceof t.DataManager?n.dataSource.offline?this._getFilteredList(n.dataSource.json):(window.clearTimeout(this.timer),i=this,this.timer=window.setTimeout(function(){i._fetchRemoteDat(n)},700)):this._getFilteredList(n)},_fetchRemoteDat:function(n){var t=this,i,r=this._getQuery();this._addQuery(r,!0);i=n.executeQuery(r);i.fail(function(){t.suggestionListItems=null;t._removeLoadingClass()}).done(function(n){t.suggestionListItems=n.result;t._doneRemaining()})},_addSortingQuery:function(n,t){if(this.model.allowSorting){var i=this.model.sortOrder=="descending"?!0:!1;n.sortBy(t,i)}},_addQuery:function(n,t){var r="",i;t&&(i=this.model.fields,r=i&&i.text?i.text:"text");this._queryString&&n.where(r,this.model.filterType,this._queryString,!this.model.caseSensitiveSearch);this._addSortingQuery(n,r);this.model.itemsCount>0&&n.take(this.model.itemsCount)},_getQuery:function(){var r;if(t.isNullOrUndefined(this.model.query)){var u=[],i=t.Query(),n=this.model.fields;for(r in n)r!=="tableName"&&n[r]&&u.push(n[r]);u.length>0&&i.select(u);this.model.dataSource.dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||i.from(n.tableName)}else i=this.model.query.clone();return i},_OnTextEnter:function(){this._addLoadingClass();this._hideResult();this.element.attr("aria-expanded",!1);this._performSearch()},_doneRemaining:function(){this._showSuggestionList();this.element.attr("aria-expanded",!0).attr("aria-haspopup",!0);this.model.enableAutoFill&&this._autoFill&&!this.noresult&&(this.element.attr("aria-autocomplete","both"),this._activeItem=1,this._queryString=this.target.value,this._setTextBoxValue());this._removeLoadingClass()},_removeRepeated:function(){var t=this.suggestionListItems,n,i;if(!t||t.length==0||this._selectedItems.length==0)return!1;for(n=0;n<this._selectedItems.length;n++)i=t.indexOf(this._selectedItems[n]),i!=-1&&this.suggestionListItems.splice(i,1)},_checkDelimiter:function(){this._queryString=this.element.hasClass("e-watermark")?"":this.element.val();var n=this.model.multiSelectMode!="delimiter"?-1:this._queryString.lastIndexOf(this.model.delimiterChar);return n==-1?!0:n+1==this._queryString.length?(this._hideResult(),this.element.attr("aria-expanded",!1),!1):(this._queryString=this._queryString.substr(n+1,this._queryString.length),!0)},_autofilSelection:function(){var n=this.element[0],t=this.element.val().length;n.setSelectionRange?n.setSelectionRange(this.suggLen,t):n.createTextRange&&(n=n.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",this.suggLen),n.select())},_OnDropdownClick:function(n){this.model.enabled&&!this.model.readOnly&&(n.preventDefault(),this._addLoadingClass(),this.showSuggestionBox?(this._isOpened=!1,this._hideResult(),this.element.attr("aria-expanded",!1),this._removeLoadingClass()):this._showFullList())},_showFullList:function(){this._isFocused||this.element.focus();this._queryString=null;this._autoFill=!1;this._performSearch()},_OnMouseEnter:function(t){var i=t.target;t.target.tagName!="LI"&&(i=n(t.target).parents("li"));this._getLiTags().removeClass("e-hover");n(i).addClass("e-hover");this._queryString=this.element.val();this._activeItem=this._getLiTags().index(n(i))+1},_OnMouseLeave:function(){this._getLiTags().removeClass("e-hover");this.model.highlightSearch&&this._getLiTags().find(".e-hilight-txt").removeClass("e-hover")},_OnMouseClick:function(){this.noresult||(this._enterTextBoxValue(),this._isOpened=!1,this._hideResult(),this.element.attr("aria-expanded",!1))},_OnDocumentClick:function(t){n(t.target).is(this.suggestionList)||n(t.target).parents(".e-atc-popup").is(this.suggestionList)||n(t.target).is(this.element)||n(t.target).parents(".e-atc").is(this.wrapper)?(n(t.target).is(this.suggestionList)||n(t.target).parents(".e-atc-popup").is(this.suggestionList))&&t.preventDefault():(this._isOpened=!1,this._hideResult(),this.element.attr("aria-expanded",!1))},_OnWindowResize:function(){this._refreshPopup()},_valueChange:function(){var n=this.model.multiSelectMode=="visualmode"?this._hiddenInput.val():this.element.val();this.model.value!=n&&(this.model.value=n,this.model.multiSelectMode!="visualmode"&&this._hiddenInput.val(this.element.val()),this._trigger("change",{value:n}))},_updateSelectedItemArray:function(){var i=this.getValue(),t,n;if(this._selectedItems=[],this.model.multiSelectMode=="delimiter")for(t=i.split(this.model.delimiterChar),n=0;n<t.length;n++)t[n]&&this._selectedItems.push(t[n]);else this.model.multiSelectMode=="none"&&i&&this._selectedItems.push(i)},_keyDownComplete:function(){var n=this.element.val();this._preVal!=n&&(this._preVal=n,this.model.multiSelectMode=="visualmode"&&this._adjustWidth(),this._valueChange())},_moveCaretToEnd:function(n){if(typeof n.selectionStart=="number")n.selectionStart=n.selectionEnd=n.value.length;else if(typeof n.createTextRange!="undefined"){var t=n.createTextRange();t.collapse(!1);t.select()}},_getCaretSelection:function(){var n=this.element[0],u=0,f=0,e,t,i,r,o;return isNaN(n.selectionStart)?(e=document.selection.createRange().getBookmark(),t=n.createTextRange(),t.moveToBookmark(e),i=n.createTextRange(),i.collapse(!0),i.setEndPoint("EndToStart",t),r=i.text.length,o=t.text.length,{start:r,end:r+o}):(u=n.selectionStart,f=n.selectionEnd,{start:Math.abs(u),end:Math.abs(f)})},_wireEvents:function(){this._on(this.element,"focus",this._targetFocus);this._on(this.element,"blur",this._targetBlur)}});t.filterType={StartsWith:"startswith",Contains:"contains",EndsWith:"endswith",LessThan:"lessthan",GreaterThan:"greaterthan",LessThanOrEqual:"lessthanorequal",GreaterThanOrEqual:"greaterthanorequal",Equal:"equal",NotEqual:"notequal"};t.SortOrder={Ascending:"ascending",Descending:"descending"};t.MultiSelectMode={None:"none",Delimiter:"delimiter",VisualMode:"visualmode"}})(jQuery,Syncfusion)})