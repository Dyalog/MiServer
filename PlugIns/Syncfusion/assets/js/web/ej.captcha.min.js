/*!
*  filename: ej.captcha.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function(n,t){t.widget("ejCaptcha","ej.Captcha",{element:null,model:null,validTags:["div"],_setFirst:!1,_rootCSS:"e-captcha",defaults:{Id:this._id,targetInput:"",targetButton:"",height:50,width:150,characterSet:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",maximumLength:8,enableCaseSensitivity:!0,enableAutoValidation:!1,customErrorMessage:"",encryptedCode:"",isValid:!0,enableAudio:!1,enableRefreshImage:!1,enableRTL:!1,audioUrl:!0,requestMapper:"",refreshBegin:"",refreshSuccess:"",refreshFailure:"",refreshComplete:"",pathName:"",mapper:""},dataTypes:{Id:"string",targetInput:"string",targetButton:"string",height:"number",width:"number",characterSet:"string",maximumLength:"number",enableCaseSensitivity:"boolean",enableAutoValidation:"boolean",customErrorMessage:"string",encryptedCode:"string",isValid:"boolean",requestMapper:"string",enableAudio:"boolean",enableRefreshImage:"boolean",audioUrl:"string",enableRTL:"boolean",pathName:"string",mapper:"string"},_init:function(){this._initialize();this._wireEvents()},_initialize:function(){n("#"+this._id+"_RefreshButton").ejButton({size:"normal",showRoundedCorner:!0,contentType:"imageonly",prefixIcon:"e-captcha refreshicon",type:"button"});n("#"+this._id+"_PlayAudio").ejButton({size:"normal",showRoundedCorner:!0,contentType:"imageonly",prefixIcon:"e-captcha audioicon",type:"button"});this._control=n("#"+this._id).get(0);this.model.targetInput||(this.model.targetInput=this._id+"_ValidText");this._target=n("#"+this.model.targetInput).get(0);this._captchaImage=n("#"+this._id+"_CaptchaImage").get(0);this._message=n("#"+this._id+"_CaptchaMessage").get(0);this._refreshButton=n("#"+this._id+"_RefreshButton").get(0);this._form=n(this._target).parents("form")[0];this._audioObject=n("#"+this._id+"_AudioObject").get(0);this._audioButton=n("#"+this._id+"_PlayAudio").get(0);this._audioPluginObject=null;this._audioType="audio/wav";this._submitButton=n("#"+this.model.targetButton).get(0);this._submitButton||(this._submitButton=n("[id$="+this.model.targetButton+"]").get(0));this._hiddenField=n("#"+this._id+"_Hidden").get(0);this._audioObject&&(this._isSupportAudio(this._audioType)||this._appendAudioPlugin())},_wireEvents:function(){if(this._FormSubmitDelegate=n.proxy(this.formSubmit,this),this._CaptchaRefreshDelegate=n.proxy(this.refresh,this),this._PlayAudioDelegate=n.proxy(this.playAudio,this),this._audioButton)n(this._audioButton).on("click",this._PlayAudioDelegate);if(this._submitButton)n(this._submitButton).on("click",this._FormSubmitDelegate);if(this._refreshButton)n(this._refreshButton).on("click",this._CaptchaRefreshDelegate)},_unwireEvents:function(){this._audioButton&&n(this._audioButton).unbind("click",this._PlayAudioDelegate);this._submitButton&&n(this._submitButton).unbind("click",this._FormSubmitDelegate);this._refreshButton&&n(this._refreshButton).unbind("click",this._CaptchaRefreshDelegate)},playAudio:function(){try{this._audioPluginObject?this._audioPluginObject.Play():this._audioObject&&this._audioObject.play&&this._audioObject.play()}catch(n){}},_isSupportAudio:function(n){return document.createElement("audio").canPlayType?document.createElement("audio").canPlayType(n).match(/maybe|probably/i)?!0:!1:!1},_appendAudioPlugin:function(){n(this._audioPluginObject).remove();var t=this._createAudioPluginObject();this._audioObject.parentNode.appendChild(t);this._audioPluginObject=n("#"+this._id+"_AudioPlugin").get(0)},_createAudioPluginObject:function(){var n=document.createElement("embed");return n.setAttribute("id",this._id+"_AudioPlugin"),n.setAttribute("src",this.model.audioUrl),n.setAttribute("name","AudioPlugin"),n.setAttribute("enablejavascript","true"),n.setAttribute("type","audio/wav"),n.setAttribute("autostart","false"),n.setAttribute("pluginspage","http://www.apple.com/quicktime/download/"),n.style.top=0,n.style.left=0,n.style.width="0px",n.style.height="0px",n.style.position="absolute",n},_onSuccess:function(n){var t;t=JSON.parse(n);this._validSuccess(t)},_onSuccessAsp:function(n){var t;t=JSON.parse(n.d);this._validSuccess(t)},_displayMessages:function(){this.model.isValid?n("#"+this._id+"_CaptchaMessage").html(""):(n("#"+this._id+"_CaptchaMessage").html(this.model.customErrorMessage),n("#"+this._id+"_ValidText").addClass("error"))},_validSuccess:function(t){try{this._audioPluginObject?this._audioPluginObject.Pause():this._audioObject&&this._audioObject.pause&&this._audioObject.pause()}catch(i){}this._captchaImage.src=t.NewChallenge;this._audioObject&&(this._audioObject.src=t.AudioLink);this.model.audioURL=t.AudioLink;this._audioPluginObject&&this._appendAudioPlugin();this.model.isValid=t.Validation=="false"?!1:!0;this.model.enableAutoValidation&&this._displayMessages();n("#"+this._id+"_ValidText")&&n("#"+this._id+"_ValidText").val("");this.model.encryptedCode=t.Script;n(this._hiddenField).val(this.model.encryptedCode)},_refreshSuccess:function(t){try{this._audioPluginObject?this._audioPluginObject.Pause():this._audioObject&&this._audioObject.pause&&this._audioObject.pause()}catch(i){}this._captchaImage.src=t.NewChallenge;this._audioObject&&(this._audioObject.src=t.AudioLink);this.model.audioUrl=t.AudioLink;this._audioPluginObject&&this._appendAudioPlugin();this.model.encryptedCode=t.EncryptedText;n(this._hiddenField).val(t.EncryptedText)},_onRefreshSuccess:function(n){var t;t=JSON.parse(n);this._refreshSuccess(t)},_onRefreshSuccessAsp:function(n){var t;t=JSON.parse(n.d);this._refreshSuccess(t)},formSubmit:function(t){var i=this,r={Height:this.model.height,Width:this.model.width,CharacterSet:this.model.characterSet,MaximumLength:this.model.maximumLength,CaseSensitive:this.model.enableCaseSensitivity,EnableRefreshImage:this.model.enableRefreshImage,EnableAudio:this.model.enableAudio,ResponseText:n(this._target).val(),EncrytedText:this.model.encryptedCode,Id:this._id,RequestType:"CaptchaRequest"};return this.model.requestMapper?n.ajax({type:"Post",url:this.model.requestMapper,data:r,dataType:"html",async:!1,success:function(n){i._onSuccess(n)},error:function(){}}):this.model.pathName&&n.ajax({type:"POST",url:this.model.pathName+"/"+this.model.mapper,data:'{encryptedCode: "'+this.model.encryptedCode+'",characterSet:"'+this.model.characterSet+'",height:"'+this.model.height+'",targerValue:"'+n(this._target).val()+'" }',contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(n){i._onSuccessAsp(n);return},error:function(){i._trigger("refreshFailure");return}}),!this.model.isValid&&this.model.enableAutoValidation?(t.preventDefault(),t.stopPropagation(),!1):void 0},refresh:function(){var t=this,u={Height:this.model.height,Width:this.model.width,CharacterSet:this.model.characterSet,MaximumLength:this.model.maximumLength,CaseSensitive:this.model.enableCaseSensitivity,ResponseText:n(this._target).val(),EncrytedText:this.model.encryptedCode,EnableRefreshImage:this.model.enableRefreshImage,EnableAudio:this.model.enableAudio,Id:this._id,RequestType:"CaptchaRequest"},i=this.model.refreshBegin,r=this.model;if(i&&(i(t,r),r.getCancel()))return!1;this.model.requestMapper?n.ajax({type:"Post",url:this.model.requestMapper,data:u,dataType:"html",async:!1,success:function(n){t._onRefreshSuccess(n);t._trigger("refreshSuccess");return},error:function(){t._trigger("refreshFailure");return},complete:function(){t._trigger("refreshComplete");return}}):this.model.pathName&&n.ajax({type:"POST",url:this.model.pathName+"/"+this.model.mapper,data:'{encryptedCode: "'+this.model.encryptedCode+'",characterSet:"'+this.model.characterSet+'",height:"'+this.model.height+'",targerValue:"'+n(this._target).val()+'" }',contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){t._onRefreshSuccessAsp(n);t._trigger("refreshSuccess");return},error:function(){t._trigger("refreshFailure");return},complete:function(){t._trigger("refreshComplete");return}})}})})(jQuery,Syncfusion)})