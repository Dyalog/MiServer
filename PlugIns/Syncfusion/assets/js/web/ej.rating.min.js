/*!
*  filename: ej.rating.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function(n,t){t.widget("ejRating","ej.Rating",{_rootCSS:"e-rating",element:null,model:null,validTags:["input"],_setFirst:!1,defaults:{maxValue:5,minValue:0,value:1,allowReset:!0,shapeWidth:23,shapeHeight:23,orientation:"horizontal",incrementStep:1,readOnly:!1,enabled:!0,showTooltip:!0,precision:"full",cssClass:"",width:null,height:null,enablePersistence:!1,create:null,click:null,mouseover:null,mouseout:null,change:null,destroy:null},dataTypes:{maxValue:"number",minValue:"number",allowReset:"boolean",shapeWidth:"number",shapeHeight:"number",orientation:"enum",incrementStep:"number",readOnly:"boolean",precision:"enum",enabled:"boolean"},observables:["value"],value:t.util.valueFunction("value"),_setModel:function(n){if(!this.model.enabled&&t.isNullOrUndefined(n.enabled))return!1;for(var i in n)switch(i){case"allowReset":n[i]?this._showResetButton():this._hideResetButton();break;case"value":this.setValue(t.util.getVal(n[i]));break;case"enabled":this._enabledAction(n[i]);break;case"cssClass":this._changeSkin(n[i]);break;case"height":this._mainDiv.height(n[i]);break;case"width":this._mainDiv.width(n[i]);break;case"readOnly":this._unWireEvents();break;case"orientation":this.model.orientation=n[i];this.refresh();break;case"maxValue":this.model.maxValue=n[i];this.refresh();break;case"minValue":this.model.minValue=n[i];this.refresh();break;case"incrementStep":this.model.incrementStep=n[i];this.refresh();break;case"shapeWidth":this.model.shapeWidth=n[i];this.refresh();break;case"shapeHeight":this.model.shapeHeight=n[i];this.refresh()}},_destroy:function(){this.element.show();this._unWireEvents();this._mainDiv.remove()},_init:function(){this._initialize()},_initialize:function(){this.element.hide();this._mainDiv=t.buildTag("div.e-rating e-widget "+this.model.cssClass,"",{},{tabindex:"0",role:"group","aria-label":"Rating"});t.isNullOrUndefined(this.model.width)||this._mainDiv.width(this.model.width);t.isNullOrUndefined(this.model.height)||this._mainDiv.height(this.model.height);this._mainDiv.insertBefore(this.element);this.model.orientation==t.Orientation.Horizontal?this._mainDiv.addClass("e-horizontal"):this._mainDiv.addClass("e-vertical");this.model.allowReset&&!this.model.readOnly&&this._createReset();this._validation();this._renderShape();this._shapes=this._mainDiv.find("div.e-shape");this._wireEvents();this._CurrentIndex=0;this._initCurrentValue();this._enabledAction(this.model.enabled)},_changeSkin:function(n){this.model.cssClass!=n&&this._mainDiv.removeClass(this.model.cssClass).addClass(n)},_enabledAction:function(n){n?this._mainDiv.removeClass("e-disable"):this._mainDiv.addClass("e-disable")},_validation:function(){this.model.incrementStep<1?this.model.incrementStep=1:this.model.incrementStep>this.model.maxValue&&(this.model.incrementStep=this.model.maxValue)},_createReset:function(){this._mainDiv.find("div.e-reset").length<=0?t.buildTag("div.e-reset","",{width:this.model.shapeWidth+"px",height:this.model.shapeHeight,title:"Reset"},{role:"button","aria-label":"reset","aria-hidden":!1}).appendTo(this._mainDiv):this._mainDiv.find("div.e-reset").show()},_renderShape:function(){var n=Math.round(this.model.maxValue/this.model.incrementStep),o=Math.round(this.model.minValue/this.model.incrementStep),i,r,u,f,e;if(this.model.orientation==t.Rating.Orientation.Horizontal?(i=(n+1)*this.model.shapeWidth,r=this.model.shapeHeight):this.model.orientation==t.Rating.Orientation.Vertical&&(i=this.model.shapeWidth,r=this.model.shapeHeight*n),n>0){for(u=t.buildTag("ul.e-ul","",{width:i+"px",height:r},{}),f=o;f<n;f++)e=t.buildTag("li.e-shape-list","",{width:this.model.shapeWidth+"px",height:this.model.shapeHeight},{tabindex:-1,"aria-describedby":this.element.prop("id")+"_tooltip"}),t.buildTag("div.e-shape inactive","",{width:this.model.shapeWidth+"px",height:this.model.shapeHeight}).appendTo(e),e.appendTo(u);u.appendTo(this._mainDiv)}},_initCurrentValue:function(){var r,i;if(t.isNullOrUndefined(this.value())||this.value()==""||this.value()==0)this._CurrentIndex=0;else if(this.value()>this.model.minValue)for(r=this.value()/this.model.incrementStep-this.model.minValue/this.model.incrementStep,this._CurrentIndex=r,this._valueRefresh(this._CurrentIndex),i=0;i<r;i++)if(this._shapes[i])n(this._shapes[i]).removeClass("inactive").removeClass("active").addClass("selected");else{this._CurrentIndex=i;break}this.value(this._CurrentIndex)},_valueRefresh:function(i){var r,f,u;if(i=Math.ceil(i),r=(this.value()/this.model.incrementStep).toFixed(1),this.model.orientation==t.Rating.Orientation.Horizontal){for(f=this.model.precision=="exact"?(r%1).toFixed(1):this.model.precision=="half"?r%1>.5?1:.5:1,r=((r%1).toFixed(1)!=0?f:r/this._CurrentIndex)*this.model.shapeWidth,u=0;u<i;u++)n(this._shapes[u]).css({width:this.model.shapeWidth+"px"});this._shapes!=null&&n(this._shapes[i-1]).css({width:r+"px"})}else{for(r=((r%1).toFixed(1)!=0?(r%1).toFixed(1):r/this._CurrentIndex)*this.model.shapeHeight,u=0;u<i;u++)n(this._shapes[u]).css({height:this.model.shapeHeight+"px"});this._shapes!=null&&n(this._shapes[i-1]).css({height:r+"px"})}},_reset:function(){var t;if(!this.model.enabled)return!1;n(this._shapes).removeClass("active").removeClass("selected").addClass("inactive");t=this.value();this.value(0);this._CurrentIndex=0;this.element.value=this._CurrValue;this._valueChanged(t)},_fillExactPrecision:function(i,r){var e=this._shapes.index(i)+this.model.minValue/this.model.incrementStep+1,f=this.model,u;if(f.orientation==t.Rating.Orientation.Horizontal){for(u=0;u<this._shapes.length;u++)u<e?n(this._shapes[u]).css({width:f.shapeWidth+"px"}):n(this._shapes[u]).css({width:"0px"});n(i).css({width:r+"px"});this.toolTipValue=((e-1)*f.incrementStep+r/f.shapeWidth*f.incrementStep).toFixed(1)}else{for(u=0;u<e;u++)n(this._shapes[u]).css({height:f.shapeHeight+"px"});for(u=e;u<this._shapes.length;u++)n(this._shapes[u]).css({height:"0px"});n(i).css({height:r+"px"});this.toolTipValue=((e-1)*f.incrementStep+r/f.shapeHeight*f.incrementStep).toFixed(1)}},_fillHalfPrecision:function(i,r){var e=this._shapes.index(i)+this.model.minValue/this.model.incrementStep+1,u=this.model,f;if(u.orientation==t.Rating.Orientation.Horizontal){for(f=0;f<this._shapes.length;f++)f<e?n(this._shapes[f]).css({width:u.shapeWidth+"px"}):n(this._shapes[f]).css({width:"0px"});(r+1)%2==0?(r=u.shapeWidth/2,n(i).css({width:r+"px"}),this.toolTipValue=((e-1)*u.incrementStep+r/u.shapeWidth*u.incrementStep).toFixed(1)):(r=u.shapeWidth,n(i).css({width:r+"px"}),this.toolTipValue=((e-1)*u.incrementStep+r/u.shapeWidth*u.incrementStep).toFixed(1))}else{for(f=0;f<this._shapes.length;f++)f<e?n(this._shapes[f]).css({height:this._starHeight+"px"}):n(this._shapes[f]).css({height:"0px"});r<=u.shapeHeight/2?(r=u.shapeHeight/2,n(i).css({height:r+"px"}),this.toolTipValue=((e-1)*u.incrementStep+r/u.shapeHeight*u.incrementStep).toFixed(1)):(r=u.shapeHeight,n(i).css({height:r+"px"}),this.toolTipValue=((e-1)*u.incrementStep+r/u.shapeHeight*u.incrementStep).toFixed(1))}},_ClickHandler:function(i){var o,u,r,f,e,s;if(this.model.enabled){if(i.target.tagName=="LI"?u=i.target.firstChild:i.target.parentNode.tagName=="LI"&&(u=i.target),u){for(r=this._shapes.index(u)+1,f=0;f<r;f++)this._shapes[f]&&n(this._shapes[f]).removeClass("inactive").removeClass("active").addClass("selected");this._CurrentIndex=r;r=r+this.model.minValue/this.model.incrementStep;e=this.model.incrementStep;s=this.model.orientation==t.Rating.Orientation.Horizontal?((r-1)*e+u.clientWidth/this.model.shapeWidth*e).toFixed(1):((r-1)*e+u.clientHeight/this.model.shapeHeight*e).toFixed(1);o=this.value();this.element.value=s;this.value(s);this._trigger("click",{event:i,value:this.value(),prevValue:o});this._valueChanged(o)}n(i.target).hasClass("e-reset")&&this._reset()}},_MouseOverHandler:function(t){var u,r,f,e,i;if(this.model.enabled){if(r=t.target,t.type=="touchmove"&&(f=t.originalEvent.changedTouches[0],r=document.elementFromPoint(f.pageX,f.pageY)),r.tagName=="LI")u=r.firstChild;else if(r.parentNode.tagName=="LI")u=r;else return!1;for(e=this._shapes.index(u)+1,i=0;i<=this._shapes.length;i++)this._shapes[i]&&(i<e?n(this._shapes[i]).removeClass("inactive").removeClass("selected").addClass("active"):n(this._shapes[i]).removeClass("active").removeClass("selected").addClass("inactive"));this._trigger("mouseover",{event:t,index:e,value:this.value()})}},_MouseOutHandler:function(i){var u,r;if(!this.model.readOnly&&this.model.enabled){if(u=this._CurrentIndex,u!=0)for(r=0;r<this._shapes.length;r++)this._shapes[r]&&(r<u?n(this._shapes[r]).removeClass("active").removeClass("inactive").addClass("selected"):n(this._shapes[r]).removeClass("active").addClass("inactive"));else n(this._shapes).removeClass("active").addClass("inactive");this.model.precision!==t.Rating.Precision.Full&&this._valueRefresh(u);this._trigger("mouseout",{event:i,value:this.value()})}this._hideTooltip(1e3)},_MouseMoveHandler:function(i){var u,f,r,e;if(!this.model.readOnly&&this.model.enabled){if(r=i.target,i.type=="touchmove"&&(e=i.originalEvent.changedTouches[0],r=document.elementFromPoint(e.pageX,e.pageY)),r.tagName=="LI")u=r.firstChild;else if(r.parentNode.tagName=="LI")u=r;else return!1;f=this.model.orientation==t.Rating.Orientation.Horizontal?t.isNullOrUndefined(i.offsetX)?i.pageX-n(r).offset().left:i.offsetX+1:t.isNullOrUndefined(i.offsetY)?i.pageY-n(r).offset().top:i.offsetY+1;this.toolTipValue=(this.model.minValue+(this._shapes.index(u)+1))*this.model.incrementStep;this.model.precision==t.Rating.Precision.Exact?this._fillExactPrecision(u,f):this.model.precision==t.Rating.Precision.Half&&this._fillHalfPrecision(u,Math.round(f))}else this.toolTipValue=(this.value()==null||this.value()==""?0:this.value())+" / "+this.model.maxValue;n(i.target).attr("aria-label",this.toolTipValue);this._showhideTooltip(i.target)},_showTooltip:function(i){this.model.showTooltip&&(n(".e-tooltip").remove(),this.tooltip=t.buildTag("div#"+this.element.prop("id")+"_tooltip.e-tooltip "+this.model.cssClass+" e-corner-all","",{},{role:"tooltip"}),n("body").append(this.tooltip),this._isTooltip=!0,this._setTooltipPosition(i))},_hideTooltip:function(t){this.model.showTooltip&&(n(this.tooltip).fadeOut(t,function(){n(".e-tooltip").remove()}),this._isTooltip=!1)},_showhideTooltip:function(n){this.model.showTooltip&&this._showTooltip(n)},_setTooltipPosition:function(t){if(this.model.showTooltip){this._updateTooltipValue();var e,o,u,f,i,r,s=5;i=n(t);r=this._getOffset(i);this.model.orientation=="vertical"?(f=(this.tooltip.outerHeight()-i.outerHeight())/2,u=i.outerWidth()+s,e=r.top-f,o=r.left+u):(u=(this.tooltip.outerWidth()-i.outerWidth())/2,f=this.tooltip.outerHeight()+s,e=r.top-f,o=r.left-u);this.tooltip.css({top:e,left:o})}},_getOffset:function(t){var i=t.offset(),r;return n("body").css("position")!="static"&&(r=n("body").offset(),i.left-=r.left,i.top-=r.top),i},_updateTooltipValue:function(){this.tooltip[0].innerHTML=this.toolTipValue},_wireEvents:function(){this.model.readOnly||(this._on(this._mainDiv,"mousedown",this._ClickHandler),this._on(this._mainDiv.find("li"),"mouseenter touchmove",this._MouseOverHandler));this._on(this._mainDiv.find("li"),"mouseleave touchend",this._MouseOutHandler);this._on(this._mainDiv.find("li"),t.eventType.mouseMove,this._MouseMoveHandler)},_unWireEvents:function(){this._mainDiv.find("li").unbind("mouseenter touchmove");this._mainDiv.find("li").unbind("mouseleave touchend");this._mainDiv.unbind("mousedown");this.model.precision!==t.Rating.Precision.Full&&this._mainDiv.find("li").unbind(t.eventType.mouseMove)},_valueChanged:function(n){this._trigger("change",{value:this.value(),prevValue:n})},reset:function(){this._reset()},show:function(){if(!this.model.enabled)return!1;this._mainDiv.css("visibility","visible")},hide:function(){if(!this.model.enabled)return!1;this._mainDiv.css("visibility","hidden")},_showResetButton:function(){if(!this.model.enabled)return!1;this._createReset()},_hideResetButton:function(){if(!this.model.enabled)return!1;this._mainDiv.find("div.e-reset").hide()},getValue:function(){return this.value()==null||this.value()==""?"":this.value()},setValue:function(t){if(!this.model.enabled)return!1;t!=null&&(this.value(t),n(this._shapes).removeClass("selected").addClass("inactive"),this._initCurrentValue())},refresh:function(){this._destroy();this._unWireEvents();this._initialize()}});t.Rating.Precision={Full:"full",Half:"half",Exact:"exact"};t.Rating.Orientation={Horizontal:"horizontal",Vertical:"vertical"}})(jQuery,Syncfusion)})