/*!
*  filename: ej.mobile.textbox.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./ej.mobile.core.min","./ej.mobile.application.min","./../common/ej.core.min","./../common/ej.data.min","./../common/ej.unobtrusive.min","./../common/ej.touch.min"],n):n()})(function(){(function(n,t,i){t.widget({ejmTextBox:"ej.mobile.TextBox",ejmPassword:"ej.mobile.Password",ejmMaskEdit:"ej.mobile.MaskEdit",ejmTextArea:"ej.mobile.TextArea"},{_setFirst:!0,_rootCSS:"e-m-text-input",validTags:["input"],type:"editor",defaults:{renderMode:"auto",theme:"auto",showBorder:!0,windows:{renderDefault:!1,allowReset:!0},value:"",watermarkText:"",change:null,enabled:!0,enablePersistence:!1,readOnly:!1},observables:["value"],value:t.util.valueFunction("value"),dataTypes:{theme:"enum",showBorder:"boolean",windows:{allowReset:"boolean"},renderMode:"enum",enabled:"boolean",readOnly:"boolean"},_init:function(){this._cloneElement=this.element.clone();this._isMaskedit=this.pluginName==="ejmMaskEdit"?!0:!1;this._isTextarea=this.pluginName==="ejmTextArea"?!0:!1;this._dataInit();this._renderControl();t._setScroller(this);this._wireEvents(!1);this.model.enabled?this.enable():this.disable()},_dataInit:function(){this._clearClicked=!1;this._isMaskedit&&this._maskInit()},_maskInit:function(){this._isInitialRendered=!0;this._hiddenField=this.element.parent().find("#"+this.model.id+"_maskedithiddenField")[0];this._charMap={"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},_renderControl:function(){t.setRenderMode(this);t.setTheme(this);this.model.renderMode=="windows"&&this.model.windows.renderDefault&&(this.model.theme="default");this._isTextarea?this._textAreaProperties():this._textBoxProperties();this.model.watermarkText!=""&&this.value()==""&&(!this._isMaskedit||this._isTextarea)?this._setWaterMark():this._setValue(this.value());this.model.readOnly&&this._setReadOnly(this.model.readOnly);this.model.showBorder||this._showBorder(!1)},_textBoxProperties:function(){var i=this.element,n=this.model,r;this._wrapper=t.buildTag("div.e-m-"+n.renderMode+" e-m-textbox e-m-"+n.theme);i.after(this._wrapper);this._wrapper.append(i);this.pluginName=="ejmPassword"&&i.attr("type","password");i.addClass("e-m-input-focusout").attr("name",n.id);r=t.buildTag("span");r.addClass("e-m-textspan");this._isMaskedit&&this._isInitialRendered&&(this._keypressFlag=0,this._selectedTextKeyDown=0,this._keydownFlag=0,this._maskLength=n.mask.length,this._maskModel=n.mask.replace(/[9a*]/g,"_"),this._validatedValue=this._maskModel,this._validateValue(),this._setWaterMark());n.windows.allowReset&&!this._isMaskedit&&(this._clearBtn=t.buildTag("div"),this.pluginName=="ejmPassword"?this._clearBtn.addClass("e-m-pass"):this._clearBtn.addClass("e-m-clear"),this._wrapper.append(this._clearBtn),this._clearBtn.css("display","none"));this._wrapper.append(r)},_textAreaProperties:function(){var n=this.element,r=this.model,i;this.defaultHeight=n[0].style.height==""?30:parseInt(n[0].style.height);this._wrapper=t.buildTag("div.e-m-"+r.renderMode+" e-m-textbox e-m-"+r.theme);i=t.buildTag("span");i.addClass("e-m-textspan");n.wrap(this._wrapper);n.css({resize:"none","text-indent":"0px","padding-left":"5px"});n.focus();this._focus();n.after(i);n.attr("rows",1);this._resize()},_touchStart:function(n){t._inputTouchStart(n,this);t.listenEvents([window,window,window],[t.moveEvent(),t.cancelEvent(),t.endEvent()],[this._touchMoveProxy,this._touchEndProxy,this._touchEndProxy],!1)},_touchMove:function(n){t._inputTouchMove(n,this)},_touchEnd:function(n){t._inputTouchEnd(n,this);t.listenEvents([window,window,window],[t.moveEvent(),t.cancelEvent(),t.endEvent()],[this._touchMoveProxy,this._touchEndProxy,this._touchEndProxy],!0)},_createDelegate:function(){this.resize=n.proxy(this._resize,this);this.delayedResize=n.proxy(this._delayedResize,this);this.blur=n.proxy(this._blur,this);this.focus=n.proxy(this._focus,this);this._keyDownProxy=n.proxy(this._keyDown,this);this._keyPressProxy=n.proxy(this._keyPress,this);this._keyUpProxy=n.proxy(this._keyUp,this);this._touchStartProxy=n.proxy(this._touchStart,this);this._touchMoveProxy=n.proxy(this._touchMove,this);this._touchEndProxy=n.proxy(this._touchEnd,this);this._isTextarea||this.isMaskedit||(this._showClearProxy=n.proxy(this._showClear,this),this._clearTextProxy=n.proxy(this._clearText,this))},_wireEvents:function(n){var i=this.element;this._createDelegate();t.listenEvents([i,i,i,i,i,i,i],["change","cut","paste","keydown","focus","blur","keyup"],[this.resize,this.delayedResize,this.delayedResize,this.delayedResize,this.focus,this.blur,this._keyUpProxy],n);t.isDevice()&&t.listenTouchEvent(i,t.startEvent(),this._touchStartProxy,n);this._isMaskedit&&t.listenEvents([i,i],["keydown","keypress"],[this._keyDownProxy,this._keyPressProxy],n);this.model.renderMode!="windows"||!this.model.windows.allowReset||this._isMaskedit||this._isTextarea||t.listenEvents([i,this._clearBtn],["keyup",t.startEvent()],[this._showClearProxy,this._clearTextProxy],n)},_setWaterMark:function(){this.model.watermarkText&&(this.value()==""||this.value()==this._maskModel)?n(this.element).attr("placeholder",this.model.watermarkText).addClass("e-m-watermarktext"):this.value()==""&&this.element.val(this._maskModel)},_removeWaterMark:function(){this.element.hasClass("e-m-watermarktext")&&this.element.val(this._maskModel).removeClass("e-m-watermarktext")},_validateValue:function(){var t=this.value(),i=this._maskModel,o=t?t.length:0,r=-1,n,f,e,u;if(this._maskLength==0)return!0;for(n=0;n<this._maskLength;n++)this._charMap[this.model.mask.charAt(n)]&&(r++,f=t.charCodeAt(r),this._validateChars(f,n)&&(e=i.substring(0,n),u=i.substring(n),i=e+t.charAt(r)+u.substr(1,u.length)));this.element.val(i);this._updateHiddenField()},_showAlert:function(){var t=this;this.element.addClass("e-error").animate({Opacity:1},700,null,function(){n(this.element).removeClass("e-error")})},_updateHiddenField:function(){var t=this.getUnstrippedValue()==this.model.watermarkText?"":this._bindingMode==0?this.getStrippedValue():this.getUnstrippedValue();n(this._hiddenField).val(t)},_selectionText:function(n,t){var i=this._maskModel.substring(n,t);return(this.element.val(this.element.val().substring(0,n)+i+this.element.val().substring(t)),this._keydownFlag==1)?(this._setCaretPosition(n),n):this._keydownFlag==2?(this._setCaretPosition(t),t):n},_caretPosition:function(n){var t=0,i,r;return document.selection?(i=document.selection.createRange(),r=i.text.length,i.moveStart("character",-n.value.length),t=i.text.length-r,r!=0&&(t=this._selectionText(t,i.text.length),this._selectedTextKeyDown=1)):(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart,n.selectionStart!=n.selectionEnd&&(t=this._selectionText(n.selectionStart,n.selectionEnd),this._selectedTextKeyDown=1)),t},_setCaretPosition:function(n){var i=this.element[0],r;t.browserInfo().name=="msie"?i.createTextRange&&(r=i.createTextRange(),r.move("character",n),r.select()):i.selectionStart||i.selectionStart=="0"?(i.focus(),i.setSelectionRange(n,n)):i.focus()},_validateChars:function(n,t){return this.model.mask.charAt(t)=="9"&&n>=48&&n<=57?!0:this.model.mask.charAt(t)=="a"&&(n>=65&&n<=90||n>=97&&n<=122)?!0:this.model.mask.charAt(t)=="*"&&(n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57)?!0:(this._showAlert(),!1)},_seekNext:function(){for(var n=this._caretPosition(this.element[0]),t=n,i=!0;i;){if(n>=0&&n<this._maskLength&&(this._charMap[this.model.mask.charAt(n)]||(this._setCaretPosition(n+1),n++),n!=t)){t=n;continue}i=!1}return n},_seekBefore:function(){var n=this._caretPosition(this.element[0]),i=--n,t=!0;for(this._selectedTextKeyDown==1&&(t=!1);t;){if(n>=0&&n<this._maskLength&&(this._charMap[this.model.mask.charAt(n)]||this._setCaretPosition(--n),n!=i)){i=n;continue}t=!1}return n},_writeBuffer:function(n,t){if(t<=this._maskLength){var i=this.element.val(),u=i.substring(0,t),r=i.substring(t);this.element.val(u+n+r.substr(1,r.length));this._setCaretPosition(t+1)}},_focus:function(){var i=this,n;this._removeWaterMark();this.element.parent().find(".e-m-textspan").removeClass("e-m-default").addClass("e-m-active");this.model.renderMode=="windows"&&(this._clearClicked&&element.focus(),this._clearClicked=!1);this.element.removeClass("e-m-input-focusout").addClass("e-m-input-focusin").parent().find(".e-m-textspan").addClass("e-m-active");this._isMaskedit&&(this._removeWaterMark(),this._updateHiddenField(),n=this.element[0],this._setCaretPosition(n.value.indexOf("_")),selectRange=function(t,i){return this.each(function(){if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,i);else if(this.createTextRange){var r=n.createTextRange();r.collapse(!0);r.moveEnd("character",i);r.moveStart("character",t);r.select()}})});this.model.renderMode!="windows"||!this.model.windows.allowReset||this._isMaskedit||this._isTextarea||this._showClear();i.element[0].scrollLeft=i.element[0].scrollWidth;window.setTimeout(function(){t.setCaretToPos(i.element[0],i.element.val().length,i.element.val().length)})},_blur:function(){this.element.parent().find(".e-m-textspan").removeClass("e-m-active").addClass("e-m-default");this.element.removeClass("e-m-input-focusin").addClass("e-m-input-focusout").parent().find(".e-m-textspan").removeClass("e-m-active");this.element.val()==""&&this._isMaskedit?this.element.val(this._maskModel).removeClass("MaskWaterMark"):this._setWaterMark();this.model.renderMode!="windows"||!this.model.windows.allowReset||this._isMaskedit||this._isTextarea||this._clearBtn.css("display","none");this.element[0].scrollLeft=0},_keyUp:function(){var n={value:this.element.val()};this.value(n.value);t._setScroller(this);this._x=this.element[0].scrollLeft;this.model.change&&this._trigger("change",n)},_keyPress:function(n){if(this._maskLength==0)return!0;var i=n.keyCode?n.keyCode:n.charCode,r=String.fromCharCode(i);if((i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122)&&(currentPos=this._seekNext(),this._validateChars(i,currentPos)&&this._writeBuffer(r,currentPos)),!this._keypressFlag&&i!=9)return this._keypressFlag=0,n.preventDefault(),!1;this._keypressFlag=0;this._updateHiddenField();t._setScroller(this);this._x=this.element[0].scrollLeft},_keyDown:function(n){if(this._maskLength==0)return!0;var i=n.keyCode?n.keyCode:n.charCode,r=String.fromCharCode(i);if(i>=35&&i<=41)(t.browserInfo().name=="mozilla"||t.browserInfo().name=="opera")&&(this._keypressFlag=1);else if(i==8||i==46)return this._keydownFlag=i==8?1:2,currentPos=this._keydownFlag==1?this._seekBefore():this._seekNext(),this._selectedTextKeyDown||(currentPos>=0&&currentPos<this._maskLength&&this._writeBuffer("_",currentPos),i==8?this._setCaretPosition(currentPos):{}),this._keydownFlag=0,this._selectedTextKeyDown=0,n.preventDefault(),!1;this._updateHiddenField()},_cancelEvent:function(n){return n.cancelBubble=!0,n.returnValue=!1,n.stopPropagation(),n.preventDefault(),!1},_showBorder:function(n){n?(this.element.removeClass("e-m-noborder"),this.element.parent().find(".e-m-noborder").addClass("e-m-textspan").removeClass("e-m-noborder")):(this.element.addClass("e-m-noborder"),this.element.parent().find(".e-m-textspan").addClass("e-m-noborder").removeClass("e-m-textspan"))},_clearText:function(n){this.element.val("");this._clearBtn.css("display","none");this._clearClicked=!0;n.preventDefault()},_showClear:function(){this.element.attr("value")!=""?this._clearBtn.css("display","inline-block"):this._clearBtn.css("display","none")},_resize:function(){this.element.css("height","auto");this.element[0].scrollHeight>=this.defaultHeight?this.element.css("height",this.element[0].scrollHeight+"px"):this.element.css("height",this.defaultHeight)},_delayedResize:function(){window.setTimeout(this.resize,0)},_setRenderMode:function(n){this.model.renderMode=n;this.element.parent().removeClass("e-m-ios7 e-m-android e-m-windows e-m-flat").addClass("e-m-"+n)},_setTheme:function(n){this.model.theme=n;this.element.parent().removeClass("e-m-dark e-m-light").addClass("e-m-"+n)},_setValue:function(n){this.value(n);this.element.val(n)},_setWatermarkText:function(n){this.model.watermarkText=n;this._setWaterMark()},_setMask:function(n){this._maskModel=n.replace(/[9a*]/g,"_");this.element.val(this._maskModel);this._validatedValue=this._maskModel;this._validateValue()},_setReadOnly:function(n){n?this.element.attr("readonly",!0):this.element.removeAttr("readonly")},_setModel:function(n){for(var t in n)switch(t){case"renderMode":this._setRenderMode(n.renderMode);break;case"showBorder":this._showBorder(n.showBorder);break;case"theme":this._setTheme(n.theme);break;case"value":this._setValue(n.value);break;case"watermarkText":this._setWatermarkText(n.watermarkText);break;case"mask":this._setMask(n.mask);break;case"enabled":n.enabled?(this.enable(),this._wireEvents(!1)):(this.disable(),this._wireEvents(!0));break;case"readOnly":this._setReadOnly(n.readOnly)}},_clearElement:function(){this._wireEvents(!0);this.element.parent().removeAttr("class")},_destroy:function(){this._cloneElement.insertBefore(this.element);this.element.remove()},enable:function(){this.model.enabled=!0;this.element.removeClass("e-m-state-disabled");this._wireEvents(!1)},disable:function(){this.model.enabled=!1;this.element.addClass("e-m-state-disabled");this._wireEvents(!0)},getStrippedValue:function(){var n=this.element.val(),t="";return n!=i&&(t=n.replace(/[^a-zA-Z0-9]/g,"")),t},getUnstrippedValue:function(){var n=this.element.val(),t="";return n!=i&&(t=n.replace(/[_]/g," ")),t},getWatermarkText:function(){return this.model.watermarkText},getValue:function(){return this.value()},refresh:function(){this._clearElement();this._renderControl();this._wireEvents(!1)}})})(jQuery,Syncfusion)})