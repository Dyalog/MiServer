/*!
*  filename: ej.mobile.autocomplete.min.js
*  version : 13.2.0.39
*  Copyright Syncfusion Inc. 2001 - 2015. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./ej.mobile.core.min","./ej.mobile.application.min","./../common/ej.unobtrusive.min","./../common/ej.touch.min","./ej.mobile.listview.min","./ej.mobile.menu.min","./ej.mobile.scrollpanel.min"],n):n()})(function(){(function($,ej){ej.widget("ejmAutocomplete","ej.mobile.Autocomplete",{_setFirst:!0,_rootCSS:"e-m-acc-wrapper",defaults:{allowScrolling:!0,cssClass:"",windows:{renderDefault:!1},filterType:"contains",caseSensitiveSearch:!1,enableAutoFill:!1,delimiterChar:",",enableMultiSelect:!1,enableCheckbox:!0,dataSource:null,renderMode:"auto",itemsCount:5,fields:{text:"text",key:"key"},selectedKeys:null,imageField:null,theme:"auto",mapper:null,watermarkText:"Search",imageClass:null,allowSorting:!0,sortOrder:"ascending",value:"",emptyResultText:"No suggestions",showEmptyResultText:!0,minCharacter:1,enableDistinct:!1,enablePersistence:!1,enabled:!0,mode:"default",templateId:null,touchEnd:null,keyPress:null,select:null,change:null,focusIn:null,focusOut:null},dataTypes:{filterType:"enum",renderMode:"enum",caseSensitiveSearch:"boolean",theme:"enum",enableAutoFill:"boolean",enableMultiSelect:"boolean",enableCheckbox:"boolean",dataSource:"data",allowSorting:"boolean",sortOrder:"enum",emptyResultText:"string",delimiterChar:"string",showEmptyResultText:"boolean",minCharacter:"number",enableDistinct:"boolean",enablePersistence:"boolean",enable:"boolean",mode:"enum",templateId:"string"},_init:function(){App.activePage||App.createAppView();this._cloneElement=this.element.clone();this._initialize();this._renderControl();ej._setScroller(this);this._wireEvents()},_initialize:function(){this._queryString="";this._filterMode="server";typeof this.model.mapper!="string"&&(this._filterMode="client");this._accFields={text:this.model.fields.text,imageClass:this.model.imageClass,imageUrl:this.model.imageField};this._noresult={text:"emptyResultText"};this._noSuggSource=[{}];this._selectedItemData=[];this._noSuggSource[0][this.model.fields.text]=this.model.emptyResultText;this.model.delimiterChar=this.model.delimiterChar+" "},_renderControl:function(){ej.setRenderMode(this);ej.setTheme(this);this._width=0;this.model.dataSource=eval(this.model.dataSource);this.model.renderMode=="windows"&&this.model.windows.renderDefault&&ej.isMobile()&&(this.model.theme="default");this._id=this.element[0].id;this.element.addClass("e-m-acc-input").attr("name",this._id).attr("placeholder",this.model.watermarkText).addClass("e-m-acc-"+this.model.mode+" "+this.model.cssClass);this._accwrapper=ej.buildTag("div#"+this._id+"_wrapper.e-m-acc-wrapper").addClass("e-m-"+this.model.renderMode+" e-m-"+this.model.theme).addClass("e-m-acc-"+this.model.mode);this._accwrapper=this.element.wrap(this._accwrapper).parent();this._search=ej.buildTag("div.e-m-acc-searchicon").addClass("e-m-fontimage").appendTo(this._accwrapper);this._custAnd=ej.buildTag("div.e-m-acc-custand").appendTo(this._accwrapper);this._clrElement=ej.buildTag("div.e-m-acc-clear").addClass("e-m-fontimage").appendTo(this._accwrapper);this._list=ej.buildTag("div#"+this._id+"list.e-m-acc-list");this.model.renderMode!="ios7"||ej.isLowerResolution()?this._accList=this._list.appendTo(this._accwrapper):(this._accMenu=ej.buildTag("div#"+this._id+"menu.e-m-acc-menu"),this._accMenu.ejmMenu({renderTemplate:!0,renderMode:this.model.renderMode,theme:this.model.theme,allowScrolling:!1,showOn:"",target:this.element,templateId:""+this._id+"list",onShow:$.proxy(this._onMenuShow,this),ios7:{title:"Results",type:"normal"},windows:{renderDefault:this.model.windows.renderDefault}}),$("#"+this._id+"menu_overlay").css("pointer-events","none"),this._accList=this._list.appendTo(this._accMenu.find(".e-m-menu-hdr")));modelObject={adjustFixedPosition:!1,renderMode:this.model.renderMode,theme:this.model.theme,showHeader:!1,allowScrolling:this.model.allowScrolling,fieldSettings:this._accFields,touchEnd:$.proxy(this._touchEnd,this),enableCheckMark:this.model.enableCheckbox&&this.model.enableMultiSelect?!0:!1,windows:{renderDefault:this.model.windows.renderDefault}};this.model.templateId&&(modelObject=$.extend({},modelObject,{templateId:this.model.templateId,renderTemplate:!0}));this._accList.ejmListView(modelObject);this._accList.hide();this.model.value&&this.element.val(this.model.value);this._clear();this.model.enabled||this._setEnabled(!1);this.model.selectedKeys&&this._setKey(this.model.selectedKeys)},_touchStart:function(n){ej._inputTouchStart(n,this);ej.listenEvents([window,window,window],[ej.moveEvent(),ej.cancelEvent(),ej.endEvent()],[this._touchMoveProxy,this._touchEndProxy,this._touchEndProxy],!1)},_searchTouchStart:function(){this.model.renderMode!="windows"||ej.isMobile()||this.model.mode!="search"||this._search.addClass("e-m-active")},_searchTouchEnd:function(){this.model.renderMode!="windows"||ej.isMobile()||this.model.mode!="search"||this._search.removeClass("e-m-active")},_touchMove:function(n){ej._inputTouchMove(n,this)},_touchInputEnd:function(n){ej._inputTouchEnd(n,this);ej.listenEvents([window,window,window],[ej.moveEvent(),ej.cancelEvent(),ej.endEvent()],[this._touchMoveProxy,this._touchEndProxy,this._touchEndProxy],!0)},_createDelegates:function(){this._onFocusDelegate=$.proxy(this._onFocusHandler,this);this._onBlurDelegate=$.proxy(this._onBlurHandler,this);this._onDocClickDelegate=$.proxy(this._docClick,this);this._onKeypressDelegate=$.proxy(this._onKeypressHandler,this);this._onClearClickDelegate=$.proxy(this._onClearClickHandler,this);this._touchStartProxy=$.proxy(this._touchStart,this);this._touchMoveProxy=$.proxy(this._touchMove,this);this._touchEndProxy=$.proxy(this._touchInputEnd,this);this._resizeDelegate=$.proxy(this._resize,this);this._searchTouchStartProxy=$.proxy(this._searchTouchStart,this);this._searchTouchEndProxy=$.proxy(this._searchTouchEnd,this)},_resize:function(){this.model.renderMode=="ios7"&&(this._isMenu=App.activePage.find("#"+this.element.attr("id")+"menu").length,(ej.isLowerResolution()&&this._isMenu>0||!ej.isLowerResolution()&&this._isMenu<=0)&&this._refresh(),ej.isLowerResolution()||this._setListHeight(this._resultData))},_wireEvents:function(n){var t=n?"unbind":"bind";this._createDelegates();ej.listenEvents([this.element,this.element,this.element],["focus","blur","keyup"],[this._onFocusDelegate,this._onBlurDelegate,this._onKeypressDelegate],n);ej.isDevice()&&ej.listenTouchEvent(this.element,ej.startEvent(),this._touchStartProxy,n);ej.listenEvents([App.document,this._accwrapper.find(".e-m-acc-clear")],[ej.tapEvent(),ej.endEvent()],[this._onDocClickDelegate,this._onClearClickDelegate],n);ej.listenEvents([this._search,this._search],[ej.startEvent(),ej.endEvent()],[this._searchTouchStartProxy,this._searchTouchEndProxy],n);this.model.renderMode!="ios7"||ej.isTouchDevice()||$(window)[t]("resize",this._resizeDelegate)},_onFocusHandler:function(){var n=this,r=this.element.val().substring(this.element.val().length-2,this.element.val().length),t,i;r==this.model.delimiterChar&&this.element.val(this.element.val().replace(this.element.val().lastIndexOf(this.model.delimiterChar),""));this._temptext=this.element.val();this._tempobj=this.element;!this.model.enableMultiSelect||this._accList.is(":visible")||this.element.val()==""||this._focus||this.element.val()[this.element.val().length-1]==this.model.delimiterChar.trim()||(this.element.val(this.element.val()+this.model.delimiterChar),this._focus=!0);this.model.renderMode=="android"?this._custAnd.addClass("e-m-acc-focus"):this.element.addClass("e-m-acc-focus");t=this.element.val();this.element.val(t);this.element[0].scrollLeft=ej.browserInfo().name==="msie"?this._width:this.element[0].scrollWidth;window.setTimeout(function(){ej.setCaretToPos(n.element[0],n.element.val().length,n.element.val().length)});i={value:this.element.val()!=""?this.element.val().substring(0,this.element.val().length-2):this.element.val()};this.model.focusIn&&this._trigger("focusIn",i)},_onBlurHandler:function(){var n=this.element.val().split(this.model.delimiterChar),t,r,u;for(this._selectedItems=n.filter(Boolean),t=ej.Predicate(this.model.fields.text,"equal",n[0]),i=1;i<n.length;i++)t=t.or(this.model.fields.text,"equal",n[i]);r=ej.Query().where(t);this._selectedItemData=ej.DataManager(this._selectedItemData).executeLocal(r);this.model.renderMode=="android"?this._custAnd.removeClass("e-m-acc-focus"):this.element.removeClass("e-m-acc-focus");this.element[0].scrollLeft=ej.browserInfo().name==="msie"?this._width:0;u={value:this.element.val()!=""?this.element.val().substring(0,this.element.val().length-2):this.element.val()};this.model.value=this.element.val();this.model.focusOut&&this._trigger("focusOut",u)},_onClearClickHandler:function(){this.element.val("");this.element.attr("placeholder",this.model.watermarkText);this.model.renderMode=="ios7"&&(this._clrElement.css("display","none"),this._accList&&this._accList.css("display","none"))},_touchEnd:function(n){var i,t;this._checkflag=n.isChecked;this._selectedVal=n.text;this._checkeditems=n.checkedItemsText?n.checkedItemsText.toString():"";n.item&&(this._width=this._width+n.item.find(".e-m-list-text.e-m-text").width());this._selectedVal!=this.model.emptyResultText&&(this.model.enableMultiSelect?(this._tempword=this._selectedVal,this._setMultiValueText(this._selectedVal)):(this.element.val(this._selectedVal),this._hideSuggestions()));i=this;this._checkflag?this._selectedItemData.push(n.model.dataSource[n.index]):(t=ej.DataManager(this._selectedItemData),t.remove(this.model.fields.text,this._selectedVal,this.model.dataSource));n.value=this.element.val()!=""?this.element.val().substring(0,this.element.val().length-2):this.element.val();this.model.value=this.element.val();this._selectedItems=this.element.val().split(this.model.delimiterChar).filter(Boolean);this._selectedVal!=this.model.emptyResultText&&(dataQuery=ej.Query().where(this.model.fields.text,"equal",n.text),n.data=ej.DataManager(this.model.dataSource).executeLocal(dataQuery),this.model.touchEnd&&this._trigger("touchEnd",n),this.model.select&&this._trigger("select",n),this.model.change&&this._trigger("change",n))},_setMultiValueText:function(n){var t=this,e=this._getDelimiterIndex()==-1?this._getDelimiterIndex()+1:this._getDelimiterIndex()+2,f=this.element.val(),r=this.element.val().indexOf(n)>-1,u,o,i;if(this.model.enableMultiSelect)for(r=!1,u=f.split(this.model.delimiterChar),o=this._checkeditems.split(this.model.delimiterChar),i=0;i<u.length;i++)u[i]==this._tempword&&(r=!0);r?this._checkflag||(this.element.val(this.element.val().replace(this._tempword+this.model.delimiterChar,"")),this.element.val(this.element.val().replace(this._tempword,""))):this._checkflag&&this.element.val(f.substring(0,e)+n+this.model.delimiterChar);window.setTimeout(function(){ej.browserInfo().name=="msie"?(t.element[0].scrollLeft=t._width,t.element[0].selectionStart=t.element[0].selectionEnd=t.element[0].value.length):t.element[0].scrollLeft=t.element[0].scrollWidth})},_getDelimiterIndex:function(){return this.element.val().lastIndexOf(this.model.delimiterChar)},_clear:function(){this.model.renderMode=="ios7"&&(this.element.val()==""?this._clrElement.css("display","none"):this._clrElement.css("display","inline"))},_showSuggestions:function(n){var t=this;t._accList.show();t.model.renderMode=="ios7"&&!ej.isLowerResolution()&&this.element.val().length&&($("#"+t._id+"menu").ejmMenu("show",n),$("#"+t._id+"menu").css("opacity",1));this._hideNoResults()},_hideSuggestions:function(){var n=this;n.model.renderMode!="ios7"||ej.isLowerResolution()||$("#"+n._id+"menu").ejmMenu("hide");n._accList.hide()},_onKeypressHandler:function(n){var t,i,r;if((n.keycode==8||n.keycode==46)&&(this._focus=!0),this._keycode=n.keyCode,t=this,this._clear(),i={value:this.element.val()},this.model.keyPress&&this._trigger("keyPress",i),this._textValue=n.target.value,n.keyCode==13)n.preventDefault();else{if(this.model.value=this.element.val(),this._textValue==""){this._hideSuggestions();return}this.model.enableMultiSelect?(r=this._getDelimiterIndex()==-1?this._getDelimiterIndex()+1:this._getDelimiterIndex()+2,this._queryString=this._textValue.substring(r)):this._queryString=this._textValue;this._queryString.length>=this.model.minCharacter?this._filterMode=="client"?(this._resultData=this._filterResult(),this._renderSuggestionList(this._resultData),this.model.enableAutoFill&&n.keyCode!=8&&this.model.filterType=="startswith"&&(this._resultData.length==0?(t._accList.ejmListView({dataSource:this._noSuggSource}),t._accList.find(".e-m-lv-checkdiv").remove()):this._setInputText(this._resultData[0])),this._showSuggestions(n),ej.getCurrentPage().find("#"+this._id+"list_scroll").ejmScrollPanel("refresh"),this._setListHeight(this._resultData),this._checkSelectedItems()):this._sendAjaxRequest(n):this._hideSuggestions()}this._accList.text()==this.model.emptyResultText&&this._accList.ejmListView("removeCheckMark");ej._setScroller(this);this._x=this.element[0].scrollLeft},_setListHeight:function(n){var t,r,i;n.length>this.model.itemsCount?this._accList.ejmListView({height:this._accList.find("li.e-m-list").outerHeight()*this.model.itemsCount+(this.model.renderMode=="windows"?10:0)}):(t=this._accList.text(),this.model.templateId&&(t=t.trim()),t==this.model.emptyResultText?this._accList.ejmListView({height:this._accList.find("li.e-m-list").outerHeight()+(this.model.renderMode=="windows"?10:0)}):this._accList.ejmListView({height:this._accList.find("li.e-m-list").outerHeight()*n.length+(this.model.renderMode=="windows"?10:0)}));this.model.renderMode!="ios7"||ej.isLowerResolution()?this.model.renderMode=="ios7"&&ej.isLowerResolution()&&window.innerHeight<this._accList.height()+this.element.innerHeight()+this.element.offset().top&&(r=this.element.offset().top-(this._accList.height()+this.element.innerHeight())-10,$(this._accList).css("top",r)):(this._accMenu.height(this._accList.find(".e-m-list-container").outerHeight()+49),this._accMenu.find(".e-m-menu-container").height(this._accList.find(".e-m-list-container").outerHeight()),this._accMenu.find(".e-m-menu-container .e-m-lv").height(this._accList.find(".e-m-list-container").outerHeight()));i=this.element.closest(".e-m-dialog,.e-m-nb");i.length&&(this._accMenu?this._accMenu:this._accList).css({"z-index":i.css("z-index")+1})},_sendAjaxRequest:function(n){var i={};$.extend(!0,i,n);var r=ej.DataManager({url:this.model.mapper,crossDomain:!0}),t=this,u=ej.Query().where(this.model.fields.text,this.model.filterType,this._queryString,!this.model.caseSensitiveSearch);r.executeQuery(u).done(function(n){t._renderSuggestionList(n.result);t.model.dataSource=n.result;t._resultData=n.result;t.model.enableAutoFill&&t._keycode!=8&&t.model.filterType=="startswith"&&t._setInputText(t._resultData[0]);t._showSuggestions(i);t._setListHeight(n.result);t._checkSelectedItems();t.element.val()==""&&t._hideSuggestions()})},_checkSelectedItems:function(){var n=this;n.model.enableMultiSelect&&n.model.enableCheckbox&&n._accList.find(".e-m-list ").each(function(t,i){var r=$(i).text();n._tempobj.val().indexOf(r)>-1&&n._accList.ejmListView("checkItem",$(i).index())})},_renderSuggestionList:function(n){if(n.value=this.element.val()!=""?this.element.val().substring(0,this.element.val().length-2):this.element.val(),this.element.val()!=this._temptext&&this.model.change&&this._trigger("change",n),this.model.enableDistinct){var t=this.model.fields.text,i={_name:null};i._name=t&&t.name?t.name:"name";this._resultData=ej.dataUtil.distinct(n,i._name,!0)}else this._resultData=n;this._resultData.length==0&&this._accList.ejmListView("getItemText",0)!=this.model.emptyResultText?(this._accList.ejmListView({dataSource:this._noSuggSource}),this._accList.find(".e-m-lv-checkdiv").remove()):this._resultData.length&&this._accList.ejmListView({dataSource:this._resultData});ej.listenEvents([this._accList,this._accList],[ej.startEvent(),ej.endEvent()],[this._onTouchStartDelegate,this._onTouchEndDelegate],!1)},_addSortingQuery:function(n,t){if(this.model.allowSorting){var i=this.model.sortOrder=="descending"?!0:!1;n.sortBy(t,i)}},_setInputText:function(n){var i=this._getDelimiterIndex()+1,r=this.element.val(),u=this.element[0].selectionStart,f=this.element.val().indexOf(n.name)>-1,t;f||this.element.val(r.substring(0,i)+n[this.model.fields.text]);this.element[0].selectionStart=u;t=this.element[0].selectionEnd;this.element[0].selectionEnd=t},_filterResult:function(){var i=ej.DataManager(this.model.dataSource),n=this._isJson(this.model.dataSource)?this.model.fields.text:"",t=ej.Query().where(n,this.model.filterType,this._queryString,!this.model.caseSensitiveSearch);return this._addSortingQuery(t,n),i.executeLocal(t)},_isJson:function(n){return typeof n[0]=="object"},_docClick:function(n){this.model.enableMultiSelect&&($(n.target).closest(".e-m-list").length==!0||$(n.target).hasClass("e-m-acc-input")||(this.element.val().substring(this.element.val().length-2,this.element.val().length)==this.model.delimiterChar&&this.element.val(this.element.val().substring(0,this.element.val().length-2)),this._focus=!1));$(n.target).closest(".e-m-list").length!=!0&&n.target.id!=this._id&&this._hideSuggestions();this.model.renderMode=="ios7"&&(ej.isLowerResolution()||$(n.target).closest(".e-m-menu").length==!0||$(n.target).hasClass("e-m-acc-input")||this._hideSuggestions());$(n.target).hasClass("e-m-acc-input")||this.element.blur()},_setModel:function(n){if(!this.model.enabled&&ej.isNullOrUndefined(n.enabled))return!1;for(var t in n)switch(t){case"theme":this._setTheme(n.theme);break;case"renderMode":this._setRenderMode(n.renderMode);break;case"showEmptyResultText":this._setShowEmptyResultText(n.showEmptyResultText);break;case"value":this._setValue(n.value);break;case"fields":this._setFields(n.fields);break;case"watermarkText":this.model.watermarkText=n.watermarkText;this._setWatermarkText(n.watermarkText);break;case"enabled":this._setEnabled(n.enabled);break;case"mode":this._setMode(n.mode);break;case"selectedKeys":this._setSelectedKeys(n.selectedKeys)}},_setRenderMode:function(n){this.model.renderMode=n;n=="auto"&&ej.setRenderMode(this);var t=this.model.renderMode;this._accwrapper.removeClass("e-m-android e-m-ios7 e-m-windows e-m-flat").addClass("e-m-"+this.model.renderMode)},_setTheme:function(n){this.model.theme=n;this.model.theme=="auto"&&ej.setTheme(this);this._accwrapper.removeClass("e-m-light e-m-dark").addClass("e-m-"+this.model.theme);this.model.renderMode=="ios7"&&this._accMenu.removeClass("e-m-light e-m-dark").addClass("e-m-"+this.model.theme);this._accList.removeClass("e-m-light e-m-dark").addClass("e-m-"+this.model.theme);this._accList.children().removeClass("e-m-light e-m-dark").addClass("e-m-"+this.model.theme);ej.getCurrentPage().find("#"+this._id+"list_scroll").ejmScrollPanel({theme:this.model.theme})},_setShowEmptyResultText:function(n){this.model.showEmptyResultText=n;this._hideNoResults()},_hideNoResults:function(){this.model.showEmptyResultText||(!this._resultData||this._resultData.length!=0)&&this._resultData||this._accList.ejmListView("getItemText",0)!=this.model.emptyResultText||this._hideSuggestions()},_setValue:function(n){(typeof n=="object"||typeof n=="number"&&isNaN(n))&&(n="");this.model.value=n=$.trim(n);this.element.val("");n&&this.element.val(n)},_setFields:function(n){this._accList.ejmListView({fieldSettings:{text:n.text}});this._setKey(n.text)},_setSelectedKeys:function(n){this._setKey(n)},_setKey:function(n){var t=typeof n=="string"?JSON.parse(n):n;for(i=0;i<t.length;i++)this._setOperation(t[i],this.model.fields.key)},_setOperation:function(n,t){dataQuery=ej.Query().where(t,"equal",n);promise=ej.DataManager(this.model.dataSource).executeLocal(dataQuery);this.model.enableMultiSelect&&this._value&&promise.length>0?this._value.split(this.model.delimiterChar).indexOf(promise[0][this.model.fields.text])==-1&&(this._value=this._value.concat(this.model.delimiterChar,promise[0][this.model.fields.text].split(this.model.delimiterChar)),this._setValue(this._value)):(promise.length>0&&(this._value=promise[0][this.model.fields.text]),this._setValue(this._value));promise.length>0&&this._selectedItemData.push(promise[0])},_setWatermarkText:function(n){this.model.watermarkText?this.element.attr("placeholder",n):this.element.val()==""&&this.element.val(n)},_setMode:function(n){n&&(this.model.mode=n,this._accwrapper.removeClass("e-m-acc-default e-m-acc-search").addClass("e-m-acc-"+this.model.mode),this.element.removeClass("e-m-acc-default e-m-acc-search").addClass("e-m-acc-"+this.model.mode))},_refresh:function(){this._destroy();this._renderControl();this._wireEvents()},_destroy:function(){var n,t;this._wireEvents(!0);this._accList&&(this._accList.hasClass("e-m-acc-list")&&(n=this._accList.ejmListView("instance"),n._destroy()),this._accList.remove());this._accMenu&&(this._accMenu.hasClass("e-m-acc-menu")&&(t=this._accMenu.ejmMenu("instance"),t._destroy()),this._accMenu.remove());this.element.removeAttr("class").removeAttr("style");this.element.insertAfter(this._accwrapper);this._accwrapper.remove();this.element.html(this._cloneElement.html())},_setEnabled:function(n){n?(this.model.enabled=!0,this.enable()):(this.model.enabled=!1,this.disable())},enable:function(){this.element.removeClass("e-m-state-disabled")},disable:function(){this._accList.hide();this.element.addClass("e-m-state-disabled")},getValue:function(){return this.element.val()},getSelectedItems:function(){return this._selectedItemData},clearText:function(){this.model.enabled&&(this.element.val(""),this._isFocused?this.element.blur():this._onBlurHandler())}});ej.mobile.Autocomplete.FilterType={StartsWith:"startswith",Contains:"contains"};ej.mobile.Autocomplete.Mode={Search:"search",Default:"default"};ej.mobile.Autocomplete.SortOrder={Ascending:"ascending",Descending:"descending"}})(jQuery,Syncfusion)});