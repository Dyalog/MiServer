/*!
*  filename: ej.diagram.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scrollbar.min","./../common/ej.scroller.min","./../common/ej.unobtrusive.min","./../web/ej.menu.min"],n):n()})(function(){(function($,ej,undefined){"use strict";ej.widget("ejDiagram","ej.datavisualization.Diagram",{element:null,model:null,validTags:["div"],defaults:{width:null,height:null,deleteDependent:!0,adjustDependent:!0,nodes:[],connectors:[],defaultSettings:{connector:null,node:null},nodeTemplate:null,connectorTemplate:null,dataSourceSettings:{dataSource:null,query:null,tableName:null,id:"",parent:"",nodes:null,connectors:null},snapSettings:{horizontalGridLines:{linesInterval:[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],snapInterval:[20],lineDashArray:"0",lineColor:"lightgray"},verticalGridLines:{linesInterval:[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],snapInterval:[20],lineDashArray:"0",lineColor:"lightgray"},snapConstraints:15,enableSnapToObject:!0,snapAngle:5,snapObjectDistance:5},pageSettings:{pageWidth:null,pageHeight:null,multiplePage:!1,pageBorderWidth:0,pageBackgroundColor:"#ffffff",pageBorderColor:"#565656",pageMargin:24,showPageBreak:!1,pageOrientation:"portrait",scrollLimit:"infinity",scrollableArea:{x:Infinity,y:Infinity,width:Infinity,height:Infinity},autoScrollBorder:{left:15,top:15,right:15,bottom:15}},locale:"en-US",contextMenu:{items:[],click:null,beforeOpen:null,showCustomMenuItemsOnly:!1},enableContextMenu:!0,enableAutoScroll:!0,showTooltip:!0,tooltipTemplateId:"",autoScrollMargin:20,layout:{type:"none",orientation:"toptobottom",horizontalSpacing:30,verticalSpacing:30,marginX:0,marginY:0,fixedNode:""},userHandles:[],drawingTools:{},backgroundImage:null,backgroundColor:"transparent",selectorConstraints:14,constraints:122,tool:6,connectorType:"orthogonalLine",zoomFactor:.2,nodeCollectionChange:null,autoScrollChange:null,itemClick:null,connectorCollectionChange:null,selectionChange:null,mouseLeave:null,mouseEnter:null,mouseOver:null,click:null,doubleClick:null,drop:null,drag:null,textChange:null,sizeChange:null,connectionChange:null,rotationChange:null},observables:["enableContextMenu","enableAutoScroll","showTooltip","zoomFactor","pageSettings.pageHeight","pageSettings.pageWidth","pageSettings.multiplePage","pageSettings.pageBorderWidth","pageSettings.pageBackgroundColor","pageSettings.pageBorderColor","pageSettings.pageMargin","pageSettings.showPageBreak","pageSettings.pageOrientation","pageSettings.scrollLimit","snapSettings.enableSnapToObject","snapSettings.snapAngle","snapSettings.snapObjectDistance",],enableContextMenu:ej.util.valueFunction("enableContextMenu"),enableAutoScroll:ej.util.valueFunction("enableAutoScroll"),showTooltip:ej.util.valueFunction("showTooltip"),zoomFactor:ej.util.valueFunction("zoomFactor"),_pageHeight:ej.util.valueFunction("pageSettings.pageHeight"),_pageWidth:ej.util.valueFunction("pageSettings.pageWidth"),_multiplePage:ej.util.valueFunction("pageSettings.multiplePage"),_pageBorderWidth:ej.util.valueFunction("pageSettings.pageBorderWidth"),_pageBackgroundColor:ej.util.valueFunction("pageSettings.pageBackgroundColor"),_pageBorderColor:ej.util.valueFunction("pageSettings.pageBorderColor"),_pageMargin:ej.util.valueFunction("pageSettings.pageMargin"),_showPageBreak:ej.util.valueFunction("pageSettings.showPageBreak"),_pageOrientation:ej.util.valueFunction("pageSettings.pageOrientation"),_scrollLimit:ej.util.valueFunction("pageSettings.scrollLimit"),_enableSnapToObject:ej.util.valueFunction("snapSettings.enableSnapToObject"),_snapAngle:ej.util.valueFunction("snapSettings.snapAngle"),_snapObjectDistance:ej.util.valueFunction("snapSettings.snapObjectDistance"),dataTypes:{nodes:"array",connectors:"array",enableAutoScroll:"boolean",autoScrollMargin:"number",userHandles:"array",contextMenu:{items:"array",showCustomMenuItemsOnly:"boolean"},layout:{type:"enum",orientation:"enum",horizontalSpacing:"number",verticalSpacing:"number",marginX:"number",marginY:"number"}},_canvas:null,_svg:null,_toolToActivate:null,_inAction:!1,_isPinching:!1,_isEditing:!1,_nodeToHit:null,_currentCursor:null,_pasteIndex:null,_page:null,_view:null,_currentLabel:null,_zOrder:0,_clipboardData:null,_currZoom:1,_historyList:{currentEntry:{next:null,previous:null},canUndo:!1,canRedo:!1},_defaultContextMenuItems:[{name:"cut",text:"Cut"},{name:"copy",text:"Copy"},{name:"paste",text:"Paste"},{name:"undo",text:"Undo"},{name:"redo",text:"Redo"},{name:"selectAll",text:"Select All"},{name:"grouping",text:"Grouping",subItems:[{name:"group",text:"Group"},{name:"ungroup",text:"Ungroup"}]},{name:"order",text:"Order",subItems:[{name:"bringToFront",text:"Bring To Front"},{name:"moveForward",text:"Move Forward"},{name:"sendToBack",text:"Send To Back"},{name:"sendBackward",text:"Send Backward"}]}],_hScrollOffset:0,_vScrollOffset:0,_hScrollbar:null,_vScrollbar:null,_scrollPixel:30,activeTool:null,selectionList:[],tools:null,nameTable:{},_updateScrollOffset:function(n,t,i){this._hScrollOffset=n;this._vScrollOffset=t;ej.datavisualization.Diagram.ScrollUtil._transform(this,n,t,i);var r=this;this._views.forEach(function(i){var f=r._views[i],u;f.type=="overview"&&(u=$("#"+i).ejOverview("instance"),u&&u._scrollOverviewRect(n,t,r._currZoom))})},_init:function(){this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch();this._initDefaults();this._initViews();this._initData();this._doLayout();this._initCanvas();this._initVisualGuide();this._wireEvents();this._initHandles();this._initContextMenu();this._drawingTool=!1;this._isDropped=!1},_setModel:function(n){var t,u,r,i;for(t in n)switch(t){case"nodes":this.model.nodes=n[t];this._initNodeCollection(!0);this.element.remove(".ej-d-node");this.element.remove(".ej-d-group");i=this;this._views.forEach(function(n){var t=i._views[n];i._renderNodes(t,!0)});break;case"connectors":this.model.connectors=n[t];this._initConnectorCollection();this.element.remove(".ej-d-connector");i=this;this._views.forEach(function(n){var t=i._views[n];i._renderConnectors(t)});break;case"enableContextMenu":case"contextMenu":this.model.contextMenu=n[t];this._initContextMenu();break;case"snapSettings":r=n[t];r&&Object.keys(r).length>0&&(this._updateSnapSettings(n[t]),ej.datavisualization.Diagram.SvgContext._renderGrid(this._canvas,this._svg,this._page,this));break;case"selectorConstraints":this._setSelectorConstraints(n[t]);break;case"constraints":this._hasSelection()&&this._clearSelection();break;case"userHandles":this.model.userHandles=n[t];this._initHandles();break;case"drawingTools":this.model.drawingTools=n[t];this._registerDrawingTools();break;case"backgroundImage":this.model.backgroundImage=n[t];ej.datavisualization.Diagram.SvgContext._renderBackground(this._canvas,this._svg,this._page,this.model);break;case"enableAutoScroll":this.enableAutoScroll(n[t]);break;case"autoScrollMargin":this.model.autoScrollMargin=n[t];break;case"layout":this.model.layout=$.extend(!0,{},this.model.layout,n[t]);this._setLayout(n[t]);break;case"pageSettings":this.updatePageSettings(n[t]);break;case"locale":this.model.locale=n[t];u=document.getElementById(this.element[0].id+"_contextMenu");u.parentNode.removeChild(u);this._renderContextMenu();break;case"nodeTemplate":this.clear();this._initData();i=this;this._views.forEach(function(n){var t=i._views[n];i._renderNodes(t);i._renderConnectors(t)});this.layout();break;case"connectorTemplate":this._updateConnectors();break;case"dataSourceSettings":r=n[t];r&&Object.keys(r).length>0&&(this.clear(),$.extend(!0,this.model.dataSourceSettings,{},n[t]),this._initData(),i=this,this._views.forEach(function(n){var t=i._views[n];i._renderNodes(t);i._renderConnectors(t)}),this.layout())}},_initData:function(){var dataSource,nodes,connectors,dataSourceApplied,collapsedNodes;if(this.model.dataSourceSettings&&(dataSource=this.model.dataSourceSettings.dataSource||this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors),dataSource){if(nodes=[],connectors=[],this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors){if(this.model.dataSourceSettings.nodes){if(dataSource=this.model.dataSourceSettings.nodes.dataSource||this.model.dataSourceSettings.dataSource,dataSource)if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(this.model.dataSourceSettings.nodes,this.model.dataSourceSettings.nodeBinding),queryPromise=dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,nodes,"nodes")})}else this._applyTemplate(this.model.dataSourceSettings,dataSource,nodes,"nodes");this.model.dataSourceSettings.connectors&&(dataSource=this.model.dataSourceSettings.connectors.dataSource||this.model.dataSourceSettings.dataSource,dataSource&&(dataSource instanceof ej.DataManager?($.ajaxSetup({async:!1}),query=this._findQuery(this.model.dataSourceSettings.connectors,this.model.dataSourceSettings.connectorBinding),queryPromise=dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,connectors,"connectors")})):this._applyTemplate(this.model.dataSourceSettings,dataSource,connectors,"connectors")))}}else dataSource instanceof ej.DataManager?this._initDataSource(dataSource,nodes,connectors):dataSource.length&&(this._applyDataSource(this.model.dataSourceSettings,dataSource,nodes,connectors),dataSourceApplied=!0);this.model.nodes=nodes;this.model.connectors=connectors}collapsedNodes=this._initNodeCollection(!1,dataSourceApplied);this._initConnectorCollection(dataSourceApplied);collapsedNodes.length>0&&this._collapseNodes(collapsedNodes)},_initDataSource:function(dataSource,nodes,connectors){var mapper=this.model.dataSourceSettings;if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(mapper,this.model.dataSourceSettings.nodeBinding),queryPromise=this.model.dataSourceSettings.dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyDataSource(diagram.model.dataSourceSettings,n.result,nodes,connectors)})}},_findQuery:function(n,t){var u=[],e=ej.Query(),h=n.query||this.model.dataSourceSettings.query,c,o,r,i,s,f;if(ej.isNullOrUndefined(h)){c=n.dataSource||this.model.dataSourceSettings.dataSource;o=n.tableName||this.model.dataSourceSettings.tableName;for(r in n)r==="tableName"||r==="dataSource"||r==="designTemplate"||r.match("Binding")||n[r]&&u.push(n[r]);for(i in t)if(i==="labels")for(s=t[i],f=0;f<s.length;f++)s[f].text&&u.push(s[f].text);else i=="shape"||i=="line"?t[i][type]&&r.push(t[i][type]):t[i]&&u.push(t[i]);u.length>0&&e.select(u);c.dataSource.url.match(o+"$")||ej.isNullOrUndefined(o)||e.from(o)}else e=h;return e},_applyDataSource:function(n,t,i,r){var f=ej.DataManager(t).executeLocal(ej.Query().group(n.parent)),e,u,o,h,c,s;if(n.parent)for(e=[],u=0;u<f.length;u++)(f[u].key==undefined||f[u].key=='""')&&e.push(f[u]);else e=f;var l=this.model.dataSourceSettings.nodeBinding||{},a=this.model.defaultSettings.node||{},v=this.model.defaultSettings.connector||{},y=this.model.dataSourceSettings.connectorBinding||{};for(u=0;u<e.length;u++)for(o=0;o<e[u].items.length;o++)h=e[u].items[o],c=this._applyNodeTemplate(n,h,l,a),i.push(c),s=ej.DataManager(f).executeLocal(ej.Query().where("key",ej.FilterOperators.equal,h[n.id])),s[0]&&s[0].items&&this._renderChildNodes(n,s[0],c.name,i,r,f)},_renderChildNodes:function(n,t,i,r,u,f){for(var h,e,o,c=this.model.dataSourceSettings.nodeBinding||{},l=this.model.defaultSettings.node||{},a=this.model.defaultSettings.connector||{},v=this.model.dataSourceSettings.connectorBinding||{},s=0;s<t.items.length;s++)h=t.items[s],e=this._applyNodeTemplate(n,h,c,l),r.push(e),u.push(this._applyConnectorTemplate(n,null,v,a,i,e.name)),o=ej.DataManager(f).executeLocal(ej.Query().where("key",ej.FilterOperators.equal,h[n.id])),o[0]&&o[0].items&&this._renderChildNodes(n,o[0],e.name,r,u,f)},_applyTemplate:function(n,t,i,r){var o,f,e,u,s;if(r=="nodes")for(f=this.model.dataSourceSettings.nodeBinding||{},e=this.model.defaultSettings.node||{},u=0;u<t.length;u++)o=this._applyNodeTemplate(n,t[u],f,e),i.push(o);if(r=="connectors")for(f=this.model.dataSourceSettings.connectorBinding||{},e=this.model.defaultSettings.connector||{},u=0;u<t.length;u++)s=this._applyConnectorTemplate(n,t[u],f,e),i.push(s)},_applyNodeTemplate:function(n,t,i,r){var u=jQuery.extend(!0,{},r),e,f,o,s;if(u.name=ej.datavisualization.Diagram.Util.randomId(),i){for(e in i)e!="labels"&&(u[e]=t[i[e]]);if(i.labels)for(u.labels||(u.labels=[]),f=0;f<i.labels.length;f++)o=r&&r.labels&&r.labels.length?r.labels[f%r.labels.length]:{},o.name=ej.datavisualization.Diagram.Util.randomId(),o.text=t[i.labels[f].text],u.labels[f]=o;i.shape&&(s=r&&r.shape?r.shape:{},s.type=t[i.shape.type],u.shape=s)}return u=ej.datavisualization.Diagram.Node(u),this.model.nodeTemplate&&this.model.nodeTemplate(this,u,t),u},_applyConnectorTemplate:function(n,t,i,r,u,f){var e=jQuery.extend(!0,{},r),s,o,h;if(e.name=ej.datavisualization.Diagram.Util.randomId(),e.sourceNode=u,e.targetNode=f,i){for(s in i)s!="labels"&&(e[s]=t[i[s]]);if(i.labels)for(e.labels||(e.labels=[]),o=0;o<i.labels.length;o++)h=r&&r.labels&&r.labels.length?r.labels[o%r.labels.length]:{},h.name=ej.datavisualization.Diagram.Util.randomId(),h.text=t[i.labels[o].text],e.labels[o]=h}return e=ej.datavisualization.Diagram.Connector(e),this.model.connectorTemplate&&this.model.connectorTemplate(this,e,t),e},_collapseNodes:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._collapseChildren(i)},_initViews:function(){this._views=[];this._views.push(this._id);this._views[this._id]={type:"mainview",context:ej.datavisualization.Diagram.SvgContext,style:"position:relative; height:"+this.model.height+"; width:"+this.model.width+";"}},_setOverview:function(n,t){var n,i;n?(this._overview=n,this._views[n._id]||(this._views.push(n._id),this._views[n._id]={context:ej.datavisualization.Diagram.SvgContext,type:"overview"},n._renderDocument(this._views[n._id]),this._renderNodes(this._views[n._id],null,!0),this._renderConnectors(this._views[n._id]),n._updateOverview(this._views[n._id]))):(n=$("#"+t).ejOverview("instance"),n._removeDocument(this._views[t]),this._views[t]=undefined,i=this._views.indexOf(t),this._views.splice(i,1))},_initNodeCollection:function(n,t){for(var u=[],r=this.model.nodes,i=0;i<r.length;i++)r[i].type=="swimlane"||r[i].isSwimlane?(r[i]=n?r[i]:ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(r[i],this),this.nameTable[r[i].name]=r[i]):r[i].isGroup?(r[i]=ej.datavisualization.Diagram.Group(r[i]),this.nameTable[r[i].name]=r[i]):(t||(r[i]=this._getNewNode(r[i])),this.nameTable[r[i].name]=r[i],ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,r[i])),this.nameTable[r[i].name]=r[i],r[i].isExpanded||u.push(r[i]);return u},_getNewNode:function(n){return ej.datavisualization.Diagram.Node($.extend(!0,{},this.model.defaultSettings.node,n))},_getNewConnector:function(n){var t=$.extend(!0,{},this.model.defaultSettings.connector,n);return this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(t.defaultType=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Connector(t)},_getTightChildrenBounds:function(n){for(var r,e=n.children,t,u=null,i,f=0,o=e.length;f<o;f++)i=this.nameTable[e[f]],i&&(r=ej.datavisualization.Diagram.Util.bounds(i),t=ej.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),i.verticalAlign=="stretch"?t.height=0:i.horizontalAlign=="stretch"&&(t.width=0)),u=u?this._union(t,u):t;return u},_getBoundsWithoutStretch:function(n,t,i){for(var s=n.children,f,e,u=null,r,o=0,h=s.length;o<h;o++)r=this.nameTable[s[o]],e=ej.datavisualization.Diagram.Util.bounds(r),f=ej.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]),t?r.verticalAlign!="stretch"||r.verticalAlign=="stretch"&&r.horizontalAlign=="stretch"||(f.height=0):i&&(r.horizontalAlign!="stretch"||r.verticalAlign=="stretch"&&r.horizontalAlign=="stretch"||(f.width=0)),u=u?this._union(f,u):f;return u.width+=n.paddingLeft+n.paddingRight,u.height+=n.paddingTop+n.paddingBottom,u},_getMinMaxSize:function(n,t,i,r){var o=null,s=null,u,f,h,c,e;return t>=n.minWidth&&t<=n.maxWidth?o=t:n.horizontalAlign=="stretch"&&n.parent&&!r?(u=this.nameTable[n.parent],u&&(f=ej.datavisualization.Diagram.Util.bounds(u),f.width==0&&f.height==0&&(f.width=t,f.height=i),e=this._getMinMaxSize(u,f.width,f.height),e.width-=u.paddingLeft+u.paddingRight+u.marginLeft+u.marginRight,e.height-=u.paddingTop+u.paddingBottom+u.marginTop+u.marginBottom,o=e.width?e.width:t)):o=t<n.minWidth&&n.minWidth!=0?n.minWidth:t>n.maxWidth&&n.maxWidth!=0?n.maxWidth:t,i>=n.minHeight&&i<=n.maxHeight?s=i:n.verticalAlign=="stretch"&&n.parent&&!r?(u=this.nameTable[n.parent],f=ej.datavisualization.Diagram.Util.bounds(u),f.width==0&&f.height==0&&(h=null,c=!1,f.width=n.minWidth,f.height=n.minHeight,n.minWidth==0&&n.minHeight==0&&(f.width=t,f.height=i,h=!1,c=!0),c||(h=!0)),e=this._getMinMaxSize(u,f.width,f.height),e.width-=u.paddingLeft+u.paddingRight+u.marginLeft+u.marginRight,e.height-=u.paddingTop+u.paddingBottom+u.marginTop+u.marginBottom,h&&(e.height-=n.marginTop),s=e.height?e.height:i):s=i<n.minHeight&&n.minHeight!=0?n.minHeight:i>n.maxHeight&&n.maxHeight!=0?n.maxHeight:i,{width:o,height:s}},_initConnectorCollection:function(n){for(var o,u,f,e,s,r=this.model.connectors,t,i=0,h=r.length;i<h;i++)t=n?r[i]:this._getNewConnector(r[i]),this.nameTable[t.name]=t,ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,t),o=r[i].segments||this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments,u=!1,t.sourceNode&&t.sourcePort&&(e=ej.datavisualization.Diagram.Util.bounds(this.nameTable[t.sourceNode],!0),f=ej.datavisualization.Diagram.Util.findPortByName(this.nameTable[t.sourceNode],t.sourcePort),t.sourcePoint=ej.datavisualization.Diagram.Util._getPortPosition(f,e),u=!0),t.targetNode&&t.targetPort&&(e=ej.datavisualization.Diagram.Util.bounds(this.nameTable[t.targetNode],!0),f=ej.datavisualization.Diagram.Util.findPortByName(this.nameTable[t.targetNode],t.targetPort),t.targetPoint=ej.datavisualization.Diagram.Util._getPortPosition(f,e),u=!0),u&&ej.datavisualization.Diagram.Util._updateConnectorSegments(t,null,null,this),this._dock(t,this.nameTable),o&&t.segments.length>1&&!t.sourcePort&&(this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(s=this.model.defaultSettings.connector.segments[0].type),t.segments=o,ej.datavisualization.Diagram.Util._initializeSegments(t,s),ej.datavisualization.Diagram.Util.updateBridging(t,this)),this._updateEdges(t),r[i]=t},_initDefaults:function(){this._initTools()},_initCanvas:function(){this._renderCanvas()},_updateConnectorBridging:function(n){for(var i,r,t,e=ej.datavisualization.Diagram.Util.bounds(n),f=ej.datavisualization.Diagram.SpatialUtil.findQuads(this._spatialSearch,e),u=0;u<f.length;u++)if(i=f[u],i.objects.length>0)for(r=0;r<i.objects.length;r++)t=i.objects[r],t.segments&&t!=n&&(ej.datavisualization.Diagram.Util.updateBridging(t,this),ej.datavisualization.Diagram.DiagramContext.update(t,this))},_initVisualGuide:function(){if(this.showTooltip()&&!this.model.tooltipTemplateId){var n=document.createElement("script"),t={id:this.element[0].id+"_defaultTooltip",type:"text/x-jsrender"};ej.datavisualization.Diagram.Util.attr(n,t);n.innerHTML='<span class="e-diagram-tooltipLabel-default"> {{:type}}{{:x}}{{:type1}}{{:y}}<\/span>';this._canvas.appendChild(n)}else this.element.remove("#"+this.element[0].id+"_defaultTooltip")},_initTools:function(){this.tools={select:new ej.datavisualization.Diagram.SelectTool(this),move:new ej.datavisualization.Diagram.MoveTool(this),resize:new ej.datavisualization.Diagram.ResizeTool(this),rotate:new ej.datavisualization.Diagram.RotateTool(this),endPoint:new ej.datavisualization.Diagram.ConnectionEditTool(this),panTool:new ej.datavisualization.Diagram.PanTool(this),straightLine:new ej.datavisualization.Diagram.StraightLineTool(this),orthogonalLine:new ej.datavisualization.Diagram.OrthogonalLineTool(this),phase:new ej.datavisualization.Diagram.PhaseTool(this)};this._toolToActivate="select";this.activeTool=this.tools[this._toolToActivate];this._registerDrawingTools()},_initHandles:function(){var t=this.model.userHandles,n;if(t)for(n=0;n<t.length;n++)t[n]=ej.datavisualization.Diagram.UserHandle(t[n]),t[n].tool&&(t[n].tool.diagram=this,this.tools[t[n].name]=t[n].tool)},_destroy:function(){this.element.empty().removeClass("e-datavisualization-diagram")},updatePageSettings:function(n){n&&(n.pageHeight&&this._pageHeight(Number(typeof n.pageHeight=="function"?n.pageHeight():n.pageHeight)),n.pageWidth&&this._pageWidth(Number(typeof n.pageWidth=="function"?n.pageWidth():n.pageWidth)),n.pageBorderWidth&&this._pageBorderWidth(Number(typeof n.pageBorderWidth=="function"?n.pageBorderWidth():n.pageBorderWidth)),n.pageMargin&&this._pageMargin(Number(typeof n.pageMargin=="function"?n.pageMargin():n.pageMargin)),n.pageBackgroundColor&&this._pageBackgroundColor(typeof n.pageBackgroundColor=="function"?n.pageBackgroundColor():n.pageBackgroundColor),n.scrollLimit&&this._scrollLimit(typeof n.scrollLimit=="function"?n.scrollLimit():n.scrollLimit),n.scrollableArea&&(this.model.pageSettings.scrollableArea=n.scrollableArea),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),ej.datavisualization.Diagram.SvgContext._updateBackground(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this))},_updateSnapSettings:function(n){n&&(n.snapAngle&&this._snapAngle(Number(typeof n.snapAngle=="function"?n.snapAngle():n.snapAngle)),n.snapObjectDistance&&this._snapObjectDistance(Number(typeof n.snapObjectDistance=="function"?n.snapObjectDistance():n.snapObjectDistance)))},updateNode:function(n,t){var i,r;n&&(i=this._findNode(n),i&&(t.offsetX&&this._translate(i,t.offsetX-i.offsetX,0,this.nameTable),t.offsetY&&this._translate(i,0,t.offsetY-i.offsetY,this.nameTable),t.rotateAngle&&this._rotate(i,t.rotateAngle-i.rotateAngle,this.nameTable),t.width&&(i.width=i.width?i.width:1,this.scale(i,t.width/i.width,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.height&&(i.height=i.height?i.height:1,this.scale(i,1,t.height/i.height,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.constraints&&(i.isGroup||(i.constraints&ej.datavisualization.Diagram.NodeConstraints.Shadow?(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.removeShadow(i,this)):(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.renderShadow(i,this))),i.constraints=t.constraints,this.selectionList[0]&&this.selectionList[0].name===i.name&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._svg,this._adornerLayer),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._svg,this._adornerLayer,this._currZoom,this.model.selectorConstraints),this.model.selectorConstraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.userHandles,this.selectionList[0],this._svg,this.selectionList[0].isPseudoGroup,this._currZoom,this._adornerLayer))),i.isGroup||(t.fillColor&&(i.fillColor=t.fillColor),t.opacity&&(i.opacity=t.opacity),t.borderColor&&(i.borderColor=t.borderColor),t.borderWidth&&(i.borderWidth=t.borderWidth),t.borderDashArray&&(i.borderDashArray=t.borderDashArray),t.gradient!==undefined&&(i.gradient=t.gradient)),t.shape&&(ej.browserInfo().name==="msie"&&i.shape&&i.shape.html&&(r=document.getElementById(i.name+"_parentdiv"),r.parentNode.removeChild(r)),i.shape=ej.datavisualization.Diagram.Shape(t.shape),ej.datavisualization.Diagram.DiagramContext.setNodeShape(i,this)),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(i,this),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectorConstraints),t.isExpanded!==undefined&&(t.isExpanded?(i.isExpanded=!0,this._expandChildren(i)):(i.isExpanded=!1,this._collapseChildren(i)),this.layout())))},updateConnector:function(n,t){var i,u,r;n&&(i=this._findConnector(n),i&&(t.constraints&&(i.constraints=t.constraints),t.lineColor&&(i.lineColor=t.lineColor),t.lineWidth&&(i.lineWidth=t.lineWidth),t.lineDashArray&&(i.lineDashArray=t.lineDashArray),t.segments&&(i.segments=t.segments,this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments[0]&&(u=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initializeSegments(i,u),this._dock(i,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(i,this),this._updateQuad(this,i),i==this.selectionList[0]&&(this._clearSelection(),this._addSelection(i))),t.targetDecorator&&(r=i.targetDecorator?$.extend(!0,{},i.targetDecorator,t.targetDecorator):ej.datavisualization.Diagram.Decorator(t.targetDecorator),i.targetDecorator=r),t.sourceDecorator&&(r=i.sourceDecorator?$.extend(!0,{},i.sourceDecorator,t.sourceDecorator):ej.datavisualization.Diagram.Decorator(t.sourceDecorator),i.sourceDecorator=r),(t.sourceDecorator||t.targetDecorator)&&(ej.datavisualization.Diagram.DiagramContext.clearDecorators(i,this),ej.datavisualization.Diagram.DiagramContext.renderDecorators(i,this)),this._svg&&(ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateConnectorStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectorConstraints)))},updateDiagram:function(n){if(this.activeTool._showAllPorts(!0),n.tool){var t=n.tool;this.model.tool=t;t&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.activateTool(this.model.connectorType,!1):t&ej.datavisualization.Diagram.Tool.DrawOnce?this.activateTool(this.model.connectorType,!0):t&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):t&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select")}},bringToCenter:function(n){var t=this._currZoom,u=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),i=n.x+n.width/2-u.width/2,r=n.y+n.height/2-u.height/2;i=Math.max(0,i)*t;r=Math.max(0,r)*t;ej.datavisualization.Diagram.ZoomUtil._applyTransform(this,t,ej.datavisualization.Diagram.Point(-i,-r),null)},bringIntoView:function(n){var i=0,r=0;n.right=n.right?n.right:n.x+n.width;n.bottom=n.bottom?n.bottom:n.y+n.height;var u=this._hScrollOffset,f=this._vScrollOffset,t=ej.datavisualization.Diagram.ScrollUtil._viewPort(this);n.right>-u+t.width&&(i=n.right-t.width);n.x<-u&&(i=n.x);n.bottom>-f+t.height&&(r=n.bottom-t.height);n.y<-f&&(r=n.y);ej.datavisualization.Diagram.ZoomUtil._applyTransform(this,this._currZoom,ej.datavisualization.Diagram.Point(-i,-r),null)},getBridgeSegment:function(n,t,i,r,u){return"A "+r/2+" "+r/2+"  "+i+" , 1 "+u+" "+t.x+","+t.y},fitToPage:function(n,t,i){var u,e,o={},r,s,c,l,h,f,a,v;if(this.model.nodes.length>0||this.model.connectors.length>0){s=ej.datavisualization.Diagram.ScrollUtil._viewPort(this);i||(i=ej.datavisualization.Diagram.Margin());t!="custom"&&(t=="content"?(r=new ej.datavisualization.Diagram.Rectangle,r.x=this._spatialSearch.pageLeft,r.y=this._spatialSearch.pageTop,r.width=this._spatialSearch.pageRight,r.height=this._spatialSearch.pageBottom):r=this._getDigramBounds());c=t!="custom"?r.width-r.x:r.width;l=t!="custom"?r.height-r.y:r.height;o.x=(s.width-(i.left+i.right))/c;o.y=(s.height-(i.top+i.bottom))/l;h=this._hScrollOffset;f=this._vScrollOffset;switch(n){case"width":u=o.x;e=u/this._getCurrentZoom();h-=r.x*u;f-=this._vScrollOffset*e;f=t!="custom"?f:f+this._vScrollOffset*e;break;case"height":u=o.y;e=u/this._getCurrentZoom();a=(s.width-(t!="content"?r.width:c)*u)/2-r.x*u;v=(s.height-(t!="content"?r.height:l)*u)/2-r.y*u;h+=a+(i.left-i.right)/2*u;f+=v+(i.top-i.bottom)/2*u;break;case"page":u=Math.min(o.x,o.y);e=u/this._getCurrentZoom();Math.min(o.x,o.y)==o.x?(h-=r.x*u,f-=this._vScrollOffset*e,f=t!="custom"?f:f+this._vScrollOffset*e):(a=(s.width-(t!="content"?r.width:c)*u)/2-r.x*u,v=(s.height-(t!="content"?r.height:l)*u)/2-r.y*u,h+=a+(i.left-i.right)/2*u,f+=v+(i.top-i.bottom)/2*u)}ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,e,h,f,new ej.datavisualization.Diagram.Point(0,0),!0)}else e=1/this._getCurrentZoom(),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,e,this._hScrollOffset,this._vScrollOffset,new ej.datavisualization.Diagram.Point(0,0),!0)},exportAsImage:function(){var n=this._getDigramBounds(),n={x:this._spatialSearch.pageLeft||n.x,y:this._spatialSearch.pageTop||n.y,width:this._spatialSearch.pageRight-this._spatialSearch.pageLeft||n.width,height:this._spatialSearch.pageBottom-this._spatialSearch.pageTop||n.height},i=new ej.datavisualization.Diagram.Canvas({id:"mycanvas",width:n.width+50,height:n.height+50}),r=i.document.getContext("2d"),t;for(r.translate(-n.x+25,-n.y+25),r.fillStyle=this.model.pageSettings.pageBackgroundColor,r.fillRect(n.x-25,n.y-25,n.width+50,n.height+50),t=0;t<this.model.nodes.length;t++)this.model.nodes[t].isGroup&&!this.model.nodes[t].parent?ej.datavisualization.Diagram.CanvasContext.renderGroup(this.model.nodes[t],i,this):this.model.nodes[t].parent||ej.datavisualization.Diagram.CanvasContext.renderNode(this.model.nodes[t],i);for(t=0;t<this.model.connectors.length;t++)ej.datavisualization.Diagram.CanvasContext.renderConnector(this.model.connectors[t],i);return i.document.toDataURL("image/png")},print:function(){var r=this.exportAsImage(),i=document.createElement("img"),u={id:this.element[0].id+"_printImage",src:r},t,n;ej.datavisualization.Diagram.Util.attr(i,u);t=document.createElement("div");t.appendChild(i);n=window.open("");n!=null&&(n.document.write("<html><head><title><\/title><\/head>"),n.document.write('<BODY onload="window.print()">'),n.document.write("<center>"+t.innerHTML+"<\/center>"),n.document.close())},save:function(){var t=this.model.drawingTools,i=this.model.userHandles,n;return this.model.drawingTools=null,this.model.userHandles=null,this.nameTable.multipleSelection&&ej.datavisualization.Diagram.Util.removeItem(this.model.nodes,this.nameTable.multipleSelection),this._updateTableNodes(),n=jQuery.extend(!0,{},this.model),this.model.drawingTools=t,this.model.userHandles=i,n},_updateTableNodes:function(){var n=0,t;for(n;n<this.model.nodes.length;n++)t=this.nameTable[this.model.nodes[n].name],t&&(this.model.nodes[n]=t)},load:function(n){var t,i;this.clear();t=document.getElementById(this.element[0].id+"_contextMenu");t&&t.parentNode.removeChild(t);i={nodes:n.nodes?n.nodes:[],connectors:n.connectors?n.connectors:[],contextMenu:n.contextMenu?n.contextMenu:{},snapSettings:n.snapSettings?n.snapSettings:{},backgroundImage:n.backgroundImage?n.backgroundImage:null,enableAutoScroll:n.enableAutoScroll?n.enableAutoScroll:!0,autoScrollMargin:n.autoScrollMargin?n.autoScrollMargin:20,layout:n.layout?n.layout:{},pageSettings:n.pageSettings?n.pageSettings:{},click:n.click?n.click:null,connectionChange:n.connectionChange?n.connectionChange:null,defaultSettings:n.defaultSettings?n.defaultSettings:null,dataSource:n.dataSource?n.dataSource:null,dataSourceSchema:n.dataSourceSettings?n.dataSourceSettings:null,doubleClick:n.doubleClick?n.doubleClick:null,enableContextMenu:n.enableContextMenu?n.enableContextMenu:!0,showTooltip:n.showTooltip?n.showTooltip:!0,handles:n.handles?n.handles:[],height:n.height?n.height:null,mouseEnter:n.mouseEnter?n.mouseEnter:null,mouseOver:n.mouseOver?n.mouseOver:null,mouseLeave:n.mouseLeave?n.mouseLeave:null,nodeTemplate:n.nodeTemplate?n.nodeTemplate:null,rotationChange:n.rotationChange?n.rotationChange:null,selectorConstraints:n.selectorConstraints?n.selectorConstraints:ej.datavisualization.Diagram.SelectorConstraints.All,tooltipTemplateId:n.tooltipTemplateId?n.tooltipTemplateId:null,width:n.width?n.width:null,constraints:n.constraints,zoomFactor:n.zoomFactor?n.zoomFactor:1};$("#"+this._id).ejDiagram(i)},layout:function(){this._setLayout()},_setLayout:function(){this._doLayout();ej.datavisualization.Diagram.PageUtil._updatePageSize(this);this._clearSelection()},addSelection:function(n){this._addSelection(n)},updateSelectedObject:function(n){var t=this.nameTable[n];t&&(this.activeTool.selectedObject=t)},updateSelection:function(n){ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._updateSelectionHandle(n)},activateTool:function(n,t){this.tools[n]&&(this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this._toolToActivate=n,this.activeTool=this.tools[this._toolToActivate],t!=undefined&&(this.activeTool.singleAction=t));this.activeTool instanceof ej.datavisualization.Diagram.ImageTool&&this.activeTool.autoOpenUpload&&this.activeTool._showPopup();this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(this._currentCursor="pointer");this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&(this.model.tool=this.activeTool.singleAction?this.model.tool|ej.datavisualization.Diagram.Tool.DrawOnce:this.model.tool|ej.datavisualization.Diagram.Tool.ContinuesDraw,this.activeTool._showAllPorts());this._drawingTool=!0},deactivateTool:function(){this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0);this.model.tool&ej.datavisualization.Diagram.Tool.DrawOnce&&(this.model.tool=this.model.tool^ej.datavisualization.Diagram.Tool.DrawOnce);this.model.tool&ej.datavisualization.Diagram.Tool.ContinuesDraw&&(this.model.tool=this.model.tool^ej.datavisualization.Diagram.Tool.ContinuesDraw);this.model.tool&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._mousedown=!1,this._currentCursor="pointer"):(this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate])},updateLabel:function(n,t,i){var r,u;if(n&&ej.datavisualization.Diagram.Util.isPageEditable(this)&&(r=this._findNode(n),r||(r=this._findConnector(n)),(!i.name||t.name==i.name)&&r)){for(u in i)t.hasOwnProperty(u)&&(t[u]=i[u]);r.segments||r.shape&&r.shape.type!=="text"?(ej.datavisualization.Diagram.DiagramContext.updateLabelStyle(r,t,this),ej.datavisualization.Diagram.DiagramContext.updateLabel(r,t,this)):r.shape&&r.shape.type==="text"&&ej.datavisualization.Diagram.DiagramContext.updateTextBlock(r,t,this)}},startLabelEdit:function(n,t){var r,i,u;if(n){for(r=0;r<this.selectionList.length;r++)if(i=this.selectionList[r],i!==n&&typeof i.labels.length!="undefined")for(u=0;u<i.labels.length;u++)i.labels[u].mode=ej.datavisualization.Diagram.LabelEditMode.View;this._setLabelEditing(t)?this._startEdit(n):this._endEdit()}},_setSelectorConstraints:function(n){this.model.selectorConstraints=n;this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._svg,this._adornerLayer),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._svg,this._adornerLayer,this._currZoom,n),this.model.selectorConstraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.userHandles,this.selectionList[0],this._svg,this.selectionList[0].isPseudoGroup,this._currZoom,this._adornerLayer))},group:function(){var t,n,i,u,r,f;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup){for(t=[],n=0;n<this.selectionList[0].children.length;n++)t.push(this.nameTable[this.selectionList[0].children[n]]);for(this._sortByZIndex(t,!0),u=ej.datavisualization.Diagram.Util.randomId(),r=new ej.datavisualization.Diagram.Group({name:u}),this._clearSelection(),n=0;n<t.length;n++)this._isUndo=!0,r.children.push(t[n].name),t[n].parent=u,ej.datavisualization.Diagram.Util.removeItem(this.selectionList,t[n].name),ej.browserInfo().name==="msie"&&(t[n].shape&&t[n].shape.type=="html"?(i=document.getElementById(t[n].name+"_parentdiv"),i.parentNode.removeChild(i)):t[n].isGroup&&this._checkForHtmlNode(t[n])),i=this._svg.document.getElementById(t[n].name),i.parentNode.removeChild(i);ej.datavisualization.Diagram.Util.clear(this.selectionList);this.add(r);this._addSelection(r);f={type:"groupchanged",object:r,actionType:"group"};this.addHistoryEntry(f);this._isUndo=!1}},_checkForHtmlNode:function(n){for(var t,r,i=0;i<n.children.length;i++)t=this.nameTable[n.children[i]],t&&(t.isGroup?this._checkForHtmlNode(t):t.shape&&t.shape.type=="html"&&(r=document.getElementById(t.name+"_parentdiv"),r.parentNode.removeChild(r)))},_removeChildren:function(n,t){for(var i,r=0;r<n.children.length;r++)i=this.nameTable[n.children[r]],i&&(this._removeConnector(i,t),ej.datavisualization.Diagram.Util.removeItem(this.model.nodes,i),i.isGroup?this._removeChildren(i,t):(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]))},ungroup:function(){var r,i,u,n,t,f;if(this.selectionList[0]&&this.selectionList[0].isGroup){for(this._isUndo=!0,r=this.selectionList[0].children,u=this.selectionList[0],$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),ej.browserInfo().name==="msie"&&this._checkForHtmlNode(this.selectionList[0]),this._clearSelection(),ej.datavisualization.Diagram.Util.clear(this.selectionList),i=0;i<r.length;i++)t=this.nameTable[r[i]],t&&(t.parent&&(t.parent=null),t.segments?(n=t,n.parent="",this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this)):(n=t,n.parent="",n.isGroup?(this._updateChildrenEdges(n),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):ej.datavisualization.Diagram.DiagramContext.renderNode(n,this)));ej.datavisualization.Diagram.Util.removeItem(this.model.nodes,this._findNode(u.name));f={type:"groupchanged",object:u,actionType:"ungroup"};this.addHistoryEntry(f);this._isUndo=!1}},nudge:function(n,t){t=t?t:1;var r={up:{x:0,y:-t},down:{x:0,y:t},left:{x:-t,y:0},right:{x:t,y:0}},i=r[n];i&&this.selectionList[0]&&this._nudge(this.selectionList[0],i.x,i.y)},selectAll:function(){var t,r,n,u,f=null,i;for(this._clearSelection(),t=ej.datavisualization.Diagram.Group({isPseudoGroup:!0,name:"multipleSelection"}),r=this.model.nodes,n=0,u=r.length;n<u;n++)ej.datavisualization.Diagram.Util.canSelect(r[n])&&(f=this.nameTable[r[n].name],f.parent==""&&t.children.push(f.name));for(i=this.model.connectors,n=0,u=i.length;n<u;n++)ej.datavisualization.Diagram.Util.canSelect(i[n])&&i[n].parent==""&&t.children.push(i[n].name);ej.datavisualization.Diagram.Util._updateGroupBounds(t,this.nameTable);this.model.nodes.push(t);this.nameTable[t.name]=t;t.children.length>0&&this._addSelection(t)},align:function(n){var o,r,t,e,i,s,u,f;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&this.selectionList[0].children&&this.selectionList[0].children.length>0&&(o=this.nameTable[this.selectionList[0].name].children,n==="left"?r=this._findCornerNodes().left:n==="right"?r=this._findCornerNodes().right:n==="top"?r=this._findCornerNodes().top:n==="bottom"&&(r=this._findCornerNodes().bottom),r?t=ej.datavisualization.Diagram.Util.bounds(r):(n==="center"||n==="middle")&&(t=ej.datavisualization.Diagram.Util.bounds(this.selectionList[0])),t)){for(u=0,f=0,e=0;e<o.length;e++)s=this.nameTable[o[e]],i=ej.datavisualization.Diagram.Util.bounds(s),n==="left"?u=-(i.x-t.x):n==="right"?u=-(i.x+i.width-(t.x+t.width)):n==="top"?f=-(i.y-t.y):n==="bottom"?f=-(i.y+i.height-(t.y+t.height)):n==="center"?u=-(i.x+i.width/2-(t.x+t.width/2)):n==="middle"&&(f=-(i.y+i.height/2-(t.y+t.height/2))),this._moveNode(u,f,s);ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this.nameTable);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectorConstraints)}},sameSize:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this.selectionList[0].children[0]],r=ej.datavisualization.Diagram.Util.bounds(u);for(t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(n.height=r.height,n.width=r.width,this._updateQuad(this,n),ej.datavisualization.Diagram.DiagramContext.update(n,this));ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this.nameTable);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectorConstraints)}},sameHeight:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,r=this.nameTable[this.selectionList[0].children[0]],u=ej.datavisualization.Diagram.Util.bounds(r);for(t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(n.height=u.height,this._updateQuad(this,n),ej.datavisualization.Diagram.DiagramContext.update(n,this));ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this.nameTable);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectorConstraints)}},sameWidth:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,r=this.nameTable[this.selectionList[0].children[0]],u=ej.datavisualization.Diagram.Util.bounds(r);for(t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(n.width=u.width,this._updateQuad(this,n),ej.datavisualization.Diagram.DiagramContext.update(n,this));ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this.nameTable);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._svg,this._currZoom,this,this.model.selectorConstraints)}},spaceDown:function(){var t,r,s,e,c,o,i,n;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&(t=this.selectionList[0].children,this._sortByYvalue(this.selectionList[0].children),r=t.length,t&&r>2)){var h=this._findCornerNodes(),u=h.top,f=h.bottom;if(u&&f)for(e=ej.datavisualization.Diagram.Util.bounds(u),c=ej.datavisualization.Diagram.Util.bounds(f),s=(c.y-e.y)/(r-1),o=1,i=0;i<t.length;i++)n=this.nameTable[t[i]],n!==u&&n!==f&&(n.offsetY=e.y+o*s+n.height/2,this._updateQuad(this,n),o+=1,ej.datavisualization.Diagram.DiagramContext.update(n,this))}},spaceAcross:function(){var t,r,s,e,c,o,i,n;if(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&(t=this.selectionList[0].children,this._sortByXvalue(this.selectionList[0].children),r=t.length,t&&r>2)){var h=this._findCornerNodes(),u=h.left,f=h.right;if(u&&f)for(e=ej.datavisualization.Diagram.Util.bounds(u),c=ej.datavisualization.Diagram.Util.bounds(f),s=(c.x-e.x)/(r-1),o=1,i=0;i<t.length;i++)n=this.nameTable[t[i]],n!==u&&n!==f&&(n.offsetX=e.x+o*s+n.width/2,this._updateQuad(this,n),o+=1,ej.datavisualization.Diagram.DiagramContext.update(n,this))}},sendBackward:function(){var t,i,r,n,u,e,f,o;if(this.selectionList[0]&&!this.selectionList[0].isPseudoGroup&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n),this._sortByZIndex(t),u=0;u<t.length;u++)if(n.zOrder>t[u].zOrder){r=t[u];break}if(e=n.zOrder,r){for(f=r.zOrder,i=f;i<e;i++)n.parent!=""?this._findObjectByIndex(i,!0).zOrder+=1:this._findObjectByIndex(i).zOrder+=1;n.parent!=""?n.parent&&(o=this.nameTable[n.parent],this._findChildren(o,n.name).zOrder=f):this._findObjectByName(n.name).zOrder=f;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name));ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectorConstraints)}}},moveForward:function(){var t,i,r,n,u,e,f,o;if(this.selectionList[0]&&!this.selectionList[0].isPseudoGroup&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n),this._sortByZIndex(t),u=t.length-1;u>=0;u--)if(n.zOrder<t[u].zOrder){r=t[u];break}if(e=n.zOrder,r){for(f=r.zOrder,i=f;i>e;i--)n.parent!=""?this._findObjectByIndex(i,!0).zOrder-=1:this._findObjectByIndex(i).zOrder-=1;n.parent!=""?n.parent&&(o=this.nameTable[n.parent],this._findChildren(o,n.name).zOrder=f):this._findObjectByName(n.name).zOrder=f;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name).nextSibling);ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectorConstraints)}}},sendToBack:function(){var n=this.selectionList[0],r,t,f;if(n&&!n.isPseudoGroup){var e=this._findOverlapNode(n),u=this._sortByZIndex(e),o=n.zOrder,i=n.zOrder;for(t=0;t<u.length;t++)u[t].zOrder<i&&(i=u[t].zOrder,r=u[t]);if(r){for(t=i;t<o;t++)n.parent!=""?this._findObjectByIndex(t,!0).zOrder+=1:this._findObjectByIndex(t).zOrder+=1;n.parent!=""?n.parent&&(f=this.nameTable[n.parent],this._findChildren(f,n.name).zOrder=i):this._findObjectByName(n.name).zOrder=i;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name));ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectorConstraints)}}},bringToFront:function(){var n=this.selectionList[0],r,t,f;if(n&&!n.isPseudoGroup){var e=this._findOverlapNode(n),i=this._sortByZIndex(e),o=n.zOrder,u=n.zOrder;for(t=0;t<i.length;t++)i[t].zOrder>u&&(u=i[t].zOrder,r=i[t]);if(r){for(t=0;t<i.length;t++)i[t].zOrder>o&&(i[t].zOrder-=1);n.parent?(f=this.nameTable[n.parent],this._findChildren(f,n.name).zOrder=u):this._findObjectByName(n.name).zOrder=u;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(r.name).nextSibling);ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectorConstraints)}}},undo:function(){var t,n;if(ej.datavisualization.Diagram.Util.isPageEditable(this)&&ej.datavisualization.Diagram.Util.canUndo(this)){this._isUndo=!0;n=this.getUndoEntry();switch(n&&n.type){case"positionchanged":t={object:n.undoObject,isMultipleNode:n.isMultipleNode};this._recordPinPointChanged(t);break;case"rotationchanged":t={object:n.undoObject,isMultipleNode:n.isMultipleNode};this._recordRotationChanged(t);break;case"sizechanged":t={object:n.undoObject,isMultipleNode:n.isMultipleNode};this._recordSizeChanged(t);break;case"endpointchanged":t={undoObject:n.undoObject,redoObject:n.redoObject,isMultipleNode:n.isMultipleNode,_isUndo:!0};this._recordEndPointChanged(t);break;case"collectionchanged":t={changeType:n.changeType,childTable:n.childTable,edgeTable:n.edgeTable,isUndo:!0,sourcePorts:n.sourcePorts,targetPorts:n.targetPorts};t.object=jQuery.extend(!0,{},n.object);this._recordCollectionChanged(t);break;case"labelchanged":t={object:n.shape,label:n.previousLabelValue};this._recordLabelChanged(t);break;case"groupchanged":t={object:n.object,isUndo:!0,actionType:n.actionType};this._recordGroupChanged(t)}this._isUndo=!1}},redo:function(){var n,t;this._isUndo=!0;n=this.getRedoEntry();switch(n&&n.type){case"positionchanged":t={object:n.redoObject,isMultipleNode:n.isMultipleNode};this._recordPinPointChanged(t);break;case"rotationchanged":t={object:n.redoObject,isMultipleNode:n.isMultipleNode};this._recordRotationChanged(t);break;case"sizechanged":t={object:n.redoObject,isMultipleNode:n.isMultipleNode};this._recordSizeChanged(t);break;case"endpointchanged":t={undoObject:n.undoObject,redoObject:n.redoObject,isMultipleNode:n.isMultipleNode,_isUndo:!1};this._recordEndPointChanged(t);case"collectionchanged":t={changeType:n.changeType,childTable:n.childTable,isUndo:!1};t.object=jQuery.extend(!0,{},n.object);this._recordCollectionChanged(t);break;case"labelchanged":t={object:n.shape,label:n.updatedLabelValue};this._recordLabelChanged(t);break;case"groupchanged":t={object:n.object,actionType:n.actionType,isUndo:!1};this._recordGroupChanged(t)}this._isUndo=!1},addHistoryEntry:function(n){var t,i;this._historyList.currentEntry!=null&&(t=this._historyList.currentEntry,t.next?t.previous&&(i=t.next,i.previous=null,t.next=n,n.previous=t):(t.next=n,n.previous=t));this._historyList.currentEntry=n;this._historyList.canUndo=!0;this._historyList.canRedo=!1},clearHistory:function(){var n=this._historyList;n.currentEntry=null;n.canUndo=!1;n.canRedo=!1;this._hScrollbar._scrollData=null;this._vScrollbar._scrollData=null},getUndoEntry:function(){var i=null,t,n=this._historyList;return n.canUndo&&(i=n.currentEntry,t=n.currentEntry.previous,t?(n.currentEntry=t,n.canRedo||(n.canRedo=!0)):(n.canRedo=!0,n.canUndo=!1)),i},getRedoEntry:function(){var i=null,t,n=this._historyList;return n.canRedo&&(t=n.currentEntry.previous||n.canUndo?n.currentEntry.next:n.currentEntry,t&&(n.currentEntry=t,n.canUndo||(n.canUndo=!0),t.next||(n.canRedo=!1,n.canUndo=!0)),i=n.currentEntry),i},cut:function(){this._pasteIndex=0;this._setClipboard();this._delete()},addPorts:function(n,t){var i,u,r;if(ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=this.nameTable[n],i&&t))for(r=0;r<t.length;r++)u=ej.datavisualization.Diagram.Port(t[r]),i.ports.push(u),ej.datavisualization.Diagram.DiagramContext.renderPort(i,u,this)},copy:function(){this._pasteIndex=1;this.selectionList&&this.selectionList.length>0&&this._setClipboard()},paste:function(){this._paste()},_setClipboard:function(){var t,n,u,s,i,r,f,e,o;if(this.selectionList.length>0&&!this.selectionList[0].isSwimlane){if(n=this.selectionList[0],u={},n.isGroup||n.isPseudoGroup){for(i=0;i<n.children.length;i++)for(r=i+1;r<n.children.length;r++)f=this.nameTable[n.children[i]],e=this.nameTable[n.children[r]],e&&f&&e.zOrder<f.zOrder&&(s=n.children[i],n.children[i]=n.children[r],n.children[r]=s);u=this._getChildTable(n,u)}if(t=$.extend(!0,{},{childTable:u,node:n}),t.node.segments&&(t.node.targetNode=null,t.node.targetPort=null,t.node.sourceNode=null,t.node.sourcePort=null),this._preserveHtmlContent(n,t.node),t.node.children&&t.node.children.length>0)for(o in t.childTable)this._preserveHtmlContent(u[o],t.childTable[o]);this._clipboardData=t}},_preserveHtmlContent:function(n,t){n.shape&&(t.shape.type==="html"?typeof n.shape.html=="string"||(t.shape.html=n.shape.html.cloneNode(!0)):t.shape.type==="native"&&(t.shape.content=n.shape.content.cloneNode(!0)))},_getChildTable:function(n,t){var i,r,e,u,f;if(r=n.children,r)for(u=0;u<r.length;u++)e=r[u],i=this.nameTable[e],i&&(i.parent===n.name||n.isPseudoGroup)&&(f=t[i.name]=$.extend(!0,{},i),(f.isGroup||f.isPseudoGroup)&&(t=this._getChildTable(f,t)));return t},_paste:function(){var i,r,n,h,f,s,c,t,u,e,o;if(this._clipboardData){if(i=this._clipboardData,i=$.extend(!0,{},{childTable:i.childTable,node:i.node}),this._preserveHtmlContent(this._clipboardData.node,i.node),i.node.children&&i.node.children.length>0)for(t in i.childTable)this._preserveHtmlContent(this._clipboardData.childTable[t],i.childTable[t]);if(n=i.node,n.container){u=ej.datavisualization.Diagram.Util.randomId();n.name+=u;this._updateChildName(n,u);for(e in i.childTable)t=i.childTable[e],t.name=t.name+u,this.nameTable[t.name]=t;r=this._pasteIndex*10;this._translate(n,r,r,this.nameTable);n.isSwimlane?(n.width=0,n.height=0,this.add(n)):n.isLane&&(o=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(n,this,i),o&&(o.width=0,o.height=0,this.add(o)))}else if(n.isPseudoGroup){for(h=n.children,f=ej.datavisualization.Diagram.Group({isPseudoGroup:!0,name:"multipleSelection"}),this._isUndo=!0,e=0;e<h.length;e++)u=h[e],t=i.childTable[u],t&&(u=u+ej.datavisualization.Diagram.Util.randomId(),delete i.childTable[t.name],t.name=u,t.parent="",i.childTable[t.name]=t,this._preserveConnection(i.childTable,t),f.children.push(u),t.isGroup&&this._pasteChildren(i.childTable,t),r=this._pasteIndex*10,this._translate(t,r,r,this.nameTable),this.add(t));this._clearSelection();this.model.nodes.push(f);this.nameTable[f.name]=f;ej.datavisualization.Diagram.Util._updateGroupBounds(f,this.nameTable);this._addSelection(f);s={};s=this._getChildTable(this.selectionList[0],s);c={type:"collectionchanged",object:jQuery.extend(!0,{},this.selectionList[0]),childTable:jQuery.extend(!0,{},s),changeType:"insert"};this.addHistoryEntry(c);this._isUndo=!1}else n.name=n.name+ej.datavisualization.Diagram.Util.randomId(),n.parent="",n.isGroup?this._pasteChildren(i.childTable,n):n.segments||n.segments||(n.inEdges=[],n.outEdges=[]),r=this._pasteIndex*10,n.segments?ej.datavisualization.Diagram.Util._translateLine(n,r,r):this._translate(n,r,r,this.nameTable),this.add(n);this._pasteIndex++}},_updateChildName:function(n,t){if(n&&t)for(var i=0;i<n.children.length;i++)n.children[i]=n.children[i]+t},_pasteChildren:function(n,t){for(var i,r,e=[],f=t.children,u=0;u<f.length;u++)r=f[u],i=n[r],i&&(r=r+ej.datavisualization.Diagram.Util.randomId(),delete n[i.name],i.name=r,n[i.name]=i,this._preserveConnection(n,i),i.parent=t.name,e.push(r),i.isGroup&&this._pasteChildren(n,i),this.add(i));t.children=e;this._preserveConnection(n,t)},_preserveConnections:function(n,t){for(var i,u=t.children,r=0;r<u.length;r++)i=n[u[r]],i&&(this._preserveConnection(n,i),i.isGroup&&this._preserveConnections(n,t))},_preserveConnection:function(n,t){var i,r,f,u;if(t.segments)t.targetNode&&(u=n[t.targetNode],u&&u.inEdges.push(t.name)),t.sourceNode&&(u=n[t.sourceNode],u&&u.outEdges.push(t.name));else{if(f=t.inEdges.length,f>0){for(i=0;i<f;i++)r=n[t.inEdges[i]],r&&(r.targetNode=t.name);t.inEdges=[]}if(f=t.outEdges.length,f>0){for(i=0;i<t.outEdges.length;i++)r=n[t.outEdges[i]],r&&(r.sourceNode=t.name);t.outEdges=[]}}},_expandChildren:function(n){for(var r,t,i=0;i<n.outEdges.length;i++)r=this.nameTable[n.outEdges[i]],r.visible=!0,t=this.nameTable[r.targetNode],t.isExpanded&&this._expandChildren(t),t.visible=!0,t.excludeFromLayout=!1},_collapseChildren:function(n){for(var r,t,i=0;i<n.outEdges.length;i++)r=this.nameTable[n.outEdges[i]],r.visible=!1,t=this.nameTable[r.targetNode],t.isExpanded&&this._collapseChildren(t),t.visible=!1,t.excludeFromLayout=!0,t.offsetX=0,t.offsetY=0},zoomTo:function(n){n||(n=new ej.datavisualization.Diagram.Zoom);n.zoomCommand&ej.datavisualization.Diagram.ZoomCommand.ZoomIn?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+n.zoomFactor,0,0,n.focusPoint,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+n.zoomFactor),0,0,n.focusPoint,!0)},remove:function(n){n&&this.nameTable[n.name]&&ej.datavisualization.Diagram.Util.isPageEditable(this)?this._remove(n):this._delete()},clear:function(){this._clearSelection();for(var n=this.model.connectors.length-1;n>=0;n--)this._remove(this.model.connectors[n]);for(n=this.model.nodes.length-1;n>=0;n--)this._remove(this.model.nodes[n]);this.clearHistory();$("#"+this._canvas.id+"_hScrollbar").ejScrollbar({width:0});$("#"+this._canvas.id+"_vScrollbar").ejScrollbar({height:0})},_add:function(n,t){var i=!1,r,e,f,u,o;if(n.length>0)for(r=0;r<n.length;r++)this.add(n[r]);else e=n.segments?"connector":"node",f={changeType:"insert",element:n,cancel:!1},this._raiseEvent(e+"CollectionChange",f),f.cancel||(this._setZorder(n),n.segments?(n=this._getNewConnector(n),i=this.model.connectors.push(n),i&&(ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n),this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(n,this),n.parent||t&&ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.nameTable[n.name]=n,t&&(this._clearSelection(),this._addSelection(n)))):(n.isGroup?n=ej.datavisualization.Diagram.Group(n):this.activeTool&&this.activeTool.name==="textTool"||(n=this._getNewNode(n)),i=this.model.nodes.push(n),this.nameTable[n.name]=n,i&&(n.isGroup?(this._updateParent(n),n.offsetX==0&&n.offsetY==0&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this.nameTable),this._updateChildrenEdges(n),t&&ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):(ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n),t&&!n.parent&&ej.datavisualization.Diagram.DiagramContext.renderNode(n,this)),this.nameTable[n.name]=n,t&&(this._clearSelection(),this._addSelection(n)))));return this._isUndo||this._selectedSymbol||n.parent==""&&(u={},this.selectionList&&this.selectionList.length>0&&(u=this._getChildTable(this.selectionList[0],u)),o={type:"collectionchanged",object:jQuery.extend(!0,{},n),childTable:jQuery.extend(!0,{},u),changeType:"insert"},this.addHistoryEntry(o)),i},add:function(n,t){if(ej.datavisualization.Diagram.Util.isPageEditable(this))return this._add(n,!0,t)},updateUserHandles:function(n){ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.userHandles,n,this._svg,!1,!1,this._currZoom)},scrollToNode:function(n){var u,f,i=this._currZoom,r=this.element[0].getBoundingClientRect(),t=ej.datavisualization.Diagram.Util.bounds(n),e,o;u=(t.x+t.width/2)*i;f=(t.y+t.height/2)*i;e=this._hScrollOffset;o=this._vScrollOffset;r.width+this._hScrollOffset<u+t.width/2&&(e=u+t.width*i-r.width);r.height+this._vScrollOffset<f+t.height/2&&(o=f+t.height*i-r.height);this._updateScrollOffset(e,o)},_getElementType:function(n){return n?n.isSwimlane?"swimlane":n.isGroup?"group":n.segments?"connector":n.shape?"node":null:null},_registerDrawingTools:function(){var t,n;for(t in this.model.drawingTools)n=this.model.drawingTools[t],n.diagram=this,this.tools[n.name]=n},_sortByXvalue:function(n){for(var r,i,u,f,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[n[t]],o=this.nameTable[n[i]],u=ej.datavisualization.Diagram.Util.bounds(e),f=ej.datavisualization.Diagram.Util.bounds(o),u.x>f.x&&(r=n[t],n[t]=n[i],n[i]=r);return n},_sortByYvalue:function(n){for(var r,i,u,f,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[n[t]],o=this.nameTable[n[i]],u=ej.datavisualization.Diagram.Util.bounds(e),f=ej.datavisualization.Diagram.Util.bounds(o),u.y>f.y&&(r=n[t],n[t]=n[i],n[i]=r);return n},_sortByZIndex:function(n,t){var u,i,r;if(t)for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder>n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);else for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder<n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);return n},_findCornerNodes:function(){var i,r,u,f,e,n,s=this.selectionList[0].children,o=this.nameTable[this.selectionList[0].children[0]],t,h,c,l,a;if(i=o,r=o,u=o,f=o,s.length>1)for(e=0;e<s.length;e++)t=this.nameTable[s[e]],n=ej.datavisualization.Diagram.Util.bounds(t),h=ej.datavisualization.Diagram.Util.bounds(r),n.x+n.width>h.x+h.width&&(r=t),c=ej.datavisualization.Diagram.Util.bounds(f),n.y+n.height>c.y+c.height&&(f=t),l=ej.datavisualization.Diagram.Util.bounds(i),n.x<l.x&&(i=t),a=ej.datavisualization.Diagram.Util.bounds(u),n.y<a.y&&(u=t);return{left:i,right:r,top:u,bottom:f}},_moveNode:function(n,t,i){this._translate(i,n,t,this.nameTable);ej.datavisualization.Diagram.DiagramContext.update(i,this)},_nudge:function(n,t,i){this._translate(n,t,i,this.nameTable);ej.datavisualization.Diagram.DiagramContext.update(n,this);ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._svg,this._currZoom,this,this.model.selectorConstraints)},_findObjectByName:function(n){var t=null;return this._findNode(n)&&(t=this._findNode(n)),this._findConnector(n)&&(t=this._findConnector(n)),t},_findObjectByIndex:function(n,t){var f,e=null,i,r,u,o;if(t){if(o=this.nameTable[this.selectionList[0].parent],o)for(f=o.children,u=0;u<f.length;u++)i=this.nameTable[f[u]],i.zOrder===n&&(e=f[u])}else{for(r=0;r<this.model.nodes.length;r++)i=this.model.nodes[r],i.zOrder===n&&(e=i);for(r=0;r<this.model.connectors.length;r++)i=this.model.connectors[r],i.zOrder===n&&(e=i)}return e},_findOverlapNode:function(n){var i=[],t,r,f=[],o,s,u,e;if(n.parent){if(u=this.nameTable[n.parent],u)for(t=0;t<u.children.length;t++)u.children[t]!==n.name&&(e=this.nameTable[u.children[t]],e&&f.push(e))}else{for(t=0;t<this.model.nodes.length;t++)i.push(this.model.nodes[t]);for(t=0;t<this.model.connectors.length;t++)i.push(this.model.connectors[t]);if(o=ej.datavisualization.Diagram.Util.bounds(n),n)for(r=0;r<i.length;r++)s=ej.datavisualization.Diagram.Util.bounds(i[r]),n.name!==i[r].name&&this._intersect(o,s)&&f.push(i[r])}return f},_intersect:function(n,t){return n.x<=t.x+t.width&&t.x<=n.x+n.width&&n.y<=t.y+t.height&&t.y<=n.y+n.height},_createTooltipDiv:function(){var n=document.createElement("div"),t={id:this.element[0].id+"_tooltipDiv","class":"e-diagram-tooltip-default",style:"padding-top:3px; height: 24px;pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(n,t),this._canvas.appendChild(n),n},_renderTooltip:function(n){var t,u,r,f,i;n.parent&&this.nameTable[n.parent]&&this.nameTable[n.parent].container||this.showTooltip()&&$.templates&&(t=$("#"+this.element[0].id+"_tooltipDiv")[0],t||(t=this._createTooltipDiv()),i=this._currZoom,this.model.tooltipTemplateId?n.segments||(t.style.top=-this._vScrollOffset+(n.offsetY*i-n.height/2*i+n.height*i+15)+"px",t.style.left=-this._hScrollOffset+(n.offsetX*i-n.width/2*i)+(n.width/2*i-$(t).width()/2)+"px",u=$.templates("#"+this.model.tooltipTemplateId),r=[{name:this.activeTool.selectedObject.name,x:n.offsetX-n.width/2+"px",y:n.offsetY-n.height/2+"px",width:n.width+"px",height:n.height+"px",rotationAngle:n.rotateAngle}],f=u.render(r),$(t).html(f)):(u=$.templates("#"+this.element[0].id+"_defaultTooltip"),this.activeTool instanceof ej.datavisualization.Diagram.MoveTool?(t.style.width="150px",n.segments||(r=[{type:"X : ",type1:"Y : ",x:Math.round(n.offsetX-n.width/2)+"px  ",y:Math.round(n.offsetY-n.height/2)+"px"}])):this.activeTool instanceof ej.datavisualization.Diagram.ResizeTool?(t.style.width="150px",r=[{type:"W : ",type1:"H : ",x:Math.round(n.width)+"px  ",y:Math.round(n.height)+"px"}]):this.activeTool instanceof ej.datavisualization.Diagram.RotateTool&&(t.style.width="50px",r=[{type:"",type1:"",x:Math.round(n.rotateAngle)+"&deg; ",y:""}]),r?(t.style.top=-this._vScrollOffset+(n.offsetY*i-n.height/2*i+n.height*i+15)+"px",t.style.left=-this._hScrollOffset+(n.offsetX*i-n.width/2*i)+(n.width/2*i-$(t).width()/2)+"px",f=u.render(r),$(t).html(f)):this._removeTooltip()))},_removeTooltip:function(){var n=document.getElementById(this.element[0].id+"_tooltipDiv");n&&n.parentNode.removeChild(n)},_renderCanvas:function(){this._canvas=document.createElement("div");this._canvas.setAttribute("id",this.element[0].id+"_canvas");this._canvas.setAttribute("class","drawing");this._canvas.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";");this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this._views[this._id].canvas=this._canvas;this.element[0].setAttribute("tabindex",0);this.element.append(this._canvas);this._renderDiagram()},_getDigramBounds:function(){var n,t,r,u,i;return n=Math.min(0,this._spatialSearch.pageLeft),t=Math.min(0,this._spatialSearch.pageTop),this._pageWidth()||(r=this._spatialSearch.pageRight-Math.min(0,this._spatialSearch.pageLeft)),this._pageHeight()||(u=this._spatialSearch.pageBottom-Math.min(0,this._spatialSearch.pageTop)),this.model.pageSettings&&this._multiplePage()?(n=Math.min(0,this._spatialSearch.pageLeft),t=Math.min(0,this._spatialSearch.pageTop),this._pageWidth()&&(n=Math.floor(n/this._pageWidth())*this._pageWidth(),r=Math.ceil(this._spatialSearch.pageRight/this._pageWidth())*this._pageWidth()-n),this._pageHeight()&&(t=Math.floor(t/this._pageHeight())*this._pageHeight(),u=Math.ceil(this._spatialSearch.pageBottom/this._pageHeight())*this._pageHeight()-t),this._spatialSearch.pageRight===null&&this._pageWidth()!==0&&(r=this._pageWidth()),this._spatialSearch.pageBottom===null&&this._pageHeight()!==0&&(u=this._pageHeight())):(this._pageWidth()&&(n=Math.min(0,this._spatialSearch.pageLeft),r=this._pageWidth()),this._pageHeight()&&(t=Math.min(0,this._spatialSearch.pageTop),u=this._pageHeight())),i=new ej.datavisualization.Diagram.Rectangle,i.x=n,i.y=t,i.width=r,i.height=u,i},_initContextMenu:function(){this.model.contextMenu.showCustomMenuItemsOnly||(this.model.contextMenu.items=$.extend([],this._defaultContextMenuItems,this.model.contextMenu.items));this.enableContextMenu()?this._renderContextMenu():$("#"+this.element[0].id+"_contextMenu").remove()},_renderContextMenuItem:function(n){var r=document.createElement("li"),f=document.createElement("a"),o=ej.datavisualization.Diagram.Locale[this.model.locale],t,u,i,e;if($.each(o,function(t,i){n.name===t&&(f.innerHTML=i,n.text=i)}),r.setAttribute("id",this.element[0].id+"_contextMenu_"+n.name),t=document.createElement("span"),t.setAttribute("id",n.text+"_image"),t.setAttribute("style","margin-top:-5px;"),t.setAttribute("class","sf-d-menuitem "+n.name),f.appendChild(t),n.subItems&&n.subItems.length>0){for(u=document.createElement("ul"),i=0,i;i<n.subItems.length;i++)e=this._renderContextMenuItem(n.subItems[i],u),u.appendChild(e);r.appendChild(u)}return r.appendChild(f),r},_renderContextMenu:function(){var i=this.model.contextMenu.items,n=0,r,u,t=document.createElement("ul");for(t.setAttribute("id",this.element[0].id+"_contextMenu"),n;n<i.length;n++)r=i[n],u=this._renderContextMenuItem(r,t),t.appendChild(u);this._canvas.appendChild(t);$("#"+this.element[0].id+"_contextMenu").ejMenu({menuType:ej.MenuType.ContextMenu,contextMenuTarget:"#"+this.element[0].id+"_canvas_svg",click:$.proxy(this._onMenuItemClick,this),beforeOpen:$.proxy(this._onContextMenuOpen,this),mouseover:$.proxy(this._onMenuItemMouseOver,this),mouseout:$.proxy(this._onMenuItemMouseOut,this),close:$.proxy(this._onContextMenuClose,this)})},_onContextMenuClose:function(){this.element[0].focus()},_onContextMenuOpen:function(n){var t=this.element[0].id,i;this.enableContextMenu()&&(document.getElementById(t+"_contextMenu_cut").style.display="block",document.getElementById(t+"_contextMenu_copy").style.display="block",document.getElementById(t+"_contextMenu_paste").style.display="block",document.getElementById(t+"_contextMenu_undo").style.display="block",document.getElementById(t+"_contextMenu_redo").style.display="block",document.getElementById(t+"_contextMenu_selectAll").style.display="block",document.getElementById(t+"_contextMenu_cut").style.display="block",document.getElementById(t+"_contextMenu_grouping").style.display="block",document.getElementById(t+"_contextMenu_order").style.display="block",this.selectionList.length==0&&(document.getElementById(t+"_contextMenu_cut").style.display="none",document.getElementById(t+"_contextMenu_copy").style.display="none",document.getElementById(t+"_contextMenu_cut").style.display="none",document.getElementById(t+"_contextMenu_grouping").style.display="none",document.getElementById(t+"_contextMenu_order").style.display="none"));i={diagram:this,contextmenu:n};this._raiseEvent(this.model.contextMenu.beforeOpen,i)},_onMenuItemClick:function(n){var t=n.events.ID.replace(this._id+"_contextMenu_","");switch(t){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"selectAll":this.selectAll();break;case"group":this.group();break;case"ungroup":this.ungroup();break;case"bringToFront":this.bringToFront();break;case"sendToBack":this.sendToBack();break;case"moveForward":this.moveForward();break;case"sendBackward":this.sendBackward()}this._raiseEvent(this.model.contextMenu.click,n)},_onMenuItemMouseOver:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).addClass("hover")},_onMenuItemMouseOut:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).removeClass("hover")},_renderDiagram:function(){var n=this;this._views.forEach(function(t){var i=n._views[t];i.context._renderDocument(i,n);i.type=="mainview"&&i.context==ej.datavisualization.Diagram.SvgContext&&(n._createScrollbar(n._canvas),ej.datavisualization.Diagram.ScrollUtil._initScrollbar(n),ej.datavisualization.Diagram.PageUtil._updatePageSize(n));n._renderNodes(i);n._renderConnectors(i);n._renderphases(i)});$(this._svg.document).pinchDiagram(this._view,this)},_createScrollbar:function(n){var i=document.createElement("div"),t;i.setAttribute("id",n.id+"_hScrollbar");n.appendChild(i);t=document.createElement("div");t.setAttribute("id",n.id+"_vScrollbar");n.appendChild(t)},_doLayout:function(){this.model.layout&&(this._updateEdgeCollection(),ej.datavisualization.Diagram.Layout.doLayout(this))},_updateNodes:function(){for(var t=this.model.nodes,n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateConnectors:function(){for(var t=this.model.connectors,n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateEdgeCollection:function(){for(var n=0;n<this.model.connectors.length;n++)this._updateEdges(this.model.connectors[n])},updateViewPort:function(){ej.datavisualization.Diagram.DiagramContext.updateViewPort(this)},_setZorder:function(n){if(n&&(n.zOrder=this._zOrder,this._zOrder++,n.isGroup)){var t=0;if(n.children>0)for(t;t<n.children.length;t++)this.nameTable[n.children[t]].zOrder=t}},_union:function(n,t){var i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),u=Math.max(n.x+n.width,t.x+t.width),f=Math.max(n.y+n.height,t.y+t.height);return new ej.datavisualization.Diagram.Rectangle(i,r,u-i,f-r)},_getSeperetor:function(n){var i=this.model.phases,t,r;if(i)for(t=0,r=i.length;t<r;t++)if(i[t].name==n)return i[t]},_renderphases:function(){var t=this.model.phases,n,i;if(t)for(n=0,i=t.length;n<i;n++)t[n].type=="phase"&&ej.datavisualization.Diagram.SvgContext.renderphase(t[n],this._svg,this._diagramLayer,this)},_renderNodes:function(n,t,i){var f,u,o,r,e;if(this.model.nodes)for(f=this.model.nodes,u=0,o=f.length;u<o;++u)r=f[u],this._setZorder(r),e=n.svg||n._canvas,r.isGroup&&!r.parent?(r.container||ej.datavisualization.Diagram.Util._updateGroupBounds(r,this.nameTable),n.context.renderGroup(r,e,n.diagramLayer,this.nameTable,this,t,i)):r.parent||n.context.renderNode(r,e,n.diagramLayer,this)},_renderConnectors:function(n){var i,f,r,t,u;if(this.model.connectors){for(i=this.model.connectors,f=n.svg||n._canvas,t=0,u=i.length;t<u;++t)r=i[t],this._setZorder(r);for(t=0,u=i.length;t<u;++t)r=i[t],ej.datavisualization.Diagram.Util.updateBridging(r,this),n.context.renderConnector(r,f,n.diagramLayer,this)}},_wireEvents:function(){var n=$(this._canvas),t;this._on(n,ej.eventType.mouseDown,this._mousedown);this._on(n,ej.eventType.mouseMove,this._mousemove);this._on(n,ej.eventType.mouseUp,this._mouseup);this._on(n,ej.eventType.mouseLeave,this._documentmouseup);this._on(n,"dblclick",this._doubleclick);this._on(n,"doubletap",this._doubleclick);this._on(this.element,"keydown",this._keydown);this._on(n,"pinchin",this._pinchin);this._on(n,"pinchout",this._pinchout);this._on(this.element,"touchstart",this._handleTouchStart);ej.browserInfo().name==="mozilla"?this._on(this.element,"DOMMouseScroll",this._handleMouseWheel):this._on(this.element,"mousewheel",this._handleMouseWheel);this._on($(document),"mouseup",this._documentmouseup);window&&this._on($(window),"resize",this.updateViewPort);t=this;$(n).ejDroppable({drop:function(n,i){t._svgdrop(n,i);t._isDropped=!0}})},_mousePosition:function(n,t){var u=this._isTouchEvent(n),e=this._canvas.scrollLeft,o=this._canvas.scrollTop,f=this._canvas.getBoundingClientRect(),i=u.clientX+e-f.left,r=o+u.clientY-f.top;return t||(i=(i+this._hScrollOffset)/this._currZoom,r=(r+this._vScrollOffset)/this._currZoom),new ej.datavisualization.Diagram.Point(Math.round(i*100)/100,Math.round(r*100)/100)},_contextmenu:function(n){n.preventDefault();n.stopPropagation()},_pinchin:function(n){n.preventDefault()},_pinchout:function(n){n.preventDefault()},_handleTouchStart:function(n){n.preventDefault()},_mousedown:function(n){if(this._isPinching=!1,this._invoke(n)&&(this._isForeignObject(n.originalEvent.target)||n.preventDefault(),this.model.contextMenu&&$("#"+this.element[0].id+"_contextMenu").css("display")!=="none"&&(n.cancel=!0),this._isEditing&&this._endEdit(),n.which===1||n.which===0&&n.originalEvent.changedTouches)){if(n.which===0&&n.originalEvent.changedTouches){var t=null,i=this._mousePosition(n),r=this._isUserHandle(n);this._isInternalTool(this.activeTool)&&!this.activeTool.inAction&&(r||(t=this._findNodeUnderMouse(n),this._raiseMouseEvents(t)),!t&&this.selectionList[0]&&(t=this.selectionList[0]),this._checkToolToActivate(n,t,i))}n.ctrlKey&&n.shiftKey&&(t=this._findNodeUnderMouse(n),!t&&this.selectionList[0]&&(t=this.selectionList[0]),this._checkToolToActivate(n,t,i));this._toolToActivate==="panTool"?this.activeTool=this.tools[this._toolToActivate]:this.activateTool(this._toolToActivate);this.activeTool.mousedown(n)}},_invoke:function(n){var t=n.originalEvent.target.className;return n.originalEvent.target&&(t=="edit"||t=="editBox"||t=="e-hhandle"||t=="e-hhandlespace"||t=="e-vhandle"||t=="e-vhandlespace")?!1:!0},_handleMouseWheel:function(n){var i,t,r,u,f;n.originalEvent.preventDefault&&n.originalEvent.preventDefault();i=new ej.datavisualization.Diagram.Point(0,0);n.ctrlKey?(i.x=(n.originalEvent.layerX+this._hScrollOffset)/this._currZoom,i.y=(n.originalEvent.layerY+this._vScrollOffset)/this._currZoom,n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+Number(this.zoomFactor()),0,0,i,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+Number(this.zoomFactor())),0,0,i,!0)):(t=0,n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?(r=this._vScrollbar.model.minimum,this._vScrollOffset-this._scrollPixel>=r||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset-this._scrollPixel),t=-this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,r),t=0)):(u=this._vScrollbar.model.maximum,f=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),u>=this._vScrollOffset+this._scrollPixel||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset+this._scrollPixel),t=this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,u),t=0)),this._updateEditBox(0,t))},_mousemove:function(n){var t,g,e,w,r,u,y,i;if(n.type=="touchmove"&&n.originalEvent.touches.length>1)this._isPinching=!0;else{this._isPinching=!1;var i=null,k=this._mousePosition(n),d=this._isUserHandle(n);if(this.activeTool.inAction===!1&&this._selectedSymbol){var f=this._currZoom,p=$("#"+this.element[0].id).offset(),h=this._isTouchEvent(n),c,l;h?(c=h.pageX,l=h.pageY):(c=n.pageX,l=n.pageY);var a=c+this._hScrollOffset-p.left,v=l+this._vScrollOffset-p.top,t=$.extend(!0,{},this._selectedSymbol);this._selectedSymbol&&(t=$.extend(!0,{},this._selectedSymbol),t.name+=ej.datavisualization.Diagram.Util.randomId(),t.segments?(ej.datavisualization.Diagram.Util._translateLine(t,a,v),e={element:t},e.cancel||this.add(t)):(g=this._palNameTable,e={element:t},e.cancel||(w=ej.datavisualization.Diagram.Util.randomId(),this._cloneGroupNode(t,w),t.isGroup?(r=ej.datavisualization.Diagram.Util._getChildrenBounds(t,this.nameTable),this._translate(t,a/f-r.x-r.height/2,v/f-r.y-r.width/2,this.nameTable)):(t.offsetX=a/f,t.offsetY=v/f),t.isLane?(u=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(t,this.nameTable),u.isLane=t.isLane,u.orientation=t.orientation,this.add(u),ej.datavisualization.Diagram.SvgContext._hideNode(u,this._svg)):this.add(t))),this.scrollToNode(t),this.element[0].focus(),this._toolToActivate="move",this.activateTool("move"),y=document.getElementsByClassName("dragClone")[0],y&&(y.style.display="none"),this.activateTool("move",!0),this.activeTool.mousedown(n),this.activeTool.mousemove(n))}else if(this._isInternalTool(this.activeTool)&&!this.activeTool.inAction?(d||(i=this._findNodeUnderMouse(n),i&&(this._nodeToHit&&this._nodeToHit!=i&&!this._nodeToHit.segments&&this.activeTool._showPort(this._nodeToHit,!0),i.segments||this.activeTool._showPort(i)),this._raiseMouseEvents(i)),!i&&this.selectionList[0]&&(i=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(n,i,k)):(this.activeTool.inAction||(this._toolToActivate=this.activeTool.name,this._currentCursor=this.activeTool.cursor),i=this._findNodeUnderMouse(n),i&&this._raiseMouseEvents(i)),this._updateCursor(),this.activeTool.mousemove(n),this.activeTool.inAction&&this.enableAutoScroll()){var b=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),o=this._mousePosition(n,!0),s=this.model.pageSettings.autoScrollBorder;o.x+s.right>=b.width-18?(this._beginAutoScroll("right",n),this._canAutoScroll=!0):o.x<=s.left?(this._beginAutoScroll("left",n),this._canAutoScroll=!0):o.y+s.bottom>=b.height-18?(this._beginAutoScroll("bottom",n),this._canAutoScroll=!0):o.y<=s.top?(this._beginAutoScroll("top",n),this._canAutoScroll=!0):this._canAutoScroll=!1}}},_cloneGroupNode:function(n,t,i){var r=null,f,u;if(n.isGroup)for(u=0;u<n.children.length;u++)r=i?i[n.children[u]]:this._paletteTable[n.children[u]],r&&(r=$.extend(!0,{},r),r.isGroup&&this._cloneGroupNode(r,t),f=$.extend(!0,{},r),f.name+=t,n.children[u]=f.name,this.nameTable[f.name]=f)},_setActiveTool:function(n){var i=this._mousePosition(n),t,r,u;this.activeTool.inAction||!this._isUserHandleActive(this.activeTool.name)&&this.model.userHandles&&this.model.userHandles.length||(this._isInternalTool(this.activeTool)||this.activeTool.singleAction)&&(r=!1,this.selectionList[0]&&(t=this.selectionList[0],r=this._checkToolToActivate(n,t,i)),r||(t=this._findNodeUnderMouse(n),this._isUserHandle(n)?(u=$(n.target).parents("g").first().context.id.split("_")[0],this._checkToolToActivate(n,t,i,u),this.activeTool=this.tools[this._toolToActivate]):(this._checkToolToActivate(n,t,i),this._raiseMouseEvents(t),this._isUserHandleActive(this.activateTool.name)&&!this._drawingTool&&(this.activeTool=this.tools[this._toolToActivate]))))},_beginAutoScroll:function(n,t){var f=100,e=this,r=0,u=0,i=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),o=this._hScrollbar.model.maximum+i.width,s=this._vScrollbar.model.maximum+i.height;if(this._canAutoScroll){switch(n){case"right":(this._hScrollOffset+i.width+10<o||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(r=10);break;case"left":(this._hScrollOffset-10>this._hScrollbar.model.minimum||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(r=-10);break;case"bottom":(this._vScrollOffset+i.height+10<s||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(u=10);break;case"top":(this._vScrollOffset-10>this._vScrollbar.model.minimum||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(u=-10)}setTimeout(function(){e._raiseEvent("autoScrollChange",{delay:f});e._updateScrollBar(r,u,n,t)},f)}},_updateScrollBar:function(n,t,i,r){if(n===0&&t===0)this._canAutoScroll=!1;else if(this.activeTool.inAction){var u=this._hScrollOffset+n*this._currZoom,f=this._vScrollOffset+t*this._currZoom;this._updateSelectionOnScroll(n,t);this._updateScrollOffset(u,f);this._beginAutoScroll(i,r)}},_updateSelectionOnScroll:function(n,t){var i=this.activeTool,r,u,f,e;i.name==="select"?(i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._updateHelper()):i.name==="orthogonalLine"||i.name==="straightLine"?(i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._targetPossibleConnection=i._currentPossibleConnection,i._targetPort=i._possibleConnectionPort,i._updateHelper()):this.selectionList.length>0&&(r=this.selectionList[0],i.currentPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i.name==="move"?this._translate(r,n,t,this.nameTable):i.name==="resize"?(ej.datavisualization.Diagram.SnapUtil._removeGuidelines(diagram),i._updateSize(r,i.previousPoint,i.currentPoint,n,t)):i.name==="endPoint"&&(i.selectedSegment&&i._endPoint=="segmentEnd"?(u=i.currentPoint.x-i.previousPoint.x,f=i.currentPoint.y-i.previousPoint.y,i._updateAdjacentSegments(u,f)):(e=i._updatePoints(r),i._disconnect(r),i._updateConnection(r,e))),i.previousPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x,i.currentPoint.y),ej.datavisualization.Diagram.DiagramContext.update(r,this),this._updateSelectionHandle(),this._renderTooltip(r))},_isUserHandle:function(n){return n.target.parentNode.className.animVal==="userHandle"?!0:!1},_isUserHandleActive:function(n){var i=!1,t,r;if(this.model.userHandles&&this.model.userHandles.length>0)for(t=0,r=this.model.userHandles.length,t;t<r;t++)if(this.model.userHandles[t].name===n){i=!0;break}else i=!0;return i},_raiseMouseEvents:function(n){!n&&this._nodeToHit&&(this._raiseEvent("mouseLeave",{element:this._nodeToHit}),this._nodeToHit==null||!this._nodeToHit.shape||this.activeTool instanceof ej.datavisualization.Diagram.LineTool||this.activeTool._showPort(this._nodeToHit,!0));n?this._nodeToHit!==n&&(this._nodeToHit=n,this._raiseEvent("mouseEnter",{element:n})):this._nodeToHit=null;n&&this._raiseEvent("mouseOver",{element:n})},_isHandle:function(n){var t=$(n.target).parent("g.handle");return t.length>0?!0:!1},_findNodeUnderMouse:function(n){var r=null,t,i=$(n.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group");return i&&(t=i.attr("class"),t==="ej-d-node"||t==="ej-d-group"?r=this._findNode(i.attr("id")):t==="ej-d-connector"&&(r=this._findConnector(i.attr("id")))),r},_isForeignObject:function(n){var t=n.parentNode;if(t)while(t.parentNode!=null){if(t.className==="foreignObject")return t;t=t.parentNode}return null},_mouseup:function(n){var u,i,t,r,f;this._isPinching||this._invoke(n)&&(u=this._isForeignObject(n.originalEvent.target),u||n.preventDefault(),n.target.id===this._id+"_canvas_svg"&&this._raiseEvent("click",{element:this}),this.activeTool.mouseup(n),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(document.onmousemove=null,document.onmouseup=null),this._selectedSymbol&&(i={element:this.selectionList[0],cancel:!1},i.cancel===!0&&this._remove(i.element),t=this.selectionList[0],t&&(t.labels.length>0&&t.labels[0].mode==="edit"?(this._isEditing=!0,this.startLabelEdit(t,t.labels[0])):this.element[0].focus(),this._raiseDropEvent(i),this._raiseEvent("selectionChange",i)),r={},this.selectionList&&this.selectionList.length>0&&(r=this._getChildTable(this.selectionList[0],r)),f={type:"collectionchanged",object:jQuery.extend(!0,{},t),childTable:jQuery.extend(!0,{},r),changeType:"insert"},this.addHistoryEntry(f),this._selectedSymbol=null),this.activeTool instanceof ej.datavisualization.Diagram.PolygonTool||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||!document.activeElement||document.activeElement.id===this.element[0].id||this._isEditing||u||this.element[0].focus(),this._currentCursor=this.activeTool.cursor,this._updateCursor())},_doubleclick:function(n){var i,t;i={element:this._nodeToHit,cancel:!1,actualObject:this.activeTool.actualObject};this._isEditing||this._raiseEvent("doubleClick",i);this._nodeToHit&&this.activeTool._doubleClick(this._nodeToHit);this.activeTool.inAction||!(this.selectionList.length>0||this.activeTool.selectedObject)||i.cancel?this.activeTool instanceof ej.datavisualization.Diagram.PolygonTool&&this.activeTool.doubleclick(n):(t=this.activeTool.selectedObject?this.activeTool.selectedObject:this.selectionList[0],this._isEditing||t.isPseudoGroup||i.cancel||(!this._isEditing&&t.shape&&t.shape.type==="text"&&this._setLabelEditing(t.shape.textBlock)?(this.scrollToNode(t),this._startEdit(t)):!this._isEditing&&(t.labels.length===0||typeof t.labels.length=="undefined"||t.labels.length>0&&this._setLabelEditing(t.labels[0]))&&(this.scrollToNode(t),this._startEdit(t))))},_keydown:function(n){var t=n.keyCode?n.keyCode:n.which,i;t===113?this.selectionList.length>0&&(i=this.selectionList[0],i.isPseudoGroup||(i.shape.type==="text"&&this._setLabelEditing(i.shape.textBlock)?this._startEdit(i):i.labels.length>0&&this._setLabelEditing(i.labels[0])&&this._startEdit(i))):this._isEditing&&t===27?this._endEdit():this._isEditing||t!==46?!this._isEditing&&n.ctrlKey&&t===88?this.cut():!this._isEditing&&n.ctrlKey&&t===67?this.copy():!this._isEditing&&n.ctrlKey&&t===86?this.paste():n.ctrlKey&&t===65?(this._isEditing&&this._endEdit(),n.preventDefault(),this.selectAll()):!this._isEditing&&n.ctrlKey&&t===89?this.redo():!this._isEditing&&n.ctrlKey&&t===90&&this.undo():this._delete();this._isEditing||t!==37&&t!==38&&t!==39&&t!==40||(n.preventDefault(),t===37?n.shiftKey?this.nudge("left",5):this.nudge("left"):t===38?n.shiftKey?this.nudge("up",5):this.nudge("up"):t===39?n.shiftKey?this.nudge("right",5):this.nudge("right"):t===40&&(n.shiftKey?this.nudge("down",5):this.nudge("down")));this.activeTool.keydown(n)},_registerHistoryEvents:function(){this.historyManager.addEventHandler("collectionchanged",$.proxy(this._recordCollectionChanged,this));this.historyManager.addEventHandler("positionchanged",$.proxy(this._recordPinPointChanged,this));this.historyManager.addEventHandler("sizechanged",$.proxy(this._recordResizeChanged,this));this.historyManager.addEventHandler("rotationchanged",$.proxy(this._recordRotationChanged,this));this.historyManager.addEventHandler("endpointchanged",$.proxy(this._recordEndPointChanged,this));this.historyManager.addEventHandler("labelchanged",$.proxy(this._recordLabelChanged,this));this.historyManager.addEventHandler("groupingchanged",$.proxy(this._recordGroupChanged,this))},_updatePoints:function(n,t,i,r){var u=new ej.datavisualization.Diagram.Point(i.x-t.x,i.y-t.y);ej.datavisualization.Diagram.Geometry.isEmptyPoint(u)||n._updateEndPoint(u.x,u.y,r)},_recordCollectionChanged:function(n){var o,f,i,u,r,s,t,e;if(this._clearSelection(),this._isUndo=!0,o=n.changeType,n.isUndo&&(o=n.changeType=="insert"?"remove":"insert"),o=="insert")if(n.object.container){if(!n.object.container){for(t in n.childTable)s=n.childTable[t],this.nameTable[t]=s;i=n.object;i.isSwimlane?(i.width=0,i.height=0,this.add(i)):i.isLane&&(e=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(i,this),e&&(e.width=0,e.height=0,this.add(e)))}}else if(n.object.isPseudoGroup){for(delete this.nameTable.multipleSelection,r=ej.datavisualization.Diagram.Group({name:"multipleSelection",isPseudoGroup:!0}),t=0;t<n.object.children.length;t++)r.children.push(n.object.children[t]),i=n.childTable[n.object.children[t]],i.parent="",i.isGroup&&this._addChildren(i,n.childTable),this.add(n.childTable[n.object.children[t]],n);for(this._addGroupConnector(n.object,n),t=0;t<r.children.length;t++)if(i=this.nameTable[r.children[t]],!i.segments){if(i.inEdges.length>0)for(u=0;u<i.inEdges.length;u++)this.nameTable[i.inEdges[u]].targetNode=i.name;if(i.outEdges.length>0)for(u=0;u<i.outEdges.length;u++)this.nameTable[i.outEdges[u]].sourceNode=i.name}this._clearSelection();this.model.nodes.push(r);r.offsetX=n.object.offsetX;r.offsetY=n.object.offsetY;r.height=n.object.height;r.width=n.object.width;r.rotateAngle=n.object.rotateAngle;this.addSelection(r);this.nameTable[r.name]=r}else{if(!n.object.segments){if(f=null,n.object.inEdges.length>0)for(t=0;t<n.object.inEdges.length;t++)this.nameTable[n.object.inEdges[t]]&&(this.nameTable[n.object.inEdges[t]].targetNode=n.object.name),f=n.targetPorts[n.object.inEdges[t]],f&&this.nameTable[n.object.inEdges[t]]&&(this.nameTable[n.object.inEdges[t]].targetPort=f);if(n.object.outEdges.length>0)for(t=0;t<n.object.outEdges.length;t++)this.nameTable[n.object.outEdges[t]]&&(this.nameTable[n.object.outEdges[t]].sourceNode=n.object.name),f=n.sourcePorts[n.object.outEdges[t]],f&&this.nameTable[n.object.outEdges[t]]&&(this.nameTable[n.object.outEdges[t]].sourcePort=f)}n.object.isGroup&&this._addChildren(n.object,n.childTable);this.add(n.object,n);n.object.isGroup?this._addGroupConnector(n.object,n):this._addConnector(n.object,n);this._clearSelection();this.addSelection(n.object)}else if(o=="remove")if(n.object.isPseudoGroup)for(t=0;t<n.object.children.length;t++)this._remove(this.nameTable[n.object.children[t]]);else this._remove(n.object);this._isUndo=!1},_addGroupConnector:function(n,t){var r,f,e,i,o,u;if(!n.segments)for(e=0;e<n.children.length;e++){if(u=this.nameTable[n.children[e]],u.inEdges&&u.inEdges.length>0)for(r=u.inEdges,i=0,o=r.length;i<o;i++)f=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],f&&this.add(f);if(u.outEdges&&u.outEdges.length>0)for(r=u.outEdges,i=0,o=r.length;i<o;i++)f=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],f&&this.add(f)}},_addConnector:function(n,t){var r,u,i,f;if(!n.segments){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=0,f=r.length;i<f;i++)u=t.edgeTable[r[i]],this.add(u);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,f=r.length;i<f;i++)u=t.edgeTable[r[i]],this.add(u)}},_addChildren:function(n,t){for(var r,i=0;i<n.children.length;i++)r=t[n.children[i]],r.isGroup?this._addChildren(r,t):this.nameTable[n.children[i]]=r},_updateRecordPinPoint:function(n,t,i){var r,o,u,h,s,c,f,e;if(n.isPseudoGroup){for(s=n,o=0;o<n.children.length;o++)u=this.nameTable[n.children[o]],h=t[n.children[o]],h&&(u.segments?(c=t[u.name],u.sourcePoint=c.sourcePoint,u.targetPoint=c.targetPoint,u.segments=c.segments):this._translate(u,h.offsetX-u.offsetX,h.offsetY-u.offsetY,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(u,this));this.selectionList[0]&&this.selectionList[0].name===s.name&&(this.selectionList[0].offsetX=s.offsetX,this.selectionList[0].offsetY=s.offsetY);ej.datavisualization.Diagram.SvgContext.updateSelector(s,this._svg,this._currZoom,this,this.model.selectorConstraints)}else n.segments?i?(r=t[n.name],n.sourcePoint=r.sourcePoint,n.targetPoint=r.targetPoint,n.segments=r.segments,ej.datavisualization.Diagram.DiagramContext.update(n,this)):(this._clearSelection(),r=this._findConnector(n.name),n.targetNode&&(f=this.nameTable[n.targetNode],ej.datavisualization.Diagram.Util.removeItem(f.inEdges,n)),n.sourceNode&&(f=this.nameTable[n.sourceNode],ej.datavisualization.Diagram.Util.removeItem(f.outEdges,n)),n.targetNode&&(f=this.nameTable[n.targetNode],f.inEdges.push(n.name)),n.sourceNode&&(f=this.nameTable[n.sourceNode],f.outEdges.push(n.name)),r.targetNode=n.targetNode,r.sourceNode=n.sourceNode,r.targetPort=n.targetPort,r.sourcePort=n.sourcePort,r.sourcePoint=n.sourcePoint,r.targetPoint=n.targetPoint,r.segments=n.segments,this._updateLabels(r,n.labels),ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._svg,this._currZoom,this,this.model.selectorConstraints),this.addSelection(n)):i?(r=t[n.name],this._translate(n,r.offsetX-n.offsetX,r.offsetY-n.offsetY,t),ej.datavisualization.Diagram.DiagramContext.update(r,this)):(this._clearSelection(),r=this._findNode(n.name),this._translate(r,n.offsetX-r.offsetX,n.offsetY-r.offsetY,this.nameTable),this._updateLabels(r,n.labels),n.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[r.parent],this.nameTable),r.parent&&(e=this.nameTable[r.parent],e&&e.container&&(e.container.type=="canvas"?ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(e,this):e.container.type=="stack"&&ej.datavisualization.Diagram.SvgContext._alignOnStack(e,this))),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r))},_updateLabels:function(n,t){n.labels=t;for(var i=0;i<n.labels.length;i++)ej.datavisualization.Diagram.DiagramContext.updateLabel(n,n.labels[i],this)},_recordPinPointChanged:function(n){var t=n.object.node,i=n.object.childTable;t.container||this._updateRecordPinPoint(t,i)},_updateRecordRotation:function(n,t){var r,f,i,e,o,s,u;if(n.isPseudoGroup){for(r=this.nameTable[n.name],f=0;f<n.children.length;f++)i=this.nameTable[n.children[f]],e=t[n.children[f]],i&&(i.segments?(o=t[i.name],i.sourcePoint=o.sourcePoint,i.targetPoint=o.targetPoint,i.segments=o.segments):e&&(this._translate(i,e.offsetX-i.offsetX,e.offsetY-i.offsetY,this.nameTable),this._rotate(i,e.rotateAngle-i.rotateAngle,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(i,this));r&&(s=n.rotateAngle-r.rotateAngle,r.rotateAngle+=s,this.selectionList[0]&&(this.selectionList[0].rotateAngle=r.rotateAngle));ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._svg,this._currZoom,this,this.model.selectorConstraints)}else u=null,n.parent&&(u=this.nameTable[n.parent]),u&&u.container?u.container.type=="canvas"?ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this):u.container.type=="stack"&&ej.datavisualization.Diagram.SvgContext._alignOnStack(u,this):n&&(this._clearSelection(),r=this._findNode(n.name),this._rotate(r,n.rotateAngle-r.rotateAngle,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r))},_recordSizeChanged:function(n){var t=n.object.node,i=n.object.childTable;t.container||this._updateRecordSize(t,i)},_updateRecordSize:function(n,t){var i,e,f,r,o,u;if(n.isGroup||n.isPseudoGroup){for(n.isPseudoGroup&&(this.nameTable[n.name]=n),i=this._findNode(n.name),e=0;e<i.children.length;e++)r=this.nameTable[n.children[e]],f=t[n.children[e]],f&&(r.segments?(o=t[r.name],r.sourcePoint=o.sourcePoint,r.targetPoint=o.targetPoint,r.segments=o.segments,ej.datavisualization.Diagram.DiagramContext.update(r,this)):(this._translate(r,f.offsetX-r.offsetX,f.offsetY-r.offsetY,this.nameTable),this.scale(r,f.width/r.width,f.height/r.height,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this)));i.offsetX=n.offsetX;i.offsetY=n.offsetY;i.width=n.width;i.height=n.height;ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectorConstraints)}else u=null,n.parent&&(u=this.nameTable[n.parent]),u&&u.container?u.container.type=="canvas"?ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this):u.container.type=="stack"&&ej.datavisualization.Diagram.SvgContext._alignOnStack(u,this):n.segments||(i=this._findNode(n.name),this._translate(i,n.offsetX-i.offsetX,n.offsetY-i.offsetY,this.nameTable),this.scale(i,n.width/i.width,n.height/i.height,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._svg,this._currZoom,this,this.model.selectorConstraints))},_recordRotationChanged:function(n){var t=n.object.node,i=n.object.childTable;t.container||this._updateRecordRotation(t,i)},_recordEndPointChanged:function(n){var t,i,r,u;n._isUndo?(t=i=n.undoObject,r=n.redoObject):(t=i=n.redoObject,r=n.undoObject);t=t.parent?this._findChildren(t.parent,t.name):this._findConnector(t.name);r.targetNode&&(u=this.nameTable[r.targetNode],ej.datavisualization.Diagram.Util.removeItem(u.inEdges,r));r.sourceNode&&(u=this.nameTable[r.sourceNode],ej.datavisualization.Diagram.Util.removeItem(u.outEdges,r));i.targetNode&&(u=this.nameTable[i.targetNode],u.inEdges.push(i.name));i.sourceNode&&(u=this.nameTable[i.sourceNode],u.outEdges.push(i.name));t.targetNode=i.targetNode;t.sourceNode=i.sourceNode;t.targetPort=i.targetPort;t.sourcePort=i.sourcePort;t.sourcePoint=i.sourcePoint;t.targetPoint=i.targetPoint;t.segments=i.segments;this._updateEdges(t);this._dock(t,this.nameTable);ej.datavisualization.Diagram.Util._updateConnectorSegments(t,t.sourcePort,t.targetPort,this);ej.datavisualization.Diagram.DiagramContext._refreshSegments(t,this);ej.datavisualization.Diagram.DiagramContext.update(t,this);this._updateSelectionHandle();this.selectionList[0]&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._svg,this.model.zoomFactor);ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._svg,this._currZoom,this,this.model.selectorConstraints)},_recordLabelChanged:function(n){var t=this.nameTable[n.object.name];n.object.shape&&n.object.shape.type==="text"?(t.shape.textBlock.text=n.label,ej.datavisualization.Diagram.DiagramContext.updateTextBlock(t,t.shape.textBlock,this)):(t.labels[0].text=n.label,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,t.labels[0],this))},_recordGroupChanged:function(n){var o,u,f,t,e,i,r;if(this._clearSelection(),o=n.actionType,n.isUndo&&(n.actionType==="group"&&(o="ungroup"),n.actionType==="ungroup"&&(o="group")),u=n.object.children,o==="group"){for(f=new ej.datavisualization.Diagram.Group({name:n.object.name}),t=0;t<u.length;t++)f.children.push(u[t]),this.nameTable[u[t]].parent=f.name,i=this._svg.document.getElementById(u[t]),i&&i.parentNode.removeChild(i);this.add(f);this._addSelection(f)}else{for(e=n.object,i=this._svg.document.getElementById(e.name),i&&i.parentNode.removeChild(i),t=0;t<e.children.length;t++)r=this.nameTable[e.children[t]],r.parent="",this._isUndo=!0,r.segments?ej.datavisualization.Diagram.DiagramContext.renderConnector(r,this):r.isGroup?ej.datavisualization.Diagram.DiagramContext.renderGroup(r,this):ej.datavisualization.Diagram.DiagramContext.renderNode(r,this),this._isUndo=!1;ej.datavisualization.Diagram.Util.removeItem(this.model.nodes,this._findNode(e.name))}},_svgdrop:function(n,t){var u={},e=n.originalEvent,i,w,f,r,c;e.preventDefault?e.preventDefault():e.returnValue=!1;var l=this._currZoom,a=$("#"+this.element[0].id).offset(),o=this._isTouchEvent(n),s,h;o?(s=o.pageX,h=o.pageY):(s=n.pageX,h=n.pageY);var v=s+this._hScrollOffset-a.left,y=h+this._vScrollOffset-a.top,p=t.helper[0].getAttribute("paletteId"),b=$("#"+p).ejSymbolPalette("instance");if(p){if(i=$.extend(!0,{},this._selectedSymbol),this._selectedSymbol=null,i.name+=ej.datavisualization.Diagram.Util.randomId(),i.segments)i.segments&&ej.datavisualization.Diagram.Util._translateLine(i,v,y),u={element:i},this._raiseDropEvent(u),u.cancel||this.add(i),i=this.selectionList[0];else{if(w=$.extend(!0,{},b.nameTable),i.offsetX=v/l,i.offsetY=y/l,i.isGroup){for(f=0;f<i.children.length;f++)r=$.extend(!0,{},w[i.children[f]]),r.parent=i.name,r.name=i.name+r.name,i.children[f]=r.name,this.nameTable[r.name]=r,this.model.nodes.push(r),ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,r);i.height=i.width=0;this._updateChildBounds(i,this.nameTable)}u={element:i};this._raiseDropEvent(u);u.cancel||this.add(i);i=this.selectionList[0]}this.scrollToNode(i);i.labels.length>0&&i.labels[0].mode==="edit"?(this._isEditing=!0,this.startLabelEdit(i,i.labels[0])):this.element[0].focus()}else c=null,c=this._findNodeUnderMouse(n),u={element:t.helper,e:n,draggable:t.draggable,targetNode:c},this._raiseDropEvent(u)},_isTouchEvent:function(n){return n.type=="touchmove"||n.type=="touchstart"||n.type=="touchend"?n.originalEvent?n.originalEvent.changedTouches[0]:n.changedTouches[0]:n},_raiseDropEvent:function(n){this._raiseEvent("drop",n)},_documentmouseup:function(n){if(!this.activeTool||!this.activeTool.inAction||this.activeTool instanceof ej.datavisualization.Diagram.PolygonTool||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||this.activeTool.mouseup(n,!0),this._selectedSymbol){var t=document.getElementsByClassName("dragClone")[0];t!=null&&(t.style.display="block");this._remove(this.selectionList[0])}},_updateEdges:function(n){var t;ej.datavisualization.Diagram.Util.isTargetConnected(n)&&(t=this.nameTable[n.targetNode],t&&t.inEdges.indexOf(n.name)==-1&&t.inEdges.push(n.name));ej.datavisualization.Diagram.Util.isSourceConnected(n)&&(t=this.nameTable[n.sourceNode],t&&t.outEdges.indexOf(n.name)==-1&&t.outEdges.push(n.name))},_updateChildrenEdges:function(n){for(var t,i=0;i<n.children.length;i++)t=n.children[i],t.segments?(this._updateEdges(t),this._dock(t,this.nameTable)):t.isGroup&&this._updateChildrenEdges(t)},_updateParent:function(n){for(var t,i=0;i<n.children.length;i++)t=this._getNewNode(this.nameTable[n.children[i]]),t&&t.isGroup?this._updateParent(t):t&&(t.parent=n.name,this.nameTable[t.name]=t)},_findPortAtPoint:function(n,t){var f,i,s,e,r,h,c,l,o,u,a;if(t)for(l=ej.datavisualization.Diagram.Util.bounds(t,!0),f=t.ports,u=0,a=f.length;u<a;++u)if(i=f[u],e=ej.datavisualization.Diagram.Size(i.size,i.size),r=ej.datavisualization.Diagram.Util._getPortPosition(i,l),o=ej.Matrix.identity(),ej.Matrix.rotate(o,t.rotateAngle,t.offsetX,t.offsetY),r=ej.Matrix.transform(o,r),h=r.x-i.size/2,c=r.y-i.size/2,s=ej.datavisualization.Diagram.Rectangle(h,c,e.width,e.height),ej.datavisualization.Diagram.Geometry.containsPoint(s,n))return i;return null},_findLabelAtPoint:function(n,t){var f,u=null,c,e,i,l,a,v,y,r,o,s,h,p;if(t&&(r=ej.datavisualization.Diagram.Util.bounds(t),f=t.labels,f.length>0))for(u=f[0],h=0,p=f.length;h<p;h++)if(u=f[h],o=this._svg.getElementById(t.name+"_"+u.name).getBBox(),v=o.width==0?r.width:o.width,y=o.height==0?u.fontSize:o.height,e=ej.datavisualization.Diagram.Size(v,y),i=ej.datavisualization.Diagram.Util._getLabelPosition(u,r),i.x=r.x+i.x,i.y=r.y+i.y,s=ej.Matrix.identity(),t.segments?ej.Matrix.rotate(s,0,r.x+r.width/2,r.y+r.height/2):ej.Matrix.rotate(s,t.rotateAngle,t.offsetX,t.offsetY),i=ej.Matrix.transform(s,i),l=i.x-e.width/2,a=i.y-e.height/2,c=ej.datavisualization.Diagram.Rectangle(l,a,e.width,e.height),ej.datavisualization.Diagram.Geometry.containsPoint(c,n))break;return u},_getCurrentZoom:function(){return this._currZoom},_findNode:function(n){return this.nameTable[n]},_findPort:function(n,t){for(var r=n.ports,i=0,u=r.length;i<u;i++)if(r[i].name===t)return r[i];return null},_findConnector:function(n){return this.nameTable[n]},_findChildren:function(n,t){for(var i,r,u=0;u<n.children.length;u++)if(i=this.nameTable[n.children[u]],i){if(t==i.name)return i;if(i.isGroup&&(r=this._findChildren(i,t),r))return r}return null},_delete:function(){var u,f,o,s,t,e,l,i,h,n,r,c;if(this.selectionList[0]){if(u={},f={},u=this._getChildTable(this.selectionList[0],u),f=this._getEdgeTable(this.selectionList[0],f),!this._isUndo){if(o={},s={},!this.selectionList[0].segments){if(this.selectionList[0].outEdges.length>0)for(e=this.selectionList[0].outEdges.length,n=0;n<e;n++)t=this.nameTable[this.selectionList[0].outEdges[n]],t.sourcePort&&(o[t.name]=t.sourcePort);if(this.selectionList[0].inEdges.length>0)for(e=this.selectionList[0].inEdges.length,n=0;n<e;n++)t=this.nameTable[this.selectionList[0].inEdges[n]],t.targetPort&&(s[t.name]=t.targetPort)}l={type:"collectionchanged",object:jQuery.extend(!0,{},this.selectionList[0]),childTable:jQuery.extend(!0,{},u),edgeTable:jQuery.extend(!0,{},f),sourcePorts:o,targetPorts:s,changeType:"remove"};this.addHistoryEntry(l)}if(this.selectionList.length>0)if(i=this.selectionList[0],i.isPseudoGroup){for(h=i.children,n=h.length-1;n>=0;n--)this._remove(this.nameTable[h[n]]),this._isUndo=!0;this._isUndo=!1}else this._nodeToHit===i&&(this._nodeToHit=null),this._remove(i),i.container&&i.parent&&(r=this.nameTable[i.parent],r&&r.container&&r.container.type=="stack"&&(r.children[0]?(this.tools.move._updateContainer(this.nameTable[r.children[0]]),ej.datavisualization.Diagram.DiagramContext.update(r,this)):(c=this.nameTable[r.parent],c&&this._remove(c))));this._clearSelection()}},_getEdgeTable:function(n,t){var r,f,o,i,u,e,s;if(!n.segments)if(n.isGroup)for(o=0;o<n.children.length;o++){if(e=this.nameTable[n.children[o]],e.inEdges&&e.inEdges.length>0)for(r=e.inEdges,i=0,f=r.length;i<f;i++)u=this.nameTable[r[i]],s=t[u.name]=$.extend(!0,{},u);if(e.outEdges&&e.outEdges.length>0)for(r=e.outEdges,i=0,f=r.length;i<f;i++)u=this.nameTable[r[i]],s=t[u.name]=$.extend(!0,{},u)}else{if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=0,f=r.length;i<f;i++)u=this.nameTable[r[i]],s=t[u.name]=$.extend(!0,{},u);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,f=r.length;i<f;i++)u=this.nameTable[r[i]],s=t[u.name]=$.extend(!0,{},u)}return t},_remove:function(n,t){var e,t,r,o,u,i,f;n&&(e=n.segments?"connector":"node",t=t?ej.datavisualization.Diagram.dependentconnector.dependent:ej.datavisualization.Diagram.dependentconnector.independent,r={changeType:"remove",element:n,cancel:!1,dependent:t},this._raiseEvent(e+"CollectionChange",r),r.cancel||ej.datavisualization.Diagram.Util.canDelete(n)&&(o=n.name,n.segments?(this._removeEdges(n),n.sourceNode=n.sourcePort=n.targetNode=n.targetPort=null,ej.datavisualization.Diagram.Util.removeItem(this.model.connectors,this.nameTable[n.name])):(this._disConnect(n),n.isGroup||this._removeConnector(n,r),ej.datavisualization.Diagram.Util.removeItem(this.model.nodes,this.nameTable[n.name])),(n.shape||n.segments)&&(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,n)),n.parent&&(u=this.nameTable[n.parent],u&&u.isGroup&&(ej.datavisualization.Diagram.Util.removeItem(u.children,n.name),ej.datavisualization.Diagram.Util._updateGroupBounds(u,this.nameTable))),delete this.nameTable[o],i=this._svg.getElementById(n.name),ej.browserInfo().name==="msie"&&(n.shape&&n.shape.html&&i?(f=document.getElementById(n.name+"_parentdiv"),f.parentNode.removeChild(f)):n.isGroup&&this._checkForHtmlNode(n)),n.isGroup&&!n.isPseudoGroup&&this._removeChildren(n,r),this._removeElement(n),n.isGroup&&n.container&&ej.datavisualization.Diagram.SvgContext._removephases(n,this),i&&i.parentNode&&i.parentNode.removeChild(i),this.selectionList[0]&&this._clearSelection()))},_removeConnector:function(n){var i,t,r;if(!n.segments){if(this.model.deleteDependent&&!this.model.adjustDependent){if(n.inEdges&&n.inEdges.length>0)for(i=n.inEdges,t=i.length-1;t>=0;t--)this._updateConnection(this.nameTable[i[t]],!0);if(n.outEdges&&n.outEdges.length>0)for(i=n.outEdges,t=0,r=i.length;t<r;t++)this._updateConnection(this.nameTable[i[t]],!0)}if(this.model.deleteDependent&&this.model.adjustDependent)if(n.inEdges&&n.inEdges.length==0&&n.outEdges.length>0)for(i=n.outEdges,t=i.length-1;t>=0;t--)this._updateConnection(this.nameTable[i[t]],!0);else if(n.outEdges&&n.outEdges.length==0&&n.inEdges.length>0)for(i=n.inEdges,t=i.length-1;t>=0;t--)this.nameTable[i[t]]&&this._updateConnection(this.nameTable[i[t]],!0);else if((n.inEdges&&n.inEdges.length==1||n.inEdges.length>1)&&n.outEdges.length==1)for(i=n.outEdges,t=0,r=i.length;t<r;t++)this._updateConnection(this.nameTable[i[t]],!0);else if(!(n.inEdges&&n.inEdges.length>1&&n.outEdges.length>1))for(i=n.inEdges,t=0,r=i.length;t<r;t++)this._updateConnection(this.nameTable[i[t]],!0)}},_updateConnection:function(n,t){this._remove(n,t);this.updateConnector(n.name)},_removeElement:function(n){for(var i,t=1;t<this._views.length;t++)i=this._views[t],this._views[i].context.removeChild(n,this._views[i])},_disConnect:function(n){var i,r,e,o,s,h,t,u,f,c;if(this.model.deleteDependent&&this.model.adjustDependent){if(n.inEdges&&n.inEdges.length>0&&n.outEdges.length>0)if(i=n.inEdges,r=n.outEdges,(n.inEdges.length>1||n.inEdges.length==1)&&n.outEdges.length==1){for(t=0,f=i.length;t<f;t++)this.nameTable[i[t]].targetNode==this.nameTable[r[0]].sourceNode&&(s=this.nameTable[this.nameTable[r[0]].targetNode],h=$.extend(!0,{},s),this.nameTable[i[t]].targetNode=this.nameTable[r[0]].targetNode,this.nameTable[i[t]].targetPort=this.nameTable[r[0]].targetPort,s.inEdges[t]=this.nameTable[i[t]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[i[t]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[i[t]],this));this.nameTable[r[0]].sourceNode=null;this.nameTable[r[0]].sourcePort=null}else if(!(n.inEdges.length>1&&n.outEdges.length>1))for(t=0,f=i.length;t<f;t++)if(n.outEdges.length>0){for(o=this.nameTable[this.nameTable[i[t]].sourceNode],h=$.extend(!0,{},o),u=0,c=r.length;u<c;u++)this.nameTable[i[t]].targetNode==this.nameTable[r[u]].sourceNode&&(this.nameTable[r[u]].sourceNode=this.nameTable[i[t]].sourceNode,this.nameTable[r[u]].sourcePort=this.nameTable[i[t]].sourcePort,o.outEdges[h.outEdges.length+u]=this.nameTable[r[u]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[r[u]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[r[u]],this));this.nameTable[i[t]].targetNode=null;this.nameTable[i[t]].targetPort=null}}else{if(n.inEdges&&n.inEdges.length>0)for(i=n.inEdges,t=0,f=i.length;t<f;t++)e=this.nameTable[i[t]],e.targetNode=null,e.targetPort=null;if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,t=0,f=r.length;t<f;t++)e=this.nameTable[r[t]],e.sourceNode=null,e.sourcePort=null}},_removeEdges:function(n){n.targetNode&&this.nameTable[n.targetNode]&&this.nameTable[n.targetNode].inEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.targetNode].inEdges,n.name);n.sourceNode&&this.nameTable[n.sourceNode]&&this.nameTable[n.sourceNode].outEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.sourceNode].outEdges,n.name)},_selectionContains:function(n){if(this._hasSelection()&&n)for(var t=0;t<this.selectionList.length;t++)if(n.name===this.selectionList[t].name)return!0;return!1},_addSelection:function(n){var t,i;n&&ej.datavisualization.Diagram.Util.canSelect(n)&&(this._selectionContains(n)||(this.selectionList.push(n),t={changeType:"insert",element:n,cancel:!1},this._selectedSymbol||this._raiseEvent("selectionChange",t),t.cancel?ej.datavisualization.Diagram.Util.removeItem(this.selectionList,n):(ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._svg,this._adornerLayer,this._currZoom,this.model.selectorConstraints),this.model.userHandles!==null&&this.model.userHandles.length>0&&(i=!1,n.isPseudoGroup&&(i=!0),this.model.selectorConstraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.userHandles,n,this._svg,i,this._currZoom,this._adornerLayer)))))},_raiseEvent:function(n,t){return t.elementType=this._getElementType(t.element),this._trigger(n,t)},_clearSelection:function(){this._isEditing&&this.selectionList.length>0&&this._endEdit();var n={changeType:"remove",element:this.selectionList,cancel:!1};this._selectedSymbol||this._raiseEvent("selectionChange",n);n.cancel||(this.selectionList[0]&&this.selectionList[0].isPseudoGroup&&(ej.datavisualization.Diagram.Util.removeItem(this.model.nodes,this.selectionList[0]),delete this.nameTable[this.selectionList[0].name]),ej.datavisualization.Diagram.Util.clear(this.selectionList),ej.datavisualization.Diagram.SvgContext.clearSelector(this._svg,this._adornerLayer))},_updateSelectionHandle:function(n){var t,i;this.selectionList.length>0&&(t=this.nameTable[this.selectionList[0].name],ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._svg,this._currZoom,this,this.model.selectorConstraints),this.model.userHandles!==null&&this.model.userHandles.length>0&&(i=!1,t.isPseudoGroup&&(i=!0),this.model.selectorConstraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.userHandles,t,this._svg,i,n,this._currZoom)))},_hasSelection:function(){return this.selectionList.length>0},_checkToolToActivate:function(n,t,i){var r=!1;return t?((t.segments&&n.ctrlKey&&n.shiftKey||n.ctrlKey&&n.altKey)&&(this._toolToActivate="endPoint",this._currentCursor="move",r=!0),r||(this._selectionContains(t)?(t.segments?r=this._canActivateEndPointTool(n,t,i):(r=this._canActivateResizeTool(n,t,i),r||(r=this._canActivateRotateTool(n,t,i))),r||(r=this._canActivateUserHandle(n,t,i)),r||(r=this._canActivateMoveTool(n,t,i)),r||(r=this._canActivatephaseTool(n,i))):r=this._canActivateMoveTool(n,t,i))):r=this._canActivatephaseTool(n,i),r||(this.model.tool&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this._currentCursor="pointer"):(this._toolToActivate="select",this._currentCursor="default")),this._toolToActivate!="rotate"&&this._svg.document.removeAttribute("class"),r},_canActivatephaseTool:function(n){if($(n.target).parents("g").first()[0]){var i=$(n.target).parents("g").first()[0].id,t=this._getSeperetor(i);return this._currentCursor=t?t.orientation=="horizontal"?"e-resize":"n-resize":"default",this._toolToActivate="phase",!0}},_canActivateUserHandle:function(n){if(this._isUserHandle(n)){var t=$(n.target).parents("g").first().context.id.split("_")[0];return this._toolToActivate=t,this._currentCursor=this.tools[this._toolToActivate].cursor,!0}return!1},_canActivateEndPointTool:function(n,t){if(t){var i=n.target.getAttribute("class");if(i&&(i==="targetEndPoint"&&ej.datavisualization.Diagram.Util.canDragTargetEnd(t)||i==="sourceEndPoint"&&ej.datavisualization.Diagram.Util.canDragSourceEnd(t)||i.match("bezierpoint")&&ej.datavisualization.Diagram.Util.canDragSegmentThumbs(t)||i=="segmentEnd"))return this._toolToActivate="endPoint",this._currentCursor="move",!0}return!1},_canActivateResizeTool:function(n,t){if(ej.datavisualization.Diagram.Util.canResize(t)&&this.model.selectorConstraints&ej.datavisualization.Diagram.SelectorConstraints.Resizer){var i=n.target.getAttribute("class");if(i==="nw-resize"||i==="n-resize"||i==="ne-resize"||i==="w-resize"||i==="e-resize"||i==="sw-resize"||i==="s-resize"||i==="se-resize")return this._toolToActivate="resize",t.rotateAngle>=0&&t.rotateAngle<25||t.rotateAngle>=160&&t.rotateAngle<=200||t.rotateAngle>=340&&t.rotateAngle<=360?this._currentCursor=i:t.rotateAngle>=25&&t.rotateAngle<=65||t.rotateAngle>=205&&t.rotateAngle<=240?this._currentCursor=i==="n-resize"||i==="s-resize"?"ne-resize":i==="nw-resize"||i==="se-resize"?"n-resize":i==="e-resize"||i==="w-resize"?"nw-resize":"e-resize":t.rotateAngle>=70&&t.rotateAngle<=110||t.rotateAngle>=250&&t.rotateAngle<=290?this._currentCursor=i==="n-resize"||i==="s-resize"?"e-resize":i==="nw-resize"||i==="se-resize"?"ne-resize":i==="e-resize"||i==="w-resize"?"n-resize":"nw-resize":(t.rotateAngle>=115&&t.rotateAngle<=155||t.rotateAngle>=295&&t.rotateAngle<=335)&&(this._currentCursor=i==="n-resize"||i==="s-resize"?"nw-resize":i==="nw-resize"||i==="se-resize"?"e-resize":i==="e-resize"||i==="w-resize"?"ne-resize":"n-resize"),!0}return!1},_canActivateMoveTool:function(n,t){var u=this._findNodeUnderMouse(n),i,r;if(u&&u.name===t.name){if(i=!0,t.parent&&(i=this.selectionList.length>0&&this._selectionContains(t)?!0:!1),i&&ej.datavisualization.Diagram.Util.canMoveLabel(t)&&(r=n.target.id.split("_"),r[r.length-1]=="lblbg"))return this._toolToActivate="move",this._currentCursor="pointer",!0;if(ej.datavisualization.Diagram.Util.canMove(t))return this._toolToActivate="move",this._currentCursor=this.selectionList.length>0&&(this._selectionContains(t)||this.selectionList[0].children&&this._findChildren(this.selectionList[0],t.name))?"move":"default",!0}return!1},_canActivateRotateTool:function(n,t){if(ej.datavisualization.Diagram.Util.canRotate(t)&&this.model.selectorConstraints&ej.datavisualization.Diagram.SelectorConstraints.Rotator){var i=n.target.getAttribute("class");if(i==="rotate")return this._toolToActivate="rotate",this._svg.document.setAttribute("class","svg-rotate"),this._currentCursor="",!0}return!1},_canActivatePivotTool:function(n){var t=n.target.getAttribute("class");return t==="pivot"?(this._toolToActivate="pivot",this._currentCursor="default",!0):!1},_updateCursor:function(){this._svg.document.style.cursor=this._currentCursor},_getResizeCursor:function(n){var t="default";switch(n){case"topleft":t="nw-resize";break;case"topcenter":t="n-resize";break;case"topright":t="ne-resize";break;case"middleleft":t="w-resize";break;case"middleright":t="e-resize";break;case"bottomleft":t="sw-resize";break;case"bottomcenter":t="s-resize";break;case"bottomright":t="se-resize"}return t},_startEdit:function(n){var i,f,e,r,o,t,u,c=ej.Matrix.identity(),l,a,h,s;ej.Matrix.rotate(c,n.rotateAngle,n.width/2,n.height/2);n.shape&&n.shape.type==="text"?(r=this._svg.getElementById(n.name+"_shape")!==null?this._svg.getElementById(n.name+"_shape").getBBox():{x:n.offsetX-n.width/2,y:n.offsetY-n.height/2,width:n.width,height:n.height},i=n.shape.textBlock,i&&(o=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(r.x-i.fontSize,r.y-i.fontSize,r.width+i.fontSize/2,r.height+i.fontSize/2),u=this._currZoom,s=ej.Matrix.transform(c,ej.datavisualization.Diagram.Util._getLabelPosition(i,o)),f=n.offsetX-n.width/2+s.x,e=n.offsetY-n.height/2+s.y,i.horizontalAlignment=="left"?f+=r.width/2:i.horizontalAlignment=="right"&&(f-=r.width/2),i.verticalAlignment=="top"?e+=r.height/2:i.verticalAlignment=="bottom"&&(e-=r.height/2),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),t.width=r.width==0?50:o.width*u,t.x=f*u-t.width/2*u-this._hScrollOffset,t.height=i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.width=50,t.height=i.fontSize,t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0)):(n.labels.length>0?this.activeTool.name==="textTool"?(i=this.activeTool.getLabelUnderMouse(),i&&(i=n.labels[0])):i=n.labels[0]:(l=this._findNode(n.name),i=new ej.datavisualization.Diagram.Label({name:"label"+ej.datavisualization.Diagram.Util.randomId()}),n.labels.push(i),a=l!==n?l:null,ej.datavisualization.Diagram.DiagramContext.addNodeLabel(n,i,a,this),this.activeTool.name==="textTool"&&(this.activateTool.activeLabel=i)),i&&!i.readOnly&&(r=this._svg.getElementById(n.name+"_"+i.name).getBBox(),o=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(r.x,r.y,r.width,r.height),u=this._currZoom,h=ej.datavisualization.Diagram.Util._getLabelPosition(i,o),n.segments?(f=o.x+h.x,e=o.y+h.y):(s=ej.Matrix.transform(c,h),f=n.offsetX-n.width/2+s.x,e=n.offsetY-n.height/2+s.y,i.horizontalAlignment=="left"?f+=r.width/2:i.horizontalAlignment=="right"&&(f-=r.width/2),i.verticalAlignment=="top"?e+=r.height/2:i.verticalAlignment=="bottom"&&(e-=r.height/2)),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),n.shape?(t.width=r.width<50?50:o.width*u,t.x=f*u-t.width/2-this._hScrollOffset):(t.width=r.width<50?50:o.width*u,t.x=f*u-t.width/2*u-this._hScrollOffset),t.height=i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0))},_createEditBox:function(n,t,i,r,u,f){var s=ej.datavisualization.Diagram.Util.bounds(f),o=document.createElement("div"),h={id:this.element[0].id+"_editBoxDiv","class":"edit",style:"top:"+i+"px;left:"+t+"px;width:"+r+"px;height:"+u+"px;font-family:"+n.fontFamily+";font-size:"+n.fontSize+"px;min-width: 50px;min-height:"+n.fontSize+"px;"},e;ej.datavisualization.Diagram.Util.attr(o,h);e=document.createElement("textarea");h={id:this.element[0].id+"_editBox","class":"editBox",style:"font-size:"+n.fontSize+"px;font-family:"+n.fontFamily+";min-height:"+n.fontSize+"px;line-height:"+n.fontSize+"px;",nodeWidth:s.width,nodeHeight:s.height,fontSize:n.fontSize,nodeOffsetX:f.offsetX,nodeOffsetY:f.offsetY,containerName:f.name};ej.datavisualization.Diagram.Util.attr(e,h);e.value=n.text;o.appendChild(e);$(this._canvas).append(o);n.text!==""&&this._updateEditor(null,o,e,s.width,n.fontSize);this._on($(e),"focusout",this._editboxfocusout);this._on($(e),"keyup",this._editBoxKeyUp);this._on($(e),"input",this._editBoxTextChange);e.focus();e.select()},_editBoxKeyUp:function(n){this._updateLabelPosition(n)},_editBoxTextChange:function(n){this._updateLabelPosition(n)},_updateEditBox:function(n,t){var i=document.getElementById(this.element[0].id+"_editBoxDiv");i&&(i.style.left=i.offsetLeft-n+"px",i.style.top=i.offsetTop-t+"px")},_editboxfocusout:function(){this._endEdit()},_updateLabelPosition:function(n){var t=50,o=this._currZoom,i=this._boundingBox,e=Number(n.target.getAttribute("fontSize")),f=Number(n.target.getAttribute("nodeWidth")),s=i.x+i.width/2,h=i.y+i.height/2,u=this._textLength(n),r;u.width===0?(r=i.width<t?t:i.width,n.target.parentNode.style.width=r+"px",n.target.parentNode.style.left=s-r/2+"px"):(r=u.width<=f*o?u.width<t?t:u.width:f<t?t:f*o,n.target.parentNode.style.width=r+"px",n.target.parentNode.style.left=s-r/2+"px");u.height===0?(n.target.style.height=e+"px",n.target.parentNode.style.top=h-e/2+"px"):this._updateEditor(n,n.target.parentNode,n.target,f,e)},_updateEditor:function(n,t,i,r,u){var s,h,f,c=this._textLength(n),e=this._currZoom,l=50,a=this._boundingBox.x,v=this._boundingBox.y,y=this._boundingBox.width,p=this._boundingBox.height,b=i.value,k=b.split("\n"),w=r*e<c.width?r*e:c.width,o=w<l?l:w;t.style.width=o+"px";s=n?(o-y)/2:(o-y*e)/2;t.style.left=a-s+"px";k.length>1||c.width>=r?(f=ej.browserInfo().name==="mozilla"?i.scrollHeight:i.scrollHeight-4,i.style.height="auto"):f=u;i.style.height=f+"px";h=n?(f-p)/2:(f-p*e)/2;this._boundingBox=new ej.datavisualization.Diagram.Rectangle(a-s,v-h,o,f);t.style.top=v-h+"px"},_textLength:function(n){var t=document.createElement("div"),i=document.getElementById(this.element[0].id+"_editBox"),u={id:this.element[0].id+"_editBoxHiddenDiv",style:"position:absolute; width:"+i.width+"px;height:"+i.height+"px;font-size:"+i.style.fontSize+"px;font-family:"+i.style.fontFamily+";padding: 4px;word-wrap: break-word;white-space:pre-wrap;"},r;return ej.datavisualization.Diagram.Util.attr(t,u),t.innerHTML=n?n.target.value:i.value,document.body.appendChild(t),r=t.getBoundingClientRect(),document.body.removeChild(t),r},_endEdit:function(){var s,u,t=document.getElementById(this.element[0].id+"_editBox"),n,r,f,h,e,i,o;if(t){if(n=this._findNode(t.getAttribute("containerName")),this.activeTool.name==="textTool")n=this.activeTool.selectedObject;else if(!n)for(r=0;r<this.selectionList.length;r++)f=this.selectionList[r],typeof f.labels.length!="undefined"&&f.labels.length>0&&f.labels[0].mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&(n=this.selectionList[r]);n&&(this._isEditing=!1,s=this._raiseEvent("textChange",{element:n,value:t.value}),s||(n&&n.shape!==undefined&&n.shape.type==="text"?(h=n.shape.textBlock.text,n.shape.textBlock.text=t.value,n.shape.textBlock.mode=ej.datavisualization.Diagram.LabelEditMode.View,this._findNode(n.name)?(ej.datavisualization.Diagram.DiagramContext.update(n,this),u={type:"labelchanged",shape:n,previousLabelValue:h,updatedLabelValue:t.value},this.addHistoryEntry(u)):(t.value!==""&&(e=Number(t.style.height.substring(0,t.style.height.length-2)),n.height<e&&(n.offsetY=n.offsetY-n.height/2+e/2,n.height=e),this.selectionList.length>0&&this._clearSelection(),this.add(n)),this.activeTool.selectedObject=null)):n==undefined||n.isPseudoGroup||(i=this.activeTool.name==="textTool"?this.activeTool.getLabelUnderMouse():n.labels[0],i!=undefined?(i.text!=t.value&&(u={type:"labelchanged",shape:n,previousLabelValue:i.text,updatedLabelValue:t.value},this.addHistoryEntry(u)),i.text=t.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(n,i,this)):n.labels.length==0&&(i=ej.datavisualization.Diagram.Label(),i.text=t.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,n.labels.push(i),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(n,i,null,this)))));this._off($(t),"focusout",this._editboxfocusout);this._off($(t),"keyup",this._editBoxKeyUp);this._off($(t),"input",this._editBoxTextChange);o=$("#"+this.element[0].id+"_editBoxDiv")[0];o&&o.parentNode.removeChild(o)}},_setLabelEditing:function(n){var t;if(n)return n.readOnly?(n.mode=ej.datavisualization.Diagram.LabelEditMode.View,t=!1):(this._currentLabel&&(this._currentLabel.mode=ej.datavisualization.Diagram.LabelEditMode.View),n.mode=ej.datavisualization.Diagram.LabelEditMode.Edit,this._currentLabel=n,t=!0),t},_isInternalTool:function(n){return n instanceof ej.datavisualization.Diagram.SelectTool||n instanceof ej.datavisualization.Diagram.ConnectionEditTool||n instanceof ej.datavisualization.Diagram.MoveTool||n instanceof ej.datavisualization.Diagram.ResizeTool||n instanceof ej.datavisualization.Diagram.PhaseTool||n instanceof ej.datavisualization.Diagram.RotateTool||n instanceof ej.datavisualization.Diagram.PanTool&&this.model.tool&ej.datavisualization.Diagram.Tool.SingleSelect&&this.model.tool&ej.datavisualization.Diagram.Tool.ZoomPan?!0:!1},_translate:function(n,t,i,r,u){var o,f,e;if(ej.datavisualization.Diagram.Util.canMove(n)){if(n.segments)ej.datavisualization.Diagram.Util._translateLine(n,t,i,n),this._dock(n,r),ej.datavisualization.Diagram.Util.updateBridging(n,this),this._updateConnectorBridging(n);else{if(n.offsetX+=t,n.offsetY+=i,n.isGroup&&!u){for(o=n.children,e=0;e<o.length;e++)f=r[o[e]],f&&(this._translate(f,t,i,r),f.parent&&f.parent!=n.name&&!n.isPseudoGroup&&ej.datavisualization.Diagram.Util._updateGroupBounds(r[f.parent],r));!n.isGroup&&n.container&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,r)}this._updateAssociatedConnectorEnds(n,r)}this._updateQuad(n)}},_rotate:function(n,t,i){var u,r,e,o,s,f,h;if(ej.datavisualization.Diagram.Util.canRotate(n)&&!n.segments){if(n.rotateAngle+=t,n.rotateAngle%=360,n.rotateAngle<0&&(n.rotateAngle+=360),n.isGroup){for(u=ej.Matrix.identity(),ej.Matrix.rotate(u,t,n.offsetX,n.offsetY),s=n.children,f=0;f<s.length;f++)r=i[s[f]],r&&(r.segments?(r.sourceNode||this._setEndPoint(r,ej.Matrix.transform(u,r.sourcePoint),!1),r.targetNode||this._setEndPoint(r,ej.Matrix.transform(u,r.targetPoint),!0)):(this._rotate(r,t,i),e=r.offsetX,o=r.offsetY,h=ej.Matrix.transform(u,ej.datavisualization.Diagram.Point(e,o)),this._translate(r,h.x-e,h.y-o,i),this._updateAssociatedConnectorEnds(r,i)),r.parent&&r.parent!=n.name&&!n.isPseudoGroup&&ej.datavisualization.Diagram.Util._updateGroupBounds(i[r.parent],i));ej.datavisualization.Diagram.Util._updateGroupBounds(n,i)}this._updateQuad(n);this._updateAssociatedConnectorEnds(n,i)}},scale:function(n,t,i,r,u,f,e,o){var d,p,l,s,y,c,b,k,h;if(n.container)switch(n.container.type){case"canvas":c={};h=ej.Matrix.identity();ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);w=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));a=n.width*t;v=n.height*i;e&&(n.minHeight=v,n.minWidth=a);o!=!0?c=this._getMinMaxSize(n,a,v):(c.width=a,c.height=v);c&&c.width>1&&(b=n.offsetX-n.width/2,n.width=c.width,n.offsetX=b+n.width/2);c&&c.height>1&&(k=n.offsetY-n.height/2,n.height=c.height,n.offsetY=k+n.height/2);f||ej.datavisualization.Diagram.SvgContext._alignOnCanvas1(n,this,!0);break;case"stack":h=ej.Matrix.identity();ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);w=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));a=n.width*t-(n.marginLeft+n.marginRight);v=n.height*i-(n.marginTop+n.marginBottom);c=this._getMinMaxSize(n,a,v);c.width>1&&(b=n.offsetX-n.width/2,n.width=c.width-n.marginLeft,n.offsetX=b+n.width/2+n.marginLeft);c.height>1&&(k=n.offsetY-n.height/2,n.height=c.height-n.marginTop,n.offsetY=k+n.height/2+n.marginTop);ej.datavisualization.Diagram.SvgContext._alignOnStack(n,this)}else{if(h=ej.Matrix.identity(),n.segments){for(ej.Matrix.scale(h,t,i,r.x,r.y),l=0;l<n.segments.length;l++){for(s=n.segments[l],y=0;y<s.points.length;y++)s.points[y]=ej.Matrix.transform(h,s.points[y]),l!=0||y!=0||n.sourceNode||(s._startPoint=s.points[0],s._endPoint=s.points[s.points.length-1],ej.datavisualization.Diagram.Util._setLineEndPoint(n,ej.Matrix.transform(h,n.sourcePoint),!1)),l!=n.segments.length-1||y!=s.points.length-1||n.targetNode||(s._startPoint=s.points[0],s._endPoint=s.points[s.points.length-1],n.targetPoint=s._endPoint);s._startPoint=s.points[0];s._endPoint=s.points[s.points.length-1];s.type=="orthogonal"?s.length||s.length===0?s.length=s._length=ej.datavisualization.Diagram.Geometry.distance(s._startPoint,s._endPoint):ej.datavisualization.Diagram.Util._addOrthogonalPoints(s,n.segments[l-1],n.segments[l+1],n.sourcePoint,n.targetPoint):s.point=s._endPoint}(n.sourceNode||n.targetNode)&&this._dock(n,u)}else{if(n.isGroup){for(d=n.children,l=0;l<d.length;l++)p=u[d[l]],p&&(this.scale(p,t,i,r,u),p.parent&&p.parent!=n.name&&!n.isPseudoGroup&&ej.datavisualization.Diagram.Util._updateGroupBounds(u[p.parent],u));ej.datavisualization.Diagram.Util._updateGroupBounds(n,u)}else{ej.Matrix.rotate(h,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(h,t,i,r.x,r.y);ej.Matrix.rotate(h,n.rotateAngle,r.x,r.y);var w=ej.Matrix.transform(h,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),a=n.width*t,v=n.height*i;a>1&&(n.width=a,n.offsetX=w.x);v>1&&(n.height=v,n.offsetY=w.y)}this._updateAssociatedConnectorEnds(n,u)}this._updateQuad(n)}},_dock:function(n,t,i){var r=n.segments.length,u=n.segments[0].points.length,f=n.segments[n.segments.length-1].points.length;ej.datavisualization.Diagram.Util.dock(n,t);r!=n.segments.length&&(ej.datavisualization.Diagram.Util._updateConnectorSegments(n,n.sourcePort,n.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(n,this));this.selectionList[0]==n&&(i||u!=n.segments[0].points.length||f!=n.segments[n.segments.length-1].points.length)&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._svg,this._currZoom);this._updateQuad(n)},_setEndPoint:function(n,t,i){ej.datavisualization.Diagram.Util._setLineEndPoint(n,t,i);this._updateQuad(n)},_updateAssociatedConnectorEnds:function(n,t){for(var r,i=0,u=n.inEdges.length;i<u;i++)r=t[n.inEdges[i]],r&&this._dock(r,t);for(i=0,u=n.outEdges.length;i<u;i++)r=t[n.outEdges[i]],r&&this._dock(r,t)},_updateChildBounds:function(n,t){var r,u,i,f,e,o,s;n.width==0&&n.height==0?(r=n.offsetX,u=n.offsetY,ej.datavisualization.Diagram.Util._updateGroupBounds(n,t),this._translate(n,r-n.offsetX,u-n.offsetY,t)):(r=n.offsetX,u=n.offsetY,i=ej.datavisualization.Diagram.Util._getChildrenBounds(n,t),n.offsetX=i.x+i.width/2,n.offsetY=i.y+i.height/2,f=r-n.offsetX,e=r-n.offsetY,this._translate(n,f,e,t),o=n.width/i.width,s=n.height/i.height,this._scale(n,o,s,n.pivot,t),this._translate(n,r-n.offsetX,u-n.offsetY,t))},_updateQuad:function(n){this._spatialSearch&&this._spatialSearch.quadTable[n.name]&&(n.segments||n.shape)&&ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n)}});ej.datavisualization.Diagram.Locale={};ej.datavisualization.Diagram.Locale["en-US"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"SelectAll",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"BringToFront",moveForward:"MoveForward",sendBackward:"SendBackward",sendToBack:"SendToBack"};$.fn.pinchDiagram=function(n,t){var i=[],f=function(n){var u=n.touches,t,f,e,r,o,s;if(u.length>=2)for(t=0;t<u.length;t++){for(f=u[t],e=!1,r=0;r<i.length;r++)if(o=i[r],f.identifier===o.identifier){e=!0;break}e||(s=$.extend({},f),i.push(s))}n.preventDefault()},r=function(n,t){var i=t.pageX-n.pageX,r=t.pageY-n.pageY;return Math.sqrt(i*i+r*r)},e=function(n){for(var e,t,u,o,f=n.changedTouches,r=0;r<f.length;r++)for(e=f[r],t=0;t<i.length;t++)u=i[t],u.identifier===e.identifier&&(o=i.indexOf(u),i.splice(o,1));n.preventDefault()},u=function(n,t){n.pageX=t.pageX;n.pageY=t.pageY},o=function(n){var f,e,l;if(n.preventDefault(),f=n.touches,f.length>=2){var o=f[0],s=f[1],h=i[0],c=i[1];e=r(o,s)/r(h,c);l=t._mousePosition(n,!1);ej.datavisualization.Diagram.ZoomUtil.zoomPan(t,e,0,0,l,!0,!0);u(h,o);u(c,s)}};this[0].addEventListener("touchstart",f,!1);this[0].addEventListener("touchend",e,!1);this[0].addEventListener("touchmove",o,!1)}})(jQuery,Syncfusion),function(n,t){"use strict";t.MatrixTypes={Identity:0,Translation:1,Scaling:2,Unknown:4};t.MatrixDefaults={m11:1,m12:0,m21:0,m22:1,offsetX:0,offsetY:0,type:t.MatrixTypes.Identity};t.Matrix={identity:function(){return n.extend(!0,{},t.MatrixDefaults)},multiply:function(n,i){var u=n.type,f=i.type,e,r,o,s;if(f!=t.MatrixTypes.Identity){if(u==t.MatrixTypes.Identity){n.m11=i.m11;n.m12=i.m12;n.m21=i.m21;n.m22=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=i.type;return}if(f==t.MatrixTypes.Translation){n.offsetX+=i.offsetX;n.offsetY+=i.offsetY;u!=t.MatrixTypes.Unknown&&(n.type|=t.MatrixTypes.Translation);return}if(u!=t.MatrixTypes.Translation){e=u<<4|f;switch(e){case 34:n.m11*=i.m11;n.m22*=i.m22;return;case 35:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling;return;case 36:break;default:switch(e){case 50:n.m11*=i.m11;n.m22*=i.m22;n.offsetX*=i.m11;n.offsetY*=i.m22;return;case 51:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.m11*n.offsetX+i.offsetX;n.offsetY=i.m22*n.offsetY+i.offsetY;return;case 52:break;default:switch(e){case 66:case 67:case 68:break;default:return}}}r=this.identity();this._setMatrix(r,n.m11*i.m11+n.m12*i.m21,n.m11*i.m12+n.m12*i.m22,n.m21*i.m11+n.m22*i.m21,n.m21*i.m12+n.m22*i.m22,n.offsetX*i.m11+n.offsetY*i.m21+i.offsetX,n.offsetX*i.m12+n.offsetY*i.m22+i.offsetY);r.m21||r.m12?r.type=t.MatrixTypes.Unknown:((r.m11&&r.m11!=1||r.m22&&r.m22!=1)&&(r.type=t.MatrixTypes.Scaling),(r.offsetX||r.offsetY)&&(r.type|=t.MatrixTypes.Translation),(r.type&(t.MatrixTypes.Translation|t.MatrixTypes.Scaling))==t.MatrixTypes.Identity&&(r.type=t.MatrixTypes.Identity));n.m11=r.m11;n.m12=r.m12;n.m21=r.m21;n.m22=r.m22;n.offsetX=r.offsetX;n.offsetY=r.offsetY;n.type=r.type;return}if(o=n.offsetX,s=n.offsetY,n.m11=i.m11,n.m12=i.m12,n.m21=i.m21,n.m22=i.m22,n.offsetX=i.offsetX,n.offsetY=i.offsetY,n.type=i.type,n.offsetX=o*i.m11+s*i.m21+i.offsetX,n.offsetY=o*i.m12+s*i.m22+i.offsetY,f==t.MatrixTypes.Unknown){n.type=t.MatrixTypes.Unknown;return}n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling}},transform:function(n,t){var i=this._multiplyPoint(n,t.x,t.y);return{x:Math.round(i.x*100)/100,y:Math.round(i.y*100)/100}},rotate:function(n,t,i,r){t%=360;this.multiply(n,this._createRotationRadians(t*.017453292519943295,i?i:0,r?r:0))},scale:function(n,t,i,r,u){this.multiply(n,this._createScaling(t,i,r?r:0,u?u:0))},translate:function(n,i,r){if(n.type&t.MatrixTypes.Identity){this._setMatrix(n,1,0,0,1,i,r,t.MatrixTypes.Translation);return}if(n.type&t.MatrixTypes.Unknown){n.offsetX+=i;n.offsetY+=r;return}n.offsetX+=i;n.offsetY+=r;n.type|=t.MatrixTypes.Translation},_createScaling:function(n,i,r,u){var f=this.identity();return this._setMatrix(f,n,0,0,i,r-n*r,u-i*u,(r||u)?t.MatrixTypes.Scaling|t.MatrixTypes.Translation:t.MatrixTypes.Scaling),f},_createRotationRadians:function(n,i,r){var e=this.identity(),u=Math.sin(n),f=Math.cos(n),o=i*(1-f)+r*u,s=r*(1-f)-i*u;return this._setMatrix(e,f,u,-u,f,o,s,t.MatrixTypes.Unknown),e},_multiplyPoint:function(n,i,r){switch(n.type){case t.MatrixTypes.Identity:break;case t.MatrixTypes.Translation:i+=n.offsetX;r+=n.offsetY;break;case t.MatrixTypes.Scaling:i*=n.m11;r*=n.m22;break;case t.MatrixTypes.Translation|t.MatrixTypes.Scaling:i*=n.m11;i+=n.offsetX;r*=n.m22;r+=n.offsetY;break;default:var u=r*n.m21+n.offsetX,f=i*n.m12+n.offsetY;i*=n.m11;i+=u;r*=n.m22;r+=f}return{x:i,y:r}},_setMatrix:function(n,i,r,u,f,e,o,s){n.m11=i;n.m12=r;n.m21=u;n.m22=f;n.offsetX=e;n.offsetY=o;n.type=s||t.MatrixTypes.Identity}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.HitTesting={_getResizeHandleCenter:function(n,i,r){var f,u;r||(r=1);f=this.bounds(n);u=t.datavisualization.Diagram.Point(0,0);switch(i){case"topleft":u=f.topLeft;break;case"topcenter":u=f.top;break;case"topright":u=f.topRight;break;case"middleleft":u=f.left;break;case"middleright":u=f.right;break;case"bottomleft":u=f.bottomLeft;break;case"bottomcenter":u=f.bottom;break;case"bottomright":u=f.bottomRight;break;case"pivot":u=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY);break;case"rotate":var o=20/r,s=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY-n.height*n.pivot.y-10-o),e=t.Matrix.identity();t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY);u=t.Matrix.transform(e,s)}return u},findResizeHandleAtPoint:function(n,i){var e=null,u,o,f,r,s;if(n)for(f=["topleft","topcenter","topright","middleleft","middleright","bottomleft","bottomcenter","bottomright"],r=0,s=f.length;r<s;r++)if(u=this._getResizeHandleCenter(n,f[r]),u!==t.datavisualization.Diagram.Point(0,0)&&(o=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),o)){e=f[r];break}return e},findRotationHandleAtPoint:function(n,i,r){var u=this.xxx_getResizeHandleCenter(n,"rotate",r),f=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),10);return f?!0:!1},findPivotHandleAtPoint:function(n,i){var r=this._getResizeHandleCenter(n,"pivot"),u=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(r.x,r.y),7);return u?!0:!1},findEndPointHandleAtPoint:function(n,i){var f=null,r,e,u,o;return n&&(e=n.line.points,u=e[e.length-1],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="targetEndPoint"),r||(u=e[0],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="sourceEndPoint")),r||n.line.type!=="bezier"||(u=n.line._point1,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="bezierpoint1"),r||(o=n.line._point2,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),r&&(f="bezierpoint2")))),f}};t.datavisualization.Diagram.Util={findPortByName:function(n,t){var r,i,u;if(n.ports)for(i=0,u=n.ports.length;i<u;i++)if(r=n.ports[i],r.name===t)return r;return null},attr:function(n,t){for(var i in t)n.setAttribute(i.toString(),t[i])},removeItem:function(n,t){var i=n.indexOf(t);i>=0&&n.splice(i,1)},clear:function(n){while(n.length>0)n.pop()},randomId:function(){for(var n,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i="",r=0;r<4;r++)n=Math.floor(Math.random()*t.length),i+=t.substring(n,n+1);return i},htmlEncode:function(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},canMove:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Drag:n.constraints&t.datavisualization.Diagram.NodeConstraints.Drag},canMoveLabel:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLabel:n.constraints&t.datavisualization.Diagram.NodeConstraints.DragLabel},canRotate:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Rotate:n.constraints&t.datavisualization.Diagram.NodeConstraints.Rotate},canSelect:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Select:n.constraints&t.datavisualization.Diagram.NodeConstraints.Select},canBridge:function(n,i){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging:n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritBridging?i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Bridging:void 0},canAllowPan:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan},canDelete:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Delete:n.constraints&t.datavisualization.Diagram.NodeConstraints.Delete},isPageEditable:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PageEditable},canDoMultipleSelection:function(n){if(n)return n.model.tool&t.datavisualization.Diagram.Tool.MultipleSelect},canDoSingleSelection:function(n){if(n)return n.model.tool&t.datavisualization.Diagram.Tool.SingleSelect},canPanning:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY},canZooming:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Zoomable},canUndo:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Undoable},canDragSourceEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd},canDragTargetEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragTargetEnd},canDragSegmentThumbs:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSegmentThumb},isTargetConnected:function(n){return n.targetNode?!0:!1},isSourceConnected:function(n){return n.sourceNode?!0:!1},bounds:function(n,i){var u,s,h,r,o,f,e;if(n.segments)for(s=0;s<n.segments.length;s++)h=n.segments[s],u=s==0?t.datavisualization.Diagram.Geometry.rect(h.points):t.datavisualization.Diagram.Geometry.union(u,t.datavisualization.Diagram.Geometry.rect(h.points)),u.width=u.width==0?n.lineWidth:u.width,u.height=u.height==0?n.lineWidth:u.height;else u=n.shape||n.isGroup?t.datavisualization.Diagram.Rectangle(n.offsetX-n.width*n.pivot.x,n.offsetY-n.height*n.pivot.y,n.width,n.height):n;return u?(r={},u.x=Math.round(u.x*100)/100,u.y=Math.round(u.y*100)/100,u.width=Math.round(u.width*100)/100,u.height=Math.round(u.height*100)/100,r.width=u.width,r.height=u.height,r.x=r.left=u.x,r.right=u.x+u.width,r.y=r.top=u.y,r.bottom=u.y+u.height,r.center=t.datavisualization.Diagram.Point(u.x+u.width/2,u.y+u.height/2),r.topLeft=t.datavisualization.Diagram.Point(u.x,u.y),r.topCenter=t.datavisualization.Diagram.Point(u.x+u.width/2,u.y),r.topRight=t.datavisualization.Diagram.Point(u.x+u.width,u.y),r.middleLeft=t.datavisualization.Diagram.Point(u.x,u.y+u.height/2),r.middleRight=t.datavisualization.Diagram.Point(u.x+u.width,u.y+u.height/2),r.bottomLeft=t.datavisualization.Diagram.Point(u.x,u.y+u.height),r.bottomCenter=t.datavisualization.Diagram.Point(u.x+u.width/2,u.y+u.height),r.bottomRight=t.datavisualization.Diagram.Point(u.x+u.width,u.y+u.height),n.rotateAngle&&!i&&(f=t.Matrix.identity(),t.Matrix.rotate(f,n.rotateAngle,n.offsetX,n.offsetY),r.topLeft=t.Matrix.transform(f,r.topLeft),r.topCenter=t.Matrix.transform(f,r.topCenter),r.topRight=t.Matrix.transform(f,r.topRight),r.middleLeft=t.Matrix.transform(f,r.middleLeft),r.middleRight=t.Matrix.transform(f,r.middleRight),r.bottomLeft=t.Matrix.transform(f,r.bottomLeft),r.bottomCenter=t.Matrix.transform(f,r.bottomCenter),r.bottomRight=t.Matrix.transform(f,r.bottomRight),o=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),r.x=r.left=o.x,r.y=r.top=o.y,r.right=o.x+o.width,r.bottom=o.y+o.height,r.center=t.datavisualization.Diagram.Point(o.x+o.width/2,o.y+o.height/2)),n.rotateAngle<45||(n.rotateAngle<=135?(f=t.Matrix.identity(),t.Matrix.rotate(f,n.rotateAngle,n.offsetX,n.offsetY),e=r.topCenter,r.topCenter=r.middleLeft,r.middleLeft=r.bottomCenter,r.bottomCenter=r.middleRight,r.middleRight=e,e=r.topLeft,r.topLeft=r.bottomLeft,r.bottomLeft=r.bottomRight,r.bottomRight=r.topRight,r.topRight=e):n.rotateAngle<=225?(f=t.Matrix.identity(),t.Matrix.rotate(f,n.rotateAngle,n.offsetX,n.offsetY),e=r.topCenter,r.topCenter=r.bottomCenter,r.bottomCenter=e,e=r.middleLeft,r.middleLeft=r.middleRight,r.middleRight=e,e=r.bottomLeft,r.bottomLeft=r.topLeft,r.topLeft=e,e=r.bottomRight,r.bottomRight=r.topRight,r.topRight=e):n.rotateAngle<=315&&(f=t.Matrix.identity(),t.Matrix.rotate(f,n.rotateAngle,n.offsetX,n.offsetY),e=r.topCenter,r.topCenter=r.middleRight,r.middleRight=r.bottomCenter,r.bottomCenter=r.middleLeft,r.middleLeft=e,e=r.bottomRight,r.bottomRight=r.topRight,r.topRight=r.bottomLeft,r.bottomLeft=r.topLeft,r.topLeft=e)),r.points=[r.topLeft,r.topRight,r.bottomRight,r.bottomLeft],r):u},canResize:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.Resize},canConnect:function(n,i){var r=null;return i?r=n.constraints&t.datavisualization.Diagram.PortConstraints.Connect:n.segments||(r=n.constraints&t.datavisualization.Diagram.NodeConstraints.Connect),r},_initializeSegments:function(n,i){var u,f,r;if(n.segments&&n.segments.length<=1){n.segments.length||n.segments.push(t.datavisualization.Diagram.Segment({type:i||"straight"}));u=n.segments[0];switch(u.type){case"straight":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:i||"straight"}):u._point=n.targetPoint;break;case"orthogonal":u.length&&u.direction?(t.datavisualization.Diagram.Util._addOrthogonalPoints(u,null,null,n.sourcePoint,n.targetPoint),(u._endPoint.x!=n.targetPoint.x||u._endPoint.y!=n.targetPoint.y)&&n.segments.push({type:i||"straight"})):(u._length=u.length||20,u._direction=u.direction||"auto");break;case"bezier":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:i||"straight"}):u._point=n.targetPoint}}var e=n.sourcePoint,s=null,h=null,o;for(f=0;f<n.segments.length;f++){if(r=n.segments[f],r._startPoint=e,h=n.segments[f+1],r=n.segments[f]=t.datavisualization.Diagram.Segment(n.segments[f]),r.type=="orthogonal"){if(r._direction=r.direction||"auto",r._length=r.length||20,o=t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[f],s,h,n.sourcePoint,n.targetPoint,o),e=n.segments[f]._endPoint,!r.length||!r.direction)break}else if(r.type=="straight"){if(r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),r._point=r._endPoint=n.segments[f].point||n.targetPoint,o=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),e=n.segments[f]._endPoint,!r.point)break}else if(r.type=="bezier"){if(r._point=r._endPoint=n.segments[f].point||n.targetPoint,r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),o=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),t.datavisualization.Diagram.Util._updateBezierPoints(r),e=n.segments[f]._endPoint,!r.point)break}else{r=t.datavisualization.Diagram.Segment({type:"orthogonal"});r._direction="auto";r._length=20;r._startPoint=e;r._endPoint=n.targetPoint;n.segments.push(r);t.datavisualization.Diagram.Util._addOrthogonalPoints(r,s,null,n.sourcePoint,n.targetPoint,o);break}s=n.segments[f]}(e.x!=n.targetPoint.x||e.y!=n.targetPoint.y)&&(r=t.datavisualization.Diagram.Segment({type:i||"straight"}),r._startPoint=e,r._endPoint=n.targetPoint,r.type=="orthogonal"?t.datavisualization.Diagram.Util._addOrthogonalPoints(r,s,null,n.sourcePoint,n.targetPoint,o):(r._point=n._endPoint,r.points.push(e),r.points.push(n.targetPoint),r.type=="bezier"&&this._updateBezierPoints(r)),n.segments.push(r))},dock:function(n,t){var i,e=null,r,o=null,u,f;i=t[n.targetNode];i&&(e=this.findPortByName(i,n.targetPort));r=t[n.sourceNode];r&&(o=this.findPortByName(r,n.sourcePort));u=this.isSourceConnected(n);f=this.isTargetConnected(n);f&&u&&e&&o?this._dockPortToPort(n,i,e,r,o):f&&e?u?n.segments.length==1?(this._dockNode(n,r,null,f,u),this._dockPortToNode(n,i,e,r,o,!0)):(this._dockNode(n,r,null,f,u),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,e,!0),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,i,e,!0),this._updatePreviousSegment(n)):u&&o?f?n.segments.length==1?(this._dockNode(n,i,null,f,u),this._dockPortToNode(n,r,o,i,e,!1)):(this._dockPortToPoint(n,r,o,!1),this._updateIntermediateSegments(n),this._dockNode(n,i,null,f,u),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,r,o,!1),this._updateIntermediateSegments(n)):f&&u?i&&r&&this._dockNode(n,i,r,f,u):f?this._dockNode(n,i,null,f,u):u&&this._dockNode(n,r,null,f,u)},_dockPortToPort:function(n,i,r,u,f){var o,s,h;if(n.segments.length==1){i&&(s=this.bounds(i,!0));u&&(h=this.bounds(u,!0));var e,c=n.segments[0],w=n.segments[n.segments.length-1],v=n.segments[0];if(v.type!=="orthogonal")r&&(o=this._getPortPosition(r,s),e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(e,o),this._setLineEndPoint(n,o,!0)),f&&(o=this._getPortPosition(f,h),e=t.Matrix.identity(),t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY),o=t.Matrix.transform(e,o),this._setLineEndPoint(n,o,!1)),v.type==="bezier"&&this._updateBezierPoints(v,i,r,s,u,f,h);else{var l=this._getPortPosition(r,s),a=this._getPortPosition(f,h),y=this._swapDirection(i.rotateAngle,this._getDirection(s,l)),p=this._swapDirection(u.rotateAngle,this._getDirection(h,a));e=t.Matrix.identity();t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY);a=t.Matrix.transform(e,a);e=t.Matrix.identity();t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY);l=t.Matrix.transform(e,l);s=this.bounds(i);h=this.bounds(u);this._constructSegements(n,c,s,l,y,h,a,p);this._setLineEndPoint(n,c.points[0],!1);this._setLineEndPoint(n,c.points[c.points.length-1],!0)}}else this._dockPortToPoint(n,u,f,!1),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,r,!0),this._updatePreviousSegment(n)},_dockPortToNode:function(n,i,r,u,f,e){var p=n.segments[0],w=n.segments[n.segments.length-1],h,l,c,b,a,o,y,s,v;i&&(h=this.bounds(i,!0));u&&(l=this.bounds(u,!0));b=e?w:p;b.type!=="orthogonal"?(a=this._getPortPosition(r,h),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),a=t.Matrix.transform(c,a),this._setLineEndPoint(n,a,e)):(o=this._getPortPosition(r,h),y=this._swapDirection(i.rotateAngle,this._getDirection(h,o)),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(c,o),s=e?n.sourcePoint:n.targetPoint,v=u?this._getDirection(l,s):"top",v&&(h=this.bounds(i),l=u?this.bounds(u):{left:s.x,right:s.x,top:s.y,bottom:s.y},e?(this._setLineEndPoint(n,o,!0),this._constructSegements(n,w,h,o,y,l,s,v)):(this._setLineEndPoint(n,o,!1),this._constructSegements(n,p,l,s,v,h,o,y))))},_dockPortToPoint:function(n,i,r,u){var s=n.segments[0],h=n.segments[n.segments.length-1],a=u?h:s,o,v,y;if(a.type!=="orthogonal")this._dockPortToNode(n,i,r,null,null,u);else{var e=this.bounds(i,!0),f=this._getPortPosition(r,e),c=this._swapDirection(i.rotateAngle,this._getDirection(e,f)),l=t.Matrix.identity();t.Matrix.rotate(l,i.rotateAngle,i.offsetX,i.offsetY);f=t.Matrix.transform(l,f);o=u?h._startPoint:s._endPoint;v=this.bounds(t.datavisualization.Diagram.Rectangle(o.x,o.y,0,0));e=this.bounds(i);y="top";u?(this._setLineEndPoint(n,f,!0),this._pointsFromNodeToPoint(n,h,c,e,i.rotateAngle,f,o,!0)):(this._setLineEndPoint(n,f,!1),this._pointsFromNodeToPoint(n,s,c,e,i.rotateAngle,f,o,!1))}},_dockNode:function(n,t,i,r,u){var s,h,e,f,o,c,l,a;n.segments.length==1?s=h=n.segments[0]:(s=n.segments[0],h=n.segments[n.segments.length-1]);r&&u&&!n.targetPort&&!n.sourcePort?n.segments.length==1?n.segments[0].type=="orthogonal"?(e=this.bounds(i),f=this.bounds(t),e.y>f.bottom?(o="top",c="bottom",l=e.topCenter,a=f.bottomCenter):e.bottom<f.y?(o="bottom",c="top",l=e.bottomCenter,a=f.topCenter):e.x>f.right?(o="left",c="right",l=e.middleLeft,a=f.middleRight):(o="right",c="left",l=e.middleRight,a=f.middleLeft),this._setLineEndPoint(n,l,!1),this._setLineEndPoint(n,a,!0),n.segments[0].type=="orthogonal"&&(this._constructSegements(n,n.segments[0],f,n.targetPoint,c,e,n.sourcePoint,o),n.segments[0]._direction=o)):(t&&(f=this.bounds(t),i&&(e=this.bounds(i),this._setLineEndPoint(n,e.center,!1),this._setLineEndPoint(n,f.center,!0),this._dockBounds(n,i,e,!1)),this._setLineEndPoint(n,f.center,!0),this._dockBounds(n,t,f,!0)),n.segments[0].type=="bezier"&&this._updateBezierPoints(n.segments[0])):(this._dock(n,s,i,null,!1),this._updateIntermediateSegments(n),n.segments.length==1?(this._dock(n,s,i,t,!1),this._dock(n,h,t,i,!0)):(this._dock(n,h,t,null,!0),this._updatePreviousSegment(n))):r&&!n.targetPort?(this._dock(n,h,t,i,!0),this._updatePreviousSegment(n)):u&&!n.sourcePort&&(this._dock(n,s,t,i,!1),this._updateIntermediateSegments(n))},_dock:function(n,i,r,u,f){var o,s,h,e,c,v;if(r){var a=r,l=f?i._startPoint:i._endPoint,o=this.bounds(r);if(f)if(i.type=="orthogonal")if(e=n.segments[n.segments.length-2],e&&e.type=="orthogonal")if(i.points.length>2&&t.datavisualization.Diagram.Geometry.containsPoint(o,i.points[i.points.length-2])){if(c=!1,e.direction=="top"||e.direction=="bottom"){if(e._endPoint.x>=o.left&&e._endPoint.x<=o.right){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.y-o.middleLeft.y);e.length==0?c=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="top"?"bottom":"top"),n.targetPoint=e._endPoint.x>o.right?o.middleRight:o.middleLeft)}else{if(e._endPoint.y>=o.top&&e._endPoint.y<=o.bottom){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.x-o.topCenter.x);e.length==0?c=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="left"?"right":"left"),n.targetPoint=e._endPoint.y>o.bottom?o.bottomCenter:o.topCenter)}if(c){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._startPoint)){if(v=e.direction=="left"||e.direction=="right"?a.width/2:a.height/2,e._length=e.length-=v+30,e.length==0){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=e.direction=="left"||e.direction=="right"?e.direction=="right"?o.middleLeft:o.middleRight:e.direction=="bottom"?o.topCenter:o.bottomCenter;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else this._dockNodeToPoint(n,l,r,f);else this._dockNodeToPoint(n,l,r,f);else this._dockNodeToPoint(n,l,r,f);else if(i.type=="orthogonal"&&n.segments[1]&&n.segments[1].type=="orthogonal")if(n.segments[0]._isInternal&&t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._insertSegmentAtSourceEnd(n,i,o,f);else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._removeFirstSegment(n,i,o,f);else{switch(i.direction){case"left":h="left";s=o.middleLeft;break;case"right":h="right";s=o.middleRight;break;case"top":h="top";s=o.topCenter;break;case"bottom":h="bottom";s=o.bottomCenter}i.points=[];i.points.push(s);i.points.push(i._endPoint);this._setLineEndPoint(n,s,f)}else this._dockNodeToPoint(n,i._endPoint,r,f)}},_removeLastSegment:function(n,t,i,r,u,f){n.segments.splice(n.segments.length-1,1);i.length=i._length=null;i.direction=null;i._direction=t._direction;this._dock(n,i,r,u,f)},_insertSegmentAtSourceEnd:function(n,t,i,r){var u=n.segments[1],f=n.segments[2],o,e;n.segments[0].direction=="left"||n.segments[0].direction=="right"?(o="horizontal",n.sourcePoint=u.direction=="top"?i.topCenter:i.bottomCenter,u&&(u.length||u.length===0)&&(u._length=u.length=Math.max(Math.abs(n.sourcePoint.y-u._endPoint.y),25)),f&&(f.length||f.length===0)&&(f.length=f._length=Math.abs(i.topCenter.x-f._endPoint.x))):(o="vertical",n.sourcePoint=u.direction=="left"?i.middleLeft:i.middleRight,u&&(u.length||u.length===0)&&(u._length=u.length=Math.max(Math.abs(n.sourcePoint.x-u._endPoint.x),25)),f&&(f.length||f.length===0)&&(f.length=f._length=Math.abs(i.middleRight.y-f._endPoint.y)));n.segments[3]&&(n.segments[3].length||n.segments[3].length==0)&&(e=u.direction=="bottom"||u.direction=="right"?u.length:-u.length,n.segments[3].length=n.segments[3]._length=o=="vertical"?Math.abs(n.sourcePoint.x+e-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+e-n.segments[3]._endPoint.y),n.segments[3].length<0&&(e=u.direction=="bottom"||u.direction=="right"?u.length:-u.length,n.segments[3].length=n.segments[3]._length=o=="vertical"?Math.abs(n.sourcePoint.x+e-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+e-n.segments[3]._endPoint.y)));n.segments.splice(0,1);this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,r)},_removeFirstSegment:function(n,i,r,u){var s,h,f=n.segments[1].direction||this._getBezierDirection(n.segments[1].points[0],n.segments[1].points[1]),e,c,o,l;f=="left"||f=="right"?(e=i._endPoint.y-r.middleRight.y,n.segments[0].direction=n.segments[0]._direction=e>=0?"bottom":"top",n.segments[0].length=n.segments[0]._length=Math.abs(e),c=f=="right"?n.segments[1]._endPoint.x-r.right:r.left-n.segments[1]._endPoint.x,n.sourcePoint=f=="left"?r.middleLeft:r.middleRight,s=Math.abs(n.sourcePoint.x-n.segments[0]._startPoint.x),h=Math.abs(n.sourcePoint.y-n.segments[0]._endPoint.y)):((n.segments[0].length||n.segments[0].length==0)&&(e=i._endPoint.x-r.bottomCenter.x,n.segments[0].direction=n.segments[0]._direction=e>=0?"right":"left",n.segments[0].length=n.segments[0]._length=Math.abs(e)),c=f=="bottom"?n.segments[1]._endPoint.y-r.bottom:r.top-n.segments[1]._endPoint.y,n.sourcePoint=f=="top"?r.topCenter:r.bottomCenter,s=Math.abs(n.sourcePoint.y-n.segments[0]._startPoint.y),h=Math.abs(n.sourcePoint.x-n.segments[0]._endPoint.x));n.segments[1]&&(n.segments[1].length||n.segments[1].length===0)&&(n.segments[1]._length=n.segments[1].length=c-25,n.segments[1]._length<0&&(n.segments.splice(0,2),(n.segments[0].length||n.segments[0].length===0)&&(n.segments[0].length=n.segments[0]._length=s),o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:h,direction:f})));o||(o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:25,direction:f}));l=[o];o._isInternal=!0;n.segments=l.concat(n.segments);this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,u)},_dockNodeToPoint:function(n,t,i,r){var l,u,v,y,h,a;if(l=r?n.segments[n.segments.length-1]:n.segments[0],l.type!="orthogonal")u=this.bounds(i),this._setLineEndPoint(n,u.center,r),this._dockBounds(n,i,u,r);else{var u=this.bounds(i),f,e,o,s=t,c=n.segments[n.segments.length-2],k=Math.abs(s.x-u.left),p=Math.abs(s.x-u.right),w=Math.abs(s.y-u.top),b=Math.abs(s.y-u.bottom);c&&r&&(v=c.direction=="left"||c.direction=="right",y=c.direction=="top"||c.direction=="bottom");l=r?n.segments[n.segments.length-1]:n.segments[0];l.points.length!=2&&c||l.type!="orthogonal"||(v=y=!1);u.bottom<s.y&&!v?(e="bottom",o="top",f=u.bottomCenter):u.y>s.y&&!v?(e="top",o="bottom",f=u.topCenter):u.right<s.x&&!y?(e="right",o="left",f=u.middleRight):u.x>s.x&&!y?(e="left",o="right",f=u.middleLeft):(h=k,f=u.middleLeft,e="left",o="right",h>=p&&p!=0&&(f=u.middleRight,e="right",o="left",h=p),h>w&&w!=0&&(f=u.topCenter,e="top",o="bottom",h=w),h>b&&b!=0&&(f=u.bottomCenter,e="bottom",o="top",h=b));f&&(r||n.segments.length==1?(a=n.segments[n.segments.length-1],a.type=="orthogonal"&&(a._direction=r?o:e)):a=n.segments[0],r?n.targetPoint=f:n.sourcePoint=f,n.segments.length!=1&&this._addOrthogonalPoints(a,r?n.segments[n.segments.length-2]:null,r?null:n.segments[1],n.sourcePoint,n.targetPoint),this._setLineEndPoint(n,f,r))}},_getDockSegment:function(n,i,r,u,f,e){var o=this._getEdges(r,u),e="",s,h,c=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint);return(h=f?t.datavisualization.Diagram.LineSegment(i.points[i.points.length-2],i.points[i.points.length-1]):c>5?t.datavisualization.Diagram.LineSegment(i._startPoint,i._endPoint):t.datavisualization.Diagram.LineSegment(i._startPoint,n.segments[1]?n.segments[1]._endPoint:n.targetPoint),t.datavisualization.Diagram.Geometry.intersectSegment(h,o.left)?(s=o.left,e="left"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.top)?(s=o.top,e="top"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.right)?(s=o.right,e="right"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.bottom)&&(s=o.bottom,e="bottom"),e=this._swapDirection(r,e),s)?{dockPoint:t.datavisualization.Diagram.Geometry.midPoint(s),direction:e}:null},_dockBounds:function(i,r,u,f){var l,o,v,c,k,d,s,p,e,w,h,a;if(l=f?i.segments[i.segments.length-1]:i.segments[0],r.shape.type==="polygon")for(s=r.shape.points.length,o=n.extend(!1,{},r.shape.points),t.datavisualization.Diagram.Geometry.updatePolygonPoints(r,o),e=0;e<s;e++)h=t.datavisualization.Diagram.Point(o[e].x+(r.offsetX-r.width/2),o[e].y+(r.offsetY-r.height/2)),r.rotateAngle!=0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,r.rotateAngle,r.offsetX,r.offsetY),h=t.Matrix.transform(a,h)),o[e]=h;else if(r.shape.type==="path"){for(v=document.createElementNS("http://www.w3.org/2000/svg","svg"),v.setAttribute("xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(v),c=document.createElementNS("http://www.w3.org/2000/svg","path"),c.setAttributeNS(null,"d",r.shape.pathData),v.appendChild(c),k=c.getBBox(),d=t.datavisualization.Diagram.Geometry.updatePath(0,0,r.width,r.height,r.shape.pathData,v,k),c.setAttributeNS(null,"d",d),s=c.getTotalLength(),p=[],e=0;e<s-1;e++)w=c.getPointAtLength(e),h=t.datavisualization.Diagram.Point(w.x+(r.offsetX-r.width/2),w.y+(r.offsetY-r.height/2)),r.rotateAngle!=0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,r.rotateAngle,r.offsetX,r.offsetY),h=t.Matrix.transform(a,h)),p[e]=h;s=p.length;o=p;document.body.removeChild(v)}else s=u.points.length,o=u.points;var g=t.datavisualization.Diagram.LineSegment(l._startPoint,l._endPoint||l.point),e,b=t.datavisualization.Diagram.LineSegment(o[s-1],o[0]),y=t.datavisualization.Diagram.Geometry.intersectSegment(g,b);if(!y)for(e=0;e<s-1;e++)if(b=t.datavisualization.Diagram.LineSegment(o[e],o[e+1]),y=t.datavisualization.Diagram.Geometry.intersectSegment(g,b),y)break;y&&(this._setLineEndPoint(i,y,f),l.type==="bezier"&&this._updateBezierPoints(l))},_getEdges:function(n,i){var u=i.points,r={},e=n%360,f;return r.left=t.datavisualization.Diagram.LineSegment(u[3],u[0]),r.top=t.datavisualization.Diagram.LineSegment(u[0],u[1]),r.right=t.datavisualization.Diagram.LineSegment(u[1],u[2]),r.bottom=t.datavisualization.Diagram.LineSegment(u[2],u[3]),e<0&&(e+=360),e>315||e<45||(e<135?(f=r.top,r.top=r.left,r.left=r.bottom,r.bottom=r.right,r.right=f):e<225?(f=r.top,r.top=r.bottom,r.bottom=f,f=r.left,r.left=r.right,r.right=f):(f=r.bottom,r.bottom=r.left,r.left=r.top,r.top=r.right,r.right=f)),r},_pointsFromNodeToPoint:function(n,t,i,r,u,f,e,o){var s=[],l,h,c;s.push(f);l=f.y==e.y&&(i=="left"&&e.x<f.x||i=="right"&&e.x>f.x)||f.x==e.x&&(i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y);u==0&&(l||o||(l=f.x>r.left&&f.x<r.right&&f.y>r.top&&f.y<r.bottom));l||(i=="top"||i=="bottom"?i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y?s.push({x:f.x,y:e.y}):(e.x<r.left||e.x>r.right)&&e.y!=f.y?(h=i=="top"?r.top-15:r.bottom+15,s.push({x:f.x,y:h}),s.push({x:e.x,y:h})):(h=i=="top"?r.top-15:r.bottom+15,c=e.x<f.x?r.left-15:r.right+15,s.push({x:f.x,y:h}),s.push({x:c,y:h}),s.push({x:c,y:e.y})):i=="left"&&e.x<f.x||i=="right"&&e.x>f.x?s.push({x:e.x,y:f.y}):(e.y<r.top||e.y>r.bottom)&&e.x!=f.x?(c=i=="left"?r.left-15:r.right+15,s.push({x:c,y:f.y}),s.push({x:c,y:e.y})):(h=e.y<f.y?r.top-15:r.bottom+15,c=i=="left"?r.left-15:r.right+15,s.push({x:c,y:f.y}),s.push({x:c,y:h}),s.push({x:e.x,y:h})));s.push(e);o&&s.reverse();t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s},_constructSegements:function(n,t,i,r,u,f,e,o){var s,l,h,c;for(o==="right"&&(u==="left"?s=this._rightToLeft(i,r,f,e):u==="right"?s=this._rightToRight(i,r,f,e):u==="top"?s=this._rightToTop(i,r,f,e):u==="bottom"&&(s=this._rightToBottom(i,r,f,e))),o==="left"&&(u==="right"&&(s=this._rightToLeft(f,e,i,r),l=!0),u==="left"&&(s=this._leftToLeft(i,r,f,e)),u==="top"&&(s=this._leftToTop(i,r,f,e)),u==="bottom"&&(s=this._leftToBottom(i,r,f,e))),o==="top"&&(u==="left"&&(s=this._leftToTop(f,e,i,r),l=!0),u==="right"&&(s=this._rightToTop(f,e,i,r),l=!0),u==="top"&&(s=this._topToTop(i,r,f,e)),u==="bottom"&&(s=this._topToBottom(i,r,f,e))),o==="bottom"&&(u==="left"&&(s=this._leftToBottom(f,e,i,r),l=!0),u==="right"&&(s=this._rightToBottom(f,e,i,r),l=!0),u==="top"&&(s=this._topToBottom(f,e,i,r),l=!0),u==="bottom"&&(s=this._bottomToBottom(i,r,f,e))),l&&s.reverse(),h=s[s.length-1],c=s[s.length-2];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(s.length-1,1),h=s[s.length-1],c=s[s.length-2];for(h=s[0],c=s[1];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(0,1),h=s[0],c=s[1];t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s},_updateIntermediateSegments:function(n){var u=n.segments[0]._endPoint,r=n.segments[0],f=r.points.length,i;n.segments[1]&&(i=n.segments[1],i._startPoint=u,i.type=="orthogonal"&&(i.length||i.length===0)?(i.direction=="left"||i.direction=="right"?(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="top"?n.segments[2].length+=i._startPoint.y-i._endPoint.y:n.segments[2].length-=i._startPoint.y-i._endPoint.y,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=i.direction=="right"?"left":"right"),n.segments[2]._length=n.segments[2].length),i._endPoint.y=i._startPoint.y):(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="left"?n.segments[2].length+=i._startPoint.x-i._endPoint.x:n.segments[2].length-=i._startPoint.x-i._endPoint.x,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=i.direction=="bottom"?"top":"bottom"),n.segments[2]._length=n.segments[2].length),i._endPoint.x=i._startPoint.x),n.sourcePort&&r.points.length>2&&(i.direction=="left"||i.direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.y=i._startPoint.y)):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.x=i._startPoint.x))),(i.length||i.length===0)&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i.points[1])),i.length>0&&(i.direction=i._direction=this._getBezierDirection(i._startPoint,i._endPoint)||i._direction),this._addOrthogonalPoints(i,r,n.segments[2],n.sourcePoint,n.targetPoint),n.segments[2]&&this._addOrthogonalPoints(n.segments[2],n.segments[1],n.segments[3],n.sourcePoint,n.targetPoint)):i.type=="orthogonal"&&i.length===null?(n.sourcePort&&r.points.length>2&&(i._direction=="left"||i._direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1]):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1])),i._startPoint=i.points[0]=n.segments[0]._endPoint,this._addOrthogonalPoints(n.segments[1],n.segments[0],null,n.sourcePoint,n.targetPoint)):(i._startPoint=i.points[0]=n.segments[0]._endPoint,i.type=="bezier"&&this._updateBezierPoints(i)))},_updatePreviousSegment:function(n){var i=n.segments[n.segments.length-2],r=n.segments[n.segments.length-1],u,f,e;i&&(i.type=="orthogonal"&&r.points.length>2&&(u=!1,f=i.points.length==2?i.direction:t.datavisualization.Diagram.Util._getBezierDirection(i.points[i.points.length-2],i.points[i.points.length-1]),f=="left"||f=="right"?r.points[0].y==r.points[1].y&&(u=!0,e=r.points[1].x-r.points[0].x,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0]):r.points[0].x==r.points[1].x&&(u=!0,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0])),i._endPoint=r._startPoint,i.points[i.points.length-1]=r._startPoint,i.type=="orthogonal"&&u?(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length>0&&(i._direction=i.direction=this._getBezierDirection(i._startPoint,i._endPoint)),(n.segments.length>2||!n.sourcePort)&&this._addOrthogonalPoints(i,n.segments[n.segments.length-3],r,n.sourcePoint,n.targetPoint)):i.point=r._startPoint)},_swapDirection:function(n,t){var u,i=n%360,r;return i<0&&(i+=360),i>315||i<45?u=t:i<135?(r={left:"top",top:"right",right:"bottom",bottom:"left"},u=r[t]):i<225?(r={left:"right",top:"bottom",right:"left",bottom:"top"},u=r[t]):(r={left:"bottom",top:"left",right:"top",bottom:"right"},u=r[t]),u},_getIntersectionPoint:function(n,i,r){var u,o=r.length,f,e=t.datavisualization.Diagram.Segment(r[o-1],r[0]);if(n.shape.type!="ellipse"&&(u=t.datavisualization.Diagram.Geometry.intersectSegment(i,e)),u)return u;for(f=0;f<o-1;f++)if(e=t.datavisualization.Diagram.Segment(r[f],r[f+1]),u=t.datavisualization.Diagram.Geometry.intersectSegment(i,e),u)return u},_getEllipseIntersectCoords:function(n,t){var i=[],u,s=n.width/2,h=n.height/2,v=n.offsetX-n.width/2,y=n.offsetY-n.height/2,c="M "+(n.offsetX-n.width/2)+", "+n.offsetY+" A "+s+" "+h+" 0 0 1 "+(n.offsetX+n.width/2)+", "+n.offsetY,r=document.createElementNS("http://www.w3.org/2000/svg","path"),e,o,f,l,a;for(r.setAttributeNS(null,"d",c),e=r.getTotalLength(),o=[],f=0;f<e-1;f++)l=r.getPointAtLength(f),o[f]=l;if((i=o,u=this._getIntersectionPoint(n,t,i),u)||(i=[],i[0]=r.getPointAtLength(0),a="M "+(n.offsetX-n.width/2)+", "+n.offsetY+" A "+s+" "+h+" 0 0 0 "+(n.offsetX+n.width/2)+", "+n.offsetY,r.setAttributeNS(null,"d",a),e=r.getTotalLength(),i[1]=r.getPointAtLength(0),u=this._getIntersectionPoint(n,t,i),u))return u;for(i=[],f=0;f<e-1;f++)i[f]=r.getPointAtLength(f);return(u=this._getIntersectionPoint(n,t,i),u)?u:(i=[],i[0]=r.getPointAtLength(e),r.setAttributeNS(null,"d",c),e=r.getTotalLength(),i[1]=r.getPointAtLength(e-1),u=this._getIntersectionPoint(n,t,i),u?u:void 0)},_rightToLeft:function(n,i,r,u){var o=[],e,f,h,s;return o.push(u),h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>u.x?u.y!=i.y&&(u.x+h>=n.left?(e=r.right+h,f=u.y,o.push(t.datavisualization.Diagram.Point(e,f)),f=i.y>r.top?i.y:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f)),i.y<=r.top&&(e=n.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f)),e=i.x,o.push(t.datavisualization.Diagram.Point(e,f)))):(e=r.right+(n.left-r.right)/2,f=u.y,o.push(t.datavisualization.Diagram.Point(e,f)),f=i.y,o.push(t.datavisualization.Diagram.Point(e,f)))):(Math.abs(n.top-r.bottom)<30||Math.abs(n.bottom-r.top)<30?u.x+h>n.right?(e=u.x+h,f=u.y):(e=n.right+s,f=u.y):(e=r.right+h,f=u.y),o.push(t.datavisualization.Diagram.Point(e,f)),n.top-r.bottom>=30?(f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f))):u.y>i.y?(f=r.top-n.bottom<30?n.top-s:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))),e=n.left-s,o.push(t.datavisualization.Diagram.Point(e,f)),f=i.y,o.push(t.datavisualization.Diagram.Point(e,f))),o.push(i),o},_rightToRight:function(n,i,r,u){var o=[],f,e,h,s;return o.push(u),e=u.y,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),n.right>=r.left?u.y>=n.top&&u.y<=n.bottom?(f=u.x+h,o.push(t.datavisualization.Diagram.Point(f,e)),u.y>=n.center.y?(e=u.x>n.left?u.y>i.y?n.bottom+s:n.top-s:n.top-s,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e))):(e=n.bottom+s,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e)))):n.right<r.right?(f=r.right+h,o.push(t.datavisualization.Diagram.Point(f,e))):(f=i.x+s,o.push(t.datavisualization.Diagram.Point(f,e))):(f=u.x+h,o.push(t.datavisualization.Diagram.Point(f,e)),i.y>=r.top&&i.y<=r.bottom&&(i.y<=r.center.y?(e=r.top-h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e))):(e=r.bottom+h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.right+s,o.push(t.datavisualization.Diagram.Point(f,e))))),o.push(t.datavisualization.Diagram.Point(f,i.y)),o.push(i),o},_rightToTop:function(n,i,r,u){var e=[],o,f,s,h;return e.push(u),f=u.y,s=15,h=15,r.width==0&&(s=0),n.width==0&&(h=0),i.x>=u.x?u.y+s>=i.y&&n.height!==0&&(o=n.left<=r.right?n.right+h:n.left-r.right>30?r.right+s:r.right+(n.left-r.right)/2,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.top-h,e.push(t.datavisualization.Diagram.Point(o,f))):r.bottom>=n.top?(o=u.x+s<=n.right?n.right+h:r.right+s,e.push(t.datavisualization.Diagram.Point(o,f)),f=r.top>=n.top?n.height!==0?n.top-h:i.y:r.top-s,e.push(t.datavisualization.Diagram.Point(o,f))):(o=u.x+s,e.push(t.datavisualization.Diagram.Point(o,f)),n.top-r.bottom<30&&n.height!==0?r.left-n.right>=30?(f=r.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f)),o=r.left-s,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.top-h,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.top-(n.top-r.bottom)/2,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.height!==0?n.top-h:i.y,e.push(t.datavisualization.Diagram.Point(o,f)))),e.push(t.datavisualization.Diagram.Point(i.x,f)),e.push(i),e},_rightToBottom:function(n,i,r,u){var o=[],e,f,s,h;return o.push(u),f=u.y,s=15,h=15,r.width==0&&(s=0),n.width==0&&(h=0),i.x>=u.x?u.y<=n.bottom?n.left>r.right+s?(e=u.x+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f))):(e=n.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f))):r.right+s>i.x?(e=u.x+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top-n.bottom>30?n.bottom+h:n.bottom+(r.top-n.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f))):f=u.y:u.y<=n.bottom?(e=r.right+s>n.right?r.right+s:n.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+h,f<=r.bottom+s&&(f=r.bottom+s),o.push(t.datavisualization.Diagram.Point(e,f))):n.bottom<r.top?(e=r.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top-n.bottom<30?n.bottom+(r.top-n.bottom)/2:n.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f))):(e=r.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))),o.push(t.datavisualization.Diagram.Point(i.x,f)),o.push(i),o},_leftToLeft:function(n,i,r,u){var o=[],f,e,h,s;return o.push(u),e=u.y,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>=u.x?(f=r.left-h,o.push(t.datavisualization.Diagram.Point(f,e)),u.y>i.y?i.y+s>=r.top?(e=r.top-h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.left-r.right>30?n.left-s:r.right+(n.left-r.right)/2,o.push(t.datavisualization.Diagram.Point(f,e))):(e=i.y,o.push(t.datavisualization.Diagram.Point(f,e)),f=i.x):r.bottom+h<i.y?(e=i.y,o.push(t.datavisualization.Diagram.Point(f,e)),f=i.x):(e=r.bottom+h,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.left-r.right>30?n.left-s:r.right+(n.left-r.right)/2,o.push(t.datavisualization.Diagram.Point(f,e)))):(i.y>u.y?u.y>n.top-s&&(f=r.left-n.right<30?n.right+(r.left-n.right)/2:r.left-h,o.push(t.datavisualization.Diagram.Point(f,e)),e=n.top-s,o.push(t.datavisualization.Diagram.Point(f,e))):n.bottom+s>=u.y&&(f=r.left-n.right<30?n.right+(r.left-n.right)/2:r.left-h,o.push(t.datavisualization.Diagram.Point(f,e)),e=n.bottom+s,o.push(t.datavisualization.Diagram.Point(f,e)),f=n.left-s,o.push(t.datavisualization.Diagram.Point(f,e))),f=n.left-s,o.push(t.datavisualization.Diagram.Point(f,e))),o.push(t.datavisualization.Diagram.Point(f,i.y)),o.push(i),o},_leftToTop:function(n,i,r,u){var f=[],h,e,o,s;return f.push(u),e=u.y,o=15,s=15,r.width==0&&(o=0),n.width==0&&(s=0),u.x<=i.x?(h=u.y>i.y&&n.left<=r.left?n.left-s:r.left-o,f.push(t.datavisualization.Diagram.Point(h,e)),e=r.bottom<=n.top?r.bottom+o<n.top?n.height!==0?n.top-s:i.y:i.x<r.right?r.bottom+(n.top-r.bottom)/2:r.top-o:r.top>=n.top?n.height!==0?n.top-s:i.y:r.top-o,f.push(t.datavisualization.Diagram.Point(h,e))):i.y<=u.y+o&&(h=r.left-n.right>30?r.left-o:n.right>=r.left?n.left-s:n.right+(r.left-n.right)/2,f.push(t.datavisualization.Diagram.Point(h,e)),e=n.top-s,f.push(t.datavisualization.Diagram.Point(h,e))),f.push(t.datavisualization.Diagram.Point(i.x,e)),f.push(i),f},_leftToBottom:function(n,i,r,u){var e=[],o,f,h,s;return e.push(u),f=u.y,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),u.x<=i.x?(o=n.left<=u.x&&u.y<=n.top?n.left-s:r.left-h,e.push(t.datavisualization.Diagram.Point(o,f)),n.bottom<r.top?(f=r.top-n.bottom<30?n.bottom+(r.top-n.bottom)/2:n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.bottom<r.bottom?r.bottom+h:n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f)))):u.y>i.y||(o=n.right>=r.left?n.left-s:r.left-n.right<30?r.left-(r.left-n.right)/2:r.left-h,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))),e.push(t.datavisualization.Diagram.Point(i.x,f)),e.push(i),e},_topToTop:function(n,i,r,u){var o=[],e,f,h,s;return o.push(u),e=u.x,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>=u.x?i.y>=u.y?(f=r.top-h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x<=r.right&&(e=r.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.height!==0?n.top-r.bottom>30?n.top-s:r.bottom+(n.top-r.bottom)/2:i.y,o.push(t.datavisualization.Diagram.Point(e,f)))):n.left<=u.x?(f=r.top-n.bottom>30?r.top-h:n.bottom+(r.top-n.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.left-s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.height!==0?n.top-s:i.y,o.push(t.datavisualization.Diagram.Point(e,f))):i.y>=u.y?(f=r.top-h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x>=r.left&&(e=r.left-h,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.height!==0?n.top-r.bottom>30?n.top-s:r.bottom+(n.top-r.bottom)/2:i.y,o.push(t.datavisualization.Diagram.Point(e,f)))):n.right>=u.x?(f=r.top-n.bottom>30?r.top-h:n.bottom+(r.top-n.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.top-s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.height!==0?n.top-s:i.y,o.push(t.datavisualization.Diagram.Point(e,f))),e=i.x,o.push(t.datavisualization.Diagram.Point(e,f)),o.push(i),o},_topToBottom:function(n,i,r,u){var e=[],o,f,h,s,c;return e.push(u),o=u.x,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),c=30,i.x>u.x?(r.top>=n.bottom?r.top-n.bottom>=30?(f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.bottom+(r.top-n.bottom)/2,e.push(t.datavisualization.Diagram.Point(o,f)),o=n.left-r.right>=30?r.right+h:r.right+(n.left-r.right)/2,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.top<r.top?n.left>=r.right+15?r.top-h:n.top-s:r.top-h,e.push(t.datavisualization.Diagram.Point(o,f)),o=n.left>=r.right+15?r.right+h:n.right+s,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))),e.push(t.datavisualization.Diagram.Point(i.x,f))):i.x<u.x&&(r.top>=n.bottom?r.top-n.bottom>30?(f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=n.bottom+(r.top-n.bottom)/2,e.push(t.datavisualization.Diagram.Point(o,f)),o=r.left-n.right>=30?r.left-h:n.right+(r.left-n.right)/2,e.push(t.datavisualization.Diagram.Point(o,f)),f=n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))):(f=r.left>=n.right+15?r.top-h:r.top-h,e.push(t.datavisualization.Diagram.Point(o,f)),o=r.left>=n.right+15?n.right+s:r.right+h,e.push(t.datavisualization.Diagram.Point(o,f)),f=r.left>=n.right+15?n.bottom+s:n.bottom<=r.bottom?r.bottom+h:n.bottom+s,e.push(t.datavisualization.Diagram.Point(o,f))),e.push(t.datavisualization.Diagram.Point(i.x,f))),e.push(i),e},_bottomToBottom:function(n,i,r,u){var o=[],e,f,h,s;return o.push(u),e=u.x,h=15,s=15,r.width==0&&(h=0),n.width==0&&(s=0),i.x>=u.x?r.bottom>=n.bottom?(f=r.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x<r.right&&(e=r.right+h,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top>=n.bottom?r.top-n.bottom>=30?n.bottom+s:n.bottom+(r.top-n.bottom)/2:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f)))):u.x>n.left?(f=n.bottom-r.bottom>=30?r.bottom+h:r.bottom+(n.bottom-r.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.left-s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):r.bottom>=n.bottom?(f=r.bottom+h,o.push(t.datavisualization.Diagram.Point(e,f)),i.x>r.left&&(e=r.left-h,o.push(t.datavisualization.Diagram.Point(e,f)),f=r.top>=n.bottom?r.top-n.bottom>=30?n.bottom+s:n.bottom+(r.top-n.bottom)/2:n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f)))):u.x<n.right?(f=n.bottom-r.bottom>=30?r.bottom+h:r.bottom+(n.bottom-r.bottom)/2,o.push(t.datavisualization.Diagram.Point(e,f)),e=n.right+s,o.push(t.datavisualization.Diagram.Point(e,f)),f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))):(f=n.bottom+s,o.push(t.datavisualization.Diagram.Point(e,f))),o.push(t.datavisualization.Diagram.Point(i.x,f)),o.push(i),o},_addOrthogonalPoints:function(n,i,r,u,f,e){var a=[],s=i?i._endPoint:u,p,o,h,c,l,y;a.push(s);n._direction||(n._direction=this._getOrthoDirection(s,f,i));var v=!e&&e!=0?this._directionToAngle(n._direction||this._getBezierDirection(s,f)):e,l=n._direction;if(l=="left"||l=="right"||l=="top"||l=="bottom")v={right:0,left:180,top:270,bottom:90,auto:90}[l];else switch(l){case"straight":v=0;break;case"clockWise90":v+=90;break;case"opposite":v+=180;break;case"antiClockWise90":v+=270}return(n.length||n.length==0)&&n.direction?(o=t.datavisualization.Diagram.Geometry.transform(s,v||0,n._length),o.x=Math.round(o.x*100)/100,o.y=Math.round(o.y*100)/100,a.push(o),n._endPoint=o,r&&(r._startPoint=n._endPoint,r.points&&(r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r)))):(s.x!=f.x&&s.y!=f.y&&(p=20,i||(o=t.datavisualization.Diagram.Geometry.transform(s,v,p)),h=f.x-(o?o.x:s.x),c=f.y-(o?o.y:s.y),h=Math.abs(h)<=.0001?0:h,c=Math.abs(c)<=.0001?0:c,l=n._direction=="auto"?i?i._direction=="left"||i.direction=="right"?"left":"top":"bottom":n._direction,(l=="left"||l=="right")&&h!=0||c==0?(c=c>0?c:-c,c>0&&(y=t.datavisualization.Diagram.Geometry.transform(o||s,90,f.y-(o?o.y:s.y)))):(h=h>0?h:-h,h>0&&(y=t.datavisualization.Diagram.Geometry.transform(o||s,0,f.x-(o?o.x:s.x)))),o&&(o.x=Math.round(o.x*100)/100,o.y=Math.round(o.y*100)/100,a.push(o)),y&&(y.x=Math.round(y.x*100)/100,y.y=Math.round(y.y*100)/100,a.push(y))),n._direction=this._getBezierDirection(a[a.length-1],f),a.push(f),n._endPoint=f,r&&(r._startPoint=n._endPoint,r.points||(r.points=[]),r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r))),n.points=a,v},_getOrthoDirection:function(n,t,i){if(i){var r=t;return Math.abs(r.x-n.x)>Math.abs(r.y-n.y)&&i&&(i._direction=="left"||i._direction=="right")?n.x<r.x?"right":"left":n.y<r.y?"bottom":"top"}return n.y<t.y?"bottom":n.y>t.y?"top":n.x<t.x?"right":n.x>t.x?"left":void 0},_directionToAngle:function(n){return{right:0,left:180,top:270,bottom:90,auto:90}[n]},_resetOrthogonalPoints:function(n){var t=[],i;t.push(n.sourcePoint);t.push(n.targetPoint);n.points=[];n.sourcePoint=t[0];n.points.push(t[0]);i=this._constructOrthogonalPoints(t[0],t[1]);n.points.push(i[0]);n.points.push(i[1]);n.targetPoint=t[1];n.points.push(t[1])},_updateBezierPoints:function(n,i,r,u,f,e,o){var c,v={right:0,left:180,top:270,bottom:90},s,h,l,a;(n.vector1||n.vector2)&&(n.vector1&&(n._point1=t.datavisualization.Diagram.Geometry.transform(n._startPoint,n.vector1.angle,n.vector1.distance)),n.vector2&&(n._point2=t.datavisualization.Diagram.Geometry.transform(n._endPoint,n.vector2.angle,n.vector2.distance)));(n.point1!=null||n.vector1)&&(n.point2!=null||n.vector2)||(s=n._endPoint,h=n._startPoint,e?(c=o,h=this._getPortPosition(e,c),f.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,f.rotateAngle,f.offsetX,f.offsetY),h=t.Matrix.transform(a,h)),l=this._getDirection(c,h)):l=this._getBezierDirection(h,s),n.vector1||(n._point1=n.point1||this._getBezierAdjPoint(v[l],n._startPoint,n._endPoint)),r?(c=u,s=this._getPortPosition(r,c),i.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,i.rotateAngle,i.offsetX,i.offsetY),s=t.Matrix.transform(a,s)),l=this._getDirection(c,s)):l=this._getBezierDirection(s,h),n.vector2||(n._point2=n.point2||this._getBezierAdjPoint(v[l],n._endPoint,n._startPoint)))},_getBezierDirection:function(n,t){return Math.abs(t.x-n.x)>Math.abs(t.y-n.y)?n.x<t.x?"right":"left":n.y<t.y?"bottom":"top"},_getDirection:function(n,i){var f=n.points,u=n.center,r=t.datavisualization.Diagram.Geometry.findAngle(i,u);return r>45&&r<135?"top":r>135&&r<225?"right":r>225&&r<315?"bottom":"left"},_getBezierAdjPoint:function(n,i,r){var u=60,f=t.datavisualization.Diagram.Point(0,0),e=n>45&&n<135?"Bottom":n>135&&n<225?"Left":n>225&&n<315?"Top":"Right";switch(e){case"Right":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x+u,i.y);break;case"Bottom":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y+u);break;case"Left":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x-u,i.y);break;case"Top":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y-u)}return f},_setLineEndPoint:function(n,t,i){var o=n,u,r,e,f;t.x=Math.round(t.x*100)/100;t.y=Math.round(t.y*100)/100;i?(u=n.segments[n.segments.length-1],o.targetPoint=t,u.type!="orthogonal"&&(u.point=u._point=t),u.points[u.points.length-1]=t,u._endPoint=t):(o.sourcePoint=t,r=n.segments[0],r.points[0]=t,r._startPoint=t,r.type!="orthogonal"||n.sourcePort||r.points.length==2&&(r._direction=="left"||r._direction=="right"?(r._endPoint.y=r._startPoint.y,e=Math.abs(r._startPoint.x-r._endPoint.x)):(r._endPoint.x=r._startPoint.x,e=Math.abs(r._startPoint.y-r._endPoint.y)),n.segments[0]._length=e,(n.segments[0].length||n.segments[0].length===0)&&(n.segments[0].length=n.segments[0]._length,n.segments[0].direction=n.segments[0]._direction)));f=i?n.segments[n.segments.length-1]:n.segments[0];f.type!=="orthogonal"||(i||n.sourcePort)&&(!i||n.targetPort)||n.sourceNode&&n.targetNode&&!(n.segments.length>1)?f.type==="bezier"&&this._updateBezierPoints(f):(f.points=[],this._addOrthogonalPoints(f,i?n.segments[n.segments.length-2]:null,i?null:n.segments[1],n.sourcePoint,n.targetPoint))},_setBezierPoint:function(n,i,r){r==="bezierpoint1"?n.vector1?(n.vector1={distance:t.datavisualization.Diagram.Geometry.distance(n._startPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._startPoint,i)},n._point1=i):n.point1=n._point1=i:n.vector2?(n.vector2={distance:t.datavisualization.Diagram.Geometry.distance(n._endPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._endPoint,i)},n._point2=i):n.point2=n._point2=i},_setPoints:function(n,t){n.sourcePoint=n.points[0]=t[0];n.targetPoint=n.points[n.points.length-1]=t[t.length-1];n.points=t;n.type==="bezier"&&(n.point1=t[2]||n.point1,n.point2=t[3]||n.point2,n.point1||(n._point1=n.point1),n.point2||(n._point2=n.point2),this._updateBezierPoints(n))},_updateConnectorSegments:function(n,i,r,u){for(var o,s=n.sourcePoint,f=0;f<n.segments.length;f++){var e=n.segments[f],h=n.segments[f-1],c=n.segments[f+1];e._startPoint=h?h._endPoint:s;f==0&&i||f==n.segments.length-1&&r||(e.type=="orthogonal"?o=t.datavisualization.Diagram.Util._addOrthogonalPoints(e,h,c,n.sourcePoint,n.targetPoint,o):(o=t.datavisualization.Diagram.Geometry.findAngle(s,e._endPoint),e.type=="bezier"&&this._updateBezierPoints(e)));s=e._endPoint}u&&u._dock(n,u.nameTable)},_translateLine:function(n,i,r){for(var u,o,f,e=0;e<n.segments.length;e++){for(u=n.segments[e],o=n.segments[e+1],f=0;f<u.points.length;f++)f==0?(u._startPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==0&&(n.sourcePoint=u._startPoint)):f==u.points.length-1?(u._endPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==n.segments.length-1&&(n.targetPoint=u._endPoint)):u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r);u.type===t.datavisualization.Diagram.Segments.Bezier?(u._point1=t.datavisualization.Diagram.Geometry.translate(u._point1,i,r),u._point2=t.datavisualization.Diagram.Geometry.translate(u._point2,i,r),u.point1&&(u.point1=u._point1),u.point2&&(u.point2=u._point2),u.point=u._endPoint):u.type=="straight"&&(u.point=u._point=u._endPoint)}},_getLabelPosition:function(n,i){var r=i.width*n.offset.x,u=i.height*n.offset.y;return n.horizontalAlignment!="right"?r+=n.margin.left:r-=n.margin.right,n.verticalAlignment!="bottom"?u+=n.margin.top:u-=n.margin.bottom,t.datavisualization.Diagram.Point(r,u)},_getPortPosition:function(n,i,r){if(r)return t.datavisualization.Diagram.Point(i.width*n.offset.x,i.height*n.offset.y);var u=i.x+i.width*n.offset.x,f=i.y+i.height*n.offset.y;return t.datavisualization.Diagram.Point(u,f)},_translate:function(n,i,r,u,f){var s,e,o;if(t.datavisualization.Diagram.Util.canMove(n))if(n.segments)t.datavisualization.Diagram.Util._translateLine(n,i,r,n);else if(n.offsetX+=i,n.offsetY+=r,n.isGroup&&!f){for(s=n.children,o=0;o<s.length;o++)e=u[s[o]],this._translate(e,i,r,u),e.parent&&e.parent!=n.name&&!n.isPseudoGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(u[e.parent],u);!n.isGroup&&n.container&&t.datavisualization.Diagram.Util._updateGroupBounds(n,u)}},scale:function(n,i,r,u,f,e,o,s){var g,w,a,h,p,l,k,d,c;if(n.container)switch(n.container.type){case"canvas":l={};c=t.Matrix.identity();t.Matrix.rotate(c,-n.rotateAngle,u.x,u.y);t.Matrix.scale(c,i,r,u.x,u.y);t.Matrix.rotate(c,n.rotateAngle,u.x,u.y);b=t.Matrix.transform(c,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));v=n.width*i;y=n.height*r;o&&(n.minHeight=y,n.minWidth=v);s!=!0?l=this._getMinMaxSize(n,v,y):(l.width=v,l.height=y);l&&l.width>1&&(k=n.offsetX-n.width/2,n.width=l.width,n.offsetX=k+n.width/2);l&&l.height>1&&(d=n.offsetY-n.height/2,n.height=l.height,n.offsetY=d+n.height/2);e||t.datavisualization.Diagram.SvgContext._alignOnCanvas1(n,this,!0);break;case"stack":c=t.Matrix.identity();t.Matrix.rotate(c,-n.rotateAngle,u.x,u.y);t.Matrix.scale(c,i,r,u.x,u.y);t.Matrix.rotate(c,n.rotateAngle,u.x,u.y);b=t.Matrix.transform(c,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));v=n.width*i-(n.marginLeft+n.marginRight);y=n.height*r-(n.marginTop+n.marginBottom);l=this._getMinMaxSize(n,v,y);l.width>1&&(k=n.offsetX-n.width/2,n.width=l.width-n.marginLeft,n.offsetX=k+n.width/2+n.marginLeft);l.height>1&&(d=n.offsetY-n.height/2,n.height=l.height-n.marginTop,n.offsetY=d+n.height/2+n.marginTop);t.datavisualization.Diagram.SvgContext._alignOnStack(n,this)}else if(c=t.Matrix.identity(),n.segments)for(t.Matrix.scale(c,i,r,u.x,u.y),a=0;a<n.segments.length;a++){for(h=n.segments[a],p=0;p<h.points.length;p++)h.points[p]=t.Matrix.transform(c,h.points[p]),a!=0||p!=0||n.sourceNode||(h._startPoint=h.points[0],h._endPoint=h.points[h.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(n,t.Matrix.transform(c,n.sourcePoint),!1)),a!=n.segments.length-1||p!=h.points.length-1||n.targetNode||(h._startPoint=h.points[0],h._endPoint=h.points[h.points.length-1],n.targetPoint=h._endPoint);h._startPoint=h.points[0];h._endPoint=h.points[h.points.length-1];h.type=="orthogonal"?h.length||h.length===0?h.length=h._length=t.datavisualization.Diagram.Geometry.distance(h._startPoint,h._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(h,n.segments[a-1],n.segments[a+1],n.sourcePoint,n.targetPoint):h.point=h._endPoint}else if(n.isGroup){for(g=n.children,a=0;a<g.length;a++)w=f[g[a]],w&&(this.scale(w,i,r,u,f),w.parent&&w.parent!=n.name&&!n.isPseudoGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(f[w.parent],f));t.datavisualization.Diagram.Util._updateGroupBounds(n,f)}else{t.Matrix.rotate(c,-n.rotateAngle,u.x,u.y);t.Matrix.scale(c,i,r,u.x,u.y);t.Matrix.rotate(c,n.rotateAngle,u.x,u.y);var b=t.Matrix.transform(c,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),v=n.width*i,y=n.height*r;v>1&&(n.width=v,n.offsetX=b.x);y>1&&(n.height=y,n.offsetY=b.y)}},_updateChildBounds:function(n,i){var u,f,e,o,r,s,h;e=n.width;o=n.height;u=n.offsetX;f=n.offsetY;r=t.datavisualization.Diagram.Util._getChildrenBounds(n,i);n.offsetX=r.x+r.width/2;n.offsetY=r.y+r.height/2;n.height=r.height;n.width=r.width;s=e/n.width;h=o/n.height;this.scale(n,s,h,n.pivot,i);this._translate(n,u-n.offsetX,f-n.offsetY,i)},_updateGroupBounds:function(n,i){var u;if(n&&!n.container&&n&&n.isGroup&&n.children.length>0){this._updateRotateAngle(n,i);var r=this._getChildrenBounds(n,i),e=r.x+r.width*n.pivot.x,o=r.y+r.height*n.pivot.y,f=t.Matrix.identity();t.Matrix.rotate(f,n.rotateAngle);u=t.Matrix.transform(f,{x:e,y:o});r&&(n.offsetX=u.x,n.offsetY=u.y,n.width=r.width,n.height=r.height)}},_getChildrenBounds:function(n,i,r){var f=n.children,e,o=t.datavisualization.Diagram.Rectangle(),u,s,h;for(f.length>0&&(u=i[f[0]],u&&(o=this._rotateChildBounds(u,n))),s=1,h=f.length;s<h;s++)u=i[f[s]],u&&(u.isGroup?(this._updateGroupBounds(u,i,r),e=this._rotateChildBounds(u,n)):e=this._rotateChildBounds(u,n)),e&&(o=t.datavisualization.Diagram.Geometry.union(o,e));return o},_updateRotateAngle:function(n,t){var i,r;if(n.offsetX==0&&n.offsetY==0&&n.width==0&&n.height==0)for(i=0;i<n.children.length;i++)if(r=t[n.children[i]],r&&!r.segments&&!n.rotateAngle){n.rotateAngle=r.rotateAngle;return}},_rotateChildBounds:function(n,i){var r=t.Matrix.identity();t.Matrix.rotate(r,-i.rotateAngle);var u=this.bounds(n),f=t.Matrix.transform(r,u.topLeft),e=t.Matrix.transform(r,u.topRight),o=t.Matrix.transform(r,u.bottomLeft),s=t.Matrix.transform(r,u.bottomRight),h=Math.min(f.x,e.x,o.x,s.x),c=Math.min(f.y,e.y,o.y,s.y);return{x:h,width:Math.max(f.x,e.x,o.x,s.x)-h,y:c,height:Math.max(f.y,e.y,o.y,s.y)-c}},updateBridging:function(i,r){var st=this.getPoints(i),s=i.bridgeSpace,f=[],ht=-1,g,vt,ct,nt,tt,it,p,yt,pt,wt,rt,h,c,bt,kt,ft,at,gt,ot,l,e,o,y,k,d,a,v,ti,ii;if(t.datavisualization.Diagram.Util.canBridge(i,r)){if(i.segments.length>0)for(g=0;g<i.segments.length;g++)i.segments[g]._bridges=[];for(vt=t.datavisualization.Diagram.Util.bounds(i),ct=t.datavisualization.Diagram.SpatialUtil.findQuads(r._spatialSearch,vt),nt=0;nt<ct.length;nt++)if(tt=ct[nt],tt.objects.length>0)for(it=0;it<tt.objects.length;it++)if(p=tt.objects[it],p.segments&&i.zOrder>p.zOrder&&(yt=t.datavisualization.Diagram.Util.bounds(i),pt=t.datavisualization.Diagram.Util.bounds(p),t.datavisualization.Diagram.Geometry.intersectsRect(yt,pt)&&(wt=this.getPoints(p),rt=this.interSect(st,wt,!1),rt.length>0)))for(l=0;l<rt.length;l++){var lt=0,u=0,w=0,b=0,ut=this.getLengthAtFractionPoint(i,rt[l]);if((w=ut.lengthAtFractionPt,lt=ut.fullLength,u=ut.segmentIndex,b=ut.pointIndex,!(u<0))&&i.segments[0])if(bt=(w-s/2)/lt,h=this.getPointAtLength(w-s/2,st),bt=(w+s/2)/lt,c=this.getPointAtLength(w+s/2,st),t.datavisualization.Diagram.Geometry.isEmptyPoint(c)&&(c=h),kt=u===0?i.sourcePoint:i.segments[u-1]._endPoint,a=i.segments[u].type==="straight"?i.segments[u]._point:i.segments[u].points[b],ft=this.findAngle(kt,a),f.length>u&&f[u]!=null){at=u===0?i.sourcePoint:i.segments[u-1]._endPoint;var ri=Math.abs(this.findLength(at,c)),dt=0,et=-1;for(ht=-1,o=0;o<f[u].bridges.length;o++)if(ht++,gt=f[u].bridges[o],dt=Math.abs(this.findLength(at,gt.endPoint)),ri<dt){et=ht;break}et>=0?(ot=this.createSegment(h,c,ft,b,i,r),f[u].bridges.splice(et,0,ot),f[u].bridges.join(),f[u].bridgeStartPoint.splice(et,0,h),f[u].bridgeStartPoint.join(),f[u].segmentIndex=u):(ot=this.createSegment(h,c,ft,b,i,r),f[u].bridges.push(ot),f[u].bridgeStartPoint.push(h),f[u].segmentIndex=u)}else if(!isNaN(h.x)&&!isNaN(h.y)&&!t.datavisualization.Diagram.Geometry.isEmptyPoint(c)){var ui=this.createSegment(h,c,ft,b,i,r),ni=[];ni.push(h);[].push(c);f.length<u+1;f[u]=n.extend(!0,{},t.datavisualization.Diagram.BridgeSegments,{});f[u].bridges.push(ui);f[u].bridgeStartPoint=ni;f[u].segmentIndex=u}}if(f.length!=0)for(l=0;l<f.length;l++)if(e=f[l],e){for(o=1;o<e.bridges.length;o++)this.findLength(e.bridges[o].endPoint,e.bridges[o-1].endPoint)<s&&(e.bridges[o-1].endPoint=e.bridges[o].endPoint,e.bridges.splice(o,1),e.bridgeStartPoint.splice(o,1),o--);for(y=i.sourcePoint,k=0;k<e.bridges.length;k++)d=e.bridges[k],i.segments[e.segmentIndex].type==="straight"?a=i.segments[e.segmentIndex]._endPoint:i.segments[e.segmentIndex].type==="orthogonal"&&(a=i.segments[e.segmentIndex].points[d.segmentPointIndex]),u!=0&&(y=i.segments[e.segmentIndex]._endPoint),v=[],v.push(t.datavisualization.Diagram.Point(a.x-s,a.y-s)),v.push(t.datavisualization.Diagram.Point(a.x+s,a.y+s)),ti=t.datavisualization.Diagram.Geometry.rect(v),v=[],v.push(t.datavisualization.Diagram.Point(y.x-s,y.y-s)),v.push(t.datavisualization.Diagram.Point(y.x+s,y.y+s)),ii=t.datavisualization.Diagram.Geometry.rect(v),t.datavisualization.Diagram.Geometry.containsPoint(ti,e.bridgeStartPoint[k])||t.datavisualization.Diagram.Geometry.containsPoint(ii,d.endPoint)||(i.segments[e.segmentIndex]._bridges.push(d),y=d.endPoint)}}},createSegment:function(i,r,u,f,e,o){var s=n.extend(!0,{},t.datavisualization.Diagram.PathSegment,{}),h,c;return c=this.sweepDirection(u,e),h=o.getBridgeSegment(i,r,u,e.bridgeSpace,c),s.path=h,s.startPoint=i,s.endPoint=r,s.angle=u,s.segmentPointIndex=f,s},sweepDirection:function(n){var t;return n===360||n===45||n===90||n===135?t=1:(n===180||n===225||n===270||n===315)&&(t=0),(n>0&&n<45||n>45&&n<90||n>90&&n<135||n>135&&n<180||n>180&&n<225||n>225&&n<270||n>270&&n<315||n>315&&n<360)&&(t=0),t},getPointAtLength:function(n,i){for(var u,o,f=0,r=null,s=t.datavisualization.Diagram.Point(0,0),e=0;e<i.length;e++){if(u=i[e],r)if(o=this.findLength(r,u),f+o>n){var h=n-f,c=this.findAngle(r,u),l=h*Math.cos(c*Math.PI/180),a=h*Math.sin(c*Math.PI/180);s=t.datavisualization.Diagram.Point(r.x+l,r.y+a);break}else f+=o;else{r=u;continue}r=u}return s},getLengthAtFractionPoint:function(n,t){var c=100,o=0,l=-1,a=0,v=0,y=-1,f,e,s,w,i,r,h;if(n.segments===null)return 0;var b=n.segments,u=n.sourcePoint,p=u;for(f=0;f<n.segments.length;f++){for(e=[],s=n.segments[f],i=0;i<s.points.length;i++)w=s.points[i],e.push(w);for(i=0;i<e.length;i++)r=e[i],h=this.getSlope(r,u,t,n),h<c&&(c=h,v=o+this.findLength(t,p),l=a,y=i),o+=this.findLength(r,u),u=r,p=r;a++}return{lengthAtFractionPt:v,fullLength:o,segmentIndex:l,pointIndex:y}},getSlope:function(n,t,i,r){var e=3,o=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y),u=(i.y-n.y)/(t.y-n.y),f=(i.x-n.x)/(t.x-n.x);return!isFinite(u)||!isFinite(f)||isNaN(u)||isNaN(f)?n.x===t.x?n.y===t.y?1e4:n.y>i.y&&i.y>t.y||n.y<i.y&&i.y<t.y?Math.abs(n.x-i.x):1e4:n.y==t.y?n.x>i.x&&i.x>t.x||n.x<i.x&&i.x<t.x?Math.abs(n.y-i.y):1e4:1e4:r.segments.length>0?n.x>=i.x&&i.x>=t.x||n.x<=i.x&&i.x<=t.x||o<e?n.y>=i.y&&i.y>=t.y||n.y<=i.y&&i.y<=t.y||s<e?Math.abs(u-f):1e4:1e4:1e4},getPoints:function(n){var r=[],t,i,u;if(n.segments.length>0)for(t=0;t<n.segments.length;t++)if(i=n.segments[t],i.type==="straight"||i.type==="bezier")t===0&&r.push(n.sourcePoint),r.push(i._point);else if(i.type==="orthogonal")for(u=0;u<n.segments[t].points.length;u++)r.push(n.segments[t].points[u]);return r},interSect:function(n,t,i){var e,r,u,f;for(i&&t.length>=2&&(t.splice(0,1),t.splice(0,1)),e=[],r=0;r<n.length-1;r++){if(u=this.interSect1(n[r],n[r+1],t),u.length>0)for(f=0;f<u.length;f++)e.push(u[f]);i&&t.length>=1&&t.splice(0,1)}return e},interSect1:function(n,i,r){for(var f,e=[],u=0;u<r.length-1;u++)f=this.interSect2(n,i,r[u],r[u+1]),t.datavisualization.Diagram.Geometry.isEmptyPoint(f)||e.push(f);return e},interSect2:function(n,i,r,u){var e=t.datavisualization.Diagram.LineUtil(n.x,n.y,i.x,i.y),o=t.datavisualization.Diagram.LineUtil(r.x,r.y,u.x,u.y),f=this.interSect3(e,o);return f.enabled?f.intersectPt:t.datavisualization.Diagram.Point(0,0)},interSect3:function(n,i){var f=t.datavisualization.Diagram.Point(0,0),r=n,u=i,o=(u.y2-u.y1)*(r.x2-r.x1)-(u.x2-u.x1)*(r.y2-r.y1),h=(u.x2-u.x1)*(r.y1-u.y1)-(u.y2-u.y1)*(r.x1-u.x1),c=(r.x2-r.x1)*(r.y1-u.y1)-(r.y2-r.y1)*(r.x1-u.x1),e,s;return o==0?{enabled:!1,intersectPt:f}:(e=h/o,s=c/o,e>=0&&e<=1&&s>=0&&s<=1)?(f.x=r.x1+e*(r.x2-r.x1),f.y=r.y1+e*(r.y2-r.y1),{enabled:!0,intersectPt:f}):{enabled:!1,intersectPt:f}},findLength:function(n,t){try{return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}catch(i){throw i;}},findAngle:function(n,i){if(t.datavisualization.Diagram.Geometry.isEqualPoint(n,i))return 0;var u=t.datavisualization.Diagram.Point(i.x,n.y),o=this.findLength(n,u),f=this.findLength(u,i),e=this.findLength(i,n),r=Math.asin(f/e);return r=r*180/Math.PI,n.x<i.x?n.y<i.y||(r=360-r):r=n.y<i.y?180-r:180+r,r}};t.datavisualization.Diagram.BridgeSegments={bridges:[],bridgeStartPoint:[],segmentIndex:-1};t.datavisualization.Diagram.PathSegment={path:"",startPoint:{x:0,y:0},endPoint:{x:0,y:0},angle:0,segmentPointIndex:-1};t.datavisualization.Diagram.LineUtil=function(n,t,i,r){return{x1:Number(n)||0,y1:Number(t)||0,x2:Number(i)||0,y2:Number(r)||0}};t.datavisualization.Diagram.Geometry={checkPointOnCircle:function(n,t,i){var r=Math.pow(i,2),u=Math.pow(n.x-t.x,2),f=Math.pow(n.y-t.y,2);return u+f<=r?!0:!1},rect:function(n){var c=t.datavisualization.Diagram.Rectangle(),e,i,r,h;if(arguments.length===1){var o=Number.MAX_VALUE,s=Number.MAX_VALUE,l=Number.MIN_VALUE,a=Number.MIN_VALUE,v=n.length,u,f;for(e=0;e<v;e++)u=n[e].x,f=n[e].y,u<o&&(o=u),u>l&&(l=u),f<s&&(s=f),f>a&&(a=f);c=t.datavisualization.Diagram.Rectangle(o,s,l-o,a-s)}else arguments.length===2&&(i=t.datavisualization.Diagram.Point(arguments[0]),r=t.datavisualization.Diagram.Point(arguments[1]),i.x>r.x&&(h=i.x,i.x=r.x,r.x=h),i.y>r.y&&(h=i.y,i.y=r.y,r.y=h),c=t.datavisualization.Diagram.Rectangle(i.x,i.y,r.x-i.x,r.y-i.y));return c},union:function(n,i){var r=Math.min(n.x,i.x),u=Math.min(n.y,i.y),f=Math.max(n.x+n.width,i.x+i.width),e=Math.max(n.y+n.height,i.y+i.height);return t.datavisualization.Diagram.Rectangle(r,u,f-r,e-u)},distance:function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},translate:function(n,i,r){return t.datavisualization.Diagram.Point(n.x+i,n.y+r)},intersectsRect:function(n,t){return t.x<n.x+n.width&&n.x<t.x+t.width&&t.y<n.y+n.height&&n.y<t.y+t.height},findAngle:function(n,t){var i=Math.atan2(t.y-n.y,t.x-n.x);return i=180*i/Math.PI,i%=360,i<0&&(i+=360),i},intersectSegment:function(n,i){var a=n.point1.x,v=n.point1.y,y=n.point2.x,p=n.point2.y,w=i.point1.x,b=i.point1.y,k=i.point2.x,d=i.point2.y,f,e,o,s,h,c,rt,ut,g,nt,tt,it,r,l,u;return(f=p-v,o=a-y,h=y*v-a*p,tt=f*w+o*b+h,it=f*k+o*d+h,tt!==0&&it!==0&&this.sameSign(tt,it))?null:(e=d-b,s=w-k,c=k*b-w*d,g=e*a+s*v+c,nt=e*y+s*p+c,g!==0&&nt!==0&&this.sameSign(g,nt))?null:(r=f*s-e*o,r===0)?null:(l=r<0?-r/2:r/2,u=o*c-s*h,rt=u<0?(u-l)/r:(u+l)/r,u=e*h-f*c,ut=u<0?(u-l)/r:(u+l)/r,t.datavisualization.Diagram.Point(rt,ut))},updatePath:function(n,i,r,u,f,e,o){var s,h;e&&e.pathBounds?(h=!0,s=e.pathBounds(f)):(h=!1,s=o);var c=0,l=0,a=!1;return(n.toString()!==s.x||i.toString()!==s.y)&&(c=n-Number(s.x),l=i-Number(s.y)),(r!==s.width||u!==s.height)&&(c=r/Number(s.width),l=u/Number(s.height),a=!0),t.datavisualization.Diagram.Geometry.processPathData(f,c,l,a,s.x,s.y,n,i,h,e)},processPathData:function(n,i,r,u,f,e,o,s,h,c){var y=document.createElementNS("http://www.w3.org/2000/svg","path"),rt,ut,b,k,d,g,p,l,nt,tt,it;y.setAttribute("d",n);h&&c&&(n=c.absolutePath(y).getAttribute("d"),y.setAttribute("d",n));p=y.pathSegList;for(var a=0,v=0,w=0,ft=p.numberOfItems;w<ft;++w){l=p.getItem(w);nt=l.pathSegTypeAsLetter;"x1"in l&&(b=l.x1);"x2"in l&&(d=l.x2);"y1"in l&&(k=l.y1);"y2"in l&&(g=l.y2);"x"in l&&(a=l.x);"y"in l&&(v=l.y);u?(a!=undefined&&(a=t.datavisualization.Diagram.Geometry.scalePathData(a,i,f,o)),v!=undefined&&(v=t.datavisualization.Diagram.Geometry.scalePathData(v,r,e,s)),b!=undefined&&(b=t.datavisualization.Diagram.Geometry.scalePathData(b,i,f,o)),k!=undefined&&(k=t.datavisualization.Diagram.Geometry.scalePathData(k,r,e,s)),d!=undefined&&(d=t.datavisualization.Diagram.Geometry.scalePathData(d,i,f,o)),g!=undefined&&(g=t.datavisualization.Diagram.Geometry.scalePathData(g,r,e,s))):(a!=undefined&&(a=a+i),v!=undefined&&(v=v+r),b!=undefined&&(b=b+i),k!=undefined&&(k=k+r),d!=undefined&&(d=d+i),g!=undefined&&(g=g+r));switch(nt){case"M":p.replaceItem(y.createSVGPathSegMovetoAbs(a,v),w);break;case"L":p.replaceItem(y.createSVGPathSegLinetoAbs(a,v),w);break;case"H":p.replaceItem(y.createSVGPathSegLinetoHorizontalAbs(a),w);break;case"V":p.replaceItem(y.createSVGPathSegLinetoVerticalAbs(v),w);break;case"C":p.replaceItem(y.createSVGPathSegCurvetoCubicAbs(a,v,b,k,d,g),w);break;case"S":p.replaceItem(y.createSVGPathSegCurvetoCubicSmoothAbs(a,v,d,g),w);break;case"Q":p.replaceItem(y.createSVGPathSegCurvetoQuadraticAbs(a,v,b,k),w);break;case"T":p.replaceItem(y.createSVGPathSegCurvetoQuadraticSmoothAbs(a,v),w);break;case"A":tt=l.r1;it=l.r2;u&&(tt=tt*i,it=it*r);p.replaceItem(y.createSVGPathSegArcAbs(a,v,tt,it,l.angle,l.largeArcFlag,l.sweepFlag),w);break;case"Z":a=rt;v=ut}(nt==="M"||nt==="m")&&(rt=a,ut=v)}return y.getAttribute("d")},scalePathData:function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},updatePolygonPoints:function(n,i){var f,r,e,u;if(n.shape.points)for(i||(i=n.shape.points),t.datavisualization.Diagram.Geometry.scalePoints(i,n),f=t.datavisualization.Diagram.Geometry.rect(n.shape.points),r=0,e=n.shape.points.length;r<e;++r)u=t.datavisualization.Diagram.Geometry.translate(i[r],-f.x,-f.y),u=t.datavisualization.Diagram.Geometry.translate(u,0,0),i[r]=u},scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(i.shape.points),f,e,r,o;if(u.width>0&&u.height>0)for(f=i.width/u.width,e=i.height/u.height,r=0,o=i.shape.points.length;r<o;++r)n[r].x=n[r].x*f,n[r].y=n[r].y*e},sameSign:function(n,t){return n*t>=0},containsPoint:function(n,t){return n.x<=t.x&&t.x<=n.x+n.width&&n.y<=t.y&&t.y<=n.y+n.height},containsRect:function(n,t){return n.x<=t.x&&t.x+t.width<=n.x+n.width&&n.y<=t.y&&t.y+t.height<=n.y+n.height},inflate:function(n,t,i){n.x-=t;n.y-=i;n.width+=2*t;n.height+=2*i},isEmptyRect:function(n){return n.x===0&&n.y===0&&n.width===0&&n.height===0},isEmptyPoint:function(n){return n.x===0&&n.y===0},isEqualPoint:function(n,t){return n.x===t.x&&n.y===t.y},isEmptySize:function(n){return n.width===0&&n.height===0},length:function(n){return t.datavisualization.Diagram.Geometry.distance(n.point1,n.point2)},midPoint:function(n){return t.datavisualization.Diagram.Point((n.point1.x+n.point2.x)/2,(n.point1.y+n.point2.y)/2)},transform:function(n,t,i){var r={};return r.x=Math.round((n.x+i*Math.cos(t*Math.PI/180))*100)/100,r.y=Math.round((n.y+i*Math.sin(t*Math.PI/180))*100)/100,r}};t.datavisualization.Diagram.LineSegment=function(n,t){return{point1:n,point2:t}};t.datavisualization.Diagram.Point=function(n,t){return{x:Number(n)||0,y:Number(t)||0}};t.datavisualization.Diagram.Size=function(n,t){return{width:Number(n)||0,height:Number(t)||0}};t.datavisualization.Diagram.Rectangle=function(n,t,i,r){return{x:Number(n)||0,y:Number(t)||0,width:Number(i)||0,height:Number(r)||0}};t.datavisualization.Diagram.DecoratorShapes={None:"none",Arrow:"arrow",OpenArrow:"openarrow",Circle:"circle",Diamond:"diamond",Path:"path"};t.datavisualization.Diagram.dependentconnector={dependent:1,independent:2};t.datavisualization.Diagram.ContainerType={Canvas:"canvas",Stack:"stack"};t.datavisualization.Diagram.PortShapes={X:"x",Circle:"circle",Square:"square",Path:"path"};t.datavisualization.Diagram.PortVisibility={Visible:1,Hidden:2,Hover:4,Connect:8,Default:8};t.datavisualization.Diagram.TextAlign={Left:"left",Center:"center",Right:"right"};t.datavisualization.Diagram.HorizontalAlignment={Left:"left",Center:"center",Right:"right"};t.datavisualization.Diagram.LabelEditMode={Edit:"edit",View:"view"};t.datavisualization.Diagram.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom"};t.datavisualization.Diagram.TextDecorations={Underline:"underline",Overline:"overline",LineThrough:"line-through",None:"none"};t.datavisualization.Diagram.NodeConstraints={None:1,Select:2,Delete:4,Resize:8,Drag:16,Rotate:32,Connect:64,ResizeNorthEast:128,ResizeEast:256,ResizeSouthEast:512,ResizeSouth:1024,ResizeSouthWest:2048,ResizeWest:4096,ResizeNorthWest:8192,ResizeNorth:16384,Shadow:32768,DragLabel:65536,AllowPan:131072,AspectRatio:262144,Default:32766};t.datavisualization.Diagram.ConnectorConstraints={None:1,Select:2,Delete:4,Drag:8,DragSourceEnd:16,DragTargetEnd:32,DragSegmentThumb:64,Bridging:128,DragLabel:256,InheritBridging:512,Default:638};t.datavisualization.Diagram.PortConstraints={None:1,Connect:2};t.datavisualization.Diagram.SelectorConstraints={None:1,Rotator:2,Resizer:4,UserHandles:8,All:14};t.datavisualization.Diagram.UserHandlePositions={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",MiddleLeft:"middleleft",MiddleRight:"middleright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"};t.datavisualization.Diagram.SnapConstraints={None:0,SnapToHorizontalLines:1,SnapToVerticalLines:2,SnapToLines:3,ShowHorizontalLines:4,ShowVerticalLines:8,ShowLines:12,All:15};t.datavisualization.Diagram.PageOrientations={Landscape:"landscape",Portrait:"portrait"};t.datavisualization.Diagram.ScrollLimit={Infinity:"infinity",Diagram:"diagram",Limited:"limited"};t.datavisualization.Diagram.LayoutOrientations={TopToBottom:"toptobottom",BottomToTop:"bottomtotop",LeftToRight:"lefttoright",RightToLeft:"righttoleft"};t.datavisualization.Diagram.PaletteDefaults={name:"",expanded:!1,subControlId:null,items:[]};t.datavisualization.Diagram.Palette=function(i,r){if(i.items)for(var u=0;u<i.items.length;u++)i.items[u]=i.items[u].isLane?t.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(i.items[u],r.nameTable):i.items[u].segments?t.datavisualization.Diagram.Connector(i.items[u]):i.items[u].isGroup||i.items[u].type=="group"?t.datavisualization.Diagram.Group(i.items[u]):t.datavisualization.Diagram.Node(i.items[u]);return n.extend(!0,{},t.datavisualization.Diagram.PaletteDefaults,i)};t.datavisualization.Diagram.Shapes={Rectangle:"rectangle",Ellipse:"ellipse",Image:"image",Text:"text",Path:"path",Polygon:"polygon",Html:"html",Native:"native"};t.datavisualization.Diagram.ShapeDefaults={type:t.datavisualization.Diagram.Shapes.Rectangle,cornerRadius:0,src:"",pathData:"",textBlock:null,points:[],html:"",content:null};t.datavisualization.Diagram.Shape=function(i){return i&&(i.type==="html"&&typeof i.html=="string"&&(i.html=t.datavisualization.Diagram.Util.htmlEncode(i.html)),i.type==="text"&&i.textBlock&&(i.textBlock=t.datavisualization.Diagram.TextBlock(i.textBlock))),n.extend(!0,{},t.datavisualization.Diagram.ShapeDefaults,i)};t.datavisualization.Diagram.Segments={Straight:"straight",Orthogonal:"orthogonal",Bezier:"bezier"};t.datavisualization.Diagram.SegmentDefaults={type:t.datavisualization.Diagram.Segments.Straight,_startPoint:null,_endPoint:null,points:[],point1:null,point2:null,vector1:null,vector2:null,_point1:t.datavisualization.Diagram.Point(),_point2:t.datavisualization.Diagram.Point(),length:null,_length:null,_bridges:[],direction:null,_direction:null};t.datavisualization.Diagram.Segment=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.SegmentDefaults,i);return r.points=[],r.type=="orthogonal"?(r._length=r.length,r._direction=r.direction):(r.type=="bezier"&&(r._point1=r.point1,r._point2=r.point2),r._point=r.point),r};t.datavisualization.Diagram.MarginDefaults={top:0,left:0,right:0,bottom:0};t.datavisualization.Diagram.Margin=function(i){return n.extend(!0,{},t.datavisualization.Diagram.MarginDefaults,i)};t.datavisualization.Diagram.Path=function(){this._path=""};t.datavisualization.Diagram.Path.prototype={moveTo:function(n,t){return this._path+="M"+n+","+t,this},lineTo:function(n,t){return this._path+="L"+n+","+t,this},cubicBezierTo:function(n,t){return this._path+=t?"S":"C",this._addPoints(n),this},quadraticBezierTo:function(n,t){return this._path+=t?"T":"Q",this._addPoints(n),this},ellipticalArcTo:function(n,t,i,r,u,f,e){return this._path+="A"+n+","+t+" "+i+" "+r+","+u+" "+f+","+e,this},close:function(){return this._path+="Z",this},toString:function(){return this._path},_addPoints:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._path+=i.x+", "+i.y,t!==n.length-1&&(this._path+=" ")}};t.datavisualization.Diagram.DecoratorDefaults={shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""};t.datavisualization.Diagram.Decorator=function(i){return n.extend(!0,{},t.datavisualization.Diagram.DecoratorDefaults,i)};t.datavisualization.Diagram.TextBlockDefaults={readOnly:!1,bold:!1,italic:!1,text:"",textDecoration:t.datavisualization.Diagram.TextDecorations.None,fontSize:12,fontFamily:"Arial",fontColor:"black",offset:t.datavisualization.Diagram.Point(.5,.5),textAlign:t.datavisualization.Diagram.TextAlign.Center,horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,wrapText:!0,margin:t.datavisualization.Diagram.Margin(),mode:t.datavisualization.Diagram.LabelEditMode.Edit,width:50,rotateAngle:0};t.datavisualization.Diagram.TextBlock=function(i){return n.extend(!0,{},t.datavisualization.Diagram.TextBlockDefaults,i)};t.datavisualization.Diagram.LabelDefaults=n.extend(!0,{},t.datavisualization.Diagram.TextBlockDefaults,{name:"",visible:!0,borderColor:"transparent",borderWidth:0,fillColor:"transparent"});t.datavisualization.Diagram.Label=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,i);return r.horizontalAlignment=="center"&&(r.margin.left=0),r.verticalAlignment=="center"&&(r.margin.top=0),r};t.datavisualization.Diagram.PortDefaults={name:"",visibility:t.datavisualization.Diagram.PortVisibility.Default,constraints:t.datavisualization.Diagram.PortConstraints.Connect,size:8,offset:t.datavisualization.Diagram.Point(0,0),borderColor:"#1a1a1a",borderWidth:1,fillColor:"white",shape:t.datavisualization.Diagram.PortShapes.Square,pathData:""};t.datavisualization.Diagram.Port=function(i){return n.extend(!0,{},t.datavisualization.Diagram.PortDefaults,i)};t.datavisualization.Diagram.StopDefaults={color:"",offset:0,opacity:1};t.datavisualization.Diagram.Stop=function(i){return n.extend(!0,{},t.datavisualization.Diagram.StopDefaults,i)};t.datavisualization.Diagram.LinearGradientDefaults={type:"linear",x1:0,x2:0,y1:0,y2:0,stops:[]};t.datavisualization.Diagram.LinearGradient=function(i){for(var r=0;r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!0,{},t.datavisualization.Diagram.LinearGradientDefaults,i)};t.datavisualization.Diagram.RadialGradientDefaults={type:"radial",cx:0,cy:0,fx:0,fy:0,r:50,stops:[]};t.datavisualization.Diagram.RadialGradient=function(i){for(var r=0;r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!0,{},t.datavisualization.Diagram.RadialGradientDefaults,i)};t.datavisualization.Diagram.NodeBaseDefaults={name:"",width:0,height:0,offsetX:0,offsetY:0,visible:!0,zOrder:0,excludeFromLayout:!1,constraints:t.datavisualization.Diagram.NodeConstraints.Default,parent:"",labels:[],ports:[],inEdges:[],outEdges:[],rotateAngle:0,pivot:t.datavisualization.Diagram.Point(.5,.5),addInfo:{},marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0};t.datavisualization.Diagram.NodeBase=function(i){var r;if(i.labels)for(r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]);if(i.ports)for(r=0;r<i.ports.length;r++)i.ports[r]=t.datavisualization.Diagram.Port(i.ports[r]);return n.extend(!0,{},t.datavisualization.Diagram.NodeBaseDefaults,i)};t.datavisualization.Diagram.NodeDefaults={fillColor:"white",borderColor:"black",borderWidth:1,borderDashArray:"",opacity:1,gradient:null,shape:t.datavisualization.Diagram.Shape(),isExpanded:!0};t.datavisualization.Diagram.Node=function(i){return i.gradient&&(i.gradient.type==="linear"?i.gradient=t.datavisualization.Diagram.LinearGradient(i.gradient):i.gradient.type==="radial"&&(i.gradient=t.datavisualization.Diagram.RadialGradient(i.gradient))),i.shape&&(i.shape=t.datavisualization.Diagram.Shape(i.shape)),i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,n.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.NodeBase(i))};t.datavisualization.Diagram.ConnectorDefaults={name:"",visible:!0,lineDashArray:"",targetDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},segments:[t.datavisualization.Diagram.Segment({type:"straight"})],sourcePoint:t.datavisualization.Diagram.Point(),targetPoint:t.datavisualization.Diagram.Point(),lineColor:"black",lineWidth:1,constraints:t.datavisualization.Diagram.ConnectorConstraints.Default,opacity:1,parent:"",labels:[],zOrder:0,lineHitPadding:10,addInfo:{},targetNode:null,targetPort:null,sourceNode:null,sourcePort:null,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,cornerRadius:0,bridgeSpace:15};t.datavisualization.Diagram.Connector=function(i){if(i.targetDecorator=t.datavisualization.Diagram.Decorator(i.targetDecorator||{}),i.sourceDecorator=t.datavisualization.Diagram.Decorator(i.sourceDecorator||{shape:t.datavisualization.Diagram.DecoratorShapes.None}),i.segments=i.segments||[t.datavisualization.Diagram.Segment({type:"straight"})],i.segments.length&&(i.sourcePoint=i.sourcePoint||t.datavisualization.Diagram.Point(),i.targetPoint=i.targetPoint||t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initializeSegments(i,i.defaultType)),i.labels)for(var r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]);return n.extend(!0,{},t.datavisualization.Diagram.ConnectorDefaults,i)};t.datavisualization.Diagram.ContainerDefaults={type:t.datavisualization.Diagram.ContainerType.Canvas,orientation:"vertical"};t.datavisualization.Diagram.Container=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ContainerDefaults,i)};t.datavisualization.Diagram.GroupDefaults={isGroup:!0,children:[],canUngroup:!0,allowDrop:!0,container:null,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0};t.datavisualization.Diagram.Group=function(i){return i=i?i:null,i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.container=i.container?t.datavisualization.Diagram.Container(i.container):null,i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",n.extend(!0,{},t.datavisualization.Diagram.GroupDefaults,t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.NodeBase(i))};t.datavisualization.Diagram.ZoomCommand={ZoomIn:1,ZoomOut:2};t.datavisualization.Diagram.Zoom=function(i){return n.extend(!0,{},{zoomFactor:.2,focusPoint:null,zoomCommand:t.datavisualization.Diagram.ZoomCommand.ZoomIn},i)};t.datavisualization.Diagram.DiagramConstraints={None:1,PageEditable:2,Bridging:4,Zoomable:8,PannableX:16,PannableY:32,Pannable:48,Undoable:64,Default:122};t.datavisualization.Diagram.Tool={None:1,SingleSelect:2,MultipleSelect:4,ZoomPan:8,DrawOnce:16,ContinuesDraw:32};t.datavisualization.Diagram.ConnectorType={StraightLine:"straightLine",OrthogonalLine:"orthogonalLine"};t.datavisualization.Diagram.UserHandleDefaults={name:"",pathData:"",borderColor:"",backgroundColor:"#2382c3",position:t.datavisualization.Diagram.UserHandlePositions.BottomCenter,pathColor:"white",tool:"",size:20,visible:!0,enableMultiSelection:!1};t.datavisualization.Diagram.UserHandle=function(i){return n.extend(!0,{},t.datavisualization.Diagram.UserHandleDefaults,i)};t.datavisualization.Diagram.SwimLaneDefaults={header:{width:30,text:""},fillColor:"transparent",orientation:"vertical",isGroup:!0,isSwimlane:!0,offsetX:100,offsetY:100,minHeight:100,maxHeight:100,minWidth:100,maxWidth:100,lanes:[],phases:[]};t.datavisualization.Diagram.SwimLane=function(i){return n.extend(!0,{},t.datavisualization.Diagram.SwimLaneDefaults,i)};t.datavisualization.Diagram.LaneDefaults={header:{width:30,text:""},name:"",children:[],isLane:!0,orientation:"horizontal"};t.datavisualization.Diagram.Lane=function(i){return n.extend(!0,{},t.datavisualization.Diagram.LaneDefaults,i)};t.datavisualization.Diagram.phaseDefaults={name:"",type:"phase",offset:0,lineWidth:1,lineDashArray:"",lineColor:"black",parent:"",orientation:""};t.datavisualization.Diagram.phase=function(i){return n.extend(!0,{},t.datavisualization.Diagram.phaseDefaults,i)};t.datavisualization.Diagram.SwimLaneHelper={_initSwimLane:function(n,i,r){var o=null,c=null,y=this._initphases(n,i),e,u,s,h,l,a,v,f;return c=this._initLanes(n,i,r),e=[],u=null,n.header||(n.header={text:"",height:0,fillColor:"white"}),n.orientation=="vertical"?s=n.header.height:h=n.header.width,n.header&&(u=t.datavisualization.Diagram.Node({type:"node",name:n.name+"_header_swimlane",labels:[{text:n.header.text?n.header.text:"",offset:{x:.5,y:.5},fontColor:n.header.fontColor?n.header.fontColor:"black",fontSize:n.header.fontSize?n.header.fontSize:12,fontFamily:n.header.fontFamily?n.header.fontFamily:"Arial",bold:n.header.bold?n.header.bold:!1,italic:n.header.italic?n.header.italic:!1,textDecoration:n.header.textDecoration?n.header.textDecoration:"none"},],height:s?s:50,width:h?h:50,fillColor:n.header.fillColor?n.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:n.name})),u&&(i.model.nodes.push(u),i.nameTable[u.name]=u,e.push(u.name)),l=null,a=null,n.orientation=="vertical"?a="stretch":l="stretch",v=n.orientation=="horizontal"?"vertical":"horizontal",f=t.datavisualization.Diagram.Group({name:n.name+"_stack",children:c,parent:n.name,container:{type:t.datavisualization.Diagram.ContainerType.Stack,orientation:v},horizontalAlign:"stretch",verticalAlign:"stretch",marginTop:n.header?n.header.height:50,width:400,height:400}),i.model.nodes.push(f),i.nameTable[f.name]=f,e.push(f.name),o=t.datavisualization.Diagram.Group({name:n.name?n.name:"",isGroup:!0,parent:"",offsetX:n.offsetX?n.offsetX:100,offsetY:n.offsetY?n.offsetY:100,children:e,fillColor:"transparent",container:{type:t.datavisualization.Diagram.ContainerType.Canvas},minHeight:n.height?n.height:100,maxHeight:n.maxHeight?n.maxHeight:1e3,minWidth:n.width?n.width:100,maxWidth:n.maxWidth?n.maxWidth:1e3,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest}),o.isSwimlane=!0,o},_initLanes:function(n,t,i){var f=[],r=null,u;if(n.lanes)for(u=0;u<n.lanes.length;u++)r=this._initLane(n.lanes[u],n,t,i),f.push(r.name),t.model.nodes.push(r),t.nameTable[r.name]=r;return f},_initLane:function(n,i,r,u){var s=null,h=null,f,e,c,o;for(i.orientation=="horizontal"?s="stretch":h="stretch",f=t.datavisualization.Diagram.Group({name:n.name,isGroup:!0,isLane:!0,parent:i.name+"_stack",offsetX:0,offsetY:0,borderColor:n.borderColor?n.borderColor:"black",orientation:i.orientation?i.orientation:"horizontal",fillColor:n.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:s?s:"left",verticalAlign:h?h:"top",minHeight:n.height?n.height:100,maxHeight:n.maxHeight?n.maxHeight:1e3,minWidth:n.width?n.width:100,maxWidth:n.maxWidth?n.maxWidth:1e3,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest^t.datavisualization.Diagram.NodeConstraints.Connect}),u||(e=this._iniLaneHeader(n,f.name,i,r),e&&(r.model.nodes.push(e),r.nameTable[e.name]=e,f.children.push(e.name))),c=this._initChildren(n,f.name,r),o=0;o<c.length;o++)f.children.push(c[o]);return f},_iniLaneHeader:function(n,i,r){var u=null;return n.header&&(u=t.datavisualization.Diagram.Node({name:i+n.header.text+"_Headerr_",type:"node",labels:[{text:n.header.text?n.header.text:"",offset:{x:.5,y:.5},width:100,rotateAngle:270,marginLeft:-10,fontColor:n.header.fontColor?n.header.fontColor:"black",fontSize:n.header.fontSize?n.header.fontSize:12,fontFamily:n.header.fontFamily?n.header.fontFamily:"Arial",bold:n.header.bold?n.header.bold:!1,italic:n.header.italic?n.header.italic:!1,textDecoration:n.header.textDecoration?n.header.textDecoration:"none"}],height:n.header.height?n.header.height:50,width:n.header.width?n.header.width:50,fillColor:n.header.fillColor?n.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20,parent:i}),r.orientation&&r.orientation=="horizontal"?u.verticalAlign="stretch":r.orientation&&r.orientation=="vertical"&&(u.horizontalAlign="stretch",u.labels[0].rotateAngle=0)),u},_initChildren:function(n,t,i){var f=[],r=null,u;if(n.children)for(u=0;u<n.children.length;u++)r=this._initChild(n.children[u],t,i),r.shape?i.model.nodes.push(r):r.isGroup||i.model.connectors.push(r),f.push(r.name),i.nameTable[r.name]=r;return f},_initChild:function(n,t,i){var r=null;return r=i._getNewNode(n),r.parent=t,r},_initphases:function(n,i){var f=[],r=null,u;if(i.model.phases||(i.model.phases=[]),n.phases&&n.phases.length>0)for(u=0;u<n.phases.length;u++)r=t.datavisualization.Diagram.phase(n.phases[u]),r.parent=n.name,r.orientation=n.orientation,i.model.phases.push(r),i.nameTable[r.name]=r,f.push(r.name);return f},_createSwimlane:function(n,i){for(var h,c,l,f=[],e=null,o=0;o<n.children.length;o++)e=i.nameTable[n.children[o]],e&&f.push(e);var a=i.nameTable,r=500,u=500,s=null;return n.children[0]?(h=a[n.children[0]],s={text:"HEADER",width:50,fillColor:h.fillColor,height:50}):s={text:"HEADER",width:50,fillColor:"white",height:50},n.orientation||n.container&&(n.orientation=n.container.orientation),n.orientation=="horizontal"?(r=n.height?n.height:100,u=n.width?n.width:650):(r=n.height?n.height:650,u=n.width?n.width:100),c={name:n.name,header:s,fillColor:"white",minWidth:u,minHeight:r,height:r+1,width:u+1,maxHeight:r+1e3,maxWidth:u+1e3,offsetX:n.offsetX,offsetY:n.offsetY,orientation:n.orientation?n.orientation:"horizontal",lanes:[{name:n.name+"_canvas",header:{text:"HEADER",width:50,fillColor:h.fillColor},fillColor:n.fillColor?n.fillColor:"white",height:120,children:f?f:[]},]},l=this._initSwimLane(t.datavisualization.Diagram.SwimLane(c),i,!1),l},_createDiagramLane:function(n,i){var r=0,u=0,f,e,h=0;n.orientation=="horizontal"?(r=120,u=450,f="stretch",e="top",h=50):n.orientation=="vertical"&&(r=450,u=120,f="left",e="stretch",h=50);var c=i[n.children[1]],o=t.datavisualization.Diagram.Group({name:n.name,isGroup:!0,isLane:!0,borderColor:"black",offsetX:n.offsetX,offsetY:n.offsetY,fillColor:c.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:f?f:"left",verticalAlign:e?e:"top",minHeight:r?r:100,maxHeight:1e3,minWidth:u?u:100,orientation:n.orientation?n.orientation:"horizontal",maxWidth:1e3,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest^t.datavisualization.Diagram.NodeConstraints.Connect}),l=i[n.children[0]],a={header:{text:"HEADER",width:h,fillColor:l.fillColor}},s=this._iniLaneHeader(a,o.name,{orientation:n.orientation},null);return s.name=o.name+"_Headerr_",i[s.name]=s,o.children.push(s.name),o},_createPaletteLane:function(n,i){var r=0,u=0,f=0,e=0,c=0,l="left",a,o,s,h;return n.orientation=="horizontal"?(r=n.height?n.height:50,u=25,f=15,e=r/2,c=270,l="left"):n.orientation=="vertical"&&(r=25,u=n.width?n.width:50,f=u/2,e=15,l="left"),a=n.header.text?n.header.text:"",o=t.datavisualization.Diagram.Node({name:n.name+"_"+a,type:"node",labels:[{text:n.header.text?n.header.text:"",fontSize:10,offset:{x:.5,y:.5},width:100,rotateAngle:c}],height:r,width:u,fillColor:n.header.fillColor?n.header.fillColor:"white",parent:n.name,offsetX:f,offsetY:e,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Connect}),i[o.name]=o,n.orientation=="horizontal"?(r=n.height,u=n.width-25,f=25+u/2,e=r/2):n.orientation=="vertical"&&(r=n.height-25,u=n.width,f=u/2,e=25+r/2),s=t.datavisualization.Diagram.Node({name:n.name+"content",type:"node",height:r,width:u,fillColor:n.fillColor?n.fillColor:"white",parent:n.name,offsetX:f,offsetY:e}),i[s.name]=s,h=t.datavisualization.Diagram.Group({name:n.name+"_group",height:n.height,width:n.width,offsetX:n.offsetX,offsetY:n.offsetY,children:[o.name,s.name,]}),h.isLane=!0,h.orientation=n.orientation,h}}}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function n(n){return this.xmlns="http://www.w3.org/2000/svg",this.document=document.createElementNS(this.xmlns,"svg"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return n.prototype.element=function(n,i){var r;return n&&n.id&&(r=this.document.getElementById(n.id)),r||(r=document.createElementNS(this.xmlns,i)),n&&t.datavisualization.Diagram.Util.attr(r,n),r},n.prototype.g=function(n){return this.element(n,"g")},n.prototype.defs=function(n){return this.element(n,"defs")},n.prototype.image=function(n){return this.element(n,"image")},n.prototype.path=function(n){return this.element(n,"path")},n.prototype.text=function(n){return this.element(n,"text")},n.prototype.textPath=function(n){return this.element(n,"textPath")},n.prototype.tspan=function(n){return this.element(n,"tspan")},n.prototype.rect=function(n){return this.element(n,"rect")},n.prototype.ellipse=function(n){return this.element(n,"ellipse")},n.prototype.circle=function(n){return this.element(n,"circle")},n.prototype.line=function(n){return this.element(n,"line")},n.prototype.polyline=function(n){return this.element(n,"polyline")},n.prototype.polygon=function(n){return this.element(n,"polygon")},n.prototype.foreignObject=function(n){return this.element(n,"foreignObject")},n.prototype.linearGradient=function(n){return this.element(n,"linearGradient")},n.prototype.radialGradient=function(n){return this.element(n,"radialGradient")},n.prototype.stop=function(n){return this.element(n,"stop")},n.prototype.filter=function(n){return this.element(n,"filter")},n.prototype.feGaussianBlur=function(n){return this.element(n,"feGaussianBlur")},n.prototype.feBlend=function(n){return this.element(n,"feBlend")},n.prototype.feOffset=function(n){return this.element(n,"feOffset")},n.prototype.feColorMatrix=function(n){return this.element(n,"feColorMatrix")},n.prototype.pattern=function(n){return this.element(n,"pattern")},n.prototype.appendChild=function(n){this.document.appendChild(n)},n.prototype.removeChild=function(n,t){t?t.removeChild(n):this.document.removeChild(n)},n.prototype.getElementById=function(n){return this.document.getElementById(n)},n.prototype.getElementsByClassName=function(n){return this.document.getElementsByClassName(n)},n.prototype.getElementsByTagName=function(n){return this.document.getElementsByTagName(n)},n.prototype.pathBounds=function(n){var r={d:n},t=this.path(r),i;return this.document.appendChild(t),i=t.getBBox(),this.document.removeChild(t),i},n.prototype.textBounds=function(n,t,i){var u=null,r;return n&&t?(r=this.text(t),r.appendChild(document.createTextNode(n)),this.document.appendChild(r),u=r.getBBox(),this.document.removeChild(r)):i&&(this.document.appendChild(i),u=i.getBBox(),this.document.removeChild(i)),u},n.prototype.absolutePath=function(n){for(var t,e,l,a,o,s,h,c,f=n.pathSegList,i=0,r=0,u=0,v=f.numberOfItems;u<v;++u){if(t=f.getItem(u),e=t.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(e))"x"in t&&(i=t.x),"y"in t&&(r=t.y);else{"x1"in t&&(o=i+t.x1);"x2"in t&&(h=i+t.x2);"y1"in t&&(s=r+t.y1);"y2"in t&&(c=r+t.y2);"x"in t&&(i+=t.x);"y"in t&&(r+=t.y);switch(e){case"m":f.replaceItem(n.createSVGPathSegMovetoAbs(i,r),u);break;case"l":f.replaceItem(n.createSVGPathSegLinetoAbs(i,r),u);break;case"h":f.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(i),u);break;case"v":f.replaceItem(n.createSVGPathSegLinetoVerticalAbs(r),u);break;case"c":f.replaceItem(n.createSVGPathSegCurvetoCubicAbs(i,r,o,s,h,c),u);break;case"s":f.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(i,r,h,c),u);break;case"q":f.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(i,r,o,s),u);break;case"t":f.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(i,r),u);break;case"a":f.replaceItem(n.createSVGPathSegArcAbs(i,r,t.r1,t.r2,t.angle,t.largeArcFlag,t.sweepFlag),u);break;case"z":case"Z":i=l;r=a}}(e==="M"||e==="m")&&(l=i,a=r)}return n},n}();t.datavisualization.Diagram.Svg=i;t.datavisualization.Diagram.SvgContext={_renderDocument:function(n,i){if(window.SVGSVGElement){var u={id:n.canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute"},r=new t.datavisualization.Diagram.Svg(u);n.svg=r;i&&(i._svg=r,n.canvas.appendChild(r.document),i._view=this._renderView(n.canvas,n.svg),i._page=this._renderPage(n.canvas,n.svg,i._view),i._htmlLayer=this._renderHtmlLayer(n.canvas),this._renderBackground(n.canvas,n.svg,i._page,i.model),i._pageBackgroundLayer=this._renderBackgroundLayer(n.canvas,n.svg,i._page),this._renderGrid(n.canvas,n.svg,i._page,i),i._diagramLayer=n.diagramLayer=this._renderDiagramLayer(n.canvas,n.svg,i._page),i._adornerLayer=this._renderAdornerLayer(n.canvas,n.svg,i._page))}},_renderView:function(n,t){var r={id:n.id+"_view"},i=t.g(r);return t.appendChild(i),i},_renderHtmlLayer:function(n){var i=document.createElement("div"),u={id:n.id+"_htmlLayer","class":"htmlLayer"},r;return t.datavisualization.Diagram.Util.attr(i,u),r=i,i.style.pointerEvents="none",n.appendChild(r),r},_renderPage:function(n,t,i){var u={id:n.id+"_page","class":"page"},r=t.g(u);return i.appendChild(r),r},_renderDiagramLayer:function(n,t,i){var u={id:n.id+"_diagramLayer","class":"DiagramLayer"},r=t.g(u);return i.appendChild(r),r},_renderAdornerLayer:function(n,t,i){var u={id:n.id+"_adornerLayer","class":"AdornerLayer"},r=t.g(u);return i.appendChild(r),r},_renderBackgroundLayer:function(n,t,i){var u={id:n.id+"_pageBackground","class":"PageBackgroundLayer",style:"pointer-events:none;"},r=t.g(u);return i.appendChild(r),r},_renderBackground:function(n,t,i,r){var e,u,f,o;t.document.style.msTouchAction="none";t.document.style.display="block";t.document.style.backgroundColor="white";e={id:n.id+"_backgroundLayer"};u=t.g(e);e={id:n.id+"_background",x:"0",y:"0",width:"100%",height:"100%",preserveAspectRatio:"none","pointer-events":"none"};f=t.image(e);r.backgroundImage?(f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r.backgroundImage),t.getElementById(n.id+"_background")||u.appendChild(f)):t.getElementById(f.id)&&u.removeChild(t.getElementById(f.id));o=t.rect({id:n.id+"_backgroundColor",x:"0",y:"0",width:"100%",height:"100%",fill:r.backgroundColor,preserveAspectRatio:"none","pointer-events":"none"});r.backgroundColor?t.getElementById(n.id+"_backgroundColor")||u.appendChild(o):t.getElementById(o.id)&&u.removeChild(t.getElementById(o.id));t.getElementById(u.id)||i.appendChild(u)},_renderGrid:function(n,i,r,u){var a=i.defs({id:n.id+"patterndefinition"}),e,h,c,l,f,o,v,s;if(i.appendChild(a),u.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines||u.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines){var s=document.getElementById(n.id+"_grid"),v=document.getElementById(n.id+"pattern_gridline"),o=document.getElementById(n.id+"pattern_grid");o&&a.removeChild(o);h={id:n.id+"_grid","pointer-events":"none"};e=i.g(h);c=0;u.model.snapSettings.horizontalGridLines.linesInterval&&u.model.snapSettings.horizontalGridLines.linesInterval.forEach(function(n){c+=n});l=0;u.model.snapSettings.verticalGridLines.linesInterval&&u.model.snapSettings.verticalGridLines.linesInterval.forEach(function(n){l+=n});f=u._currZoom;h={id:n.id+"pattern_grid",x:0,y:0,width:l*f,height:c*f,patternUnits:"userSpaceOnUse"};o=i.pattern(h);f=this._scaleSnapInterval(u.model,f);this._renderHorizontalGridlines(f,o,l,u.model,i);this._renderVerticalGridlines(f,o,c,u.model,i);a.appendChild(o);v=i.rect({id:n.id+"pattern_gridline",x:u._hScrollOffset,y:u._vScrollOffset,width:"100%",height:"100%",fill:"url(#"+n.id+"pattern_grid)"});e.appendChild(v);s||r.appendChild(e)}else e=document.getElementById(n.id+"_grid"),e&&(s=document.getElementById(n.id+"pattern_gridline"),s&&e.removeChild(s))},_updateBackground:function(n,i,r,u){var e={x:n,y:i},o=document.getElementById(u._id+"_canvas_backgroundColor"),f;o&&t.datavisualization.Diagram.Util.attr(o,e);f=document.getElementById(u._id+"_canvas_background");f&&t.datavisualization.Diagram.Util.attr(f,e)},_updateGrid:function(n,i,r,u){var l=document.getElementById(u._canvas.id+"pattern_gridline"),f,e,o,s,a,c,h;if(l){if(e=document.getElementById(u._canvas.id+"pattern_grid"),o=0,u.model.snapSettings.horizontalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.horizontalGridLines.linesInterval.length;f++)o+=u.model.snapSettings.horizontalGridLines.linesInterval[f];if(s=0,u.model.snapSettings.verticalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.verticalGridLines.linesInterval.length;f++)s+=u.model.snapSettings.verticalGridLines.linesInterval[f];h={x:n,y:i};t.datavisualization.Diagram.Util.attr(l,h);r=this._scaleSnapInterval(u.model,r);a=u._svg;c=a.defs({id:u._canvas.id+"patterndefinition"});e&&c.removeChild(e);h={id:u._canvas.id+"pattern_grid",x:0,y:0,width:o*r,height:s*r,patternUnits:"userSpaceOnUse"};e=u._svg.pattern(h);this._renderHorizontalGridlines(r,e,o,u.model,u._svg);this._renderVerticalGridlines(r,e,s,u.model,u._svg);c.appendChild(e)}},_scaleSnapInterval:function(n,t){if(t>=2)while(t>=2)t/=2;else if(t<=.5)while(t<=.5)t*=2;var i;if(t!==1){for(n.snapSettings.horizontalGridLines._snapinterval=[],i=0;i<n.snapSettings.horizontalGridLines.snapInterval.length;i++)n.snapSettings.horizontalGridLines._snapinterval[i]=n.snapSettings.horizontalGridLines.snapInterval[i]*t;for(n.snapSettings.verticalGridLines._snapinterval=[],i=0;i<n.snapSettings.verticalGridLines.snapInterval.length;i++)n.snapSettings.verticalGridLines._snapinterval[i]=n.snapSettings.verticalGridLines.snapInterval[i]*t}return t},_renderHorizontalGridlines:function(n,i,r,u,f){var o=u.snapSettings,s,c,e,h,l;if(o.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines)for(s=0,c=0,e=0;e<o.horizontalGridLines.linesInterval.length;e=e+2)h=o.horizontalGridLines.linesInterval[e],l=f.line({x1:s*n,y1:0,x2:s*n,y2:r*n,stroke:o.horizontalGridLines.lineColor,"stroke-width":h}),s+=o.horizontalGridLines.linesInterval[e+1]+h,i.appendChild(l),c++},_renderVerticalGridlines:function(n,i,r,u,f){var o=u.snapSettings,s,c,e,h,l;if(o.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines)for(s=0,c=0,e=0;e<o.verticalGridLines.linesInterval.length;e=e+2)h=u.snapSettings.verticalGridLines.linesInterval[e],l=f.line({x1:0,y1:s*n,x2:r*n,y2:s*n,stroke:o.verticalGridLines.lineColor,"stroke-width":h,"stroke-dasharray":o.verticalGridLines.lineDashArray}),s+=o.verticalGridLines.linesInterval[e+1]+h,i.appendChild(l),c++},transformView:function(n,i,r){var u=n._view,f={transform:"translate("+i+","+r+")"};t.datavisualization.Diagram.Util.attr(u,f);t.browserInfo().name==="msie"&&n._htmlLayer&&n._htmlLayer.children.length>0&&(n._htmlLayer.style.left=i+"px",n._htmlLayer.style.top=r+"px",n._htmlLayer.style.position="absolute")},scaleContent:function(n,i){var u=n._diagramLayer,r;t.datavisualization.Diagram.Util.attr(u,{transform:"scale("+i+")"});t.browserInfo().name==="msie"&&n._htmlLayer&&n._htmlLayer.children.length>0&&(n._htmlLayer.style.transform="scale("+i+")");n.selectionList.length>0&&this.updateSelector(n.selectionList[0],n._svg,i,n,n.model.selectorConstraints);n.selectionList[0]&&n.model.userHandles&&n.model.userHandles.length>0&&(r=!1,n.selectionList[0].isPseudoGroup&&(r=!0),n.model.selectorConstraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&t.datavisualization.Diagram.SvgContext.updateUserHandles(n.model.userHandles,n.selectionList[0],n._svg,r,!1,i))},setSize:function(n,i,r){t.datavisualization.Diagram.Util.attr(n.document,{width:i+"px",height:r+"px"})},_findIndex:function(t,i){var r,f=1,e,u;return u=i.parent?n("#"+i.parent.name).find(">.node,>.connector,>.group"):n("#DiagramContent_canvas_svg").find(">.node,>.connector,>.group"),i.name!="helper"&&(r=u[u.length-1],r&&r.id=="helper"&&(r=u[u.length-2]),r&&(e=0,r.className.animVal=="ej-d-node"||r.className.animVal=="ej-d-group"?f=e+1:r.className.animVal=="ej-d-connector"&&(f=e+1))),f},renderNode:function(n,t,i){var r,u=n.name,f=n.visible?"visible":"hidden",e=n.offsetX-n.width*n.pivot.x,o=n.offsetY-n.height*n.pivot.y;return r=t.g({id:u,"class":"ej-d-node",transform:"rotate("+n.rotateAngle+","+n.offsetX+","+n.offsetY+"),translate("+e+","+o+")",visibility:f}),i?i.appendChild(r):t.appendChild(r),this._renderNode(n,t,r),r},_renderNode:function(n,t,i){this._renderShape(n,t,i);this._renderLabels(n,t,i);this._renderPorts(n,t,i)},_renderShadow:function(n,t){var r=this._renderFilter(n,t),i;i=n.type=="image"||n.type=="html"||n.type=="text"?t.document.getElementById(n.name+"_backrect"):t.document.getElementById(n.name+"_shape");i.setAttribute("filter",r)},_removeShadow:function(n,t){if(n.type=="image"||n.type=="html"||n.type=="text")var i=t.document.getElementById(n.name+"_backrect");else i=t.document.getElementById(n.name+"_shape");i.removeAttribute("filter")},renderphase:function(n,i,r,u){var e,c,v,y;e=i.g({id:n.name,"class":"ej-d-sepetator"});n.parent?r.appendChild(e):i.appendChild(e);var p="visible",s=0,h=0,l=u.nameTable[n.parent];if(l){l.children.length>1&&(c=u.nameTable[l.children[0]]);var f=t.datavisualization.Diagram.Util.bounds(l),o=[],a,w=f.top+50,b=f.left+50;n.orientation=="vertical"?(o.push({x:0,y:0}),o.push({x:f.width,y:0}),a=this._convertToSVGPoints(o),s=f.x,h=f.y+n.offset,c&&(w+=c.height),h<f.bottom&&h>w||(p="hidden")):(o.push({x:0,y:c.height?c.height:0}),o.push({x:0,y:f.height}),a=this._convertToSVGPoints(o),s=f.x+n.offset,h=f.y,s<f.right&&s>b||(p="hidden"));v={id:n.name+"_phase",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,points:a};y=i.polyline(v);e.appendChild(y);v={id:n.name+"_phase_hitTest","stroke-width":10,points:a,stroke:"transparent"};y=i.polyline(v);e.appendChild(y);e.setAttribute("transform","translate("+s+","+h+")")}},_renderGroupBackground:function(n,i,r){if(n.fillColor!="none"){var u=n.offsetX-n.width/2,f=n.offsetY-n.height/2,o=n.rotateAngle,e=new t.datavisualization.Diagram.Point(u+n.width/2,f+n.height/2),s={id:n.name+"_shape",rx:n.shape.cornerRadius,ry:n.shape.cornerRadius,width:Math.round(n.width),height:Math.round(n.height),fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+o+","+e.x+","+e.y+"),translate("+u+","+f+")"};i.appendChild(r.rect(s))}},renderGroup:function(n,t,i,r,u,f,e){var o,a=n.visible?"visible":"hidden",c,h,l,s;for(o=t.g({id:n.name,"class":"ej-d-group",visibility:a}),i?i.appendChild(o):t.appendChild(o),n.parent==""&&n.container&&((f||e)&&(n.height=0,n.width=0),this._alignOnContainer(n,u)),this._renderGroupBackground(n,o,t),c=n.children,h=0,l=c.length;h<l;h++)s=r[c[h]],s&&(s.isGroup?this.renderGroup(s,t,o,r,u):s.segments?this.renderConnector(s,t,o):this.renderNode(s,t,o));return this._renderLabels(n,t,o),this._renderPorts(n,t,o),o},_alignOnContainer:function(n,t,i){switch(n.container&&n.container.type){case"canvas":var r=n.rotateAngle;n.rotateAngle==0&&r==0||(n.parent==""?n.rotateAngle=0:t._rotate(n,-r,t.nameTable));this._alignOnCanvasContainer1(n,t,i);n.rotateAngle==0&&r==0||t._rotate(n,r,t.nameTable);break;case"stack":this._alignOnStackContainer(n,t)}},_removeFromContainer:function(n,t){var i=t.getElementById(n.name);i&&i.parentNode.removeChild(i)},_childrenBounds:function(n,i){var f=n.children,r=new t.datavisualization.Diagram.Rectangle,u,o,e;for(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[f[0]]),u=1,o=f.length;u<o;u++)e=t.datavisualization.Diagram.Util.bounds(i.nameTable[f[u]],i),e&&(r=i._union(r,e));return r},_alignOnCanvasContainer1:function(n,t,i){var r=this._measureCanvasSize1(n,t),u=t._getMinMaxSize(n,r.width,r.height,i);n.width=u.width;n.height=u.height;this._alignOnCanvas1(n,t)},_alignOnCanvas1:function(n,i,r){for(var e,u=null,f=0;f<n.children.length;f++)u=i.nameTable[n.children[f]],u&&(e=this._getCanvasPosition1(n,u,i,r),i._translate(u,e.x,e.y,i.nameTable),t.datavisualization.Diagram.SpatialUtil._updateQuad(i,i._spatialSearch,u))},_getCanvasPosition1:function(n,i,r,u){var c=null,h=null,e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util.bounds(i),p,l,a,v,f,s,w,d,b,k,y;switch(i.horizontalAlign){case"left":c=e.x-o.x+i.marginLeft+n.paddingLeft;break;case"center":c=e.x+e.width/2-(o.x+o.width/2);i.marginLeft&&(h=e.x-o.x+i.marginLeft+n.paddingLeft);break;case"right":c=e.x+e.width-(o.x+o.width+n.paddingRight);break;case"stretch":s=i.rotateAngle;i.rotateAngle==0||s!=0||r._rotate(i,-i.rotateAngle,r.nameTable);p=(n.width-n.paddingLeft-n.paddingRight-i.marginLeft-i.marginRight)/i.width;r.scale(i,p,0,n.pivot,r.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);o=t.datavisualization.Diagram.Util.bounds(i,r);c=e.x+n.paddingLeft-o.x+i.marginLeft;i.rotateAngle==0||s!=0||r._rotate(i,s,r.nameTable);i.container&&i.container.type=="stack"&&(l=t.datavisualization.Diagram.Util._getChildrenBounds(i,r.nameTable,r),a=r.nameTable[i.name].width,l.width<a&&(v=a-l.width-n.paddingLeft-n.paddingRight,f=r.nameTable[i.children[i.children.length-1]],f&&(f.width+=v,f.offsetX+=v/2,f.minWidth=f.width,u&&f.container&&f.container.type=="canvas"&&this._alignOnCanvas1(f,r))))}switch(i.verticalAlign){case"top":h=e.y-o.y+i.marginTop+n.paddingTop;break;case"center":h=e.y+e.height/2-(o.y+o.height/2)+i.marginTop;i.marginTop&&(h=e.y-o.y+i.marginTop+n.paddingTop);break;case"bottom":h=e.y+e.height-(o.y+o.height+n.paddingBottom);break;case"stretch":s=i.rotateAngle;d=t.datavisualization.Diagram.Util.bounds(i);i.rotateAngle==0||s!=0||r._rotate(i,-i.rotateAngle,r.nameTable);w=i.height==0?1:i.height;b=(n.height-n.paddingTop-n.paddingBottom-i.marginTop-i.marginBottom)/w;r.scale(i,0,b,n.pivot,r.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);o=t.datavisualization.Diagram.Util.bounds(i,r);h=e.y+n.paddingTop-o.y+i.marginTop;i.rotateAngle==0||s!=0||r._rotate(i,s,r.nameTable);i.container&&i.container.type=="stack"&&(l=t.datavisualization.Diagram.Util._getChildrenBounds(i,r.nameTable,r),k=r.nameTable[i.name].height,y=k-l.height- -n.paddingTop-n.paddingBottom,f=r.nameTable[i.children[i.children.length-1]],f&&(f.height+=y,f.offsetY+=y/2,f.minHeight=f.height,u&&f.container&&f.container.type=="canvas"&&this._alignOnCanvas1(f,r)))}return{x:c,y:h}},_measureCanvasSize1:function(n,i){for(var f,r=null,u=t.datavisualization.Diagram.Rectangle(0,0,0,0),e=t.datavisualization.Diagram.Rectangle(0,0,0,0),o=0;o<n.children.length;o++)r=i.nameTable[n.children[o]],r&&(r.isGroup?(this._alignOnContainer(r,i),f=t.datavisualization.Diagram.Util.bounds(r),u=t.datavisualization.Diagram.Geometry.rect([f.topLeft,f.topRight,f.bottomRight,f.bottomLeft]),u.y=0,u.x=0,r.rotateAngle==0&&(u.width=f.width,u.height=f.height)):(f=t.datavisualization.Diagram.Util.bounds(r),u=t.datavisualization.Diagram.Geometry.rect([f.topLeft,f.topRight,f.bottomRight,f.bottomLeft]),u.y=0,u.x=0)),r&&(r.container&&r.container.type=="stack"?(u.width+=r.marginLeft,u.height+=r.marginTop):(u.width+=r.marginLeft+r.marginRight,u.height+=r.marginTop+r.marginBottom)),u&&(e=i._union(u,e));return e.width+=n.paddingLeft+n.paddingRight,e.height+=n.paddingTop+n.paddingBottom,e},_updateMargin:function(n,i){if(i&&i.container&&i.container.type=="canvas"){var u=t.datavisualization.Diagram.Util.bounds(i),r=t.datavisualization.Diagram.Util.bounds(n);n.marginLeft=r.x-(u.x+i.paddingLeft);n.marginRight=u.x+i.width-(r.x+r.width)-i.paddingRight;n.marginTop=r.y-(u.y+i.paddingTop);n.marginBottom=u.y+i.height-(r.y+r.height)-i.paddingBottom}},_alignOnStackContainer:function(n,t){var u=n.rotateAngle,i,r;n.parent==""?n.rotateAngle=0:t._rotate(n,-u,t.nameTable);i=this._measureStackSize(n,t);r=t._getMinMaxSize(n,i.width,i.height);n.width=r.width;n.height=r.height;this._alignOnStack(n,t);t._rotate(n,u,t.nameTable)},_alignOnStack:function(n,i){for(var u,e,r=null,o=0,s=0,f=0;f<n.children.length;f++)r=i.nameTable[n.children[f]],r&&(u=r.rotateAngle,r.rotateAngle==0&&u==0||i._rotate(r,-r.rotateAngle,i.nameTable),e=this._getStackPosition(n,r,o,s,i),i._translate(r,e.x,e.y,i.nameTable),n.container.orientation=="vertical"?s+=r.height+r.marginTop+r.marginBottom:o+=r.width+r.marginLeft+r.marginRight,r.rotateAngle==0&&u==0||i._rotate(r,u,i.nameTable),t.datavisualization.Diagram.SpatialUtil._updateQuad(i,i._spatialSearch,r))},_getStackPosition:function(n,i,r,u,f){var e=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Util.bounds(i),s=null,h=null,c,l;if(n.container.orientation=="vertical"){h=e.y-o.y+u+i.marginTop+n.paddingTop;switch(i.horizontalAlign){case"left":s=e.x-o.x+i.marginLeft+n.paddingLeft;break;case"center":s=e.center.x-o.center.x;break;case"right":s=e.x+e.width-(o.x+o.width+n.paddingRight);break;case"stretch":c=(n.width-n.paddingLeft-n.paddingRight)/i.width;f.scale(i,c,1,n.pivot,f.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);o=t.datavisualization.Diagram.Util.bounds(i,f);s=e.x+n.paddingLeft-o.x}}else{s=e.x-o.x+r+i.marginLeft+n.paddingLeft;switch(i.verticalAlign){case"top":h=e.y-o.y+i.marginTop+n.paddingTop;break;case"center":h=e.center.y-o.center.y;break;case"bottom":h=e.y+e.height-(o.y+o.height+n.paddingBottom);break;case"stretch":l=(n.height-n.paddingTop-n.paddingBottom)/i.height;f.scale(i,1,l,n.pivot,f.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);o=t.datavisualization.Diagram.Util.bounds(i,f);h=e.y+n.paddingTop-o.y}}return{x:s,y:h}},_measureStackSize:function(n,i,r){for(var f=null,u=new t.datavisualization.Diagram.Rectangle,s=0,h=0,e=t.datavisualization.Diagram.Rectangle(0,0,0,0),o=0;o<n.children.length;o++)f=i.nameTable[n.children[o]],f&&(f.isGroup?(u=this._measureContainerSize(f,i,r),u.y=0,u.x=0):(u=t.datavisualization.Diagram.Util.bounds(f),u.y=0,u.x=0),u.width+=s+f.marginLeft+f.marginRight,u.height+=h+f.marginTop+f.marginBottom),u&&(e=i._union(u,e)),n.container.orientation=="horizontal"?s=u.width:h=u.height;return e.width+=n.paddingLeft+n.paddingRight,e.height+=n.paddingTop+n.paddingBottom,e},_measureContainerSize:function(n,i,r){if(n.isGroup&&n.container)switch(n.container.type){case"canvas":return this._alignOnContainer(n,i,r),t.datavisualization.Diagram.Util.bounds(n)}},_renderFilter:function(n,i){var r,e,o,s,h;if(n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){var c=i.getElementsByTagName("defs")[0],u=n.width+10,f=n.height+10;return t.browserInfo().name==="chrome"&&(u=n.width/3,f=n.height/3),r=i.filter({id:n.name+"_filter",width:u,height:f}),e=i.feOffset({result:"offOut","in":"SourceAlpha",dx:"5",dy:"5"}),r.appendChild(e),o=i.feColorMatrix({result:"matrixOut","in":"offOut",type:"matrix",values:"0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.3 0"}),r.appendChild(o),s=i.feGaussianBlur({result:"blurOut","in":"matrixOut",stdDeviation:"5"}),r.appendChild(s),h=i.feBlend({"in":"SourceGraphic",in2:"blurOut",mode:"normal"}),r.appendChild(h),c.appendChild(r),"url(#"+n.name+"_filter)"}return null},_renderGradient:function(n,t,i){var u,r;return t.type==="linear"?(r=this._renderLinearGradient(n,t,i),u="url(#"+r+")"):t.type==="radial"&&(r=this._renderRadialGradient(n,t,i),u="url(#"+r+")"),u},_renderLinearGradient:function(n,t,i){var u=i.getElementsByTagName("defs")[0],f,r;return u?(f={id:n+"_gradient",x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"},r=i.linearGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderRadialGradient:function(n,t,i){var u=i.getElementsByTagName("defs")[0],f,r;return u?(f={id:n+"_gradient",cx:t.cx+"%",cy:t.cy+"%",fx:t.fx+"%",fy:t.fy+"%",r:t.r+"%"},r=i.radialGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderStops:function(n,t,i){var f,r,u,e;if(t.getElementById(i.getAttribute("id"))===i)while(i.firstChild)i.removeChild(i.firstChild);for(f=n.stops,u=0,e=f.length;u<e;u++)r=f[u],i.appendChild(t.stop({offset:r.offset+"%","stop-color":r.color,"stop-opacity":r.opacity}))},_renderShape:function(n,t,i){switch(n.shape.type){case"rectangle":this._renderRect(n,t,i);break;case"ellipse":this._renderEllipse(n,t,i);break;case"image":this._renderImage(n,t,i);break;case"path":this._renderPath(n,t,i);break;case"polygon":this._renderPolygon(n,t,i);break;case"text":this._renderTextElement(n,t,i);break;case"html":this._renderHtmlElement(n,t,i);break;case"native":this._rendercontent(n,t,i)}},_rendercontent:function(n,t,i){var u;if(n.shape.content){typeof n.shape.content=="string"&&(u=document.getElementById(n.shape.content),n.shape.content=u.cloneNode(!0));n.shape.content instanceof SVGElement&&(n.shape.content=n.shape.content.cloneNode(!0));n.shape.content.setAttribute("preserveAspectRatio","none");i.appendChild(n.shape.content);var r=n.shape.content.getBBox(),f=r.width?n.width/r.width:1,e=r.height?n.height/r.height:1;n.shape.content.setAttribute("transform","scale("+f+","+e+")");n.shape.content.setAttribute("id",n.name+"_shape");n.shape.content.setAttribute("filter",this._renderFilter(n,t))}},_fill:function(n,t){var i;return n.gradient&&(i=this._renderGradient(n.name,n.gradient,t)),i||(i=n.fillColor),i},_renderRect:function(n,t,i){var r=this._fill(n,t),u={id:n.name+"_shape",rx:n.shape.cornerRadius,ry:n.shape.cornerRadius,width:n.width,height:n.height,fill:r,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,filter:this._renderFilter(n,t)};i.appendChild(t.rect(u))},_renderEllipse:function(n,t,i){var r=this._fill(n,t),u={id:n.name+"_shape",rx:n.width/2,ry:n.height/2,cx:n.width/2,cy:n.height/2,fill:r,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,filter:this._renderFilter(n,t)};i.appendChild(t.ellipse(u))},_renderImage:function(n,t,i){var e=n.fillColor,f=this._renderBackgroundRect(n,t),u,r;i.appendChild(f);u={id:n.name+"_shape",width:n.width,height:n.height,opacity:n.opacity,preserveAspectRatio:"none"};r=t.image(u);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n.shape.src);i.appendChild(r)},_renderPolygon:function(n,i,r){var e=this._fill(n,i),u,f;t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);u=this._convertToSVGPoints(n.shape.points);f={id:n.name+"_shape",fill:e,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,points:u,filter:this._renderFilter(n,i)};r.appendChild(i.polygon(f))},_renderPath:function(n,i,r){var e=this._fill(n,i),u=t.datavisualization.Diagram.Geometry.updatePath(0,0,n.width,n.height,n.shape.pathData,i),f;n._absolutePath=u;f={id:n.name+"_shape",width:n.width,height:n.height,d:u,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:e,filter:this._renderFilter(n,i)};r.appendChild(i.path(f))},_renderHtmlElement:function(n,i,r){var l=this._renderBackgroundRect(n,i),f,e,c,o,s;if(r.appendChild(l),n.shape.html){var a=n.offsetX-n.width*n.pivot.x,v=n.offsetY-n.height*n.pivot.y,u=document.createElement("div"),h="width:"+n.width+"px;height:"+n.height+"px;padding:1px; opacity:"+n.opacity+";left:"+a+"px; top:"+v+"px; ";t.browserInfo().name==="msie"&&(h+="display: block; position: absolute; border:0px;");f={id:n.name+"_html","class":"foreignObject",style:h};t.datavisualization.Diagram.Util.attr(u,f);n.shape.html instanceof HTMLElement?u.appendChild(n.shape.html):u.innerHTML=n.shape.html.toString();t.browserInfo().name==="msie"?(e=document.createElement("div"),c={id:n.name+"_parentdiv","class":"ej-d-node"},t.datavisualization.Diagram.Util.attr(e,c),e.appendChild(u),o=i.document.parentNode.getElementsByClassName("htmlLayer")[0],o?o.appendChild(e):i.document.parentNode.appendChild(u)):(f={id:n.name+"_shape",width:n.width,height:n.height,style:"pointer-events:none"},s=i.foreignObject(f),s.appendChild(u),r.appendChild(s))}},_initializeGuidelines:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderSideAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderCenterAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderSpacingLines:function(n,t,i,r,u){var e,o,f=r.g({}),s;n.x==t.x?(e="M"+(n.x*u-5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u+5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u+5)+" "+(t.y*u-5)+"z",f.appendChild(r.line({x1:n.x*u-8,x2:n.x*u+8,y1:n.y*u-1,y2:n.y*u-1,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u-8,x2:t.x*u+8,y1:t.y*u+1,y2:t.y*u+1,stroke:"#07EDE1","stroke-width":1}))):(e="M"+(n.x*u+5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u-5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u-5)+" "+(t.y*u+5)+"z",f.appendChild(r.line({x1:n.x*u-1,x2:n.x*u-1,y1:n.y*u-8,y2:n.y*u+8,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u+1,x2:t.x*u+1,y1:t.y*u-8,y2:t.y*u+8,stroke:"#07EDE1","stroke-width":1})));f.appendChild(r.path({d:e,fill:"#07EDE1"}));s=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":.6,fill:"#07EDE1"});f.appendChild(s);f.appendChild(r.path({d:o,fill:"#07EDE1"}));i.appendChild(f)},_removeGuidelines:function(n,t){t!=null&&n.removeChild(t)},update:function(n,t){var i=t._svg;n.isGroup?this.updateGroup(n,i,t):n.segments?this.updateConnector(n,i,t):this.updateNode(n,i,t)},_updateGoupBackground:function(n,i){var r=n.offsetX-n.width/2,u=n.offsetY-n.height/2,e=n.rotateAngle,f=new t.datavisualization.Diagram.Point(r+n.width/2,u+n.height/2),o={id:n.name+"_shape",rx:n.shape.cornerRadius,ry:n.shape.cornerRadius,width:n.width,height:n.height,fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+e+","+f.x+","+f.y+"),translate("+r+","+u+")"};i.getElementById(n.name+"_shape")&&t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_shape"),o)},updateGroup:function(n,t,i){var o=n.children,h=n.visible?"visible":"hidden",u,s,r,f,e;for(t.g({id:n.name,visibility:h}),u=0,s=o.length;u<s;u++)r=i.nameTable[o[u]],r&&(r.isGroup?this.updateGroup(r,t,i):r.segments?this.updateConnector(r,t,i):this.updateNode(r,t,i));if(this._updateGoupBackground(n,t),this._updateAssociatedConnector(n,t,i),this._updateLabels(n,t),this._updatePorts(n,t),n.isSwimlane&&i.model.phases&&i.model.phases.length>0)for(f=null,e=0;e<i.model.phases.length;e++)f=i.model.phases[e],f.parent==n.name&&this._updatephase(f,i)},_removephases:function(n,i){var r,u,f;if(n.isSwimlane&&i.model.phases&&i.model.phases.length>0)for(r=null,u=i.model.phases.length-1;u>=0;u--)r=i.model.phases[u],r&&(f=i._svg.getElementById(r.name+"_phase"),f.parentNode.removeChild(f),t.datavisualization.Diagram.Util.removeItem(i.model.phases,r))},_updatephase:function(i,r){var h=r.nameTable[i.parent],l,f;if(h){var e=0,o=0,a=null,s=[],c,u=t.datavisualization.Diagram.Util.bounds(h);h.children.length>1&&(l=r.nameTable[h.children[0]]);var y=u.top+50,p=u.left+50,v="visible";i.orientation=="vertical"?(e=u.x,o=u.y+i.offset,l&&(y+=l.height),o<u.bottom&&o>y?a="translate("+e+","+o+")":v="hidden",s.push({x:0,y:0}),s.push({x:u.width,y:0}),c=this._convertToSVGPoints(s)):(e=u.x+i.offset,o=u.y,e<u.right&&e>p?a="translate("+e+","+o+")":v="hidden",s.push({x:0,y:l.height}),s.push({x:0,y:u.height}),c=this._convertToSVGPoints(s));f={points:c,id:i.name+"_phase"};r._svg.polyline(f);f={points:c,id:i.name+"_phase_hitTest"};r._svg.polyline(f);f={id:i.name,transform:a,visibility:v};r._svg.g(f);r._svg.getElementById(f.id)&&n("#"+f.id).insertAfter(n("#"+f.id)[0].parentNode.lastChild)}},updateLabelStyle:function(n,i,r){var u={};n&&r&&i&&(u["font-weight"]=i.bold?"bold":"",u["font-style"]=i.italic?"italic":"",i.textDecoration&&(u["text-decoration"]=i.textDecoration),u["font-family"]=i.fontFamily,u["font-size"]=i.fontSize,u.fill=i.fontColor);t.datavisualization.Diagram.Util.attr(r.getElementById(n.name+"_"+i.name),u)},_updateNodeStyle:function(n,i){var r,u;n&&i&&(r={},r.opacity=n.opacity,r.fill=n.fillColor,r.stroke=n.borderColor,r["stroke-width"]=n.borderWidth,r["stroke-dasharray"]=n.borderDashArray,n.gradient&&(r.fill=this._renderGradient(n.name,n.gradient,i)),u=n.shape.type=="text"?"_backRect":"_shape",t.browserInfo().name==="msie"&&n.shape&&n.shape.type=="html"||i.getElementById(n.name+u)&&t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+u),r))},_updateConnectorStyle:function(n,i){if(n&&i){var r={};r.stroke=n.lineColor;r["stroke-width"]=n.lineWidth;r["stroke-dasharray"]=n.lineDashArray;t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_segments"),r)}},updateTargetDecoratorStyle:function(n,i){if(i){var r={};r.stroke=n.targetDecorator.borderColor;r.fill=n.targetDecorator.fillColor;t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_targetDecorator"),r)}},updateSourceDecoratorStyle:function(n,i){if(i){var r={};r.stroke=n.sourceDecorator.borderColor;r.fill=n.sourceDecorator.fillColor;t.datavisualization.Diagram.Util.attr(i.getElementById(n.name+"_sourceDecorator"),r)}},updateNode:function(n,i,r){var u,f;n.shape.type==="html"&&t.browserInfo().name==="msie"?(u=document.getElementById(n.name+"_html").getBoundingClientRect(),f={x:u.left,y:u.top,width:u.width,height:u.height}):(u=i.getElementById(n.name+"_shape"),u&&(f=u.getBBox()));this._updateNode(n,i);this._updateAssociatedConnector(n,i,r);r.activeTool.inAction&&(r.activeTool.name==="move"||r.activeTool.name==="rotate")||(this._updateLabels(n,i),f&&(f&&f.width!=n.width||f.height!=n.height)&&this._updatePorts(n,i))},updateTextBlock:function(n,i,r){var u={},i=n.shape.textBlock;n.shape.textBlock=i;n&&r&&i&&(u["font-weight"]=i.bold?"bold":"",u["font-style"]=i.italic?"italic":"",i.textDecoration&&(u["text-decoration"]=i.textDecoration),u["font-family"]=i.fontFamily,u["font-size"]=i.fontSize,u.fill=i.fontColor);t.datavisualization.Diagram.Util.attr(r.getElementById(n.name+"_shape"),u);this._updateTextElement(n,r)},_updateAssociatedConnector:function(n,i,r){for(var u=0,f=n.inEdges.length;u<f;u++)r.nameTable[n.inEdges[u]]&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.inEdges[u]],r),t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.inEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.inEdges[u]]));for(u=0,f=n.outEdges.length;u<f;u++)r.nameTable[n.outEdges[u]]&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.outEdges[u]],r),t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.outEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.outEdges[u]]))},_updateNode:function(n,i){var e=n.offsetX-n.width*n.pivot.x,o=n.offsetY-n.height*n.pivot.y,s=n.rotateAngle,f=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),h=n.visible?"visible":"hidden",c={id:n.name,transform:"rotate("+s+","+f.x+","+f.y+"),translate("+e+","+o+")",visibility:h},u;i.g(c);switch(n.shape.type){case"rectangle":i.rect({id:n.name+"_shape",width:n.width,height:n.height});break;case"ellipse":i.ellipse({id:n.name+"_shape",rx:n.width/2,ry:n.height/2,cx:n.width/2,cy:n.height/2});break;case"image":this._updateBackgroundRect(n,i);i.image({id:n.name+"_shape",width:n.width,height:n.height});break;case"path":u=t.datavisualization.Diagram.Geometry.updatePath(0,0,n.width,n.height,n.shape.pathData,i);n._absolutePath=u;i.path({id:n.name+"_shape",d:u});break;case"polygon":this._updatePolygon(n,i);break;case"text":this._updateTextElement(n,i);break;case"html":this._updateHtmlElement(n,i);break;case"native":var r=n.shape.content.getBBox(),l=r.width?n.width/r.width:1,a=r.height?n.height/r.height:1;i.g({id:n.name+"_shape",width:n.width,height:n.height,transform:"scale("+l+","+a+")"})}},_updateHtmlElement:function(n,i){var r,u,f;this._updateBackgroundRect(n,i);t.browserInfo().name==="msie"?(u=n.offsetX-n.width*n.pivot.x,f=n.offsetY-n.height*n.pivot.y,r=document.getElementById(n.name+"_html"),r.style.left=u+"px",r.style.top=f+"px",r.style.transform="rotate("+n.rotateAngle+"deg)"):(r=i.getElementById(n.name+"_shape"),i.foreignObject({id:n.name,width:n.width,height:n.height}));r.style.width=n.width.toString()+"px";r.style.height=n.height.toString()+"px"},_updatePolygon:function(n,i){t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);i.polygon({id:n.name+"_shape",points:this._convertToSVGPoints(n.shape.points)})},_convertToSVGPoints:function(n){for(var i="",t=0,r=n.length;t<r;t++)i+=n[t].x+","+n[t].y+" ";return i.trim()},_renderTextElement:function(n,i,r){var u=n.shape.textBlock,s,e,f,o;u&&(s=this._renderBackgroundRect(n,i),r.appendChild(s),e={id:n.name+"_shape","class":"ej-d-label","font-family":u.fontFamily,"font-size":u.fontSize,fill:u.fontColor,"text-decoration":u.textDecoration,opacity:n.opacity,"alignment-baseline":"middle"},u.bold&&(e["font-weight"]="bold"),u.italic&&(e["font-style"]="italic"),f=i.text(e),f.appendChild(document.createTextNode(u.text)),r.appendChild(f),o=t.datavisualization.Diagram.Util.bounds(n),this._wrapText(n,o,f,n.shape.textBlock,i),this._alignTextOnLabel(n,o,f,n.shape.textBlock,i),this._renderShadow(n,i,r))},_updateTextElement:function(n,i){this._updateBackgroundRect(n,i);var r=i.getElementById(n.name+"_shape"),u=t.datavisualization.Diagram.Util.bounds(n);this._wrapText(n,u,r,n.shape.textBlock,i);this._alignTextOnLabel(n,u,r,n.shape.textBlock,i)},_renderBackgroundRect:function(n,t){var i=this._fill(n,t),r={id:n.name+"_backRect","class":"backrect",x:0,y:0,width:n.width,height:n.height,fill:i,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,filter:this._renderFilter(n,t)};return t.rect(r)},_updateBackgroundRect:function(n,t){var i={id:n.name+"_backRect",x:0,y:0,width:n.width,height:n.height};t.rect(i)},_hideNode:function(n,t){var i={id:n.name,style:"pointer-events:none;"};t.rect(i)},_showNode:function(n,t){var i={id:n.name,style:"pointer-events:auto;"};t.rect(i)},_drawContainerHelper:function(n){var i=n.activeTool.helper,o=n._svg,u=n._currZoom,r;i.segments&&(r=t.datavisualization.Diagram.Util.bounds(i));var f=i.height?i.height:r.height,e=i.width?i.width:r.width,s=i.offsetX?i.offsetX:r.x+r.width/2,h=i.offsetY?i.offsetY:r.y+r.height/2,c=i.rotateAngle?i.rotateAngle:0,l=o.rect({id:"helper","class":"helper","stroke-width":1,"stroke-dasharray":"3,3","pointer-events":"none",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+(s-e/2)*u+","+(h-f/2)*u+"),rotate("+c+","+e/2*u+","+f/2*u+")"});n._adornerLayer.appendChild(l)},_updateContainerHelper:function(n){var o=null,i=n.activeTool.helper,u=n._currZoom,r;i.segments&&(r=t.datavisualization.Diagram.Util.bounds(i));var f=i.height?i.height:r.height,e=i.width?i.width:r.width,s=i.offsetX?i.offsetX:r.x+r.width/2,h=i.offsetY?i.offsetY:r.y+r.height/2,c=i.rotateAngle?i.rotateAngle:0;o={id:"helper","class":"helper",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+(s-e/2)*u+","+(h-f/2)*u+"),rotate("+c+","+e/2*u+","+f/2*u+")"};n._svg.rect(o)},_removeContainerHelper:function(n,t,i){t.getElementById("helper")&&t.removeChild(t.getElementById("helper"),i)},setNodeShape:function(t,i,r){var u,f;r?(f=i.getElementById(r.name),u=n(f).find("#"+t.name)[0]):u=i.getElementById(t.name);n(u).empty();this._renderNode(t,i,u)},setLine:function(t,i,r){var u,f;r?(f=i.getElementById(r.name),u=n(f).find("#"+t.name)[0]):u=i.getElementById(t.name);n(u).empty();this.renderConnector(t,i,u)},addNodeLabel:function(t,i,r,u){var f,e;u?(e=r.getElementById(u.name),f=n(e).find("#"+t.name)[0]):f=r.getElementById(t.name);this._renderLabel(t,i,r,f)},renderConnector:function(n,t,i){var r,f=n.visible?"visible":"hidden",u;return r=t.g({id:n.name,"class":"ej-d-connector",visibility:f}),i?i.id!==r.id&&i.appendChild(r):t.appendChild(r),u=t.g({id:n.name+"segments"}),this._renderSegments(n,t,u),r.appendChild(u),this._renderLabels(n,t,r),this._renderDecorators(n,t,r),r},_renderSegments:function(n,i,r){var o=t.browserInfo().name==="msie"?"collapse":"hidden",e=this._findPath(n),u={id:n.name+"_segments",d:e,fill:"none",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,opacity:n.opacity},f=i.path(u);r.appendChild(f);u={id:n.name+"_hitTest","stroke-width":n.lineHitPadding,d:e,"pointer-events":"stroke",stroke:"transparent",visibility:o};f=i.path(u);r.appendChild(f)},_findPath:function(n){for(var u,c,l,r,o,i,s,h,f,e=0;e<n.segments.length;e++){if(u=n.segments[e],u._bridges.length>0)for(c=0;c<u._bridges.length;c++)l=u._bridges[c],l._rendered=!1;if(r=u.points,e==0&&(r=this._clipDecorators(n,u,!0),f="M"+r[0].x+" "+r[0].y),e==n.segments.length-1&&(r=this._clipDecorators(n,u,!1)),u.type!="bezier")if(n.cornerRadius>0)for(i=0;i<r.length-1;i++)o=t.datavisualization.Diagram.Geometry.distance(r[i],r[i+1]),o>0&&(h=e<n.segments.length-1||i<r.length-2?o<n.cornerRadius*2?this._adjustPoint(r[i],r[i+1],!1,o/2):this._adjustPoint(r[i],r[i+1],!1,n.cornerRadius):r[i+1],(e>0||i>0)&&(o<n.cornerRadius*2?(s=this._adjustPoint(r[i],r[i+1],!0,o/2),(e<n.segments.length-1||i<r.length-2)&&(h=null)):s=this._adjustPoint(r[i],r[i+1],!0,n.cornerRadius)),s&&(f+=" Q"+r[i].x+" "+r[i].y+" "+s.x+" "+s.y),h&&(u._bridges.length>0&&(f=this._updateBridging(u,f,i),u.type==="orthogonal"&&(f=this._updateBridging(u,f,i+1))),f+=" L"+h.x+" "+h.y));else for(i=0;i<r.length;i++)i>0&&(f=this._updateBridging(u,f,i)+(" L"+r[i].x+" "+r[i].y));else f+=" C"+u._point1.x+" "+u._point1.y+" "+u._point2.x+" "+u._point2.y+" "+u._endPoint.x+" "+u._endPoint.y}return f},_updateBridging:function(n,t,i){var f=t,u,r;if(n._bridges.length>0)if(n.type==="straight")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path);else if(n.type==="orthogonal")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r.segmentPointIndex!==i||r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path,r._rendered=!0);return f},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},_refreshSegments:function(n,t){this._updateConnector(n,t);this._updateDecorators(n,t)},_clipDecorators:function(i,r,u){var o=n.extend(!0,[],r.points),f,s,e,c,h;return!u&&i.targetDecorator&&i.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None?(f=o[o.length-1],s=o[o.length-2],e=t.datavisualization.Diagram.Geometry.distance(f,s),e=e==0?1:e,c=i.targetDecorator.width,h=t.datavisualization.Diagram.Point(),h.x=f.x+c*(s.x-f.x)/e,h.y=f.y+c*(s.y-f.y)/e,o[o.length-1]=h):i.sourceDecorator&&i.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=o[0],s=o[1],e=t.datavisualization.Diagram.Geometry.distance(f,s),e=e==0?1:e,c=i.sourceDecorator.width,h=t.datavisualization.Diagram.Point(),h.x=f.x+c*(s.x-f.x)/e,h.y=f.y+c*(s.y-f.y)/e,o[0]=h),o},_updateConnector:function(n,t){var i=this._findPath(n);t.path({id:n.name+"_segments",d:i});t.path({id:n.name+"_hitTest",d:i})},updateConnector:function(n,t){var i=n.visible?"visible":"hidden";t.g({id:n.name,visibility:i});this._updateConnector(n,t);this._updateLabels(n,t);this._updateDecorators(n,t)},renderDecorators:function(n,t){var i=t.getElementById(n.name);this._renderDecorators(n,t,i)},clearDecorators:function(n,t){this._updateConnector(n,t);var r=t.getElementById(n.name),i=t.getElementById(n.name+"_targetDecorator");i&&t.removeChild(i,r);i=t.getElementById(n.name+"_sourceDecorator");i&&t.removeChild(i,r)},_renderDecorators:function(n,t,i){var u,f,r;n.targetDecorator&&n.targetDecorator.shape&&(r=n.segments[n.segments.length-1],u=r.points[r.points.length-2],f=n.targetPoint,r.type=="bezier"&&(u=r._point2),this._renderDecorator(n.name+"_targetDecorator",f,u,n.targetDecorator,t,i));n.sourceDecorator&&n.sourceDecorator.shape&&(r=n.segments[0],u=n.sourcePoint,f=r.points[1],r.type=="bezier"&&(f=r._point1),this._renderDecorator(n.name+"_sourceDecorator",u,f,n.sourceDecorator,t,i))},_renderDecorator:function(n,i,r,u,f,e){var h,s,c,o=t.datavisualization.Diagram.Size(u.width,u.height),l,a;switch(u.shape){case"arrow":c=this._constructArrow(i,o);s={id:n,"class":"decorator",d:c,fill:u.fillColor,stroke:u.borderColor};h=f.path(s);break;case"openarrow":c=this._constructArrow(i,o,!0);s={id:n,"class":"decorator",d:c,fill:"transparent",stroke:u.borderColor};h=f.path(s);break;case"circle":l=o.width/2;a=o.height/2;s={id:n,"class":"decorator",rx:l,ry:a,cx:i.x+o.width/2,cy:i.y,fill:u.fillColor,stroke:u.borderColor};h=f.ellipse(s);break;case"diamond":c=this._constructDiamond(i,o,f);s={id:n,"class":"decorator",x:i.x,y:i.y,width:o.width,height:o.height,d:c,fill:u.fillColor,stroke:u.borderColor};h=f.path(s);break;case"path":c=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-o.height/2,o.width,o.height,u.pathData,f);s={id:n,"class":"decorator",x:i.x,y:i.y,width:o.width,height:o.height,d:c,fill:u.fillColor,stroke:u.borderColor};h=f.path(s)}h&&(h.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"),e.appendChild(h))},_updateDecorators:function(n,i){var u,f,r,e;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(r=n.segments[n.segments.length-1],e=r.points,u=e[e.length-2],f=n.targetPoint,r.type=="bezier"&&(u=r._point2),this._updateDecorator(n.name+"_targetDecorator",f,u,n.targetDecorator,i));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(r=n.segments[0],e=r.points,u=n.sourcePoint,f=e[1],r.type=="bezier"&&(f=r._point1),this._updateDecorator(n.name+"_sourceDecorator",u,f,n.sourceDecorator,i))},_updateDecorator:function(n,i,r,u,f){var h,o,s,e=t.datavisualization.Diagram.Size(u.width,u.height),c,l;switch(u.shape){case"arrow":s=this._constructArrow(i,e);o={id:n,d:s};h=f.path(o);break;case"openarrow":s=this._constructArrow(i,e,!0);o={id:n,d:s};h=f.path(o);break;case"circle":c=e.width/2;l=e.height/2;o={id:n,rx:c,ry:l,cx:i.x+e.width/2,cy:i.y};h=f.ellipse(o);break;case"diamond":s=this._constructDiamond(i,e,f);o={id:n,x:i.x,y:i.y,width:e.width,height:e.height,d:s};h=f.path(o);break;case"path":s=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-e.height/2,e.width,e.height,u.pathData,f);o={id:n,x:i.x,y:i.y,width:e.width,height:e.height,d:s};h=f.path(o)}h&&h.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")")},_constructArrow:function(n,i,r){var u=new t.datavisualization.Diagram.Path;return u.moveTo(n.x+i.width,n.y+i.height/2),u.lineTo(n.x,n.y),u.lineTo(n.x+i.width,n.y-i.height/2),r||u.close(),u.toString()},_constructDiamond:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x+i.width,n.y),r.lineTo(n.x+i.width/2,n.y+i.height/2),r.lineTo(n.x,n.y),r.lineTo(n.x+i.width/2,n.y-i.height/2),r.lineTo(n.x+i.width,n.y),r.toString()},_renderLabels:function(n,t,i){for(var u=n.labels,r=0,f=u.length;r<f;++r)this._renderLabel(n,u[r],t,i)},_renderLabelBackground:function(n,i,r,u){var f,e;return f=t.browserInfo().name==="mozilla"?r.getBoundingClientRect():r.getBBox(),e={id:i.name+"_"+n.name+"_lblbg",width:f.width,height:f.height,fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,transform:"translate(0,0)"},u.rect(e)},_renderLabel:function(n,i,r,u){var e={id:n.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.fontColor,"text-decoration":i.textDecoration,"dominant-baseline":"middle","pointer-events":"none"},f,s,o;i.bold&&(e["font-weight"]="bold");i.italic&&(e["font-style"]="italic");f=r.text(e);f.textContent=i.text;u.appendChild(f);s=this._renderLabelBackground(i,n,f,r);u.insertBefore(s,f);o=t.datavisualization.Diagram.Util.bounds(n);this._wrapText(n,o,f,i,r);this._alignTextOnLabel(n,o,f,i,r)},_updateLabels:function(n,i){for(var r,u,e,o=n.labels,f=0,s=o.length;f<s;++f)r=o[f],u=i.getElementById(n.name+"_"+r.name),u&&(u.setAttribute("fill",r.fontColor),e=t.datavisualization.Diagram.Util.bounds(n),this._wrapText(n,e,u,r,i),this._alignTextOnLabel(n,e,u,r,i))},updateLabel:function(n,i,r){var u=r.getElementById(n.name+"_"+i.name),f;u.setAttribute("fill",i.fontColor);u.textContent=i.text;f=t.datavisualization.Diagram.Util.bounds(n);this._wrapText(n,f,u,i,r);this._alignTextOnLabel(n,f,u,i,r)},_alignTextOnLabel:function(n,i,r,u,f){var s=r.getBBox(),o=t.datavisualization.Diagram.Util._getLabelPosition(u,i),e={x:0,y:0},h=0,c,l,a;h=u.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?o.y:u.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Center?o.y-s.height/2:o.y-s.height;e.y=h;switch(u.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(u.textAlign){case t.datavisualization.Diagram.TextAlign.Left:e.x=o.x;break;case t.datavisualization.Diagram.TextAlign.Center:e.x=o.x+s.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:e.x=o.x+s.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(u.textAlign){case t.datavisualization.Diagram.TextAlign.Left:e.x=o.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:e.x=o.x;break;case t.datavisualization.Diagram.TextAlign.Right:e.x=o.x+s.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(u.textAlign){case t.datavisualization.Diagram.TextAlign.Left:e.x=o.x-s.width;break;case t.datavisualization.Diagram.TextAlign.Center:e.x=o.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:e.x=o.x}}(n.segments||n.isGroup)&&(e.x=e.x+i.x,e.y=e.y+i.y,o.x+=i.x,o.y+=i.y);t.browserInfo().name==="mozilla"&&(e.y=e.y-u.fontSize/2);r.setAttribute("transform","translate("+e.x+","+e.y+"), rotate("+u.rotateAngle+","+(o.x-e.x)+","+(o.y-e.y)+")");c=f.getElementById(n.name+"_"+u.name+"_lblbg");c&&(l=e.x+s.x,h=e.y,t.browserInfo().name==="mozilla"&&(h=e.y+u.fontSize/2),a={width:s.width,height:s.height,transform:"translate("+l+","+h+"), rotate("+u.rotateAngle+","+(o.x-l)+","+(o.y-h)+")",fill:u.fillColor,stroke:u.borderColor,"stroke-width":u.borderWidth},t.datavisualization.Diagram.Util.attr(c,a))},_wrapText:function(n,t,i,r,u){for(var v=r.text,h,a,o,f,e,y,p,c,l,s;i.hasChildNodes();)i.removeChild(i.lastChild);if(n.segments?(h=t.width,a=t.height):(h=t.width-r.margin.left-r.margin.right,a=t.height-r.margin.top-r.margin.bottom),h=h<r.width?r.width:h,o=v.split("\n"),y="",u.getElementById(i.id)&&(c=u.getElementById(i.id).childNodes),c){for(e=0;e<o.length;e++)for(f=u.tspan(),f.style.fontSize=r.fontSize,i.appendChild(f),s=0;s<o[e].length;s++)l=c[c.length-1].getComputedTextLength(),r.wrapText?l>=h-r.fontSize?(f.textContent+=o[e][s],p=-l,s==o[e].length-1||(f=u.tspan(),i.appendChild(f))):f.textContent+=o[e][s]:f.textContent+=o[e][s];this._wrapTextAlign(i,c,r.fontSize,r.textAlign)}},_wrapTextAlign:function(n,i,r,u){for(var f,o,s,e=0;e<i.length;e++){f=i[e].getComputedTextLength();switch(u){case"left":f=0;break;case"center":f=-f/2;break;case"right":f=-f}o={x:Number(f),dy:r};s=i[e];t.datavisualization.Diagram.Util.attr(s,o)}},_renderPorts:function(n,i,r){for(var e,o=n.ports,u,f=0,s=o.length;f<s;++f)u=o[f],e=this._renderPort(n,u,i),r.appendChild(e),(u.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||u.visibility&t.datavisualization.Diagram.PortVisibility.Hover||u.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&e.setAttribute("visibility","hidden")},_renderPort:function(n,i,r){var e,u,o=t.datavisualization.Diagram.Size(i.size,i.size),f,s,h,c;f=n.isGroup?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);switch(i.shape){case"x":s=this._constructX(f,i.size);u={id:n.name+"_"+i.name,"class":"ej-d-port",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,d:s};e=r.path(u);break;case"circle":h=o.width/2;c=o.height/2;u={id:n.name+"_"+i.name,"class":"ej-d-port",rx:h,ry:c,cx:f.x,cy:f.y,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};e=r.ellipse(u);break;case"square":u={id:n.name+"_"+i.name,"class":"ej-d-port",x:f.x-i.size/2,y:f.y-i.size/2,width:o.width,height:o.height,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};e=r.rect(u)}return e},_insertPort:function(n,i,r){var f,u;f=document.getElementById(n.name);u=t.datavisualization.Diagram.SvgContext._renderPort(n,i,r);f.appendChild(u);(i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&u.setAttribute("visibility","hidden")},_updatePort:function(n,i,r){var e=t.datavisualization.Diagram.Size(i.size,i.size),u=null,f,o,s,h;u=n.isGroup?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);f=n.name+"_"+i.name;switch(i.shape){case"x":o=this._constructX(u,i.size);r.path({id:f,d:o});break;case"circle":s=e.width/2;h=e.height/2;r.ellipse({id:f,rx:s,ry:h,cx:u.x,cy:u.y});break;case"square":r.rect({id:f,x:u.x-i.size/2,y:u.y-i.size/2})}},_updatePorts:function(n,t){for(var u,r=n.ports,i=0,f=r.length;i<f;++i)u=r[i],this._updatePort(n,u,t)},_constructX:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x-i/2,n.y-i/2),r.lineTo(n.x+i/2,n.y+i/2),r.moveTo(n.x+i/2,n.y-i/2),r.lineTo(n.x-i/2,n.y+i/2),r.toString()},_enableSelectedNode:function(n,t,i){var u,r,e,f,o;if(n.isPseudoGroup)for(u=n.children,r=0,e=u.length;r<e;r++)f=i[u[r]],f&&this._enableSelectedNode(f,t);else o={id:n.name,"pointer-events":"auto",style:"pointer-events:block"},t.g(o)},_disableSelectedNode:function(n,t,i){var u,r,e,f,o;if(n.isPseudoGroup)for(u=n.children,r=0,e=u.length;r<e;r++)f=i[u[r]],f&&this._disableSelectedNode(f,t);else o={id:n.name,style:"pointer-events:none","pointer-events":"none"},t.g(o)},_drawNodeHighlighter:function(n,i,r,u){var f,o=n.offsetX-n.width*n.pivot.x,s=n.offsetY-n.height*n.pivot.y,e=t.datavisualization.Diagram.Point(n.offsetX-n.width*n.pivot.x+n.width/2,n.offsetY-n.height*n.pivot.y+n.height/2),h="rotate("+n.rotateAngle+","+e.x*u+","+e.y*u+")",c={id:"nodeHighlighter","class":"ej-d-node",x:o*u,y:s*u,width:n.width*u,height:n.height*u,fill:"transparent",stroke:"red","stroke-width":3,"pointer-events":"none",transform:h,style:"pointer-events: none"};return f=i.rect(c),r.appendChild(f),f},_removeNodeHighlighter:function(n,t){var i=n.getElementById("nodeHighlighter");i&&n.removeChild(i,t)},_drawPortHighlighter:function(n,i,r,u,f){var l,o,e,h,c,a,s,v="#8CC63F",w="#1A1A1A",b=.5,y,p,k;return n?(o=t.datavisualization.Diagram.Size(n.size*2,n.size*2),e=t.datavisualization.Diagram.Util._getPortPosition(n,t.datavisualization.Diagram.Util.bounds(i,!0)),p=t.Matrix.identity(),t.Matrix.rotate(p,i.rotateAngle,i.offsetX,i.offsetY),e=t.Matrix.transform(p,e),h=(e.x-n.size)*f,c=(e.y-n.size)*f,a="rotate(0,"+(h+o.width/2)+","+(c+o.height/2)+")"):(s=t.datavisualization.Diagram.Util.bounds(i,!0),o=t.datavisualization.Diagram.Size(s.width,s.height),e=t.datavisualization.Diagram.Point(s.x,s.y),h=e.x*f,c=e.y*f,w=v,v="transparent",b=2,y=t.datavisualization.Diagram.Point(i.offsetX-i.width*i.pivot.x+i.width/2,i.offsetY-i.height*i.pivot.y+i.height/2),a="rotate("+i.rotateAngle+","+y.x*f+","+y.y*f+")"),k={id:"portHighlighter","class":"ej-d-port",x:h,y:c,width:o.width*f,height:o.height*f,fill:v,stroke:w,"stroke-width":b,"pointer-events":"none",transform:a},l=r.rect(k),u.appendChild(l),l},_removePortHighlighter:function(n,t){var i=n.getElementById("portHighlighter");i&&n.removeChild(i,t)},renderSelector:function(n,t,i,r,u){var f;n.segments?(f=t.g({id:t.document.id+"handle_g","class":"handle"}),i.appendChild(f),this._renderEndPointHandle(n,t,r)):(f=t.g({id:t.document.id+"handle_g","class":"handle",transform:"translate("+(n.offsetX-n.width/2)*r+","+(n.offsetY-n.height/2)*r+"),rotate("+n.rotateAngle+","+n.width/2*r+","+n.height/2*r+")"}),i.appendChild(f),this._renderResizeHandle(n,t,r,u))},_renderResizeHandle:function(n,i,r,u){var f=t.datavisualization.Diagram.Point(n.width/2,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&(this._renderPivotLine(n,i,r),this._renderRotateThumb("rotate",n,f.x,f.y,r,i));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._renderResizeBorder("resizeBorder",n,i,r),this._renderResizeCorner("nw-resize",n,0,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest)),this._renderResizeCorner("n-resize",n,n.width/2*r,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth)),this._renderResizeCorner("ne-resize",n,n.width*r,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast)),this._renderResizeCorner("w-resize",n,0,n.height/2*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest)),this._renderResizeCorner("e-resize",n,n.width*r,n.height/2*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast)),this._renderResizeCorner("sw-resize",n,0,n.height*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest)),this._renderResizeCorner("s-resize",n,n.width/2*r,n.height*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth)),this._renderResizeCorner("se-resize",n,n.width*r,n.height*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast)))},renderUserHandles:function(n,t,i,r,u,f){for(var e=0;e<n.length;e++)(r&&n[e].enableMultiSelection||!r)&&n[e].visible&&this._renderUserHandle(n[e],t,i,u,f)},_renderUserHandle:function(n,i,r,u,f){var o=r.g({id:r.document.id+"userHandle_g","class":"userHandle"});f.appendChild(o);var e=this._getHandlePosition(n,i,u),s=t.datavisualization.Diagram.Geometry.updatePath(e.x*u-n.size/4,e.y*u-n.size/4,n.size/2,n.size/2,n.pathData,r),h=this._getHandleShape(n,e.x*u,e.y*u),c=this._getHandleIcon(n,s,e.x,e.y);o.appendChild(r.circle(h));o.appendChild(r.path(c))},_getHandleIcon:function(n,t){return{id:n.name+"_icon","class":"userHandle-icon",d:t,fill:n.pathColor}},_getHandlePosition:function(n,i,r){var s=t.Matrix.identity();i.rotateAngle&&t.Matrix.rotate(s,0);var f=t.datavisualization.Diagram.Point(),e=t.datavisualization.Diagram.Util.bounds(i),h=n.position,o=10,u=new t.datavisualization.Diagram.Point;switch(h){case"topleft":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(o+n.size/2,o+n.size/2));f.x=e.topLeft.x-u.x/r;f.y=e.topLeft.y-u.y/r;break;case"topcenter":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(0,o+n.size/2));f.x=e.topCenter.x-u.x/r;f.y=e.topCenter.y-u.y/r;break;case"topright":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(o+n.size/2,o/2-n.size));f.x=e.topRight.x+u.x/r;f.y=e.topRight.y+u.y/r;break;case"middleleft":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(-(o+n.size/2),0));f.x=e.middleLeft.x+u.x/r;f.y=e.middleLeft.y+u.y/r;break;case"middleright":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(o+n.size/2,0));f.x=e.middleRight.x+u.x/r;f.y=e.middleRight.y+u.y/r;break;case"bottomleft":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(-(o+n.size/2),o+n.size/2));f.x=e.bottomLeft.x+u.x/r;f.y=e.bottomLeft.y+u.y/r;break;case"bottomcenter":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(0,o/2-n.size));f.x=e.bottomCenter.x-u.x/r;f.y=e.bottomCenter.y-u.y/r;break;case"bottomright":u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(o+n.size/2,o+n.size/2));f.x=e.bottomRight.x+u.x/r;f.y=e.bottomRight.y+u.y/r}return f},_getHandleShape:function(n,t,i){return{id:n.name+"_shape","class":"userHandle",cx:t,cy:i,r:n.size/2,fill:n.backgroundColor,stroke:n.borderColor,"stroke-width":n.borderWidth,title:n.name}},_updateHandleShape:function(n,t,i,r){var u={id:n.name+"_shape",cx:t,cy:i};r.circle(u)},_updateHanleIcon:function(n,t,i){var r={id:n.name+"_icon",d:t};i.path(r)},_getHanleIcon:function(n,t){return{id:n.name,d:t,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:n.fillColor}},renderPivotPoint:function(n,i,r){r.getElementById("pivot")||(t.datavisualization.Diagram.SvgContext._renderResizeCorner("pivot",n,n.offsetX*i,n.offsetY*i,r),this._updatePivotLine(n,r,i))},_renderPivotLine:function(n,i,r){if(!n.container){var u=t.datavisualization.Diagram.Point(n.width/2,-20/r),f=t.datavisualization.Diagram.Point(n.width/2,0),e=i.getElementById(i.document.id+"handle_g"),o=i.line({id:"pivotLine",x1:u.x*r,y1:u.y*r,x2:f.x*r,y2:f.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"2,3",fill:"none"});e.appendChild(o)}},_renderResizeBorder:function(n,t,i,r){var u=i.getElementById(i.document.id+"handle_g"),f=i.rect({id:n,width:t.width*r,height:t.height*r,stroke:"#097F7F","stroke-width":.6,"stroke-dasharray":"6,3",fill:"none"});u.appendChild(f)},_renderResizeCorner:function(n,i,r,u,f,e){var c=f.getElementById(f.document.id+"handle_g"),s="default",h="white",o;t.datavisualization.Diagram.Util.canResize(i)||(h="darkgray");e&&(h="darkgray",s="none");o={id:n,fill:h,stroke:"black","stroke-width":1,cx:r,cy:u,r:7,"pointer-events":s};c.appendChild(f.circle(o));o={id:n+"_transparent","class":n,fill:"transparent",cx:r,cy:u,r:10,"pointer-events":s};c.appendChild(f.circle(o))},_renderRotateThumb:function(n,i,r,u,f,e){if(!i.container){var h=e.getElementById(e.document.id+"handle_g"),c="#231f20";t.datavisualization.Diagram.Util.canRotate(i)||(c="darkgray");var o=20,s=20,l={id:"rotatehandle","class":n,fill:c,stroke:"black","stroke-width":.5,width:o,height:s,d:"M 16.856 10.239 L 18 3.438 l -2.189 0.817 c -0.974 -1.694 -2.482 -2.995 -4.326 -3.696 C 9.375 -0.245 7.071-0.18 5.01 0.744 C 2.942 1.668 1.365 3.342 0.558 5.453 c -0.803 2.115 -0.738 4.414 0.185 6.478 c 0.925 2.064 2.6 3.645 4.714 4.45 c 0.969 0.371 1.993 0.554 3.013 0.554 c 1.345 0 2.685 -0.317 3.897 -0.948 l -1.016 -1.962 c -1.584 0.822-3.445 0.929 -5.114 0.293 c -1.56 -0.596 -2.793 -1.762 -3.479 -3.289 C 2.078 9.502 2.031 7.803 2.622 6.244 C 3.216 4.68 4.387 3.443 5.914 2.761 C 7.437 2.079 9.137 2.03 10.7 2.626 c 1.246 0.475 2.271 1.328 2.986 2.424 L 11.54 5.851 L 16.856 10.239 Z",transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"},a=e.path(l),v=e.circle({id:"rotate","class":n,fill:"transparent",stroke:"none",cx:o/2,cy:s/2,r:13,transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"});h.appendChild(a);h.appendChild(v)}},_refreshEndPointHandles:function(t,i,r){if(t.segments){var u=i.getElementById(i.document.id+"handle_g");n(u).empty();this._renderEndPointHandle(t,i,r)}},_renderEndPointHandle:function(n,i,r){for(var u,e,o,f=0;f<n.segments.length;f++)u=n.segments[f],u.type=="bezier"&&(e=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),this._renderBezierLine("bezierline1",u._startPoint,u._point1,r,i),this._renderBezierLine("bezierline2",u._endPoint,u._point2,r,i),this._renderEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,e),this._renderEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,e)),o=u.points,f==0&&this._renderEndPointCorner("sourceEndPoint",u._startPoint.x*r,u._startPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),f==n.segments.length-1?(this._renderEndPointCorner("targetEndPoint",u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._renderTerminalOrthoThumbs(u,i,r,f)):u.type!="orthogonal"?this._renderSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._renderTerminalOrthoThumbs(u,i,r,f)},_renderTerminalOrthoThumbs:function(n,i,r,u,f){var e,s,o;if(n.points.length>2)for(e=0;e<n.points.length-1;e++)o=t.datavisualization.Diagram.Geometry.distance(n.points[e],n.points[e+1]),f=n.points[e].y==n.points[e+1].y?"horizontal":"vertical",s=o>=50?"visible":"hidden",this._renderOrthogonalThumb("OrthoThumb_"+e+"_"+u,(n.points[e].x+n.points[e+1].x)/2*r,(n.points[e].y+n.points[e+1].y)/2*r,i,s,f);else o=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),s=o>=50?"visible":"hidden",f=n._startPoint.y==n._endPoint.y?"horizontal":"vertical",this._renderOrthogonalThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,s,f)},_renderEndPointCorner:function(n,t,i,r,u,f){var s=u.getElementById(u.document.id+"handle_g"),e=r?"#8CC63F":"white",o;f||(e="darkgray");o={id:n,"class":n,opacity:.75,fill:e,stroke:"black","stroke-width":2,cx:t,cy:i,r:7};s.appendChild(u.circle(o))},_renderSegmentEndThumb:function(n,t,i,r,u){var f=u.getElementById(u.document.id+"handle_g"),e={id:n,"class":"segmentEnd",fill:"#e2e2e2",stroke:"black","stroke-width":2,cx:t,cy:i,r:5};f.appendChild(u.circle(e))},_renderOrthogonalThumb:function(n,t,i,r,u,f){var e,o,s;f=="horizontal"?(e="M0,7 L15,0 L30,7 L15,14 z",o=-15,s=-7):(e="M7,0 L0,15 L7,30 L14,15 z",o=-7,s=-15);var h=r.getElementById(r.document.id+"handle_g"),c={id:n,"class":"segmentEnd",fill:"#e2e2e2",stroke:"black","stroke-width":1,d:e,transform:"translate("+(t+o)+","+(i+s)+")",visibility:u};h.appendChild(r.path(c))},_renderBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"3,3",fill:"none"}),e=u.getElementById(u.document.id+"handle_g");e.appendChild(f)},_renderControlPointCorner:function(n,t,i,r){var u=r.g({"class":n}),f;r.getElementById(r.document.id+"handle_g").appendChild(u);f={id:n+"_"+i,fill:"white",stroke:"black","stroke-width":2,cx:t.x,cy:t.y,r:5};u.appendChild(r.circle(f))},_removePivotPoint:function(n,t,i){var r=t.getElementById(t.document.id+"handle_g");r!=null&&t.getElementById("pivot")&&(r.removeChild(t.getElementById("pivot")),this._updatePivotLine(n,t,i))},updateSelector:function(n,i,r,u,f){var o,e;n.segments?(this._updateEndPointHandle(n,i,r),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(u.model.userHandles,n,i,!1,!1,r)):(o=i.g({id:i.document.id+"handle_g",transform:"translate("+(n.offsetX-n.width/2)*r+","+(n.offsetY-n.height/2)*r+"),rotate("+n.rotateAngle+","+n.width/2*r+","+n.height/2*r+")"}),this._updateResizeHandle(n,i,r,f),u.model.userHandles&&u.model.userHandles.length>0&&(e=!1,u.selectionList[0]&&u.selectionList[0].name=="multipleSelection"&&(e=!0),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(u.model.userHandles,n,i,e,!1,r)))},_updateResizeHandle:function(n,i,r,u){var e=n._corners,f=t.datavisualization.Diagram.Point(n.width/2,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&(this._updateRotateHandle("rotate",f.x,f.y,r,i,n),this._updatePivotLine(n,i,r));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._updateResizeCorner("nw-resize",0,0,i),this._updateResizeCorner("n-resize",n.width/2*r,0,i),this._updateResizeCorner("ne-resize",n.width*r,0,i),this._updateResizeCorner("w-resize",0,n.height/2*r,i),this._updateResizeCorner("e-resize",n.width*r,n.height/2*r,i),this._updateResizeCorner("sw-resize",0,n.height*r,i),this._updateResizeCorner("s-resize",n.width/2*r,n.height*r,i),this._updateResizeCorner("se-resize",n.width*r,n.height*r,i),this._updateResizeBorder("resizeBorder",n,i,r))},_updateRotateHandle:function(n,t,i,r,u){var f=20,e=20,o={id:"rotatehandle",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"};u.path(o);u.circle({id:"rotate",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"})},_updatePivotLine:function(n,i,r){var u=t.datavisualization.Diagram.Point(n.width/2,-20/r),f=t.datavisualization.Diagram.Point(n.width/2,0),e=i.line({id:"pivotLine",x1:u.x*r,y1:u.y*r,x2:f.x*r,y2:f.y*r})},_updateResizeBorder:function(n,t,i,r){i.rect({id:n,width:t.width*r,height:t.height*r})},_updateResizeCorner:function(n,t,i,r){var u={id:n,cx:t,cy:i};r.circle(u);u={id:n+"_transparent",cx:t,cy:i};r.circle(u)},_updateEndPointHandle:function(n,i,r){for(var u,e,o,f=0;f<n.segments.length;f++)u=n.segments[f],e=u.points,f==n.segments.length-1?(this._updateEndPointCorner("targetEndPoint",e[e.length-1].x*r,e[e.length-1].y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._updateTerminalOrthoThumbs(u,i,r,f)):u.type!="orthogonal"?this._updateSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._updateTerminalOrthoThumbs(u,i,r,f),f==0&&this._updateEndPointCorner("sourceEndPoint",e[0].x*r,e[0].y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),u.type=="bezier"&&(o=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),this._updateEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,o),this._updateEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,o),this._updateBezierLine("bezierline1",u._startPoint,u._point1,r,i),this._updateBezierLine("bezierline2",u._endPoint,u._point2,r,i))},_updateEndPointCorner:function(n,t,i,r,u,f){var e=r?"#8CC63F":"white",o;f||(e="darkgray");o={id:n,fill:e,cx:t,cy:i};u.circle(o)},_updateSegmentEndThumb:function(n,t,i,r,u){var f={id:n,cx:t,cy:i};u.circle(f)},_updateOrthoThumb:function(n,t,i,r,u,f){var e,o,s,h;f=="horizontal"?(e="M0,7 L15,0 L30,7 L15,14 z",o=-15,s=-7):(e="M7,0 L0,15 L7,30 L14,15 z",o=-7,s=-15);h={id:n,visibility:u,transform:"translate("+(t+o)+","+(i+s)+")",d:e};r.path(h)},_updateTerminalOrthoThumbs:function(n,i,r,u){var e,f,s,o;if(n.points.length>2)for(f=0;f<n.points.length-1;f++)o=t.datavisualization.Diagram.Geometry.distance(n.points[f],n.points[f+1]),e=n.points[f].y==n.points[f+1].y?"horizontal":"vertical",s=o>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+f+"_"+u,(n.points[f].x+n.points[f+1].x)/2*r,(n.points[f].y+n.points[f+1].y)/2*r,i,s,e);else o=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),e=n._startPoint.y==n._endPoint.y?"horizontal":"vertical",s=o>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,s,e)},_updateBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r})},_updateControlPointCorner:function(n,t,i,r){r.circle({id:n+"_"+i,cx:t.x,cy:t.y})},updateUserHandles:function(n,t,i,r,u,f){if(n&&n.length>0)for(var e=0;e<n.length;e++)(r&&n[e].enableMultiSelection||!r)&&this._updateHandle(n[e],t,i,u,f)},_updateHandle:function(n,i,r,u,f){var e=this._getHandlePosition(n,i,f),o;!u&&n.visible?(o=t.datavisualization.Diagram.Geometry.updatePath(e.x*f-n.size/4,e.y*f-n.size/4,n.size/2,n.size/2,n.pathData,r),this._updateHandleShape(n,e.x*f,e.y*f,r),this._updateHanleIcon(n,o,r),r.getElementById(n.name+"_shape")&&n.visible&&(r.getElementById(n.name+"_shape").style.display="block",r.getElementById(n.name+"_icon").style.display="block")):r.getElementById(n.name+"_shape")&&(r.getElementById(n.name+"_shape").style.display="none",r.getElementById(n.name+"_icon").style.display="none")},clearSelector:function(n,t){var i=n.getElementById(n.document.id+"handle_g");i&&t.removeChild(i);i=n.getElementById(n.document.id+"userHandle_g");i&&t.removeChild(i)},_initializePageBreaks:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderVPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_renderPageSettingsRect:function(n,t,i,r,u,f,e){var o=i.rect({id:"pageback",x:n.x,y:n.y,width:t.x,height:t.y,style:"fill:"+f+";stroke:"+u+";stroke-width:"+e+""});r.appendChild(o)},_updatePageBakground:function(n,i,r,u,f,e,o){var s=document.getElementById("pageback"),h={x:n.x,y:n.y,width:i.x,height:i.y,style:"fill:"+e+";stroke:"+f+";stroke-width:"+o+""};s&&t.datavisualization.Diagram.Util.attr(s,h)},_renderHPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_removePageBreaks:function(n,t,i){t!=null&&i!=null&&i.removeChild(t)},removeChild:function(n,t){var i=t.svg.document.getElementById(n.name);i&&i.parentNode.removeChild(i)}};t.datavisualization.Diagram.DiagramContext={updateViewPort:function(n){var i;n._views.forEach(function(r){i=n._views[r];i.context==t.datavisualization.Diagram.SvgContext&&i.type=="mainview"&&t.datavisualization.Diagram.PageUtil._updatePageSize(n)})},renderNode:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context.renderNode(n,u,i||r.diagramLayer)})},renderPort:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r._canvas;r.context._insertPort(n,t,u)})},renderConnector:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context.renderConnector(n,u,i||r.diagramLayer)})},renderGroup:function(n,t,i){var r,u;t._views.forEach(function(f){var e;r=t._views[f];u=r.svg||r._canvas;i=r.svg.getElementById(n.parent);r.type=="overview"&&(e=!0);r.context.renderGroup(n,u,i||r.diagramLayer,t.nameTable,t,null,e)})},update:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;n.isGroup?i.context.updateGroup(n,r,t):n.segments?i.context.updateConnector(n,r,t):i.context.updateNode(n,r,t)})},_refreshSegments:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;n.segments&&i.context._refreshSegments(n,r)})},renderShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._renderShadow(n,r)})},removeShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._removeShadow(n,r)})},addNodeLabel:function(n,t,i,r){var u,f;r._views&&r._views.forEach(function(e){u=r._views[e];f=u.svg||u.canvas;u.context.addNodeLabel(n,t,f,i)})},updateLabel:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateLabel(n,t,u)})},setNodeShape:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setNodeShape(n,u,i)})},setLine:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setLine(n,u,i)})},renderDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.renderDecorators(n,r)})},clearDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.clearDecorators(n,r)})},updateTargetDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateTargetDecoratorStyle(n,r)})},updateSourceDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateSourceDecoratorStyle(n,r)})},updateNodeStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateNodeStyle(n,r)})},updateLabelStyle:function(n,t,i){i._views.forEach(function(r){var u=i._views[r],f=u.svg||u.canvas;u.context.updateLabelStyle(n,t,f)})},updateConnectorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateConnectorStyle(n,r)})},updateTextBlock:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateTextBlock(n,t,u)})}}}(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejSymbolPalette","ej.datavisualization.SymbolPalette",{element:null,model:null,nameTable:{},defaults:{width:250,height:400,paletteItemWidth:50,paletteItemHeight:50,previewWidth:110,previewHeight:110,previewOffset:{x:112,y:112},diagramId:null,headerHeight:30,selectedPaletteName:0,cssClass:"e-datavisualization-symbolpalette",showPaletteItemText:!0,allowDrag:!0,palettes:[]},dataTypes:{paletteItemWidth:"number",paletteItemHeight:"number",previewWidth:"number",previewHeight:"number",headerHeight:"number",showPaletteItemText:"boolean",allowDrag:"boolean",palettes:"array"},_canvas:null,_init:function(){this.selectedItem=null;this.activePalette=null;this._selectedElement=null;this._renderSymbolPalette();this._wireEvents();this.updateScrollerViewport()},_setModel:function(n){for(var t in n)switch(t){case"width":this._setWidth(n[t]);break;case"height":this._setHeight(n[t]);break;case"paletteItemWidth":this.model.paletteItemWidth=n[t];this._redrawContent();break;case"paletteItemHeight":this.model.paletteItemHeight=n[t];this._redrawContent();break;case"headerHeight":this._setHeaderHeight(n[t]);break;case"cssClass":this._setCssClass(n[t]);break;case"showPaletteItemText":this._showItemText(n[t])}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_renderSymbolPalette:function(){var n,i,r;if(this._canvas=document.createElement("div"),this._canvas.setAttribute("class","e-scanvas"),this._canvas.setAttribute("id",this.element[0].id+"_canvas"),this.element[0].setAttribute("style","height:"+this.model.height+"; width:"+this.model.width+";"),this.element.append(this._canvas),this.element.ejScroller({width:this._setViewPortWidth(),height:this._setViewPortHeight()}),n=this.model.palettes,n)for(i=0,r=n.length;i<r;i++)n[i]=t.datavisualization.Diagram.Palette(n[i],this),this._renderPalette(n[i])},_setViewPortWidth:function(){this.element[0].setAttribute("style","width:"+this.model.width+";");var n=this.element.width();return Math.abs(n)},_setViewPortHeight:function(){this.element[0].setAttribute("style","height:"+this.model.height+";");var n=this.element.height();return Math.abs(n)},_renderPalette:function(n){this._renderHeader(n);this._renderContent(n);this._collapse(n)},_renderHeader:function(i){var r=document.createElement("div"),u={id:i.name+"_header","class":"e-header",style:"height:"+this.model.headerHeight+"px;"};t.datavisualization.Diagram.Util.attr(r,u);this._renderHeaderArrow(r,i.expanded,i.name);this._renderHeaderText(r,i.name);this._addExpandedClass(r,i.expanded);this.model.selectedPaletteName===i.name&&(n(r).addClass("selected"),this.activePalette=i);this._canvas.appendChild(r)},_renderHeaderText:function(n,t){var i=document.createElement("span");i.setAttribute("class","e-header-text");i.innerHTML=t;n.appendChild(i)},_renderHeaderArrow:function(t,i){var r=document.createElement("span");r.setAttribute("class","e-header-arrow e-icon");r.setAttribute("style","top:"+(this.model.headerHeight-16)/2+"px;");this._addExpandedClass(r,i);this.model.selectedPaletteName===name&&n(r).addClass("selected");t.appendChild(r)},_renderContent:function(n){var r=document.createElement("div"),t,i,u;if(r.setAttribute("id",n.name+"_content"),r.setAttribute("class","e-scontent"),this.model.palettes.length-1===this.model.palettes.indexOf(n)&&r.setAttribute("style","border-bottom-width: 0px;"),this._canvas.appendChild(r),t=n.items,t&&t.length>0)for(i=0,u=t.length;i<u;i++)t[i].parent?this.nameTable[t[i].name]=t[i]:(this._renderItem(t[i],r),this.nameTable[t[i].name]=t[i])},_renderItem:function(n,t){var i=this._renderItemContainer(n.name,t);n.segments?this._renderConnector(n,i):n.isGroup?this._renderGroup(n,i):this._renderNode(n,i)},_renderItemContainer:function(i,r,u){var e=document.createElement("div"),s={id:i+"_paletteItem",draggable:"true",height:this.model.paletteItemHeight+"px",width:this.model.paletteItemWidth+"px","class":"e-paletteItem",style:"-ms-touch-action: none;touch-action: none;"},o,f;return t.datavisualization.Diagram.Util.attr(e,s),r.appendChild(e),o=this.element[0].id,f=this,u||n(e).ejDraggable({clone:!0,cursorAt:{top:f.model.previewOffset.y,left:f.model.previewOffset.x},helper:function(){var r=n("#"+f.model.diagramId).ejDiagram("instance"),s,h,u,i,o;if(s=f.model.paletteItemWidth,h=f.model.paletteItemHeight,f.model.paletteItemWidth=f.model.previewWidth,f.model.paletteItemHeight=f.model.previewHeight,u=f._renderItemContainer(f.selectedItem.name+"_clone",document.body,!0),u.document.setAttribute("drag","true"),i=n.extend(!0,{},f.selectedItem),r._selectedSymbol=i,r._paletteTable=f.nameTable,r._palNameTable=n.extend(!0,{},f.nameTable),i.segments){var e=t.datavisualization.Diagram.Util.bounds(i),c=(f.model.previewWidth-10)/e.width,l=(f.model.previewHeight-10)/e.height;r.scale(i,c,l,e.topLeft,r.nameTable);f._renderConnector(i,u)}else i.width=f.model.previewWidth-10,i.height=f.model.previewHeight-10,i.offsetX=i.width/2+5,i.offsetY=i.height/2+5,i.isGroup?f._renderGroup(i,u):f._renderNode(i,u);return o=document.getElementById(f.selectedItem.name+"_clone_paletteItem"),n(o).addClass("dragClone"),f.model.paletteItemWidth=s,f.model.paletteItemHeight=h,n(o)},drag:function(){var i=this,t=n(".dragClone")[0];t&&t.setAttribute("paletteId",o)},dragStop:function(){var t=n("#"+f.model.diagramId).ejDiagram("instance");t._selectedSymbol=null;n(".dragClone").remove()}}),this._renderAnchor(e,i)},_renderAnchor:function(n,i){var r=document.createElement("div"),f={id:i+"_anchor",height:this.model.paletteItemHeight+"px",width:this.model.paletteItemWidth+"px","class":"e-anchor"},u;return t.datavisualization.Diagram.Util.attr(r,f),n.appendChild(r),u=this._renderSvg(r,i),this._renderText(r,i),u},_renderSvg:function(n,i){var r=document.createElement("div"),u={id:i+"_svgWrapper",width:this.model.paletteItemWidth+"px;",height:+this.model.paletteItemHeight+"px;","class":"e-svg-container"},f;return t.datavisualization.Diagram.Util.attr(r,u),u={id:i+"_svg",width:this.model.paletteItemWidth,height:this.model.paletteItemHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},f=new t.datavisualization.Diagram.Svg(u),r.appendChild(f.document),n.appendChild(r),f},_renderText:function(n,t){var i=document.createElement("div"),r;i.setAttribute("class","e-text-container");i.setAttribute("style","width:"+this.model.paletteItemWidth+"px;");r=document.createElement("span");r.setAttribute("class","e-paletteItemText");r.innerHTML=t;i.appendChild(r);this.model.showPaletteItemText||(i.style.display="none");n.appendChild(i)},_renderNode:function(n,i){var u=t.datavisualization.Diagram.SvgContext.renderNode(n,i),r=!1;i.document.getAttribute("drag")!=null&&(r=!0);this._transformItem(u,n.width,n.height,n,r)},_updateChildBounds:function(n,i){var u=null,r;if(n.isGroup){for(r=0;r<n.children.length;r++)u=i[n.children[r]],u.isGroup&&this._updateChildBounds(u,i);t.datavisualization.Diagram.Util._updateChildBounds(n,i)}},_renderGroup:function(n,i){this._updateChildBounds(n,this.nameTable);var u=t.datavisualization.Diagram.SvgContext.renderGroup(n,i,null,this.nameTable),r=!1;i.document.getAttribute("drag")!=null&&(r=!0);this._transformItem(u,n.width,n.height,n,r)},_renderConnector:function(n,i){var f=t.datavisualization.Diagram.SvgContext.renderConnector(n,i),r=t.datavisualization.Diagram.Util.bounds(n),u=!1;i.document.getAttribute("drag")!=null&&(u=!0);this._transformItem(f,r.width,r.height,null,u)},_wireEvents:function(){this._on(this.element,t.eventType.click,".e-header",this._headerClick);this._on(this.element,t.eventType.mouseDown,".e-header",this._headerMouseDown);this._on(this.element,"mouseover",".e-header",this._headerMouseOver);this._on(this.element,"mouseout",".e-header",this._headerMouseOut);this._on(this.element,t.eventType.mouseDown,".e-paletteItem",this._itemMouseDown);this._on(this.element,"mouseover",".e-paletteItem",this._itemMouseOver);this._on(this.element,"mouseout",".e-paletteItem",this._itemMouseOut);this._on(this.element,t.eventType.click,".e-anchor",this._itemClick)},_headerClick:function(t){var r=this,i;n(t.currentTarget).next(".e-scontent").slideToggle(200,function(){r._refresh()});this._updateHeaderState(t.currentTarget);i=this._getActivePalette(t.currentTarget.id);i&&i!==this.activePalette&&(this.activePalette=i)},_headerMouseDown:function(n){n.preventDefault();n.stopPropagation()},_headerMouseOver:function(t){n(t.currentTarget).addClass("hover");n(t.currentTarget).find(".e-header-arrow").addClass("hover")},_headerMouseOut:function(t){n(t.currentTarget).removeClass("hover");n(t.currentTarget).find(".e-header-arrow").removeClass("hover")},_itemMouseDown:function(i){var r,u,s,e,f,h,o;if(this.model.diagramId&&(r=n("#"+this.model.diagramId).ejDiagram("instance"),r.activeTool instanceof t.datavisualization.Diagram.LineTool&&(r.activeTool._showAllPorts(!0),r.deactivateTool())),this.model.allowDrag||(i.preventDefault(),i.stopPropagation()),this._selectedElement?this._selectedElement!==i.currentTarget&&(n(this._selectedElement).removeClass("selected"),this._selectedElement=i.currentTarget):this._selectedElement=i.currentTarget,n(i.currentTarget).hasClass("selected")||n(i.currentTarget).addClass("selected"),u=this._getActivePalette(i.currentTarget.parentElement.id),u&&u!==this.activePalette&&(this._clearHeaderSelection(),this._updateHeaderSelection(n(i.currentTarget.parentElement).prev()),this.activePalette=u),this.activePalette&&this._selectedElement)for(s=this._selectedElement.id.slice(0,this._selectedElement.id.lastIndexOf("_")),e=this.activePalette.items,f=0,h=e.length;f<h;f++)o=e[f],o.name===s&&(this.selectedItem=o)},_itemMouseOver:function(t){n(t.currentTarget).addClass("hover")},_itemMouseOut:function(t){n(t.currentTarget).removeClass("hover")},_itemDraStart:function(n){var t=n.originalEvent.dataTransfer;t.setData("Text",this.element[0].id);t.effectAllowed="copy"},_itemClick:function(i){var f,r,e,u;if(this.model.diagramId&&(i.type==="click"||i.type==="touchend"&&!n(".dragClone")[0])){if(f=n("#"+this.model.diagramId).ejDiagram("instance"),r=n.extend(!0,{},this.selectedItem),r.name+=t.datavisualization.Diagram.Util.randomId(),r.isGroup){for(e=0;e<r.children.length;e++)u=n.extend(!0,{},this.nameTable[r.children[e]]),u.parent=r.name,u.name=r.name+u.name,r.children[e]=u.name,f.nameTable[u.name]=u,f.model.nodes.push(u),t.datavisualization.Diagram.SpatialUtil._updateQuad(f,f._spatialSearch,u);r.height=r.width=0;f._updateChildBounds(r,f.nameTable)}r&&!r.isLane&&f.add(r)}},_collectionChanged:function(n){var t,i,r;n.changeType=="insert"?this._renderPalette(n.element):n.changeType=="remove"&&(t=n.element,t!=null&&(i=document.getElementById(t.name+"_header"),i&&i.parentNode.removeChild(i),r=document.getElementById(t.name+"_content"),r&&r.parentNode.removeChild(r)))},addPaletteItem:function(n,t){for(var u,i,r=0;r<this.model.palettes.length;r++)i=this.model.palettes[r],i.name===n&&(i.items.push(t),u=document.getElementById(n+"_content"),this._renderItem(t,u))},removePaletteItem:function(n,i){for(var r,u,f=0;f<this.model.palettes.length;f++)u=this.model.palettes[f],u.name===n&&(t.datavisualization.Diagram.Util.removeItem(u.items,i),r=document.getElementById(n+"_content"),r.removeChild(r.getElementsByClassName("e-paletteItem e-draggable e-js").item(i.name+"_paletteItem")),this.selectedItem=null)},addPalette:function(n){this.model.palettes.push(n);this._renderPalette(n)},removePalette:function(n){for(var r,u,i,f=0;f<this.model.palettes.length;f++)i=this.model.palettes[f],i.name===n&&(t.datavisualization.Diagram.Util.removeItem(this.model.palettes,i),r=document.getElementById(i.name+"_header"),r&&r.parentNode.removeChild(r),u=document.getElementById(i.name+"_content"),u&&u.parentNode.removeChild(u))},setWidth:function(n){this.model.width=n;this._setWidth(n)},setHeight:function(n){this.model.height=n;this._setHeight(n)},setPaletteItemWidth:function(n){this.model.paletteItemWidth=n;this._redrawContent()},setPaletteItemHeight:function(n){this.model.paletteItemHeight=n;this._redrawContent()},setHeaderHeight:function(n){this.model.headerHeight=n;this._setHeaderHeight(n)},setCssClass:function(n){this._setCssClass(n);this.model.cssClass=n},showPaletteItemText:function(n){this._showItemText(n);this.model.showPaletteItemText=n},searchPalette:function(n,i){var r=new t.datavisualization.Diagram.Collection;return i!=""&&(n=this._getSearchPaletteItems(i),r.add(n)),r},_getSearchPaletteItems:function(n){for(var f=new t.datavisualization.Diagram.Palette,u=this.model.palettes,r,i=0;i<u.length;i++)if(u[i].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0)for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display="block";else for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display=u[i].items[r].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0?"block":"none";return f},_addExpandedClass:function(t,i){i?n(t).addClass("expanded"):n(t).addClass("collapsed")},_collapse:function(t){t.expanded||n(document.getElementById(t.name+"_header")).next(".e-scontent").slideToggle(10)},_transformItem:function(n,i,r,u,f){var h;if(!f){var e=this._getScaleFactor(i,r),s=this._getTranslateFactor(i,r),o="";o+="translate("+s+","+s+")";o+="scale("+e+","+e+")";n.setAttribute("transform",o)}u&&t.browserInfo().name==="msie"&&(u.isGroup||u.shape.type!=="html"||(h=document.getElementById(u.name+"_html"),h.setAttribute("style","zoom:"+e+";")))},_getScaleFactor:function(n,t){var u=30*this.model.paletteItemWidth/100,f=30*this.model.paletteItemHeight/100,i=(this.model.paletteItemWidth-u)/n,r=(this.model.paletteItemHeight-f)/t;return i=i>1?1:i,r=r>1?1:r,Math.min(i,r)},_getTranslateFactor:function(){var n=15/100*this.model.paletteItemWidth,t=15/100*this.model.paletteItemHeight;return Math.min(n,t)},_setWidth:function(n){this.element.css("width",n)},_setHeight:function(n){this.element.css("height",n)},_setHeaderHeight:function(n){this.element.find(".e-header").css("height",n);this.element.find(".e-header-arrow").css("top",(n-16)/2)},_setCssClass:function(n){this.element.removeClass(this.model.cssClass).addClass(n)},_showItemText:function(n){n!==this.model.showPaletteItemText&&(n?this.element.find(".e-text-container").show():this.element.find(".e-text-container").hide())},_redrawContent:function(){for(var u,e,t,r,o,f=this.element.find(".e-scontent"),i=0,s=f.length;i<s;++i)if(u=f[i],n(u).empty(),e=this.model.palettes[i],t=e.items,t&&t.length>0)for(r=0,o=t.length;r<o;r++)this._renderItem(t[r],u)},_getActivePalette:function(n){for(var t,u=n.slice(0,n.lastIndexOf("_")),r=this.model.palettes,i=0,f=r.length;i<f;i++)if(t=r[i],t.name===u&&t!==this.activePalette)return t;return null},_updateHeaderState:function(n){this._clearHeaderSelection();this._updateExpandState(n);this._updateHeaderSelection(n)},_updateExpandState:function(t){n(t).hasClass("expanded")?(n(t).removeClass("expanded").addClass("collapsed"),n(t).find(".e-header-arrow").removeClass("expanded").addClass("collapsed")):(n(t).removeClass("collapsed").addClass("expanded"),n(t).find(".e-header-arrow").removeClass("collapsed").addClass("expanded"))},_updateHeaderSelection:function(t){n(t).hasClass("selected")||(n(t).addClass("selected"),n(t).find(".e-header-arrow").addClass("selected"))},_clearHeaderSelection:function(){this.element.find(".e-header").removeClass("selected");this.element.find(".e-header-arrow").removeClass("selected")},_addItem:function(n,t){var i=document.getElementById(n.name+"_content");this._renderItem(t,i)},_removeItem:function(n,t){var i=document.getElementById(n.name+"_content");i.removeChild(document.getElementById(t.name+"_paletteItem"));t===this._selectedElement&&(this._selectedElement=null)},updateScrollerViewport:function(){var n=this.element.ejScroller("instance");n.model.touchScroll=!1;n.model.width=this._setViewPortWidth();n.model.height=this._setViewPortHeight();this._refresh()},_refresh:function(){this.element.ejScroller("refresh")}})}(jQuery,Syncfusion),function(n,t){"use strict";var i,u,f,e,o,r,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt;t.datavisualization.Diagram.extend=function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};i=function(){function i(n,i){this.name=n;this.diagram=i;this.helper=null;this.inAction=!1;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0);this.cursor="default";this._currentPossibleConnection=null;this._previousPossibleConnection=null;this._possibleConnectionPort=null;this.singleAction=!1;this.svgHelper=null;this.single=null;this._centralPoint=t.datavisualization.Diagram.Point(0,0);this._enableAutoNode=null;this._prevTool=null}return i.prototype.abort=function(){this._endAction();t.datavisualization.Diagram.SvgContext.updateSelector(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom,this.diagram,this.diagram.model.selectorConstraints);this.diagram._removeTooltip()},i.prototype.keydown=function(n){var t=n.keyCode?n.keyCode:n.which;t===27&&this.inAction?this.abort():this.inAction||t!=27||this.diagram._clearSelection()},i.prototype._containChil=function(n,t){for(var i=0;i<t.length;i++)if(t[i]==n.name)return!0},i.prototype._decideSelectedItem=function(n,t,i){var r=null,u;if(t)t.parent?this.diagram.selectionList&&this.diagram.selectionList[0]&&t.parent==this.diagram.selectionList[0].name&&!i?r=t:i&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].name==t.name?r=t:(u=this.diagram.nameTable[t.parent],r=this._decideSelectedItem(n,u,i),this.diagram.selectionList&&this.diagram.selectionList[0]&&r&&this.diagram.selectionList[0].name==r.name&&!i&&(r=t)):r=t;else return null;return r},i.prototype._removeHighLighter=function(){t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._svg,this.diagram._adornerLayer)},i.prototype._nodeHighLighter=function(n){var u=null,i=null,r=null,f,e;n&&this.selectedObject.parent?(f=this.diagram.nameTable[this.selectedObject.parent],f.container&&f.container.type=="stack"&&this.selectedObject.name!=n.name?t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):f.container&&f.container.type=="canvas"&&this.selectedObject.parent!=n.name?t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter()):n.container?t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter();this._nodeToHit&&n&&n.name!=this._nodeToHit.name&&(i=t.datavisualization.Diagram.Util.bounds(this._nodeToHit),r=this._getTargetNode(this._nodeToHit,i),this._raiseEvent("mouseLeave",{element:this.selectedObject,source:this._nodeToHit,target:r}));n?(this._nodeToHit&&this._nodeToHit.name!==n.name||!this._nodeToHit)&&(this._nodeToHit=n,this.selectedObject.parent&&(u=this.diagram.nameTable[this.selectedObject.parent]),this.selectedObject.isPseudoGroup&&(e=this.diagram.nameTable[this.selectedObject.children[0]],e&&e.parent&&(u=this.diagram.nameTable[e.parent])),i=t.datavisualization.Diagram.Util.bounds(n),r=this._getTargetNode(n,i),this._raiseEvent("mouseEnter",{element:this.selectedObject,source:u,target:r})):this._nodeToHit=null;n&&(this.selectedObject.parent&&(u=this.diagram.nameTable[this.selectedObject.parent]),i=t.datavisualization.Diagram.Util.bounds(n),r=this._getTargetNode(n,i),this._raiseEvent("mouseOver",{element:this.selectedObject,source:u,target:r}))},i.prototype._doubleClick=function(n){var t,i;n&&n.parent&&(t=this.diagram.nameTable[n.parent],t&&t.container&&(i=n.name,this.diagram.updateSelectedObject(i),this.diagram.addSelection(n)))},i.prototype._itemClick=function(n,t){var r,i;t&&t.parent?(r=this.diagram.nameTable[t.parent],r&&r.container&&t&&!this.diagram._selectedSymbol&&(i=t.name,i.indexOf("_header_swimlane")!=-1?this.diagram.updateSelectedObject(i.split("_header_swimlane")[0]):i.indexOf("_Headerr_")!=-1?this.diagram.updateSelectedObject(t.parent):this.diagram.updateSelectedObject(i))):t&&this.diagram.updateSelectedObject(t.name)},i.prototype._getTargetNode=function(n,i){for(var e,o,f,s,h=null,u=[],c=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,i),r=0;r<c.length;r++)if(e=c[r],e.objects.length>0)for(o=0;o<e.objects.length;o++)f=e.objects[o],f.segments||(h=t.datavisualization.Diagram.Util.bounds(f),u.indexOf(f)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&u.push(f));for(s=[],s.push(n),r=0;r<u.length;r++)u[r].name!=n.name&&s.push(u[r]);return s},i.prototype._updateMargin=function(n,i){var o,u;if(n.isPseudoGroup)for(o=null,u=0;u<n.children.length;u++)o=this.diagram.nameTable[n.children[u]],this._updateMargin(o,i);else if(i&&i.container&&i.container.type=="canvas"){var f=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util.bounds(n),r=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);n.marginLeft=r.x-(f.x+i.paddingLeft);n.marginRight=f.x+i.width-(r.x+r.width)-i.paddingRight;n.marginTop=r.y-(f.y+i.paddingTop);n.marginBottom=f.bottom-(r.y+r.height)-i.paddingBottom}},i.prototype._getNodeUnderMouse=function(t){var r,i=null,f=null,u=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),e;return u&&(r=u.attr("class"),r==="ej-d-node"||r==="ej-d-group"?i=this.diagram._findNode(u.attr("id")):r==="ej-d-connector"&&(i=this.diagram._findConnector(u.attr("id")))),i&&(i.isGroup?f=i:i.parent&&(e=this.diagram.nameTable[i.parent],e&&(f=e))),f},i.prototype._isChange=function(n,t){var i=null;return n.isGroup||n.isPseudoGroup||t.isGroup||t.isPseudoGroup?(!(n.isGroup||n.isPseudoGroup)||t.isGroup||t.isPseudoGroup||(i=!this._containsChild(n,t.name)),n.isGroup||n.isPseudoGroup||!(t.isGroup||t.isPseudoGroup)?(n.isGroup||n.isPseudoGroup)&&(t.isGroup||t.isPseudoGroup)&&n.name==t.name&&(i=!0):i=!this._containsChild(t,n.name)):n.name==t.name&&(i=!0),i},i.prototype._containsChild=function(n,t){var u=!0,i=null,r;if(n.children)for(r=0;r<n.children.length;r++)i=this.diagram.nameTable[n.children[r]],i.isGroup?u=this._containsChild(i,t):i.name==t&&(u=!1);return u},i.prototype._findNodeUnderMouse=function(t,i){var r=null,u=null,f,e=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group");return e&&(f=e.attr("class"),f==="ej-d-node"||f==="ej-d-group"?u=this.diagram._findNode(e.attr("id")):f==="ej-d-connector"&&(u=this.diagram._findConnector(e.attr("id")))),r=u&&!u.parent?u:this._decideSelectedItem(t,u,i),this.prevSelectObject=r,i&&this.diagram.selectionList[0]&&(r&&r.isGroup&&!this._containsChild(r,this.diagram.selectionList[0].name)?r=r:r&&this.diagram.selectionList[0].name!=r.name&&this._isChange(this.diagram.selectionList[0],r)?r=this.diagram.selectionList[0]:u&&u.name==this.diagram.selectionList[0].name&&!this._isChange(this.diagram.selectionList[0],r)&&(r=this.diagram.selectionList[0])),this.actualObject=u,r},i.prototype._findLabelUnderMouse=function(t){var i,s=n(t.target),o=s.context.id.split("_"),u,e,r,f;return o[o.length-1]=="lblbg"&&(u=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),u&&(e=u[0].getAttribute("id"),r=u[0].getAttribute("class"),r&&(r==="ej-d-node"||r==="ej-d-group"?(i=this.diagram._findNode(e),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f):r==="ej-d-connector"&&(i=this.diagram._findConnector(e),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f)))),i},i.prototype._selectionContainsChild=function(n){var t,i,r,u,f;if(this.diagram.selectionList[0].children){for(t=this.diagram.selectionList[0].children,i=null,r=0;r<t.length;r++)if(i=this.diagram.nameTable[t[r]],i.name==n)return!0}else if(this.diagram.selectionList[0].isGroup&&!this.diagram.selectionList[0].isPseudoGroup){if(this.diagram.selectionList[0].name==n)return!0}else if(this.diagram.nameTable[n].isGroup){for(t=this.diagram.nameTable[n].children,u=0;u<t.length;u++)if(i=this.diagram.nameTable[t[u]],f=this._selectionContainsChild(i.name),f)return f}else if(this.diagram.selectionList[0].name==n)return!0;return!1},i.prototype._isSelected=function(n){var r=null,t=this.diagram.nameTable[n],i;if(this._selectionContainsChild(t.name))return!0;if(t.isGroup)for(i=0;i<t.children.length;i++)if(r=t.children[i],this._selectionContainsChild(r))return!0;return!1},i.prototype._isColleagueSelected=function(n){var r=this.diagram.nameTable[n],u=null,t,i;if(r.parent&&(t=this.diagram.nameTable[r.parent],t))for(i=0;i<t.children.length;i++)if(u=t.children[i],this._isSelected(u))return!0;return!1},i.prototype._isInSelection=function(n){var i,r,t;if(this.diagram.selectionList[0].isPseudoGroup&&this.diagram.selectionList[0].children)for(i=this.diagram.selectionList[0].children,r=null,t=0;t<i.length;t++)if(r=this.diagram.nameTable[i[t]],r.name==n)return!0},i.prototype._getCloneNode=function(n){var t=null;return t=jQuery.extend(!0,{},n),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},i.prototype._getProcessedObject=function(n){var t=this.diagram.nameTable[n],i;if(t){if(this._isInSelection(n))return null;if(this._selectionContainsChild(t.name))return{add:t,remove:null};if(t.parent)if(this._selectionContainsChild(t.parent)){if(this._isInSelection(t.parent))return{add:t,remove:this.diagram.nameTable[t.parent]};if(i=this.diagram.nameTable[t.parent],i)return{add:i,remove:this.diagram.nameTable[i.parent]}}else return this._isColleagueSelected(t.parent)&&!this._selectionContainsChild(t.parent)?this._isSelected(t.parent)?{add:t,remove:null}:{add:this.diagram.nameTable[t.parent],remove:null}:this.diagram.selectionList[0]&&this._isInSelection(t.parent)?{add:this.diagram.nameTable[t.name],remove:this.diagram.nameTable[t.parent]}:this._getProcessedObject(t.parent);else return{add:t,remove:null}}},i.prototype._measureStackBounds=function(n){for(var f=null,r,i=null,u=0;u<n.children.length;u++)f=this.diagram.nameTable[n.children[u]],r=t.datavisualization.Diagram.Util.bounds(f),r&&(i=i?this.diagram._union(r,i):r);return i.width+=n.paddingLeft+n.paddingRight,i.height+=n.paddingTop+n.paddingBottom,i},i.prototype.hasSameParent=function(){var n;if(this.selectedObject.isPseudoGroup){var t=this.selectedObject,i=null,r=this.diagram.nameTable[t.children[0]].parent;for(n=0;n<t.children.length;n++)if(i=this.diagram.nameTable[t.children[n]],i.parent!=r||i.parent=="")return!1;return!0}return!1},i.prototype._fromDiagram=function(n){for(var r=!0,t=null,i=0;i<n.length;i++)if(t=this.diagram.nameTable[n[i]],t&&t.parent){r=!1;break}return r},i.prototype._fromContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[n[r]],t.parent&&(i=this.diagram.nameTable[t.parent],i&&i.container))return!0},i.prototype._fromSameContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[n[r]],!i&&t.parent&&(i=t.parent),t.parent&&t.parent!=i)return!1;return!0},i.prototype._processCtrlKey=function(n){var o,e,s,r,u,c,f,i;if(this.diagram.selectionList.length>0){e=this.diagram.selectionList;e[0].isPseudoGroup?(s=!0,o=this._findNodeUnderMouse(n)):o=this._findNodeUnderMouse(n);var h=this._findNodeUnderMouse(n,!0),l=this.selectedObject,a=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:h,cancel:!1});this._itemClick(this.selectedObject,this.actualObject,h);a.cancel&&(this.selectedObject=l);this.actualObject&&(this.actualObject.parent?s?(r=e[0],u=this._getProcessedObject(this.actualObject.name),u?(this.selectedObject?t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name):u.remove&&t.datavisualization.Diagram.Util.removeItem(r.children,u.remove.name),this.selectedObject?this._hasMultipleSelection(this.selectedObject)||r.children.push(this.selectedObject.name):u.add&&(this._hasMultipleSelection(u.add)||r.children.push(u.add.name))):(f=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name):r.children.push(this.selectedObject.name):this._hasMultipleSelection(f)?t.datavisualization.Diagram.Util.removeItem(r.children,f.name):r.children.push(f.name)),t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram.nameTable),r.children.length<=1?(c=this.diagram.nameTable[r.children[0]],this.diagram._hasSelection()&&this.diagram._clearSelection(),this.selectedObject=c,this.diagram._addSelection(this.selectedObject)):(this.selectedObject=e[0],t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._svg,this.diagram._currZoom,this.diagram,this.diagram.model.selectorConstraints))):this.diagram.selectionList[0].isGroup?(u=this._getProcessedObject(this.actualObject.name),u&&(this.diagram._hasSelection()&&this.diagram._clearSelection(),this.selectedObject=u.add,this.diagram._addSelection(this.selectedObject))):(u=null,o.isGroup&&(u=this._getProcessedObject(this.actualObject.name)),f=u?u.add:o,e=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection(),i=t.datavisualization.Diagram.Group({isPseudoGroup:!0,name:"multipleSelection"}),e.name!=f.name&&i.children.push(e.name),this.selectedObject?i.children.push(this.selectedObject.name):this._containsChild(i,f.name)&&i.children.push(f.name),this._checkRepeatedChild(i),this.diagram.model.nodes.push(i),this.diagram.nameTable[i.name]=i,t.datavisualization.Diagram.Util._updateGroupBounds(i,this.diagram.nameTable),this.selectedObject=i,this.diagram._addSelection(this.selectedObject)):s?(r=e[0],f=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name):r.children.push(this.selectedObject.name):this._hasMultipleSelection(f)?t.datavisualization.Diagram.Util.removeItem(r.children,f.name):r.children.push(f.name),t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram.nameTable),this.selectedObject=e[0],t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._svg,this.diagram._currZoom,this.diagram,this.diagram.model.selectorConstraints)):(f=this.actualObject,e=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection(),i=t.datavisualization.Diagram.Group({isPseudoGroup:!0,name:"multipleSelection"}),i.children.push(e.name),this.selectedObject?i.children.push(this.selectedObject.name):i.children.push(f.name),this.diagram.model.nodes.push(i),this.diagram.nameTable[i.name]=i,t.datavisualization.Diagram.Util._updateGroupBounds(i,this.diagram.nameTable),this.selectedObject=i,this.diagram._addSelection(this.selectedObject)));this.selectedObject=this.diagram.selectionList[0]}else o=this._findNodeUnderMouse(n),this.selectedObject=o;return o},i.prototype._checkRepeatedChild=function(i){for(var u,f=null,r=n.extend(!0,{},i),e=0;e<r.children.length;e++)if(f=this.diagram.nameTable[r.children[e]],f.isGroup)for(u=0;u<r.children.length;u++)this._containsChild(f,r.children[u])||t.datavisualization.Diagram.Util.removeItem(i.children,r.children[u])},i.prototype._hasMultipleSelection=function(n){for(var i=this.diagram.selectionList[0].children,t=0;t<i.length;t++)if(n.name==i[t])return!0;return!1},i.prototype._getNextParent=function(n){if(n.parent){var t=this.diagram.nameTable[n.parent];return this._hasMultipleSelection(t)?n:this._getNextParent(t)}return n},i.prototype._hasMultipleSelection=function(n){for(var i=this.diagram.selectionList[0].children,t=0;t<i.length;t++)if(n.name==i[t])return!0;return!1},i.prototype._getNextParent=function(n){if(n.parent){var t=this.diagram.nameTable[n.parent];return this._hasMultipleSelection(t)?n:this._getNextParent(t)}return n},i.prototype._findObj=function(n,t){var r,u=n.getAttribute("id"),i;return t?r=this.diagram._findChildren(t,u):(i=n.getAttribute("class"),i&&(i==="ej-d-node"||i==="ej-d-group"?r=this.diagram._findNode(u):i==="ej-d-connector"&&(r=this.diagram._findConnector(u)))),r},i.prototype.mousedown=function(n){this.startPoint=this.mousePosition(n);this.currentPoint=this.mousePosition(n);this.previousPoint=this.startPoint},i.prototype.mousemove=function(n){this.currentPoint=this.mousePosition(n)},i.prototype.mouseup=function(){this._endAction();this.singleAction&&this.diagram.activateTool("select")},i.prototype.mousePosition=function(n){return this.diagram._mousePosition(n)},i.prototype.updateCursor=function(n){this.diagram._currentCursor=n;this.diagram._updateCursor()},i.prototype.nearestGridPoint=function(n){var i=t.datavisualization.Diagram.Point();if(this.diagram.model.snap&t.datavisualization.Diagram.Snap.Grid){var o=this.diagram.model.magnification/100,r=this.diagram.model.grid.horizontalSpacing*o,u=this.diagram.model.grid.verticalSpacing*o,f=n.x%r,e=n.y%u;i.x=f>=r/2?n.x+r-f:n.x-f;i.y=e>=u/2?n.y+u-e:n.y-e}return i},i.prototype.snap=function(n){var i=this.diagram.model.snapSettings,r=this.diagram._currZoom;return i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(n.x=t.datavisualization.Diagram.SnapUtil._round(n.x,i.verticalGridLines.snapInterval,r)),i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(n.y=t.datavisualization.Diagram.SnapUtil._round(n.y,i.horizontalGridLines.snapInterval,r)),n},i.prototype._endAction=function(){var n,i,u,r,f;if(this.inAction=!1,this.svgHelper)if(n=this.helper,i=this.diagram._spatialSearch,n.isGroup)for(u=this.helper.children.length-1,r=u;r>=0;r--)t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(i,i.quadTable[n.children[r].name],n.children[r]);else t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(i,i.quadTable[n.name],n);this.helper&&(this.svgHelper&&this.diagram._svg.removeChild(this.svgHelper,this.diagram._diagramLayer),this.helper.gradient&&(f=this.diagram._svg.getElementsByTagName("defs")[0],f.removeChild(this.diagram._svg.getElementById(this.helper.name+"_gradient"))));this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._svg,this.diagram._adornerLayer));this._currentPossibleConnection=null;this._possibleConnectionPort=null;this.helper=null;this.svgHelper=null;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0)},i.prototype._isResizeCorner=function(n){var t=!1;switch(n){case"n-resize":case"e-resize":case"w-resize":case"s-resize":case"ne-resize":case"nw-resize":case"se-resize":case"sw-resize":case"targetEndPoint":case"sourceEndPoint":t=!0}return t},i.prototype._initHelper=function(){this.selectedObject&&(this.helper=n.extend(!0,{},this.selectedObject),this._updateHelperName(this.helper))},i.prototype._updateHelperName=function(n,t){var u,i,r,f,e;for(t?n.name+="helper":n.name="helper",n.opacity=.5,u=n.labels,i=0,r=u.length;i<r;++i)u[i].name+="helper";if(n.ports)for(f=n.ports,i=0,r=f.length;i<r;++i)f[i].name+="helper";if(n.isGroup)for(e=n.children,i=0,r=e.length;i<r;i++)this._updateHelperName(e[i],!0)},i.prototype._raiseEvent=function(n,t){return t.elementType=this.diagram._getElementType(t.element),this.diagram._trigger(n,t),t},i.prototype._findPort=function(n,t){var f=this.diagram._findPortAtPoint(n,t),r,u,i;if(!f&&t.isGroup)for(u=0;u<t.children.length;u++)if(i=this.diagram.nameTable[t.children[u]],i&&!i.segments)if(r=this._findPort(n,i),r&&!i.isGroup)this._currentPossibleConnection=i,f=r;else if(r)return r;return f},i.prototype._checkConnectionPossible=function(n){var i=null,p=t.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y),f=this.diagram._findNodeUnderMouse(n),r,c,l,e,o,s,u,v;if(f&&!f.segments)f.isPseudoGroup||(this._showPorts(f),this._currentPossibleConnection=f,(this._previousPossibleConnection==null||this._previousPossibleConnection.name!==this._currentPossibleConnection.name)&&(this._previousPossibleConnection=this._currentPossibleConnection));else if(this.diagram.activeTool instanceof t.datavisualization.Diagram.LineTool)this._showPorts(),this._currentPossibleConnection=null,this._possibleConnectionPort=null;else{for(r=t.datavisualization.Diagram.Point(0,0),this._endPoint=="targetEndPoint"?(r.x=this.selectedObject.targetPoint.x-25,r.y=this.selectedObject.targetPoint.y-25):this._endPoint=="sourceEndPoint"&&(r.x=this.selectedObject.sourcePoint.x-25,r.y=this.selectedObject.sourcePoint.y-25),c=t.datavisualization.Diagram.Rectangle(r.x,r.y,50,50),l=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,c),e=0;e<l.length;e++)if(o=l[e],o.objects.length>0)for(s=0;s<o.objects.length;s++)u=o.objects[s],v=t.datavisualization.Diagram.Util.bounds(u),t.datavisualization.Diagram.Geometry.intersectsRect(c,v)?u.segments||this._showPort(u):u.segments||this._showPort(u,!0);this._currentPossibleConnection=null;this._possibleConnectionPort=null}if(this._currentPossibleConnection){if(i=this._findPort(p,this._currentPossibleConnection),i&&t.datavisualization.Diagram.Util.canConnect(i,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(i,this._currentPossibleConnection,this.diagram._svg,this.diagram._adornerLayer,this.diagram._currZoom):t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._svg,this.diagram._adornerLayer),this._possibleConnectionPort=i,i&&t.datavisualization.Diagram.Util.canConnect(i,!0)){var h=this._currentPossibleConnection,a=t.datavisualization.Diagram.Util._getPortPosition(this._possibleConnectionPort,t.datavisualization.Diagram.Util.bounds(h,!0)),y=t.Matrix.identity();t.Matrix.rotate(y,h.rotateAngle,h.offsetX,h.offsetY);a=t.Matrix.transform(y,a);this.currentPoint=a}}else this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._svg,this.diagram._adornerLayer),this._possibleConnectionPort=null)},i.prototype._showPorts=function(n){n?(this._currentPossibleConnection&&this._currentPossibleConnection.name!==n.name&&this._showPort(this._currentPossibleConnection,!0),this._showPort(n)):this._currentPossibleConnection!=null&&this._showPort(this._currentPossibleConnection,!0)},i.prototype._showPort=function(n,i){var f,r,e,u,o;if(i)for(f=n.ports,u=0,o=f.length;u<o;++u)r=f[u],(r.visibility&t.datavisualization.Diagram.PortVisibility.Hover||r.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._svg.getElementById(n.name+"_"+r.name),e&&e.setAttribute("visibility","hidden"));else for(f=n.ports,u=0,o=f.length;u<o;++u)r=f[u],(r.visibility&t.datavisualization.Diagram.PortVisibility.Hover||r.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"&&this.inAction||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._svg.getElementById(n.name+"_"+r.name),e&&e.setAttribute("visibility","visible"))},i.prototype._showAllPorts=function(n){var t,i,r=this.diagram.model.nodes;if(n)for(t=0,i=r.length;t<i;t++)this._showPort(r[t],n);else for(t=0,i=r.length;t<i;++t)this._showPort(r[t])},i.prototype._disconnect=function(n){var r,i=this.diagram.nameTable[n.targetNode],u=null;i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.targetPort),r=this._raiseEvent("connectionChange",{element:n,connection:i,port:u,cancel:!1}),r.cancel||(t.datavisualization.Diagram.Util.removeItem(i.inEdges,n.name),n.targetNode=null,n.targetPort=null));i=this.diagram.nameTable[n.sourceNode];i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.sourcePort),r=this._raiseEvent("connectionChange",{element:n,connection:i,port:u,cancel:!1}),r.cancel||(t.datavisualization.Diagram.Util.removeItem(i.outEdges,n.name),n.sourceNode=null,n.sourcePort=null))},i}();t.datavisualization.Diagram.ToolBase=i;u=function(n){function i(t){n.call(this,"select",t);this.cursor="default";this._svgHelper=null}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);var i=this._findNodeUnderMouse(t);i&&(this.selectedObject=i)},i.prototype.mousemove=function(i){n.prototype.mousemove.call(this,i);t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this._updateHelper():(this.inAction=!0,this._initHelper()))},i.prototype.mouseup=function(i){var o,u,s,r,e,v,f,y,h,a,c,l;if(this.inAction)if(this.currentPoint=this.mousePosition(i),o=t.datavisualization.Diagram.Geometry.rect([{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPoint.x,y:this.currentPoint.y}]),o.width!==0||o.height!==0){for(e=[],v=this.diagram.model.nodes,u=0,s=v.length;u<s;u++)f=this.diagram.nameTable[v[u].name],f&&(r=t.datavisualization.Diagram.Util.bounds(f),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),t.datavisualization.Diagram.Util.canSelect(f)&&(t.datavisualization.Diagram.Geometry.containsRect(o,r)?f.parent===""&&e.push(f):f.isGroup&&this._checkGroupChildren(e,f,o)));for(y=this.diagram.model.connectors,u=0,s=y.length;u<s;u++)h=this.diagram.nameTable[y[u].name],h&&(r=t.datavisualization.Diagram.Util.bounds(h),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),t.datavisualization.Diagram.Util.canSelect(h)&&t.datavisualization.Diagram.Geometry.containsRect(o,r)&&h.parent===""&&e.push(h));if(this.diagram._hasSelection()&&this.diagram._clearSelection(),e.length>0){if(a=e,a.length>1){for(l=t.datavisualization.Diagram.Group({isPseudoGroup:!0,name:"multipleSelection"}),u=0,s=a.length;u<s;u++)l.children.push(a[u].name);this.diagram.model.nodes.push(l);this.diagram.nameTable[l.name]=l;c=l}else t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(c=e[0]);c&&(c.isGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(c,this.diagram.nameTable),this.diagram._addSelection(c))}}else this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();else this.selectedObject||this.diagram._hasSelection()?(i.ctrlKey||i.shiftKey?t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)||this._processCtrlKey(i):this.diagram._hasSelection()&&this.diagram._clearSelection(),this.diagram._addSelection(this.selectedObject)):this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();this.diagram._isDropped=!1;this.selectedObject&&this._raiseEvent("click",{element:this.selectedObject});n.prototype.mouseup.call(this,i)},i.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this.selectedObject=null,this._svgHelper=null);n.prototype._endAction.apply(this)},i.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._svg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},i.prototype._updateHelper=function(){var t=this.diagram._svg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._svg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},i.prototype._checkGroupChildren=function(n,i,r){for(var u,e,f=0;f<i.children.length;f++)u=this.diagram.nameTable[i.children[f]],u&&(e=t.datavisualization.Diagram.Util.bounds(u),t.datavisualization.Diagram.Geometry.containsRect(r,e)?n.push(u):u.isGroup&&this._checkGroupChildren(n,u,r))},i}(i);t.datavisualization.Diagram.SelectTool=u;f=function(i){function r(n){i.call(this,"move",n);this.cursor="move";this._isMouseDown=!1;this.diffx=0;this.diffy=0;this.helper=null;this.hoverNode=null;this.stackOverNode=null;this.undoObject=[];this.activeLabel=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.diffx=0;this.diffy=0;this._allowPan(this.selectedObject,"mousedown",n);i.prototype.mousedown.call(this,n);this._isMouseDown=!0;this.diagram._currentCursor!="pointer"&&this.updateCursor(this.cursor);this._findLabelUnderMouse(n)},r.prototype._containsChild=function(n,t){for(var r=!0,i=null,u=0;u<n.children.length;u++)i=this.diagram.nameTable[n.children[u]],i&&(i.isGroup?r=this._containsChild(i,t):i.name==t&&(r=!1));return r},r.prototype._nodeCanHighlight=function(n){var t=!1;return n.children.indexOf(this.selectedObject.name)==-1&&(this.selectedObject.isGroup?n.isGroup&&(this._containsChild(this.selectedObject,n.name)||(t=!0)):t=!0),t},r.prototype._containerMouseMove=function(n){var u,f,i,r,e;this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container?(u=this.diagram.nameTable[this.selectedObject.parent].container,this.helper?(this._updateHelperXY(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(this.diagram)):(t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram.nameTable),this.helper=this._getCloneNode(this.selectedObject),this.helper.name="helper",this.startPoint=this.currentPoint,f=t.datavisualization.Diagram.Util.bounds(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)),u.type=="canvas"?(i=this._getNodeUnderMouse(n),i&&!i.segments&&i.isGroup?(i.container&&i.container.type!="stack"&&this._nodeHighLighter(i),this.hoverNode=i):(this._removeHighLighter(),this.hoverNode=null)):u.type=="stack"&&(r=this._findStackOverNode(this.helper,n),r?(this._nodeHighLighter(r),this.stackOverNode=r):(this._removeHighLighter(),this.stackOverNode=null))):(this.selectedObject.isSwimlane||(this.selectedObject.isPseudoGroup&&this.hasSameParent()?(this.helper?(f=t.datavisualization.Diagram.Util.bounds(this.helper),this._updateHelperXY(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(this.diagram)):(this.helper=this._getCloneNode(this.selectedObject),this.helper.name="helper",this.helper.children=[],this.startPoint=this.currentPoint,t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram.nameTable),i=this._getNodeUnderMouse(n),e=!0,i&&!i.segments?(i.container&&i.container.type!="stack"&&this._nodeHighLighter(i),this.hoverNode=i):(this._removeHighLighter(),this.hoverNode=null),this._nodeHighLighter(i)):this.isDiagram(n)?this._removeHighLighter():(i=this._getNodeUnderMouse(n),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram.nameTable),i&&i.container&&(this.selectedObject.isSwimlane||this.selectedObject.isLane)?this._getSwimLaneNode(i,this.selectedObject)&&this._nodeHighLighter(i):i&&i.container&&i.container.type!="stack"&&this.selectedObject.name!=i.name&&this._nodeHighLighter(i),this.hoverNode=i)),e||(this.selectedObject.isPseudoGroup?this._fromDiagram(this.selectedObject.children)?this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):this._fromSameContainer(this.selectedObject.children)&&this.hasSameParent()&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)))},r.prototype.mousemove=function(r){var u,s,h,c,f,l,e,a,o,v;if(this._allowPan(this.selectedObject,"mousemove",r),i.prototype.mousemove.call(this,r),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this._isMouseDown&&!this.inAction&&(this.selectedObject||(u=this._findNodeUnderMouse(r,!0),this.diagram._selectedSymbol&&(u=this.diagram.selectionList[0]),u&&(t.datavisualization.Diagram.Util.canMoveLabel(u)||(this.activeLabel=null),this.diagram.selectionList[0]&&this.diagram.selectionList[0].isPseudoGroup?this.activeLabel?(this.selectedObject=u,this.diagram._clearSelection()):this.selectedObject=this.diagram.selectionList[0]:(this.diagram.selectionList[0]!=u?(this.diagram._clearSelection(),this.selectedObject=this.diagram.nameTable[u.name]):this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name],s=this.selectedObject,h=this._raiseEvent("itemClick",{actualObject:this.actualObject,selectedObject:this.selectedObject,model:this.diagram.model,cancel:!1}),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),h.cancel&&(this.selectedObject=s),this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection()),f={},(this.selectedObject.isGroup||this.selectedObject.isPseudoGroup)&&(f=this.diagram._getChildTable(this.selectedObject,f)),l={childTable:f,node:this.selectedObject},c=n.extend(!0,{},l),this.undoObject=jQuery.extend(!0,{},c)))),this.selectedObject&&t.datavisualization.Diagram.Util.canSelect(this.selectedObject))if(this.inAction||(this.inAction=!0,this.activeLabel||this.updateCursor("move"),this._updateSelection()),this.activeLabel)this._updateLabelXY(this.activeLabel,this.previousPoint,this.currentPoint);else{if(this.diagram&&!this.diagram._isEditing&&this._containerMouseMove(r),this.selectedObject.segments&&(e=this.selectedObject,(t.datavisualization.Diagram.Util.isTargetConnected(e)||t.datavisualization.Diagram.Util.isSourceConnected(e))&&this._disconnect(e)),this.selectedObject.isPseudoGroup)for(o=0,v=this.selectedObject.children.length;o<v;o++)a=this.diagram.nameTable[this.selectedObject.children[o]],t.datavisualization.Diagram.DiagramContext.update(a,this.diagram);else this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram.nameTable,this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);this.diagram._renderTooltip(this.selectedObject);this._updateSelection();this.diagram._updateSelectionHandle(!0)}this.previousPoint=this.currentPoint},r.prototype._findStackOverNode=function(n,i){var u=this.diagram.nameTable[n.parent],s=null,r,o,h,c,f,e;if(u)for(h=u.children.length,c=0;c<h;c++)if(s=this.diagram.nameTable[u.children[c]],r=this.mousePosition(i),o=t.datavisualization.Diagram.Util.bounds(s),u.container.orientation=="vertical"){if(f=this.diagram.nameTable[u.children[h-1]],e=this.diagram.nameTable[u.children[0]],r.y>=o.y&&r.y<=o.bottom)return s;if(r.y<=e.offsetY-e.height/2)return e;if(r.y>=f.offsetY+f.height/2)return f}else{if(f=this.diagram.nameTable[u.children[h-1]],e=this.diagram.nameTable[u.children[0]],r.x>=o.x&&r.x<=o.right)return s;if(r.x<=e.offsetX-e.width/2)return e;if(r.x>=f.offsetX+f.width/2)return f}},r.prototype._removeFromContainer=function(n){var i,r;if(n.isPseudoGroup)for(i=null,r=0;r<n.children.length;r++)i=this.diagram.nameTable[n.children[r]],i&&t.datavisualization.Diagram.SvgContext._removeFromContainer(i,this.diagram._svg,this.diagram._adornerLayer);else t.datavisualization.Diagram.SvgContext._removeFromContainer(n,this.diagram._svg,this.diagram._adornerLayer)},r.prototype._updateContainerProperties=function(n){var u,h,e,r,i;if(n&&n.isPseudoGroup){var f=null,o=this.helper.offsetX-this.selectedObject.offsetX,s=this.helper.offsetY-this.selectedObject.offsetY;for(u=0;u<n.children.length;u++)f=this.diagram.nameTable[n.children[u]],f&&(r=this.diagram.nameTable[this.selectedObject.parent],r&&t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name),i=this.diagram.nameTable[f.name],i&&(h=this.diagram.nameTable[i.parent],t.datavisualization.Diagram.Util.removeItem(h.children,i.name),i.parent=this.hoverNode.name,e=this.diagram.nameTable[i.parent],this._containsChild(e,i.name)&&e.children.push(i.name),this.diagram.updateNode(i.name,{offsetX:i.offsetX+o}),this.diagram.updateNode(i.name,{offsetY:i.offsetY+s}),this.diagram.nameTable[i.name]=i));return n.offsetX+=o,n.offsetY+=s,n}return r=this.diagram.nameTable[this.selectedObject.parent],r&&r.children&&t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name),i=this.selectedObject,i.parent=this.hoverNode.name,this.diagram.nameTable[i.name]=i,i},r.prototype._updatePreviousContainer=function(n){if(n.isGroup)if(n.container.type=="canvas"){var i=t.datavisualization.Diagram.Util.bounds(n),r=this.diagram._getMinMaxSize(n,i.width,i.height);n.width=r.width;n.height=r.height}else n.container.type=="stack"},r.prototype._updateContainer=function(n,i,r){var e,o,y=0,p=0,f,l,w,u,h,s,a,g,nt,c,ut,ft,v,tt,it;if(n&&(l=this.diagram.nameTable[n.parent],!l&&n.isPseudoGroup&&(w=this.diagram.nameTable[this.selectedObject.children[0]],l=this.diagram.nameTable[w.parent]),l&&l.container))if(l.container.type=="canvas"){if(r){u=this.diagram.nameTable[n.parent];!u&&n.isPseudoGroup&&(u=l);h=t.datavisualization.Diagram.Util.bounds(u);s=u.rotateAngle;this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);a=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);o=t.datavisualization.Diagram.Util.bounds(u);var b=this.diagram._getTightChildrenBounds(u),et=!0,rt=!0,k=a.x+a.width,d=a.y+a.height;k>=o.right&&(y=k-o.right+u.paddingRight,f=this.diagram._getMinMaxSize(u,u.width+y,u.height,!0),g=f.width-u.width,u.width=f.width,u.offsetX+=g/2,k<o.right&&(et=!1));d>=o.bottom&&(p=d-o.bottom+u.paddingBottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+p,!0),nt=f.height-u.height,u.height=f.height,u.offsetY+=nt/2,rt=!0,d<o.bottom&&(rt=!1));k<o.right&&et&&(y=b.x+b.width+u.paddingRight-o.right,f=this.diagram._getMinMaxSize(u,u.width+y,u.height,!0),g=f.width-u.width,u.width=f.width,u.offsetX+=g/2);d<o.bottom&&rt&&(p=b.y+b.height+u.paddingBottom-o.bottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+p,!0),nt=f.height-u.height,u.height=f.height,u.offsetY+=nt/2);this._updateMargin(n,u);t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram);this.diagram._rotate(u,s,this.diagram.nameTable);c=t.datavisualization.Diagram.Util.bounds(u);this.diagram._translate(u,h.topLeft.x-c.topLeft.x,h.topLeft.y-c.topLeft.y,this.diagram.nameTable);u.parent&&u.container&&u.container.type=="canvas"&&this._updateMargin(u,this.diagram.nameTable[u.parent]);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram)}else ut=!1,ft=!1,u=this.diagram.nameTable[n.parent],h=t.datavisualization.Diagram.Util.bounds(u),s=u.rotateAngle,u.rotateAngle==0&&s==0||this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable),u.container&&u.container.type=="canvas"&&this._updateMargin(n,u),n.container.type=="stack"&&(n.container.orientation=="vertical"?ut=!0:ft=!0),e=this.diagram._getBoundsWithoutStretch(u,ut,ft),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),tt=f.width-u.width,it=f.height-u.height,u.offsetX+=tt/2,u.width=f.width,u.offsetY+=it/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram),u.rotateAngle==0&&s==0||this.diagram._rotate(u,s,this.diagram.nameTable),c=t.datavisualization.Diagram.Util.bounds(u),this.diagram._translate(u,h.topLeft.x-c.topLeft.x,h.topLeft.y-c.topLeft.y,this.diagram.nameTable);n.parent?(this._updateContainer(this.diagram.nameTable[n.parent]),this.diagram.nameTable[n.parent].parent||t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[n.parent],this.diagram)):n.isPseudoGroup&&(w=this.diagram.nameTable[n.children[0]],v=this.diagram.nameTable[w.parent],v.parent&&(this._updateContainer(this.diagram.nameTable[v.name]),this.diagram.nameTable[v.name]||t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[v.name],this.diagram)))}else l.container.type=="stack"&&(u=this.diagram.nameTable[n.parent],e=t.datavisualization.Diagram.SvgContext._measureStackSize(u,this.diagram,!0),h=t.datavisualization.Diagram.Util.bounds(u),s=u.rotateAngle,u.rotateAngle==0&&s==0||this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),tt=f.width-u.width,it=f.height-u.height,u.offsetX+=tt/2,u.width=f.width,u.offsetY+=it/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnStack(u,this.diagram),u.rotateAngle==0&&s==0||this.diagram._rotate(u,s,this.diagram.nameTable),c=t.datavisualization.Diagram.Util.bounds(u),this.diagram._translate(u,h.topLeft.x-c.topLeft.x,h.topLeft.y-c.topLeft.y,this.diagram.nameTable),u.parent&&this._updateContainer(u),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram))},r.prototype._addToContainer=function(n){var r,u,i;if(n.isPseudoGroup)for(r=null,u=0;u<n.children.length;u++)r=this.diagram.nameTable[n.children[u]],r&&(i=this.diagram._svg.getElementById(r.parent),i||(i=this.diagram._diagramLayer),r.isGroup?t.datavisualization.Diagram.SvgContext.renderGroup(r,this.diagram._svg,i,this.diagram.nameTable,this.diagram):r.segments?t.datavisualization.Diagram.SvgContext.renderConnector(r,this.diagram._svg,i):t.datavisualization.Diagram.SvgContext.renderNode(r,this.diagram._svg,i));else this.diagram._clearSelection(),this.hoverNode&&this.hoverNode.children&&this.hoverNode.children.push(n.name),n&&(i=this.diagram._svg.getElementById(n.parent),i||(i=this.diagram._diagramLayer),n.isGroup?t.datavisualization.Diagram.SvgContext.renderGroup(n,this.diagram._svg,i,this.diagram.nameTable,this.diagram):n.segments?t.datavisualization.Diagram.SvgContext.renderConnector(n,this.diagram._svg,i):t.datavisualization.Diagram.SvgContext.renderNode(n,this.diagram._svg,i));this.selectedObject=n},r.prototype._addToDiagram=function(){this.seletedObject=this.diagram.nameTable[this.selectedObject.name];this._removeFromContainer(this.selectedObject);var n=this.diagram.nameTable[this.selectedObject.parent];t.datavisualization.Diagram.Util.removeItem(n.children,this.selectedObject.name);this.selectedObject.parent="";this.diagram.nameTable[this.selectedObject.name]=this.selectedObject;this._updateXY(this.diagram.nameTable[this.selectedObject.name],this.startPoint,this.currentPoint);this._addToContainer(this.selectedObject)},r.prototype.isDiagram=function(n){return n.target.id==this.diagram._id+"_canvas_svg"?!0:!1},r.prototype._allowPan=function(n,i,r){i==="mousedown"&&this.diagram.tools.panTool.mousedown(r);n&&(n.isGroup||n.shape)&&n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan&&(i==="mousemove"?this.diagram.tools.panTool.mousemove(r):i==="mouseup"&&this.diagram.tools.panTool.mouseup(r))},r.prototype._checkForDropEvent=function(n){var i=null,r=null,u=null,f;return this.selectedObject&&this.selectedObject.parent&&(i=this.diagram.nameTable[this.selectedObject.parent]),n&&(u=t.datavisualization.Diagram.Util.bounds(n),r=this._getTargetNode(n,u)),f=this._raiseEvent("drop",{cancel:!1,source:i,target:r}),f.cancel},r.prototype._getSwimLaneNode=function(n,t){if(n.isSwimlane&&this.diagram.nameTable[n.children[1]].container.orientation!=t.orientation)return n;if(n.parent){var i=this.diagram.nameTable[n.parent];if(i)return this._getSwimLaneNode(i,t)}return null},r.prototype._cloneGroupNode=function(t,i){var e=null,r,u,f;if(u=n.extend(!0,{},t),u.name+=i,t.isGroup)for(u.children=[],f=0;f<t.children.length;f++)e=this.diagram.nameTable[t.children[f]],r=n.extend(!0,{},e),r.name+=i,r.parent&&(r.parent+=i),r.isGroup&&this._cloneGroupNode(r,i),this.diagram.nameTable[r.name]=r,this.diagram.model.nodes.push(r),u.children.push(r.name);return u},r.prototype._getSwimLaneStackIndex=function(n){if(n.container.type=="canvas"){if(n.parent)var t=this.diagram.nameTable[n.parent];if(t)return t.children.indexOf(n.name)}else return null},r.prototype._changeNodeState=function(n,i){var r,y,l=null,e,u,p,f,o,s,h,a,w,v,c;return this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isLane&&!i?(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg),e=this._findNodeUnderMouse(n),e&&(l=this._getSwimLaneNode(e,this.selectedObject)),e&&l?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),u=this.diagram.nameTable[l.children[1]],u&&(p=t.datavisualization.Diagram.Util.randomId(),f=this._cloneGroupNode(this.selectedObject,p),this.diagram.remove(this.selectedObject),this.hoverNode&&(o=this._getSwimLaneStackIndex(this.hoverNode)),o||o==0?u.children.splice(o,0,f.name):u.children.push(f.name),f.parent=u.name,this.diagram.add(f),s=this.diagram.nameTable[u.parent],s&&this._updateContainer(f),t.datavisualization.Diagram.DiagramContext.update(s,this.diagram),this.selectedObject=s)):(h=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(this.selectedObject,this.diagram),h&&(this.diagram.remove(this.selectedObject),this.diagram.add(h),this.selectedObject=h))):this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container?(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram.nameTable),a=this.diagram.nameTable[this.selectedObject.parent].container,a.type=="canvas"?(t.datavisualization.Diagram.SvgContext._showNode(this.selectedObject,this.diagram._svg),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),w=!this._checkForDropEvent(this.hoverNode),w&&(this.hoverNode&&this.hoverNode.allowDrop||this.hoverNode&&this.hoverNode.name==this.selectedObject.parent?this.hoverNode.container&&this.hoverNode.container.type=="canvas"&&(this.seletedObject=this.diagram.nameTable[this.selectedObject.name],y=this.selectedObject.parent,this._removeFromContainer(this.selectedObject),r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),this._updateXY(this.diagram.nameTable[this.selectedObject.name],this.startPoint,this.currentPoint),this._addToContainer(r)):(this.isDiagram(n)&&this._addToDiagram(),this.diffx=0,this.diffy=0))):a.type=="stack"&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter())):(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram.nameTable),this.selectedObject.isSwimlane||(this.selectedObject.isPseudoGroup&&this.hasSameParent()?(this.currentPoint=this.previousPoint,this.diffx=0,this.diffy=0,this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this.hoverNode&&this.hoverNode.allowDrop&&!this._checkForDropEvent(this.hoverNode)||this.hoverNode&&this.hoverNode.name==this.selectedObject.parent?(this.seletedObject=this.diagram.nameTable[this.selectedObject.name],y=this.selectedObject.parent,r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),this._removeFromContainer(this.selectedObject),this._addToContainer(r)):(this.diffx=0,this.diffy=0)):this.isDiagram(n)||this.selectedObject.isPseudoGroup||(v=this.hoverNode,(v&&v.container&&this.hoverNode.allowDrop&&!this._checkForDropEvent(this.hoverNode)||this.hoverNode&&this.hoverNode.container&&this.hoverNode.name==this.selectedObject.parent)&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram.nameTable),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),this.seletedObject=this.diagram.nameTable[this.selectedObject.name],this._removeFromContainer(this.selectedObject),r=this._updateContainerProperties(this.diagram.nameTable[this.selectedObject.name]),c=this.diagram.nameTable[r.parent],c&&this._updateMargin(r,c),this._addToContainer(r),t.datavisualization.Diagram.SvgContext._alignOnCanvas1(c,this.diagram))))),r},r.prototype._updateNodeState=function(n,i){var u,f,c,e,s,h;if(this.diagram.nameTable[this.selectedObject.parent]&&(u=this.diagram.nameTable[this.selectedObject.parent].container),this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container){if(u=this.diagram.nameTable[this.selectedObject.parent].container,u.type=="canvas")this.hoverNode&&i&&(f=this.selectedObject.parent,this._updateContainer(i,f,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram));else if(u.type=="stack"&&(c=this._checkForDropEvent(this.stackOverNode),!c))if(e=this.stackOverNode,e){var r=this.diagram.nameTable[e.parent],l=t.datavisualization.Diagram.Util.bounds(r),o=r.rotateAngle;r.rotateAngle==0||o!=0||this.diagram._rotate(r,-r.rotateAngle,this.diagram.nameTable);this._swapChildren(r.children,this.selectedObject.name,e.name);this._updateContainer(this.selectedObject);r.rotateAngle==0||o!=0||this.diagram._rotate(r,o,this.diagram.nameTable);s=t.datavisualization.Diagram.Util.bounds(r);this.diagram._translate(r,l.topLeft.x-s.topLeft.x,l.topLeft.y-s.topLeft.y,this.diagram.nameTable);t.datavisualization.Diagram.DiagramContext.update(r,this.diagram)}else this.diffx=0,this.diffy=0}else this.selectedObject.isPseudoGroup&&(h=this.diagram.nameTable[this.selectedObject.children[0]],h.parent&&(u=this.diagram.nameTable[h.parent].container),u&&u.type=="canvas"&&this.hoverNode&&i&&(f=this.selectedObject.parent,this._updateContainer(i,f,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram)))},r.prototype.mouseup=function(r,u){var y=this.inAction,f,s,h,e,c,l,o,a,v;this.diffx=0;this.diffy=0;this._isMouseDown=!1;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.inAction?(s=this._changeNodeState(r,u),this.inAction=!1,this.activeLabel?this._updateLabelXY(this.activeLabel,this.previousPoint,this.currentPoint):this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint),this._updateNodeState(r,s),this._updateObject(),e={},(this.selectedObject.isGroup||this.selectedObject.isPseudoGroup)&&(e=this.diagram._getChildTable(this.selectedObject,e)),c={childTable:e,node:this.selectedObject},h=n.extend(!0,{},c),this.diagram._selectedSymbol||(l={type:"positionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},h),isMultipleNode:this.selectedObject.isGroup?!0:!1},this.diagram.addHistoryEntry(l)),this.diagram._updateSelectionHandle(),f=this.selectedObject):this.selectedObject?f=this._findNodeUnderMouse(r):r.which==3?this.diagram.selectionList&&!this.diagram.selectionList[0].isPseudoGroup&&(this.diagram.selectionList.length>0?(this.selectedObject=this._findNodeUnderMouse(r,!0),f=this.selectedObject):(this.selectedObject=this._findNodeUnderMouse(r),f=this.selectedObject),this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection()):(r.ctrlKey||r.shiftKey?f=this._processCtrlKey(r):(t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(this.selectedObject=this._findNodeUnderMouse(r)),f=this.selectedObject),this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection());this.selectedObject&&!this.selectedObject.isPseudoGroup&&(o=this._findNodeUnderMouse(r,!0),y||(a=this.selectedObject,v=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:o,model:this.diagram.model,cancel:!1}),this._itemClick(this.selectedObject,this.actualObject,o),v.cancel&&(this.selectedObject=a)));this._allowPan(this.selectedObject,"mouseup",r);this._updateSelection();this.activeLabel=null;this.diagram._removeTooltip();this.diagram._isEditing||this.diagram._endEdit();this.hoverNode=null;f&&this._raiseEvent("click",{element:f});i.prototype.mouseup.call(this,r)},r.prototype._swapChildren=function(n,t,i){var r=n.indexOf(i);n.splice(n.indexOf(t),1);n.splice(r,0,t)},r.prototype._updateObject=function(){var i,n,r;if(this.selectedObject.isPseudoGroup)for(n=0,r=this.selectedObject.children.length;n<r;n++)i=this.diagram.nameTable[this.selectedObject.children[n]],t.datavisualization.Diagram.DiagramContext.update(i,this.diagram);else t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._isMouseDown=!1;this._mouseOffset=t.datavisualization.Diagram.Size(0,0)},r.prototype._renderHelper=function(){this.svgHelper||(this.helper.segments?t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer):this.helper.isGroup?t.datavisualization.Diagram.SvgContext.renderGroup(this.helper,this.diagram._svg,this.diagram._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},r.prototype._updateHelper=function(){this._updateXY(this.helper,this.previousPoint,this.currentPoint);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._updateHelperXY=function(n,i,r){var s=r.x<i.x,h=r.y<i.y,f=this.diffx+(r.x-i.x),e=this.diffy+(r.y-i.y),u,o;(this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines)&&this.diagram._enableSnapToObject()&&(u=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.helper,s,h,t.datavisualization.Diagram.Point(f,e),r,i));u||(u=t.datavisualization.Diagram.Point(f,e));this.diffx=f-u.x;this.diffy=e-u.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(u)||(o=this._raiseEvent("drag",{element:this.helper,offset:u,cancel:!1}),o.cancel||(this.diagram._translate(n,u.x,u.y,this.diagram.nameTable),this._updateParent(n),n.isGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram.nameTable,this.diagram)))},r.prototype._updateXY=function(n,i,r){var s=r.x<i.x,h=r.y<i.y,f=this.diffx+(r.x-i.x),e=this.diffy+(r.y-i.y),u,o,c;(this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram.model.snapSettings.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines||this.diagram._enableSnapToObject())&&(u=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.selectedObject,s,h,t.datavisualization.Diagram.Point(f,e),r,i));u||(u=t.datavisualization.Diagram.Point(f,e));this.diffx=f-u.x;this.diffy=e-u.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(u)||(this.diagram._selectedSymbol||(o=this._raiseEvent("drag",{element:this.selectedObject,offset:u,cancel:!1})),(o&&!o.cancel||this.diagram._selectedSymbol)&&(c=!1,n.shape&&t.datavisualization.Diagram.Util.canAllowPan(n)&&(this.diagram._hScrollOffset===0&&(u.x=0),this.diagram._vScrollOffset===0&&(u.y=0)),this.diagram._translate(n,u.x,u.y,this.diagram.nameTable),this._updateParent(n),n.isGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram.nameTable,this.diagram)))},r.prototype._updateLabelXY=function(n,i,r){var h=t.datavisualization.Diagram.Util.bounds(this.selectedObject),u=r.x-i.x,f=r.y-i.y,e,o,s;this.selectedObject.segments||(e=t.Matrix.identity(),t.Matrix.rotate(e,-this.selectedObject.rotateAngle),o=t.Matrix.transform(e,t.datavisualization.Diagram.Point(u,f)),u=o.x,f=o.y);n.margin.left+=u;n.margin.top+=f;n.margin.right-=u;n.margin.bottom-=f;s=this._raiseEvent("drag",{element:n,offset:n.offset,cancel:!1});s.cancel||t.datavisualization.Diagram.DiagramContext.updateLabel(this.selectedObject,n,this.diagram)},r.prototype._updateParent=function(n){var i,r;if(n.isPseudoGroup)for(r=0;r<n.children.length;r++)i=this.diagram.nameTable[n.children[r]],i&&i.parent&&(t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[i.parent],this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[i.parent],this.diagram),this.diagram._updateAssociatedConnectorEnds(this.diagram.nameTable[i.parent],this.diagram.nameTable));else n&&n.parent&&(t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[n.parent],this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.diagram.nameTable[n.parent],this.diagram),this.diagram._updateAssociatedConnectorEnds(this.diagram.nameTable[n.parent],this.diagram.nameTable))},r.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||this.diagram._addSelection(this.selectedObject)},r}(i);t.datavisualization.Diagram.MoveTool=f;e=function(i){function r(n){i.call(this,"resize",n);this.cursor="default";this._resizeDirection=null;this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.diffx=0;this.diffy=0;this._startPoint=t.datavisualization.Diagram.Size(0,0);this.undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(r){var f,u,e;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mousedown.call(this,r);this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name];u={};(this.selectedObject.isGroup||this.selectedObject.isPseudoGroup)&&(u=this.diagram._getChildTable(this.selectedObject,u));e={childTable:u,node:this.selectedObject};f=n.extend(!0,{},e);this.undoObject=jQuery.extend(!0,{},f);this._resizeDirection=r.target.getAttribute("class");this.diffx=0;this.diffy=0},r.prototype._createUpdateHelper=function(){var n,i;this.helper?(n=t.datavisualization.Diagram.Util.bounds(this.helper),this._updateHelperSize(this.helper,this.previousPoint,this.currentPoint),i=t.datavisualization.Diagram.Util.bounds(this.helper),this.selectedObject.container&&this.diagram._translate(this.helper,n.topLeft.x-i.topLeft.x,n.topLeft.y-i.topLeft.y,this.diagram.nameTable),t.datavisualization.Diagram.SvgContext._updateContainerHelper(this.diagram)):(this.helper=this._getCloneNode(this.selectedObject),this.helper.isGroup=null,this.helper.isPseudoGroup=null,this.helper.name="helper",t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateHelperSize(this.helper,this.previousPoint,this.currentPoint))},r.prototype.mousemove=function(n){var r,u;i.prototype.mousemove.call(this,n);t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.selectedObject&&(this.inAction||(t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._svg,this.diagram._currZoom),this.inAction=!0),r=!1,this.selectedObject&&this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&u.container.type=="canvas"&&(r=!0)):this.selectedObject.isPseudoGroup&&this.hasSameParent()&&this._fromContainer(this.selectedObject.children)&&(r=!0),this.selectedObject&&r?this._createUpdateHelper():this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?this._createUpdateHelper():this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&this.diagram.nameTable[this.selectedObject.parent].container.type=="stack"?(this.helper||(this.helper=this._getCloneNode()),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.helper,this.diagram)):this.selectedObject.isPseudoGroup?this.selectedObject.isPseudoGroup&&!this._fromContainer(this.selectedObject.children)&&this._fromSameContainer(this.selectedObject.children)&&this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint):this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._renderTooltip(this.selectedObject),this.diagram._updateSelectionHandle(!0));this.previousPoint=this.currentPoint},r.prototype._updateResizeObject=function(){var n=this.diagram.nameTable[this.selectedObject.name],r=t.datavisualization.Diagram.Util.bounds(n),u=n.rotateAngle,f,e,i;return this.diagram._rotate(n,-n.rotateAngle,this.diagram.nameTable),f=n.width-this.helper.width,e=n.height-this.helper.height,n.container||n.rotateAngle!=0?(this.diagram.updateNode(n.name,{width:this.helper.width}),this.diagram.updateNode(n.name,{height:this.helper.height})):this._updateSize(n,this.startPoint,this.currentPoint),n.minWidth=n.width,n.minHeight=n.height,this.diagram._rotate(n,u,this.diagram.nameTable),i=t.datavisualization.Diagram.Util.bounds(n),(n.container||n.rotateAngle!=0)&&this.diagram._translate(n,r.topLeft.x-i.topLeft.x,r.topLeft.y-i.topLeft.y,this.diagram.nameTable),n},r.prototype.mouseup=function(r){var f,s,u,e,h,c,o,l,a;this.inAction&&(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.inAction=!1,f=!1,this.selectedObject&&this.selectedObject.parent?(s=this.diagram.nameTable[this.selectedObject.parent],s.container&&s.container.type=="canvas"&&(f=!0)):this.selectedObject.isPseudoGroup&&this.hasSameParent()&&this._fromContainer(this.selectedObject.children)&&(f=!0),this.selectedObject&&f?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),u=this._updateResizeObject(),this._updateContainer(u,null,!0)):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),u=this.diagram.nameTable[this.selectedObject.name],this.selectedObject.container&&(u.minWidth=this.helper.width.width,u.minHeight=this.helper.width.height),this._updateSize(this.selectedObject,this._startPoint,this.currentPoint,null,null,!0),this.selectedObject.parent?(e=this.diagram.nameTable[this.selectedObject.parent],e.isGroup&&e.container&&e.container.type=="stack"&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),u=this.diagram.nameTable[this.selectedObject.name],h=this.diagram._getMinMaxSize(this.selectedObject,this.helper.width,this.helper.height),u.height=h.height,u.width=h.width,this.selectedObject.container&&(u.minWidth=u.width,u.minHeight=u.height),this._updateContainer(this.diagram.nameTable[this.selectedObject.name]))):this.selectedObject&&(this.selectedObject.minWidth=this.selectedObject.width,this.selectedObject.minHeight=this.selectedObject.height)):this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&this.diagram.nameTable[this.selectedObject.parent].container.type=="stack"?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this.selectedObject.height=this.helper.height,this.selectedObject.width=this.helper.width,this._updateContainer(this.selectedObject)):this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(),o={},(this.selectedObject.isGroup||this.selectedObject.isPseudoGroup)&&(o=this.diagram._getChildTable(this.selectedObject,o)),l={childTable:o,node:this.selectedObject},c=n.extend(!0,{},l),a={type:"sizechanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},c),isMultipleNode:this.selectedObject.isGroup?!0:!1},this.diagram.addHistoryEntry(a),this.diagram._removeTooltip());i.prototype.mouseup.call(this,r)},r.prototype._updateContainer=function(n,i,r){var e,o,c=0,l=0,f,s,rt,u,d,ut,h,p,w,nt,tt,it,b,k;if(n&&(s=this.diagram.nameTable[n.parent],!s&&n.isPseudoGroup&&(rt=this.diagram.nameTable[this.selectedObject.children[0]],s=this.diagram.nameTable[rt.parent]),s))if(s.container.type=="canvas"){if(r){r=!1;u=this.diagram.nameTable[n.parent];!u&&n.isPseudoGroup&&(u=s);d=t.datavisualization.Diagram.Util.bounds(u);ut=u.rotateAngle;this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable);e=t.datavisualization.Diagram.Util.bounds(n);h=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);o=t.datavisualization.Diagram.Util.bounds(u);var a=this.diagram._getTightChildrenBounds(u),ft=!0,g=!0,v=h.x+h.width,y=h.y+h.height;v>=o.right&&(c=v-o.right+u.paddingRight,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2,v<o.right&&(ft=!1));y>=o.bottom&&(l=y-o.bottom+u.paddingBottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2,g=!0,y<o.bottom&&(g=!1));v<o.right&&ft&&(c=a.x+a.width+u.paddingRight-o.right,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2);y<o.bottom&&g&&(l=a.y+a.height+u.paddingBottom-o.bottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2);this._updateMargin(n,u);t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram);this.diagram._rotate(u,ut,this.diagram.nameTable);nt=t.datavisualization.Diagram.Util.bounds(u);this.diagram._translate(u,d.topLeft.x-nt.topLeft.x,d.topLeft.y-nt.topLeft.y,this.diagram.nameTable);u.parent&&u.container&&u.container.type=="canvas"&&this._updateMargin(u,this.diagram.nameTable[u.parent]);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram)}else tt=!1,it=!1,u=this.diagram.nameTable[n.parent],n.container&&n.container.type=="stack"&&(n.container.orientation=="vertical"?tt=!0:it=!0),e=this.diagram._getBoundsWithoutStretch(u,tt,it),e.width+=u.paddingLeft+u.paddingRight,e.height+=u.paddingTop+u.paddingBottom,f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);u.parent&&(this.diagram.nameTable[u.parent]&&(r=!0),this._updateContainer(u,null,r))}else s.container.type=="stack"&&(u=this.diagram.nameTable[n.parent],e=t.datavisualization.Diagram.SvgContext._measureStackSize(u,this.diagram,!0),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnStack(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram),u.parent&&this._updateContainer(u))},r.prototype._updateSize=function(n,i,r,u,f,e){var d=t.Matrix.identity(),nt,tt,h,c,l,ot,ft,rt,ut,it,st;t.Matrix.rotate(d,-n.rotateAngle);var a={snapped:!1,offset:0,left:!1,right:!1},v={snapped:!1,offset:0,top:!1,bottom:!1},o=(u?u:r.x-i.x)+this.diffx,s=(f?f:r.y-i.y)+this.diffy,y=s,p=o;this.diffx=0;this.diffy=0;var k=t.datavisualization.Diagram.Point(0,0),g=t.Matrix.identity(),et=n.pivot,w=n.offsetX,b=n.offsetY;t.Matrix.rotate(g,n.rotateAngle,w,b);nt=n.width;tt=n.height;w=w-nt*et.x;b=b-tt*et.y;switch(this._resizeDirection){case"n-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt/2,b+tt));c=1;n.rotateAngle||(s=this._snapTop(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;o=0;l=(n.height-s)/n.height;break;case"e-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w,b+tt/2));n.rotateAngle||(o=this._snapRight(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;s=0;c=(n.width+o)/n.width;l=1;break;case"w-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt,b+tt/2));n.rotateAngle||(o=this._snapLeft(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;s=0;c=(n.width-o)/n.width;l=1;break;case"s-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt/2,b));c=1;n.rotateAngle||(s=this._snapBottom(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;o=0;l=(n.height+s)/n.height;break;case"ne-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w,b+tt));n.rotateAngle||n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(s=this._snapTop(a,v,p,y,n,r==i),o=this._snapRight(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;c=(n.width+o)/n.width;l=(n.height-s)/n.height;break;case"nw-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt,b+tt));n.rotateAngle||n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(s=this._snapTop(a,v,p,y,n,r==i),o=this._snapLeft(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;c=(n.width-o)/n.width;l=(n.height-s)/n.height;break;case"se-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w,b));n.rotateAngle||n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(s=this._snapBottom(a,v,p,y,n,r==i),o=this._snapRight(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;c=(n.width+o)/n.width;l=(n.height+s)/n.height;break;case"sw-resize":k=t.Matrix.transform(g,t.datavisualization.Diagram.Point(w+nt,b));n.rotateAngle||n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(s=this._snapBottom(a,v,p,y,n,r==i),o=this._snapLeft(a,v,p,y,n,r==i));h=t.Matrix.transform(d,t.datavisualization.Diagram.Point(o,s));o=h.x;s=h.y;c=(n.width-o)/n.width;l=(n.height+s)/n.height}if(n&&(n.isPseudoGroup===!0||n.isGroup===!0))for(ft=this.diagram.nameTable[this.diagram.selectionList[0].name].children,rt=0;rt<ft.length;rt++)ut=this.diagram.nameTable[ft[rt]],ut&&!ut.segments&&ut.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio&&(ot=!0);(ot||n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio)&&(Math.abs(o)>Math.abs(s)?l=c:c=l);it=t.datavisualization.Diagram.Size();it.width=c;it.height=l;t.datavisualization.Diagram.Geometry.isEmptySize(it)||(this.diagram.scale(n,c,l,k,this.diagram.nameTable,null,e),st=this._raiseEvent("sizeChange",{element:this.selectedObject,offset:it,cancel:!1}),st.cancel&&this.diagram.scale(n,1/c,1/l,k,this.diagram.nameTable),n.isGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram.nameTable,this.diagram))},r.prototype._updateHelperSize=function(n,i,r,u,f){var b=t.Matrix.identity(),g,nt,s,p,w,tt;t.Matrix.rotate(b,-n.rotateAngle);var h={snapped:!1,offset:0,left:!1,right:!1},c={snapped:!1,offset:0,top:!1,bottom:!1},e=(u?u:r.x-i.x)+this.diffx,o=(f?f:r.y-i.y)+this.diffy,l=o,a=e;this.diffx=0;this.diffy=0;var k=t.datavisualization.Diagram.Point(0,0),d=t.Matrix.identity(),it=n.pivot,v=n.offsetX,y=n.offsetY;t.Matrix.rotate(d,n.rotateAngle,v,y);g=n.width;nt=n.height;v=v-g*it.x;y=y-nt*it.y;switch(this._resizeDirection){case"n-resize":k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v+g/2,y+nt));p=1;o=this._snapTop(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;w=(n.height-o)/n.height;break;case"e-resize":k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v,y+nt/2));e=this._snapRight(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;p=(n.width+e)/n.width;w=1;break;case"w-resize":k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v+g,y+nt/2));e=this._snapLeft(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;p=(n.width-e)/n.width;w=1;break;case"s-resize":k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v+g/2,y));p=1;o=this._snapBottom(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;w=(n.height+o)/n.height;break;case"ne-resize":o=this._snapTop(h,c,a,l,n,r==i);k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v,y+nt));e=this._snapRight(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;p=(n.width+e)/n.width;w=(n.height-o)/n.height;break;case"nw-resize":o=this._snapTop(h,c,a,l,n,r==i);k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v+g,y+nt));e=this._snapLeft(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;p=(n.width-e)/n.width;w=(n.height-o)/n.height;break;case"se-resize":k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v,y));o=this._snapBottom(h,c,a,l,n,r==i);e=this._snapRight(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;p=(n.width+e)/n.width;w=(n.height+o)/n.height;break;case"sw-resize":k=t.Matrix.transform(d,t.datavisualization.Diagram.Point(v+g,y));o=this._snapBottom(h,c,a,l,n,r==i);e=this._snapLeft(h,c,a,l,n,r==i);s=t.Matrix.transform(b,t.datavisualization.Diagram.Point(e,o));e=s.x;o=s.y;p=(n.width-e)/n.width;w=(n.height+o)/n.height}tt=t.datavisualization.Diagram.Size();tt.width=p;tt.height=w;t.datavisualization.Diagram.Geometry.isEmptySize(tt)||(this.diagram.scale(n,p,w,k,this.diagram.nameTable,null,null,!0),n.isGroup&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram.nameTable,this.diagram))},r.prototype._snapTop=function(n,i,r,u,f,e){var o=u,s,a,h,c,l;return i.top=!0,s=this.diagram.model.snapSettings,a=this.diagram._currZoom,this.diagram._enableSnapToObject()&&t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,u,this.selectedObject,e),h=t.datavisualization.Diagram.Util.bounds(f),i.snapped?(this.diffy=o-i.offset,o=i.offset):s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(c=h.top+u,l=t.datavisualization.Diagram.SnapUtil._round(c,s.horizontalGridLines.snapInterval,a),o=l-h.top,this.diffy=c-l),o},r.prototype._snapBottom=function(n,i,r,u,f,e){var o=u,s,a,h,c,l;return i.bottom=!0,s=this.diagram.model.snapSettings,a=this.diagram._currZoom,this.diagram._enableSnapToObject()&&t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,u,this.selectedObject,e),h=t.datavisualization.Diagram.Util.bounds(f),i.snapped?(this.diffy=o-i.offset,o=i.offset):s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(c=h.bottom+u,l=t.datavisualization.Diagram.SnapUtil._round(c,s.horizontalGridLines.snapInterval,a),o=l-h.bottom,this.diffy=c-l),o},r.prototype._snapLeft=function(n,i,r,u,f,e){var o=r,s,a,h,c,l;return n.left=!0,s=this.diagram.model.snapSettings,a=this.diagram.model.zoomFactor,this.diagram._enableSnapToObject()&&t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,u,this.selectedObject,e),h=t.datavisualization.Diagram.Util.bounds(f),n.snapped?(this.diffx=o-n.offset,o=n.offset):s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(c=h.left+r,l=t.datavisualization.Diagram.SnapUtil._round(c,s.verticalGridLines.snapInterval,a),o=l-h.left,this.diffx=c-l),o},r.prototype._snapRight=function(n,i,r,u,f,e){var o=r,s,a,h,c,l;return n.right=!0,s=this.diagram.model.snapSettings,a=this.diagram._currZoom,this.diagram._enableSnapToObject()&&t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,u,this.selectedObject,e),h=t.datavisualization.Diagram.Util.bounds(f),n.snapped?(this.diffx=o-n.offset,o=n.offset):s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(c=h.right+r,l=t.datavisualization.Diagram.SnapUtil._round(c,s.verticalGridLines.snapInterval,a),o=l-h.right,this.diffx=c-l),o},r}(i);t.datavisualization.Diagram.ResizeTool=e;o=function(i){function r(n){i.call(this,"endPoint",n);this.cursor="move";this._endPoint=null;this._undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(t){if(i.prototype.mousedown.call(this,t),t.ctrlKey&&t.shiftKey){var r=n(t.target).parents(".ej-d-connector");r.length>0&&(this.selectedObject=this.diagram.nameTable[r[0].id],this.diagram._hasSelection()&&this.diagram._clearSelection(),this.diagram._addSelection(this.selectedObject))}this.diagram.selectionList[0]&&!this.selectedObject&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name]);this.undoObject=this._getClonedObject(this.selectedObject);this._endPoint=t.target.getAttribute("class");this.targetid=t.target.id;this._selectedSegment=""},r.prototype.mousemove=function(n){var f,e,o,u,r,h,s,c,l;i.prototype.mousemove.call(this,n);!this.selectedObject||n.ctrlKey&&n.shiftKey||(f=!1,this.selectedObject.segments.length==2&&(f=!0),e=this.currentPoint.x-this.previousPoint.x,o=this.currentPoint.y-this.previousPoint.y,this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this.inAction&&(this.selectedSegment&&this._endPoint=="segmentEnd"?this._updateAdjacentSegments(e,o):this._endPoint!="segmentEnd"&&((this._endPoint=="targetEndPoint"||this._endPoint=="sourceEndPoint")&&this._checkConnectionPossible(n),l=this._updatePoints(this.selectedObject),this._disconnect(this.selectedObject),this._updateConnection(this.selectedObject,l)),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateConnectorBridging(this.selectedObject),this.diagram._updateSelectionHandle(!0)):(this.inAction=!0,this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").style["pointer-events"]="none",this.diagram._svg.getElementById(this.selectedObject.name).style["pointer-events"]="none",this.diagram._svg.getElementById(this.diagram._svg.document.id+"handle_g").style["pointer-events"]="none",u=this.targetid.split("_"),u.reverse(),r=Number(u[0]),this.selectedSegment=this.selectedObject.segments[r],h=this.selectedSegment,this.selectedSegment&&this.selectedSegment.type=="orthogonal"?(s=!1,r===0&&(c=!0),this.selectedSegment.length?r==0?(this.insertFirstSegment(e,o,u),s=!0):this.nextSegment=this.selectedObject.segments[r+1]:(this._addTerminalSegment(e,o,u),s=!0)):this.nextSegment=this.selectedObject.segments[r+1],s&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,!(f||c||!this.selectedObject.sourcePort),!(f||!(h.length||h.length===0)||!this.selectedObject.targetPort),this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom)),this.selectedSegment||this._endPoint!="targetEndPoint"||(this.selectedSegment=this.selectedObject.segments[this.selectedObject.segments.length-1]),this.selectedSegment||this._endPoint!="sourceEndPoint"||(this.selectedSegment=this.selectedObject.segments[0],this.nextSegment=this.selectedObject.segments[1]),this.undoObject=this._getClonedObject(this.selectedObject)));this.previousPoint=this.currentPoint},r.prototype._updateAdjacentSegments=function(n,i){var r=this.selectedSegment,u={x:n+r._endPoint.x,y:i+r._endPoint.y},e,f;r.type=="orthogonal"?(r._direction=="left"||r._direction=="right"?(r._startPoint.y+=i,r._endPoint.y=r._startPoint.y):(r._startPoint.x+=n,r._endPoint.x=r._startPoint.x),r.points[0]=r._startPoint,r.points[r.points.length-1]=r._endPoint,e=this.selectedObject.segments.indexOf(this.selectedSegment),f=this.selectedObject.segments[e-1],f&&this.updatePreviousSegment(r,f,n,i)):r.type=="straight"?(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u):(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u,t.datavisualization.Diagram.Util._updateBezierPoints(r));this.nextSegment&&this.updateNextSegment(r,this.nextSegment,n,i)},r.prototype._addTerminalSegment=function(n,i,r){var u=this.selectedSegment,f,e,o,h,c,s;for(this.selectedObject.segments.pop(),f=this.selectedObject.segments[this.selectedObject.segments.length-1]&&this.selectedObject.segments[this.selectedObject.segments.length-1].type=="orthogonal"?this.selectedObject.segments[this.selectedObject.segments.length-1]:null,e=0;e<u.points.length-2;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=f.direction=="top"||f.direction=="bottom"?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),f=o,this.selectedObject.segments.push(o);if(h=Number(r[1]),(u.points.length==2||h==u.points.length-2)&&(f&&(f.length+=5,f._length=f.length),h!=0)){var l=t.datavisualization.Diagram.Geometry.distance(u.points[u.points.length-2],u._endPoint),a=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint),v=t.datavisualization.Diagram.Segment({type:"orthogonal",length:2*l/3,direction:a});this.selectedObject.segments.push(v)}c=t.datavisualization.Diagram.Segment({type:"orthogonal"});this.selectedObject.segments.push(c);s=Number(r[0])+(Number(r[1])||0);this.selectedSegment=this.selectedObject.segments[s];this.nextSegment=this.selectedObject.segments[s+1];s==this.selectedObject.segments.length-2?this.nextSegment._direction=Number(r[0])==0?t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint):u._direction:c._direction=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint);s==0&&this.insertFirstSegment(n,i,r)},r.prototype.insertFirstSegment=function(n,i,r){var u=this.selectedSegment,l,e,o,f,h,c,s,a;if(this.selectedObject.sourcePort&&u.length&&this.selectedObject.segments[0].points.length>2){for(this.selectedObject.segments.splice(0,1),f=[],e=0;e<u.points.length-1;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=l.direction=="top"||l.direction=="bottom"?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),l=o,f.push(o);this.selectedObject.segments=f.concat(this.selectedObject.segments);this.selectedSegment=this.selectedObject.segments[Number(r[1])];this.nextSegment=this.selectedObject.segments[Number(r[1])+1]}else u=this.selectedObject.segments[0],f=[],f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:u.direction,length:u.length/3})),u.direction=="bottom"||u.direction=="top"?(h=Math.max(5,Math.abs(n)),c=n>0?"right":"left"):(h=Math.max(5,Math.abs(i)),c=i>0?"bottom":"top"),f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:c,length:h})),s=this.selectedObject.segments[1],s&&s.length&&(c!=s.direction&&(h*=-1),s.length-=h,s._length=s.length),u.length=u._length=2*u._length/3,this.selectedObject.segments=f.concat(this.selectedObject.segments),a=Number(r[0])+Number(r[1]),this.selectedSegment=this.selectedObject.segments[2],this.nextSegment=this.selectedObject.segments[3]},r.prototype.updatePreviousSegment=function(n,i,r,u){i._endPoint=i.points[i.points.length-1]=n._startPoint;var f=n.type=="orthogonal"&&!n.direction?t.datavisualization.Diagram.Util._getBezierDirection(n._startPoint,n._endPoint):n.direction;i.type=="orthogonal"?f=="left"||f=="right"?(i.direction=="bottom"?(i.length+=u,i.length<0&&(i._direction=i.direction="top",i.length*=-1)):(i.length-=u,i.length<0&&(i._direction=i.direction="bottom",i.length*=-1)),i._length=i.length):i&&(i.direction=="right"?(i.length+=r,i.length<0&&(i._direction=i.direction="left",i.length*=-1)):(i.length-=r,i.length<0&&(i._direction=i.direction="right",i.length*=-1)),i._length=i.length):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i)},r.prototype.updateNextSegment=function(n,i,r,u){var o=n._endPoint,e,f;i._startPoint=i.points[0]=this.selectedSegment._endPoint;i&&(i.type=="orthogonal"?(i.length||i.length===0)&&(i._direction=="left"||i._direction=="right"?(r!=0&&(i._direction=="right"?i._length-=r:i._length+=r,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="left"?i.direction="right":i.direction=="right"&&(i.direction="left"),i.length*=-1,i._direction=i.direction,i._length=i.length))),u!=0&&n.type!="orthogonal"&&(i._startPoint.y=i.points[0].y=i._endPoint.y=i.points[i.points.length-1].y=o.y,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f._startPoint.y=f.points[0].y=i._endPoint.y,f.length&&(f.direction=="bottom"?(f.length-=u,f.length<0&&(f.direction="top",f.length*=-1)):(f.length+=u,f.length<0&&(f.direction="bottom",f.length*=-1))))):(u!=0&&(i._direction=="bottom"?i._length-=u:i._length+=u,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="top"?i.direction="bottom":i.direction=="bottom"&&(i.direction="top"),i.length*=-1,i._length=i.length,i._direction=i.direction))),r!=0&&n.type!="orthogonal"&&(i._startPoint.x=i.points[0].x=i._endPoint.x=i.points[i.points.length-1].x=o.x,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f.length&&(f.direction=="right"?(f.length+=r,f.length<0&&(f.direction="left",f.length*=-1)):(f.length-=r,f.length<0&&(f.direction="right",f.length*=-1)))))):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i))},r.prototype.mouseup=function(n){var o,s;if(n.shiftKey&&n.ctrlKey)this._addOrRemoveStraightSegments(n);else if(this.inAction){if(this.inAction=!1,this._endPoint=="segmentEnd"&&this.selectedSegment.type=="orthogonal"){var u=this.selectedObject.segments.indexOf(this.selectedSegment),f=this.selectedObject.segments[u-1],r=this.selectedObject.segments[u+1],e=!1;f&&f.type=="orthogonal"&&Math.abs(f.length)<5?u!=1&&(e=this._removePrevSegment(u)):r&&r.type=="orthogonal"&&(o=r.length||r.length===0?r.length:t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]),Math.abs(o<=5)&&(e=this._removeNextSegment(u)));e&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom))}else this._endPoint!="segmentEnd"&&(this._updatePoints(this.selectedObject),this._disconnect(this.selectedObject),this._currentPossibleConnection&&!this.inAction?this._updateConnection(this.selectedObject):(this.selectedObject.sourceNode||this.selectedObject.targetNode)&&this._updateConnection(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram.nameTable));this.diagram._updateSelectionHandle();this.selectedObject&&(this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").style["pointer-events"]="",this.diagram._svg.getElementById(this.selectedObject.name).style["pointer-events"]="");this.diagram._svg.getElementById(this.diagram._svg.document.id+"handle_g").style["pointer-events"]=""}s={type:"endpointchanged",undoObject:this.undoObject,redoObject:this._getClonedObject(this.selectedObject),isMultipleNode:this.selectedObject.isGroup?!0:!1};this.diagram.addHistoryEntry(s);i.prototype.mouseup.call(this,n)},r.prototype._addOrRemoveStraightSegments=function(n){var s,e,r,f,i,u;if(this._endPoint=="segmentEnd")s=n.target.id,e=s.split("_"),e.reverse(),r=Number(e[0]),i=this.selectedObject.segments[r],i&&i.type=="straight"&&(f=this.selectedObject.segments[r+1],f&&(this.selectedObject.segments.splice(r,1),f._startPoint=f.points[0]=i._startPoint,o=!0));else{var h=n.target.getAttribute("class"),s=n.target.id,o=!1,r=this._findIndex();this.selectedObject.segments&&this.selectedObject.segments[r]&&this.selectedObject.segments[r].type=="straight"&&(i=this.selectedObject.segments[r],u=t.datavisualization.Diagram.Segment({type:"straight",point:i._endPoint}),this.selectedObject.segments.splice(r+1,0,u),i._point=i.point=i.points[1]=i._endPoint=this.currentPoint,u.points[0]=u._startPoint=this.currentPoint,u.points[1]=u._endPoint=u.point,o=!0)}o&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram._currZoom))},r.prototype._findIndex=function(){for(var n,o,e,s,h,u,c,l,f,r=[],i=0;i<this.selectedObject.segments.length;i++)n=this.selectedObject.segments[i],o={x:Math.min(n._startPoint.x,n._endPoint.x),y:Math.min(n._startPoint.y,n._endPoint.y),width:Math.abs(n._startPoint.x-n._endPoint.x),height:Math.abs(n._startPoint.y-n._endPoint.y)},t.datavisualization.Diagram.Geometry.inflate(o,this.selectedObject.lineHitPadding/2,this.selectedObject.lineHitPadding/2),t.datavisualization.Diagram.Geometry.containsPoint(o,this.currentPoint)&&r.push(n);if(r.length==1)return this.selectedObject.segments.indexOf(r[0]);for(i=0;i<r.length;i++)u=r[i],f=this.currentPoint,c=(f.y-u._startPoint.y)/(u._endPoint.y-f.y),l=(f.x-u._startPoint.x)/(u._endPoint.x-f.x),e=Math.abs(c-l),i==0&&(s=e,h=0),e<s&&(s=e,h=i);return this.selectedObject.segments.indexOf(r[h])},r.prototype._removeNextSegment=function(n){var i=this.selectedObject.segments[n-1],r=this.selectedObject.segments[n+2],u=this.selectedObject.segments[n+1];return u.length||u.length===0?(this.selectedObject.segments.splice(n,2),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?(r._startPoint.y=this.selectedSegment._startPoint.y,i._endPoint.x=r._startPoint.x):(r._startPoint.x=this.selectedSegment._startPoint.x,i._endPoint.y=r._startPoint.y)):(this.selectedObject.segments.splice(n+1,1),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?i._endPoint.x=u._endPoint.x:i._endPoint.y=u._endPoint.y,i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)),this.selectedSegment.length=this.selectedSegment._length=this.selectedSegment.direction=null),i&&r&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,r._startPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,r._startPoint)),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(i._endPoint,r._endPoint),r.length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._endPoint,r._endPoint)))),!0},r.prototype._removePrevSegment=function(n){var i=this.selectedObject.segments[n-2],f=this.selectedObject.segments[n+1],o=f.length||f.length===0?f.length:t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]),r,u,e;return o<=5?(r=this.selectedObject.segments[n+2],f.length===o?this.selectedObject.segments.splice(n-1,4):this.selectedObject.segments.splice(n-1,3),r?(i.direction=="top"||i.direction=="bottom"?(i._endPoint.y=r._endPoint.y,r._startPoint.x=i._endPoint.x):(i._endPoint.x=r._endPoint.x,r._startPoint.y=i._endPoint.y),(i.length||i.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(r._startPoint,r._endPoint),r._length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(r._startPoint,r._endPoint)))):(i._endPoint=this.selectedObject.endPoint,i.direction=i.length=i._length=null,i._direction=f._direction)):(u=this.selectedObject.segments[n+1],this.selectedObject.segments.splice(n-1,2),e=this.selectedSegment,e.direction=="left"||e.direction=="right"?(i._endPoint.x=u._startPoint.x,u._startPoint.y=i._endPoint.y):(i._endPoint.y=u._startPoint.y,u._startPoint.x=i._endPoint.x),(this.selectedSegment.length||this.selectedSegment.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(u.length||u.length===0)&&(u._length=u.length=t.datavisualization.Diagram.Geometry.distance(u._startPoint,u._endPoint),u.length&&(u._direction=u.direction=t.datavisualization.Diagram.Util._getBezierDirection(u._startPoint,u._endPoint)))),!0},r.prototype._getClonedObject=function(t){if(t){var i=n.extend(!0,{},t);return i.targetNode=t.targetNode,i.sourceNode=t.sourceNode,i.targetPort=t.targetPort,i.sourcePort=t.sourcePort,i}},r.prototype._updateConnection=function(n,i){var r,u;this._endPoint=="targetEndPoint"?(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.targetNode!=this._currentPossibleConnection.name||n.targetPort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n,!0)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.targetNode!=this._currentPossibleConnection.name||n.targetPort)&&(r=this._raiseConnectionChangeEvent(n,!0)):this.selectedObject.targetNode&&(r=this._raiseConnectionChangeEvent(n,!0)),r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),(n.segments.length>2||n.segments[0].points.length==2)&&t.datavisualization.Diagram.Util._updatePreviousSegment(n),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor))):this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort)&&(r=this._raiseConnectionChangeEvent(n)):(this.selectedObject.sourceNode&&(r=this._raiseConnectionChangeEvent(n),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram)),r&&t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor));u=this.selectedSegment._endPoint;this.diagram._dock(n,this.diagram.nameTable,i);r&&this._endPoint=="sourceEndPoint"&&this.selectedObject.segments.length>1&&(this.selectedSegment.points.length==2&&!this.selectedObject.sourcePort&&this.selectedSegment.length?(this.selectedSegment.direction=="right"||this.selectedSegment.direction=="left"?(this.selectedSegment.direction=this.selectedSegment._startPoint.x<u.x?this.selectedSegment._direction="right":this.selectedSegment._direction="left",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.x-u.x)):(this.selectedSegment.direction=this.selectedSegment._startPoint.y<u.y?this.selectedSegment._direction="bottom":this.selectedSegment._direction="top",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.y-u.y)),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor)):r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._svg,this.diagram.model.zoomFactor)))},r.prototype._raiseConnectionChangeEvent=function(n,i){var u=this._raiseEvent("connectionChange",{element:this.selectedObject,endPoint:this._endPoint,connection:this._currentPossibleConnection,port:this._possibleConnectionPort,cancel:!1}),r;if(!u.cancel)return i?(this._currentPossibleConnection&&n.targetNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.inEdges.push(n.name),n.targetNode&&(r=this.diagram.nameTable[this.selectedObject.targetNode],t.datavisualization.Diagram.Util.removeItem(r.inEdges,n.name))),n.targetNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,n.targetPort=this._possibleConnectionPort?this._possibleConnectionPort.name:null):(this._currentPossibleConnection&&n.sourceNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.outEdges.push(n.name),n.sourceNode&&(r=this.diagram.nameTable[this.selectedObject.sourceNode],t.datavisualization.Diagram.Util.removeItem(r.outEdges,n.name))),n.sourceNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,n.sourcePort=this._possibleConnectionPort?this._possibleConnectionPort.name:null),!0},r.prototype._disconnect=function(){},r.prototype._endAction=function(){this._showPorts();var n;this._currentPossibleConnection&&!this._possibleConnectionPort&&(n=this._currentPossibleConnection);i.prototype._endAction.apply(this);this._endPoint&&(this._endPoint=null,n&&(this.diagram._checkToolToActivate(n,this.currentPoint),this.diagram._updateCursor()))},r.prototype._updatePoints=function(n){var u,s,f,a,r,p,v,w,h,c,y,i,e,o,l,b;if(this._endPoint!="segmentEnd"&&(u=this._endPoint=="targetEndPoint"?!0:!1,s=this._endPoint=="sourceEndPoint"?!0:!1,this._endPoint)){a=this._endPoint.match("bezierpoint1")?"bezierpoint1":this._endPoint.match("bezierpoint2")?"bezierpoint2":this._endPoint;switch(a){case"targetEndPoint":f=this.selectedSegment._endPoint;break;case"sourceEndPoint":f=this.selectedSegment._startPoint;break;case"bezierpoint1":f=this.selectedSegment._point1;break;case"bezierpoint2":f=this.selectedSegment._point2}if(r=this.currentPoint,this._possibleConnectionPort==null&&(r=this.snap(r)),p=t.datavisualization.Diagram.Point(f.x-r.x,f.y-r.y),!t.datavisualization.Diagram.Geometry.isEmptyPoint(p)&&(v=!1,h=null,this.inAction||(u?h="target":s&&(h="source"),w=this._raiseEvent("drag",{end:h,element:this.selectedObject,cancel:!1}),v=w.cancel),!v))if(u||s){if(c=this._currentPossibleConnection?t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection,!1):!1,this.selectedObject.segments.length>1&&(u||c||this.selectedSegment.type!="orthogonal"||!this.selectedSegment.length&&this.selectedSegment.length!==0?u&&!c&&this.selectedSegment.type=="orthogonal"&&this.selectedSegment.points.length==2&&(e=r.x-this.selectedSegment._endPoint.x,o=r.y-this.selectedSegment._endPoint.y,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?(this.selectedSegment._startPoint.y=this.selectedSegment.points[0].y+=o,this.selectedSegment._endPoint.y=this.selectedSegment.points[1].y=this.selectedSegment._startPoint.y):(this.selectedSegment._startPoint.x=this.selectedSegment.points[0].x+=e,this.selectedSegment._endPoint.x=this.selectedSegment.points[1].x=this.selectedSegment._startPoint.x),l=this.selectedObject.segments.length-1,this.selectedObject.segments[l-1]&&this.updatePreviousSegment(this.selectedObject.segments[l],this.selectedObject.segments[l-1],e,o)):(this.selectedObject.sourcePoint=r,e=r.x-this.selectedSegment._startPoint.x,o=r.y-this.selectedSegment._startPoint.y,this.selectedSegment.direction=="left"||this.selectedSegment.direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,this.selectedSegment._endPoint),this.selectedSegment._length&&(this.selectedSegment._direction=this.selectedSegment.direction=t.datavisualization.Diagram.Util._getBezierDirection(r,this.selectedSegment._endPoint)),this.updateNextSegment(this.selectedObject.segments[0],this.selectedObject.segments[1],e,o),i=this.selectedObject.segments[1],y=!1,i&&i.length&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,i._endPoint),i.length&&(i.direction=i._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,i._endPoint))),this.selectedSegment.length==0||i.length===0?(i.length==0&&this.selectedObject.segments.length>2?this.selectedObject.segments.splice(0,2):this.selectedObject.segments.length>1&&this.selectedObject.segments.splice(0,1),this.selectedSegment=this.selectedObject.segments[0],this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,i=this.selectedObject.segments[1],this.selectedObject.segments.length>1?(this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,i._startPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[1],n.segments[0],n.segments[2],n.sourcePoint,n.targetPoint),i._startPoint=i.points[0]=n.segments[0]._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),y=!0):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),i&&i.length&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,i._endPoint),i.length&&(i.direction=i._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,i._endPoint))))),(s||u)&&!c&&(b=this.selectedSegment.points.length,this.diagram._setEndPoint(n,t.datavisualization.Diagram.Point(r.x,r.y),u),b!=this.selectedSegment.points.length||y))return!0}else t.datavisualization.Diagram.Util._setBezierPoint(this.selectedSegment,t.datavisualization.Diagram.Point(r.x,r.y),a)}},r}(i);t.datavisualization.Diagram.ConnectionEditTool=o;r=function(i){function r(n,t){i.call(this,n,t);this.cursor="crosshair";this._isMouseDown=!1;this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this._isMouseDown=!0;this.diagram._hasSelection()&&this.diagram._clearSelection();this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort)},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);this._checkConnectionPossible(n);this._isMouseDown&&(this.inAction?(this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this._possibleConnectionPort,this._updateHelper()):(this.inAction=!0,this._initHelper(),this._renderHelper()));this.previousPoint=this.currentPoint},r.prototype.mouseup=function(n){var r,u;if(this._isMouseDown=!1,this.inAction){this.inAction=!1;var f=this._getStartPoint(),e=this._getCurrentPoint(),o=t.datavisualization.Diagram.Geometry.distance(f,e);o>0&&(r=this.createConnector(f,e),r.name="connector"+t.datavisualization.Diagram.Util.randomId(),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),u.cancel||(r.sourceNode=this._sourcePossibleConnection.name,r.sourcePort=this._sourcePort.name,t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name))):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),u.cancel||(r.sourceNode=this._sourcePossibleConnection.name,t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name)))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),u.cancel||(r.targetNode=this._targetPossibleConnection.name,r.targetPort=this._targetPort.name,t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name))):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),u.cancel||(r.targetNode=this._targetPossibleConnection.name,t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name)))),this.diagram.add(r))}this.singleAction&&this.diagram.deactivateTool();this._prevTool&&(this._prevTool.inAction=!1);this._showPorts();i.prototype.mouseup.call(this,n)},r.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},r.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},r.prototype._initHelper=function(){this.helper=this.createConnector(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(0,0));this.diagram._setZorder(this.helper);this.helper.name="helper"},r.prototype.createConnector=function(){return null},r.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id)).attr("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id+"_hitTest")).attr("pointer-events","none"))},r.prototype._updateHelper=function(){var n=[],i=this._getStartPoint(),r=this._getCurrentPoint();n.push(i);n.push(r);this.diagram._setEndPoint(this.helper,i,!1);this.diagram._setEndPoint(this.helper,r,!0);this._disconnect(this.helper);this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(this.helper.sourceNode=this._sourcePossibleConnection.name,this.helper.sourcePort=this._sourcePort.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(this.helper.sourceNode=this._sourcePossibleConnection.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)));this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(this.helper.targetNode=this._targetPossibleConnection.name,this.helper.targetPort=this._targetPort.name,this._targetPossibleConnection.inEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(this.helper.targetNode=this._targetPossibleConnection.name,this._targetPossibleConnection.inEdges.push(this.helper.name)));this.diagram._dock(this.helper,this.diagram.nameTable);t.datavisualization.Diagram.Util.updateBridging(this.helper,this.diagram);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null;this._isMouseDown=!1},r.prototype._showPorts=function(){},r.prototype._showAllPorts=function(n){i.prototype._showAllPorts.call(this,n)},r}(i);t.datavisualization.Diagram.LineTool=r;s=function(n){function i(t){n.call(this,"straightLine",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createConnector=function(n,t){return this.diagram._getNewConnector({segments:[{type:"straight"}],sourcePoint:n,targetPoint:t})},i}(r);t.datavisualization.Diagram.StraightLineTool=s;h=function(n){function i(t){n.call(this,"orthogonalLine",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createConnector=function(n,t){return this.diagram._getNewConnector({segments:[{type:"orthogonal"}],sourcePoint:n,targetPoint:t})},i}(r);t.datavisualization.Diagram.OrthogonalLineTool=h;c=function(i){function r(n){i.call(this,"rotatetool",n);this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(t){var u,r,f,e;i.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0];r={};(this.selectedObject.isGroup||this.selectedObject.isPseudoGroup)&&(r=this.diagram._getChildTable(this.selectedObject,r));f={childTable:r,node:this.selectedObject};u=n.extend(!0,{},f);this.undoObject=jQuery.extend(!0,{},u);e=this.diagram._currZoom},r.prototype.mousemove=function(n){var r,u;i.prototype.mousemove.call(this,n);this.selectedObject&&(this.inAction?(r=!1,this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&(r=!0)):this.selectedObject.isPseudoGroup&&this.hasSameParent()&&this._fromContainer(this.selectedObject.children)&&(r=!0),r?(this.helper||(this.helper=this._getCloneNode(this.selectedObject),this.helper.name="helper"),this._rotate(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)):this.selectedObject.isPseudoGroup&&this._fromContainer(this.selectedObject.children)?this._fromContainer(this.selectedObject.children)&&this.hasSameParent()&&(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject)):(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject))):this.inAction=!0);this.previousPoint=this.currentPoint},r.prototype._rotate=function(n){var r=!1,u;if(this.inAction||(u=this._raiseEvent("rotationChange",{element:n,cancel:!1}),r=u.cancel),!r){var f=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),e=this.currentPoint,i=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(f.x,f.y),e)+90;i=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,i);this.diagram._rotate(n,i-n.rotateAngle,this.diagram.nameTable)}},r.prototype._updateRotateObject=function(){var i=this.diagram.nameTable[this.selectedObject.name],n;return t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.helper&&(n=this.helper.rotateAngle-this.diagram.nameTable[this.selectedObject.name].rotateAngle,this.diagram._rotate(this.selectedObject,n,this.diagram.nameTable),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)),i},r.prototype._updateContainer=function(n,i,r){var e,o,c=0,l=0,f,s,rt,u,d,ut,h,p,w,nt,tt,it,b,k;if(n&&(s=this.diagram.nameTable[n.parent],!s&&n.isPseudoGroup&&(rt=this.diagram.nameTable[this.selectedObject.children[0]],s=this.diagram.nameTable[rt.parent]),s))if(s.container.type=="canvas"){if(r){r=!1;u=this.diagram.nameTable[n.parent];!u&&n.isPseudoGroup&&(u=s);d=t.datavisualization.Diagram.Util.bounds(u);ut=u.rotateAngle;this.diagram._rotate(u,-u.rotateAngle,this.diagram.nameTable);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);e=t.datavisualization.Diagram.Util.bounds(n);h=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);o=t.datavisualization.Diagram.Util.bounds(u);var a=this.diagram._getTightChildrenBounds(u),ft=!0,g=!0,v=h.x+h.width,y=h.y+h.height;v>=o.right&&(c=v-o.right+u.paddingRight,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2,v<o.right&&(ft=!1));y>=o.bottom&&(l=y-o.bottom+u.paddingBottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2,g=!0,y<o.bottom&&(g=!1));v<o.right&&ft&&(c=a.x+a.width+u.paddingRight-o.right,f=this.diagram._getMinMaxSize(u,u.width+c,u.height,!0),p=f.width-u.width,u.width=f.width,u.offsetX+=p/2);y<o.bottom&&g&&(l=a.y+a.height+u.paddingBottom-o.bottom,f=this.diagram._getMinMaxSize(u,u.width,u.height+l,!0),w=f.height-u.height,u.height=f.height,u.offsetY+=w/2);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);this._updateMargin(n,u);t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram);this.diagram._rotate(u,ut,this.diagram.nameTable);nt=t.datavisualization.Diagram.Util.bounds(u);this.diagram._translate(u,d.topLeft.x-nt.topLeft.x,d.topLeft.y-nt.topLeft.y,this.diagram.nameTable);u.parent&&u.container&&u.container.type=="canvas"&&this._updateMargin(u,this.diagram.nameTable[u.parent]);t.datavisualization.Diagram.DiagramContext.update(u,this.diagram)}else tt=!1,it=!1,u=this.diagram.nameTable[n.parent],n.container&&n.container.type=="stack"&&(n.container.orientation=="vertical"?tt=!0:it=!0),e=this.diagram._getBoundsWithoutStretch(u,tt,it),e.width=u.paddingLeft+u.paddingRight,e.height=u.paddingTop+u.paddingBottom,f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnCanvas1(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram);u.parent&&(this.diagram.nameTable[u.parent]&&(r=!0),this._updateContainer(u,null,r))}else s.container.type=="stack"&&(u=this.diagram.nameTable[n.parent],e=t.datavisualization.Diagram.SvgContext._measureStackSize(u,this.diagram,!0),f=this.diagram._getMinMaxSize(u,e.width,e.height,!0),b=f.width-u.width,k=f.height-u.height,u.offsetX+=b/2,u.width=f.width,u.offsetY+=k/2,u.height=f.height,t.datavisualization.Diagram.SvgContext._alignOnStack(u,this.diagram),t.datavisualization.Diagram.DiagramContext.update(u,this.diagram),u.parent&&this._updateContainer(u))},r.prototype.mouseup=function(r){var f,o,u,s,h,c,e,l,a;this.inAction&&(this.inAction=!1,f=!1,o=!1,this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&(f=!0)):this.selectedObject.isPseudoGroup&&this.hasSameParent()&&this._fromContainer(this.selectedObject.children)&&(s=this.diagram.nameTable[this.selectedObject.children[0]],u=this.diagram.nameTable[s.parent],u.container&&(f=!0)),f&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._svg,this.diagram._adornerLayer),this._removeHighLighter(),u.container.type=="canvas"&&(o=!0),o&&(h=this._updateRotateObject(),this._updateContainer(h,null,!0))),this.selectedObject.isPseudoGroup?this._fromContainer(this.selectedObject.children)||this._rotate(this.selectedObject):this._rotate(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),e={},(this.selectedObject.isGroup||this.selectedObject.isPseudoGroup)&&(e=this.diagram._getChildTable(this.selectedObject,e)),l={childTable:e,node:this.selectedObject},c=n.extend(!0,{},l),a={type:"rotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},c),isMultipleNode:this.selectedObject.isGroup?!0:!1},this.diagram.addHistoryEntry(a),this.diagram._updateSelectionHandle(),this.diagram._removeTooltip());i.prototype.mouseup.call(this,r)},r}(i);t.datavisualization.Diagram.RotateTool=c;l=function(n){function i(i){n.call(this,"PivotTool",i);this._mouseOffset=t.datavisualization.Diagram.Size(0,0)}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0]},i.prototype.mousemove=function(i){if(n.prototype.mousemove.call(this,i),this.selectedObject)if(this.inAction){var r=this.currentPoint.x-this.previousPoint.x,u=this.currentPoint.y-this.previousPoint.y,f=t.Matrix.identity();t.Matrix.rotate(f,-this.selectedObject.rotateAngle);var e=t.Matrix.transform(f,t.datavisualization.Diagram.Point(r,u)),o=(this.selectedObject.width*this.selectedObject.pivot.x+e.x)/this.selectedObject.width,s=(this.selectedObject.height*this.selectedObject.pivot.y+e.y)/this.selectedObject.height;this.selectedObject.pivot.x=o;this.selectedObject.pivot.y=s;this.selectedObject.offsetX+=r;this.selectedObject.offsetY+=u;this.diagram._updateSelectionHandle()}else this.inAction=!0;this.previousPoint=this.currentPoint},i.prototype._rotate=function(n){var i=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),r=this.currentPoint,u=this.FindAngle(i,r);this.diagram._rotate(n,u-n.rotateAngle,i,this.diagram.nameTable)},i.prototype.mouseup=function(t){this.inAction&&(this.inAction=!1,this.diagram._updateSelectionHandle());n.prototype.mouseup.call(this,t)},i}(i);t.datavisualization.Diagram.PivotTool=l;a=function(n){function i(t){n.call(this,"panTool",t);this.diagram=t;this._isMouseDown=!1;this.cursor="pointer"}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){var r,i,u;return n.prototype.mousedown.call(this,t),r=this.diagram._svg.document,i=this.diagram._svg.document.createSVGPoint(),i.x=t.clientX,i.y=t.clientY,u=i.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),r.lastMouseX=u.x,r.lastMouseY=u.y,this._isMouseDown=!0,!1},i.prototype.mousemove=function(i){var r,u;if(n.prototype.mousemove.call(this,i),this._isMouseDown){this.inAction=!0;r=this.diagram._svg.document;u=this.diagram._svg.document.createSVGPoint();u.x=i.clientX;u.y=i.clientY;var h=u.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),f=h.x,e=h.y,o,s;return o=f-r.lastMouseX,s=e-r.lastMouseY,this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||(o=0),this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY||(s=0),t.datavisualization.Diagram.ZoomUtil.zoomPan(this.diagram,1,o,s,t.datavisualization.Diagram.Point(f,e)),r.lastMouseX=f,r.lastMouseY=e,!1}},i.prototype.mouseup=function(t){this.inAction=!1;document.onmousemove=null;document.onmouseup=null;this._isMouseDown=!1;n.prototype.mouseup.call(this,t)},i}(i);t.datavisualization.Diagram.PanTool=a;v=function(n){function i(t,i){n.call(this,t,i);this.cursor="crosshair"}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);this.selectedObject=this.createNode()},i.prototype.createNode=function(){},i.prototype.mousemove=function(t){n.prototype.mousemove.call(this,t);this.selectedObject&&(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper(),this._renderHelper(),this._calcOffset()))},i.prototype.mouseup=function(t){this.inAction&&(this.inAction=!1,this.diagram.model.snapSettings.snapConstraints.snapToLines&&this._calcOffset(),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this.diagram.add(this.selectedObject),this.diagram._clearSelection(),this.diagram._addSelection(this.selectedObject));this.diagram._toolToActivate="selectTool";this.diagram._drawingTool=!1;n.prototype.mouseup.call(this,t)},i.prototype._calcOffset=function(){var r=this.diagram.model.magnification/100,n=t.datavisualization.Diagram.Util.bounds(this.helper),i=n.topLeft;i=t.datavisualization.Diagram.Point(n.x+n.width,n.y+n.height);var u=i.x*r,f=i.y*r,e=t.datavisualization.Diagram.Point(u,f),o=this.snap(t.datavisualization.Diagram.Point(u,f));this._mouseOffset=t.datavisualization.Diagram.Size(e.x-o.x,e.y-o.y)},i.prototype.getBoundingRect=function(){var u=Math.abs(this.startPoint.x-this.currentPoint.x),f=Math.abs(this.startPoint.y-this.currentPoint.y),n=t.datavisualization.Diagram.Size(u,f),i,r;return this.diagram.model.snapSettings.snapConstraints.snapToVerticalLines&&this._mouseOffset.width!=0&&(n.width-=this._mouseOffset.width,this._mouseOffset.width=0),this.diagram.model.snapSettings.snapConstraints.snapToHorizontalLines&&this._mouseOffset.height!=0&&(n.height-=this._mouseOffset.height,this._mouseOffset.height=0),i=this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x,r=this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y,{size:n,offset:t.datavisualization.Diagram.Point(i,r)}},i.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},i.prototype._updateHelper=function(){this._updateSize(this.helper,this.startPoint,this.currentPoint);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},i.prototype._updateSize=function(n,i,r){var f=this.getBoundingRect(i,r),u=f.size,e=f.offset;t.datavisualization.Diagram.Geometry.isEmptySize(u)||(n.offsetX=e.x+u.width/2,n.offsetY=e.y+u.height/2,n.width=u.width,n.height=u.height)},i}(t.datavisualization.Diagram.ToolBase);t.datavisualization.Diagram.RectangleToolBase=v;y=function(n){function i(t,i){n.call(this,t,i);this.cursor="crosshair"}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(){},i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t)},i.prototype.mousemove=function(t){n.prototype.mousemove.call(this,t);this.selectedObject&&(this.inAction?this._updateHelper(this.snap(this.currentPoint)):(this.inAction=!0,this._initHelper(),this._renderHelper(),this._calcOffset()))},i.prototype.mouseup=function(){if(this.selectedObject)this.inAction&&this.helper.shape.points.push(t.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y));else if(this.startPoint){this.selectedObject=this.createNode();var n=this.snap(this.startPoint),i=this.snap(this.currentPoint);this.selectedObject.shape.points.push(t.datavisualization.Diagram.Point(n.x,n.y));this.selectedObject.shape.points.push(t.datavisualization.Diagram.Point(i.x,i.y))}},i.prototype._calcOffset=function(){var r=this.diagram.model.magnification/100,n=t.datavisualization.Diagram.Util.bounds(this.helper),i=n.topLeft;i=t.datavisualization.Diagram.Point(n.x+n.width,n.y+n.height);var u=i.x*r,f=i.y*r,e=t.datavisualization.Diagram.Point(u,f),o=this.snap(t.datavisualization.Diagram.Point(u,f));this._mouseOffset=t.datavisualization.Diagram.Size(e.x-o.x,e.y-o.y)},i.prototype._renderHelper=function(){if(!this.svgHelper){var n=t.datavisualization.Diagram.Geometry.rect(this.helper.shape.points);this.helper.offsetX=n.x+n.width/2;this.helper.offsetY=n.y+n.height/2;this.helper.width=n.width;this.helper.height=n.height;this.svgHelper=t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer);this.svgHelper=document.getElementById(this.helper.name);this.svgHelper.setAttribute("pointer-events","none")}},i.prototype.doubleclick=function(){if(this.selectedObject){t.datavisualization.Diagram.Util.removeItem(this.helper.shape.points,this.helper.shape.points[this.helper.shape.points.length-2]);t.datavisualization.Diagram.Util.removeItem(this.helper.shape.points,this.helper.shape.points[this.helper.shape.points.length-1]);this.selectedObject.shape.points=this.helper.shape.points;var n=t.datavisualization.Diagram.Geometry.rect(this.helper.shape.points);this.selectedObject.offsetX=n.x+n.width/2;this.selectedObject.offsetY=n.y+n.height/2;this.selectedObject.width=n.width;this.selectedObject.height=n.height;this.diagram.model.nodes.push(this.selectedObject);this.diagram.nameTable[this.selectedObject.name]=this.selectedObject;t.datavisualization.Diagram.DiagramContext.renderNode(this.selectedObject,this.diagram);this.diagram._clearSelection();this.diagram._addSelection(this.selectedObject)}this._svgHelper&&(this.diagram._svg.removeChild(this._svgHelper),this._svgHelper=null);this._endAction();this.diagram._drawingTool=!1;this.diagram._toolToActivate="selectTool";this._mouseOffset=t.datavisualization.Diagram.Size(0,0)},i.prototype._updateHelper=function(n){this.helper.shape.points[this.helper.shape.points.length-1]=t.datavisualization.Diagram.Point(n.x,n.y);var i=t.datavisualization.Diagram.Geometry.rect(this.helper.shape.points);this.helper.offsetX=i.x+i.width/2;this.helper.offsetY=i.y+i.height/2;this.helper.width=i.width;this.helper.height=i.height;t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},i}(t.datavisualization.Diagram.ToolBase);t.datavisualization.Diagram.PolygonToolBase=y;p=function(i){function r(n,r){i.call(this,n,r);this.boundingRect=t.datavisualization.Diagram.Rectangle();this.activeLabel=null;this.cursor="crosshair"}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this.diagram._isEditing&&this.diagram._endEdit()},r.prototype.createNode=function(){},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this.selectedObject||t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this.diagram._isEditing||(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper())))},r.prototype.mouseup=function(n){var r,u,i;this.activeLabel=null;r=12;this.inAction?(i=this.getBoundingRect(this.startPoint,this.currentPoint),this._endAction(),t.browserInfo().name==="chrome"&&(i.width===0||i.height===0)&&(i.width=90,i.height=r),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,i.height),this.diagram._startEdit(this.selectedObject)):(u=this._findNodeUnderMouse(n),u!=null&&t.datavisualization.Diagram.Util.isPageEditable(this.diagram)?(this.selectedObject=u,this.diagram._startEdit(this.selectedObject)):(i=t.datavisualization.Diagram.Rectangle(this.currentPoint.x-45,this.currentPoint.y-r/2,90,r),this._endAction(),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,r),this.diagram._startEdit(this.selectedObject)))},r.prototype.getBoundingRect=function(){var n=Math.abs(this.startPoint.x-this.currentPoint.x),t=Math.abs(this.startPoint.y-this.currentPoint.y),i=this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x,r=this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y;return{x:i,y:r,width:n,height:t}},r.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._svg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},r.prototype._updateHelper=function(){var t=this.diagram._svg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._svg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},r.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this._svgHelper=null);i.prototype._endAction.apply(this)},r.prototype._findNodeUnderMouse=function(t){var i,r=n(t.target).parents("text")[0],o,s,u,e;if(r!=null)r.getAttribute("class")=="ej-d-label"&&(o=n(r).parents("g")[0],i=this._findObj(o),i.shape.type!="text"&&(s=r.id.split("_"),this.activeLabel=i.labels.find(s[1])));else if(u=n(t.target).parents("g"),u.length>3){var h=u[u.length-4],c=h.getAttribute("id"),f=h.getAttribute("class");f&&(f==="ej-d-node"||f==="ej-d-group"?(i=this.diagram._findNode(c),e=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=e):f==="ej-d-connector"&&(i=this.diagram._findConnector(c),e=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=e))}return i},r.prototype.getLabelUnderMouse=function(){return this.activeLabel},r}(t.datavisualization.Diagram.ToolBase);t.datavisualization.Diagram.TextToolBase=p;w=function(n){function i(t){n.call(this,"rectangleTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(){var n=this.diagram._getNewNode({name:"rectangle"+t.datavisualization.Diagram.Util.randomId()});return n.offsetX=0,n.offsetY=0,n.width=0,n.height=0,n},i}(t.datavisualization.Diagram.RectangleToolBase);t.datavisualization.Diagram.RectangleTool=function(n){return new w(n)};b=function(n){function i(t){n.call(this,"ellipseTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(){var n=this.diagram._getNewNode({name:"ellipse"+t.datavisualization.Diagram.Util.randomId()});return n.shape.type=t.datavisualization.Diagram.Shapes.Ellipse,n.fillColor="white",n.offsetX=0,n.offsetY=0,n.width=0,n.height=0,n},i}(t.datavisualization.Diagram.RectangleToolBase);t.datavisualization.Diagram.EllipseTool=function(n){return new b(n)};k=function(n){function i(t){n.call(this,"roundRectTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(){var n=this.diagram._getNewNode({name:"roundrect"+t.datavisualization.Diagram.Util.randomId()});return n.shape.type=t.datavisualization.Diagram.Shapes.Rectangle,n.shape.cornerRadius=15,n.offsetX=0,n.offsetY=0,n.width=0,n.height=0,n},i}(t.datavisualization.Diagram.RectangleToolBase);t.datavisualization.Diagram.RoundRectTool=function(n){return new k(n)};d=function(n){function i(t){n.call(this,"textTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(n,i,r,u){return t.datavisualization.Diagram.Node({name:"text"+t.datavisualization.Diagram.Util.randomId(),offsetX:n,offsetY:i,width:r,height:u,borderColor:"transparent",fillColor:"transparent",labels:[],ports:[],shape:{type:"text",textBlock:t.datavisualization.Diagram.TextBlockDefaults}})},i}(t.datavisualization.Diagram.TextToolBase);t.datavisualization.Diagram.TextTool=function(n){return new d(n)};g=function(n){function i(t){n.call(this,"polygonTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(){var n=this.diagram._getNewNode({name:"polygon"+t.datavisualization.Diagram.Util.randomId()});return n.shape.type=t.datavisualization.Diagram.Shapes.Polygon,n.offsetX=0,n.offsetY=0,n.width=0,n.height=0,n},i}(t.datavisualization.Diagram.PolygonToolBase);t.datavisualization.Diagram.PolygonTool=function(n){return new g(n)};nt=function(i){function r(n,r,u,f,e){i.call(this,"imageTool",e);this.saveUrl=n;this.removeUrl=r;this.uploadfileUrl=u;this.autoOpenUpload=f;this.bounds=t.datavisualization.Diagram.Rectangle(0,0,0,0);this.cursor="crosshair"}return t.datavisualization.Diagram.extend(r,i),r.prototype.createNode=function(n){var i=this.diagram._getNewNode();return i.name="image"+t.datavisualization.Diagram.Util.randomId(),i.shape=t.datavisualization.Diagram.Shapes.Image(n),i.borderDashArray="5,5",i.offsetX=0,i.offsetY=0,i.width=0,i.height=0,i},r.prototype.mouseup=function(){this.inAction&&(this.bounds=this.getBoundingRect(this.snap(this.startPoint),this.snap(this.currentPoint)));this._renderDialogControl();this.diagram._toolToActivate="selectTool";this.diagram._drawingTool=!1;this._endAction()},r.prototype._showPopup=function(){this._renderDialogControl();this.diagram._toolToActivate="selectTool";this.diagram._drawingTool=!1;this._endAction()},r.prototype._renderDialogControl=function(){var v=document.createElement("div"),i={id:"basicDialog",title:"Insert Image",style:"display:none"},y,o,h,c,u,s,l,a;t.datavisualization.Diagram.Util.attr(v,i);document.body.appendChild(v);y=document.createElement("div");i={id:"UploadDefault",style:"padding-Left:15px; float:left"};t.datavisualization.Diagram.Util.attr(y,i);var e=document.createElement("table"),f=document.createElement("tr"),r=document.createElement("td");i={align:"left",style:"padding-Top:10px"};t.datavisualization.Diagram.Util.attr(r,i);o=document.createElement("div");o.style.cssFloat="left";h=document.createElement("input");i={type:"radio",name:"uploadOption",id:"rdoComputer",checked:"true"};t.datavisualization.Diagram.Util.attr(h,i);h.onchange=n.proxy(this._rdoChanged,this);o.appendChild(h);u=document.createElement("label");u.innerHTML="My Computer";u.className="dialogLabel";i={style:"font-weight:normal; padding-left:5px; vertical-align: top;"};t.datavisualization.Diagram.Util.attr(u,i);u.onclick=n.proxy(this._labelClick,this);o.appendChild(u);r.style.paddingBottom="5px";r.appendChild(o);r.appendChild(y);u=document.createElement("label");i={id:"lblComputerUrl",style:"font-weight:normal;padding-left:10px; vertical-align: top;color:red;"};t.datavisualization.Diagram.Util.attr(u,i);r.appendChild(u);f.appendChild(r);e.appendChild(f);f=document.createElement("tr");r=document.createElement("td");c=document.createElement("input");i={id:"rdoWebUrl",type:"radio",name:"uploadOption"};t.datavisualization.Diagram.Util.attr(c,i);c.onchange=n.proxy(this._rdoChanged,this);r.appendChild(c);u=document.createElement("label");u.innerHTML="Web URL";u.className="dialogLabel";i={style:"font-weight:normal; padding-left:5px; vertical-align: top;"};t.datavisualization.Diagram.Util.attr(u,i);u.onclick=n.proxy(this._labelClick,this);r.appendChild(u);u=document.createElement("label");i={id:"lblWebUrl",style:"font-weight:normal;padding-left:25px; vertical-align: top;color:red;"};t.datavisualization.Diagram.Util.attr(u,i);r.appendChild(u);f.appendChild(r);e.appendChild(f);f=document.createElement("tr");r=document.createElement("td");i={style:"padding-Top:5px;padding-Bottom:15px"};t.datavisualization.Diagram.Util.attr(r,i);s=document.createElement("input");i={id:"txtImageUrl",type:"text",placeholder:"Image URL",style:"width:460px;height:20px"};t.datavisualization.Diagram.Util.attr(s,i);s.onfocus=n.proxy(this._textFocus,this);s.onfocusout=n.proxy(this._textFocusOut,this);r.appendChild(s);f.appendChild(r);e.appendChild(f);f=document.createElement("tr");r=document.createElement("td");l=document.createElement("input");i={value:"Ok",type:"button",id:"btnOk",style:"width : 100px; height: 30px; margin-Right: 5px; border: 1px solid #F7952E; color : white; font-Family:Segoe UI;font-weight:bold"};t.datavisualization.Diagram.Util.attr(l,i);l.onclick=n.proxy(this._uploadClick,this);r.appendChild(l);a=document.createElement("input");i={value:"Cancel",type:"button",id:"btnCancel",style:"width : 100px; height: 30px; border: 1px solid #DFDFDE; font-Family:Segoe UI;font-weight:bold"};t.datavisualization.Diagram.Util.attr(a,i);a.onclick=n.proxy(this._closeDialog,this);r.appendChild(a);i={align:"right"};t.datavisualization.Diagram.Util.attr(r,i);f.appendChild(r);e.appendChild(f);v.appendChild(e);n("#UploadDefault").ejUploadbox({saveUrl:this.saveUrl,removeUrl:this.removeUrl,complete:n.proxy(this.fileuploadComplete,this)});n("#basicDialog").ejDialog({height:230,width:500,modal:!0});n("#basicDialog").ejDialog("open")},r.prototype.fileuploadComplete=function(n){var t=this.uploadfileUrl+"/"+n.files.name;this._renderImageNode(t);this._closeDialog()},r.prototype._uploadClick=function(){var i=document.getElementById("txtImageUrl").value,n,t;/^(http:\/\/www\.|https:\/\/www\.)[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(i)?(this._renderImageNode(i),this._closeDialog()):document.getElementById("rdoComputer").checked===!0?(n=document.getElementById("lblComputerUrl"),t=document.getElementById("lblWebUrl"),n.innerHTML="Browse any image to insert",t.innerHTML=""):(n=document.getElementById("lblComputerUrl"),t=document.getElementById("lblWebUrl"),n.innerHTML="",t.innerHTML="Invalid Url",document.getElementById("txtImageUrl").focus())},r.prototype._rdoChanged=function(){var n=document.getElementById("lblComputerUrl"),t=document.getElementById("lblWebUrl");n.innerHTML="";t.innerHTML=""},r.prototype._closeDialog=function(){n("#basicDialog").ejDialog("close");var t=document.getElementById("basicDialog");t.parentNode.removeChild(t)},r.prototype._labelClick=function(n){var t;n.target.innerHTML=="My Computer"?(t=document.getElementById("rdoComputer"),t.checked=!0):(t=document.getElementById("rdoWebUrl"),t.checked=!0);this._rdoChanged()},r.prototype._textFocus=function(){var n=document.getElementById("rdoWebUrl");n.checked=!0},r.prototype._renderImageNode=function(n){var i=this.createNode(n);this.bounds.size.width==undefined||t.datavisualization.Diagram.Geometry.isEmptySize(this.bounds.size)?(i.offsetX=150,i.offsetY=150,i.width=100,i.height=100):(i.offsetX=this.bounds.offset.x+this.bounds.size.width/2,i.offsetY=this.bounds.offset.y+this.bounds.size.height/2,i.width=this.bounds.size.width,i.height=this.bounds.size.height);i.borderDashArray="";this.diagram.model.nodes.push(i);t.datavisualization.Diagram.DiagramContext.renderNode(i,this.diagram);this.diagram._clearSelection();this.diagram._addSelection(i)},r}(t.datavisualization.Diagram.RectangleToolBase);t.datavisualization.Diagram.ImageTool=function(n,t,i,r,u){return new nt(n,t,i,r,u)};tt=function(i){function r(n){i.call(this,"phase",n);this.selectedSeperetor=null;this._svgHelper=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this._inAction=!0},r.prototype.mousemove=function(r){var f,u,e,o;i.prototype.mousemove.call(this,r);this._inAction&&n(r.target).parents("g").first()[0]&&(f=n(r.target).parents("g").first()[0].id,u=this._getphase(f),u&&!this.selectedSeperetor&&(this.selectedSeperetor=u));this.selectedSeperetor&&(e=this.previousPoint.x-this.currentPoint.x,o=this.previousPoint.y-this.currentPoint.y,this.selectedSeperetor.offset-=this.selectedSeperetor.orientation=="horizontal"?e:o,t.datavisualization.Diagram.SvgContext._updatephase(this.selectedSeperetor,this.diagram));this.previousPoint=this.currentPoint},r.prototype._getphase=function(n){if(this.diagram.model.phases)for(var t=0;t<this.diagram.model.phases.length;t++)if(this.diagram.model.phases[t].name==n)return this.diagram.model.phases[t]},r.prototype.mouseup=function(n){i.prototype.mouseup.call(this,n);this._inAction=!1;this.selectedSeperetor=null},r}(i);t.datavisualization.Diagram.PhaseTool=tt}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.LayoutTypes={None:"none",HierarchicalTree:"hierarchicaltree",OrganizationalChart:"organizationalchart"};t.datavisualization.Diagram.Layout={doLayout:function(n){n.model.layout.type==="hierarchicaltree"?t.datavisualization.Diagram.HierarchicalLayout.doLayout(n):n.model.layout.type==="organizationalchart"&&t.datavisualization.Diagram.HierarchicalLayout.doLayout(n,!0)}};t.datavisualization.Diagram.HierarchicalLayout={doLayout:function(t,i){var r={_mDepths:[],_mMaxDepth:0,fixedNode:null,diagram:t,rootNode:null,_mAnchorX:0,_mAnchorY:0,_mEqualities:{},_firstLevelNodes:[],level:null},e=t.model,o,u,f;if(r=n.extend(!0,{},r,e.layout),e.nodes.length>0){for(r._mEqualities={},r._firstLevelNodes=[],u=0;u<e.nodes.length;u++)f=e.nodes[u],o=r._mEqualities[f.name]=this._setUpLayoutInfo(f),o.split=!0,o.waterfall=!0,f.inEdges&&f.inEdges.length||r._firstLevelNodes.push(f);for(i&&(r.level=Math.max(this._findLevel(r,r._firstLevelNodes[0],1),2),r.orientation="toptobottom"),u=0;u<r._firstLevelNodes.length;u++)f=r._firstLevelNodes[u],this._updateEdges(r,f,1);r._firstLevelNodes.length>0&&(r._rootNode=r._firstLevelNodes[0],this._doLayout(r))}},_findLevel:function(n,t,i,r){var s=n._mEqualities[t.name],o=!0,f,u,e;if(t.outEdges&&t.outEdges.length&&t.isExpanded){for(f=0;f<t.outEdges.length;f++)if(u=n.diagram.nameTable[n.diagram.nameTable[t.outEdges[f]].targetNode],u.outEdges&&u.outEdges.length&&u.isExpanded)e=this._findLevel(n,u,i+1,r),r||(r=e),r=Math.min(r,e),o=!1;else return i;if(o)return i}return r},_updateEdges:function(n,t,i){var u=n._mEqualities[t.name],f,r;if(t.outEdges&&t.outEdges.length)for(f=0;f<t.outEdges.length;f++)r=n.diagram.nameTable[n.diagram.nameTable[t.outEdges[f]].targetNode],r.excludeFromLayout||(i<n.level||n.level===null?u.children.push(r.name):u.waterfallChildren.push(r.name)),t.outEdges.length>1&&r.outEdges&&r.outEdges.length&&r.isExpanded&&(u.split=!1,u.waterfall=!1),this._updateEdges(n,r,i+1)},_getNextSibling:function(n,t,i,r,u){var t,f;if(u=u?u:1,t=n._mEqualities[t.name],r){if(t.waterfallChildren&&t.waterfallChildren.length&&(f=t.waterfallChildren.indexOf(i),f<t.waterfallChildren.length-u))return n.diagram.nameTable[t.waterfallChildren[f+u]]}else if(t.children&&t.children.length&&(f=t.children.indexOf(i),f<t.children.length-u))return n.diagram.nameTable[t.children[f+u]]},_getPrevSibling:function(n,t,i,r){var t=n._mEqualities[t.name],u;if(r){if(t.waterfallChildren&&t.waterfallChildren.length&&(u=t.waterfallChildren.indexOf(i),u>0))return n.diagram.nameTable[t.waterfallChildren[u-1]]}else if(t.children&&t.children.length&&(u=t.children.indexOf(i),u>0))return n.diagram.nameTable[t.children[u-1]]},_getLastChild:function(n,t,i){var t=n._mEqualities[t.name];if(i){if(t.waterfallChildren&&t.waterfallChildren.length)return n.diagram.nameTable[t.waterfallChildren[t.waterfallChildren.length-1]]}else if(t.children&&t.children.length)return n.diagram.nameTable[t.children[t.children.length-1]]},_getFirstChild:function(n,t,i){var t=n._mEqualities[t.name];if(i){if(t.waterfallChildren&&t.waterfallChildren.length)return n.diagram.nameTable[t.waterfallChildren[0]]}else if(t.children&&t.children.length)return n.diagram.nameTable[t.children[0]]},_getParentNode:function(n,t){if(t.inEdges&&t.inEdges.length)return n.diagram.nameTable[n.diagram.nameTable[t.inEdges[0]].sourceNode]},_hasChild:function(n,t){var t=n._mEqualities[t.name];return t.children&&t.children.length||t.waterfallChildren&&t.waterfallChildren.length},_getSpace:function(n,t,i,r){var u=0,f=0,o=n.orientation=="toptobottom"||n.orientation=="bottomtotop",e;return(u=n.horizontalSpacing,f=n.horizontalSpacing,e=n._mEqualities[t.name],e.bounds)?(r?u:f)+e.bounds.right:(r?u:f)+.5*(o?t.width+i.width:t.height+i.height)},_updateDepths:function(n,t,i){var u=n.orientation=="toptobottom"||n.orientation=="bottomtotop",r=u?i.height:i.width;n.orientation=="bottomtotop"||n.orientation=="righttoleft"?(r=-r,n._mDepths[t]=Math.min(n._mDepths[t]||0,r)):n._mDepths[t]=Math.max(n._mDepths[t]||0,r);n._mMaxDepth=Math.max(n._mMaxDepth,t)},_checkDepths:function(n){for(var i,t=1;t<=n._mMaxDepth;++t)i=0,i=n.verticalSpacing,(n.orientation=="bottomtotop"||n.orientation=="righttoleft")&&(i=-i),n._mDepths[t]+=(n._mDepths[t-1]||0)+i},_doLayout:function(n){var i,u;if(n._mDepths=[],n._mDepths[0]=0,n._mAnchorX=0,n._mAnchorY=0,n._mMaxDepth=0,n._firstLevelNodes.length>1?this._doFirstWalk(n,n._firstLevelNodes[0],0,1,null,null,n._firstLevelNodes[1]):this._doFirstWalk(n,n._firstLevelNodes[0],0,1,null,null,null),this._checkDepths(n),i=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram),n._mAnchorX=i.width/2-n._rootNode.width/2,n._mAnchorY=0,n.fixedNode)var r=n.diagram.nameTable[n.fixedNode],f=r.offsetX,e=r.offsetY;u=n._mEqualities[n._firstLevelNodes[0].name];this._doSecondWalk(n,n._firstLevelNodes[0],null,-u.prelim,0);this._updateNodes(n,f||0,e||0);this._updateConnectors(n,n._rootNode,1)},_updateNodes:function(n,i,r){var f,u;if(n.fixedNode)var e=n.diagram.nameTable[n.fixedNode],o=i-e.offsetX,s=r-e.offsetY;else o=n.marginX,s=n.marginY;for(f=n.diagram.model.nodes,u=0;u<f.length;u++)f[u].excludeFromLayout||(f[u].offsetX+=o,f[u].offsetY+=s),t.datavisualization.Diagram.SpatialUtil._updateQuad(n.diagram,n.diagram._spatialSearch,f[u]),n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(f[u],n.diagram)},_updateConnectors:function(n,i,r){for(var u,f,s,o,e=0;e<i.outEdges.length;e++)u=n.diagram.nameTable[i.outEdges[e]],f=n.diagram.nameTable[u.targetNode],n.type=="organizationalchart"&&(u.sourcePoint={x:i.offsetX,y:i.offsetY+i.height/2},u.targetPoint={x:f.offsetX+f.width/2,y:i.offsetY},s=n._mEqualities[i.name],!n.level||r<n.level?n.diagram.updateConnector(u.name,{segments:[{type:"orthogonal"}]}):f.offsetX==i.offsetX?(u.sourcePoint={x:i.offsetX,y:i.offsetY+i.height/2},u.targetPoint={x:f.offsetX,y:f.offsetY-f.height/2},n.diagram.updateConnector(u.name,{segments:[{type:"orthogonal"}]})):(o=[{type:"orthogonal",length:f.offsetY-(i.offsetY+i.height/2),direction:"bottom"},{type:"orthogonal"}],n.diagram.updateConnector(u.name,{segments:o})),n.diagram._dock(u,n.diagram.nameTable)),n.diagram._dock(u,n.diagram.nameTable),n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(u,n.diagram),(f.isExpanded||this._hasChild(n,f))&&this._updateConnectors(n,f,r+1)},_doFirstWalk:function(n,t,i,r,u,f,e){var o=n._mEqualities[t.name],y,s,d,a,p,w,b,k,l,c,tt,it;if(o.number=i,this._updateDepths(n,r,t),y=t.isExpanded,this._hasChild(n,t)&&y&&r!=n.level){if(y){var v=this._getFirstChild(n,t),g=this._getLastChild(n,t),nt=v,h=v;for(p=0;h!=null;++p,h=this._getNextSibling(n,t,h.name))w=this._getPrevSibling(n,t,h.name),b=this._getNextSibling(n,t,h.name),this._doFirstWalk(n,h,p,r+1,t,w,b),nt=this._allocateSpace(n,h,nt,t,w,b,r);this._translateShapePosition(n,t);k=.5*(n._mEqualities[v.name].prelim+n._mEqualities[v.name].waterfallMod+n._mEqualities[g.name].prelim+n._mEqualities[g.name].waterfallMod);l=null;n._firstLevelNodes.indexOf(t)!=-1?n._firstLevelNodes.indexOf(t)>0&&(l=n._firstLevelNodes[n._firstLevelNodes.indexOf(t)-1]):this._getPrevSibling(n,u,t.name)&&(l=this._getPrevSibling(n,u,t.name));l?(o.prelim=n._mEqualities[l.name].prelim+this._getSpace(n,l,t,!0),o.mod=o.prelim-k):o.prelim=k}}else r==n.level?(f&&(s=n._mEqualities[f.name]),d=this._doWaterFallFirstWalk(n,t,null,null,0,0,s?s.bounds:{}),o.bounds=d,o.waterfallMod=o.dimensions.x,o.prelim=0,s&&(o.prelim+=s.prelim-s.mod+s.bounds.right+n.horizontalSpacing)):(a=f,o.prelim=a==null?0:n._mEqualities[a.name].prelim+this._getSpace(n,a,t,!0));n._firstLevelNodes.indexOf(t)!=-1&&n._firstLevelNodes.length>1&&this._allocateSpace(n,t,n._firstLevelNodes[0],null,f,e);n._firstLevelNodes.indexOf(t)!=-1&&n._firstLevelNodes.length>1&&(c=null,n._firstLevelNodes.indexOf(t)<n._firstLevelNodes.length-1&&(c=n._firstLevelNodes[n._firstLevelNodes.indexOf(t)+1]),c!=null&&(tt=n._firstLevelNodes.indexOf(c)==0?null:n._firstLevelNodes[n._firstLevelNodes.indexOf(c)-1],it=n._firstLevelNodes.indexOf(c)==n._firstLevelNodes.length-1?null:n._firstLevelNodes[n._firstLevelNodes.indexOf(t)+1],this._doFirstWalk(n,c,0,1,null,tt,it)))},_setUpLayoutInfo:function(n){var t={};return t.ancestor=n,t.number=-1,t.ancestor=t.thread=null,t.shift=0,t.change=0,t.mod=0,t.children=[],t.waterfallChildren=[],t.waterfallMod=0,t},_allocateSpace:function(n,t,i,r,u){var k=u,s,o,f,e,l,v,y,p,h,c,d,a,w,b;if(k!=null){for(s=f=t,o=k,e=null,e=r?this._getFirstChild(n,r):n._firstLevelNodes[0],l=n._mEqualities[s.name].mod,y=n._mEqualities[f.name].mod,v=n._mEqualities[o.name].mod,p=n._mEqualities[e.name].mod,h=this._adjacentRight(n,o),c=this._adjacentLeft(n,s);h!=null&&c!=null;){if(o=h,s=c,e=this._adjacentLeft(n,e)||e,f=this._adjacentRight(n,f)||f,d=n._mEqualities[f.name],d.ancestor=t,a=n._mEqualities[o.name].prelim+v-(n._mEqualities[s.name].prelim+l)+this._getSpace(n,o,s,!1),a>0&&(this._shiftSubTree(n,this._ancestorShape(n,o,t,i),t,a),l+=a,y+=a),!e||!f)break;if(v+=n._mEqualities[o.name].mod,l+=n._mEqualities[s.name].mod,p+=n._mEqualities[e.name].mod,y+=n._mEqualities[f.name].mod,h=this._adjacentRight(n,o),c=this._adjacentLeft(n,s),this._adjacentRight(n,f)==null||this._adjacentLeft(n,e)==null)break}h!=null&&this._adjacentRight(n,f)==null&&(w=n._mEqualities[f.name],w.thread=h,w.mod+=v-y);c!=null&&this._adjacentLeft(n,e)==null&&(b=n._mEqualities[e.name],b.thread=c,b.mod+=l-p,i=t)}return i},_adjacentLeft:function(n,t){var i=null;return t.isExpanded&&(i=this._getFirstChild(n,t)),i||n._mEqualities[t.name].thread},_adjacentRight:function(n,t){var i=null;return t.isExpanded&&(i=this._getLastChild(n,t)),i||n._mEqualities[t.name].thread},_shiftSubTree:function(n,t,i,r){var f=n._mEqualities[t.name],u=n._mEqualities[i.name],e=u.number-f.number;u.change-=r/e;f.change+=r/e;u.shift+=r;u.prelim+=r;u.mod+=r},_translateShapePosition:function(n,t){for(var u=0,f=0,r,i=this._getLastChild(n,t),e=t.outEdges.length-1;i!=null;i=this._getPrevSibling(n,t,i.name),e--)r=n._mEqualities[i.name],r.prelim+=u,r.mod+=u,f+=r.change,u+=r.shift+f},_ancestorShape:function(n,t,i,r){var f=this._getParentNode(n,i),u=n._mEqualities[t.name];return u.ancestor!=null&&this._getParentNode(n,u.ancestor)==f?u.ancestor:r},_doSecondWalk:function(n,t,i,r,u){var e=n._mEqualities[t.name],s,f,o;if(n.orientation=="lefttoright"||n.orientation=="righttoleft"?(this._setBreadthSpace(n,t,n._mDepths[u],u),this._setDepthSpace(n,t,e.prelim+r)):(this._setBreadthSpace(n,t,e.prelim+r+(e.waterfallMod||0)+t.width/2,u),this._setDepthSpace(n,t,n._mDepths[u])),t.isExpanded&&this._hasChild(n,t))if(u+=1,s=0,u<n.level||n.level===null)for(f=this._getFirstChild(n,t);f!=null;f=this._getNextSibling(n,t,f.name),s++)this._doSecondWalk(n,f,t,r+e.mod,u);else for(f=this._getFirstChild(n,t,!0);f!=null;f=this._getNextSibling(n,t,f.name,!0),s++)this._waterFallSecondWalk(n,f,t.offsetX-t.width/2-e.waterfallMod||0,u);n._firstLevelNodes.indexOf(t)!=-1&&(o=null,n._firstLevelNodes.indexOf(t)<n._firstLevelNodes.length-1&&(o=n._firstLevelNodes[n._firstLevelNodes.indexOf(t)+1]),o!=null&&this._doSecondWalk(n,o,null,r,0))},_waterFallSecondWalk:function(n,t,i,r){var f=n._mEqualities[t.name],u;if(t.offsetX=f.dimensions.x+i+t.width/2+f.mod,t.offsetY=f.dimensions.y+t.height/2+n._mDepths[r-1],t.isExpanded)for(u=this._getFirstChild(n,t,!0);u!=null;u=this._getNextSibling(n,t,u.name,!0))this._waterFallSecondWalk(n,u,i+f.mod,r)},_setBreadthSpace:function(n,t,i){n.orientation=="righttoleft"?this._setX(t,n._mAnchorX+i-t.width/2):n.orientation=="lefttoright"?this._setX(t,n._mAnchorX+i+t.width/2):this._setX(t,n._mAnchorX+i)},_setDepthSpace:function(n,t,i){n.orientation=="bottomtotop"?this._setY(t,n._mAnchorY+i-t.height/2):n.orientation=="toptobottom"?this._setY(t,n._mAnchorY+i+t.height/2):this._setY(t,n._mAnchorY+i)},_setX:function(n,t){n.offsetX=t},_setY:function(n,t){n.offsetY=t},_doWaterFallFirstWalk:function(n,t,i,r,u,f,e){var c,p,h,o;if(e||(e={x:0,y:0}),n._mEqualities[t.name]?c=n._mEqualities[t.name]:(c={},this._setUpLayoutInfo(t,c),n._mEqualities[t.name]=c),i)p=n._mEqualities[i.name],c.dimensions={x:u,y:f};else{var r={x:0,y:0,right:0,bottom:0};c.dimensions={x:u,y:f}}var y=this._getFirstChild(n,t,!0),l=f+t.height+n.verticalSpacing/2,a,s=y,w=l,v=[];if(t.isExpanded&&this._hasChild(n,t)){if(c.waterfallChildren.length>1&&c.waterfallChildren.length<=2||!c.split)for(a=u+t.width/2+20,h=0;s!=null;h++,s=this._getNextSibling(n,t,s.name,!0))o=this._doWaterFallFirstWalk(n,s,t,r,a,l,{x:0,y:0}),l=o.bottom+n.verticalSpacing/2,e.x=Math.max(o.right,e.x),e.y=Math.max(o.bottom,e.y),r.right=Math.max(r.right,o.right),r.bottom=Math.max(r.bottom,o.bottom);else{for(h=0;s!=null&&h<t.outEdges.length;h=h+2,s=this._getNextSibling(n,t,s.name,!0,2))a=u,o=this._doWaterFallFirstWalk(n,s,t,r,a,l,{x:0,y:0}),n._mEqualities[s.name].bounds=o,l=o.bottom+n.verticalSpacing/2,v.push({name:s.name,right:o.right}),e.x=Math.max(o.right,e.x),e.y=Math.max(o.bottom,e.y),r.right=Math.max(r.right,o.right),r.bottom=Math.max(r.bottom,o.bottom);if(v.length>1)for(h=0;h<v.length;h++)n._mEqualities[v[h].name].mod=e.x-v[h].right;for(c.dimensions.x=t.outEdges.length>1?e.x+20-t.width/2:n._mEqualities[y.name].dimensions.x,a=e.x+40,l=w,s=this._getNextSibling(n,t,y.name,!0),h=1;s!=null&&h<t.outEdges.length;h=h+2,s=this._getNextSibling(n,t,s.name,!0,2))o=this._doWaterFallFirstWalk(n,s,t,r,a,l,{x:0,y:0}),l=o.bottom+n.verticalSpacing/2,r.right=Math.max(r.right,o.right),r.bottom=Math.max(r.bottom,o.bottom),e.x=Math.max(o.right,e.x),e.y=Math.max(o.bottom,e.y)}return i?{x:0,y:0,right:e.x,bottom:e.y}:r}return{x:u||0,y:f||0,right:(u||0)+t.width,bottom:(f||0)+t.height}}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.ZoomUtil={zoomPan:function(i,r,u,f,e,o){var s,h,c,l,a;t.datavisualization.Diagram.Util.canZooming(i)&&(s=t.Matrix.identity(),t.Matrix.scale(s,i._currZoom,i._currZoom),t.Matrix.translate(s,-i._hScrollOffset,-i._vScrollOffset),h=i._currZoom*r,h>30?r=30/i._currZoom:h<.25&&(r=.25/i._currZoom),c=t.Matrix.identity(),l=e?t.Matrix.transform(s,e):t.datavisualization.Diagram.Point(n(i.element).width()/2,n(i.element).height()/2),t.Matrix.scale(c,r,r,l.x,l.y),h=i._currZoom*r,t.Matrix.translate(c,u,f),t.Matrix.multiply(s,c),a=t.Matrix.transform(s,t.datavisualization.Diagram.Point(0,0)),this._applyTransform(i,h,a,o))},_applyTransform:function(n,i,r,u){n._currZoom=i;var f=r.x*-1,e=r.y*-1;u||n._scrollLimit()!==t.datavisualization.Diagram.ScrollLimit.Infinity&&(f<n._hScrollbar.model.minimum?f=n._hScrollbar.model.minimum:f>n._hScrollbar.model.maximum&&(f=n._hScrollbar.model.maximum),e<n._vScrollbar.model.minimum?e=n._vScrollbar.model.minimum:e>n._vScrollbar.model.maximum&&(e=n._vScrollbar.model.maximum));n._updateScrollOffset(f,e,!0,u)}};t.datavisualization.Diagram.PageUtil={_createPageBreaks:function(n){this._removePageBreaks(n);var i={id:n._canvas.id+"pagebreaks","pointer-events":"none"},r=t.datavisualization.Diagram.SvgContext._initializePageBreaks(n._svg,i,n._pageBackgroundLayer);this._updatePageBreaks(r,n)},_removePageBreaks:function(n){var i=n._svg.getElementById(n._canvas.id+"pagebreaks");i&&t.datavisualization.Diagram.SvgContext._removePageBreaks(n._svg,i,n._pageBackgroundLayer)},_updatePageBreaks:function(n,i){var l=i._getDigramBounds(),k=i.model.pageSettings,r=l.x,w=l.width,u=l.y,b=l.height,f=i._currZoom,a=i._pageHeight(),v=i._pageWidth(),e=i._pageMargin(),y=parseInt(Math.ceil((w-r)/v)),p=parseInt(Math.ceil((b-u)/a)),o,s,h,c;for(r=-i._canvas.clientLeft+(e+r)*f,u=-i._canvas.clientTop+(e+u)*f,o=(v*y-e*2)*f,s=(a*p-e*2)*f,t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r+o,u),i._svg,n),t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r,u+s),i._svg,n),h=1;h<y;h++)t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+(v*h-e)*f,u),t.datavisualization.Diagram.Point(r+(v*h-e)*f,u+s),i._svg,n);for(c=1;c<p;c++)t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+(a*c-e)*f),t.datavisualization.Diagram.Point(r+o,u+(a*c-e)*f),i._svg,n);t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+o,u),t.datavisualization.Diagram.Point(r+o,u+s),i._svg,n);t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+s),t.datavisualization.Diagram.Point(r+o,u+s),i._svg,n)},_updatePageSize:function(n){var u=!1,f,c;n._pageOrientation()==t.datavisualization.Diagram.PageOrientations.Landscape?n._pageHeight()>n._pageWidth()&&(u=!0):n._pageWidth()>n._pageHeight()&&(u=!0);u&&(f=n._pageWidth(),n._pageWidth(n._pageHeight()),n._pageHeight(f));var i=n._getDigramBounds(),r=n._currZoom,e=i.x*r,o=i.y*r,s=(i.width-i.x)*r,h=(i.height-i.y)*r,l=n.model.pageSettings;n._pageBackgroundLayer&&n._pageBackgroundLayer.firstChild?t.datavisualization.Diagram.SvgContext._updatePageBakground(t.datavisualization.Diagram.Point(e,o),t.datavisualization.Diagram.Point(s,h),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth()):t.datavisualization.Diagram.SvgContext._renderPageSettingsRect(t.datavisualization.Diagram.Point(e,o),t.datavisualization.Diagram.Point(s,h),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth());n._svg.document.style.left=0;n._svg.document.style.top=0;c=!1;n._pageWidth()||n._pageHeight()||(c=!0);l.pageWidth&&n._pageHeight()&&(n._showPageBreak()?this._createPageBreaks(n):this._removePageBreaks(n));t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n)}};t.datavisualization.Diagram.ScrollUtil={_transform:function(n,i,r,u){t.datavisualization.Diagram.SvgContext.transformView(n,-i,-r);u&&t.datavisualization.Diagram.SvgContext.scaleContent(n,n._currZoom);t.datavisualization.Diagram.PageUtil._updatePageSize(n);t.datavisualization.Diagram.SvgContext._updateBackground(i,r,n._currZoom,n);t.datavisualization.Diagram.SvgContext._updateGrid(i,r,n._currZoom,n)},_viewPort:function(i){var f=i.element[0],r=n(f).width(),u=n(f).height(),e=i.element[0].getBoundingClientRect(),s=window.screenX<0?window.screenX*-1:window.screenX,o;return r===0&&(r=Math.floor(window.innerWidth-s-Math.floor(e.left))),o=window.screenY<0?window.screenY*-1:window.screenY,u===0&&(u=Math.floor(window.innerHeight-o-Math.floor(e.top))),t.datavisualization.Diagram.Size(r,u)},_union:function(n,t){var i,r,u,f;return n.width<=0?t:n.width>0?(i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),t.width===Infinity||n.width===Infinity?n.width=Infinity:(u=Math.max(n.x+n.width,t.x+t.width),n.width=Math.max(u-i,0)),t.height===Infinity||n.height===Infinity?n.height=Infinity:(f=Math.max(n.y+n.height,t.y+t.height),n.height=Math.max(f-r,0)),n.x=i,n.y=r,n):void 0},_setScrollContentSize:function(i){var v=i._currZoom,u=this._viewPort(i),h,c,r,y,p,l,w,b,a,k;u=t.datavisualization.Diagram.Rectangle(i._hScrollOffset,i._vScrollOffset,u.width,u.height);var f=i._spatialSearch.pageLeft,e=i._spatialSearch.pageRight,o=i._spatialSearch.pageTop,s=i._spatialSearch.pageBottom;f>e&&(f=e=0);o>s&&(o=s=0);i.model.pageSettings&&(h=i._pageWidth(),c=i._pageHeight(),h>0&&c>0?i._multiplePage()?(f=Math.floor(f/h)*h,o=Math.floor(o/c)*c,e=Math.ceil(e/h)*h,s=Math.ceil(s/c)*c):(f=0,o=0,e=h,s=c):(f=f<0?f:0,o=o<0?o:0,e=e>u.width?e:u.width,s=s>u.height?s:u.height));f=f*v;o=o*v;e=e*v;s=s*v;r=t.datavisualization.Diagram.Rectangle(0,0,0,0);r=this._union(r,t.datavisualization.Diagram.Rectangle(0,0,u.width,u.height));r=this._union(r,t.datavisualization.Diagram.Geometry.rect([{x:f,y:o},{x:e,y:s}]));r.width-=u.width;r.height-=u.height;r.x>i._hScrollOffset&&(l=r.x-i._hScrollOffset,r.x-=l,r.width+=l);i._hScrollOffset>r.x+r.width&&(r.width=i._hScrollOffset-r.x);y=r.x;p=Math.max(0,r.x+r.width);r.y>i._vScrollOffset&&(l=r.y-i._vScrollOffset,r.y-=l,r.height+=l);i._vScrollOffset>r.y+r.height&&(r.height=i._vScrollOffset-r.y);w=r.y;b=Math.max(0,r.y+r.height);r.width=r.width<u.width?u.width:r.width;r.height=r.height<u.height?u.height:r.height;i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited&&(a=this._setMinMaxValues(i,y,w,p,b),y=a.minX,w=a.minY,p=a.maxX,b=a.maxY);f>=i._hScrollOffset&&e<=u.width+i._hScrollOffset?(n("#"+i._canvas.id+"_hScrollbar").ejScrollbar("remove"),i._hScrollbar.model.width=0):(n("#"+i._canvas.id+"_hScrollbar").ejScrollbar({width:u.width-18,viewportSize:u.width-18,maximum:p,minimum:y}),n("#"+i._canvas.id+"_hScrollbar").ejScrollbar("scrollX",i._hScrollOffset),k=document.getElementById(i._canvas.id+"_hScrollbar"),k.style.marginTop=u.height-18+"px");o>=i._vScrollOffset&&s<=u.height+i._vScrollOffset?(n("#"+i._canvas.id+"_vScrollbar").ejScrollbar("remove"),i._vScrollbar.model.height=0):(n("#"+i._canvas.id+"_vScrollbar").ejScrollbar({height:u.height-18,viewportSize:u.height-18,maximum:b,minimum:w}),n("#"+i._canvas.id+"_vScrollbar").ejScrollbar("scrollY",i._vScrollOffset));t.datavisualization.Diagram.SvgContext.setSize(i._svg,r.width,r.height)},_setMinMaxValues:function(n,t,i,r,u){var f=n.model.pageSettings.scrollableArea;return t<f.left&&(t=f.left),i<f.top&&(i=f.top),r>f.right&&(r=f.right),u>f.bottom&&(u=f.bottom),{minX:t,minY:i,maxX:r,maxY:u}},_initScrollbar:function(i){var u=i._canvas,f=document.getElementById(u.id+"_hScrollbar"),e=document.getElementById(u.id+"_vScrollbar"),r=this._viewPort(i);n(f).ejScrollbar({orientation:t.Scrollbar.Orientation.Horizontal,width:r.width-18,viewportSize:r.width-18,scroll:function(n){n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&i._updateScrollOffset(n.scrollLeft,i._vScrollOffset)}});i._hScrollbar=n(f).ejScrollbar("instance");n(e).ejScrollbar({orientation:t.Scrollbar.Orientation.Vertical,height:r.height-18,viewportSize:r.height-18,scroll:function(n){n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&i._updateScrollOffset(i._hScrollOffset,n.scrollTop)}});i._vScrollbar=n(e).ejScrollbar("instance")}};t.datavisualization.Diagram.SnapUtil={_canConsider:function(n,t,i){var r=!1;return t.isGroup?r=!this._contains(n,t,i):t.segments||(r=!(t==i)),r},_contains:function(n,t,i){var u=i.name,r=null;if(t.children.indexOf(u)>=0&&(r=n[u]),r&&!r.segments){if(r.isGroup)return this._contains(n,r,i);if(r==i)return!0}return!1},_round:function(n,t,i){for(var e=0,r=0;r<t.length;r++)e+=t[r];e/=i;var o=Math.floor(Math.abs(n)/e),u=n%e,f=o*e;if(n>=0)for(r=0;r<t.length;r++){if(u<=t[r]/i)return f+(u<t[r]/(2*i)?0:t[r]/i);f+=t[r]/i;u-=t[r]/i}else for(f=f*-1,r=t.length-1;r>=0;r--){if(Math.abs(u)<=t[r]/i)return f-(Math.abs(u)<t[r]/(2*i)?0:t[r]/i);f-=t[r]/i;u+=t[r]/i}return n},_findNodes:function(n,i,r,u,f){for(var s,h=[],o,e,c,a=t.datavisualization.Diagram.SpatialUtil.findQuads(n,u),v=t.datavisualization.Diagram.Util.bounds(r),l=0;l<a.length;l++)if(o=a[l],o.objects.length>0)for(s=0;s<o.objects.length;s++)e=o.objects[s],e.segments||(c=t.datavisualization.Diagram.Util.bounds(e),h.indexOf(e)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(v,c)&&h.push(e),f&&f.indexOf(e)&&t.datavisualization.Diagram.Geometry.intersectsRect(u,c)&&f.push(e));return h},_snapAngle:function(n,t){var i=n._snapAngle(),r=t%i;return r>=i/2?t+i-r:t-r},_snapPoint:function(n,i,r,u,f,e,o){var c=n.model.snapSettings,l=n._currZoom,h=t.datavisualization.Diagram.Point(),s=t.datavisualization.Diagram.Util.bounds(i),k={snapped:!1,offset:0},d={snapped:!1,offset:0};n._enableSnapToObject()&&this._snapObject(n,i,k,d,f,o==e);var g=s.x+f.x,nt=s.y+f.y,tt=s.x+s.width+f.x,it=s.y+s.height+f.y,a=this._round(tt,c.verticalGridLines.snapInterval,l),v=this._round(g,c.verticalGridLines.snapInterval,l),y=this._round(nt,c.horizontalGridLines.snapInterval,l),p=this._round(it,c.horizontalGridLines.snapInterval,l),w=s.x+s.width,b=s.y+s.height;return k.snapped?h.x=n._enableSnapToObject()?k.offset:e.x-o.x:c.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines?Math.abs(f.x)>=1&&(h.x+=r?Math.abs(a-w)>Math.abs(v-s.x)?v-s.x:a-w:Math.abs(a-w)<Math.abs(v-s.x)?a-w:v-s.x):h.x=e.x-o.x,d.snapped?h.y=d.offset:c.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines?Math.abs(f.y)>=1&&(h.y+=u?Math.abs(p-b)>Math.abs(y-s.y)?y-s.y:p-b:Math.abs(p-b)<Math.abs(y-s.y)?p-b:y-s.y):h.y=e.y-o.y,h},_snapObject:function(n,i,r,u,f,e){var v=null,y=null,w,b,d=[],g=[],it=[],rt=[],o=t.datavisualization.Diagram.Util.bounds(i),l=n._currZoom,ut=n._hScrollOffset,ft=n._vScrollOffset,h=n._snapObjectDistance(),p=t.datavisualization.Diagram.ScrollUtil._viewPort(n),et=t.datavisualization.Diagram.Rectangle(ut/l,o.y-5,p.width/l,o.height+10),ot=t.datavisualization.Diagram.Rectangle(o.x-5,ft/l,o.width+10,p.height/l),k,a,c,s,nt,tt;for(p=t.datavisualization.Diagram.Rectangle(ut/l,ft/l,p.width/l,p.height/l),k=this._findNodes(n._spatialSearch,i,ot,p),nt=n.nameTable,a=0;a<k.length;a++)c=k[a],!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.y+s.height<o.y+f.y?it.push({object:c,distance:Math.abs(o.y+f.y-s.y-s.height)}):s.y>o.y+f.y+o.height&&rt.push({object:c,distance:Math.abs(o.y+f.y+o.height-s.y)}),(v==null||v>Math.abs(s.y-o.y-f.y))&&(Math.abs(s.x+s.width/2-(o.x+o.width/2+f.x))<=h?(w=this._createSnapObject(s,o,"centerX"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"left"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+o.width+f.x))<=h?(w=this._createSnapObject(s,o,"right"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"leftRight"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+o.width+f.x))<=h&&(w=this._createSnapObject(s,o,"rightLeft"),v=Math.abs(s.y-o.y))));for(k=this._findNodes(n._spatialSearch,i,et,p),a=0;a<k.length;a++)c=k[a],!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.x+s.width<o.x+f.x&&(d[d.length]={object:c,distance:Math.abs(o.x+f.x-s.x-s.width)}),s.x>o.x+f.x+o.width&&(g[g.length]={object:c,distance:Math.abs(o.x+f.x+o.width-s.x)}),(y==null||y>Math.abs(s.x-o.x-f.x))&&(Math.abs(s.y+s.height/2-(o.y+o.height/2+f.y))<=h?(b=this._createSnapObject(s,o,"centerY"),y=Math.abs(s.x-o.x)):Math.abs(s.y-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"top"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-(o.y+o.height+f.y))<=h?(b=this._createSnapObject(s,o,"bottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"topBottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y-(o.y+o.height+f.y))<=h&&(b=this._createSnapObject(s,o,"bottomTop"),y=Math.abs(s.x-o.x))));tt=this._createGuidelines(n,w,b,r,u,e);r.snapped||this._createHSpacingLines(n,i,d,g,r,u,e,tt,f,h);u.snapped||this._createVSpacingLines(n,i,it,rt,r,u,e,tt,f,h)},_snapSize:function(n,i,r,u,f,e,o){var p=null,w=null,d,g,s=t.datavisualization.Diagram.Util.bounds(e),ut=n.nameTable,nt=[],tt=[],l=n._currZoom,st=n._hScrollOffset,ht=n._vScrollOffset,v=n._snapObjectDistance(),y=t.datavisualization.Diagram.ScrollUtil._viewPort(n),lt=t.datavisualization.Diagram.Rectangle(st/l,(s.y-5)/l,y.width/l,(s.height+10)/l),at=t.datavisualization.Diagram.Rectangle((s.x-5)/l,ht/l,(s.width+10)/l,y.height/l),it,b,a,c,h,et,ot;for(y=t.datavisualization.Diagram.Rectangle(st/l,ht/l,y.width/l,y.height/l),it=[],b=this._findNodes(n._spatialSearch,e,at,y,it),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(p==null||p>Math.abs(h.y-s.y))&&(i.left?Math.abs(s.x+u-h.x)<=v?(d=this._createSnapObject(h,s,"left"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u-h.x-h.width)<=v&&(d=this._createSnapObject(h,s,"leftRight"),p=Math.abs(h.y-s.y)):i.right&&(Math.abs(s.x+u+s.width-h.x-h.width)<=v?(d=this._createSnapObject(h,s,"right"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u+s.width-h.x)<=v&&(d=this._createSnapObject(h,s,"rightLeft"),p=Math.abs(h.y-s.y)))));for(b=this._findNodes(n._spatialSearch,e,lt,y),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(w==null||w>Math.abs(h.x-s.x))&&(r.top?Math.abs(s.y+f-h.y)<=v?(g=this._createSnapObject(h,s,"top"),w=Math.abs(h.x-s.x)):Math.abs(s.y+f-h.y-h.height)<=v&&(g=this._createSnapObject(h,s,"topBottom"),w=Math.abs(h.x-s.x)):r.bottom&&(Math.abs(s.y+s.height+f-h.y-h.height)<=v?(g=this._createSnapObject(h,s,"bottom"),w=Math.abs(h.x-s.x)):Math.abs(s.y+s.height+f-h.y)<=v&&(g=this._createSnapObject(h,s,"bottomTop"),w=Math.abs(h.x-s.x)))));for(a=0;a<it.length;a++)if(c=it[a],this._canConsider(ut,e,c)){var k=t.datavisualization.Diagram.Util.bounds(c),ft=i.left?-u:u,ct=Math.abs(s.width+ft-k.width),rt;ct<=v&&(rt=i.left?-k.width+s.width:k.width-s.width,nt[nt.length]={source:c,diff:ct,offset:rt});ft=r.top?-f:f;et=Math.abs(s.height+ft-k.height);et<=v&&(rt=r.top?-k.height+s.height:k.height-s.height,tt[tt.length]={source:c,diff:et,offset:rt})}ot=this._createGuidelines(n,d,g,i,r,o);!i.snapped&&nt.length>0&&(i.left||i.right)&&this._addSameWidthLines(n,nt,i,o,ot,e);!r.snapped&&tt.length>0&&(r.top||r.bottom)&&this._addSameHeightLines(n,tt,r,o,ot,e)},_createSnapObject:function(n,i,r){var u;switch(r){case"left":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x,offsetY:0,type:"sideAlign"};break;case"right":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"top":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y,offsetX:0,type:"sideAlign"};break;case"bottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"topBottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"leftRight":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"centerX":u={start:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width/2-(i.x+i.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height/2),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height/2),offsetY:n.y+n.height/2-(i.y+i.height/2),offsetX:0,type:"centerAlign"}}return u},_createGuidelines:function(n,i,r,u,f,e){var l={id:n._canvas.id+"guideline","pointer-events":"none",style:"pointer-events:none;"},o=t.datavisualization.Diagram.SvgContext._initializeGuidelines(n._svg,l,n._adornerLayer),s=n._currZoom,h=n._hScrollOffset,c=n._vScrollOffset;return i&&(u.offset=i.offsetX,u.snapped=!0,e||(i.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(i.start,i.end,o,n._svg,s,h,c):i.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(i.start,i.end,o,n._svg,s,h,c))),r&&(f.offset=r.offsetY,f.snapped=!0,e||(r.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(r.start,r.end,o,n._svg,s,h,c):r.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(r.start,r.end,o,n._svg,s,h,c))),o},_removeGuidelines:function(n){var i=n._svg.getElementById(n._canvas.id+"guideline");i!=null&&t.datavisualization.Diagram.SvgContext._removeGuidelines(n._adornerLayer,i)},_createHSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,w,p,y,b,v,d,g,k;r.sort(function(n,t){return n.distance-t.distance});u.sort(function(n,t){return n.distance-t.distance});l=[];w=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],p=t.datavisualization.Diagram.Util.bounds(r[0].object),a=p.y,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),v=p.x-b.x-b.width,Math.abs(v-r[0].distance)<=c?a=this._findEquallySpacedNodesAtLeft(r,v,a,l):v=r[0].distance):v=r[0].distance);l.sort(function(n,t){return t.distance-n.distance});l[l.length]={object:i,distance:0};a=w.y<a||!a?w.y:a;u.length>0&&(y=t.datavisualization.Diagram.Util.bounds(u[0].object),a=y.y<a?y.y:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.x-y.x-y.width),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?v-=g:v+=g,l[l.length]=u[0]):r.length==1&&(p=undefined,l.splice(0,1),l[l.length]=u[0],v=d):(v=d,l[l.length]=u[0]),u.length>1&&y.x+y.width<b.x&&(a=this._findEquallySpacedNodesAtRight(u,d,a,l,c)));l.length>2&&(this._addHSpacingLines(n,l,o,s,a),k=0,o&&(k=h.x),p?f.offset=v-Math.abs(w.x+k-p.x-p.width)+k:y&&(f.offset=Math.abs(w.x+w.width+k-y.x)-v+k),f.snapped=!0)},_createVSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,p,w,v,b,y,d,g,k;r.sort(function(n,t){return n.distance-t.distance});u.sort(function(n,t){return n.distance-t.distance});l=[];p=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],w=t.datavisualization.Diagram.Util.bounds(r[0].object),a=w.x+w.width,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),y=w.y-b.y-b.height,Math.abs(y-r[0].distance)<=c?a=this._findEquallySpacedNodesAtTop(r,y,a,l):y=r[0].distance):y=r[0].distance);l.sort(function(n,t){return t.distance-n.distance});l[l.length]={object:i,distance:0};a=p.x+p.width>a||!a?p.x+p.width:a;u.length>0&&(v=t.datavisualization.Diagram.Util.bounds(u[0].object),a=v.x+v.width>a?v.x+v.width:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.y-v.y-v.height),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?y-=g:y+=g,l[l.length]=u[0]):r.length==1&&(w=undefined,l.splice(0,1),l[l.length]=u[0],y=d):(y=d,l[l.length]=u[0]),u.length>1&&b.y>v.y+v.height&&(a=this._findEquallySpacedNodesAtBottom(u,d,a,l,c)));l.length>2&&(this._addVSpacingLine(n,l,o,s,a),k=0,o&&(k=h.y),w?e.offset=y-Math.abs(p.y+k-w.y-w.height)+k:v&&(e.offset=Math.abs(p.y+p.height+k-v.y)-y+k),e.snapped=!0)},_addHSpacingLines:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,e,o,s;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width,f-15),t.datavisualization.Diagram.Point(s.x,f-15),u,n._svg,h,c,l)},_addVSpacingLine:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,o,s,e;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(f+15,o.y+o.height),t.datavisualization.Diagram.Point(f+15,s.y),u,n._svg,h,c,l)},_addSameWidthLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;i.sort(function(n,t){return n.offset-t.offset});var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=1;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.width==p.width&&h.push(i[s]);if(h.length>0&&!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+c.offset,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width+c.offset,o.y-15),f,n._svg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width,o.y-15),f,n._svg,l,a,v);r.offset=c.offset;r.snapped=!0},_addSameHeightLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;i.sort(function(n,t){return n.offset-t.offset});var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=0;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.height==p.height&&h.push(i[s]);if(h.length>0){if(!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+c.offset),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height+c.offset),f,n._svg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height),f,n._svg,l,a,v);r.offset=c.offset;r.snapped=!0}},_findEquallySpacedNodesAtLeft:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.x-f.x-f.width,Math.abs(s-i)<=1)u[u.length]=n[e],f.y<r&&(r=f.y);else break;return r},_findEquallySpacedNodesAtRight:function(n,i,r,u,f){var l=n[0].distance,s,h,o,c,e;if(Math.abs(i-l)<=f)for(e=0;e<n.length-1;e++)if(s=n[e].object,h=t.datavisualization.Diagram.Util.bounds(n[e+1].object),o=t.datavisualization.Diagram.Util.bounds(s),c=h.x-o.x-o.width,Math.abs(c-i)<=1)u[u.length]=n[e+1],o.y<r&&(r=o.y);else break;return r},_findEquallySpacedNodesAtTop:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.y-f.y-f.height,Math.abs(s-i)<=1)u[u.length]=n[e],f.x+f.width>r&&(r=f.x+f.width);else break;return r},_findEquallySpacedNodesAtBottom:function(n,i,r,u,f){var l=n[0].distance,s,h,e,c,o;if(Math.abs(i-l)<=f)for(o=0;o<n.length-1;o++)if(s=n[o].object,h=t.datavisualization.Diagram.Util.bounds(n[o+1].object),e=t.datavisualization.Diagram.Util.bounds(s),c=h.y-e.y-e.height,Math.abs(c-i)<=1)u[u.length]=n[o+1],e.x+e.width>r&&(r=e.x+e.width);else break;return r}};t.datavisualization.Diagram.SpatialUtil={findQuads:function(n,t){n.quads=[];var i=n.parentQuad;return this._findQuads(n,i,t),n.quads},_addIntoAQuad:function(n){for(var t=!1;!t;)t=this._add(n,n.parentQuad)},_setCurrentNode:function(n,i){n.childnode=i;var r=t.datavisualization.Diagram.Util.bounds(i);n.childLeft=r.left;n.childTop=r.top;n.childRight=r.right;n.childBottom=r.bottom},_add:function(n,i){if(this._isContained(n,i))return this._selectQuad(n,i),!0;var r,u=!i.objects.length&&i.first==null&&i.second==null&&i.third==null&&i.fourth==null;return n.childLeft<i.left?n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top-i.height,i.width*2,i.height*2),u||(r.fourth=i)):(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top,i.width*2,i.height*2),u||(r.second=i)):n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left,i.top-i.height,i.width*2,i.height*2),u||(r.third=i)):(r=t.datavisualization.Diagram.Quad(i.left,i.top,i.width*2,i.height*2),u||(r.first=i)),i.parent=r,n.parentQuad=r,!1},_isContained:function(n,t){return n.childLeft>=t.left&&n.childRight<=t.left+t.width&&n.childTop>=t.top&&n.childBottom<=t.top+t.height?!0:!1},_selectQuad:function(n,t){for(var i=t;i!==null;)i=this._getQuad(n,i)},_getQuad:function(n,i){var u=i.width/2,f=i.height/2,e,r;if(u>=100&&f>=100)if(e=i.left+u,r=i.top+f,n.childRight<=e){if(n.childBottom<=r)return i.first?i.first:i.first=t.datavisualization.Diagram.Quad(i.left,i.top,u,f,i);if(n.childTop>=r)return i.third?i.third:i.third=t.datavisualization.Diagram.Quad(i.left,r,u,f,i)}else if(n.childLeft>=e){if(n.childBottom<=r)return i.second?i.second:i.second=t.datavisualization.Diagram.Quad(e,i.top,u,f,i);if(n.childTop>=r)return i.fourth?i.fourth:i.fourth=t.datavisualization.Diagram.Quad(e,r,u,f,i)}return i.objects.push(n.childnode),n.quadTable[n.childnode.name]=i,null},_findQuads:function(n,t,i){t.first&&this._isIntersect(t.first,i)&&this._findQuads(n,t.first,i);t.second&&this._isIntersect(t.second,i)&&this._findQuads(n,t.second,i);t.third&&this._isIntersect(t.third,i)&&this._findQuads(n,t.third,i);t.fourth&&this._isIntersect(t.fourth,i)&&this._findQuads(n,t.fourth,i);t.objects.length>0&&n.quads.push(t)},_isIntersect:function(n,t){return n.left+n.width<t.left||n.top+n.height<t.top||n.left>t.right||n.top>t.bottom?!1:!0},_update:function(n){if(n.parent!=null&&n.objects.length==0&&n.first==null&&n.second==null&&n.third==null&&n.fourth==null){var t=n.parent;t.first==n?t.first=null:t.second==n?t.second=null:t.third==n?t.third=null:t.fourth==n&&(t.fourth=null);this._update(n.parent)}else return},_isWithinPageBounds:function(n,t){return t.left>=n.pageLeft&&t.right<=n.pageRight&&t.top>=n.pageTop&&t.bottom<=n.pageBottom?!0:!1},_updateBounds:function(n,i,r){var u=!1;i.topElement&&r.name==i.topElement.name&&(u=!0,i.pageTop=null,this._findQuadElement(i,i.parentQuad,"top"));i.leftElement&&r.name==i.leftElement.name&&(u=!0,i.pageLeft=null,this._findQuadElement(i,i.parentQuad,"left"));i.rightElement&&r.name==i.rightElement.name&&(u=!0,i.pageRight=null,this._findQuadElement(i,i.parentQuad,"right"));i.bottomElement&&r.name==i.bottomElement.name&&(u=!0,i.pageBottom=null,this._findQuadElement(i,i.parentQuad,"bottom"));u&&n._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(n)},_findQuadElement:function(n,i,r){var u,f;switch(r){case"bottom":i.third!=null||i.fourth!=null?(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r));break;case"top":i.first!=null||i.second!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"left":i.first!=null||i.third!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.third!=null&&this._findQuadElement(n,i.third,r)):(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"right":i.second!=null||i.fourth!=null?(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.first!=null&&this._findQuadElement(n,i.first,r))}for(f=0;f<i.objects.length;f++)u=t.datavisualization.Diagram.Util.bounds(i.objects[f]),r==="bottom"&&(n.pageBottom<=u.bottom||n.pageBottom==null)?(n.pageBottom=u.bottom,n.bottomElement=i.objects[f]):r==="top"&&(n.pageTop>=u.top||n.pageTop==null)?(n.pageTop=u.top,n.topElement=i.objects[f]):r==="left"&&(n.pageLeft>=u.left||n.pageLeft==null)?(n.pageLeft=u.left,n.leftElement=i.objects[f]):r==="right"&&(n.pageRight<=u.right||n.pageRight==null)&&(n.pageRight=u.right,n.rightElement=i.objects[f])},_initializeNodes:function(n,t){for(var r,u=n.model.nodes,i=0;i<u.length;i++)r=u[i],r.isGroup||this._updateQuad(n,t,r)},_initializeConnectors:function(n,t){for(var r=n.model.connectors,i=0;i<r.length;i++)this._updateQuad(n,t,r[i])},_updateQuad:function(i,r,u,f){var s,o,e;this._setCurrentNode(r,u);s=t.datavisualization.Diagram.Util.bounds(u);o=r.quadTable[u.name];o?u.segments?(this._removeFromaQuad(r,o,u),this._addIntoAQuad(r)):this._isContained(r,o)||(this._removeFromaQuad(r,o,u),this._addIntoAQuad(r)):(r.parentQuad||(r.parentQuad=t.datavisualization.Diagram.Quad(0,0,200,200)),this._addIntoAQuad(r));this._isWithinPageBounds(r,s)&&r.leftElement!=u&&r.topElement!=u&&r.rightElement!=u&&r.bottomElement!=u||(e=!1,r.pageLeft>=r.childLeft||r.pageLeft==null?(r.pageLeft=r.childLeft,r.leftElement=u,e=!0):u==r.leftElement&&(r.pageLeft=null,this._findQuadElement(r,r.parentQuad,"left"),e=!0),r.pageTop>=r.childTop||r.pageTop==null?(r.pageTop=r.childTop,r.topElement=u,e=!0):u==r.topElement&&(r.pageTop=null,this._findQuadElement(r,r.parentQuad,"top"),e=!0),r.pageBottom<=r.childBottom||r.pageBottom==null?(e=!0,r.pageBottom=r.childBottom,r.bottomElement=u):u==r.bottomElement&&(r.pageBottom=null,this._findQuadElement(r,r.parentQuad,"bottom"),e=!0),r.pageRight<=r.childRight||r.pageRight==null?(r.pageRight=r.childRight,r.rightElement=u,e=!0):u==r.rightElement&&(r.pageRight=null,this._findQuadElement(r,r.parentQuad,"right"),e=!0));e&&(i._views.forEach(function(t){var u=i._views[t],r;u.type=="overview"&&(r=n("#"+t).ejOverview("instance"),r&&r._updateOverview(u))}),!f&&i._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(i))},_removeFromaQuad:function(n,t,i){if(t){var r=t.objects.indexOf(i);t.objects.splice(r,1);this._update(t);delete n.quadTable[i.name]}}};t.datavisualization.Diagram.Quad=function(n,t,i,r,u){return{left:n,top:t,width:i,height:r,parent:u,first:null,second:null,third:null,fourth:null,objects:[]}};t.datavisualization.Diagram.SpatialSearch=function(){return{pageLeft:null,pageRight:null,pageTop:null,pageBottom:null,topElement:null,bottomElement:null,rightElement:null,leftElement:null,childLeft:null,childTop:null,childRight:null,childBottom:null,childNode:null,quads:null,parentQuad:t.datavisualization.Diagram.Quad(0,0,200,200),quadTable:{}}}}(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejOverview","ej.datavisualization.Overview",{element:null,validTags:["div"],model:null,defaults:{sourceID:"",width:null,height:null},_canvas:null,_actionName:"",_startPoint:null,_currentPoint:null,_prevPoint:null,_helper:null,_viewPortRatio:1,_resizeDirection:"",_inAction:!1,_init:function(){this._wireEvents();this._renderCanvas();this._setParent(this.model.sourceID)},_renderCanvas:function(){var n=document.createElement("div");n.setAttribute("id",this.element[0].id+"_canvas");n.setAttribute("class","drawing");n.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";style:-ms-touch-action: none;touch-action: none;");this.element[0].setAttribute("tabindex",0);this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this.element.append(n);this._canvas=n},_renderDocument:function(i){var o,r,h,c;if(i.canvas=this._canvas,window.SVGSVGElement){o={id:this._canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:i.style};r=new t.datavisualization.Diagram.Svg(o);this._svg=r;i.svg=r;var l=document.getElementById(this._id),e=l,u=n(e).width(),f=n(e).height(),s=e.getBoundingClientRect(),a=window.screenX<0?window.screenX*-1:window.screenX;u===0&&(u=Math.floor(window.innerWidth-a-Math.floor(s.left)));h=window.screenY<0?window.screenY*-1:window.screenY;f===0&&(f=Math.floor(window.innerHeight-h-Math.floor(s.top)));r.document.setAttribute("width",u);r.document.setAttribute("height",f);this.width=u;this.height=f;c=r.defs({id:i.canvas.id+"definition"});r.appendChild(c);i.diagramLayer=t.datavisualization.Diagram.SvgContext._renderDiagramLayer(i.canvas,i.svg,i.svg);i.canvas.appendChild(r.document);this._addOverviewRectPanel()}},_removeDocument:function(){var n=document.getElementById(this._canvas.id+"_svg");this._canvas.removeChild(n)},_setModel:function(n){for(var t in n)switch(t){case"sourceID":this._setParent(n[t])}},_setParent:function(t){if(this._parent){var i=n("#"+this._parent._id).ejDiagram("instance");i._setOverview(null,this._id)}t&&(this.model.sourceID=t,this._parent=n("#"+t).ejDiagram("instance"),this._parent&&this._parent._setOverview(this))},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){var i=n(this._canvas);this._on(i,t.eventType.mouseDown,this._mousedown);this._on(i,t.eventType.mouseMove,this._mousemove);this._on(i,t.eventType.mouseUp,this._mouseup);this._on(i,"touchstart",this.handleTouchStart);this._on(i,"touchmove",this.handleTouchMove);this._on(i,"touchend",this.handleTouchEnd);window&&this._on(n(window),"resize",this.updateScrollerViewport)},updateScrollerViewport:function(){},_mouseup:function(n){var f,e,t,u;if(this._currentPoint=this._mouseposition(n),f=this.width,e=this.height,this._actionName)if(this._startPoint.x!=this._currentPoint.x||this._startPoint.y!=this._currentPoint.y){if(this._actionName!="pan"&&this._helper){t=this._helper.getBBox();this._resizeDirection=this._resizeDirection||"";var o=t.x,s=t.y,i=t.width,r=t.height,h=this._resizeDirection=="topleft"||this._resizeDirection=="topright"||this._resizeDirection=="bottomleft"||this._resizeDirection=="bottomright";this._renderOverviewRect(o,s,i,r)}}else if((n.target.id==this._canvas.id+"overviewbackrect"||n.target.id=="helper")&&this._startPoint.x==this._currentPoint.x&&this._startPoint.y==this._currentPoint.y){var u=document.getElementById(this._canvas.id+"overviewrect"),t=u.getBBox(),i=t.width||100,r=t.height||100/this._viewPortRatio;this.inAction=!0;this._actionName="pan";this._renderOverviewRect(this._currentPoint.x-i/2,this._currentPoint.y-r/2,i,r);this.inAction=!1}this._helper&&(u=document.getElementById(this._canvas.id+"overviewhandle"),u.removeChild(this._helper),this._helper=null);this._actionName="";this._startPoint=null;this._currentPoint=null;this._prevPoint=null;this._helper=null;this._viewPortRatio=1;this._resizeDirection="";this._inAction=!1},_mousedown:function(n){if(n.target.className.animVal=="overviewbackrect"&&(this._actionName="draw"),n.target.id==this._canvas.id+"overviewrect"&&(this._actionName="pan"),n.target.className.animVal=="overviewresizer"){this._actionName="scale";switch(n.target.id){case this._canvas.id+"left":this._resizeDirection="left";break;case this._canvas.id+"right":this._resizeDirection="right";break;case this._canvas.id+"top":this._resizeDirection="top";break;case this._canvas.id+"bottom":this._resizeDirection="bottom";break;case this._canvas.id+"topleft":this._resizeDirection="topleft";break;case this._canvas.id+"topright":this._resizeDirection="topright";break;case this._canvas.id+"bottomleft":this._resizeDirection="bottomleft";break;case this._canvas.id+"bottomright":this._resizeDirection="bottomright"}}this._startPoint=this._prevPoint=this._mouseposition(n);var i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent);this._viewPortRatio=i.width/i.height},_mouseposition:function(n){var i=this._parent._isTouchEvent(n);i||(i=n);var u=this._canvas.scrollLeft,f=this._canvas.scrollTop,r=this._canvas.getBoundingClientRect(),e=i.clientX+u-r.left,o=f+i.clientY-r.top;return new t.datavisualization.Diagram.Point(e,o)},_updateCursor:function(n){if(n.target.className.animVal=="overviewresizer")switch(n.target.id){case this._canvas.id+"left":this._canvas.style.cursor="w-resize";break;case this._canvas.id+"right":this._canvas.style.cursor="e-resize";break;case this._canvas.id+"top":this._canvas.style.cursor="n-resize";break;case this._canvas.id+"bottom":this._canvas.style.cursor="s-resize";break;case this._canvas.id+"topleft":this._canvas.style.cursor="nw-resize";break;case this._canvas.id+"topright":this._canvas.style.cursor="ne-resize";break;case this._canvas.id+"bottomleft":this._canvas.style.cursor="sw-resize";break;case this._canvas.id+"bottomright":this._canvas.style.cursor="se-resize"}else this._canvas.style.cursor=""},_mousemove:function(n){if(this._updateCursor(n),this._currentPoint=this._mouseposition(n),this._actionName)switch(this._actionName){case"draw":this._inAction||(this._initHelper(),this._inAction=!0);this._updateHelper();break;case"scale":this._inAction||(this._initHelper(),this._inAction=!0);this._updateOverviewRectangle();break;case"pan":this._inAction=!0;this._translateOverviewRectangle()}this._prevPoint=this._currentPoint},_addOverviewRectPanel:function(){var u=this._svg,f=u.g({id:this._id+"_overviewlayer"}),e,r,i,o;this._canvas.firstChild.appendChild(f);e=u.rect({fill:"transparent",width:"100%",height:"100%","class":"overviewbackrect",id:this._canvas.id+"overviewbackrect"});f.appendChild(e);r=n(f);this._on(r,t.eventType.mouseDown,this._mousedown);this._on(r,t.eventType.mouseMove,this._mousemove);this._on(r,t.eventType.mouseUp,this._mouseup);this._on(r,"touchstart",this.handleTouchStart);this._on(r,"touchmove",this.handleTouchMove);this._on(r,"touchend",this.handleTouchEnd);i=u.g({id:this._canvas.id+"overviewhandle"});f.appendChild(i);o=u.rect({id:this._canvas.id+"overviewrect",fill:"transparent"});i.appendChild(o);this._renderOverviewCorner("left",i);this._renderOverviewCorner("right",i);this._renderOverviewCorner("top",i);this._renderOverviewCorner("bottom",i);this._renderOverviewCorner("topleft",i);this._renderOverviewCorner("topright",i);this._renderOverviewCorner("bottomleft",i);this._renderOverviewCorner("bottomright",i)},_updateOverview:function(n){var h,c,r,u,f,a,i,v,s;n=n||this._parent._views[this._id];r=this._parent._getDigramBounds();h=r.width;c=r.height;var l=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),e=this.width,o=this.height;n.context==t.datavisualization.Diagram.SvgContext?(u=Math.max(h,l.width),f=Math.max(c,l.height),this.contentWidth=u=Math.max(u,e/o*f),this.contentHeight=f=Math.max(f,o/e*u),a=document.getElementById(this._canvas.id+"_diagramLayer"),i=Math.min(e/u,o/f),this.scale=i,a.setAttribute("transform","scale("+i+","+i+"),translate("+-r.x+","+-r.y+")"),v=document.getElementById(this._id+"_overviewlayer"),v.setAttribute("transform","translate("+-r.x*i+","+-r.y*i+")")):(s=n._canvas.document.getContext("2d"),n.scale&&s.scale(1/n.scale.x,1/n.scale.y),n.scale={x:i,y:i},s.scale(i,i),t.datavisualization.Diagram.CanvasContext.refreshCanvas(this._parent.model,n));this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom)},_updateOverviewRectangle:function(){var n=this._currentPoint.x-this._prevPoint.x,t=this._currentPoint.y-this._prevPoint.y;if(this._actionName=="scale"){var i={width:0,height:0},r=0,u=0,f,e;switch(this._resizeDirection){case"left":i.width-=n;i.height-=n/this._viewPortRatio;r=n;u=n/this._viewPortRatio/2;break;case"right":i.width+=n;i.height+=n/this._viewPortRatio;u=n/this._viewPortRatio/-2;break;case"top":i.height-=t;i.width-=t*this._viewPortRatio;u=t;r=t*this._viewPortRatio/2;break;case"bottom":i.height+=t;i.width+=t*this._viewPortRatio;r=t*this._viewPortRatio/-2;break;case"topleft":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width-=n;i.height-=t;r=n;u=t;break;case"topright":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-(n/this._viewPortRatio);u=t;i.width+=n;i.height-=t;break;case"bottomleft":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-n/this._viewPortRatio;r=n;i.width-=n;i.height+=t;break;case"bottomright":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width+=n;i.height+=t}this._updateHelper(r,u,i,f,e)}},_initHelper:function(){var e,n,t;if(!this._helper){var o=this._svg,s=document.getElementById(this._canvas.id+"overviewhandle"),h=this._parent._currZoom,i=this._startPoint.x,r=this._startPoint.y,u=1,f=1;this._actionName=="scale"&&(e=document.getElementById(this._canvas.id+"overviewrect"),n=e.getBBox(),i=n.x,r=n.y,u=n.width,f=n.height);t=o.rect({id:"helper",x:i,y:r,width:u,height:f,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"});s.appendChild(t);this._helper=t}},_updateHelper:function(n,i,r){var n,i,f,e;if(r)var u=this._helper.getBBox(),o=u.x+n,s=u.y+i,h=u.width+r.width,c=u.height+r.height;else{n=this._currentPoint.x>this._startPoint.x?this._currentPoint.x-this._prevPoint.x:this._prevPoint.x-this._currentPoint.x;i=this._currentPoint.y>this._startPoint.y?this._currentPoint.y-this._prevPoint.y:this._prevPoint.y-this._currentPoint.y;Math.abs(i)>Math.abs(n)?(n=this._viewPortRatio*i,e=!0,f=!1):(i=n/this._viewPortRatio,f=!0,e=!1);var u=this._helper.getBBox(),o=this._startPoint.x>this._currentPoint.x?u.x-n:u.x,s=this._startPoint.y>this._currentPoint.y?u.y-i:u.y,h=u.width+n,c=u.height+i}this._helper&&t.datavisualization.Diagram.Util.attr(this._helper,{id:this._helper.id,x:o,y:s,width:h,height:c})},_renderOverviewCorner:function(n,t){var i=this._svg,r,u;n=="top"||n=="bottom"||n=="right"||n=="left"?(r=i.rect({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.rect({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u)):(r=i.circle({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.circle({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u))},_updateOverviewrect:function(n,i,r,u){if(r&&u){var f=document.getElementById(this._canvas.id+"overviewrect"),e={x:n,y:i,width:Math.max(1,r),height:Math.max(1,u)};t.datavisualization.Diagram.Util.attr(f,e);this._updateOverviewCorner("top",n+8,i-2,Math.max(0,r-16),2);this._updateOverviewCorner("bottom",n+8,i+u,Math.max(0,r-16),2);this._updateOverviewCorner("left",n-2,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("right",n+r,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("topleft",n,i,5,5);this._updateOverviewCorner("topright",n+r,i,5,5);this._updateOverviewCorner("bottomleft",n,i+u,5,5);this._updateOverviewCorner("bottomright",n+r,i+u,5,5)}},_scrollOverviewRect:function(n,i,r){var h;if(!this._actionName){var c=this.width,l=this.height,u=Math.min(this.contentWidth/c,this.contentHeight/l),f={},e=f.x=n/r/u,o=f.y=i/r/u,s=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),a=f.width=s.width/r/u,v=f.height=s.height/r/u,y=s.width/s.height;e+a>c&&(h=e+a-c,e-=h);o+v>l&&(h=o+v-l,o-=h);this._updateOverviewrect(e,o,a,v)}},_updateOverviewCorner:function(n,i,r,u,f){var h="visible"+n,c=document.getElementById(this._canvas.id+h),e,o,s;n=="top"||n=="bottom"||n=="right"||n=="left"?(e={x:i,y:r,width:u,height:f,fill:"#ED1C24"},o={x:i-2,y:r-2,width:u==2?4:u,height:f==2?4:f}):(e={cx:i,cy:r,r:4,fill:"#ED1C24"},o={cx:i,cy:r,r:6,fill:"transparent"});t.datavisualization.Diagram.Util.attr(c,e);s=document.getElementById(this._canvas.id+n);t.datavisualization.Diagram.Util.attr(s,o)},_translateOverviewRectangle:function(){var o=this.width,s=this.height,h=this._currentPoint.x-this._prevPoint.x,c=this._currentPoint.y-this._prevPoint.y,i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),a=Math.min(i.width/o,i.height/s),l=document.getElementById(this._canvas.id+"overviewrect"),n=l.getBBox(),r=n.x+h,u=n.y+c,f=n.width,e=n.height;this._updateOverviewrect(r,u,f,e);this._updateView(this._parent._currZoom,r,u,f,e,null)},_updateView:function(i,r,u,f,e,o){var b=this.width,k=this.height,d=this.contentWidth/b,g=this.contentHeight/k,y=r*d*i,p=u*g*i,h=this._parent._getDigramBounds(),v,s;if(i!=1||this._actionName=="pan"){var a=n("#"+this._parent._canvas.id+"_hScrollbar").ejScrollbar("instance").model,w=-y+a.maximum,c=-y+this._parent._hScrollOffset,l=-p+this._parent._vScrollOffset;h.width*i<w&&(s=h.width*i-w,c=Math.abs(s)<Math.abs(c)?c-s:0);a=n("#"+this._parent._canvas.id+"_vScrollbar").ejScrollbar("instance").model;v=-p+a.maximum;h.height*i<v&&(s=h.height*i-v,l=Math.abs(s)<Math.abs(l)?l-s:0)}t.datavisualization.Diagram.ZoomUtil.zoomPan(this._parent,i/this._parent._currZoom,c,l,o,!1)},_renderOverviewRect:function(n,i,r,u){var o=this.width,s=this.height,e=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),h=r/o*this.contentWidth,c=u/s*this.contentHeight,f=Math.max(e.width/h,e.height/c);f>=.25&&f<=30&&(this._updateView(f,n,i,r,u,new t.datavisualization.Diagram.Point(0,0)),this._updateOverviewrect(n,i,r,u))},handleTouchStart:function(n){n.preventDefault()},handleTouchMove:function(n){n.preventDefault()},handleTouchEnd:function(n){n.preventDefault()},handleTouchLeave:function(n){n.preventDefault()}})}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function i(n){return this.document=document.createElement("canvas"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return i.prototype.rect=function(n,t,i,r,u,f){var e=this.document.getContext("2d");e.beginPath();u&&u.angle&&this.rotateContext(u,e);f?(this.setStyle(f,e),f.dashArray?this.dashedRectangle(n,t,i,r,f.dashArray):e.strokeRect(n,t,i,r)):e.strokeRect(n,t,i,r);e.fillRect(n,t,i,r);e.closePath();u&&u.angle&&e.restore()},i.prototype.ellipse=function(n,i,r,u,f,e){var s=this.document.getContext("2d"),o;e&&this.setStyle(e,s);o=4*((Math.sqrt(2)-1)/3);s.beginPath();f&&f.angle&&this.rotateContext(f,s);s.moveTo(n,i-u);s.bezierCurveTo(n+o*r,i-u,n+r,i-o*u,n+r,i);s.bezierCurveTo(n+r,i+o*u,n+o*r,i+u,n,i+u);s.bezierCurveTo(n-o*r,i+u,n-r,i+o*u,n-r,i);s.bezierCurveTo(n-r,i-o*u,n-o*r,i-u,n,i-u);s.fill();e&&e.dashArray&&(this.bezierCurve(t.datavisualization.Diagram.Point(n,i-u),new t.datavisualization.Diagram.Point(n+o*r,i-u),new t.datavisualization.Diagram.Point(n+r,i-o*u),new t.datavisualization.Diagram.Point(n+r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n+r,i),new t.datavisualization.Diagram.Point(n+r,i+o*u),new t.datavisualization.Diagram.Point(n+o*r,i+u),new t.datavisualization.Diagram.Point(n,i+u),e),this.bezierCurve(t.datavisualization.Diagram.Point(n,i+u),new t.datavisualization.Diagram.Point(n-o*r,i+u),new t.datavisualization.Diagram.Point(n-r,i+o*u),new t.datavisualization.Diagram.Point(n-r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n-r,i),new t.datavisualization.Diagram.Point(n-r,i-o*u),new t.datavisualization.Diagram.Point(n-o*r,i-u),new t.datavisualization.Diagram.Point(n,i-u),e));s.stroke();s.closePath();f&&f.angle&&s.restore()},i.prototype.circle=function(n,t,i,r,u){var f=this.document.getContext("2d");u&&this.setStyle(u,f);r&&r.angle&&this.rotateContext(r,f);u&&u.dashArray?(f.beginPath(),f.arc(n,t,i,0,2*Math.PI),f.fill(),f.stroke(),f.closePath()):this.ellipse(n,t,i*2,i*2,r,u);r&&r.angle&&f.restore()},i.prototype.arc=function(n,t,i,r,u){var e={angle:r,x:n,y:t},f=this.document.getContext("2d");u&&this.setStyle(u,f);e&&e.angle&&this.rotateContext(e,f);f.beginPath();u&&u.dashArray?f.arc(n,t,i,0,Math.PI):f.arc(n,t,i,0,Math.PI);f.stroke();f.closePath();e&&e.angle&&f.restore()},i.prototype.path=function(n,i,r,u,f,e,o){var h=this.document.getContext("2d"),tt,s,it,g;o&&this.setStyle(o,h);h.beginPath();h.translate(i,r);e&&e.angle&&this.rotateContext(e,h);tt=document.createElementNS("http://www.w3.org/2000/svg","path");tt.setAttribute("d",n);this.document.appendChild(tt);for(var gt=this.getSegments(tt),ri=i,ui=r,et,ot,k,d,st,ht,ct=gt,i=0,r=0,lt=0,ni=ct.length;lt<ni;++lt){s=ct[lt];it=s.command;"x1"in s&&(k=s.x1);"x2"in s&&(st=s.x2);"y1"in s&&(d=s.y1);"y2"in s&&(ht=s.y2);"x"in s&&(i=s.x);"y"in s&&(r=s.y);switch(it){case"M":h.moveTo(i,r);s.x=i;s.y=r;break;case"L":h.lineTo(i,r);s.x=i;s.y=r;break;case"C":h.bezierCurveTo(k,d,st,ht,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;s.x2=st;s.y2=ht;break;case"Q":h.quadraticCurveTo(k,d,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;break;case"A":var w=new t.datavisualization.Diagram.Point(et,ot),c=s.r1,l=s.r2,v=s.angle*(Math.PI/180),ti=s.largeArcFlag,rt=s.sweepFlag,b=new t.datavisualization.Diagram.Point(i,r),a=new t.datavisualization.Diagram.Point(Math.cos(v)*(w.x-b.x)/2+Math.sin(v)*(w.y-b.y)/2,-Math.sin(v)*(w.x-b.x)/2+Math.cos(v)*(w.y-b.y)/2),at=Math.pow(a.x,2)/Math.pow(c,2)+Math.pow(a.y,2)/Math.pow(l,2);at>1&&(c*=Math.sqrt(at),l*=Math.sqrt(at));g=(ti==rt?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(l,2)-Math.pow(c,2)*Math.pow(a.y,2)-Math.pow(l,2)*Math.pow(a.x,2))/(Math.pow(c,2)*Math.pow(a.y,2)+Math.pow(l,2)*Math.pow(a.x,2)));isNaN(g)&&(g=0);var y=new t.datavisualization.Diagram.Point(g*c*a.y/l,g*-l*a.x/c),p=new t.datavisualization.Diagram.Point((w.x+b.x)/2+Math.cos(v)*y.x-Math.sin(v)*y.y,(w.y+b.y)/2+Math.sin(v)*y.x+Math.cos(v)*y.y),pt=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))},ut=function(n,t){return(n[0]*t[0]+n[1]*t[1])/(pt(n)*pt(t))},wt=function(n,t){return(n[0]*t[1]<n[1]*t[0]?-1:1)*Math.acos(ut(n,t))},ft=wt([1,0],[(a.x-y.x)/c,(a.y-y.y)/l]),vt=[(a.x-y.x)/c,(a.y-y.y)/l],yt=[(-a.x-y.x)/c,(-a.y-y.y)/l],nt=wt(vt,yt);ut(vt,yt)<=-1&&(nt=Math.PI);ut(vt,yt)>=1&&(nt=0);var ii=1-rt?1:-1,bt=ft+ii*(nt/2),fi=new t.datavisualization.Diagram.Point(p.x+c*Math.cos(bt),p.y+l*Math.sin(bt));if(s.centp=p,s.xAxisRotation=v,s.rx=c,s.ry=l,s.a1=ft,s.ad=nt,s.sweepFlag=rt,h!=null){var ut=c>l?c:l,kt=c>l?1:c/l,dt=c>l?l/c:1;h.save();h.translate(p.x,p.y);h.rotate(v);h.scale(kt,dt);h.arc(0,0,ut,ft,ft+nt,1-rt);h.scale(1/kt,1/dt);h.rotate(-v);h.translate(-p.x,-p.y);h.restore()}break;case"Z":h.closePath();i=et;r=ot}(it==="M"||it==="m")&&(et=i,ot=r)}h.fill();o&&o.dashArray?this.drawDashedPath(ct,o):h.stroke();h.translate(-i,-r);e&&e.angle&&h.restore()},i.prototype.getSegments=function(i){for(var r,a,c,l,k,u,f,e,v,y,p,w,d=i.pathSegList,o=[],s=0,h=0,b=0,g=d.numberOfItems;b<g;++b){r=d.getItem(b);a=r.pathSegTypeAsLetter;"x1"in r&&(v=r.x1);"x2"in r&&(p=r.x2);"y1"in r&&(y=r.y1);"y2"in r&&(w=r.y2);"x"in r&&(s=r.x);"y"in r&&(h=r.y);switch(a){case"M":o.push({command:"M",x:s,y:h});break;case"L":o.push({command:"L",x0:f,y0:e,x:s,y:h});break;case"H":o.push({command:"L",x0:f,y0:e,x:s,y:e});break;case"V":o.push({command:"L",x0:f,y0:e,x:f,y:h});break;case"C":o.push({command:"C",x0:f,y0:e,x1:v,y1:y,x2:p,y2:w,x:s,y:h});break;case"S":u&&(c=u.command=="C"||u.command=="S"?{x:u.x2,y:u.y2}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*f-c.x,2*e-c.y),o.push({command:"C",x0:f,y0:e,x1:l.x,y1:l.y,x2:p,y2:w,x:s,y:h}));break;case"Q":o.push({command:"Q",x0:f,y0:e,x1:v,y1:y,x:s,y:h});break;case"T":u&&(c=u.command=="Q"?{x:u.x1,y:u.y1}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*f-c.x,2*e-c.y),o.push({command:"Q",x0:f,y0:e,x1:l.x,y1:l.y,x:s,y:h}));break;case"A":k=n.extend(!0,{},r);k.command="A";o.push(k);break;case"Z":o.push({command:"L",x0:s,y0:h,x:f,y:e});s=f;h=e}u=o[o.length-1];(a==="M"||a==="m")&&(f=s,e=h)}return o},i.prototype.drawDashedPath=function(n,i){for(var r,p,u,h,c,v,y,o,s,l,f=0,e=0,a=0,k=n.length;a<k;++a){r=n[a];p=r.command;"x1"in r&&(h=r.x1);"x2"in r&&(v=r.x2);"y1"in r&&(c=r.y1);"y2"in r&&(y=r.y2);"x"in r&&(f=r.x);"y"in r&&(e=r.y);switch(p){case"M":l={x:f,y:e};break;case"L":this.dashedLine(o,s,f,e,i.dashArray);break;case"H":this.dashedLine(o,s,f,s,i.dashArray);break;case"V":this.dashedLine(o,s,o,e,i.dashArray);break;case"C":this.bezierCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(f,e),i);break;case"Q":this.quadraticCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(f,e),i);break;case"A":if(u=this.document.getContext("2d"),u!=null){var d=r.rx>r.ry?r.rx:r.ry,w=r.rx>r.ry?1:r.rx/r.ry,b=r.rx>r.ry?r.ry/r.rx:1;u.save();u.translate(r.centp.x,r.centp.y);u.rotate(r.xAxisRotation);u.scale(w,b);this.dashedArc(d,0,0,r.a1,r.a1+r.ad,1-r.sweepFlag,i.dashArray);u.scale(1/w,1/b);u.rotate(-r.xAxisRotation);u.translate(-r.centp.x,-r.centp.y);u.restore()}break;case"Z":this.dashedLine(f,e,l.x,l.y,i.dashArray);f=o;e=s}o=f;s=e}},i.prototype.calculateCirclePoints=function(n,i,r,u,f,e){var h,o,s,c;for(u=u*180/Math.PI,f=f*180/Math.PI,h=2*Math.PI*n*(Math.abs(u-f)/360)*.7,o=Math.abs(u-f)/h,o=e?o*-1:o,s=0,c=[];s<h;)c.push(t.datavisualization.Diagram.Geometry.transform({x:i,y:r},u+o*s,n)),s++;return c},i.prototype.polygon=function(n,t,i){var u=this.document.getContext("2d"),r;for(u.beginPath(),t&&t.angle&&this.rotateContext(t,u),i&&this.setStyle(i,u),u.moveTo(n[0].x,n[0].y),r=1;r<n.length;r++)u.lineTo(n[r].x,n[r].y);if(u.lineTo(n[0].x,n[0].y),u.fill(),i&&i.dashArray){for(r=1;r<n.length;r++)this.line(n[r-1],n[r],i);this.line(n[r-1],n[0],i)}u.stroke();u.closePath();t&&t.angle&&u.restore()},i.prototype.image=function(n,t,i,r,u,f,e){var o=this.document.getContext("2d");o.beginPath();f&&f.angle&&this.rotateContext(f,o);e&&this.setStyle(e,o);r&&u?o.drawImage(n,t,i,r,u):o.drawImage(n,t,i);o.closePath();f&&f.angle&&o.restore()},i.prototype.text=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();r&&r.angle&&this.rotateContext(r,f);u&&this.setStyle(u,f);f.fillText(n.text,t,i);f.closePath();r&&r.angle&&f.restore()},i.prototype.line=function(n,t,i){var r=this.document.getContext("2d");r.beginPath();i&&this.setStyle(i,r);i&&i.dashArray?this.dashedLine(n.x,n.y,t.x,t.y,i.dashArray):(r.moveTo(n.x,n.y),r.lineTo(t.x,t.y),r.stroke());r.closePath()},i.prototype.polyline=function(n,t){var r=this.document.getContext("2d"),i;for(r.beginPath(),t&&this.setStyle(t,r),i=1;i<n.length;i++)this.line(n[i-1],n[i],t);r.stroke()},i.prototype.bezierCurve=function(n,t,i,r,u){var f=this.document.getContext("2d"),e,c,o,h;if(f.beginPath(),f.moveTo(n.x,n.y),u&&this.setStyle(u,f),u&&u.dashArray){for(e=[],this.flattenCubicBezier(e,n,t,i,r),c=0,o=0;o<u.dashArray.length;o++)c+=Number(u.dashArray[o]);var a=e.length/c,l=!0,s=0;for(o=0;o<a;o++)for(h=0;h<u.dashArray.length;h++)s+=Number(u.dashArray[h]),s<e.length&&(l?f.lineTo(e[s].x,e[s].y):f.moveTo(e[s].x,e[s].y)),l=!l}else f.moveTo(n.x,n.y),f.bezierCurveTo(t.x,t.y,i.x,i.y,r.x,r.y);f.stroke()},i.prototype.quadraticCurve=function(n,t,i,r){var u=this.document.getContext("2d"),f,h,e,s;if(u.beginPath(),u.moveTo(n.x,n.y),r&&this.setStyle(r,u),r&&r.dashArray){for(f=[],this.flattenQuadraticBezier(f,n,t,i),h=0,e=0;e<r.dashArray.length;e++)h+=Number(r.dashArray[e]);var l=f.length/h,c=!0,o=0;for(e=0;e<l;e++)for(s=0;s<r.dashArray.length;s++)o+=Number(r.dashArray[s]),o<f.length&&(c?u.lineTo(f[o].x,f[o].y):u.moveTo(f[o].x,f[o].y)),c=!c}else u.moveTo(n.x,n.y),u.quadraticCurveTo(t.x,t.y,i.x,i.y);u.stroke()},i.prototype.arrow=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();u&&this.setStyle(u,f);t&&t.angle&&this.rotateContext(t,f);f.moveTo(n.x+i.width,n.y+i.height/2);f.lineTo(n.x,n.y);f.lineTo(n.x+i.width,n.y-i.height/2);r||(f.closePath(),f.fill());f.stroke();t&&t.angle&&f.restore()},i.prototype.diamond=function(n,t,i,r){var u=this.document.getContext("2d");u.beginPath();r&&this.setStyle(r,u);t&&t.angle&&this.rotateContext(t,u);u.moveTo(n.x+i.width,n.y);u.lineTo(n.x+i.width/2,n.y+i.height/2);u.lineTo(n.x,n.y);u.lineTo(n.x+i.width/2,n.y-i.height/2);u.stroke();u.fill();u.closePath();t&&t.angle&&u.restore()},i.prototype.dashedLine=function(n,t,i,r,u){var f=this.document.getContext("2d");f.save();var o=i-n,s=r-t,h=Math.sqrt(o*o+s*s),l=Math.atan2(s,o);f.beginPath();f.translate(n,t);f.moveTo(0,0);f.rotate(l);for(var a=u.length,v=0,c=!0,e=0;h>e;)e+=Number(u[v++%a]),e>h&&(e=h),c?f.lineTo(e,0):f.moveTo(e,0),c=!c,f.stroke();f.restore()},i.prototype.dashedRectangle=function(n,t,i,r,u){this.dashedLine(n,t,n+i,t,u);this.dashedLine(n+i,t,n+i,t+r,u);this.dashedLine(n+i,t+r,n,t+r,u);this.dashedLine(n,t+r,n,t,u)},i.prototype.dashedArc=function(n,t,i,r,u,f,e){for(var o,h,l,a=0,s=0;s<e.length;s++)a+=Number(e[s]);o=this.calculateCirclePoints(n,t,i,r,u,f,a);h=this.document.getContext("2d");h.beginPath();var y=o.length/a,v=!0,c=0;for(s=0;s<y;s++)for(l=0;l<e.length;l++)c+=Number(e[l]),c<o.length&&(v?(h.lineTo(o[c].x,o[c].y),h.stroke()):h.moveTo(o[c].x,o[c].y)),v=!v;h.closePath()},i.prototype.absolutePath=function(n){for(var t,o,a,v,s,h,c,l,e=n.pathSegList,r=0,u=0,f=0,y=e.numberOfItems;f<y;++f){if(t=e.getItem(f),o=t.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(o))"x"in t&&(r=t.x),"y"in t&&(u=t.y);else{"x1"in t&&(s=r+t.x1);"x2"in t&&(c=r+t.x2);"y1"in t&&(h=u+t.y1);"y2"in t&&(l=u+t.y2);"x"in t&&(r+=t.x);"y"in t&&(u+=t.y);switch(o){case"m":e.replaceItem(n.createSVGPathSegMovetoAbs(r,u),f);break;case"l":e.replaceItem(n.createSVGPathSegLinetoAbs(r,u),f);break;case"h":e.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(r),f);break;case"v":e.replaceItem(n.createSVGPathSegLinetoVerticalAbs(u),f);break;case"c":e.replaceItem(n.createSVGPathSegCurvetoCubicAbs(r,u,s,h,c,l),f);break;case"s":e.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(r,u,c,l),f);break;case"q":e.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(r,u,s,h),f);break;case"t":e.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(r,u),f);break;case"a":e.replaceItem(n.createSVGPathSegArcAbs(r,u,t.r1,t.r2,t.angle,t.largeArcFlag,t.sweepFlag),f);break;case"z":case"Z":r=a;u=v}}(o==="M"||o==="m")&&(a=r,v=u)}return i.prototype._scalePathData=function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},n},i.prototype.setStyle=function(n,t){n.fill&&(t.fillStyle=n.fill);n.stroke&&(t.strokeStyle=n.stroke);n.font&&(t.font=n.font)},i.prototype.rotateContext=function(n,t){t.save();t.translate(n.x,n.y);t.rotate(n.angle*Math.PI/180);t.translate(-n.x,-n.y)},i.prototype.pathBounds=function(n){for(var i,b,r,v,y,p,w,c,l,u,f,e,o,s=0,h=0,a=0,k=n.length;a<k;++a){i=n[a];b=i.command;a==0&&i.x&&i.y&&(u=e=i.x,f=o=i.y);"x1"in i&&(v=i.x1);"x2"in i&&(p=i.x2);"y1"in i&&(y=i.y1);"y2"in i&&(w=i.y2);"x"in i&&(s=i.x);"y"in i&&(h=i.y);switch(b){case"M":c=s;l=h;case"L":case"H":case"V":s&&(u=Math.min(s,u),e=Math.max(s,e));h&&(f=Math.min(h,f),o=Math.max(h,o));break;case"C":case"S":r=this.getBezierBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(p,w),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Q":case"q":case"T":r=this.getQuadraticBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Z":s=c;h=l}}return{x:u,y:f,width:e-u,height:o-f}},i.prototype.flattenCubicBezier=function(n,i,r,u,f,e){for(var e=1.5,h=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r)+t.datavisualization.Diagram.Geometry.distance(f,u))/e),s=0;s<=h;s++){var o=s/h,c=(1-o)*(1-o)*(1-o)*i.x+3*o*(1-o)*(1-o)*r.x+3*o*o*(1-o)*u.x+o*o*o*f.x,l=(1-o)*(1-o)*(1-o)*i.y+3*o*(1-o)*(1-o)*r.y+3*o*o*(1-o)*u.y+o*o*o*f.y;n.push(new t.datavisualization.Diagram.Point(c,l))}},i.prototype.flattenQuadraticBezier=function(n,i,r,u,f){for(var f=1.5,s=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),o=0;o<=s;o++){var e=o/s,h=(1-e)*(1-e)*i.x+2*e*(1-e)*r.x+e*e*u.x,c=(1-e)*(1-e)*i.y+2*e*(1-e)*r.y+e*e*u.y;n.push(new t.datavisualization.Diagram.Point(h,c))}},i.prototype.getBezierBounds=function(n,i,r,u,f){for(var f=3,o,s,h,c,y=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),l=0;l<=y;l++){var e=l/y,a=(1-e)*(1-e)*(1-e)*n.x+3*e*(1-e)*(1-e)*i.x+3*e*e*(1-e)*r.x+e*e*e*u.x,v=(1-e)*(1-e)*(1-e)*n.y+3*e*(1-e)*(1-e)*i.y+3*e*e*(1-e)*r.y+e*e*e*u.y;l==0?(o=h=a,s=c=v):(o=Math.min(a,o),s=Math.min(v,s),h=Math.max(a,h),c=Math.max(v,c))}return{x:o,y:s,width:h-o,height:c-s}},i.prototype.getQuadraticBounds=function(n,i,r,u){for(var u=3,e,o,s,h,v=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i))/u),c=0;c<=v;c++){var f=c/v,l=(1-f)*(1-f)*n.x+2*f*(1-f)*i.x+f*f*r.x,a=(1-f)*(1-f)*n.y+2*f*(1-f)*i.y+f*f*r.y;c==0?(e=s=l,o=h=a):(e=Math.min(l,e),o=Math.min(a,o),s=Math.max(l,s),h=Math.max(a,h))}return{x:e,y:o,width:s-e,height:h-o}},i}();t.datavisualization.Diagram.Canvas=i;t.datavisualization.Diagram.CanvasContext={_renderDocument:function(n,i){var r={id:n.canvas.id+"_canvas",width:i._canvas.clientWidth,height:i._canvas.clientHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:n.style,"pointer-events":"none"};n._canvas=new t.datavisualization.Diagram.Canvas(r);i._view=n.canvas;n.canvas.appendChild(n._canvas.document);n.type=="mainview"&&(this._canvas=n.canvas,i._svg=this._svg=n._canvas)},_renderGroupBackground:function(n,t){var i,r,u,f,e,o;n.pivot||(n.pivot={},n.pivot.x=.5,n.pivot.y=.5);i=t.document.getContext("2d");n.visible&&(r={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY},i.save(),i.translate(r.x,r.y),i.rotate(r.angle*Math.PI/180),i.translate(-r.x,-r.y),i.save(),i.fillStyle=n.fillColor,i.strokeStyle=n.borderColor,i.lineWidth=n.borderWidth,n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?u=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?u=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(u=n.borderDashArray.split(" ")),i.setLineDash?i.setLineDash(u):i.mozDash?i.mozDash=u:f={dashArray:u}));e=n.offsetX-n.width*n.pivot.x;o=n.offsetY-n.height*n.pivot.y;t.rect(e,o,n.width,n.height,null,f)},renderGroup:function(n,t,i){var u,r;if(n.visible)for(this._renderGroupBackground(n,t,i),u=0;u<n.children.length;u++)r=i.nameTable[n.children[u]],r.isGroup?this.renderGroup(r,t,i):r.shape?this.renderNode(r,t):r.line&&this.renderConnector(r,t)},renderNode:function(n,i){var r=i.document.getContext("2d"),o,s,e,u,f,l,c,h;if(n.visible){if(o={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY},r.save(),r.translate(o.x,o.y),r.rotate(o.angle*Math.PI/180),r.translate(-o.x,-o.y),r.save(),r.fillStyle=n.fillColor,r.strokeStyle=n.borderColor,r.lineWidth=n.borderWidth,n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?s=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?s=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(s=n.borderDashArray.split(" ")),r.setLineDash?r.setLineDash(s):r.mozDash?r.mozDash=s:e={dashArray:s}),u=n.offsetX-n.width*n.pivot.x,f=n.offsetY-n.height*n.pivot.y,this._renderGradient(n,r,u,f),l=n.fillColor,n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){r.save();r.strokeStyle="lightgrey";r.fillStyle=l!="none"||l!="transparent"?"lightgrey":"none";switch(n.shape.type){case"image":case"rectangle":i.rect(u+5,f+5,n.width,n.height,null);break;case"ellipse":i.ellipse(n.offsetX+5,n.offsetY+5,n.width,n.height,null);break;case"path":i.path(n._absolutePath,u+5,f+5,n.width,n.height,null);break;case"polygon":this._updatePolygonPoints(n);r.translate(5,5);i.polygon(n.shape.points,null,e)}r.restore()}switch(n.shape.type){case"rectangle":i.rect(u,f,n.width,n.height,null,e);break;case"ellipse":i.ellipse(n.offsetX,n.offsetY,n.width/2,n.height/2,null,e);break;case"path":i.path(n._absolutePath,u,f,n.width,n.height,null,e);break;case"image":i.rect(u,f,n.width,n.height,null,e);c=new Image;c.src=n.shape.src;c.onload=function(){var t={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY};i.image(c,u,f,n.width,n.height,t)};break;case"text":i.rect(u,f,n.width,n.height,null,e);n.shape.textBlock&&(h="",n.shape.textBlock.italic&&(h+="italic "),n.shape.textBlock.bold&&(h+="bold "),h+=n.shape.textBlock.fontSize+" ",h+=n.shape.textBlock.fontFamily,r.font=h,r.fillStyle=n.shape.textBlock.fontColor,this._renderTextElement(n,n.shape.textBlock,i));break;case"polygon":this._updatePolygonPoints(n);i.polygon(n.shape.points,null,e)}r.restore();this.renderLabels(n,i);this.renderPorts(n,i,u,f);r.restore()}},renderConnector:function(n,t){var i,r,u;n.visible&&(i=t.document.getContext("2d"),i.save(),i.strokeStyle=n.lineColor,i.lineWidth=n.lineWidth,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?r=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?r=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(r=n.lineDashArray.split(" ")),i.setLineDash?i.setLineDash(r):i.mozDash?i.mozDash=r:u={dashArray:r}),n.segments&&this._renderSegments(n,t,u),i.restore(),this.renderLabels(n,t),this._renderDecorators(n,t))},_renderSegments:function(n,i,r){for(var f,e,o,s,u,a,p,y,h,v,c,l=0;l<n.segments.length;l++){if(f=n.segments[l],f._bridges.length>0)for(h=0;h<f._bridges.length;h++)v=f._bridges[h],v._rendered=!1;if(f.type=="bezier")i.bezierCurve(f.sourcePoint,f._point1,f._point2,f.point3,r);else if(n.cornerRadius>0){for(e=f.points,u=0;u<e.length-1;u++)if(f._bridges.length>0&&u>0&&this._updateBridging(f,i,u,o?o:e[u],s?s:e[u+1],n.bridgeSpace,r,!0),a=t.datavisualization.Diagram.Geometry.distance(e[u],e[u+1]),a>0&&(p=s,s=l<n.segments.length-1||u<e.length-2?a<n.cornerRadius*2?this._adjustPoint(e[u],e[u+1],!1,a/2):this._adjustPoint(e[u],e[u+1],!1,n.cornerRadius):e[u+1],(l>0||u>0)&&(a<n.cornerRadius*2?(o=this._adjustPoint(e[u],e[u+1],!0,a/2),(l<n.segments.length-1||u<e.length-2)&&(s=null)):o=this._adjustPoint(e[u],e[u+1],!0,n.cornerRadius)),o?i.quadraticCurve(p,e[u],o,r):o=e[u],s))if(u+1===e.length-1&&f._bridges.length>0){for(this._updateBridging(f,i,u+1,o?o:e[u],s?s:e[u+1],n.bridgeSpace,r,!0),y=!1,h=0;h<f._bridges.length;h++)v=f._bridges[h],v.segmentPointIndex===u+1&&(y=!0);y||i.line(o,s,r)}else f._bridges.length>0||i.line(o,s,r)}else for(c=1;c<f.points.length;c++)f._bridges.length>0?this._updateBridging(f,i,c,f.points[c-1],f.points[c],n.bridgeSpace,r):i.line(f.points[c-1],f.points[c],r)}},_updateBridging:function(n,t,i,r,u,f,e,o){var c,v=this._findAngle(r,u),h,s,l,a;if(n._bridges.length>0)if(n.type==="straight")for(h=0;h<n._bridges.length;h++)s=n._bridges[h],s._rendered||(c=n._bridges[h-1]!=null?n._bridges[h-1].endPoint:r,t.line(c,s.startPoint,e),l=s.startPoint.x+(s.endPoint.x-s.startPoint.x)/2,a=s.startPoint.y+(s.endPoint.y-s.startPoint.y)/2,t.arc(l,a,f/2,v,e),n._bridges[h+1]!=null?t.line(s.endPoint,n._bridges[h+1].startPoint,e):t.line(s.endPoint,u,e),s._rendered=!0);else if(n.type==="orthogonal")for(h=0;h<n._bridges.length;h++)s=n._bridges[h],s.segmentPointIndex!==i||s._rendered?o||t.line(r,u,e):(c=n._bridges[h-1]!=null?n._bridges[h-1].endPoint:r,t.line(c,s.startPoint,e),l=s.startPoint.x+(s.endPoint.x-s.startPoint.x)/2,a=s.startPoint.y+(s.endPoint.y-s.startPoint.y)/2,t.arc(l,a,f/2,v,e),n._bridges[h+1]!=null?t.line(s.endPoint,n._bridges[h+1].startPoint,e):t.line(s.endPoint,u,e),s._rendered=!0)},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},renderLabels:function(n,i){for(var f=0;f<n.labels.length;f++){var r=n.labels[f],o=t.datavisualization.Diagram.Util.bounds(n),s=t.datavisualization.Diagram.Util._getLabelPosition(r,o),e=i.document.getContext("2d"),u="";r.italic&&(u+="italic ");r.bold&&(u+="bold ");u+=r.fontSize+" ";u+=r.fontFamily;e.font=u;e.fillStyle=r.fontColor;this._renderTextElement(n,r,i)}},renderPorts:function(n,i,r,u){for(var f,e,s,c,l,o=i.document.getContext("2d"),h=0;h<n.ports.length;h++)if(f=n.ports[h],!(f.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||f.visibility&t.datavisualization.Diagram.PortVisibility.Hover||f.visibility&t.datavisualization.Diagram.PortVisibility.Connect)){e=t.datavisualization.Diagram.Util._getPortPosition(f,n.bounds());o.fillStyle=f.fillColor;o.strokeStyle=f.borderColor;o.lineWidth=f.borderWidth;switch(f.shape){case"x":s=new t.datavisualization.Diagram.Size(f.size,f.size);o.beginPath();o.moveTo(e.x-s/2,e.y-s/2);o.lineTo(e.x+s/2,e.y+s/2);o.moveTo(e.x+s/2,e.y-s/2);o.lineTo(e.x-s/2,e.y+s/2);o.stroke();o.fill();o.closePath();break;case"circle":c=s.width/2;l=s.height/2;i.ellipse(r+e.x,u+e.y,c,l);break;case"square":i.rect(e.x-f.size/2,e.y-f.size/2,f.size,f.size)}}},_renderTextElement:function(n,t,i){if(t){var r={childNodes:[]};this._wrapText(n,r,t,i);this._alignTextOnLabel(t,n,r,i)}},_alignTextOnLabel:function(n,i,r,u){var o={width:n.width,height:r.childNodes.length*n.fontSize},h=t.datavisualization.Diagram.Util.bounds(i),f=t.datavisualization.Diagram.Util._getLabelPosition(n,h),e={x:0,y:0},l=0,s;l=n.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?f.y:n.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Center?f.y-o.height/2:f.y-o.height;e.y=l;switch(n.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(n.textAlign){case t.datavisualization.Diagram.TextAlign.Left:e.x=f.x;break;case t.datavisualization.Diagram.TextAlign.Center:e.x=f.x+o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:e.x=f.x+o.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(n.textAlign){case t.datavisualization.Diagram.TextAlign.Left:e.x=f.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:e.x=f.x;break;case t.datavisualization.Diagram.TextAlign.Right:e.x=f.x+o.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(n.textAlign){case t.datavisualization.Diagram.TextAlign.Left:e.x=f.x-o.width;break;case t.datavisualization.Diagram.TextAlign.Center:e.x=f.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:e.x=f.x}}for(s=0;s<r.childNodes.length;s++){var c=r.childNodes[s],a=h.x+e.x+c.x,v=h.y+e.y+3*n.fontSize/4+c.dy*s;u.text({text:c.text},a,v)}},_wrapText:function(n,i,r,u){var y=r.text,c=t.datavisualization.Diagram.Util.bounds(n),h,a,e;n.line?(h=c.width,a=c.height):(h=c.width-r.margin.left-r.margin.right,a=c.height-r.margin.top-r.margin.bottom);h=h<r.width?r.width:h;for(var s=y.split("\n"),p,l,o,v=u.document.getContext("2d"),f=0;f<s.length;f++)for(e="",o=0;o<s[f].length;o++)l=v.measureText(e).width,r.wrapText?l>=h-r.fontSize?(e+=s[f][o],p=-l,o==s[f].length-1||(i.childNodes[i.childNodes.length]={text:e},e="")):(e+=s[f][o],o==s[f].length-1&&(i.childNodes[i.childNodes.length]={text:e},e="")):e+=s[f][o];this._wrapTextAlign(i,i.childNodes,r.fontSize,r.textAlign,v)},_wrapTextAlign:function(n,t,i,r,u){for(var f,e=0;e<t.length;e++){f=u.measureText(t[e].text).width;switch(r){case"left":f=0;break;case"center":f=-f/2;break;case"right":f=-f}t[e].x=Number(f);t[e].dy=i}},_renderGradient:function(n,t,i,r){var e,u,f;if(n.gradient){if(n.gradient.type=="linear")for(e=t.createLinearGradient(i+n.gradient.x1,r+n.gradient.y1,i+n.gradient.x2,r+n.gradient.y2),u=0;u<n.gradient.stops.length;u++)f=n.gradient.stops[u],e.addColorStop(Math.min(1,Math.max(0,f.offset/100)),f.color);else if(n.gradient.type=="radial")for(e=t.createRadialGradient(i+n.gradient.cx,r+n.gradient.cy,0,i+n.gradient.fx,r+n.gradient.fy,n.gradient.r),u=0;u<n.gradient.stops.length;u++)f=n.gradient.stops[u],e.addColorStop(Math.min(1,Math.max(0,f.offset/100)),f.color);t.fillStyle=e}},_renderDecorators:function(n,t){var r,u,i;n.targetDecorator&&n.targetDecorator.shape&&(i=n.segments[n.segments.length-1],r=i.points[i.points.length-2],u=n.targetPoint,i.type=="bezier"&&(r=i._point2),this._renderDecorator(n.name+"_targetDecorator",u,r,n.targetDecorator,t));n.sourceDecorator&&n.sourceDecorator.shape&&(i=n.segments[0],r=n.sourcePoint,u=i.points[1],i.type=="bezier"&&(u=i._point1),this._renderDecorator(n.name+"_sourceDecorator",r,u,n.sourceDecorator,t))},_renderDecorator:function(n,i,r,u,f){var a,e=new t.datavisualization.Diagram.Size(u.width,u.height),s=f.document.getContext("2d"),h,o,c,l;s.fillStyle=u.fillColor;s.strokeStyle=u.borderColor;h=t.datavisualization.Diagram.Geometry.findAngle(i,r);o={angle:h,x:i.x,y:i.y};switch(u.shape){case"arrow":f.arrow(i,o,e);break;case"openarrow":f.arrow(i,o,e,!0);break;case"circle":c=e.width/2;l=e.height/2;f.ellipse(i.x+e.width/2,i.y,c,l,o);break;case"diamond":f.diamond(i,o,e);break;case"path":f.path(u.pathData,i.x,i.y,e.width,e.height,o)}return a},_updatePolygonPoints:function(n){var i,r,f,e;if(n.shape.points&&(i=n.shape.points,i.length)){this._scalePoints(i,n);var u=t.datavisualization.Diagram.Geometry.rect(i),o=n.offsetX-n.width/2-u.x,s=n.offsetY-n.height/2-u.y;for(r=0,f=i.length;r<f;++r)e=t.datavisualization.Diagram.Geometry.translate(i[r],o,s),i[r]=e}},_scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(n),f,e,r,o;if(u.width>0&&u.height>0)for(f=i.width/u.width,e=i.height/u.height,r=0,o=n.length;r<o;++r)n[r].x=n[r].x*f,n[r].y=n[r].y*e},updateNode:function(n,t){this.refreshCanvas(n,t)},updateConnector:function(n,t){this.refreshCanvas(n,t)},updateGroup:function(n,t){this.refreshCanvas(n,t)},refreshCanvas:function(n,t){var r=t.document.getContext("2d"),u,i;for(r.save(),view.scale&&r.scale(1/view.scale.x,1/view.scale.y),u={x:t.document.offsetLeft,y:t.document.offsetTop,width:t.document.offsetWidth,height:t.document.offsetHeight},r.clearRect(u.x,u.y,u.width,u.height),view.scale&&r.scale(view.scale.x,view.scale.y),r.restore(),i=0;i<n.nodes.length;i++)n.nodes[i].shape?this.renderNode(n.nodes[i],t):n.nodes[i].isGroup&&this.renderGroup(n.nodes[i],t);for(i=0;i<n.connectors.length;i++)this.renderConnector(n.connectors[i],t)},updateViewport:function(){},addNodeLabel:function(n,t){this.refreshCanvas(n,t)},updateLabel:function(n,t){this.refreshCanvas(n,t)},setNodeShape:function(n,t){this.refreshCanvas(n,t)},setLine:function(n,t){this.refreshCanvas(n,t)},renderDecorators:function(n,t){this.refreshCanvas(n,t)},clearDecorators:function(n,t){this.refreshCanvas(n,t)},updateTargetDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},updateSourceDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},_updateNodeStyle:function(n,t){this.refreshCanvas(n,t)},updateLabelStyle:function(n,t){this.refreshCanvas(n,t)},updateConnectorStyle:function(n,t){this.refreshCanvas(n,t)},updateTextBlock:function(n,t,i){this.refreshCanvas(n,i)},removeChild:function(){}}}(jQuery,Syncfusion)})