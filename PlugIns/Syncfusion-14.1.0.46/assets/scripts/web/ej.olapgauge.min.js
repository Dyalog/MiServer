/*!
*  filename: ej.olapgauge.min.js
*  version : 14.1.0.46
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./ej.waitingpopup.min","./ej.olapgauge.min","./../datavisualization/ej.circulargauge.min"],n):n()})(function(){(function(n,t,i){t.widget("ejOlapGauge","ej.olap.OlapGauge",{_rootCSS:"e-olapgauge",element:null,model:null,validTags:["div","span"],defaults:n.extend({},t.datavisualization.CircularGauge.prototype.defaults,{url:"",cssClass:"",rowsCount:0,columnsCount:0,enableTooltip:!1,isResponsive:!1,labelFormatSettings:{numberFormat:"default",decimalPlaces:5,prefixText:"",suffixText:""},showHeaderLabel:!0,scales:t.datavisualization.CircularGauge.prototype._defaultScaleValues(),customObject:{},locale:"en-US",serviceMethodSettings:{initialize:"InitializeGauge"},renderSuccess:null,renderComplete:null,renderFailure:null,beforeServiceInvoke:null,afterServiceInvoke:null,load:null}),dataTypes:{serviceMethodSettings:"data",customObject:"data",scales:"data"},observables:["rowsCount","columnsCount","showHeaderLabel","locale","radius","frameType"],rowsCount:t.util.valueFunction("rowsCount"),columnsCount:t.util.valueFunction("columnsCount"),showHeaderLabel:t.util.valueFunction("showHeaderLabel"),locale:t.util.valueFunction("locale"),radius:t.util.valueFunction("radius"),frameType:t.util.valueFunction("frameType"),getOlapReport:function(){return this._olapReport},setOlapReport:function(n){this._olapReport=n},getJSONRecords:function(){return this._JSONRecords},setJSONRecords:function(t){this._JSONRecords=n.parseJSON(t)},_init:function(){this.model=n.extend(t.datavisualization.CircularGauge.prototype.defaults,this.model);this._scalesInitialize();this._initPrivateProperties();this._load()},_scalesInitialize:function(){this.model.scales!=null?n.each(this.model.scales,t.proxy(function(i,r){var u=t.datavisualization.CircularGauge.prototype._defaultScaleValues();n.extend(u,r);n.extend(r,u)},this)):this.model.scales=[t.datavisualization.CircularGauge.prototype._defaultScaleValues()]},_destroy:function(){this._unWireEvents();this.element.empty().removeClass("e-olapgauge"+this.model.cssClass);this._ogaugeWaitingPopup!=i&&this._ogaugeWaitingPopup._destroy()},_initPrivateProperties:function(){this._id=this.element.attr("id");this._olapReport="";this._JSONRecords=null;this._maximum=[];this._maxValue=0;this._pointerValue_0=0;this._pointerValue_1=0;this._currentLayout="";this._defaultArea=0;this._defaultWidth=0;this._gaugeObj={};this._ogaugeWaitingPopup=null;this._ogaugeProgressBar=null;this._ogaugeProgressText=null;this._notationStr=null;this._ogaugeTimer=null},_load:function(){this.element.addClass(this.model.cssClass);n("#"+this._id).ejWaitingPopup({showOnInit:!0});this._ogaugeWaitingPopup=n("#"+this._id).data("ejWaitingPopup");this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{element:this.element,customObject:this.model.customObject});var t=JSON.stringify(this.model.customObject);this.model.customObject!=null&&this.model.customObject!=i&&this.model.customObject!={}?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGauge",customObject:t}),this._renderControlSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGauge"}),this._renderControlSuccess)},_setFirst:!0,_setModel:function(n){for(var t in n)switch(t){case"OlapReport":this.setOlapReport(n[t]);break;case"JsonData":this.setOlapReport(n[t]);break;case"RefreshOlapGauge":this.element.renderControlFromJSON(n[t]);break;case"customObject":this.model.customObject=n[t];break;case"locale":this.locale();break;case"rowsCount":this.rowsCount();break;case"columnsCount":this.columnsCount();break;case"showHeaderLabel":this.showHeaderLabel();break;case"locale":this.locale();break;case"radius":this.radius();break;case"frameType":this.frameType()}this._gaugeObj.obj0&&this._renderControlSuccess({PivotRecords:JSON.stringify(this.getJSONRecords()),OlapReport:this.getOlapReport()})},_wireEvents:function(){this.model.enableTooltip&&this.element.find("canvas").mouseenter(t.proxy(function(n){this._showTooltip(n)},this)).mouseout(t.proxy(function(){n(this._tooltip).fadeOut("slow")},this)).mousemove(t.proxy(function(n){this._showTooltip(n);this._hideTooltip()},this))},_getLocalizedLabels:function(n){return t.olap.OlapGauge.Locale[this.locale()][n]===i?t.olap.OlapGauge.Locale["en-US"][n]:t.olap.OlapGauge.Locale[this.locale()][n]},_unWireEvents:function(){},_showTooltip:function(r){var f,e,o,l;n(this._tooltip).remove();var c=r.target.parentNode.id.split("_")==""?r.target.parentNode.parentNode.id.split("_"):r.target.parentNode.id.split("_"),u=c[c.length-1],s=this._numberFormatConversion(this._JSONRecords[u].GoalValue||0,this.model.labelFormatSettings.numberFormat,this.model.labelFormatSettings.decimalPlaces),h=this._numberFormatConversion(this._JSONRecords[u].MeasureValue||this._JSONRecords[u].Value,this.model.labelFormatSettings.numberFormat,this.model.labelFormatSettings.decimalPlaces),a=this._setMaxScaleValue(this._JSONRecords[u].GoalValue||0,this._JSONRecords[u].MeasureValue||this._JSONRecords[u].Value,u);if(this.model.labelFormatSettings.numberFormat==t.olap.OlapGauge.NumberFormat.Notation){for(f=this._JSONRecords[u].GoalValue||0,e=this._JSONRecords[u].MeasureValue||this._JSONRecords[u].Value;f>=10;)f=parseInt(f)/10;while(e>=10)e=parseInt(e)/10;s=f.toFixed(1)+s;h=e.toFixed(1)+h}o=this._JSONRecords[u].MemberName||this._JSONRecords[u].Measure;(o==i||o=="undefined")&&(o=this._JSONRecords[u].MeasureCaption);l=o+"<br/>"+this._getLocalizedLabels("RevenueGoal")+": "+s+"<br/>"+this._getLocalizedLabels("RevenueValue")+": "+h;this._tooltip=t.buildTag("div.e-olapgauge-tooltip",l);n(this._tooltip).appendTo("body");n(this._tooltip).addClass(".e-olapgauge-active");this._changeTooltipPos(r)},_changeTooltipPos:function(t){var i=t.pageX-8,r=t.pageY+8;n(this._tooltip).css({top:r,left:i})},_hideTooltip:function(){window.setTimeout(t.proxy(function(){n(this._tooltip).fadeOut(1500,"linear")},this),3e3)},_renderControlSuccess:function(n){var u,f,h,c,a;try{var r="",e="",o="",l="",s=0;if(n[0]!=i&&n.length>0?(this.setJSONRecords(n[0].Value),this.setOlapReport(n[1].Value),n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value)):n.d!=i&&n.d.length>0?(this.setJSONRecords(n.d[0].Value),this.setOlapReport(n.d[1].Value),n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value)):n.PivotRecords&&n.OlapReport&&(this.setJSONRecords(n.PivotRecords),this.setOlapReport(n.OlapReport),n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject)),this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{element:this.element,customObject:this.model.customObject}),u=this.getJSONRecords(),u!=null&&u.length>0){if(this.rowsCount()<1&&this.columnsCount()<1){for(this._currentLayout="WrapPanel",f=0;f<u.length;f++)e=t.buildTag("img#statusIndicator_"+f+".kpiiconvalue")[0].outerHTML,o=t.buildTag("img#trendIndicator_"+f+".kpiiconvalue")[0].outerHTML,l+=t.buildTag("li",t.buildTag("div#"+this._id+"_"+f,e+o)[0].outerHTML)[0].outerHTML;r=t.buildTag("ul.wrapLayout",l)[0].outerHTML}else{for(this._currentLayout="Table",(this.columnsCount()==i||this.columnsCount()<1)&&this.columnsCount((u.length/this.rowsCount()).toFixed()),(this.rowsCount()==i||this.rowsCount()<1)&&this.rowsCount((u.length/this.columnsCount()).toFixed()),r="<table><tbody>",h=0;h<this.rowsCount();h++){for(r+="<tr>",c=0;c<this.columnsCount();c++)e=t.buildTag("img#statusIndicator_"+s+".kpiiconvalue")[0].outerHTML,o=t.buildTag("img#trendIndicator_"+s+".kpiiconvalue")[0].outerHTML,r+="<td>"+t.buildTag("div#"+this._id+"_"+s,e+o)[0].outerHTML+"<\/td>",s++;r+="<\/tr>"}r+="<\/tbody><\/table>"}this.element.html(r);this.renderControlFromJSON(u);this._defaultWidth=this.element.find("canvas").width();this._defaultArea=this.element.find("table").height()*this.element.find("table").width()}this._ogaugeWaitingPopup.hide();a={element:this.element,customObject:this.model.customObject};this._trigger("renderSuccess",a)}catch(v){}},doAjaxPost:function(i,r,u,f){n.ajax({type:i,url:r,contentType:"application/json; charset=utf-8",dataType:"json",data:u,success:n.proxy(f,this),complete:t.proxy(function(){var n={element:this.element,customObject:this.model.customObject};this._trigger("renderComplete",n)},this),error:t.proxy(function(n){this._ogaugeWaitingPopup.hide();var t={element:this.element,customObject:this.model.customObject,Message:n};this._trigger("renderFailure",t)},this)})},_getCalculatedValue:function(n){var t=n.toString(),r=1,f,i,u;for(f=t.indexOf(".")>-1?t.split(".")[0].length:t.length,i=parseInt(t),u=0;u<f;u++)i>this._maxValue&&(i=i/10,r=r*10);return r},_findNearestUpperLimit:function(n,t){var r=n.toString(),i=parseInt(r),u=i%t;return i+(t-u)},_setMaxScaleValue:function(n,t,i){var r;return t>n?(r=this._getCalculatedValue(t),this._maximum[i]=this._findNearestUpperLimit(t/r,10)):(r=this._getCalculatedValue(n),this._maximum[i]=this._findNearestUpperLimit(n/r*4/3,10)),r},_numberFormatConversion:function(n,i,r){function s(n,t){for(var i=n,r=t;;){if(!(i%=r))return r;if(!(r%=i))return i}}var e,n,r,o,u,f;switch(i){case t.olap.OlapGauge.NumberFormat.Default:return parseFloat(n).toFixed(r);case t.olap.OlapGauge.NumberFormat.Text:return n.toString();case t.olap.OlapGauge.NumberFormat.Currency:return t.format(parseInt(n),"c",this.model.locale);case t.olap.OlapGauge.NumberFormat.Percentage:return n*=100,parseFloat(n).toFixed(2)+"%";case t.olap.OlapGauge.NumberFormat.Fraction:for(n||(n=this),e=String(n).split(".")[0],n=parseFloat("."+String(n).split(".")[1]),n=n.toFixed(4),r="1",z=0;z<String(n).length-2;z++)r+="0";for(n=n*r,r=parseInt(r),z=2;z<n+1;z++)n%z==0&&r%z==0&&(n=n/z,r=r/z,z=2);return n.toString().length==2&&r.toString().length==3?(n=Math.round(Math.round(n)/10),r=Math.round(Math.round(r)/10)):n.toString().length==2&&r.toString().length==2&&(n=Math.round(n/10),r=Math.round(r/10)),o=s(n,r),(e==0?"":e+" ")+n/o+"/"+r/o;case t.olap.OlapGauge.NumberFormat.Scientific:return parseFloat(n).toExponential();case t.olap.OlapGauge.NumberFormat.Notation:for(u=0,f=parseInt(n);f>=1;)f=parseInt(f)/10,u++;return this._notationStr=u==1?"da":u==2?"h":u==3?"k":u==4?"k*da":u==5?"k*h":u==6?"M":u==7?"M*da":u==8?"M*h":u==9?"G":u==10?"G*da":u==11?"G*h":u==12?"T":""}},removeImg:function(){this.element.find("img").remove()},renderControlFromJSON:function(r){var b,u,p,ot,w,st,ht,f;for(this._maxValue=99,maxGaugeCount=0,b=this.radius()/22,this._currentLayout=="Table"&&this.rowsCount()*this.columnsCount()<=r.length?maxGaugeCount=this.rowsCount()*this.columnsCount():(this._currentLayout=="WrapPanel"||this.rowsCount()*this.columnsCount()>r.length)&&(maxGaugeCount=r.length),u=0;u<maxGaugeCount;u++){var h=0,c=0,nt=0,s=0,tt=0,l=0,a=0,k=0,v="",e,it=[],rt=[],d=[],ut=[],ft=[],et=[],g=[],o="",y="";if(r[u].MeasureValue!=null&&r[u].MeasureValue!=i?(c=parseFloat(r[u].MeasureValue)||0,h=parseFloat(r[u].GoalValue)||0,v=this.model.labelFormatSettings.prefixText+" "+r[u].MeasureCaption+(n.trim(r[u].MemberName)?" - ":"")+r[u].MemberName+" "+this.model.labelFormatSettings.suffixText):(c=parseFloat(r[u].Value),h=0,v=r[u].Measure,this.model.scales[0].showIndicators=!1),l=this._setMaxScaleValue(h,c,u),tt=c,a=h/l,k=tt/l,this._pointerValue_0=s+k,this._pointerValue_1=a+s,nt=s,s=s+k,r[u].StatusGraphic=="Traffic Signals"?r[u].StatusValue==-1?o="kpiredroad":r[u].StatusValue==0?o="kpiallcolor":r[u].StatusValue==1&&(o="kpigreenroad"):r[u].StatusValue==-1?o="kpidiamond":r[u].StatusValue==0?o="kpitriangle":r[u].StatusValue==1&&(o="kpicircle"),e=this.element.find("#statusIndicator_"+[u]).addClass(o),e!=null&&e!=i&&(p=n(e).css("background-image"),ot={height:15,width:15,type:"image",imageUrl:!t.isNullOrUndefined(p)&&p!="none"?p.split("(")[1].split(")")[0].replace('"',"").replace('"',""):"",position:{x:this.radius()-20,y:260},location:{x:this.radius()-20,y:260}}),r[u].TrendGraphic!=null&&r[u].TrendGraphic!=i&&r[u].TrendGraphic!=""&&r[u].TrendGraphic.toLowerCase()=="standard arrow"&&(r[u].TrendValue==-1?y="kpidownarrow":r[u].TrendValue==0?y="kpirightarrow":r[u].TrendValue==1&&(y="kpiuparrow"),e=this.element.find("#trendIndicator_"+[u]).toggleClass(y)),t.isNullOrUndefined(e)||(w=n(e).css("background-image"),st={height:15,width:15,type:"image",imageUrl:!t.isNullOrUndefined(w)&&w!="none"?w.split("(")[1].split(")")[0].replace('"',"").replace('"',""):"",position:{x:this.radius(),y:260},location:{x:this.radius(),y:260}}),!t.isNullOrUndefined(this.model.scales[0])){for(this.frameType()=="fullcircle"?(this.model.scales[0].startAngle=122,this.model.scales[0].sweepAngle=296):this.frameType()=="halfcircle"&&(this.model.scales[0].startAngle=180,this.model.scales[0].sweepAngle=180),this.model.scales[0].indicators=this.model.scales[0].showIndicators?[ot,st]:this.model.scales[0].indicators,t.isNullOrUndefined(this.model.scales[0].pointers[0])||(ht=t.datavisualization.CircularGauge.prototype._defaultScaleValues().pointerCap,this.model.scales[0].pointers[0].value=this._pointerValue_0,this.model.scales[0].pointers[0].pointerCap=ht,this.model.scales[0].pointers[0].pointerCap.radius=b),t.isNullOrUndefined(this.model.scales[0].pointers[1])||(this.model.scales[0].pointers[1].value=this._pointerValue_1,this.model.scales[0].pointers[1].type=this.model.scales[0].pointers[1].type||"marker",this.model.scales[0].pointers[1].markerType=this.model.scales[0].pointers[1].markerType||"diamond",this.model.scales[0].pointers[1].placement=this.model.scales[0].pointers[1].placement||"center"),t.isNullOrUndefined(this.model.scales[0].ranges[0])||(this.model.scales[0].ranges[0].startValue=nt,this.model.scales[0].ranges[0].endValue=a),t.isNullOrUndefined(this.model.scales[0].ranges[1])||(this.model.scales[0].ranges[1].startValue=a,this.model.scales[0].ranges[1].endValue=this._maximum[u]),t.isNullOrUndefined(this.model.scales[0].customLabels[0])||(this.model.scales[0].customLabels[0].value=this.showHeaderLabel()?"X "+l:""),t.isNullOrUndefined(this.model.scales[0].customLabels[1])||(this.model.scales[0].customLabels[1].value=this.showHeaderLabel()?v:""),t.isNullOrUndefined(this.model.scales[0].customLabels[2])||(this.model.scales[0].customLabels[2].value=this.showHeaderLabel()?v:""),f=0;f<this.model.scales[0].ranges.length;f++)it.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().ranges[0],this.model.scales[0].ranges[f]));for(f=0;f<this.model.scales[0].pointers.length;f++)rt.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().pointers[0],this.model.scales[0].pointers[f]));for(f=0;f<this.model.scales[0].labels.length;f++)this.model.labelFormatSettings.numberFormat!=t.olap.OlapGauge.NumberFormat.Notation||t.isNullOrUndefined(t.datavisualization.CircularGauge.prototype._defaultScaleValues().labels[0])||(this._numberFormatConversion(this._JSONRecords[u].MeasureValue||this._JSONRecords[u].Value,this.model.labelFormatSettings.numberFormat,this.model.labelFormatSettings.decimalPlaces),this.model.scales[0].labels[f].unitText=this._notationStr),d.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().labels[0],this.model.scales[0].labels[f]));for(f=0;f<this.model.scales[0].labels.length;f++)d.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().labels[0],this.model.scales[0].labels[f]));for(f=0;f<this.model.scales[0].customLabels.length;f++)ut.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().customLabels[0],this.model.scales[0].customLabels[f]));for(f=0;f<this.model.scales[0].ticks.length;f++)ft.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().ticks[0],this.model.scales[0].ticks[f]));if(this.model.scales[0].indicators)for(f=0;f<this.model.scales[0].indicators.length;f++)et.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues().indicators[0],this.model.scales[0].indicators[f]));for(newScale={pointerCap:{radius:b||this.model.scales[0].pointerCap.radius,borderWidth:this.model.scales[0].pointerCap.borderWidth,interiorGradient:this.model.scales[0].pointerCap.interiorGradient,borderColor:this.model.scales[0].pointerCap.borderColor,backgroundColor:this.model.scales[0].pointerCap.backgroundColor},border:{color:this.model.scales[0].border.color,width:this.model.scales[0].border.width},majorIntervalValue:this.model.scales[0].majorIntervalValue,minorIntervalValue:this.model.scales[0].minorIntervalValue,minimum:this.model.scales[0].minimum,backgroundColor:this.model.scales[0].backgroundColor,direction:this.model.scales[0].direction,showPointers:this.model.scales[0].showPointers,showTicks:this.model.scales[0].showTicks,showLabels:this.model.scales[0].showLabels,showIndicators:this.model.scales[0].showIndicators,showRanges:this.model.scales[0].showRanges,showScaleBar:this.model.scales[0].showScaleBar,startAngle:this.model.scales[0].startAngle,sweepAngle:this.model.scales[0].sweepAngle,radius:this.model.scales[0].radius,size:this.model.scales[0].size,maximum:this.model.scales[0].maximum||this._maximum[u],pointers:rt,ticks:ft,labels:d,ranges:it,customLabels:ut,indicators:et},f=0;f<this.model.scales.length;f++)f==0?g.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues(),newScale)):g.push(n.extend({},t.datavisualization.CircularGauge.prototype._defaultScaleValues(),this.model.scales[f]))}n("#"+this._id+"_"+u).ejCircularGauge({backgroundColor:this.model.backgroundColor,frame:{frameType:this.model.frame.frameType,halfCircleFrameStartAngle:this.model.halfCircleFrameStartAngle,halfCircleFrameEndAngle:this.model.halfCircleFrameEndAngle},radius:this.radius(),width:this.model.width,height:this.model.height,interiorGradient:this.model.interiorGradient,readOnly:this.model.readOnly,enableResize:this.model.isResponsive,enableAnimation:!0,animationSpeed:this.model.animationSpeed,theme:this.model.theme,isRadialGradient:this.model.isRadialGradient,load:this.model.load,drawTicks:this.model.drawTicks,drawLabels:this.model.drawLabels,drawPointers:this.model.drawPointers,drawRange:this.model.drawRange,drawCustomLabel:this.model.drawCustomLabel,drawIndicators:this.model.drawIndicators,drawPointerCap:this.model.drawPointerCap,renderComplete:this.model.renderComplete,mouseClick:this.model.mouseClick,mouseClickMove:this.model.mouseClickMove,mouseClickUp:this.model.mouseClickUp,scales:g});this._gaugeObj["obj"+u]=n("#"+this._id+"_"+u).data("ejCircularGauge")}this.removeImg();this._wireEvents()},refresh:function(){if(this._gaugeObj==null||this._gaugeObj==i)for(var t=0;t<this._JSONRecords.length;t++)this._gaugeObj["obj"+t]=n("#"+this._id+"_"+t).data("ejCircularGauge"),this._gaugeObj["obj"+t].refresh();else for(key in this._gaugeObj)this._gaugeObj[key].refresh()}});t.olap.OlapGauge.Locale={};t.olap.OlapGauge.Locale["en-US"]={RevenueGoal:"Revenue Goal",RevenueValue:"Revenue Value"};t.olap.OlapGauge.NumberFormat={Default:"default",Currency:"currency",Percentage:"percentage",Fraction:"fraction",Scientific:"scientific",Text:"text",Notation:"notation"}})(jQuery,Syncfusion)});
