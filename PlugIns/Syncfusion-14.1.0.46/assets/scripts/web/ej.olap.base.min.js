/*!
*  filename: ej.olap.base.min.js
*  version : 14.1.0.46
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function(n,t,i){t.olap=t.olap||{};t.olap.base={_initProperties:function(){this._columnHeaders=[];this._rowHeaders=[];this._valueCells=[];this.pivotEngine=[];this.pivotGridObj=null;this._cBIndx=null;this._rBIndx=null;this._OlapDataSource;this._measureDt={};this._cTotIndexInfo=null;this._rTotIndexInfo=null},_initPivotGridProperties:function(n){n._drilledCellSet=[];n.XMLACellSet=null;this._hierarchyNodes=this._getFieldItemsInfo(n);this._currIndex={};this._isRowDrilled=!1;this._isColDrilled=!1},getJSONData:function(n,t,i){n.action&&n.action=="initialLoad"&&(this._initPivotGridProperties(i),i.model.dataSource=this._applyTrim(i.model.dataSource));this._initProperties();this.pivotGridObj=i;this._OlapDataSource=t;var u="",f=t.data,r;i.model.enableGroupingBar&&i._createGroupingBar(t);u=t.MDXQuery?t.MDXQuery:this._getParsedMDX(t,t.cube);r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+u+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+t.catalog+"<\/Catalog> <\/PropertyList> <\/Properties> <\/Execute> <\/Body> <\/Envelope>";n.action=="drilldown"?this.pivotGridObj.doAjaxPost("POST",f,{XMLA:r},this._onDemandExpand,null,n):this.pivotGridObj.doAjaxPost("POST",f,{XMLA:r},this._generateJSONData,null,n)},_getParsedMDX:function(n,r){if(n!=i){var e="",u,f,o;u=t.olap._mdxParser._getRowMDX(n);f=t.olap._mdxParser._getcolumnMDX(n);u=u.length>0?",NON EMPTY("+u+")\n dimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON ROWS":"";o=t.olap._mdxParser._getSlicerMDX(n);e="\nSelect \nNON EMPTY("+(f==""?"{}":f)+")\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON COLUMNS \n"+u+"\n "+t.olap._mdxParser._getIncludefilterQuery(n,r)+o+"\n CELL PROPERTIES VALUE, FORMAT_STRING, FORMATTED_VALUE \n ";f==""&&e.replace(/NON EMPTY/g," ")}return e},_getAxisElementsUName:function(n){for(var i="",t=0;t<n.length;t++)i+=i==""?"{"+n[t].uniqueName+"}":", {"+n[t].uniqueName+"}";return i},_generateJSONData:function(t,r){var e=[],s=[],o,l,y,a,c,u,f;if(n(r).find("Error").length>0)return this.pivotGridObj._createErrorDialog(n(r).find("faultstring").text(),t.action),!1;if(n(r).find("Axis[name|='SlicerAxis']").remove(),this.pivotGridObj.XMLACellSet=n(r).find("Axes, CellData"),y=[],t=="onDemandDrill"&&(this.pivotGridObj.XMLACellSet=r),o=n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple"),l=n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple"),o.length>0){a=n(this.pivotGridObj.XMLACellSet).find("CellData Cell");this._columnHeaders=this._getHeaderCollection(o,"colheader");this._rowHeaders=this._getHeaderCollection(l,"rowheader");this._valueCells=this._getValueCells(a,o.length);indexRCell=this._measureDt.axis=="rowheader"?n.Enumerable.From(this._rowHeaders.maxLvlLen).Sum()+1:n.Enumerable.From(this._rowHeaders.maxLvlLen).Sum();indexCCell=this._measureDt.axis=="colheader"?n.Enumerable.From(this._columnHeaders.maxLvlLen).Sum()+1:n.Enumerable.From(this._columnHeaders.maxLvlLen).Sum();this._populateEngine(this._rowHeaders.headers,this._columnHeaders.headers,this._valueCells);n(this.pivotGridObj).find(".pivotGridTable").remove();var h=this._rowHeaders.headers.length+indexCCell,v=this._columnHeaders.headers.length+indexRCell,p=[];for(this.pivotEngine.length>1&&(h=this.pivotEngine.length),u=0;u<h;u++)for(f=0;f<v;f++)e[f]==i&&(e[f]=[]),this.pivotEngine[u]!=i&&this.pivotEngine[u][f]!=i?(e[f][u]={Index:f+","+u,CSS:this.pivotEngine[u][f].CSS==""?"none":this.pivotEngine[u][f].CSS==i?"value":this.pivotEngine[u][f].CSS,Value:this.pivotEngine[u][f].Value,State:this.pivotEngine[u][f].ChildCount>0?2:this.pivotEngine[u][f].ChildCount<0?1:0,RowSpan:this.pivotEngine[u][f].RowSpan!=i?this.pivotEngine[u][f].RowSpan:1,ColSpan:this.pivotEngine[u][f].ColSpan!=i?this.pivotEngine[u][f].ColSpan:1,Info:this.pivotEngine[u][f].UName+"::"+this.pivotEngine[u][f].LName+"::"+this.pivotEngine[u][f].Value+"::"+this.pivotEngine[u][f].PUName,Span:"None",Expander:1},p=e[f][u].CSS):this.pivotEngine[u]!=i&&(c="none",u<indexCCell&&f<indexRCell&&(c="rowheader"),e[f][u]={Index:f+","+u,CSS:c,Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0});for(u=0;u<v;u++)for(f=0;f<h;f++)e[u]!=i&&e[u][f]!=i&&s.push(e[u][f])}return this.pivotGridObj._dataModel="XMLA",this.pivotGridObj.setJSONRecords(JSON.stringify(s)),this.pivotGridObj.renderControlFromJSON(s),t.action&&t.action=="initialLoad"&&this.pivotGridObj._trigger("renderSuccess",this.pivotGridObj),this.pivotGridObj._ogridWaitingPopup.hide(),this._columnHeaders=this._rowHeaders=this._valueCells=this.pivotEngine=[],this._cBIndx=this._rBIndx=null,this._measureDt={axis:"",posision:null},this._cTotIndexInfo=this._rTotIndexInfo=null,e},_onDemandExpand:function(t,i){var et=i,f,it,r="",e=this.pivotGridObj.XMLACellSet,b,k,d=n(this.pivotGridObj.XMLACellSet).find("Axis[name='Axis0'] Tuple").length,c=n(this.pivotGridObj.XMLACellSet).find("Axis[name='Axis1'] Tuple").length,y,rt=0,ut=0,h,u,nt,ft,tt;c=c?c:1;rt=n(i).find("CellData Cell").length;ut=n(this.pivotGridObj.XMLACellSet).find("CellData Cell").length;it=t.cellInfo.previousElements.split(">#>");var l=n(i).find("Axis[name|='Axis0'] Tuple"),a=n(i).find("Axis[name|='Axis1'] Tuple"),b=l.length;k=a.length;n(i).find("Axis[name='SlicerAxis']").remove();var g=t.cellInfo.itemPosition,v,p,o=0,s=!1,w="";for(p=t.cellInfo.axis=="rowheader"?a[0]:l[0],r=v=n(p).find("Member:nth-child("+(g+1)+") PARENT_UNIQUE_NAME").text(),h=g+1;h>0;h--)e=n(e).find("Tuple Member:nth-child("+h+") UName:contains('"+v+"')").parents("tuple"),v=n(p).find("Member:nth-child("+(h-1)+") UName").text(),w=v+w;if(r=w+r,y=e.index()+1,r=t.cellInfo.previousElements.split(">#>").join().replace(/,/g,""),f=t.cellInfo.preRepItm.split(">#>").join().replace(/,/g,""),this.pivotGridObj._drilledCellSet&&(o=this.pivotGridObj._drilledCellSet.length),this.pivotGridObj._drilledCellSet[0]&&o)for(u=0;u<o;u++){for(nt=this.pivotGridObj._drilledCellSet[u].length,ft=t.cellInfo.parentUniqueName,cEllen=0;cEllen<nt;cEllen++)if(t.cellInfo.previousElements.startsWith(this.pivotGridObj._drilledCellSet[u][cEllen].key)){this.pivotGridObj._drilledCellSet[u].push({key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)});s=!0;break}else if(this.pivotGridObj._drilledCellSet[u][cEllen].key.startsWith(t.cellInfo.previousElements)){this.pivotGridObj._drilledCellSet[u].splice(cEllen,0,{key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)});s=!0;break}if(s)break}else this.pivotGridObj._drilledCellSet[0]=[],this.pivotGridObj._drilledCellSet[0][0]={key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)},s=!0;s||(this.pivotGridObj._drilledCellSet[o]=[],this.pivotGridObj._drilledCellSet[o].push({key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)}));t.cellInfo.axis=="rowheader"?(tt=n(i).find("Axis[name|='Axis1'] Tuple"),this._insertCellSet("rowheader",e,a,l,k,d,b,y,i)):(tt=n(i).find("Axis[name|='Axis1'] Tuple"),this._insertCellSet("colheader",e,l,a,c,d,b,y,i));this._generateJSONData("onDemandDrill",this.pivotGridObj.XMLACellSet)},_insertCellSet:function(t,i,r,u,f,e,o,s,h){var g=n(n(h).find("CellData Cell")[0]).clone(),a,l,c,v,it;n(g).find("FmtValue").text("");i.length>1?n(i[0]).after(r):n(i).after(r);l=e;t=="rowheader"?a=n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple"):(a=n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple"),l=o);var y=0,nt=n(a).filter(function(t,i){if(u[y]&&n(i).find("UName").text()==n(u[y]).find("UName").text())return y++,!0}),p=0,w=!1;for(c=0;c<f;c++){var tt="",b=0,k=0,d;for(d=t=="rowheader"?(s+c)*l:c*(e+l)+s,v=0;v<l;v++)(t!="rowheader"||n(nt[b]).index()!=v)&&(t!="colheader"||n(nt[p]).index()!=c)&&a.length?n(this.pivotGridObj.XMLACellSet).find("CellData Cell:nth-child("+(d+k)+")").after(n(g).clone()):(it=t=="rowheader"?c*o:p*o,tt=n(n(h).find("CellData Cell")[it+b]).clone(),n(this.pivotGridObj.XMLACellSet).find("CellData Cell:nth-child("+(d+k)+")").after(tt),b++,w=!0),k++;t=="colheader"&&(w&&p++,w=!1)}},_onDemandCollapse:function(t,i){var f,e,o,r,u,s=t.drilledMembers[t.drilledMembers.length-1].cSet;e=n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple");f=n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple");r=n(s).find("Axis[name|='Axis0'] Tuple");u=n(s).find("Axis[name|='Axis1'] Tuple");try{o=i=="rowheader"?u:r;i=="rowheader"?this._removeCellSets(o,f,e,r,u,i):this._removeCellSets(o,e,f,u,r,i);this.pivotGridObj.model.dataSource=this.pivotGridObj._clearCollapsedItems(i,t.drilledMembers[t.drilledMembers.length-1],this.pivotGridObj.model.dataSource);t.drilledMembers=t.drilledMembers.splice(0,t.drilledMembers.length-1)}catch(h){this.pivotGridObj._ogridWaitingPopup.hide()}t.drilledMembers.length?this._onDemandCollapse({drilledMembers:t.drilledMembers},i):t.action||this._generateJSONData("onDemandDrill",this.pivotGridObj.XMLACellSet)},_removeCellSets:function(t,i,r,u,f,e){for(var c,s,v,o,l=t.length,h,y,p=f[0],a=0;a<i.length;a++)if(n(i[a]).find("UName").text()==n(p).find("UName").text()){y=i[a];break}if(c=l,s=n(y).index(),s)if(e=="rowheader"){for(h=r.length;c>0;)n(n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple")[s]).remove(),c--;for(o=ext=s;o<ext+l;o++)v=n(n(this.pivotGridObj.XMLACellSet).find("CellData Cell")).splice(s*h,h),n(v).remove()}else{for(h=i.length;c>0;)n(n(this.pivotGridObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple")[s]).remove(),c--;for(o=0;o<h;o++)v=n(n(this.pivotGridObj.XMLACellSet).find("CellData Cell")).splice(h*o-o*l+s,l),n(v).remove()}},_getDrilledMemeber:function(t){var u=[],e=t.item.itemPosition,f,r,i,o=this.pivotGridObj._drilledCellSet.length;return keyVal=t.item.previousElements.split(">#>").join().replace(/,/g,""),n.grep(this.pivotGridObj._drilledCellSet,function(n,t){for(var u=0;u<n.length;u++)if(n[u].key.startsWith(keyVal))return r=u,i=t,f=n.length,!0}),this.pivotGridObj._drilledCellSet[i]&&(n.merge(u,this.pivotGridObj._drilledCellSet[i].splice(r,f-r)),this.pivotGridObj._drilledCellSet[i].length||this.pivotGridObj._drilledCellSet.splice(i,1)),u},_getHeaderCollection:function(t,r){var f,bt,y=[],ut,ft="",p=[],et=null,ot={},lt,u,e,l,ct,ni,v,yt,k,nt,pt,tt,h,ti,it,kt,ii,dt,d,rt,wt,gt;if(f=n.Enumerable.From(t).Where(function(t,i){var f=n(t).find("Member"),e=n(f[0]).find("LName").text().indexOf("[(All)]")!=-1,s=e?1:0,o=0,u;for(et=null,e?(ut=0,ft="total"):(ft="",ut=f.length),u=1,n(f[0]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1&&(u=0),u;u<f.length;u++)n(f[u]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1?(o=e,ot.axis=r,ot.posision=u,parseInt(n(f[u]).find("MEMBER_TYPE").text())==4&&(n(f[u]).find("UName").text().toLowerCase().indexOf("trend]")!=-1?et="trend":n(f[u]).find("UName").text().toLowerCase().indexOf("status]")!=-1&&(et="status"))):o=n(f[u]).find("LName").text().indexOf("[(All)]")!=-1,(e==!1&&o==!0||e==!0&&o==!1)&&(s++,ut=u,ft="total"),e=o;return bt=i,s<2}).Select(function(t){for(var e,s,f=n(t).find("Member"),o=[],u=0;u<f.length;u++)e=parseInt(n(f[u]).find("LNum").text()),s=n(f[u]).find("PARENT_UNIQUE_NAME").length?n(f[u]).find("PARENT_UNIQUE_NAME").text():"",o.push({CSS:r,Value:n(f[u]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:n(f[u]).attr("Hierarchy"),LName:n(f[u]).find("LName").text(),UName:n(f[u]).find("UName").text(),ChildCount:parseInt(n(f[u]).find("CHILDREN_CARDINALITY").text()),PUName:s,LNum:e,MemberType:parseInt(n(f[u]).find("MEMBER_TYPE").text())}),p[u]==i?p[u]=e:p[u]<e&&(p[u]=e);return y.push({selIndx:bt,totLvl:ut,type:ft,kpi:et}),o}).ToArray(),r=="colheader"?this._cTotIndexInfo=y:this._rTotIndexInfo=y,f={headers:f,indxInfo:y,maxLvlLen:p},n.isEmptyObject(ot)||(this._measureDt=n.extend({},ot)),lt=1,r.indexOf(this._OlapDataSource.values[0].axis.substring(0,3))>-1&&(lt=this._measureDt.measureCount=this._OlapDataSource.values[0].measures.length),!this._OlapDataSource._enableBasicEngine){var s={headers:[],indxInfo:[]},ri=y,c=y.length,st=s.length,ht=[],o=[],at=0,w=[],g=!1;try{for(u=0;u<c;u++){for(at=e==0?o.length:o.length;u<c&&f.indxInfo[u-at].type=="total";)s.indxInfo.push(f.indxInfo.splice(u-at,1)[0]),s.headers.push(f.headers.splice(u,1)[0]),c--,st++;if(u==0&&(s.indxInfo.reverse(),s.headers.reverse()),u+1<c||u+1==c){var b=f.headers[u].length,a=0,vt=0;for(e==b-1&&p[p.length-1]==0&&(b-=1),this._measureDt.posision==b-1&&this._measureDt.axis==r&&(vt=1),e=0;e<b-1-vt;e++){if(l=1,f.headers[u][e+1]!=i&&e+1<b-1&&f.headers[u][e+1].LName.toLowerCase().indexOf("[measures]")!=-1&&(l=2),w[e]==i?w[e]=0:f.headers[u+1]!=i&&u!=0&&f.headers[u][e].LNum==f.headers[u+1][e].LNum&&f.headers[u][e].UName!=f.headers[u-1][e].UName&&f.headers[u][e].UName==f.headers[u+1][e].UName&&(w[e]!=i&&(w[e]=u),g=!0),f.headers[u+1]!=i&&f.headers[u+1][e].LNum>1&&f.headers[u][e].LNum<f.headers[u+1][e].LNum){for(ct=0,ni=0,tlen=s.headers.length,nt=f.headers[u+1][e].PUName,v=0;v<tlen;v++)s.headers[v]!=i&&s.headers[v][e].UName==nt&&s.headers[v][e+l]!=i&&s.headers[v][e+l].LNum!=0&&(s.headers.splice(v,1),s.indxInfo.splice(v-o.length,1),st--,v--,tlen--);for(yt=w[e];yt<=u;yt++)k=w[e],(f.headers[k][e+l]!=i&&(e+l==b-1||f.headers[k][e+l].LName.toLowerCase().indexOf("[measures]")!=-1)||f.headers[k][e+l].LName.indexOf("[(All)]")==-1&&f.headers[k][e+l].LNum!=0)&&(f.indxInfo.splice(k-o.length,1),f.headers.splice(k,1),c--,ct++);if(u+1>=ct)for(u-=ct-1;u<c&&f.indxInfo[u-o.length].type=="total";)s.indxInfo.push(f.indxInfo.splice(u-o.length,1)[0]),s.headers.push(f.headers.splice(u,1)[0]),c--,st++}if(u>0&&f.headers[u-1]!=i&&f.headers[u][e].LNum<f.headers[u-1][e].LNum){for(nt=f.headers[u-1][e].PUName,pt=f.headers[u][e].LNum;pt<=f.headers[u-1][e].LNum;pt++)n.grep(s.headers,function(n,t){n!=i&&n[e].UName==nt&&(nt=n[e].PUName,f.headers.splice(u,0,s.headers.splice(t,1)[0]),f.indxInfo.splice(u-o.length,0,s.indxInfo.splice(t,1)[0]),c++,st--,u++,g&&w[e]++)});g=!1}if(tt=this._comparePrevMembers(f.headers,c,u,e,b,a),u+1+a==c||f.headers[u+1+a]!=i&&f.headers[u][e].UName!=f.headers[u+1+a][e].UName||tt){for(h=[],ti=n.grep(s.headers,function(n,t){if(f.headers[u][e].UName==n[e].UName&&s.indxInfo[t].totLvl==e+l||f.headers[u+1+a]!=i&&f.headers[u][e].UName!=f.headers[u+1+a][e].UName&&f.headers[u][e].PUName==n[e].UName&&s.indxInfo[t].totLvl==e+l&&tt)return h.push(t),n}),tt&&(h.reverse(),tt=!1);h.length>0;){for(it=h.length-1,kt=h[h.length-1];it>=0;)kt<h[it]&&h[it]--,it--;f.headers.splice(u+1,0,s.headers.splice(h[h.length-1],1)[0]);f.indxInfo.splice(u+1-o.length,0,s.indxInfo.splice(h[h.length-1],1)[0]);a++;h.pop();c++;g&&w[e]++}g=!1;ht[e]=0}ht[e]==i?ht[e]=0:ht[e]++}if(ii=this._findNextMember(f.headers,u,e),dt=this._findPreviousMember(f.headers,u-1,e),u>=lt&&e==b-1-vt&&p[e]>1){if(u>0&&f.headers[u]!=i&&f.headers[u-1][e].LNum!=0&&f.headers[u-1][e].LNum<f.headers[u][e].LNum)for(d=dt;d<0;d++)f.indxInfo[u+d-o.length].lnum=f.headers[u+d][e].LNum,f.indxInfo[u+d-o.length].type="total",o.push(f.indxInfo.splice(u+d-o.length,1)[0]);if(u!=0&&f.headers[u]!=i&&f.headers[u][e].LNum!=0&&f.headers[u-1][e].LNum>f.headers[u][e].LNum)if(rt=0,f.headers[u][e].LNum!=1&&o.length)for(wt=f.headers[u][e].LNum;wt<f.headers[u-1][e].LNum;wt++)for(gt=o[o.length-1].lnum;gt==o[o.length-1].lnum;)f.indxInfo.splice(u+rt-o.length,0,o.splice(o.length-1,1)[0]),r==this._measureDt.axis&&this._measureDt.measureCount>1&&rt--;else while(o.length>0)f.indxInfo.splice(u+rt-o.length,0,o.splice(o.length-1,1)[0]),r==this._measureDt.axis&&this._measureDt.measureCount>1&&rt--;else if(f.indxInfo[u+1-o.length]&&o.length&&f.indxInfo[u+1-o.length].type=="total")while(o.length>0)f.indxInfo.splice(u+1-o.length,0,o.splice(o.length-1,1)[0])}a>0&&(u+=a,a=0)}if(u+1==c){if(o.length&&f.headers[u][e].LNum!=1)while(o.length>0)f.indxInfo.splice(u+1-o.length,0,o.splice(o.length-1,1)[0]);n.grep(s.indxInfo,function(){f.headers.splice(u+1,0,s.headers.splice(0,1)[0]);f.indxInfo.splice(u+1-o.length,0,s.indxInfo.splice(0,1)[0])})}}}catch(ui){this.pivotGridObj._ogridWaitingPopup.hide()}}return r=="rowheader"?this._rBIndx=y:this._cBIndx=y,f.maxLvlLen[e]>1&&(f.headers=this._drillOrderHeaderCollection(f.indxInfo,t,r)),f},_insertSummaryHeaders:function(n,t,i,r,u){while(i.length>0)n.headers.splice(r+1,0,t.headers.splice(i[i.length-1],1)[0]),n.indxInfo.splice(r+1-u,0,t.indxInfo.splice(i[i.length-1],1)[0]),i.pop()},_comparePrevMembers:function(n,t,i,r,u,f){if(r>0&&i+1+f<t)for(var e=r-1;e<=0;e--)return n[i][e].UName!=n[i+1+f][e].UName?!0:!1},_drillOrderHeaderCollection:function(t,i,r){var f=t,e=i,o=r,u=0;return n(f).map(function(t,i){var f=n(e[i.selIndx]).find("Member"),s=[],r,h,c;for(s[u]=[],r=0;r<f.length;r++)h=parseInt(n(f[r]).find("LNum").text()),c=n(f[r]).find("PARENT_UNIQUE_NAME").length?n(f[r]).find("PARENT_UNIQUE_NAME").text():"",s[u].push({CSS:o,Value:n(f[r]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:n(f[r]).attr("Hierarchy"),LName:n(f[r]).find("LName").text(),UName:n(f[r]).find("UName").text(),ChildCount:parseInt(n(f[r]).find("CHILDREN_CARDINALITY").text()),PUName:c,LNum:h,MemberType:parseInt(n(f[r]).find("MEMBER_TYPE").text())});return s})},_getValueCells:function(t,i){var o=this._columnHeaders.headers.length,h=this._rowHeaders.headers.length?this._rowHeaders.headers.length:1,e=0,u=0,f,l,r,s,c;if(this._valueCells[e]=[],this._OlapDataSource._enableBasicEngine)for(r=0;r<t.length;r++)u<o&&(this._valueCells[e][u]={Value:n(t[r]).find("FmtValue")[0]?n(t[r]).find("FmtValue").text():"",FormatString:n(t[r]).find("FormatString")[0]?n(t[r]).find("FormatString").text():""},u++),u==o&&e+1<h&&(u=0,e++,this._valueCells[e]=[]);else for(f=0;f<h;f++)for(l=this._rBIndx.length?this._rBIndx[f].selIndx:0,r=0;r<o;r++)s=n(t[l*i+this._cBIndx[r].selIndx]),c="",(this._columnHeaders.indxInfo[r]&&this._columnHeaders.indxInfo[r].type=="total"||this._rowHeaders.indxInfo[f]&&this._rowHeaders.indxInfo[f].type=="total")&&(c="summary"),u<o&&(this._valueCells[f][r]={Value:n(s).find("FmtValue")[0]?n(s).find("FmtValue").text():"",FormatString:n(s).find("FormatString")[0]?n(s).find("FormatString").text():"",kpi:this._cBIndx[r].kpi?this._cBIndx[r].kpi:this._rBIndx[f]?this._rBIndx[f].kpi:"status",summary:c},u++),u==o&&e+1<h&&(u=0,e++,this._valueCells[e]=[]);return this._valueCells},_populateEngine:function(t,r,u){var c=t.length,l=r.length,a=c?t[0].length:c,s=l?r[0].length:l,y=u.length,p=u[0].length,f,e,v,tt;try{this.pivotEngine=[];var w=[],b=[],it=!1,k=n.Enumerable.From(r.maxLvlLen).Sum(),h=!1,o=[];for(f=0;f<l;f++)for(this.pivotEngine[f+s]==i&&(this.pivotEngine[f+s]=[]),f==0&&(this.pivotEngine[0]=[],this.pivotEngine[0][0]={CSS:"none",Value:"",ColSpan:indexCCell?indexCCell:1,RowSpan:indexRCell?indexRCell:1,HUName:"",LName:"",UName:"",LNum:""}),e=0;e<s;e++)h=!1,this._OlapDataSource.columns&&this._OlapDataSource.columns[e]&&this._OlapDataSource.columns[e].isNamedSets&&(h=!0),this._pivotEngineSpanCalculation("colheader",r,t,this._columnHeaders.maxLvlLen,u,e,f,b,w,k,this._cTotIndexInfo,h);for(o=this.pivotEngine.slice(),this.pivotEngine=[],f=0;f<o.length;f++)if(o[f])for(e=0;e<o[f].length;e++)o[f][e]&&(this.pivotEngine[e]==i&&(this.pivotEngine[e]=[]),this.pivotEngine[e][f]={CSS:o[f][e].CSS,ColSpan:o[f][e].RowSpan,HUName:o[f][e].HUName,LName:o[f][e].LName,LNum:o[f][e].LNum,RowSpan:o[f][e].ColSpan,UName:o[f][e].UName,PUName:o[f][e].PUName,Value:o[f][e].Value,ChildCount:o[f][e].ChildCount,MemberType:o[f][e].MemberType});var d=[],g=[],it=!1,nt=n.Enumerable.From(this._rowHeaders.maxLvlLen).Sum();for(f=0;f<c;f++)for(this.pivotEngine[f+indexCCell]==i&&(this.pivotEngine[f+indexCCell]=[]),e=0;e<a;e++)h=!1,this._OlapDataSource.rows&&this._OlapDataSource.rows[e]&&this._OlapDataSource.rows[e].isNamedSets&&(h=!0),this._pivotEngineSpanCalculation("rowheader",t,r,this._rowHeaders.maxLvlLen,u,e,f,g,d,nt,this._rTotIndexInfo,h);for(a=this._measureDt.axis=="rowheader"?indexRCell+1:indexRCell,s=indexCCell?indexCCell:s,f=0;f<y;f++)for(this.pivotEngine[f+s]!=i&&(a=this.pivotEngine[f+s].length),e=0;e<p;e++)this.pivotEngine[f+s]==i&&(this.pivotEngine[f+s]=[]),v=this._setClassName(u[f][e]),u[f][e].CSS=v,v.indexOf("kpiiconvalue")>-1&&(u[f][e].Value=""),this.pivotEngine[f+indexCCell][e+indexRCell]=u[f][e];tt=n.grep(this.pivotEngine,function(n){return n})}catch(rt){this.pivotGridObj._ogridWaitingPopup.hide()}},_pivotEngineSpanCalculation:function(n,t,r,u,f,e,o,s,h,c,l,a){var ft=t.length,yt=r.length,k=ft?t[0].length:ft,y=yt?r[0].length:yt,dt=f.length,gt=f[0].length,wt,d,nt,v,pt,ct,tt,g,ut,kt,ot,at,vt,st;y=n=="rowheader"?indexCCell?indexCCell:y:indexRCell?indexRCell:y;wt=1;d=0;a&&(t[o][e].ChildCount=0);this._measureDt.axis==n&&this._measureDt.posision==k-1&&(d=1);s[e]||(s[e]=[]);this.pivotEngine[o+y]||(this.pivotEngine[o+y]=[]);h[e]=o;var bt=u[e]?u[e]:1,p=0,ht=0;for(nt=0;nt<e;nt++)u[nt]&&(p+=u[nt]-1,ht+=u[nt]);if(!this._OlapDataSource._enableBasicEngine||this._OlapDataSource._checkSummaryHeaders)for(v=1;v<=bt;v++){var w=null,rt=!1,b=t[o][e].LNum;if(s[e][v]==i&&(s[e][v]=0),t[o-1]&&s[e][b]&&(t[o][e].LNum!=0&&t[o-1][e].PUName==t[o][e].UName||e+d==k-1&&t[o-1][e].LNum<t[o][e].LNum)&&(tempSpan=s[e][b],this.pivotEngine[o+y-tempSpan][e+b-1+p]=t[o][e],a||(this.pivotEngine[o+y-tempSpan][e+b-1+p].ChildCount=-1),this.pivotEngine[o+y-tempSpan][e+b-1+p].ColSpan=1,this.pivotEngine[o+y-tempSpan][e+b-1+p].RowSpan+=tempSpan,this._drilledJSONData(o+y-tempSpan,o+y,e+b-1+p,t[o][e]),s[e][b]=0,e+d==k-1&&t[o-1][e].LNum>t[o][e].LNum)){for(pt=u[e]-b,ct=this._findNextMember(t,o,e),tt=0;tt<ct;tt++)this.pivotEngine[o+y+tt]||(this.pivotEngine[o+y+tt]=[]),this.pivotEngine[o+y+tt][e+p+b]={CSS:"summary",Value:"Total",ColSpan:pt,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:""};this.pivotEngine[o+y-tempSpan][e+b-1+p].RowSpan+=ct-1}if(t[o][e].LNum>v&&s[e][v]++,w=o+y,v==t[o][e].LNum&&o==0&&t[o][e].LNum>1)this.pivotEngine[w]||(this.pivotEngine[w]=[]),this.pivotEngine[w][e+v-1+p]=t[o][e],(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+d==k-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&(this.pivotEngine[w][e+v-1+p].ColSpan+=u[e]-this.pivotEngine[w][e+v-1+p].LNum);else if(o!=0&&t[o][e].LNum>1&&v==t[o][e].LNum&&t[o-1][e].UName!=t[o][e].UName&&t[o-1][e].PUName!=t[o][e].UName)this.pivotEngine[w]==i&&(this.pivotEngine[w]=[]),this.pivotEngine[w][e+v-1+p]=t[o][e],(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+d==k-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&(this.pivotEngine[w][e+v-1+p].ColSpan+=u[e]-this.pivotEngine[w][e+v-1+p].LNum);else if(o!=0&&v==t[o][e].LNum&&t[o-1][e].UName==t[o][e].UName)s[e][v]++,this.pivotEngine[o+y][e+v-1+p]=t[o][e],(t[o+1]!=i&&t[o+1][e].UName!=t[o][e].UName||o+1==ft&&s[e][v]>0)&&(g=s[e][v],ut=t[o][e].LNum,g&&this.pivotEngine[o+y-g][e+ut-1+p]!=i&&this.pivotEngine[o+y-g][e+ut-1+p].Value!=i&&(this.pivotEngine[o+y-g][e+ut-1+p].RowSpan+=g,this._drilledJSONData(o+y-g,o+y,e+ut-1+p,t[o][e])),s[e][v]=0);else if(t[o][e].LNum<2&&(v==t[o][e].LNum||t[o][e].LNum==0)||t[o][e].LNum<v&&t[o-1]&&t[o][e].LNum<t[o-1][e].LNum&&l[o].type=="total"&&this._measureDt.axis==n)if(kt=v-1,t[o-1]&&t[o-1][e].UName==t[o][e].UName&&t[o][e].LName.toLowerCase().indexOf("[measures]")>-1&&(this.pivotEngine[o+y][e+v-1+p]=t[o][e],this._measureDt.measureCount>1&&n==this._measureDt.axis||s[e][v]++),l[o].type!="total")t[o-1]&&t[o-1][e].UName==t[o][e].UName||(this.pivotEngine[o+y][e+v-1+p]=t[o][e],rSCnt=s[e][v],rSCnt&&this.pivotEngine[o+y-rSCnt][e+v-1+p]!=i&&(this.pivotEngine[o+y-rSCnt][e+v-1+p].RowSpan+=s[e][v],this._drilledJSONData(o+y-rSCnt,o+y,e+v-1+p,t[o][e])),s[e][v]=0),!t[o][e].LNum==0&&(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+d==k-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&this.pivotEngine[o+y][e+v-1+p]&&(this.pivotEngine[o+y][e+v-1+p].ColSpan+=u[e]-this.pivotEngine[o+y][e+v-1+p].LNum);else if(l[o].type=="total"&&t[o][e].LName.toLowerCase().indexOf("[measures]")==-1&&t[o][e].LNum!=v&&u[e]!=0){if((t[o][e-1]&&t[o][e-1].LName.toLowerCase().indexOf("[measures]")==-1||this._measureDt.axis!=n)&&(e>l[o].totLvl||e==k-1&&v>l[o].totLvl&&l[o].totLvl!=0||l[o].totLvl==0&&v-1>l[o].totLvl))break;for(var et=1,lt=1,it=0;t[o-lt][e]&&t[o-lt][e].LNum==0;)lt++,it++;if(this._measureDt.axis==n){for(ot=0,rt=!1,it=0,e<this._measureDt.posision?(at=e,vt=this._measureDt.posision):e>this._measureDt.posision&&(vt=u.length,at=e,rt=!0),st=at;st<vt;st++)ot+=u[st];t[o][e+1]&&t[o][e+1].LName.toLowerCase().indexOf("[measures]")>-1&&u[e]>1&&(rt=!0,ot-=t[o][e].LNum);et=ot}else t[o][e].LNum==0&&(o!=0&&t[o][e-1]&&u[e-1]>1&&t[o][e-1].LNum<t[o-1][e-1].LNum&&(it=u[e-1]-t[o][e-1].LNum),n=="rowheader"?et=indexRCell-ht+it:n=="colheader"&&(et=indexCCell-ht+it),(u.length!=1&&e==k-1||u.length>1&&e<k-1)&&(rt=!0));this.pivotEngine[o+y][e+v-1+p-it]={CSS:"summary",Value:"Total",ColSpan:et,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:""}}else t[o][e].LName.toLowerCase().indexOf("[measures]")!=-1&&(t[o-1]&&t[o-1][e].UName==t[o][e].UName||(this.pivotEngine[o+y][e+v-1+p]=t[o][e]),(t[o-1]&&t[o-1][e].UName!=t[o][e].UName||o+1==ft)&&(rSCnt=s[e][v],rSCnt&&this.pivotEngine[o+y-rSCnt][e+v-1+p]!=i&&(this.pivotEngine[o+y-rSCnt][e+v-1+p].RowSpan+=s[e][v],this._drilledJSONData(o+y-rSCnt,o+y,e+v-1+p,t[o][e])),s[e][v]=0));if(rt)break}else this.pivotEngine[o+y][e]=t[o][e]},_findNextMember:function(n,t,i){for(var r=0;n[t+r]&&n[t][i].UName==n[t+r][i].UName;)r++;return r},_findPreviousMember:function(n,t,i){for(var r=-1;n[t+r]&&n[t][i].UName==n[t+r][i].UName;)r--;return r},_drilledJSONData:function(n,t,i,r){for(var u=n+1;u<t;u++)this.pivotEngine[u][i]=r},_setClassName:function(n){var i=parseInt(n.Value),t="value";if(n.kpi)if(n.kpi=="status")switch(i){case-1:t="value kpiiconvalue kpidownarrow";break;case 0:t="value kpiiconvalue kpirightarrow";break;case 1:t="value kpiiconvalue kpiuparrow"}else if(n.kpi=="trend")switch(i){case-1:t="value kpiiconvalue kpidiamond";break;case 0:t="value kpiiconvalue kpitriangle";break;case 1:t="value kpiiconvalue kpicircle"}return n.summary+" "+t},_getFieldItemsInfo:function(n){var t=n.model.dataSource,i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_HIERARCHIES<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+t.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+t.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+t.catalog+"<\/Catalog><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";n.doAjaxPost("POST",t.data,{XMLA:i},this._getReportInfo)},_getReportInfo:function(t,i){for(var r,f=[],u=0;u<n(i).find("row").length;u++)r=n(n(i).find("row")[u]),f.push({pid:r.find("DIMENSION_UNIQUE_NAME").text(),id:r.find("HIERARCHY_UNIQUE_NAME").text(),name:r.find("HIERARCHY_CAPTION").text(),tag:r.find("HIERARCHY_UNIQUE_NAME").text()});this._hierarchyNodes=f},_applyTrim:function(t){return t.rows=n.map(t.rows,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t}),t.columns=n.map(t.columns,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t}),t.filters=n.map(t.filters,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t}),t.values=t.values.length>0&&t.values[0].measures!=i?t.values:[{measures:[],axis:"columns"}],t}};t.olap._mdxParser={_getRowMDX:function(r){var f=n(r)[0].rows,o,u,e;if(rowQuery="",measureQuery="",o=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.PivotGrid.AxisName.Row,f.length>0){for(u=0;u<f.length;u++)e=f[u].isNamedSets==i||!f[u].isNamedSets?!1:!0,f[u].fieldName==i||e?e&&(rowQuery=u>0?rowQuery+"*{"+f[u].fieldName+"}":"{"+f[u].fieldName+"}"):rowQuery=rowQuery+(u>0?"*":"")+"{"+this._getDimensionQuery(f[u],r,"rows",u)+"}";rowQuery="HIERARCHIZE({"+this._updateOlapReport(n(r)[0].rows,rowQuery,"rows")+"})"}return o&&(measureQuery=t.olap._mdxParser._getMeasuresQuery(r),rowQuery=rowQuery!=""?rowQuery+(rowQuery!=""&&measureQuery!=""?",":"")+measureQuery:measureQuery),rowQuery},_getcolumnMDX:function(r){var e=n(r)[0].columns,f="",s=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.PivotGrid.AxisName.Column,u,o;if(e.length>0){for(u=0;u<e.length;u++)o=e[u].isNamedSets==i||!e[u].isNamedSets?!0:!1,f=e[u].fieldName!=i&&o?f+(u>0?"*":"")+"{"+this._getDimensionQuery(e[u],r,"columns",u)+"}":u>0?f+"*{"+e[u].fieldName+"}":"{"+e[u].fieldName+"}";f="HIERARCHIZE({"+this._updateOlapReport(e,f,"columns")+"})"}return s&&(measureQuery=t.olap._mdxParser._getMeasuresQuery(r),f=f!=""?f+(f!=""&&measureQuery!=""?",":"")+measureQuery:measureQuery),f},_updateOlapReport:function(r,u,f){var s,h,e,o;return f=="rows"?(s=n.map(r,function(n,t){if(r[t].drilledItems!=i)return r[t].drilledItems}),t.olap.base._isRowDrilled&&"rows"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(e=u.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"").split("*"),o=n.map(e,function(n){return n.indexOf("DrillDownlevel")>=0&&(n=n.replace("DrillDownlevel","DrillDownlevel(")+")"),n}),r[t.olap.base._currIndex.Index].drilledItems.push(o),t.olap.base._isRowDrilled=!1):s.length>0&&(t.olap.base._currIndex.axis==i||t.olap.base._currIndex.axis=="columns"&&!t.olap.base._isRowDrilled)&&(u=this._getDrillQuery(s,u,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||t.olap.base._currIndex.axis!="rows"||(t.olap.base._currIndex={})):(h=n.map(r,function(n,t){if(r[t].drilledItems!=i)return r[t].drilledItems}),t.olap.base._isColDrilled&&"columns"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(e=u.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"").split("*"),o=n.map(e,function(n){return n.indexOf("DrillDownlevel")>=0&&(n=n.replace("DrillDownlevel","DrillDownlevel(")+")"),n}),r[t.olap.base._currIndex.Index].drilledItems.push(o),t.olap.base._isColDrilled=!1):h.length>0&&(t.olap.base._currIndex.axis==i||t.olap.base._currIndex.axis=="rows"&&!t.olap.base._isColDrilled)&&(u=this._getDrillQuery(h,u,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||t.olap.base._currIndex.axis!="columns"||(t.olap.base._currIndex={})),u},_getDrillQuery:function(t,r,u){for(var s,e,h,o="",f=0;f<t.length;f++)if(t[f][t[f].length-1].indexOf(".children")>=0||t[f][t[f].length-1].indexOf("DrillDownlevel")>=0||(t[f][t[f].length-1]=t[f][t[f].length-1]+".children"),t[f].length!=u.length){for(s=n.map(u,function(n){if(n.fieldName!=i&&n.fieldName!=t[f][[t[f].length-1]].split(".").splice(0,2).join("."))return{uniqueName:"DrillDownLevel("+n.fieldName.trim()+")",fieldName:n.fieldName.trim()}}),e=0;e<s.length;e++)h=this._getItemPosition(u,s[e].fieldName)[0],t[f].toString().indexOf(s[e].fieldName)>=0||t[f].splice(h,0,s[e].uniqueName);o=o+""+(f>0?",":"")+"\n ("+t[f]+")"}else o=o+""+(f>0?",":"")+"\n ("+t[f].toString()+")\n";return"("+r+"),"+o},_getDimensionQuery:function(n){if(n.drillCellInfo!=i){var t="{("+n.drillCellInfo.uniqueName+")}";return delete n.drillCellInfo,t}return"DrillDownlevel(("+n.fieldName.trim()+"))"},_updateReport:function(i,r,u,f){var e;isElementFound=!1;u.drillCellInfo=n.extend({},r);u.drillCellInfo.uniqueName="("+u.drillCellInfo.uniqueName.trim()+".children)";e={action:"drilldown",cellInfo:r};t.olap.base.getJSONData(e,f.model.dataSource,f)},_splitCellInfo:function(n){if(n)var t={hierarchyUniqueName:n.split("::")[1].split(".").splice(0,2).join("."),uniqueName:n.split("::")[0],levelUniqueName:n.split("::")[1],leveName:n.split("::")[2],parentUniqueName:n.split("::")[3]};return t},updateDrilledReport:function(r,u,f){var it=t.olap._mdxParser,c=null,e,p,w="",l="",k,h,v,o,y,tt;if(e=this._splitCellInfo(r.uniqueName),e.targetUName=r.uniqueName,e.previousElements="",p=n(u.target).parent().hasClass("rowheader")?f.model.dataSource.rows:n(u.target).parent().hasClass("colheader")?f.model.dataSource.columns:null,p.length>0){k=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==e.hierarchyUniqueName.trim().toLowerCase())return{report:n,index:t}});c=k[0].report;e.itemPosition=k[0].index;e.cellIndex=r.index;c.drilledItems!=i?c.drilledItems:c.drilledItems=[];t.olap.base._currIndex={axis:n(u.target).parent().hasClass("rowheader")?"rows":"columns",Index:k[0].index};var a=e.hierarchyUniqueName,b="",w="",s="",g=n(u.target).parent(),d=g.attr("p").split(",")[0],nt=g.attr("p").split(",")[1];if(g.hasClass("rowheader"))for(b="rowheader",t.olap.base._isRowDrilled=!0,h=parseInt(d);h>=0;h--)!f.getJSONRecords()[parseInt(h*f._rowCount+parseInt(d))].Info.indexOf(a)>=0&&(s=f.getJSONRecords()[parseInt(h*f._rowCount+parseInt(nt))].Info,v=this._splitCellInfo(s),v&&(w=v.uniqueName+w),s==""||s.indexOf(a)>=0||(o=this._splitCellInfo(s),o.uniqueName=o.uniqueName.replace(/&/g,"&amp;"),l=o.uniqueName+">#>"+l,currReport=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==o.hierarchyUniqueName.trim().toLowerCase())return t}),r.action!="collapse"&&(f.model.dataSource.rows[currReport[0]].drillCellInfo=o),a=o.hierarchyUniqueName));else for(b="colheader",t.olap.base._isColDrilled=!0,h=parseInt(nt);h>=0;h--)!f.getJSONRecords()[parseInt(d*f._rowCount+parseInt(h))].Info.indexOf(a)>=0&&(s=f.getJSONRecords()[parseInt(d*f._rowCount+parseInt(h))].Info,v=this._splitCellInfo(s),v&&(w=v.uniqueName+">#>"+w),s==""||s.indexOf(a)>=0||(o=this._splitCellInfo(s),o.uniqueName=o.uniqueName.replace(/&/g,"&amp;"),l=o.uniqueName+l,currReport=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==o.hierarchyUniqueName.trim().toLowerCase())return t}),r.action!="collapse"&&(f.model.dataSource.columns[currReport[0]].drillCellInfo=o),a=o.hierarchyUniqueName));l+=e.uniqueName;e.previousElements=w.replace(/&amp;/g,"&");e.preRepItm=l.replace(/&amp;/g,"&");e.axis=b;r.action?r.action?(y=t.olap.base._getDrilledMemeber({item:e}),y.length&&t.olap.base._onDemandCollapse({drilledMembers:y},b)):(tt=n(r.drilledMember).clone(!0),t.olap.base._onDemandExpand({action:"drilldown",cellInfo:e,isExist:!0},r.drilledMember)):(y=t.olap.base._getDrilledMemeber({item:e}),y.length&&t.olap.base._onDemandCollapse({drilledMembers:y,action:"collapse"},b),t.olap._mdxParser._updateReport(c.drilledItems,e,c,f))}},_getSlicerMDX:function(t){var u=n(t)[0].filters,f="",r,e;for(ths=this,r=0;r<u.length;r++)e=n.grep(n(t)[0].columns,function(n){return ths._getDimensionUniqueName(n.fieldName)==ths._getDimensionUniqueName(u[r].fieldName)}).length>0,e||(e=n.grep(n(t)[0].rows,function(n){return ths._getDimensionUniqueName(n.fieldName)==ths._getDimensionUniqueName(u[r].fieldName)}).length>0),e||(u[r].fieldName!=i&&u[r].filterItems==i?f=f+(f!=""?"*":"")+"{"+this._getDimensionQuery(u[r])+"}":u[r].filterItems!=i&&(f=f+(f!=""?"*":"")+"{"+u[r].filterItems.values.toString()+"}"));return f!=""?"where ("+f.replace(/DrillDownlevel/g,"")+")":""},_getDimensionUniqueName:function(i){var u=t.olap.base._hierarchyNodes,r;return u?(r=n.map(u,function(n){if(n.id.toLowerCase()==i.toLowerCase())return n.pid}),r.length>0?r[0]:""):i.split(".")[0]},_getMeasuresQuery:function(t){var u=n(t)[0].values,f=[],e="",s="",r,o;return u.length>0&&(r=jQuery.map(u,function(n,t){if(n.measures!=i)return{measureElements:n.measures,Index:t,axisName:n.axis}}),o=r.length>0?n.Enumerable.From(r[0].measureElements).Select(function(n){return n.fieldName}).ToArray():null,o!=null?f.push({values:o,Index:r[0].Index}):f,s=u.axis),e=n.Enumerable.From(f).Select(function(n){return n.values.toString()}).ToArray(),e[0]!=""?"{"+e+"}":""},_getIncludefilterQuery:function(t,r){var c="FROM ["+r+"]",f="from (select (",e,o,s,h,u;for(e=n.Enumerable.From(t.rows).Where(function(n){return n.filterItems!=i}).Select(function(n){return n.filterItems.values}).ToArray(),o=n.Enumerable.From(t.columns).Where(function(n){return n.filterItems!=i}).Select(function(n){return n.filterItems.values}).ToArray(),u=0;u<t.filters.length;u++)s=t.filters,h=this,n.map(t.columns,function(n){h._getDimensionUniqueName(n.fieldName)==h._getDimensionUniqueName(s[u].fieldName)&&s[u].filterItems!=i&&o.push(s[u].filterItems.values)}),n.map(t.rows,function(n){h._getDimensionUniqueName(n.fieldName)==h._getDimensionUniqueName(s[u].fieldName)&&s[u].filterItems!=i&&e.push(s[u].filterItems.values)});for(u=0;u<=o.length-1;u++)f=u==0?f+"{"+o[u].toString()+"}":f+",{"+o[u].toString()+"}";for(o.length>0&&(f=f+" ) on COLUMNS ",e.length>0&&(f=f+",(")),u=0;u<=e.length-1;u++)f=u>0?f+",{"+e[u].toString()+"}":f+"{"+e[u].toString()+"}";return f=o.length>0&&e.length>0?f=f+") on ROWS ":o.length==0&&e.length>0?f+") on COLUMNS ":f,o.length==0&&e.length==0?c:f+c+")"},_getItemPosition:function(t,r){return n.map(t,function(n,t){if(n.fieldName!=i&&n.fieldName.trim()==r.trim())return t})}}})(jQuery,Syncfusion)});
