/*!
*  filename: ej.pivotschemadesigner.min.js
*  version : 14.1.0.46
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.button.min","./ej.checkbox.min","./ej.dialog.min","./ej.maskedit.min","./ej.waitingpopup.min","./ej.treeview.min","./../datavisualization/ej.vmlrenderer.min","./../datavisualization/ej.svgrenderer.min","./../datavisualization/ej.axisrenderer.min","./../datavisualization/ej.legendrender.min","./../datavisualization/ej.seriesrender.min","./../datavisualization/ej.chart.min","./../datavisualization/ej.synchart.min"],n):n()})(function(){(function(n,t,i){t.widget("ejPivotSchemaDesigner","ej.PivotSchemaDesigner",{_rootCSS:"e-pivotschemadesigner",element:null,model:null,validTags:["div","span"],defaults:{url:"",cssClass:"",height:"630px",width:"415px",locale:"en-US",layout:"normal",pivotControl:null,pivotTableFields:[],pivotCalculations:[],pivotColumns:[],pivotRows:[],filters:[],olap:{showKpi:!1,showNamedSets:!1},enableWrapper:!1,serviceMethods:{fetchMembers:"FetchMembers",nodeStateModified:"NodeStateModified",nodeDropped:"NodeDropped",removeButton:"RemoveButton",memberExpand:"MemberExpanded",filtering:"filtering"},customObject:{},beforeServiceInvoke:null,afterServiceInvoke:null,dragMove:null},dataTypes:{serviceMethods:"data",customObject:"data",pivotControl:"data",pivotTableFieldList:"array",pivotCalculationList:"array",pivotColumnList:"array",pivotRowList:"array",filterList:"array"},locale:t.util.valueFunction("locale"),_init:function(){this._initPrivateProperties();this._load()},_destroy:function(){this.element.empty().removeClass("e-pivotschemadesigner"+this.model.cssClass)},_initPrivateProperties:function(){this._id=this.element.attr("id");this._dialogTitle="";this._currentMembers=[];this._memberTreeObj=null;this._tableTreeObj=null;this._dialogOKBtnObj=null;this._curFilteredText="";this._curFilteredAxis="";this._tempFilterData=null;this._droppedClass="";this._selectedTreeNode=null;this._selectedMember="";this._isDragging=!1;this._dataModel="";this._droppedPosition="";this._currentCubeName="";this._errorDialog="";this._nodeDropedParams="";this._contextMenuObj=null;this._removeButtonDeferUpdate=!1;this._isMeasureBtnRemove=!1;this._nodeCheck=!1;this._isFiltered=!1},_load:function(){var u="",r;if(this.model.pivotControl!=null&&(this.model.pivotControl._schemaData=this),this.model.pivotControl==null||jQuery.isEmptyObject(this.model.pivotControl.getOlapReport())&&this.model.pivotControl._dataModel!="XMLA"||(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(u=JSON.parse(JSON.parse(this.model.pivotControl.getOlapReport()).ItemsProperties),r=JSON.parse(this.model.pivotControl.getOlapReport()),this._setTableFields(u),this._setPivotRows(r.PivotRows),this._setPivotColumns(r.PivotColumns),this._setPivotCalculations(r.PivotCalculations),this._setFilters(r.Filters),this._dataModel=r.DataModel,this._currentCubeName=r.CurrentCube):(r=this.model.pivotControl.getOlapReport(),r==""&&this.model.pivotControl._dataModel=="XMLA"?r=this.model.pivotControl.model.dataSource:this._setTableFields(this.model.pivotControl._pivotTableFields),this._setPivotRows(r.rows),this._setPivotColumns(r.columns),this._setPivotCalculations(r.values),this._setFilters(r.filters),this._dataModel=this.model.pivotControl.model.dataSource.cube!=""?"XMLA":"Pivot"),n("#"+this._id).ejWaitingPopup({showOnInit:!0}),pschemaDesignerWaitingPopup=n("#"+this._id).data("ejWaitingPopup"),this.element.width(this.model.width).height(this.model.height),pschemaDesignerWaitingPopup.show()),this.model.enableWrapper==!1){var f=t.buildTag("table.headerTable",t.buildTag("tr",t.buildTag("td",t.buildTag("div.listHeader",t.buildTag("span.headerText",this._getLocalizedLabels("PivotTableFieldList"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.listSubhead",t.buildTag("span.subheadText",this._getLocalizedLabels("ChooseFieldsToAddToReport"),{})[0].outerHTML,{})[0].outerHTML,{}).attr("valign","top")[0].outerHTML,{})[0].outerHTML,{}).attr("width","100%").attr("height","10%")[0].outerHTML+t.buildTag("table.fieldTable",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.schemaFieldList",t.buildTag("div.schemaFieldTree#schemaFieldTree")[0].outerHTML)[0].outerHTML).attr("valign","top")[0].outerHTML,{})[0].outerHTML,{})[0].outerHTML,{}).attr("width","95%").attr("height","30%")[0].outerHTML,e=t.buildTag("table.axisTable",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("ReportFilter"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaFilter",this._createPivotButtons(this.model.filters,"filter"))[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML+t.buildTag("td",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("ColumnLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaColumn",this._createPivotButtons(this.model.pivotColumns,"column")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="columns"?this._createPivotButtons([{fieldName:"Measures"}],"column"):""),{})[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML,{})[0].outerHTML+t.buildTag("tr",t.buildTag("td",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("RowLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaRow",this._createPivotButtons(this.model.pivotRows,"row")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="rows"?this._createPivotButtons([{fieldName:"Measures"}],"row"):""),{})[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML+t.buildTag("td",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("Values"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaValue",this._createPivotButtons(this.model.pivotCalculations,"values"),{})[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML,{})[0].outerHTML,{})[0].outerHTML,{}).attr("width","100%").attr("height","46%")[0].outerHTML,o=t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",this._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML,s=f+t.buildTag("div.centerDiv")[0].outerHTML+t.buildTag("div.centerHead",this._getLocalizedLabels("DragFieldBetweenAreasBelow"))[0].outerHTML+e+t.buildTag("span.responsiveSchema","")[0].outerHTML+(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?o:"")+t.buildTag("div.schemaNoClick","")[0].outerHTML;n(s).appendTo("#"+this._id)}else this.model.enableWrapper==!0&&(this._setFilters(r.Filters),this.element.find(".axisTable .schemaFilter").append(this._createPivotButtons(this.model.filters,"filter")),this.element.find(".axisTable .schemaRow").append(this._createPivotButtons(this.model.pivotRows,"row")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="rows"?this._createPivotButtons([{fieldName:"Measures"}],"row"):"")),this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons(this.model.pivotColumns,"column")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="columns"?this._createPivotButtons([{fieldName:"Measures"}],"column"):"")),this.element.find(".axisTable .schemaValue").append(this._createPivotButtons(this.model.pivotCalculations,"values")),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.element.append(t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",this._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML),this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)}));this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)});this.element.find(".pivotButton .filterBtn").ejButton({size:"normal",type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"filter"});this.element.find(".pivotButton input").ejToggleButton({size:"normal",contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._onSortBtnClick,this)});this.model.pivotControl!=null&&(this.model.pivotControl._dataModel!="XMLA"?this._createTreeView(this,this.model.pivotTableFields):this._generateTreeViewData(this))},_createTreeView:function(r,u){var e,f,c,l,o,s,a,h;for(this.element.find(".schemaFieldTree").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||this.model.pivotControl._dataModel=="XMLA"?"name":"caption",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:u},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._onNodeDropped,this),nodeDragStart:t.proxy(this._onNodeDrag,this),nodeDrag:t.proxy(this._onNodeDraged,this)}),this._tableTreeObj=this.element.find(".schemaFieldTree").data("ejTreeView"),this._tableTreeObj.element.find(".measureGroupCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".folderCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".dimensionCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".measureGroupCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML),this._tableTreeObj.element.find(".dimensionCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML),e=this._tableTreeObj.element.find("li"),f=0;f<e.length;f++)c=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n(e[f]).attr("id"):this.model.pivotTableFields[f].tag,e[f].setAttribute("tag",c),l=n(e[f]).find(".e-chkbox-wrap"),n(l[0]).attr("aria-checked")=="true"&&n(n(e[f])).find(".folderCDB").length<=0&&n(e[f]).attr("tag").indexOf("[Measures]")==-1&&(this.model.pivotControl._dataModel=="XMLA"?n(e[f]).parents("li:eq(0)").length>0&&n(e[f]).parents("li:eq(0)").attr("tag").indexOf("[Measures]")==-1&&(o=this.model.pivotControl._getReportItem(n(e[f]).attr("tag")).item,o.length>0&&(o[0].isNamedSets==i||!o[0].isNamedSets)&&(s=t.buildTag("span.e-icon").css("display","inline-block").addClass("treeDrop")[0].outerHTML,n(n(e[f]).find(".e-text")[0]).after(s))):(s=t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML,n(n(e[f]).find(".e-text")[0]).after(s)));this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(this._tableTreeObj.model.nodeCheck=t.proxy(this._pivotCheckedStateModified,this),this._tableTreeObj.model.nodeUncheck=t.proxy(this._pivotCheckedStateModified,this)):(this._tableTreeObj.model.nodeCheck=t.proxy(this._onCheckedStateModified,this),this._tableTreeObj.model.nodeUncheck=t.proxy(this._onCheckedStateModified,this));this._tableTreeObj.element.find(".attributeCDB").parent().siblings("ul").remove();this._tableTreeObj.element.find(".attributeCDB").closest("div").find(".e-plus").remove();this._tableTreeObj.element.find(".hierarchyCDB").parent().parent().siblings("ul").find(".e-chkbox-wrap").remove();this._tableTreeObj.element.find(".e-plus").length==0&&this._tableTreeObj.element.find(".e-item").css("padding","0px");this.element.find(".schemaFilter, .schemaColumn, .schemaRow, .schemaValue").ejDroppable({});this.model.pivotControl!=null&&(a=t.buildTag("ul.pivotTreeContext#pivotTreeContext",t.buildTag("li",t.buildTag("a","Add to Filter")[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a","Add to Row")[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a","Add to Column")[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a","Add to Values")[0].outerHTML)[0].outerHTML)[0].outerHTML,n(this.element).append(a),n("#pivotTreeContext").ejMenu({menuType:t.MenuType.ContextMenu,openOnClick:!1,contextMenuTarget:this._tableTreeObj.element[0],click:t.proxy(this._onTreeContextClick,this),beforeOpen:t.proxy(this._onContextOpen,this),close:t.proxy(this.model.pivotControl._onPreventPanelClose,this)}));this.model.pivotControl!=null&&this.model.pivotControl.model.isResponsive==!0&&(n(window).width()<750?(n("#"+this._id).css("position","absolute"),this.element.find(".responsiveSchema").addClass("expandSchema").removeClass("responsiveSchema"),n("#"+this.model.pivotControl._id).width("100%"),this._hideSchemaDesigner()):n(window).width()>750&&(n("#"+this._id).css({position:"static"}),n("#"+this.model.pivotControl._id).width(parseInt(100-n("#"+this._id).width()/n(window).width()*100)-2+"%"),this._showSchemaDesigner()));this.model.pivotControl!=null&&(h=!1,this.model.pivotControl.model.enableDeferUpdate&&(h=!0),this.element.find(".btnDeferUpdate").ejButton({size:"mini",type:t.ButtonType.Button,enabled:h,click:t.proxy(this.model.pivotControl._deferUpdate,this.model.pivotControl)}),this.element.find(".chkDeferUpdate").ejCheckBox({text:this._getLocalizedLabels("DeferLayoutUpdate"),change:this._checkedChange,size:"normal",checked:h}));pschemaDesignerWaitingPopup.hide();this._unWireEvents();this._wireEvents()},_onNodeDraged:function(n){this._trigger("dragMove",n)},_setFirst:!0,_setModel:function(n){for(var t in n)switch(t){case"OlapReport":this.setOlapReport(n[t]);break;case"locale":this._load()}},_wireEvents:function(){this.model.layout!="excel"?(this._on(this.element,"mouseover",".pivotButton .pvtBtn",t.proxy(function(t){n(t.target.parentNode).find("span.removePivotBtn").css("display","inline-block")},this)),this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(){this.element.find(".pivotButton > span.removePivotBtn").css("display","none")},this))):(this._on(this.element,"mouseover",".pivotButton .pvtBtn",t.proxy(function(t){this._isDragging&&(this.element.find(".dropIndicator").removeClass("dropIndicatorHover"),n(t.target).siblings(".dropIndicator").addClass("dropIndicatorHover"))},this)),this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(t){this._isDragging&&n(t.target).siblings(".dropIndicator").removeClass("dropIndicatorHover")},this)));this._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){var i=n(t.target).siblings("span.e-icon.filter:eq(0)").length>0||n(t.target).find("span.e-icon.filter:eq(0)").length>0||n(t.target).parentsUntil("li").find("span.e-icon.filter:eq(0)").length>0?navigator.userAgent.indexOf("Trident")>0?"-20px":"-35px":"-20px";n(t.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(t.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static",color:"#5c5c5c","margin-left":i,"margin-top":"3px"}):n(t.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(t.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static",color:"#5c5c5c"}):n(t.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({color:"#5c5c5c",display:"inline-block",position:"static"});n(t.target).parent().find(".measureGroupCDB, .dimensionCDB, .folderCDB").length>0&&n(t.target).css("cursor","default")},this)).mouseout(t.proxy(function(){n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"})},this));this._on(this.element,"click",".filterBtn",t.proxy(this._onFilterBtnClick,this));this._on(this.element,"click",".removePivotBtn",t.proxy(this._onRemoveBtnClick,this));this._on(this._tableTreeObj.element,"click",".treeDrop",t.proxy(this._onFilterBtnClick,this));this._on(this.element,"click",".collapseSchema",t.proxy(this._hideSchemaDesigner,this));this._on(this.element,"click",".expandSchema",t.proxy(this._showSchemaDesigner,this));n(window).bind("resize",n.proxy(this._reSizeHandler,this))},_unWireEvents:function(){this._off(this.element,"click",".filterBtn, .collapseSchema,.expandSchema");this._off(this.element,"mouseover",".pivotButton");this._off(this.element,"mouseover",".pivotButton .pvtBtn");this._off(this.element,"mouseleave",".pivotButton");this._off(this.element,"mouseover",".schemaFieldTree li");this._off(this.element,"mouseout",".schemaFieldTree li");this._off(this._tableTreeObj.element,"click",".treeDrop");this._off(this._tableTreeObj.element,"click","li");n(window).unbind("resize",n.proxy(this._reSizeHandler,this))},_getLocalizedLabels:function(n){return t.PivotSchemaDesigner.Locale[this.locale()][n]===i?t.PivotSchemaDesigner.Locale["en-US"][n]:t.PivotSchemaDesigner.Locale[this.locale()][n]},_setTableFields:function(n){t.isNullOrUndefined(n)||(this.model.pivotTableFields=n)},_setPivotRows:function(n){t.isNullOrUndefined(n)||(this.model.pivotRows=n)},_setPivotColumns:function(n){t.isNullOrUndefined(n)||(this.model.pivotColumns=n)},_setPivotCalculations:function(n){t.isNullOrUndefined(n)||(this.model.pivotCalculations=n)},_setFilters:function(n){t.isNullOrUndefined(n)||(this.model.filters=n)},_getSortedHeaders:function(){for(var i=this.element.find(".descending").parents("label"),r="",t=0;t<i.length;t++)r+=n(i[t]).attr("for").replace("toggleBtn","")+"##";return r},_onContextOpen:function(i){var u,f,r;if(n(i.target.parentElement).find(".measureGroupCDB").length>0||n(i.target.parentElement).find(".folderCDB").length>0||n(i.target.parentElement).find(".dimensionCDB").length>0)return!1;u=t.buildTag("div#preventDiv").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML;n("body").append(u);this._dataModel=="Olap"||this.model.pivotControl._dataModel=="XMLA"?(r=n("#pivotTreeContext").data("ejMenu"),this._selectedMember=n(i.target).parents("li:eq(0)").attr("tag"),this._selectedMember.toLowerCase().indexOf("[measures]")>=0?(r.disableItem("Add to Filter"),r.disableItem("Add to Row"),r.disableItem("Add to Column"),r.enableItem("Add to Values")):(r.disableItem("Add to Values"),n(i.target.parentElement).find(".namedSetCDB").length>0?r.disableItem("Add to Filter"):r.enableItem("Add to Filter"),r.enableItem("Add to Row"),r.enableItem("Add to Column"))):this._dataModel=="Pivot"&&(f=i.target.textContent,n(i.target).hasClass("e-text")?(this._selectedMember=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(n){return n.caption==i.target.text})[0].name:i.target.text,r=n("#pivotTreeContext").data("ejMenu"),r.enable()):(r=n("#pivotTreeContext").data("ejMenu"),r.disable()))},_onNodeDrag:function(t){return this._isDragging=!0,n(t.dragTarget.parentElement).find(".measureGroupCDB").length>0||n(t.dragTarget.parentElement).find(".folderCDB").length>0||n(t.dragTarget.parentElement).find(".dimensionCDB").length>0?!1:void 0},_onTreeContextClick:function(r){var l,v,y,p,u,e,h,a;this.model.pivotControl._onPreventPanelClose();var f,b="",o=this.element.find(".pivotButton:contains("+this._selectedMember+")"),k=n(o).find(".filterIndicator").length>0?!0:!1,d=n(o).find("~ span:eq(0) span.descending").length>0?!0:!1,c,w,s;for(this._dataModel=="Olap"||this.model.pivotControl._dataModel=="XMLA"?(selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(this._selectedMember),f=this._selectedMember):selectedTreeNode=n(this._tableTreeObj.element).find("div:contains("+this._selectedMember+")>span").parents("li"),this._droppedClass=r.events.text=="Add to Filter"?"schemaFilter":r.events.text=="Add to Row"?"schemaRow":r.events.text=="Add to Column"?"schemaColumn":r.events.text=="Add to Values"?"schemaValue":"",u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==this._selectedMember&&(this.model.pivotTableFields[u].isSelected=!0,f=this.model.pivotTableFields[u]);if(!t.isNullOrUndefined(this._tempFilterData))for(u=0;u<this._tempFilterData.length;u++)if(!t.isNullOrUndefined(this._tempFilterData[u][this._selectedMember]))for(l=0;l<this._tempFilterData[u][this._selectedMember].length;l++)b+="##"+this._tempFilterData[u][this._selectedMember][l];if(o.length>1)for(u=0;u<selectedElement.length;u++)n(o[u]).text()==this._selectedMember&&n(o[u]).remove();else n(o).remove();try{c=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(g){c=this.model.pivotControl.getOlapReport()}if(this._dataModel=="Olap"){for(this._nodeDropedParams=this._droppedClass=="schemaFilter"?"Slicer":this._droppedClass=="schemaColumn"?"Categorical":this._droppedClass=="schemaRow"?"Series":"",this._droppedClass=="schemaValue"&&(v=this.element.find(".pivotButton:contains('Measures')").length==0?"schemaColumn":this.element.find(".pivotButton:contains('Measures')").parents(".e-droppable").attr("class").split(" ")[0],this._nodeDropedParams=v=="schemaColumn"?"Categorical":v=="schemaRow"?"Series":""),y=!1,p="",u=0;u<this.element.find(".pivotButton").length;u++)if(n(this.element.find(".pivotButton")[u]).attr("tag").split(":")[1]==selectedTreeNode.attr("tag").replace(/\[/g,"").replace(/\]/g,"")){y=!0;p=n(this.element.find(".pivotButton")[u]).attr("tag");break}y?(w=this._currentCubeName+"--"+p+"--"+this._nodeDropedParams+"--",this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),a=JSON.stringify(this.model.customObject),s=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:w,currentReport:c,gridLayout:this.model.pivotControl.model.layout,customObject:a}),this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,s.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,s,this._onDroppedSuccess)):this._tableTreeObj.checkNode(selectedTreeNode);this._nodeDropedParams=""}else selectedTreeNode.find(".e-chk-inact").length>0?this._tableTreeObj.checkNode(selectedTreeNode):this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(this.model.pivotControl._dataModel=="XMLA"?(f=f==i||f.name==i?{name:this._selectedMember}:f,e={fieldName:f.name,fieldCaption:f.name}):e={fieldName:this._selectedMember,fieldCaption:this._selectedMember},h=this._droppedClass==""?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaValue"?"value":this._droppedClass=="schemaFilter"?"filter":"",this._createPivotButton(e,h,"","",""),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=f.name}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=f.name}),this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName!=f.name}),this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=f.name}),h=="row"?this.model.pivotControl.model.dataSource.rows.push(e):h=="column"?this.model.pivotControl.model.dataSource.columns.push(e):h=="filter"?this.model.pivotControl.model.dataSource.filters.push(e):this.model.pivotControl.model.dataSource.values.push(e),this.model.pivotControl._dataModel=="XMLA"?t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl):(this._trigger("fieldItemDropped",{axis:h,fieldItem:selectedTreeNode}),this.model.pivotControl._populatePivotGrid())):(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),a=JSON.stringify(this.model.customObject),this._createPivotButton(this._selectedMember,this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",k,d,""),s=JSON.stringify({action:"nodeDropped",dropAxis:this._droppedClass+"::",headerTag:JSON.stringify(f),sortedHeaders:this.model.pivotControl._ascdes,currentReport:c,customObject:a}),this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,s.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,s,this._pvtNodeDroppedSuccess))},_checkedChange:function(t){var i=n(t.event.target).parents(".e-pivotschemadesigner").data("ejPivotSchemaDesigner"),r=n(".btnDeferUpdate").data("ejButton");t.isChecked?(i.model.pivotControl.model.enableDeferUpdate=!0,r.enable()):(i.model.pivotControl.model.enableDeferUpdate=!1,i.model.pivotControl._isUpdateRequired&&i.model.pivotControl._deferUpdate(),r.disable())},_onSortBtnClick:function(){var i=JSON.stringify(this.model.customObject),n=this._getSortedHeaders(),r=this.model.customObject!={}&&n!=""?JSON.stringify({action:"sorting",sortedHeaders:n,currentReport:this.model.pivotControl.getOlapReport(),customObject:i}):this.model.customObject!={}?JSON.stringify({action:"sorting",currentReport:this.model.pivotControl.getOlapReport(),customObject:i}):n!=""?JSON.stringify({action:"sorting",sortedHeaders:n,currentReport:this.model.pivotControl.getOlapReport()}):JSON.stringify({action:"sorting"});t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show();this.model.pivotControl.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.pivotControl.model.serviceMethods.sorting,r,this.model.pivotControl._renderControlSuccess)},_generateMembers:function(i){var e=n(i).find("Axis:eq(0) Tuple"),u=[],o={},r,f,s;for(u.push({id:"All",name:"All",checkedStatus:!0,tag:""}),r=0;r<e.length;r++)f=n(n(i).find("Axis:eq(0) Tuple:eq("+r+")").children().children()[0]).text(),s=n(n(i).find("Axis:eq(0) Tuple:eq("+r+")").children().children()[1]).text(),o={hasChildren:n(e[r]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!0,id:f.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:s,tag:f},u.push(o);t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.hide();this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(u)})},_onFilterBtnClick:function(i){var u,o,f,l,s,a,h,e,r,c,v;if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(u=this.model.pivotControl._dataModel=="XMLA"?n(n(i.target).parents("li:eq(0)")).attr("tag"):n.grep(this.model.pivotTableFields,function(t){return t.caption==n(n(i.target).parent()).text()})[0].name,f=0;f<this.element.find(".pivotButton").length;f++)if(uniqueName=n(this.element.find(".pivotButton")[f]).find("button").attr("fieldName"),uniqueName==u){o=n(this.element.find(".pivotButton")[f]).find("button").text();this._selectedAxis=n(this.element.find(".pivotButton")[f]).parent()[0].className.split(" ")[0];break}this._selectedAxis=this.model.pivotControl._selectedAxis=this._selectedAxis=="schemaRow"?"rows":this._selectedAxis=="schemaColumn"?"columns":this._selectedAxis=="schemaValue"?"values":"filters";this._dialogTitle=this.model.pivotControl._dialogTitle=o;this._dialogHead=this.model.pivotControl._dialogHead=o;this._selectedMember=this.model.pivotControl._selectedField=u;this.model.pivotControl._dataModel=="XMLA"?(l=n(i.currentTarget).parents("li:eq(0)").attr("tag"),s=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==l)return n.filterItems}),s.length>0?this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(s)}):(t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.show(),this._selectedMember=u,parsedMDX="select {"+u+".children} dimension properties CHILDREN_CARDINALITY  on 0 from ["+this.model.pivotControl.model.dataSource.cube+"]",pData='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+parsedMDX+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+this.model.pivotControl.model.dataSource.catalog+"<\/Catalog> <\/PropertyList> <\/Properties> <\/Execute> <\/Body> <\/Envelope>",this.doAjaxPost("POST",this.model.pivotControl.model.dataSource.data,{XMLA:pData},this._generateMembers,null,{action:"fetchMembers"}))):(a=this.model.pivotControl._getTreeViewData(u,o,this._selectedAxis),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(a)}))}else if(n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"}),h=n(i.target).parent().find("a>span").attr("class"),e=this._dataModel=="Olap"?h.indexOf("hierarchyCDB")>-1||h.indexOf("attributeCDB")>-1?n(i.target).parents("li")[0]:n(i.target).parents("li")[1]:n(n(i.target).parent()).parent(),this._selectedTreeNode=e,i.target.tagName.toLowerCase()=="span"){if(this._curFilteredText=this.model.layout!="excel"?n(n(i.target).parents(".pivotButton")).find(".pvtBtn").text():this._dataModel=="Olap"?n(e).attr("tag").split(".")[1].replace(/\]/g,"").replace(/\[/g,""):n(e).find("div:first").text(),n(i.target).parents("li:eq(1)").find("div:first>a>span").hasClass("hierarchyCDB")&&(this._curFilteredText=n(i.target).parents("li:eq(1)").find("div:first>a").text()),this._dataModel=="Pivot"&&(this._curFilteredAxis=t.isNullOrUndefined(this.element.find(".e-btn:contains('"+this._curFilteredText+"')").parents(".e-droppable")[0])?"":this.element.find(".e-btn:contains('"+this._curFilteredText+"')").parents(".e-droppable")[0].className.split(" ")[0],this._dialogHead=n(i.target).parent().text()),this._dialogTitle=this._dataModel=="Olap"?n(this.element.find(".pivotButton:contains('"+n(e).find("div:first").text()+"')")[0]).attr("tag"):n(i.target).parent().text()||i.target.id.replace("filterBtn","")||n(i.target).parents(".filterBtn")[0].id.replace("filterBtn",""),this._dataModel=="Olap")for(r=0;r<this.element.find(".e-btn").length;r++)if(!t.isNullOrUndefined(n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag"))&&n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag").split(":")[1]==n(this._selectedTreeNode).attr("tag").replace(/\]/g,"").replace(/\[/g,"")&&n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag").indexOf(this._curFilteredText)>-1){this._curFilteredAxis=t.isNullOrUndefined(n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0])?"":n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0].className.split(" ")[0];this._dialogTitle=n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag");this._dialogHead=n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).text();break}try{c=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(y){c=this.model.pivotControl.getOlapReport()}sortedHeaders=this._getSortedHeaders();this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject});v=JSON.stringify(this.model.customObject);eventArgs=JSON.stringify({action:"fetchMembers",headerTag:this._dialogTitle||"UniqueName##"+n(e).attr("tag"),sortedHeaders:this.model.pivotControl._ascdes,currentReport:c,customObject:v});this.model.pivotControl._ogridWaitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.fetchMembers,eventArgs,this._fetchMemberSuccess)}},_onRemoveBtnClick:function(i){var u=n(i.target.parentElement).text(),f=n(n(this._tableTreeObj.element).find("div:contains("+u+")>span")[1]).find(".e-chk-act"),e,r,o,s;for(n(f).removeClass("e-chk-act").addClass("e-chk-inact"),n(f).children("e-chk-activeicon").removeClass("e-chk-activeicon"),r=0;r<this.model.pivotTableFields.length;r++)this.model.pivotTableFields[r].FieldHeader==u&&(this.model.pivotTableFields[r].IsSelected=!1,e=this.model.pivotTableFields[r]);n(i.target.parentElement).remove();this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});o=JSON.stringify(this.model.customObject);s=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(e),sortedHeaders:this._getSortedHeaders(),currentReport:this.model.pivotControl.getOlapReport(),customObject:o});t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show();this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,s,this._nodeStateModifiedSuccess)},_onNodeCheckChanges:function(i){if(this._isFiltered=!0,(i.value=="(All)"||i.value=="All")&&i.type=="nodeUncheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("unCheckAll"),this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this),this._dialogOKBtnObj.disable();else if((i.value=="(All)"||i.value=="All")&&i.type=="nodeCheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("checkAll"),n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-chk-indetericon"),this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this),this._dialogOKBtnObj.enable();else if(i.value!="(All)"){var r=this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),u=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)");r.length==0||r.length==1&&r[0].id[r[0].id.length-1]==0?(n(u).parent().removeClass("e-chk-inact").removeClass("e-chk-ind").addClass("e-chk-act"),u.removeClass("e-chk-indetericon").addClass("e-chk-activeicon")):i.type=="nodeCheck"&&r.length==1&&r[0].id[r[0].id.length-1]==0?u.removeClass("e-chk-indetericon").addClass("e-chk-activeicon"):r.length>0&&u.removeClass("e-chk-activeicon").addClass("e-chk-indetericon");this._dialogOKBtnObj.enable();i.type=="nodeUncheck"&&r.length+1==this._memberTreeObj.element.find("li").length&&(u.removeClass("e-chk-activeicon").removeClass("e-chk-indetericon"),this._dialogOKBtnObj.disable())}},_pivotCheckedStateModified:function(r){var f,u,a;if(this._nodeCheck==!0)return this._nodeCheck=!1,!1;var e=this.model.pivotControl._dataModel=="XMLA"?n(r.currentElement).attr("tag"):this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(t){return t.caption==n(r.currentElement).find("a")[0].textContent})[0].name:n(r.currentElement).find("a")[0].textContent,v=this.model.pivotControl._dataModel=="XMLA"?n(r.currentElement).attr("tag"):n(r.currentElement).find("a")[0].textContent,s="",h="",l="",c="",o=this.model.pivotControl._dataModel=="XMLA"?"XMLA":"",s=[];for(f=0;f<this.element.find(".pivotButton").length;f++)if(l=n(this.element.find(".pivotButton")[f]).find("button").attr("fieldName"),l==e&&(s.push(this.element.find(".pivotButton")[f]),o=="XMLA"))break;for(f=0;f<this.model.pivotTableFields.length;f++)this.model.pivotTableFields[f].name==e&&r.type=="nodeCheck"?(this.model.pivotTableFields[f].isSelected=!0,h=this.model.pivotTableFields[f]):this.model.pivotTableFields[f].name==e&&r.type=="nodeUncheck"&&(this.model.pivotTableFields[f].isSelected=!1,h=this.model.pivotTableFields[f]);if(r.type=="nodeUncheck")if(s.length>1)for(f=0;f<s.length;f++)n(s[f]).find("button").attr("fieldName")==e&&n(s[f]).remove();else n(s).remove();try{c=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(y){c=this.model.pivotControl.getOlapReport()}o=="XMLA"&&c==""&&(c=this.model.pivotControl.model.dataSource,this._selectedMember=e,this._selectedTreeNode=n(r.currentElement),this.model.pivotControl.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeStateModefied"}));u=this._droppedClass!=""?this._droppedClass:h.pivotType!=i?h.pivotType=="PivotItem"?"schemaRow":"schemaValue":"schemaRow";this._droppedClass="";r.type=="nodeCheck"?(o=="XMLA"?(n(r.currentElement).attr("tag").indexOf("[Measures]")<0&&!(n(r.currentElement).find(".namedSetCDB").length>0)?n(r.currentElement.find(".e-text")[0]).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML):"",n(r.currentElement).attr("tag").toLocaleLowerCase().indexOf("[measures]")>=0&&(u="schemaValue")):n(r.currentElement.find(".e-text")[0]).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),droppedItem=n(r.currentElement).find(".namedSetCDB").length>0?{fieldName:n(r.currentElement).attr("tag"),fieldCaption:n(r.currentElement).text(),isNamedSets:!0}:{fieldName:e,fieldCaption:v},u=u==""?"row":u=="schemaColumn"?"column":u=="schemaRow"?"row":u=="schemaValue"?"value":u=="schemaFilter"?"filter":"",this._createPivotButton(droppedItem,u,"","",""),o=="XMLA"&&u=="value"?(this.model.pivotControl.model.dataSource.values.length==0&&this.model.pivotControl.model.dataSource.values.push({measures:[],axis:"columns"}),measuresAxis=this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns:":"Rows:",this.element.find("div[tag='"+measuresAxis+"Measures']").length==0&&this._createPivotButton({fieldName:"Measures",fieldCaption:"Measures"},measuresAxis=="Columns:"?"column":"row","","",""),this.model.pivotControl.model.dataSource.values[0].measures.push(droppedItem)):u=="row"?this.model.pivotControl.model.dataSource.rows.push(droppedItem):u=="column"?this.model.pivotControl.model.dataSource.columns.push(droppedItem):u=="filter"?this.model.pivotControl.model.dataSource.filters.push(droppedItem):this.model.pivotControl.model.dataSource.values.push(droppedItem),o=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeCheck"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:u,fieldItem:r.currentElement}),this.model.pivotControl._populatePivotGrid())):r.type=="nodeUncheck"&&(n(r.currentElement).removeClass("filter").find(".filter").remove(),n(r.currentElement).removeClass("filter").find(".treeDrop").remove(),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=e}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=e}),a=this.model.pivotControl.model.dataSource.values,o=="XMLA"?(t.olap._mdxParser._getItemPosition(this.model.pivotControl.model.dataSource.values[0].measures,e).length>0&&this.model.pivotControl.model.dataSource.values[0].measures.splice(t.olap._mdxParser._getItemPosition(this.model.pivotControl.model.dataSource.values[0].measures,e)[0],1),this.model.pivotControl.model.dataSource.values[0].measures.length==0&&this.element.find("div[tag='"+(this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns":"Rows")+":Measures']").remove()):this.model.pivotControl.model.dataSource.values=n.grep(a,function(n){return n.fieldName!=e}),this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=e}),o=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeUncheck"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(u=u==""?"row":u=="schemaColumn"?"column":u=="schemaRow"?"row":u=="schemaValue"?"value":u=="schemaFilter"?"filter":"",this._trigger("fieldItemDropped",{axis:u,fieldItem:r.currentElement}),this.model.pivotControl._populatePivotGrid()))},_onCheckedStateModified:function(i){var k,d,y,c,a,p,w,u,s,f,g,tt,r,b,o;if(this.model.pivotControl._isUpdateRequired=!0,this._isMeasureBtnRemove==!0)return this._isMeasureBtnRemove=!1,!1;if(this._nodeCheck==!0)return this._nodeCheck=!1,!1;var e=n(i.currentElement).find("a")[0].textContent,v="",nt="",h="",u="",l="";if(this._dataModel=="Olap")if(!i.currentElement[0].id.indexOf("[Measures]")>-1){for(r=0;r<this.element.find(".pivotButton").length;r++)if(u=n(this.element.find(".pivotButton")[r]).attr("tag"),l="",l=u.indexOf("[Measures]")>-1||u.indexOf("[")>-1?u.split(":")[1]:this.model.pivotControl._getNodeUniqueName(u),l=l.replace("<>","."),n(i.currentElement).attr("tag").toLowerCase()==l.toLowerCase()){h=n(this.element.find(".pivotButton")[r]);break}}else h=this.element.find(".pivotButton:contains("+e+")"),u,s;else h=this.element.find(".pivotButton:contains("+e+")"),u,s;for(k=h.length>0&&n(h).siblings(".filterIndicator").length>0?!0:!1,d=i.currentElement.find("~ span:eq(0) span.descending").length>0?!0:!1,r=0;r<this.model.pivotTableFields.length;r++)this.model.pivotTableFields[r].name==e&&i.type=="nodeCheck"?(this.model.pivotTableFields[r].isSelected=!0,u=this.model.pivotTableFields[r]):this.model.pivotTableFields[r].name==e&&i.type=="nodeUncheck"&&(this.model.pivotTableFields[r].isSelected=!1,u=this.model.pivotTableFields[r]);if(t.isNullOrUndefined(u)&&(u=n(i.currentElement).attr("tag")),i.type=="nodeUncheck")if(h.length>1)for(r=0;r<h.length;r++)n(h[r]).text()==e&&n(h[r]).remove();else n(h).remove();else this._droppedClass!=""?this._createPivotButton(e,this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaValue"?"value":this._droppedClass=="schemaFilter"?"filter":"",k,d,""):this._createPivotButton(e,this._dataModel=="Olap"&&n(i.currentElement).attr("tag").indexOf("[Measures]")<0||this._dataModel=="Pivot"&&u.pivotType=="PivotItem"?"row":"value",k,d,"");if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)if(!t.isNullOrUndefined(this._tempFilterData[r][e]))for(y=0;y<this._tempFilterData[r][e].length;y++)nt+="##"+this._tempFilterData[r][e][y];try{s=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(it){s=this.model.pivotControl.getOlapReport()}if(v="schemaRow::"+e+"::FILTERED"+nt,c=this._droppedClass!=""?this._droppedClass:u.pivotType=="PivotItem"?"schemaRow":"schemaValue",this._droppedClass="",this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),i.type=="nodeCheck"||i.type=="nodeUncheck"||c==""){if(i.type=="nodeCheck")this._dataModel=="Olap"?(n(i.currentElement).attr("tag").indexOf("[Measures]")==-1&&(w=t.buildTag("span.e-icon").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(w).hide())),this._nodeDropedParams=c=="schemaColumn"?"Categorical":c=="schemaRow"?"Series":c=="schemaFilter"?"Slicer":"",u=n(i.currentElement).attr("tag"),a=this._nodeDropedParams==""?n(i.currentElement).attr("tag").indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,u.toLowerCase().indexOf("[measures]")>-1&&(a="Categorical"),p=this._currentCubeName+"--"+u+"--"+a+"--",s,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:p,currentReport:s,gridLayout:this.model.pivotControl.model.layout,customObject:o}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._onDroppedSuccess)):(n(i.currentElement.find(".e-text")[0]).after(n(t.buildTag("span.e-icon").addClass("treeDrop")[0].outerHTML).hide()),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:c+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:v,currentReport:s,customObject:o}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess));else if(i.type=="nodeUncheck")if(this._dataModel=="Olap"){if(n(i.currentElement.find(".treeDrop")).remove(),n(i.currentElement).find(".filter").removeClass("filter"),u=n(h).attr("tag"),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:s,gridLayout:this.model.pivotControl.model.layout,customObject:o}),t.isNullOrUndefined(u))return!1;(u.indexOf("[Measures]")>=0||u.toLowerCase().indexOf("[measures]"))&&this.element.find(".schemaValue .pivotButton").length==0?(g=u.split(":"),tt=g[0]=="Rows"?".schemaRow":g[0]=="Columns"?".schemaColumn":"",this.element.find(tt+" .pivotButton:contains('Measures')").remove()):u.indexOf("[Measures]")<0&&u.indexOf("Measures")>=0&&this.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,f.replace("removeButton","removeButtonDeferUpdate"),this._onDroppedSuccess)):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,f,this._pvtBtnDroppedSuccess)}else{if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)for(b in this._tempFilterData[r])b==e&&(this._tempFilterData[r][e]=[]);if(!t.isNullOrUndefined(this.model.pivotControl._tempFilterData))for(r=0;r<this.model.pivotControl._tempFilterData.length;r++)for(b in this.model.pivotControl._tempFilterData[r])b==e&&(this.model.pivotControl._tempFilterData[r][e]=[]);n(i.currentElement).removeClass("filter").find(".filter").remove();n(i.currentElement).removeClass("filter").find(".treeDrop").remove();this.model.pivotControl._ascdes=this.model.pivotControl._ascdes.replace(e+"##","");this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});o=JSON.stringify(this.model.customObject);f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:c+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:v,currentReport:s,customObject:o});this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)}}else this._dataModel=="Pivote"?(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:c+"::"+this._droppedPosition,sortedHeaders:this.model.pivotControl._ascdes,filterParams:v,currentReport:s,customObject:o}),this._droppedPosition="",this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)):(n(i.currentElement).attr("tag").indexOf("[Measures]")==-1&&(w=t.buildTag("span.e-icon").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(w).hide())),u=n(i.currentElement).attr("tag"),a=this._nodeDropedParams==""?n(i.currentElement).attr("tag").indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,p=this._currentCubeName+"--"+u+"--"+a+"--",s,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:p,currentReport:s,customObject:o}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._onDroppedSuccess))},_onNodeDropped:function(r){var p,nt,k,ft,et,ot,tt,b,st,d,h,u,e,it,l,a,v,g,y;if(this.model.pivotControl._isUpdateRequired=!0,r.dropTarget.context!=i||r.dropTarget.className!=i){if(p=!1,this._dataModel=="Pivot")for(nt=n(r.dropTarget).parents(),u=0;u<nt.length;u++)nt[u].className.split(" ")[0]=="e-pivotgrid"&&(p=!0);if(r.dropTarget.context!=i&&r.dropTarget.context.className.indexOf("e-droppable")>=0||r.dropTarget.className!=i&&r.dropTarget.className.indexOf("e-droppable")>=0||p){this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var o=n(r.droppedElement).attr("tag"),f=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.droppedElement.text()})[0].name:this._dataModel=="XMLA"?r.droppedElement.attr("tag"):r.droppedElement.text(),ht="",w,c=this.element.find(".pivotButton:contains("+f+")"),s=this._dataModel=="XMLA"?this._tableTreeObj.element.find("li[tag='"+o+"']").length>1?r.droppedElement:this._tableTreeObj.element.find("li[tag='"+o+"']"):this._tableTreeObj.element.find("li:contains('"+f+"'):last"),rt=n(c).find(".filterIndicator").length>0?!0:!1,ut=n(c).find("~ span:eq(0) span.descending").length>0?!0:!1;if(r.dropTarget.parent().attr("role")=="presentation")return!1;if(this.model.pivotControl._dataModel=="XMLA"){if(k=n.map(n(o.split("].")),function(n){return n.lastIndexOf("]")>=0?n:n+"]"}),k.length>=2&&(ft=k[0]+"."+k[1],s=this._tableTreeObj.element.find("li[tag='"+ft+"']"),o=s.attr("tag")),et=n(r.dropTarget).hasClass("value")||n(r.dropTarget).hasClass("colheader")||n(r.dropTarget).hasClass("rowheader")||n(r.dropTarget).hasClass("summary")||n(r.dropTarget).parents("table:eq(0)").hasClass("pivotGridTable"),ot=r.droppedElement.find(".namedSetCDB").length>0&&n(r.dropTarget).hasClass("schemaFilter"),et||ot||n(r.droppedElement).attr("tag").indexOf("Measures")>=0&&!n(r.dropTarget).hasClass("schemaValue")||n(r.droppedElement).attr("tag").indexOf("Measures")<0&&n(r.dropTarget).hasClass("schemaValue"))return this._createErrorDialog(),pschemaDesignerWaitingPopup.hide(),!1;if(tt=this.model.pivotControl._getReportItem(o),b=tt.axis,tt.item.length>0&&(b=="rows"&&r.dropTarget.hasClass("schemaRow")||b=="columns"&&r.dropTarget.hasClass("schemaColumn")||b=="values"&&n(r.dropTarget).hasClass("schemaValue")||b=="filters"&&n(r.dropTarget).hasClass("schemaFilter")))return!1;if(this._tableTreeObj.isNodeChecked(this._tableTreeObj.element.find("li[tag='"+o+"']")))for(u=0;u<this.element.find(".pivotButton").length;u++)this.element.find(".pivotButton:eq("+u+")").attr("tag").split(":")[1]==o?this.element.find(".pivotButton:eq("+u+")").remove():""}else if(this._dataModel=="Olap"&&(n(r.droppedElement).attr("tag").indexOf("Measures")>=0&&n(r.dropTarget).hasClass("schemaFilter")||n(r.droppedElement).attr("tag").indexOf("Measures")<0&&n(r.dropTarget).hasClass("schemaValue")))return this._createErrorDialog(),pschemaDesignerWaitingPopup.hide(),!1;if(n(s).find(".filter").remove(),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(c=[],u=0;u<this.element.find(".pivotButton").length;u++)uniqueName=n(this.element.find(".pivotButton")[u]).find("button").attr("fieldName"),uniqueName==f&&c.push(this.element.find(".pivotButton")[u]);if(p)if(r.event.target.tagName=="TH"||r.event.target.tagName=="TD"){if(this._droppedClass=r.event.target.className.split(" ")[0]=="rowheader"||r.event.target.className.split(" ")[0]=="grpRow"?"schemaRow":r.event.target.className.split(" ")[0]=="colheader"?"schemaColumn":n(r.event.target).hasClass("value")?"schemaValue":"",this._droppedClass=="")return}else this._droppedClass=r.event.target.className.split(" ")[0]=="rows"||r.event.target.className.split(" ")[0]=="emptyRows"?"schemaRow":r.event.target.className.split(" ")[0]=="columns"?"schemaColumn":r.event.target.className.split(" ")[0]=="values"?"schemaValue":r.event.target.className.split(" ")[0]=="drag"?"schemaFilter":"";else this._droppedClass=r.event.target.className.split(" ")[0];if(this._dataModel=="Olap"&&(st=n(r.droppedElement).children("div:eq(0)").find(".e-checkbox").length,s=st==0?r.droppedElement.parent("ul").parent("li:eq(0)"):r.droppedElement),s.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue"))return this._tableTreeObj.checkNode(s),!1;if(s.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="pvtBtn"||this._droppedClass=="rowheader"||this._droppedClass=="colheader"||this._droppedClass=="value"&&n(r.droppedElement).attr("tag").indexOf("Measures")<0)&&(this._nodeCheck=!0,this._tableTreeObj.checkNode(s)),t.isNullOrUndefined(o))for(u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==f&&(this.model.pivotTableFields[u].isSelected=!0,o=this.model.pivotTableFields[u]);if(!t.isNullOrUndefined(this._tempFilterData))for(u=0;u<this._tempFilterData.length;u++)if(!t.isNullOrUndefined(this._tempFilterData[u][f]))for(d=0;d<this._tempFilterData[u][f].length;d++)ht+="##"+this._tempFilterData[u][f][d];if(r.droppedElement[0].tagName.toLowerCase()=="button")if(c.length>1)for(u=0;u<c.length;u++)n(c[u]).text()==f&&n(c[u]).remove();else n(c).remove();try{w=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(lt){w=this.model.pivotControl.getOlapReport()}if(this.model.pivotControl._dataModel=="XMLA"&&(w=this.model.pivotControl.model.dataSource),this._dataModel=="Pivot"||this.model.pivotControl._dataModel=="XMLA"){for(f=this.model.pivotControl._dataModel=="XMLA"?o:f,h="",h=p?this._droppedPosition="":this._droppedPosition=this._setSplitBtnTargetPos(r.event),u=0;u<this.model.pivotTableFields.length;u++)if(this.model.pivotTableFields[u].name==f){this.model.pivotTableFields[u].isSelected=!0;o=this.model.pivotTableFields[u];n(c).remove();break}s.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue")?this._tableTreeObj.checkNode(s):this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(e=this.model.pivotControl._getDroppedItem(f),e.length&&e[0].filterItems&&e[0].filterItems.values&&e[0].filterItems.values.length&&n(n(s).find(".e-text")[0]).after(t.buildTag("span.e-icon").addClass("filter")[0].outerHTML),e.length||(e[0]={fieldName:f,fieldCaption:f}),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=f}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=f}),this._dataModel!="XMLA"?this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName!=f}):this.model.pivotControl.model.dataSource.values[0].measures=n.grep(this.model.pivotControl.model.dataSource.values[0].measures,function(n){return n.fieldName!=f}),this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=f}),it=this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",this._createPivotButton(e[0],it,rt,ut,h),n.isNumeric(h)?this._droppedClass=="schemaRow"?this.model.pivotControl.model.dataSource.rows.splice(h,0,e[0]):this._droppedClass=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.splice(h,0,e[0]):this._droppedClass=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.splice(h,0,e[0]):this.model.pivotControl.model.dataSource.values.splice(h,0,e[0]):this.model.pivotControl.model.dataSource.filters.splice(h,0,e[0]):this._droppedClass=="schemaRow"?this.model.pivotControl.model.dataSource.rows.push(e[0]):this._droppedClass=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.push(e[0]):this._droppedClass=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.push(e[0]):this.model.pivotControl.model.dataSource.values.push(e[0]):this.model.pivotControl.model.dataSource.filters==null?(this.model.pivotControl.model.dataSource.filters=[],this.model.pivotControl.model.dataSource.filters.push(e[0])):this.model.pivotControl.model.dataSource.filters.push(e[0]),this.model.pivotControl._dataModel=="XMLA"?t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl):(this._trigger("fieldItemDropped",{axis:it,fieldItem:s}),this.model.pivotControl._populatePivotGrid())):(this._createPivotButton(f,this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",rt,ut,h),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),g=JSON.stringify(this.model.customObject),y=JSON.stringify({action:"nodeDropped",dropAxis:this._droppedClass+"::"+h,headerTag:JSON.stringify(o),sortedHeaders:this.model.pivotControl._ascdes,currentReport:w,customObject:g}),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,y.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,y,this._pvtNodeDroppedSuccess))}else{if(l=r.dropTarget[0]!=i&&r.dropTarget[0].className=="pivotButton"?n(r.dropTarget).parents()[0]:r.dropTarget[0]!=i&&r.dropTarget[0].tagName.toLowerCase()=="td"&&!n(r.dropTarget.parents("table.pivotGridTable")[0]).length?r.dropTarget.children(":last")[0]:r.dropTarget,this._droppedClass=l[0].className.split(" ")[0],a="",v="",a=l[0].className.split(" ")[0],n(r.dropTarget.parents("table.pivotGridTable")[0]).length){if(v=n(l).hasClass("rowheader")?"Series":n(l).hasClass("grpRow")?"Series":n(l).hasClass("rows")?"Series":n(l).hasClass("colheader")?"Categorical":n(l).hasClass("columns")?"Categorical":n(l).hasClass("value")?"Slicer":n(l).hasClass("drag")?"Slicer":"",n(r.droppedElement).attr("tag").indexOf("Measures")>0&&v=="Slicer")return this._createErrorDialog(),!1}else v=a=="columns"?"Categorical":a=="schemaColumn"?"Categorical":a=="rows"?"Series":a=="schemaRow"?"Series":a=="drag"?"Slicer":a=="schemaFilter"?"Slicer":"";v==""&&(v=this.element.find(".schemaRow .pivotButton:contains('Measures')").length>0||this.element.find(".schemaRow .pivotButton:contains('MEASURES')").length>0?"Series":"Categorical");var h=this._setSplitBtnTargetPos(r.event),ct=this._currentCubeName+"--"+o+"--"+v+"--"+h;this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});g=JSON.stringify(this.model.customObject);y=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:ct,filterParams:"",currentReport:w,gridLayout:this.model.pivotControl.model.layout,customObject:g});this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,y.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,y,this._onDroppedSuccess)}}}},_onPvtBtnDropped:function(r){var h,o,nt,a,c,tt,b,y,f,k,d,it,g,rt;this.model.pivotControl._isUpdateRequired=!0;this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var l=null,v="",s="",e,u,p=!1,w=!1;if(this._dataModel=="Olap"||this.model.pivotControl._dataModel=="XMLA")l=r.target.className.indexOf("pvtBtn")>-1?n(r.target).parents(".e-droppable")[0]:r.target.className.indexOf("e-droppable")?r.target:r.target[0].tagName.toLowerCase()=="td"?r.target.children(":last")[0]:r.target,v=l.className.split(" ")[0]=="schemaColumn"?"Categorical":l.className.split(" ")[0]=="schemaRow"?"Series":l.className.split(" ")[0]=="schemaFilter"?"Slicer":"",v==""&&r.element.parent().attr("tag").indexOf("[Measures]")>-1&&(v=this.element.find(".schemaRow .pivotButton:contains('Measures')").length>0?"Series":"Categorical"),this.model.pivotControl._dataModel=="XMLA"?e=s=n(r.element.parent()[0]).attr("tag").split(":")[1]:s=n(r.element.parent()[0]).attr("tag"),u=l.className.split(" ")[0];else for(e=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.element.text()})[0].name:r.element.text(),u=r.target.className.indexOf("e-droppable")>=0?r.target.className.split(" ")[0]:r.target.className.split(" ")[0]=="pvtBtn"?n(r.target).parents("div.e-droppable").attr("class").split(" ")[0]:"",s,p=r.element.find("~ .filterIndicator").length>0?!0:!1,w=r.element.find("~ span:eq(0) span.descending").length>0?!0:!1,h=0;h<this.model.pivotTableFields.length;h++)this.model.pivotTableFields[h].name==e&&(this.model.pivotTableFields[h].isSelected=!0,s=this.model.pivotTableFields[h]);if(this.element.find(".dragClone").remove(),this._dataModel=="Olap"&&(s.split(":")[1].toLocaleUpperCase()=="MEASURES"&&(u!="schemaColumn"||u!="schemaRow")&&(u=="schemaFilter"||u=="schemaValue")||s.toUpperCase().indexOf("[MEASURES]")>-1&&u!="schemaValue"&&(u=="schemaRow"||u=="schemaColumn"||u=="schemaFilter")||s.toUpperCase().indexOf("[MEASURES]")==-1&&u=="schemaValue"))return this._createErrorDialog(),!1;if(u=="schemaValue"||u=="schemaRow"||u=="schemaColumn"||u=="schemaFilter"){o=this._setSplitBtnTargetPos(r.event);try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(ut){a=this.model.pivotControl.getOlapReport()}if(a==""&&this.model.pivotControl._dataModel=="XMLA"){if(this.model.pivotControl.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"}),tt=u=="schemaFilter"&&this.model.pivotControl._getNodeByUniqueName(e)!=null&&this.model.pivotControl._getNodeByUniqueName(e).find(".namedSetCDB").length>0,b=n(r.element.parent()).attr("tag").split(":")[0]=="Columns"&&this._droppedClass=="schemaColumn"&&s.toLowerCase()=="measures"||n(r.element.parent()).attr("tag").split(":")[0]=="Rows"&&this._droppedClass=="schemaRow"&&s.toLowerCase()=="measures",b||tt||e.toLowerCase().indexOf("[measures]")>=0&&u!="schemaValue"||u=="schemaValue"&&!(e.toLowerCase().indexOf("[measures]")>=0)||u=="schemaFilter"&&e.toLowerCase().indexOf("measures")>=0)return pschemaDesignerWaitingPopup.hide(),b||this._createErrorDialog(),r.Cancel;if(e.indexOf("Measures")>=0&&!(e.indexOf("[Measures]")>=0))return n(r.element.parent()).remove(),this.model.pivotControl.model.dataSource.values[0].axis=u=="schemaRow"?"rows":u=="schemaColumn"?"columns":"columns",this._createPivotButton({fieldName:"Measures",fieldCaption:"Measures"},u=="schemaRow"?"row":u=="schemaColumn"?"column":"column","","",o),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl),pschemaDesignerWaitingPopup.hide(),!1}n(r.element.parent()).remove();this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this._dataModel=="Olap"?(nt=this._currentCubeName+"--"+s+"--"+v+"--"+o,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),y=JSON.stringify(this.model.customObject),c=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:nt,currentReport:a,gridLayout:this.model.pivotControl.model.layout,customObject:y}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,c.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,c,this._onDroppedSuccess)):(this._createPivotButton(e,u=="schemaRow"?"row":u=="schemaColumn"?"column":u=="schemaFilter"?"filter":u=="schemaValue"?"value":"",p,w,o),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),y=JSON.stringify(this.model.customObject),c=JSON.stringify({action:"nodeDropped",dropAxis:u+"::"+o,headerTag:JSON.stringify(s),sortedHeaders:this.model.pivotControl._ascdes,currentReport:a,customObject:y}),successMethod=this.model.pivotControl._renderControlSuccess,this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,c.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,c,this._pvtNodeDroppedSuccess))):(f=this.model.pivotControl._getDroppedItem(e),k={},f.length>0&&(k=f[0].isNamedSets!=i?{fieldName:f[0].fieldName,fieldCaption:f[0].fieldCaption,isNamedSets:f[0].isNamedSets}:{fieldName:f[0].fieldName,fieldCaption:f[0].fieldCaption}),d=u=="schemaRow"?"row":u=="schemaColumn"?"column":u=="schemaFilter"?"filter":u=="schemaValue"?"value":"",this._createPivotButton(k,d,p,w,o),n.isNumeric(o)?u=="schemaRow"?this.model.pivotControl.model.dataSource.rows.splice(o,0,f[0]):u=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.splice(o,0,f[0]):u=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.splice(o,0,f[0]):this.model.pivotControl.model.dataSource.values.splice(o,0,f[0]):this.model.pivotControl.model.dataSource.filters.splice(o,0,f[0]):u=="schemaRow"?this.model.pivotControl.model.dataSource.rows.push(f[0]):u=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.push(f[0]):u=="schemaValue"?this.model.pivotControl.model.dataSource.values.push(f[0]):this.model.pivotControl.model.dataSource.filters.push(f[0]),this.model.pivotControl._dataModel=="XMLA"&&(it=this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns:":"Rows:",g=this.element.find("div[tag='"+it+"Measures']"),g.appendTo(g.parent()),rt=r.element.attr("axis").toLowerCase(),this.model.pivotControl.model.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"})),this.model.pivotControl._dataModel=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:d,fieldItem:f}),this.model.pivotControl._populatePivotGrid()))}else this._removePvtBtn(r)},_createErrorDialog:function(){var r=t.buildTag("div#preventDiv").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML,i;n("body").append(r);this.element.find(".errorDialog").length==0?(i=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent","The field you are moving cannot be placed in that area of the report.")[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title","Warning")[0].outerHTML,this.element.append(i),this.element.find(".errorDialog").ejDialog({target:"#"+this._id,enableResize:!1,width:"400px"}),this._errorDialog=this.element.find(".errorDialog").data("ejDialog"),n("#"+this._errorDialog._id+"_wrapper").css({left:"50%",top:"50%"}),this.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._errOKBtnClick,this)})):this._errorDialog.open()},_errOKBtnClick:function(){this.model.pivotControl._onPreventPanelClose();this._errorDialog._ejDialog.find("div.e-dialog-icon").trigger("click")},_hideSchemaDesigner:function(){n("#PivotSchemaDesigner").animate({left:"-"+n("#"+this._id).width()+"px"},500,function(){});this.element.find(".collapseSchema").addClass("expandSchema").removeClass("collapseSchema")},_showSchemaDesigner:function(){n("#PivotSchemaDesigner").animate({left:"5px"});this.element.find(".expandSchema").addClass("collapseSchema").removeClass("expandSchema")},_reSizeHandler:function(){if(this.model.pivotControl!=null&&this.model.pivotControl.model.isResponsive){var t=!0,i=n("#"+this._id).parent().width();i<750&&t?(n("#"+this._id).css({position:"absolute"}),n("#"+this.model.pivotControl._id).width("100%"),t=!1,this.element.find(".responsiveSchema").addClass("expandSchema").removeClass("responsiveSchema"),this._hideSchemaDesigner(),this._tableTreeObj.option("allowDragAndDrop",!1)):i>750&&(n("#"+this._id).css({position:"static"}),n("#"+this.model.pivotControl._id).width(parseInt(100-n("#"+this._id).width()/n(window).width()*100)-4+"%"),this.element.find(".expandSchema, .collapseSchema").addClass("responsiveSchema").removeClass("expandSchema").removeClass("collapseSchema"),this._tableTreeObj.option("allowDragAndDrop",!0),t=!0)}},_dialogBtnClick:function(r){var o,v,k,c,f,d,y,u,tt,it,g,h,b,nt;if(this.model.pivotControl._onPreventPanelClose(),this.element.find(".e-dialog, .clientDialog").hide(),!this._isFiltered)return!1;if(this.model.pivotControl._isUpdateRequired=!0,this.model.pivotControl!=null&&(this.model.pivotControl._memberTreeObj=this._memberTreeObj),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(r.model.text.toLowerCase()=="cancel")return;o=[];v=[];this.model.pivotControl._dataModel=="XMLA"?(k=this._selectedMember,this.model.pivotControl._currentReportItems=n.grep(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()!=k.toLocaleLowerCase())return n}),this._memberTreeObj=this.model.pivotControl._updateTreeView(this),this.model.pivotControl._currentReportItems.push({filterItems:this._memberTreeObj.dataSource(),fieldName:this._selectedMember}),o=n.map(this.model.pivotControl._getSelectedNodes().split("::"),function(n){return{Id:n.split("||")[0],tag:n.split("||")[1],parentId:n.split("||")[2]}}),c=this._selectedMember!=i?this._selectedMember.toLocaleLowerCase():this._selectedMember.toLocaleLowerCase(),f=n.map(this.model.pivotControl.model.dataSource.columns,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==c)return n}),f.length==0&&(f=n.map(this.model.pivotControl.model.dataSource.rows,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==c)return n})),f.length==0&&(f=n.map(this.model.pivotControl.model.dataSource.filters,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==c)return n})),f.length>0&&(this._getUnSelectedNodes()!=""&&(this.model.pivotControl.model.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"filtering"})),f[0].filterItems={filterType:"include",values:this.model.pivotControl._removeSelectedNodes(o)},this._selectedTreeNode=this.element.find(".schemaFieldList").find("li[tag='"+f[0].fieldName+"']"),n(this._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(n(this._selectedTreeNode).parents("li:eq(0)"))),this._getUnSelectedNodes()==""?(this._selectedTreeNode.find(".filter").remove(),delete f[0].filterItems):n(n(this._selectedTreeNode)).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").addClass("filter")[0].outerHTML),this.element.find(".pivotButton:contains('"+this._selectedMember+"') .filter").addClass("filtered"))),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"filtering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(n,t){t.value!="All"&&o.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(n,t){v.push(t.value)}),this.element.find(".e-dialog, .clientDialog").hide(),this.model.pivotControl._pivotFilterItems(o,v),this.model.pivotControl._populatePivotGrid())}else{if(d="",r.model.text.toLowerCase()!="cancel"){var s=this._dataModel=="Olap"?d=this._getUnSelectedNodes()+"FILTERED"+this.model.pivotControl._getSelectedNodes(this._curFilteredAxis=="schemaFilter"?!0:!1):this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),l=!1,e=this._dataModel=="Olap"?s:this._curFilteredAxis+"::"+this._curFilteredText+"::FILTERED",p=this._curFilteredText,w=[],a={};if(y=this._getUnSelectedNodes()!=""?!0:!1,this._dataModel=="Pivot"){for(u=0;u<s.length;u++)w.push(n(s[u].parentElement).siblings("a").text());for(a[p]=w,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][p])||(this._tempFilterData[u][p]=w,l=!0);if(l||this._tempFilterData.push(a),this.model.pivotControl._tempFilterData=this._tempFilterData,t.isNullOrUndefined(this._curFilteredAxis)||this._curFilteredAxis!="")for(u=0;u<s.length;u++)e+="##"+n(s[u].parentElement).siblings("a").text()}else{for(a[this._curFilteredText]=e,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][this._curFilteredText])||(this._tempFilterData[u][this._curFilteredText]=e,l=!0);l||this._tempFilterData.push(a)}if(tt=this._getSortedHeaders(),it=this.model.layout=="excel"?this.element.find(".schemaFieldTree li:contains('"+this._curFilteredText+"')"):this.element.find("."+this._curFilteredAxis+" .pivotButton:contains("+this._curFilteredText+") .filterBtn"),this.model.layout=="excel"&&(n(this._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(n(this._selectedTreeNode).parents("li:eq(0)"))),y&&n(n(this._selectedTreeNode)).find(".filter").length<=0?(g=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,n(n(this._selectedTreeNode).find(".e-text")[0]).after(g)):y||n(this._selectedTreeNode).find(".filter").remove(),this._curFilteredAxis==""))return!1;try{h=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(rt){h=this.model.pivotControl.getOlapReport()}this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject});b=JSON.stringify(this.model.customObject);nt=this.model.pivotControl.model.customObject!={}&&e!=""?JSON.stringify({action:"filtering",filterParams:e,sortedHeaders:this.model.pivotControl._ascdes,currentReport:h,gridLayout:this.model.pivotControl.model.layout,customObject:b}):this.model.pivotControl.model.customObject!={}?JSON.stringify({action:"filtering",currentReport:h,customObject:b}):e!=""?JSON.stringify({action:"filtering",filterParams:e,sortedHeaders:this.model.pivotControl._ascdes,currentReport:h}):JSON.stringify({action:"filtering"});t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.pivotControl.model.enableDeferUpdate?(this.model.pivotControl._filterUpdate.push(e),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide(),this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,nt,this._filterElementSuccess)}this._selectedTreeNode=null}},_onBeforeNodeExpand:function(n){this.model.pivotControl._onBeforeNodeExpand(n)},_onNodeExpand:function(n){this.model.pivotControl._onNodeExpand(n)},_nodeStateModifiedSuccess:function(n){this.model.pivotControl._isUpdateRequired=!0;n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(n):this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_pvtNodeDroppedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(n):this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_pvtBtnDroppedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject});this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_filterElementSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject});this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_fetchChildNodeSuccess:function(t){var r,u,f;t.length>1&&t[0]!=i?(r=JSON.parse(t[0].Value),t[1]!=null&&t[1]!=i&&(this.model.customObject=t[1].Value)):t.d!=i?(r=JSON.parse(t.d[0].Value),t.d[1]!=null&&t.d[1]!=i&&(this.model.customObject=t.d[1].Value)):(r=JSON.parse(t.ChildNodes),t.customObject!=null&&t.customObject!=i&&(this.model.customObject=t.customObject));f={id:"id",parentId:"pid",hasChild:"hasChildren",text:"name",isChecked:"checkedStatus"};u=n(this.pNode).parents("li").length>1?n(this.pNode).parents("li").first():n(this.pNode).parents("li");n(n(u).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this._memberTreeObj._createSubNodesWhenLoadOnDemand(r,this.pNode,f);n.each(n(u).children().find("li"),function(n,t){t.setAttribute("tag",r[n].tag)});this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject});this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_fetchMemberSuccess:function(n){n[0]!=i&&n.length>0?(this._currentMembers=n[0].Value,n[1]!=null&&n[1]!=i&&(this.model.customObject=n[1].Value)):n.d!=i&&n.d.length>0?(this._currentMembers=n.d[0].Value,n.d[1]!=null&&n.d[1]!=i&&(this.model.customObject=n.d[1].Value)):n!=i&&n.length>0?(this._currentMembers=n.EditorTreeInfo,n!=null&&n.customObject!=i&&(this.model.customObject=n.customObject)):n!=i&&(this._currentMembers=n.EditorTreeInfo,n!=null&&n.customObject!=i&&(this.model.customObject=n.customObject));this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject});this._createDialog(this._dialogHead,this._currentMembers);this.model.pivotControl._ogridWaitingPopup.hide();this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_onDroppedSuccess:function(r){var u=null;this.model.pivotControl.model.enableDeferUpdate?u=this._removeButtonDeferUpdate==!1?t.isNullOrUndefined(r.OlapReport)?JSON.parse(r.d[0].Value):JSON.parse(r.OlapReport):u=t.isNullOrUndefined(r.OlapReport)?r.d[0].Value:r.OlapReport:(!t.isNullOrUndefined(r[0])&&r.length>0?(u=JSON.parse(r[1].Value),r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value)):!t.isNullOrUndefined(r.d)&&r.d.length>0?(u=JSON.parse(r.d[1].Value),r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value)):t.isNullOrUndefined(r)||t.isNullOrUndefined(r.OlapReport)||(u=JSON.parse(r.OlapReport)),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject));this._removeButtonDeferUpdate==!1&&(this.element.find(".axisTable .pivotButton").remove(),this._setPivotRows(u.PivotRows),this._setPivotColumns(u.PivotColumns),this._setPivotCalculations(u.PivotCalculations),this._setFilters(u.Filters),this.element.find(".axisTable .schemaFilter").append(this._createPivotButtons(this.model.filters,"filter")),this.element.find(".axisTable .schemaRow").append(this._createPivotButtons(this.model.pivotRows,"row")),this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons(this.model.pivotColumns,"column")),this.element.find(".axisTable .schemaValue").append(this._createPivotButtons(this.model.pivotCalculations,"values")),this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)}),this._unWireEvents(),this._wireEvents());this.model.pivotControl.model.enableDeferUpdate?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide(),t.isNullOrUndefined(r.OlapReport)?(this.model.pivotControl.setOlapReport(r.d[0].Value),n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=i&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(r.d[2].Value),JSON.parse(r.d[1].Value))):(this.model.pivotControl.setOlapReport(r.OlapReport),r.HeaderCounts!=i&&n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=i&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(r.HeaderCounts),JSON.parse(r.PageSettings))),this._removeButtonDeferUpdate=!1,this.model.pivotControl._deferUpdateSuccess(r)):this.model.pivotControl._renderControlSuccess(r);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_removePvtBtn:function(i){var o=i.element.text(),r=i.element.parent().attr("tag"),e,s,u,h,f;try{e=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(c){e=this.model.pivotControl.getOlapReport()}if(e==""&&this.model.pivotControl._dataModel=="XMLA"&&(e=this.model.pivotControl.model.dataSource),this._dataModel=="Olap")if(u=r.indexOf("[Measures]")>-1||r.indexOf("[")>-1?r.split(":")[1]:this.model.pivotControl._getNodeUniqueName(r),u=u.indexOf("<>")?u.replace("<>","."):u,u=="[Measures]"){for(n(i.element.remove()),f=0;f<this.model.pivotCalculations.length&&r.indexOf("Measures")>-1;f++)u=this.model.pivotCalculations[f].Tag,this._isMeasureBtnRemove=!0,selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(u),this._tableTreeObj.uncheckNode(selectedTreeNode);this.model.pivotControl._ogridWaitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject});h=JSON.stringify(this.model.customObject);s=JSON.stringify({action:"removeButton",headerInfo:r,currentReport:e,customObject:h,gridLayout:this.model.pivotControl.model.layout});r.indexOf("[Measures]")<0&&r.indexOf("Measures")>=0&&this.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,s.replace("removeButton","removeButtonDeferUpdate"),this._onDroppedSuccess),this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,s,this._pvtBtnDroppedSuccess)}else selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(u),this._tableTreeObj.uncheckNode(selectedTreeNode);else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(o=i.element.attr("fieldName"),this.model.pivotControl._dataModel=="XMLA"){if(r.split(":")[1].toLowerCase()=="measures"){for(this.model.pivotControl._ogridWaitingPopup.show(),this.element.find("div[tag='"+r+"']").remove(),f=0;f<this.model.pivotControl.model.dataSource.values[0].measures.length;f++)this._nodeCheck=!0,selectedTreeNode=this._tableTreeObj.element.find("li[tag='"+this.model.pivotControl.model.dataSource.values[0].measures[f].fieldName+"']"),this._tableTreeObj.uncheckNode(selectedTreeNode),this.element.find("div[tag='values:"+this.model.pivotControl.model.dataSource.values[0].measures[f].fieldName+"']").remove();this.model.pivotControl.model.dataSource.values[0].measures=[];t.olap.base.getJSONData({action:"removeButton"},this.model.pivotControl.model.dataSource,this.model.pivotControl)}selectedTreeNode=this._tableTreeObj.element.find("li[tag='"+o+"']");selectedTreeNode.length>1?selectedTreeNode[0]:selectedTreeNode}else selectedTreeNode=this._tableTreeObj.element.find("li:contains('"+o+"')");this._tableTreeObj.uncheckNode(selectedTreeNode)}else selectedTreeNode=this._tableTreeObj.element.find("li:contains('"+o+"')"),this._tableTreeObj.uncheckNode(selectedTreeNode)},_createDialog:function(r,u){var v=t.buildTag("div#preventDiv").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML,s,e,o,h,f,c,l,a;n("body").append(v);this.element.find(".e-dialog, .clientDialog").remove();var y=t.buildTag("div#EditorDiv.editorDiv",t.buildTag("div",t.buildTag("div.memberEditorDiv",t.buildTag("div#editorTreeView.editorTreeView")[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML+"<\/br>",p=t.buildTag("div",t.buildTag("button#OKBtn.dialogOKBtn",this._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#CancelBtn.dialogCancelBtn",this._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,w=t.buildTag("div#clientDialog.clientDialog",y+p,{opacity:"1"}).attr("title",r)[0].outerHTML,u=JSON.parse(u);for(f=0;f<u.length;f++)u[f].name==" "&&(u[f].name="[Blank]");if(this.model.pivotControl._dataModel=="XMLA"&&(e=n.Enumerable.From(this.model.pivotControl.model.dataSource.rows).Where(function(n){return n.fieldName==r}).Select(function(n){return n}).ToArray(),e.length==0&&(e=n.Enumerable.From(this.model.pivotControl.model.dataSource.columns).Where(function(n){return n.fieldName==r}).Select(function(n){return n}).ToArray()),e.length==0&&(e=n.Enumerable.From(this.model.pivotControl.model.dataSource.filters).Where(function(n){return n.fieldName==r}).Select(function(n){return n}).ToArray()),e.length>0&&e[0].filters!=i&&(e[0].filters.members,n.map(u,function(t,i){var r=n.inArray(u[i].tag.replace(/\&/g,"&amp;"),e[0].filters.members);r>=0&&(u[i].checkedStatus=!0)}))),!t.isNullOrUndefined(this._tempFilterData)){for(f=0;f<this._tempFilterData.length;f++)t.isNullOrUndefined(this._tempFilterData[f][r])||(s=this._tempFilterData[f][r]);if(!t.isNullOrUndefined(s))for(f=0;f<s.length;f++)for(o=0;o<u.length;o++)s[f]==u[o].name&&(u[o].checkedStatus=!1)}for(n(w).appendTo("#"+this._id),this.element.find(".editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,height:n(".memberEditorDiv").height(),fields:{id:"id",text:"name",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:u}}),h=this.element.find(".editorTreeView").find("li"),f=0;f<h.length;f++)h[f].setAttribute("tag",u[f].tag);this.element.find(".dialogOKBtn, .dialogCancelBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._dialogBtnClick,this)});this._dialogOKBtnObj=this.element.find(".dialogOKBtn").data("ejButton");this._memberTreeObj=this.element.find(".editorTreeView").data("ejTreeView");c=this.element.find(".editorTreeView li:gt(0)");l=n(c).find(":input.nodecheckbox:not(:checked)");l.length>0&&(a=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),n(a).removeClass("e-chk-activeicon").addClass("e-chk-indetericon"));this.element.find(".clientDialog").ejDialog({width:265,target:"#"+this._id,enableResize:!1,close:this.model.pivotControl._onPreventPanelClose});this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this);this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this);this._dataModel=="XMLA"?this._memberTreeObj.model.beforeExpand=t.proxy(this._onBeforeNodeExpand,this):this._memberTreeObj.model.nodeClick=t.proxy(this._onNodeExpand,this);this._memberTreeObj.element.find(".e-plus").length==0&&this._memberTreeObj.element.find(".e-item").css("padding","0px");this._isFiltered=!1;this._unWireEvents();this._wireEvents();t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.hide()},_createPivotButton:function(i,r,u,f,e){var s=r=="row"?".schemaRow":r=="column"?".schemaColumn":r=="value"?".schemaValue":".schemaFilter",h,o,c;if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)h=r=="column"?"Columns":r=="row"?"Rows":r=="filter"?"Slicers":"values",o=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+i.fieldName,this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.name==i.fieldName})[0].caption:i.fieldName,{},{fieldName:i.fieldName,axis:h})[0].outerHTML+t.buildTag("span.removePivotBtn","",{display:"none"}).addClass("e-icon")[0].outerHTML).attr("tag",h+":"+i.fieldName)[0].outerHTML;else var h=r=="column"?"Columns":r=="row"?"Rows":r=="filter"?"Slicers":"values",l=(r=="column"||r=="row")&&this.model.layout!="excel"?t.buildTag("input#toggleBtn"+i,{}).attr("type","checkbox")[0].outerHTML:"",a=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"?t.buildTag("button.filterBtn#filterBtn"+i,{}).addClass(u?"filterIndicator":"")[0].outerHTML:"",o=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+i,this._dataModel=="Pivot"?i:i=="Measures"?i:i.split(".")[1])[0].outerHTML+l+a+t.buildTag("span.removePivotBtn","",{display:"none"}).addClass("e-icon")[0].outerHTML).attr("tag",h+":"+i)[0].outerHTML;typeof e=="number"&&n(this.element.find(s+" .pivotButton")[e]).length>0?r=="row"?n(this.element.find(".schemaRow .pivotButton")[e]).before(o):r=="column"?n(this.element.find(".schemaColumn .pivotButton")[e]).before(o):r=="value"?n(this.element.find(".schemaValue .pivotButton")[e]).before(o):r=="filter"?n(this.element.find(".schemaFilter .pivotButton")[e]).before(o):"":r=="row"?this.element.find(".schemaRow").append(o):r=="column"?this.element.find(".schemaColumn").append(o):r=="value"?this.element.find(".schemaValue").append(o):r=="filter"?this.element.find(".schemaFilter").append(o):"";c=typeof e!="number"&&e==""?" .pivotButton .pvtBtn:last":" .pivotButton .pvtBtn:eq("+e+")";this.element.find(s+c).ejButton({size:"normal",type:t.ButtonType.Button}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)});this.element.find(s+" .pivotButton .filterBtn:last").ejButton({size:"normal",type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"filter"});this.element.find(s+" .pivotButton input:last").ejToggleButton({size:"normal",contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._onSortBtnClick,this)});f&&(this.element.find(s+" .pivotButton:contains("+i+") span:eq(0) span").removeClass("ascending").addClass("descending"),this.element.find(s+" .pivotButton:contains("+i+") span:eq(0) button").addClass("e-active"));this.element.find(".dropIndicator").removeClass("dropIndicatorHover")},_createPivotButtons:function(i,r){var e,f,o,s,u,h,c;if(!t.isNullOrUndefined(i)){if(e="",f=r=="column"?"Columns":r=="row"?"Rows":r=="filter"?"Slicers":"",this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(f=r=="column"?"Columns":r=="row"?"Rows":r=="filter"?"Slicers":"values",f=="values"&&this.model.pivotControl._dataModel=="XMLA"&&(i=n.map(i,function(n){return n.kpi||n.measures})),u=0;u<i.length;u++)o=this.model.pivotControl._dataModel=="XMLA"?"":i[u].fieldName,e+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+o,this.model.pivotControl._dataModel=="XMLA"?i[u].fieldName||i[u]:n.grep(this.model.pivotTableFields,function(n){return n.name==i[u].fieldName})[0].caption||n.grep(this.model.pivotTableFields,function(n){return n.name==i[u]})[0].caption,{},{fieldName:i[u].fieldName||i[u],axis:f})[0].outerHTML+t.buildTag("span.removePivotBtn","",{display:"none"}).addClass("e-icon")[0].outerHTML).attr("tag",f+":"+i[u].fieldName||i[u])[0].outerHTML;else for(f==""&&r=="values"&&(s=this.element.find(".pivotButton:contains('Measures')").length>0?this.element.find(".pivotButton:contains('Measures')").parent()[0].className.split(" ")[0]:"schemaColumn",f=s=="schemaColumn"?"Columns":"Rows"),u=0;u<i.length;u++)h=(r=="column"||r=="row")&&this.model.layout!="excel"?t.buildTag("input#toggleBtn"+i[u].FieldHeader||i[u].FieldName,{}).attr("type","checkbox")[0].outerHTML:"",c=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"?t.buildTag("button.filterBtn#filterBtn"+(i[u].FieldHeader||i[u].FieldName||i[u].Name||i[u].DimensionName),{})[0].outerHTML:"",e+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+i[u].FieldHeader||i[u].FieldName||i[u].Name||i[u].DimensionName,i[u].FieldHeader||i[u].FieldName||i[u].Name||i[u].DimensionName)[0].outerHTML+h+c+t.buildTag("span.removePivotBtn","",{display:"none"}).addClass("e-icon")[0].outerHTML).attr("tag",f+":"+i[u].Tag)[0].outerHTML;return e}},_setSplitBtnTargetPos:function(t){var o="",e,r,u,f;if(t.event!=i&&t.event.type=="touchend"?(r=t.event.originalEvent.target!=null?n(t.event.originalEvent.target).parents(".pivotButton"):n(t.event.originalEvent.srcElement).parents(".pivotButton"),u=t.event.originalEvent.target!=null?t.event.originalEvent.target.className:t.event.originalEvent.srcElement.className):(r=t.originalEvent.target!=null?n(t.originalEvent.target).parents(".pivotButton"):n(t.originalEvent.srcElement).parents(".pivotButton"),u=t.originalEvent.target!=null?t.originalEvent.target.className:t.originalEvent.srcElement.className),this._droppedClass=r.length>0?n(r[0]).parent()[0].className.split(" ")[0]:u.split(" ")[0],r[0]||u!=i&&u!=null&&jQuery.type(u)=="string"&&u.indexOf("pivotButton")>-1)for(r=r[0]?r[0]:t.originalEvent.target!=null?t.originalEvent.target:t.originalEvent.srcElement,e=t.event!=i&&t.event.type=="touchend"?t.target:this._droppedClass!=null&&this._droppedClass!=i&&this._droppedClass!=""?this.element.find("."+this._droppedClass)[0]:r.parentNode,f=0;f<e.children.length;f++)n(e.childNodes[f]).attr("tag")==n(r).attr("tag")&&(o=f);return o},_getUnSelectedNodes:function(){for(var r,f=this.element.find(".editorTreeView")[0],u="",i=n(f).find(":input.nodecheckbox:not(:checked)"),t=0;t<i.length;t++)n(i[t].parentElement).find("span:nth-child(1)").attr("class").indexOf("e-chk-act")>-1||n(i[t].parentElement).attr("aria-checked")=="mixed"||(r=n(i[t]).parents("li:eq(0)"),u+="::"+r[0].id+"||"+n(r).attr("tag"));return u},_getSelectedNodes:function(t){var o,s,e,r,i;if(t){var h=this.element.find(".editorTreeView")[0].childNodes[0],f=[],u=n(h).children();for(r=0;r<u.length;r++){if(i=u[r],o={caption:n(i.firstChild).find("a").text(),parentId:i.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(i).parents()[1].id,id:i.id,checked:n(i).find(":input.nodecheckbox")[0].checked||n(i).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(i.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(i).attr("tag")},n(i).find("ul:first").children().length>0)for(s=n(i).find("ul:first").children(),e=0;e<s.length;e++)o.childNodes.push(this._getNodeInfo(s[e]));f.push(o)}return JSON.stringify(f)}var h=n(".editorTreeView"),f="",u=n(h).find(":input.nodecheckbox");for(r=0;r<u.length;r++)(u[r].checked||n(u[r].parentElement).attr("aria-checked")=="mixed")&&(i=n(u[r]).parents("li:eq(0)"),f+="::"+i[0].id+"||"+n(i).attr("tag"));return f},_getNodeInfo:function(t){var u={caption:n(t.firstChild).find("a").text(),parentId:t.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(t).parents()[1].id,id:t.id,checked:n(t).find(":input.nodecheckbox")[0].checked||n(t).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(t.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(t).attr("tag")},r,i;if(n(t).find("ul:first").children().length>0)for(r=n(t).find("ul:first").children(),i=0;i<r.length;i++)u.childNodes.push(this._getNodeInfo(r[i]));return u},doAjaxPost:function(t,r,u,f,e){var o=u.XMLA==i?"application/json; charset=utf-8":"text/xml",s=u.XMLA==i?"json":"xml",u=u.XMLA==i?u:u.XMLA;n.ajax({type:t,url:r,contentType:o,dataType:s,data:u,success:n.proxy(f,this),complete:n.proxy(e,this),error:function(){this.model.pivotControl._ogridWaitingPopup.hide()}})},_generateTreeViewData:function(){pschemaDesignerWaitingPopup.show();isElement=!1;tree=[];reportItemNames=[];var n={catlog:this.model.pivotControl.model.dataSource.catalog,cube:this.model.pivotControl.model.dataSource.cube,url:this.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(n,this._loadDiemnsionElements)},_loadDiemnsionElements:function(t){var f,e,u,r;for(pschemaDesignerWaitingPopup.show(),f={},e={},u=0;u<n(t).find("row").length;u++){var o=n(n(t).find("row")[u]),i=o.find("DIMENSION_UNIQUE_NAME").text(),s=o.find("DIMENSION_CAPTION").text();i.toLowerCase()=="[measures]"?e={hasChildren:!0,isSelected:!1,id:i,name:s,spriteCssClass:i.toLowerCase()=="[measures]"?"folderCDB e-icon":"dimensionCDB e-icon",tag:i}:!n(n(t).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&(f={hasChildren:!0,isSelected:!1,id:i,name:s,spriteCssClass:"dimensionCDB e-icon",tag:i},tree.push(f))}tree.splice(0,0,e);r={catlog:this.model.pivotControl.model.dataSource.catalog,cube:this.model.pivotControl.model.dataSource.cube,url:this.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this.model.olap.showNamedSets?(r.request="MDSCHEMA_SETS",this._getTreeData(r,this._loadNamedSetElements)):(r.request="MDSCHEMA_HIERARCHIES",this._getTreeData(r,this._loadHierarchyElements))},_loadNamedSetElements:function(t){var u,r;pschemaDesignerWaitingPopup.show();var o={catlog:this.model.pivotControl.model.dataSource.catalog,cube:this.model.pivotControl.model.dataSource.cube,url:this.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},f=this.model.pivotControl!=i?this.model.pivotControl.model.dataSource:this.model.dataSource,e=n.map(f.rows,function(n){if(n.fieldName!=i)return n.fieldName});for(n.merge(e,n.map(f.columns,function(n){if(n.fieldName!=i)return n.fieldName})),n.merge(e,n.map(f.filters,function(n){if(n.fieldName!=i)return n.fieldName})),measureGroupItems=[],u=0;u<n(t).find("row").length;u++)r=n(n(t).find("row")[u]),n.inArray(r.find("DIMENSIONS").text().split(".")[0],measureGroupItems)>=0||(treeNodeElement={hasChildren:!0,isSelected:!1,pid:r.find("DIMENSIONS").text().split(".")[0],id:r.find("SET_DISPLAY_FOLDER").text()+"_"+r.find("DIMENSIONS").text().split(".")[0],name:r.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"folderCDB e-icon namedSets"},tree.push(treeNodeElement),measureGroupItems.push(r.find("DIMENSIONS").text().split(".")[0])),treeNodeElement={hasChildren:!0,isSelected:n.inArray("["+n.trim(r.children("SET_NAME").text())+"]",e)>=0,pid:r.find("SET_DISPLAY_FOLDER").text()+"_"+r.find("DIMENSIONS").text().split(".")[0],id:"["+n.trim(r.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:r.children("SET_CAPTION").text(),spriteCssClass:"namedSetCDB e-icon",tag:r.find("EXPRESSION").text()},tree.push(treeNodeElement);o.request="MDSCHEMA_HIERARCHIES";this._getTreeData(o,this._loadHierarchyElements)},_loadHierarchyElements:function(t){var s,l,u;pschemaDesignerWaitingPopup.show();var c={catlog:this.model.pivotControl.model.dataSource.catalog,cube:this.model.pivotControl.model.dataSource.cube,url:this.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},e=this.model.pivotControl!=i?this.model.pivotControl.model.dataSource:this.model.dataSource,o=n.map(e.rows,function(n){if(n.fieldName!=i)return n.fieldName});for(n.merge(o,n.map(e.columns,function(n){if(n.fieldName!=i)return n.fieldName})),n.merge(o,n.map(e.filters,function(n){if(n.fieldName!=i)return n.fieldName})),s={},l="",u=0;u<n(t).find("row").length;u++){var r=n(n(t).find("row")[u]),h=r.find("DIMENSION_UNIQUE_NAME").text(),f=r.find("HIERARCHY_UNIQUE_NAME").text(),a=n.Enumerable.From(tree).Where(function(n){return n.tag==h}).Select(function(n){return n}).ToArray();a.length>0&&h!=f&&(s={hasChildren:!0,isSelected:n.inArray(f,o)>=0,pid:h,id:f,name:r.find("HIERARCHY_CAPTION").text(),spriteCssClass:r.find("HIERARCHY_ORIGIN").text()!="2"&&r.find("HIERARCHY_ORIGIN").text()!="6"?"hierarchyCDB e-icon":"attributeCDB e-icon",tag:f},tree.push(s))}c.request="MDSCHEMA_LEVELS";this._getTreeData(c,this._loadLevelElements)},_loadLevelElements:function(t){var i,t;pschemaDesignerWaitingPopup.show();i=n.map(n(t).find("row"),function(t){if(parseInt(n(t).children("LEVEL_TYPE").text())!="1"&&n(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase()!="[measures]")return treeNodeElement={hasChildren:!1,isChecked:!1,id:n(t).find("LEVEL_UNIQUE_NAME").text(),pid:n(t).find("HIERARCHY_UNIQUE_NAME").text(),name:n(t).find("LEVEL_NAME").text(),spriteCssClass:"level"+parseInt(n(t).children("LEVEL_NUMBER").text())+" e-icon",tag:n(t).find("LEVEL_UNIQUE_NAME").text()}});n.merge(tree,i);isElement==0&&(t={catlog:this.model.pivotControl.model.dataSource.catalog,cube:this.model.pivotControl.model.dataSource.cube,url:this.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_MEASURES"},this._getTreeData(t,this._loadMeasureElements),isElement=1)},_loadMeasureElements:function(t){var e,l,f;pschemaDesignerWaitingPopup.show();var s={catlog:this.model.pivotControl.model.dataSource.catalog,cube:this.model.pivotControl.model.dataSource.cube,url:this.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},h=this.model.pivotControl!=i?this.model.pivotControl.model.dataSource:this.model.dataSource,c=n.map(h.values,function(n){if(n.measures!=i)return n.measures});for(reportItemNames=n.map(c,function(n){if(n.fieldName!=i)return n.fieldName}),e=[],l="",f=0;f<n(t).find("row").length;f++){var o=n(n(t).find("row")[f]),r=o.children("MEASUREGROUP_NAME").text(),u=o.find("MEASURE_UNIQUE_NAME").text();n.inArray(r,e)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"[Measures]",id:r,name:r,spriteCssClass:"measureGroupCDB e-icon",tag:r},tree.push(treeNodeElement),e.push(r));treeNodeElement={hasChildren:!0,isSelected:n.inArray(u,reportItemNames)>=0,id:u,pid:r,name:o.children("MEASURE_CAPTION").text(),tag:u};tree.push(treeNodeElement);n.inArray(u,reportItemNames)>=0&&reportItemNames.splice(reportItemNames.indexOf(u),1)}this.model.olap.showKpi?(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI Elements",spriteCssClass:"KPICDB folderCDB e-icon",tag:""},tree.splice(1,0,treeNodeElement),s.request="MDSCHEMA_KPIS",this._getTreeData(s,this._loadKPIElements)):this._createTreeView(this,tree)},_loadKPIElements:function(t){var f;pschemaDesignerWaitingPopup.show();var a=this.model.pivotControl!=i?this.model.pivotControl.model.dataSource:this.model.dataSource,e=reportItemNames,l=[];for(f=0;f<n(t).find("row").length;f++){var u=n(n(t).find("row")[f]),r=u.children("KPI_NAME").text(),o=u.children("KPI_goal").text(),s=u.children("KPI_STATUS").text(),h=u.children("KPI_TREND").text(),c=u.find("KPI_VALUE").text();n.inArray(u.children("KPI_NAME").text(),l)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:r,name:r,spriteCssClass:"measureGroupCDB e-icon",tag:r},tree.push(treeNodeElement),l.push(r));treeNodeElement={hasChildren:!0,isSelected:n.inArray(o,e)>=0,id:o,pid:r,name:"Goal",tag:o};tree.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(s,e)>=0,id:s,pid:r,name:"Status",tag:s};tree.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(h,e)>=0,id:h,pid:r,name:"Trend",tag:h};tree.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(c,reportItemNames)>=0,id:c,pid:r,name:"Value",tag:c};tree.push(treeNodeElement)}this._createTreeView(this,tree)},_getTreeData:function(n,t){var i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+n.request+"<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+n.catlog+"<\/CATALOG_NAME><CUBE_NAME>"+n.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.catlog+"<\/Catalog><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";this.doAjaxPost("POST",n.url,{XMLA:i},t)}});t.PivotSchemaDesigner.Locale={};t.PivotSchemaDesigner.Locale["en-US"]={PivotTableFieldList:"PivotTable Field List",ChooseFieldsToAddToReport:"Choose fields to add to report:",DragFieldBetweenAreasBelow:"Drag fields between areas below:",ReportFilter:"Report Filter",ColumnLabel:"Column Label",RowLabel:"Row Label",Values:"Values",DeferLayoutUpdate:"Defer Layout Update",Update:"Update",OK:"OK",Cancel:"Cancel"};t.PivotSchemaDesigner.Layouts={Excel:"excel",Normal:"normal"}})(jQuery,Syncfusion)});
