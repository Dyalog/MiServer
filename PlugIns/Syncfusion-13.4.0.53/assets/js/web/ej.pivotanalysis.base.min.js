/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 13.4.0.53
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function(n,t,i){var u=[],r=[],e=[],f=null,l=[],a=[],c=[],v=0,y=0,s="",o={},h=[];t.PivotAnalysis={pivotEnginePopulate:function(s){var d=s.columns,k=s.rows,rt=s.filters,it=s.values,yt=[],ft=[],ct,g,ut,nt,tt,p,pt,et,wt,bt,w,st,b;for(h=[],g=0;g<it.length;g++)h.push(it[g].summaryType!=null&&it[g].summaryType!=i?it[g].summaryType:t.PivotAnalysis.SummaryType.TotalSum);if(s.data!=null)for(ct=0;ct<s.data.length;ct++){list=s.data[ct];var ot={keys:[],uniqueName:"",value:null},lt={keys:[],uniqueName:"",value:null},at={keys:[],uniqueName:"",value:null},ht={keys:[],uniqueName:"",value:null},vt=!1;for(g=0;g<rt.length;g++)if(p=this._getReflectedValue(list,rt[g].fieldName),o[rt[g].fieldName]==i||o[rt[g].fieldName]==null?o[rt[g].fieldName]=[p]:n.inArray(p,o[rt[g].fieldName])==-1&&o[rt[g].fieldName].push(p),rt[g].filterItems!=null&&rt[g].filterItems!=i&&((rt[g].filterItems.filterType==t.PivotAnalysis.FilterType.Exclude||rt[g].filterItems.filterType==null)&&n.inArray(p.toString(),rt[g].filterItems.values)>=0||rt[g].filterItems.filterType==t.PivotAnalysis.FilterType.Include&&n.inArray(p.toString(),k[nt].filterItems.values)<0)){vt=!0;break}for(ut=0;ut<it.length;ut++)p="",it[ut]!=i&&it[ut]!=null&&(p=this._getReflectedValue(list,it[ut].fieldName),o[it[ut].fieldName]==i||o[it[ut].fieldName]==null?o[it[ut].fieldName]=[p]:n.inArray(p,o[it[ut].fieldName])==-1&&o[it[ut].fieldName].push(p)),n.isNumeric(p)?ht.keys.push(p):ht.keys.push(1);for(nt=0;nt<k.length;nt++){if(p="",k[nt]!=i&&k[nt]!=null&&(p=this._getReflectedValue(list,k[nt].fieldName),o[k[nt].fieldName]==i||o[k[nt].fieldName]==null?o[k[nt].fieldName]=[p]:n.inArray(p,o[k[nt].fieldName])==-1&&o[k[nt].fieldName].push(p),k[nt].filterItems!=null&&k[nt].filterItems!=i&&((k[nt].filterItems.filterType==t.PivotAnalysis.FilterType.Exclude||k[nt].filterItems.filterType==null)&&n.inArray(p.toString(),k[nt].filterItems.values)>=0||k[nt].filterItems.filterType==t.PivotAnalysis.FilterType.Include&&n.inArray(p.toString(),k[nt].filterItems.values)<0))){vt=!0;break}lt.keys.push(p);lt.uniqueName+=lt.uniqueName==""?p:"."+p;ot.keys.push(p);ot.uniqueName+=ot.uniqueName==""?p:"."+p}for(tt=0;tt<d.length;tt++){if(p="",d[tt]!=i&&d[tt]!=null&&(p=this._getReflectedValue(list,d[tt].fieldName),o[d[tt].fieldName]==i||o[d[tt].fieldName]==null?o[d[tt].fieldName]=[p]:n.inArray(p,o[d[tt].fieldName])==-1&&o[d[tt].fieldName].push(p),d[tt].filterItems!=null&&d[tt].filterItems!=i&&((d[tt].filterItems.filterType==t.PivotAnalysis.FilterType.Exclude||d[tt].filterItems.filterType==null)&&n.inArray(p.toString(),d[tt].filterItems.values)>=0||d[tt].filterItems.filterType==t.PivotAnalysis.FilterType.Include&&n.inArray(p.toString(),d[tt].filterItems.values)<0))){vt=!0;break}at.keys.push(p);at.uniqueName+=at.uniqueName==""?p:"."+p;ot.keys.push(p);ot.uniqueName+=ot.uniqueName==""?p:"."+p}for(vt||(this._isMemberExist("row",lt,n.extend(!0,{},ht)),this._isMemberExist("column",at,n.extend(!0,{},ht)),this._isMemberExist("calc",ot,n.extend(!0,{},ht))),jQuery.each(list,function(n){jQuery.inArray(n,ft)==-1&&ft.push(n)}),pt=[],et=0;et<ft.length;et++)wt=n.grep(s.rows,function(n){return n.fieldName==ft[et]}).length>0||n.grep(s.columns,function(n){return n.fieldName==ft[et]}).length>0||n.grep(s.values,function(n){return n.fieldName==ft[et]}).length>0||n.grep(s.filters,function(n){return n.fieldName==ft[et]}).length>0,pt.push({id:ft[et],name:ft[et],isSelected:wt,spriteCssClass:""})}for(k.length>0&&(r=this._sortHeaders(r,k,0)),d.length>0&&(u=this._sortHeaders(u,d,0)),bt=it.length>1?1:2,d.length>0&&this._insertTotalHeader(bt,d,u),k.length>0?this._insertTotalHeader(2,k,r):r[0].keys[0]="GrandTotal",v=0,y=0,it.length>0&&this._calculateValues(s),a=[],l=[],u=[],r=[],e=[],w=0;w<v-1;w++)for(b=0;b<y-1;b++)c[b]==i&&(c[b]=[]),f[w]!=i&&f[w][b]!=i?c[b][w]={Index:b+","+w,CSS:f[w][b].CSS,Value:typeof f[w][b]=="string"||typeof f[w][b]=="number"||typeof f[w][b]=="object"?f[w][b].Value==0?"":f[w][b].Value==i?"":f[w][b].Value:"",State:f[w][b].State,RowSpan:f[w][b].RowSpan!=i?f[w][b].RowSpan:1,ColSpan:f[w][b].ColSpan!=i?f[w][b].ColSpan:1,Info:"",Span:"None",Expander:f[w][b].Expander}:f[w]!=i&&(c[b][w]={Index:b+","+w,CSS:"none",Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0});for(f=[],w=0;w<y-1;w++){if(k.length=k.length==0?1:k.length,w<k.length)for(st=0;st<d.length+1;st++)yt.push({Index:w+","+st,CSS:"none",Value:"",State:0,ColSpan:w==0&&st==0?k.length:1,RowSpan:w==0&&st==0?d.length+1:1,Info:"",Span:"None",Expander:0});for(b=0;b<v-1;b++)c[w]==i||c[w][b]==i||b<d.length+1&&w<k.length||yt.push(c[w][b])}return c=[],s.rows[0]==i&&(s.rows.length=0),{json:yt,report:s,treeviewData:pt}},getMembers:function(n){return o[n]},_sortHeaders:function(i,r,u){for(var f=[],s=[],e=0,o=r[u].sortOrder!=null&&r[u].sortOrder==t.PivotAnalysis.SortOrder.Descending?n.Enumerable.From(i).OrderByDescending("$.keys["+u+"]").ToArray():n.Enumerable.From(i).OrderBy("$.keys["+u+"]").ToArray(),h;e<o.length;)h=o[e].keys[u],f=n.grep(o,function(n){return n.keys[u]==h}),f.length>1&&u+1<o[e].keys.length&&(f=this._sortHeaders(f,r,u+1)),s=s.concat(f),e+=f.length;return s},_getReflectedValue:function(t,i){return n(t).prop(i)},_isMemberExist:function(n,i,f){var o,a,c,s,l;switch(n){case"row":for(a=!1,r.length==0&&r.push(i),c=0;c<r.length;c++)if(i.uniqueName==r[c].uniqueName){a=!0;o=c;break}if(a)for(s=0;s<f.keys.length;s++)if(r[o].value==null){r[o].value=f;break}else r[o].value.keys[s]+=f.keys[s];else r.push(i);break;case"column":for(a=!1,u.length==0&&u.push(i),c=0;c<u.length;c++)if(i.uniqueName==u[c].uniqueName){a=!0;o=c;break}if(a)for(s=0;s<f.keys.length;s++)if(u[o].value==null){u[o].value=f;break}else u[o].value.keys[s]+=f.keys[s];else u.push(i);break;case"calc":for(a=!1,e.length==0&&e.push(i),c=0;c<e.length;c++)if(i.uniqueName==e[c].uniqueName){a=!0;o=c;break}if(a)for(s=0;s<f.keys.length;s++)if(e[o].value==null){for(e[o].value=f,e[o].value.count=1,l=0;l<f.keys.length;l++)h[l]==t.PivotAnalysis.SummaryType.Count&&(e[o].value.keys[l]=e[o].value.count);break}else e[o].value.count++,e[o].value.keys[s]=this._getSummaryValue(e[o].value.keys[s],f.keys[s],e[o].value.count,h[s]);else for(e.push(i),e[e.length-1].value=f,l=0;l<f.keys.length;l++)h[l]==t.PivotAnalysis.SummaryType.Count&&(e[e.length-1].value.keys[l]=1),e[e.length-1].value.count=1}},_getSummaryValue:function(n,i,r,u){switch(u){case t.PivotAnalysis.SummaryType.TotalSum:n+=i;break;case t.PivotAnalysis.SummaryType.Average:n=(n*(r-1)+i)/r;Math.floor(n)!=n&&(n=Number(n.toFixed(2)));break;case t.PivotAnalysis.SummaryType.Minimum:n=r==1?i:Math.min(n,i);break;case t.PivotAnalysis.SummaryType.Maximum:n=r==1?i:Math.max(n,i);break;case t.PivotAnalysis.SummaryType.Count:n=r}return n},_insertTotalHeader:function(n,t,r){var c,f,h,e,l,s,o,u;if(t.length<=1){r.push({cellType:"RGTot",keys:["GrandTotal"],tot:"sub"});return}for(c=-1,f=t.length-n;f>=0;f--)if(c++,h=r.length,h>0)for(e=r[0].uniqueName.split("."),l=r[0].keys[c],e=e.slice(0,f+1).join("."),s="",o=0,u=1;u<=h;u++)r[u]!=i?(s=r[u].uniqueName.split("."),s=s.slice(0,f+1).join("."),newTxt=r[u].keys[f+1]):s=i,s!=i&&s.indexOf("Total")==-1?e!=i&&s!=e&&(r.splice(u,0,{keys:[e.split(".")[f]+" Total"],cellType:"SubTot",uniqueName:e,level:f}),r[o].span==i&&(r[o].span=[]),r[o].span[f]=u-o,u++,h++,e=s,o=u,l=newTxt):e!=i&&(r.splice(u,0,{keys:[e.split(".")[f]+" Total"],cellType:"SubTot:",uniqueName:e,level:f}),r[o].span==i&&(r[o].span=[]),r[o].span[f]=u-o,u++,h++,e=s,o=u,l=newTxt);r.push({cellType:"RGTot",keys:["GrandTotal"]})},_isPreviousLevelEqual:function(n,t,i,r){for(var u=r-1;u>=0;u--)return n[t].keys[u]!=n[i].keys[u]?!0:!1},_calculateValues:function(n){var t=r.length+1,o=u.length==0?0:u.length*n.values.length+1,i,e;f=new Array(t+n.rows.length+1);this._populateRowHeaders(n,t+n.rows.length+1,n.rows.length==0?1:n.rows.length);i=n.columns.length+1;e=o+(n.rows.length==0?1:n.rows.length);this._populateColumnHeaders(n,i,e);this._populateCalcTable(n);v=t+i;y=e},_populateRowHeaders:function(n,t,u){var o,p,y,e,v;if(r.length!=0){for(o=n.columns.length+1,f=[],p=n.rows.length,y="",e=0;e<r.length;e++){y=r[e];var c=0,h=0,l=0,a=0;if(r[e].keys!=i&&r[e].keys.length!=0)for(f[o]=new Array(u),a=r[e].keys.length,kCnt=0;kCnt<a;kCnt++)r[e].cellType!=i?r[e].cellType.indexOf("SubTot")>-1?(h=r[e].level+c,l=u-r[e].level,s="summary"):(s="summary",h=c,l=n.rows.length):(s="rowheader",h=c,l=1),v=a>1?a-kCnt>1?1:0:0,f[o][h]={Index:h+","+o,CSS:s,Value:r[e].keys[kCnt],State:v,RowSpan:r[e].span!=i?r[e].span[kCnt]:1,ColSpan:l,Info:"",Span:"None",Expander:v},c++;o++}s=""}},_populateColumnHeaders:function(n,t){var r,c,o;if(u.length!=0){var l=tempCnt=n.rows.length==0?1:n.rows.length,h=n.values.length,a=n.columns.length,v="",e=colKLen=0;for(r=0;r<u.length;r++){for(e=0,tempRIndx=0,tempRSpan=0,tempCSpan=0,v=u[r].keys,f[e]==i&&(f[e]=[]),colKLen=u[r].keys.length,kCnt=0;kCnt<colKLen;kCnt++){for(f[e]==i&&(f[e]=[]),u[r].cellType!=i?u[r].cellType.indexOf("SubTot")>-1?(tempRIndx=u[r].level+e,tempRSpan=t-u[r].level-1,s="summary"):(tempRIndx=e,tempRSpan=n.columns.length,s="summary"):(tempRIndx=e,tempRSpan=1,s="colheader"),c=colKLen>1?colKLen-kCnt>1?1:0:0,o=0;o<h;o++)f[tempRIndx][h*r+o+tempCnt]={Index:l+","+tempRIndx,CSS:s,Value:u[r].keys[kCnt],State:c,ColSpan:(u[r].span!=i?u[r].span[kCnt]:1)*h,RowSpan:tempRSpan,Info:"",Span:"None",Expander:c};e++}for(o=0;o<h;o++)f[e]==i&&(f[e]=[]),f[a][h*r+o+tempCnt]={Index:h*r+o+tempCnt+","+e,CSS:s+" calc",Value:n.values[o].fieldName,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0};l++}s=""}},_populateCalcTable:function(o){for(var ht,rt,d,k,et,v,g,tt,c=[],w=o.values.length,p=o.rows.length==0?1:o.rows.length,b=o.columns.length+1,ot=0,ut=!1,it=0,st=b,nt,ft=!1,y=0;y<r.length;y++){for(a=[],nt=p,ut=!0,f[y+b]==i&&(f[y+b]=[]),l[it]=[],cCnt=0;cCnt<u.length;cCnt++){if(c=[],s="value",o.columns.length>0&&o.rows.length>0?n.grep(e,function(n){if(n.uniqueName==r[y].uniqueName+"."+u[cCnt].uniqueName)for(v=0;v<n.value.keys.length;v++)c.push(n.value.keys[v]);return}):o.rows.length==0?n.grep(e,function(n){if(n.uniqueName==u[cCnt].uniqueName)for(v=0;v<n.value.keys.length;v++)c.push(n.value.keys[v]);return}):n.grep(e,function(n){if(n.uniqueName==r[y].uniqueName)for(v=0;v<n.value.keys.length;v++)c.push(n.value.keys[v]);return}),u[cCnt].cellType!=i&&(u[cCnt].cellType.indexOf("SubTot")>-1||u[cCnt].cellType.indexOf("RGTot")>-1)){for(c=[],v=0;v<w;v++)for(g=0,d=0,k=nt;k<=cCnt*w+p;k++)f[y+b]!=i&&f[y+b][nt+g*w+v]!=i&&f[y+b][nt+g*w+v].Value!=i&&(c[v]==i&&(c[v]=0),d++,c[v]=this._getSummaryValue(c[v],f[y+b][nt+g*w+v].Value,d,h[v]=="count"?"totalsum":h[v])),g++;ot=0;nt=(cCnt+1)*w+p;c!=0&&a.push({uniqueName:u[cCnt].uniqueName,level:u[cCnt].level,value:c});u[cCnt-1].cellType!=i&&u[cCnt-1].cellType.indexOf("SubTot")>-1&&u[cCnt-1].cellType.indexOf("RGTot")==-1&&(rt=n.Enumerable.From(a).Where(function(n){return n!=i&&n.uniqueName!=i&&u[cCnt].uniqueName!=i&&n.level!=i&&u[cCnt].level!=i&&n.uniqueName.indexOf(u[cCnt].uniqueName)===0&&u[cCnt].level+1==n.level}).Select(function(n){for(var t=0;t<n.value.length;t++)c[t]==i&&(c[t]=0),c[t]+=n.value[t];return c}).ToArray(),c!=0&&a.push({uniqueName:u[cCnt].uniqueName,level:u[cCnt].level,value:c}));s="summary value"}if(u[cCnt].cellType!=i&&u[cCnt].cellType.indexOf("RGTot")>-1&&c==0&&(c=[],rt=n.Enumerable.From(a).Where(function(n){return n!=i&&n!=i&&n.level!=i&&n.level==0}).Select(function(n){for(var t=0;t<n.value.length;t++)c[t]==i&&(c[t]=0),c[t]+=n.value[t];return c}).ToArray(),s="summary value"),r[y].cellType!=i&&(r[y].cellType.indexOf("SubTot")>-1||r[y].cellType.indexOf("RGTot")>-1)){for(c=[],ht=r[y].uniqueName,r[y-1].cellType!=i&&r[y-1].cellType.indexOf("SubTot")>-1&&r[y].cellType.indexOf("RGTot")==-1&&(rt=n.Enumerable.From(l).Where(function(n){return n[0]!=i&&n[0].uniqueName!=i&&r[y].uniqueName!=i&&n[0].level!=i&&r[y].level!=i&&n[0].uniqueName.indexOf(r[y].uniqueName)===0&&r[y].level+1==n[0].level}).Select(function(n){if(n[p+cCnt].length>0)for(var t=0;t<n[p+cCnt].length;t++)c[t]==i&&(c[t]=0),c[t]+=n[p+cCnt][t];return c}).ToArray()),r[y].cellType!=i&&r[y].cellType.indexOf("RGTot")>-1&&(d=0,rt=n.Enumerable.From(l).Where(function(n){return n!=i&&n[0]!=i&&n[0].level!=i&&n[0].level==0}).Select(function(n){if(n[p+cCnt].length>0){d++;for(var r=0;r<n[p+cCnt].length;r++)c[r]==i&&(c[r]=0),c[r]=t.PivotAnalysis._getSummaryValue(c[r],n[p+cCnt][r],d,h[r]=="count"?"totalsum":h[r])}return c}).ToArray()),d=1,k=st;k<=y+b;k++){for(et=!1,v=0;v<w;v++)g=0,f[k]!=i&&f[k][p+cCnt*w+v]!=i&&f[k][p+cCnt*w+v].Value!=i&&(c[v]==i&&(c[v]=0),et=!0,c[v]=this._getSummaryValue(c[v],f[k][p+cCnt*w+v].Value,d,h[v]=="count"?"totalsum":h[v])),g++;et&&d++}ot=0;ft=!0;ut&&(l[it][0]={uniqueName:r[y].uniqueName,level:r[y].level},ut=!1);l[it][p+cCnt]=c;s="summary value"}for(tt=0;tt<w;tt++)f[b+y][w*cCnt+tt+p]=c!=i&&c.length!=i?{Index:w*cCnt+tt+p+","+b+y,CSS:s,Value:c[tt],State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0}:0}ft&&(it++,st=y+b+1,ft=!1)}return f}};t.PivotAnalysis.SortOrder={Ascending:"ascending",Descending:"descending"};t.PivotAnalysis.FilterType={Exclude:"exclude",Include:"include"};t.PivotAnalysis.SummaryType={TotalSum:"totalsum",Average:"average",Count:"count",Minimum:"minimum",Maximum:"maximum"}})(jQuery,Syncfusion)});