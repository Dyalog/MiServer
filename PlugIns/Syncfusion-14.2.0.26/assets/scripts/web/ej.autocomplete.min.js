/*!
*  filename: ej.autocomplete.min.js
*  version : 14.2.0.26
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.globalize.min","jquery-easing","./../common/ej.core.min","./../common/ej.data.min","./../common/ej.scroller.min"],n):n()})(function(){(function(n,t,i){t.widget("ejAutocomplete","ej.Autocomplete",{element:null,model:null,validTags:["input"],_ignoreOnPersist:["fields","dataSource","query","focusIn","focusOut","change","select","create","destroy","open","close","actionComplete","actionSuccess","actionFailure"],_setFirst:!1,_rootCSS:"e-autocomplete",type:"editor",angular:{require:["?ngModel","^?form","^?ngModelOptions"]},defaults:{dataSource:null,query:null,fields:{text:null,key:null,category:null,groupBy:null,htmlAttributes:null},locale:"en-US",template:null,allowGrouping:!1,enableDistinct:!1,allowSorting:!0,sortOrder:"ascending",htmlAttributes:{},multiSelectMode:"none",delimiterChar:",",allowAddNew:!1,addNewText:"Add New",showRoundedCorner:!1,readOnly:!1,cssClass:"",watermarkText:null,value:"",selectValueByKey:null,filterType:"startswith",caseSensitiveSearch:!1,showLoadingIcon:!0,showResetIcon:!1,itemsCount:0,minCharacter:1,delaySuggestionTimeout:200,showPopupButton:!1,highlightSearch:!1,enableAutoFill:!1,enableRTL:!1,enabled:!0,visible:!0,height:"",width:"",emptyResultText:"No suggestions",animateType:"slide",showEmptyResultText:!0,enablePersistence:!1,popupHeight:"152px",popupWidth:"auto",autoFocus:!1,multiColumnSettings:{enable:!1,showHeader:!0,stringFormat:"{0}",columns:[{field:null,headerText:null}]},validationRules:null,validationMessage:null,focusIn:null,focusOut:null,change:null,select:null,create:null,open:null,close:null,destroy:null,actionBegin:null,actionComplete:null,actionSuccess:null,actionFailure:null},dataTypes:{autoFocus:"boolean",watermarkText:"string",locale:"string",cssClass:"string",filterType:"enum",caseSensitiveSearch:"boolean",showLoadingIcon:"boolean",template:"string",allowGrouping:"boolean",enableDistinct:"boolean",allowSorting:"boolean",sortOrder:"enum",allowAddNew:"boolean",addNewText:"string",showRoundedCorner:"boolean",showResetIcon:"boolean",readOnly:"boolean",itemsCount:"number",animateType:"enum",minCharacter:"number",showPopupButton:"boolean",highlightSearch:"boolean",enableAutoFill:"boolean",enableRTL:"boolean",multiSelectMode:"enum",delimiterChar:"string",emptyResultText:"string",showEmptyResultText:"boolean",enabled:"boolean",visible:"boolean",enablePersistence:"boolean",dataSource:"data",query:"data",fields:"data",validationRules:"data",validationMessage:"data",htmlAttributes:"data",multiColumnSettings:"data"},observables:["value","selectValueByKey"],value:t.util.valueFunction("value"),_selectValueByKey:t.util.valueFunction("selectValueByKey"),enable:function(){this.model.enabled||(this.model.enabled=!0,this.target.disabled=!1,this.element.removeClass("e-disable").attr({"aria-disabled":!1}),this.element.removeAttr("disabled"),this.model.showPopupButton&&this.dropdownbutton.removeClass("e-disable").attr({"aria-disabled":!1}),this.model.multiSelectMode=="visualmode"&&this._ulBox.removeClass("e-disable").attr({"aria-disabled":!1}))},disable:function(){this.model.enabled&&(this._hideResult(),this.model.enabled=!1,this.target.disabled=!0,this.element.attr("disabled","disabled"),this.element.addClass("e-disable").attr({"aria-disabled":!0}),this.model.showPopupButton&&this.dropdownbutton.addClass("e-disable").attr({"aria-disabled":!0}),this.model.multiSelectMode=="visualmode"&&this._ulBox.addClass("e-disable").attr({"aria-disabled":!0}))},clearText:function(){this.model.multiSelectMode=="visualmode"&&this._deleteBox(this._ulBox.children("li"));this.element.val("");this._valueChange();this._isFocused?this.element.blur():this._focusOutAction();this._hideResult()},getValue:function(){var n=this.value();return n==null?"":n},getSelectedItems:function(){return this._isFocused&&this.model.multiSelectMode!="visualmode"&&this._updateSelectedItemArray(this.getValue()),this._selectedItems},_setValue:function(i){var r,u;if(this._isWatermark||this._hiddenSpan.css("display","none"),(typeof i=="object"||typeof i=="number"&&isNaN(i)||n.trim(i)=="")&&(i=null),this.model.multiSelectMode=="visualmode"&&this._hiddenInput.val(""),this.element.val(""),i)if(this.model.multiSelectMode=="visualmode")if(this._selectedItems=[],this._modelValue=i,this._deleteBox(this._ulBox.children("li")),r=i.split(this.model.delimiterChar),this.element.width(1).val("").removeAttr("placeholder"),this._hiddenInput||(this._hiddenInput=t.buildTag("input#"+this.target.id+"_hidden","",{},{type:"hidden",name:this.element.attr("name")}).insertBefore(this.element)),t.DataManager&&this.model.dataSource instanceof t.DataManager)this._createBoxForObjectType(r);else if(this.suggestionListItems=this.model.dataSource,this.suggestionListItems&&typeof this.suggestionListItems[0]!="object")for(this._hiddenInput.val(i),u=0;u<r.length;u++)r[u]&&(this._ulBox.append(this._createBox(r[u])),this._selectedItems.push(r[u]));else this._createBoxForObjectType(r);else this.element.val(i),this._updateSelectedItemArray(i);return this.model.multiSelectMode!="visualmode"&&this.value(this.element.val()),this._preVal=this.element.val(),this._isWatermark||this._setWatermarkTxt(),i},_createBoxForObjectType:function(i){for(var r,u=this,f=this._declareVariable(),e=0;e<i.length;e++)r=n.trim(i[e]),r!=""&&(t.DataManager&&this.model.dataSource instanceof t.DataManager?(this._dataQuery=this._getQuery().where(f[0],"equal",r,!1),this._promise=this.model.dataSource.executeQuery(this._dataQuery),this._promise.done(function(n){var i=n.result;u._strData=i instanceof Array&&i.length?i[0]:r;t.isNullOrUndefined(u._strData[f[1]])||u._selectKeyInit();u._selectedItems.push(u._strData)}).fail(function(){u._selectedItems.push(r)})):(this._dataQuery=t.Query().where(f[0],"equal",r,!1),this._promise=t.DataManager(this.suggestionListItems).executeLocal(this._dataQuery),this._strData=this._promise instanceof Array&&this._promise.length?this._promise[0]:r,t.isNullOrUndefined(this._strData[f[1]])||this._selectKeyInit(),this._selectedItems.push(this._strData)),this.model.multiSelectMode=="visualmode"&&this._ulBox.append(this._createBox(r)))},_selectKeyInit:function(){var n=this._declareVariable(),i;delimiterChar=this._delimiterChar();this.model.multiSelectMode=="visualmode"&&this._hiddenInput.val(this._hiddenInput.val()+(t.isNullOrUndefined(this._strData[n[1]]||this._strData[n[0]])?"":(this._strData[n[1]]||this._strData[n[0]])+this.model.delimiterChar));t.isNullOrUndefined(this._strData[n[1]])||(this.model.multiSelectMode!="none"?(i=this._selectValueByKey()!=null?this._selectValueByKey()+this._strData[n[1]]+delimiterChar:this._strData[n[1]]+delimiterChar,i=i.split(delimiterChar).reduce(function(n,t){return n.indexOf(t)<0&&n.push(t),n},[]),this._selectValueByKey(i.join(delimiterChar))):this._selectValueByKey(this._strData[n[1]]))},_declareVariable:function(){var n=this.model.fields,i={_key:null,_text:null,_attr:null},r=[];if(!t.isNullOrUndefined(n))return i._text=n&&n.text?n.text:"text",i._key=n&&n.key?n.key:"key",r.push(i._text,i._key),r},selectValueByKey:function(t){var r=this,i;t=t.toString();i=this.model.multiSelectMode!="none"?t.split(this.model.delimiterChar):t.split(",");Object.prototype.toString.call(i)==="[object Array]"&&n.each(i,function(t,i){r._setOperation(n.trim(i),"key")})},selectValueByText:function(n){this._setOperation(n,"text")},setValue:function(n){this._setText(n)},_setOperation:function(n,i){var e;if(!this.model.enabled)return!1;var o="",u,f,s=this,r=this.model.dataSource;if(t.isNullOrUndefined(r))return!1;if(typeof r[0]=="object"||r instanceof t.DataManager)e=this.model.fields,o=e&&e[i]?e[i]:i;else if(i=="key")return!1;if(t.DataManager&&r instanceof t.DataManager)f=this._getQuery().where(o,"equal",n,!this.model.caseSensitiveSearch),u=r.executeQuery(f),u.done(function(n){s._setText(n.result[0])});else{if(!r||!r.length||r.length<1)return!1;f=t.Query().where(o,"equal",n,!this.model.caseSensitiveSearch);u=t.DataManager(r).executeLocal(f);this._setText(u[0])}},_setText:function(n){var i,t,r;if(!n)return!1;if(t=this.model.fields,i=typeof this.model.dataSource[0]=="object"||typeof n=="object"?typeof n=="string"?n:t&&t.text?n[t.text]:n.text:n,i){if(this.model.multiSelectMode=="visualmode"&&this._removeDuplicates(n))return!1;this._valueToTextBox(i,n,!0);r=this.model.multiSelectMode=="visualmode"?this._modelValue:this.element.val()==""?null:this.element.val();this.value(r)}},_textFormateString:function(n){var i=this.model.multiColumnSettings.stringFormat,t;if(this._columnIndex=this.model.multiColumnSettings.stringFormat.match(/\{.+?\}/g).map(function(n){return n.slice(1,-1)}),typeof this.model.dataSource[0]=="object")for(t=0;t<this._columnIndex.length;t++)i=i.replace("{"+this._columnIndex[t]+"}",n[this.model.multiColumnSettings.columns[parseInt(this._columnIndex[t])].field]);else i=this._currList[this._activeItem-1];return i},_valueToTextBox:function(n,i,r){var e,u,f;!this._addNewTemplate&&this.model.multiColumnSettings.enable&&(n=this._textFormateString(i));this.model.multiSelectMode=="visualmode"?(i=typeof i=="string"&&this._addNewTemplate&&i.substr(i.length-this._addNewTemplate.length)==this._addNewTemplate?i.replace(this._addNewTemplate,""):i,e=n.indexOf(this._addNewTemplate),this._addNewTemplate&&(n=n.substr(0,n.length-this._addNewTemplate.length)),f=this.model.delimiterChar,u=this._getUniqueKey(),u=u?u:this.model.fields&&this.model.fields.key?i[this.model.fields.key]:t.isNullOrUndefined(i.key)?u:i.key,(!(this._selectValueByKey()==u||u==null)||e>-1)&&this._selectValueByKey(this._selectValueByKey()!=null?this._selectValueByKey()+(e>-1?n:u)+f:(e>-1?n:u)+f),(!(this._hiddenInput.val()==u||u==null)||e>-1)&&this._hiddenInput.val(this._hiddenInput.val()+(u||n)+f),this._modelValue=t.isNullOrUndefined(this.value())?n+f:this.value()+n+f,this.element.val("").removeAttr("placeholder").width(1),this._ulBox.append(this._createBox(n)),this._addNewTemplate=null):this.model.multiSelectMode=="delimiter"?(f=this.target.value.lastIndexOf(this.model.delimiterChar),this._typed||this.element.val()==""||r||!this.model.showPopupButton?r?this.element.val(this.element.val()==""?n+this.model.delimiterChar:this.element.val()+n+this.model.delimiterChar):f==-1?this.element.val(this._queryString.substr(0,f+1)+n+this.model.delimiterChar):this.element.val(this._queryString.substr(0,f+this.model.delimiterChar.length)+n+this.model.delimiterChar):!this.model.enableAutoFill||this.showSuggestionBox?this._checkDeli()?this.element.val(this._queryString.substr(0,f)+this.model.delimiterChar+n+this.model.delimiterChar):this.element.val(this.element.val()+this.model.delimiterChar):this._checkDeli()||this.element.val(this.element.val()+this.model.delimiterChar),this._typed=!1):(this.element.val(n),this._selectedItems=[]);this._selectedItems.push(i);this._originalval.push(n);this._moveCaretToEnd(this.element[0])},_removeDuplicates:function(n){return this._selectedItems.length==0?!1:this._selectedItems.indexOf(n)!=-1?!0:void 0},search:function(){this.model.enabled&&this._checkDelimiter()&&(this._hideResult(),this._autoFill=!1,this._queryString=n.trim(this._queryString),this._queryString.length>0&&this._OnTextEnter())},setVisible:function(n){n?this.wrapper.show():this.wrapper.hide()},hide:function(){this._hideResult()},open:function(){this._showFullList()},_changeWatermark:function(n){this._isWatermark?this.element.attr("placeholder",n):this._hiddenSpan.text(n)},_changeSkin:function(n){this.wrapper.removeClass(this.model.cssClass).addClass(n);this.suggestionList.removeClass(this.model.cssClass).addClass(n)},_setDropdown:function(n){this.model.showPopupButton=n;n?this._renderDropdown():this._destroyDropdown()},_changeHeight:function(n){this.wrapper.height(n)},_changeWidth:function(n){this.wrapper.width(n);this._setListWidth()},_setCulture:function(){this._localizedLabels=this._getLocalizedLabels();t.isNullOrUndefined(this._options)||(t.isNullOrUndefined(this._options.addNewText)||(this._localizedLabels.addNewText=this._options.addNewText),t.isNullOrUndefined(this._options.emptyResultText)||(this._localizedLabels.emptyResultText=this._options.emptyResultText));this.model.addNewText=this._localizedLabels.addNewText;this.model.emptyResultText=this._localizedLabels.emptyResultText},_init:function(n){if(this._options=n,this._setCulture(),!this.element.is("input")||this.element.attr("type")&&this.element.attr("type")!="text")return!1;this.model.fields.groupBy=this.model.fields.groupBy?this.model.fields.groupBy:this.model.fields.category;this._initialize();this._render();this._wireEvents();this.initialRender=!1;this.model.validationRules!=null&&(this._initValidator(),this._setValidation())},_initValidator:function(){this.element.closest("form").data("validator")||this.element.closest("form").validate()},_setValidation:function(){var f,r,i,u,e;if(this.model.validationRules){f=this.model.multiSelectMode=="visualmode"?this._hiddenInput:this.element;f.rules("add",this.model.validationRules);r=this.element.closest("form").data("validator");r=r?r:this.element.closest("form").validate();name=f.attr("name");r.settings.messages[name]={};for(i in this.model.validationRules)if(u=null,!t.isNullOrUndefined(this.model.validationRules[i])){if(t.isNullOrUndefined(this.model.validationRules.messages&&this.model.validationRules.messages[i])){r.settings.messages[name][i]=n.validator.messages[i];for(e in this.model.validationMessage)i==e?u=this.model.validationMessage[i]:""}else u=this.model.validationRules.messages[i];r.settings.messages[name][i]=u!=null?u:n.validator.messages[i]}}},_delimiterChar:function(){return this.model.multiSelectMode!="none"?this.model.delimiterChar:""},_setModel:function(n){var i,e,o,f,u,r;for(i in n)switch(i){case"dataSource":this.model.dataSource=null;break;case"watermarkText":this._changeWatermark(n[i]);break;case"delaySuggestionTimeout":this.model.delaySuggestionTimeout=parseInt(n[i]);break;case"value":n[i]!=""&&(deli=this._delimiterChar(),this.model.multiSelectMode!="none"&&(r=n[i].substr(n[i].length-deli.length)==deli?n[i]:n[i]+deli,n[i]=this.value()+r,this.model.multiSelectMode=="visualmode"&&(n[i]=n[i].split(deli).reduce(function(n,t){return n.indexOf(t)<0&&n.push(t),n},[]),n[i]=n[i].join(deli))),this._setValue(n[i]),this._modelValue=n[i],e=this.model.multiSelectMode=="visualmode"?this._hiddenInput.val():this.element.val()==""?null:this.element.val(),this._changeEvtTrigger(e));break;case"showPopupButton":this._setDropdown(n[i]);break;case"enableRTL":this._RightToLeft(n[i]);break;case"showRoundedCorner":this._setRoundedCorner(n[i]);break;case"readOnly":this._checkReadOnly(n[i]);break;case"delimiterChar":o=this.model.delimiterChar;n[i]=this._validateDelimiter(n[i]);this.model.delimiterChar=n[i];this.element.val(this.value().replace(new RegExp(o,"g"),this.model.delimiterChar));this.value(this.element.val());break;case"validationRules":this.model.validationRules!=null&&(this.element.rules("remove"),this.model.validationMessage=null);this.model.validationRules=n[i];this.model.validationRules!=null&&(this._initValidator(),this._setValidation());break;case"validationMessage":this.model.validationMessage=n[i];this.model.validationRules!=null&&this.model.validationMessage!=null&&(this._initValidator(),this._setValidation());break;case"locale":t.Autocomplete.Locale[n[i]]?(this.model.locale=n[i],this._setCulture()):n[i]=this.model.locale;break;case"multiSelectMode":this.model.multiSelectMode=n[i];f=this._delimiterChar();this.model.multiSelectMode!="none"&&(u=this._selectValueByKey(),r=this.value(),r&&(r=r.substr(r.length-f.length)==f?r:r+f,this.value(r)),u&&this._selectValueByKey(u.substr(u.length-f.length)==f?u:u+f));n[i]=="visualmode"?(this.model.validationRules!=null&&this.element.rules("remove"),this.element.val()!=""&&this._isWatermark&&this.element.removeAttr("placeholder"),this._renderBoxModel()):this.element.hasClass("e-visual-mode")&&this._destroyBoxModel();this._setValue(this.value());this._setValidation();t.isNullOrUndefined(this.element.attr("placeholder"))&&this._isWatermark&&this._setWatermark();break;case"enabled":this._disabled(!n[i]);break;case"visible":this.setVisible(n[i]);break;case"height":this._changeHeight(n[i]);break;case"width":this._changeWidth(n[i]);break;case"cssClass":this._changeSkin(n[i]);break;case"itemsCount ":(n[i]<=0||isNaN(n[i]))&&(n[i]=0);break;case"popupHeight":this.suggestionList.css({"max-height":isNaN(n[i])?n[i]:n[i]+"px"});break;case"popupWidth":this.model.popupWidth=n[i];this._setListWidth();break;case"selectValueByKey":deli=this._delimiterChar();u=t.util.getVal(n[i]);this.selectValueByKey(u);keyValue=this._selectValueByKey()+n[i];keyValue=keyValue.split(deli).reduce(function(n,t){return n.indexOf(t)<0&&n.push(t),n},[]);keyValue=keyValue.join(deli);n[i]=keyValue.substr(keyValue.length-deli.length)==deli?keyValue:keyValue+deli;break;case"htmlAttributes":this._addAttr(n[i]);break;case"emptyResultText":t.isNullOrUndefined(this._options)&&(this._options={});this._options.emptyResultText=this.model.emptyResultText=n[i];this._setCulture();break;case"addNewText":t.isNullOrUndefined(this._options)&&(this._options={});this._options.addNewText=this.model.emptyResultText=n[i];this._setCulture();break;case"multiColumnSettings":t.isNullOrUndefined(n[i].enable)||(this.model.multiColumnSettings.enable=n[i].enable);t.isNullOrUndefined(n[i].showHeader)||(this.model.multiColumnSettings.showHeader=n[i].showHeader);t.isNullOrUndefined(n[i].stringFormat)||(this.model.multiColumnSettings.stringFormat=n[i].stringFormat);t.isNullOrUndefined(n[i].columns)||(this.model.multiColumnSettings.columns=n[i].columns);this.suggestionList.remove();this._renderSuggestionList()}},_destroy:function(){this.element.insertAfter(this.wrapper);this.model.multiSelectMode=="visualmode"&&this.element.attr("name",this._hiddenInput.attr("name"));this.wrapper.remove();this.element.removeClass("e-input").val("");this._isWatermark&&this.element.removeAttr("placeholder");this.suggestionList.remove()},_initialize:function(){this.value(this.value()===""?this.element[0].value:this.value());this.element.attr("role","combobox").attr("aria-label","Autocomplete textbox").attr("aria-expanded",!1).attr("tabindex",0).attr("aria-autocomplete","list");this.target=this.element[0];this.dropdownbutton=null;this._isIE8=t.browserInfo().name=="msie"&&t.browserInfo().version=="8.0"?!0:!1;this.showSuggestionBox=!1;this.noresult=!0;this._queryString=null;this.suggLen=0;this._selectedItems=[];this._modelValue="";this._activeItem=0;this._originalval=[];this.ctrlKeyPressed=!1;this._isFocused=!1;this._isOpened=!1;this._typed=!1;this._cancelEvent=!1;this._isWatermark=this._checkWatermarkSupport()},_render:function(){this._renderWrapper();this._addAttr(this.model.htmlAttributes);this._setDimentions();this._renderDropdown();this._checkProperties();this._isWatermark?this._setWatermark():this._setWatermarkTxt();this._renderSuggestionList();this._RightToLeft(this.model.enableRTL);this._setRoundedCorner(this.model.showRoundedCorner);this.setVisible(this.model.visible);this._setListPosition()},_renderWrapper:function(){var n,i;this.element.addClass("e-input").attr("autocomplete","off");this.wrapper=t.buildTag("span.e-atc e-widget "+this.model.cssClass+"#"+this.target.id+"_wrapper").insertAfter(this.element);document.activeElement==this.element[0]&&(n=!0);this.container=t.buildTag("span.e-in-wrap e-box").append(this.element);this.wrapper.append(this.container);this._isWatermark||(this._hiddenSpan=t.buildTag("span.e-input e-placeholder ").insertAfter(this.element),this._hiddenSpan.text(this.model.watermarkText),this._hiddenSpan.css("display","none"),i=this,this._hiddenSpan.click(function(){this._isFocused||i.element.focus()}));n&&this.element.focus()},_renderDropdown:function(){if(this.model.showPopupButton){var i=t.buildTag("span.e-icon e-search").attr(this._isIE8?{unselectable:"on"}:{});this.dropdownbutton=t.buildTag("span.e-select#"+this.target.id+"_dropdown").attr(this._isIE8?{unselectable:"on"}:{}).append(i);this.container.append(this.dropdownbutton).addClass("e-padding");this.dropdownbutton.bind("mousedown",n.proxy(this._OnDropdownClick,this))}},_addAttr:function(t){var i=this;n.map(t,function(n,t){t=="required"&&i.element.attr(t,n);t=="class"?i.wrapper.addClass(n):t=="name"?i.element.attr(t,n):t=="disabled"&&n=="disabled"?i._disabled(!0):t=="readOnly"&&n=="readOnly"?i._checkReadOnly(!0):i.wrapper.attr(t,n)})},_setDimentions:function(){this.model.height&&this.wrapper.height(this.model.height);this.model.width&&this.wrapper.width(this.model.width)},_renderBoxModel:function(){this._ulBox=t.buildTag("ul.e-ul e-boxes");this._hiddenInput=t.buildTag("input#"+this.target.id+"_hidden","",{},{type:"hidden"}).insertBefore(this.element);this._hiddenInput.attr("name",this.element.attr("name"));this.element.val("").removeAttr("name").addClass("e-visual-mode");this._isWatermark||this.element.width(1);this.container.prepend(this._hiddenInput,this._ulBox);this.wrapper.height("auto");this._on(this.container,"mousedown",function(t){if(!this.model.enabled)return!1;var i=n(t.target);i.is(this.element)||(t.preventDefault(),this._isFocused||this.element.focus(),i.hasClass("e-options")?(!t.ctrlKey&&i.siblings().hasClass("e-active")&&this._removeActive(),i.hasClass("e-active")?i.removeClass("e-active"):i.addClass("e-active")):this._moveCaretToEnd(this.element[0]));!t.ctrlKey&&(i.hasClass("e-boxes")||i.hasClass("e-input"))&&this._removeActive()})},_destroyBoxModel:function(){this.container.prepend(this.element);this.element.attr({name:this._hiddenInput.attr("name")}).removeAttr("style").removeClass("e-visual-mode");this.wrapper.height(this.model.height);this._hiddenInput.remove();this._hiddenInput=null;this._ulBox.remove();this._off(this.container,"mousedown")},_deleteLastBox:function(){var t=this._ulBox.children(),n=t.last(),i=n.hasClass("e-active");this._removeActive();i?this._deleteBox(n):n.addClass("e-active")},_deleteBox:function(t){for(var o,u,i,f,e,r=0;r<t.length;r++)o=this._ulBox.children(),u=o.index(t[r]),this._selectedItems.splice(u,1),i=this.model.delimiterChar,f=this._hiddenInput.val().split(i),f.splice(u,1),this._hiddenInput.val(f.join(i)),this._selectValueByKey(f.join(i)),e=this._modelValue.split(i),e.splice(u,1),this._modelValue=e.join(i),n(t[r]).remove();this.showSuggestionBox&&this._refreshPopup();this._valueChange();this._hiddenInput.val()==""&&this._setWatermark()},_removeActive:function(){this._ulBox.children("li.e-active").removeClass("e-active")},_adjustWidth:function(){var n=t.buildTag("span",this.element.val()),i,r;this.container.append(n);r=30;i=n.width()+r;this.element.width()!=i&&this.element.width(i);this._hiddenInput.val()==""&&this._setWatermark();n.remove()},_checkProperties:function(){var r,i;this._checkReadOnly(this.model.readOnly);this.model.delimiterChar=this._validateDelimiter(this.model.delimiterChar);this.model.enabled?this.model.enabled&&n(this.element).hasClass("e-disable")&&(this.model.enabled=!1,this._disabled(!1)):(this.model.enabled=!0,this._disabled(!0));this._checkNameAttr();this.model.multiSelectMode=="visualmode"&&this._renderBoxModel();this._selectValueByKey()!=null&&this.value()==""?(r=this._selectValueByKey().toString(),this.model.multiSelectMode!="none"&&(r=r.substr(r.length-this.model.delimiterChar.length)==this.model.delimiterChar?r:r+this.model.delimiterChar,this.model.multiSelectMode=="visualmode"?this._selectValueByKey(null):this._selectValueByKey(r)),this.selectValueByKey(r)):(i=this.value(),this.model.multiSelectMode!="none"&&(t.isNullOrUndefined(i)||i!="")&&(i=i.substr(i.length-this.model.delimiterChar.length)==this.model.delimiterChar?i:i+this.model.delimiterChar),this.value(this._setValue(i)))},_checkNameAttr:function(){this.element.attr("name")||this.element.attr("name",this.element[0].id)},_disabled:function(n){n?this.disable():this.enable()},_destroyDropdown:function(){this.dropdownbutton.unbind("mousedown",n.proxy(this._OnDropdownClick,this));this.dropdownbutton.remove();this.dropdownbutton=null;this.container.removeClass("e-padding")},_validateDelimiter:function(t){if(n.trim(t).length==t.length||t.length!=null)if(!/^[a-zA-Z0-9]+$/.test(t))return t;return","},_checkWatermarkSupport:function(){return"placeholder"in document.createElement("input")},_setWatermark:function(){(this.model.watermarkText&&(this.value()==""||t.isNullOrUndefined(this.value()))||this.model.multiSelectMode!="visualmode")&&this.element.attr("placeholder",this.model.watermarkText).width("")},_setWatermarkTxt:function(){this.model.watermarkText!=null&&n.trim(this.element.val())==""&&(this.model.multiSelectMode!="visualmode"||n.trim(this._hiddenInput.val())=="")&&this._hiddenSpan.css("display","block").text(this.model.watermarkText)},_renderSuggestionList:function(){var e=n("#"+this.element.context.id+"_suggestion").get(0),r,o,u,i,f;if(e&&n(e).remove(),this.suggestionList=t.buildTag("div.e-atc-popup e-popup e-widget e-box "+this.model.cssClass+"#"+this.target.id+"_suggestion","",{display:"none"}).attr("role","listbox"),this.element.attr("aria-owns",this.target.id+"_suggestion"),this.popup=this.suggestionList,r=t.buildTag("div"),this.model.multiColumnSettings.enable){if(this._tableColumn=t.buildTag("table","",{},{role:"listbox","border-collapse":"separate",border:0,cellspacing:0,cellpadding:0,"class":"e-atc-tableContent"}),this._listEventBind(this._tableColumn,"tr"),this._headerColGroup=document.createElement("colgroup"),this.model.multiColumnSettings.showHeader){for(this._tableHeaderDiv=t.buildTag("div",{},{},{"class":"e-atc-tableHeader "+(this.model.enableRTL?"e-atc-tableHeaderRTL":"e-atc-tableHeaderScroll")}),o=t.buildTag("div",{},{},{"class":"e-atc-tableHeaderContent e-atc-tableHeaderBorder"}),u=document.createElement("tr"),this._tableHeader=t.buildTag("table","",{},{cellspacing:"0.25px"}),i=0;i<this.model.multiColumnSettings.columns.length;i++)n(u).append(t.buildTag("th",this.model.multiColumnSettings.columns[i].headerText?this.model.multiColumnSettings.columns[i].headerText:"column"+i,{},{"class":i==this.model.multiColumnSettings.columns.length-1?"":this.model.enableRTL?"e-atc-thleft":"e-atc-thright"})),n(this._headerColGroup).append(document.createElement("col"));n(this._tableHeaderDiv).append(n(o).append(n(this._tableHeader).append(u).append(this._headerColGroup)));this.suggestionList.append(this._tableHeaderDiv)}else{for(i=0;i<this.model.multiColumnSettings.columns.length;i++)n(this._headerColGroup).append(document.createElement("col"));this._tableColumn.append(this._headerColGroup)}f=t.buildTag("div");f.append(this._tableColumn);r.append(f)}else this.ul=t.buildTag("ul.e-ul").attr("role","listbox"),this._listEventBind(this.ul,"li:not('.e-category')"),r.append(this.ul);this.suggestionList.append(r);n("body").append(this.suggestionList);this._setListWidth();this._setListHeight();this.model.multiColumnSettings.enable?(r.ejScroller({height:r.height(),width:0,scrollerSize:20}),this.scrollerObj=r.ejScroller("instance")):(this.suggestionList.ejScroller({height:this.suggestionList.height(),width:0,scrollerSize:20}),this.scrollerObj=this.suggestionList.ejScroller("instance"))},_listEventBind:function(t,i){t.on({mouseenter:n.proxy(this._OnMouseEnter,this),mouseleave:n.proxy(this._OnMouseLeave,this),click:n.proxy(this._OnMouseClick,this)},i)},_checkEmptyList:function(){this.model.multiSelectMode=="visualmode"&&this._removeRepeated();this.suggestionListItems.length==0?(this.suggestionListItems.push(this.model.emptyResultText),this.noresult=!0):this.noresult=!1},_showSuggestionList:function(n){this.suggestionListItems=this.model.enableDistinct?t.dataUtil.distinct(this.suggestionListItems,typeof this.suggestionListItems[0]!="object"?"":this.model.fields&&this.model.fields.text?this.model.fields.text:"text",!0):this.suggestionListItems;this.model.itemsCount>0&&(this.suggestionListItems=t.DataManager(this.suggestionListItems).executeLocal(t.Query().take(this.model.itemsCount)));this._checkEmptyList();this._addNewTemplate=null;this.noresult&&this.model.multiSelectMode=="visualmode"&&this.model.allowAddNew&&this.element.val()!=""&&!this._repeatRemove&&(this.noresult=!1,this.suggestionListItems.pop(),this._addNewTemplate="   ("+this.model.addNewText+")",this.suggestionListItems.push(this.element.val()+this._addNewTemplate),this._checkEmptyList());(!this.noresult||this.model.showEmptyResultText)&&this._generateSuggestionList(n)},_generateSuggestionList:function(n){var f=this.suggestionListItems,i,r,u,s,e,o;this.model.multiColumnSettings.enable?this._tableColumn.empty()&&this.model.multiColumnSettings.showHeader&&this._tableHeaderDiv.css("display",""):this.ul.empty();i=this;typeof f[0]!="object"?(f.forEach(function(n){var r=i.model.highlightSearch&&!i.noresult?i._highlightSuggestion(n):n,u;i.model.multiColumnSettings.enable?(u=t.buildTag("tr").attr("role","option").attr(i._isIE8?{unselectable:"on"}:{}),u.append(t.buildTag("td",r).attr("role","option").attr(i._isIE8?{unselectable:"on"}:{}).attr(n!=f.length-1?{"class":"e-atc-tdbottom"}:{})),i._tableColumn.append(u),i.model.showEmptyResultText&&i.model.emptyResultText==r&&i.model.multiColumnSettings.showHeader&&i._tableHeaderDiv.css("display","none"),i._addNewTemplate&&i._tableHeaderDiv.css("display","none")):i.ul.append(t.buildTag("li",r).attr("role","option").attr(i._isIE8?{unselectable:"on"}:{}))}),this._currList=f,this._mapper={txt:null,key:null}):(r=this.model.fields,u={_key:null,_text:null,_attr:null},u._key=r&&r.key?r.key:"key",u._text=r&&r.text?r.text:"text",u._attr=r&&r.htmlAttributes?r.htmlAttributes:"htmlAttributes",this._mapper={txt:u._text,key:u._key},this._currList=[],this.model.fields.groupBy?(s=r&&r.groupBy?r.groupBy:"groupBy",o=t.Query().group(s),this._addSortingQuery(o,"key"),e=t.DataManager(f).executeLocal(o),this._swapUnCategorized(e),e.forEach(function(n,r){if(n.key)if(i.model.multiColumnSettings.enable){var e=t.buildTag("tr.e-category").attr("role","option").attr(i._isIE8?{unselectable:"on"}:{});e.append(t.buildTag("td",n.key).attr("role","option").attr(i._isIE8?{unselectable:"on"}:{}).attr(r!=f.length-1?{"class":"e-atc-tdbottom"}:{}));i._tableColumn.append(e)}else i.ul.append(t.buildTag("li.e-category",n.key).attr("role","option").attr(i._isIE8?{unselectable:"on"}:{}));i._generateLi(n.items,u)})):this._generateLi(f,u));this._getLiTags().length>0&&this._showResult(n)},_swapUnCategorized:function(t){n(t).each(function(n,i){if(!i.key){for(var r=n;r>0;r--)t[r]=t[r-1];return t[r]=i,!1}})},_generateLi:function(i,r){var u=this;i.forEach(function(f,e){var s=f[r._text],l=f[r._key],h,o,c;if(!t.isNullOrUndefined(s)||u.model.multiColumnSettings.enable){if(u.model.multiColumnSettings.enable||(u.model.highlightSearch&&(s=u._highlightSuggestion(s)),u.model.template&&(s=u._getTemplatedString(f,r._text,s))),u.model.multiColumnSettings.enable)for(h=t.buildTag("tr","",{},{"class":e%2?"e-atc-trbgcolor":""}),o=0;o<u.model.multiColumnSettings.columns.length;o++)n(h).append(t.buildTag("td",u.model.highlightSearch&&n.inArray(o.toString(),u._columnIndex)>-1?u._highlightSuggestion(u._getField(f,u.model.multiColumnSettings.columns[o].field).toString()):u._getField(f,u.model.multiColumnSettings.columns[o].field),{},{"class":(e!=i.length-1?"e-atc-tdbottom ":"")+(o!=u.model.multiColumnSettings.columns.length-1?u.model.enableRTL?"e-atc-tdleft":"e-atc-tdright":"")}));else c=document.createElement("li"),c.innerHTML+=s;l&&(u.model.multiColumnSettings.enable?h.attr("id",l):c.setAttribute("id",l));u._setAttributes(u._getField(i[e],r._attr),u.model.multiColumnSettings.enable?h:c);u.model.multiColumnSettings.enable?n(u._tableColumn).append(h):u.ul[0].appendChild(c);u._currList=n.merge(u._currList,[f])}})},_getLiTags:function(){return this.model.multiColumnSettings.enable?this._tableColumn.find("tbody tr:not('.e-category')"):this.ul.children("li:not('.e-category')")},_getTemplatedString:function(n,t,i){for(var r=this.model.template,f=r.indexOf("${"),e=r.indexOf("}");f!=-1&&e!=-1;){var o=r.substring(f,e+1),s=o.replace("${","").replace("}",""),u=this._getField(n,s);t==s&&(u=i);u||(u="");r=r.split(o).join(u);f=r.indexOf("${");e=r.indexOf("}")}return r},_getField:function(n,i){return t.pvt.getObject(i,n)},_setAttributes:function(t,i){if(t){typeof t=="string"&&(t=n.parseJSON(t));for(var r in t)i.setAttribute(r,t[r])}},_setListWidth:function(){var n=this.model.popupWidth;n&&n!="auto"?this.suggestionList.css({width:n}):this.suggestionList.css({width:this.wrapper.width()})},_setListHeight:function(){this.suggestionList.css({"max-height":this.model.popupHeight})},_refreshPopup:function(){this.model.popupWidth=="auto"&&this.wrapper.outerWidth()!=this.suggestionList.outerWidth()&&(this.suggestionList.css({width:this.wrapper.width()}),this._refreshScroller());this._setListPosition()},_showResult:function(r){var u,e,o,f;this._refreshScroller();this._refreshPopup();this._isOpened?n(document).bind("mousedown",n.proxy(this._OnDocumentClick,this)):(this.suggestionList.css("display","none"),u=this,clearTimeout(this._typing),this._typing=setTimeout(function(){u.suggestionList[u.model.animateType=="slide"?"slideDown":"fadeIn"](u.model.animateType=="none"?0:300,"easeOutQuad",function(){n(document).bind("mousedown",n.proxy(u._OnDocumentClick,u))})},this.model.delaySuggestionTimeout),e=r!=i?{event:r,isInteraction:!0}:{isInteraction:!1},this._trigger("open",e),this.wrapper.addClass("e-active"));this._isOpened=!0;this.showSuggestionBox=!0;o=this._getLiTags();this._listSize=o.size();n(window).bind("resize",n.proxy(this._OnWindowResize,this));f=t.getScrollableParents(this.wrapper);f[0]!=window&&this._on(f,"scroll",this._hideResult)},_hideResult:function(r){var u,f;this.showSuggestionBox&&(this.showSuggestionBox=!1,this._activeItem=0,clearTimeout(this._hiding),this.element.attr("aria-expanded",!1),u=this,this._isOpened?(this.suggestionList.css("display","none"),f=r!=i?{event:r,isInteraction:!0}:{isInteraction:!1},this._trigger("close",f)):this._hiding=setTimeout(function(){u.suggestionList[u.model.animateType=="slide"?"slideUp":"fadeOut"](u.model.animateType=="none"?0:100,"easeOutQuad")},this.model.delaySuggestionTimeout),n(document).unbind("mousedown",n.proxy(this._OnDocumentClick,this)),n(window).unbind("resize",n.proxy(this._OnWindowResize,this)),this._off(t.getScrollableParents(this.wrapper),"scroll",this._hideResult),this.wrapper.removeClass("e-active"))},_refreshScroller:function(){this.suggestionList.css("height","auto");this.suggestionList.find(".e-content , .e-scroller").removeAttr("style");this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&(n(this._tableColumn).attr("width","auto"),n(this._tableHeader).attr("width","auto"));this.suggestionList.css("display","block");this.model.multiColumnSettings.enable&&(this.scrollerObj.option("height","auto"),this._columnBorderAlign());this.suggestionList.height()>parseInt(n.isNumeric(this.model.popupHeight)?this.model.popupHeight:this.model.popupHeight.replace("px",""))-4||this.model.multiColumnSettings.enable&&(this.suggestionList.height()<=this._tableColumn.height()||this.suggestionList.width()<=this._tableColumn.width()||this.model.multiColumnSettings.showHeader&&this.suggestionList.width()<=this._tableHeader.width())?(this.scrollerObj.model.height=this.model.multiColumnSettings.showHeader&&this._tableHeader?parseInt(this.suggestionList.height())-parseInt(this._tableHeader.height()):this.suggestionList.height(),this.scrollerObj.model.width=this.suggestionList.width(),this.scrollerObj.refresh(),this.scrollerObj.option({enableRTL:this.model.enableRTL,scrollTop:0,scrollLeft:0}),this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&this._addThBorder(),this.suggestionList.addClass("e-scroller"),!this.scrollerObj._vScroll&&this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&this._removeThBorder()):(this.suggestionList.removeClass("e-scroller"),this.scrollerObj.refresh(),this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&this._removeThBorder());this.suggestionList.css("height","auto");this._isIE8&&this.suggestionList.find(".e-vscroll div, .e-hscroll div").attr("unselectable","on");this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&(this.suggestionList.find(".e-content").scroll(t.proxy(function(t){this._tableHeader.parent(".e-atc-tableHeaderContent").scrollLeft(n(t.currentTarget).scrollLeft())},this)),this.suggestionList.find(".e-content").length>0&&this._tableHeader.parent(".e-atc-tableHeaderContent").scrollLeft(this.model.enableRTL?this.suggestionList.find(".e-content")[0].scrollWidth-this.suggestionList.find(".e-content")[0].clientWidth:0))},_columnBorderAlign:function(){var i,t;if(this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&this._tableHeaderDiv.css("display")!="none"){for(this._tableWid=this._tableHeader.outerWidth()>this._tableColumn.outerWidth()?this._tableHeader.outerWidth():this._tableColumn.outerWidth(),this._tableColumn.find("colgroup").remove(),n(this._headerColGroup.children).removeAttr("style"),t=0;t<this._headerColGroup.children.length;t++)n(this._headerColGroup.children[t]).css({width:parseInt(n(this._tableColumn).find("tr:first td").eq(t).outerWidth())>parseInt(this._tableHeader.find("tr:first th").eq(t).outerWidth())?n(this._tableColumn).find("tr:first td").eq(t).outerWidth():this._tableHeader.find("tr:first th").eq(t).outerWidth()});this._tableColumn.append(n(this._headerColGroup).clone());i=this._tableWid>this.suggestionList.width()?this._tableWid:"100%";n(this._tableColumn).attr("width",i);n(this._tableHeader).attr("width",i)}else if(this.model.multiColumnSettings.enable&&!this.model.multiColumnSettings.showHeader){if(n(this._tableColumn).attr("width","auto"),this._tableWid=this._tableColumn.outerWidth(),n(this._headerColGroup.children).removeAttr("style"),i=this._tableWid>this.suggestionList.width()?this._tableWid:"100%",i!="100%"){for(t=0;t<this._headerColGroup.children.length;t++)n(this._headerColGroup.children[t]).css({width:n(this._tableColumn).find("tr:first td").eq(t).outerWidth()});this._tableColumn.append(this._headerColGroup)}n(this._tableColumn).attr("width",i)}else n(this._tableColumn).attr("width","100%")},_removeThBorder:function(){this._tableHeader.parents(".e-atc-tableHeader").removeClass(this.model.enableRTL?"e-atc-tableHeaderRTL":"e-atc-tableHeaderScroll");this._tableHeader.parent(".e-atc-tableHeaderContent").removeClass("e-atc-tableHeaderBorder")},_addThBorder:function(){this._tableHeader.parents(".e-atc-tableHeader").addClass(this.model.enableRTL?"e-atc-tableHeaderRTL":"e-atc-tableHeaderScroll").removeClass(this.model.enableRTL?"e-atc-tableHeaderScroll":"e-atc-tableHeaderRTL");this._tableHeader.parent(".e-atc-tableHeaderContent").addClass("e-atc-tableHeaderBorder")},_setListPosition:function(){var t=this.wrapper,i=this._getOffset(t),f,h=n(document).scrollTop()+n(window).height()-(i.top+n(t).outerHeight()),c=i.top-n(document).scrollTop(),u=this.suggestionList.outerHeight(),e=this.suggestionList.outerWidth(),r=i.left,o=t.outerHeight(),l=(o-t.height())/2,a=this._getZindexPartial(),s=3,v=(u<h||u>c?i.top+o+s:i.top-u-s)-l;f=n(document).scrollLeft()+n(window).width()-r;(this.model.enableRTL||e>f&&e<r+t.outerWidth())&&(r-=this.suggestionList.outerWidth()-t.outerWidth());this.suggestionList.css({left:r+"px",top:v+"px","z-index":a})},_getOffset:function(n){return t.util.getOffset(n)},_getZindexPartial:function(){return t.util.getZindexPartial(this.element,this.suggestionList)},_targetFocus:function(n){this.model.multiSelectMode=="visualmode"&&this._setWatermarkWidth(30);this._isWatermark||this._hiddenSpan.css("display","none");this.wrapper.addClass("e-focus");this._isFocused=!0;this._trigger("focusIn",{event:n,isInteraction:!0,value:this.value()})},_focusOutAction:function(n){var i,r;this._isFocused=!1;this.wrapper.removeClass("e-focus");this._isWatermark||this._setWatermarkTxt();this._removeSelection();this.model.multiSelectMode=="visualmode"&&this.model.showResetIcon&&this.element.val()!=""&&this._removeReset();this.model.multiSelectMode=="visualmode"?(this._removeActive(),this.element.val(""),this._setWatermarkWidth(1),this._preVal="",this._addNewTemplate=null):(this.model.multiSelectMode=="delimiter"&&this._valueChange(n),this._updateSelectedItemArray(this.getValue()));t.isNullOrUndefined(this.value())||this.value()==""||(i=this.value().split(this.model.delimiterChar),(this.model.multiSelectMode=="delimiter"||this.model.multiSelectMode=="none")&&(r=this._removeDuplicateVal(i),this._keyProcess(r)));this.element.val()==""&&(this.value()==""||this.value()==null)&&this._selectValueByKey(null)},_targetBlur:function(n){this._focusOutAction(n);this._trigger("focusOut",{event:n,isInteraction:!0,value:this.value()})},_setWatermarkWidth:function(n){this.model.watermarkText&&this.element.attr("placeholder")?this.element.width(""):this.element.val("").width(n)},_checkDeli:function(){var n,t,i;return n=this.element.val(),t=this.model.delimiterChar,i=n.substr(n.length-t.length,n.length),i==t?(this.element.val(n.substr(0,n.length-t.length)),!0):!1},_removeSelection:function(){if(this.model.enableAutoFill){this.element.attr("aria-autocomplete","both");var n=this._getCaretSelection();n.end-n.start!=0&&n.end-n.start!=this.element.val().length&&(this.target.value=this.target.value.substr(0,n.start))}},_removeListHover:function(){this._getLiTags().removeClass("e-hover")},_addListHover:function(){var t=n(this._getLiTags()[this._activeItem-1]);t.addClass("e-hover");this.scrollerObj.setModel({scrollTop:this._calcScrollTop()});t.focus()},_calcScrollTop:function(){var r=this.model.multiColumnSettings.enable?this.model.multiColumnSettings.showHeader?this._tableColumn.outerHeight()+this._tableHeader.outerHeight():this._tableColumn.outerHeight():this.ul.outerHeight(),t=this.model.multiColumnSettings.enable?this._tableColumn.find("tr"):this.ul.find("li"),i=0,n;return n=this.model.multiColumnSettings.enable?this._tableColumn.find("tr.e-hover").index():this.ul.find("li.e-hover").index(),i=t.eq(1).outerHeight()*n,i-((this.model.multiColumnSettings.enable?this._tableColumn.parent().outerHeight():this.suggestionList.outerHeight())-t.eq(n).outerHeight())/2},getActiveText:function(){return this.model.multiColumnSettings.enable?this._textFormateString(this._currList[this._activeItem-1]):this._mapper.txt?this._getField(this._currList[this._activeItem-1],this._mapper.txt):this._currList[this._activeItem-1]},_getUniqueKey:function(){var n=null;return t.isNullOrUndefined(this._mapper)||(this._mapper.key&&(n=this._getField(this._currList[this._activeItem-1],this._mapper.key)),t.isNullOrUndefined(n)&&(n=null)),n},_setTextBoxValue:function(){var i,f,t,e,r,u;this._activeItem&&!this.noresult&&(i=this.model.multiColumnSettings.enable?this._textFormateString(this._currList[this._activeItem-1]):this.getActiveText(),f=this._getCaretSelection(),this.suggLen=f.start,t=this.target.value.substr(0,this.suggLen),r=this.target.value.lastIndexOf(this.model.delimiterChar),u=r==-1?n.trim(t.substr(r+1,this.suggLen)):n.trim(t.substr(r+this.model.delimiterChar.length,this.suggLen)),t&&(t.toLowerCase()==i.substr(0,this.suggLen).toLowerCase()||u.toLowerCase()==i.substr(0,this.suggLen-(r+this.model.delimiterChar.length)).toLowerCase())?(e=this.model.multiSelectMode=="delimiter"?t+i.substr(u.length,i.length):t+i.substr(t.length,i.length),this.element.val(e),this._autofilSelection(),this.model.multiSelectMode=="visualmode"&&(this._adjustWidth(),this.model.enableAutoFill&&this._refreshPopup()),this.model.autoFocus&&!this.noresult&&this._addListHover()):this._removeSelection())},_enterTextBoxValue:function(n){var t,i,r;!this._activeItem||this.noresult||this.model.readOnly||(t=this.getActiveText(),i=this._currList[this._activeItem-1],this._preVal=t+(this.model.multiSelectMode=="delimiter"?this.model.delimiterChar:""),this._valueToTextBox(t,i,!1),r=this.model.multiSelectMode=="visualmode"?this._modelValue:this.element.val()==""?null:this.element.val(),this._trigger("select",{event:n,isInteraction:!0,value:r,text:t,key:this._getUniqueKey(),item:i}),this._valueChange(n));this._trigger("close",{event:n,isInteraction:!0})},_createBox:function(i){var r=t.buildTag("span.e-icon e-close"),u=t.buildTag("li.e-options",i).append(r);return this._on(r,"click",function(t){if(!this.model.enabled)return!1;this._deleteBox(n(t.target).parent())}),u},_addLoadingClass:function(){this.model.showLoadingIcon&&this.element.addClass("e-load")},_removeLoadingClass:function(){this.element.removeClass("e-load")},_highlightSuggestion:function(t){if(n.trim(this._queryString)!=""){var f,e,r,u,o,i,s;f=this.model.caseSensitiveSearch?"g":"gi";i=n.trim(this._queryString);i=/^[a-zA-Z0-9- ]*$/.test(i)?i:i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");e=this.model.filterType=="startswith"?"^"+i:this.model.filterType=="endswith"?i+"$":i;r=new RegExp(e,f);r.test(t)&&(u=t.match(r),s=t.replace(r,"~^"),o=s.split("~^"),t="",n(o).each(function(n,i){t+=u[n]?i+"<span class='e-hilight-txt'>"+u[n]+"<\/span>":i}))}return t},_RightToLeft:function(n){n?(this.wrapper.addClass("e-rtl"),this.suggestionList.addClass("e-rtl")):(this.wrapper.removeClass("e-rtl"),this.suggestionList.removeClass("e-rtl"));this.model.multiColumnSettings.enable&&this.model.multiColumnSettings.showHeader&&(this._tableHeaderDiv.removeClass(n?"e-atc-tableHeaderRTL":"e-atc-tableHeaderScroll"),this._tableHeader.find("tr :not(th:last)").addClass(n?"e-atc-thleft":"e-atc-thright").removeClass(n?"e-atc-thright":"e-atc-thleft"))},_setRoundedCorner:function(n){n?(this.container.addClass("e-corner"),this.suggestionList.addClass("e-corner")):(this.container.removeClass("e-corner"),this.suggestionList.removeClass("e-corner"))},_checkReadOnly:function(n){this.model.readOnly=n;this.model.readOnly?(this.element.attr({readonly:"readonly","aria-readonly":!0}),this._off(this.element,"keydown",this._OnKeyDown),this._off(this.element,"keyup",this._OnKeyUp)):(this.element.removeAttr("readonly").removeAttr("aria-readonly"),this._on(this.element,"keydown",this._OnKeyDown),this._on(this.element,"keyup",this._OnKeyUp))},_OnKeyDown:function(t){var f;this.model.filterType!="startswith"&&(this.model.enableAutoFill=!1);switch(t.keyCode){case 37:case 35:case 36:this._removeSelection();break;case 38:this.showSuggestionBox&&this.suggestionList&&(this._removeListHover(),this._activeItem>1?this._activeItem-=1:this._activeItem=this._listSize,this._navigationHover());this._PreventDefaultAction(t);break;case 40:this.showSuggestionBox&&this.suggestionList?(this._removeListHover(),this._activeItem<this._listSize?this._activeItem+=1:this._activeItem=1,this._navigationHover()):t.ctrlKey&&this.element.val()==""?this._showFullList(t):t.ctrlKey&&this._showSuggestionList(t);this._PreventDefaultAction(t);break;case 33:case 34:if(this.showSuggestionBox&&this.suggestionList){this._removeListHover();var i=this.model.multiColumnSettings.enable?this._tableColumn.parent().height():this.suggestionList.height(),r=this.model.multiColumnSettings.enable?this._tableColumn.find("tr").outerHeight():this.ul.children("li").outerHeight(),u=Math.round(i/r)!=0?Math.round(i/r):this._listSize;this._activeItem=t.keyCode==33?this._activeItem-u:this._activeItem+u;this._activeItem<1&&(this._activeItem=1);this._activeItem>this._listSize&&(this._activeItem=this._listSize);this._navigationHover()}this._PreventDefaultAction(t);break;case 8:n.trim(this.element.val())==""&&(this._isOpened=!1);this.model.multiSelectMode=="visualmode"&&this.element.val()==""&&this._deleteLastBox();break;case 17:this.ctrlKeyPressed=!0;break;case 13:t.preventDefault();break;case 9:this.showSuggestionBox&&(this._queryString=this.element.val(),this._enterTextBoxValue(t),this._hideResult(t),this._isOpened=!1,this._PreventDefaultAction(t));break;case 27:this._isOpened=!1;f=this.showSuggestionBox;this._hideResult(t);this._PreventDefaultAction(t);f&&this._trigger("close",{event:t,isInteraction:!0})}this.model.multiSelectMode=="visualmode"&&(t.keyCode!=17&&t.keyCode!=8&&t.keyCode!=46&&this._removeActive(),this._adjustWidth())},_PreventDefaultAction:function(n){n.preventDefault();this._cancelEvent||(n.stopPropagation(),n.cancelBubble=!0,n.returnValue=!0)},_bubbleEvent:function(n){return typeof n=="boolean"&&(this._cancelEvent=n),this._cancelEvent},_navigationHover:function(){this._addListHover();this.model.enableAutoFill&&(this.element.attr("aria-autocomplete","both"),this._queryString=this.target.value,this._setTextBoxValue())},_OnKeyUp:function(t){if(this._keyDownComplete(t),this.ctrlKeyPressed)return t.keyCode==17&&(this.ctrlKeyPressed=!1),!1;if(n.trim(this.element.val())==""&&t.keyCode==38&&t.keyCode==40)return this._hideResult(t),!1;if(!this._checkDelimiter())return!1;this._queryString=n.trim(this._queryString);switch(t.keyCode){case 34:case 33:case 38:case 40:case 37:case 39:case 20:case 16:case 17:case 18:case 35:case 36:case 144:case 9:case 27:break;case 13:t.preventDefault();this._queryString=this.element.val();this._enterTextBoxValue(t);this.model.enableAutoFill&&(this.element.attr("aria-autocomplete","both"),this.suggLen=this.element.val().length,this._autofilSelection());this._isOpened=!1;this._hideResult(t);break;case 46:if(this.model.multiSelectMode=="visualmode"&&this.element.val()==""){this._deleteBox(this._ulBox.children("li.e-active"));break}case 8:this._queryString.length>=this.model.minCharacter?(this._autoFill=!1,this._OnTextEnter(t)):(this.noresult=!0,this._hideResult(t),n.trim(this.element.val())==""&&(this._isOpened=!1,this._trigger("close",{event:t,isInteraction:!0})));this._typed=!0;break;default:this._queryString.length>=this.model.minCharacter?(this._autoFill=!0,this._OnTextEnter(t)):this.noresult=!0;this._typed=!0}},_getFilteredList:function(n,i){var u,r;t.isNullOrUndefined(n)||typeof n[0]!="object"||(u=this.model.fields.text?this.model.fields.text:"text",this.model.actionFailure&&t.isNullOrUndefined(t.DataManager(n).executeLocal(t.Query().select(u))[0])&&this._trigger("actionFailure",{error:this._localizedLabels.actionFailure}));!n||!n.length||n.length<1?(this.suggestionListItems=[],this.model.actionFailure&&this._trigger("actionFailure",{error:this._localizedLabels.actionFailure})):(r=t.Query(),this._addQuery(r,typeof n[0]=="object"),this.suggestionListItems=t.DataManager(n).executeLocal(r),this.model.actionSuccess&&this._trigger("actionSuccess"));this._doneRemaining(i);this.model.actionComplete&&this._trigger("actionComplete")},_performSearch:function(n){var i,r;this.model.actionBegin&&this._trigger("actionBegin");i=this.model.dataSource;t.DataManager&&i instanceof t.DataManager?i.dataSource.offline||i.dataSource.json&&i.dataSource.json.length>0?this._getFilteredList(i.dataSource.json,n):(window.clearTimeout(this.timer),r=this,this.timer=window.setTimeout(function(){r._fetchRemoteDat(i)},700)):this._getFilteredList(i,n)},_fetchRemoteDat:function(n){var t=this,i,r=this._getQuery();this._addQuery(r,!0);i=n.executeQuery(r);i.fail(function(n){t.suggestionListItems=null;t._removeLoadingClass();t._trigger("actionFailure",n)}).done(function(n){t.suggestionListItems=n.result;t._doneRemaining(n);t._trigger("actionSuccess",n)}).always(function(n){t._trigger("actionComplete",n)})},_addSortingQuery:function(n,t){if(this.model.allowSorting){var i=this.model.sortOrder=="descending"?!0:!1;n.sortBy(t,i)}},_addQuery:function(n,t){var i="",r,u;if(t&&(r=this.model.fields,i=r&&r.text?r.text:"text"),this._queryString)if(this.model.multiColumnSettings.enable){for(i=[],this._columnIndex=this.model.multiColumnSettings.stringFormat.match(/\{.+?\}/g).map(function(n){return n.slice(1,-1)}),u=0;u<this._columnIndex.length;u++)i.push(this.model.multiColumnSettings.columns[this._columnIndex[u]].field);n.search(this._queryString,i,this.model.filterType,!this.model.caseSensitiveSearch)}else n.where(i,this.model.filterType,this._queryString,!this.model.caseSensitiveSearch);this._addSortingQuery(n,i)},_getQuery:function(){var r;if(t.isNullOrUndefined(this.model.query)){var u=[],i=t.Query(),n=this.model.fields;for(r in n)r!=="tableName"&&n[r]&&u.push(n[r]);u.length>0&&i.select(u);t.isNullOrUndefined(this.model.dataSource.dataSource.url)||this.model.dataSource.dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||i.from(n.tableName)}else i=this.model.query.clone();return i},_OnTextEnter:function(n){this._addLoadingClass();this.element.attr("aria-expanded",!1);this._performSearch(n);this.model.showResetIcon&&this._showReset()},_showReset:function(){t.isNullOrUndefined(this.resetSpan)&&(this.resetSpan=t.buildTag("span.e-icon e-iclose"),this.model.showPopupButton?(this.dropdownbutton.before(this.resetSpan),this.container.addClass("e-popup e-reset")):this.container.append(this.resetSpan).addClass("e-reset"));this._on(this.resetSpan,"mousedown",this._refreshSearch)},_refreshSearch:function(){this.resetSpan=null;this.clearText();this._refreshPopup()},_removeReset:function(){this.resetSpan.remove();this._refreshPopup()},_doneRemaining:function(n){this._showSuggestionList(n);this.element.attr({"aria-expanded":!0,"aria-haspopup":!0});(this.model.enableAutoFill&&this._autoFill&&!this.noresult||this.model.autoFocus)&&(this.element.attr("aria-autocomplete","both"),this._activeItem=1,this._queryString=this.target.value);this.model.enableAutoFill&&this._autoFill&&!this.noresult&&this._setTextBoxValue();this.model.autoFocus&&!this.noresult&&this._addListHover();this._removeLoadingClass();this.noresult&&!this.model.showEmptyResultText&&this._hideResult(n)},_removeRepeated:function(){var t=this.suggestionListItems,n,i;if(!t||t.length==0||this._selectedItems.length==0)return!1;for(this._repeatRemove=!1,n=0;n<this._selectedItems.length;n++)i=t.indexOf(this._selectedItems[n]),i!=-1&&this.suggestionListItems.splice(i,1),this.element.val()==this._selectedItems[n]&&(this._repeatRemove=!0)},_checkDelimiter:function(){this._queryString=this.element.val();var n=this.model.multiSelectMode!="delimiter"?-1:this._queryString.lastIndexOf(this.model.delimiterChar);return n==-1?!0:(this._queryString=this._queryString.substr(n+this.model.delimiterChar.length,this._queryString.length),!0)},_autofilSelection:function(){var n=this.element[0],t=this.element.val().length;n.setSelectionRange?n.setSelectionRange(this.suggLen,t):n.createTextRange&&(n=n.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",this.suggLen),n.select())},_OnDropdownClick:function(n){this.model.enabled&&!this.model.readOnly&&(n.preventDefault(),(n.which&&n.which==1||n.button&&n.button==0)&&(this._addLoadingClass(),this.showSuggestionBox?(this._isOpened=!1,this._hideResult(n),this._removeLoadingClass()):this._showFullList(n)))},_showFullList:function(n){this._isFocused||this.element.focus();this._queryString=null;this._autoFill=!1;this._performSearch(n)},_OnMouseEnter:function(n){this._getActiveItemIndex(n)},_getActiveItemIndex:function(t){var i=t.target;this.model.multiColumnSettings.enable&&t.target.tagName.toLowerCase()!="tr"?i=n(t.target).parents("tr"):t.target.tagName.toLowerCase()!="li"&&(i=n(t.target).parents("li"));this._getLiTags().removeClass("e-hover");n(i).addClass("e-hover");this._queryString=this.element.val();this._activeItem=this._getLiTags().index(n(i))+1},_OnMouseLeave:function(){this._getLiTags().removeClass("e-hover");this.model.highlightSearch&&this._getLiTags().find(".e-hilight-txt").removeClass("e-hover")},_OnMouseClick:function(n){this._getActiveItemIndex(n);this.noresult||(this._enterTextBoxValue(n),this._isOpened=!1,this._hideResult(n))},_OnDocumentClick:function(t){n(t.target).is(this.suggestionList)||n(t.target).parents(".e-atc-popup").is(this.suggestionList)||n(t.target).is(this.element)||n(t.target).parents(".e-atc").is(this.wrapper)?(n(t.target).is(this.suggestionList)||n(t.target).parents(".e-atc-popup").is(this.suggestionList))&&t.preventDefault():(this._isOpened=!1,this._hideResult(t),this._trigger("close",{event:t,isInteraction:!0}))},_OnWindowResize:function(){this._refreshPopup()},_keyProcess:function(n){var i=this._declareVariable(),e=this,u,r,f;if(u=this._delimiterChar(),!t.isNullOrUndefined(n))for(r=0;r<n.length;r++)f=n[r],t.DataManager&&this.model.dataSource instanceof t.DataManager?(this._dataQuery=this.model.multiColumnSettings.enable?this._getQuery():this._getQuery().where(i[0],"equal",f,!1),this._promise=this.model.dataSource.executeQuery(this._dataQuery),this._promise.done(function(){return e._selectValueByKey(null),!1}).fail(function(){return!1})):(this._dataQuery=this.model.multiColumnSettings.enable?t.Query():t.Query().where(i[0],"equal",f,!1),this._promise=t.DataManager(this.model.dataSource).executeLocal(this._dataQuery),this.model.multiColumnSettings.enable?this._formatStringKey(n,i,u):this._promise instanceof Array&&this._promise.length==0?this._selectValueByKey()!=null?this._selectValueByKey():null:this._getFieldKey(this._promise[0],i[1],u))},_formatStringKey:function(n,t,i){var r,e,f,u;for(this._selectValueByKey(null),r=0;r<n.length;r++)if(n[r]!=""){for(e=n[r],u=0;u<this._promise.length;u++)e==this._textFormateString(this._promise[u])&&(f=u);f?this._getFieldKey(this._promise[f],t[1],i):this._selectValueByKey()!=null?this._selectValueByKey():null}},_getFieldKey:function(i,r,u){if((t.isNullOrUndefined(this.model.template)||!t.isNullOrUndefined(this._getField(i,r)))&&!t.isNullOrUndefined(this._getField(i,r))){if(f=this._getField(i,r).toString(),this.model.multiSelectMode!="none"){var e,o,f=this._selectValueByKey();delimiterChar=this.model.delimiterChar;e=this._getField(i,r).toString();f!=null?(o=f.toString().split(u).filter(function(n){return n!==""}),n.inArray(e,o)==-1?(o.push(e),f=o.join(delimiterChar)+delimiterChar):f=e+delimiterChar):f=e+delimiterChar}this._selectValueByKey(f)}},_removeDuplicateVal:function(i){var r=[];return n.each(i,function(t,i){n.inArray(i,r)==-1&&r.push(i)}),i.length!=1||t.isNullOrUndefined(this._originalval)||n.inArray(i[0],this._originalval)==-1&&this._selectValueByKey(null),r},_valueChange:function(n){var t=this.model.multiSelectMode=="visualmode"?this._modelValue:this.element.val()==""?null:this.element.val();this.value()!=t&&(this.value(t),this._changeEvtTrigger(t,n));this.model.showResetIcon&&!t&&(this.wrapper.find("span.e-iclose").remove(),this.resetSpan=null)},_changeEvtTrigger:function(n,t){var r=t!=i?{event:t,isInteraction:!0,value:n}:{isInteraction:!1,value:n};this.initialRender||(this._trigger("_change",{value:n}),this._trigger("change",r))},_updateSelectedItemArray:function(n){var i=[],r;if(this._selectedItems=[],this.suggestionListItems=this.model.dataSource,this.model.multiSelectMode=="delimiter"&&n)if(i=n.split(this.model.delimiterChar),t.DataManager&&this.model.dataSource instanceof t.DataManager||!t.isNullOrUndefined(this.suggestionListItems)&&typeof this.suggestionListItems[0]!="object")for(r=0;r<i.length;r++)i[r]&&this._selectedItems.push(i[r]);else this._createBoxForObjectType(i);else this.model.multiSelectMode=="none"&&n&&(i.push(n),t.DataManager&&this.model.dataSource instanceof t.DataManager||!t.isNullOrUndefined(this.suggestionListItems)&&typeof this.suggestionListItems[0]!="object"?this._selectedItems.push(n):this._createBoxForObjectType(i))},_keyDownComplete:function(n){var t=this.element.val();this._preVal!=t&&(this._preVal=t,this.model.multiSelectMode=="visualmode"&&this._adjustWidth(),this._valueChange(n))},_moveCaretToEnd:function(n){var t,i;n.scrollLeft=n.scrollWidth;n.createTextRange&&(t=n.createTextRange(),t.moveEnd("textedit"),t.moveStart("textedit"),t.select());typeof n.selectionStart=="number"?n.selectionStart=n.selectionEnd=n.value.length:typeof n.createTextRange!="undefined"&&(i=n.createTextRange(),i.collapse(!1),i.select())},_getCaretSelection:function(){var n=this.element[0],u=0,f=0,e,t,i,r,o;return isNaN(n.selectionStart)?(e=document.selection.createRange().getBookmark(),t=n.createTextRange(),t.moveToBookmark(e),i=n.createTextRange(),i.collapse(!0),i.setEndPoint("EndToStart",t),r=i.text.length,o=t.text.length,{start:r,end:r+o}):(u=n.selectionStart,f=n.selectionEnd,{start:Math.abs(u),end:Math.abs(f)})},_getLocalizedLabels:function(){return t.getLocalizedConstants(this.sfType,this.model.locale)},_wireEvents:function(){this._on(this.element,"focus",this._targetFocus);this._on(this.element,"blur",this._targetBlur)}});t.Autocomplete.Locale=t.Autocomplete.Locale||{};t.Autocomplete.Locale["default"]=t.Autocomplete.Locale["en-US"]={addNewText:"Add New",emptyResultText:"No suggestions",actionFailure:"The specified field doesn't exist in given data source"};t.filterType={StartsWith:"startswith",Contains:"contains",EndsWith:"endswith",LessThan:"lessthan",GreaterThan:"greaterthan",LessThanOrEqual:"lessthanorequal",GreaterThanOrEqual:"greaterthanorequal",Equal:"equal",NotEqual:"notequal"};t.SortOrder={Ascending:"ascending",Descending:"descending"};t.MultiSelectMode={None:"none",Delimiter:"delimiter",VisualMode:"visualmode"};t.Animation={None:"none",Slide:"slide",Fade:"fade"}})(jQuery,Syncfusion)});
