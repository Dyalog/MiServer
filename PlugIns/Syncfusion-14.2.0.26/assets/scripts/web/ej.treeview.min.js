/*!
*  filename: ej.treeview.min.js
*  version : 14.2.0.26
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.draggable.min","./ej.checkbox.min","./ej.waitingpopup.min"],n):n()})(function(){(function(n,t,r){t.widget("ejTreeView","ej.TreeView",{_rootCSS:"e-treeview",element:null,model:null,validTags:["ul","div"],_addToPersist:["expandedNodes","checkedNodes","selectedNode"],_setFirst:!1,defaults:{showCheckbox:!1,enableAnimation:!0,allowDragAndDrop:!1,htmlAttributes:{},allowDropChild:!0,allowDropSibling:!0,allowDragAndDropAcrossControl:!0,allowEditing:!1,allowKeyboardNavigation:!0,items:null,fields:{dataSource:null,query:null,tableName:null,child:null,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass",expanded:"expanded",hasChild:"hasChild",selected:"selected",linkAttribute:"linkAttribute",imageAttribute:"imageAttribute",htmlAttribute:"htmlAttribute",imageUrl:"imageUrl",isChecked:"isChecked"},autoCheckParentNode:!1,loadOnDemand:!1,cssClass:"",template:null,enableRTL:!1,expandOn:"dblclick",enablePersistence:!1,enabled:!0,expandedNodes:[],checkedNodes:[],selectedNode:-1,width:null,height:null,autoCheck:!0,enableMultipleExpand:!0,sortSettings:{allowSorting:!1,sortOrder:"ascending"},nodeClick:null,beforeExpand:null,nodeExpand:null,beforeCollapse:null,nodeCollapse:null,beforeSelect:null,nodeSelect:null,nodeCheck:null,nodeUncheck:null,inlineEditValidation:null,beforeEdit:null,nodeEdit:null,keyPress:null,nodeDragStart:null,nodeDrag:null,nodeDragStop:null,nodeDropped:null,beforeAdd:null,nodeAdd:null,beforeDelete:null,nodeDelete:null,beforeCut:null,nodeCut:null,beforePaste:null,nodePaste:null,beforeLoad:null,loadSuccess:null,loadError:null,ready:null,create:null,destroy:null},dataTypes:{cssClass:"string",showCheckbox:"boolean",enableAnimation:"boolean",allowDragAndDrop:"boolean",allowDropChild:"boolean",allowDragAndDropAcrossControl:"boolean",allowEditing:"boolean",allowKeyboardNavigation:"boolean",autoCheckParentNode:"boolean",loadOnDemand:"boolean",enableRTL:"boolean",expandOn:"string",enablePersistence:"boolean",enableMultipleExpand:"boolean",items:"data",fields:{dataSource:"data",query:"data",child:"data"},expandedNodes:"array",checkedNodes:"array",selectedNode:"number",htmlAttributes:"data",sortSettings:{allowSorting:"boolean",sortOrder:"enum"}},observables:["fields.dataSource"],dataSource:t.util.valueFunction("fields.dataSource"),_setModel:function(i){var r,s,h,c,e,f,u,o,l;for(r in i)switch(r){case"cssClass":this._changeSkin(i[r]);break;case"fields":this._unWireEvents();h=this.element.hasClass("e-js")?!1:!0;c=h?this.element.children("ul"):this.element;c.empty();this.model.fields==null||i[r]==null?this.model.fields=i[r]:this._extendFields(this.model.fields,i[r]);this.model.expandedNodes=[];this.model.checkedNodes=[];this.model.selectedNode=-1;!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null?this._checkDataBinding():this._initialize();h&&(s=this.element.children(".e-treeview-ul"),c.append(s.children()),s.remove());break;case"allowDragAndDropAcrossControl":this.model.allowDragAndDropAcrossControl=i[r];this._enableDragDrop();break;case"enabled":this._enabledAction(i[r]);break;case"showCheckbox":i[r]?(this.model.showCheckbox=i[r],this._showCheckBox(),this.model.enabled||this.element.find(".nodecheckbox").ejCheckBox("disable")):(this.element.find(".e-item > div > .e-chkbox-wrap").remove(),this._updateCheckedNodes());break;case"autoCheck":this.model.autoCheck=i[r];break;case"autoCheckParentNode":this.model.autoCheckParentNode=i[r];break;case"expandedNodes":if(u=i[r].length,e=JSON.parse(JSON.stringify(this.model.expandedNodes)),u>0)for(this._expandNodes(i[r]),f=0,u=e.length;f<u;f++)i[r].indexOf(e[f])==-1&&this._collpaseNode(n(this._liList[e[f]]));else u==0&&this._collapseAll();break;case"checkedNodes":if(this.model.showCheckbox)if(u=i[r].length,e=JSON.parse(JSON.stringify(this.model.checkedNodes)),u>0)for(this._checkedNodes(i[r]),f=0,u=e.length;f<u;f++)i[r].indexOf(e[f])==-1&&this._nodeUncheck(n(this._liList[e[f]]).find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]);else u==0&&this._uncheckAll();break;case"expandOn":this._off(this.element,this.model.expandOn,this._expandEventHandler);this._on(this.element,i[r],this._expandEventHandler);break;case"allowEditing":this._preventEditable();i[r]&&this._allowEditable();break;case"allowKeyboardNavigation":o=i[r]?"_on":"_off";this[o](this.element,"keydown",this._KeyPress);break;case"allowDragAndDrop":this.model.allowDragAndDrop=i[r];i[r]?this._addDragableClass():this._preventDraggable();break;case"allowDropChild":this.model.allowDropChild=i[r];i[r]?this._addDragableClass():this._preventDropChild();break;case"allowDropSibling":this.model.allowDropSibling=i[r];i[r]?this._addDragableClass():this._preventDropSibling();break;case"enableRTL":this.model.enableRTL=i[r];l=this.element.is("UL")?this.element.parent(".e-treeview-wrap"):this.element;o=this.model.enableRTL?"addClass":"removeClass";l[o]("e-rtl");break;case"height":this.element.height(i[r]);break;case"width":this.element.width(i[r]);break;case"selectedNode":this.model.selectedNode=i[r];this.model.selectedNode>=0?this._nodeSelectionAction(n(this._liList[this.model.selectedNode])):this.unselectNode(this.element.find(".e-item > div > .e-active").closest(".e-item"));break;case"htmlAttributes":this._addAttr(i[r]);break;case"enableMultipleExpand":i[r]||this.collapseAll();break;case"sortSettings":n.extend(this.model.sortSettings,i[r]);t.isNullOrUndefined(this.model.fields)||this.dataSource()==null||(this.model.expandedNodes=[],this.model.checkedNodes=[],this.model.selectedNode=-1,this._checkDataBinding())}},_destroy:function(){this.element.html("");this._cloneElement.removeClass("e-treeview e-js e-treeview-wrap");var t=this.element.is("UL")?this.element.parent(".e-treeview-wrap"):this.element;t.replaceWith(this._cloneElement);n("#"+this._id+"_WaitingPopup").remove();window.localStorage?(window.localStorage.removeItem(this._id+"_childNodes"),window.localStorage.removeItem(this._id+"_persistedValues")):window.cookie&&(document.cookie=this._id+"_childNodes=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie=this._id+"_persistedValues=; expires=Thu, 01 Jan 1970 00:00:00 UTC")},_init:function(){var i,n;this._cloneElement=this.element.clone();this._dataSource=[];this._fragment=[];this._templateType="";this._indexID=0;this._newDataSource=this.dataSource();this._id=this.element.prop("id");this._treeList=[];this._isTextbox=!1;this.model.enablePersistence&&(i=this._getCookies("_persistedValues"),i||(n={selectedNode:"",expandedNodes:[],checkedNodes:[]},n=this._updatePersistAttr(n),this._setCookies("_persistedValues",JSON.stringify(n))));t.isNullOrUndefined(this.model.fields)||this.dataSource()==null?(this._initialize(),this._completeRendering()):this._checkDataBinding()},_initialize:function(){this._cutNode=null;this._beforeEditText=null;this._CurrenctSelectedNodes=[];this.element.is("ul")?this._createWrapper():(this.element.addClass("e-treeview-wrap e-widget").attr("tabindex",0).children("ul:first").addClass("e-ul e-box"),this.model.width!=null&&this.element.width(this.model.width),this.model.height!=null&&this.element.height(this.model.height),this.model.enableRTL&&this.element.addClass("e-rtl"),this.model.cssClass!=null&&this.element.addClass(this.model.cssClass),this._addAttr(this.model.htmlAttributes));this._elementSettings();this._beforeBaseClass();this.dataSource()==null&&(this._addBaseClass(),this._controlRender());this._finalize();this._enabledAction(this.model.enabled)},_completeRendering:function(){this._treeList.length==0&&this._triggerEvent("ready",{element:this.element[0]})},_extendFields:function(t,i){if(t==null||i==null)t=i;else if(t.child==null||i.child==null)n.extend(t,i);else{this._extendFields(t.child,i.child);var r=t.child;n.extend(t,i);n.extend(t.child,r)}},_elementSettings:function(){var n=this.element.is("UL")?this.element.parent(".e-treeview-wrap"):this.element;this.element.is("ul")?n.attr("role","tree"):n.attr("aria-activedescendant",this._id+"_active").children("ul:first").attr("role","tree")},_beforeBaseClass:function(){var t=this.element.is("UL")?this.element.parent(".e-treeview-wrap")[0]:this.element[0];this._ulList=n(t.querySelectorAll("ul"));this._liList=n(t.querySelectorAll("li"))},_createWrapper:function(){var n=t.buildTag("div.e-treeview-wrap e-widget "+this.model.cssClass,"","",{tabindex:0,"aria-activedescendant":this._id+"_active"});this.model.width!=null&&n.width(this.model.width);this.model.height!=null&&n.height(this.model.height);this.model.enableRTL&&n.addClass("e-rtl");n.insertAfter(this.element);n.append(this.element.addClass("e-ul e-box").attr("tabindex",0));this._addAttr(this.model.htmlAttributes)},_addAttr:function(t){var i=this;n.map(t,function(n,t){t=="class"?i.element.addClass(n):t=="disabled"&&n=="disabled"?i._enabledAction(!1):i.element.attr(t,n)})},_changeSkin:function(n){if(this.model.cssClass!=n){var t=this.element.is("UL")?this.element.parent(".e-treeview-wrap"):this.element;t.removeClass(this.model.cssClass).addClass(n);t.find(".e-item > div > .e-chkbox-wrap").removeClass(this.model.cssClass).addClass(n)}},_enabledAction:function(n){this.model.enabled=n;n?(this.element.removeClass("e-disable"),this._wireEvents()):(this.element.addClass("e-disable"),this._unWireEvents())},_checkDataBinding:function(){this.dataSource()instanceof t.DataManager?this._initDataSource():(this._ensureDataSource(this.dataSource()),this._initialize(),this._completeRendering())},_initDataSource:function(){this.element.ejWaitingPopup();var u=this.element.ejWaitingPopup("instance"),n=this,i,r;this.element.ejWaitingPopup("refresh");this.element.ejWaitingPopup("show");r=this._columnToSelect(this.model.fields);i=this.dataSource().executeQuery(r);i.done(function(i){n.element.ejWaitingPopup("hide");n.retriveData=i.xhr&&i.xhr.responseJSON&&i.xhr.responseJSON.d?i.xhr.responseJSON.d:i.result?i.result:[];n._typeOfFieldId=n.retriveData[0]?(typeof n.retriveData[0][n.model.fields.id]).toLowerCase():"";n._ensureDataSource(n.retriveData);n._initialize();(n.model.loadOnDemand||t.isNullOrUndefined(n.model.fields.child))&&n._completeRendering()})},_columnToSelect:function(n){var u=[],r=t.Query(),i;if(n.query||t.isNullOrUndefined(n.tableName))r=n.query?n.query:r;else{for(i in n)i!=="tableName"&&i!=="child"&&i!=="dataSource"&&n[i]&&u.push(n[i]);u.length>0&&r.select(u);this.dataSource().dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||r.from(n.tableName)}return r},_ensureDataSource:function(n){n=this._getSortAndFilterList(this.model.fields,n);this.currentSelectedData=n;this._renderTemplate(n);this.element.is("ul")?this.element.html(this._fragment.firstChild.children):this.element.html(this._fragment)},_getTemplateType:function(n,t){for(var i=0,r=n.length;i<r;i++){if(n[i].hasOwnProperty(t.parentId)||n[i].hasOwnProperty(t.hasChild))return 1;if(n[i].hasOwnProperty("child"))return 2}return 1},_groupingObjects:function(n,t){for(var u,r={},f=[],i=0,e=n.length;i<e;i++)u=JSON.stringify(t(n[i])),r[u]=r[u]||[],r[u].push(n[i]);for(i in r)f.push(r[i]);return f},_renderTemplate:function(n){this._onlineData=!1;this._loadOnDemandNodes=!1;var i=this;this._templateType=this._getTemplateType(n,this.model.fields);this._dataSource=this._templateType==1?this._groupingObjects(n,function(n){return[!t.isNullOrUndefined(n)&&[n[i.model.fields.parentId]].toString()]}):n;this._templateNodeCreation(n,this.model.fields)},_templateNodeCreation:function(i,r){var e,u,f,o;if(this._fragment=document.createDocumentFragment(),e=document.createElement("ul"),this._fragment.appendChild(e),u=this._fragment.firstChild,(this._onlineData||this._loadOnDemandNodes)&&(u.className="e-treeview-ul",u.setAttribute("role","group"),n(u).attr("style","display:none")),this.dataSource()!=null){for(f=0,o=i.length;f<o;f++)i[f]&&(t.isNullOrUndefined(i[f][this.model.fields.parentId])||i[f][this.model.fields.parentId]==0||this._loadOnDemandNodes)&&u.appendChild(this._genTemplate(i[f],r));n(u).find(".e-item:first-child:not(:last-child)").addClass("first");n(u).find(".e-item:last-child").addClass("last")}},_onlineDataSource:function(t,i,r){this._loadOnDemandNodes=!0;this._templateNodeCreation(t,r);var u=this.element.find(".e-item#"+i);u[0]!=null&&(n(u[0]).append(this._fragment),u.children().find("> div:first").addClass("e-icon e-plus"),this._finalizeLoadOnDemand(u));this._onlineData=!1},_genTemplate:function(i,r){var v=document.createDocumentFragment(),u,y,f,e,s,o,p,w,h,l,a,c,b;if(y=document.createElement("li"),v.appendChild(y),u=v.firstChild,u.id=i[r.id]?i[r.id]:"",u.setAttribute("role","treeitem"),i[r.htmlAttribute]&&this._setAttributes(i[r.htmlAttribute],u),u.className+=" e-item",e=document.createElement("a"),i[r.imageUrl]?(f=document.createElement("img"),f.className="e-align",f.src=i[r.imageUrl],i[r.imageAttribute]&&this._setAttributes(i[r.imageAttribute],f)):i[r.spriteCssClass]&&(f=document.createElement("span"),f.className=i[r.spriteCssClass]),this.model.template){if(f&&e.appendChild(f),typeof n.fn.render!="function")throw"Error : JsRender dependecy script missing";e.innerHTML+=this._renderEjTemplate(this.model.template,i)}else i[r.text]?n(e).text(i[r.text]):n(e).text("undefined"),f&&e.insertBefore(f,e.lastChild);if(i[r.linkAttribute]&&(typeof i[r.linkAttribute]=="object"?this._setAttributes(i[r.linkAttribute],e):e.href=i[r.linkAttribute]),u.appendChild(e),i[r.expanded]&&(u.className+=" expanded"),i[r.selected]&&(u.className+=" selected"),t.isNullOrUndefined(i[r.isChecked])||(u.className+=i[r.isChecked]?" checked":" unchecked"),u.setAttribute("aria-selected",!1),u.setAttribute("aria-expanded",!1),this.dataSource()instanceof t.DataManager)this._updateElement(u,!0),this.model.showCheckbox&&this._checkboxOnTemplate(u.children[0]),this.model.loadOnDemand?(i[r.hasChild]||i.hasOwnProperty("child"))&&(u.children[0].firstChild.className="e-icon e-plus"):!t.isNullOrUndefined(r.child)&&r.child.dataSource instanceof t.DataManager?(o=this,w=r.child.parentId?r.child.parentId:o.model.fields.parentId,h,h=r.id?r.id:this.model.fields.id,this._treeList.push("false"),p=this._executeDataQuery(r.child,w,this._typeOfFieldId=="number"?parseInt(i[h]):i[h]),p.done(function(n){o._treeList.pop();s=n.xhr&&n.xhr.responseJSON&&n.xhr.responseJSON.d?n.xhr.responseJSON.d:n.result?n.result:[];s=o._getSortAndFilterList(r.child,s);s&&s.length>0&&(o._onlineData=!0,o._onlineDataSource(s,s[0][r.child.parentId],r.child));o._treeList.length==0&&o._completeRendering()})):t.isNullOrUndefined(this.model.fields.child)&&this._childNodeCreation(i,u,r);else if(this.model.loadOnDemand){if(this._updateElement(u,!0),(i[r.hasChild]||i.hasOwnProperty("child"))&&(u.children[0].firstChild.className="e-icon e-plus"),this.model.showCheckbox&&this._checkboxOnTemplate(u.children[0]),i[r.expanded]&&this._childNodeCreation(i,u,r),this.model.enablePersistence&&(l=this._getCookies("_childNodes"),l))for(a=JSON.parse(l),c=0,b=a.length;c<b;c++)if(a[c].toString()==i[r.id].toString()){this._childNodeCreation(i,u,r);break}}else this._onlineData||(this._updateElement(u,!0),this.model.showCheckbox&&this._checkboxOnTemplate(u.children[0]),this._childNodeCreation(i,u,r));return u},_childNodeCreation:function(i,r,u){var f,s,h,e,o,c;if(f=this._templateType==2?!t.isNullOrUndefined(i.child)&&i.child.length>0&&i.child:this._getChildNodes(this._dataSource,{id:i[u.id]}),!t.isNullOrUndefined(f)&&f.length>0){for(r.children[0].firstChild.className="e-icon e-plus",s=document.createDocumentFragment(),h=document.createElement("ul"),s.appendChild(h),e=s.firstChild,e.className="e-treeview-ul",e.setAttribute("role","group"),n(e).attr("style","display:none"),o=0,c=f.length;o<c;o++)f[o]&&e.appendChild(this._genTemplate(f[o],u));r.appendChild(h)}},_checkboxOnTemplate:function(n){n.parentElement.id==""&&(n.parentElement.id=this._id+"_"+this._indexID,this._indexID++);var t=document.createElement("input");t.setAttribute("type","checkbox");t.setAttribute("class","nodecheckbox");t.setAttribute("name",this._id+"_Checkbox_"+n.parentElement.id);t.setAttribute("value",n.parentElement.id);n.insertBefore(t,n.children[1])},_updateElement:function(t,i){var f,e,u,o,s=t.firstChild,h,c,l;s&&(h=s.nodeName,h=="SPAN"||h=="IMG"?(o=s,u=t.lastChild):u=t.lastChild,u&&(l=u.lastChild!=null?u.lastChild.nodeValue:"",c=u.innerHTML,textElement=n(u).clone()[0],n(u).remove(),textElement.className+=" e-text CanSelect",textElement.innerHTML=c,t.innerHTML="",this._on(n(textElement),"mouseenter",this._mouseEnterEvent)._on(n(textElement),"mouseleave",this._mouseLeaveEvent)),f=document.createElement("div"),f.setAttribute("role","presentation"),i&&(e=document.createElement("div"),e.setAttribute("role","presentation"),f.appendChild(e)),o&&f.appendChild(o),f.appendChild(textElement),n(t).prop("name")==r&&n(t).prop("name",l),t.appendChild(f))},_setAttributes:function(t,i){for(var r in t)n(i).attr(r,t[r])},_addDragableClass:function(){this.model.allowDragAndDrop&&(this._anchors=this._liList.map(function(){return n("a.e-text",this)[0]}),this._anchors.addClass("e-draggable e-droppable"),this._enableDragDrop(),this._on(this.element,"mouseup touchstart pointerdown MSPointerDown",this._anchors,this._focusElement))},_addBaseClass:function(){this._ulList.addClass("e-treeview-ul").attr("role","group");this._liList.addClass("e-item").attr("role","treeitem");this.element.is("ul")||this.element.find("ul:first").removeClass("e-treeview-ul").addClass("e-ul")},_controlRender:function(){var s=this.element,h,e,i,f,c,l,a,o,y,v,u,p;if(s!=null){for(h=s.find(".e-item"),e=0;e<h.length;e++)i=n(h[e]),a=i.children("ul")[0],a&&n(i.children("ul")[0]).remove(),o=i.children("a")[0],o?(l=n(o).text(),f=n(o).clone(),n(o).remove(),c=i.clone(),n(f).prepend(c.children()),n(f).addClass("e-text CanSelect"),i.html("")):(l=this._getText(i),c=i.clone(),i.html(""),f=t.buildTag("a.e-text CanSelect","","",{alt:""}),f.append(c.children()),f[0].innerHTML+=l),y=t.buildTag("div","",{},{role:"presentation"}),v=t.buildTag("div","",{},{role:"presentation"}),n(v).append(y).append(f),i.prepend(v),a&&i.append(a),i.prop("name")==r&&i.prop("name",l),this.model.showCheckbox&&this._checkboxOnTemplate(h[e].children[0]);this.model.showCheckbox&&s.find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange})}u=s.find(".e-item");u.find(">ul").hide();p=u.find(".e-text");p.focus(function(){n(this).blur()});u.filter(".e-item:last-child").addClass("last");n(u[0]).addClass("first");n(u[0]).hasClass("first")&&n(u[0]).hasClass("last")&&n(u[0]).removeClass("first");n(u.filter(":has(ul)")).each(function(){n(this).attr("aria-expanded",!1).attr("aria-selected",!1);var t=n(this).children("ul:first");n(t).is(":hidden")?n(this).find("> div > div:first").removeClass("e-icon e-minus").addClass("e-icon e-plus"):n(this.childNodes[1]).removeClass("e-icon e-plus").addClass("e-icon e-minus")})},_getText:function(t){return n(t).clone().children().remove().end().text()},_expandNodes:function(i){for(var f,e=i.length,r=[],u=0;u<e;u++)(r=n(this._liList[i[u]]),!this.model.enableMultipleExpand&&(f=r.siblings().find(">div>.e-minus").closest(".e-item"),f.length>0))||this.isExpanded(r)||(!this.model.loadOnDemand||this.dataSource()instanceof t.DataManager?this._expandNode(r):this._createChildNodesWhenExpand(r))},_checkedNodes:function(t){var r,i,u;for(t.length>0&&this._removeField(this._newDataSource,this.model.fields.isChecked),i=0,u=t.length;i<u;i++)r=n(this._liList[t[i]]),r[0]!=null&&this._nodeCheck(r.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0])},_finalize:function(){var v,h,r,f;this._isRender=!1;var c=this.element,e=this._getCookies("_persistedValues"),u=[],l=0,i=[],a,o,s;if(this.model.showCheckbox&&c.find(".e-item > div .nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),!(this.model.expandedNodes instanceof Array&&this.model.expandedNodes.length>0))for(a=c.find("li.expanded"),f=a.length,r=0;r<f;r++)(v=n(a[r]),!this.model.enableMultipleExpand&&(h=v.siblings().find(">div>.e-minus").closest(".e-item"),h.length>0))||this._expandNode(v);if(e&&(o=JSON.parse(e),u=o.expandedNodes,i=[]),u&&u.length>0&&!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null){for(r=0,f=u.length;r<f;r++)if(i=this.element.find(".e-item#"+u[r]),i[0]!=null){if(!this.model.enableMultipleExpand&&(h=i.siblings().find(">div>.e-minus").closest(".e-item"),h.length>0))continue;!this.model.loadOnDemand||this.dataSource()instanceof t.DataManager?this._expandNode(i):this._createChildNodesWhenExpand(i)}}else s=JSON.parse(JSON.stringify(this.model.expandedNodes)),this._expandNodes(s);if(this.model.showCheckbox)if(e&&(o=JSON.parse(e),u=o.checkedNodes,i=[]),u&&u.length>0&&!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null)for(this._removeField(this._newDataSource,this.model.fields.isChecked),r=0,f=u.length;r<f;r++)i=this.element.find(".e-item#"+u[r]),i[0]==null||this.dataSource()instanceof t.DataManager||this._nodeCheck(i.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]);else s=JSON.parse(JSON.stringify(this.model.checkedNodes)),this._checkedNodes(s);this.model.checkedNodes instanceof Array&&this.model.checkedNodes.length>0||this.model.showCheckbox&&this._isCheckedAction();i=[];e&&(l=o.selectedNode);l&&!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null&&(i=this.element.find(".e-item#"+l));i[0]!=null?this._nodeSelectionAction(i):this.model.selectedNode>=0?this._nodeSelectionAction(n(this._liList[this.model.selectedNode])):this.model.selectedNode!=null&&this._isSelectedAction();this._isRender=!0;this.model.allowEditing&&this._allowEditable();c.find(".e-item.checked, .e-item.expanded, .e-item.selected").removeClass("checked expanded selected")},_updateSelectedNode:function(){var t=n(this._liList).find(".e-text.e-active").closest(".e-item"),i=[];this.model.selectedNode=t[0]!=null&&t.length>0?n(this._liList).index(t):null;this.model.selectedNode>=0&&(i=n(this._liList[this.model.selectedNode]),i[0]!=null&&(this._isRender=!1,this.selectNode(i),this._isRender=!0));this._persistValues([this.model.selectedNode],"selectedNode")},_setCookies:function(n,i){window.localStorage?window.localStorage.setItem(this._id+n,i):document.cookie&&t.cookie.set(this._id+n,i)},_getCookies:function(n){return window.localStorage?window.localStorage.getItem(this._id+n):window.cookie?t.cookie.get(this._id+n):void 0},_updateCheckedNodes:function(){for(var r=[],t=this.element.find(".e-item > div > .e-chkbox-wrap > .nodecheckbox.checked").closest(".e-item"),i=0;i<t.length;i++)r.push(n(this._liList).index(t[i]));(r.length>0||t.length==0)&&(this.model.checkedNodes=r);t.length==0&&this.model.checkedNodes.push(-1);this._persistValues(this.model.checkedNodes,"checkedNodes")},_updateExpandedNodes:function(){var t,r=[],i,u;for(t=this.element.find(".e-item > div > .e-minus").closest(".e-item").addClass("e-collapse"),i=0,u=t.length;i<u;i++)r.push(n(this._liList).index(t[i]));(r.length>0||t.length==0)&&(this.model.expandedNodes=r);t.length==0&&this.model.expandedNodes.push(-1);this._persistValues(this.model.expandedNodes,"expandedNodes")},_isCheckedAction:function(){for(var r,u,f,i=this.element.find(".e-item.checked"),t=0;t<i.length;t++)if(r=n(i[t]).find(".e-item"),u=n(i[t]).find(".e-item.unchecked"),r.length==0||!(r.length>0&&u.length==r.length)||!this.model.autoCheck)for(this._nodeCheck(n(i[t]).find("> div > .e-chkbox-wrap > input.nodecheckbox:first")[0]),f=0;f<u.length;f++)this._nodeUncheck(n(u[f]).find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]);this.element.find(".e-item.checked, .e-item.unchecked").removeClass("checked unchecked")},_isSelectedAction:function(){var n=this.element.find(".e-item.selected:last");n[0]!=null&&this._nodeSelectionAction(n);this.element.find(".e-item.selected").removeClass("selected")},_checkedChange:function(t){if(t.isInteraction){var i=this.element.closest(".e-treeview.e-js").data("ejTreeView");action=t.isChecked?"_nodeCheck":"_nodeUncheck";i[action](n(this.element)[0],t)}},_ClickEventHandler:function(i){var c=this,u,r=n(i.target),s=r.closest(".e-item").find("> div > div:first"),h,e,f,o;if(s&&!s.hasClass("e-process")&&(u=r.closest(".e-item"),!u.hasClass("e-node-disable"))){if(this._triggerEvent("nodeClick",{event:i,currentElement:r[0]}),!t.isNullOrUndefined(r)&&r.is("DIV")&&(r.hasClass("e-plus")||r.hasClass("e-minus")))if(h=null,r.is("SPAN")&&(r=r.parent("div").find("div:first")),h=u.children("ul:first"),o=this.isChildLoaded(u),!o&&this.model.loadOnDemand){if(r.removeClass("e-plus").addClass("e-load"),this._checkboxChecked=r.parent().find(".nodecheckbox").hasClass("checked"),f=this._getNodeDetails(u),e={currentElement:u,targetElement:r[0],id:f.id,value:f.text,parentId:f.parentId,isChildLoaded:o,hasParent:!0,async:!0},this._isEventTriggered=!0,this._triggerEvent("beforeExpand",e))return!1;this._loadOnDemand(e,r[0])}else r.hasClass("e-plus")?this._expandNode(u):this._collpaseNode(u);r.is("A")||r.hasClass("input-text")||(r=r.parent());!t.isNullOrUndefined(r)&&r.is("A")&&r.hasClass("CanSelect")&&!r.hasClass("e-active")&&this._nodeSelectionAction(r.closest(".e-item"))}},_getChildTables:function(n,i,r){if(!t.isNullOrUndefined(n.child))return i==r?n.child:this._getChildTables(n.child,i,r+1)},_loadOnDemand:function(i){var u,e,r,f=this,o;if(this.dataSource()instanceof t.DataManager){if(e=i.currentElement.parents("ul").length,r=this._getChildTables(f.model.fields,e,1),t.isNullOrUndefined(r)&&t.isNullOrUndefined(this.model.fields.child)&&(r=this.model.fields),r.query&&r.query.queries.length>0&&(r.query.queries=[]),!r)return;o=this._executeDataQuery(r,r.parentId,this._typeOfFieldId=="number"?parseInt(i.currentElement[0].id):i.currentElement[0].id);o.done(function(t){u=t.xhr&&t.xhr.responseJSON&&t.xhr.responseJSON.d?t.xhr.responseJSON.d:t.result?t.result:[];u=f._getSortAndFilterList(r,u);u.length>0?(f._onlineData=!0,f._loadChildNodeWhenOnDemand(u,i,r)):n(i.targetElement).hasClass("e-load")&&n(i.targetElement).removeClass(n(i.targetElement).hasClass("e-plus")||n(i.targetElement).hasClass("e-minus")?"e-load":"e-icon e-load")})}else u=this._getChildNodes(this._dataSource,i),!t.isNullOrUndefined(u)&&u.length>0?setTimeout(function(){f._createSubNodesWhenLoadOnDemand(u,i.targetElement,f.model.fields)},400):n(i.targetElement).hasClass("e-load")&&n(i.targetElement).removeClass(n(i.targetElement).hasClass("e-plus")||n(i.targetElement).hasClass("e-minus")?"e-load":"e-icon e-load")},_loadChildNodeWhenOnDemand:function(n,i,r){var u=this;!t.isNullOrUndefined(n)&&n.length>0&&setTimeout(function(){u._createSubNodesWhenLoadOnDemand(n,i.targetElement,r)},100)},_createSubNodesWhenLoadOnDemand:function(t,i,r){this._loadOnDemandNodes=!0;this._templateNodeCreation(t,r);n(this._fragment.firstChild).attr("style","display:none");this._fragment.firstChild.className="e-treeview-ul";this._fragment.firstChild.setAttribute("role","group");i.parentNode.parentNode.appendChild(this._fragment);var u=n(i).closest(".e-item");u.attr({"aria-expanded":!1,"aria-expanded":!0});n(i).removeClass("e-load").addClass("e-plus");this._expandNode(u);this._finalizeLoadOnDemand(u)},_finalizeLoadOnDemand:function(n){var r,u,i,f;this._beforeBaseClass();this._isRender=!1;this.model.showCheckbox&&(n.children("ul").find("li > div > input.nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),r=n.children("ul").find(".e-item"),u=n.children("ul").find(".e-item.unchecked"),u.length>=0&&u.length!=r.length&&this._checkboxChecked?r.not(".unchecked").addClass("checked"):u.length==r.length&&this.isNodeChecked(n)&&this._nodeUncheck(n.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]),this._isCheckedAction(),this._updateCheckedNodes());this._isRender=!0;this._addDragableClass();this._preventEditable();this.model.allowEditing&&this._allowEditable();this._isSelectedAction();this._updateSelectedNode();this._updateExpandedNodes();!this.model.loadOnDemand||!this.model.enablePersistence||this.dataSource()instanceof t.DataManager||(f=this._getCookies("_childNodes"),f&&(i=JSON.parse(f)),!t.isNullOrUndefined(i)&&i.indexOf(n[0].id)==-1?i.push(n[0].id):i=[n[0].id],this._setCookies("_childNodes",JSON.stringify(i)))},_getChildNodes:function(n,i){var u=[],r,f;if(this._templateType==1){for(r=0,f=n.length;r<f;r++)if(!t.isNullOrUndefined(n[r][0])&&!t.isNullOrUndefined(n[r][0][this.model.fields.parentId])&&n[r][0][this.model.fields.parentId]==i.id)return n[r]}else{for(r=0,f=n.length;r<f;r++){if(n[r][this.model.fields.id]==i.id)return n[r].child;if(n[r].hasOwnProperty("child")&&(u=this._getChildNodes(n[r].child,i),!t.isNullOrUndefined(u)&&u.length>0))break}return u}},_getPath:function(n){for(var i=n.prop("name"),t=n.parents(".e-item:first");t[0]!=null&&t[0].parentNode.id!=this._id;)i=t.prop("name")+"/"+i,t=t.parents(".e-item:first");return this._id+"/"+i},_nodeSelectionAction:function(t){if((t[0]!=null||t.length!=0)&&!(t.find("> div > .text.e-active").length>0)){var i,r;this._triggerEvent("beforeSelect",{target:t,nodeDetails:this._getNodeDetails(t)})||(this.element.find("a.e-text.e-active").removeClass("e-node-focus e-active").closest("li").find("[aria-selected=true]").attr("aria-selected",!1),this.element.find("a.e-text.e-node-focus").removeClass("e-node-focus"),t.attr("aria-selected",!0),n(t.find("> div > .e-text")[0]).addClass("e-active").attr("id",this._id+"_active"),this.model.selectedNode=this._liList.index(t[0]),i=this._getNodeDetails(t),r={currentElement:t,value:i.text,id:i.id,parentId:i.parentId},this.model.enablePersistence&&this._persistValues([this.model.selectedNode],"selectedNode"),this._triggerEvent("nodeSelect",r))}},_nodeUnSelectionAction:function(n){n.attr("aria-selected",!1).find("> div > .e-text").removeClass("e-active").attr("id","");this.model.selectedNode=null},_nodeEnableAction:function(n){var t=this.getParent(n);t[0]!=null&&t.hasClass("e-node-disable")||(this.model.showCheckbox&&n.find("div > .e-chkbox-wrap > .nodecheckbox").ejCheckBox("enable").prop("disabled",!1),n.find(".e-text").removeClass("e-node-disable").closest(".e-item").removeClass("e-node-disable").removeProp("disabled"))},_nodeDisableAction:function(t){this._collpaseNode(t);this.model.showCheckbox&&t.find("div > .e-chkbox-wrap > .nodecheckbox").ejCheckBox("disable").prop("disabled",!0);t.find(".e-text").addClass("e-node-disable").removeClass("e-active").attr("id","").closest(".e-item").addClass("e-node-disable").prop("disabled",!0);var i=this._liList[this.model.selectedNode];(n(this._liList).index(t)==this.model.selectedNode||t.find(i)[0]!=null)&&(this.model.selectedNode=null)},_getNodeDetails:function(n){if(n[0]!=null&&n.is("LI")&&n.hasClass("e-item")){var i,r,t,u,f,e,o,s,h;return i=n[0].getAttribute("id"),r=n.children("div").find(".e-text:first").text(),t=n.closest("ul").closest(".e-item").attr("id"),u=n.parents("ul").length,f=n.find(".e-item").length,e=this._isNodeExpanded(n),o=this._isChecked(n),s=n.find("> div > .e-text").hasClass("e-active"),h=this._liList.index(n),{id:i,text:r,parentId:t?t:"",level:u,count:f,expanded:e,checked:o,selected:s,index:h}}return{id:"",text:"",parentId:"",level:"",count:"",expanded:"",checked:"",selected:"",index:""}},_denyMultipleExpand:function(t){for(var r=t.siblings().find(">div>.e-minus").closest(".e-item"),i=0,u=r.length;i<u;i++)this._collpaseNode(n(r[i]))},_expandCollapseAction:function(t){if(t&&!t.hasClass("e-process")){var u,o=this,i,f,r,e;if(i=t.closest(".e-item"),t.is("SPAN")&&(t=n(t).parent("div").find("div:first")),u=i.children("ul:first"),u.find("> .e-item").length>0)if(this.model.enableAnimation&&t.addClass("e-process"),f=this._getNodeDetails(i),e=this.isChildLoaded(i),r={currentElement:i,value:f.text,isChildLoaded:e,id:f.id,parentId:f.parentId,async:!1},!this._isNodeExpanded(i)&&e){if(!this._isEventTriggered&&this._triggerEvent("beforeExpand",r))return!1;this._isEventTriggered=!1;i.attr("aria-expanded",!0);this._addExpandedNodes(this._liList.index(i));n(t).removeClass("e-icon e-plus").addClass("e-icon e-minus");i.addClass("e-collapse");u.animate({height:"toggle"},this.model.enableAnimation?350:0,"linear",function(){t.removeClass("e-process");o._triggerEvent("nodeExpand",r)})}else{if(i.attr("aria-expanded",!1),this._triggerEvent("beforeCollapse",r)===!0)return!1;this._removeExpandedNodes(this._liList.index(r.currentElement));n(t).removeClass("e-icon e-minus").addClass("e-icon e-plus");i.removeClass("e-collapse");u.animate({height:"toggle"},this.model.enableAnimation?200:0,"linear",function(){t.removeClass("e-process");o._triggerEvent("nodeCollapse",r)})}}},_isChecked:function(n){return n.find("> div > .e-chkbox-wrap:first").attr("aria-checked")==="true"?!0:!1},_doRecursiveCheck:function(t,i){var o,r,f,t,u,s,e;u=t.children[1];o=u?u.querySelectorAll('.e-chkbox-wrap[aria-checked="true"]').length:0;s=u?u.querySelectorAll(".e-item > div > .e-chkbox-wrap > .nodecheckbox"):[];r=t.firstChild.querySelector(".nodecheckbox");r&&r.nodeName.toUpperCase()=="INPUT"&&(e=n(r).data("ejCheckBox"),o==s.length||this.model.autoCheckParentNode?(e.setModel({enableTriState:!1,checked:!0}),r.className+=" checked",f=t.firstChild.getElementsByTagName("a")[0].innerHTML,i.push({id:t.id,text:f}),this._addHiddenInputElement(r,f),this._addCheckNodes(this._liList.index(t))):e.setModel({enableTriState:!0,checkState:"indeterminate"}),t=t.parentNode.parentNode,t.nodeName.toUpperCase()=="LI"&&this._doRecursiveCheck(t,i))},_nodeCheck:function(t,i){var s,r,u,h,e,o,c,f,l;if(n(t)[0]!=null){if(this._CurrenctSelectedNodes=[],this._checkedArray=[],t.className+=" checked",s=n(t).data("ejCheckBox"),s){if(s.setModel({enableTriState:!1,checked:!0}),r=t.parentNode.parentNode.parentNode,u=r.firstChild.getElementsByTagName("a")[0].lastChild.nodeValue,this._checkedArray.push({id:r.id,text:u}),this._updateField(this._newDataSource,r.id,this.model.fields.isChecked,!0),this._addHiddenInputElement(t,u),this._addCheckNodes(this._liList.index(r)),this.model.autoCheck){for(c=r.children[1],e=c?c.querySelectorAll(".e-item > div > .e-chkbox-wrap > .nodecheckbox"):[],f=0,l=e.length;f<l;f++)n(e[f]).ejCheckBox({checked:!0,enableTriState:!1})[0].className+=" checked",o=e[f].parentNode.parentNode.parentNode,u=o.firstChild.getElementsByTagName("a")[0].lastChild.nodeValue,this._checkedArray.push({id:o.id,text:u}),this._addHiddenInputElement(e[f],u),this._addCheckNodes(this._liList.index(o));h=r.parentNode.parentNode;h.nodeName.toUpperCase()=="LI"&&this._doRecursiveCheck(h,this._checkedArray)}i&&(i.checknode=this._checkedArray);this._onChecked(n(t),i)}this._persistValues(this.model.checkedNodes,"checkedNodes")}},_addHiddenInputElement:function(n,t){if(n.firstChild==null){var i=document.createElement("input");i.setAttribute("type","hidden");i.setAttribute("name",this._id+"_Checkbox_"+n.value+".Text");i.setAttribute("value",t);try{n.appendChild(i)}catch(r){}}},_doRecursiveUncheck:function(t,i){var e,r,o,t,u,s,f;u=t.children[1];e=u?u.querySelectorAll('.e-chkbox-wrap[aria-checked="true"]').length:0;s=u?u.querySelectorAll(".e-item > div > .e-chkbox-wrap > .nodecheckbox"):[];r=t.firstChild.querySelector(".nodecheckbox");r&&r.nodeName.toUpperCase()=="INPUT"&&(f=n(r).data("ejCheckBox"),e<=0&&(f.setModel({enableTriState:!1,checked:!1}),n(r).removeClass("checked").removeClass("checked").children().remove(),o=t.firstChild.getElementsByTagName("a")[0].innerHTML,this._removeCheckNodes(this._liList.index(t)),i.push({id:t.id,text:o})),e>1&&this.model.autoCheckParentNode?(f.setModel({checked:!0}),r.className+=" checked",o=t.firstChild.getElementsByTagName("a")[0].innerHTML,this._addHiddenInputElement(t,o)):e>0&&!this.model.autoCheckParentNode&&(s.length>1?f.setModel({enableTriState:!0,checkState:"indeterminate"}):f.setModel({checked:!1}),n(r).removeClass("checked").removeClass("checked").children().remove(),this._removeCheckNodes(this._liList.index(t))),t=t.parentNode.parentNode,t.nodeName.toUpperCase()=="LI"&&this._doRecursiveUncheck(t,i))},_nodeUncheck:function(t,i){var e,u,r,f;if(n(t)[0]!=null){if(e=this,this._uncheckedArray=[],currentLi=t.parentNode.parentNode.parentNode,n(currentLi).find("div > .e-chkbox-wrap > .nodecheckbox").removeClass("checked").children().remove(),chkObj=n(t).data("ejCheckBox"),this._removeCheckNodes(this._liList.index(currentLi)),chkObj){if(chkObj.setModel({enableTriState:!1,checked:!1}),textvalue=currentLi.firstChild.getElementsByTagName("a")[0].lastChild.nodeValue,this._uncheckedArray.push({id:currentLi.id,text:textvalue}),this._updateField(this._newDataSource,currentLi.id,this.model.fields.isChecked,!1),this.model.autoCheck){for(childUl=currentLi.children[1],u=childUl?childUl.querySelectorAll(".e-item > div > .e-chkbox-wrap > .nodecheckbox"):[],r=0,f=u.length;r<f;r++)n(u[r]).ejCheckBox({enableTriState:!1,checked:!1}),liElement=u[r].parentNode.parentNode.parentNode,textvalue=liElement.firstChild.getElementsByTagName("a")[0].lastChild.nodeValue,this._uncheckedArray.push({id:liElement.id,text:textvalue}),this._removeCheckNodes(this._liList.index(liElement));parentLi=currentLi.parentNode.parentNode;parentLi.nodeName.toUpperCase()=="LI"&&this._doRecursiveUncheck(parentLi,this._uncheckedArray)}i&&(i.unchecknode=this._uncheckedArray);this._onUnChecked(n(t),i)}this._persistValues(this.model.checkedNodes,"checkedNodes")}},_executeDataQuery:function(i,r,u){var f,o,e;if(f=t.Query(),f=this._columnToSelect(i),!t.isNullOrUndefined(r)&&r!=""){for(o=n.extend(!0,[],f._params),f._params=[],f.addParams(r,u),e=0;e<o.length;e++)o[e].key!=r&&f.addParams(o[e].key,o[e].value);f.where(r,t.FilterOperators.equal,u)}return i.dataSource.executeQuery(f)},_createChildNodesWhenExpand:function(n){var e,o,f,s,h,i,r,c,u;if(n.length>0&&n.find("ul .e-item").length==0){if(e=n.attr("id"),o=n.children("div").find(".e-text:first").text(),s=n.children("div").find("div.e-plus:first"),f={currentElement:n,targetElement:s[0],id:e,value:o,isChildLoaded:!1,hasParent:!0,async:!1},r=this,this._isEventTriggered=!0,this._triggerEvent("beforeExpand",f))return!1;if(this.dataSource()instanceof t.DataManager){if(h=f.currentElement.parents("ul").length,i=this._getChildTables(this.model.fields,h,1),t.isNullOrUndefined(i)&&t.isNullOrUndefined(this.model.fields.child)&&(i=this.model.fields),i.query&&i.query.queries.length>0&&(i.query.queries=[]),!i)return;this._treeList.push("false");c=this._executeDataQuery(i,i.parentId,this._typeOfFieldId=="number"?parseInt(f.currentElement[0].id):f.currentElement[0].id);c.done(function(f){r._treeList.pop();u=f.xhr&&f.xhr.responseJSON&&f.xhr.responseJSON.d?f.xhr.responseJSON.d:f.result?f.result:[];u=r._getSortAndFilterList(i,u);!t.isNullOrUndefined(u)&&u.length>0&&(r._checkboxChecked=n.find("> div > .e-chkbox-wrap > .nodecheckbox").hasClass("checked"),r._loadOnDemandNodes=!0,n.find("ul .e-item").length==0&&(r._templateNodeCreation(u,i),n.append(r._fragment)),r._finalizeLoadOnDemand(n),r._expandNode(n),r._treeList.length==0&&r._completeRendering())})}else u=this._getChildNodes(this._dataSource,{id:n[0].id}),!t.isNullOrUndefined(u)&&u.length>0&&(this._checkboxChecked=n.find("> div > .e-chkbox-wrap > .nodecheckbox").hasClass("checked"),this._loadOnDemandNodes=!0,this._templateNodeCreation(u,this.model.fields),n.append(this._fragment),this._finalizeLoadOnDemand(n),this._expandNode(n))}else this._expandNode(n)},_getSortAndFilterList:function(n,i){var r,u;return!i||!i.length||i.length<1?r=[]:(u=t.Query(),this._addSortingQuery(u,n),r=t.DataManager(i).executeLocal(u)),r},_addSortingQuery:function(n,i){if(this.model.sortSettings.allowSorting){var r=i&&i.text?i.text:"text",u=this.model.sortSettings.sortOrder==t.sortOrder.Descending?!0:!1;n.sortBy(r,u)}},_expandNode:function(n){var t,i;return n[0]!=null&&n.length>0&&(t=n.find("> div > div:first"),this.model.loadOnDemand&&!this.model.enablePersistence?n.find("> ul > .e-item").length>0&&t.hasClass("e-plus")?(this.model.enableMultipleExpand||this._denyMultipleExpand(n),this._expandCollapseAction(n.find("> div > div.e-plus:first"))):t.hasClass("e-icon")&&!t.hasClass("e-minus")&&this._allowOnDemand&&this._createChildNodesWhenExpand(n):t.hasClass("e-plus")&&(i=n.find("> ul > .e-item").length>0?!0:!1,i&&(this.model.enableMultipleExpand||this._denyMultipleExpand(n),this._expandCollapseAction(t)))),!0},_collpaseNode:function(n){if(n[0]!=null&&n.length>0&&n.find("> ul > .e-item").length>0){var t=n.find("> div > div:first");t.hasClass("e-minus")&&this._expandCollapseAction(t)}},_expandAll:function(){var i=this.element,t,r;if(this.model.loadOnDemand)for(r=n(i).find(".e-item"),t=0,len=r.length;t<len;t++)this._createChildNodesWhenExpand(n(r[t]));else if(cnodes=i.find(".e-item > div > .e-plus").closest(".e-item"),i.find("ul:hidden").length==cnodes.length)for(t=0,len=cnodes.length;t<len;t++)this._expandNode(n(cnodes[t]))},_collapseAll:function(){var r=this.element,t,i;if(i=r.find(".e-item > ul:not(:hidden)").closest(".e-item"),enodes=i.find("> div > .e-minus").closest(".e-item"),enodes.length>0)for(t=0,len=enodes.length;t<len;t++)this._collpaseNode(n(enodes[t]))},_checkAll:function(){this._CurrenctSelectedNodes=[];var r=this.element,t;for(t=r.find(".e-item > div > .e-chkbox-wrap > .nodecheckbox"),t.addClass("checked"),i=0,len=t.length;i<len;i++)n(t[i]).ejCheckBox("setModel",{checked:!0}),this._addHiddenInputElement(t[i],n(t[i]).parent().siblings(".e-text")[0].lastChild.nodeValue);this.model.checkedNodes=this.getCheckedNodesIndex()},_uncheckAll:function(){var r=this.element,t;for(t=r.find(".e-item > div > .e-chkbox-wrap > .nodecheckbox"),t.removeClass("checked").children().remove(),i=0,len=t.length;i<len;i++)n(t[i]).ejCheckBox("setModel",{checked:!1});this.model.checkedNodes=[];this.model.checkedNodes.push(-1)},_isNodeExpanded:function(n){if(n[0]!=null)return n.children("ul:first").length>0&&n.find("> div > div.e-minus").length>0},_showCheckBox:function(){for(var t=this.element,i=t.find("li"),n=0;n<i.length;n++)this._checkboxOnTemplate(i[n].children[0]);t.find(".e-item > div > .nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});t.find(".e-item.e-node-disable > div > .e-chkbox-wrap > .nodecheckbox").ejCheckBox("disable")},_drag:function(){var i,u=!1,o=t.browserInfo(),r=null,s=null,f=null,e;e=o.name=="msie"&&o.version=="8.0"?!0:!1;this.element.is("ul")?(this._treeView=this.element.parent(),this.model.allowDragAndDropAcrossControl||(f=this.element.parent())):(this._treeView=this.element,this.model.allowDragAndDropAcrossControl||(f=this.element));n(this._treeView).find("ul li div a").not(".e-js").ejDraggable({dragArea:f,clone:!0,dragStart:function(u){if(!i||t.isNullOrUndefined(u.target)||n(u.target).hasClass("e-node-disable")||i.element.find(".e-item > div > .e-text.e-editable").length!=0||(u.element.attr("aria-grabbed",!0),n(u.target).is("A")&&!n(u.target).hasClass("e-draggable")))return!1;e&&(document.ondragstart=function(){return!1});var f={target:n(u.target).closest(".e-item"),targetElementData:i._getNodeDetails(n(u.target).closest(".e-item")),dragTarget:u.target,parentElement:n(u.target).closest("ul").closest(".e-item"),parentElementData:i._getNodeDetails(n(u.target).closest("ul").closest(".e-item")),event:u.event};if(i._triggerEvent("nodeDragStart",f))return u.cancel=!0,r&&r.remove(),!1},drag:function(f){var e,o,h,s,c;return u=!1,n(".e-sibling").remove(),e=f.target,o=i._findTarget(n(e)),n(r).css({"margin-left":"20px","margin-top":f.event.clientY-20<0?"0px":"-20px",display:"table"}),n(r).find("> a.e-text").css({display:"table-cell","white-space":"nowrap",margin:"0 0 1px"}),n(r).find(">.e-dropedStatus").css({display:"table-cell"}),h={draggedElement:n(f.element).closest(".e-item"),draggedElementData:i._getNodeDetails(n(f.element).closest(".e-item")),dragTarget:e,target:o,targetElementData:i._getNodeDetails(o),event:f.event},n(f.element).parent().parent().has(n(e)).length==0&&(n(e).hasClass("e-droppable")||n(e).parent().hasClass("e-droppable"))&&n(e).hasClass("e-dropchild")&&!n(e).hasClass("e-node-disable")&&(i.model.allowDragAndDropAcrossControl||!i.model.allowDragAndDropAcrossControl&&n(e).parents(".e-treeview").is(i.element))?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"),n(e).addClass("allowDrop")):n(e).hasClass("e-droppable")&&!n(e).hasClass("e-item")&&!n(e).hasClass("e-text")||n(e).is("UL")&&n(e).hasClass("e-ul")&&n(e).find(".e-item").length==0&&n(e).parent(".e-treeview-wrap").length>0?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus")):(n(e).hasClass("e-sibling")||n(e).find("a").hasClass("e-text"))&&(n(e).hasClass("e-sibling")||n(e).parent().parent().hasClass("e-item")||n(e).parent().hasClass("e-item")||n(e).hasClass("e-item")||n(e).hasClass("e-text"))&&(e.nodeName.toUpperCase()!="LI"&&(e.parentElement===null||e.parentElement.nodeName.toUpperCase()!="LI")||this.model.allowDropSibling)&&(i.model.allowDragAndDropAcrossControl||n(e).parents(".e-treeview").is(i.element))||(document.body.style.cursor="not-allowed",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-minus"),n(e).removeClass("showline-hover"),n(e).removeClass("noline-hover")),e.nodeName!="A"&&n(f.element).parent().parent().has(n(e)).length==0&&n(f.element).parent().parent()[0]!=n(e)[0]?(e.nodeName=="UL"&&n(e).children()[0]!=null&&(e=n(e).children()[0],u=!0),e.nodeName!="LI"&&(e=n(e).closest(".e-droppable")[0]||n(e).parent()),e.nodeName=="LI"&&n(e).hasClass("e-droppable")&&n(e).hasClass("e-dropsibling")&&(i.model.allowDragAndDropAcrossControl||!i.model.allowDragAndDropAcrossControl&&n(e).parents(".e-treeview").is(i.element))?(s=t.buildTag("div.e-sibling"),c=n(e).offset().top+n(e).find("a").height()||-1,u=f.event.pageY>c?!1:!0,u?s.insertBefore(n(e).find("> div > a").parent()):s.insertAfter(n(e).find("> div > a").parent()),n(e).parents().hasClass("e-rtl")?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-insertInbetween-rtl")):(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-insertInbetween"))):e.nodeName=="A"&&n(e)&&n(e).hasClass("e-droppable")&&n(e).hasClass("e-dropchild")?(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"),n(e).addClass("allowDrop")):!n(e).hasClass("e-droppable")||n(e).hasClass("e-item")||n(e).hasClass("e-text")||(document.body.style.cursor="",n(r).find("span.e-dropedStatus").removeClass().addClass("e-dropedStatus e-icon e-plus"))):n(".e-sibling").remove(),i._triggerEvent("nodeDrag",h)?!1:void 0},dragStop:function(t){e&&(document.ondragstart=function(){return!0});t.element.dropped||(r&&r.remove(),document.body.style.cursor="");var f=t.target,o,s;if((f.className=="e-sibling"&&(f=n(f).closest(".e-item")[0]),n(".e-sibling").remove(),n(f).hasClass("e-node-disable"))||(o=u?"Before":"After",trgtEle=i._findTarget(n(f)),o=f.nodeName=="A"?"Over":o,s={draggedElementData:i._getNodeDetails(n(t.element).closest(".e-item")),draggedElement:n(t.element).closest(".e-item"),dropTarget:n(f),target:trgtEle,targetElementData:i._getNodeDetails(trgtEle),position:o,event:t.event},i._triggerEvent("nodeDragStop",s))||(f.nodeName=="A"&&n(f).hasClass("e-dropchild")&&n(f).hasClass("e-droppable")||f.nodeName=="UL"&&n(f).children().length==0?(o="Over",n(f).is("UL")&&n(f).hasClass("e-ul")&&n(f).find(".e-item").length==0&&n(f).parent(".e-treeview-wrap").length>0?i._dropAsChildNode(n(f),n(t.element),t.event):n(t.element).parent().parent().has(n(f)).length==0&&(n(f).parent().parent().has(n(t.element)).length==0||i._isDescendant(n(f).parents("li:last").find(">ul>li"),n(t.element).parents("li:first")[0]))&&(i.model.allowDragAndDropAcrossControl||!i.model.allowDragAndDropAcrossControl&&n(f).parents(".e-treeview").is(i.element))&&i._dropAsChildNode(n(f).closest(".e-item"),n(t.element),t.event)):(f.nodeName=="UL"&&(f=n(f).children()[0]),f.nodeName!="LI"&&(f=n(f).closest(".e-droppable")[0]||n(f).parent()),f.nodeName=="LI"&&n(f).hasClass("e-dropsibling")&&n(f).hasClass("e-droppable")?n(t.element).parent().parent().has(n(f)).length<1&&n(t.element).parent().parent()[0]!=n(f)[0]&&(i.model.allowDragAndDropAcrossControl||!i.model.allowDragAndDropAcrossControl&&n(f).parents(".e-treeview").is(i.element))&&i._dropAsSublingNode(n(f),n(t.element),u,t.event):f.nodeName=="A"&&n(f).hasClass("e-dropchild")&&n(f).hasClass("e-droppable")&&(o="Over",n(t.element).parent().parent().has(n(f)).length==0&&(n(f).parent().parent().has(n(t.element)).length==0||i._isDescendant(n(f).parents("li:last").find(">ul>li"),n(t.element).parents("li:first")[0]))&&i._dropAsChildNode(n(f).closest(".e-item"),n(t.element),t.event))),n(".allowDrop").removeClass("allowDrop"),t.element.attr("aria-grabbed",!1),n(f).hasClass("e-dropchild")||r&&r.remove(),trgtEle=i._findTarget(n(f)),s={droppedElementData:i._getNodeDetails(n(t.element).closest(".e-item")),droppedElement:n(t.element).closest(".e-item"),dropTarget:n(f),target:trgtEle,targetElementData:i._getNodeDetails(trgtEle),position:o,event:t.event},i._triggerEvent("nodeDropped",s)))return!1;document.body.style.cursor=""},helper:function(u){if(!t.isNullOrUndefined(u.element)&&!n(u.element).hasClass("e-node-disable")&&n(u.element).hasClass("e-draggable")&&(i=n(u.element).closest(".e-treeview.e-js").data("ejTreeView"),i))return r=t.buildTag("div.e-dragedNode"),r.addClass(i.model.cssClass+(i.model.enableRTL?" e-rtl":"")),s=n(u.element).clone().addClass("dragClone"),this.spanEle=t.buildTag("span.e-icon e-plus e-dropedStatus"),r.append(this.spanEle),r.append(s),r.appendTo(n("body"))}})},_findTarget:function(n){return n.hasClass("e-text")?n.closest(".e-item"):n.closest("ul").closest(".e-item").length>0?n.closest("ul").closest(".e-item"):this.element.find(n).length>0?n.parents("ul").first():n},_isDescendant:function(t,i){var r=!0;return n(t).each(function(n,t){if(t==i)return r=!1,!1;r=!0}),r},_childDrop:function(){n(this._treeView).find("ul .e-item div .e-text").ejDroppable({accept:n(this._treeView).find("ul .e-item div .e-text").addClass("e-dropchild"),drop:function(t,i){n(i.helper).hide()}})},_siblingDrop:function(){n(this._treeView).find("ul .e-item").addClass("e-dropsibling").ejDroppable({drop:function(t,i){n(i.helper).hide()}})},_dropAsSublingNode:function(i,r,u){var f=r.parent().parent(),f=n(f),e;e=n(r.parents(".e-item")[1]);this.dataSource()instanceof t.DataManager&&this.model.loadOnDemand&&r.parents(".e-item:first").attr("aria-expanded")=="false"&&r.parents(".e-item:first").find("div.e-icon")&&r.parents(".e-item:first").find("div.e-icon").removeClass();t.isNullOrUndefined(this.model.fields)||this.dataSource()==null||this.dataSource()instanceof t.DataManager||this._updateDataSource(r.parents(".e-item:first"),n(i),u,this);u?f.insertBefore(i):f.insertAfter(i);this.model.template||this._autoGenerateNodes(r.parents(".e-item:first"));this._modifyCss(e);this._finalizeEditing(f);this._isRender=!1;this._updateCheckState(f);this._updateCheckState(e);this._isRender=!0;f.find("> div > .e-minus").length>0&&!this.model.enableMultipleExpand&&this._denyMultipleExpand(f);this._updateChanges(n(i))},_dropAsChildNode:function(i,r){var u=r.parent().parent(),u=n(u),f;f=n(r.parents(".e-item")[1]);n(i).is("UL")?n(i).append(u):this._appendNode(i,u);this.dataSource()instanceof t.DataManager&&this.model.loadOnDemand&&r.parents(".e-item:first").attr("aria-expanded")=="false"&&r.parents(".e-item:first").find("div.e-icon")&&r.parents(".e-item:first").find("div.e-icon").removeClass();t.isNullOrUndefined(this.model.fields)||this.dataSource()==null||this.dataSource()instanceof t.DataManager||this._updateDataSource(r.parents(".e-item:first"),n(i).find("> div > .e-text").first(),"",this);this.model.template||this._autoGenerateNodes(r.parents(".e-item:first"));this._modifyCss(f);this._finalizeEditing(u);this._isRender=!1;this._updateCheckState(u);this._updateCheckState(f);this._isRender=!0;i.find("> div > .e-icon.e-plus:first").length>0&&this._expandNode(i);this._updateChanges(n(i))},_updateChanges:function(t){if(n(t)[0]!=null){var i=this,r=0;do i._updateNodes(),r++,i=t.closest(".e-treeview.e-js").data("ejTreeView");while(i&&this._id!=i._id&&r==1)}},_updatePersistProb:function(){var i,r,t,u;for(this._removeField(this._newDataSource,this.model.fields.selected),this._removeField(this._newDataSource,this.model.fields.expanded),i=this.getSelectedNode().attr("id"),i&&this._updateField(this._newDataSource,i,this.model.fields.selected,!0),r=this.getExpandedNodes(),t=0,u=r.length;t<u;t++)this._updateField(this._newDataSource,n(r[t]).attr("id"),this.model.fields.expanded,!0)},_orderDataSource:function(){var f,r,u,e,i,o;for(this._beforeBaseClass(),f=[],r=this._newDataSource,this._updatePersistProb(),u=0,e=this._liList.length;u<e;u++)for(i=0,o=r.length;i<o;i++)if(!t.isNullOrUndefined(r[i])&&!t.isNullOrUndefined(r[i][this.model.fields.id])&&r[i][this.model.fields.id].toString()==n(this._liList[u]).attr("id")){n(this._liList[u]).find("> ul .e-item").length==0?delete r[i][this.model.fields.hasChild]:this._templateType==1&&(r[i][this.model.fields.hasChild]=!0);f.push(r[i]);break}return f},_updateDataSource:function(i,r,u,f){var o,e,c,s,l,h,a;n(i)[0]!=null&&n(r)[0]!=null&&(o=f,e=r.closest(".e-treeview.e-js").data("ejTreeView"),!o||!e||t.isNullOrUndefined(e.model.fields)||e.dataSource()==null||e.dataSource()instanceof t.DataManager||(r.is("A")?(c=r.closest(".e-item").attr("id"),l=r.closest(".e-item").find("> ul > .e-item"),s=l.length>0?l.length:r.closest(".e-item").index()):(c=r.parents(".e-item:first").attr("id"),h=r.next(".e-item"),a=r.prev(".e-item"),s=h.length>0?s=a.length>0?h.index()-1:u?r.index():h.index():u?r.index():r.index()+1),e&&o._findAndUpdate(i.attr("id"),c,o._newDataSource,s,e)))},_removeObject:function(n,i,r){for(var u=0,f=n.length;u<f;u++)if(!t.isNullOrUndefined(n[u])&&!t.isNullOrUndefined(n[u][r])&&n[u][r].toString()==i){n.splice(u,1);break}},_convertDataSourceTypes:function(n,t){for(var i=0;i<n.child.length;i++)n.child[i][this.model.fields.parentId]=n[this.model.fields.id],t.push(n.child[i]),n.child[i].hasOwnProperty("child")&&n.child[i].child.length>0&&this._convertDataSourceTypes(n.child[i],t);return n.child&&(delete n.child,n[this.model.fields.hasChild]=!0),t},_childObjectCollection:function(n,t,i){for(var u,r=0,f=n.length;r<f;r++)u=this._getChildNodes(t,{id:n[r][this.model.fields.id]}),u&&(i=i.concat(u),i=this._childObjectCollection(u,t,i));return i},_updateCopyData:function(t,i,u){var f=i.model.fields,e;return temp=u,arr=[],proxy=this,n.each(this.model.fields,function(n){(n!=="dataSource"||n!=="query")&&temp[t][proxy.model.fields[n]]!==r&&(arr[f[n]]=temp[t][proxy.model.fields[n]])}),n.extend(e,arr,!1)},_findAndUpdate:function(n,i,r,u,f){var a,o,c,p,h,y,w,b,s,l,e,v;if(this._templateType==1){for(s=0,l=r.length;s<l;s++)if(!t.isNullOrUndefined(r[s])&&!t.isNullOrUndefined(r[s][this.model.fields.id])&&r[s][this.model.fields.id].toString()==n){if(this._id==f._id)t.isNullOrUndefined(i)?delete r[s][this.model.fields.parentId]:r[s][this.model.fields.parentId]=i,a=this.dataSource(),c=this,this._templateType=this._getTemplateType(a,this.model.fields),this._dataSource=this._templateType==1?this._groupingObjects(a,function(n){return[!t.isNullOrUndefined(n)&&[n[c.model.fields.parentId]].toString()]}):a;else if(c=this,v=[],p=this._groupingObjects(r,function(n){return[!t.isNullOrUndefined(n)&&[n[c.model.fields.parentId]].toString()]}),e=r.splice(s,1),o=this._getChildNodes(p,{id:n}),o&&o.length>0&&(o=this._childObjectCollection(o,p,o)),f._templateType==2){if(o&&o.length>0){for(h=0,y=o.length;h<y;h++)this._removeObject(r,n,this.model.fields.parentId),delete o[h][f.model.fields.parentId],delete o[h][f.model.fields.hasChild];e[0].hasOwnProperty("child")||(e[0].child=[]);e[0].child=o}delete e[0][f.model.fields.parentId];delete e[0][f.model.fields.hasChild];i?this._changeObjectPos(i,e,f._newDataSource,u):f._newDataSource.splice(u,0,e[0])}else{if(o&&o.length>0){for(h=0,y=o.length;h<y;h++)this._removeObject(r,o[h].id,this.model.fields.parentId),this._removeObject(r,n,this.model.fields.parentId);this._dataSource=this._templateType==1?this._groupingObjects(r,function(n){return[!t.isNullOrUndefined(n)&&[n[c.model.fields.parentId]].toString()]}):r}if(i?e[0][f.model.fields.parentId]=i:delete e[0][f.model.fields.parentId],f._newDataSource.push(e[0]),w=[],o&&o.length>0){if(!(this.dataSource()instanceof t.DataManager)&&this.model.loadOnDemand){for(f._newDataSource.splice(f._newDataSource.length-1,1),o.push(e[0]),s=0;s<o.length;s++)w.push(this._updateCopyData(s,f,o));o=w}b=f._newDataSource=f._newDataSource.concat(o);f._dataSource=f._templateType==1?f._groupingObjects(b,function(n){return[!t.isNullOrUndefined(n)&&[n[f.model.fields.parentId]].toString()]}):b}}break}}else for(s=0,l=r.length;s<l;s++){if(r[s][this.model.fields.id].toString()==n)return e=r.splice(s,1),this._id==f._id?i?this._changeObjectPos(i,e,this._newDataSource,u):this._newDataSource.splice(u,0,e[0]):f._templateType==1?(v=[],e[0].hasOwnProperty("child")?(f._convertDataSourceTypes(e[0],v),e[0]=e.concat(v)):e[0]=e.concat(),i?e[0][0][f.model.fields.parentId]=i:delete e[0][0][f.model.fields.parentId],f._newDataSource=f._newDataSource.concat(e[0])):i?this._changeObjectPos(i,e,f._newDataSource,u):f._newDataSource.splice(u,0,e[0]),!0;if(r[s].hasOwnProperty("child")&&this._findAndUpdate(n,i,r[s].child,u,f))break}},_changeObjectPos:function(n,t,i,r){for(var u=0,f=i.length;u<f;u++){if(i[u][this.model.fields.id].toString()==n)return i[u].hasOwnProperty("child")?i[u].child.splice(r,0,t[0]):(i[u].child=[],i[u].child.push(t[0])),!0;if(i[u].hasOwnProperty("child")&&this._changeObjectPos(n,t,i[u].child,r))break}},_finalizeEditing:function(t){if(n(t)[0]!=null){var i=t.closest(".e-treeview.e-js").data("ejTreeView");i&&(i._preventEditable(),i.model.allowEditing&&i._allowEditable())}},_updateCheckState:function(n){var t,i,r;this._isTreeElement(n)&&(t=n.closest(".e-treeview.e-js").data("ejTreeView"),t&&t.model.showCheckbox&&(i=n.children("ul").find(".e-item > div > .e-chkbox-wrap > .checked").closest(".e-item").addClass("checked"),i.length>0?t._isCheckedAction():(r=t.isNodeChecked(n)?"_nodeCheck":"_nodeUncheck",t[r](n.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]))))},_autoGenerateNodes:function(t){var i,u,r,f;if(n(t)[0]!=null)if(i=t.closest(".e-treeview.e-js").data("ejTreeView"),i&&i.model.showCheckbox){if(t.find(".e-chkbox-wrap").length==0){for(this._checkboxOnTemplate(t[0].children[0]),u=t.find(".e-item"),r=0,f=u.length;r<f;r++)this._checkboxOnTemplate(u[r].children[0]);t.find(".nodecheckbox").ejCheckBox({cssClass:i.model.cssClass,change:i._checkedChange})}}else t.find(".e-chkbox-wrap").remove()},_appendNode:function(i,r){var u,f,s,e,h,o;for(this._isTreeElement(i)?(i.find("ul")[0]==null?(u=i.closest(".e-treeview.e-js").data("ejTreeView"),u&&(h=this._isNodeExpanded(i),h||!u.model.loadOnDemand||this.dataSource()instanceof t.DataManager||!i.find("> div > div").first().hasClass("e-plus")||u._createChildNodesWhenExpand(i)),f=t.buildTag("ul.e-treeview-ul","",{},{role:"group",style:"display:none"}),n(f).append(n(r)),n(i.find("div")[1]).length==0?(s=document.createElement("div"),s.setAttribute("role","presentation"),s.className="e-icon e-minus",n(i.find("div")).append(n(s))):n(i.find("div")[1]).hasClass("e-minus")||n(i.find("div")[1]).addClass("e-icon e-plus"),u&&u.model.loadOnDemand&&!(this.dataSource()instanceof t.DataManager)&&i.find("ul").length>0?i.children("ul").append(n(r)):i.append(n(f))):n(i.find("ul")[0]).append(r),this.isDisabled(i)||this._expandNode(i)):this.element.is("UL")?this.element.append(r):this.element.children("ul:first").length>0?this.element.children("ul:first").append(r):(f=t.buildTag("ul.e-treeview-ul","",{},{role:"group"}),f.append(r),this.element.append(f)),e=this.element.find(".e-item.expanded"),o=0;o<e.length;o++)this.model.loadOnDemand&&!(this.dataSource()instanceof t.DataManager)?this._createChildNodesWhenExpand(n(e[o])):this._expandNode(n(e[o]));e.removeClass("expanded");this.model.showCheckbox&&this._isCheckedAction()},_modifyCss:function(t){t=n(t);t[0]!=null&&t.find(".e-item").length==0&&t.removeClass("e-collapse").attr("aria-expanded",!1).find("> div > .e-icon").removeClass("e-icon e-minus").closest(".e-item").find("ul").remove()},_applyFirstLastChildClass:function(){n(this._liList).removeClass("first last").filter(":first-child:not(:last-child)").addClass("first");n(this._liList).filter(":last-child").addClass("last")},_expandEventHandler:function(t){var i=n(t.target),r,u;i.hasClass("e-icon")||i.closest(".e-item").hasClass("e-node-disable")||t.type==="dblclick"&&this.model.allowEditing||(t.preventDefault(),r=i.is("A")?n(i.siblings("div")):n(i.parent().siblings("div")),u=i.closest(".e-item"),r.hasClass("e-minus")?this._collpaseNode(u):this.model.loadOnDemand&&r.find(".e-item").length==0?this._ClickEventHandler({target:r[0]}):this._expandNode(u))},_inlineEdit:function(t){t.preventDefault();var i=n(t.target);return i.hasClass("input-text")||i.hasClass("e-node-disable")||!i.closest(".e-item").hasClass("AllowEdit")||(i.is("A")||(i=i.closest(".e-text")),i.is("A")&&!i.hasClass("e-node-disable")&&i.closest(".e-item").hasClass("AllowEdit")&&(this.unselectNode(i.closest(".e-item")),this._inlineEditAction(i))),!1},_inlineEditAction:function(n){var t=this.element.find(".e-item > div > .e-text > #Edit_Input");t[0]==null&&this._createEditTextBox(n)},_createEditTextBox:function(i){var f={currentElement:i},r,e,u;return this._triggerEvent("beforeEdit",f)?!1:(r=this.element.find(".e-item > div > .e-text > #Edit_Input"),r[0]==null&&(u=t.buildTag("Input.input-text#Edit_Input","","",{type:"text",value:n.trim(i.text()).replace(/\n\s+/g," "),name:"inplace_value"}),u.width(i.outerWidth()+5),u.height(i.outerHeight()),u.addClass("e-tree-input"),this._beforeEditText=i.text(),i[0].lastChild.nodeValue="",i.addClass("e-editable").append(u),r=u,e=r.val().length==""?3:i.outerWidth()+20,this._mousePositionAtEnd(r),this._currentEditableNode=i,this._on(r,"keypress",this._editTextBoxKeyPress)._on(r,"keydown",this,this._pressEscKey)._on(r,"mousedown",this,this._preventPropagation)._on(r,this.model.expandOn,this,this._preventPropagation)._on(r,"blur",this._focusout)),r)},_preventPropagation:function(n){n.stopImmediatePropagation();this._isTextbox=!0},_editTextBoxKeyPress:function(n){n.target.size=n.target.value.length+1},_mousePositionAtEnd:function(n){return n.focus&&n.focus(),n.select&&n.select(),!0},_focusElement:function(t){if(!this._isTextbox){if(t&&(t.type=="touchstart"||t.type=="pointerdown"||t.type=="MSPointerDown")){var i=n(t.currentTarget);i.hasClass("e-text")&&this.selectNode(i.closest(".e-item"))}this.element.focus()}},_focusout:function(t){var i=n(t.currentTarget),r,u;this.getSelectedNode().length==0&&(u=i.closest(".e-item"),this._isRender=!1,this._nodeSelectionAction(u),this._isRender=!0);this._isTextbox=!1;r={id:i.closest(".e-item").attr("id"),oldText:this._beforeEditText,newText:i.val()};this._triggerEvent("inlineEditValidation",r)?this._cancelAction(i):this._saveAction(i,t)},_pressEscKey:function(i){var r,u,f;i.cancelBubble=!0;i.returnValue=!1;r=n(i.currentTarget);r[0]!=null&&(i.keyCode==13&&(i.stopPropagation(),this._focusout(i)),i.keyCode==27&&this._cancelAction(r),(i.keyCode==13||i.keyCode==27)&&(u=t.browserInfo(),f=u.name=="msie"&&u.version=="8.0"?!0:!1,f&&this.element.focus()))},_onFocusHandler:function(n){n.preventDefault()},_onKeyDown:function(n,t){n.find("> div > .e-text:first").removeClass("e-node-focus");t.find("> div > .e-text:first").addClass("e-node-focus")},_KeyPress:function(t){var u,r=this,o,e,i,p,s,h,w,l,a,v,b,y,f,c,k;if(c=this.element.is("ul")?this.element:this.element.find("> ul"),u=t.keyCode?t.keyCode:t.which?t.which:t.charCode,r.model.allowKeyboardNavigation&&r.element.find("#Edit_Input").length<1&&r.element.find(".e-chkbox-wrap.e-focus").length<1)if(o=c.find(".e-item > div > .e-text.e-active").closest(".e-item"),e=c.find(".e-item:visible"),r._focusedNode?(i=r._focusedNode,r._focusedNode=null):i=c.find(".e-text.e-node-focus").closest(".e-item"),u==113&&(t.preventDefault(),c=i.length>0?i:o,c.length>0&&r.model.allowEditing&&(t.target=c.find("> div > .e-text:first"),r._inlineEdit(t))),u!=40||t.ctrlKey||t.altKey||t.shiftKey)if(u!=38||t.ctrlKey||t.altKey||t.shiftKey)if((u!=39||this.model.enableRTL||t.ctrlKey||t.altKey||t.shiftKey)&&(u!=37||!this.model.enableRTL))if((u!=37||this.model.enableRTL||t.ctrlKey||t.altKey||t.shiftKey)&&(u!=39||!this.model.enableRTL)){if(u!=36||t.ctrlKey||t.altKey||t.shiftKey){if(u!=35||t.ctrlKey||t.altKey||t.shiftKey){if(u==13)t.preventDefault(),f=i.length>0?i:o,f.find("> div > .e-text").removeClass("e-node-focus"),this._nodeSelectionAction(f);else if(u==32)t.preventDefault(),f=i.length>0?i:o,f.length>0&&this.model.showCheckbox&&(b=f.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0],b.checked?this._nodeUncheck(b):this._nodeCheck(b));else if(u==46)t.preventDefault(),f=i.length>0?i:o,f.length>0&&this._removeNode(f,t);else if(t&&t.ctrlKey==!0)if(u==88&&this.model.allowDragAndDrop&&this.model.allowDropChild){if(t.preventDefault(),f=i.length>0?i:o,f.length>0&&(y=f.parents(".e-item:first"),this._cutNode=n(e[e.index(f)]).detach(),n(this._cutNode)[0]!=null)){if(this._triggerEvent("beforeCut",{target:f,nodeDetails:this._getNodeDetails(f),keyCode:u,event:t}))return;this._isRender=!1;this.unselectNode(f);y.find("> ul > .e-item").length==0&&(this.collapseNode(y),this._modifyCss(y));this._isRender=!0;this._triggerEvent("nodeCut",{parentElement:y,parentDetails:this._getNodeDetails(y),keyCode:u,event:t})}}else if(u==86&&this._cutNode!=null&&this.model.allowDragAndDrop&&this.model.allowDropChild&&(t.preventDefault(),f=i.length>0?i:o,f=n(e[e.index(f)]),f.length===0&&(f=this.element),c=this._cutNode.find(" > div > .e-text").first(),n(e).length>0)){if(this._triggerEvent("beforePaste",{target:f,nodeDetails:this._getNodeDetails(f),keyCode:u,event:t}))return;this._isRender=!1;this._dropAsChildNode(f,c,t);this._isRender=!0;this._cutNode=null;k=c.closest(".e-item");this._triggerEvent("nodePaste",{target:k,nodeDetails:this._getNodeDetails(k),keyCode:u,event:t})}}else if(t.preventDefault(),v=i.length>0?i:o,a=n(e).last(),(a.hasClass("e-node-disable")||a.hasClass("hidden"))&&(a=this._getPrevEle(e,a)),o.length>0&&i.length==0&&o[0]!=a[0]||i.length>0&&i[0]!=a[0]){if(r._KeyPressEventHandler(a,r,u,t))return;r._onKeyDown(v,a)}}else if(t.preventDefault(),v=i.length>0?i:o,l=n(e).first(),(l.hasClass("e-node-disable")||l.hasClass("hidden"))&&(l=this._getNextEle(e,l)),o.length>0&&i.length==0&&o[0]!=l[0]||i.length>0&&i[0]!=l[0]){if(r._KeyPressEventHandler(l,r,u,t))return;r._onKeyDown(v,l)}}else if(t.preventDefault(),w=i.length>0?i.find("> div > div").first():o.find("> div > div").first(),h=w.closest(".e-item"),w.hasClass("e-minus"))this._collpaseNode(n(e[e.index(w.closest(".e-item"))]));else{if(h=n(e[e.index(h)]).closest("ul").closest(".e-item"),r._KeyPressEventHandler(h.length>0?h:"",r,u,t))return;h.length>0&&r._onKeyDown(i,h)}else if(t.preventDefault(),p=i.length>0?i.find("> div > div").first():o.find("> div > div").first(),s=p.closest(".e-item"),p.hasClass("e-plus"))this.model.loadOnDemand&&s.find("> ul .e-item").length==0?this._ClickEventHandler({target:p[0]}):this._expandNode(n(e[e.index(s)]));else{if(s=this._getNextEle(e,s),r._KeyPressEventHandler(s.length>0?s:"",r,u,t))return;(s.length>0&&s[0]==p.closest(".e-item").find("ul > .e-item:first")[0]||s.find("ul > .e-item").first().hasClass("e-node-disable"))&&r._onKeyDown(i,s)}else{if(t.preventDefault(),v=i.length>0?i:o,h=this._getPrevEle(e,v),r._KeyPressEventHandler(h.length>0?h:null,r,u,t))return;h.length>0&&r._onKeyDown(i,h)}else{if(t.preventDefault(),v=i.length>0?i:o,s=this._getNextEle(e,v),r._KeyPressEventHandler(s.length>0?s:null,r,u,t))return;s.length>0&&r._onKeyDown(i,s)}},_getNextEle:function(t,i){var u=t.index(i),r;do u++,r=n(t[u]);while(r.hasClass("e-node-disable")||r.hasClass("hidden"));return r},_getPrevEle:function(t,i){var u=t.index(i),r;do u--,r=n(t[u]);while(r.hasClass("e-node-disable")||r.hasClass("hidden"));return r},_removeChildNodes:function(n,i,r){for(var f,e=0,o,u=0;u<i.length;u++)if(!t.isNullOrUndefined(i[u][0][this.model.fields.parentId])&&i[u][0][this.model.fields.parentId].toString()==r){e=i[u].length;break}for(u=0;u<e;u++)for(f=0;f<n.length;f++)if(!t.isNullOrUndefined(n[f][this.model.fields.parentId])&&n[f][this.model.fields.parentId].toString()==r){t.isNullOrUndefined(n[f])||(o=n[f][this.model.fields.id].toString());n.splice(f,1);this._removeChildNodes(n,i,o);break}},_removeNode:function(i,r){var u,o,h,c,s,e,f;if(i[0]!=null&&i[0]!=null&&i.length>0){if(e=this,u=i.closest("ul").closest(".e-item"),o=i,this._triggerEvent("beforeDelete",{target:o,nodeDetails:this._getNodeDetails(o),parentElement:u[0]!=null?u:null,parentDetails:this._getNodeDetails(u),event:r}))return;if(this._isRender=!1,!t.isNullOrUndefined(this.dataSource())&&this.dataSource().length>0)for(f=this.dataSource(),s=0;s<f.length;s++)if(h=o.attr("id"),f[s][this.model.fields.id].toString()==h){c=this._groupingObjects(f,function(n){return[!t.isNullOrUndefined(n)&&[n[e.model.fields.parentId]].toString()]});f.splice(s,1);this._removeChildNodes(f,c,h);break}if(n(this._liList).index(o)==this.model.selectedNode&&(this.model.selectedNode=null),o.remove(),this._modifyCss(u),this._updateNodes(),this._updateCheckState(u),this._isRender=!0,this._triggerEvent("nodeDelete",{parentElement:u[0]!=null?u:null,parentDetails:this._getNodeDetails(u),event:r}))return;e=this;f=this.dataSource();setTimeout(function(){e.dataSource()==null||e.dataSource()instanceof t.DataManager||(e._dataSource=e._groupingObjects(f,function(n){return[!t.isNullOrUndefined(n)&&[n[e.model.fields.parentId]].toString()]}))},300)}},_updateNodes:function(){this._beforeBaseClass();this._applyFirstLastChildClass();this._updateExpandedNodes();this._updateCheckedNodes();this._updateSelectedNode()},_updateField:function(n,i,r,u){var f,e,o;if(!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null&&!(this.dataSource()instanceof t.DataManager)&&!t.isNullOrUndefined(n)&&!t.isNullOrUndefined(i)&&!t.isNullOrUndefined(r))if(this._templateType==1){for(f=0,e=n.length;f<e;f++)if(!t.isNullOrUndefined(n[f])&&!t.isNullOrUndefined(n[f][this.model.fields.id])&&n[f][this.model.fields.id].toString()==i){n[f][r]=u;u==!1&&delete n[f][r];o=n[f];n.splice(f,1,o);break}}else for(f=0,e=n.length;f<e;f++){if(n[f][this.model.fields.id].toString()==i){n[f][r]=u;u==!1&&delete n[f][r];o=n[f];n.splice(f,1,o);break}n[f].hasOwnProperty("child")&&this._updateField(n[f].child,i,r,u)}},_removeField:function(n,i){if(!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null&&!(this.dataSource()instanceof t.DataManager)&&!t.isNullOrUndefined(n))for(var u=0;u<n.length;u++)n[u][i]!=r&&delete n[u][i],n[u].hasOwnProperty("child")&&this._removeField(n[u].child,i)},_KeyPressEventHandler:function(t,i,r,u){var f,e,o,s;return n(t)[0]!=null?(s=this._isNodeExpanded(t),f=this._getNodeDetails(t),o=i._getPath(t),e={keyCode:r,currentElement:t,value:f.text,isExpanded:s,path:o,event:u,id:f.id,parentId:f.parentId}):e={keyCode:r,currentElement:t,value:"",isExpanded:"",path:"",event:u,id:"",parentId:""},this._triggerEvent("keyPress",e)},_documentClick:function(t){var i,e,u,f;if(t.target.id!="Edit_Input"&&(i=n("#Edit_Input")[0]),i!=null){var e=n(i).closest(".e-text")[0],u=i.value,r=n(i).closest(".e-item");this.getSelectedNode().length==0&&(this._isRender=!1,this._nodeSelectionAction(r),this._isRender=!0);n(i).remove();e.lastChild.nodeValue=u;n(e).removeClass("e-editable").removeAttr("style");this._updateField(this._newDataSource,r.attr("id"),this.model.fields.text,u);this._triggerEvent("nodeEdit",{id:r.attr("id"),oldText:this._beforeEditText,newText:u,target:r,nodeDetails:this._getNodeDetails(r),event:t})}this.element.find(t.target).length==0&&(f=this.element.find(".e-item > div > .e-text.e-node-focus"),this._focusedNode=f.closest(".e-item"),f.removeClass("e-node-focus"))},_saveAction:function(t,i){var u=t.val(),r=t.closest(".e-item"),f=t.closest(".e-text")[0];t.remove();f!=null&&(f.lastChild.nodeValue=u,n(f).removeClass("e-editable"),this._updateField(this._newDataSource,r.attr("id"),this.model.fields.text,u),this._triggerEvent("nodeEdit",{id:r.attr("id"),oldText:this._beforeEditText,newText:u,target:r,nodeDetails:this._getNodeDetails(r),event:i}),this.element.focus())},_cancelAction:function(t){var i=t.closest(".e-text")[0];t.remove();i.lastChild.nodeValue=this._beforeEditText;n(i).removeClass("e-node-hover e-editable");this.getSelectedNode().length==0&&(this._isRender=!1,this.selectNode(n(i).closest(".e-item")),this._isRender=!0);this.element.focus()},_mouseEnterEvent:function(t){this.element.find(".e-node-hover").removeClass("e-node-hover");n(t.currentTarget).hasClass("e-text")&&!n(t.currentTarget).hasClass("e-node-disable")&&n(t.currentTarget).addClass("e-node-hover")},_mouseLeaveEvent:function(t){n(t.currentTarget).removeClass("e-node-hover")},_createObjectByText:function(t,i){if(typeof t=="string"){var r={};return r[this.model.fields.text]=t,n(i)[0]!=null&&(r[this.model.fields.parentId]=i[0].getAttribute("id")),r}},_addNodesWhenObject:function(i,r){var l=JSON.stringify(this._dataSource),s=this.dataSource(),f,h,u,e,o,c;if(this._dataSource=[],this.dataSource()!=null&&this.dataSource()instanceof t.DataManager&&(s=[]),r[0]!=null&&r.length>0&&(f=r[0].getAttribute("id")),t.isNullOrUndefined(i.length))this._dataSource.push(i),t.isNullOrUndefined(this.dataSource())||(t.isNullOrUndefined(f)||(i[this.model.fields.parentId]=f),s.push(i));else if(this._dataSource=i,!t.isNullOrUndefined(this.dataSource()))for(u=0;u<i.length;u++)f?i[u][this.model.fields.parentId]=f:delete i[u][this.model.fields.parentId],s.push(i[u]);for(h=this._templateType,this._templateType=2,this._liList||(this._liList=n("li",this.element)),e=document.createDocumentFragment(),o=0,c=this._dataSource.length;o<c;o++)e.appendChild(this._genTemplate(this._dataSource[o],this.model.fields)),this._liList.push(n(e).children()[0]);return this._templateType=h,this.dataSource()==null||this.dataSource()instanceof t.DataManager||(this._dataSource=JSON.parse(l)),e},_addExpandedNodes:function(t){var i=this.model.expandedNodes;this._removeNullInArray(i);n.inArray(t,i)==-1&&this.model.expandedNodes.push(t);this._persistValues(this.model.expandedNodes,"expandedNodes")},_removeExpandedNodes:function(t){var i=this.model.expandedNodes;n.inArray(t,i)>-1&&(this.model.expandedNodes.splice(n.inArray(t,i),1),i.length==0&&i.push(-1));this._persistValues(this.model.expandedNodes,"expandedNodes")},_persistValues:function(i,r){var f,e,c,s,u,l,h,o;if(!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null){for(f=i,e=[],u=0,l=f.length;u<l;u++)!t.isNullOrUndefined(f[u])&&f[u]>=0&&(c=this._liList[f[u]],s=n(c).attr("id"),s&&e.push(s));h=this._getCookies("_persistedValues");h&&(o=JSON.parse(h),o[r]=r=="selectedNode"?e[0]?e[0]:"":e,o=this._updatePersistAttr(o),this._setCookies("_persistedValues",JSON.stringify(o)))}},_updatePersistAttr:function(i){return t.isNullOrUndefined(this._ignoreOnPersist)?(n.inArray("selectedNode",this._addToPersist)==-1&&delete i.selectedNode,n.inArray("expandedNodes",this._addToPersist)==-1&&delete i.expandedNodes,n.inArray("checkedNodes",this._addToPersist)==-1&&delete i.checkedNodes):(n.inArray("selectedNode",this._ignoreOnPersist)>-1&&delete i.selectedNode,n.inArray("expandedNodes",this._ignoreOnPersist)>-1&&delete i.expandedNodes,n.inArray("checkedNodes",this._ignoreOnPersist)>-1&&delete i.checkedNodes),i},_onChecked:function(n,i){var r=n.closest(".e-item"),u,f,e;nodeDetails=this._getNodeDetails(r);this._CurrenctSelectedNodes.push(nodeDetails.text);u=this._isChecked(r);f=t.isNullOrUndefined(i)?"":t.isNullOrUndefined(i.event)?"":i.event;e={currentElement:r,id:nodeDetails.id,parentId:nodeDetails.parentId,value:nodeDetails.text,currentNode:this._CurrenctSelectedNodes,currentCheckedNodes:this._checkedArray,isChecked:u,event:f};this._isRender&&this._triggerEvent("nodeCheck",e)},_onUnChecked:function(n,i){var r=n.closest(".e-item"),u,f,e;nodeDetails=this._getNodeDetails(r);this._CurrenctSelectedNodes.push(nodeDetails.text);u=this._isChecked(r);f=t.isNullOrUndefined(i)?"":t.isNullOrUndefined(i.event)?"":i.event;e={currentElement:r,id:nodeDetails.id,parentId:nodeDetails.parentId,value:nodeDetails.text,currentNode:nodeDetails.text,currentUncheckedNodes:this._uncheckedArray,isChecked:u,event:f};this._triggerEvent("nodeUncheck",e)},_addCheckNodes:function(n){var t=this.model.checkedNodes;this._removeNullInArray(t);!t instanceof Array&&(t=[]);t.indexOf(n)==-1&&t.push(n)},_removeCheckNodes:function(n){var t=this.model.checkedNodes,i;!t instanceof Array&&(t=[]);i=t.indexOf(n);i!=-1&&(t.splice(i,1),t.length==0&&t.push(-1))},_removeNullInArray:function(n){var t=n.indexOf(-1);t!=-1&&n.splice(t,1)},_afterInsertingNode:function(n){this._addDragableClass();this._finalizeEditing(n);var t=n.closest("ul").closest(".e-item");this._modifyCss(t);this._updateCheckState(t);this._isSelectedAction();t.length>0&&t.hasClass("e-node-disable")&&this._nodeDisableAction(t);this._updateSelectedNode()},_insertBeforeOrAfter:function(i,r,u){if(r=this._getNodeByID(r),r[0]!=null&&r.is("LI")&&r.hasClass("e-item")){if(this._triggerEvent("beforeAdd",{data:i,targetParent:r[0]!=null?r:null,parentDetails:this._getNodeDetails(r)}))return;if(this._isRender=!1,typeof i!="object"&&(i=this._createObjectByText(i)),typeof i!="object")return;i[this.model.parentId]&&delete i[this.model.parentId];outerLi=this._addNodesWhenObject(i,r);temp=document.createElement("ul");n(temp).append(outerLi);outerLi=n(temp.children);this.model.showCheckbox&&outerLi.children().find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange});r.parents(".e-item:first").length>0?r.parents(".e-item:first").append(outerLi):this.element.append(outerLi);this.model.showCheckbox&&this._isCheckedAction();this._dropAsSublingNode(r,outerLi.find("> div > .e-text"),u,"");this._afterInsertingNode(outerLi);this._isRender=!0;this._triggerEvent("nodeAdd",{data:i,nodes:outerLi,parentElement:r[0]!=null?r:null,parentDetails:this._getNodeDetails(r)});var f=this,e=this.dataSource();setTimeout(function(){f.dataSource()==null||f.dataSource()instanceof t.DataManager||(f._dataSource=f._groupingObjects(e,function(n){return[!t.isNullOrUndefined(n)&&[n[f.model.fields.parentId]].toString()]}))},300)}},_getNodeByID:function(t){return typeof t!="object"&&t!=""&&t!=r?this.element.find(this._checkValidId(t.toString())):(t=n(t),t.is("A")&&t.hasClass("e-text")&&(t=t.closest(".e-item")),t)},_checkValidId:function(n){return"#"+n.replace(/(:|\.|\[|\]|,)/g,"\\$1")},_isTreeElement:function(t){return n(t)[0]!=null&&t.is("LI")&&t.hasClass("e-item")},_isUrl:function(n){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(n)},_sendAjaxOptions:function(n,t){var r=this,i,u;i=this._getNodeDetails(t);i.mapper=this.model.fields;i.model=this.model;u={url:n,data:i,type:"POST",async:!0,crossDomain:!0,dataType:"JSON",contentType:"application/json; charset=utf-8",success:function(n){try{r._ajaxSuccessHandler(n,t)}catch(i){}},error:function(n){try{r._ajaxErrorHandler(n)}catch(t){}}};this._sendAjaxRequest(u)},_sendAjaxRequest:function(t){var i=JSON.parse(JSON.stringify(t));(delete i.success,delete i.error,this._triggerEvent("beforeLoad",{ajaxOptions:i}))||(delete i.success,delete i.error,n.extend(t,i),n.ajax({type:t.type,url:t.url,dataType:t.dataType,data:t.data,async:t.async,contentType:t.contentType,crossDomain:t.crossDomain,success:t.success,error:t.error}))},_ajaxSuccessHandler:function(n,t){this._isRender=!1;typeof n=="object"&&this.addNode(n,t);this._isRender=!0;this._triggerEvent("loadSuccess",{data:n,targetParent:t,parentDetails:this._getNodeDetails(t)})},_ajaxErrorHandler:function(n){this._triggerEvent("loadError",{error:n})},_wireEvents:function(){this._on(this.element,"click",this._ClickEventHandler)._on(this.element.find(".e-text"),"mouseenter",this._mouseEnterEvent)._on(this.element.find(".e-text"),"mouseleave",this._mouseLeaveEvent)._on(this.element,this.model.expandOn,this._expandEventHandler)._on(this.element,"focus",this._onFocusHandler);this.model.allowEditing&&this._allowEditable();this.model.allowDragAndDrop&&this._addDragableClass();this.model.showCheckbox&&this.element.find(".nodecheckbox").ejCheckBox("enable");this.model.allowKeyboardNavigation&&this._on(this.element,"keydown",this._KeyPress)},_unWireEvents:function(){this._off(this.element,"click")._off(this.element.find(".e-text"),"mouseenter")._off(this.element.find(".e-text"),"mouseleave")._off(this.element,this.model.expandOn)._off(this.element,"focus");this._preventEditable();this._preventDraggable();this.model.allowKeyboardNavigation&&this._off(this.element,"keydown");this.model.showCheckbox&&this.element.find(".nodecheckbox").ejCheckBox("disable")},_enableDragDrop:function(){this.model.allowDragAndDrop&&(this._drag(),this.model.allowDropChild&&this._childDrop(),this.model.allowDropSibling&&this._siblingDrop())},_allowEditable:function(){this.model.template||(this.element.find(".e-item").addClass("AllowEdit"),this._on(n(document),"click",this._documentClick)._on(this.element.find(".e-item > div > .e-text"),"dblclick",this._inlineEdit))},_preventEditable:function(){this.element.find(".e-item").removeClass("AllowEdit");this._off(n(document),"click")._off(this.element.find(".e-item > div > .e-text"),"dblclick")},_preventDraggable:function(){this.element.find(".e-draggable, .e-droppable").removeClass("e-draggable e-droppable");this._preventDropSibling();this._preventDropChild();this._off(this.element,"mouseup touchstart pointerdown MSPointerDown",this._anchors,this._focusElement)},_preventDropSibling:function(){this.element.find(".e-dropsibling").removeClass("e-dropsibling")},_preventDropChild:function(){this.element.find(".e-item > div > .e-dropchild").removeClass("e-dropchild")},_getNodeData:function(i){var u,e,c,l,f,a;if(!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null&&!(this.dataSource()instanceof t.DataManager)&&i!=r){if(this._updatePersistProb(),u=[],this._templateType==2)u=t.DataManager(this._newDataSource).executeLocal(t.Query().where(this.model.fields.id,"equal",i,!1));else{var s=[],o=this._newDataSource,v=t.Query().where(this.model.fields.id,"equal",i,!1),y=t.DataManager(o).executeLocal(v),h=this._getFilterItems(y[0],o);for(e=0,c=h.length;e<c;e++)s.push(new t.Predicate(this.model.fields.id,"equal",h[e],!1));l=t.Query().where(t.Predicate.or(s));u=t.DataManager(o).executeLocal(l)}for(f=0,a=u.length;f<a;f++)n(document.getElementById(u[f][this.model.fields.id])).find("> ul .e-item").length==0?delete u[f][this.model.fields.hasChild]:this._templateType==1&&(u[f][this.model.fields.hasChild]=!0);return u}},_getFilterItems:function(n,i){var f=[],s,e,r,h,o,u,c;for(f.push(n.id),s=t.Query().where(this.model.fields.parentId,"equal",n.id,!1),e=t.DataManager(i).executeLocal(s),r=0,h=e.length;r<h;r++)for(o=this._getFilterItems(e[r],i),u=0,c=o.length;u<c;u++)f.push(o[u]);return f},refresh:function(){this._unWireEvents();this.element.html("");this._init()},expandAll:function(){this.model.enableMultipleExpand&&this._expandAll()},collapseAll:function(){this.model.enableMultipleExpand&&this._collapseAll()},checkAll:function(){this.model.showCheckbox&&this._checkAll()},unCheckAll:function(){this.model.showCheckbox&&this._uncheckAll()},selectNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&this._nodeSelectionAction(n)},unselectNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&this._nodeUnSelectionAction(n)},enableNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&this._nodeEnableAction(n)},disableNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&this._nodeDisableAction(n)},addNodes:function(n,t){if(n&&typeof n=="object"&&t==r&&n.length>0)for(var i=0;i<n.length;i++)this.addNode(n[i],t);else this.addNode(n,t)},addNode:function(i,r){var f,l,h,s,u,o,e,c;t.isNullOrUndefined(i)||(f=null,l=null,u=r?this._getNodeByID(r):this.getSelectedNode(),typeof i=="object"&&(t.isNullOrUndefined(i.length)&&!t.isNullOrUndefined(i[this.model.fields.parentId])?s=i[this.model.fields.parentId]:t.isNullOrUndefined(i.length)||i.length!=1||(s=i[0][this.model.fields.parentId]),s&&(u=this._getNodeByID(s))),u=this._isTreeElement(u)?u:[],this._triggerEvent("beforeAdd",{data:i,targetParent:u[0]!=null?u:null,parentDetails:this._getNodeDetails(u)}))||(u.length==0||u.hasClass("e-node-disable")||this._expandNode(u),typeof i!="object"&&(i=this._createObjectByText(i,u)),typeof i!="object"||t.isNullOrUndefined(i.length)&&i.length==0)||(f=this._addNodesWhenObject(i,u),h=document.createElement("ul"),n(h).append(f),f=n(h.children),this.model.showCheckbox&&f.children().find(".nodecheckbox").ejCheckBox({cssClass:this.model.cssClass,change:this._checkedChange}),this._appendNode(u,f),u[0]!=null&&(o=n(u[0].childNodes[0].childNodes[0]),o.hasClass("e-plus")||o.hasClass("e-minus")?o.removeClass("e-load"):o.removeClass("e-icon e-load")),u[0]!=null&&u.find("> div > .e-minus").length>0&&!this.model.enableMultipleExpand&&this._denyMultipleExpand(u),this._updateNodes(),this._afterInsertingNode(f),this._triggerEvent("nodeAdd",{data:i,nodes:f,parentElement:u[0]!=null?u:null,parentDetails:this._getNodeDetails(u)}),e=this,c=this.dataSource(),setTimeout(function(){e.dataSource()==null||e.dataSource()instanceof t.DataManager||(e._dataSource=e._groupingObjects(c,function(n){return[!t.isNullOrUndefined(n)&&[n[e.model.fields.parentId]].toString()]}))},300))},removeNode:function(n){n=n?this._getNodeByID(n):this.getSelectedNode();this._isTreeElement(n)&&this._removeNode(n)},removeAll:function(){this._liList.remove();this._updateNodes()},checkNode:function(n){this.model.showCheckbox&&(n=this._getNodeByID(n),this._isTreeElement(n)&&this._nodeCheck(n.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]))},uncheckNode:function(n){this.model.showCheckbox&&(n=this._getNodeByID(n),this._isTreeElement(n)&&this._nodeUncheck(n.find("> div > .e-chkbox-wrap > .nodecheckbox:first")[0]))},expandNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&(this._allowOnDemand=!0,this._expandNode(n),this._allowOnDemand=!1)},collapseNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&this._collpaseNode(n)},showNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&n.css("visibility","").removeClass("hidden")},hideNode:function(n){n=this._getNodeByID(n);this._isTreeElement(n)&&n.css("visibility","hidden").addClass("hidden")},show:function(){this.element.css("visibility","").find(".e-item").removeClass("hidden")},hide:function(){this.element.css("visibility","hidden").find(".e-item").addClass("hidden")},hasChildNode:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?n.find("> ul > .e-item").length>0?!0:!1:void 0},isChildLoaded:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)&&n.find("ul > .e-item").length>0?!0:!1},isNodeChecked:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?this._isChecked(n):void 0},isExpanded:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?this._isNodeExpanded(n):void 0},isVisible:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)&&n.css("visibility")!="hidden"?!0:!1},isExist:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)&&this._liList.index(n)!=-1?!0:!1},isSelected:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?n.find("> div > .e-text").hasClass("e-active"):void 0},isDisabled:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)&&n.hasClass("e-node-disable")?!0:!1},getTreeData:function(n){return n!=r?this._getNodeData(n):!t.isNullOrUndefined(this.model.fields)&&this.dataSource()!=null&&!(this.dataSource()instanceof t.DataManager)?this._orderDataSource():void 0},getText:function(t){return t=this._getNodeByID(t),this._isTreeElement(t)?n.trim(this.element.find(t).find("> div > .e-text").text()):void 0},getSelectedNode:function(){return this.element.find(".e-item > div > .e-active").closest(".e-item")},getCheckedNodes:function(){if(this.model.showCheckbox)return this._liList.find('> div > .e-chkbox-wrap[aria-checked="true"]').closest(".e-item")},getExpandedNodes:function(){return this.element.find(".e-item > div > .e-minus").closest(".e-item")},getExpandedNodesIndex:function(){for(var t=this.getExpandedNodes(),i=[],n=0,r=t.length;n<r;n++)i.push(this._liList.index(t[n]));return i},getCheckedNodesIndex:function(){for(var t=this.getCheckedNodes(),i=[],n=0,r=t.length;n<r;n++)i.push(this._liList.index(t[n]));return i},getSelectedNodeIndex:function(){return this._liList.index(this.getSelectedNode())},getVisibleNodes:function(){return this.element.find(".e-item:visible:not(.hidden, .e-node-disable)")},getNodeCount:function(){return this.element.find(".e-item").length},getNode:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?this._getNodeDetails(n):null},getNodeIndex:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?this._liList.index(n):void 0},getNodeByIndex:function(t){if(typeof t=="number")return n(this._liList[t])},getParent:function(n){return n=this._getNodeByID(n),this._isTreeElement(n)?n.parents(".e-item:first"):void 0},updateText:function(i,r){if(i=this._getNodeByID(i),this._isTreeElement(i)&&!t.isNullOrUndefined(r)){var u=this.element.find(i).children("div").find("> .e-text")[0],f,e;if(u!=null){if(e={currentElement:n(u)},this._triggerEvent("beforeEdit",e))return!1;f=u.lastChild.nodeValue}u.lastChild.nodeValue=r;this._updateField(this._newDataSource,i.attr("id"),this.model.fields.text,r);this._triggerEvent("nodeEdit",{id:i.attr("id"),oldText:f,newText:r,target:i,nodeDetails:this._getNodeDetails(i),event:null})}},insertAfter:function(n,t){this._insertBeforeOrAfter(n,t,!1)},insertBefore:function(n,t){this._insertBeforeOrAfter(n,t,!0)},moveNode:function(n,i,r){if(n=this._getNodeByID(n),i=this._getNodeByID(i),this._isTreeElement(n)){if(n.parents(".e-item")[0]==i[0]&&t.isNullOrUndefined(r)||i.find(n).index()==r||i[0]==null&&this._liList.index(n)==r)return;var u=i[0]!=null&&r>=0?i.find("> ul > .e-item").eq(r):this.getNodeByIndex(r);this._isRender=!1;this._isTreeElement(u)?u.parents(".e-item:first")[0]==n.parents(".e-item:first")[0]&&u.next(".e-item")[0]==null?this._dropAsSublingNode(u,n.find(" > div > .e-text"),!1,""):this._dropAsSublingNode(u,n.find(" > div > .e-text"),!0,""):this._dropAsChildNode(i,n.find(" > div > .e-text"),"");i.length>0&&i.hasClass("e-node-disable")&&this._nodeDisableAction(i);this._isRender=!0}},loadData:function(n,t){t=this._getNodeByID(t);this._isUrl(n)&&(t[0]==null||this._isTreeElement(t))&&this._sendAjaxOptions(n,t)},ensureVisible:function(t){var r,u,i,f;if(t=this._getNodeByID(t),this._isTreeElement(t)&&!this.isDisabled(t)&&this.isVisible(t)){for(r=t.parents(".e-item"),i=0,f=r.length;i<f;i++)this._expandNode(n(r[i]));return u=t.offset(),t.animate({scrollTop:u.top},this.model.enableAnimation?350:0,"linear",function(){t.find("> div > a.e-text")[0].scrollIntoView(!1)}),!0}return!1},_triggerEvent:function(n,t){if(this._isRender)return this._trigger(n,t)}})})(jQuery,Syncfusion)});
