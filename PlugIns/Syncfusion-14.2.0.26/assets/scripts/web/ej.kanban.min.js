/*!
*  filename: ej.kanban.min.js
*  version : 14.2.0.26
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["jquery-easing","./../common/ej.globalize.min","jquery-validation","jsrender","./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.button.min","./ej.waitingpopup.min","./ej.datepicker.min","./ej.datetimepicker.min","./ej.dropdownlist.min","./ej.dialog.min","./ej.editor.min","./ej.toolbar.min","./ej.rte.min","./ej.menu.min"],n):n()})(function(){var r=function(){function n(n){this.kanbanObj=null;this._dragEle=null;this._dropEle=null;this._dropTarget=null;this.kanbanObj=n}return n.prototype._addDragableClass=function(){var n=this.kanbanObj;n._dropped=!1;this._dragEle=n.getContent().find(".e-columnrow .e-kanbancard");this._dropEle=n.getContent().find(".e-columnrow .e-rowcell");this._dropEle.addClass("e-droppable");this._dragEle.addClass("e-draggable e-droppable");this._enableDragDrop();n._on(n.element,"mouseup touchstart pointerdown MSPointerDown","",$.proxy(n.element.focus(),this))},n.prototype._enableDragDrop=function(){var n=this.kanbanObj;this._drag();$(n.getContent()).ejDroppable({accept:$(n.getContent()).find("div.e-kanbancard"),drop:function(n,t){$(t.helper).hide()}})},n.prototype._selectedPrevCurrentCards=function(){var t,i,n=this.kanbanObj;n._previousRowCellIndex.length>0&&(t=n._getCardbyIndexes(n._previousRowCellIndex),n._pCardId=t.attr("id"));n._previousRowCellIndex=n._currentRowCellIndex;n._pCardId=n._cCardId;n._currentRowCellIndex.length>0&&(i=n._getCardbyIndexes(n._currentRowCellIndex),n._cCardId=i.attr("id"))},n.prototype._getPriorityIndex=function(n){for(var i=null,r=this.kanbanObj,t=0;t<r._priorityCollection.length;t++)if(r._priorityCollection[t].primaryKey==n.attr("id")){i=r._priorityCollection[t];break}return ej.isNullOrUndefined(i)?this._getPriorityKey(parseInt(n.attr("id"))):parseInt(i.dropKey)},n.prototype._removeFromPriorirtyCollec=function(n){for(var i=null,r=this.kanbanObj,t=0;t<r._priorityCollection.length;t++)if(r._priorityCollection[t].primaryKey==n){i=t;break}ej.isNullOrUndefined(i)||r._priorityCollection.splice(i,1)},n.prototype._columnDataOndrop=function(n,t){var r=this.kanbanObj,h=new ej.DataManager(r._initialData),u,f,e,o,s,i=new ej.Query;return f=r.model.keyField,e=r.model.fields.swimlaneKey,o=$(n).hasClass("e-rowcell")?$(n).attr("ej-mappingkey"):$(n).parents(".e-rowcell").attr("ej-mappingkey"),s=$(n).parents(".e-columnrow").prev(".e-swimlanerow").find(".e-slkey").text(),i=ej.isNullOrUndefined(e)?i.where(f,ej.FilterOperators.equal,o):i.where(f,ej.FilterOperators.equal,o).where(e,ej.FilterOperators.equal,s),u=h.executeLocal(i),u.sort(function(n,i){return n[t]-i[t]}),u},n.prototype._dropToColumn=function(n,t){var i=this.kanbanObj,h,u,f=[],c=!1,e=i.model.fields.priority,l,o,a,s,r,v,y;for(ej.isNullOrUndefined(i._filterToolBar)||(l=i._filterToolBar.find(".e-select")),n.hasClass("e-targetclone")&&(n=n.parent()),this._selectedPrevCurrentCards(),e&&(!ej.isNullOrUndefined(i._filterToolBar)&&l.length>0||i._searchBar!=null&&i._searchBar.find(".e-cancel").length>0)?(f=this._columnDataOndrop(n,e),c=f.length>0):c=$(n).children(".e-kanbancard").length>1,i.model.selectionType=="multiple"&&this._getSelectedCards(t).length>0&&$(t).hasClass("e-cardselection")&&(t=this._getSelectedCards(t)),o=0;o<t.length;o++)for(a=t[o],s=0;s<$(a).length;s++)r=$(a)[s],$(r).is(":visible")&&(e&&c&&(h=!ej.isNullOrUndefined(i._filterToolBar)&&l.length>0||i._searchBar!=null&&i._searchBar.find(".e-cancel").length>0?f[f.length-1][e]:this._getPriorityIndex(n.find(".e-kanbancard").last()),u=this._getPriorityIndex($(r)),h>=u&&(u=++h),this._removeFromPriorirtyCollec($(r).attr("id")),i._priorityCollection.push({primaryKey:$(r).attr("id"),dropKey:u}),v=i._getKanbanCardData(i._currentJsonData,$(r)[0].id)[0],ej.isNullOrUndefined(u)||(v[e]=u,f.push(v))),$(n).find(".e-customaddbutton").length>0?$(r).insertBefore($(n).find(".e-customaddbutton")):i.element.hasClass("e-responsive")?(y=n.find(".e-cell-scrollcontent"),y.length>0?y.children().append(r):$(n).append(r)):$(n).append(r));this._updateDropAction(n,t)},n.prototype._updateDropAction=function(n,t){var a,i=this.kanbanObj,r,f,e,o,h,u,s,c,l;for(a=$(n).hasClass("e-rowcell")?n:$(n).closest("td.e-rowcell"),i._selectedCardData=[],r=0;r<t.length;r++)if(ej.isNullOrUndefined(t[r].length))$(t[r]).is(":visible")&&(f=$(t[r]).attr("id"),this._updateDropData(n,t[r],f),u=i.element.find("#"+f),u.parents(".e-rowcell").hasClass("e-shrink")&&u.addClass("e-hide"));else for(e=0;e<t[r].length;e++)$(t[r][e]).is(":visible")&&(f=t[r][e].id,this._updateDropData(n,t[r][e],f),u=i.element.find("#"+f),u.parents(".e-rowcell").hasClass("e-shrink")&&u.addClass("e-hide"));if(i.model.fields.priority&&i._priorityCollection.length>0)for(o=0;o<i._priorityCollection.length;o++)h=i._priorityCollection[o].primaryKey,u=i.element.find("#"+h),this._updateDropData(n,u,h);i._bulkUpdateData.length>0&&(i._dataManager instanceof ej.DataManager&&!i._dataManager.dataSource.offline||i._dataSource().adaptor instanceof ej.remoteSaveAdaptor)&&(l=this,c={added:[],deleted:[],changed:[]},c.changed=i._bulkUpdateData,$("#"+i._id).data("ejWaitingPopup").show(),s=i._dataManager.saveChanges(c,i.model.fields.primaryKey,i.model.query._fromTable),$.isFunction(s.promise)&&(s.done(function(){l._updateDataOndrop(i._bulkUpdateData)}),s.fail(function(n){var t={error:n.error};l._updateDataOndrop(i._failBulkData);i._trigger("actionFailure",t)})));(!ej.isNullOrUndefined(t[0].length)&&t[0].length>1||t.length>1||t.length==1&&$(t).hasClass("e-cardselection"))&&(i._previousRowCellIndex=ej.isNullOrUndefined(i._pCardId)?[]:this._updateRowCellIndexes(i._pCardId,i._previousRowCellIndex),i._currentRowCellIndex=ej.isNullOrUndefined(i._cCardId)?[]:this._updateRowCellIndexes(i._cCardId,i._currentRowCellIndex),i._selectionOnRerender(),ej.isNullOrUndefined(i._pCardId)&&(i._previousRowCellIndex=i._currentRowCellIndex),i.model.selectionType=="single"?i.selectedRowCellIndexes=i._currentRowCellIndex:this._updateSelectedCardIndexes(n));i._priorityCollection=[]},n.prototype._updateDataOndrop=function(n){for(var r,t=this.kanbanObj,i=0;i<n.length;i++)r=n[i][t.model.fields.primaryKey],t.element.find("#"+r).length>0&&t._renderSingleCard(r,n[i]);t._failBulkData=[];t._bulkUpdateData=[];t.refresh(!0);$("#"+t._id).data("ejWaitingPopup").hide()},n.prototype._getPriorityKey=function(n){var t=this.kanbanObj,i=t._getKanbanCardData(t._currentJsonData,n);return i[0][t.model.fields.priority]},n.prototype._dropAsSibling=function(n,t,i){var r=this.kanbanObj,s=0,d=0,rt=0,p,ut,f,k,g,nt,tt,u=[],ot,h=r.model.fields.priority,w,b,l,ft,v,e,st,et,y,o,a,c,it;for(ej.isNullOrUndefined(r._filterToolBar)||(w=r._filterToolBar.find(".e-select")),b=r.model.fields.primaryKey,this._selectedPrevCurrentCards(),h&&(!ej.isNullOrUndefined(r._filterToolBar)&&w.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0)&&(u=this._columnDataOndrop(n,h)),$(n).hasClass("e-targetclone")&&(n.next().length==0&&$(n).addClass("e-targetappend"),nt=$(n).prevAll(".e-kanbancard")[0],tt=$(n).nextAll(".e-kanbancard")[0],$(n).hasClass("e-targetclone")&&(nt=$(n).prevAll(".e-kanbancard")[0],tt=$(n).nextAll(".e-kanbancard")[0],$(n).hasClass("e-targetappend")?(i=!0,n=nt,ej.isNullOrUndefined(n)&&(n=tt)):(i=!1,n=tt,ej.isNullOrUndefined(n)&&(n=nt)))),g=n,r.model.selectionType=="multiple"&&this._getSelectedCards(t).length>0&&$(t).hasClass("e-cardselection")&&(t=this._getSelectedCards(t)),l=0;l<t.length;l++)for(ft=t[l],v=0;v<$(ft).length;v++)if(e=$(ft)[v],$(e).is(":visible")&&(i&&(v>0&&t[l][v-1]!=g?n=t[l][v-1]:v==0&&l>0&&t[l-1]!=g&&(n=t[l-1])),e!=g&&(i?$(e).insertAfter(n):$(e).insertBefore(n),h&&(!ej.isNullOrUndefined(r._filterToolBar)&&w.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0)&&(st=r._getKanbanCardData(u,$(n).attr("id")),c=u.indexOf(st[0]),i?u.splice(c+1,0,r._getKanbanCardData(r._currentJsonData,$(e)[0].id)[0]):u.splice(c,0,r._getKanbanCardData(r._currentJsonData,$(e)[0].id)[0]),ot=$(e)[0].id)),h)){if(!ej.isNullOrUndefined(r._filterToolBar)&&w.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0)for(a=r._getKanbanCardData(u,$(n).attr("id")),s=a[0][h],a=r._getKanbanCardData(u,ot),k=[],y=u.indexOf(a[0]);y<u.length;y++)k.push(u[y]);else s=this._getPriorityIndex($(n)),k=$(e).nextAll(".e-kanbancard").andSelf();for(y=0;y<k.length;y++){if(o=k[y],!ej.isNullOrUndefined(r._filterToolBar)&&w.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0?(a=null,f=o[h],!i&&parseInt($(e)[0].id)==o[h]&&s<f&&(f=s),a=r._getKanbanCardData(u,o[b]),c=et=u.indexOf(a[0]),c-1>=0&&(d=u[c-1][h]),a=r._getKanbanCardData(u,o[b]),c=et=u.indexOf(a[0]),c+1<u.length?(rt=u[c+1][h],p=u[c+1]):p=[]):(f=this._getPriorityKey(parseInt($(o).attr("id"))),!i&&$(e)[0]==o&&s<f&&(f=s),ut=$(o).prevAll(".e-kanbancard"),ut.length>0&&(d=this._getPriorityIndex(ut.eq(0))),p=$(o).nextAll(".e-kanbancard"),p.length>0&&(rt=this._getPriorityIndex(p.eq(0)))),!isNaN(d)&&d<f&&(f<rt||p.length==0))break;!ej.isNullOrUndefined(r._filterToolBar)&&w.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0?(!i&&parseInt($(e)[0].id)==o[b]?!i&&parseInt($(e)[0].id)==o[b]&&s<f||(f=s):f=++s,u[et][h]=f,it=o[b]):(!i&&$(e)[0]==o?!i&&$(e)[0]==o&&s<f||(f=s):f=++s,it=$(o).attr("id"));this._removeFromPriorirtyCollec(it);r._priorityCollection.push({primaryKey:it,dropKey:f});s=f}}this._updateDropAction(n,t);this._dropTarget=null},n.prototype._updateSelectedCardIndexes=function(n){var e,f,t=this.kanbanObj,i,r,u;if(t.selectedRowCellIndexes.length>0)for($(n).hasClass("e-rowcell")?f=$(n).index():(n=t.element.find("#"+$(n).attr("id")),f=$(n).parents(".e-rowcell").index()),e=$(n).parents(".e-columnrow"),$.inArray(f,t.selectedRowCellIndexes[0].cellIndex)==-1&&t.selectedRowCellIndexes[0].cellIndex.push(f),i=0;i<t.selectedRowCellIndexes[0].cellIndex.length;i++)if(r=e.find(".e-rowcell").eq(t.selectedRowCellIndexes[0].cellIndex[i]).find(".e-cardselection"),r.length>0)for(t.selectedRowCellIndexes[0].cardIndex.splice(i,1),t.element.find(".e-targetclone").remove(),u=0;u<r.length;u++)u>0?t.selectedRowCellIndexes[0].cardIndex[i].push($(r[u]).index()):t.selectedRowCellIndexes[0].cardIndex.splice(i,0,[$(r[0]).index()]);else t.selectedRowCellIndexes[0].cellIndex.splice(i,1),t.selectedRowCellIndexes[0].cardIndex.splice(i,1),--i},n.prototype._updateDropData=function(n,t,i){var r=this.kanbanObj,l,e,h,u,o,c,s,f,a;if(!ej.isNullOrUndefined(r.model.fields.primaryKey)){if(u=[],e=r.model.fields.priority,h=r.model.fields.primaryKey,ej.isNullOrUndefined(i)&&(i=$(n).attr("id")),l=$(n).hasClass("e-rowcell")?$(n):$(n).parents(".e-rowcell"),l.index()<0&&(l=r.element.find("#"+$(n).attr("id")).parents(".e-rowcell")),u=r._getKanbanCardData(r._currentJsonData,i),(r._dataManager instanceof ej.DataManager&&!r._dataManager.dataSource.offline||r._dataSource().adaptor instanceof ej.remoteSaveAdaptor)&&r._failBulkData.push($.extend(!0,{},u[0])),u.length>0&&(u[0][r.model.keyField]=r.model.columns[l.index()].key,r.model.fields.swimlaneKey&&(u[0][r.model.fields.swimlaneKey]=$(n).parents("tr.e-columnrow").prev().find("div.e-slkey").html())),r._dropped=!0,e&&r._priorityCollection.length>0){for(s=0;s<r._priorityCollection.length;s++)if(r._priorityCollection[s].primaryKey==i){o=r._priorityCollection[s];r._priorityCollection.splice(s,1);break}if(!ej.isNullOrUndefined(o)&&u.length>0&&(u[0][e]=o.dropKey),!ej.isNullOrUndefined(r._filterToolBar)&&r._filterToolBar.find(".e-select").length>0&&!ej.isNullOrUndefined(o)||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0)for(f=0;f<r._initialData.length;f++)if(o.primaryKey==r._initialData[f][h]){u.length>0?r._initialData[f]=u[0]:r._initialData[f][e]=o.dropKey;c=r._initialData[f];break}}if(u.length>0){if($(t).hasClass("e-cardselection")){for(f=0;f<r._selectedCardData.length;f++)if(u[0][h]==r._selectedCardData[f][h])break;r._selectedCardData.splice(f,1);r._selectedCardData.push(u[0])}r._dataManager instanceof ej.DataManager&&!r._dataManager.dataSource.offline||r._dataSource().adaptor instanceof ej.remoteSaveAdaptor?r._bulkUpdateData.push(u[0]):r._renderSingleCard(i,u[0])}else e&&(r._dataManager instanceof ej.DataManager&&!r._dataManager.dataSource.offline||r._dataSource().adaptor instanceof ej.remoteSaveAdaptor?r._getKanbanCardData(r._bulkUpdateData,c[h]).length<=0&&r._bulkUpdateData.push(c):r._dataSource()instanceof ej.DataManager?(a=r._getKanbanCardData(r._dataSource().dataSource.json,i),a[0][e]=c[e]):(a=r._getKanbanCardData(r._dataSource(),i),a[0][e]=c[e]))}},n.prototype._updateRowCellIndexes=function(n,t){var f,i,r=[],u;return ej.isNullOrUndefined(n)?r=t:(u=this.kanbanObj.element.find("#"+n),f=$(u).parents(".e-columnrow"),i=$(u).parents(".e-rowcell"),r.push([f.index(),[i.index()],[i.find(".e-kanbancard").index(i.find("#"+n))]])),r},n.prototype._dragStop=function(n,t,i){var h=this,c,d,a,g,f,r=this.kanbanObj,l,u,w,o,b,k,s,y,p;if(n.element.dropped||t&&t.remove(),n.target=this._getCursorElement(n),u=$(n.target).closest(".e-kanbancard").length>0?$(n.target).closest(".e-kanbancard")[0]:n.target,r.element.hasClass("e-responsive")&&!$(u).hasClass("e-targetclone")&&(w=$(u).parents(".e-rowcell"),!$(u).hasClass("e-kanbancard")&&$(u).parents(".e-kanbancard").length==0&&w.length>0&&(n.target=u=w[0])),h._dropEle.removeClass("e-dropping e-dragged"),c={data:n.dragData,draggedElement:n.dragEle,dropTarget:$(u),event:n.event},r._trigger("cardDragStop",c))return!1;a=$(n.element).parents(".e-columnrow");d=a.find(".e-cardselection");g=a.find(".e-rowcell");f=r.element.find(".e-targetclone");l=$(n.element).parents(".e-rowcell");var nt=$(u).parent().children().hasClass("e-customaddbutton"),v=$(u).parent().children().hasClass("e-limits"),tt=$(u).parent().children().hasClass("e-shrinkheader"),e=$(u).parent().children(),it=tt?nt?v?e.length==4:e.length==3:v?e.length==3:e.length==2:nt?v?e.length==3:e.length==2:v?e.length==2:e.length==1;return(f.is(":visible")&&document.body.style.cursor==""&&u.style.cursor==""?u.nodeName=="TD"&&$(u).parent().hasClass("e-columnrow")&&f.is(":visible")||f.siblings().length<=0||it?(k=$(u).find(".e-cell-scrollcontent"),o=k.length>0?k.children().eq(0).children().last():$(u).children().last(),o.hasClass("e-targetclone")&&(o=o.prev()),b=f.siblings().not(".e-shrinkheader").not(".e-customaddbutton").not(".e-limits"),($(u).children().length==0||b.length<=0||$(o).offset().top+$(o).height()<$(f).offset().top)&&(o.next().hasClass("e-targetclone")||b.length<=0?h._dropToColumn($(u),$(n.element)):(i=!1,h._dropAsSibling($(f.next()),$(n.element),i)))):u.nodeName=="DIV"&&($(u).hasClass("e-kanbancard")||$(u).hasClass("e-targetclone"))&&(f.is(":visible")||d.length>1)&&h._dropAsSibling($(u),$(n.element),i):h._removeKanbanCursor(),r.element.hasClass("e-responsive")&&r.element.parents("body").removeClass("e-kbnwindow-modal"),r._autoKbnSwipeLeft=!1,r._autoKbnSwipeRight=!1,r.element.find(".e-targetclone").remove(),g.height(a.find(u).parents(".e-rowcell").height()-r._tdHeightDiff),r._on(r.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard",r._cardHover),$(t).length>0&&$(t).remove(),r._renderLimit(),r._totalCount(),r._eventBindings(),r.model.isResponsive&&r._kanbanWindowResize(),s=r.element.find("#"+n.element.attr("id")),$(s).hasClass("e-cardselection")&&(s=$(s).parents(".e-columnrow").find(".e-cardselection:visible")),c.draggedElement=s,c.draggedParent=l,r._trigger("cardDrop",c))?!1:(y=l.parent().find(".e-rowcell"),p=s.parents(".e-rowcell"),r.element.hasClass("e-responsive")&&p[0]!=l[0]&&y.index(p)!=r._kbnSwipeCount&&(y.index(p)>y.index(l)?r._kbnLeftSwipe():r._kbnRightSwipe()),r.element.find(".e-togglevisible").removeClass("e-togglevisible"),!0)},n.prototype._getCursorElement=function(n){var i=$(n.target).closest(".dragClone"),t=n.event;return i.length>0&&(i.hide(),n.target=t.type=="touchmove"||t.type=="touchstart"||t.type=="touchend"?document.elementFromPoint(t.originalEvent.changedTouches[0].pageX,t.originalEvent.changedTouches[0].pageY):document.elementFromPoint(t.clientX,t.clientY),i.show()),n.target},n.prototype._getSelectedCards=function(n){for(var r,t=this.kanbanObj,i=0;i<t._selectedCards.length;i++)if($(t._selectedCards[i]).length>1)for(r=0;r<t._selectedCards[i].length;r++)$(t._selectedCards[i][r])[0]==n[0]&&(t._selectedCards[i].splice(r,1),t._selectedCards[i].splice(0,0,n[0]),t._selectedCards.splice(0,0,t._selectedCards[i]),t._selectedCards.splice(i+1,1));else $(t._selectedCards[i])[0]==n[0]&&(t._selectedCards.splice(0,0,t._selectedCards[i]),t._selectedCards.splice(i+1,1));return t._selectedCards},n.prototype._kanbanAutoScroll=function(n){var nt=this,t=this.kanbanObj,r,u,f=null,e=null,o=null,i=null,h=t.element.find(".e-draggedcard"),g=t.element.find(".e-columnrow .e-rowcell"),b,a,k,v,y,c,d,p,s,w,l;v=ej.isNullOrUndefined(n.event.clientX)?n.event.originalEvent.changedTouches[0].clientX:n.event.clientX;y=ej.isNullOrUndefined(n.event.clientY)?n.event.originalEvent.changedTouches[0].clientY:n.event.clientY;b=t.element.width();r=t.element.hasClass("e-responsive")&&!t.element.hasClass("e-swimlane-responsive")?$(g).eq(t._kbnSwipeCount).find(".e-cell-scrollcontent"):t.getContent();u=r.data("ejScroller");a=t.element.offset().left;k=t.element.offset().top;p=r.find(".e-hup");d=r.find(".e-hdown");l=r.find(".e-vup");w=r.find(".e-vdown");c=r.find(".e-hhandle.e-box");s=r.find(".e-vhandle.e-box");t.element.hasClass("e-responsive")||(v>a+b-10?(t.element.removeClass("e-view-horizontal"),e=window.setInterval(function(){c.width()+c.offset().left<=d.offset().left&&!t.element.hasClass("e-view-horizontal")?u.scrollX(u.scrollLeft()+5,!0):e&&(e=window.clearInterval(e));h.length<=0&&e&&(e=window.clearInterval(e))},100)):v-10<a?(t.element.removeClass("e-view-horizontal"),u.scrollLeft()>0&&(f=window.setInterval(function(){c.offset().left>=p.offset().left+p.width()&&!t.element.hasClass("e-view-horizontal")?u.scrollX(u.scrollLeft()-5,!0):f&&(f=window.clearInterval(f));h.length<=0&&f&&(f=window.clearInterval(f))},100))):(t.element.addClass("e-view-horizontal"),e&&(e=window.clearInterval(e)),f&&(f=window.clearInterval(f))));!ej.isNullOrUndefined(r)&&r.length>0&&r.hasClass("e-scroller")&&(y>k+t.getHeaderContent().height()+(r.height()-60)&&s.length>0&&w.length>0?(t.element.removeClass("e-view-vertical"),i=window.setInterval(function(){s.height()+s.offset().top<=w.offset().top&&!t.element.hasClass("e-view-vertical")?u.scrollY(u.scrollTop()+5,!0):i&&(i=window.clearInterval(i));h.length<=0&&i&&(i=window.clearInterval(i))},100)):y-30<t.element.find(".e-kanbancontent").offset().top&&s.length>0&&l.length>0?u.scrollTop()>0&&(t.element.removeClass("e-view-vertical"),o=window.setInterval(function(){i&&(i=window.clearInterval(i));s.offset().top>=l.offset().top+l.height()&&!t.element.hasClass("e-view-vertical")?u.scrollY(u.scrollTop()-5,!0):o&&(o=window.clearInterval(o));h.length<=0&&o&&(i=window.clearInterval(o))},100)):(t.element.addClass("e-view-vertical"),i&&(i=window.clearInterval(i)),o&&(o=window.clearInterval(o))))},n.prototype._changeKanbanCursor=function(n,t,i){var f=$(n).parents(".e-kanbancard"),e=$(n).hasClass("e-kanbancard"),u,r;f.length>0||e?(r=e?$(n):f,r[0].style.cursor="not-allowed"):$(n).hasClass("e-shrinkheader")||$(n).parents(".e-shrinkheader").length>0||$(n).hasClass("e-slexpandcollapse")||$(n).parents(".e-slexpandcollapse").length>0?(r=$(n),$(n).parents(".e-shrinkheader").length>0?r=$(n).parents(".e-shrinkheader"):$(n).parents(".e-slexpandcollapse").length>0&&(r=$(n).parents(".e-slexpandcollapse")),r[0].style.cursor="not-allowed"):$(n).hasClass("e-shrink")?$(n)[0].style.cursor="not-allowed":($(n).parents(".e-columnrow").has(i.element).length==0||$(n).parents(".e-swimlanerow").length>0)&&(document.body.style.cursor="not-allowed");u=$(t).find(".e-kanbancard");u.length>0&&(u[0].style.cursor="not-allowed")},n.prototype._removeKanbanCursor=function(){document.body.style.cursor="";this.kanbanObj.element.find(".e-kanbancard,.e-shrink,.e-shrinkheader,.e-slexpandcollapse").css("cursor","")},n.prototype._drag=function(){var u=this,t=null,i=null,h=null,c=null,l=null,a,o,e,f=[],r,s,n=this.kanbanObj;n.element!=null&&(h=n.getContent().find("div:first"));$(n.getContent()).find("div.e-kanbancard").not(".e-js").ejDraggable({dragArea:h,clone:!0,cursorAt:{left:-20,top:-20},dragStart:function(r){var h,o;if(n.model.enableTouch&&!ej.isNullOrUndefined(n._cardSelect)&&n._cardSelect=="touch")return!1;for(n.element.hasClass("e-responsive")&&n.element.parents("body").addClass("e-kbnwindow-modal"),n._off(n.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard"),s=n.element.find(".e-draggedcard"),i=$(r.element).hasClass("e-cardselection")?$(r.element).parents(".e-columnrow").find(".e-cardselection:visible"):$(r.element),i.length>1&&(h=ej.buildTag("div.e-dragmultiple"),h.append(i.length+n.localizedLabels.Cards),s.children().remove(),s.append(h).css("width","90px")),f.length!=0&&(f=[]),o=0;o<i.length;o++)i[o].id!=""&&(a=new ej.DataManager(n._currentJsonData),f.push(a.executeLocal((new ej.Query).where(n.model.fields.primaryKey,ej.FilterOperators.equal,parseInt(i[o].id)))));if(u&&!ej.isNullOrUndefined(r.target)){if(e={draggedElement:i,dragTarget:r.target,data:f,event:r.event},n._trigger("cardDragStart",e))return r.cancel=!0,t&&t.remove(),!1}else return!1;return!0},drag:function(s){var v=null,p=null,it=n.element.find(".e-draggedcard"),h,a,ft,k,y,w,rt,d,g,ut,b,tt,nt;return(o=!1,n._cardSelect=null,n.element.find(".e-kanbantooltip").hide(),it.addClass("e-left-rotatecard"),n._kbnMouseX=ej.isNullOrUndefined(s.event.clientX)?s.event.originalEvent.changedTouches[0].clientX:s.event.clientX,$(".e-kanban-context").length>0&&$(".e-kanban-context").css("visibility","hidden"),n._kTouchBar.hide(),!n._autoKbnSwipeRight&&n.element.hasClass("e-responsive")&&n.element.offset().left+n.element.width()-50<n._kbnMouseX&&(v=window.setInterval(function(){it.is(":hidden")?v&&(v=window.clearInterval(v)):n.element.offset().left+n.element.width()<n._kbnMouseX?v=window.clearInterval(v):n.element.offset().left+n.element.width()-50<n._kbnMouseX?n._kbnLeftSwipe():v&&(v=window.clearInterval(v))},1500),n._autoKbnSwipeRight=!0),!n._autoKbnSwipeLeft&&n.element.hasClass("e-responsive")&&n.element.offset().left+20>n._kbnMouseX&&(p=window.setInterval(function(){it.is(":hidden")?p&&(p=window.clearInterval(p)):n.element.offset().left+20>n._kbnMouseX?n._kbnRightSwipe():p&&(p=window.clearInterval(p))},1500),n._autoKbnSwipeLeft=!0),(n.model.allowScrolling||n.model.isResponsive)&&u._kanbanAutoScroll(s),$(s.target).closest(".dragClone").length>0&&(s.target=c,clearTimeout(l),l=setTimeout(function(){s.target=u._getCursorElement(s)},10)),$(s.target).hasClass("e-targetclone")||$(s.target).hasClass("e-rowcell")||$(r).remove(),h=$(s.target).closest(".e-kanbancard").length>0?$(s.target).closest(".e-kanbancard")[0]:s.target,ft=$(s.element).closest("td.e-rowcell").addClass("e-dragged"),ft.siblings().addClass("e-dropping"),e={draggedElement:i,data:f,dragTarget:h,event:s.event},c=a=$(h).closest("td.e-rowcell"),k=a.parents(".e-columnrow").find(".e-cardselection"),a&&a.hasClass("e-droppable")&&$(a).parent().has(s.element[0]).length>0&&(h!=s.element[0]||k.length>1)?(document.body.style.cursor="",$(r).parents(".e-rowcell").index()!=a.index()&&$(r).remove(),a.find(".e-kanbancard").removeClass("e-hover"),n.element.hasClass("e-responsive")&&(rt=$(h).parents(".e-rowcell"),!$(h).hasClass("e-kanbancard")&&$(h).parents(".e-kanbancard").length==0&&rt.length>0&&(h=rt,a=h.find(".e-cell-scrollcontent").children().eq(0))),y=a.children().last(),y.hasClass("e-shrinkheader")&&(y=y.prev()),$(h).hasClass("e-rowcell")&&(s.element[0]!=y[0]||k.length>1)&&!$(h).hasClass("e-shrink")?(y.length==0||a.children().length==0||y.offset().top+y.height()<$(t).offset().top)&&(w=$(h).height(),d=$(s.element[0]).height(),g=$(h).width(),n.element.hasClass("e-responsive")?(ut=a.find(".e-cell-scrollcontent"),ut.length>0?ut.children().append($(r).height(d).width(g-28)):a.append($(r).height(d).width(g-28))):a.append($(r).height(d).width(g-28)),w<$(h).height()&&(a.height(a.height()),n._tdHeightDiff=$(h).height()-w)):$(h).hasClass("e-rowcell")&&$(h).hasClass("e-shrink")?(nt=new ej.DataManager(n.model.columns).executeLocal((new ej.Query).where("key",ej.FilterOperators.equal,$(h).attr("ej-mappingkey"))),n.toggleColumn(nt[0].headerText),$(h).addClass("e-togglevisible")):($(h).hasClass("e-kanbancard")||$(h).hasClass("e-targetclone"))&&(b=$(h).parents(".e-rowcell"),w=b.height(),$(h).offset().top+$(h).height()/2>=s.event.pageY?$(h).prev()[0]!=s.element[0]||k.length>1?$(h).hasClass("e-targetclone")||(u._removeKanbanCursor(),$(r).insertBefore($(h)).height($(s.element[0]).height()).width($(h).width()).removeClass("e-targetappend")):u._changeKanbanCursor(h,t,s):$(h).next()[0]!=s.element[0]||k.length>1?(w=$(h).parents(".e-rowcell").height(),$(h).hasClass("e-targetclone")||(o=!0,u._removeKanbanCursor(),$(r).insertAfter($(h)).height($(s.element[0]).height()).width($(h).width()).addClass("e-targetappend"))):u._changeKanbanCursor(h,t,s),w<b.height()&&(b.height(b.height()),n._tdHeightDiff=b.height()-w))):(($(h).hasClass("e-swimlanerow")||$(h).parents(".e-swimlanerow").length>0)&&$(r).is(":visible")&&$(r).remove(),u._changeKanbanCursor(h,t,s)),tt=n.element.find(".e-togglevisible"),tt.length>0&&!$(h).hasClass("e-togglevisible")&&$(h).parents(".e-togglevisible").length==0&&(nt=new ej.DataManager(n.model.columns).executeLocal((new ej.Query).where("key",ej.FilterOperators.equal,tt.attr("ej-mappingkey"))),n.toggleColumn(nt[0].headerText),tt.removeClass("e-togglevisible")),n._trigger("cardDrag",e))?!1:!0},dragStop:function(r){n._cardSelect=null;r.dragData=f;r.dragEle=i;u._dragStop(r,t,o)},helper:function(u){return n.model.enableTouch&&!ej.isNullOrUndefined(n._cardSelect)&&n._cardSelect=="touch"?!1:(!ej.isNullOrUndefined(u.element)&&$(u.element).hasClass("e-draggable")&&(t=ej.buildTag("div.e-draggedcard"),t.addClass(n.model.cssClass),i=$(u.element).clone().addClass("dragClone"),$(t).css({width:u.element.width()}),t.append(i),$(t).find("div:first").removeClass("e-hover"),t.appendTo(n.element),r=ej.buildTag("div.e-targetclone"),$(r).css({width:u.element.width(),height:u.element.height()})),t)}})},n}(),n,t,i;window.ej.createObject("ej.KanbanFeatures.DragAndDrop",r,window);n=function(){function n(n){this.kanbanObj=null;this._dropDownManager=null;this._editForm=null;this.kanbanObj=n}return n.prototype._processEditing=function(){var n=this.kanbanObj,t=this._columnToSelect(),i=this,r;n.model.query._fromTable!=""&&t.from(n.model.query._fromTable);n._dataSource()instanceof ej.DataManager&&t.queries.length&&!n._dataManager.dataSource.offline?(r=n._dataSource().executeQuery(t),r.done(ej.proxy(function(n){i._dropDownManager=new ej.DataManager(n.result);i._addDialogEditingTemplate()}))):i._addDialogEditingTemplate()},n.prototype._renderDialog=function(){return ej.buildTag("div.e-dialog e-kanbandialog e-dialog-content e-shadow e-widget-content","",{display:"none"},{id:this.kanbanObj._id+"_dialogEdit"})},n.prototype._columnToSelect=function(){for(var i=[],t=this.kanbanObj,n=0;n<t.model.editSettings.editItems.length;n++)t.model.editSettings.editItems[n].editType=="dropdownedit"&&ej.isNullOrUndefined(t.model.editSettings.editItems[n].dataSource)&&i.push(t.model.editSettings.editItems[n].field);return i.length?(new ej.Query).select(i):new ej.Query},n.prototype.cancelEdit=function(){var n=this.kanbanObj,t;(n.model.editSettings.allowEditing||n.model.editSettings.allowAdding)&&(n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate"?$("#"+n._id+"_dialogEdit").ejDialog("close"):(n.model.editSettings.editMode=="externalform"||n.model.editSettings.editMode=="externalformtemplate")&&(n.model.editSettings.formPosition=="right"&&$(n.element).children().css("width","100%"),$("#"+n._id+"_externalEdit").css("display","none")),n.refreshTemplate(),t={requestType:"cancel"},n._processBindings(t));n.element.parents("body").removeClass("e-kbnwindow-modal")},n.prototype._renderExternalForm=function(){var n=this.kanbanObj,f=ej.buildTag("div","",{display:"none"},{id:n._id+"_externalEdit","class":"e-form-container"}),t=ej.buildTag("div","","",{id:n._id+"_eFormHeader","class":"e-form-titlebar"}),e=ej.buildTag("span","","",{"class":"e-form-title"}),i=ej.buildTag("div","","",{id:n._id+"_closebutton","class":"e-externalform-icon"}),o=ej.buildTag("span","","",{"class":"e-icon e-externaledit e-cancel"});i.append(o);t.append(e).append(i);var r=ej.buildTag("div","","",{id:n._id+"_eFormContent","class":"e-form-content"}),u=ej.buildTag("div","","",{id:n._id+"_externalForm","class":"e-externalform"}),s=ej.buildTag("div","","",{"class":"e-externalformedit"});return u.append(s),r.append(u),f.append(t).append(r)},n.prototype._maxZindex=function(){var n=1;return n=Math.max.apply(null,$.map($("body *"),function(n){if($(n).css("position")=="absolute")return parseInt($(n).css("z-index"))||1})),(n==undefined||n==null)&&(n=1),n},n.prototype.addCard=function(n,t){var i=this.kanbanObj,f,r,o,s,e,u;if(i.model.editSettings.allowAdding)if(r=i.model.fields.primaryKey,n&&t)o=i.model.query,s=o.clone(),$.type(i._currentJsonData[0][r])=="number"&&(n=parseInt(n)),f={data:t,requestType:"save",action:"add",primaryKeyValue:n},i._cAddedRecord=t,new ej.DataManager(i._currentJsonData).insert(t),i._saveArgs=f,i._updateGroup(f.primaryKeyValue,f.data),i.getContentTable().find("colgroup").first().replaceWith(i._getMetaColGroup()),ej.isNullOrUndefined(i.model.fields.swimlaneKey)||(o=o.group(i.model.fields.swimlaneKey),i.currentViewData=new ej.DataManager(i._currentJsonData).executeLocal(o).result),i._renderAllCard(),i._enableDragandScroll(),i._dataSource()instanceof ej.DataManager?i._dataSource().dataSource.json.push(t):i._dataSource(undefined,!0).splice(i._dataSource().length,0,t),i._cAddedRecord=null,i._renderLimit(),i._totalCount(),i._eventBindings(),o.queries=s.queries;else{for(e=i.model.editSettings.editItems,f={requestType:"add"},i._currentData={},i._isAddNewClick&&(i.model.fields.swimlaneKey&&(i._currentData[i.model.fields.swimlaneKey]=$(i._newCard).parent().prev(".e-swimlanerow").find(".e-slkey").text()),i.model.keyField&&(i._currentData[i.model.keyField]=i.model.columns[$(i._newCard).index()].key)),u=0;u<e.length;u++)i._currentData[e[u].field]=ej.isNullOrUndefined(e[u].defaultValue)?ej.isNullOrUndefined(i._currentData[e[u].field])?"":i._currentData[e[u].field]:e[u].defaultValue;i._currentData[r]=i._currentJsonData[i._currentJsonData.length-1][r];$.type(i._currentJsonData[0][r])=="string"&&(i._currentData[r]=parseInt(i._currentData[r]));i._currentData[r]=i._currentData[r]+1;$.type(i._currentJsonData[0][r])=="string"&&(i._currentData[r]=i._currentData[r].toString());f.data=i._currentData;i.element.find(".e-kanbandialog").removeAttr("data-id");i._processBindings(f)}},n.prototype.deleteCard=function(n){var i,t=this.kanbanObj,e,f,o,u,r,s=t.model.fields.primaryKey,t=this.kanbanObj,h;if(e=t.element.find("#"+n),o=new ej.DataManager(t._currentJsonData),u=new ej.Query,u=u.where(t.model.fields.primaryKey,ej.FilterOperators.equal,n),f=o.executeLocal(u),$.type(t._currentJsonData[0][s])=="number"&&(n=parseInt(n)),i={div:e,data:f[0],requestType:"delete",primaryKeyValue:n},t._trigger("actionBegin",i))return!0;t._cDeleteData=f;t._dataSource()instanceof ej.DataManager&&!t._dataManager.dataSource.offline&&t._dataManager.dataSource.json!==undefined||t._dataSource().adaptor instanceof ej.remoteSaveAdaptor?(r=t._dataManager.remove(t.model.fields.primaryKey,n),h=this,$.isFunction(r.promise)?(r.done(function(){t._processBindings(i);t._cDeleteData=null}),r.fail(function(n){i.error=n;t._trigger("actionFailure",i)})):t._processBindings(i)):t._processBindings(i);r!=undefined&&$.isFunction(r.promise)||(t._cDeleteData=null)},n.prototype.startEdit=function(n){var t=this.kanbanObj;if($.type(n)!="object"&&(n=t.element.find("#"+n)),t.model.editSettings.allowEditing&&n.hasClass("e-kanbancard")){var f,i,e=t.model.fields.primaryKey,r=n.attr("id"),s=n.hasClass("e-rowcell")?n.index():n.closest(".e-rowcell").index(),h=t.getIndexByRow(n.closest("tr")),o,u=new ej.Query;f=n.closest(".e-kanbancard");o=new ej.DataManager(t._currentJsonData);u=u.where(e,ej.FilterOperators.equal,n.attr("id"));t._currentData=o.executeLocal(u);!ej.isNullOrUndefined(t._cardEditClick)&&t._cardEditClick&&(t._dblArgs.data=t._currentData[0],t._trigger("cardDoubleClick",t._dblArgs));$.type(t._currentJsonData[0][e])=="number"&&(r=parseInt(r));i={target:n,rowIndex:h,data:t._currentData[0],columnIndex:s,cardIndex:f.index(),primaryKeyValue:r};t._trigger("beginEdit",i);i.requestType="beginedit";t._processBindings(i)}},n.prototype._refreshEditForm=function(){var n=this.kanbanObj,l,f,y,p,a,s,c,v,u,i,t,r,o,h,e;for(n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate"?(y=n.element.find("#"+n._id+"_dialogEdit_wrapper"),a=95,y.show(),s=$("#"+n._id+"_dialogEdit"),l=s.find("tr").find(".e-rowcell")):(n.model.editSettings.editMode=="externalform"||n.model.editSettings.editMode=="externalformtemplate")&&(p=n.element.find("#"+n._id+"_externalEdit"),a=133,p.show(),s=$("#"+n._id+"_externalForm"),l=s.find("div").find(".e-rowcell")),c=0;c<l.length;c++)n._tdsOffsetWidth[c]=l.get(c).offsetWidth;for((n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate")&&(f=ej.max(n._tdsOffsetWidth)*(a/100)),v=0;v<n.model.editSettings.editItems.length;v++)u=n.model.editSettings.editItems[v],i=s.find("#"+n._id+"_"+u.field),(n.model.editSettings.editMode=="externalform"||n.model.editSettings.editMode=="externalformtemplate")&&(f=ej.max(n._tdsOffsetWidth)*(a/100),$(i).parent().css("width",f+"px")),u.editType=="stringedit"&&i.width(f-4),o=u.editType=="textarea",h=n.model.editSettings.editMode=="externalform"||n.model.editSettings.editMode=="externalformtemplate",r=u.editParams,!ej.isNullOrUndefined(r)&&o?(ej.isNullOrUndefined(r.width)||(i.width(r.width),o&&h&&i.parent().width(r.width+8)),ej.isNullOrUndefined(r.height)||(i.height(r.height),o&&h&&i.parent().height(r.height+8))):o&&(n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate")?i.width(250).height(95):o&&h&&n.model.editSettings.formPosition=="bottom"?(i.height(95),$(i).css({width:"400px"}),$(i).parent().css({width:"500px"})):o&&h&&n.model.editSettings.formPosition=="right"&&(i.css({width:f-8}),i.height(150),$(i).parent().css("width",f+8)),u.editType=="rteedit"?(t={width:"450px",height:"260px",minHeight:"240px",locale:n.model.locale,enableRTL:n.model.enableRTL},r=u.editParams,t.toolsList=["style","links"],t.tools={style:["bold","italic","underline"],casing:["upperCase","lowerCase"],links:["createLink"]},ej.isNullOrUndefined(r)||$.extend(t,r),s.find("#"+n._id+"_"+u.field).ejRTE(t)):u.editType=="dropdownedit"?(t={width:f,enableIncrementalSearch:!0,enableRTL:n.model.enableRTL},e=i.val(),r=u.editParams,i.hasClass("e-disable")&&(t.enabled=!1),ej.isNullOrUndefined(r)||$.extend(t,r),i.ejDropDownList(t),i.ejDropDownList("setSelectedValue",i.val())):u.editType=="numericedit"?(t={width:f},e=i.val(),r=u.editParams,t.cssClass=n.model.cssClass,t.showSpinButton=!0,t.enableRTL=n.model.enableRTL,t.locale=n.model.locale,e.length&&(t.value=parseFloat(e)),i.hasClass("e-disable")&&(t.enabled=!1),ej.isNullOrUndefined(r)||$.extend(t,r),i.ejNumericTextbox(t)):u.editType=="datepicker"?(t={width:f},e=i.val(),r=u.editParams,t.cssClass=n.model.cssClass,t.displayDefaultDate=!0,t.enableRTL=n.model.enableRTL,t.locale=n.model.locale,e.length&&(t.value=new Date(e)),i.hasClass("e-disable")&&(t.enabled=!1),ej.isNullOrUndefined(r)||$.extend(t,r),i.ejDatePicker(t)):u.editType=="datetimepicker"&&(t={width:f,cssClass:n.model.cssClass,locale:n.model.locale,showPopupButton:!1,enableRTL:n.model.enableRTL},e=i.val(),r=u.editParams,e.length&&(t.value=new Date(e)),i.hasClass("e-disable")&&(t.enabled=!1),ej.isNullOrUndefined(r)||$.extend(t,r),i.ejDateTimePicker(t)),u.editType!="textarea"&&$(i.outerWidth(f)).height(28),ej.browserInfo().name=="msie"&&parseInt(ej.browserInfo().version,10)==8&&i.css("line-height","26px");h&&(n._editForm=n.element.find(".e-externalform"));(n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate")&&(n._editForm=n.element.find(".kanbanform"),y.hide());this._formFocus()},n.prototype._setKanbanDdlValue=function(n){for(var e,i,r=n.find("select.e-field"),u,f=n.find("input.e-field.e-dropdownlist"),t=0;t<r.length;t++)e={},e[this.kanbanObj._id+"drpDownTempl"]="{{:"+r[t].name.replace(/[^a-z0-9\s]/gi,"")+"}}",$.templates(e),u=$.render[this.kanbanObj._id+"drpDownTempl"](this.kanbanObj._currentData),n.find("select").eq(t).val(u).attr("selected","selected"),r.eq(t).val(u);for(i=0;i<f.length;i++)f.eq(i).val(ej.getObject(f.eq(i).attr("name"),this.kanbanObj._currentData[0]))},n.prototype._editAdd=function(n){var f,t=this.kanbanObj,p=t.element.find(".e-kanbandialog"),e=$(n.target),a,h=new ej.Query,c=t.model.fields.primaryKey,o=document.createElement("div"),l=$(o),i,r,u,v,s,y;n.requestType=="add"?l.addClass("e-addedrow"):(t._currentData={},e.hasClass("e-kanbancard")?i=e.attr("id"):e.parents(".e-kanbancard").length>0&&(i=e.parents(".e-kanbancard").attr("id")),$.type(t._currentJsonData[0][c])=="number"&&(i=parseInt(i)),a=new ej.DataManager(t._currentJsonData),h=h.where(c,ej.FilterOperators.equal,i),t._currentData=a.executeLocal(h),l.addClass("e-editedrow"));o.innerHTML=$.render[t._id+"_dialogEditingTemplate"](t._currentData);this._setKanbanDdlValue(l);n.requestType=="add"?ej.isNullOrUndefined(t.model.fields.title)||$.isEmptyObject(t._newData)?u=t.localizedLabels.AddFormTitle:(r=t.model.fields.title,u=t.localizedLabels.EditFormTitle+t._newData[r]):(r=c,ej.isNullOrUndefined(t.model.fields.title)||(r=t.model.fields.title),u=t.localizedLabels.EditFormTitle+t._currentData[0][r]);t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate"?(f=$("#"+t._id+"_dialogEdit"),f.html($(o)),v={cssClass:t.model.cssClass,enableRTL:t.model.enableRTL,width:"auto",content:"#"+t._id,close:$.proxy(this.cancelEdit,this),open:$.proxy(this._onKbnDialogOpen,this),enableModal:!0,enableResize:!1,title:u},f.ejDialog(v),f.ejDialog("open"),p.attr("data-id",i),s=t.element.find("#"+t._id+"_dialogEdit_wrapper"),s.css("left","0"),y=self!=parent?ej.browserInfo().name=="chrome"?$(window).scrollTop():-$(window.frameElement).offset().top:$(window).scrollTop(),s.css("top",y),s.hide()):(t.model.editSettings.editMode=="externalform"||t.model.editSettings.editMode=="externalformtemplate")&&($("#"+t._id+"_externalEdit").css("display","block").css("z-index",this._maxZindex()+1),$("#"+t._id+"_externalForm").find(".e-externalformedit").html($(o)),$("#"+t._id+"_eFormHeader").find(".e-form-title").text(u),$("#"+t._id+"_externalForm").attr("data-id",i),this._externalFormPosition());$.isFunction($.validator)&&(this.initValidator(),this.setValidation())},n.prototype._onKbnDialogOpen=function(){var t=this.kanbanObj,n=t.element.find("#"+t._id+"_dialogEdit_wrapper"),i,r,e,u,f,o,s;n.css("position","absolute");e=$(t.element)[0];u=e.offsetTop;f=e.offsetLeft;o=e.offsetWidth;s=e.offsetHeight;window.pageYOffset>u?(i=u+s>window.pageYOffset+window.innerHeight?Math.max(0,(window.innerHeight-n.outerHeight())/2):Math.max(0,(u+s-window.pageYOffset-n.outerHeight())/2),i=window.pageYOffset+i):(i=u+s>window.pageYOffset+window.innerHeight?Math.max(0,(window.innerHeight-(u-window.pageYOffset)-n.outerHeight())/2):Math.max(0,(s-n.outerHeight())/2),i=u+i);window.pageXOffset>f?(r=f+o>window.pageXOffset+window.innerWidth?Math.max(0,(window.innerWidth-n.outerWidth())/2):Math.max(0,(f+o-window.pageXOffset-n.outerWidth())/2),r=window.pageXOffset+r):(r=f+o>window.pageXOffset+window.innerWidth?Math.max(0,(window.innerWidth-(f-window.pageXOffset)-n.outerWidth())/2):Math.max(0,(o-n.outerWidth())/2),r=f+r);n.css("top",i+"px");n.css("left",r+"px");n.show();this._formFocus();t._editForm.find(".e-rte").length>0&&t.element.find("#"+t._id+"_dialogEdit").data("ejDialog")._resetScroller();t.element.hasClass("e-responsive")&&this._setAdaptEditWindowHeight()},n.prototype._setAdaptEditWindowHeight=function(){var r=this.kanbanObj,n,t,i;n=r.element.find(".e-kanbandialog");t=n.parents(".e-dialog-scroller");i;n.parents(".e-dialog").css({top:"0",left:"0"}).addClass("e-kbnadapt-editdlg");n.parents("body").addClass("e-kbnwindow-modal");i=t.prev(".e-titlebar");t.ejScroller({height:$(window).height()-i.outerHeight()});t.data("ejScroller").refresh();n.css("height",t.height())},n.prototype._externalFormPosition=function(){var n=this.kanbanObj,t=$(n.element).offset(),r=$(n.element).width(),u=$(n.element).height(),i=$("#"+n._id+"_externalEdit");switch(n.model.editSettings.formPosition){case"right":$(i).find(".e-close").removeClass("e-bottomleft").addClass("e-topright");$("#"+n._id+"_eFormContent").height("auto");n.model.allowScrolling||n.model.isResponsive?($(i).css({left:t.left+r+2+"px",top:t.top+"px",position:"absolute",width:"25%"}),$(".e-externalrow").css("padding-right","0px")):($(n.element).css({width:"100%"}),$(n.element).children().not(".e-form-container").css("width","73%"),$(i).css({left:t.left+$(n.element).children().width()+2+"px",top:t.top+"px",position:"absolute",width:"25%"}));break;case"bottom":$(i).find(".e-close").removeClass("e-topright").addClass("e-bottomleft");$(i).css({left:t.left+"px",top:t.top+u+1+"px"});$("#"+n._id+"_eFormContent").width("100%");(n.element.find(".e-scrollbar").hasClass("e-hscrollbar")||n.model.isResponsive)&&$("#"+n._id+"_externalEdit").css({border:"none","border-top":"1px solid"})}},n.prototype._formFocus=function(){for(var n,i=$(this.kanbanObj._editForm).find("input,select,div.e-field,textarea.e-field"),r=!1,t=0;t<i.length;t++)n=i.eq(t),(n.is(":disabled")||r||n.is(":hidden")&&typeof(n.data("ejDropDownList")||n.data("ejNumericTextbox"))!="object")&&!n.hasClass("e-rte")||(this._focusKbnDialogEle(n),r=!0)},n.prototype._focusKbnDialogEle=function(n){if(n.length)if((n[0].tagName.toLowerCase()!="select"||n.hasClass("e-field e-dropdownlist"))&&n[0].tagName.toLowerCase()!="input"&&(n[0].tagName.toLowerCase()!="textarea"||n.hasClass("e-numerictextbox")))n.hasClass("e-field e-dropdownlist")?n.closest(".e-ddl").focus():n.hasClass("e-numerictextbox")?n.siblings("input:visible").first().select().focus():n.find("input:visible,select").first().select().focus();else if(n.hasClass("e-rte")){var t=n.data("ejRTE");$(t).focus();t.selectAll()}else n.focus().select(),n[0].focus()},n.prototype.endEdit=function(){var n=this.kanbanObj,u,c,t,l,a,i,f,r,e,o,s,v,h;if(n.model.editSettings.allowEditing||n.model.editSettings.allowAdding){if(u=n.model.fields.primaryKey,c=n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate"?n.element.find(".e-kanbandialog"):n.element.find(".e-externalform"),f={},!this.editFormValidate())return!0;for(t=document.getElementById(n._id+"EditForm"),l=$(t),a=l.closest("div"),ej.isNullOrUndefined(c.attr("data-id"))?(i=n._currentJsonData[n._currentJsonData.length-1][u],$.type(n._currentJsonData[0][u])=="string"&&(i=parseInt(i)),i=i+1,$.type(n._currentJsonData[0][u])=="string"&&(i=i.toString()),f[u]=i):(i=c.attr("data-id"),$.type(n._currentJsonData[0][u])=="number"&&(i=parseInt(i))),r=0;r<t.length;r++)if(!a.hasClass("e-addedrow")||!$(t[r]).hasClass("e-identity")){if(e=t[r].name,o=$(t[r]),o.hasClass("e-dropdownlist e-input")&&o.attr("id").indexOf("_input")!=-1||o.hasClass("e-dropdownlist")&&o.is(":hidden")){!ej.isNullOrUndefined(l[1])&&ej.isNullOrUndefined(t[r+1])&&(t=l[1],r=-1);continue}e!=undefined&&(e==""&&(t[r].id.indexOf("Save")!=-1||t[r].id.indexOf("Cancel")!=-1?e="":(e=t[r].id.replace(n._id+"_",""),e=e.replace("_hidden",""))),e!=""&&f[e]==null?(s=t[r].value,$(t[r]).hasClass("e-datepicker")?s=o.ejDatePicker("model.value"):$(t[r]).hasClass("e-datetimepicker")?s=o.ejDateTimePicker("model.value"):o.is(".e-numerictextbox")?(s=o.ejNumericTextbox("getValue"),s=s||""):o.data("ejDropDownList")&&(s=o.ejDropDownList("getSelectedValue")),v=t[r].type!="checkbox"?s:$(t[r]).is(":checked"),f[e]=v):e==u&&(f[u]=t[r].value))}if(n._editForm=n.element.find(".kanbanform"),f[u]=isNaN(f[u])?i:$.type(n._currentJsonData[0][u])=="number"?i=parseInt(f[u]):i=f[u],h={data:f,requestType:"save"},n._trigger("actionBegin",h))return!0;$(n._editForm).hasClass("e-formdestroy")?n.refresh(!0):ej.isNullOrUndefined(c.attr("data-id"))?(h.action="add",h.primaryKeyValue=i,n._cAddedRecord=f):(h.action="edit",h.primaryKeyValue=i,n._cModifiedData=f);h.primaryKey=u;n._saveArgs=h;n.updateCard(i,f);n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate"?(n.element.find(".e-kanbandialog").removeAttr("data-id"),$("#"+n._id+"_dialogEdit").ejDialog("close")):(n.model.editSettings.editMode=="externalform"||n.model.editSettings.editMode=="externalformtemplate")&&(n.model.editSettings.formPosition=="right"&&$(n.element).children().css("width","100%"),c.removeAttr("data-id"),$("#"+n._id+"_externalEdit").css("display","none"))}},n.prototype.initValidator=function(){for(var n=this.kanbanObj,i=n.element.find(".kanbanform"),t=0;t<i.length;t++)i.eq(t).validate({ignore:".e-hide,:hidden",errorClass:"e-field-validation-error",errorElement:"div",wrapper:"div",errorPlacement:function(t,i){i.is(":hidden")&&(i=i.siblings("input:visible"));var u=i.closest("td"),r=$(t).addClass("e-error"),f=ej.buildTag("div.e-errortail e-toparrow");n.model.editSettings.editMode!="dialog"&&u.find(".e-error").remove();i.parent().hasClass("e-in-wrap")?r.insertAfter(i.closest(".e-widget")):r.insertAfter(i);r.prepend(f);n.model.enableRTL?n.model.editSettings.editMode!="dialog"&&r.offset({left:i.offset().left,top:i.offset().top+i.height()}):n.model.editSettings.editMode!="dialog"&&r.offset({left:i.offset().left,top:i.offset().top+i.height()});r.fadeIn("slow")}})},n.prototype.setValidation=function(){for(var t=this.kanbanObj,n=0;n<t.model.editSettings.editItems.length;n++)ej.isNullOrUndefined(t.model.editSettings.editItems[n].validationRules)||this.setValidationToField(t.model.editSettings.editItems[n].field,t.model.editSettings.editItems[n].validationRules)},n.prototype.setValidationToField=function(n,t){var i=n,u,r,f=this.kanbanObj,e,o;ej.isNullOrUndefined(n)||(i=i.replace(/[^a-z0-9\s_]/gi,""));e=f.element.find(".kanbanform");u=e.find("#"+f._id+"_"+i).length>0?e.find("#"+f._id+"_"+i):e.find("#"+i);u.attr("name")||u.attr("name",n);u.rules("add",t);o=f.element.find(".kanbanform").validate();o.settings.messages[n]=o.settings.messages[n]||{};ej.isNullOrUndefined(t.required)||(r=ej.isNullOrUndefined(t.messages&&t.messages.required)?$.validator.messages.required:t.messages.required,r.indexOf("This field")==0&&(r=r.replace("This field",n)),o.settings.messages[n].required=r)},n.prototype.editFormValidate=function(){return $.isFunction($.validator)?this.kanbanObj.element.find(".kanbanform").validate().form():!0},n.prototype._addDialogEditingTemplate=function(){var n=this.kanbanObj,s=ej.buildTag("div"),u,y,f,p,r,w,b,e,k,h,c,i,t,l,tt,d,it,g,a,v,rt,o,nt;if(n.model.columns.length!=0){if(u=ej.buildTag("form.kanbanform","",{},{id:n._id+"EditForm"}),y=ej.buildTag("table","",{},{cellspacing:"14px"}),ej.isNullOrUndefined(n.model.editSettings.editMode)&&(n.model.editSettings.editMode="dialog"),n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="externalform")for(c=0;c<n.model.editSettings.editItems.length;c++){i=n.model.editSettings.editItems[c];t=i.field;n.model.editSettings.editMode=="dialog"?(k="tr",h="td"):(k="div.e-externalrow",h="div");f=ej.buildTag(k);p=ej.buildTag(h,"",{}).addClass("e-label");r=ej.buildTag(h,"",{"text-align":"left"}).addClass("e-rowcell");f.append(p.get(0)).append(r.get(0));p.append("<label style='text-transform:capitalize' for='"+t+"'>"+t+"<\/label>");n.model.editSettings.editMode=="externalform"&&n.model.editSettings.formPosition=="right"&&f.css({width:"300px","padding-right":"0px"});ej.isNullOrUndefined(i.editType)&&(i.editType="stringedit");ej.isNullOrUndefined(t)||(t=t.replace(/[^a-z0-9\s_]/gi,""));switch(i.editType){case"stringedit":n.model.fields.primaryKey==t?r.html(ej.buildTag("input.e-field e-ejinputtext e-disable","",{},{value:"{{html:#data['"+t+"']}}",id:n._id+"_"+t,name:t,disabled:"disabled"})):r.html(ej.buildTag("input.e-field e-ejinputtext","",{},{value:"{{html:#data['"+t+"']}}",id:n._id+"_"+t,name:t}));break;case"numericedit":r.html(ej.buildTag("input.e-numerictextbox e-field","",{},{type:"text",value:"{{:#data['"+t+"']}}",id:n._id+"_"+t,name:t}));break;case"dropdownedit":if(l=[],ej.isNullOrUndefined(i.dataSource))for(v=(new ej.Query).where(ej.Predicate.or(n.keyPredicates)).select(i.field),ej.isNullOrUndefined(this._dropDownManager)||!n._dataManager.dataSource.offline&&n._dataManager.dataSource.json.length?g=n._dataManager.executeLocal(v):(n._dataManager.adaptor instanceof ej.JsonAdaptor&&i.field.indexOf(".")!=-1&&(rt=i.field.replace(/\./g,ej.pvt.consts.complexPropertyMerge),v=(new ej.Query).select(rt)),g=this._dropDownManager.executeLocal(v)),a=ej.dataUtil.mergeSort(ej.dataUtil.distinct(g)),o=0;o<a.length;o++)l.push({text:a[o],value:a[o]});else l=i.dataSource;d=ej.buildTag("select");it=ej.buildTag("option","{{:text}}",{},{value:"{{html:#data['value']}}"});d.append(it);tt=$.templates(d.html());r.get(0).innerHTML=ej.isNullOrUndefined(i.editParams)||ej.isNullOrUndefined(i.dataSource)?["<select>",tt.render(l),"<\/select>"].join(""):"<input>";r.find("select,input").prop({id:n._id+"_"+t,name:t}).addClass("e-field e-dropdownlist");break;case"rteedit":r.html(ej.buildTag("textarea.e-field e-rte","{{html:#data['"+t+"']}}",{},{id:n._id+"_"+t,name:t}));break;case"textarea":r.html(ej.buildTag("textarea.e-field e-kanbantextarea e-ejinputtext","{{html:#data['"+t+"']}}",{},{id:n._id+"_"+t,name:t}));break;case"datepicker":case"datetimepicker":r.html(ej.buildTag("input.e-"+i.editType+" e-field","",{},{type:"text",value:"{{:#data['"+t+"']}}",id:n._id+"_"+t,name:t}))}n.model.editSettings.editMode=="dialog"?(u.append(y),y.append(f)):u.append(f);u.appendTo(s)}else n.model.editSettings.editMode=="dialogtemplate"&&n.model.editSettings.dialogTemplate!=null&&(nt=n.model.editSettings.dialogTemplate),n.model.editSettings.editMode=="externalformtemplate"&&n.model.editSettings.externalFormTemplate!=null&&(nt=n.model.editSettings.externalFormTemplate),u.html($(nt).html()),u.appendTo(s);w=ej.buildTag("input.e-save","",{},{type:"button",id:n._id+"_Save"});w.ejButton({text:n.localizedLabels.SaveButton});b=n.model.editSettings.formPosition!="right"?ej.buildTag("input.e-cancel","",{},{type:"button",id:n._id+"_Cancel"}):ej.buildTag("input.e-cancel","",{},{type:"button",id:n._id+"_Cancel"});b.ejButton({text:n.localizedLabels.CancelButton});e=n.model.editSettings.editMode!="dialog"&&n.model.editSettings.editMode!="dialogtemplate"?ej.buildTag("div","","",{"class":"e-editform-btn"}):ej.buildTag("div#"+n._id+"_EditBtnDiv","",{},{"class":"e-kanban-editdiv"});e.append(w);e.append(b);n.model.editSettings.editMode!="dialog"&&n.model.editSettings.editMode!="dialogtemplate"?e.appendTo(s):u.append(e);$.templates(n._id+"_dialogEditingTemplate",s.html())}},n}();window.ej.createObject("ej.KanbanFeatures.Edit",n,window);t=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};i=function(n){function i(t,i){return n.call(this),this.element=null,this.PluginName="ejKanban",this.id="null",this.validTags=["div"],this.observables=["dataSource"],this._tags=[{tag:"columns",attr:["headerTemplate","headerText","key","isCollapsed","showAddButton","visible","constraints.type","constraints.min","constraints.max"]},{tag:"stackedHeaderRows",attr:[[{tag:"stackedHeaderColumns",attr:["headerText","column"]}]]},{tag:"contextMenuSettings",attr:["customMenuItems","menuItems","disableDefaultItems"]},{tag:"filterSettings",attr:["text","query","description"]},{tag:"editSettings.editItems",attr:["field","editType","validationRules","editParams","defaultValue"]}],this.localizedLabels=null,this.currentViewData=null,this.keyConfigs={focus:"e",insertCard:"45",deleteCard:"46",editCard:"113",saveRequest:"13",cancelRequest:"27",firstCardSelection:"36",lastCardSelection:"35",upArrow:"38",downArrow:"40",rightArrow:"39",leftArrow:"37",swimlaneExpandAll:"ctrl+40",swimlaneCollapseAll:"ctrl+38",selectedSwimlaneExpand:"alt+40",selectedSwimlaneCollapse:"alt+38",selectedColumnCollapse:"ctrl+37",selectedColumnExpand:"ctrl+39",multiSelectionByUpArrow:"shift+38",multiSelectionByDownArrow:"shift+40",multiSelectionByLeftArrow:"shift+37",multiSelectionByRightArrow:"shift+39"},this.dataTypes={dataSource:"data",query:"data",columns:"array",stackedHeaderRows:"array",contextMenuSettings:{disableDefaultItems:"array",menuItems:"array",customMenuItems:"array"},filterSettings:"array",editSettings:{editMode:"enum",editItems:"array"},searchSettings:{fields:"array"}},this.defaults={dataSource:null,keyField:null,keySettings:null,allowTitle:!1,cssClass:"",allowSelection:!0,allowSearching:!1,allowToggleColumn:!1,enableTotalCount:!1,enableTouch:!0,selectionType:"single",allowKeyboardNavigation:!1,allowDragAndDrop:!0,allowHover:!0,allowScrolling:!1,allowPrinting:!1,enableRTL:!1,stackedHeaderRows:[],filterSettings:[],scrollSettings:{width:"auto",height:0,allowFreezeSwimlane:!1},swimlaneSettings:{showCount:!0},fields:{content:null,tag:null,color:null,imageUrl:null,swimlaneKey:null,primaryKey:null,priority:null},cardSettings:{colorMapping:{},template:null},columns:[],contextMenuSettings:{enable:!1,menuItems:[{menuItem:"Add Card"},{menuItem:"Edit Card"},{menuItem:"Delete Card"},{menuItem:"Top of Row"},{menuItem:"Bottom of Row"},{menuItem:"Move Up"},{menuItem:"Move Down"},{menuItem:"Move Left"},{menuItem:"Move Right"},{menuItem:"Move to Swimlane"},{menuItem:"Hide Column"},{menuItem:"Visible Columns"}],customMenuItems:[]},editSettings:{editItems:[],allowEditing:!1,allowAdding:!1,dialogTemplate:null,externalFormTemplate:null,formPosition:"bottom"},searchSettings:{fields:[],key:"",operator:"contains",ignoreCase:!0},tooltipSettings:{enable:!1,template:null},minWidth:0,isResponsive:!1,locale:"en-US",query:null,create:null,actionBegin:null,actionComplete:null,actionFailure:null,load:null,destroy:null,beginEdit:null,endEdit:null,endAdd:null,endDelete:null,beforeCardSelect:null,cardSelect:null,toolbarClick:null,cardDoubleClick:null,cardDragStart:null,cardDrag:null,cardDragStop:null,cardDrop:null,contextClick:null,contextOpen:null,cardClick:null,beforePrint:null,cellClick:null,headerClick:null,dataBound:null,queryCellInfo:null},this._dataSource=ej.util.valueFunction("dataSource"),this._rootCSS="e-kanban",this._requiresID=!0,this._id=null,this.KanbanDragAndDrop=null,this.KanbanEdit=null,this._currentJsonData=null,this._kanbanRows=null,this._columnRows=null,this._swimlaneRows=null,this._filterToolBar=null,this._filteredRecordsCount=0,this._filteredRecords=null,this._contexttarget=null,this._editForm=null,this._newData=null,this._isAddNew=!1,this._isRemoteSaveAdaptor=!1,this._queryPromise=null,this._kanbanWidth=null,this.keyPredicates=null,this._cloneQuery=null,this._isLocalData=!0,this._previousRowCellIndex=[],this.selectedRowCellIndexes=[],this._bulkUpdateData=[],this._kbnFilterObject=[],this._kbnAdaptFilterObject=[],this._kbnFilterCollection=[],this._kbnAdaptDdlData=[],this._kbnAdaptDdlIndex=0,this._kbnSwipeWidth=0,this._kbnSwipeCount=0,this._searchTout=null,this._cardSelect=null,this._kbnMouseX=null,this._kbnAutoFilterCheck=!1,this._autoKbnSwipeLeft=!1,this._autoKbnSwipeRight=!1,this._kbnTransitionEnd=!0,this._conmenu=null,this._rowIndexesColl=[],this.templates={},this.initialRender=!1,this._columnsWidthCollection=[],this._slTemplate="",this._cardTemplate="",this._tdsOffsetWidth=[],this._scrollObject=null,this._templateRefresh=!1,this._action="",this._hiddenColumns=[],this._visibleColumns=[],this._filterCollection=[],this.collapsedColumns=null,this._expandedColumns=null,this._headerColumnNames=null,this._isWatermark=null,this._searchInput=null,this._hiddenSpan=null,this._currentRowCellIndex=[],this._recordsCount=0,this._selectedCards=[],this._selectedCardData=[],this._tableBEle=null,this._saveArgs=null,this._cModifiedData=null,this._dropped=null,this._cAddedRecord=null,this._cDeleteData=null,this._isAddNewClick=!1,this._currentData=null,this._newCard=null,this._cardEditClick=null,this._collapsedCards=[],this._dblArgs=null,this._freezeSwimlaneRow={},this._freezeScrollTop=0,this._freezeSlOrder=0,this._originalWidth=null,this._originalScrollWidth=0,this._collapsedColumns=[],this._enableMultiTouch=!1,this._enableSwimlaneCount=!0,this._kTouchBar=null,this._contextSwimlane=null,this._initialData=null,this._searchBar=null,this._originalScrollHeight=null,this._dataManager=null,this._failBulkData=[],this._priorityCollection=[],t&&(this._id=t[0].id,t.jquery||(t=$("#"+t)),t.length)?$(t).ejKanban(i).data(this.PluginName):void 0}return t(i,n),i.prototype.getHeaderTable=function(){return this.headerTable},i.prototype.setHeaderTable=function(n){this.headerTable=n},i.prototype.getColumnByHeaderText=function(n){for(var i=this.model.columns,t=0;t<i.length;t++)if(i[t].headerText==n)break;return t==i.length?null:i[t]},i.prototype._destroy=function(){var i,n,r,t;if(this.element.off(),this.element.find(".e-kanbanheader").find(".e-headercontent").add(this.getContent().find(".e-content")).unbind("scroll"),ej.isNullOrUndefined(this._filterToolBar)||this._filterToolBar.ejToolbar("destroy"),!ej.isNullOrUndefined(this._editForm)){for(i=this._editForm.find(".e-field"),t=0;t<i.length;t++)n=$(i[t]),n.hasClass("e-ejinputtext")&&this.element.find(".e-ejinputtext").remove(),n.hasClass("e-kanbantextarea")&&this.element.find(".e-kanbantextarea").remove(),n.hasClass("e-dropdownlist")&&n.ejDropDownList("destroy"),n.hasClass("e-numerictextbox")&&n.ejNumericTextbox("destroy"),r=n.parent("div").find("textarea.e-rte"),r.length&&(r.ejRTE("destroy"),n.parent().find("textarea").remove());$("#"+this._id+"_dialogEdit").ejDialog("destroy")}this.element.ejWaitingPopup("destroy");this.model.contextMenuSettings.enable&&($("#"+this._id+"_Context").ejMenu("destroy"),$("#"+this._id+"_Context").remove());this.element.children().remove()},i.prototype._kbnTouchClick=function(n){this.model.selectionType=="multiple"&&this._kTouchBar.is(":visible")&&!$(n.target).hasClass("e-cardselection")&&$(n.target).parents(".e-cardselection").length<=0&&!$(n.target).hasClass("e-cardtouch")&&$(n.target).parents(".e-cardtouch").length<=0&&!this._kTouchBar.find(".e-cardtouch").hasClass("e-spanclicked")&&this._kTouchBar.hide();n.type=="touchstart"&&(this._cardSelect="touch")},i.prototype._kbnHoldHandler=function(){this.model.enableTouch&&(this._cardSelect="hold")},i.prototype.showColumns=function(n){var t,i="_visibleColumns";t=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]);this._showExpandColumns(t,n,"_hiddenColumns",i);this._showhide(this[i],"show");this._renderLimit();this._totalCount();this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader()},i.prototype._showhide=function(n,t){var i,p=0,h,f=this.model.columns,e,r,s,y,o;h=t==="show"?"_visibleColumns":"_hiddenColumns";var w=this.getHeaderTable().find("thead"),c=w.find("tr").not(".e-stackedHeaderRow").find(".e-headercell"),l=this.getHeaderTable().find("colgroup").find("col"),a,v=this.getContentTable().find("colgroup").find("col"),u=this._columnRows;for(i=0;i<f.length;i++)$.inArray(f[i].headerText,this[h])!=-1&&(f[i].visible=t==="show"?!0:!1,p++),a=this.getColumnByHeaderText(n[i]),e=$.inArray(a,this.model.columns),e!=-1&&(t=="show"?(c.eq(e).removeClass("e-hide"),l.eq(e).css("display","")):(c.eq(e).addClass("e-hide"),l.eq(e).css("display","none")));for(i=0;i<f.length;i++)for(r=0;r<u.length;r++)ej.isNullOrUndefined(this.model.fields.swimlaneKey)||($(u[r]).is(":visible")?u.eq(r).prev().find(".e-rowcell").attr("colspan",this.getVisibleColumnNames().length):(u.eq(r).prev().prev(".e-swimlanerow").find(".e-rowcell").attr("colspan",this.getVisibleColumnNames().length),f[i].visible?u.eq(r).prev(".e-collapsedrow").find("td.e-rowcell").eq(i).removeClass("e-hide"):u.eq(r).prev(".e-collapsedrow").find("td.e-rowcell").eq(i).addClass("e-hide"))),s=u.eq(r).find("td.e-rowcell[ej-mappingkey='"+this.model.columns[i].key+"']"),f[i].visible?(s.removeClass("e-hide"),v.eq(i).removeClass("e-hide")):(s.addClass("e-hide"),v.eq(i).addClass("e-hide"));for(y=this.element.find(".e-kanbanheader"),this._columnsWidthCollection=[],o=0;o<this.model.columns.length;o++)ej.isNullOrUndefined(this.model.columns[o].width)||this._columnsWidthCollection.push(this.model.columns[o].width);this.element[0].replaceChild(this._renderHeader()[0],y[0]);this.getContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup());this._setWidthToColumns();this._refreshScroller({requestType:"refresh"})},i.prototype.searchCards=function(n){var i,t=$("#"+this._id+"_toolbarItems_search");t.find("input").val()!=n&&t.find("input").val(n);i={requestType:"search",keyValue:n};(n!=""||this.model.searchSettings.key!="")&&(this.model.searchSettings.key=n,t.find(".e-searchfind").length>0&&(this._initialData=this._currentJsonData),this._processBindings(i))},i.prototype.clearSearch=function(){this.element.find(".e-kanbantoolbar #"+this._id+"_toolbarItems_search").val("");this.searchCards("");$.extend(this.model.searchSettings,this.defaults.searchSettings)},i.prototype._onToolbarKeypress=function(n){var t=this.element,i=t.ejKanban("instance");t.hasClass("e-responsive")&&($(this.itemsContainer).parent().children().not(".e-searchbar").hide(),this._kbnTimeoutSearch(t,n))},i.prototype._kbnTimeoutSearch=function(n,t){var i=n.ejKanban("instance"),r;r=t.currentTarget;i._searchTout&&(i._searchTout=window.clearInterval(i._searchTout));i._searchTout=window.setInterval(function(){$(".e-kanbanwaitingpopup").removeClass("e-kanbanwaitingpopup").addClass("e-kbnsearchwaitingpopup");n.data("ejWaitingPopup").show();$(".e-kbnsearchwaitingpopup").css({top:"1px",left:"1px"});var u=setTimeout(function(){var f=$(r).find("input").val(),e,o;ej.isNullOrUndefined(f)&&(f=$(r).val());e={itemName:r.title,itemId:r.id,target:r,currentTarget:r,itemIndex:$(r).index(),toolbarData:t,itemText:f};i._trigger("toolbarClick",e);i.searchCards(f);$(".e-kbnsearchwaitingpopup").addClass("e-kanbanwaitingpopup").removeClass("e-kbnsearchwaitingpopup").css({top:"0px",left:"0px"});ej.isNullOrUndefined(i.model.fields.swimlaneKey)||(o=(new ej.Query).where(ej.Predicate.or(i.keyPredicates)).select(i.model.fields.swimlaneKey),i._kbnAdaptDdlData=new ej.DataManager(i._currentJsonData).executeLocal(o),i._kbnAdaptDdlData=ej.dataUtil.mergeSort(ej.dataUtil.distinct(i._kbnAdaptDdlData)),i._addSwimlaneName());n.data("ejWaitingPopup").hide();clearTimeout(u)},300);i._searchTout=window.clearInterval(i._searchTout)},1e3)},i.prototype._onToolbarClick=function(n){var h=$(this.itemsContainer).closest(".e-kanban"),t=h.data("ejKanban"),i=n.currentTarget,r=n.target,o,u,s,f,e;if((r.tagName=="INPUT"&&$(r).parent().next().hasClass("e-cancel")&&$(r).val().length==0&&(this.clearSearch(),e=this._searchBar.find(".e-toolbaricons"),e.removeClass("e-cancel").addClass("e-searchfind")),this.element.hasClass("e-responsive")&&($(this.itemsContainer).parent().children().not(".e-searchbar").hide(),n.keyCode==8&&this._kbnTimeoutSearch(this.element,n)),n.event==undefined)||$(i).hasClass("e-quickfilter"))return!1;for(o=$(i).text(),u=0;u<t.model.filterSettings.length;u++)if(t.model.filterSettings[u].text==o)break;return(s=u==t.model.filterSettings.length?null:t.model.filterSettings[u],f={itemName:i.title,itemId:i.id,target:r,currentTarget:i,itemIndex:$(i).index(),toolbarData:n,itemText:o,model:t.model,cancel:!1,type:"toolbarClick"},t._trigger("toolbarClick",f))?!1:(f.itemId==this._id+"_search"?(f.target.nodeName=="A"&&(t.searchCards($(f.currentTarget).find("input").val()),t.model.allowSearching&&t._searchBar!=null&&t.model.searchSettings.key.length!=0&&(e=t._searchBar.find(".e-toolbaricons"),$(r).is(t._searchBar.find(".e-searchfind"))?e.removeClass("e-searchfind").addClass("e-cancel"):$(r).is(t._searchBar.find(".e-cancel"))&&(e.removeClass("e-cancel").addClass("e-searchfind"),t.clearSearch()))),t._isWatermark||(t._searchInput.blur(function(){t._searchInput.val()||t._hiddenSpan.css("display","block")}),t._hiddenSpan.css("display","none"))):$(f.currentTarget).hasClass("e-printlist")?t.print():$(i).parent().hasClass("e-customtoolbar")||t._filterHandler(s,i),!1)},i.prototype.print=function(){var t={},n,u,f,i,r;t.requestType="print";this._trigger("actionBegin",t);ej.isNullOrUndefined(this.element.find("#"+this._id+"_externalEdit"))||this.element.find("#"+this._id+"_externalEdit").css("display","none");n=this.element.clone();n.find(".e-kanbantouchbar").remove();this.model.allowScrolling&&(u=this.model.scrollSettings.width,f=this.model.scrollSettings.height,(this.getScrollObject().isVScroll()||this.getScrollObject().isHScroll())&&(i=this.getContent().find(".e-content")[0],n.find(".e-kanbancontent").height(i.scrollHeight),n.find(".e-kanbancontent").ejScroller({width:i.scrollWidth,height:i.scrollHeight}),n.width(i.scrollWidth)));(!ej.isNullOrUndefined(this.model.filterSettings)||this.model.allowSearching||this.model.allowPrinting||!ej.isNullOrUndefined(this.model.customToolbarItems))&&n.find(".e-kanbantoolbar").remove();r=window.open("","print","height=452,width=1024,tabbar=no");t={requestType:"print",element:n};this._trigger("beforePrint",t);ej.isNullOrUndefined(t.element)||(n=t.element);ej.print(n,r);this._trigger("actionComplete",t)},i.prototype._filterHandler=function(n,t){var r={requestType:"filtering",currentFilterObject:[],filterCollection:this._filterCollection},u,i,e,f;if(r.currentFilterObject.push(n),this.model.isResponsive){for(u=[],this._kbnFilterObject=this._kbnFilterObject.concat(r.currentFilterObject),i=0;i<this._kbnFilterObject.length;i++)f=$.inArray(this._kbnFilterObject[i],u),f<0&&u.push(this._kbnFilterObject[i]);this._kbnFilterObject=u}for(this._initialData=this._currentJsonData,i=0;i<this.model.filterSettings.length;i++)if(this.model.filterSettings[i].text==r.currentFilterObject[0].text){e=this.model.filterSettings[i].query.queries[0].e;ej.isNullOrUndefined(r.filterCollection[0])?(r.filterCollection.push(e),$(t).addClass("e-select")):$(t).hasClass("e-select")?($(t).removeClass("e-select"),f=$.inArray(e,r.filterCollection),r.filterCollection.splice(f,1)):($(t).addClass("e-select"),r.filterCollection.push(e));break}this._processBindings(r)},i.prototype.filterCards=function(n){var t={requestType:"filtering",filterCollection:this._filterCollection},n=n.queries[0].e;t.filterCollection.push(n);this._processBindings(t)},i.prototype.clearFilter=function(){if(this._filterCollection.length!=0)this._filterCollection=[],this.element.find(".e-kanbantoolbar .e-tooltxt").removeClass("e-select"),this._processBindings({requestType:"filtering"})},i.prototype._wireEvents=function(){this._on(this.element,$.isFunction($.fn.tap)&&this.model.enableTouch?"tap":"click","",this._clickHandler);this._on($("#"+this._id+"_searchbar"),"keyup","",this._onToolbarClick);this._on(this.element.find(".e-kanbancard"),"taphold","",this._kbnHoldHandler);this._on($(document),"click touchstart","",this._kbnTouchClick);this._on(this.element,"swipeleft swiperight",".e-kanbancontent",$.proxy(this._swipeKanban,this));this._on($("#"+this._id+"_searchbar"),"keypress","",this._onToolbarKeypress);this.KanbanEdit&&this._enableEditingEvents();this._enableCardHover();this.model.tooltipSettings.enable&&(this._on(this.element,"mouseover",".e-kanbancard",this._showToolTip),this._on(this.element,"mouseout",".e-kanbancard",this._hideToolTip));this.model.allowKeyboardNavigation&&(this.element[0].tabIndex=this.element[0].tabIndex==-1?0:this.element[0].tabIndex,this.element[0].accessKey=!ej.isNullOrUndefined(this.element[0].accessKey)&&this.element[0].accessKey!=""?this.element[0].accessKey:"e",this._on(this.element,"keyup","",undefined));this._enableCardHover()},i.prototype._enableEditingEvents=function(){this.model.editSettings.allowEditing?this._on(this.element,"dblclick doubletap",".e-kanbancard",this._cardDblClickHandler):this._off(this.element,"dblclick doubletap",".e-kanbancard");this.model.editSettings.allowAdding?this._on(this.element,"dblclick",".e-kanbancontent .e-columnrow .e-rowcell",this._cellDblClickHandler):this._off(this.element,"dblclick",".e-kanbancontent .e-columnrow .e-rowcell");this.model.editSettings.allowEditing||this.model.editSettings.allowAdding?this._on($("#"+this._id+"_dialogEdit"),"click keypress","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel",this._clickHandler):this._off($("#"+this._id+"_dialogEdit"),"click","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel")},i.prototype._cardDblClickHandler=function(n){this._cardEditClick=!0;this._dblArgs=n;this.KanbanEdit&&this.KanbanEdit.startEdit($(n.target).closest(".e-kanbancard"))},i.prototype._cellDblClickHandler=function(n){$(n.target).hasClass("e-rowcell")&&(this._isAddNewClick=!0,this._newCard=$(n.target),this.KanbanEdit&&this.KanbanEdit.addCard())},i.prototype._enableCardHover=function(){this.model.allowHover?this._on(this.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard",this._cardHover):this._off(this.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard")},i.prototype._showToolTip=function(n){var e,o,u,f;if(this.model.tooltipSettings.enable){if($(n.target).hasClass("e-kanbantooltip"))return;if(u=this.element.find(".e-kanbantooltip"),f=ej.isNullOrUndefined(this.model.tooltipSettings.template),f&&!($(n.target).hasClass("e-tag")||$(n.target).hasClass("e-text")||$(n.target).closest(".e-primarykey").length>0))return;f?u.html($(n.target).text()).removeClass("e-tooltiptemplate"):(u.addClass("e-tooltiptemplate"),o=new ej.DataManager(this._currentJsonData),e=o.executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,$(n.currentTarget).attr("id"))),u.html($(this.model.tooltipSettings.template).render(e[0])));var i=n.pageX,r=n.pageY,t=$(this.element).find(".e-kanbantooltip");i=i+t.width()<$(this.element).width()?i:i-t.width();r=r+t.height()<$(this.element).height()?r:r-t.height();t.css("left",i);t.css("top",r);this.model.enableRTL==!0&&t.addClass("e-rtl");$(this.element).find(".e-kanbantooltip").show()}},i.prototype._hideToolTip=function(){this.model.tooltipSettings.enable&&this.element.find(".e-kanbantooltip").hide()},i.prototype.expandAll=function(){var t=this.element.find(".e-swimlanerow .e-slcollapse"),n;if(t.length!=0)for(n=0;n<t.length;n++)this.toggleSwimlane($(t[n]))},i.prototype.collapseAll=function(){var t=this.element.find(".e-swimlanerow .e-slexpand"),n;if(t.length!=0)for(n=0;n<t.length;n++)this.toggleSwimlane($(t[n]))},i.prototype._moveCurrentCard=function(n,t,i){var s,r,f,u,o,h,w,c,v,y,b,l,a,p,e;if(r=this.selectedRowCellIndexes[0],l=r.cardIndex,s=r.cellIndex[r.cellIndex.length-1],t=="down"||t=="up"){if(b=$(this._columnRows[n]).find("td.e-rowcell").eq(s),o=b.find(".e-kanbancard"),u=$(o).index(b.find(".e-cardselection")),c=o.length,t=="down")if(ej.isNullOrUndefined(this.model.fields.swimlaneKey)?u=this.model.selectionType=="multiple"?l[r.cellIndex.length-1][l[r.cellIndex.length-1].length-1]:l[r.cellIndex.length-1]:(i.shiftKey||i.ctrlKey)&&this.model.selectionType=="multiple"&&(u=l[r.cellIndex.length-1][l[r.cellIndex.length-1].length-1]),u==c-1||c==0){if(n==this._columnRows.length-1)return;if((i.shiftKey||i.ctrlKey)&&this.model.selectionType!="single")return;this._moveCurrentCard(n+1,t,i)}else o.eq(u+1).hasClass("e-cardselection")?this._cardSelection([[n,[s],[u]]],$(o[u]),i):this._cardSelection([[n,[s],[u+1]]],$(o[u+1]),i);else if(t=="up")if(ej.isNullOrUndefined(this.model.fields.swimlaneKey)?u=this.model.selectionType=="multiple"?r.cardIndex[r.cellIndex.length-1][r.cardIndex[r.cellIndex.length-1].length-1]:r.cardIndex[r.cellIndex.length-1]:(i.shiftKey||i.ctrlKey)&&this.model.selectionType=="multiple"&&(u=r.cardIndex[r.cellIndex.length-1][r.cardIndex[r.cellIndex.length-1].length-1]),c==0||u==0){if(n==0)return;if((i.shiftKey||i.ctrlKey)&&this.model.selectionType!="single")return;this._moveCurrentCard(n-1,t,i)}else o.eq(u-1).hasClass("e-cardselection")?this._cardSelection([[n,[s],[u]]],$(o[u]),i):u!=-1?this._cardSelection([[n,[s],[u-1]]],$(o[u-1]),i):this._cardSelection([[n,[s],[c-1]]],$(o[c-1]),i);(i.shiftKey||i.ctrlKey)&&!1||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse"))}else if(w=$(this._columnRows[r.rowIndex]),h=w.find("td.e-rowcell"),o=h.eq(n).find(".e-kanbancard"),f=h.eq(n).find(".e-kanbancard"),v=h.eq(n+1),y=h.eq(n-1),a=this.element.find(".e-kanbancard"),p=this.element.find(".e-cardselection"),y.is(":visible")&&v.is(":visible")||ej.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse")),u=(i.shiftKey||i.ctrlKey)&&this.model.selectionType=="multiple"?r.cardIndex[r.cellIndex.length-1][r.cardIndex[r.cellIndex.length-1].length-1]:this.model.selectionType=="single"?r.cardIndex[0]:r.cardIndex[0][0],t=="right"){if(e=a.eq(a.index(p)+1),n==h.length-1){e.length>0&&(!i.shiftKey&&!i.ctrlKey||this.model.selectionType=="single")&&!ej.isNullOrUndefined(this.model.fields.swimlaneKey)&&(this._cardSelection([[this._columnRows.index(e.closest("tr.e-columnrow")),[e.closest("tr.e-columnrow").find("td.e-rowcell").index(e.closest("td.e-rowcell"))],[0]]],e,i),this.element.find(".e-cardselection").closest("tr:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse")));return}v.find(".e-kanbancard:visible").length>0?(f=v.find(".e-kanbancard"),f.eq(u).length>0?this._cardSelection([[r.rowIndex,[n+1],[u]]],$(f[u]),i):this._cardSelection([[r.rowIndex,[n+1],[f.length-1]]],$(f[f.length-1]),i),(i.shiftKey||i.ctrlKey)&&this.model.selectionType!="single"||ej.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse"))):this._moveCurrentCard(n+1,t,i)}else if(t=="left"){if(a.index(p)!=0&&(e=a.eq(a.index(p)-1)),n==0){if(!i.shiftKey&&!i.ctrlKey&&!ej.isNullOrUndefined(this.model.fields.swimlaneKey)){if(this.toggleSwimlane($(w).prev().find(".e-slexpand")),ej.isNullOrUndefined(e))return;(e.length>0&&!i.shiftKey&&!i.ctrlKey||this.model.selectionType=="single")&&(this._cardSelection([[this._columnRows.index(e.closest("tr.e-columnrow")),[e.closest("tr.e-columnrow").find("td.e-rowcell").index(e.closest("td.e-rowcell"))],[0]]],e,i),this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse")))}return}y.find(".e-kanbancard:visible").length>0?(f=y.find(".e-kanbancard"),f.eq(u).length>0?this._cardSelection([[r.rowIndex,[n-1],[u]]],$(f[u]),i):this._cardSelection([[r.rowIndex,[n-1],[f.length-1]]],$(f[f.length-1]),i),(i.shiftKey||i.ctrlKey)&&this.model.selectionType!="single"||ej.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slexpand"))):this._moveCurrentCard(n-1,t,i)}},i.prototype.clearSelection=function(){if(this.model.allowSelection){var n=$(this._kanbanRows).not(".e-swimlanerow");$(n).find(".e-rowcell .e-kanbancard").removeClass("e-cardselection");this.selectedRowCellIndexes=[];this._selectedCardData=[];this._selectedCards=[];this._previousRowCellIndex=[];this._currentRowCellIndex=[]}},i.prototype._keyPressed=function(n,t,i){var r,o,u,s,c=$(t),l=!1,h,f,e;r=this.element.find(".e-cardselection");o=this.element.find(".e-kanbancard:visible");i.code==13&&t.tagName=="INPUT"&&c.closest("#"+this._id+"_toolbarItems_search").length&&(n="searchRequest");u=this.selectedRowCellIndexes[0];h=!ej.isNullOrUndefined(this.model.fields.swimlaneKey);switch(n){case"editCard":r.length>0&&this.model.editSettings.allowEditing&&(s=u.cellIndex,r=this._columnRows.eq(u.rowIndex).find("td.e-rowcell").eq(s[s.length-1]).find(".e-kanbancard").eq(u.cardIndex[s.length-1]),this.KanbanEdit.startEdit(r));break;case"insertCard":this.model.editSettings.allowAdding&&this.KanbanEdit.addCard();break;case"swimlaneExpandAll":this.expandAll();break;case"swimlaneCollapseAll":this.collapseAll();break;case"downArrow":r.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(u.rowIndex,"down",i);break;case"upArrow":r.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(u.rowIndex,"up",i);break;case"leftArrow":r.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(u.cellIndex[u.cellIndex.length-1],"left",i);this.element.hasClass("e-responsive")&&this._kbnTransitionEnd&&this._kbnRightSwipe();break;case"rightArrow":r.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(u.cellIndex[u.cellIndex.length-1],"right",i);this.element.hasClass("e-responsive")&&this._kbnTransitionEnd&&this._kbnLeftSwipe();break;case"multiSelectionByDownArrow":i.ctrlKey=!0;r.length>0&&this._moveCurrentCard(u.rowIndex,"down",i);break;case"multiSelectionByUpArrow":i.ctrlKey=!0;r.length>0&&this._moveCurrentCard(u.rowIndex,"up",i);break;case"multiSelectionByRightArrow":i.shiftKey=!0;r.length>0&&this._moveCurrentCard(u.cellIndex[u.cellIndex.length-1],"right",i);break;case"multiSelectionByLeftArrow":i.shiftKey=!0;r.length>0&&this._moveCurrentCard(u.cellIndex[u.cellIndex.length-1],"left",i);break;case"firstCardSelection":this.model.allowSelection&&(this.clearSelection(),o.eq(0).addClass("e-cardselection"),r=this.element.find(".e-cardselection"),f=$(this._columnRows).find(".e-cardselection").index(),e=$(this._columnRows).find(".e-cardselection").parent().children().eq(0).hasClass("e-limits")?f-1:f,this.model.selectionType=="multiple"?this.selectedRowCellIndexes.push({cardIndex:[[e]],cellIndex:[r.parent().index()],rowIndex:$(this._columnRows).index(r.parents(".e-columnrow"))}):this.selectedRowCellIndexes.push({cardIndex:[e],cellIndex:[r.parent().index()],rowIndex:$(this._columnRows).index(r.parents(".e-columnrow"))}));break;case"lastCardSelection":this.model.allowSelection&&(this.clearSelection(),o.eq(o.length-1).addClass("e-cardselection"),r=this.element.find(".e-cardselection"),r=this.element.find(".e-cardselection"),f=$(this._columnRows).find(".e-cardselection").index(),e=$(this._columnRows).find(".e-cardselection").parent().children().eq(0).hasClass("e-limits")?f-1:f,this.model.selectionType=="multiple"?this.selectedRowCellIndexes.push({cardIndex:[[e]],cellIndex:[r.parent().index()],rowIndex:$(this._columnRows).index(r.parents(".e-columnrow"))}):this.selectedRowCellIndexes.push({cardIndex:[e],cellIndex:[r.parent().index()],rowIndex:$(this._columnRows).index(r.parents(".e-columnrow"))}));break;case"cancelRequest":$("#"+this._id+"_dialogEdit:visible").length>0?this.KanbanEdit.cancelEdit():r.length>0&&this.clearSelection();break;case"searchRequest":this.searchCards(c.val());this._searchBar.find(".e-toolbaricons").removeClass("e-searchfind").addClass("e-cancel");break;case"saveRequest":$("#"+this._id+"_dialogEdit:visible").length>0&&this.KanbanEdit.endEdit();break;case"deleteCard":r.length>0&&$("#"+this._id+"_dialogEdit:visible").length<=0&&!ej.isNullOrUndefined(this.model.fields.primaryKey)&&this.KanbanEdit.deleteCard(r.attr("id"));break;case"selectedSwimlaneExpand":r.length>0&&h&&(r.is(":visible")||this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slexpandcollapse")));break;case"selectedSwimlaneCollapse":r.length>0&&h&&r.is(":visible")&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().find(".e-slexpandcollapse"));break;case"selectedColumnCollapse":r.length>0&&this._toggleField(this.model.columns[this.selectedRowCellIndexes[0].cellIndex[0]].headerText);break;case"selectedColumnExpand":this._collapsedColumns.length!=0&&this._toggleField(this._collapsedColumns[this._collapsedColumns.length-1]);break;case"focus":this.element.find(".e-cardselection").focus();break;default:l=!0}return l},i.prototype._showExpandColumns=function(n,t,i,r){var u,e,f;if(!ej.isNullOrUndefined(n)){if(n!=null)if($.isArray(t))for(u=0;u<t.length;u++)e=this.getColumnByHeaderText(t[u]),t[u]=e!=null?e.headerText:t[u];else t=n.headerText;if($.isArray(t))for(u=0;u<t.length;u++)f=$.inArray(t[u],this[i]),f!=-1?(this[i].splice(f,1),this[r].push(t[u])):f!=-1||$.inArray(t[u],this[r])!=-1||ej.isNullOrUndefined(this.getColumnByHeaderText(t[u]))||(this[r].push(this.getColumnByHeaderText(t[u]).key)&&this[r].push(t[u]),this[i].splice($.inArray(this.getColumnByHeaderText(t[u]).key,this[i]),1)&&this[i].splice($.inArray(t[u],this[i]),1));else f=$.inArray(t,this[i]),f!=-1?(this[i].splice(f,1),this[r].push(t)):f!=-1||$.inArray(t,this[r])!=-1||ej.isNullOrUndefined(this.getColumnByHeaderText(t))||(this[r].push(this.getColumnByHeaderText(t).key)&&this[r].push(t),this[i].splice($.inArray(this.getColumnByHeaderText(t).key,this[i]),1)&&this[i].splice($.inArray(t,this[i]),1))}},i.prototype._createStackedRow=function(n){for(var c,l,o,f,r,a,i,s,e,u,y,p,v=ej.buildTag("tr.e-columnheader e-stackedHeaderRow","",{},{}),t=[],h=0;h<this.model.columns.length;h++)if(c=this.model.columns[h],c.visible!=!1){for(l="",o=n.stackedHeaderColumns,f=0;f<o.length;f++)o[f].column.indexOf(c.headerText)!=-1&&(l=o[f].headerText);t.push(l)}for(r=[],a="",i=0;i<t.length;i++){for(s=1,e=i+1;e<t.length;e++)if(t[i]!=""&&t[e]!=""&&t[i]==t[e])s++;else break;r.push({sapnCount:s,headerText:t[i],css:t[i]!=""?a:"e-sheader"});i+=s-1;a=""}for(u=0;u<r.length;u++)y=ej.buildTag("div",r[u].headerText,{},{}),p=ej.buildTag("th.e-headercell e-stackedHeaderCell "+r[u].css+"","",{},{colspan:r[u].sapnCount}).append(y),v.append(p);return v},i.prototype._refreshStackedHeader=function(){for(var r,t=this.model.stackedHeaderRows,i=this.element.find(".e-stackedHeaderRow"),n=0;n<t.length;n++)r=this._createStackedRow(t[n]),i.length>0&&i.remove(),$(this.getHeaderTable().find(".e-columnheader").before(r));this.model.allowScrolling&&this._refreshScroller({requestType:"refresh"})},i.prototype._expandColumns=function(n){var t,i="_expandedColumns";t=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]);this._showExpandColumns(t,n,"_collapsedColumns",i);this._expandCollapse(this[i],"expand");this.model.allowScrolling&&this._setWidthToColumns();this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader()},i.prototype._setWidthToColumns=function(){for(var u=this.getContentTable().children("colgroup").find("col"),t=this.getHeaderTable().children("colgroup").find("col"),i=this._originalWidth-this._collapsedColumns.length*50,n=0;n<t.length;n++)if(ej.isNullOrUndefined(this._columnsWidthCollection[n])||this.model.allowToggleColumn){if(this.model.allowScrolling){var e=parseInt((i/this._expandedColumns.length).toFixed(2)),f=parseInt((i/(this.model.scrollSettings.buttonSize||18)/100).toFixed(2)),r=e-f;this.model.columns[n].isCollapsed||(u.eq(n).css("width",r+"px"),t.eq(n).css("width",r+"px"),this.model.columns[n].width=r);this._columnsWidthCollection[n]=parseInt((i/this.model.columns.length).toFixed(2))-f}}else u.eq(n).width(this._columnsWidthCollection[n]),t.eq(n).width(this._columnsWidthCollection[n])},i.prototype._filterLimitCard=function(n){for(var f,t,u,r,i=0;i<this.model.columns.length;i++)f=this.model.columns[i],t=this.getHeaderContent().find("span.e-totalcount"),this.model.enableTotalCount&&(t=$(t[i]),u=$(t).text().indexOf(this.localizedLabels.FilterOfText),(!ej.isNullOrUndefined(n)&&n.requestType=="filtering"||this.model.enableTotalCount)&&n.filterCollection.length>0?(r=this.getHeaderContent().find(".e-columnheader").not(".e-stackedHeaderRow").find(".e-headercell")[i],$(r).hasClass("e-exceed")?$(r).removeClass("e-exceed"):$(r).hasClass("e-deceed")&&$(r).removeClass("e-deceed"),u!=-1&&$(t).text($(t).text().slice(u+3)),$(t).text($($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+f.key+"] > div.e-kanbancard")).length+" "+this.localizedLabels.FilterOfText+" "+$(t).text())):ej.isNullOrUndefined(f.constraints)?$(t).text($(t).text().slice(u+3)):this._renderLimit())},i.prototype._toggleField=function(n){var r,t;if($.isArray(n))for(t=0;t<n.length;t++)r=$.inArray(n[t],this._collapsedColumns),r!=-1?this._expandColumns(n[t]):this._collapseColumns(n[t]);else $.inArray(n,this._collapsedColumns)!=-1?this._expandColumns(n):this._collapseColumns(n);if(this.model.allowScrolling){var e=this.getContentTable().children("colgroup").find("col"),u=this.getHeaderTable().children("colgroup").find("col"),f=this._originalWidth-this._collapsedColumns.length*50;for(t=0;t<u.length;t++){var o=parseInt((f/this._expandedColumns.length).toFixed(2)),s=parseInt((f/(this.model.scrollSettings.buttonSize||18)/100).toFixed(2)),i=o-s;this.model.columns[t].isCollapsed||(e.eq(t).css("width",i+"px"),u.eq(t).css("width",i+"px"),this.model.columns[t].width=i)}}this._refreshScroller({requestType:"refresh"})},i.prototype.refreshColumnConstraints=function(){this._renderLimit();var n={requestType:"refresh"};this._filterCollection.length>0&&(n.filterCollection=this._filterCollection,this._filterLimitCard(n));this._swimlaneLimit(n);this._enableSwimlaneCount=!1},i.prototype._validateLimit=function(n,t,i){var e=n.key,r=$($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+e+"]")),u,o=!ej.isNullOrUndefined(n.constraints.min),s=!ej.isNullOrUndefined(n.constraints.max),f=!ej.isNullOrUndefined(this.model.fields.swimlaneKey)&&i==0;n.constraints.type=="column"?u=r.find(".e-kanbancard").length:(u=$(r[i]).find(".e-kanbancard").length,r=$(r[i]));o&&(n.constraints.min>u?(r.addClass("e-deceed"),f&&$(t).addClass("e-deceed")):(r.removeClass("e-deceed"),f&&$(t).removeClass("e-deceed")));s&&(n.constraints.max<u?(r.addClass("e-exceed"),f&&$(t).addClass("e-exceed")):(r.removeClass("e-exceed"),f&&$(t).removeClass("e-exceed")));r.find(".e-limits").addClass("e-hide");$(t).find(".e-limits").removeClass("e-hide")},i.prototype._swimlaneLimit=function(n){for(var t,s,f,h,e,c,r,l,o,i=0;i<this.model.columns.length;i++)if(t=this.model.columns[i].constraints,s=this.model.columns[i].key,!ej.isNullOrUndefined(t)){var a=!ej.isNullOrUndefined(t.min),v=!ej.isNullOrUndefined(t.max),u=$($(this.getContent().find(".e-columnrow")).find("td[ej-mappingkey="+s+"]"));if(t.type=="swimlane"&&!ej.isNullOrUndefined(this.model.fields.swimlaneKey)&&(this._enableSwimlaneCount&&(n.requestType=="filtering"||n.requestType=="refresh")||this._filterCollection.length>0&&this._enableSwimlaneCount))for(r=0;r<u.length;r++)l=ej.buildTag("div.e-limits"),$(u).eq(r).prepend(l),o=$(u).eq(r).find(".e-limits"),a&&(f=ej.buildTag("div.e-min",this.localizedLabels.Min+" [","",{}),h=ej.buildTag("span.e-minlimit",t.min.toString(),"",{}),f.append(h).append("]"),o.append(f)),v&&(e=ej.buildTag("div.e-max",this.localizedLabels.Max+" [","",{}),c=ej.buildTag("span.e-maxlimit",t.max.toString(),"",{}),e.append(c).append("]"),o.append(e)),this.getHeaderContent().find(".e-headercell").eq(i).hasClass("e-shrinkcol")&&$(u).eq(r).find(".e-limits").addClass("e-hide")}},i.prototype._hideCollapseColumns=function(n,t,i,r){var u,f;if(!ej.isNullOrUndefined(n))if($.isArray(t))for(u=0;u<t.length;u++)f=$.inArray(t[u],this[r]),f!=-1?(this[i].push(t[u]),this[r].splice(f,1)):f!=-1||$.inArray(t[u],this[i])!=-1||ej.isNullOrUndefined(this.getColumnByHeaderText(t[u]))||(this[i].push(this.getColumnByHeaderText(t[u]).key)&&this[i].push(this.getColumnByHeaderText(t[u]).key),this[r].splice($.inArray(this.getColumnByHeaderText(t[u]).key,this[r]),1)&&this[r].splice($.inArray(t[u],this[r]),1));else f=$.inArray(t,this[r]),f!=-1?(this[i].push(t),this[r].splice(f,1)):f!=-1||r!=r||$.inArray(t,this[i])!=-1||ej.isNullOrUndefined(this.getColumnByHeaderText(t))||(this[i].push(this.getColumnByHeaderText(t).key)&&this[i].push(this.getColumnByHeaderText(t).key),this[r].splice($.inArray(this.getColumnByHeaderText(t).key,this[r]),1)&&this[r].splice($.inArray(t,this[r]),1))},i.prototype.hideColumns=function(n){for(var i,r=0,u,f="_hiddenColumns",t=0;t<this._visibleColumns.length;t++)i=$.inArray(this._collapsedColumns[t],this._visibleColumns),i!=-1&&r++;if(this._visibleColumns.length-1>r)u=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]),this._hideCollapseColumns(u,n,f,"_visibleColumns"),this._showhide(this[f],"hide"),this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader();else{if(this._visibleColumns.length==1)return;this._visibleColumns[0]==n?this._expandColumns(this._visibleColumns[1]):this._expandColumns(this._visibleColumns[0]);this.hideColumns(n)}this._renderLimit();this._totalCount();this._stackedHeadervisible()},i.prototype._expandCollapse=function(n,t){var u,y=0,l,s=this.model.columns,i,h,c,f;l=t==="expand"?"_expandedColumns":"_collapsedColumns";var p=this.getHeaderTable().find("thead"),e=p.find("tr").not(".e-stackedHeaderRow").find(".e-headercell"),o=this.getHeaderTable().find("colgroup").find("col"),a,r,v=this.getContentTable().find("colgroup").find("col");for(u=0;u<s.length;u++)if($.inArray(s[u].headerText,this[l])!=-1&&(s[u].isCollapsed=t==="expand"?!1:!0,y++),a=this.getColumnByHeaderText(n[u]),i=$.inArray(a,this.model.columns),h=t=="expand"?!0:!1,i!=-1&&(h?o.eq(i).hasClass("e-shrinkcol")&&(e.eq(i).find(".e-headercelldiv").removeClass("e-hide"),e.eq(i).removeClass("e-shrinkcol"),o.eq(i).removeClass("e-shrinkcol"),v.eq(i).removeClass("e-shrinkcol"),e.eq(i).find(".e-clcollapse").addClass("e-clexpand").removeClass("e-clcollapse")):o.eq(i).hasClass("e-shrinkcol")||(e.eq(i).find(".e-headercelldiv").addClass("e-hide"),e.eq(i).addClass("e-shrinkcol"),o.eq(i).addClass("e-shrinkcol"),v.eq(i).addClass("e-shrinkcol"),e.eq(i).find(".e-clexpand").addClass("e-clcollapse").removeClass("e-clexpand"))),c=this.model.columns[u].isCollapsed,h){if(!c)for(f=0;f<this._columnRows.length;f++)if(r=this._columnRows.eq(f).find("td.e-rowcell[ej-mappingkey='"+this.model.columns[u].key+"']"),r.hasClass("e-shrink"))r.removeClass("e-shrink").find(".e-shrinkheader").addClass("e-hide").parent().find(".e-kanbancard").removeClass("e-hide"),r.find(".e-customaddbutton").removeClass("e-hide"),r.find(".e-limits").removeClass("e-hide"),r.find(".e-shrinkcount").text(this._columnCardcount(this.currentViewData,this.model.columns[u].key,this.model.fields.swimlaneKey?f:null));else break}else if(c)for(f=0;f<this._columnRows.length;f++)if(r=this._columnRows.eq(f).find("td.e-rowcell[ej-mappingkey='"+this.model.columns[u].key+"']"),r.hasClass("e-shrink"))break;else r.addClass("e-shrink").find(".e-shrinkheader").removeClass("e-hide").parent().find(".e-kanbancard").addClass("e-hide"),r.find(".e-customaddbutton").addClass("e-hide"),r.find(".e-limits").addClass("e-hide"),r.find(".e-shrinkcount").text(this._columnCardcount(this.currentViewData,this.model.columns[u].key,this.model.fields.swimlaneKey?f:null))},i.prototype._collapseColumns=function(n){for(var i,r,u="_collapsedColumns",f=0,t=0;t<n.length;t++)i=$.inArray(n[t],this._expandedColumns),i!=-1&&f++;this._expandedColumns.length==f||this.getVisibleColumnNames().length-this._collapsedColumns.length==1||this.model.columns.length-this._collapsedColumns.length==1?(this._expandColumns(this._collapsedColumns[0]),this._collapseColumns(n)):(r=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]),this._hideCollapseColumns(r,n,u,"_expandedColumns"),this._expandCollapse(this[u],"collapse"),this.model.allowScrolling&&this._setWidthToColumns(),this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader())},i.prototype._cardHover=function(n){var r=$(n.target),i=$(this._kanbanRows),t=$(r).closest(".e-kanbancard");return t.length<=0?!1:(this.model.allowHover&&(n.type=="mouseenter"?ej.isNullOrUndefined(i)||t.index()!=-1&&t.addClass("e-hover"):i.find(".e-kanbancard").removeClass("e-hover")),!1)},i.prototype.toggleCard=function(n){var t,i;if(typeof n=="string"||typeof n=="number")t=this.element.find("div.e-kanbancard[id="+n+"]"),this._toggleCardByTarget($(t).find(".e-cardheader .e-icon"));else if(typeof n=="object"&&n[0].nodeName!="DIV")for(i=0;i<n.length;i++)t=this.element.find("div.e-kanbancard[id="+n[i]+"]"),this._toggleCardByTarget($(t).find(".e-cardheader .e-icon"));else this._toggleCardByTarget(n)},i.prototype._toggleCardByTarget=function(n){var u,f;if(n=n.hasClass("e-expandcollapse")?n.find("div:first"):n,n.hasClass("e-cardexpand")||n.hasClass("e-cardcollapse")){var t=n.closest("div.e-cardheader"),i=t.next(),r=t.find(".e-primarykey").text(),e=$(n).closest(".e-kanbancard");n.hasClass("e-cardexpand")?(n.removeClass("e-cardexpand").addClass("e-cardcollapse"),e.addClass("e-collapsedcard"),t.append(i.find(".e-text").clone()),i.hide(),$.inArray(r,this._collapsedCards)==-1&&this._collapsedCards.push(r)):(n.removeClass("e-cardcollapse").addClass("e-cardexpand"),e.removeClass("e-collapsedcard"),t.find(".e-text").remove(),i.show(),u=$.inArray(r,this._collapsedCards),u!=-1&&this._collapsedCards.splice(u));this.model.allowScrolling&&((this.getScrollObject().isVScroll()||this.getScrollObject().isHScroll())&&this.getScrollObject().refresh(),this.getScrollObject().isVScroll()?this.element.find(".e-kanbanheader").addClass("e-scrollcss").children().addClass("e-hscrollcss"):this.element.find(".e-kanbanheader").removeClass("e-scrollcss").children().removeClass("e-hscrollcss"));this.element.hasClass("e-responsive")&&(f=n.parents(".e-cell-scrollcontent"),f.length>0&&f.data("ejScroller").refresh())}},i.prototype.toggleColumn=function(n){if(typeof n=="string"||"object"&&n[0].nodeName!="DIV"&&n[0].nodeName!="TD")this._toggleField(n);else if(n[0].nodeName=="TD")this._toggleField(n.closest(".e-shrink").find(".e-shrinkheader").text().split("[")[0]);else{var u,i,f,t,r,o=this.model.columns,e;if(this.model.stackedHeaderRows.length&&(r=this.model.stackedHeaderRows[0].stackedHeaderColumns),f=n.closest(".e-headercell").not(".e-stackedHeaderCell"),i=this.element.find(".e-columnheader").not(".e-stackedHeaderRow").find(".e-hide"),f.length>0)this._toggleField(o[f.index()].headerText);else if(n.closest(".e-shrink").find(".e-shrinkheader").length>0)for(t=0;t<i.length;t++)e=$(i[t]).find(".e-headerdiv").text().split("[")[0],e==n.closest(".e-shrink").find(".e-shrinkheader").text().split("[")[0]&&($(i[t]).next().find(".e-clcollapse").addClass("e-clexpand"),$(i[t]).next().find(".e-clexpand").removeClass("e-clcollapse"),this._toggleField(e));else if(n.closest(".e-stackedHeaderRow").length>0)for(u=n.closest(".e-stackedHeaderCell"),t=0;t<r.length;t++)r[t].headerText==$(u).text()&&(u.hasClass("e-collapse")?this.element.find(".e-stackedHeaderCell").eq(t).removeClass("e-collapse"):this.element.find(".e-stackedHeaderCell").eq(t).addClass("e-collapse"),this._toggleField(r[t].column.split(",")))}},i.prototype._kbnRightSwipe=function(){var h=this.element.width(),c=this.element.find(".e-rowcell:visible"),o,t=this.element.find(".e-stackedHeaderCell"),u=0,i,f,r,l=this,n,s,e;if(this._kbnSwipeCount>0){for(this._kbnSwipeCount==1?this._kbnSwipeWidth=0:(r=c.eq(this._kbnSwipeCount-1),r.length==0&&(r=this.element.find(".e-headercell:visible").not(".e-stackedHeaderCell").eq(this._kbnSwipeCount-1)),this._kbnSwipeWidth=this._kbnSwipeWidth-r.offset().left,o=(h-r.width())/2,this._kbnSwipeWidth=this._kbnSwipeWidth+o),n=0;n<t.length;n++)if(s=this.headerContent.find("col:eq(0)").width(),i=u,f=this._kbnSwipeCount-1,u=u+parseInt($(t).eq(n).attr("colspan")),f>=i&&f<u)if(i==this._kbnSwipeCount-1){this.element.find(".e-adapt-stheader").removeClass("e-adapt-stheader");$(t).eq(n).find("div").css({position:"",left:""});e=$(t).eq(n).prev(".e-stackedHeaderCell");e.length>0&&e.addClass("e-adapt-stheader");break}else if(i<this._kbnSwipeCount-1){$(t).eq(n).find("div").css({position:"relative",left:s*(this._kbnSwipeCount-1-i)});break}this._kbnTransitionEnd=!1;this.headerContent.find("table").css({transform:"translate3d("+this._kbnSwipeWidth+"px, 0px, 0px)","transition-duration":""}).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){l._kbnTransitionEnd=!0});this.kanbanContent.find("table").eq(0).css({transform:"translate3d("+this._kbnSwipeWidth+"px, 0px, 0px)","transition-duration":""});--this._kbnSwipeCount}},i.prototype._kbnLeftSwipe=function(){var o=this.element.width(),h=this.element.find(".e-rowcell:visible"),s,t=this.element.find(".e-stackedHeaderCell"),u=0,r,f,i,c=this,n,e;if(this._kbnSwipeCount<this.model.columns.length-1){for(i=h.eq(this._kbnSwipeCount+1),i.length==0&&(i=this.element.find(".e-headercell:visible").not(".e-stackedHeaderCell").eq(this._kbnSwipeCount+1)),this._kbnSwipeWidth=this._kbnSwipeWidth-i.offset().left,s=this._kbnSwipeCount==this.model.columns.length-2?o-i.width():(o-i.width())/2,this._kbnSwipeWidth=this._kbnSwipeWidth+s,n=0;n<t.length;n++)if(e=this.headerContent.find("col:eq(0)").width(),r=u,f=this._kbnSwipeCount+1,u=u+parseInt($(t).eq(n).attr("colspan")),f>r&&f<u)if(n==0){$(t).eq(n).addClass("e-adapt-stheader");$(t).eq(n).find("div").css({position:"relative",left:e*f});break}else if(r==this._kbnSwipeCount+1){this.element.find(".e-adapt-stheader").removeClass("e-adapt-stheader");$(t).eq(n-1).find("div").css({position:"",left:""});$(t).eq(n).addClass("e-adapt-stheader");break}else if(r<this._kbnSwipeCount+1){$(t).eq(n).find("div").css({position:"relative",left:e*(this._kbnSwipeCount+1-r)});break}this._kbnTransitionEnd=!1;this.headerContent.find("table").css({transform:"translate3d("+this._kbnSwipeWidth+"px, 0px, 0px)","transition-duration":""}).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){c._kbnTransitionEnd=!0});this.kanbanContent.find("table").eq(0).css({transform:"translate3d("+this._kbnSwipeWidth+"px, 0px, 0px)","transition-duration":""});++this._kbnSwipeCount}},i.prototype._swipeKanban=function(n){if(this.element.hasClass("e-responsive")&&this._kbnTransitionEnd&&this.element.find(".e-targetclone").length==0)switch(n.type){case"swipeleft":this._kbnLeftSwipe();break;case"swiperight":this._kbnRightSwipe()}},i.prototype._clearAdaptSearch=function(n){var t,r=this.element,i=r.data("ejKanban");ej.isNullOrUndefined(n)||(t=$(n.target));ej.isNullOrUndefined(t)||t.hide();r.data("ejWaitingPopup").show();setTimeout(function(){var f,u,e;ej.isNullOrUndefined(t)||(u=t.prev(".e-input"));(ej.isNullOrUndefined(u)||u.length==0)&&(u=ej.isNullOrUndefined(t)?r.find(".e-kanbantoolbar .e-searchdiv > .e-input"):t.next(".e-search").find("input"));f=ej.isNullOrUndefined(t)?{itemText:u.val()}:{target:t,currentTarget:t,itemIndex:t.index(),toolbarData:n,itemText:u.val()};i._trigger("toolbarClick",f);i.clearSearch();ej.isNullOrUndefined(i.model.fields.swimlaneKey)||(e=(new ej.Query).where(ej.Predicate.or(i.keyPredicates)).select(i.model.fields.swimlaneKey),i._kbnAdaptDdlData=new ej.DataManager(i._currentJsonData).executeLocal(e),i._kbnAdaptDdlData=ej.dataUtil.mergeSort(ej.dataUtil.distinct(i._kbnAdaptDdlData)),i._addSwimlaneName());r.data("ejWaitingPopup").hide()},300)},i.prototype._adaptiveKbnClick=function(n){var t=$(n.target),u,f,e=this.element.find(".e-swimlane-window"),a,g,nt,v,r,tt,s,h,o,it,i,w,b,y,p,k,c,d,rt,l;if(this.element.hasClass("e-responsive")){if(u=this.element.find(".e-kanbanfilter-window"),f=this.element.find(".e-kanbanfilter-icon"),t.hasClass("e-searchitem")&&(a=t.parents(".e-searchbar"),t.prev().show(),a.siblings().hide(),a.find(".e-adapt-search").length==0&&(g=ej.buildTag("div.e-icon e-adapt-search e-searchfind","",{}),nt=ej.buildTag("div.e-icon e-adapt-cancel e-cancel","",{}),t.siblings(".e-searchdiv").append(nt).prepend(g)),t.parents(".e-search").css({border:""}),t.parents("body").addClass("e-kbnwindow-modal"),t.parents(".e-kanbantoolbar").addClass("e-adaptive-search"),a.find(".e-adapt-cancel").show(),t.hide()),t.hasClass("e-adapt-cancel")&&(this._clearAdaptSearch(n),t.parents(".e-searchbar").siblings(":not('.e-ul.e-horizontal')").show(),v=t.parents(".e-search"),v.find(".e-searchdiv").hide(),v.find(".e-searchitem").show(),v.css({border:"none"}),t.parents("body").removeClass("e-kbnwindow-modal"),t.parents(".e-kanbantoolbar").removeClass("e-adaptive-search")),(t.hasClass("e-filter-done")||t.hasClass("e-clearfilter"))&&(o=t.text(),u.parents("body").removeClass("e-kbnwindow-modal"),t.hasClass("e-clearfilter")&&(o=t.val()),r={target:t,currentTarget:t,itemIndex:t.index(),toolbarData:n,itemText:o},this._trigger("toolbarClick",r),t.hasClass("e-clearfilter")?(this._kbnFilterCollection=[],this._kbnFilterObject=[],this._filterCollection=[],this._kbnAdaptFilterObject=[],t.hide(),f.removeClass("e-kbnclearfl-icon"),this.element.find(".e-kbnfilter-check").parents('[aria-checked~="true"]').click()):(f.hasClass("e-kbnclearfl-icon")||f.addClass("e-kbnclearfl-icon"),this._kbnFilterObject.length==0&&f.hasClass("e-kbnclearfl-icon")&&f.removeClass("e-kbnclearfl-icon")),r={},r.requestType=ej.Kanban.Actions.Filtering,r.currentFilterObject=[],r.filterCollection=this._kbnFilterCollection,r.currentFilterObject=this._kbnFilterObject,this._initialData=this._currentJsonData,this._processBindings(r),ej.isNullOrUndefined(this.model.fields.swimlaneKey)||(this._currentJsonData.length==0?(this.element.find(".e-swimlane-ddl,.e-swimlane-window").remove(),this.kanbanContent.data("ejScroller").destroy()):(tt=(new ej.Query).where(ej.Predicate.or(this.keyPredicates)).select(this.model.fields.swimlaneKey),this._kbnAdaptDdlData=new ej.DataManager(this._currentJsonData).executeLocal(tt),this._kbnAdaptDdlData=ej.dataUtil.mergeSort(ej.dataUtil.distinct(this._kbnAdaptDdlData)),this.element.find(".e-swimlane-ddl,.e-swimlane-window").remove(),this._kbnAdaptSwimlaneDdl())),u.hide(),this._kanbanWindowResize()),t.hasClass("e-filterback-icon")){for(s=[],i=0;i<this.model.filterSettings.length;i++)s.push(this.model.filterSettings[i].text);for(i=0;i<this._kbnAdaptFilterObject.length;i++)o=this._kbnAdaptFilterObject[i].text,it=$.inArray(o,s),s.splice(it,1),h=this.element.find("label.e-filterlabel:contains("+o+")").prev(),h.attr("aria-checked")=="false"&&h.click();for(i=0;i<s.length;i++)h=this.element.find("label.e-filterlabel:contains("+s[i]+")").prev(),h.attr("aria-checked")=="true"&&h.click();u.hide()}t.hasClass("e-kanbanfilter-icon")&&(w=u.find(".e-clearfilter"),p=0,k=this.element.find(".e-filter-scrollcontent"),e.is(":visible")&&e.hide(),u.show(),t.hasClass("e-kbnclearfl-icon")?w.show():w.hide(),b=this.element.find(".e-kbnfilterwindow-head").height(),y=this.element.find(".e-clearfilter"),y.is(":visible")&&(k.ejScroller({height:0}),p=y.outerHeight()+parseInt(y.css("bottom"))),$(window).height()-p<this.element.find(".e-filter-content").height()+b&&k.ejScroller({height:$(window).height()-(b+p+10)}),u.parents("body").addClass("e-kbnwindow-modal"))}c=this.element.find(".e-slwindow-scrollcontent");(t.hasClass("e-swimlane-item")||t.parents(".e-swimlane-item").length>0)&&(d=t,t.parents(".e-swimlane-item").length>0&&(d=t.parents(".e-swimlane-item")),this._kbnAdaptDdlIndex=this._freezeSlOrder=this.element.find(".e-swimlane-item").index(d),e.hide(),this.element.find(".e-swimlane-text").text(this._kbnAdaptDdlData[this._kbnAdaptDdlIndex]),rt=document.getElementsByClassName("e-columnrow"),rt[this._kbnAdaptDdlIndex].scrollIntoView(),c.hasClass("e-scroller")&&c.data("ejScroller").refresh());(t.hasClass("e-swimlane-ddl")||t.parents(".e-swimlane-ddl").length>0)&&(l=this.headerContent.offset().top,e.is(":hidden")?(this.element.parents("body").addClass("e-kbnwindow-modal"),e.show().css({top:l,height:$(window).height()-l}),$(window).height()<l+c.height()&&c.ejScroller({height:$(window).height()-l})):(e.hide(),this.element.parents("body").removeClass("e-kbnwindow-modal")))},i.prototype._kbnFilterChange=function(n){var f=$(n.event.target).closest(".e-kanban"),h=f.ejKanban("instance"),e=$(n.event.target).parents(".e-chkbox-wrap").next().text(),c,o,r,t,u,i,s;if(!h._kbnAutoFilterCheck){for(e==""&&(e=$(n.event.target).next().text()),c=f.find(".e-kanbanfilter-icon"),o=f.find(".e-filter-done"),o.is(":hidden")&&o.show(),t=0;t<this.model.filterSettings.length;t++)if(this.model.filterSettings[t].text==e)break;if(r=t==this.model.filterSettings.length?null:this.model.filterSettings[t],n.isChecked)for(this._kbnFilterObject.push(r),i=0;i<this.model.filterSettings.length;i++)this.model.filterSettings[i].text==r.text&&(s=this.model.filterSettings[i].query.queries[0].e,this._kbnFilterCollection.push(s));else u=$.inArray(r,this._kbnFilterObject),u>=0&&(this._kbnFilterObject.splice(u,1),this._kbnFilterCollection.splice(u,1))}},i.prototype._clickHandler=function(n){var t=$(n.target),i,f=t.hasClass("e-rowcell")?t.index():t.closest(".e-rowcell").index(),r=this.getIndexByRow(t.closest("tr.e-columnrow")),u;i=t.closest(".e-kanbancard");($(n.target).hasClass("e-customaddbutton")||$(n.target).parents(".e-customaddbutton").length>0)&&(this._isAddNewClick=!0,this._newCard=$(n.target).parents(".e-rowcell"),this.KanbanEdit&&this.KanbanEdit.addCard());(t.hasClass("e-cardexpand")||t.hasClass("e-cardcollapse")||t.hasClass("e-expandcollapse"))&&this.toggleCard(t);(t.closest(".e-clexpand").length||t.closest(".e-clcollapse").length||t.closest(".e-shrink").length||t.closest(".e-stackedHeaderRow").length)&&this.model.allowToggleColumn&&this.toggleColumn(t);!ej.isNullOrUndefined(this.model.fields.swimlaneKey)&&(t.hasClass("e-slexpandcollapse")||t.hasClass("e-slexpand")||t.hasClass("e-slcollapse"))&&this.toggleSwimlane(t);this.model.allowSelection&&i.length>0&&t.closest(".e-expandcollapse").length<=0&&(u=$(i.parent()).children().eq(0).hasClass("e-limits")?i.index()-1:i.index(),this.model.selectionType=="single"?this._cardSelection([[r,[f],[u]]],i,n):this.model.selectionType=="multiple"&&(n.shiftKey||n.ctrlKey||this._enableMultiTouch?(this._currentRowCellIndex.length==0||r==this._currentRowCellIndex[0][0])&&this._cardSelection([[r,[f],[u]]],i,n):this._cardSelection([[r,[f],[u]]],i,n)));i.length>0&&this._cardClick(t,i);(t.attr("id")==this._id+"_Cancel"||t.parent().attr("id")==this._id+"_closebutton")&&this.KanbanEdit.cancelEdit();t.attr("id")==this._id+"_Save"&&this.KanbanEdit.endEdit();this._adaptiveKbnClick(n);t.hasClass("e-cardtouch")&&(t.hasClass("e-spanclicked")?(t.removeClass("e-spanclicked"),this._enableMultiTouch=!1,this._kTouchBar.hide()):(t.addClass("e-spanclicked"),this._enableMultiTouch=!0));this._kbnHeaderAndCellEvents(t)},i.prototype._kbnHeaderAndCellEvents=function(n){var i={},h=n.find(".e-kanbancard"),r=n,f,o=n.find(".e-cardselection"),s,t=this,u=n.index(),c=n.parents(".e-columnrow"),l,e,v,a;if(l=this.element.find(".e-rowcell.e-droppable"),f=n.attr("ej-mappingkey"),r.parents(".e-headercell").length>0&&(r=n.parents(".e-headercell")),r.hasClass("e-headercell")&&(s=u=r.index(),e=l.eq(s),f=e.attr("ej-mappingkey"),t.model.fields.swimlaneKey&&(e=$("td[ej-mappingkey~='"+f+"']")),h=e.find(".e-kanbancard"),o=e.find(".e-cardselection"),c=e.parents(".e-columnrow")),(n.hasClass("e-rowcell")||!r.hasClass("e-stackedHeaderCell"))&&(v=c.prev(".e-swimlanerow").find(".e-slkey").text(),a=[],i.cardsInfo=function(){var i={},r;return i.cards=h,i.cardsData=t.model.fields.swimlaneKey&&n.hasClass("e-rowcell")?new ej.DataManager(t._currentJsonData).executeLocal((new ej.Query).where(t.model.keyField,ej.FilterOperators.equal,f).where(t.model.fields.swimlaneKey,ej.FilterOperators.equal,v)):new ej.DataManager(t._currentJsonData).executeLocal((new ej.Query).where(t.model.keyField,ej.FilterOperators.equal,f)),i.cardsCount=h.length,t._selectedCardData.length>0&&(r=$.inArray(u,t.selectedRowCellIndexes[0].cellIndex),!ej.isNullOrUndefined(r)&&r>=0&&a.push(t.selectedRowCellIndexes[0].cardIndex[r])),i.selectedCardsIndexes=a,i.selectedCardsData=new ej.DataManager(t._selectedCardData).executeLocal((new ej.Query).where(t.model.keyField,ej.FilterOperators.equal,f)),i.selectedCards=o,i}),n.hasClass("e-rowcell")&&(i.rowIndex=this.getIndexByRow(c),i.cellIndex=u,this._trigger("cellClick",i)),r.hasClass("e-stackedHeaderCell")){i.text=n.text();var y=[],o,p=[],w=[],b=[],k,d=[],g=[];k=this.element.find(".e-stackedHeaderRow");i.data=function(){var i,h=0,e,nt=t.model.stackedHeaderRows[k.index(r.parents(".e-stackedHeaderRow"))].stackedHeaderColumns,s,f,c,a,v,n;for(i=nt[r.index()].column,i=i.split(","),s=0;s<i.length;s++)f=new ej.DataManager(t.model.columns).executeLocal((new ej.Query).where("headerText",ej.FilterOperators.equal,i[s])),c=$("td[ej-mappingkey~='"+f[0].key+"']"),a=c.find(".e-kanbancard"),y.push(a),d.push(new ej.DataManager(t._currentJsonData).executeLocal((new ej.Query).where(t.model.keyField,ej.FilterOperators.equal,f[0].key))),u=l.index($("td[ej-mappingkey~='"+f[0].key+"']")[0]),t._selectedCardData.length>0&&(e=$.inArray(u,t.selectedRowCellIndexes[0].cellIndex),!ej.isNullOrUndefined(e)&&e>=0&&(v=c.find(".e-cardselection"),o.push(v),g.push(new ej.DataManager(t._selectedCardData).executeLocal((new ej.Query).where(t.model.keyField,ej.FilterOperators.equal,f[0].key))),v.length>0&&(w.push(u),b.push(t.selectedRowCellIndexes[0].cardIndex[e])))),h=h+a.length,p.push(u);return n={},n.count=h,n.cards=y,n.cardsData=d,n.cellIndexes=p,n.selectedCellCardIndexes={cellIndex:w,cardIndex:b},n.selectedCards=o,n.selectedCardsData=g,n};this._trigger("headerClick",i)}else r.hasClass("e-headercell")&&(i["text "]=r.text(),i.cellIndex=s,i.columnData=this.model.columns[s],this._trigger("headerClick",i))},i.prototype._cardClick=function(n,t){var i,r=null,u;ej.isNullOrUndefined(t.attr("id"))||(u=new ej.DataManager(this._currentJsonData),r=u.executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,t.attr("id"))));i={target:n,currentCard:t,data:r};this._trigger("cardClick",i)},i.prototype._getCardData=function(n){return new ej.DataManager(this._currentJsonData).executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,n))},i.prototype._getCardbyIndexes=function(n){return $(this.getRowByIndex(n[0][0]).find(".e-rowcell:eq("+n[0][1][0]+")").find("div.e-kanbancard:eq("+n[0][2][0]+")"))},i.prototype.getRowByIndex=function(n){if(!ej.isNullOrUndefined(n))return $(this._columnRows[n])},i.prototype._cardSelection=function(n,t,i){var h,s,u=null,e=null,p,c,k,a,v,o,y;if(h=t.parent("td.e-rowcell"),this._currentRowCellIndex.length>0&&!$(t).hasClass("e-cardselection")&&(this._previousRowCellIndex=[[this._currentRowCellIndex[0][0],[this._currentRowCellIndex[0][1][0]],[this._currentRowCellIndex[0][2][0]]]]),ej.isNullOrUndefined(t.attr("id"))||(p=new ej.DataManager(this._currentJsonData),e=p.executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,t.attr("id")))),ej.isNullOrUndefined(this._previousRowCellIndex)||this._previousRowCellIndex.length==0||(u=this._getCardbyIndexes(this._previousRowCellIndex)),s={currentCell:h,target:t,cellIndex:n[0][1][0],cardIndex:n[0][2][0],data:e,previousRowCellIndex:this._previousRowCellIndex,previousCard:u,selectedCardsData:this._selectedCardData},!this._trigger("beforeCardSelect",s)){if($(t).hasClass("e-cardselection")||(this.model.selectionType!="multiple"||this._kTouchBar.find(".e-cardtouch").hasClass("e-spanclicked")||this._kTouchBar.hide(),i.pointerType!="touch"||this._kTouchBar.find(".e-cardtouch").hasClass("e-spanclicked")||this.model.selectionType!="multiple"||(c=$(t).offset(),this._kTouchBar.show(),this._kTouchBar.offset({top:c.top,left:c.left}))),this.model.selectionType=="multiple"&&i.shiftKey){var l,f,r=0,w=0,d=t,b=[];for(ej.isNullOrUndefined(u)?f=t.parents(".e-columnrow").find(".e-kanbancard"):(l=u.parents(".e-columnrow"),l.find(".e-cardselection").not(u).removeClass("e-cardselection"),f=l.find(".e-kanbancard"),r=f.index(u)),this._selectedCards=[],this._selectedCardData=[],this.selectedRowCellIndexes=[];w<=0;)v=[],k=$(f[r]).parents(".e-columnrow"),a=$(f[r]).parents(".e-rowcell"),$(f[r]).addClass("e-cardselection"),b.push(f[r]),this._selectedCardData.push(this._getKanbanCardData(this._currentJsonData,f[r].id)[0]),v=[[this.element.find(".e-columnrow").index(k),[a.index()],[a.find($(f[r])).index()]]],f[r].id==d.attr("id")&&(w=1),this._pushIntoSelectedArray(v),ej.isNullOrUndefined(u)?++r:n[0][1][0]<this._previousRowCellIndex[0][1][0]?--r:n[0][1][0]==this._previousRowCellIndex[0][1][0]?n[0][2][0]<this._previousRowCellIndex[0][2][0]?--r:++r:++r;ej.isNullOrUndefined(u)&&(this._previousRowCellIndex=this._currentRowCellIndex=[[0,[0],[0]]],u=this._getCardbyIndexes(this._previousRowCellIndex));this._selectedCards=[];this._selectedCards[this._selectedCards.length]=b;!ej.isNullOrUndefined(u)||i.ctrlKey||i.shiftKey||this._enableMultiTouch||($(t).addClass("e-cardselection"),this._selectedCards.push(t[0]),this._selectedCardData.push(this._getKanbanCardData(this._currentJsonData,t.id)[0]),this._pushIntoSelectedArray(n))}if(this.model.selectionType=="multiple"&&(i.ctrlKey||this._enableMultiTouch))if($(t).hasClass("e-cardselection")){for($(t).removeClass("e-cardselection"),this._popFromSelectedArray(n[0][0],n[0][1],n[0][2],i),o=0;o<this._selectedCardData.length;o++)if(e[0][this.model.fields.primaryKey]==this._selectedCardData[0][this.model.fields.primaryKey])break;this._selectedCardData.splice(o,1);this._selectedCards.splice(o,1);this._currentRowCellIndex=n}else $(t).addClass("e-cardselection"),this._selectedCards.push(t[0]),this._pushIntoSelectedArray(n),this._selectedCardData.push(e[0]);else this.model.selectionType=="multiple"&&i.shiftKey||(y=n[0][2],this.element.find(".e-cardselection").removeClass("e-cardselection"),this._selectedCards=[],this.selectedRowCellIndexes=[],$(t).addClass("e-cardselection"),this._selectedCardData=[],this._selectedCardData.push(e[0]),this._selectedCards.push(t[0]),this.model.selectionType=="multiple"&&(y=[n[0][2]]),this.selectedRowCellIndexes.push({rowIndex:n[0][0],cellIndex:n[0][1],cardIndex:y}));(s={currentCell:h,target:t,cellIndex:n[0][1][0],cardIndex:n[0][2][0],data:e,selectedRowCellIndex:this.selectedRowCellIndexes,previousRowCellIndex:this._previousRowCellIndex,previousCard:u,selectedCardsData:this._selectedCardData},this.model.selectionType=="multiple"&&i.shiftKey&&$(t).hasClass("e-cardselection")?(this._previousRowCellIndex.length==0&&(this._currentRowCellIndex=[[t.parents(".e-columnrow").index(),[0],[0]]]),this._currentRowCellIndex.length==0&&(this._currentRowCellIndex=n)):$(t).hasClass("e-cardselection")&&(this._currentRowCellIndex=n),this._trigger("cardSelect",s))||this.element.focus()}},i.prototype._pushIntoSelectedArray=function(n){for(var i=0,u=!0,f=!0,r,e,t=0;t<this.selectedRowCellIndexes.length;t++)if(r=this.selectedRowCellIndexes[t],r.rowIndex==n[0][0]){for(u=!1,i=0;i<r.cellIndex.length;i++)if(e=r.cellIndex[i],e==n[0][1][0]){f=!1;break}break}u&&this.selectedRowCellIndexes.push({rowIndex:n[0][0],cellIndex:n[0][1],cardIndex:[n[0][2]]});f?u||(this.selectedRowCellIndexes[t].cellIndex.push(n[0][1][0]),this.selectedRowCellIndexes[t].cardIndex.push([n[0][2][0]])):this.selectedRowCellIndexes[t].cardIndex[i].push(n[0][2][0])},i.prototype._popFromSelectedArray=function(n,t,i,r){var e,f,o,u,s,h;if(this.model.selectionType=="multiple"&&(r.ctrlKey||r.shiftKey||this._enableMultiTouch))for(e=0;e<this.selectedRowCellIndexes.length;e++)if(u=this.selectedRowCellIndexes[e],u.rowIndex==n)for(f=0;f<u.cellIndex.length;f++)if(s=u.cellIndex[f],s==t[0])if(r.shiftKey){u.cardIndex=[];break}else for(o=0;o<u.cardIndex[f].length;o++)if(h=u.cardIndex[f][o],h==i[0]){u.cardIndex[f].splice(o,1);u.cardIndex[f].length==0&&(u.cardIndex.splice(f,1),u.cellIndex.splice(f,1));u.cellIndex.length==0&&this.selectedRowCellIndexes.splice(e,1);break}},i.prototype.toggleSwimlane=function(n){var t,i,r;if(typeof n=="string"||typeof n=="number")t=this._removeIdSymbols(n),i=this.element.find("tr[id="+t+"]"),this._toggleSwimlaneRow($(i).find(".e-rowcell .e-slexpandcollapse"));else if(typeof n=="object"&&n[0].nodeName!="DIV")for(r=0;r<n.length;r++)t=this._removeIdSymbols(n[r]),i=this.element.find("tr[id="+t+"]"),this._toggleSwimlaneRow($(i).find(".e-rowcell .e-slexpandcollapse"));else this._toggleSwimlaneRow(n)},i.prototype._toggleSwimlaneRow=function(n){var f,i,e,r,u,t,o;if(n=n.hasClass("e-slexpandcollapse")?n.find("div:first"):n,n.hasClass("e-slexpand")||n.hasClass("e-slcollapse")){if(f=n.closest("tr"),f.next(".e-collapsedrow").remove(),i=f.next(),n.hasClass("e-slexpand")){for(i.hide(),e=ej.buildTag("tr","",{},{"class":"e-collapsedrow"}),r=this.model.columns,t=0;t<r.length;t++)u=ej.buildTag("td","",{},{"class":"e-rowcell",role:"kanbancell"}),r[t].visible||u.addClass("e-hide"),r[t].isCollapsed&&u.addClass("e-shrink"),e.append(u);i.before(e);n.removeClass("e-slexpand").addClass("e-slcollapse")}else i.show(),n.removeClass("e-collapsedrow").removeClass("e-slcollapse").addClass("e-slexpand");this.model.allowScrolling&&(o=this.headerContent.find(".e-hscrollcss"),this._refreshScroller({requestType:"refresh"}),this.getContent().find(".e-vscrollbar").length>0?o.removeClass("e-vscroll-area"):o.addClass("e-vscroll-area"))}},i.prototype.getScrollObject=function(){return(this._scrollObject==null||ej.isNullOrUndefined(this._scrollObject.model))&&(this._scrollObject=this.getContent().ejScroller("instance")),this._scrollObject},i.prototype.getIndexByRow=function(n){return $(this._columnRows).index(n)},i.prototype._initialize=function(){},i.prototype._initPrivateProperties=function(){this.currentViewData=null;this._dataManager=this._dataSource()instanceof ej.DataManager?this._dataSource():this._dataSource()!=null?new ej.DataManager(this._dataSource()):null;this._originalWidth=this.element.width();this._recordsCount=this._dataSource()!==null?this._dataSource().length:0;ej.Kanban.Locale["default"]=ej.Kanban.Locale["en-US"]={EmptyCard:"No cards to display",SaveButton:"Save",CancelButton:"Cancel",EditFormTitle:"Details of ",AddFormTitle:"Add New Card",SwimlaneCaptionFormat:"- {{:count}}{{if count == 1 }} item {{else}} items {{/if}}",FilterSettings:"Filters:",FilterOfText:"of",Max:"Max",Min:"Min",Cards:"  Cards"};this.localizedLabels=this._getLocalizedLabels()},i.prototype._init=function(){if(this._initPrivateProperties(),this._trigger("load"),!ej.isNullOrUndefined(this.model.query)&&this.model.query instanceof ej.Query||(this.model.query=new ej.Query),this._initSubModules(),this._initialize(),this.model.columns.length==0)return!1;this._kbnAdaptSwimlaneData();this.element.removeClass("e-kanbanscroll");this._initScrolling();this._checkDataBinding()},i.prototype._kbnAdaptSwimlaneData=function(){var i=this,n,t;this.model.isResponsive&&(ej.isNullOrUndefined(this.model.minWidth)||this.model.minWidth==0)&&!ej.isNullOrUndefined(this.model.fields.swimlaneKey)&&(n=new ej.Query,ej.isNullOrUndefined(this.model.keyField)||this._addColumnFilters(),this.model.query._fromTable!=""&&n.from(this.model.query._fromTable),this._dataSource()instanceof ej.DataManager&&n.queries.length&&!this._dataManager.dataSource.offline?(t=this._dataSource().executeQuery(n),t.done(ej.proxy(function(t){this._kbnAdaptDdlData=new ej.DataManager(t.result);n=(new ej.Query).where(ej.Predicate.or(this.keyPredicates)).select(this.model.fields.swimlaneKey);this._kbnAdaptDdlData=this._kbnAdaptDdlData.executeLocal(n);this._kbnAdaptDdlData=ej.dataUtil.mergeSort(ej.dataUtil.distinct(this._kbnAdaptDdlData))}))):(n=(new ej.Query).where(ej.Predicate.or(this.keyPredicates)).select(this.model.fields.swimlaneKey),this._dataManager.dataSource.offline&&this._dataManager.dataSource.json.length&&(this._kbnAdaptDdlData=this._dataManager.executeLocal(n)),this._kbnAdaptDdlData=ej.dataUtil.mergeSort(ej.dataUtil.distinct(this._kbnAdaptDdlData))))},i.prototype._initSubModules=function(){var n=this.model;n.allowDragAndDrop&&(this.KanbanDragAndDrop=new ej.KanbanFeatures.DragAndDrop(this));(n.editSettings.allowEditing||n.editSettings.allowAdding)&&(this.KanbanEdit=new ej.KanbanFeatures.Edit(this))},i.prototype._initScrolling=function(){(this.model.width||this.model.height)&&(this.model.allowScrolling=!0,this.model.width&&(this.model.scrollSettings.width=this.model.width),this.model.height&&(this.model.scrollSettings.height=this.model.height));this._originalScrollWidth=this.model.scrollSettings.width},i.prototype._setResponsiveHeightWidth=function(){typeof this.model.scrollSettings.width=="string"?this._originalScrollWidth=this.element.width():this.model.scrollSettings.width>0&&(this._originalScrollWidth=this.model.scrollSettings.width);typeof this.model.scrollSettings.height=="string"?this._originalScrollHeight=this.getContent().height():this.model.scrollSettings.height>0&&(this._originalScrollHeight=this.model.scrollSettings.height);this.model.isResponsive&&($(window).bind("resize",$.proxy(this._kanbanWindowResize,this)),this._kanbanWindowResize())},i.prototype._renderResponsiveKanban=function(n,t,i,r,u){var f;n?(this.model.scrollSettings.width=ej.isNullOrUndefined(this._originalScrollWidth)?Math.min(i,u):Math.min(this._originalScrollWidth,Math.min(i,u)),f=Math.min(r,t),f=ej.isNullOrUndefined(this._originalScrollHeight)?f:Math.min(this._originalScrollHeight,r),this.model.scrollSettings.height=f,this._originalScrollWidth<u&&(this.model.scrollSettings.width=Math.min(i,u)),this._renderScroller()):(this.model.scrollSettings.width="100%",ej.isNullOrUndefined(this._originalScrollWidth)||(this.model.scrollSettings.width=Math.min(this._originalScrollWidth,i)),f=this.element.outerHeight(),ej.isNullOrUndefined(this._originalScrollHeight)||(f=Math.min(this._originalScrollHeight,r)),this.model.scrollSettings.height=f,this._renderScroller())},i.prototype._kanbanWindowResize=function(){var e=this.element.find(".e-kanbantoolbar"),c=this.model.fields.swimlaneKey,i,it,u,r,t,b,k,f,d,l,a,n,v,g,y,s,nt,h,p,o,w,tt;if(this.model.isResponsive&&(ej.isNullOrUndefined(this.model.minWidth)||this.model.minWidth==0))if(it=this.element.find(".e-kanbanfilter-window"),window.matchMedia("(max-width: 480px)").matches){if(this.element.hasClass("e-responsive")||(this.element.addClass("e-responsive"),e.css("display","table"),e.find(".e-searchdiv").hide(),e.find(".e-search").css({border:"none"}),ej.isNullOrUndefined(c)||this._kbnAdaptSwimlaneDdl(),this.model.filterSettings.length>0&&(this._kbnAdaptFilterWindow(),this._kbnFilterCollection=this._filterCollection.slice())),!this.element.hasClass("e-swimlane-responsive"))for(u=this.element.find(".e-rowcell:visible"),n=0;n<u.length;n++)u.eq(n).height()>$(window).height()&&(r=u.eq(n).find(".e-cell-scrollcontent"),r.length>0?r.ejScroller({height:$(window).height()-(this.kanbanContent.offset().top+2)}):(r=ej.buildTag("div.e-cell-scrollcontent","<div><\/div>"),u.eq(n).append(r),r.children().append(u.eq(n).children(":not('.e-cell-scrollcontent')")),r.ejScroller({height:$(window).height()-(this.kanbanContent.offset().top+2),thumbStart:$.proxy(this._kbnThumbStart,this)})));if(this._columnTimeoutAdapt(),i=this.element.find(".e-searchbar"),i.length>0&&i.find(".e-ejinputtext").val().length>0&&(t=i.find(".e-searchitem"),t.addClass("e-searchfind"),t.prev().show(),i.siblings().hide(),i.find(".e-adapt-search").length==0&&(b=ej.buildTag("div.e-icon e-adapt-search e-searchfind","",{}),k=ej.buildTag("div.e-icon e-adapt-cancel e-cancel","",{}),t.siblings(".e-searchdiv").append(k).prepend(b)),t.parents(".e-search").css({border:""}),t.parents("body").removeClass("e-kbnwindow-modal"),t.parents(".e-kanbantoolbar").addClass("e-adaptive-search"),i.find(".e-adapt-cancel").show(),t.hide()),this.model.filterSettings.length>0)for(f=this.element.find(".e-quickfilter").nextAll(".e-tooltxt"),n=0;n<f.length;n++)f.eq(n).hasClass("e-select")&&(d=f.index(f.eq(n)),l=this.element.find(".e-kanbanfilter-icon"),this._kbnAutoFilterCheck=!0,this.element.find(".e-filter-content span.e-chkbox-wrap").eq(d).click(),this._kbnAutoFilterCheck=!1,l.hasClass("e-kbnclearfl-icon")||l.addClass("e-kbnclearfl-icon"),f.eq(n).removeClass("e-select"));if(ej.isNullOrUndefined(c)||this.kanbanContent.ejScroller({height:$(window).height()-this.kanbanContent.offset().top,scroll:$.proxy(this._freezeSwimlane,this),thumbStart:$.proxy(this._kbnThumbStart,this)}),!this.element.hasClass("e-swimlane-responsive"))for(a=this.element.find(".e-rowcell .e-cell-scrollcontent:visible"),n=0;n<a.length;n++)v=$(a[n]).data("ejScroller"),ej.isNullOrUndefined(v)||v.refresh();g=this.element.find(".e-kanbandialog");y=this.element.find(".e-swimlane-window");g.is(":visible")&&this.KanbanEdit._setAdaptEditWindowHeight();!ej.isNullOrUndefined(c)&&y.is(":visible")&&(s=this.element.find(".e-slwindow-scrollcontent"),nt=this.headerContent.offset().top,s.ejScroller({height:$(window).height()-s.offset().top}),s.data("ejScroller").refresh(),y.css({height:$(window).height()-nt}))}else this._removeKbnAdaptItems();else this.model.scrollSettings.width=this._originalScrollWidth,this.element.outerWidth("100%"),this.getContentTable().width("100%"),this.getHeaderTable().width("100%"),h=this.element.outerWidth(),p=$(window).width()-this.element.offset().left,o=$(window).height()-this.element.offset().top,e.length>0&&(o=o-(e.outerHeight()+25)),w=this.headerContent.outerHeight()+this.getContentTable().height(),tt=this.model.minWidth>h||p<=h||o<=w,this._renderResponsiveKanban(tt,w,h,o,p)},i.prototype._columnTimeoutAdapt=function(){var t=this.element.width()*(80/100),f,e,u,n=this,o,i,r;for(f=this.element.find(".e-headercell"),e=this.element.find(".e-columnrow .e-rowcell"),this.kanbanContent.find("table:eq(0) > colgroup col").width(t),e.width(t),this.headerContent.find("table > colgroup col").width(t),f.not(".e-stackedHeaderCell").width(t),u=this.element.find(".e-stackedHeaderCell"),r=0;r<u.length;r++)$(u).eq(r).width(parseInt($(u).eq(r).attr("colspan"))*t);o=setTimeout(function(){if(n._kbnSwipeCount>0){i=e.eq(n._kbnSwipeCount);i.length==0&&(i=f.not(".e-stackedHeaderCell").eq(this._kbnSwipeCount));n._kbnSwipeWidth=n._kbnSwipeWidth-i.offset().left;var r=n.element.width(),u=i.width();t=n._kbnSwipeCount==n.model.columns.length-1?n.element.hasClass("e-swimlane-responsive")?r-(u+18):r-u:(r-u)/2;n._kbnSwipeWidth=n._kbnSwipeWidth+t;n.headerContent.find("table").css({transform:"translate3d("+n._kbnSwipeWidth+"px, 0px, 0px)","transition-duration":"0ms"});n.kanbanContent.find("table").eq(0).css({transform:"translate3d("+n._kbnSwipeWidth+"px, 0px, 0px)","transition-duration":"0ms"});clearTimeout(o)}},2500)},i.prototype._addSwimlaneName=function(){for(var r,t,n,u,f=this.element.find(".e-columnrow"),i=0;i<f.length;i++)for(r=f.eq(i).find(".e-rowcell"),t=0;t<r.length;t++)n=r.eq(t).find(".e-limits"),n.length==0&&(n=ej.buildTag("div.e-limits","",{},{})),n.find(".e-swimlane-name").length==0?(n.append(ej.buildTag("div.e-swimlane-name",this._kbnAdaptDdlData[i],{},{})),r.eq(t).prepend(n)):(u=n.find(".e-swimlane-name"),u.show(),u.parents(".e-limits").show())},i.prototype._kbnAdaptSwimlaneDdl=function(){var t=ej.buildTag("div.e-swimlane-ddl","",{}),e=this.model.fields.swimlaneKey,i,r,u,f=this.element.find(".e-kanbantoolbar"),n;for(this.element.addClass("e-swimlane-responsive"),ej.buildTag("div.e-swimlane-text",this._kbnAdaptDdlData[0]).appendTo(t),ej.buildTag("div.e-swimlane-arrow").appendTo(t),i=ej.buildTag("div.e-swimlane-window","",{}),r=ej.buildTag("ul.e-swimlane-ul ","",{}),n=0;n<this._kbnAdaptDdlData.length;n++)ej.buildTag("li.e-swimlane-item ","<div>"+this._kbnAdaptDdlData[n]+"<\/div>",{}).appendTo(r);this._addSwimlaneName();u=ej.buildTag("div#"+this._id+"_slScrollContent","<div><\/div>").addClass("e-slwindow-scrollcontent");u.children().append(r);u.appendTo(i);i.appendTo(this.element).hide();f.length==0&&(this._renderToolBar().insertBefore(this.element.find(".e-kanbanheader").first()),f=this.element.find(".e-kanbantoolbar").css("padding-top","0px"));f.prepend(t);this.element.find(".e-swimlanerow").hide()},i.prototype._kbnAdaptFilterWindow=function(){var s=this.element.find(".e-kanbantoolbar"),t,f,r,e,h,i,o,n,u;for(s.find(".e-quickfilter").parent().hide(),i=ej.buildTag("div.e-kanbanfilter-window","",{}),t=ej.buildTag("div.e-kbnfilterwindow-head","",{}),ej.buildTag("div.e-filterback-icon","",{}).appendTo(t),ej.buildTag("div.e-text","FILTER",{}).appendTo(t),ej.buildTag("div.e-text e-filter-done","DONE",{}).appendTo(t).hide(),t.appendTo(i),this.element.append(i.hide()),f=ej.buildTag("div.e-kbnfilterwindow-body","",{}),e=ej.buildTag("div.e-filter-content"),n=0;n<this.model.filterSettings.length;n++)u=ej.buildTag("div","",{}),u.append("<input type='checkbox' class='e-kbnfilter-check' id='check"+n+"' /><label for='check"+n+"' class='e-filterlabel'>"+this.model.filterSettings[n].text+"<\/label><\/td>"),e.append(u),u.find("input").ejCheckBox({change:$.proxy(this._kbnFilterChange,this)});f.append(e);o=ej.buildTag("div#"+this._id+"_filterScrollContent","<div><\/div>").addClass("e-filter-scrollcontent");o.children().append(f);o.appendTo(i);r=ej.buildTag("input.e-clearfilter","",{},{type:"button",id:this._id+"_ClearFilter"});r.ejButton({text:"ClearFilter"});i.append(r);r.hide();h=ej.buildTag("div.e-kanbanfilter-icon","",{float:"right"});s.append(h)},i.prototype._removeKbnAdaptItems=function(){var r,g,h,c,u,l,nt,f,a,v,y,n,p,o,e,w;if(this.element.hasClass("e-responsive")){var t=this.element.find(".e-kanbantoolbar"),b=this.element.find(".e-stackedHeaderCell"),s,k=this.element.find(".e-swimlane-ddl"),d=this.element.find(".e-kanbanfilter-window"),i;if(k.length>0&&(k.remove(),this.element.find(".e-swimlane-window").remove()),d.length>0){for(r=this.element.find(".e-filter-content").children(),n=0;n<r.length;n++)r.eq(n).find("span.e-chkbox-wrap").attr("aria-checked")=="true"&&(g=r.index(r.eq(n)),this.element.find(".e-quickfilter").nextAll("li.e-tooltxt").eq(g).addClass("e-select"));d.remove()}if(b.length>0&&b.width(""),this.element.find(".e-rowcell,.e-headercell").width(""),this.kanbanContent.find("table:eq(0) > colgroup col").width(""),this.headerContent.find("table > colgroup col").width(""),!this.element.hasClass("e-swimlane-responsive"))for(s=this.element.find(".e-rowcell .e-cell-scrollcontent:visible"),n=0;n<s.length;n++)h=$(s[n]).data("ejScroller"),ej.isNullOrUndefined(h)||h.destroy();for(t.length>0&&t.is(":visible")&&(t.css("display","block"),c=t.find(".e-quickfilter"),u=t.find(".e-searchbar"),t.find(".e-adapt-cancel").is(":visible")&&u.find(".e-searchitem").addClass("e-cancel").removeClass("e-searchfind"),t.find(".e-adapt-cancel,.e-adapt-search").hide(),c.length>0&&(t.find(".e-kanbanfilter-icon").remove(),c.parent(".e-ul.e-horizontal").show()),l=u.find(".e-searchdiv"),l.length>0&&(l.show(),u.find(".e-search").css("border",""),u.find(".e-searchitem").show(),t.parents("body").removeClass("e-kbnwindow-modal"),t.removeClass("e-adaptive-search"))),this.headerContent.find("table").css({transform:"","transition-duration":""}),this.kanbanContent.find("table").eq(0).css({transform:"","transition-duration":""}),i=this.element.find(".e-cell-scrollcontent"),n=0;n<i.length;n++)nt=i.eq(n).children(),nt.children().appendTo(i.eq(n).parents(".e-rowcell")),i.eq(n).remove();if(f=this.element.find(".e-kanbandialog"),f.is(":visible")&&(a=f.parents(".e-dialog-scroller"),v=f.parents(".e-dialog"),v.css({top:"",left:""}).removeClass("e-kbnadapt-editdlg"),a.css("height","auto"),a.ejScroller({height:0}),f.parents("body").removeClass("e-kbnwindow-modal"),v.hide(),this.KanbanEdit._onKbnDialogOpen()),!ej.isNullOrUndefined(this.model.fields.swimlaneKey))for(this.kanbanContent.hasClass("e-scroller")&&this.kanbanContent.data("ejScroller").destroy(),this.element.parents("body").removeClass("e-kbnwindow-modal"),this.element.find(".e-swimlanerow").show(),y=this.element.find(".e-columnrow"),n=0;n<y.length;n++)for(p=y.eq(n).find(".e-rowcell"),o=0;o<p.length;o++)e=p.eq(o).find(".e-swimlane-name"),e.length>0&&(e.siblings().length==0?e.parents(".e-limits").hide():e.hide());w=this.element.find(".e-adapt-stheader");w.length>0&&w.find("div").css({position:"",left:""});this.element.removeClass("e-responsive");this.element.removeClass("e-swimlane-responsive")}},i.prototype._initKanbanRender=function(){var n=this,t;this._addInitTemplate();this.model.keySettings&&$.extend(this.model.keyConfigs,this.model.keySettings);this._render();this._trigger("dataBound",{});this.model.contextMenuSettings.enable&&(this._dataManager.dataSource.offline?this._renderContext():(t=n._dataSource().executeQuery(ej.isNullOrUndefined(n.model.fields.swimlaneKey)?new ej.Query:(new ej.Query).select([n.model.fields.swimlaneKey])),t.done(ej.proxy(function(t){n._contextSwimlane=new ej.DataManager(t.result);n._renderContext()}))));this.KanbanEdit&&(this.KanbanEdit._processEditing(),this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?this.element.append(this.KanbanEdit._renderDialog()):(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&this.element.append(this.KanbanEdit._renderExternalForm()));this._setResponsiveHeightWidth();this._renderKanbanTouchBar();this._wireEvents();this.model.tooltipSettings.enable&&(this.element.append($("<div class='e-kanbantooltip'><\/div>")),this.element.find(".e-kanbantooltip").hide());this.initialRender=!1},i.prototype._renderKanbanTouchBar=function(){this._kTouchBar=ej.buildTag("div.e-kanbantouchbar","",{display:"none"},{});var n=ej.buildTag("div.e-content","",{},{}),t=ej.buildTag("div.e-downtail e-tail","",{},{}),i=ej.buildTag("span.e-cardtouch e-icon","",{},{});n.append(i);this._kTouchBar.append(n);this._kTouchBar.append(t);this.element.append(this._kTouchBar)},i.prototype._addLastRow=function(){var i=this.getContentTable().find("tr:last").find("td"),t=0,n;if(this.model.allowScrolling&&!ej.isNullOrUndefined(this.model.dataSource)&&!ej.isNullOrUndefined(this._kanbanRows)){for(n=0;n<this._kanbanRows.length;n++)t+=$(this._kanbanRows[n]).height();t<this.getContent().height()-1&&i.addClass("e-lastrowcell")}},i.prototype._render=function(){this.element.addClass(this.model.cssClass+"e-widget");this._renderContent().insertAfter(this.element.children(".e-kanbanheader"));this._renderLimit();this._enableDragandScroll();this.initialRender&&this._addLastRow()},i.prototype._renderHeader=function(){var f=ej.buildTag("div.e-kanbanheader","",{},{}),h=ej.buildTag("div","",{},{}),w=$(document.createElement("colgroup")),o,k,t,v,nt,u,tt,it,y,rt,p,ut;ej.isNullOrUndefined(this.model.fields.swimlaneKey)||f.addClass("e-slheader");this.model.allowScrolling&&h.addClass("e-headercontent");f.append(h);var e=ej.buildTag("table.e-table","",{},{cellspacing:"0.25px",role:"kanban"}),c=ej.buildTag("thead","",{},{}),b=ej.buildTag("tbody.e-hide","",{},{});for(o=0;o<this.model.stackedHeaderRows.length;o++)k=this._createStackedRow(this.model.stackedHeaderRows[o]),c.append(k);var d=ej.buildTag("tr.e-columnheader","",{},{}),g=$(document.createElement("tr")),i=this.model.columns;for(this._visibleColumns=[],this._expandedColumns=[],this._headerColumnNames={},t=0;t<i.length;t++){var n=i[t],r=ej.buildTag("th.e-headercell","",{},{role:"columnheader"}),s=document.createElement("col"),ft=document.createElement("td"),l=ej.buildTag("div.e-headercelldiv","",{},{}),a=ej.buildTag("div.e-headerdiv",n.headerText!=null?n.headerText:n.key,{},{});ej.isNullOrUndefined(n.headerTemplate)||a.html($(n.headerTemplate).hide().html());u=null;this.model.enableTotalCount&&(v=ej.buildTag("div.e-totalcard","",{},{}),nt=ej.buildTag("span.e-totalcount","",{},{}),v.append("[").append(nt).append("]"),a.append(v));ej.isNullOrUndefined(n.constraints)||(tt=!ej.isNullOrUndefined(n.constraints.min),it=!ej.isNullOrUndefined(n.constraints.max),u=ej.buildTag("div.e-limits","",{},{}),tt&&(y=ej.buildTag("div.e-min",this.localizedLabels.Min+" [","",{}),rt=ej.buildTag("span.e-minlimit",n.constraints.min.toString(),"",{}),y.append(rt).append("]"),u.append(y)),it&&(p=ej.buildTag("div.e-max",this.localizedLabels.Max+" [","",{}),ut=ej.buildTag("span.e-maxlimit",n.constraints.max.toString(),"",{}),p.append(ut).append("]"),u.append(p)));l.append(a).append(u);r.append(l);this.model.allowToggleColumn&&(i[t].isCollapsed===!0?r.append(ej.buildTag("div.e-icon e-clcollapse","",{},{})).addClass("e-shrinkcol"):r.append(ej.buildTag("div.e-icon e-clexpand","",{},{})));i[t].isCollapsed===!0&&this.model.allowToggleColumn?(r.find(".e-headercelldiv").addClass("e-hide")&&$(s).addClass("e-shrinkcol"),$.inArray(i[t].headerText,this._collapsedColumns)==-1&&this._collapsedColumns.push(i[t].headerText)):(r.find(".e-headercelldiv").removeClass("e-hide")&&$(s).removeClass("e-shrinkcol"),this._expandedColumns.push(i[t].headerText),i[t].isCollapsed=!1);w.append(s);d.append(r);g.append(ft);n.visible===!1?(r.addClass("e-hide")&&$(s).css("display","none"),$.inArray(n.headerText,this._hiddenColumns)==-1&&this._hiddenColumns.push(n.headerText)):(this._visibleColumns.push(n.headerText),n.visible=!0);ej.isNullOrUndefined(n.headerTemplate)||l.parent().addClass("e-headertemplate");this.initialRender&&(typeof n.width=="string"&&n.width.indexOf("%")!=-1?this._columnsWidthCollection.push(parseInt(n.width)/100*this.element.width()):this._columnsWidthCollection.push(n.width))}return c.append(d),e.append(w).append(c),b.append(g),e.append(b),h.append(e),this.setHeaderContent(f),this.setHeaderTable(e),f},i.prototype._renderContent=function(){var t=ej.buildTag("div.e-kanbancontent","",{},{}),i=ej.buildTag("div","",{},{}),u=ej.buildTag("tbody","",{},{}),n=ej.buildTag("table.e-table","",{},{cellspacing:"0.25px",role:"kanban"}),r;return n.append(this.getHeaderTable().find("colgroup").clone()).append(u),i.append(n),t.append(i),this.setContent(t),this.setContentTable(n),n.attr("role","kanban"),r={requestType:"refresh"},this.sendDataRenderingRequest(r),t},i.prototype.refreshTemplate=function(){this._addInitTemplate();(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&this.KanbanEdit._addDialogEditingTemplate()},i.prototype.getContentTable=function(){return this.contentTable},i.prototype.setContentTable=function(n){this.contentTable=n},i.prototype.getVisibleColumnNames=function(){return this._visibleColumns},i.prototype.getHeaderContent=function(){return this.headerContent},i.prototype.setHeaderContent=function(n){this.headerContent=n},i.prototype.getContent=function(){return this.kanbanContent},i.prototype.setContent=function(n){this.kanbanContent=n},i.prototype._initDataSource=function(){var n=this,t;this._isLocalData=!(this._dataSource()instanceof ej.DataManager)||this._dataSource().dataSource.offline;this._ensureDataSource();this._trigger("actionBegin");t=this._dataSource().executeQuery(this.model.query);this.element.is(":visible")||this.element.ejWaitingPopup("hide");t.done(ej.proxy(function(t){n.element.ejWaitingPopup("hide");n._currentJsonData=n.currentViewData=t.result;n._recordsCount=t.count==0&&t.result.length?t.result.length:t.count;n._initKanbanRender()}))},i.prototype._stackedHeadervisible=function(){for(var t=this.element.find(".e-columnheader .e-stackedHeaderCell "),n=0;n<t.length;n++)t[n].offsetWidth<t[n].scrollWidth&&t.eq(n).find("div").addClass("e-hide")},i.prototype._renderContext=function(){var s,h,c,e,t,i,n,u,v,l,r,y,o,f,a;for(s=this.model.contextMenuSettings.menuItems,r=ej.buildTag("ul","",{},{id:this._id+"_Context"}),y=this.model.contextMenuSettings.disableDefaultItems,n=0;n<s.length;n++)t=s[n].menuItem,$.inArray(t,y)==-1&&(i=this._items(t,"menuItem")),r.append(i);for(o=this.model.contextMenuSettings.customMenuItems,u=0;u<o.length;u++)v=o[u].text,l=this._items(v,"custom"),o[u].template&&l.append($(o[u].template)),r.append(l);for(f=ej.buildTag("ul","",{},{id:this._id+"_SubContext"}),n=0;n<this.model.columns.length;n++)t=this.model.columns[n].headerText,h=ej.buildTag("div","",{},{"class":"e-visiblecolumns"}),c=ej.buildTag("input","",{},{type:"checkbox",name:t}),i=this._items(t,"subMenuItem"),h.append(c),i.prepend(h),f.append(i),c.ejCheckBox({checked:this.model.columns[n].visible});if($(r).find("li.e-column.e-visiblecolumn").append(f),this.model.fields.swimlaneKey){for(f=ej.buildTag("ul","",{},{id:this._id+"_SubContext"}),a=(new ej.Query).select([this.model.fields.swimlaneKey]),e=this._dataManager.dataSource.offline?this._dataManager.executeLocal(a):this._contextSwimlane.executeLocal(a),e=ej.dataUtil.mergeSort(ej.dataUtil.distinct(e)),n=0;n<e.length;n++)t=e[n],i=this._items(t,"subMenuItem"),f.append(i);$(r).find("li.e-move.e-swimlane").append(f)}$(r).ejMenu({menuType:ej.MenuType.ContextMenu,openOnClick:!1,contextMenuTarget:"#"+this._id,click:$.proxy(this._clickevent,this),width:"auto",cssClass:"e-kanban-context",beforeOpen:$.proxy(this._menu,this),open:$.proxy(this._contextopen,this)});this._conmenu=r.data("ejMenu")},i.prototype._contextopen=function(){var n=this._conmenu.element;n.length>0&&(n.find("li").is(":visible")||n.css("visibility","hidden"))},i.prototype._clickevent=function(n){var r,t,i,e,f,u,o;if(u=n.parentText!=null?n.parentText:n.events.text,r=$(this._contexttarget),n.targetelement=this._contexttarget,t=r.closest(".e-kanbancard"),i=t.length,!this._trigger("contextClick",n))switch(u){case"Add Card":this._isAddNewClick=!0;this._newCard=$(this._contexttarget);this.KanbanEdit&&this.KanbanEdit.addCard();break;case"Edit Card":i>0&&!ej.isNullOrUndefined(this.model.fields.primaryKey)&&this.KanbanEdit&&this.KanbanEdit.startEdit(t);break;case"Hide Column":r.closest(".e-headercell").find(".e-headercelldiv").length>0&&this.hideColumns($.trim(r.closest(".e-headercell").find(".e-headercelldiv .e-headerdiv").text()).split("[")[0]);break;case"Delete Card":!ej.isNullOrUndefined(this.model.fields.primaryKey)&&t.length>0&&this.KanbanEdit&&this.KanbanEdit.deleteCard(t.attr("id"));break;case"Move Right":i>0&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._dropToColumn($(this._contexttarget).closest("td.e-rowcell").next(),t);break;case"Move Left":i>0&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._dropToColumn($(this._contexttarget).closest("td.e-rowcell").prev(),t);break;case"Move Up":i>0&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._dropAsSibling(t.prev(),t,!1);break;case"Move Down":i>0&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._dropAsSibling(t.next(),t,!0);break;case"Top of Row":i>0&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._dropAsSibling(r.closest("td.e-rowcell").find(".e-kanbancard").first(),t,!1);break;case"Bottom of Row":i>0&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._dropAsSibling(r.closest("td.e-rowcell").find(".e-kanbancard").last(),t,!0);break;case"Move to Swimlane":u!=n.text&&i>0&&(e=r.closest(".e-kanbancard").attr("id"),f=new ej.DataManager(this._currentJsonData).executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,e))[0],f[this.model.fields.swimlaneKey]=n.text,u={data:f,requestType:"save",primaryKeyValue:f[this.model.fields.primaryKey]},this._saveArgs=u,this.updateCard(e,f),this._saveArgs=null);break;case"Visible Columns":u!=n.text&&(o=$(n.element.parentElement).find("li").index(n.element),this.model.columns[o].visible?(this.hideColumns(n.text),$($(n.element).find("input.e-checkbox")).ejCheckBox({checked:!1})):(this.showColumns(n.text),$($(n.element).find("input.e-checkbox")).ejCheckBox({checked:!0})))}},i.prototype._menu=function(n){var t,u,c,y,l,f,p,e,r,o,i,a,s,v,h;if(t=this._conmenu.element,this._contexttarget=n.target,u=$(n.target),c=$(this._contexttarget).closest("td.e-rowcell"),y=$(this._contexttarget).closest("tr.e-columnrow"),l=u.closest(".e-rowcell"),f=$(u).closest(".e-kanbancard"),p=this.model.contextMenuSettings.menuItems,t.css("visibility","visible"),t.find("li").hide(),u.closest(".e-kanban").attr("id")!==this._id){t.css("visibility","hidden");return}if(t.find(".e-customitem").length>0)for(e=this.model.contextMenuSettings.customMenuItems,r=t.find(".e-customitem"),i=0;i<r.length;i++)if(e[i].target||(e[i].target="all"),e[i].target&&e[i].text==t.find(".e-customitem").children("a").eq(i).text())switch(e[i].target){case"content":this.getContentTable().find(u).length>0?($(r[i]).show(),$(r[i]).find("li").length>0&&$(r[i]).find("li").show()):$(r[i]).hide();break;case"header":this.getHeaderContent().find(u).length>0?($(r[i]).show(),$(r[i]).find("li").length>0&&$(r[i]).find("li").show()):$(r[i]).hide();break;case"card":this.element.find(".e-kanbancard").find(u).length>0?($(r[i]).show(),$(r[i]).find("li").length>0&&$(r[i]).find("li").show()):$(r[i]).hide();break;case"all":$(r[i]).show();$(r[i]).find("li").length>0&&$(r[i]).find("li").show()}if(this.getContentTable().find(u).length>0){if(l.length==0){t.css("visibility","hidden");return}if($(u).closest(".e-swimlanerow").length>0){t.css("visibility","hidden");return}f.length>0?(v=$(u).closest("td.e-rowcell").find(".e-kanbancard"),s=v.index(f),a=v.length,$(t.find("li").not(".e-customitem")).hide(),$(t.find(".e-customitem li")).show(),!ej.isNullOrUndefined(this.model.fields.primaryKey)&&this.model.editSettings.allowEditing&&t.find(".e-content.e-cardedit").show(),s>1&&t.find(".e-move.e-up").show(),s!=a-1&&t.find(".e-row.e-bottom").show(),s!=0&&t.find(".e-row.e-top").show(),a-1-s>1&&t.find(".e-move.e-down").show(),c.next().length>0&&t.find(".e-move.e-right").show(),c.prev().length>0&&t.find(".e-move.e-left").show(),ej.isNullOrUndefined(this.model.fields.primaryKey)||t.find(".e-content.delete").show(),this.model.fields.swimlaneKey&&this.model.fields.primaryKey&&t.find(".e-move.e-swimlane").length>0&&(t.find(".e-move.e-swimlane").show(),t.find(".e-move.e-swimlane").find("li").show(),t.find(".e-move.e-swimlane").find("li").eq(this._columnRows.index(y)).hide())):l.length>0&&($(t.find("li").not(".e-customitem")).hide(),$(t.find(".e-customitem li")).show(),this.model.editSettings.allowAdding&&t.find(".e-add").show())}else if(this.getHeaderContent().find(u).length>0)if(h=t.find(".e-column"),$(u).closest(".e-headercell").not(".e-stackedHeaderCell").length>0){for($(t.find("li").not(".e-customitem")).hide(),$(t.find(".e-customitem li")).show(),$(t.find("li.e-haschild").find("li")).show(),h.show(),o=0;o<t.find(".e-column.e-visiblecolumn").find("li").length;o++)this.element.find(".e-headercell").not(".e-stackedHeaderCell").eq(o).hasClass("e-hide")?h.find("li input.e-checkbox").eq(o).ejCheckBox({checked:!1}):h.find("li input.e-checkbox").eq(o).ejCheckBox({checked:!0});h.find("li").show()}else{t.css("visibility","hidden");return}else{t.css("visibility","hidden");return}this.model.contextOpen&&(n.card=f,n.index=f.parent(".e-rowcell").find(".e-kanbancard").index(f),n.cellIndex=f.parent(".e-rowcell").index(),n.rowIndex=this.getIndexByRow(f.parents(".e-columnrow")),n.cardData=this._getKanbanCardData(this._currentJsonData,f.attr("id"))[0],this._trigger("contextOpen",n))},i.prototype._items=function(n,t){var i,r,u;return n==""||ej.isNullOrUndefined(n)?!1:(t=="menuItem"?n.indexOf("Card")!=-1?(i=ej.buildTag("li","",{},{"class":"e-content"}),i.css("display","none"),n.indexOf("Add")!=-1&&i.addClass("e-add"),n.indexOf("Edit")!=-1&&i.addClass("e-cardedit"),n.indexOf("Delete")!=-1&&i.addClass("delete"),i.css("display","none")):n.indexOf("Column")!=-1||n.indexOf("Columns")!=-1?(i=ej.buildTag("li","",{},{"class":"e-column"}),n.indexOf("Hide")!=-1&&i.addClass("e-hidecolumn"),n.indexOf("Visible")!=-1&&i.addClass("e-visiblecolumn"),i.css("display","none")):n.indexOf("Row")!=-1?(i=ej.buildTag("li","",{},{"class":"e-row"}),n.indexOf("Top")!=-1?i.addClass("e-top"):i.addClass("e-bottom"),i.css("display","none")):n.indexOf("Move")!=-1&&(i=ej.buildTag("li","",{},{"class":"e-move"}),n.indexOf("Left")!=-1?i.addClass("e-left"):n.indexOf("Right")!=-1?i.addClass("e-right"):n.indexOf("Up")!=-1?i.addClass("e-up"):n.indexOf("Down")!=-1?i.addClass("e-down"):n.indexOf("Swimlane")!=-1&&i.addClass("e-swimlane"),i.css("display","none")):t=="subMenuItem"?i=ej.buildTag("li","",{},{}):t=="custom"&&(i=ej.buildTag("li","",{},{"class":"e-customitem"}),i.css("display","block")),r=document.createElement("a"),u="",u=n.indexOf("Move to")!=-1?n.split(" ")[2].toLowerCase():n.indexOf("Move")!=-1?n.split(" ")[1].toLowerCase():n.split(" ")[0].toLowerCase(),r.innerHTML=n,$(r).append(ej.buildTag("span","",{},{"class":"e-kanbancontext e-icon e-context"+u})),i.append(r),i)},i.prototype.columns=function(n,t,i){var u,r,f,o,e,s;if(!ej.isNullOrUndefined(n)){for(u=!1,typeof n=="string"?(n=[n],u=!0):n instanceof Array&&n.length&&typeof n[0]=="string"&&(u=!0),r=0;r<n.length;r++)f=$.inArray(this.getColumnByHeaderText(u?n[r]:n[r].headerText),this.model.columns),i=="add"||ej.isNullOrUndefined(i)?f==-1?this.model.columns.push(u?{headerText:n[r],key:t}:n[r]):this.model.columns[f]=u?{headerText:n[r],key:t}:n[r]:f!=-1&&this.model.columns.splice(f,1);for(o=this.element.find(".e-kanbanheader"),this._columnsWidthCollection=[],e=0;e<this.model.columns.length;e++)ej.isNullOrUndefined(this.model.columns[e].width)||this._columnsWidthCollection.push(this.model.columns[e].width);this.element[0].replaceChild(this._renderHeader()[0],o[0]);this._addColumnFilters();s={requestType:"addcolumn"};this._ensureDataSource(s);this._renderAllCard();this.refresh(!0);this._refreshHeaderScroller();this._totalCount()}},i.prototype._checkDataBinding=function(){var n,t;(this.model.columns.length||(this._dataSource()!=null&&this._dataSource().length||this._dataSource()instanceof ej.DataManager)&&(!(this._dataSource()instanceof ej.DataManager)||this._dataManager.dataSource.url!=undefined||this._dataSource().dataSource.json.length))&&(ej.isNullOrUndefined(this.model.keyField)||this._addColumnFilters(),this.initialRender=!0,this.model.cssClass!=null&&this.element.addClass(this.model.cssClass),(this.model.filterSettings.length>0||this.model.allowSearching||this.model.customToolbarItems||this.model.allowPrinting)&&this.element.append(this._renderToolBar()),n=this.model.columns,n&&n.length&&(this.element.append(this._renderHeader()),this._stackedHeadervisible()),$.isFunction($.fn.ejWaitingPopup)&&(this.element.ejWaitingPopup({showOnInit:!1}),$("#"+this._id+"_WaitingPopup").addClass("e-kanbanwaitingpopup")),this._dataSource()instanceof ej.DataManager?(this.element.ejWaitingPopup("show"),this._dataSource().ready!=undefined?(t=this,this._dataSource().ready.done(function(n){t._initDataSource();t.model.dataSource=new ej.DataManager(n.result)})):(this.element.ejWaitingPopup("show"),this._initDataSource())):(this._trigger("actionBegin"),this._ensureDataSource(),this._initKanbanRender(),this._enableKanbanRTL()))},i.prototype._renderToolBar=function(){var n=ej.buildTag("div.e-kanbantoolbar","",{},{id:this._id+"_toolbarItems"}),f,r,u,t,a;if(this.model.allowSearching){this._isWatermark="placeholder"in document.createElement("input");var e=ej.buildTag("ul.e-searchbar","",{},{}),i=ej.buildTag("li.e-search","",{},{id:this._id+"_toolbarItems_search"}),v=ej.buildTag("a.e-searchitem e-toolbaricons e-disabletool e-icon e-searchfind","",{position:"absolute"},{}),s=ej.buildTag("input.e-ejinputtext e-input","",{},{type:"text",id:this._id+"_searchbar",placeholder:"Search",height:"33px"}),h=ej.buildTag("div.e-searchdiv","",{display:"inline-table",width:"83%"},{});h.append(s);i.append(h);i.append(v);e.append(i);this._searchInput=s;ej.isNullOrUndefined(this.model.searchSettings.key)||this._searchInput.val(this.model.searchSettings.key);this._searchBar=i;this._isWatermark||(this._hiddenSpan=ej.buildTag("span.e-input e-placeholder","Search",{display:"block"},{}).insertAfter(this._searchInput))}for(ej.isNullOrUndefined(this.model.customToolbarItems)||(f=ej.buildTag("ul.e-customtoolbar"),this.model.filterSettings.length>0&&f.addClass("e-customtoolbarseparator"),!ej.isNullOrUndefined(this.model.customToolbarItems)&&this.model.customToolbarItems.length&&this._renderCustomLi(f),n.append(f)),this.model.filterSettings.length>0&&(r=ej.buildTag("ul","",{},{}),u=ej.buildTag("li","",{},{"class":"e-quickfilter",tabindex:"0"}),u.append("<label class='e-toolbartext e-text'>"+this.localizedLabels.FilterSettings+"<\/label>"),r.append(u)),t=0;t<this.model.filterSettings.length;t++){var c=this.model.filterSettings[t].description,i=ej.buildTag("li","",{},{id:this._id+"_"+this.model.filterSettings[t].text,title:ej.isNullOrUndefined(c)?this.model.filterSettings[t].text:c,tabindex:"0"}),l=ej.buildTag("a.e-toolbartext e-text",this.model.filterSettings[t].text,{},{});i.append(l);r.append(i)}if(this.model.allowPrinting){var o=ej.buildTag("ul.e-print","",{},{}),u=ej.buildTag("li","",{},{"class":"e-printlist",title:"Print",tabindex:"0"}),l=ej.buildTag("a.e-printicon e-icon","",{});u.append(l);o.append(u)}return ej.isNullOrUndefined(r)||n.append(r),ej.isNullOrUndefined(o)||n.append(o),ej.isNullOrUndefined(e)||n.append(e),a={click:this._onToolbarClick},n.ejToolbar(a),this._filterToolBar=n,n},i.prototype._renderCustomLi=function(n){for(var i,r,u,t=0;t<this.model.customToolbarItems.length;t++){r=this.model.customToolbarItems[t].template?this.model.customToolbarItems[t].template.replace("#",""):this.model.customToolbarItems[t];i=ej.buildTag("li","",{},{id:this._id+"_"+r,title:r});switch(typeof this.model.customToolbarItems[t]){case"string":u=ej.buildTag("a.e-toolbaricons e-icon","",{}).addClass(this.model.customToolbarItems[t].text);break;case"object":i.attr("title",this.model.customToolbarItems[t].template.replace("#",""));u=$(this.model.customToolbarItems[t].template).hide().html()}i.html(u);n.append(i)}},i.prototype.dataSource=function(n,t){t&&(this._templateRefresh=!0);this._dataSource(n);this._refreshDataSource(n);this._addLastRow()},i.prototype._refreshDataSource=function(n){this._dataManager=n instanceof ej.DataManager?n:new ej.DataManager(n);this._isLocalData=!(this._dataSource()instanceof ej.DataManager)||this._dataManager.dataSource.offline||this._isRemoteSaveAdaptor;this.refresh(!0)},i.prototype._ensureDataSource=function(n){var t,f,r,i,s,v,h,e,c,u,l,o,a;if(this._dataSource()==null&&!(this._dataSource()instanceof ej.DataManager)){if(ej.isNullOrUndefined(n)||n.requestType!="add")return;this.dataSource([],!1)}if(this.model.query.requiresCount(),t=this.model.query,u=t.clone(),this._dataSource()instanceof ej.DataManager||(this._currentJsonData=this.currentViewData=this._dataSource()),this.model.filterSettings.length&&!ej.isNullOrUndefined(n)&&n.requestType=="filtering"||!ej.isNullOrUndefined(n)&&n.requestType=="search"||this.model.searchSettings.key.length){for(t.queries=t.queries.slice(t.queries.length),this.model.searchSettings.key.length!=0&&(r=this.model.searchSettings,r.fields.length==0&&(ej.isNullOrUndefined(this.model.fields.content)||r.fields.push(this.model.fields.content),ej.isNullOrUndefined(this.model.fields.swimlaneKey)||r.fields.push(this.model.fields.swimlaneKey),ej.isNullOrUndefined(this.model.fields.primaryKey)||r.fields.push(this.model.fields.primaryKey),ej.isNullOrUndefined(this.model.fields.title)||r.fields.push(this.model.fields.title)),t.search(r.key,r.fields,r.operator||"contains",r.ignoreCase)),this.element.hasClass("e-responsive")&&(this._filterCollection=this._kbnFilterCollection.slice()),i=0;i<this._filterCollection.length;i++)f=f!=undefined?f.and(this._filterCollection[i]):this._filterCollection[i];for(t.where(ej.Predicate.or(this.keyPredicates)),i=0;i<t.queries.length;i++)t.queries[i].fn=="onWhere"&&f&&(t.queries[i].e=t.queries[i].e.and(f));this._isLocalData&&(this._filteredRecords=this._dataManager.executeLocal(t).result,this._filteredRecordsCount=this._filteredRecords.length);this._isLocalData&&this.model.filterSettings.length==0&&(!ej.isNullOrUndefined(this._filteredRecordsCount)||this._filteredRecordsCount>0)&&(this._filteredRecordsCount=null,this._filteredRecords=[])}this._isLocalData&&(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(!ej.isNullOrUndefined(this._cModifiedData)||!ej.isNullOrUndefined(this._cAddedRecord))&&(ej.isNullOrUndefined(this._cAddedRecord)?(t=t.where(this.model.fields.primaryKey,ej.FilterOperators.equal,n.primaryKeyValue),s=this._dataManager.executeLocal(t),v=this._dataSource()instanceof ej.DataManager?$.extend(this._dataSource().dataSource.json[$.inArray(s.result[0],this._dataSource().dataSource.json)],this._cModifiedData):$.extend(this._dataSource()[$.inArray(s.result[0],this._dataSource())],this._cModifiedData),n.data=v):(h=this._cAddedRecord,this._cAddedRecord=null,this._dataSource()instanceof ej.DataManager?this._dataSource().dataSource.json.push(h):this._dataSource(undefined,!0).splice(this._dataSource().length,0,h)),t.queries=u.queries);n&&n.requestType=="delete"&&!ej.isNullOrUndefined(this._cDeleteData)&&this._isLocalData&&(this._dataSource()instanceof ej.DataManager?(e=$.inArray(this._cDeleteData[0],this._dataSource().dataSource.json),this._dataSource().dataSource.json.splice(e,1)):(e=$.inArray(this._cDeleteData[0],this._dataSource()),this._dataSource(undefined,!0).splice(e,1)));this._cloneQuery=t.clone();this._isLocalData&&(!ej.isNullOrUndefined(n)&&(n.requestType=="addcolumn"||n.requestType=="refresh")&&this._filterCollection.length<=0&&(ej.isNullOrUndefined(this._searchInput)||this._searchInput.val().length<=0)?(u=t.clone(),u.queries=[],u.where(ej.Predicate.or(this.keyPredicates)),c=u):c=t,l=this._dataManager.dataSource.json,o=this._dataSource().dataSource,!ej.isNullOrUndefined(o)&&this._dataSource()instanceof ej.DataManager&&(this._dataManager.dataSource.json=l!=o.json?o.json:l),a=this._dataManager.executeLocal(c),this.currentViewData=this._currentJsonData=a.result,this._recordsCount=a.count)},i.prototype._addColumnFilters=function(){for(var i=this.model.columns,n=[],r=this.model.query,t=0;t<i.length;t++)ej.isNullOrUndefined(i[t].key)||n.push(new ej.Predicate(this.model.keyField,ej.FilterOperators.equal,i[t].key,!0));n.length>0&&r.where(ej.Predicate.or(n));this.keyPredicates=n},i.prototype._getMetaColGroup=function(){for(var t,i=ej.buildTag("colgroup","",{},{}),n=0;n<this.model.columns.length;n++)t=$(document.createElement("col")),this.model.allowToggleColumn&&this.model.columns[n].isCollapsed===!0&&t.addClass("e-shrinkcol"),this.model.columns[n].visible===!1&&t.addClass("e-hide"),i.append(t);return i},i.prototype.refresh=function(n){n&&this.refreshTemplate();this._processBindings({requestType:"refresh"})},i.prototype.sendDataRenderingRequest=function(n){this._templateRefresh&&(this.refreshTemplate(),this._templateRefresh=!1);var t=this.model.query,i=t.clone();if(this.currentViewData!=null&&this.currentViewData.length){switch(n.requestType){case"save":this._updateGroup(n.primaryKeyValue,n.data);case"delete":case"refresh":case"search":case"filtering":this.element.hasClass("e-responsive")&&!ej.isNullOrUndefined(n.currentFilterObject)&&(this._kbnAdaptFilterObject=n.currentFilterObject.slice());case"cancel":this.getContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup());ej.isNullOrUndefined(this.model.fields.swimlaneKey)||(t=t.group(this.model.fields.swimlaneKey),this.currentViewData.GROUPGUID||(this.currentViewData=new ej.DataManager(this.currentViewData).executeLocal(t).result));this._renderAllCard();this._enableSwimlaneCount=!0;this._swimlaneLimit(n);this.element.hasClass("e-responsive")&&(ej.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-swimlanerow").hide(),this._kanbanWindowResize());this._eventBindings();break;case"beginedit":case"add":this.KanbanEdit._editAdd(n)}t.queries=i.queries}else this.getContentTable().find("tbody").empty().first().append(this._getEmptyTbody());(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&(this._editForm=this.element.find(".e-externalform"),this.KanbanEdit._formFocus());("beginedit"==n.requestType||"add"==n.requestType)&&(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="externalform")&&this.KanbanEdit._refreshEditForm(n);this._renderComplete(n);this._newData=null},i.prototype._renderAllCard=function(){var n=document.createElement("div");n.innerHTML=["<table>",$.render[this._id+"_JSONTemplate"]({columns:this.model.columns,dataSource:this.currentViewData}),"<\/table>"].join("");ej.isNullOrUndefined(n.firstChild)||ej.isNullOrUndefined(n.firstChild.lastChild)||this.getContentTable().get(0).replaceChild(n.firstChild.lastChild,this.getContentTable().get(0).lastChild);this._cardCollapse();this._selectionOnRerender()},i.prototype._processBindings=function(n){if(n.primaryKey=this.model.fields.primaryKey,!this._checkSkipAction(n)&&this._trigger("actionBegin",n))return!0;if(this._ensureDataSource(n),this._editForm=this.element.find(".kanbanform"),n.requestType=="beginedit"||this._editForm.length==0||(this._editForm.length>1&&n.requestType=="save"&&n.action=="edit"&&(this._editForm=$(this._editForm[0])),$(this._editForm).find("select.e-dropdownlist").ejDropDownList("destroy"),$(this._editForm).find("textarea.e-rte").ejRTE("destroy"),$(this._editForm).find(".e-datepicker").ejDatePicker("destroy"),$(this._editForm).find(".e-datetimepicker").ejDateTimePicker("destroy"),$(this._editForm).find(".e-numerictextbox").ejNumericTextbox("destroy"),$(this._editForm).addClass("e-formdestroy")),n&&n.requestType=="delete"&&n.div.remove(),this._dataSource()instanceof ej.DataManager&&n.requestType!="beginedit"&&n.requestType!="cancel"&&n.requestType!="add"){this.element.ejWaitingPopup("show");var i=this._queryPromise=this._dataSource().executeQuery(this.model.query),t=this;t._dataSource().ready?t._dataSource().ready.done(function(){t._processDataRequest(t,n,i)}):t._processDataRequest(t,n,i)}else this.sendDataRenderingRequest(n)},i.prototype._processDataRequest=function(n,t,i){i.done(ej.proxy(function(i){n.element.ejWaitingPopup("hide");n._currentJsonData=n.currentViewData=i.result==null?[]:i.result;n._processData(i,t)}));i.fail(ej.proxy(function(i){n.element.ejWaitingPopup("hide");t.error=i.error;i=[];n.currentViewData=[];n._processData(i,t);n._trigger("actionFailure",t)}))},i.prototype._processData=function(n,t){ej.isNullOrUndefined(this.model.filterSettings)||(t.requestType=="filtering"||this.model.filterSettings.length>0&&t.requestType=="refresh")&&(this._filteredRecordsCount=n.count);this.sendDataRenderingRequest(t)},i.prototype._editEventTrigger=function(n){if(n.requestType=="save"||n.requestType=="delete"){var t={data:n.data,action:n.action!==undefined?n.action:n.requestType};this._trigger("end"+t.action.charAt(0).toUpperCase()+t.action.slice(1),t)}},i.prototype._renderComplete=function(n){n.requestType!="beginedit"&&this._setWidthToColumns();(n.requestType=="save"||n.requestType=="cancel")&&(this._isAddNew=!1);("delete"==n.requestType||"save"==n.requestType)&&this._editEventTrigger(n);this._tableBEle=this.getContentTable().get(0);this._kanbanRows=this._tableBEle.rows;this._columnRows=$(this._kanbanRows).not(".e-swimlanerow");this.model.allowScrolling&&!this.initialRender&&this.getContentTable().find("tr:last").find("td").addClass("e-lastrowcell");this._trigger("actionComplete",n);!this.initialRender&&this.model.allowScrolling&&(n.requestType=="add"||n.requestType=="cancel"||n.requestType=="save"||n.requestType=="delete"||n.requestType=="filtering"||n.requestType=="refresh")&&this._refreshScroller(n);(n.requestType=="cancel"||n.requestType=="delete")&&(this._renderLimit(),this._totalCount());n.requestType=="filtering"&&this._filterLimitCard(n);this.model.allowDragAndDrop&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._addDragableClass()},i.prototype._enableKanbanRTL=function(){this.model.enableRTL?this.element.addClass("e-rtl"):this.element.removeClass("e-rtl")},i.prototype._createTemplate=function(n,t){var i=document.createElement("script");return i.id=this._id+t+"_Template",i.type="text/x-jsrender",i.text=n,$("body").append(i),i},i.prototype._addInitTemplate=function(){var n=this,t={},r=!ej.isNullOrUndefined(n.model.keyField),u=ej.browserInfo().name=="msie"&&parseInt(ej.browserInfo().version,10)==8,f=this.model.allowToggleColumn,i=!ej.isNullOrUndefined(n.model.fields.swimlaneKey);this._slTemplate="";t[n._id+"Object"]=this;t["_"+n._id+"columnKeys"]=this._getColumnKeyItems;t["_"+n._id+"tagItems"]=this._gettagItems;t["_"+n._id+"colorMaps"]=this._getColorMaps;t["_"+n._id+"getId"]=this._removeIdSymbols;t["_"+n._id+"getData"]=this._columnData;t["_"+n._id+"getCardCount"]=this._columnCardcount;t["_"+n._id+"getStatus"]=this._columnStatus;$.views.helpers(t);i&&(this._slTemplate+="{{for dataSource ~columns=columns ~ds=dataSource}}",this._slTemplate+="<tr id='{{: ~_"+n._id+"getId(key)}}' class='e-swimlanerow' role='kanbanrow'><td class='e-rowcell' role='kanbancell'  colspan='"+n.getVisibleColumnNames().length+"'><div class='e-slexpandcollapse'><div class='e-icon e-slexpand'><\/div><\/div><div class='e-slkey'>{{:key}}<\/div>{{if "+this.model.swimlaneSettings.showCount+"}}<div class='e-slcount'>"+n.localizedLabels.SwimlaneCaptionFormat+"<\/div>{{/if}}<\/td><\/tr>");this._slTemplate+="<tr class='e-columnrow' role='kanbanrow'>";this._slTemplate+=i?"{{for ~columns ~items=#data.items}}":"{{for columns}}";this._slTemplate+="<td ej-mappingkey='{{:key}}' class='e-rowcell {{if !#data.visible}}  e-hide {{/if}}{{if (#data.isCollapsed && "+f+")}}e-shrink{{/if}}'role='kanbancell'>{{if "+r+"}}{{for ~_"+n._id+"columnKeys('"+n._id+"Object')}}";this._slTemplate+=this._cardCustomization()+"{{/for}}{{/if}}{{if "+this.model.allowToggleColumn+"}}<div class='e-shrinkheader{{if "+u+"}} IE{{/if}}{{if !#data.isCollapsed}}  e-hide {{/if}}'>{{:headerText}}<div class='e-shrinklabel'>[<div class='e-shrinkcount'>{{:~_"+n._id+"getCardCount(~root.dataSource,key,#parent.parent.getIndex()) }}<\/div>]<\/div><\/div>{{/if}}{{if "+this.model.editSettings.allowAdding+"}}{{if #data.showAddButton}} <div class='e-customaddbutton{{if #data.isCollapsed}}  e-hide {{/if}}'><div class='e-columnadd e-icon'><\/div><\/div>{{/if}}{{/if}}<\/td>{{/for}}<\/tr>";i&&(this._slTemplate+="{{/for}}");this.templates[this._id+"_JSONTemplate"]=$.templates(this._createTemplate(this._slTemplate,"_swinlaneContent"));this.templates[this._id+"_cardTemplate"]=$.templates(this._createTemplate(this._cardTemplate,"_cardTemplate"));$.templates(this.templates)},i.prototype._cardCustomization=function(){var t=this,r=this.model.allowToggleColumn,i=this.model.cardSettings.template?!0:!1,u=this.model.fields.imageUrl?!0:!1,n=this.model.fields,o=!ej.isNullOrUndefined(n.title),f=n.title?n.title:n.primaryKey?n.primaryKey:null,e=!ej.isNullOrUndefined(n.tag)||!ej.isNullOrUndefined(n.content);return this._cardTemplate="<div id='{{:"+t.model.fields.primaryKey+"}}' class='e-kanbancard {{if ~_"+t._id+"getData(#parent)  && "+r+" }}e-hide{{/if}} {{if "+i+"}}e-templatecell{{/if}}'{{if "+n.color+" }} style='{{if "+t.model.enableRTL+"}}border-right-color{{else}}border-left-color{{/if}}:{{for  ~_"+t._id+"colorMaps('"+t._id+"Object',"+n.color+")}}{{:#data}}{{/for}}'{{/if}}>{{if "+i+"}}"+$(t.model.cardSettings.template).html()+"{{else}}{{if "+t.model.allowTitle+"}}<div class='e-cardheader'><div class='e-primarykey'>{{:"+f+"}}<\/div><div class='e-expandcollapse'><div class='e-icon e-cardexpand'><\/div><\/div><\/div>{{/if}}<div class='e-cardcontent'><table class='e-cardtable'><tbody><tr><td class='e-contentcell'>{{if "+e+"}}<div class='e-innercontent'><div class='e-text'>{{:"+n.content+"}}<\/div>{{if "+n.tag+"}}{{for ~_"+t._id+"tagItems("+n.tag+")}}{{:#data}}{{/for}}{{/if}}<\/div>{{/if}}<\/td><td class='e-imagecell'>{{if "+u+" }} <div class='e-card_image'>{{if "+n.imageUrl+"}}<img class='e-image' src='{{:"+n.imageUrl+"}}'><\/img>{{else}}<div class='e-image e-no-user'><\/div>{{/if}}{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>{{/if}}<\/div><\/div>",this._cardTemplate},i.prototype._removeIdSymbols=function(n){return n.replace(/[-\s']/g,"_")},i.prototype._columnStatus=function(n){var t=this.getRsc("helpers",n),i=t.getBrowserDetails();return i.browser=="msie"?!0:!1},i.prototype._setModel=function(n){var t,r,f,u,i,e;for(t in n)switch(t){case"columns":f=n.columns;this.model.columns=[];this.columns(f,"add");break;case"cssClass":this.element.removeClass(this.model.cssClass).addClass(n[t]);break;case"filterSettings":t=="filterSettings"&&(this.model.filterSettings=n[t]);this.model.filterSettings.length>0?(this.element.find(".e-kanbantoolbar").remove(),this._filterCollection=[],this._renderToolBar().insertBefore(this.element.find(".e-kanbanheader").first())):(this.element.find(".e-kanbantoolbar").remove(),this.model.filterSettings=[],this._filterCollection=[],this.refresh());break;case"allowHover":this.model.allowHover=n[t];this._enableCardHover();break;case"enableRTL":this.model.enableRTL=n[t];this._enableKanbanRTL();this.refresh(!0);this._refreshScroller({requestType:"refresh"});break;case"tooltipSettings":$.extend(this.model.tooltipSettings,n[t]);!ej.isNullOrUndefined(this.model.tooltipSettings)&&this.model.tooltipSettings.enable?(this._on(this.element,"mouseover",".e-kanbancard",$.proxy(this._showToolTip,this)),this._on(this.element,"mouseout",".e-kanbancard",$.proxy(this._hideToolTip,this))):(this._off(this.element,"mouseover",".e-kanbancard"),this._off(this.element,"mouseout",".e-kanbancard"));break;case"allowScrolling":case"scrollSettings":if(r=this.getContent(),t!="allowScrolling"){if(!ej.isNullOrUndefined(n.scrollSettings)){if($.isEmptyObject(n.scrollSettings))break;$.extend(this.model.scrollSettings,n.scrollSettings)}ej.isNullOrUndefined(n.allowScrolling)||(this.model.allowScrolling=n.allowScrolling);ej.isNullOrUndefined(r.data("ejScroller"))||r.ejScroller("destroy");this.model.allowScrolling?(this.getHeaderContent().find("div").first().addClass("e-headercontent"),this._originalScrollWidth=this.model.scrollSettings.width,this._renderScroller()):(this.element.children(".e-kanbanheader").removeClass("e-scrollcss"),this.element.get(0).style.width.length==0&&this.element.css("width","auto"));this.model.scrollSettings.allowFreezeSwimlane||(this._freezeSwimlaneRow.remove(),this.headerContent.css({position:"",top:""}),this.kanbanContent.css({position:"",top:""}),u=this.element.find(".e-kanbantoolbar"),u.length>0&&u.css({position:"",top:""}))}break;case"dataSource":r=this.element.find(".e-kanbancontent").first();this._refreshDataSource(this._dataSource());this._addLastRow();break;case"editSettings":$.extend(this.model.editSettings,n[t]);this.KanbanEdit._processEditing();this._tdsOffsetWidth=[];(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?($("#"+this._id+"_dialogEdit").data("ejDialog")&&$("#"+this._id+"_dialogEdit").ejDialog("destroy"),$("#"+this._id+"_dialogEdit_wrapper,#"+this._id+"_dialogEdit").remove(),this.element.append(this.KanbanEdit._renderDialog())):(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&($("#"+this._id+"_externalEdit").css("display","none"),this.element.append(this.KanbanEdit._renderExternalForm())));this._enableEditingEvents();break;case"allowSelection":n[t]&&(this._off(this.element,"click"),this._on(this.element,"click","",this._clickHandler));break;case"query":this.model.query=$.extend(!0,{},n[t]);break;case"stackedHeaderRows":t=="stackedHeaderRows"&&(this.model.stackedHeaderRows=n[t]);this.model.stackedHeaderRows.length>0?this._refreshStackedHeader():(this.element.find(".e-stackedHeaderRow").remove(),this.model.stackedHeaderRows=[]);break;case"cardSettings":ej.isNullOrUndefined(n.cardSettings)||$.extend(this.model.cardSettings,n.cardSettings);this.element.find(".e-kanbancard").remove();this.refreshTemplate();this._renderAllCard();this._enableDragandScroll();break;case"allowToggleColumn":this.model.allowToggleColumn=n[t];this.refreshTemplate();this.getHeaderContent().replaceWith(this._renderHeader());this.sendDataRenderingRequest({requestType:"refresh"});this.model.allowToggleColumn||this.element.find(".e-shrinkheader").not(".e-hide").addClass("e-hide");break;case"locale":this.model.locale=n[t];i=this.model;e=this.element;i.query.queries=i.query.queries.slice(0,i.query.queries.length-1);this.element.ejKanban("destroy").ejKanban(i);this.element=e;this.model=i;this._collapsedCards.length!=0&&this.toggleCard(this._collapsedCards)}},i.prototype._columnCardcount=function(n,t,i){var u=0,r;if(ej.isNullOrUndefined(i)){for(r=0;r<n.length;r++)n[r].Status===t&&u++;return u}for(r=0;r<n[i].items.length;r++)n[i].items[r].Status===t&&u++;return u},i.prototype._columnData=function(n){return ej.isNullOrUndefined(n)?!1:n.parent.data.isCollapsed},i.prototype._getColorMaps=function(n,t){var e=this.getRsc("helpers",n),f,r=e.model.cardSettings.colorMapping,i,u;for(i in r){if(r[i].indexOf(",")==-1&&r[i]==t)return i;for(f=r[i].split(","),u=0;u<f.length;u++)if(f[u]==t)return i}},i.prototype._gettagItems=function(n){var i="<div class='e-tags'>",t;for(n=n.split(","),t=0;t<n.length;t++)i=i.concat("<div class='e-tag'>"+n[t]+"<\/div>");return i.concat("<\/div>")},i.prototype._getColumnKeyItems=function(n){var i=this.getRsc("helpers",n),u,f=this.ctx.root.dataSource,r,e=i.model.query,t=e.clone();return i._filterCollection.length<=0&&i.model.allowSearching&&i._searchInput.val().length<=0?(t.queries=[],t.where(ej.Predicate.or(i.keyPredicates))):t.queries=t.queries.slice(0,t.queries.length-1),t=t.where(i.model.keyField,"equal",this.data.key),u=f.GROUPGUID?new ej.DataManager(this.ctx.items).executeLocal(t).result:new ej.DataManager(f).executeLocal(t).result,r=i.model.fields.priority,r&&u.sort(function(n,t){return n[r]-t[r]}),u},i.prototype._renderSingleCard=function(n,t){var i=this.element.find("div[id='"+n+"']"),r=this,u,f,s,e,o,h;this._dropped?(o=$.render[this._id+"_cardTemplate"](t),ej.browserInfo().name=="msie"&&ej.browserInfo().version=="8.0"?$(i).after(o):$(i).replaceWith(o)):(ej.isNullOrUndefined(r.model.fields.swimlaneKey)?u=this.element.find(".e-columnrow:first"):(s=this._removeIdSymbols(t[r.model.fields.swimlaneKey]),e=this.element.find("tr[id='"+s+"']"),e.length>0&&(u=e.next())),f=$(u).find("td.e-rowcell[ej-mappingkey='"+t[r.model.keyField]+"']"),$(i).remove(),f.length>0&&$(f).append($.render[this._id+"_cardTemplate"](t)));h=$.inArray(n,this._collapsedCards);h!=-1&&this.toggleCard(n);this.KanbanDragAndDrop&&this.KanbanDragAndDrop._addDragableClass();this._selectionOnRerender()},i.prototype._selectionOnRerender=function(){var s,e,t,o=!0,n=this,r,u,i,f,c,h;if(n.model.selectionType=="single")n._selectedCards.length>0&&(u=$(n._selectedCards[0]),i=n.element.find("#"+u[0].id),i.hasClass("e-kanbancard")?(e=$(i).parents(".e-columnrow"),t=$(i).parents(".e-rowcell"),n._selectedCards=[],n._selectedCards=i.addClass("e-cardselection"),n._currentRowCellIndex=n._previousRowCellIndex=[],n._currentRowCellIndex.push([e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]]),n._currentRowCellIndex=n._previousRowCellIndex,n.selectedRowCellIndexes=[],n.selectedRowCellIndexes.push({rowIndex:n._currentRowCellIndex[0][0],cellIndex:n._currentRowCellIndex[0][1][0],cardIndex:n._currentRowCellIndex[0][2][0]})):(n._selectedCards=[],n._selectedCardData=[],n.selectedRowCellIndexes=[],n._currentRowCellIndex=n._previousRowCellIndex=[]));else{for(r=0;r<n._selectedCards.length;r++)if($(n._selectedCards[r]).length>1)for(f=0;f<n._selectedCards[r].length;f++)u=$(n._selectedCards[r][f]),i=n.element.find("#"+u[0].id),e=$(i).parents(".e-columnrow"),t=$(i).parents(".e-rowcell"),i.hasClass("e-kanbancard")?(o=!0,n._selectedCards[r].splice(f,0,i[0]),i.addClass("e-cardselection"),n._selectedCards[r].splice(f+1,1),r==0&&f==0&&(n._currentRowCellIndex=n._previousRowCellIndex=[],n._currentRowCellIndex.push([e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]]),n._currentRowCellIndex=n._previousRowCellIndex,n.selectedRowCellIndexes=[]),c=[e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]],n._pushIntoSelectedArray([c])):(o=!1,n._selectedCards[r].splice(f,1),h=n._selectedCardData.indexOf(n._getKanbanCardData(n._selectedCardData,u[0].id)[0]),n._selectedCardData.splice(h,1),--f);else u=$(n._selectedCards[r]),i=n.element.find("#"+u[0].id),e=$(i).parents(".e-columnrow"),t=$(i).parents(".e-rowcell"),i.hasClass("e-kanbancard")?(o=!0,i.addClass("e-cardselection"),n._selectedCards[r]=i[0],r==0&&(n._currentRowCellIndex=n._previousRowCellIndex=[],n._currentRowCellIndex.push([e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]]),n._currentRowCellIndex=n._previousRowCellIndex,n.selectedRowCellIndexes=[]),c=[e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]],n._pushIntoSelectedArray([c])):(o=!1,n._selectedCards.splice(r,1),h=n._selectedCardData.indexOf(this._getKanbanCardData(n._selectedCardData,u[0].id)[0]),n._selectedCardData.splice(h,1),--r);!o&&n._selectedCards.length<=0&&(n._currentRowCellIndex=n._previousRowCellIndex=n.selectedRowCellIndexes=[])}s=n.element.find(".e-columnrow").index(n.element.find(".e-cardselection").eq(0).parents(".e-columnrow"));s>=0&&(n.selectedRowCellIndexes[0].rowIndex=n._currentRowCellIndex[0][0]=s,n._previousRowCellIndex.length>0&&(n._previousRowCellIndex[0][0]=s))},i.prototype._getKanbanCardData=function(n,t){return new ej.DataManager(n).executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,t))},i.prototype._renderScroller=function(){var t,i,r,u,n,f;this.model.scrollSettings||(this.model.scrollSettings={});typeof this._originalScrollWidth=="string"&&(this.element.css("width","auto"),t=this.element.width(),(this.model.scrollSettings.width=="auto"||this._originalScrollWidth=="auto")&&(this._originalScrollWidth="100%"),this.model.scrollSettings.width=t*(parseFloat(this._originalScrollWidth)/100));typeof this.model.scrollSettings.height=="string"&&(i=this.element.height(),this.model.scrollSettings.height=="auto"&&(this.model.scrollSettings.height="100%"),this.model.scrollSettings.height=i*(parseFloat(this.model.scrollSettings.height)/100));(this.model.scrollSettings.width||this.model.width)&&this.element.width(this.model.scrollSettings.width||this.model.width);r=this.model.scrollSettings.height!=0?this.model.scrollSettings.height-this.getHeaderTable().height()-(!ej.isNullOrUndefined(this._filterToolBar)&&this._filterToolBar.height()):this.model.scrollSettings.height;u=this.getContent().attr("tabindex","0");this.element.addClass("e-kanbanscroll");u.ejScroller({enableRTL:this.model.enableRTL,height:r,width:this.model.scrollSettings.width,thumbStart:$.proxy(this._kbnThumbStart,this),scroll:$.proxy(this._freezeSwimlane,this)});this.getContent().ejScroller("isVScroll")?(this.element.find(".e-kanbanheader").addClass("e-scrollcss"),this.getHeaderContent().find("div").first().addClass("e-headercontent")):this.element.find(".e-kanbanheader").removeClass("e-scrollcss");(this.model.scrollSettings.width||this.model.width)&&this.element.width(this.model.scrollSettings.width||this.model.width);n=this.getContent().data("ejScroller");f=n&&n.isVScroll()?"addClass":"removeClass";this.getHeaderContent().find(".e-headercontent")[f]("e-hscrollcss");this._refreshHeaderScroller()},i.prototype._refreshHeaderScroller=function(){var n=this;this.getContent().find(".e-content").scroll(ej.proxy(function(t){n.getHeaderContent().find("div").first().scrollLeft($(t.currentTarget).scrollLeft())}));this.element.find(".e-kanbanheader").find(".e-headercontent").scroll(ej.proxy(function(t){var i=$(t.currentTarget);n.getContent().find(".e-content").first().scrollLeft(i.scrollLeft())}))},i.prototype._kbnThumbStart=function(n){var t=$(n.originalEvent.target);return t.hasClass("e-kanbancard")||t.parents(".e-kanbancard").hasClass("e-kanbancard"),!1},i.prototype._freezeSwimlane=function(n){var c=this.model.fields.swimlaneKey,e=this.element.find(".e-kanbantoolbar"),o,p,l,a,w,k;if(this._freezeSwimlaneRow=this.element.find(".e-freezeswimlanerow"),this.model.scrollSettings.allowFreezeSwimlane||(this._freezeSwimlaneRow.remove(),this.headerContent.css({position:"",top:""}),this.kanbanContent.css({position:"",top:""}),e.length>0&&e.css({position:"",top:""})),(!this.element.hasClass("e-responsive")||!ej.isNullOrUndefined(c))&&(this.element.hasClass("e-responsive")||this.model.scrollSettings.allowFreezeSwimlane&&!ej.isNullOrUndefined(c)&&(ej.isNullOrUndefined(n.scrollLeft)||this._freezeSwimlaneRow.length!=0))){if(this._freezeSwimlaneRow.length<=0&&this.model.scrollSettings.allowFreezeSwimlane)this._freezeSwimlaneRow=ej.buildTag("div.e-freezeswimlanerow e-swimlanerow","<div><\/div>",{},{}),o=this.headerContent.offset().top+this.headerContent.height()-(this.element.offset().top+1),k=this.element.height(),this._freezeSwimlaneRow.prependTo(this.element).css({top:o}),o=this._freezeSwimlaneRow.height(),this.headerContent.css({position:"relative",top:-o}),this.kanbanContent.css({position:"relative",top:-o}),e.length>0&&e.css({position:"relative",top:-o}),this.element.height(k),p=this._swimlaneRows.eq(0),this._freezeSwimlaneRow.children().append(p.find(".e-slkey,.e-slcount").clone()),this._freezeSwimlaneRow.width(this.headerContent.width()-1).height(p.height()),this._freezeSlOrder=0,l=ej.buildTag("table.e-table e-freeze-table","",{},{cellspacing:"0.25px"}),l.append(this.getContentTable().find("colgroup").clone()),a=ej.buildTag("tbody","",{},{}),l.append(a),a.append(this.getContentTable().find(".e-columnrow").eq(0).clone().removeClass("e-columnrow").addClass("e-collapsedrow")),w=a.find("td"),w.removeClass("e-droppable").removeAttr("ej-mappingkey").height(0),w.children().remove(),this._freezeSwimlaneRow.append(l);else if(this._freezeSwimlaneRow.length>0||!ej.isNullOrUndefined(c)&&this.element.hasClass("e-responsive")){var t,i=0,h=0,b=0,v,y=this.element.find(".e-swimlane-text"),u,s,f,r;!ej.isNullOrUndefined(c)&&this.element.hasClass("e-responsive")?(v=this.element.find(".e-columnrow"),t=this.getContent().offset().top,s=v.eq(this._freezeSlOrder),u=v.eq(this._freezeSlOrder+1),f=v.eq(this._freezeSlOrder-1),u.length>0&&(i=u.offset().top),s.length>0&&(h=s.offset().top),f.length>0&&(b=f.offset().top)):this._freezeSwimlaneRow.length>0&&(t=this.getContent().offset().top+this._freezeSwimlaneRow.height(),s=this._swimlaneRows.eq(this._freezeSlOrder),u=this._swimlaneRows.eq(this._freezeSlOrder+1),f=this._swimlaneRows.eq(this._freezeSlOrder-1),i=u.offset().top+u.height(),h=s.offset().top+s.height(),b=f.offset().top+f.height());r=this.element.find(".e-freezeswimlanerow >div");this._freezeScrollTop>n.scrollTop&&(h=h,t>=i&&(i=t+1));this._freezeScrollTop<n.scrollTop&&(i=i);(n.source=="wheel"||n.source=="button")&&(this._freezeScrollTop<n.scrollTop?i=i-n.model.scrollOneStepBy:this._freezeScrollTop>n.scrollTop&&(t=t-n.model.scrollOneStepBy));t>=i?(r.length>0&&(r.children().remove(),r.append(u.find(".e-slkey,.e-slcount").clone())),y.length>0&&(y.text(this._kbnAdaptDdlData[this._kbnAdaptDdlIndex+1]),++this._kbnAdaptDdlIndex),++this._freezeSlOrder):t<h&&t>b&&this._freezeSlOrder>0&&(r.length>0&&(r.children().remove(),r.append(f.find(".e-slkey,.e-slcount").clone())),y.length>0&&(y.text(this._kbnAdaptDdlData[this._kbnAdaptDdlIndex-1]),--this._kbnAdaptDdlIndex),--this._freezeSlOrder);n.scrollTop==0&&(this._freezeSwimlaneRow.remove(),this.headerContent.css({position:"",top:""}),this.kanbanContent.css({position:"",top:""}),e.length>0&&e.css({position:"",top:""}));ej.isNullOrUndefined(n.scrollLeft)||(r.css({left:-n.scrollLeft}),this._freezeSwimlaneRow.find("table").css({left:-n.scrollLeft}))}this._freezeScrollTop=n.scrollTop}},i.prototype._enableDragandScroll=function(){this.model.allowDragAndDrop&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._addDragableClass();this.model.allowScrolling&&(this.initialRender?(ej.isNullOrUndefined(this.model.fields.swimlaneKey)||(this._swimlaneRows=this.element.find(".e-swimlanerow")),this._renderScroller()):this._refreshScroller({requestType:"refresh"}));this.model.enableTotalCount&&this._totalCount()},i.prototype._refreshScroller=function(n){var t=this.getContent().first();ej.isNullOrUndefined(t.data("ejScroller"))||(n.requestType=="beginedit"&&this.getScrollObject().scrollY(0,!0),t.ejScroller("refresh"),t.ejScroller({enableRTL:this.model.enableRTL}),t.ejScroller("isVScroll")&&!this.getScrollObject().model.autoHide?(this.getHeaderContent().addClass("e-scrollcss"),this.getHeaderContent().find(".e-headercontent").hasClass("e-hscrollcss")||this.getHeaderContent().find(".e-headercontent").addClass("e-hscrollcss")):this.element.find(".e-kanbanheader").removeClass("e-scrollcss"))},i.prototype._cardCollapse=function(){var t,n,i;if(this._collapsedCards.length>0)for(t=this.element.find(".e-kanbancard"),n=0;n<t.length;n++)i=$(t[n]).find(".e-primarykey").text(),$.inArray(i,this._collapsedCards)!=-1&&this.toggleCard(i)},i.prototype._updateGroup=function(n,t){var i=this;ej.isNullOrUndefined(this._saveArgs)&&new ej.DataManager(i._currentJsonData).update(i.model.fields.primaryKey,t,"");$.type(t)&&!t.count&&i._renderSingleCard(n,t)},i.prototype.updateCard=function(n,t){ej.isNullOrUndefined(t)&&n&&(t=new ej.DataManager(this._currentJsonData).executeLocal((new ej.Query).where(this.model.fields.primaryKey,ej.FilterOperators.equal,n))[0]);t=ej.isNullOrUndefined(t)?null:t;var u,f=t,i=this,r=this._saveArgs;this._dataSource()instanceof ej.DataManager&&!this._dataManager.dataSource.offline||this._dataSource().adaptor instanceof ej.remoteSaveAdaptor?(u=ej.isNullOrUndefined(this._saveArgs)||this._saveArgs.action=="edit"?this._dataManager.update(this.model.fields.primaryKey,f):this._dataManager.insert(f),!ej.isNullOrUndefined(u)&&$.isFunction(u.promise)&&this._dataSource()instanceof ej.DataManager&&(u.done(function(u){!ej.isNullOrUndefined(u)&&$.isPlainObject(u.record)&&(ej.isNullOrUndefined(r)?t=u.record:(r.data=u.record,r.action=="add"&&(i._cAddedRecord=u.record),r.action=="edit"&&(i._cModifiedData=u.record)));ej.isNullOrUndefined(r)?i._updateGroup(n,t):i._processBindings(r);i._cModifiedData=null;i._cAddedRecord=null;i._isAddNewClick=!1;i._currentData=null;i._newCard=null;i._saveArgs=null;i._cardEditClick=null;i._dblArgs=null}),u.fail(function(n){var t;ej.isNullOrUndefined(r)?t=n:(r.error=n&&n.error?n.error:n,t=r);i._trigger("actionFailure",t)}))):ej.isNullOrUndefined(this._saveArgs)?i._updateGroup(n,t):i._processBindings(this._saveArgs);u!=undefined&&$.isFunction(u.promise)||(i._cModifiedData=null,i._cAddedRecord=null,i._isAddNewClick=!1,i._currentData=null,i._newCard=null,i._saveArgs=null,i._cardEditClick=null,i._dblArgs=null)},i.prototype._eventBindings=function(){var i,t,u,r,n,f;if(this._kanbanRows=this.getContentTable().get(0).rows,i=$(this._kanbanRows).not(".e-swimlanerow"),this._currentJsonData.length!=0&&this.model.queryCellInfo!=null)for(t=0;t<i.length;t++)for(u=i[t],r=this.model.columns,n=0;n<r.length;n++)f=$(u).find(".e-rowcell")[n],this._cellEventTrigger(f,r[n])},i.prototype._cellEventTrigger=function(n,t){for(var r=$(n).find(".e-kanbancard"),i=0;i<r.length;i++){var u=r[i].id,f=this._getKanbanCardData(this._currentJsonData,u),e={card:r[i],cell:n,column:t,data:f[0]};this._trigger("queryCellInfo",e)}},i.prototype._checkSkipAction=function(n){switch(n.requestType){case"save":case"delete":return!0}return!1},i.prototype._totalCount=function(){for(var t,n=0;n<this.model.columns.length;n++)if(t=this.model.columns[n],ej.isNullOrUndefined(t.constraints)&&this.model.enableTotalCount){var i=this.getHeaderContent().find("span.e-totalcount")[n],r=t.key,u=$($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+r+"]")),f=u.find(".e-kanbancard").length;$(i).text(f)}},i.prototype._renderLimit=function(){for(var n,o,s,f,e,r={},t=0;t<this.model.columns.length;t++)if(n=this.model.columns[t],!ej.isNullOrUndefined(n.constraints)){o=!ej.isNullOrUndefined(n.constraints.min);s=!ej.isNullOrUndefined(n.constraints.max);(o||s)&&(r=this.getHeaderContent().find(".e-columnheader").not(".e-stackedHeaderRow").find(".e-headercell")[t]);f=this.getHeaderContent().find("span.e-totalcount");var h=n.key,u=$($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+h+"]")),i=0;e=u.find(".e-kanbancard").length;$(f[t]).text(e);ej.isNullOrUndefined(n.constraints.type)&&(n.constraints.type="column");switch(n.constraints.type){case"column":this._validateLimit(n,r,i);break;case"swimlane":for(i=0;i<u.length;i++)this._validateLimit(n,r,i),this.getHeaderContent().find(".e-headercell").eq(t).hasClass("e-shrinkcol")||u.eq(i).find(".e-limits").removeClass("e-hide");ej.isNullOrUndefined(this.model.fields.swimlaneKey)||$(r).find(".e-limits").addClass("e-hide")}}},i.prototype._getEmptyTbody=function(){var n=ej.buildTag("td.e-emptycard",this.localizedLabels.EmptyCard,{},{colSpan:this.model.columns.length});return $(document.createElement("tr")).append(n)},i.prototype._getLocalizedLabels=function(){return ej.getLocalizedConstants(this.sfType,this.model.locale)},i}(ej.WidgetBase);window.ej.widget("ejKanban","ej.Kanban",new i);ej.Kanban.Actions={Filtering:"filtering",BeginEdit:"beginedit",Edit:"edit",Save:"save",Add:"add",Delete:"delete",Cancel:"cancel",Refresh:"refresh",Search:"searching",Print:"print"};ej.Kanban.EditingType={String:"stringedit",Numeric:"numericedit",Dropdown:"dropdownedit",DatePicker:"datepicker",DateTimePicker:"datetimepicker",TextArea:"textarea",RTE:"rteedit"};ej.Kanban.EditMode={Dialog:"dialog",DialogTemplate:"dialogtemplate",ExternalForm:"externalform",ExternalFormTemplate:"externalformtemplate"};ej.Kanban.FormPosition={Bottom:"bottom",Right:"right"};ej.Kanban.Type={Column:"column",Swimlane:"swimlane"};ej.Kanban.SelectionType={Multiple:"multiple",Single:"single"};ej.Kanban.Locale={}});
