/*!
*  filename: ej.spreadsheet.min.js
*  version : 17.4.0.39
*  Copyright Syncfusion Inc. 2001 - 2019. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["jsrender","jquery-validation","./../common/ej.core.min","./../common/ej.data.min","./ej.grid.min","./../common/ej.scroller.min","./../common/ej.globalize.min","./ej.calculate.min","./ej.waitingpopup.min","./../datavisualization/ej.chart.min","./ej.dialog.min","./ej.tab.min","./ej.button.min","./ej.splitbutton.min","./ej.togglebutton.min","./ej.checkbox.min","./ej.radiobutton.min","./ej.autocomplete.min","./ej.datepicker.min","./ej.dropdownlist.min","./ej.listbox.min","./ej.editor.min","./ej.pager.min","./ej.menu.min","./ej.treeview.min","./ej.uploadbox.min","./ej.colorpicker.min","./ej.excelfilter.min","./ej.ribbon.min","./ej.pivotschemadesigner.min","./ej.pivotgrid.min"],n):n()})(function(){(function(n,t,i){t.widget("ejSpreadsheet","ej.Spreadsheet",{_rootCSS:"e-spreadsheet",element:null,_excelFilter:null,validTags:["div"],model:null,_requiresID:!0,defaults:{allowFreezing:!0,enableContextMenu:!0,allowEditing:!0,allowResizing:!0,allowMerging:!0,allowWrap:!0,allowUndoRedo:!0,allowClipboard:!0,allowDataValidation:!0,allowConditionalFormats:!0,allowSearching:!0,allowKeyboardNavigation:!0,allowAutoFill:!0,allowSelection:!0,allowSorting:!0,allowDragAndDrop:!0,allowCellType:!0,allowAutoCellType:!1,allowCharts:!0,enablePersistence:!1,allowCellFormatting:!0,allowFormulaBar:!0,showRibbon:!0,showPager:!0,allowComments:!0,allowFiltering:!0,allowInsert:!0,allowDelete:!0,allowFormatPainter:!0,allowHyperlink:!0,allowImport:!0,allowFormatAsTable:!0,allowAutoSum:!0,enablePivotTable:!1,allowLockCell:!0,enableTouch:!0,allowOverflow:!0,allowClear:!0,allowSparkline:!1,isReadOnly:!1,isGridMode:!1,columnCount:21,rowCount:20,rowHeight:20,columnWidth:64,sheetCount:1,undoRedoStep:20,activeSheetIndex:1,apWidth:300,activationPanelWidth:300,_isActPanelVisible:!1,isImport:!1,cssClass:"",userName:"",locale:"en-US",pageSize:"A4",sparkDiv:"",sheets:[],nameManager:[],customFormulas:[],currentViewData:null,query:null,create:null,actionBegin:null,actionComplete:null,beforeCellFormat:null,cellFormatting:null,beforeOpen:null,beforePrint:null,beforeDrop:null,drop:null,cellEdit:null,pagerClick:null,cellClick:null,_pivotPrint:null,tabClick:null,tabSelect:null,_createPivotTable:null,beforePanelOpen:null,load:null,loadComplete:null,editRangeBegin:null,editRangeComplete:null,cellHover:null,menuClick:null,contextMenuClick:null,ribbonClick:null,dragStart:null,drag:null,cellSave:null,beforeCellSelect:null,cellSelected:null,autoFillBegin:null,autoFillComplete:null,openFailure:null,onImport:null,onExport:null,beforeImport:null,beforeBatchSave:null,keyUp:null,keyDown:null,dragShape:null,resizeStart:null,resizeEnd:null,refresh:null,beforeEditComment:null,beforeTabClick:null,scrollStop:null,formulaComputed:null,scrollSettings:{width:"100%",height:"100%",allowScrolling:!0,scrollMode:"infinite",isResponsive:!0,allowVirtualScrolling:!0,allowSheetOnDemand:!1},pageSettings:{pageCount:10,currentPage:1,pagerHeight:26},exportSettings:{allowExporting:!0,enableFormulaCalculation:!1,excelUrl:null,csvUrl:null,pdfUrl:null,password:null},pictureSettings:{allowPictures:!0,height:220,width:440},selectionSettings:{selectionType:"default",selectionUnit:"multirange",enableAnimation:!1,animationType:"linear",animationTime:.001,activeCell:""},chartSettings:{height:220,width:440},formatSettings:{allowFontFamily:!0,allowDecimalPlaces:!0,allowCellBorder:!0},autoFillSettings:{fillType:"fillseries",showFillOptions:!0},importSettings:{importMapper:"",importUrl:"",password:"",allowSheetOnDemand:!1,importOnLoad:!1},printSettings:{allowPageSetup:!0,allowPageSize:!1,allowPrinting:!0},ribbonSettings:{enableOnDemand:!1,applicationTab:{type:t.Ribbon.ApplicationTabType.Backstage,menuSettings:{isAppend:!1,dataSource:[]}}}},dataTypes:{pageSize:"enum",sheets:"array",nameManager:"array",scrollSettings:{scrollMode:"enum"},selectionSettings:{selectionType:"enum",selectionUnit:"enum",animationType:"enum"},autoFillSettings:{fillType:"enum"}},_dataSource:function(n){return this.getSheet(n).dataSource},getSheet:function(n){return this.model.sheets[this._getSheetIndex(n)]},getSheets:function(){return this.model.sheets},getSheetElement:function(n){return this.element.find("#"+this._id+"_"+this.getSheet(n).sheetInfo.value)},getDataSettings:function(n){var i,r=[],t=this.getSheet(n),u=t.rangeSettings.length;if(u)while(u--)i=t.rangeSettings[u],i.dataSource&&r.push(i);return r.length?r:t.dataSource?[t]:null},_getJSSheetHeader:function(n){return this._sheets[n]._sheetHeader},_setJSSheetHeader:function(n,t){this._sheets[t]._sheetHeader=n},_getInputBox:function(){return this._inputBox},_setInputBox:function(n){this._inputBox=n},_getIndexBox:function(){return this._indexBox},_setIndexBox:function(n){this._indexBox=n},_getJSSheetRowHeader:function(n){return this._sheets[n]._sheetRowHeader},_setJSSheetRowHeader:function(n,t){this._sheets[t]._sheetRowHeader=n},_getJSSheetRowHeaderContent:function(n){return this._sheets[n]._sheetRowHeaderContent},_setJSSheetRowHeaderContent:function(n,t){this._sheets[t]._sheetRowHeaderContent=n},_getJSSheetContent:function(n){return this._sheets[n]._sheetContent},_setJSSheetContent:function(n,t){this._sheets[t]._sheetContent=n},_getContent:function(n){return this._sheets[n]._content},_setContent:function(n,t){this._sheets[t]._content=n},getPager:function(){return this._spreadSheetPager},setPager:function(n){this._spreadSheetPager=n},getFooter:function(){return this._footer},setFooter:function(n){this._footer=n},getMainPanel:function(){return this._mainPanel},setMainPanel:function(n){this._mainPanel=n},getGroupPanel:function(){return this._groupPanel},setGroupPanel:function(n){this._groupPanel=n},getActivationPanel:function(){return this._activationPanel},setActivationPanel:function(n){this._activationPanel=n},getActiveSheetIndex:function(){return this.model.activeSheetIndex},setActiveSheetIndex:function(n){this.model.activeSheetIndex=n},getRows:function(n){return this._sheets[n]._Rows},setRows:function(n,t){this._sheets[t]._Rows=n},getFrozenRows:function(n){return this.getSheet(this._getSheetIndex(n)).frozenRows},setFrozenRows:function(n,t){this.model.isReadOnly||(this.getSheet(this._getSheetIndex(t)).frozenRows=n)},getFrozenColumns:function(n){return this.getSheet(n).frozenColumns},setFrozenColumns:function(n,t){this.model.isReadOnly||(this.getSheet(t).frozenColumns=n)},setFocusTopElem:function(n){this._focusTopElem=n},getFocusTopElem:function(){return this._focusTopElem},setFocusRightElem:function(n){this._focusRightElem=n},getFocusRightElem:function(){return this._focusRightElem},setFocusBottomElem:function(n){this._focusBottomElem=n},getFocusBottomElem:function(){return this._focusBottomElem},setFocusLeftElem:function(n){this._focusLeftElem=n},getFocusLeftElem:function(){return this._focusLeftElem},setAutoFillElem:function(n){this._autoFillElem=n},getAutoFillElem:function(){return this._autoFillElem},_setAutoFillOptElem:function(n){this._autoFillOptElem=n},_getAutoFillOptElem:function(){return this._autoFillOptElem},_getColWidth:function(n,t){return this.getSheet(t).columnsWidthCollection[n]},_getRowHeight:function(n,t){return this.getSheet(t).rowsHeightCollection[n]},setActiveCell:function(n,i,r){var f=this.getSheet(r?r:this.getActiveSheetIndex()),u;typeof n=="string"&&(u=this.getRangeIndices(n),n=u[0],i=u[1]);f._activeCell=t.isNullOrUndefined(n)&&t.isNullOrUndefined(i)?f._startCell:{rowIndex:n,colIndex:i}},getActiveCell:function(n){return this.getSheet(this._getSheetIndex(n))._activeCell},_setFormulaSuggElem:function(n){this._formulaSuggElem=n},_getFormulaSuggElem:function(){return this._formulaSuggElem},_setRowHdrTBody:function(n,t){this._sheets[t]._rowHdrTBody=n},_getRowHdrTBody:function(n){return this._sheets[n]._rowHdrTBody},_setContTBody:function(n,t){this._sheets[t]._contTBody=n},_getContTBody:function(n){return this._sheets[n]._contTBody},_init:function(){var n=this.model.importSettings;this._initBegin();this.model.allowImport&&(n.importUrl.length||n.importOnLoad)?this["import"]({url:n.importUrl,password:n.password,allowSheetOnDemand:n.allowSheetOnDemand}):(this.showWaitingPopUp(),this._initBase(),this._initComplete(),this._isSSLoaded=!0);this._isAutoWHMode&&this._setElemDimension();!this.model.isGridMode||this.getSheet(this.getActiveSheetIndex())._isDataManager||t.isNullOrUndefined(this.getDataSettings(this.getActiveSheetIndex()))||this._gridModeScroll(!0);this.addClass(this.element,this.model.cssClass);this._cssClass=this.model.cssClass},_initBegin:function(){var u="touch-action",i=this.model.scrollSettings,r=t.preferredCulture(this.model.locale).calendar.patterns,f;t.support.stableSort=!1;this._isInitLoad=!0;this._isDefaultLocked=!1;this._isSSLoaded=!1;this._computeFormula=!0;this.model.isGridMode&&(i.scrollMode="normal",this.model.showRibbon=!1,this.model.allowFormulaBar=!1,this.model.allowDragAndDrop=!1,this.model.allowResizing=!1,this.model.allowFreezing=!1,this.model.allowImport=!1);this._isAutoWHMode=!i.allowScrolling;this._isAutoWHMode&&(i.isResponsive=!1,i.scrollMode="normal",i.allowVirtualScrolling=!1);this._minWidth=280;this._minHeight=200;this._isAutoWHMode||this.element.css({height:i.height,width:i.width});(!this.model.isGridMode||this.model.isGridMode&&this.model.scrollSettings.allowScrolling)&&this.element.css({"min-height":this._minHeight,"min-width":this._minWidth});this._updateResponsiveSettings();this._isAutoWHMode||i.isResponsive||(i.width.toString().indexOf("%")>-1&&(i.width=this._responsiveWidth),i.height.toString().indexOf("%")>-1&&(i.height=this._responsiveHeight),this.element.css({height:i.height,width:i.width}));this._browserDetails=t.browserInfo();this.localizedLabels=t.getLocalizedConstants(this.sfType,this.model.locale);this.element.attr("tabindex",0);this._browserDetails.name==="msie"&&(u="-ms-"+u);this.element.css(u,"double-tap-zoom pinch-zoom");f=t.buildTag("div#"+this._id+"_wait","",{position:"absolute"});n(document.body).append(f);f.ejWaitingPopup({showOnInit:!1,target:this.element});r.dT=r.d+" "+r.T;this.model.locale!="en-US"&&(r.d&&(t.Spreadsheet.CellFormat.shortdate="{0:"+r.d+"}"),r.D&&(t.Spreadsheet.CellFormat.longdate="{0:"+r.D+"}"),r.T&&(t.Spreadsheet.CellFormat.time="{0:"+r.T+"}"))},_initBase:function(){var i=this.model.locale,r=t.preferredCulture(i),n;this._refreshModel(this.isImport||this.model.isImport?this._impData.model:this._isRefresh?this.model:null);this._isRefresh?this._updateCellType():this._initProps();n=this.getCalcEngine();i!=="en-US"&&(r.numberFormat["."]===","&&n.setParseArgumentSeparator(";"),n.setParseDecimalSeparator(r.numberFormat["."]));this._tabMode||this._phoneMode||this.model.isGridMode||(this._minHeight=400,this.element.css({"min-height":this._minHeight}));this._initCSSTag();this._initLayout();this._wireEvents("_on");this._isInitLoad=!1},_initProps:function(){var r=this.model,i=t.spreadsheetFeatures;this.XLClipboard=new i.clipboard(this);this.XLEdit=new i.editing(this);this.XLPrint=new i.print(this);this.XLRibbon=new i.ribbon(this);this.XLScroll=new i.scroller(this);r.allowDragAndDrop&&(this.XLDragDrop=new i.dragAndDrop(this));r.allowKeyboardNavigation&&(this.XLCellNav=new i.cellNavigation(this));r.allowFiltering&&(this.XLFilter=new i.filter(this));r.allowAutoFill&&(this.XLDragFill=new i.dragFill(this));(r.allowCellFormatting||r.allowFormatAsTable||r.allowFormatPainter)&&(this.XLFormat=new i.cellFormatting(this));r.allowCellFormatting&&(this.XLCellFrmtDlg=new i.formatCellDialog(this));r.allowConditionalFormats&&(this.XLCFormat=new i.cFormat(this));r.allowSearching&&(this.XLSearch=new i.findnreplace(this));r.allowCharts&&(this.XLChart=new i.chart(this));r.allowSparkline&&(this.XLSparkline=new i.sparkLine(this));r.exportSettings.allowExporting&&(this.XLExport=new i.exporting(this));r.allowSorting&&(this.XLSort=new i.sorting(this));r.allowFreezing&&(this.XLFreeze=new i.freezepane(this));r.allowComments&&(this.XLComment=new i.comments(this));r.allowSelection&&(this.XLSelection=new i.selection(this));(r.allowCharts||r.pictureSettings.allowPictures)&&(this.XLShape=new i.shape(this));r.allowResizing&&(this.XLResize=new i.resizing(this));r.enableContextMenu&&(this.XLCMenu=new i.contextmenu(this));r.allowDataValidation&&(this.XLValidate=new i.validation(this));r.allowCellType&&(this.XLCellType=new i.cellType(this));r.enablePivotTable&&(this.XLPivot=new i.pivot(this));i.math&&n.extend(t.Spreadsheet.prototype,i.math);this._initPvtProps();this._initFATProps();this.model.customFormulas.length&&this._updateCustomFormulas(this.model.customFormulas,"add");this.model.nameManager.length&&this._refreshNameMngr(this.model.nameManager)},_initPvtProps:function(){var u=1,i={rowIndex:0,colIndex:0},r=this._getLocStr("AutoFillOptions").split("/"),e=this.getActiveSheetIndex(),f=t.preferredCulture(this.model.locale).numberFormat;for(this._dataContainer=this.isImport||this.model.isImport?n.extend(!0,{},this._impData.dataContainer):{sheets:{},sheetCellType:{},hashCode:[],sharedData:[],cellType:[],valData:[],cFormatData:[],customCellStyle:{}},this._newSIndex=1,this.isImport=this.isImport||!1,this.mergeCenter=!1,this.isDirty=!1,this._calcID=CalcEngine.createSheetFamilyID(),this._calcEngine=new CalcEngine(this,this._calcID),this._calcEngine.setUseDependencies(!0),this._calcEngine.setExcelLikeComputations(!0),this._calcEngine.setUseDatesInCalculations(!0),this._calcEngine.setEnableFormulaErrorValidation(!0),this._calcEngine.setCalculatingSuspended(n("#"+this._id+"_CalcManual").find("span").hasClass("e-ss-calcauto")),this._sheets=[],this._cellProp=["value","value2","type","cFormatRule","range","thousandSeparator","rule","format","border","picture","chart","calcValue","align","hyperlink","formats","borders","tformats","tborders","isFilterHeader","filterState","tableName","comment","formatStr","decimalPlaces","cellType","isFilterHighlight","pivot","sparkline","hasFormulaArray","hasMultipleFormulaArray","formulaRange","customFormat"],this.model.isGridMode&&(this.model.sheets=this.model.sheets.splice(e-1,1)),this.isImport||this.model.isImport||(this.model.sheets.splice(0,0,{}),this._updateCellType()),this.model.isGridMode&&(this.model.sheetCount=1);u<=this.model.sheetCount;)this.isImport||this.model.isImport||(this._dataContainer.sheets[u]={}),this._sheetSettings(u),this._newSIndex++,u++;this._detachTable=null;this._isPrint=!1;this._isSheetInsert=!1;this._isSheetRename=!1;this._isTableRename=!1;this._tableClassName=null;this._isSheetNavigate=!1;this._sheetCopy={isSheetCopy:!1,sheetContent:null};this._alertDialog={element:null,action:null};this._dataManager=null;this._isUndo=!1;this._undoCollection=[];this._redoCollection=[];this._ctrlKeyCount=0;this._formulaRange=[];this._formulaHeight=36;this._isSort=!1;this._isPaste=!1;this._isFATResize=!1;this._isDisplayHeader=!1;this._currencySymbol=f.currency.symbol||"$";this._percentSymbol=f.percent.symbol||"%";this._decimalSeparator=f["."]||".";this.operators={"<":function(n,t){return n<t},">":function(n,t){return n>t},">=":function(n,t){return n>=t},"<=":function(n,t){return n<=t},"==":function(n,t){return n===t},"!=":function(n,t){return n!==t},"!":function(n){return!n},"=":function(n){return n}};this.parse={parseInt:function(n){return parseInt(n)},parseFloat:function(n){return parseFloat(n)},parseDate:function(n){return new Date(n).getTime()},parseTime:function(n){return new Date("01/01/1990 "+n).getTime()},length:function(n){return n.charAt(0)==="^"?parseInt(n.split("^")[1]):n.length}};this._selMergeCells=[];this._mergeType="merge-cells";this._delCells=[];this._deletedText=[];this._removeMergeColl=[];this._insData={};this._deletedDimension=[];this._insDelStatus="";this._isUndoRedo=!1;this._indexBox=null;this._inputBox=null;this._focusTopElem=null;this._focusRightElem=null;this._focusBottomElem=null;this._focusLeftElem=null;this._dStartCell=i;this._dEndCell=i;this._pStartCell=i;this._pEndCell=i;this._pFillCell=i;this._borderFocus=["e-focusright","e-focusbottom"];this._cutFocus=["e-cutright","e-cutbottom"];this._autoFillFocus=["e-autofillright","e-autofillbottom"];this._formulaBorder=[["e-bborderright","e-bborderbottom"],["e-rborderright","e-rborderbottom"],["e-vborderright","e-vborderbottom"],["e-gborderright","e-gborderbottom"],["e-pborderright","e-pborderbottom"],["e-oborderright","e-oborderbottom"]];this._ctrlFormulaBorder=[["e-bctrlborderright","e-bctrlborderbottom"],["e-rctrlborderright","e-rctrlborderbottom"],["e-vctrlborderright","e-vctrlborderbottom"],["e-gctrlborderright","e-gctrlborderbottom"],["e-pctrlborderright","e-pctrlborderbottom"],["e-octrlborderright","e-octrlborderbottom"]];this._borderTypes=[{id:"bottomborder",text:this._getLocStr("BottomBorder"),parentId:null,sprite:"e-icon e-ss-bottomborder"},{id:"topborder",text:this._getLocStr("TopBorder"),parentId:null,sprite:"e-icon e-ss-topborder"},{id:"leftborder",text:this._getLocStr("LeftBorder"),parentId:null,sprite:"e-icon e-ss-leftborder"},{id:"rightborder",text:this._getLocStr("RightBorder"),parentId:null,sprite:"e-icon e-ss-rightborder"},{id:"noborder",text:this._getLocStr("NoBorder"),parentId:null,sprite:"e-icon e-ss-noborder"},{id:"allborder",text:this._getLocStr("AllBorder"),parentId:null,sprite:"e-icon e-ss-allborder"}];this._datePattern=["year","month","day","hours","minutes","seconds"];this._styleColl={};this._borderStyle="solid";this._borderColor="#000000";this._borderStyles=["solid","dashed","dotted","double"];this._ddlCell=null;this._cOpt={};this._shapeChange=!1;this._dupDetails=!1;this._paste=!1;this._autoFillElem=null;this._autoFillOptElem=null;this._fillOptionMenuData=[{id:"copycells",text:r[0],parentId:null,sprite:"e-icon e-ss-fillselect"},{id:"fillseries",text:r[1],parentId:null,sprite:"e-icon e-ss-filloption"},{id:"fillformattingonly",text:r[2],parentId:null,sprite:"e-icon e-ss-filloption"},{id:"fillwithoutformatting",text:r[3],parentId:null,sprite:"e-icon e-ss-filloption"},{id:"flashfill",text:r[4],parentId:null,sprite:"e-icon e-ss-filloption"}];this._formulaSuggElem=null;this._isFormulaSuggestion=!1;this._shiftKeyEnabled=!1;this._preventctrlkey=!1;this._rAlign="e-ralign";this._cAlign="e-calign";this._chartBorder=[["e-rcborderright","e-rcborderbottom"],["e-vcborderright","e-vcborderbottom"],["e-bcborderright","e-bcborderbottom"]];this._selectionBorder=["e-selecttop","e-selectright","e-selectbottom","e-selectleft"];this._autofillBorder=["e-autofilltop","e-autofillright","e-autofillbottom","e-autofillleft"];this._thinBorder=["e-thinborderright","e-thinborderbottom"];this._rcRegx=new RegExp("\\be-rc.*\\b","g");this._formatRegx=new RegExp("\\be-format.*?\\b","g");this._borderRegx=new RegExp("\\be-border.*?\\b","g");this._formulaChanged=[];this._ref=[];this._nmRef=[];this._prevText="";this._prevVal="";this._dlgHLClick=!1;this._selectDataval={};this._undoInputobj={};this._cureditedCell="";this._colHeaderHeight=22;this._rowHeaderWidth=30;this._scrollerHeight=18;this._scrollerWidth=18;this._bufferCnt=5;this._maxRowCnt=1048576;this._maxColCnt=16384;this._impData=this._impData||null;this._isNew=!1;this._isSheetReq=!1;this._intrnlReq=!1;this._isTableBrdrEnd=!1;this._isFilterApplied=!1;this._commentCount=0;this._tableCnt=1;this._uploadImage=!1;this._responsiveWidth=0;this._responsiveHeight=0;this._celltypes=[];this._reqCnt=0;this._resCnt=0;this._pageClickArgs=null;this._gotoPageArgs=null;this._updateFormulaCollection();this._isRibbonClick=!1;this._intrnlUpdate=!1;this._isPvtNameEdit=!1;this._hlColor="#428bca";this._isFilter=!1;this._isShowHide=!1;this._insRows={};this._isTotalRow=!1;this._scrollReverse=!1;this._phoneMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth<420;this._tabMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth>419&&document.documentElement.clientWidth<617;this._dlgHeight=this._responsiveHeight-2;this._dlgWidth=this._responsiveWidth-2;this._isTouchEvt=!1;this._isTouchMoveSel=!1;this._isTouchScroll=!1;this._isScrolling=!1;this._startXY=null;this._touchArgs=null;this._isResized=!1;this._isRibbonDestroyed=!1;this._resizeColl=[];this._delWrapColl={};this._isInsdel=!1;this._canOverflow=!0;this.preventFilterPopup=!1;this._FATStyles={};this._isFiltered=!1;this._dautoFillCell={rowIndex:0,colIndex:0};this._isPublic=!1;this._fRow={rowAdj:!0,fRowCnt:0};this._fCol={colAdj:!0,fColCnt:0};this.isPasteValuesOnly=!1;this._isSaveAsJSON=!1;this._cssClass="";this._hideRowColl=[];this._isSort=!1;this._isKeyCtrlShftF2=!1;this._isSelIdxChange=!1;this._isRefresh=!1;this._clkCellObj={rowIndex:0,colIndex:0};this._copySheet=!1;this._isCopyPaste=!1;this._overFlowRowIdx=!1;this._tableRangesFormula={};this._tableFormulaCollection={};this._hasFormulaArray=!1;this._hasMultipleFormulaArray=!1;this._formulaArray=!1;this._isFormulaCln=!1;this._copyColumns={};this._isSameRowColumn=!1;this._prevCellTypes={};this._curCellTypes={};this._cellTypesUndo={};this._cellTypesRedo={};this._prevChartDetails={};this._curChartDetails={};this._chartRedo={};this._chartUndo={};this._isDataSrcMethod=!1;this._isallowScrollingSetModel=!1;this._isallowVirtualScrollingSetModel=!1;this._isGridModeSettings={};this._isGridModeWidthChange=!1;this._prevValData={};this._curValData={};this._valDataUndo={};this._valDataRedo={};this._isTrigCellSave=!1;this._ddCellSave=!1;this._saveTriggered=!1;this._isCFDirty=!1},_initFATProps:function(){var o,g,t="w:bold",i="c:#FFFFFF",n="c:#000000",l="c:#2F75B5",a="c:#ED7D31",v="c:#FFC000",r="1px solid #000000",u="1px solid #2f75b5",f="1px solid #ED7D31",e="1px solid #FFC000",y="b:#D9D9D9",s="b:#DDEBF7",p="b:#FCE4D6",w="b:#FFF2CC",nt="b:#000000",tt="b:#FFE2C6",it="b:#FFF1BF",h="b:#000000",rt="b:#D7D7D7",b="b:#FFC000",k="b:#5B9BD5",ut="b:#Ed7D31",d="hl?"+t+";"+n+";bo:tb-"+r+"&cl?"+y+";"+n+","+n+"&cb?b-"+r+"/hl?"+t+";bo:tb-"+u+";"+l+"&cl?"+s+";"+l+","+l+"&cb?b-"+u+"/hl?"+t+";bo:tb-"+f+";"+a+"&cl?"+p+";"+a+","+a+"&cb?b-"+f+"/hl?"+t+";bo:tb-"+e+";"+v+"&cl?"+w+";"+v+","+v+"&cb?b-"+e+"/hl?"+t+";"+nt+";"+i+";bo:o-"+r+"&cl?bo:t-"+r+";"+n+"&cb?o-"+r+"/hl?bo:o-"+u+";"+t+";"+k+";"+i+"&cl?bo:t-"+u+";"+n+"&cb?o-"+u+"/hl?"+t+";b:#EB7E2F;"+i+";bo:o-"+f+"&cl?bo:t-"+f+";"+n+"&cb?o-"+f+"/hl?"+t+";"+b+";"+i+";bo:o-"+e+"&cl?bo:t-"+e+";"+n+"&cb?o-"+e+"/hl?"+t+";bo:gb-"+r+";"+n+"&cl?"+y+";"+n+","+n+"&cb?gb-"+r+"/hl?"+t+";bo:gb-"+u+";"+n+"&cl?"+s+";"+n+","+n+"&cb?gb-"+u+"/hl?"+t+";bo:gb-"+f+";"+n+"&cl?"+p+";"+n+","+n+"&cb?gb-"+f+"/hl?"+t+";bo:gb-"+e+";"+n+"&cl?"+w+";"+n+","+n+"&cb?gb-"+e+"/hl?"+t+";"+nt+";"+i+"&cl?b:#A6A6A6;"+n+","+y+";"+n+"/hl?"+t+";"+k+";"+i+"&cl?b:#BDD7EE;"+n+","+s+";"+n+"/hl?"+t+";"+ut+";"+i+"&cl?b:#F8CBAD;"+n+","+p+";"+n+"/hl?"+t+";"+b+";"+i+"&cl?b:#FFE699;"+n+","+w+";"+n+"/hl?"+t+";"+rt+";"+n+";bo:gb-"+r+"&cl?b:#A7A7A7;"+n+","+rt+";"+n+"&cb?gb-"+r+"/hl?"+t+";b:#DBECF6;"+n+";bo:gb-"+u+"&cl?b:#BED8F1;"+n+","+s+";"+n+"&cb?gb-"+u+"/hl?"+t+";"+tt+";"+n+";bo:gb-"+f+"&cl?b:#F6CAAD;"+n+","+tt+";"+n+"&cb?gb-"+f+"/hl?"+t+";"+it+";"+n+";bo:gb-"+e+"&cl?b:#FDE18D;"+n+","+it+";"+n+"&cb?gb-"+e+"/hl?"+t+";"+h+";"+i+"&cl?b:#404040;"+i+",b:#737373;"+i+"/hl?"+t+";"+h+";"+i+"&cl?b:#2F75B5;"+i+","+k+";"+i+"/hl?"+t+";"+h+";"+i+"&cl?b:#C65911;"+i+","+ut+";"+i+"/hl?"+t+";"+h+";"+i+"&cl?b:#BF8F00;"+i+","+b+";"+i,c=["Light1","Light2","Light3","Light5","Light8","Light9","Light10","Light12","Light15","Light16","Light17","Light19","Medium8","Medium9","Medium10","Medium12","Medium22","Medium23","Medium24","Medium26","Dark1","Dark2","Dark3","Dark5"];for(d=d.split("/"),o=0,g=c.length;o<g;)this._FATStyles["TableStyle"+c[o]]={format:this.XLRibbon._getFormatAsTableInput(d[o]),formatName:"TableStyle"+c[o]},o++;this.XLFormat._formatAsTableStyle=this._FATStyles["TableStyle"+c[0]]},_updateResponsiveSettings:function(){var i=t.browserInfo().name==="msie"&&t.browserInfo().version==="8.0",n=this.element[0].getClientRects()[0];this._responsiveHeight=Math.floor(i?this.element[0].offsetHeight:n?n.height:0);this._responsiveWidth=Math.floor(i?this.element[0].offsetWidth:n?n.width:0)},_gridModeScroll:function(n){var u,i,h=this.getActiveSheetIndex(),t=this.getSheet(h),r=this.getSheetElement(h),e=this._getContent(h),f=e.find("#"+this._id+"_content"),l=this._footer.outerHeight(!0),s=this._scrollerHeight,o=this._scrollerWidth,c=t._vPortWth,a=t._vPortHgt,v=0,y=0,p,w,b=e.find("#vscrollBar"),k=e.find("#hscrollBar");if(w=u=f.find(".e-table").width(),p=i=f.find(".e-table").height(),this.model.scrollSettings.allowScrolling){if(this.getObjectLength(this._isGridModeSettings)&&(this._isGridModeSettings.width<=u&&(u=this._isGridModeSettings.width,t._vPortWth=c=this._isGridModeSettings.vPortWt,y=this._isGridModeSettings.cWt),this._isGridModeSettings.height<=i&&(i=this._isGridModeSettings.height,t._vPortHgt=a=this._isGridModeSettings.vPortHt,v=this._isGridModeSettings.cHt)),(e.find("#vscrollBar")[0].style.display=="none"||v>=p)&&(r.find(".e-spreadsheetheader").hasClass("e-scrollcss")&&(r.find(".e-spreadsheetheader").removeClass("e-scrollcss"),r.find(".e-spreadsheetheader")[0].style.width=parseInt(r.find(".e-spreadsheetheader")[0].style.width)+18+"px"),o=0),(e.find("#hscrollBar")[0].style.display=="none"||y>=w)&&(r.find(".e-spreadsheetrowheader").hasClass("e-scrollrowcss")&&(r.find(".e-spreadsheetrowheader").removeClass("e-scrollrowcss"),r.find(".e-spreadsheetrowheader")[0].style.height=parseInt(r.find(".e-spreadsheetrowheader")[0].style.height)+18+"px"),s=0),u>c&&this.model.scrollSettings.allowScrolling)return;t._isNavigated||(r.find(".e-spreadsheetrowheader")[0].style.height=i+"px",r.find(".e-rowheadercontent")[0].style.height=i+"px",e[0].style.height=i+"px",f[0].style.height=i+"px");u>c&&(u=c+17,o=0);t._isNavigated||(r.find(".e-spreadsheetcontent")[0].style.width=u+o+this._rowHeaderWidth+"px",f[0].style.width=u+"px");i>a&&(i=a+17,s=0);t._isNavigated||(this.element.find(".e-spreadsheetmainpanel")[0].style.height=i+this._colHeaderHeight+l+"px",this.element.find(".e-spreadsheetgrppanel")[0].style.height=i+this._colHeaderHeight+l+"px",r.find(".e-spreadsheetrowheader")[0].style.height=i+"px",r.find(".e-rowheadercontent")[0].style.height=i+"px",e[0].style.height=i+"px",f[0].style.height=i+"px");this.element.css({"min-height":"0",width:u+o+(t.showHeadings?this._rowHeaderWidth:0)+2+"px",height:i+s+(t.showHeadings?this._colHeaderHeight:0)+2+l+"px"})}n&&(this._isGridModeSettings={cHt:f.height(),cWt:f.width(),vPortWt:t._vPortWth,vPortHt:t._vPortHgt,width:u,height:i});t._contWidth=u+o;t._contHeight=i+s;!this.model.scrollSettings.allowVirtualScrolling||t._isNavigated||n||(b&&(b[0].style.display="none"),k&&(k[0].style.display="none"),o&&(t._contWidth=t._contWidth+18,f[0].style.width=u+18+"px"),s&&(t._contHeight=t._contHeight+18,f[0].style.height=i+18+"px"),this.XLScroll._refreshScroller(h,"refresh","all"),o&&(t._contWidth=t._contWidth-18),s&&(t._contHeight=t._contHeight-18),t._virtualBlockRowCnt=Math.ceil(t._vPortHgt/t.rowHeight)+this._bufferCnt,this._refreshViewport(0,h));t._isNavigated=!0},_getElementDimension:function(){var f=0,t,e=0,o=0,i,r,u;return this.model.showRibbon&&(i=n("#"+this._id+"_Ribbon").data("ejRibbon"),t=i.element[0].offsetWidth,f=i.element[0].offsetHeight),this.model.allowFormulaBar&&(r=n("#"+this._id+"_formulabar")[0],e=r.offsetHeight,t||(t=r.offsetWidth)),u=this.element.find(".e-spreadsheetmainpanel")[0],o=u.offsetHeight,t||(t=u.offsetWidth),{width:t+2,height:f+e+o+1}},_sheetSettings:function(i){var o,f,u,s,c,r,e,l,h;if(this._isSheetReq?f=this.getSheet(i):(r=this.getSheet(i),c=this._generateSheetName(this._newSIndex),f=this.model.sheets[i]={colCount:r&&r.colCount||this.model.columnCount,rowCount:r&&r.rowCount||this.model.rowCount,_formulaCollection:{},columnsWidthCollection:[],_colWidthCollection:[],_ofColWidthColl:[],rowsHeightCollection:[],_rowHeightCollection:[],_rowIdxColl:[],_spreadSheetPager:null,showHeadings:r&&!this.isUndefined(r.showHeadings)?r.showHeadings:!0,showGridlines:r&&!this.isUndefined(r.showGridlines)?r.showGridlines:!0,dataSource:r&&r.dataSource||null,_jsonData:r?r.dataSource instanceof t.DataManager?null:r.dataSource:null,_dataManager:r&&r.dataSource instanceof t.DataManager?r.dataSource:null,query:r&&r.query||null,primaryKey:r&&r.primaryKey||"",startCell:r&&r.startCell||"A1",topLeftCell:r&&r.topLeftCell||"A1",fieldAsColumnHeader:r&&r.fieldAsColumnHeader||!1,showHeader:r&&r.showHeader===!1?!1:!0,headerStyles:r&&r.headerStyles||null,batchChanges:{added:[],changed:[],deleted:[]},range:[0,0,0,0],fields:[],_isDataManager:!1,_isOffline:!1,_hasDataSrc:!1,columns:r&&r.columns||[],_columnStyles:{},_rowStyles:{},cellTypes:r&&r.cellTypes||[],rows:r&&r.rows||null,_excelFilter:null,filterSettings:{filteredColumns:[],maxFilterChoices:1e3,filteredRange:[],range:"",tableRange:[]},paperSettings:{paperOrientation:"Portrait",pageSize:"PaperLetter",bottomMargin:"0.75",headerMargin:"0.3",footerMargin:"0.3",leftMargin:"0.7",rightMargin:"0.7",topMargin:"0.75"},frozenRows:r&&r.frozenRows||0,frozenColumns:r&&r.frozenColumns||0,_frozenRows:r&&r.frozenRows&&r.frozenRows+1||1,_frozenColumns:r&&r.frozenColumns&&r.frozenColumns+1||1,_fHMergeRows:[],_fHMergeCols:[],paneTopLeftCell:r&&r.paneTopLeftCell||"A1",_selectedRange:{},_selectedCellColors:[],columnWidth:r&&r.columnWidth||this.model.columnWidth,rowHeight:this.model.rowHeight,_frozenHeight:0,_frozenWidth:0,_firstRow:{idx:0,value:0},_firstCol:{idx:0,value:0},_topRow:{idx:0,value:0},_bottomRow:{idx:0,value:0},_leftCol:{idx:0,value:0},_rightCol:{idx:0,value:0},_filterColl:{},_filteredColumns:[],_commentColl:{},_mergeColl:{},_unmergeColl:{},_delmergeColl:{},_hideMergeColl:{},_clrMergeColl:[],_clrWrapColl:[],_selectedCells:[],selectedRange:[0,0,0,0],tableManager:{},_header:{},_selectedCellIndexes:[],_startCell:{rowIndex:0,colIndex:0},_endCell:{rowIndex:0,colIndex:0},_activeCell:{rowIndex:0,colIndex:0},_autoFillCell:{rowIndex:0,colIndex:0},rangeSettings:r&&r.rangeSettings||[],sheetInfo:{text:c,value:this._getLocStr("Sheet")+this._newSIndex,isVisible:!0},_multipleFiltering:!1,_multifilterIdx:[],_filteredByColor:"",staticWidth:0,_fRow:0,_fCol:0,hideColsCollection:{},hideRowsCollection:r&&r.hideRowsCollection||[],_hiddenFreezeRows:[],_hiddenFreezeCols:[],_filterHRowsColl:[],_restrictedHeightRows:[],filteredRowsCollection:[],_rHeightCollection:[],_frHiddenHeight:0,_fpHiddenHeight:0,_fpHiddenWidth:0,_pTarget:{},_cSpan:1,_rSpan:1,usedRange:{rowIndex:0,colIndex:0},mergedCells:[],shapeMngr:{picture:{},chart:{},sharedPics:[],sparkline:{}},formulaRange:{},pivotMngr:{pivot:{}},_nmValue:{},_nmEdit:!1,_wrapHtCollection:{},_isChartBorderDrawn:!1,_virtualBlockCnt:0,_virtualBlockRowCnt:0,_virtualContBlockIdx:1,_virtualTopTBodyHgt:0,_virtualBottomTBodyHgt:0,_virtualTBodyHgt:0,_scrollTop:0,_scrollLeft:0,_virtualRowIdx:[],_virtualTopTBodyOffset:{top:0,bottom:0},_virtualContTBodyOffset:{top:0,bottom:0},_virtualBottomTBodyOffset:{top:0,bottom:0},_virtualDataLoadedBlks:[],_virtualDataMngrLoadedBlks:[1,2],_isVirtualTopReached:!0,_isVirtualEndReached:!1,_isLoaded:!1,_isNavigated:!1,_isImpSLoad:!1,_isRowSelected:!1,_isColSelected:!1,_isSheetSelected:!1,isSheetProtected:!1,_contWidth:0,_isRangeSelected:!1,_isEmptyActiveCell:!1,_isMultiSelect:!1,_isImported:this.isImport,_isRequested:!1,_goToCollection:{multiple:!1,selected:[]},_showLockCellAlert:!1,_reqCnt:0,_resCnt:0,_templateColCount:0,_isTemplate:!1,_cFormatFormula:{},_isVPRendered:!1,_isDataMoved:!1,_vPortHgt:0,_vPortWth:0,cFormatRule:r&&r.cFormatRule||[],mergeCells:r&&r.mergeCells||[],hideRows:r&&r.hideRows||[],hideColumns:r&&r.hideColumns||[],border:r&&r.border||[],isResized:!1,_isOpened:!1,_wrapColl:{},_formatColl:{},_isFreezed:!1,_ftopRowIdx:0,_fleftColIdx:0,_contScrollTop:0,_contScrollLeft:0,_fDivTop:0,_fDivLeft:0,_isRibCollapsed:!1,_wrapValColl:{rows:{},cols:{}},_refrshObj:{},_scopeRanges:{},_mergeSpan:{},_renderedRange:[]},this._initRangeSettings(i),s=f.sheetInfo.value,this._sheets[i]={_contentColGroup:null,_content:null,_sheetRowHeaderContent:null,_sheetHeader:null,_sheetRowHeader:null,_sheetContent:null,_Rows:null,_contTBody:null,_rowHdrTBody:null},this._calcEngine.registerGridAsSheet(s,s,this._calcID)),(this.isImport||this.model.isImport)&&(u=this._impData.model.sheets[i],o=this.getRangeIndices(u.topLeftCell||"A1"),f.sheetInfo.text=u.sheetInfo.text,f.sheetInfo.isVisible=this.isUndefined(u.sheetInfo.isVisible)?!0:u.sheetInfo.isVisible,this.model.importSettings.allowSheetOnDemand&&i!==this.getActiveSheetIndex()||(f._isRequested=!0),f._isRequested)){if(u.paperSettings&&(f.paperSettings=n.extend({},f.paperSettings,u.paperSettings)),u.usedRange&&(u.usedRange.rowIndex&&(f.usedRange.rowIndex=u.usedRange.rowIndex),u.usedRange.colIndex&&(f.usedRange.colIndex=u.usedRange.colIndex)),u._startCell&&(u._startCell.rowIndex&&(f._startCell.rowIndex=u._startCell.rowIndex),u._startCell.colIndex&&(f._startCell.colIndex=u._startCell.colIndex)),u._endCell&&(u._endCell.rowIndex&&(f._endCell.rowIndex=u._endCell.rowIndex),u._endCell.colIndex&&(f._endCell.colIndex=u._endCell.colIndex)),u._activeCell&&(u._activeCell.rowIndex&&(f._activeCell.rowIndex=u._activeCell.rowIndex),u._activeCell.colIndex&&(f._activeCell.colIndex=u._activeCell.colIndex)),u.columnsWidthCollection&&(f.columnsWidthCollection=u.columnsWidthCollection),u.rowsHeightCollection){for(h=u.hideRowsCollection||[],e=0,l=h.length;e<l;e++)u.rowsHeightCollection[parseInt(h[e])]=0;f.rowsHeightCollection=n.extend(!0,[],u.rowsHeightCollection)}t.isNullOrUndefined(u.showGridlines)||(f.showGridlines=u.showGridlines);u.hideRowsCollection&&(f.hideRowsCollection=u.hideRowsCollection||[]);u.hideColsCollection&&(f.hideColsCollection=u.hideColsCollection||[]);u.formulaRange&&(f.formulaRange=u.formulaRange||{});u.shapeMngr.picture.length&&(f.shapeMngr.sharedPics=u.shapeMngr.sharedPics);u.isSheetProtected&&(f.isSheetProtected=u.isSheetProtected);u._restrictedHeightRows&&(f._restrictedHeightRows=u._restrictedHeightRows||[]);u._isColSelected&&(f._isColSelected=u._isColSelected);u._isRowSelected&&(f._isRowSelected=u._isRowSelected);u.showHeadings===!1&&(f.showHeadings=!1);u.frozenRows&&(f.frozenRows=f._frozenRows=o[0]+u.frozenRows,f._frozenRows=f.frozenRows+1);u.frozenColumns&&(f.frozenColumns=f._frozenColumns=o[1]+u.frozenColumns,f._frozenColumns=f.frozenColumns+1)}},_generateSheetName:function(n){var t,f,r,i,o=1,u=this.model.sheets,e=this._getLocStr("Sheet");for(i=u[n],r=i&&i.sheetName||e+n,t=1,f=u.length;t<f;t++)u[t].sheetInfo&&r===u[t].sheetInfo.text&&(t=0,r=i&&i.sheetName?i.sheetName+o++:e+ ++n);return r},_initRangeSettings:function(n){var i,u=this.getSheet(n),r=u.rangeSettings.length;if(r)while(r--)i=u.rangeSettings[r],i.dataSource&&(i._jsonData=i._dataManager=null,i.dataSource instanceof t.DataManager?i._dataManager=i.dataSource:i._jsonData=i.dataSource,i.showHeader!=!1&&(i.showHeader=!0))},_initCSSTag:function(){if(!document.getElementById(this._id+"_sscustomformat")){(this.isImport||this.model.isImport)&&(this._dataContainer.hashCode=[]);var n,r,i=0,t;if(t=this._renderStyleTag("custom"),(this.isImport||this.model.isImport)&&this._refreshImpStyles(this._impData.dataContainer.hashCode),this.XLFormat)for(n="s:11pt/b:#FFC7CE;c:#82012A;f:calibri;s:11pt/b:#C6EED2;c:#0A7043;f:calibri;s:11pt/b:#FEEC9B;c:#826717;f:calibri;s:11pt/f:Calibri;w:bold;v:top;s:11pt/f:calibri;s:18pt/b:#DDE5F6;f:calibri;s:11pt/b:#FDE0D2;f:calibri;s:11pt/b:#EEEEEC;f:calibri;s:11pt/b:#FEF4CD;f:calibri;s:11pt/b:#9CC0E7;f:calibri;s:11pt/b:#F9AD7B;f:calibri;s:11pt/b:#C9C9C9;f:calibri;s:11pt/b:#FED965;f:calibri;s:11pt/b:#559AD9;c:#FFFFFF;f:calibri;s:11pt/b:#EB7E2F;c:#FFFFFF;f:calibri;s:11pt/b:#A5A5A5;c:#FFFFFF;f:calibri;s:11pt/b:#FDBF01;c:#FFFFFF;f:calibri;s:11pt".split("/"),r=n.length;i<r;)this.XLFormat._createFormatClass(this._getStyleAsJSON(n[i]),null,!0),i++;n=".e-spreadsheet .e-hide, .e-spreadsheet .e-mc-hide, .e-spreadsheet .e-fr-hide, .e-spreadsheet .e-fc-hide, .e-spreadsheet .e-c-hide, .e-spreadsheet .e-r-hide, .e-spreadsheet .e-col-hide{ display: none}";n+=".e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-redft { background-color: #FFC7CE; color: #9C0055;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-yellowft { background-color: #FFEB9C; color: #9C6500;}";n+=".e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-greenft { background-color: #C6EFCE;   color: #006100;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-redf { background-color: #FFC7CE;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-redt { color: #9C0055;}";n+=".e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-hlcell { background-color: #FFFF00; color: #FF0000;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-goto-blank { background-color: #C6C6C6;}";t.styleSheet?t.styleSheet.cssText+=n:t.appendChild(document.createTextNode(n))}this._renderStyleTag("showhide")},_initEditForm:function(){var n,i,r;n=t.buildTag("input","",{display:"none"},{id:this._id+"_AutoComplete"});n.addClass("e-hide");this.element.append(n);this.XLEdit._renderAutoComplete(n,"",null,!0);n.data("ejAutocomplete")._setListPosition=function(){};i=t.buildTag("form","",{width:1,height:1,display:"none"},{id:this._id+"EditForm"});r=t.buildTag("input","",{width:1,height:1,overflow:"hidden",opacity:0},{id:this._id+"_ValElem"});i.append(r);r.data("id",this._id);this.element.append(i)},_getStyleAsJSON:function(n){var t,r,i=0,u={},f={b:"background-color",c:"color",f:"font-family",s:"font-size",w:"font-weight",v:"vetical-align",bo:"border"};for(n=n.split(";"),r=n.length;i<r;)t=n[i].split(":"),u[f[t[0]]]=t[0]==="bo"?this.XLRibbon._getBorderObj(t[1].split("-")[0],t[1].split("-")[1]):t[1],i++;return u},_initLayout:function(){this.model.showRibbon&&(this.XLRibbon._renderRibbon(),this._tabMode&&n("#"+this._id+"_Ribbon").ejRibbon("collapse"));this.model.allowFormulaBar&&this._renderFormulaBar();this._renderFUpload();this._renderLayout()},_renderLayout:function(){var n,i,r=this.getDataSettings(this.getActiveSheetIndex());if(this.model.isGridMode&&t.isNullOrUndefined(r)){this._renderAlertdlg();this._showAlertDlg("Alert","GridDataSourceAlert","",630);this.element.css({height:0,width:0,"min-height":0,"min-width":0});return}for(this._renderPanel(),this._initTags(),this._initDependencies(),this._renderFooter(),this._refreshSheetLayout(),this.model.scrollSettings.allowVirtualScrolling||this.model.scrollSettings.allowSheetOnDemand?n=i=this.getActiveSheetIndex():(n=1,i=this.model.sheetCount);n<=i;)this._initSheet(n),n++},_renderPanel:function(){var i,n,r=this.model.scrollSettings;i=t.buildTag("div.e-spreadsheetgrppanel","",{},{id:this._id+"GroupPanel"});this.setGroupPanel(i);n=t.buildTag("div.e-spreadsheetmainpanel",this._renderDIV("e-spreadsheet-list",""),{},{id:this._id+"MainPanel"});i.append(n);this.setMainPanel(n);n=t.buildTag("div.e-spreadsheetactpanel","",{height:r.height,width:this.model.activationPanelWidth-1,display:"none"},{id:this._id+"ActivationPanel"});i.append(n);this.setActivationPanel(n);this.element.append(i)},_refreshSheetLayout:function(){var i,r,t,u,f=-1,e=this.model.pageSettings.pagerHeight+1;this._updateResponsiveSettings();this.XLRibbon._ribbonState&&(f=n("#"+this._id+"_Ribbon").find(".e-content:eq(1)").height());t=this._phoneMode?n("#"+this._id+"_Ribbon").height():n("#"+this._id+"_Ribbon").find(".e-header").height()+f+2;r=this.model.allowFormulaBar?this._formulaHeight:0;u=t&&this.model.showRibbon&&n("#"+this._id+"_Ribbon").is(":visible")?t:0;this.model.showPager&&this.element.find(".e-spreadsheetfooter").is(":visible")||(e=1);i=this._responsiveHeight-(u+r+2);this._browserDetails.name=="msie"||this._isAutoWHMode||this.element.find(".e-spreadsheet-list").height(i-e)},_initTags:function(){var n=t.buildTag("span#"+this._id+"_emptySpan"),i=t.buildTag("div#"+this._id+"_emptyDiv");this.element.find(".e-spreadsheetmainpanel")[0].insertBefore(n[0],this.element.find(".e-spreadsheetmainpanel").find(".e-spreadsheet-list")[0]);this.element.find(".e-spreadsheetmainpanel")[0].insertBefore(i[0],this.element.find(".e-spreadsheetmainpanel").find(".e-spreadsheet-list")[0]);this._refreshGlobalSpan()},_refreshGlobalSpan:function(t,i){t=t||document.getElementById(this._id+(i?"_emptyDiv":"_emptySpan"));t.textContent="";t.className="";this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0"?n(t).removeAttr("style").text(""):t.removeAttribute("style")},_initSheet:function(n){var u,t=0,i=this.getSheet(n),r=this.getDataSettings(n);if(this._updateResponsiveSettings(),this._initViewPort(n),r&&!this._sheetCopy.isSheetCopy)for(u=r.length;t<u;)this._initDataSrc(n,i,r[t]),t++;i._reqCnt===i._resCnt&&this._renderSheet(n)},_initViewPort:function(i){var k=-1,o,u,s,h,c,l,a,v,y,p,d,e,f,tt=this._dataContainer.sheets,w,g,nt=this.model.scrollSettings,r=this.getSheet(i),b;if(o=u=h=c=l=a=v=b=0,nt.allowScrolling&&(h=this._scrollerHeight,c=this._scrollerWidth),r.showHeadings&&(l=this._colHeaderHeight,a=this._rowHeaderWidth),this.model.showRibbon&&(s=this.getSheet(this.getActiveSheetIndex())._isRibCollapsed?0:s=n("#"+this._id+"_Ribbon_home").height(),u=this.element.find(".e-box.e-addborderbottom.e-header").height()+s+2,u=u<189?u:188),this.model.allowFormulaBar&&(v=this._formulaHeight),this.model.showPager&&this.element.find(".e-spreadsheetfooter").is(":visible")&&(k=this.model.pageSettings.pagerHeight),this.getActivationPanel().is(":visible")&&(o=this.getActivationPanel().width()),r._vPortHgt=this._responsiveHeight-(u+v+l+k+h),r._vPortWth=this._responsiveWidth-(o+c+a),nt.allowVirtualScrolling&&(b=r._virtualBlockRowCnt,r._virtualBlockRowCnt=Math.ceil(r._vPortHgt/r.rowHeight)+this._bufferCnt,r._hasDataSrc&&b<r._virtualBlockRowCnt))for(y=r._virtualBlockRowCnt,p=r._virtualDataLoadedBlks,d=p.length,e=0;e<d;e++)for(w=p[e]*y,g=w-y,f=g+1;f<=w;f++)t.isNullOrUndefined(tt[i][f])&&this._refreshDataSrc([f,0,f,r.usedRange.colIndex,i])},_initDataSrc:function(n,i,r){var f,u={sheetIndex:n,lockWorkbookCells:!1,computeFormula:this._computeFormula};r._dataManager?(this._trigger("load",u),this._isDefaultLocked=u.lockWorkbookCells,this._computeFormula=u.computeFormula,r._dataManager instanceof t.DataManager&&(r._dataManager.ready?(f=this,i._reqCnt++,this._reqCnt++,r._dataManager.ready.done(function(){f._initDataMngr(n,i,r)})):this._initDataMngr(n,i,r))):r._jsonData&&(r.count=r._jsonData.length)},_initDataMngr:function(n,i,r){var f,e,c,h,l,o,s=0,u=this;if(r._isDataManager=!0,r._isOffline=r._dataManager.dataSource.offline,r.query||(r.query=new t.Query),r.query.requiresCount(),this.model.scrollSettings.allowVirtualScrolling){if(h=r.query.queries,f=h.length,f)while(f--)e=h[f],e.fn==="onTake"?(s=e.e.nos,h.splice(f,1)):e.fn==="onSkip"&&(r._skip=e.e.nos);o=i._virtualBlockRowCnt*2;r.startCell&&(c=this.getRangeIndices(r.startCell),c[0]&&(o-=c[0]-0));s&&s<o&&(o=s);r.query.take(o)}l=r._dataManager.executeQuery(r.query);l.done(function(t){f=t.count||t.result.length;f&&(r._jsonData=t.result,r.count=u.model.isGridMode?t.result&&t.result.length>0?t.result.length:1:s||f);u._isDataSrcMethod?(i.fieldAsColumnHeader?(i.columns=[],u._initTmplColumns(n),u.refreshContent(n),this._isDataSrcMethod=!1):(u.refreshContent(n),this._isDataSrcMethod=!1),u._isAutoWHMode&&u._setElemDimension(),u.model.isGridMode&&!u._isAutoWHMode&&this._gridModeScroll(!0)):(u._respHandler(n),u.model.isGridMode&&!u._isAutoWHMode&&u._gridModeScroll(!0))});l.fail(function(){u._respHandler(n)});r._dataManager.isDataAvailable||(i._reqCnt++,this._reqCnt++)},_respHandler:function(n){var t=this.getSheet(n);t._resCnt++;this._resCnt++;t._reqCnt===t._resCnt&&this._renderSheet(n);this._initComplete();this._isAutoWHMode&&this._setElemDimension()},_renderSheet:function(i){var u,o,v,s,f=this.getActiveSheetIndex(),r=this.getSheet(i),y=r.sheetInfo.value,h={},c=this.element.find("#"+this._id+"_"+y),l={sheetIndex:i,lockWorkbookCells:this._isDefaultLocked,computeFormula:this._computeFormula},a,e,p;for(this._resizeColl[i-1]=!1,this._isInitLoad&&this._trigger("load",l),this._isDefaultLocked=l.lockWorkbookCells,this._computeFormula=l.computeFormula,this._initTmplColumns(i),u=c.length===1?c:t.buildTag("div.e-sheet e-hide ","",{},{id:this._id+"_"+y}),a=this._renderContent(i),e=0,p=a.length;e<p;e++)u.append(a[e]);c.length||(this.model.allowFreezing&&(s=this.XLFreeze._getHFreeze()),s?s.before(u):this.element.find(".e-spreadsheet-list").append(u));r.showGridlines===!1&&n("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").ejCheckBox({checked:r.showGridlines});this.model.enableContextMenu&&(this.XLCMenu._initContextMenu(),this.XLCMenu._initColorDialog(),this.XLCMenu._initCMenuFooter());this._updateResponsiveSettings();this._removeClass(u,"e-hide");h.width=this._responsiveWidth;h.height=this._responsiveHeight;this.model.showRibbon&&!this._isAutoWHMode&&(this._tabMode||this._responsiveHeight<280)&&n("#"+this._id+"_Ribbon").ejRibbon("collapse");this._setSheetWidthHeight(i,h,null,"refresh","initial");this._refreshCellBinding(i);this._refreshImpResRowHght(i);this.refreshContent(i);i===f&&this._updateHiddenRows(f);this._initializePicture(i);this.model.allowCellType&&this.model.allowAutoCellType&&this._celltypes.length&&this._processCellTypes(this._celltypes,i);this.model.allowCellType&&!this.model.scrollSettings.allowVirtualScrolling&&this.XLCellType._rangeCellTypes(r.cellTypes,i);r._isImported&&!this._sheetCopy.isSheetCopy&&(this.setActiveSheetIndex(i),this._refreshImpSheets(i),this.setActiveSheetIndex(f));i!==f?u.hide():this._initSelection();this._initSheetModel(i);(this.isImport||this.model.isImport)&&r._isFreezed&&(v=this._impData.model.sheets[i],o=this.getRangeIndices(v.paneTopLeftCell),this._isFrozen(r.frozenRows)&&this.XLScroll._vScroller(i).scroll(this._getRowOffsetTop(r,o[0])-r._frozenHeight),this._isFrozen(r.frozenColumns)&&this.XLScroll._hScroller(i).scroll(this._getColOffsetLeft(r,o[1])-r._frozenWidth));r._isLoaded=!0;!this._isSheetInsert&&(this._pageClickArgs||this._gotoPageArgs)&&this._pageLoadComplete(i);this.getSheet(f)._isOpened=!0;this.model.showRibbon&&(n("#"+this._id+"_Ribbon")[0].style.overflow==="hidden"&&(n("#"+this._id+"_Ribbon")[0].style.overflow="",this.model.showRibbon&&this.XLRibbon._refreshBackstageHeight()),r._isRibCollapsed=!this.XLRibbon._ribbonState);this._isAutoWHMode&&i==f&&this._autoSSWidthHeight(i)},_initSheetModel:function(n){var u,f,e,o,t=this.getSheet(n),i=this.getFrozenRows(n),r=this.getFrozenColumns(n);t.showHeadings===!1&&this.showHeadings(t.showHeadings);t._isImported&&(o=this._impData.model.sheets[n],u=this.getRangeIndices(o.topLeftCell||"A1"));f=t._isImported?u[0]:this._isFrozen(i)&&t._bottomRow.idx<=i?i-1:0;e=t._isImported?u[1]:this._isFrozen(r)&&t._rightCol.idx<=r?r-1:0;this.model.scrollSettings.allowScrolling&&(f>0&&this.XLScroll._vScroller(n).scroll(this._getRowOffsetTop(t,f)),e>0&&this.XLScroll._hScroller(n).scroll(this._getColOffsetLeft(t,e)));this.model.allowFreezing&&(this._isFrozen(i)&&this._isFrozen(r)?this.XLFreeze.freezePanes(i,r):this._isFrozen(i)?this.XLFreeze._freeze(i):this._isFrozen(r)&&this.XLFreeze._freeze(null,r))},_initTmplColumns:function(n){for(var f,r,u,e,t=this.getSheet(n),o=t.columns.length,i=0;i<o;i++)t.columns[i].field&&t.columns[i].text&&(this._copyColumns[t.columns[i].field]=t.columns[i]);if(o&&(t.columns=[]),!this._sheetCopy.isSheetCopy&&!t.rangeSettings.length&&t.dataSource&&t._jsonData&&t.fieldAsColumnHeader&&(u=t._jsonData[0],e=this.getRangeIndices(t.startCell),i=e[1]+1,u)){for(r in u)u.hasOwnProperty(r)&&(f=u[r],typeof u[r]=="object"&&(r=this._iterateComplxObj(u[r],r).prop),t.columns[i-1]={field:this._generateHeaderText(i),text:r,type:f!=null?f.getDay?"date":typeof f:null},i++);t.colCount=t._templateColCount=t.columns.length;t._isTemplate=!0}},_refreshCellBinding:function(n){var t,r,f,l=this.getSheet(n),e=l.mergeCells,o=l.hideRows,u,i,s,h,c;if(e.length)for(u=0,f=e.length;u<f;u++)for(i=this.getRangeIndices(e[u]),s=i[2]-i[0]+1,h=i[3]-i[1]+1,c,t=0;t<s;t++)for(r=0;r<h;r++)c=t==0&&r==0?{merge:{isMerge:!0,mRange:e[u],isCenterAlign:!1,mSpan:{colSpan:h,rowSpan:s}}}:{isMHide:!0,mergeIdx:{rowIndex:i[0],colIndex:i[1]}},this.XLEdit._updateDataContainer({rowIndex:i[0]+t,colIndex:i[1]+r},{dataObj:c,sheetIdx:n,skipCell:!0});if(o.length&&this.model.scrollSettings.allowVirtualScrolling)for(t=0,f=o.length;t<f;t++)this._cellBindHiddenRows(o[t],o,n)},_cellBindHiddenRows:function(n,t,i){var r,u,e=this.getSheet(i),f=this.XLEdit;e.hideRowsCollection.push(n);this.XLScroll._getRowHeights(i,t.sort()[0]);u=n===0?{rowIndex:n,colIndex:0}:{rowIndex:n-1,colIndex:0};r={rowIndex:n,colIndex:0};f._updateDataContainer(u,{dataObj:{hRow:!0},sheetIdx:i,skipCell:!0});f._updateDataContainer(r,{dataObj:{isRHide:!0},sheetIdx:i,skipCell:!0})},_updateHiddenRows:function(n){var i,r,h,a,c,u=this.getSheet(n),s=u.hideRows,e,v=u.cFormatRule,f,o=u.hideColumns,l=u.border;if(s.length&&!this.model.scrollSettings.allowVirtualScrolling)for(i=0,r=s.length;i<r;i++)e=s[i],h=this.getRows(n),a=h[1],c=h[0],this.addClass(a[e],"e-r-hide"),this.addClass(c[e],"e-r-hide"),e>0&&this.addClass(c.eq(e-1).find("td")[0],"e-hrow"),this._cellBindHiddenRows(e,s,n);if(o.length&&!this.model.scrollSettings.allowVirtualScrolling){for(i=0,r=o.length;i<r;i++)u.hideColsCollection[o[i]]||this._updateHiddenColumns({rowIndex:0,colIndex:o[i]},n);this.XLScroll._getColWidths(n,o.sort()[0])}if(!t.isNullOrUndefined(v)&&v.length)for(i=0,r=u.cFormatRule.length;i<r;i++)f=u.cFormatRule[i],this.XLCFormat._cFormat(f.action,f.inputs[0],f.inputs[1],f.color,f.bgColor,f.range,n);if(l.length&&!this.model.scrollSettings.allowVirtualScrolling)for(i=0,r=l.length;i<r;i++)this._updateCellBorder(l[i],n)},_updateHiddenColumns:function(n,t){var i=n.colIndex,u=this.getSheet(t),f={isCHide:!0},r=this._getJSSheetHeader(t),e=r.find("th"),o=r.find("col"),s=this._getContent(t).find("col");u.hideColsCollection[i]=u.columnWidth;u.columnsWidthCollection[i]=0;i===0&&(f.hCol=!0);this._writeRule(i,t);this.addClass(e[i],"e-hide");this.addClass(o[i],"e-hide");this.addClass(s[i],"e-hide");r.find("th:eq("+(i-1)+")").hasClass("e-hide")||this.addClass(r.find("th:eq("+(i-1)+")")[0],"e-hcol");this.XLEdit._updateDataContainer({rowIndex:0,colIndex:i},{dataObj:f,sheetIdx:t,skipCell:!0});i>0&&this.isUndefined(this.XLEdit.getPropertyValue(0,i-1,"isCHide"))&&this.XLEdit._updateDataContainer({rowIndex:0,colIndex:i-1},{dataObj:{hCol:!0},sheetIdx:t,skipCell:!0})},_renderContent:function(n){var r=[],i=t.buildTag("div.e-spreadsheetheader"),o=t.buildTag("div.e-headercontent"),h=t.buildTag("div.e-spreadsheetcolumnheader e-icon e-ss-selectall  e-ss-cursor","",{},{}),u=t.buildTag("div.e-spreadsheetcontentcontainer","",{"-webkit-tap-highlight-color":"rgba(0,0,0,0)"}),s=t.buildTag("div#"+this._id+"_content.e-content e-ss-cursor"),f=t.buildTag("div.e-spreadsheetrowheader","",{float:"left",width:"30px"},{}),e=t.buildTag("div.e-rowheadercontent");return this._isAutoWHMode&&(s.addClass("e-rmvbtmbdr"),o.addClass("e-rmvrghtbdr"),e.addClass("e-rmvbtmbdr")),this._setJSSheetHeader(i,n),i.append(h),i.append(o),r.push(i),i=t.buildTag("div.e-spreadsheetcontent"),this._setJSSheetContent(i,n),this._setContent(u,n),this._setJSSheetRowHeader(f,n),this._setJSSheetRowHeaderContent(e,n),f.append(e),u.append(s),i.append(f),i.append(u),r.push(i),r},refreshContent:function(n){this._refreshContent(n)},_refreshContent:function(n,t){n=n||this.getActiveSheetIndex();var r,u,o=this.model.scrollSettings,s=o.allowVirtualScrolling,i=this._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content"),f,e;this._initDataRange(n);this._refreshRowColCnt(n);f=this._renderHeaderColumns(n);this._getJSSheetHeader(n).find(".e-headercontent").html(f);this._refreshTemplates(n);e=this._renderHdrRows(n);this._getJSSheetRowHeaderContent(n).html(e);i.find(".e-table")[0]&&i.find(".e-table").eq(0).remove();i.prepend(this._renderContTable(n));this._initViewPortCont(n);this._isAutoWHMode?this._isInitLoad||this._autoSSWidthHeight(n):t||this.XLScroll._refreshScroller(n,"refresh","all");s||t||(this.XLScroll._getFirstRow(n),this.XLScroll._getFirstColumn(n));r=this._getContTBody(n).find("tr");u=this._getRowHdrTBody(n).find("tr");this.setRows([u,r],n)},_autoSSWidthHeight:function(t,i){var r={},u=n("#"+this._id+"_Ribbon").data("ejRibbon");t=t||this._getSheetIndex();this._responsiveWidth=this._dlgWidth=r.width=this.getSheet(t).showHeadings?this._getContTBody(t).width()+this._getJSSheetRowHeader(t).width():this._getContTBody(t).width();this.model.showRibbon&&r.width<=480?(r.width=480,this._getContent(t).find(".e-content").removeClass("e-rmvrghtbdr")):i||this._getContent(t).find(".e-content").addClass("e-rmvrghtbdr");i||this._setSheetWidthHeight(t,r,null,"refresh");this.model.showRibbon&&(r.width<=480&&this._alignFormulaBar(r.width),this.XLRibbon._refreshBackstageHeight(),u.setModel({width:r.width}));this._responsiveHeight=this._dlgHeight=r.height=this.element.height()},_initDataRange:function(n){var c,r,i,u,f,e,o,s=0,t=this.getSheet(n),h=this.getDataSettings(n);if(h)for(c=h.length;s<c;)i=h[s],i._jsonData&&(i.batchChanges=t.batchChanges,i.fields=this.getObjectKeys(i._jsonData[0]),r=i.startCell?this._toIntrnlRange(i.startCell,n):[0,0,0,0],r[2]=r[0]+(!i.fieldAsColumnHeader&&i.showHeader?i.count:i.count-1),r[3]=r[1]+this.getObjectLength(i._jsonData[0])-1,i.range=r,e=r[2],o=r[3],(this._isAutoWHMode||t.usedRange.rowIndex<e)&&(t.usedRange.rowIndex=e),(this._isAutoWHMode||t.usedRange.colIndex<o)&&(t.usedRange.colIndex=o),u=e+1,f=o+1,this._isPublic||((this._isAutoWHMode||t.rowCount<u)&&(t.rowCount=u),(this._isAutoWHMode||t.colCount<=f)&&(t.colCount=f),this.model.isGridMode&&(t.usedRange.rowIndex<u&&(t.rowCount=u),t.usedRange.colIndex<f&&(t.colCount=f))),t._hasDataSrc=!0),s++},_renderStyleTag:function(n){var i,t;return i=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],t=document.createElement("style"),t.type="text/css",n=="custom"?(t.setAttribute("id",this._id+"_sscustomformat"),i.appendChild(t)):n!=="showhide"||document.getElementById(this._id+"_sshide")||(t.setAttribute("id",this._id+"_sshide"),i.appendChild(t)),t},_renderHeaderColumns:function(i){for(var c,u,l,s,a=document.createElement("thead"),f=this.getSheet(i),e=this.getObjectKeys(this._copyColumns),v=e.length,h=this._copyColumns,o,r=0;r<v;r++)o=this._generateColCount(e[r])-1,f.columns[o]?f.columns[o].text=h[e[r]].text:f.colCount>o&&h[e[r]].field&&(f.columns[o]=h[e[r]]);return s=this._renderHeaderCol(i,0,f.colCount),u=t.buildTag("table.e-table")[0],this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?n(u).width(this._getEntireColWidth(i)):this.addClass(u,"e-ss-hdrspacing"),l=s[1],c=s[0],a.appendChild(c),u.appendChild(l),u.appendChild(a),u},_renderHeaderCol:function(n,i,r){var e,h,c,b,l,a,v,y,o,s=0,p=[],f=i,u=this.getSheet(n),w=document.createElement("tr"),k=document.createElement("colgroup");for(w.className="e-columnheader",this.isImport||this.model.isImport||(u._colWidthCollection.length=0,u._ofColWidthColl.length=0),this.model.scrollSettings.allowScrolling||this.model.scrollSettings.scrollMode!="infinite"||(u.columnsWidthCollection=[]),u._colWidthCollection.push(s),u._ofColWidthColl.push(s);f<r;)e="e-headercell",l="col",o=u.columnsWidthCollection[f],this.isUndefined(o)&&(o=u.columnsWidthCollection[f]=u.columnWidth),f!=r-1&&(s=u._colWidthCollection[u._colWidthCollection.length-1]+o,u._colWidthCollection.push(s),u._ofColWidthColl.push(s)),this.model.allowSelection&&this._inColumn(u.selectedRange,f)&&(e+=" e-colhighlight",u._isColSelected&&(e+=" e-colselected")),o<1?(l+=".e-hide",e+=" e-hide"):u._hiddenFreezeCols.indexOf(f)>-1&&(l+=".e-fcol-hide",e+=" e-fcol-hide"),(this.isImport||this.model.isImport||u._isLoaded)&&this.XLEdit.getPropertyValue(0,f,"hCol")&&(e+=" e-hcol"),h=document.createElement("th"),h.className=e,a=v=this._generateHeaderText(f+1),u.fieldAsColumnHeader&&u.columns[f]&&(a=u.columns[f].text),c=document.createElement("div"),c.className="e-headercelldiv",c.innerHTML=a,h.appendChild(c),b=t.buildTag(l,"",{width:o},{}),w.appendChild(h),k.appendChild(b[0]),this._sheetCopy.isSheetCopy||u.columns[f]||(u.columns[f]={field:v,text:v,type:y!=null?y.getDay?"date":typeof y:null}),f++;return p.push(w),p.push(k),p},_getWidth:function(n,t,i){for(var r=0,u=this.getSheet(i);n<=t;n++)r+=u.columnsWidthCollection[n];return r},_getEntireColWidth:function(n){var t=this.getSheet(n),i=this._getIdxWithOffset(null,this._getLastColIdx(t)).xOffset;return i+t.columnsWidthCollection[t.columnsWidthCollection.length-1]},_getLastColIdx:function(n){for(var t=n.colCount-1;t>-1;){if(!(t in n.hideColsCollection)&&n._hiddenFreezeCols.indexOf(t)===-1)break;t--}return t},_getIdxWithOffset:function(n,i,r,u,f){u=u||[];var s,h,p,e,c,l,a,y={},v=t.Spreadsheet.HideTypes,o=this.getSheet(f);if(e=c=l=a=0,!t.isNullOrUndefined(n)){if(r)for(p=o.rowsHeightCollection.length;e<p;){if(s=h=!1,u.indexOf(v.Default)===-1&&o.hideRowsCollection.indexOf(e)>-1&&(s=!0),u.indexOf(v.Freeze)===-1&&o._hiddenFreezeRows.indexOf(e)>-1&&(h=!0),!s&&!h){if(l+=o.rowsHeightCollection[e],l>n){c=e;break}a=l}e++}else{while(e<n)s=h=!1,u.indexOf(v.Default)===-1&&o.hideRowsCollection.indexOf(e)>-1&&(s=!0),u.indexOf(v.Freeze)===-1&&o._hiddenFreezeRows.indexOf(e)>-1&&(h=!0),s||h||(a+=o.rowsHeightCollection[e]),e++;c=n}y.rowIdx=c;y.yOffset=a}if(!t.isNullOrUndefined(i)){if(r)for(e=c=l=a=0,p=o.columnsWidthCollection.length;e<p;){if(s=h=!1,u.indexOf(v.Default)===-1&&e in o.hideColsCollection&&(s=!0),u.indexOf(v.Freeze)===-1&&o._hiddenFreezeCols.indexOf(e)>-1&&(h=!0),!s&&!h){if(l+=o.columnsWidthCollection[e],l>i){c=e;break}a=l}e++}else{while(e<i)s=h=!1,u.indexOf(v.Default)===-1&&e in o.hideColsCollection&&(s=!0),u.indexOf(v.Freeze)===-1&&o._hiddenFreezeCols.indexOf(e)>-1&&(h=!0),s||h||(a+=o.columnsWidthCollection[e]),e++;c=i}y.colIdx=c;y.xOffset=a}return y},_getEntireRowHeight:function(n){var t=this.getSheet(n);return t._rowHeightCollection[t._rowHeightCollection.length-1]+t.rowsHeightCollection[t.rowsHeightCollection.length-1]},_renderHdrRows:function(n){var r,a,v,b,k,p,d,u,o,s,c,g,h,l,f,e,y,i=this.getSheet(n),w=this.model.scrollSettings.allowVirtualScrolling;if(h=t.buildTag("table.e-table","<colgroup><col style='width: 30px;'><\/colgroup>",{}),this.addClass(h[0],"e-ss-rowhdrspacing"),!this._sheetCopy.isSheetCopy){for(u=f=0,y=i.rows,r=0,p=i.rowCount,i._rowHeightCollection=[],i._rowIdxColl=[],i._rowHeightCollection.push(u);r<p;)l=i.rowsHeightCollection[r],l||(l=i.rowsHeightCollection[r]=i.rowHeight),w&&(i.hideRowsCollection.indexOf(r)!==-1||i._hiddenFreezeRows.indexOf(r)!==-1)?l=0:i._rowIdxColl.push(r),r!=p-1&&i._rowHeightCollection.push(i._rowHeightCollection[i._rowHeightCollection.length-1]+l),r++;if(y){for(e=-1,k=y.length,g=this._browserDetails.name==="mozilla"?2:1,a=0;a<k;a++){for(o=y[a],b=o.cells.length,this.isUndefined(o.index)||(f=o.index),u=o.height||i.rowHeight,i.rowHeight<u&&(i.rowsHeightCollection[f]=u,e===-1&&(e=f)),v=0;v<b;v++)s=o.cells[v],s.style&&s.style["font-size"]&&(c=document.getElementById(this._id+"_emptySpan"),d=this.XLFormat._createFormatClass(s.style),this.addClass(c,d),c.textContent=s.value,u=c.offsetHeight+g,u>i.rowsHeightCollection[f]&&(i.rowsHeightCollection[f]=u,e===-1&&(e=f)),this._refreshGlobalSpan(c)),this.isUndefined(s.value)||(i._hasDataSrc=!0);f++}e!==-1&&this.XLScroll._getRowHeights(n,e,!0)}}return w?h.append("<tbody class='e-ss-virtualtop'><\/tbody><tbody><\/tbody><tbody class='e-ss-virtualbottom'><\/tbody>"):h.append("<tbody>"+this._renderRowHdr(i._rowIdxColl,n)+"<\/tbody>"),this._setRowHdrTBody(h.find("tbody").eq(w?1:0),n),h},_renderRowHdr:function(i,r){for(var u,f,o=0,h=[],e=this.getSheet(r),s=i?i.length:e.rowCount;o<s;)u=i?i[o]:o,(t.isNullOrUndefined(this.XLEdit.getPropertyValue(u,0,"isFilterHide",r))||t.isNullOrUndefined(this.XLEdit.getPropertyValue(u,0,"isRHide",r)))&&(f={height:e.rowsHeightCollection[u]<this.model.rowHeight?this.model.rowHeight:e.rowsHeightCollection[u],rowidx:u},f.className=this.XLEdit.getPropertyValue(u,0,"hRow",r)?"e-rowheader e-hrow ":"e-rowheader",this.XLEdit.getPropertyValue(u,0,"isFilterHighlight",r)&&(f.className+=" e-filterhiglight"),f.wrap=this.XLEdit.getPropertyValue(u,0,"wrapRow",r)?" e-sswraprow":"",this.model.allowSelection&&this._inRow(e.selectedRange,u)&&(f.className+=" e-rowhighlight",e._isRowSelected&&(f.className+=" e-rowselected")),h.push(f)),o++;return n.render[this._id+"JSONRowHdrTemplate"+r](h)},_refreshDataSrc:function(n,t){var r,e,f,o,c,u,i,w,l,s,a,h,v,y=0,b=this.getSheet(t),p=this.getDataSettings(t);if(h=v=!1,!b.rangeSettings.length&&b.dataSource&&(v=!0),p)for(w=p.length;y<w;){if(i=p[y],i.range)if(s=i.range,h=v?!i.fieldAsColumnHeader&&i.showHeader:i.showHeader,i.headerStyles&&this.getObjectLength(i.headerStyles)&&this.model.allowCellFormatting&&(l=this.XLFormat._createFormatClass(i.headerStyles)),n)for(r=n[0],e=n[2],o=n[3];r<=e;){if(this._inRow(s,r))for(f=n[1];f<=o;)this._inColumn(s,f)&&(a=i.fields[f-i.range[1]],h&&r===s[0]?(u=i._jsonData[r-i.range[0]],u&&this._refreshCell(r,f,t,i,u,a,!1,l)):(u=i._jsonData[r-(i.range[0]+(h?1:0))],u&&this._refreshCell(r,f,t,i,u,a,!0))),f++;r++}else{if(r=0,e=s[0],o=s[1],f=s[2],h){u=i._jsonData[r];for(c in u)this._refreshCell(e,o,t,i,u,c,!1,l),o++;e++}while(e<=f){u=i._jsonData[r];o=s[1];for(c in u)this._refreshCell(e,o,t,i,u,c,!0),o++;r++;e++}}y++}},_refreshCell:function(n,t,i,r,u,f,e,o){var s,c=this._iterateComplxObj(u[f],f),h=this.getSheet(i),l=this._dataContainer;s=this.XLEdit._parseValue(e?c.value:c.prop,{rowIndex:n,colIndex:t});s.sheetIdx=i;r.rangeName&&(s.rangeName=r.rangeName);e?r.primaryKey===f&&(s.isReadOnly=!0):(o&&(s.format=o,s.formats=r.headerStyles),!h.rangeSettings.length&&h.dataSource&&(s.isReadOnly=!0));h.showHeader&&n&&this.isFormula(u[f])&&(this.XLEdit._refreshCalcEngine(n,t,!0,u[f],i),s.value2=l.sharedData[l.sheets[i][n][t].value2]);h.showHeader&&n&&u[f]&&u[f][0]=="'"&&(s.value2=s.value2.substr(1));this.XLEdit._updateDataContainer({rowIndex:n,colIndex:t},{dataObj:s,sheetIdx:i,skipCell:!0})},_iterateComplxObj:function(n,t,i){var r,u,e,o=i||t,f={prop:o,value:n};if(this._isObject(n)){e=".";for(r in n){if(u=n[r],this.isUndefined(u))return f;if(n.hasOwnProperty(r)&&this._isObject(u)&&!this._isDateTime(u))o+=e+r,f=this._iterateComplxObj(u,r,o);else return f.prop+=e+r,f.value=u,f}}return f},_refreshCellData:function(t,i){var f,l,w,r,a,e,u,k,v,y,h,d,o=0,s=this.getSheet(i),p=s.rows,c=s.hideColumns,b=s.border;if(p){for(f=0,h=p.length;f<h;f++){if(e=0,w=p[f],a=p[f].cells,w.index&&(o=w.index),(!t||this._inRow(t,o))&&a)for(l=0,d=a.length;l<d;l++)r=a[l],r.index&&(e=r.index),(!t||this._inColumn(t,e))&&(u=this.isUndefined(r.value)?{}:r.format&&r.format.type=="text"?{type:"text",value:r.value,value2:r.value}:this.XLEdit._parseValue(r.value,{rowIndex:o,colIndex:e}),u.value=this.isUndefined(u.value)?this.isUndefined(this.XLEdit.getPropertyValue(o,e))?"":this.XLEdit.getPropertyValue(o,e):u.value,v=this.isFormula(u.value),v&&this.XLEdit._refreshCalcEngine(o,e,!0,u.value,i),r.format&&(y=this.XLFormat._getFormatObj(r.format),u.type=r.format.type,u.formatStr=y.format.formatStr,u.decimalPlaces=y.format.decimalPlaces,u.thousandSeparator=y.format.thousandSeparator?!0:!1),u.value2=this.XLFormat._format(v?this.XLEdit.getPropertyValue(o,e,"value2"):u.value,{formatStr:u.formatStr,type:u.type,thousandSeparator:u.thousandSeparator,decimalPlaces:u.decimalPlaces,cellObj:u}),r.hyperlink&&(u.hyperlink=r.hyperlink.webAddr?r.hyperlink.webAddr.indexOf("http")===-1?{webAddr:"http://"+r.hyperlink.webAddr}:{webAddr:r.hyperlink.webAddr}:{cellAddr:r.hyperlink.cellAddr+"_"+r.hyperlink.sheetIndex||i},u.formats={color:this._hlColor}),r.comment&&(k=(this.model.userName.length?this.model.userName:this._getLocStr("UserName"))+":\n",u.comment={value:k+(r.comment.value||""),isVisible:r.comment.isVisible||!1}),r.isLocked&&(u.isLocked=!0,this.protectSheet(!0)),r.style&&(r.style.fontWeight&&(r.style["font-weight"]=r.style.fontWeight,delete r.style.fontWeight),r.style.backgroundColor&&(r.style["background-color"]=r.style.backgroundColor,delete r.style.backgroundColor),u.formats=n.extend(u.formats,r.style)),u.formats&&(u.format=this.XLFormat._createFormatClass(u.formats)),this.XLEdit._updateDataContainer({rowIndex:o,colIndex:e},{dataObj:u,sheetIdx:i,skipCell:!0}),this.XLEdit._refreshCellAlignment({cellIdx:{rowIndex:o,colIndex:e},value:u.value,type:u.type}),v||this.XLEdit._refreshCalcEngine(o,e,!1,null,i)),e++;o++}this.model.scrollSettings.allowVirtualScrolling&&(s._virtualTBodyHgt=s._rowHeightCollection[s._rowHeightCollection.length-1]+s.rowsHeightCollection[s.rowsHeightCollection.length-1])}if(c.length&&this.model.scrollSettings.allowVirtualScrolling){for(f=0,h=c.length;f<h;f++)s.hideColsCollection[c[f]]||this._updateHiddenColumns({rowIndex:0,colIndex:c[f]},i);this.XLScroll._getColWidths(i,c.sort()[0])}if(b.length&&this.model.scrollSettings.allowVirtualScrolling)for(f=0,h=b.length;f<h;f++)this._updateCellBorder(b[f],i)},_updateCellBorder:function(n,t){var r,f,e,i,u,o=this.getRangeIndices(n.range);if(e={top:{top:"1px solid"},right:{right:"1px solid"},bottom:{bottom:"1px solid"},left:{left:"1px solid"},outside:{top:"1px solid",right:"1px solid",bottom:"1px solid",left:"1px solid"},allborder:{top:"1px solid",right:"1px solid",bottom:"1px solid",left:"1px solid"},thickbox:{top:"2px solid",right:"2px solid",bottom:"2px solid",left:"2px solid"},thickbottom:{bottom:"2px solid"},topandbottom:{top:"1px solid",bottom:"1px solid"},topandthickbottom:{top:"1px solid",bottom:"2px solid"}},i=e[n.type],u=this.getObjectKeys(i),u.length)for(r=0,f=u.length;r<f;r++)i[u[r]]=i[u[r]].concat(" "+n.color);i.skipCell=!0;i.sheetIdx=t;n.type==="allborder"?this.XLFormat._applyAllBorderCss(i,o):this.XLFormat._applyBorderCss(i,o)},_renderContTable:function(i){var r;return this._sheetCopy.isSheetCopy?r=n(this._sheetCopy.sheetContent):(r=t.buildTag("table.e-table",this._sheets[i]._contentColGroup.outerHTML),this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?n(r).width(this._getEntireColWidth(i)):this.addClass(r,"e-ss-rowhdrspacing"),this.model.scrollSettings.allowVirtualScrolling?r.append("<tbody class='e-ss-virtualtop'><\/tbody><tbody><\/tbody><tbody class='e-ss-virtualbottom'><\/tbody>"):r.append("<tbody><\/tbody>")),this._setContTBody(r.find("tbody").eq(this.model.scrollSettings.allowVirtualScrolling?1:0),i),r},_initViewPortCont:function(n){var i,t=this.getSheet(n);this.model.scrollSettings.allowVirtualScrolling?this._refreshViewport(this._initLoad?0:this._isFrozen(this.getFrozenRows())?t._contScrollTop:t._scrollTop,n):(i=this.getRangeData({property:["value","value2","comment","hyperlink","format","border","type","isFilterHide","isRHide","isFHide","isFilterHeader","isFilterVisible","filterState","isMHide","merge","hRow","isLocked","wrap","isOverflow","align","picture","cFormatRule","isOfBrdr","formatStr"],sheetIdx:n,rowIdxs:t._rowIdxColl,withRowIdx:!0}),this._getContTBody(n).html(this._renderData(i,n)),this.model.allowComments&&this.XLComment._updateCmntArrowPos(null,n),this.model.allowCellType&&this.XLCellType._rangeCellTypes(t.cellTypes,n),this.model.allowSparkline&&this.XLSparkline._refreshContentWithSparkline(n));t._isVPRendered=!0},_processCellTypes:function(n,t){for(var r=[],i=0,u=n.length;i<u;i++)n[i].cellType.type==="DatePicker"?r.push({range:this._getAlphaRange(t,n[i].rowIndex,n[i].colIndex,n[i].rowIndex,n[i].colIndex),settings:{type:n[i].cellType.type,value:n[i].value}}):r.push({range:this._getAlphaRange(t,n[i].rowIndex,n[i].colIndex,n[i].rowIndex,n[i].colIndex),settings:{type:n[i].cellType.type,isChecked:n[i].cellType.isChecked}});this.XLCellType._rangeCellTypes(r,t);this._celltypes=[]},_initDependencies:function(){var t=this.model;this._renderAlertdlg();this._renderAlertDlgContent(n("#"+this._id+"_alertdlg"),"Alert","");this._initEditForm();t.allowClipboard&&this.XLClipboard._initCopyPaste();t.allowEditing&&(this.XLEdit._processEditing(),this.getMainPanel().append(this.XLEdit._editElem),this.XLEdit._editElem.hide());this._renderDDownList();this.clearUndoRedo();t.showRibbon&&this.XLRibbon._disableButtons(["clearfilter"],"ejButton");t.allowDataValidation&&this.XLValidate._addDVMethod();t.enableContextMenu&&this.XLCMenu._initCMenuFooter();t.allowFiltering&&this.XLFilter._renderExcelFilter();t.allowFreezing&&this.XLFreeze._initFreeze()},_initComplete:function(){this._reqCnt===this._resCnt&&(this._isRefresh||this._trigger("loadComplete",{}),this.isDirty=!1,this.clearUndoRedo(),this.hideWaitingPopUp(),this.XLRibbon.updateRibbonIcons())},_showDialog:function(t,i){var e,r,u="e-dialog",f=this.model;switch(t){case this._id+"_Ribbon_Home_Styles_ConditionalFormatting":r=n("#"+this._id+"_CFDialog");!r.length&&f.allowConditionalFormats&&(r=this.XLRibbon._initCFDialog());r.ejDialog("open");break;case this._id+"_chartname":r=n("#"+this._id+"_chartnamedlg");r.length||this.XLRibbon._renderChartNameDlg();break;case this._id+"_Ribbon_ChartDesign_Type_ChangeChartType":r=n("#"+this._id+"_charttypedlg");r.length||(r=this.XLRibbon._renderChartTypeDialog());break;case this._id+"_ImportPasswordDialog":r=n("#"+this._id+"_ImportPasswordDialog");r.length||(r=this._importPasswordDlg());r.ejDialog("open");break;case this._id+"_Ribbon_Insert_Links_Hyperlink":this.model.isReadOnly||(f.allowHyperlink&&!this._hasClass(document.getElementById(this._id+"_HLDialog"),u)&&this.XLRibbon._initHLDialog(),this._hlDlgOpen());break;case this._id+"_Ribbon_SparklineDesign_Sparkline_EditData":this.XLSparkline._initSparklineDialog();this.XLSparkline._renderSparklineDialog();this.XLSparkline._renderSparklineDesignDlg();break;case this._id+"_Ribbon_Others_Cells_InsertCellOptions":f.allowInsert&&(this._hasClass(document.getElementById(this._id+"_insertdeletedlg"),u)||this._renderInsertDeleteDialog(),this._refreshInsDelDialog("Insert"));break;case this._id+"_Ribbon_Insert_Sparkline_Column":case this._id+"_Ribbon_Insert_Sparkline_Line":case this._id+"_Ribbon_Insert_Sparkline_Pie":case this._id+"_Ribbon_Insert_Sparkline_Area":case this._id+"_Ribbon_Insert_Sparkline_Winloss":f.allowSparkline&&!this._hasClass(document.getElementById(this._id+"_SparklineDialog"),u)&&(this.XLSparkline._initSparklineDialog(),this.XLSparkline._renderSparklineDialog());break;case this._id+"_Ribbon_Others_Cells_DeleteCellOptions":f.allowDelete&&(this._hasClass(document.getElementById(this._id+"_insertdeletedlg"),u)||this._renderInsertDeleteDialog("delete"),this._refreshInsDelDialog("Delete"));break;case this._id+"_FormatCells":f.allowCellFormatting&&!this._hasClass(document.getElementById(this._id+"_formatdlg"),u)&&this.XLCellFrmtDlg._renderCellFrmtDlg();this.XLCellFrmtDlg._initFormatCellDlg();break;case this._id+"_MoveorCopy":this._hasClass(document.getElementById(this._id+"_moveCopyDlg",u))||this._initMoveCopyDlg();this._renderMoveCopyDlg();break;case this._id+"_UnhideSheet":this._hasClass(document.getElementById(this._id+"_UnhideDlg",u))||this._initUnhideDlg();this._renderUnhideDlg();break;case this._id+"_Ribbon_Data_DataTools_DataValidation":case this._id+"_Ribbon_Data_DataTools_DataValidationOptions":this.model.allowDataValidation&&!this._hasClass(document.getElementById(this._id+"_ValDialog"),u)&&(e=this.XLRibbon._initValDialog(),this.XLRibbon._renderValDialog(e));break;case this._id+"_Filter":document.getElementById(this._id+i+"_excelDlg")||document.getElementById(this._id+"_filter_custom_"+i)||this.XLFilter._renderFilterDialogs(i);break;case this._id+"_Ribbon_Review_Changes_ProtectWorkbook":this._hasClass(document.getElementById(this._id+"_PasswordDialog"),u)||this._passwordDlg();break;case this._id+"_Ribbon_Insert_Tables_Table":f.allowFormatAsTable&&!this._hasClass(document.getElementById(this._id+"_fatnamedlg"),u)&&this.XLRibbon._renderFATNameDlg();break;case this._id+"_Ribbon_Insert_Tables_PivotTable":f.enablePivotTable&&!this._hasClass(document.getElementById(this._id+"_PvtDialog"),u)&&(this.XLRibbon._initPvtDialog(),this.XLRibbon._renderPvtDialog());break;case this._id+"_Ribbon_Others_Editing_FindSelect":f.allowSearching&&!this._hasClass(document.getElementById(this._id+"_FRDialog"),u)&&(this.XLRibbon._initFRDialog(),this.XLRibbon._renderFRDialog(),this.model.isReadOnly||(e=this.XLRibbon._initGoToDialog(),this.XLRibbon._renderGoToDialog(e)));this.model.isReadOnly?n("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option",{disabledItemIndex:[1,2]}):n("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option",{enabledItemIndex:[1,2]});break;case this._id+"_Ribbon_ChartDesign_Data_SelectData":f.allowCharts&&!this._hasClass(document.getElementById(this._id+"_chartrangedlg",u))&&this.XLChart._renderChartRangeDialog();break;case this._id+"_Ribbon_Others_NameManager":document.getElementById(this._id+"_nmdlg")?n("#"+this._id+"_nmgrid").ejGrid("option",{dataSource:this.model.nameManager}):this.XLRibbon._renderNameManagerDlg();break;case this._id+"_Ribbon_Design_Tools_ResizeTable":document.getElementById(this._id+"_fatresizetabledlg")||this.XLRibbon._renderFATResizeTableDlg();break;case"exportxl":case"exportcsv":case"exportpdf":document.getElementById(this._id+"_ExportFileNameDialog")||this.XLExport._exportFileNameDlg();break;case this._id+"_CustomCellDialog":document.getElementById(this._id+"_CustomCellDialog")?this.XLFormat._styleDlgOpen():(this.XLFormat._customStyleDlg(),this.XLFormat._styleDlgOpen())}},_generateHeaderText:function(n){var t="Z";return n/26>1?this._generateHeaderText(n%26==0?n/26-1:Math.floor(n/26))+String.fromCharCode(n%26==0?t.charCodeAt(t):64+n%26):String.fromCharCode(64+n)},_generateColCount:function(n){var i=0,t;for(n=n.split("").reverse().join(""),t=n.length-1;t>=0;t--)i+=(n[t].charCodeAt(n[t])-64)*Math.pow(26,t);return i},_getSheetIndex:function(n){return n||this.getActiveSheetIndex()},_getSheetIdxFromSheetValue:function(n){for(var t=1,i=this.model.sheets,r=i.length-1;t<=r;){if(i[t].sheetInfo.value.toLowerCase()===n.toLowerCase())return t;t++}return-1},getAlphaRange:function(n,t,i,r){return this.isUndefined(i)&&this.isUndefined(r)&&(i=n,r=t),this._getAlphaRange(null,n,t,i,r)},_getAlphaRange:function(n,t,i,r,u){return t=t+1,i=i+1,r=r+1,u=u+1,t===r&&i===u?this._generateHeaderText(i)+t:this._generateHeaderText(i)+t+":"+this._generateHeaderText(u)+r},_getProperAlphaRange:function(n,t,i,r,u){var f=this._getAlphaRange(n,t,i,r,u);return f.indexOf(":")===-1?f+":"+f:f},_getDollarAlphaRange:function(n,t){var u=this.getActiveSheetIndex(),i=this.getSheet(u).sheetInfo.text,r=i.match(/\s/g)?"'"+i+"'":i;return t&&!this.isRange(n)?r+"!$"+this._generateHeaderText(n[1]+1)+"$"+(n[0]+1):r+"!$"+this._generateHeaderText(n[1]+1)+"$"+(n[0]+1)+":$"+this._generateHeaderText(n[3]+1)+"$"+(n[2]+1)},_toIntrnlRange:function(n,t){return n?this._isString(n)&&(n=this.getRangeIndices(n)):n=this.getSheet(t).selectedRange,n},_getMaxRowColCnt:function(n,t,i){var u,f,r,e=0,o=0,s=i?i:1,h=i?i+1:n.length;for(n=n?n:this.model.sheets;s<h;)r=n[s],t&&r.usedRange?(u=r.usedRange.rowIndex,f=r.usedRange.colIndex):(u=r.rowCount,f=r.colCount),e<u&&(e=u),o<f&&(o=f),s++;return{rowCount:e,colCount:o}},_generateEJMenu:function(n,i,r){return{menuType:n==="normal"?t.MenuType.NormalMenu:t.MenuType.ContextMenu,orientation:i==="vertical"?t.Orientation.Vertical:t.orientation.Horizontal,cssClass:r}},_generateEJDD:function(t,i,r,u,f,e){return{dataSource:t,fields:i,selectedItemIndex:r,width:u,cssClass:"e-"+this._id+"-ddl",change:n.proxy(this.XLRibbon._frTypeChange,this,e)}},_heightWidthCalculation:function(t,i){var r,u=this.getActivationPanel(),f=u.is(":visible");this._isDisplayHeader?(r=n("#"+this._id+"_Ribbon").height(),this._isDisplayHeader=!1):r=this.XLRibbon._ribbonState?this.element.find(".e-ribbon").height()-1:this.element.find(".e-ribbon .e-header").height();this._refreshSheetWithScreen(t);this._updateResponsiveSettings();this.model.isGridMode&&!this.model.scrollSettings.allowScrolling&&(this._responsiveHeight=this._minHeight);this._initViewPort(t);this._setSheetWidthHeight(t,{width:this._responsiveWidth,height:this._responsiveHeight},r,"refresh",i.action);f&&u.height(this.getMainPanel().height()-1);this.refreshContent(t)},_refreshSheetWithScreen:function(t){n("#"+this._id+"GroupPanel")[0].style.height="0px";n("#"+this._id+"MainPanel")[0].style.height="0px";this.model.allowFormulaBar&&(this.element.find(".e-formulabar")[0].style.width="0px");this.getSheetElement(t).find(".e-spreadsheetcontentcontainer")[0].style.height="0px";this.getSheetElement(t).find(".e-spreadsheetrowheader")[0].style.height="0px"},_refreshWidthHeight:function(i,r,u,f){var h,y=1,p=0,e=this._getContent(i),c,l,w=this.model.pageSettings.pagerHeight+1,b,o=this.getSheet(i),a=this._getJSSheetRowHeader(i),v,k,d=-1,g=n("#"+this._id+"_Ribbon").ejRibbon("instance"),s,nt;return b=this.model.showRibbon?g.model.selectedItemIndex<1?1:g.model.selectedItemIndex:0,this.XLRibbon._ribbonState&&(d=n("#"+this._id+"_Ribbon").find(".e-content:eq("+b+")").height()),v=this._phoneMode?n("#"+this._id+"_Ribbon").height():n("#"+this._id+"_Ribbon").find(".e-header").height()+d+2,l=this.model.allowFormulaBar&&this.element.find("#"+this._id+"_formulabar").is(":visible")?this._formulaHeight:0,u=v&&this.model.showRibbon&&n("#"+this._id+"_Ribbon").is(":visible")?v:0,o.showHeadings&&(y=22,p=a.width()),this._isAutoWHMode&&o.showHeadings||(c=r.height-(u+l+1),this.getGroupPanel().height(c-1),this.getMainPanel().height(c-1),this.model.showPager&&(f==="initial"||this.element.find(".e-spreadsheetfooter").is(":visible"))||(w=1),k=this._browserDetails.name==="chrome"?1:2,r.height=r.height-(y+w+l+u+k),this.element.find(".e-spreadsheet-list")[0].style.height=""),this.model._isActPanelVisible?r.width=r.width-(this.model.activationPanelWidth+2):t.isNullOrUndefined(r.isActPanel)||r.isActPanel||(r.width=r.width+this.model.activationPanelWidth+2),s=this.model.scrollSettings,this.getMainPanel().width(!this.model._isActPanelVisible&&s.isResponsive?"100%":r.width),e.find("#hscrollBar").length>0&&(e.find("#hscrollBar").remove(),a.removeClass("e-scrollrowcss"),this._getJSSheetRowHeaderContent(i).height(r.height),this._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").height(r.height-1)),e.find("#vscrollBar").length>0&&(nt=o._scrollTop,e.find("#vscrollBar").data("ejScrollBar").scroll(0),o._scrollTop=nt,e.find("#vscrollBar").remove(),this._getJSSheetHeader(i).removeClass("e-scrollcss"),this._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").width(s.isResponsive?r.width-2:r.width)),this._isAutoWHMode&&o.showHeadings||(e.height(r.height),a.height(r.height)),this._getJSSheetContent(i).width(s.isResponsive?"100%":r.width),h=this.getFooter(),h&&h.width(s.isResponsive?"100%":r.width),this._alignFormulaBar(this._responsiveWidth),this._initViewPort(i),this.model.allowFreezing&&this.XLFreeze._refreshFreeze(),r.width=r.width-p,r.height=r.height-0,r},_setSheetWidthHeight:function(t,i,r,u,f){var e=this.getSheet(t),o=this._getContent(t),s,h,a,v,c,l=this._getJSSheetRowHeader(t),y,p=this.model.scrollSettings.isResponsive,w=e.showHeadings?l.width():0;p?(f!="initial"&&u!="resize"&&(this._refreshSheetWithScreen(t),this._updateResponsiveSettings(),i={width:this._responsiveWidth,height:this._responsiveHeight}),this._resizeColl[t-1]=this._isResized,u!=="resize"||this.model.allowResizing&&(!this.model.allowResizing||this.XLResize._resizeStart)||f=="toggleBtn"||(this.model.activationPanelWidth=Math.floor(i.width/3)),y=this._refreshWidthHeight(t,n.extend(!0,{},i),r,f,u),this._updateResponsiveSettings(),u!=="resize"||this.model.allowResizing&&(!this.model.allowResizing||this.XLResize._resizeStart)||f=="toggleBtn"||(this.model.activationPanelWidth=Math.floor(i.width/3)),i=y):(this._isAutoWHMode||(i.width=i.width-2),i=this._refreshWidthHeight(t,n.extend(!0,{},i),r,f,u));this.getMainPanel().width(!this.model._isActPanelVisible&&p?"100%":i.width+w);this.model.scrollSettings.allowScrolling&&(this.model._isActPanelVisible&&(i.width+=2),this._renderScroller(t,n.extend(!0,{},i),f),h=o.find("#vscrollBar"),s=o.find("#hscrollBar"),h.length>0&&this._getJSSheetHeader(t).addClass("e-scrollcss"),s.length>0&&(c=o.height(),l.height(c-18),this._getJSSheetRowHeaderContent(t).height(c-(s[0].style.display==="none"?0:18)),l.addClass("e-scrollrowcss")),f!="initial"&&(v=h.data("ejScrollBar"),a=s.data("ejScrollBar"),v.scroll(e._scrollTop),a.scroll(e._scrollLeft)));e.showHeadings||o.find(".e-content")[this.model.allowFormulaBar?"addClass":"removeClass"]("e-viewbrdr");this._isAutoWHMode||(this._dlgWidth=this._phoneMode||this._tabMode||this._responsiveWidth<350?this._responsiveWidth-2:this._responsiveWidth/2,this._dlgHeight=this._phoneMode||this._tabMode||this._responsiveHeight<350?this._responsiveHeight-2:this._responsiveHeight/1.5)},setWidthToColumns:function(n,i){var s,e=i||this.getActiveSheetIndex(),u=this.getSheet(e),y,c,l=0,f,r,a=!1,v,o,p,h;if(!this.isUndefined(u)&&!this.model.isGridMode){for(typeof n[0]=="object"&&(a=!0),u._isLoaded&&(y=this._getContent(e).find("col"),c=this._getJSSheetHeader(e).find("col")),o=0,p=n.length;o<p;o++){if(f=a?n[o].width:n[o],r=a?n[o].colIndex:o,v=this.XLEdit._getPropWithCellIdx([0,r,u.rowCount-1,r],"isOfBrdr",e),f===0&&(f=64),f<u.columnsWidthCollection[r]&&this.XLEdit.getPropertyValue(0,r,"wrapCol")){l+=f;continue}for(u._isLoaded&&(t.isNullOrUndefined(c[r])||(c[r].style.width=f+"px",y[r].style.width=f+"px")),l+=f,this.XLShape&&this.XLShape._refreshShapePosOnResize(r,f,!0,e),this.XLEdit.getPropertyValue(0,r,"isCHide",e)?(u.hideColsCollection[r]=f,u.columnsWidthCollection[r]=0):u.columnsWidthCollection[r]=f,this.XLScroll._getColWidths(e,r),h=0;h<v.length;h++)s=v[h],this._textClip(s.rowIdx,s.colIdx,"delete","",!0),this._textClip(s.rowIdx,s.colIdx,"add","",!0)}u.staticWidth=l;u._isLoaded&&this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(e,"refresh","horizontal");u._isFreezed&&(this.XLFreeze._refreshFreezeRowDiv(),this.XLFreeze._refreshFreezeColDiv());(!u._isImported||u._isLoaded)&&(this.model.allowSelection&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this._isAutoWHMode&&this._autoSSWidthHeight())}},setHeightToRows:function(n){this._setHeightToRows(n)},_setHeightToRows:function(n,t){var o,i,r,u=this.getActiveSheetIndex(),e=this.getSheet(u),s=!1,h=this.getRows(u),l=h[1],a=h[0],f,c;for(typeof n[0]=="object"&&(s=!0),f=0,c=n.length;f<c;f++)(i=s?n[f].height:n[f],r=s?n[f].rowIndex:f,i===0&&(i=22),i<e.rowsHeightCollection[r]&&this.XLEdit.getPropertyValue(r,0,"wrapRow"))||(this._isRowViewable(u,r)&&r!=-1&&(o=this._getRowIdx(r,u),l[o].style.height=i+"px",a[o].style.height=i+"px"),this.XLShape&&this.XLShape._refreshShapePosOnResize(r,i,!1,u),e.rowsHeightCollection[r]=i);t||(this.model.scrollSettings.allowScrolling&&(this.XLScroll._getRowHeights(u,1),this.XLScroll._getFirstRow(u)),this.model.allowSelection&&(!e._isImported||e._isLoaded)&&(this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()))},_refreshRowColCnt:function(n){var f,c,u,e,r,o,s,h=this.model.scrollSettings,l=h.scrollMode===t.Spreadsheet.scrollMode.Infinite,i=this.getSheet(n);r=o=s=0;i.rowCount>this._maxRowCnt&&(i.rowCount=this._maxRowCnt);f=this._getMaxHgt(n,this.isImport||this.model.isImport);l&&(o=i._vPortHgt+this._bufferCnt*i.rowHeight,f<o&&(u=o-f,r=Math.ceil(u/i.rowHeight),i.rowCount+=r,f+=r*i.rowHeight));h.allowVirtualScrolling&&(e=i.rowCount-(i.hideRowsCollection.length+(this.isImport||this.model.isImport?i._hiddenFreezeRows.length:0)),h.allowScrolling&&l&&(u=e%i._virtualBlockRowCnt,u&&(r=i._virtualBlockRowCnt-u,i.rowCount+=r,e+=r,f+=r*i.rowHeight)),i._virtualBlockCnt=Math.ceil(e/i._virtualBlockRowCnt),i._virtualTBodyHgt=f);i.colCount>this._maxColCnt?i.colCount=this._maxColCnt:h.allowScrolling&&l&&(s=i._vPortWth+this._bufferCnt*i.columnWidth,c=this.isImport||this.model.isImport?this._getMaxWth(n):i.colCount*i.columnWidth,c<s&&(u=s-c,i.colCount+=Math.ceil(u/i.columnWidth)))},_getMaxHgt:function(n,t,i){var e,u,f,r=this.getSheet(n);if(u=f=0,t)for(e=r.rowsHeightCollection.length;u<e;)i&&r.hideRowsCollection.indexOf(u)!==-1||(f+=r.rowsHeightCollection[u]),u++;else f=(r.rowCount-(r.hideRowsCollection.length+r._hiddenFreezeRows.length))*r.rowHeight;return f},_getMaxWth:function(n){for(var i=0,t=0,r=this.getSheet(n),u=r.columnsWidthCollection.length;t<u;)i+=r.columnsWidthCollection[t],t++;return i},_refreshTemplates:function(i,r,u,f){for(var h,o,e,s=t.isNullOrUndefined(u)?0:u,l={},a=this.getSheet(i),v=t.buildTag("colgroup"),y=this.model.scrollSettings.allowVirtualScrolling,p=t.isNullOrUndefined(f)?a.colCount:f,c=y?"<tr style = 'height: {{:height}}px' data-idx = '{{:rowidx}}'>":"<tr style = 'height: {{:height}}px'>";s<p;)h=a.columnsWidthCollection[s],e=this._generateHeaderText(s+1),o=document.createElement("col"),h<1?o.setAttribute("class","e-hide"):a._hiddenFreezeCols.indexOf(s)>-1&&o.setAttribute("class","e-fcol-hide"),o.style.width=h+"px",c+="<td class='{{:"+e+"_className}}' rowspan= {{:"+e+"_rspan}} colspan= {{:"+e+"_cspan}} style={{:"+e+"_Colors}} >{{:"+e+"_value}}<\/td>",v.append(o),s++;l[this._id+"JSONTemplate"+i]=c+"<\/tr>";r||(l[this._id+"JSONRowHdrTemplate"+i]=y?"<tr class='{{:wrap}}' style='height:{{:height}}px' data-idx='{{:rowidx}}'><td class='{{:className}}'>{{:rowidx + 1}}<\/td><\/tr>":"<tr class='{{:wrap}}' style='height:{{:height}}px'><td class='{{:className}}'>{{:rowidx + 1}}<\/td><\/tr>");n.templates(l);this._sheets[i]._contentColGroup=v.get(0)},_renderData:function(i,r,u,f,e,o,s){var nt,a,p,c,h,d,vt,yt,pt,wt,et,l,v,b,st,rt,w,ht,ii,k,ri,ut,ct,tt=" ",bt=[],y=this.getSheet(r),g,ui=t.preferredCulture(this.model.locale),lt,kt,dt=e?f:y.colCount,ot=y._goToCollection,fi=ot.selected.length,gt,ni,ti="e-redft e-yellowft e-greenft e-redf e-redt",ei=this._dataContainer.sheets[r],oi,at,si,ft,it;if(ct=0,ut=o?o:0,i)for(vt=i.data,et=vt.length/dt;ut<et;){for(c={},nt=ct,l=i.rowIdx[ut],v=e?u:0;nt<ct+dt;){if(h=vt[nt],h){if(b=this._generateHeaderText(v+1),a=b+"_className",p=b+"_value",c[a]="e-rowcell e-wrapword ",y.showGridlines||(c[a]+=" e-hborder"),!e&&!ot.multiple&&fi&&ot.selected.indexOf(l+":"+v)>-1&&(c[a]+=" e-selected"),v in y.hideColsCollection&&(c[a]+=" e-soverflow"),y._hiddenFreezeCols.indexOf(v)>-1&&(c[a]+=" e-fcol-hide"),!e&&this.model.allowSelection&&this.inRange(y.selectedRange,l,v)&&(ht=!0,ot.multiple&&(ht=!1,fi&&ot.selected.indexOf(l+":"+v)>-1&&(ht=!0)),ht&&(c[a]+=" e-selected"),y._activeCell.rowIndex===l&&y._activeCell.colIndex===v&&(c[a]+=" e-activecell")),this.model.allowCellType&&this.model.allowAutoCellType&&((h.type=="shortdate"||h.type=="longdate")&&this._celltypes.push({rowIndex:l,colIndex:v,sheetIndex:r,cellType:{type:"DatePicker"},value:h.value2}),h.value2&&["true","yes","false","no"].indexOf(h.value2.toLowerCase())>-1&&this._celltypes.push({rowIndex:l,colIndex:v,sheetIndex:r,cellType:{type:"CheckBox",isChecked:["yes","true"].indexOf(h.value2.toLowerCase())>-1?!0:!1}})),(this.isImport||this.model.isImport)&&h.type=="date"&&this.XLFormat.addCustomFormatSpecifier(null,h.formatStr&&h.formatStr.replace(/^\{0\:|\}$/g,""),h.type),(h.type=="shortdate"||h.type=="longdate"||h.type=="date"||h.type=="time")&&!this._isDateTime(h.value)&&Date.parse(h.value)&&(h.value=new Date(h.value)),h.format&&(c[a]+=tt+h.format,this._isClassHasProperty(h.format,"text-align","right")&&!h.merge&&(c[a]+=" e-rightalign")),h.border&&(c[a]+=tt+h.border),h.align){if(h.align===t.Spreadsheet.Align.Center)c[a]+=tt+this._cAlign;else if(h.align===t.Spreadsheet.Align.Right&&(typeof h.value=="object"&&this._isDateTime(h.value)||this.isNumber(this.isFormula(h.value)?ei[l][v].calcValue?ei[l][v].calcValue:h.value2:h.value)))c[a]+=tt+this._rAlign;else if(h.align==t.Spreadsheet.Align.Right&&h.type=="time"&&h.formatStr)for(g in ui.calendar.patterns)if(ui.calendar.patterns[g]==h.formatStr.replace(/^\{0\:|\}$/g,"")){c[a]+=tt+this._rAlign;break}}else this._isGeneral(h.type)&&(typeof h.value=="object"&&this._isDateTime(h.value)||this.isNumber(h.value)||this.isFormula(h.value))&&this.isNumber(h.value2)&&(c[a]+=tt+this._rAlign);if(h.isMHide&&(c[a]+=" e-mc-hide",c[a]+=" e-moverflow"),h.isOfBrdr&&(c[a]+=" e-ofbrdr"),h.isOverflow===!1&&(c[a]+=" e-overflow"),yt=b+"_rspan",pt=b+"_cspan",h.merge?(wt=h.merge.mSpan,c[yt]=wt.rowSpan,c[pt]=wt.colSpan,c[a]+=" e-moverflow",h.merge.isCenterAlign&&(c[a]+=tt+this._cAlign)):(c[yt]=1,c[pt]=1),d=t.isNullOrUndefined(h.value2)?"":h.value2,h.wrap&&(k=this._dataContainer.sheets[r],this.isUndefined(k[l])&&(k[l]={}),this.isUndefined(k[l][0])&&(k[l][0]={}),k[l][v].wrap||(k[l][v].wrap=!0),this.model.allowWrap?(c[a]+=" e-sswraptext",k[l][0].wrapRow=!0,this.isUndefined(k[0])&&(k[0]={}),this.isUndefined(k[0][v])?k[0][v]={wrapCol:!0,wrapWidth:y.columnsWidthCollection[v]}:(k[0][v].wrapCol=!0,k[0][v].wrapWidth=y.columnsWidthCollection[v]),y._wrapColl[l]&&(!y._wrapColl[l]||y._wrapColl[l][v])||(this._wrapTextLenCln([{rowIndex:l,colIndex:v}],y,"renderdata",r),this._wrapCollection(l,v,this._getWrapCellHeight(r,l,v).rowHt,r))):k[l][v].wrap=!1),h.hyperlink)lt="",kt=this.XLEdit.getPropertyValue(l,v,"formats"),t.isNullOrUndefined(kt)||(lt=kt["text-decoration"]),e?(c[a]+=" e-hyperlinks",c[p]=d):c[p]=h.hyperlink.webAddr?lt?String.format("<a href={0} class='e-hyperlinks' target='_blank'>{1}<\/a>",h.hyperlink.webAddr,d):String.format("<a href={0} class='e-hyperlinks' style = 'text-decoration: none' target='_blank'>{1}<\/a>",h.hyperlink.webAddr,d):lt?String.format("<a class='e-hyperlinks'>{0}<\/a>",d):String.format("<a class='e-hyperlinks' style = 'text-decoration: none'>{0}<\/a>",d);else if(h.merge){for(ni=0,gt=this.getRangeIndices(h.merge.mRange),g=gt[0];g<=gt[2];g++)i.rowIdx.indexOf(g)<0&&ni++;c[p]="<div id ="+this._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(Math.floor(y._rowHeightCollection[l+(h.merge.mSpan.rowSpan-ni)]-y._rowHeightCollection[l])-1)+"px'"+(this._isClassHasProperty(h.format,"text-align","right")?">":" class = 'e-rightalign'>")+d+"<\/div>"}else c[p]=d;if(h.cFormatRule)for(oi=h.cFormatRule.length,at="",g=0;g<oi;g++)if(w=h.cFormatRule[g].split("_"),w[8]==="true"&&(w[4].length>0&&ti.indexOf(w[4])>-1?c[a]+=" e-"+w[4]:(c[b+"_Colors"]=this.isUndefined(c[b+"_Colors"])?"":c[b+"_Colors"],ti.indexOf(w[4])<0&&(c[b+"_Colors"]+="color:"+w[4]+";"),ti.indexOf(w[5])<0&&(c[b+"_Colors"]+="background-color:"+w[5]+";"))),!t.isNullOrUndefined(h.value)&&(this.isNumber(h.value)||Object.prototype.toString.call(h.value)=="[object Date]")){if(w[0]==="colorscale"&&(c[b+"_Colors"]=this.isUndefined(c[b+"_Colors"])?"":c[b+"_Colors"],w[9]&&w[9].indexOf("#")>-1&&(c[b+"_Colors"]+="background-color:"+w[9]+";")),w[0]==="iconset"){if(c[p].indexOf("e-cf-databar")>-1)continue;si=["e-ss-greenarrow","e-ss-yellowarrow","e-ss-redarrow","e-ss-downarrow","e-ss-midarrow","e-ss-uparrow","e-ss-uptriangle","e-ss-midtriangle","e-ss-downtriangle","e-ss-greencircle","e-ss-yellowcircle","e-ss-redcircle","e-ss-rimgreencircle","e-ss-rimyellowcircle","e-ss-rimredcircle","e-ss-yellowtri","e-ss-redsquare","e-ss-greencircleindi","e-ss-yellowcircleindi","e-ss-redcircleindi","e-ss-tick","e-ss-exclam","e-ss-cross","e-ss-greenflag","e-ss-yellowflag","e-ss-redflag","e-ss-fullstar","e-ss-drystar","e-ss-halfstar"];st="e-icon e-iconsetspan "+w[9];c[p]=si.indexOf(at)>-1?c[p].split(at).join(w[9]):String.format('<span class="{0}"><\/span>',st)+c[p];c[a]+=" e-iconset";at=w[9]}if(w[0]==="databar"){if(c[p].indexOf("e-iconsetspan")>-1)continue;this.XLCFormat._dataBarStyle.forEach(function(n){if(n.idx==l+""+v){ft=n.rightStyle||"";it=n.leftStyle||"";ft&&(ft="width:"+ft.width+";height:"+ft.height+";background-color:"+ft.backgroundColor+";left:"+ft.left);it&&(it="width:"+it.width+";height:"+it.height+";background-color:"+it.backgroundColor+";left:"+it.left+";right:"+it.right+";");return}});c[p]=String.format('<div id="{0}_databar" class="e-cf-databar" style="height: 19px;"><span id="{0}_leftspan" style="{1}" class="e-databar"><\/span><span id="{0}_rightspan" class="e-databar" style="{2}"><\/span><span id="{0}_dataspan" class="e-databar-value" style="font-size:11pt;">{3}<\/span><\/div>',this._id,it,ft,c[p])}}h.comment&&(c[a]+=" e-commentcell",ri=h.comment.isVisible?"visible":"none",c[p]=String.format("<span class='e-comment'><span class='e-celltoparrow'><\/span><textarea class='e-comment-txtarea' style='display:{0};z-index:9;text-align:left'>{1}<\/textarea><\/span>",ri,h.comment.value)+c[p]);h.rule&&h.rule.isApply&&!this.XLValidate._checkValidation(c[p],h.rule.customVal.split("_"),!0,r)&&(c[a]+=" e-hlcell");!h.isFilterHeader||this.isUndefined(y._filterColl[l])||this.isUndefined(y._filterColl[l][v])||(st="e-icon e-spanfilter e-filterspan "+y._filterColl[l][v].status,ii=h.isFilterVisible?"display: visible":"display: none",c[p]=String.format('<span class="{0}" style="{1}"><\/span>',st,ii)+c[p],c[a]=c[a].replace("e-ralign",""),tt=tt.replace("e-ralign",""));h.altTxt&&!h.wrap&&(c[a]+=" e-alt-unwrap");typeof d=="string"&&d.indexOf("<")>-1&&(c[p]=c[p].replace(/</g,"&lt;"))}v++;nt++}c.rowidx=l;rt=y.rowsHeightCollection[l];c.height=this.isUndefined(rt)||rt<this.model.rowHeight?this.model.rowHeight:rt;bt.push(c);ct=nt;ut++}else for(et=this.model.scrollSettings.allowVirtualScrolling?y._virtualBlockRowCnt:s?s:y.rowCount,et=ut+et;ut<et;){for(c={},nt=0;nt<dt;)b=this._generateHeaderText(nt+1),a=b+"_className",c[a]="e-rowcell e-wrapword ",nt++;rt=y.rowsHeightCollection[ut];c.height=this.isUndefined(rt)||rt<this.model.rowHeight?this.model.rowHeight:rt;c.rowidx=l;bt.push(c);ut++}return n.render[this._id+"JSONTemplate"+r](bt)},_padStart:function(){String.prototype.padStart||(String.prototype.padStart=function(n,t){return n=n>>0,t=String(typeof t!="undefined"?t:" "),this.length>n?String(this):(n=n-this.length,n>t.length&&(t+=t.repeat(n/t.length)),t.slice(0,n)+String(this))})},_isGeneral:function(n){return this.isUndefined(n)&&(n=t.Spreadsheet.CellType.General),n===t.Spreadsheet.CellType.General},_isFormulaError:function(n){for(var r=["#NA","#DIV/0!","#NAME?","circular reference","TypeError","wrong"],t=0,i=r.length;t<i;t++)if(typeof n=="string"&&n.indexOf(r[t])>-1)return!0;return!1},_refreshViewport:function(n,t){var e,f,o,s,a,c,l,r,h,u,i=this.getSheet(t),v=this.XLShape._getCellIndexFromOffset(n,0);i._virtualContBlockIdx=this._getVirtualBlockIdx(t,v.rowIndex).idx;o=(i._virtualContBlockIdx-1)*i._virtualBlockRowCnt;a=this._getRowIdx(o,t,!0);s=i._virtualContBlockIdx*i._virtualBlockRowCnt;l=this._getRowIdx(s,t,!0);i._virtualContTBodyOffset.top=this._getRowOffsetTop(i,a);i._virtualBlockCnt===1?(i._virtualTopTBodyOffset.top=i._virtualTopTBodyOffset.bottom=i._virtualTopTBodyHgt=0,i._virtualBottomTBodyOffset.top=i._virtualBottomTBodyOffset.bottom=i._virtualBottomTBodyHgt=0,i._virtualContTBodyOffset.bottom=this._getRowOffsetBottom(i._rowIdxColl[i._rowIdxColl.length-1],t),f=i._rowIdxColl,i._isVirtualTopReached=i._isVirtualEndReached=!0):i._virtualContBlockIdx===1?(i._virtualTopTBodyOffset.top=i._virtualTopTBodyOffset.bottom=i._virtualTopTBodyHgt=0,i._virtualContTBodyOffset.bottom=i._virtualBottomTBodyOffset.top=this._getRowOffsetTop(i,l),r=this._getRowIdx(s+(i._virtualBlockRowCnt-1),t,!0),i._virtualBottomTBodyOffset.bottom=this._getRowOffsetBottom(r,t),i._virtualBottomTBodyHgt=i._virtualTBodyHgt-(i._virtualContTBodyOffset.bottom-i._virtualContTBodyOffset.top+(i._virtualBottomTBodyOffset.bottom-i._virtualBottomTBodyOffset.top)),f=i._rowIdxColl.slice(0,i._rowIdxColl.indexOf(r)+1),i._isVirtualTopReached=!0,i._isVirtualEndReached=!1):i._virtualContBlockIdx===i._virtualBlockCnt?(h=(i._virtualContBlockIdx-2)*i._virtualBlockRowCnt,i._virtualBottomTBodyOffset.top=i._virtualBottomTBodyOffset.bottom=i._virtualBottomTBodyHgt=0,c=this._getRowIdx(o+(i._virtualBlockRowCnt-1),t,!0),i._virtualContTBodyOffset.bottom=this._getRowOffsetBottom(c,t),u=this._getRowIdx(h,t,!0),i._virtualTopTBodyOffset.top=this._getRowOffsetTop(i,u),i._virtualTopTBodyOffset.bottom=i._virtualContTBodyOffset.top,i._virtualTopTBodyHgt=i._virtualTBodyHgt-(i._virtualContTBodyOffset.bottom-i._virtualContTBodyOffset.top+(i._virtualTopTBodyOffset.bottom-i._virtualTopTBodyOffset.top)),f=i._rowIdxColl.slice(i._rowIdxColl.indexOf(u),i._rowIdxColl.indexOf(c)+1),i._isVirtualEndReached=!0,i._isVirtualTopReached=!1):(h=o-i._virtualBlockRowCnt,u=this._getRowIdx(h,t,!0),i._virtualTopTBodyOffset.top=this._getRowOffsetTop(i,u),i._virtualTopTBodyOffset.bottom=i._virtualContTBodyOffset.top,i._virtualContTBodyOffset.bottom=i._virtualBottomTBodyOffset.top=this._getRowOffsetTop(i,l),r=this._getRowIdx(s+(i._virtualBlockRowCnt-1),t,!0),i._virtualBottomTBodyOffset.bottom=this._getRowOffsetBottom(r,t),i._virtualTopTBodyHgt=n-(i._virtualTopTBodyOffset.bottom-i._virtualTopTBodyOffset.top+(n-i._virtualContTBodyOffset.top)),i._virtualBottomTBodyHgt=i._virtualTBodyHgt-i._virtualBottomTBodyOffset.bottom,f=i._rowIdxColl.slice(i._rowIdxColl.indexOf(u),i._rowIdxColl.indexOf(r)+1),i._isVirtualTopReached=i._isVirtualEndReached=!1);e=this.getRangeData({property:["value","value2","comment","hyperlink","rule","cFormatRule","format","border","type","isFilterHide","isRHide","isFHide","isFilterHeader","isFilterVisible","filterState","isMHide","merge","hRow","isLocked","wrap","isOverflow","align","isOfBrdr","altTxt","formatStr","cellType"],sheetIdx:t,rowIdxs:f,withRowIdx:!0});this._getRowHdrTBody(t).html(this._renderRowHdr(e.rowIdx,t));this._getContTBody(t).html(this._renderData(e,t));this._refreshRows(t);this._refreshTBodiesHgt(t);this.model.allowComments&&this.XLComment._updateCmntArrowPos(null,t);i._virtualRowIdx=e.rowIdx;this.model.allowCellType&&this.XLCellType._rangeCellTypes(i.cellTypes,t);this.model.allowSparkline&&this.XLSparkline._refreshContentWithSparkline(t);this._refreshViewVar(n,i._isLoaded?null:0,t)},refreshOverflow:function(n,t){this._refreshOverflow(n,t)},_refreshOverflow:function(n,t){t=this._getSheetIndex(t);var f,o,i,r,u,h=this.getSheet(t),e,c=this._dataContainer.sheets[t],s;if(n=n||[0,0,h.usedRange.rowIndex,h.usedRange.colIndex],u=this.XLEdit._getPropWithCellIdx(n,"value2"),!(u.length<1))for(s=u[u.length-1].colIdx,f=u.length-1;f>-1;f--)i=u[f].rowIdx,r=u[f].colIdx,this.model.allowOverflow?(s===r&&(e=this.getObjectKeys(c[i])),this._textClip(i,r,"add","",!0,e)):(this._isRowViewable(t,i)&&(o=this.getCell(i,r)[0]),this._removeClass(o,"e-overflow"),s===r&&(e=this.getObjectKeys(c[i])),this._textClip(i,r,"delete","",!0,e),this.addClass(o,"e-overflow"),this.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{isOverflow:!1},skipCell:!0}))},_getVirtualBlockIdx:function(n,t,i){for(var r=1,u={},f=this.getSheet(n),e=this._getRowIdx(t,n,!1,!0);r<=f._virtualBlockCnt;){if(e<r*f._virtualBlockRowCnt){u.idx=r;break}r++}if(i)for(r=0;++r;)if(t<r*f._virtualBlockRowCnt){u.orgIdx=r;break}return u},_getBlockInfo:function(n,t,i){var r,f=this.getSheet(t),u=[0,0,0,f.colCount-1];return r=this._getVirtualBlockIdx(t,n,i),u[0]=f._virtualBlockRowCnt*(r.idx-1),u[2]=f._virtualBlockRowCnt*r.idx-1,r.range=u,i&&(u=[0,0,0,f.colCount-1],u[0]=f._virtualBlockRowCnt*(r.orgIdx-1),u[2]=f._virtualBlockRowCnt*r.orgIdx-1,r.orgRange=u),r},_getRowOffsetTop:function(n,t){return n._rowHeightCollection[t]},_getRowOffsetBottom:function(n,t){return this.getSheet(t)._rowHeightCollection[n]+this.getSheet(t).rowsHeightCollection[n]},_getColOffsetLeft:function(n,t){return n._colWidthCollection[t]},getCellIdx:function(n){return this._getCellIdx(n)},_getCellIdx:function(n){return{rowIndex:this.model.scrollSettings.allowVirtualScrolling?Number(n.parentNode.attributes.getNamedItem("data-idx").value):n.parentNode.rowIndex,colIndex:n.cellIndex}},_getMidCell:function(){var t,i={},n=this.getSheet();return t=n._bottomRow.idx-n._topRow.idx+1,i.rowIdx=n._topRow.idx+Math.floor(t/2),t=n._rightCol.idx-n._leftCol.idx+1,i.colIdx=n._leftCol.idx+Math.floor(t/2),i},_removeRange:function(i,r){for(var k,g,e=this.getActiveSheetIndex(),nt=this._getRowHdrTBody(e),v=n(this._getRowHdrTBody(e)[0].rows),tt=this._getContTBody(e),f=n(this._getContTBody(e)[0].rows),y=this._dataContainer.sheets[e],u=this.getSheet(e),o,l,c,a,h,d,p,s=0,w,b=0,it=this.getObjectLength(u._mergeSpan);b<it;b++){for(c=parseInt(this.getObjectKeys(u._mergeSpan)[b]),k=0,g=this.getObjectLength(u._mergeSpan[c]);k<g;k++)a=parseInt(this.getObjectKeys(u._mergeSpan[c])[0]),l=this._getRowIdx(c),l>=0&&(f[l].children[a].rowSpan=1,f[l].children[a].colSpan=1,f[l].children[a].classList.add("e-mc-hide")),delete u._mergeSpan[c][a];delete u._mergeSpan[c]}for(v.splice(i,r),f.splice(i,r),this.setRows([v,f],e);s<u.usedRange.colIndex;)o=parseInt(f[0].getAttribute("data-idx")),t.isNullOrUndefined(y[o])||(h=y[o][s],t.isNullOrUndefined(h)||h.mergeIdx&&(d=this.getAlphaRange(h.mergeIdx.rowIndex,h.mergeIdx.colIndex,h.mergeIdx.rowIndex,h.mergeIdx.colIndex),p=this.getRangeIndices(d),w=y[p[0]][p[1]].merge.mSpan,f[0].children[s].rowSpan=w.rowSpan-o,f[0].children[s].colSpan=w.colSpan,f[0].children[s].classList.remove("e-mc-hide"),t.isNullOrUndefined(u._mergeSpan[o])?(u._mergeSpan[o]={},u._mergeSpan[o][s]={isMerged:!0}):this.getObjectKeys(u._mergeSpan)==o&&(u._mergeSpan[o][s]={isMerged:!0}))),s++;tt.html(f);nt.html(v);this._getContent(e).find(".e-ss-sparkline").remove();this._getContent(e).find(".e-ddl").remove()},_refreshTBodiesHgt:function(n){n=this._getSheetIndex(n);var i="px",t=this.getSheet(n),r=this._getJSSheetRowHeaderContent(n)[0].getElementsByTagName("tbody"),u=this._getContent(n)[0].getElementsByTagName("tbody");r[0].style.height=u[0].style.height=(t._virtualTopTBodyHgt<this.model.rowHeight?0:t._virtualTopTBodyHgt)+i;r[2].style.height=u[2].style.height=t._virtualBottomTBodyHgt+i},_renderTD:function(n,t,i){return String.format("<td class='{0}' style='{1}' >{2}<\/td>",n,t,i)},_renderDIV:function(n,t,i){return i?String.format("<div class='{0}' title='{2}'>{1}<\/div>",n,t,i):String.format("<div class='{0}'>{1}<\/div>",n,t)},_renderTR:function(n,t,i){var r=this._sheetCopy.isSheetCopy?this.getSheet(i).rowsHeightCollection[t]:this.model.rowHeight,u="height:"+r+"px";return String.format("<tr style='{0}'>"+n+"<\/tr>",u)},_renderFooter:function(){var h=this.model.scrollSettings,f,i=t.buildTag("div.e-spreadsheetfooter","",{display:this.model.showPager?"block":"none"}),e=t.buildTag("table.e-table","",{},{}),o=n(document.createElement("tbody")),s=n(document.createElement("tr")),u=n(document.createElement("td")),r;this._updateResponsiveSettings();f=h.isResponsive?"100%":this._responsiveWidth-2;u.append(this._renderSpreadSheetPager());u.find(".e-pagercontainer").append(t.buildTag("div#"+this._id+"_AddSheet.e-new e-icon e-default","",null,{title:this._getLocStr("NewSheet")}));s.append(u);o.append(s);e.append(o);i.append(e);this.getMainPanel().append(i);this._refreshSpreadSheetPager();r=this.element.find(".e-spreadsheetfooter").outerHeight();this.model.showPager&&r>this.model.pageSettings.pagerHeight&&(this.model.pageSettings.pagerHeight=r<37?r:36);i.width(f).height(this.model.showPager?this.model.pageSettings.pagerHeight:0);this.element.find(".e-spreadsheetfooter .e-table").height(this.model.pageSettings.pagerHeight);this.setFooter(i)},gotoPage:function(t,r){var e,k,d,tt;if((r||!(t>this.model.sheetCount))&&!(t<1)){var s,u,h=this.model.sheets,c=this.getPager(),l={},a=this._impData,v,y,f={reqType:"gotoSheet",gotoIndex:t,newSheet:r,prevSheetIdx:this.getActiveSheetIndex()},p,w,g=!this.XLRibbon._ribbonState,b={reqType:f.reqType,gotoSheetIndex:f.gotoIndex,isNewSheet:f.newSheet,prevSheetIndex:f.prevSheetIdx,action:"gotopage",type:"actionBegin"},nt=c.ejPager("option","totalRecordsCount"),o=this.model.sheetCount;(r&&(r=t<=o?!1:!0),r&&(o+1<t&&(t=o+1),nt==o&&c.ejPager("option",{totalRecordsCount:nt+1})),this._gotoPageArgs=n.extend(!0,{},f),this._isSheetNavigate=r?!1:!0,this._trigActionBegin(b))||(this.setActiveSheetIndex(t),this.model.pageSettings.currentPage=t,u=h[t],r||this.isNumber(u.colCount)||(u.colCount=this.model.columnCount),r||u._isRequested||!u._isImported?(this.element.find(".e-sheet").hide(),r&&(this._addSheet(t),u=h[t],u._isNavigated=!0),this._isSheetInsert&&(s=c.ejPager("option","currentPage"),this._swapSheetDtCntr(h.length-1,s),this.model.activeSheetIndex=t=s,this._isSheetInsert=!1),this._isNew||(this.model.scrollSettings.allowVirtualScrolling||this.model.scrollSettings.allowSheetOnDemand)&&!u._isLoaded||this._isallowScrollingSetModel||this._isallowVirtualScrollingSetModel?(this.showWaitingPopUp(),this._initSheet(t),this.model.isGridMode&&!r&&this._gridModeScroll(),this._isallowScrollingSetModel=!1,this._isallowVirtualScrollingSetModel=!1):(this.element.find("#"+this._id+"_"+u.sheetInfo.value).show(),this.model.scrollSettings.allowVirtualScrolling||r||u._isOpened||this._refreshOverflow(i,t),this.model.isGridMode&&!r&&this._gridModeScroll(),r||this._initSelection(),this._isAutoWHMode&&(this._autoSSWidthHeight(),u._isOpened||this._refreshOverflow(i,t)),this._gotoPageArgs&&this._pageLoadComplete(t)),this.model.isGridMode&&(e=this.getSheetElement(t),k=this._getContent(t),k.find("#vscrollBar")[0].style.display=="none"&&e.find(".e-spreadsheetheader").hasClass("e-scrollcss")&&(e.find(".e-spreadsheetheader").removeClass("e-scrollcss"),e.find(".e-spreadsheetheader")[0].style.width=parseInt(e.find(".e-spreadsheetheader")[0].style.width)+18+"px"),k.find("#hscrollBar")[0].style.display=="none"&&e.find(".e-spreadsheetrowheader").hasClass("e-scrollrowcss")&&(e.find(".e-spreadsheetrowheader").removeClass("e-scrollrowcss"),e.find(".e-spreadsheetrowheader")[0].style.height=parseInt(e.find(".e-spreadsheetrowheader")[0].style.height)+18+"px")),u._isResized&&(this._refreshSheetWithScreen(t),this._updateResponsiveSettings(),l.width=this._responsiveWidth,l.height=this._responsiveHeight,this._setSheetWidthHeight(t,l,null,"refresh"),u._isResized=!1),this.model.scrollSettings.allowVirtualScrolling||u._isOpened||this._updateHiddenRows(t),this.model.allowFreezing&&this.XLFreeze._refreshFreeze(),this._isSheetNavigate=!1):this._importSheet(t),u._isOpened=!0,this.isImport||this.model.isImport||this.hideActivationPanel(),a&&!this._isExport&&!u._isImpSLoad&&u._isImported&&(v=a.model.sheets[t]._scrollTop,y=a.model.sheets[t]._scrollLeft,v>0&&this.XLScroll._vScroller(t).scroll(v),y>0&&this.XLScroll._hScroller(t).scroll(y),u._isImpSLoad=!0),p=this.getActiveCell(t),w=this.XLEdit.getPropertyValue(p.rowIndex,p.colIndex,"rule",t),w&&w.type==="list"&&this._setddlCell(),u._isRibCollapsed!=g&&(this._heightWidthCalculation(this.getActiveSheetIndex(),n.extend(!0,{},this.model.scrollSettings)),u._isRibCollapsed=g),this._isAutoWHMode&&(d=this._getElementDimension(),this.element.css({height:d.height,width:d.width})),this.XLRibbon._updateScopeRange(),this.XLRibbon._updateUseInFormulaTrgt(),this.XLEdit._refreshAutoComplete(),u._isImported&&!u._isLoaded||this._isUndoRedo||this._isExport||(b={sheetIndex:t,reqType:f.reqType,gotoSheetIndex:f.gotoIndex,isNewSheet:f.newSheet,prevSheetIndex:f.prevSheetIdx,action:"gotopage",type:"actionComplete"},this._trigActionComplete(b)),this.XLEdit._isEdit&&(tt=this.element.find("#"+this._id+"_Edit"),this.XLEdit._focusElements(tt)))}},insertSheet:function(){if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode){var n=this.getPager(),t=n.ejPager("option","totalRecordsCount")+1;n.ejPager("option",{totalRecordsCount:t});this._isSheetInsert=!0;this.gotoPage(t,!0);this._setSheetFocus()}},_renameSheet:function(i){var r=this.element.find(".e-currentitem"),u=t.buildTag("input#"+this._id+"_Sheet_RenamePanel","",{width:r.width()+5+"px",padding:0},{type:"input",value:i||this.getSheet(this.getActiveSheetIndex()).sheetInfo.text,maxlength:"31"});r.hide();u.insertAfter(r).select().focus();this._isSheetRename=!0;this.model.showRibbon&&this.XLRibbon._disableRibbonIcons();this.model.enableContextMenu&&n("#"+this._id+"_contextMenuFooter").data("ejMenu")._contextMenuEvents("_off")},deleteSheet:function(n,t){if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode){var r=this.getActiveSheetIndex(),i={index:n,alertStatus:t,sheetIndex:r,reqType:"delete",type:"actionBegin",action:"deleteSheet"},u;this._trigActionBegin(i)||(u=this._getSheetNames(!0).length,n=i.index||r,u>1?(n!==r&&this.gotoPage(n,!1),this.getObjectLength(this._dataContainer.sheets[n])&&i.alertStatus?this._showAlertDlg("","SheetDeleteAlert","sheetDeleteActn",470):this._removeSheet(n)):this._showAlertDlg("Alert","SheetDeleteErrorAlert","",430),i.type="actionComplete",this._trigActionComplete(i))}},hideSheet:function(t){if(!this.model.isReadOnly&&!this.model.isGridMode){var i=this._getSheetNames(!0),u=this._getSheetNames(),r=n.isNumeric(t)?t:this._getSheetIndexByName(t)||this.getActiveSheetIndex();i.length>1?(u[r-1].isVisible=!1,this.gotoPage(this._getNxtVisibleSheet(r,null,i))):this._showAlertDlg("Alert","SheetDeleteErrorAlert","",377)}},unhideSheet:function(t){if(!this.model.isReadOnly&&!this.model.isGridMode){var r=this._getSheetNames(),i=n.isNumeric(t)?t:this._getSheetIndexByName(t);r[i-1].isVisible||(r[i-1].isVisible=!0,this.gotoPage(i));this.hideWaitingPopUp()}},_getNxtVisibleSheet:function(n,t,i){var r=this._getSheetNames(),u=r.length,f="<=",e=1,o=this._getSheetNames(!0),s=r[n-1].value===(i&&i[i.length-1].value||o[o.length-1].value);for((t||s)&&(u=0,f=">=",e=-1);this.operators[f](n,u);){if(r[n-1].isVisible)return n;n=n+e}},_renderSpreadSheetPager:function(){var i,u,r={},t=n(document.createElement("div"));return this.model.pageSettings.change=n.proxy(this._spreadSheetPagerClickHandler,this),this.model.pageSettings.totalRecordsCount=this.model.sheetCount,this.model.pageSettings.locale=this.model.locale,n.extend(r,this.model.pageSettings),r.currentPage=this.getActiveSheetIndex(),r.pageSize=1,r.showGotoPage=!1,this.setPager(t),t.ejPager(r),i=t.data("ejPager"),i._$first[0].title=this._getLocStr("Firstsheet"),i._$last[0].title=this._getLocStr("Lastsheet"),i._$next[0].title=this._getLocStr("Nextsheet"),i._$prev[0].title=this._getLocStr("Prevsheet"),t.find(".e-parentmsgbar").remove(),u=t.find(".e-pagercontainer")[0],u.appendChild(t.find("a.e-PP")[0]),u.appendChild(t.find(".e-numericcontainer")[0]),u.appendChild(t.find("a.e-NP")[0]),t},_getPageCount:function(){var y=this.model.scrollSettings.isResponsive,p=this.model.pageSettings.pageCount;if(y){var r=0,h,i,u,c=this.getPager(),l,f,e=c.find(".e-currentitem"),w=c.find(".e-numericcontainer"),o=this._getSheetNames(),a=c.width(),s=250,b=w.children(":visible"),t=this.getActiveSheetIndex(),k=n(b[0]).data("index"),v=!0;for(i=this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0",i?(u=n("#"+this._id+"_emptySpan"),u.css({"font-size":e.css("font-size"),"font-family":e.css("font-family")})):(l=document.createElement("canvas"),f=l.getContext("2d"),f.font=e.css("font-size")+" "+e.css("font-family"));t>k-1;){if(s+=i?u.text(o[t-1].text).width()+19:f.measureText(o[t-1].text).width+19,a<=s)return r||1;t--;r++}for(t=this.getActiveSheetIndex();v;){if(h=this.isUndefined(o[t])?this._getLocStr("Sheet")+t:o[t].text,s+=i?u.text(h).width()+19:f.measureText(h).width+19,a<=s){v=!1;break}t++;r++}return i&&this._refreshGlobalSpan(),r||1}return p},_spreadsheetPagerCustomBtnHandler:function(n){var t=this.getPager().ejPager("option","currentPage");this._spreadSheetPagerClickHandler({currentPage:t,event:n,isInteraction:!0})},_spreadSheetPagerClickHandler:function(i){var s;if(i.isInteraction){var o,e,h=!1,r=this,f,u=n(i.event.target),a=r.getPager().data("ejPager"),c,l;if(r._filterClose(u),!u.hasClass("e-new")||!r.model.exportSettings.password)return(r.model.allowComments&&r.XLComment._isCommentEdit||r.XLEdit._isEdit||!r.model.allowInsert||r.model.isReadOnly)&&(i.event&&(u.hasClass("e-pager")||u.hasClass("e-new"))||r.element.find(".e-field-validation-error").length)?void 0:(r.model.allowComments&&r.XLComment._isCommentEdit&&r.XLComment._updateCurCmntVal(),r.XLEdit._isEdit&&!r.XLEdit._isFormulaEdit?r.XLEdit.saveCell():(s=r.element.find("#"+r._id+"_Edit").text(),s.substr(s.length-1).indexOf(",")>-1?(c={rowIndex:0,colIndex:0},l={rowIndex:0,colIndex:0}):(c=r._dStartCell,l=r._dEndCell),r.XLSelection._clearBorder(r._arrayAsString(r._ctrlFormulaBorder.concat(r._formulaBorder))),this.element.focus()),!t.isNullOrUndefined(i.event)&&(u.hasClass("e-prevpage")||u.hasClass("e-nextpage")||u.hasClass("e-firstpagedisabled")||u.hasClass("e-lastpagedisabled"))&&(i.currentPage=r._getNxtVisibleSheet(i.currentPage,u.hasClass("e-prevpage")||u.hasClass("e-lastpage")||u.hasClass("e-lastpagedisabled"))),f={activeSheet:r.getActiveSheetIndex(),gotoSheet:i.currentPage,newSheet:i.event&&u.hasClass("e-new")},f.newSheet?(o=r.getPager(),e=o.ejPager("option","totalRecordsCount")+1,f.gotoSheet=e):f.gotoSheet=i.currentPage,i.currentPage=f.gotoSheet,!t.isNullOrUndefined(i.event)&&i.event.target.id.indexOf("_Sheet_RenamePanel")>-1||r._isSheetRename&&!r._updateSheetNames(null,!1)||a._prevPageNo===i.currentPage)?void 0:(f.newSheet&&(o.ejPager("option",{totalRecordsCount:e,currentPage:e}),i.currentPage=e,h=!0),r._pageClickArgs=n.extend(!0,{},f),r.gotoPage(i.currentPage,h),n(i.event.target).hasClass("e-pager")||(r._completeAction({reqType:"paging",sheetIndex:f.activeSheet,nSheetIndex:i.currentPage}),r._trigActionComplete({reqType:"paging",sheetIndex:f.activeSheet,newSheetIndex:i.currentPage})),!1)}},_pageLoadComplete:function(t){var u,f,r=this.getSheet(t),e="option",o="checked",i=this._gotoPageArgs,s=this.model.allowSelection;if(s&&t!==i.prevSheetIdx&&(this.XLSelection._isGridBordering||this.XLSelection._isOutsideBordering)&&(this._getContent(i.prevSheetIdx).find("div:first-child").removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor"),this.XLSelection._isGridBordering=this.XLSelection._isOutsideBordering=!1),(!r._isImported||r._isLoaded)&&this.model.enableContextMenu&&this.XLCMenu.hideCMenu(),this._refreshSpreadSheetPager(i.newSheet),s&&this.getSheetElement(t).find(".e-ss-activeimg").length&&this.XLSelection._cleanUp(!0),this.model.showRibbon&&(this._updateRibbonTab(r._activeCell),this.isImport||this.model.isImport||(this.model.allowLockCell&&(r.isSheetProtected||this.XLEdit._isFormulaEdit?this.XLRibbon._disableRibbonIcons():this.XLRibbon._enableRibbonIcons(),this.XLRibbon._updateRibbonIcons()),this.model.allowComments&&this.XLComment._updateCmntRibIcons()),n("#"+this._id+"_Ribbon_PageLayout_Show_Headings").ejCheckBox(e,o,r.showHeadings),n("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").ejCheckBox(e,o,r.showGridlines)),this.model.allowCellFormatting&&(u=this.getSheetElement(t).find(".e-content")[0],this.XLFormat._formatEnable?(this._removeClass(u,"e-ss-cursor"),this.addClass(u,"e-ss-fpcursor")):(this.addClass(u,"e-ss-cursor"),this._removeClass(u,"e-ss-fpcursor"))),this._pageClickArgs){if(this._pageClickArgs.activeSheet=this.getActiveSheetIndex(),this._trigger("pagerClick",this._pageClickArgs))return!1;this.model.scrollSettings.isResponsive&&this._isResized&&!this._resizeColl[t-1]&&(this._refreshSheetonResize(),this._resizeColl.toString().indexOf("f")<0&&(this._isResized=!1,this._resizeColl.fill(!1)))}this.hideWaitingPopUp();this._pageClickArgs=this._gotoPageArgs=null;f={gotoSheetIndex:i.gotoIndex,isNewSheet:i.newSheet,prevSheetIndex:i.prevSheetIdx,reqType:i.reqType};this._trigActionComplete(f)},_createTemplateElement:function(t,i){var r=document.createElement("script");return r.id=(this._id+t+i.field+n.inArray(i,this.getSheet(t).columns)+"_Template").split(" ").join(""),r.type="text/x-jsrender",r.text=i.templateContent?i.templateContent:n(i.templateID).html(),n("body").append(r),n(i.templateID).hide(),r},_refreshSpreadSheetPager:function(n){var t=this.getPager(),i={currentPage:this.getActiveSheetIndex()},u=t.height(),r;(this.isImport||this.model.isImport||this._isNew||t===null)&&(i.totalRecordsCount=this.model.sheetCount);(n||this._isInitLoad||this._isSheetInsert||this._isNew)&&(this.model.pageSettings.pageCount=i.pageCount=this._getPageCount());t.ejPager("option",i).ejPager("refreshPager");this._updatePageContainer(t,i.currentPage);r=t.height();u!==r&&(i.pageCount=this._getPageCount(),t.ejPager("option",i).ejPager("refreshPager"),this._updatePageContainer(t,i.currentPage));this.model.isGridMode&&(document.getElementById(this._id+"_AddSheet").style.display="none");this.model.allowInsert||this.addClass(document.getElementById(this._id+"_AddSheet"),"e-disable")},_updatePageContainer:function(t,i){var l,w,s,f,e,h,r=0,o=0,u=t.data("ejPager"),et=this.model.sheets,b=t.find(".e-numericcontainer").children(":visible"),k=u.model.pageCount,d=[u._$first[0],u._$prev[0]],g=["e-firstpagedisabled e-disable","e-firstpage e-default","e-prevpagedisabled e-disable","e-prevpage e-default"],nt=[u._$last[0],u._$next[0]],tt=["e-lastpagedisabled e-disable","e-lastpage e-default","e-nextpagedisabled e-disable","e-nextpage e-default"],it=b.length,ot=r+1===it;for(u._$next[0].className=u._$next[0].className.replace("-2x",""),u._$prev[0].className=u._$prev[0].className.replace("-2x","");r<it;){if(f=n(b[r]),s=f.data("index"),h=et[s].sheetInfo,e=h.text,ot){for(var v,st=t.outerWidth(),y,rt,p,ut=!0,c=e,ft=3,a=this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0";ut;){if(a?(v=n("#"+this._id+"_emptySpan"),v.css({"font-size":f.css("font-size"),"font-family":f.css("font-family")}),y=248+(v.text(c).width()+19)):(rt=document.createElement("canvas"),p=rt.getContext("2d"),p.font=f.css("font-size")+" "+f.css("font-family"),y=248+(p.measureText(c).width+19)),st<=y&&e.length>=ft){c=e.slice(0,e.length-ft++)+"...";continue}ut=!1;e=c}a&&this._refreshGlobalSpan()}f.text(e);h.isVisible?w=s%k:f.hide();!l&&h.isVisible&&(l=s%k);r++}if(l===i)for(r=0;r<2;r++)this.addClass(d[r],g[o]),this._removeClass(d[r],g[o+1]),o+=2;if(o=0,w===i)for(r=0;r<2;r++)this.addClass(nt[r],tt[o]),this._removeClass(nt[r],tt[o+1]),o+=2},_updateSheetNames:function(i,r){var w,o,ft,f,d,l,dt=this.getPager(),at,g=dt.find(".e-currentitem"),nt=this.model.sheets,et=n("#"+this._id+"_Sheet_RenamePanel"),vt=!0,v=[],ot,h,b,s,yt,pt,tt,k,st,u,y,c,p=[],it,ht,wt,rt,bt,a,ut,gt=/'[^'"]*'(?=(?:[^"]*"[^"]*")*[^"]*$)/g,ct,lt,e,kt;if(t.isNullOrUndefined(i)&&(i=et.val().trim()),o=nt[g.data("index")].sheetInfo.text,w={sheetIdx:this.getActiveSheetIndex(),reqType:"renameSheet",prevName:o,newName:i,type:"actionBegin",action:"updatesheetnames"},this._trigActionBegin(w)&&(r=!0),i=w.newName,r)return et.remove(),g.show(),this.model.showRibbon&&this.XLRibbon._enableRibbonIcons(),this.model.enableContextMenu&&n("#"+this._id+"_contextMenuFooter").data("ejMenu")._contextMenuEvents("_on"),this._isSheetRename=!1,!1;if(i.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*"))&&(i=!1),!i)return this._showAlertDlg("Alert",["SheetRenameEmptyAlert","SheetRenameEmptyCharExceedAlert","SheetRenameEmptySplCharAlert","SheetRenameEmptyBlankAlert"],"sheetRenameActn",500),!1;for(u=1,at=nt.length;u<at;u++)g.text()!==nt[u].sheetInfo.text&&i.toLowerCase()===nt[u].sheetInfo.text.toLowerCase()&&(vt=!1);if(vt){if(this.model.enablePivotTable&&this.XLPivot._updateSheetName(i),nt[g.data("index")].sheetInfo.text=i){et.remove();g.show();d=this._calcEngine;it=d.getDependentCells().items;for(ct in it)it.hasOwnProperty(ct)&&p.push(ct);for(ot=p,h=this._getSheetNames(),u=0;u<ot.length;u++)for(b=it[ot[u]],e=0;e<b.length;e++){if(s=d.getFormulaInfoTable().items[b[e]],s)for(s=s.getFormulaText(),y=0;y<h.length;y++)h[y].text!==h[y].value&&(k=new RegExp(h[y].value+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),s.match(gt)&&(this.XLEdit._singleQuote=!0),s.match(k)&&(s=s.replace(k,y+"/"),v.push(y),st=!0));if(st){for(c=0;c<v.length;)k=new RegExp(v[c]+'/(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),s=isNaN(h[v[c]].text)&&/^[a-zA-Z0-9- ]*$/.test(h[v[c]].text)&&!h[c].text.match("\\s+")?s.replace(k,h[v[c]].text):s.replace(k,this.XLEdit._singleQuote?h[v[c]].text:"'"+h[v[c]].text+"'"),c++,this.XLEdit._singleQuote=!1;yt=d.rowIndex(b[e])-1;pt=d.colIndex(b[e])-1;tt=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+(parseInt(b[e].split("!")[1])+1));this.XLEdit._updateDataContainer({rowIndex:yt,colIndex:pt},{dataObj:{value:s},sheetIdx:tt});st=!1}}this._isSheetRename=!1}for(this._refreshSpreadSheetPager(!0),this.model.allowFormulaBar&&this.updateFormulaBar(),a=this.getSheet(tt),l=this.model.nameManager,u=0,wt=l.length;u<wt;u++){for(f=l[u].refersto,f=f.split(","),lt=[],rt=l[u].scope,e=0,kt=f.length;e<kt;e++)rt&&rt.indexOf(o)>-1&&(l[u].scope=rt.replace(o,i.match(/\s/g)?"'"+i+"'":i),this._calcEngine.removeNamedRange(o+"!"+l[u].name),this._calcEngine.addNamedRange(i+"!"+l[u].name,l[u].refersto.replace("=",""))),f[e]&&f[e].indexOf(o)>-1&&(f[e]=f[e].replace(/[\']/g,""),lt.push(f[e].replace(o,i.match(/\s/g)?"'"+i+"'":i)));l[u].refersto=lt.join(",")}for(p=this.getObjectKeys(a._scopeRanges),u=0,bt=p.length;u<bt;u++)ut=a._scopeRanges[p[u]].name,f=a._scopeRanges[p[u]].refersto,ut&&ut.indexOf(o)>-1&&(a._scopeRanges[p[u]].name=ut.replace(o,i.match(/\s/g)?"'"+i+"'":i)),f&&f.indexOf(o)>-1&&(f=f.replace(/[\']/g,""),a._scopeRanges[p[u]].refersto=f.replace(o,i.match(/\s/g)?"'"+i+"'":i));ht=a.tableManager;for(u in ht)this.XLFormat._updateTableFormula("updateRange",ht[u],tt);return this.model.showRibbon&&(this.XLRibbon._enableRibbonIcons(),ft=n("#"+this._id+"_nmgrid").data("ejGrid"),ft&&(ft.refreshContent(),n("#"+this._id+"_nmrange").val(""))),this.model.enableContextMenu&&n("#"+this._id+"_contextMenuFooter").data("ejMenu")._contextMenuEvents("_on"),w={sheetIdx:this.getActiveSheetIndex(),reqType:"renameSheet",prevName:o,newName:i,type:"actionComplete",action:"updatesheetnames"},this._trigActionComplete(w),!0}this._showAlertDlg("Alert","SheetRenameAlert","sheetRenameActn",325);a._isImported&&!a._isLoaded||this._isUndoRedo||this._isExport||(this._completeAction(w),this._trigActionComplete(w))},_getSheetIndexByName:function(n){var i=this._getSheetNames(),t,r;for(n=n&&n.replace(/^'|'$/g,""),n&&(n=n.toLowerCase()),t=0,r=i.length;t<r;t++)if(i[t].text.toLowerCase()===n)return t+1;return!1},_removeSheet:function(t){var r=this.model.sheetCount,d=this._dataContainer.sheets,i,y=this.model.sheets,g,u,e,h,o,p=[],w,c,l,s,nt,b=[],f,k,a,tt,v,it;if(r>1){if(l=y[t].sheetInfo.value,this._getAutoFillOptElem().appendTo(this.element),this.element.find("#"+this._id+"_"+l).remove(),r===this.getActiveSheetIndex()){for(i=1;i<r;i++)if(y[t-i].sheetInfo.isVisible){this.setActiveSheetIndex(t-i);break}}else this.setActiveSheetIndex(t);for(this._swapSheetDtCntr(t,r),(r in d)&&delete d[r],this._sheets.splice(r,1),y.splice(r,1),r=--this.model.sheetCount,this.getPager().ejPager("option",{totalRecordsCount:r,pageCount:this._getPageCount()}),this.gotoPage(this.getActiveSheetIndex(),!1),this._getAutoFillOptElem().appendTo(this._getJSSheetContent(this.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content")),this._rebindScrollEvnt(),s=this.model.nameManager,i=0,tt=s.length;i<tt;i++)nt=s[i].refersto,nt.indexOf(l)>-1&&(b.push(s[i].name),s[i].scope!="Workbook"?s.splice(i,1):s[i].refersto="#REF!");f=this._calcEngine;a=n.extend(!0,[],f.getDependentCells().items);for(i in a)a.hasOwnProperty(i)&&p.push(i);for(i=0;i<p.length;i++)for(e=a[p[i]],u=0;u<e.length;u++)if(h=f.getFormulaInfoTable().items[e[u]],c=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+(parseInt(e[u].split("!")[1])+1)),h&&c>-1)for(o=h.getFormulaText(),w=new RegExp(l+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),o.match(w)&&(o=o.replace(w,"#REF"),this.XLEdit._updateDataContainer({rowIndex:f.rowIndex(e[u])-1,colIndex:f.colIndex(e[u])-1},{dataObj:{value:o},sheetIdx:c}),f.refresh(h.getParsedFormula()),this.XLEdit._refreshCalcEngine(f.rowIndex(e[u])-1,f.colIndex(e[u])-1,!0,o,c)),v=0,it=b.length;v<it;v++)o.indexOf(b[v])>-1&&f.refresh(h.getParsedFormula());if(this.model.showRibbon&&(k=n("#"+this._id+"_nmgrid").data("ejGrid"),k&&(k.refreshContent(),n("#"+this._id+"_nmrange").val(""))),g={sheetIndex:t,reqType:"remove-sheet"},this.clearUndoRedo(),this._trigActionComplete(g))return}},_rebindScrollEvnt:function(){for(var n=1;n<=this.model.sheetCount;n++)this.getSheet(n)._isLoaded&&(this._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content").off("scroll"),this.element.find("#"+this._id+"_"+this.model.sheets[n].sheetInfo.value).find(".e-headercontent").off("scroll"),this._refreshScrollerEvent(n))},_getSheetNames:function(n){for(var u=[],i=this.model.sheets,t=1,r=i.length;t<r;t++)(this.isUndefined(n)||(!n||i[t].sheetInfo.isVisible)&&(n||!i[t].sheetInfo.isVisible))&&u.push(i[t].sheetInfo);return u},_initMoveCopyDlg:function(){var n=this._id+"_moveCopyDlg",i,r,f,e,o,s,u,h,c;i=t.buildTag("div#"+n,"",{display:"none"});r=t.buildTag("div#"+n+"_sheetContent.e-dlgctndiv e-dlg-fields",t.buildTag("label.e-dlg-fields",this._getLocStr("Beforesheet")));h=t.buildTag("div.e-dlg-fields");s=t.buildTag("ul#"+n+"_list");r.append(h.append(s));u=t.buildTag("input#"+n+"_createcopy");r.append(u);u.ejCheckBox({cssClass:"e-dlg-fields"});u.parent().append(t.buildTag("label",this._getLocStr("CreateaCopy"),{"margin-left":6}));i.append(r);o=t.buildTag("div#"+n+"_btndiv.e-dlg-btnfields");c=t.buildTag("div.e-dlg-btnctnr");f=t.buildTag("input#"+n+"_okbtn","");e=t.buildTag("input#"+n+"_cnlbtn");f.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,click:t.proxy(this._moveCopyBtnClick,this,"ok"),cssClass:"e-ss-okbtn",width:60});e.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._moveCopyBtnClick,this,"cancel"),showRoundedCorner:!0,width:60});o.append(c.append(f,e));i.append(o);this.element.append(i);i.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("MoveorCopy"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg e-ss-movedlg"});s.ejListBox({dataSource:this._getSheetNames(),height:"197px",width:"250px",fields:{text:"text",value:"value"}})},_renderMoveCopyDlg:function(){var r=n("#"+this._id+"_moveCopyDlg"),t=n("#"+this._id+"_moveCopyDlg_list").data("ejListBox"),i=this._getSheetNames();i.push({text:this._getLocStr("MoveToEnd"),value:this._getLocStr("MoveToEnd")});r.ejDialog("open");t.model.dataSource=i;t.option("fields",{dataSource:i});t.unSelectAll();t.selectItemByIndex(0)},_initUnhideDlg:function(){var n=this._id+"_UnhideDlg",i,r,u,f,e,o,s;i=t.buildTag("div#"+n,"",{display:"none"});r=t.buildTag("div#"+n+"_sheetContent.e-dlgctndiv e-dlg-fields",t.buildTag("label.e-dlg-fields",this._getLocStr("UnhideDlgText")));o=t.buildTag("ul#"+n+"_list");r.append(o);i.append(r);e=t.buildTag("div#"+n+"_btndiv.e-dlg-btnfields");s=t.buildTag("div.e-dlg-btnctnr");u=t.buildTag("input#"+n+"_okbtn");f=t.buildTag("input#"+n+"_cnlbtn");u.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._unhideBtnClick,this,"ok"),cssClass:"e-ss-okbtn"});f.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._unhideBtnClick,this,"cancel"),showRoundedCorner:!0,width:"25%"});e.append(s.append(u,f));i.append(e);this.element.append(i);i.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("UnhideSheet"),width:280,height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg"});o.ejListBox({dataSource:this._getSheetNames(),height:"197px",width:"250px",fields:{text:"text",value:"value"}})},_renderUnhideDlg:function(){var r=n("#"+this._id+"_UnhideDlg"),t=n("#"+this._id+"_UnhideDlg_list").data("ejListBox"),i=this._getSheetNames(!1);i.length>0&&(r.ejDialog("open"),t.model.dataSource=i,t.option("fields",{dataSource:i}),t.unselectAll(),t.selectItemByIndex(0))},_moveCopyBtnClick:function(i){switch(i){case"ok":var c,r,u,y,e,p=!1,l=2,f,o=n(this.element).find(".e-currentitem"),w=n("#"+this._id+"_moveCopyDlg_list").data("ejListBox"),h=n("#"+this._id+"_moveCopyDlg_createcopy").data("ejCheckBox"),v=w.getSelectedItems()[0].text,s=w.getIndexByText(v),a=this.model.sheets;if(!h.isChecked()&&v===o.text()){n("#"+this._id+"_moveCopyDlg").ejDialog("close");this._setSheetFocus();return}for(u=1;u<a.length;u++)v===a[u].sheetInfo.text&&(r=u),o.text()===a[u].sheetInfo.text&&(f=u);if(c={reqType:"moveSheet",toSheetIndex:s,fromSheetIndex:f,isCopy:h.isChecked(),type:"actionBegin",action:i},this._trigActionBegin(c))return n("#"+this._id+"_moveCopyDlg").ejDialog("close"),!1;if(s=c.toSheetIndex,f=c.fromSheetIndex,h.isChecked()){for(o.text().match(".*[ ]+[(]+[0-9]+[)]$")===null?e=o.text()+" ("+l+")":o.text().lastIndexOf(" ")!==-1&&(l=parseInt(o.text().substring(o.text().lastIndexOf("(")+1,o.text().lastIndexOf(")"))),e=o.text().substring(0,o.text().lastIndexOf(" "))+" ("+l+")");!p;){for(e=e.substring(0,e.lastIndexOf(" "))+" ("+l+")",u=1,y=a.length;u<y;u++)e===a[u].sheetInfo.text&&l++;l===parseInt(e.substring(e.lastIndexOf("(")+1,e.lastIndexOf(")")))&&(p=!0)}this._copySheet=!0;this._copySheetProcess(f,e);this._copySheet=!1;f=this.model.sheetCount;t.isNullOrUndefined(r)&&(r=f)}else!t.isNullOrUndefined(r)&&r>f&&(r=r-1);if(t.isNullOrUndefined(r)&&(r=s),!h.isChecked()&&r===f){n("#"+this._id+"_moveCopyDlg").ejDialog("close");this._setSheetFocus();break}this._swapSheetDtCntr(f,r);n("#"+this._id+"_moveCopyDlg").ejDialog("close");r<=f&&(s=s+1);this.getPager().ejPager("option",{currentPage:s});this.gotoPage(s,!1);this._rebindScrollEvnt();c={reqType:"moveSheet",toSheetIndex:s,fromSheetIndex:f,isCopy:h.isChecked()};this._trigActionComplete(c);h._unChecked();h._isChecked=!1;this._setSheetFocus();break;case"cancel":n("#"+this._id+"_moveCopyDlg").ejDialog("close")}},_unhideBtnClick:function(t){if(t==="ok"){var i=n("#"+this._id+"_UnhideDlg_list").data("ejListBox");this.unhideSheet(i.getSelectedItems()[0].text)}n("#"+this._id+"_UnhideDlg").ejDialog("close")},_swapSheetDtCntr:function(n,t){var f=this._dataContainer.sheets,i=this.model.sheets,e=this._sheets,o=this._getLocStr("Sheet"),s=[{}],h,u,r,c;for(u in f)f.hasOwnProperty(u)&&(s[parseInt(i[u].sheetInfo.value.replace(o,""))]=f[u]);for(i.splice(t,0,i.splice(n,1)[0]),e.splice(t,0,e.splice(n,1)[0]),r=1,c=i.length;r<c;r++)h=parseInt(i[r].sheetInfo.value.replace(o,"")),this._dataContainer.sheets[r]=s[h];this.clearUndoRedo()},_copySheetProcess:function(t,i){var o,h,r,s,c,u,l,a,f,v,p=this.getPager(),w=p.ejPager("option","totalRecordsCount")+1,e=this.model.sheets,y,b;for(this._impData&&this.XLExport._renderAll(),p.ejPager("option",{totalRecordsCount:w,currentPage:w}),e.push(n.extend(!0,{},e[t])),e[e.length-1]._isImported=!1,this._sheetCopy={isSheetCopy:!0,sheetContent:this._getContent(t).find(".e-table").clone(!0).get(0),sheetIndex:t},u=this.model.sheetCount+1,e[u].sheetInfo.text=i,l=e[u].sheetInfo.value=this._getLocStr("Sheet")+this._newSIndex,this._newSIndex++,this.setActiveSheetIndex(u),this._dataContainer.sheets[u]=n.extend(!0,{},this._dataContainer.sheets[t]),this._sheets[u]={_contentColGroup:null,_content:null,_sheetRowHeaderContent:null,_sheetHeader:null,_sheetRowHeader:null,_sheetContent:null,_Rows:null},this._initSheet(u),this.model.sheetCount++,this._sheetCopy={isSheetCopy:!1,sheetContent:null,sheetIndex:null},this._calcEngine.registerGridAsSheet(l,l,this._calcID),v=e[u].usedRange,r=0;r<=v.rowIndex;r++)for(s=0;s<=v.colIndex;s++)h=this.XLEdit.getPropertyValue(r,s,"value"),h&&this.isFormula(h)&&this.XLEdit._refreshCalcEngine(r,s,!0,h,u);for(a=e[u].shapeMngr.picture,c=this.getObjectLength(a),r=1;r<=c;r++)f=a[this._id+"_picture"+r],this.XLShape._createPicture(u,{rowIndex:f.rowIndex,colIndex:f.colIndex},this.getSheet(u).shapeMngr.sharedPics[f.data],f.top,f.left,f.width,f.height,null,f.bcolor,f.bstyle,f.bwidth);if(!this.model.scrollSettings.allowVirtualScrolling)for(y=this._getContent(u).find(".e-commentcell"),r=0,c=y.length;r<c;r++)b=n(y[r]),o=this._getCellIdx(n(".e-commentcell")[0]),b.removeClass("e-commentcell")&&this.XLComment.setComment([o.rowIndex,o.colIndex,o.rowIndex,o.colIndex],null,!1);this.model.allowComments&&this.XLComment._updateCmntArrowPos()},showActivationPanel:function(n){var i,t=this.getActiveSheetIndex(),r=this.getActivationPanel();if(!this.model.enablePivotTable||this._phoneMode)return!1;if(this.isUndefined(n))this._getContent(t).find(".e-ss-activepivot").length&&this.XLPivot._displayActPanel&&(this.model._isActPanelVisible=!0,this._setSheetWidthHeight(t,{width:this._responsiveWidth,height:this._responsiveHeight,isActPanel:!0},null,"refresh"),this._refreshActivationPanel());else if(i=this.getSheet(t).rangeSettings[n],i.showPanel){if(this._trigger("beforePanelOpen",{activationPanel:r,range:i,sheetIndex:t}))return!1;this.model._isActPanelVisible=!0;this._setSheetWidthHeight(t,{width:this._responsiveWidth,height:this._responsiveHeight,isActPanel:!0},null,"refresh");this._refreshActivationPanel()}this.model.showPager&&this._refreshSpreadSheetPager(!0)},_refreshActivationPanel:function(){var n=this.getActivationPanel(),i=this.getMainPanel().height(),t=n.data("ejScroller"),r;n.width(this.model.activationPanelWidth-1).height(i);n.find(".e-ss-pivotfield").hide();n.find("#"+this._id+"_PivotTableSchema_"+this._getContent(this.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).show();n.find(".e-ss-pivotfield").width(this.model.activationPanelWidth-20);n.show();r=this.getActivationPanel().find("#"+this._id+"_PivotTableSchema_"+this._getContent(this.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).data("ejPivotSchemaDesigner");r._reSizeHandler();t&&(t.option({width:this.model.activationPanelWidth-1,height:i}),t.refresh())},hideActivationPanel:function(){var n=this.getActivationPanel();n.is(":visible")&&(n.find(".e-ss-pivotfield").hide(),this.model._isActPanelVisible=!1,n.hide(),this._isNew||this._setSheetWidthHeight(this.getActiveSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight},null,"refresh"),this.model.showPager&&this._refreshSpreadSheetPager(!0))},_addSheet:function(n){this._sheetSettings(n);this._dataContainer.sheets[n]={};this._initSheet(n);this._newSIndex++;this.model.sheetCount++},addNewSheet:function(){!this.model.allowInsert||this.model.isReadOnly||this.model.isGridMode||this.element.find(".e-pager .e-new").click()},_createFocusElement:function(){this.setFocusTopElem(n("<div class='e-focustop e-hide' ><\/div>"));this.setFocusRightElem(n("<div class='e-focusright e-hide' ><\/div>"));this.setFocusBottomElem(n("<div class='e-focusbottom e-hide' ><\/div>"));this.setFocusLeftElem(n("<div class='e-focusleft e-hide' ><\/div>"))},_createAutoFillElement:function(){var i,r=this._getJSSheetContent(this.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content");this.model.allowAutoFill&&(i=n("<div class='e-autofill e-hide'><\/div>"),r.append(i),this.setAutoFillElem(i));this.element.append(t.buildTag("ul.e-spreadsheet","",{width:"auto"},{id:this._id+"_ctxtmenu"}));i=n("<div class='e-splitspan e-hide' title="+this._getLocStr("AutoFillTitle")+"><button id="+this._id+"_dragfilloptionbtn type='button'><\/button><\/div>");r.append(i);this._setAutoFillOptElem(i);this._initializeSplitButton()},_initializeSplitButton:function(){this._getAutoFillOptElem().find("button").ejSplitButton({size:"normal",contentType:"imageonly",targetID:this._id+"_ctxtmenu",prefixIcon:"e-icon e-ss-autofill",isSeparator:!1,buttonMode:t.ButtonMode.Dropdown,imagePosition:t.ImagePosition.ImageLeft,arrowPosition:t.ArrowPosition.Right,fields:{dataSource:this._fillOptionMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},beforeOpen:n.proxy(this.model.allowAutoFill&&this.XLDragFill._autoFillClick,this),itemSelected:n.proxy(this.model.allowAutoFill&&this.XLDragFill._autoFillOptionClick,this),width:"42px",height:"24px",cssClass:"e-spreadsheet e-autofillbtn"})},_renderFormulaBar:function(t){var i,r="<div id="+this._id+"_formulabar class='e-formulabar' ><div id="+this._id+"_indexbox class='e-indexbox' title='"+this._getLocStr("NameBox")+"'><\/div><div class='e-inputbox' ><input id="+this._id+"_inputbox type='text' title='"+this._getLocStr("FormulaBar")+"'/><\/div><\/div>",u;t?this.model.showRibbon?n("#"+this._id+"_Ribbon").after(r):this.element.prepend(r):this.element.append(r);this._setIndexBox(n("#"+this._id+"_indexbox"));i=n("#"+this._id+"_inputbox");this._setInputBox(i);this.XLEdit._renderAutoComplete(i,"",26);this._alignFormulaBar();u=this.element.find(".e-formulabar").height();u>36&&(this._formulaHeight=u);this.model.isReadOnly&&(this.element.find(".e-formulabar")[0].disabled=!0)},_alignFormulaBar:function(n){var u=this.model.scrollSettings,i,r,t;n=n||this._responsiveWidth;this.element.find(".e-formulabar").width(u.isResponsive?n-2:n);n=parseInt(n);i=n/10;r=n-(i+24);t=this.element.find(".e-inputbox");t.hide();t.width(Math.floor(r));this.element.find(".e-indexbox").width(Math.floor(i));t.show()},hideFormulaBar:function(){if(n("#"+this._id+"_formulabar").hide(),!this._isInitLoad){this._setSheetWidthHeight(this._getSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight});for(var t=1,i=this.model.sheets.length;t<i;t++)this.getSheet(t)._isResized=t!=this.getActiveSheetIndex()}},showFormulaBar:function(){if(this.model.allowFormulaBar){n("#"+this._id+"_formulabar").show();this._setSheetWidthHeight(this._getSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight});for(var t=1,i=this.model.sheets.length;t<i;t++)this.getSheet(t)._isResized=t!=this.getActiveSheetIndex();this.updateFormulaBar()}},_getlocaleNumVal:function(n,i){if(n=typeof n!="object"&&Number(n)?Number(n):!t.isNullOrUndefined(n)&&typeof n!="object"?t.parseFloat(n+"",this.model.locale):null,!t.isNullOrUndefined(n)&&!isNaN(n)&&i){var r=t.preferredCulture(this.model.locale).numberFormat,u=n.toString();r["."]!="."&&u.indexOf(r["."])<0&&(n=u.replace(".",r["."]))}return n},_getEditValOfDateTime:function(n,i){var u=this.XLEdit.getPropertyValue(n,i,"type"),r=this.getRangeData({range:[n,i,n,i],property:["value","value2"]})[0];return this._isDateTime(r.value)?u=="longdate"||u=="date"?["12:00:00 AM","0:00:00"].indexOf(r.value.toLocaleTimeString())==-1?this.formatting("{0:"+t.preferredCulture(this.model.locale).calendar.patterns.dT+"}",r.value,this.model.locale):this.formatting("{0:"+t.preferredCulture(this.model.locale).calendar.patterns.d+"}",r.value,this.model.locale):r.value.toLocaleDateString()!="1/1/1990"&&["12:00:00 AM","0:00:00"].indexOf(r.value.toLocaleTimeString())==-1||u=="time"&&r.value.toLocaleDateString()!="1/1/1990"?this.formatting("{0:"+t.preferredCulture(this.model.locale).calendar.patterns.dT+"}",r.value,this.model.locale):r.value2:r.value2},updateFormulaBar:function(){if(this.model.allowFormulaBar){var i,u,c,e=this.getActiveSheetIndex(),r=this.getSheet(e)._activeCell,f=this._getContent(e).find(".e-ss-activeimg")[0],o,l,s,h;u=this.getRangeData({range:[r.rowIndex,r.colIndex,r.rowIndex,r.colIndex],property:["value","value2","isLocked"]})[0];t.isNullOrUndefined(u)?i="":(i=t.isNullOrUndefined(u.value)?"":u.value,s=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"hasFormulaArray"),h=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"hasMultipleFormulaArray"),(!this.XLEdit._isEdit&&(s||h)||this._formulaArray)&&(i="{"+i+"}"));this._isDateTime(i)&&(i=this._getEditValOfDateTime(r.rowIndex,r.colIndex));this.model.locale!=="en-US"&&this.isNumber(i)&&(o=t.preferredCulture(this.model.locale).numberFormat,l=new RegExp("\\"+o[","]+"\\d{3}"),i=i+"",o[","]=="."&&(l.test(i)||u.value!=u.value2)&&(i=this._getlocaleNumVal(i,!0)));this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"type")==="percentage"&&(i=this.isFormula(u.value)?u.value:u.value2,(!this.XLEdit._isEdit&&(s||h)||this._formulaArray)&&(i="{"+i+"}"));this._getInputBox().val(i);this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"isReadOnly")||this.model.allowLockCell&&this.getSheet(e).isSheetProtected&&u.isLocked?this._getInputBox().attr("readonly","readonly"):this._getInputBox().prop("readonly",!1);c=f&&(f.id.indexOf(this._id+"_picture")>-1||f.id.indexOf(this._id+"_chart")>-1)?f.id.replace(n(f).data("parentID")+"_",""):this._generateHeaderText(r.colIndex+1)+(r.rowIndex+1);this._getIndexBox().html(c)}},_initSelection:function(){var r,i=this.model,f=this.getActiveSheetIndex(),n=this.getSheet(f),u=this._getJSSheetContent(f).find(".e-spreadsheetcontentcontainer > .e-content"),e=i.selectionSettings.selectionType,o=t.Spreadsheet.SelectionType,s=i.selectionSettings.activeCell;i.allowSelection&&(this.getFocusTopElem()||this._createFocusElement(),u.append(this.getFocusTopElem(),this.getFocusRightElem(),this.getFocusBottomElem(),this.getFocusLeftElem()),s&&(r=this.getRangeIndices(s),!this.isRange(r)&&r[0]<n.rowCount&&r[1]<n.colCount&&(n._startCell=n._endCell=n._activeCell={rowIndex:r[0],colIndex:r[1]})),(!n._isImported||n._isLoaded)&&n._selectedCells.length?(this.XLSelection.selectRange(n._selectedCells[0],n._selectedCells[n._selectedCells.length-1]),this.XLSelection._refreshBorder()):(this.XLSelection._processBoundary(),e===o.Row||n._isRowSelected?this.XLSelection.selectRows(n._startCell.rowIndex,n._endCell.rowIndex):e===o.Column||n._isColSelected?this.XLSelection.selectColumns(n._startCell.colIndex,n._endCell.colIndex):this.XLSelection.selectRange(n._startCell,n._endCell)));i.allowAutoFill&&(this.getAutoFillElem()||this._createAutoFillElement(),this.getAutoFillElem().appendTo(u),this.XLDragFill.positionAutoFillElement(),i.autoFillSettings.showFillOptions&&i.allowAutoFill&&(this._getAutoFillOptElem().appendTo(u),this.XLDragFill.hideAutoFillOptions()));i.allowSelection&&n._isFreezed&&this.XLFreeze._refreshSelection()},_updateRibbonTab:function(t){var i,u,r=this.getActiveSheetIndex(),o=n("#"+this._id+"_Ribbon").data("ejRibbon"),f=this.XLRibbon,s=this.element.find(".e-ribbon .e-contextual a:visible"),e=s.length,h=o.element.find("#"+this._id+"_Ribbon_togglebutton");if(t&&(u=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"tableName",r)),e)while(e--)o.hideTab(s[e].text);f._toggleAnalyzeTab();h.is(":visible")&&h.hasClass("e-ribbonpin")&&this._refreshSheetonResize();i=this._getContent(r).find(".e-ss-activeimg");i.length?i[0].id.indexOf("chart")>-1?this.XLRibbon._chartDesignTabUpdate(i):this.XLRibbon._formatTabUpdate():u?f._designTabUpdate(this._getTableID(u),t):this._getContent(r).find(".e-ss-activepivot").length&&(f._analyzeTabUpdate(),this.XLSelection._cleanUp(!0),this.getActivationPanel().find("#"+this._id+"_PivotTableSchema_"+this._getContent(r).find(".e-ss-activepivot")[0].id).show(),this.showActivationPanel())},_updateCellType:function(){var n,i=t.Spreadsheet.CellType;for(n in i)this._dataContainer.cellType.push(i[n])},_updateFormulaCollection:function(){var n,i=this._calcEngine.getLibraryFunctions(),t=[];for(n in i.items)t.push({text:"="+n,display:n});this._formulaCollection=t},_renderScroller:function(n,t,i){this.XLScroll._createScroller(n,t,i);this._refreshScrollerEvent(n)},_refreshScrollerEvent:function(i){this._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").scroll(t.proxy(function(t){var i=this.getActiveSheetIndex(),r=this.getSheet(i),u=this._isFrozen(this.getFrozenColumns(i))?n(t.target).scrollLeft():r._scrollLeft;this._getJSSheetHeader(i).find(".e-headercontent").scrollLeft(u);this._getJSSheetRowHeaderContent(i).scrollTop(n(t.currentTarget).scrollTop())},this));this.element.find("#"+this._id+"_"+this.model.sheets[i].sheetInfo.value).find(".e-headercontent").scroll(t.proxy(function(t){var i=this.getActiveSheetIndex(),r=this._isFrozen(this.getFrozenColumns(i))?n(t.target).scrollLeft():this.getSheet(i)._scrollLeft;this._getContent(i).find(".e-content").scrollLeft(r);this.getSheet(i)._scrollLeft=this._getContent(i).find(".e-content").scrollLeft()},this))},_clickHandler:function(i){if(this.XLEdit._isFEdit=!1,this._hasClass(i.target,"e-ssfilter"))this._excelFilter._openedFltr&&n(this._excelFilter._openedFltr).is(":visible")?this._excelFilter.closeXFDialog():this.XLFilter._filterClickHandler(i);else{if(i.target.tagName==="TD"&&n(i.target).parents("div")[0].className.indexOf("e-content")>-1&&i.target.className.indexOf("e-rowcell")>-1&&n(i.target).find(".e-chk-image").length<1&&(this._clkCellObj=this._getCellIdx(i.target)),(i.target.localName==="svg"||i.target.localName==="path"||i.target.localName==="rect"||i.target.localName==="circle"||i.target.localName==="div"&&i.target.className.indexOf("e-sparkline")>-1||i.target.localName==="span"&&i.target.className.indexOf("e-databar")>-1||i.target.localName==="div"&&i.target.className.indexOf("e-cf-databar")>-1||i.target.localName==="span"&&i.target.className.indexOf("e-iconsetspan")>-1)&&(this._clkCellObj=this._getCellIdx(n(i.target).closest("td")[0])),i.target.tagName==="DIV"&&i.target.id.indexOf("_Merge")>-1&&(this._clkCellObj=this._getCellIdx(i.target.parentElement)),this._isExport||!this.model.cellClick)return!1;var u,f=i.target,s=this.getActiveSheetIndex(),r,e,o;if(i.target.tagName==="TD"&&n(i.target).parents("div")[0].className.indexOf("e-content")>-1&&i.target.className.indexOf("e-rowcell")>-1&&n(i.target).find(".e-chk-image").length<1){if(r=f.cellIndex,e=n.inArray(n(f).closest("tr").get(0),this.getRows(s)[1]),o=this.getSheet(s).columns[r],u={columnName:o.field,value:this.XLEdit.getPropertyValue(e,r),columnIndex:r,rowIndex:e,columnObject:o,cell:f,eventArgs:i,event:i,target:i.target},this.isFormula(u.value)&&(u.calcValue=this.XLEdit.getPropertyValue(e,r,"calcValue")),this._trigger("cellClick",u))return!1}else if(!t.isNullOrUndefined(n(i.target).parents("div"))&&n(i.target).parents("div")[0].className.indexOf("e-content")>-1&&(i.target.className.indexOf("e-rowcell")>-1||i.target.parentElement.className.indexOf("e-rowcell")>-1)&&n(i.target).find(".e-chk-image").length<1&&(f=n(i.target).parents("td").get(0),!t.isNullOrUndefined(f)&&(r=f.cellIndex,e=n.inArray(n(f).closest("tr").get(0),this.getRows(s)[1]),o=this.getSheet(s).columns[r],u={columnName:o.field,value:this.XLEdit.getPropertyValue(e,r),columnIndex:r,rowIndex:e,columnObject:o,cell:f,eventArgs:i,event:i,target:i.target},this.isFormula(u.value)&&(u.calcValue=this.XLEdit.getPropertyValue(e,r,"calcValue")),this._trigger("cellClick",u))))return!1}},_wireEvents:function(t){var i=this.element,r=this._id;this.model.enableTouch&&t=="_on"&&parseInt(this._browserDetails.version)>8?this._wireTouchEvts("_on"):this._wireTouchEvts("_off");this[t](i,"mousedown",".e-spreadsheetcontentcontainer .e-content, .e-spreadsheetrowheader, .e-spreadsheetheader, .e-spreadsheetactpanel, .e-ribbon, .e-spreadsheetcontentcontainer .e-vscroll, .e-spreadsheetcontentcontainer .e-hscroll",this._mouseDownHandler);this[t](i,"mousemove",this._mouseMoveHandler);this[t](i,"mouseup",this._mouseUpHandler);this[t](i,"keydown",this._keyDownHandler);this[t](i,"keyup",this._keyUpHandler);this[t](i,"click",".e-spreadsheetcontentcontainer .e-content,.e-spreadsheetrowheader,.e-spreadsheetheader,.e-spreadsheetactpanel, .e-ss-object, .e-ss-sparkline",this._clickHandler);this[t](i,n.isFunction(n.fn.doubletap)&&this.model.enableTouch&&parseInt(this._browserDetails.version)>8&&!this._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",".e-spreadsheetcontentcontainer, .e-spreadsheetheader, .e-spreadsheetrowheader, .e-numericcontainer .e-numericitem, .e-ss-sparkline, .e-cf-databar",this._dblClickHandler);this[t](i,"mouseleave",".e-spreadsheetrowheader, .e-spreadsheetheader, .e-viewhdrlbl, .e-vheading, .e-viewlinlbl, .e-vgridlines",this._mouseLeaveHandler);this[t](i,"mouseover",".e-spreadsheetcontentcontainer .e-content .e-rowcell, .e-viewhdrlbl, .e-vheading, .e-viewlinlbl, .e-vgridlines, .e-rowheadercontent, .e-vscrollbar, .e-hscrollbar, .e-spreadsheetfooter, .e-spreadsheetheader",this._mouseHoverHandler);this.model.allowFormulaBar&&this.XLEdit&&this[t](this._getInputBox(),"input",this.XLEdit._formulaBoxInputChange);this[t](n(".e-ss-"+r+".e-chartcell"),"click",this._chartClickHandler);this[t](n("#"+r+"_cellstyles"),"click",this._cellStyleClick);this[t](n("#"+r+"_formatastable"),"click",this._formatAsTableClick);this[t](n("#"+r+"_nmuseinformula"),"click",".e-nmuseinformularow",this._useInFormulaClick);this[t](n("#"+r+"_AddSheet"),"click",this._spreadsheetPagerCustomBtnHandler);this.model.scrollSettings.allowScrolling&&this.XLScroll&&this[t](this.element.find(".e-spreadsheet-list"),"mousewheel DOMMouseScroll",n.proxy(this.XLScroll._spreadMouseWheel,this.XLScroll));this.model.scrollSettings.isResponsive&&this[t](n(window),"resize",n.proxy(this._resizeHandler,this))},_wireTouchEvts:function(n){(this._browserDetails.name!="msie"||["11.0","10.0"].indexOf(this._browserDetails.version)===-1)&&this[n](this.element,this._getBrowserEvt(),".e-spreadsheetcontentcontainer .e-content, .e-spreadsheetrowheader, .e-spreadsheetheader, .e-spreadsheetactpanel, .e-ribbon, .e-spreadsheetcontentcontainer .e-vscroll, .e-spreadsheetcontentcontainer .e-hscroll",this._mouseDownHandler);this[n](this.element,this._getBrowserEvt("move"),this._mouseMoveHandler);this[n](this.element,this._getBrowserEvt("end"),this._mouseUpHandler);this[n](this.element,"swipeleft swiperight",".e-spreadsheetfooter",this._swipeHandler)},_getBrowserEvt:function(n,t){return n==="move"?this._browserDetails.isMSPointerEnabled?this._browserDetails.pointerEnabled?"pointermove":"MSPointerMove":t?"mousemove":"touchmove":n==="end"?this._browserDetails.isMSPointerEnabled?this._browserDetails.pointerEnabled?"pointerup":"MSPointerUp":t?"mouseup":"touchend":this._browserDetails.isMSPointerEnabled?this._browserDetails.pointerEnabled?"pointerdown":"MSPointerDown":"touchstart"},_swipeHandler:function(n){var t=this.getActiveSheetIndex();this.gotoPage(n.type==="swiperight"?--t:++t)},_isTouchEvent:function(n){return this.model.enableTouch&&(n.type.indexOf("touch")>-1||n.type.indexOf("pointer")>-1)&&n.originalEvent.pointerType!=="mouse"&&n.originalEvent.pointerType!==4?!0:!1},_getOriginalEvt:function(n){return n.originalEvent.changedTouches?n.originalEvent.changedTouches[0]:n.originalEvent},_allChartType:function(t){n("#"+this._id+"_allchart").find(".e-chartimg").removeClass("e-chartselect");n(t.target).addClass("e-chartselect")},refreshSpreadsheet:function(){this._responsiveHeight>350&&(this._refreshSheetonResize(),this.model.showRibbon&&n("#"+this._id+"_Ribbon").data("ejRibbon")._ribbonResize())},_databarItemClick:function(t){var i=n("#"+this._id+"_Ribbon_Home_Styles_ConditionalFormatting"),r;if(t.target.id.indexOf("databar")>-1||t.target.id.indexOf("colorscale")>-1)cfColor=t.target.id.indexOf("databar")>-1?t.target.id.split("databar").join(""):t.target.id.split("colorscale").join(""),this.XLCFormat._cFormat(t.target.id,null,null,cfColor),i.length&&i.data("ejSplitButton")._hidePopup();else if(t.target.classList.contains("e-ss-iconsets-wrapper")||t.target.id==""){var u=t.target.id==""?t.target.parentElement.children:t.target.children,f=[],e=u.length;if(e!=3)return;for(r=0;r<e;r++)f.push(u[r].classList[0].split("e-ss-").join(""));this.XLCFormat._cFormat("iconset",null,null,f.toString());i.length&&i.data("ejSplitButton")._hidePopup();n("#"+this._id+"_CFormat").hide()}},refresh:function(){this._isRefresh=!0;this._destroy();for(var n=1;n<=this.model.sheetCount;n++)this.model.sheets[n]._isLoaded=!1;this.addClass(this.element[0],this._rootCSS+" e-js");this._init();this._isRefresh=!1},_resizeHandler:function(){var t,n=this;n.element.is(":hidden")||(t&&clearTimeout(t),t=setTimeout(function(){n._refreshSheetonResize();for(var t=1,i=n.model.sheets.length;t<i;t++)n.getSheet(t)._isResized=t!=n.getActiveSheetIndex()},100))},_refreshSheetonResize:function(){var l,a,i=this.getActiveSheetIndex(),f,v=n(".e-ddl-popup:visible[id^="+this._id+"]"),o=n("#"+this._id+"_inputbox_suggestion"),r,u,s,y,d=this._phoneMode,p,w=n(".e-ss-colorpicker:visible[id^="+this._id+"]"),b=n(".e-menu:visible[id^="+this._id+"]"),h,c,e,k;if(this._resizeColl[i-1]=this._isResized=!0,this.element.find(".e-inputbox").hide(),t.isNullOrUndefined(this._getFormulaSuggElem())||(this._isFormulaSuggestion=!1,this._getFormulaSuggElem().hide()),t.isNullOrUndefined(o[0])||o[0].style.display!="block"||(this._isFormulaSuggestion=!1,o.hide()),this.model.enablePivotTable&&this.hideActivationPanel(),this._phoneMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth<420,this._tabMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth>419&&document.documentElement.clientWidth<617,f={width:this._responsiveWidth,height:this._responsiveHeight},this.model.showRibbon&&(this._tabMode||this._responsiveHeight<280)&&n("#"+this._id+"_Ribbon").ejRibbon("collapse"),p=this.getSheet(i),p._virtualRowIdx=[],this._refreshSheetWithScreen(i),this._updateResponsiveSettings(),this._initViewPort(i),this.refreshContent(i),f.width=this._responsiveWidth,f.height=this._responsiveHeight,this._setSheetWidthHeight(i,f,null,"refresh"),l=this._getContTBody(i).find("tr"),a=this._getRowHdrTBody(i).find("tr"),this.setRows([a,l],i),this._dlgWidth=this._phoneMode||this._tabMode||this._responsiveWidth<350?this._responsiveWidth-2:this._responsiveWidth/1.5,this._dlgHeight=this._phoneMode||this._tabMode||this._responsiveHeight<350?this._responsiveHeight-2:this._responsiveHeight/1.2,this.model._isActPanelVisible&&this._refreshActivationPanel(),this.element.find(".e-inputbox").show(),this.model.showPager&&(this._isSheetRename&&(s=this.getPager().find("#"+this._id+"_Sheet_RenamePanel"),y=s.val(),s.remove()),this._refreshSpreadSheetPager(!0),this._isSheetRename&&this._renameSheet(y)),this._phoneMode&&(n("#"+this._id+"_CFormat").css("width",""),n("#"+this._id+"_Ribbon_Border").css("width",""),n("#"+this._id+"_indexbox").css({"text-overflow":"ellipsis",overflow:"hidden"})),this.model.showRibbon&&(this.XLRibbon._refreshBackstageHeight(),this._phoneMode&&!d&&this.XLRibbon._hideRibbonElem()),v.length&&(r=v[0].id.split("_",5).join("_"),r.length&&(u=n("#"+r),u.hasClass("e-dropdownlist")&&u.ejDropDownList("hidePopup"))),b.length&&(r=b[0].id.split("_",5).join("_"),r.length&&(u=n("#"+r),u.hasClass("e-split")&&u.hide())),w.length&&(r=w[0].id.split("_",5).join("_"),r.length&&(u=n("#"+r),u.hasClass("e-colorpicker")&&u.ejColorPicker("hide"))),this._isResized=!1,this._isRibbonDestroyed){if(h=n("#"+this._id+"_Ribbon").ejRibbon("instance"),this.model.ribbonSettings.enableOnDemand)this.XLRibbon._createTabControls(h.getTabText(h.model.selectedItemIndex));else if(this.model.showRibbon)for(c=[this._getLocStr("HOME"),this._getLocStr("DATATAB"),this._getLocStr("PAGELAYOUT"),this._getLocStr("OTHERS")],e=0,k=c.length;e<k;e++)this.XLRibbon._updateRibCustomCss(c[e]);this._on(n(".e-ss-"+this._id+".e-chartcell"),"click",this._chartClickHandler);this._on(n("#"+this._id+"_cellstyles"),"click",this._cellStyleClick);this._on(n("#"+this._id+"_formatastable"),"click",this._formatAsTableClick)}this._isRibbonDestroyed=!1;this._trigger("refresh")},_chartClickHandler:function(t){var i=n(t.target),r=n.extend(!0,{},n(t.target).data());i.parents().eq(1).hide();this.XLChart.createChart(null,r)},_useInFormulaClick:function(t){var i,r,s="=",h=!1,u=t.target.textContent,l=this.getActiveSheetIndex(),e=this.getActiveCell(l),o=this.XLEdit._editElem,c=o.text(),f;if(f=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"mergeIdx"),this._intrnlReq=!0,this.XLEdit.editCell(f?f.rowIndex:e.rowIndex,f?f.colIndex:e.colIndex,!0),this._intrnlReq=!1,c===s)o.text(s+u);else{if(r=this.XLDragFill._parseFormula(c),i=r.length,i){while(i--)if(r[i]===","||r[i]==="("){r.splice(i+1,0,u);h=!0;break}else if(this._isCellReference(r[i])||this.isNumber(r[i])){r[i]=u;h=!0;break}u=h?r.join(""):u}o.text(s+u)}o.focusEnd();n("#"+this._id+"_nmuseinformula").hide()},_formatAsTableClick:function(t){var u,f,i=t.target,e=this.getActiveSheetIndex(),o=this.getSheet(e),r=o._selectedCells;r.length!==0&&(i.parentNode.className==="e-formatastablecell"&&(u=this.XLEdit.getPropertyValue(r[0].rowIndex,r[0].colIndex,"tableName",e),this._showDialog(this._id+"_Ribbon_Insert_Tables_Table"),u?(this.XLFormat._formatAsTableStyle=this._FATStyles[i.parentNode.id.replace(/ /g,"")],this.XLFormat._createTable(this._getTableID(u),this.XLFormat._formatAsTableStyle)):r.length>1?(f=n("#"+this._id+"_fatname"),n("#"+this._id+"_fatnamedlg").ejDialog("open"),n("#"+this._id+"_fatheader").data("ejCheckBox").option("checked",!1),f.val("Table"+this._tableCnt).focus().setInputPos(f.val().length),this.model.allowCellFormatting&&(this.XLFormat._formatAsTableStyle=this._FATStyles[i.parentNode.id.replace(/ /g,"")])):this._showAlertDlg("Alert","FormatAsTableAlert",null,445)),(i.className.indexOf("back")>-1||i.parentNode.className==="e-formatastablecell")&&n("#"+this._id+"_Ribbon_Home_Styles_FormatAsTable").length&&n("#"+this._id+"_Ribbon_Home_Styles_FormatAsTable").data("ejSplitButton")._hidePopup())},_borderSelectionClick:function(t){var u,r={ID:t.target.parentNode.id},f,e=t.target,o=this.getActiveSheetIndex(),i=this.getSheet(o)._selectedCells;i.length!==0&&(this._borderStyles.indexOf(r.ID)>-1&&this.XLRibbon._updateBordeStyle(r),u=this._borderColor||"#000000",f=this._getAlphaRange(o,i[0].rowIndex,i[0].colIndex,i[i.length-1].rowIndex,i[i.length-1].colIndex),this.model.allowSelection&&(this.XLSelection._isOutsideBordering||this.XLSelection._isGridBordering)?!(this._borderStyles.indexOf(r.ID)>-1)&&r.ID.indexOf("bordercolor")<0&&(this.XLSelection._isOutsideBordering=this.XLSelection._isGridBordering=!1):this.setBorder({type:r.ID,color:u,style:this._borderStyle},f),(e.className.indexOf("back")>-1||e.parentNode.className==="e-bordercell")&&n("#"+this._id+"_bordercontainer").hide())},_getTableID:function(n,t){var i,r=this.getSheet(this.getActiveSheetIndex()).tableManager;if(t){for(i in r)if(t===r[i].name)return Number(i)}else for(i in r)if(n.indexOf("e-table"+i)>-1)return Number(i)},_cellStyleClick:function(i){var r=this.model.sheets[this.getActiveSheetIndex()].selectedRange,u=i.target.className,f=i.target.innerHTML,c=this.XLFormat.getFormatClass(u),e=this._dataContainer,h={range:r,sheetIdx:this.getActiveSheetIndex(),reqType:"cell-styles",type:"actionBegin",action:i.target.innerHTML},o,s;this._trigActionBegin(h)||(r=h.range,o={range:r,sheetIndex:this.getActiveSheetIndex(),reqType:"cell-styles",opr:i.target.innerHTML,beforeFormat:this.getRangeData({range:r,property:["format","formats"]})},u.indexOf("e-cellstylecell")>-1&&t.isNullOrUndefined(e.customCellStyle[f])&&this.XLFormat.updateUniqueFormat(c,r,i.target.innerHTML),u.indexOf("e-cellstylecell")>-1&&!t.isNullOrUndefined(e.customCellStyle[f])&&(s={style:e.customCellStyle[f].style},n.extend(s,e.customCellStyle[f].NumFormat),this.XLFormat.format(s)),u.indexOf("e-cellstylecell")>-1&&f===this._getLocStr("NewCellStyle")&&this._showDialog(this._id+"_CustomCellDialog"),(u.indexOf("e-cellstylecell")>-1||u.indexOf("back")>-1)&&n("#"+this._id+"_Ribbon_Home_Styles_CellStyles").length&&n("#"+this._id+"_Ribbon_Home_Styles_CellStyles").data("ejSplitButton")._hidePopup(),o.afterFormat=this.getRangeData({range:r,property:["format","formats"]}),this.isUndoRedo||(this._completeAction(o),this._trigActionComplete(o)),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons())},_mouseHoverHandler:function(t){var i=t.target,r;t.target.localName!="svg"&&t.target.localName!=="rect"&&t.target.localName!=="path"&&(this._hasClass(t.target,"e-viewhdrlbl")||this._hasClass(t.target,"e-vheading")?this.element.find(".e-vheading .e-chk-act, .e-vheading .e-chk-inact").addClass("e-chkhover"):this._hasClass(t.target,"e-viewlinlbl")||this._hasClass(t.target,"e-vgridlines")?this.element.find(".e-vgridlines .e-chk-act, .e-vgridlines .e-chk-inact").addClass("e-chkhover"):this.model.allowDragAndDrop&&this.XLDragDrop._allowDragAndDrop&&(n(t.target).parents(".e-vscrollbar").length>0||t.target.className.indexOf("e-rowheader")>-1||n(t.target).parents(".e-spreadsheetfooter").length>0||t.target.className.indexOf("e-headercell")>-1||t.target.className.indexOf("e-spreadsheetfooter")>-1||n(t.target).parents(".e-hscrollbar").length>0||this.getSheet()._isFreezed&&t.target.className.indexOf("e-rowcell")>-1)?this.XLDragDrop._scrollHover(t):this._hasClass(t.target,"e-rowcell")&&(r=this._getCellIdx(i),this._trigger("cellHover",{target:i,event:t,cellIndex:r})))},_mouseDownHandler:function(i){var o,v,tt,it,f,h,c,rt,ut,ft,et=!0,k=!0,l="e-ss-sparkline",d="e-ss-object",a="e-ss-pivot",r=i.target,u=n(r),s=this.getActiveSheetIndex(),g=this.getSheet(s),e=n("#"+this._id+"_Ribbon").data("ejRibbon"),y,nt,p,ot,w,st,b;if(i.currentTarget.className.indexOf("e-ribbon")<0&&this.element.find(".e-bordercontainer").hide(),this.element.find("#"+this._id+"ddl_popup").has(r).length)return!1;if(this._isTouchEvt=this._isTouchEvent(i),this._isTouchEvt&&(this._touchArgs=i,this._startXY=this._setXY(i,navigator.userAgent.indexOf("WebKit")>-1),this.model.allowDragAndDrop&&this.XLDragDrop._dragtouch(this._startXY[0],this._startXY[1]),!this._hasClass(r,"e-autofill")&&this.model.allowAutoFill&&(tt=this._hasClass(r,"e-headercell")?10:20,o=this._setXY(i),v=o[1],o=o[0],o=Math.abs(o-this.getAutoFillElem().offset().left),v=Math.abs(v-this.getAutoFillElem().offset().top),o<=tt&&o>=0&&v<=tt&&v>=0&&(u=this.getAutoFillElem(),r=i.target=u[0]))),u.parents(".e-ribbon").length||u.parents(".e-vscroll").length||u.parents(".e-hscroll").length)this._excelFilter&&(this.XLFilter._isSearchEdit=!1,this._excelFilter.closeXFDialog());else if(this._hasClass(r,"e-ssddl"))this._ddlopen(i);else{if(i.target=this._changeTargetWithOffset(i),this.model.allowCharts&&g._isChartBorderDrawn&&this.XLChart._clearChartRange(this._arrayAsString(this._chartBorder)),this.model.allowSparkline&&g._isSparklineBorder&&this.XLSparkline._clearSparkline(this._arrayAsString(this._chartBorder)),(this.model.pictureSettings.allowPictures||this.model.allowCharts)&&(u.hasClass(d)||n(u).parents("."+d).length))u.hasClass(d)||(r=i.target=n(u).parents("."+d)[0]),this.XLShape._shapeMouseDown(i);else if(this.model.allowSparkline&&(u.hasClass(l)||n(u).parents("."+l).length))for(u.hasClass(l)||(k=!1),(r.localName=="svg"||r.localName=="rect"||r.localName=="path")&&(this.sparkDiv=n(u).parents("."+l)[0]||u[0]),y=this._getCellIdx(n(this.sparkDiv).closest("td")[0]),this.model.showRibbon&&this.model.allowSparkline&&(this.sparkDiv.id.indexOf("Line")>-1||this.sparkDiv.id.indexOf("Area")>-1||this.sparkDiv.id.indexOf("Pie")>-1||this.sparkDiv.id.indexOf("Column")>-1||this.sparkDiv.id.indexOf("Winloss")>-1)?this.XLSparkline._sparklineDesignTabUpdate(this.sparkDiv.id):this.model.showRibbon&&this.model.allowSparkline&&(e.model.selectedItemIndex===this.XLRibbon._getTabIndex("sparklinedesign")||e.isVisible(this._getLocStr("SPARKLINEDESIGN")))&&this.XLSparkline._toggleSparklineDesignTab(),r=i.target=this.sparkDiv,this.performSelection({rowIndex:y.rowIndex,colIndex:y.colIndex},{rowIndex:y.rowIndex,colIndex:y.colIndex}),this.XLShape._shapeType="sparkline",l=this.getSheet(this.getActiveSheetIndex()).shapeMngr.sparkline,nt=this.getObjectKeys(l),w=0,st=nt.length;w<st;w++)nt[w]==r.id&&(ot=l[nt[w]],p=this.getRangeIndices(ot.DataRange),this.XLSelection._focusBorder({rowIndex:p[0],colIndex:p[1]},{rowIndex:p[2],colIndex:p[3]},["e-bcborderright","e-bcborderbottom"]),this.getSheet(this.getActiveSheetIndex())._isSparklineBorder=!0);else k=!1,this.XLShape._shapeROStart&&this.XLShape._shapeRSStart||this._getContent(s).find(".e-ss-activeimg").removeClass("e-ss-activeimg e-ss-imgcresize e-ss-imgrresize");if((u.hasClass("e-cf-databar")||u.hasClass("e-databar")||u.hasClass("e-databar-value")||u.hasClass("e-iconsetspan"))&&(k=!1,b=this._getCellIdx(n(u).closest("td")[0]),r=n(u).closest("td")[0],i.target=u[0],this.performSelection({rowIndex:b.rowIndex,colIndex:b.colIndex},{rowIndex:b.rowIndex,colIndex:b.colIndex})),(r.nodeName==="TD"||r.nodeName==="TH")&&(this.XLRibbon._isPanelVisible=!1),this.model.enablePivotTable&&(this._isPvtNameEdit&&(this._isPvtNameEdit=!1,this.XLPivot._changePvtName()),u.hasClass(a)||u.parents("."+a).length?(u.hasClass(a)||(r=i.target=u.parents("."+a)[0]),this.XLPivot._pivotMouseDown(i)):u.parents(".e-ss-pivotfield").length||u.hasClass("e-ss-pivotfield")||u.hasClass("e-vhandle")||u.hasClass("e-hhandle")||u.css("cursor")==="col-resize"||(this.hideActivationPanel(),this.getSheetElement(s).find(".e-ss-activepivot").removeClass("e-ss-activepivot"))),rt=r.className,r.id.indexOf("picture")===-1&&this.model.showRibbon&&(e.model.selectedItemIndex===this.XLRibbon._getTabIndex("format")||e.isVisible(this._getLocStr("FORMAT")))&&this.XLRibbon._toggleFormatTab(),this.model.showRibbon&&r.id.indexOf("chart")>-1?this.XLRibbon._chartDesignTabUpdate(n(r)):this.model.showRibbon&&(e.model.selectedItemIndex===this.XLRibbon._getTabIndex("cdesign")||e.isVisible(this._getLocStr("CHARTDESIGN")))&&this.XLRibbon._toggleChartDesignTab(),this.model.showRibbon&&this.model.allowSparkline&&(r.id.indexOf("Line")>-1||r.id.indexOf("Area")>-1||r.id.indexOf("Pie")>-1||r.id.indexOf("Column")>-1||r.id.indexOf("Winloss")>-1)?this.XLSparkline._sparklineDesignTabUpdate(this.sparkDiv.id):this.model.showRibbon&&this.model.allowSparkline&&(e.model.selectedItemIndex===this.XLRibbon._getTabIndex("sparklinedesign")||e.isVisible(this._getLocStr("SPARKLINEDESIGN")))&&this.XLSparkline._toggleSparklineDesignTab(),this.XLEdit._isEdit&&r.nodeName!="TD"&&!this._hasClass(r,"e-autofill"))return;if(this.model.allowDragAndDrop&&this.XLDragDrop._isDragAndDropStart&&rt!=="e-autofill"&&rt.indexOf("e-filterspan")<0&&this.XLDragDrop._dMouseDown(i),this.model.allowResizing&&!this.XLEdit._isEdit&&(n(r).hasClass("e-headercelldiv")||n(r).hasClass("e-headercell")?this.XLResize._headerMouseDown(i):n(r).hasClass("e-rowheader")?this.XLResize._rowMouseDown(i):(n(r).hasClass("e-spreadsheetactpanel")||n(r).parents(".e-spreadsheetactpanel").length)&&this.XLResize._apMouseDown(i)),n(r).parents("div.e-spreadsheetactpanel").length>0)return;if(this.model.allowEditing&&this.XLEdit._isEdit&&this.XLEdit._editElem.html()==="="&&(this._isFormulaSuggestion=!1,this.XLEdit._isFormulaEdit=!0),et=this.XLEdit._isEdit?(this._isFormulaSuggestion||!this.XLEdit._isFormulaEdit)&&this.XLEdit.saveCell():!0,!et&&!this.XLEdit._isFormulaEdit)return!1;this.model.allowComments&&!u.hasClass("e-pager")&&this.getSheetElement(s).find(".e-commentcell").length&&this.XLComment._commentMouseDownHandler(i);r.tagName!=="SPAN"&&r.tagName!=="A"||t.isNullOrUndefined(u.parent("td")[0])?r.tagName==="TD"&&this._hasClass(r,"e-rowcell")?(h=r,f=this._getCellIdx(h),this.model.showRibbon&&this.XLRibbon.updateRibbonIcons()):f=this.getActiveCell():(h=u.parent("td")[0],f=this._getCellIdx(h));r.tagName==="A"?(g._activeCell=f,this.model.allowSelection&&(this.XLSelection.selectRange(f,f),this.XLDragFill&&this.XLDragFill.positionAutoFillElement()),i.which!==3&&this._hlClick(this.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"hyperlink",s))):(i.button!==2||i.which!==3||this.getSheetElement(s).find(".e-selected, .e-colselected .e-headercelldiv, .e-rowselected").index(r)===-1)&&this.model.allowSelection&&!k&&(t.isNullOrUndefined(this.XLDragDrop)||!this.XLDragDrop._allowDragAndDrop)&&(this.XLResize&&this.XLResize._resizeStart||u.hasClass("e-comment-txtarea")||u.hasClass(a)||n(u).parents("."+a).length||this.XLSelection._selectionMouseDownHandler(i));this._filterClose(i.target);this._undoInputobj={};r.tagName!=="TD"||t.isNullOrUndefined(n(r).parents("div")[0])||n(r).parents("div")[0].className!=="e-content"||this.displayActivationPanel(this.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"range"));r.tagName==="TD"&&r.className.indexOf("e-rowheader")<0&&(t.isNullOrUndefined(this._ddlCell)||(this.element.find("#"+this._id+"ddl").ejDropDownList("hidePopup"),this.element.find("#"+this._id+"ddlspan").remove(),this._ddlCell=null));r.tagName==="TD"&&this._hasClass(r,"e-rowcell")&&(ft=this._getCellIdx(r),t.isNullOrUndefined(this.XLEdit.getPropertyValue(ft.rowIndex,ft.colIndex,"rule",s))||this._setddlCell(i));this.model.showRibbon&&this.model.allowSparkline&&r.id.indexOf("sparkline")>-1&&this.XLSparkline._sparklineDesignTabUpdate(this.sparkDiv.id);this._isTableRename&&(this.XLFormat._renameTable(this._tableClassName),this._isTableRename=!1);this._isSheetRename&&this._updateSheetNames(null,!1);this.element.find("#"+this._id+"ddl").ejDropDownList("hidePopup");this._hasClass(r,"e-rowcell")&&(ut=this.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"tableName",s));ut?(it=this._getTableID(ut),this.isNumber(it)&&this.XLRibbon._designTabUpdate(it,f)):this.model.showRibbon&&(e.model.selectedItemIndex===this.XLRibbon._getTabIndex("design")||e.isVisible(this._getLocStr("Design")))&&this.XLRibbon._toggleDesignTab(f);this.model.allowEditing&&(h=g._activeCell,this.XLEdit._isEdit&&i.target.id!==this._id+"_inputbox"&&(c=n(i.target).hasClass("e-ss-input")||!this.XLEdit._isFBarFocused?this.element.find("#"+this._id+"_Edit"):this._getInputBox(),c&&(i.target.id!==c[0].id&&c.focus().setInputPos(c[0].selectionStart,c[0].selectionEnd),c.hasClass("e-ss-input")&&(this.XLEdit._isFBarFocused=!1))),this.model.allowComments&&this.XLComment._isCommentEdit||this._isSheetRename||i.target.id!==this._id+"_inputbox"||(i.target.readOnly?this._setSheetFocus():(this.XLEdit._isEdit||this.XLEdit.editCell(h.rowIndex,h.colIndex,!0),this._getInputBox().focus(),this.XLEdit._isFBarFocused=!0)))}},_renderDDownList:function(){n("#"+this._id+"ddl").length<1&&this.element.append(t.buildTag("input.e-"+this._id+"-ddl","","",{id:this._id+"ddl",style:"display:none"}));n("#"+this._id+"ddl").ejDropDownList({fields:{id:"Types",text:"text",value:"text"},beforePopupShown:n.proxy(this._drppopupshow,this),cssClass:"e-"+this._id+"-ddl e-ss-ddlwrap",width:.1,height:.1,change:n.proxy(this._changeddl,this)});n(document.body).append(n("#"+this._id+"ddl_popup_wrapper"))},_setddlCell:function(i){var r,p,a,g,u=[],h=[],w,nt=[],tt,l,f,b,k=this.getActiveSheetIndex(),it,d,rt=this.getCalcEngine().getNamedRanges(),v,e,o,y,s,c;if((t.isNullOrUndefined(i)||i.type!=="mousedown"?(f=this.getActiveCell(),b=n("#"+this._id+"GroupPanel").find("div.e-content")[0]):(w=n(i.target).parents("td"),(i.target.classList[0].indexOf("databar")>-1||i.target.classList.contains("e-iconsetspan"))&&(i.target=w&&w[0]),f=this._getCellIdx(i.target),b=i.currentTarget),l=this.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"rule",k),l)&&(tt=l.customVal.split("_"),l&&tt.indexOf("list")>0)){if(this._ddlCell=f,e=l.customVal.split("_list")[0],o=[],e.startsWith("=")&&e.indexOf(",")<0){for(u=n.trim(e.replace("=","")),v=rt.getItem(u.toUpperCase()),v&&(u=v),u.indexOf("!")>-1&&(y=u.split("!"),k=v?this._getSheetIdxFromSheetValue(y[0]):this._getSheetIndexByName(y[0]),u=y[1]),u.indexOf("$")>-1&&(u=u.split("$").join("")),u.indexOf(":")<0&&(u=u+":"+u),g=this.getRangeIndices(u),s=this._getMultiRangeCells(g),c=this.getRangeData({range:[s[0].rowIndex,s[0].colIndex,s[s.length-1].rowIndex,s[s.length-1].colIndex],property:["value","value2"],sheetIdx:k}),r=0,a=c.length;r<a;r++)t.isNullOrUndefined(c[r].value)||t.isNullOrUndefined(c[r].value2)?(o.push(""),h.push("")):(o.push(c[r].value),h.push(c[r].value2));o.length||(o.push(e),h.push(e))}else e.indexOf(",")>-1?h=o=e.split(","):(o=[],o.push(e),h.push(e));for(r=0,a=o.length;r<a;r++)nt[r]={id:r+1,text:h[r],value:o[r]};f=this.getCell(f.rowIndex,f.colIndex);f&&(p={top:f[0].offsetTop,left:f[0].offsetLeft},b.insertAdjacentHTML("beforeEnd","<span id='"+this._id+"ddlspan' class='e-icon e-ssddl e-spanddl e-ddlspan' role='button'><\/span>"),d=n("#"+this._id+"ddlspan"),it=f.height()-(d.height()+3),d.css({top:p.top+it,left:p.left+f.width()+3}),n("#"+this._id+"ddl").ejDropDownList("option","dataSource",nt))}},_drppopupshow:function(){if(this._ddlCell){var t=this.getCell(this._ddlCell.rowIndex,this._ddlCell.colIndex);n("#"+this._id+"ddl_popup").css({width:this.getActiveCellElem().width()+20,"font-size":"11",top:t.position().top,left:t.position().left})}},_ddlPosition:function(){if(this._ddlCell){var i,t=this.getCell(this._ddlCell.rowIndex,this._ddlCell.colIndex),r={top:t[0].offsetTop,left:t[0].offsetLeft};i=n("#"+this._id+"ddlspan");i.css({top:r.top+t.height()-(i.height()+3),left:r.left+t.width()+3})}},_changeddl:function(n){if(this._ddlCell&&this.model.allowEditing){var i=this.getActiveCell(),u=n.model.dataSource[n.itemId].value,r=this.XLEdit.getPropertyValue(i.rowIndex,i.colIndex),t={cellIndex:i,value:u,prevValue:r,sheetIdx:this.getActiveSheetIndex(),reqType:"list-value"};if(this._trigger("cellSave",t))return;this.XLEdit._updateCellValue(t.cellIndex,t.value);this.getActiveCellElem().hasClass("e-hlcell")&&this.XLValidate.highlightInvalidData();this._trigrDdlActnCmplt(t.value,r,n.itemId);this.model.allowFormulaBar&&this.updateFormulaBar()}},_trigrDdlActnCmplt:function(n,t,i){if(this.model.actionComplete!==null){var o,r,h=this.getActiveCell(),l=this.getActiveSheetIndex(),c,u,f,e,a,s,v;if(c=this.XLEdit.getPropertyValue(h.rowIndex,h.colIndex,"rule",l),u={reqType:"edit",sheetIndex:l,currValue:n,prevValue:t,rowIndex:h.rowIndex,colIndex:h.colIndex,hasValidation:!0,rule:c,isRefreshVal:!1,isDropDownAction:!0},!this._trigActionBegin(u)){if(c.type=="list"&&n!==""&&(f=c.customVal.split("_")[0],f[0]=="="&&f.indexOf(",")<0)){if(u.isRefrsVal=!0,f=f.replace("=",""),e=f.split("!"),u.refrValSheetIdx=e.length==1?l:this._getSheetIndexByName(e[0]),o=e.length==1?e[0]:e[1],o.indexOf("$")>-1&&(o=o.replace(/\$/g,"")),r=this.getRangeIndices(o),this.isUndefined(i))for(a=this.getRangeData({range:r}),v=a.length,s=0;s<v;s++)a[s].value==n&&(i=parseInt(s));u.refrValCellAddr=r[0]===r[2]?this.getAlphaRange(r[0],r[1]+i):this.getAlphaRange(r[0]+i,r[1])}this._trigActionComplete(u)}}},_ddlopen:function(i){var e=this.getActiveSheetIndex(),u=this.getActiveCell(e),o=this.getSheet(e).rowsHeightCollection[u.rowIndex],f,r,s;if(this.XLEdit._isEdit&&this.XLEdit.getPropertyValue(u.rowIndex,u.colIndex,"rule").customVal.split("_")[2]==="true")return!1;this.XLEdit.saveCell();r=n("#"+this._id+"ddl").data("ejDropDownList");s=this.getCell(this._ddlCell.rowIndex,this._ddlCell.colIndex);i.stopPropagation();t.isNullOrUndefined(r)||(r._isPopupShown()?r._hideResult():(r._showResult(),n("#"+this._id+"ddl_popup").css({width:this.getActiveCellElem().width()+20,"font-size":"11",top:20,left:100}),f=this._getXYPos(s,n("#"+this._id+"ddl_popup"),o,0),n("#"+this._id+"ddl_popup_list_wrapper").css({top:f.yPos+o,left:f.xPos})))},_mouseMoveHandler:function(i){i.target=this._changeTargetWithOffset(i);var r=n(i.target),u,f;this._isTouchEvt=this._isTouchEvent(i);this._isTouchEvt&&(i.preventDefault(),u=this._setXY(i,navigator.userAgent.indexOf("WebKit")>-1),this.model.allowDragAndDrop&&this.XLDragDrop._dragtouch(u[0],u[1]));!this.model.allowResizing||!(this.XLResize._resizeType==="Col"||r.hasClass("e-headercelldiv")||r.hasClass("e-headercell")||r.hasClass("e-reSizeColbg"))||this.XLEdit._isEdit||this.XLCMenu&&this.XLCMenu._isMenuOpened?!this.model.allowResizing||!(this.XLResize._resizeType==="Row"||r.hasClass("e-rowheader")||r.hasClass("e-reSizeRowbg"))||this.XLEdit._isEdit||this.XLCMenu&&this.XLCMenu._isMenuOpened?this.model.allowResizing&&(this.XLResize._resizeType==="AP"||r.hasClass("e-spreadsheetactpanel")||r.parents(".e-spreadsheetactpanel").length>0)?this.XLResize._apMouseMove(i):(this.model.pictureSettings.allowPictures||this.model.allowCharts)&&(r.hasClass("e-ss-object")||r.parents(".e-ss-object").length||this.XLShape._shapeROStart||this.XLShape._shapeRSStart||r.hasClass("e-ss-imgvisual"))&&this.XLShape._imgMouseMove(i):this.XLResize._rMouseMove(i):this.XLResize._cMouseMove(i);this.model.allowSelection&&this.model.allowDragAndDrop&&t.spreadsheetFeatures.dragAndDrop&&r.parents(".e-spreadsheetmainpanel").length&&r.hasClass("e-rowcell")&&!this.XLEdit._isEdit&&this._getJSSheetHeader(this.getActiveSheetIndex())[0].querySelector(".e-spreadsheetcolumnheader").className.indexOf("e-sheetselected")===-1&&this.XLDragDrop._dMouseMove(i);this.model.allowComments&&!this.XLComment._isCommentEdit&&this.getSheetElement(this.getActiveSheetIndex()).find(".e-commentcell").length>0&&this.XLComment._commentMouseMove(i);t.isNullOrUndefined(i.target.parentNode)||i.target.id.indexOf("_svg")<0&&this._isString(i.target.parentNode.className)&&i.target.parentNode.className.indexOf("e-content")<0&&!n(i.target).is("td.e-rowcell")&&this.XLShape._shapeMouseUp(i);this._isTouchEvt&&!this._isSelected(i.target)&&!this._isTouchMoveSel&&this._touchArgs&&!this._isUniqueTarget(this._touchArgs,i)&&r.parents(".e-table").length&&r.parents(".e-spreadsheetcontentcontainer").length&&!this.XLDragDrop._allowDragAndDrop&&(f=this._getClientDiff(this._startXY,u),this._scrollContent(f),this._startXY=u,this._touchArgs=i,this._isTouchScroll=!0)},_mouseLeaveHandler:function(t){this._hasClass(t.target,"e-viewhdrlbl")||this._hasClass(t.target,"e-vheading")?this.element.find(".e-vheading .e-chk-act, .e-vheading .e-chk-inact").removeClass("e-chkhover"):this._hasClass(t.target,"e-viewlinlbl")||this._hasClass(t.target,"e-vgridlines")?this.element.find(".e-vgridlines .e-chk-act,.e-vgridlines .e-chk-inact").removeClass("e-chkhover"):this.model.allowResizing&&n(".e-ss-colresize, .e-ss-rowresize").removeClass("e-ss-colresize e-ss-rowresize")},_mouseUpHandler:function(t){var i=n(t.target),u=this.getActiveSheetIndex(),r=this.XLScroll._vScroller(u),f=this.XLScroll._hScroller(u);if(this.model.allowResizing&&(this.XLResize._resizeType==="Col"?this.XLResize._cMouseUp(t):this.XLResize._resizeType==="Row"?this.XLResize._rMouseUp(t):this.XLResize._resizeType==="AP"&&this.XLResize._apMouseUp(t)),this.model.showRibbon&&!this._phoneMode&&this.element.find(".e-ribbonpin").is(":visible")&&n(t.target).parents(".e-ribbon").length<=0&&n("#"+this._id+"_Ribbon").ejRibbon("collapse"),this.model.allowDragAndDrop&&this.XLDragDrop._allowDragAndDrop&&this.XLDragDrop._dMouseUp(t),this.model.allowComments&&this.XLComment._isCommentEdit&&this.getActiveCellElem().find("textarea").focus(),this._isSheetRename&&n("#"+this._id+"_Sheet_RenamePanel").focus(),this.model.pictureSettings.allowPictures&&this.XLShape._shapeMouseUp(t),this.model.enablePivotTable&&this.XLPivot._pivotMouseUp(t),this._hasClass(i[0],"e-vhandle")||this._hasClass(i[0],"e-vhandlespace")||this._hasClass(i[0],"e-vup")||this._hasClass(i[0],"e-vdown")){this._trigger("scrollStop",{scrollData:r._scrollData,position:r.model.value,reqType:"vertical"});return}if(this._hasClass(i[0],"e-hhandle")||this._hasClass(i[0],"e-hhandlespace")||this._hasClass(i[0],"e-hdown")||this._hasClass(i[0],"e-hup")){this._trigger("scrollStop",{scrollData:r._scrollData,position:f.model.value,reqType:"horizontal"});return}},_scrollContent:function(n,i){var r,u,e=this.getActiveSheetIndex(),f=this.getSheet(e);n.x&&(r=i?n.x:f._scrollLeft+n.x,u=this.XLScroll._hScroller(e),r<0?r=0:this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?n.x>0&&u.model.maximum<r+u._scrollData.handle&&(r=u.model.maximum):u._scrollData.step=n.x<0?-1:1,f._scrollLeft!=r&&u.scroll(r));n.y&&(r=i?n.y:f._scrollTop+n.y,u=this.XLScroll._vScroller(e),r<0?r=0:this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?n.y>0&&u.model.maximum<r&&(r=u.model.maximum):u._scrollData.step=n.y<0?-1:1,(r||f._scrollTop!=r)&&u.scroll(r))},_keyDownHandler:function(i){var y,o,p,w,f,it=!0,b=!1,e=this.getActiveSheetIndex(),u=this.element.find("#"+this._id+"_AutoComplete").data("ejAutocomplete"),rt=n("#"+this._id+"_Ribbon").data("ejRibbon"),k=this.getSheet(e),r=k._activeCell,s,l,a,h,v,d,c,g,ut,ft,nt,tt;if(!this._trigger("keyDown",{event:i,isEdit:this.model.allowEditing&&this.XLEdit._isEdit,isCommentEdit:this.model.allowComments&&this.XLComment._isCommentEdit,isSheetRename:this._isSheetRename,sheetIndex:this._getSheetIndex(),activeCell:this.getActiveCell(),keyCode:i.keyCode})){if(this._getContent(e).find(".e-ss-activeimg").length&&(n(i.target).hasClass("e-numerictextbox")&&i.keyCode===13&&i.preventDefault(),b=!0,w=document.activeElement.id,w.indexOf(this._id+"_Ribbon_Format_Size_PictureHeight")<0&&w.indexOf(this._id+"_Ribbon_Format_Size_PictureWidth")<0&&this.XLShape._imgKeyDown(i)),navigator.platform.toLowerCase().indexOf("mac")>-1&&i.metaKey){i.keyCode==67?this.XLClipboard.copy():i.keyCode==86?this.XLClipboard.paste():i.keyCode==88&&this.XLClipboard.cut();return}if(u.showSuggestionBox&&u.suggestionList){if(i.keyCode===38){u._removeListHover();u._activeItem=u._activeItem>1?u._activeItem-1:u._listSize;u._addListHover();u._targetFocus();return}if(i.keyCode===40){u._removeListHover();u._activeItem=u._activeItem<u._listSize?u._activeItem+1:1;u._addListHover();return}}if(i.target.id.indexOf("_Edit")>-1&&this.model.allowKeyboardNavigation&&(this.XLCellNav._canKeyBoardNavigate=!0),this.XLEdit._editElem&&(f=this.XLEdit._editElem.text()),i.target.id.indexOf("_Edit")>-1&&i.keyCode===9&&f.indexOf("=")===0&&f.indexOf(")")!=f.length-1){if(i.preventDefault(),!u.suggestionList.is(":visible")&&this.model.allowKeyboardNavigation){this._isFormulaSuggestion&&(i.keyCode===39||i.keyCode===37||i.keyCode===13&&!i.altKey)&&this.XLEdit.saveCell();this.XLCellNav._selectionKeyDownHandler(i);r=this.getSheet(e)._activeCell;return}o=v=u.getActiveText();v.indexOf("(worksheet)")>-1&&(v=o.split(" (worksheet)")[0]);f.endsWith("[")&&this._tableRangesFormula[f.split("[")[0].slice(1)]?o=f+o.slice(1):this.XLEdit._isNamedRange(v)||(o+="(");this.XLEdit._editElem.text(o);this.model.allowFormulaBar&&this._getInputBox().val(o);i.target.id.indexOf("_Edit")>-1&&this.XLEdit._editElem.focusEnd();this.XLCellNav._canKeyBoardNavigate=!1;return}if(this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"wrap")&&this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"merge")&&i.keyCode===46&&(this.getCell(r.rowIndex,r.colIndex,e).find("#"+this._id+"_Merge")[0].textContent=""),i.target.id.indexOf("_Custom")<0&&i.target.id.indexOf("_Ribbon")<0){if(i.stopImmediatePropagation(),this.model.allowFiltering&&this.XLFilter._isSearchEdit&&i.keyCode!==27)return!0;if(n(i.target).parents(".e-formulabar").length&&this.XLEdit._isEdit&&this.model.allowKeyboardNavigation&&(this.XLCellNav._isNavigate=i.keyCode===13),this._isSheetRename||this.XLEdit._isEdit||this.XLComment&&this.XLComment._isCommentEdit||!this.model.allowClipboard||this.XLClipboard._copyPasteHandler(i),b||this._isSheetRename||((this.XLComment&&this.XLComment._isCommentEdit)?this.model.allowKeyboardNavigation&&(this.XLCellNav._isNavigate=!1):this.model.allowEditing&&(document.activeElement.id.indexOf("_inputbox")===-1||i.keyCode===27)&&this.XLEdit._editingHandler(i)),this.isFormula(f)&&i.ctrlKey&&i.shiftKey&&i.keyCode===13){for(this._hasFormulaArray=!0,s=this._getSelectedCells(),h=s.range,d=this._getAlphaRange(e,h[0],h[1],h[2],h[3]),t.isNullOrUndefined(k.formulaRange[f])&&(k.formulaRange[d]=f),c=0,g=s.selCells.length;c<g;c++)g>1&&(this._hasMultipleFormulaArray=!0),l=s.selCells[c].rowIndex,a=s.selCells[c].colIndex,r.rowIndex==l&&r.colIndex==a&&this.XLEdit.saveCell(),this.XLEdit._updateCellValue({rowIndex:l,colIndex:a},f),this._dataContainer.sheets[e][l][a].formulaRange=d;this._hasFormulaArray=!1;this._hasMultipleFormulaArray=!1}if(i.keyCode==27&&this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"hasFormulaArray")?(ut=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"hasFormulaArray"),ft=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"hasMultipleFormulaArray"),(ut||ft)&&(this._formulaArray=!0,this.model.allowFormulaBar&&this.updateFormulaBar(),this._formulaArray=!1)):this._isFormulaSuggestion&&(i.keyCode===39||i.keyCode===37||i.keyCode===13&&!i.altKey)?this.XLEdit.saveCell():this.XLEdit._isFormulaEdit||i.keyCode!==9&&(i.keyCode!==13||i.altKey)&&i.keyCode!==37&&i.keyCode!==38&&i.keyCode!==39&&i.keyCode!==40||(it=this.XLEdit._isEdit&&this.model.allowKeyboardNavigation&&this.XLCellNav._isNavigate?this.XLEdit.saveCell():!0),n(i.target).hasClass("e-field-validation-error")||i.target.id==this._id+"_Ribbon_Home_Font_FontFamily_wrapper"||i.target.id==this._id+"_Ribbon_Home_Number_NumberFormat_wrapper"||i.target.id==this._id+"_Ribbon_Home_Font_FontSize_wrapper")return!0;if(this.model.allowDataValidation&&this.XLValidate._isErrorVisible&&(i.keyCode===37||i.keyCode===39||i.keyCode===38||i.keyCode===40))return this.XLValidate._isErrorVisible=!1,!0;if(!it&&!this.XLEdit._isFormulaEdit||i.keyCode===13&&i.altKey)return!1;!this.model.allowKeyboardNavigation||b||this._isSheetRename||(this.model.allowComments&&this.XLComment._isCommentEdit||n(i.target).parents(".e-formulabar").length&&i.keyCode!==9&&(i.keyCode!==13||i.altKey)||(this.XLEdit._isFormulaEdit&&(nt=this.XLEdit._editElem.closest(".e-sheet"),tt=nt.length&&this._getSheetIdxFromSheetValue(nt[0].id.replace(this._id+"_","")),e!=tt&&(i.keyCode===9||i.keyCode===13)&&(this.XLSelection._clearBorder(this._formulaBorder.join(" ").replace(/,/g," ")+" "+this._ctrlFormulaBorder.join(" ").replace(/,/g," ")),this.gotoPage(tt))),this.XLCellNav._selectionKeyDownHandler(i)),r=this.getSheet(e)._activeCell,this._keyboardShortCuts(i));this.model.allowUndoRedo&&(this.model.allowComments&&!this.XLComment._isCommentEdit?this._undoRedoOperation(i):this.model.allowComments||this._undoRedoOperation(i));this.XLEdit._isFormulaEdit&&i.keyCode===9&&!this.XLCellNav._canKeyBoardNavigate&&(this.XLCellNav._canKeyBoardNavigate=!0)}if(i.target.id===this._id+"_Ribbon_Analyze_PivotTable_PivotTableName")return this._isPvtNameEdit=!0,!0;if(this._isPvtNameEdit&&(this._isPvtNameEdit=!1,this.XLPivot._changePvtName()),i.target.tagName!=="DIV"||this.XLEdit._isEdit||t.isNullOrUndefined(this._ddlCell)||(this.element.find("#"+this._id+"ddl").ejDropDownList("hidePopup"),this.element.find("#"+this._id+"ddlspan").remove(),this._ddlCell=null),p=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tableName",e),i.target.id===this._id+"_Ribbon_Design_Properties_TableName")if(this._isTableRename=!0,this._tableClassName=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tableName")||"",this._isTableRename&&(i.keyCode===13||i.keyCode===9||i.keyCode===27))i.keyCode===13&&i.preventDefault(),this.XLFormat._renameTable(this._tableClassName);else return;p&&this._getContent(e).find(".e-ss-activeimg").length===0?(y=this._getTableID(p),this.isNumber(y)&&this.XLRibbon._designTabUpdate(y,r)):this.model.showRibbon&&(rt.model.selectedItemIndex===this.XLRibbon._getTabIndex("design")||rt.isVisible(this._getLocStr("Design")))&&this.XLRibbon._toggleDesignTab(r);this.XLEdit._isEdit||t.isNullOrUndefined(this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"rule",e))||this._setddlCell(i);this._isSheetRename&&(i.keyCode===13||i.keyCode===9||i.keyCode===27)&&(i.preventDefault(),this._updateSheetNames(null,i.keyCode===27)&&this._setSheetFocus());u.suggestionList.is(":visible")&&(this.XLEdit._editElem.text()===""||i.keyCode===13)&&u._hideResult();this.model.showRibbon&&this.XLRibbon._updateRibbonIcons()}},_keyUpHandler:function(n){var t=this.element.find("#"+this._id+"_Edit").text();this.model.allowEditing&&this.XLEdit._isEdit&&t.indexOf("=")>-1&&t.length>0&&t.indexOf(")")==-1&&(this.XLEdit._isFEdit||(this.XLCellNav._isNavigate=!0),n.keyCode!==40&&n.keyCode!==38&&t.length>1&&(t=t.replace("=",""),t.endsWith("[")&&this._tableRangesFormula[t.split("[")[0]]?(this.XLEdit._refreshAutoComplete(t.split("[")[0]),this._isFormulaCln=!0,this.XLEdit._captureEditing(!0)):(this._isFormulaCln&&(this.XLEdit._refreshAutoComplete(),this._isFormulaCln=!1),this.XLEdit._captureEditing())));this._trigger("keyUp",{event:n,isEdit:this.model.allowEditing&&this.XLEdit._isEdit,isCommentEdit:this.model.allowComments&&this.XLComment._isCommentEdit,isSheetRename:this._isSheetRename,sheetIndex:this._getSheetIndex(),activeCell:this.getActiveCell(),keyCode:n.keyCode})},_dblClickHandler:function(t){var r,o,i,u,f,e;if(this.XLEdit._isFEdit=!1,t.target.tagName!=="A")if(this._hasClass(t.target,"e-numericitem")){if(this.XLEdit&&this.XLEdit._isEdit&&this.getActiveCellElem().find(".e-error").length)return;this._isSheetRename||this._renameSheet()}else{if(t.target.id.indexOf("chart")>-1||this._hasClass(t.target,"e-comment-txtarea")||this._hasClass(t.target,"e-filterspan")||n(t.target).parents(".e-ss-pivot").length)return;if(t.target.classList.contains("e-iconsetspan")&&(t.target=t.target.closest("td")),u=this.getActiveSheetIndex(),f=this.getSheet(u),t.target=this._changeTargetWithOffset(t),!this.model.allowEditing||!this.model.allowSelection)return;if(this.XLSelection._isOutsideBordering||this.XLSelection._isGridBordering){r=this._getContent(u).find("div:first-child");r.addClass("e-ss-cursor");r.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor");this.XLSelection.selectRange(f._startCell,f._endCell);this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this.XLSelection._isOutsideBordering=this.XLSelection._isGridBordering=!1;return}if(!this.XLEdit._isEdit&&(n(t.target).hasClass("e-rowcell")||n(t.target).parents("td").hasClass("e-rowcell"))&&!this._hasClass(n(t.target),"e-readonly")&&!n(t.target).hasClass("e-cellreadonly")){if(e=this._clkCellObj,this._isTouchEvt&&t.preventDefault(),n(".e-cdata").length&&n(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),o=n(t.target),o.closest("#"+this._id+"EditForm").length)return;i=t.target.id.length<1?this._getCellIdx(t.target):this._getCellIdx(n(t.target).parents("td")[0]);e.rowIndex==i.rowIndex&&e.colIndex==i.colIndex&&this.XLEdit.editCell(i.rowIndex,i.colIndex,!0)}this.model.allowResizing&&(n(t.target).hasClass("e-headercell")||n(t.target).hasClass("e-headercelldiv"))&&(n(t.target).css("cursor")==="col-resize"||this._isTouchEvt)&&(n(t.target).hasClass("e-headercelldiv")&&(t.target=t.target.parentNode),this.XLResize._resizeToFitWidth(t));this.model.allowResizing&&(n(t.target).hasClass("e-ss-rowresize")||this._isTouchEvt&&n(t.target).hasClass("e-rowheader"))&&this.XLResize._resizeToFitHeight(t)}},_setAndSelectActiveCell:function(n,t,i){this.setActiveCell(n,t);this._selectActiveCell(n,t,"",i)},_selectActiveCell:function(n,t,i,r){var e=this.getActiveSheetIndex(),f=i?{rowIndex:i.rowIndex,colIndex:i.colIndex}:{rowIndex:n,colIndex:t},u=this.getSheet(e);if(this.model.allowSelection&&this.model.allowKeyboardNavigation&&this.model.scrollSettings.allowScrolling){this.XLEdit.getPropertyValue(n,t,"mergeIdx")?(u._activeCell=u._endCell=u._startCell=f,this.XLSelection._processBoundary(),u._activeCell=u._startCell,this.XLSelection.selectRange(u._startCell,u._endCell)):this.XLSelection.selectRange(this._getAlphaRange(e,n,t,f.rowIndex,f.colIndex));this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();switch(r){case"Home":this._scrollContent({x:[i?i.colIndex*u.columnWidth:0]-u._scrollLeft});break;case"End":u._isFreezed?this.XLCellNav._navToCell(n,t):(n<u._topRow.idx||n>u._bottomRow.idx||t<u._leftCol.idx||t>u._rightCol.idx)&&this.XLScroll.scrollToCell(this._getAlphaRange(e,n,t,f.rowIndex,f.colIndex));break;case"Ctrl + Home":case"Ctrl + Shift + Home":this.XLScroll.scrollToCell(this._getAlphaRange(e,n,t,f.rowIndex,f.colIndex))}this.XLScroll._getFirstColumn(e)}},_pageUpDown:function(n){if(!this._isAutoWHMode){var u,h,o,e,c,f=0,s,r=this.getActiveCell(),l=this.getActiveSheetIndex(),i=this.getSheet(l),a=this.model.scrollSettings.allowVirtualScrolling;(o=i._rowHeightCollection[r.rowIndex],i.rowCount-1===i._bottomRow.idx&&n===1||(this._isFrozen(i.frozenRows)?r.rowIndex>i.frozenRows&&i._ftopRowIdx===i.frozenRows:i._topRow.idx===0)&&n===-1)||(e=i._bottomRow.value+i.rowsHeightCollection[i._bottomRow.idx],this._isFrozen(i.frozenRows)&&(r.rowIndex<i.frozenRows&&n===1&&(o=i._rowHeightCollection[i.frozenRows]),f=n===1?this._getRowOffsetTop(i,i.frozenRows):this._getIdxWithOffset(i._ftopRowIdx,null,!1,["freeze"]).yOffset),c=n*(e-(f?f:i._topRow.value)),u=o+c>0?o+c:0,f?n===1?(s=r.rowIndex>i._ftopRowIdx?this._getIdxWithOffset(r.rowIndex).yOffset-i._frozenHeight:0,r.rowIndex<i.frozenRows?this._scrollContent({y:n*(e-i.rowsHeightCollection[i._bottomRow.idx]-f)+1}):this._scrollContent({y:this._getIdxWithOffset(i._bottomRow.idx,null,!1,["freeze"]).yOffset-i._frozenHeight},!0),u=this._getIdxWithOffset(i._ftopRowIdx).yOffset+s):(s=r.rowIndex>i._ftopRowIdx?this._getIdxWithOffset(r.rowIndex).yOffset-i._frozenHeight:0,r.rowIndex>i.frozenRows&&a?this._scrollContent({y:f-(e-i.rowsHeightCollection[i._bottomRow.idx])+1},!0):this._scrollContent({y:u+i.rowsHeightCollection[i._bottomRow.idx]-i._frozenHeight+1},!0),u=this._getIdxWithOffset(i._ftopRowIdx).yOffset+s):n===1&&this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&i._bottomRow.value+this.model.rowHeight+i._vPortHgt>=i._rowHeightCollection[i._rowHeightCollection.length-1]?u=i._rowHeightCollection[i._rowHeightCollection.length-1]:this._scrollContent({y:n*(e-i._scrollTop)}),h=this._getIdxWithOffset(u,i._colWidthCollection[r.colIndex],!0),this._setAndSelectActiveCell(h.rowIdx,h.colIdx))}},_keyboardShortCuts:function(i){var v,p,c,y,w,a;if(this.model.allowEditing&&this.XLEdit._isEdit||this.model.allowComments&&this.XLComment._isCommentEdit&&i.keyCode!==27)return!1;var h,s,e,o=this.XLFormat,l=this.getActiveSheetIndex(),u=this.getSheet(l),f=u._selectedCells,r=!1;if(this.model.allowLockCell&&u.isSheetProtected&&(r=!0),!i.ctrlKey&&!i.shiftKey)switch(i.keyCode){case 33:i.preventDefault();this._pageUpDown(-1);break;case 34:i.preventDefault();this._pageUpDown(1);break;case 36:i.preventDefault();this._setAndSelectActiveCell(this.getActiveCell(l).rowIndex,this._isFrozen(u.frozenColumns)?u._frozenColumns-1:0,"Home")}if(i.ctrlKey&&!i.shiftKey){if(!this.element.find("#"+this._id+"_Ribbon .e-ribbonbackstagepage").is(":visible"))switch(i.keyCode){case 65:i.preventDefault();this.model.allowSelection&&(h=this.getActiveCellElem(),this.selectAll(),t.isNullOrUndefined(this.XLCellNav)||this.XLCellNav._updateActiveCell(n(h[0]).closest("tr").index(),h[0].cellIndex,{keyCode:i.keyCode}),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement());break;case 66:i.preventDefault();r||this._toggleFontPrpty("bold");break;case 68:case 82:i.preventDefault();this.model.allowAutoFill&&this.XLDragFill._fillRange(i.keyCode===68);break;case 73:i.preventDefault();r||this._toggleFontPrpty("italic");break;case 75:i.preventDefault();this.model.allowHyperlink&&!r&&this._showDialog(this._id+"_Ribbon_Insert_Links_Hyperlink");break;case 85:i.preventDefault();r||this._toggleFontPrpty("underline");break;case 32:if(i.preventDefault(),!this.model.allowSelection)return;v=f[0].colIndex;p=f[f.length-1].colIndex;s={rowIndex:0,colIndex:v};e={rowIndex:u.rowCount-1,colIndex:p};this.model.allowSelection&&this.XLSelection.selectRange(s,e);u._startCell=s;u._endCell=e;u._isColSelected=!0;t.isNullOrUndefined(this.XLCellNav)||this.XLCellNav._updateActiveCell(f[0].rowIndex,v);this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();break;case 35:i.preventDefault();e=this._getUsedRangeFromSheet(l).endCell;this._setAndSelectActiveCell(e.rowIndex,e.colIndex,"End");break;case 36:i.preventDefault();this._setAndSelectActiveCell(this._isFrozen(u.frozenRows)?u._frozenRows-1:0,this._isFrozen(u.frozenColumns)?u._frozenColumns-1:0,"Ctrl + Home");break;case 49:i.preventDefault();this._showDialog(this._id+"_FormatCells");break;case 53:i.preventDefault();r||this._toggleFontPrpty("line-through");break;case 56:i.shiftKey||r||(i.preventDefault(),this._hideColumn(u._startCell.colIndex,u._endCell.colIndex));break;case 57:i.shiftKey||(i.preventDefault(),r||this._hideRow(u._startCell.rowIndex,u._endCell.rowIndex,"isRHide"));break;case 220:i.shiftKey||(i.preventDefault(),this.model.allowSearching&&this.XLSearch._applyGotoRowDiff());break;case 90:i.preventDefault();break;case 89:i.preventDefault();break;case 114:i.preventDefault();this.model.showRibbon&&!r&&this.XLRibbon._openNameManagerDlg();break;case 70:i.preventDefault();this._showDialog(this._id+"_Ribbon_Others_Editing_FindSelect");n("#"+this._id+"_FRDialog").ejDialog("open");this.XLRibbon._refreshFRDlg();n("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option","selectedItemIndex",0);break;case 71:i.preventDefault();this._showDialog(this._id+"_Ribbon_Others_Editing_FindSelect");n("#"+this._id+"_GoDialog").ejDialog("open");n("#"+this._id+"_GoToDlgTab").ejTab("option","selectedItemIndex",0);break;case 72:i.preventDefault();this._showDialog(this._id+"_Ribbon_Others_Editing_FindSelect");n("#"+this._id+"_FRDialog").ejDialog("open");this.XLRibbon._refreshFRDlg();n("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option","selectedItemIndex",1)}switch(i.keyCode){case 80:i.preventDefault();this.XLPrint.printSheet();break;case 79:if(i.preventDefault(),this.model.allowImport){if(this.model.importSettings.importMapper.length<1){this._showAlertDlg("Alert","ImportExportUrl","",266);return}this.isDirty&&this._browserDetails.name!=="msie"?this._showAlertDlg("","ImportAlert","Open",470,135):n("#"+this._id+"_file .e-uploadinput").click()}break;case 83:i.preventDefault();this.model.exportSettings.allowExporting&&(this._showDialog("exportxl"),n("#"+this._id+"_ExportFileNameDialog").ejDialog("open"),this.XLExport._exportType="Excel")}}if(i.ctrlKey&&i.shiftKey){if(!this.element.find("#"+this._id+"_Ribbon .e-ribbonbackstagepage").is(":visible")){this._browserDetails.name==="mozilla"&&i.keyCode===173&&(i.keyCode=189);switch(i.keyCode){case 192:i.preventDefault();r||o.format({type:"general"});break;case 52:i.preventDefault();r||o.format({type:"currency"});break;case 53:i.preventDefault();r||o.format({type:"percentage"});break;case 54:i.preventDefault();r||o.format({type:"scientific"});break;case 51:i.preventDefault();r||o.format({type:"shortdate"});break;case 50:i.preventDefault();r||o.format({type:"time"});break;case 49:i.preventDefault();r||o.format({type:"number"});break;case 55:i.preventDefault();this.model.allowCellFormatting&&this.model.formatSettings.allowCellBorder&&!r&&this.XLFormat.applyBorder({top:"1px solid #000000",right:"1px solid #000000",bottom:"1px solid #000000",left:"1px solid #000000"});break;case 189:i.preventDefault();this.model.allowCellFormatting&&this.model.formatSettings.allowCellBorder&&!r&&this.XLFormat.applyBorder("noborder");break;case 73:i.preventDefault();this.model.allowInsert&&!r&&this._showDialog(this._id+"_Ribbon_Others_Cells_InsertCellOptions");break;case 68:i.preventDefault();this.model.allowDelete&&!r&&this._showDialog(this._id+"_Ribbon_Others_Cells_DeleteCellOptions");break;case 113:i.preventDefault();c=n("#"+this._id+"_Ribbon").data("ejRibbon");this.model.showRibbon&&(c._isCollapsed?(c.expand(),c._removeRibbonPin(),this._isKeyCtrlShftF2=!0):c.collapse());break;case 56:i.preventDefault();!r&&this.model.allowSelection&&this._showColumn(f[0].colIndex,f[f.length-1].colIndex);break;case 57:i.preventDefault();!r&&this.model.allowSelection&&this._showRow(f[0].rowIndex,f[f.length-1].rowIndex,"isRHide");break;case 79:i.preventDefault();this.XLSearch._applyGotoComments();break;case 220:i.preventDefault();this.XLSearch._applyGotoColDiff();break;case 36:i.preventDefault();e=this.getActiveCell(l);this._selectActiveCell(0,0,e,"Ctrl + Shift + Home")}}}else if(i.shiftKey)i.keyCode===32?(i.preventDefault(),this.model.allowSelection&&(y=f[0].rowIndex,w=f[f.length-1].rowIndex,s={rowIndex:y,colIndex:0},e={rowIndex:w,colIndex:u.colCount-1},this.XLSelection.selectRange(s,e),u._startCell=s,u._endCell=e,u._isRowSelected=!0,t.isNullOrUndefined(this.XLCellNav)||this.XLCellNav._updateActiveCell(y,f[0].colIndex),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())):i.keyCode===113?(this._dupDetails=!0,i.preventDefault(),h=this.getActiveCellElem(),this.model.allowComments&&!r&&(this._isRibbonClick=!0,h.hasClass("e-commentcell")?this.XLComment.editComment():this.XLComment.setComment(),this._isRibbonClick=!1),this._dupDetails=!1):i.keyCode===122&&(i.preventDefault(),this.addNewSheet());else if(i.keyCode===27){if(this.model.allowComments&&this.XLComment._isCommentEdit&&(this.XLComment._updateCurCmntVal(),this.XLComment._updateCmntRibIcons()),this.model.allowContextMenu&&(this.XLCMenu._isMenuOpened||n("#"+this._id+"_contextMenuColumnHeader").is(":visible")||n("#"+this._id+"_contextMenuRowHeader").is(":visible"))&&this.XLCMenu.hideCMenu(),this.model.allowFiltering&&this._excelFilter&&this._excelFilter._openedFltr&&n(this._excelFilter._openedFltr).is(":visible")){if(a=this._excelFilter._menuWrap.data("ejMenu"),a.element.find(".e-mhover li:visible").length){a._isContextMenuOpen||a._closeMenu();return}this.XLFilter._isSearchEdit=!1;this._excelFilter.closeXFDialog()}this._setSheetFocus()}else i.altKey&&(i.keyCode===112&&this.model.showRibbon&&this.model.allowCharts&&!r?(i.preventDefault(),this.XLChart.createChart(null,{type:"column",enable3D:!1,marker:{visible:!1}})):i.keyCode===84&&this.model.showRibbon&&!this.XLRibbon._isDirtySelect&&!r&&this.model.allowFormatAsTable&&(this._showDialog(this._id+"_Ribbon_Insert_Tables_Table"),i.preventDefault(),this.XLRibbon._openFATDlg()))},_triggerTBtnClick:function(t){var i=n("#"+t).data("ejToggleButton");i.buttontag.click()},_toggleFontPrpty:function(n){var e=this.getActiveCell(),o=this.XLFormat,u={style:{}},f,t,i,r;f=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"format");i=!this.isUndefined(f)&&this.XLFormat.getFormatFromHashCode(f);t=n==="bold"?"font-weight":n==="italic"?"font-style":"text-decoration";r=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase();r==="Line-through"&&(r="StrikeThrough");i[t]===n?(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).ejToggleButton("option","toggleState",!1),u.style[t]="none"):t==="text-decoration"&&(i[t]==="underline"||i[t]==="line-through")?(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).ejToggleButton("option","toggleState",!0),u.style[t]=i[t]==="underline"?n+" "+i[t]:i[t]+" "+n):t==="text-decoration"&&(i[t]==="line-through underline"||i[t]==="underline line-through")?(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).ejToggleButton("option","toggleState",!1),i[t]=i[t].split(" ").join(""),u.style[t]=i[t].replace(n,"")):(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+r).ejToggleButton("option","toggleState",!0),u.style[t]=n);o.format(u)},_getLocStr:function(n){return this.localizedLabels[n]},_checkIndicesInContainer:function(n,t,i,r){var u=this._dataContainer.sheets;return n in u&&t in u[n]&&i in u[n][t]?r?r in u[n][t][i]?!0:!1:!0:!1},_textFormatting:function(t){switch(t){case"wrapText":var i=n("#"+this._id+"_Ribbon_Home_Alignment_WrapText").data("ejToggleButton");i&&this.setWrapText(i.model.toggleState?"wrap":"unwrap",null)}},wrapText:function(n){this.model.allowWrap&&!this.model.isReadOnly&&this.setWrapText("wrap",n)},unWrapText:function(n){this.model.allowWrap&&!this.model.isReadOnly&&this.setWrapText("unwrap",n)},setWrapText:function(i,r){var f,rt,d;if(this.model.allowWrap&&!this.model.isReadOnly){var u,a,s,e=this.getActiveSheetIndex(),h,p,o=this.getSheet(e),c=0,v,y=this.model.rowHeight,ut=this.getRows(e),ft=ut[0],g,nt=o.rowsHeightCollection,w=o._wrapHtCollection,l=!1,et=o._clrWrapColl,b,tt=[],ot=this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0",it,k;if(a=this._getRangeArgs(r,"object"),u=this._getSelectedCells(e,a).selCells,u.length!==0){for(g=u.length>1?this._getProperAlphaRange(e,u[0].rowIndex,u[0].colIndex,u[u.length-1].rowIndex,u[u.length-1].colIndex):this._getAlphaRange(e,u[0].rowIndex,u[0].colIndex,u[u.length-1].rowIndex,u[u.length-1].colIndex),this._updateWrapCol(i,u,o,e),f=0,rt=u.length;f<rt;f++)if(l=this.XLEdit.getPropertyValue(u[f].rowIndex,u[f].colIndex,"wrap"),u[f].colIndex===a[1]&&(it=this._dataContainer.sheets[e],k=this.getObjectKeys(it[u[f].rowIndex])),this._isPaste||(i!=="unwrap"||l)&&(i!=="wrap"||!l)){if(i==="unwrap"&&l)this._isUndoRedo||et.push({rowIdx:u[f].rowIndex,colIdx:u[f].colIndex}),this._isRowViewable(e,u[f].rowIndex)&&(s=this.getCell(u[f].rowIndex,u[f].colIndex),h=u[f].rowIndex,p=u[f].colIndex,s&&this._removeClass(s[0],"e-sswraptext"),this._removeClass(ft[h],"e-sswraprow"),this.XLEdit.getPropertyValue(u[f].rowIndex,u[f].colIndex,"altTxt")&&this.addClass(s[0],"e-alt-unwrap"),h in o._wrapColl&&p in o._wrapColl[h]&&(delete o._wrapColl[h][p],v=t.max(this._getObjectValues(o._wrapColl[h])),b=this._getFormattedHeight(e,h),(!v||v<b)&&(v=b),n.isEmptyObject(o._wrapColl[h])&&delete o._wrapColl[h])),this.XLEdit._clearDataContainer({cellIdx:u[f],property:["wrap"]}),this.XLEdit._clearDataContainer({cellIdx:{rowIndex:u[f].rowIndex,colIndex:0},property:["wrapRow"]}),this.XLEdit._clearDataContainer({cellIdx:{rowIndex:0,colIndex:u[f].colIndex},property:["wrapCol","wrapWidth"]}),c=this._getWrapCellHeight(e,u[f].rowIndex,u[f].colIndex,v),this._textClip(u[f].rowIndex,u[f].colIndex,"add",null,null,k);else if(i==="wrap"&&!l){if(this.XLEdit.getPropertyValue(u[f].rowIndex,u[f].colIndex,"isFilterHeader"))continue;this._textClip(u[f].rowIndex,u[f].colIndex,"delete",null,null,k);this._wrapCollection(u[f].rowIndex,u[f].colIndex,nt[u[f].rowIndex],e);this.XLEdit._updateDataContainer({rowIndex:u[f].rowIndex,colIndex:u[f].colIndex},{dataObj:{wrap:!0}});this._isRowViewable(e,u[f].rowIndex)&&(s=this.getCell(u[f].rowIndex,u[f].colIndex),s&&s.length>0&&((ot?s.is(":visible"):window.getComputedStyle(s[0]).display=="table-cell")||this._isPaste)&&this.model.allowResizing&&!this.XLResize._preventRowResize(u[f].rowIndex)&&(this.addClass(s[0],"e-sswraptext"),this.XLEdit.getPropertyValue(u[f].rowIndex,u[f].colIndex,"altTxt")&&this._removeClass(s[0],"e-alt-unwrap")));c=this.XLEdit.getPropertyValue(u[f].rowIndex,u[f].colIndex,"mergeIdx")?this._getWrapCellHeight(e,u[f].rowIndex,u[f].colIndex,o.rowsHeightCollection[u[f].rowIndex]):this._getWrapCellHeight(e,u[f].rowIndex,u[f].colIndex);c.rowHt<y&&(c.rowHt=y);y=c.rowHt;this._wrapCollection(u[f].rowIndex,u[f].colIndex,c.cellHt,e);this.XLEdit._updateDataContainer({rowIndex:u[f].rowIndex,colIndex:u[f].colIndex},{dataObj:{wrap:!0}});w[u[f].rowIndex]=f>0&&u[f].rowIndex===u[f-1].rowIndex?w[u[f-1].rowIndex]:w[u[f].rowIndex]=nt[u[f].rowIndex];t.isNullOrUndefined(this.XLEdit.getPropertyValue(u[f].rowIndex,0,"wrapCol"))&&this.XLEdit._updateDataContainer({rowIndex:0,colIndex:u[f].colIndex},{dataObj:{wrapCol:!0,wrapWidth:this.getSheet(e).columnsWidthCollection[u[f].colIndex]}})}c.rowHt>0&&(u[f].colIndex===a[3]||this.XLEdit.getPropertyValue(u[f].rowIndex,u[f].colIndex,"merge"))&&(tt.push({rowIndex:u[f].rowIndex,height:c.rowHt}),y=0,i!=="wrap"||l||t.isNullOrUndefined(this.XLEdit.getPropertyValue(u[f].rowIndex,0,"wrapRow"))&&this.XLEdit._updateDataContainer({rowIndex:u[f].rowIndex,colIndex:0},{dataObj:{wrapRow:!0}}));u[f].colIndex===a[3]&&(y=0);c=0}this._setHeightToRows(tt,!0);this.model.allowFreezing&&o.frozenRows&&(this.XLFreeze._refreshFRowResize(o.frozenRows-1),this.isImport||this.model.isImport||!o._isLoaded||this.XLFreeze._refreshSelection());this.model.allowComments&&this.XLComment._updateCmntArrowPos();this.model.scrollSettings.allowScrolling&&this.XLScroll._getRowHeights(e,u[0].rowIndex+1,null,!0);(!o._isImported||o._isLoaded)&&(d={sheetIndex:e,selectedCell:u,reqType:"textwrap",operation:i,range:g},this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(e,"refresh","all"),this.model.allowSelection&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._isUndoRedo||this._dupDetails||(this._completeAction(d),this._trigActionComplete(d)))}}},_getWrapCellHeight:function(n,t,i,r){var u,o,f=0,s=0,e,h=this.getSheet(n),c=h.rowsHeightCollection,l=h.columnsWidthCollection,a;if(o=this.XLEdit.getPropertyValue(t,i,"merge"),f=c[t],s=l[i],o){for(u=t+1;u<t+o.mSpan.rowSpan;u++)f=f+c[u];for(u=i+1;u<i+o.mSpan.colSpan;u++)s=s+l[u]}return o?(f=this._getRowHeight(t,n),e=r?r:f):(a=h._wrapValColl.rows[t]&&h._wrapValColl.rows[t][i]?this._detailsFromGlobalSpan(t,i,"height",this.XLEdit.getPropertyValue(t,i,"value2"),s):this.model.rowHeight,e=r?r:a,e=e<this.model.rowHeight?this.model.rowHeight:e,f=e),{cellHt:e,rowHt:f}},_wrapTextLenCln:function(t,i,r,u){var c,l,p=t.length-1,e=this.getRangeData({range:[t[0].rowIndex,t[0].colIndex,t[p].rowIndex,t[p].colIndex],property:["value2","formats","altTxt","type"]}),y=t[p].rowIndex-t[0].rowIndex,k=t[p].colIndex-t[0].colIndex,f=0,o,a=i.columnsWidthCollection,d,w,v=0,s=!1,g=0,b,h;if(this.model.scrollSettings.allowVirtualScrolling&&(y=y>i._virtualBlockRowCnt?this._getRowIdx(i._virtualContBlockIdx*i._virtualBlockRowCnt+(i._virtualBlockRowCnt-1),u,!0):y),r==="isFitWidth"&&(s=!0),d=this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0",d)for(w=n("#"+this._id+"_emptySpan"),h={},c=0;c<=y;c++)for(l=0;l<=k;l++)h={},e[f].value2&&(s||(v=i._wrapValColl.rows[t[f].rowIndex]?this._getObjectValues(i._wrapValColl.rows[t[f].rowIndex])[0]:a[t[f].colIndex]),e[f].formats?(h["font-size"]=e[f].formats["font-size"]?e[f].formats["font-size"]:"11pt",h["font-family"]=e[f].formats["font-family"]?e[f].formats["font-family"]:"Calibri",h["font-weight"]=e[f].formats["font-weight"]?e[f].formats["font-weight"]:"normal"):h={"font-size":"11pt","font-family":"Calibri","font-weight":"normal"},w.css(h),o=w.text(e[f].value2).width(),!s&&r!="wrap"&&i._wrapColl[t[f].rowIndex]&&i._wrapColl[t[f].rowIndex][t[f].colIndex]<=this.model.rowHeight&&a[t[f].colIndex]<o&&this._wrapCollection(t[f].rowIndex,t[f].colIndex,this._detailsFromGlobalSpan(t[f].rowIndex,t[f].colIndex,"height",e[f].value2,a[t[f].colIndex]),u),(v<o||e[f].altTxt)&&(v=o,s?(i._wrapValColl.cols[t[f].colIndex]={},i._wrapValColl.cols[t[f].colIndex][t[f].rowIndex]=o):(i._wrapValColl.rows[t[f].rowIndex]={},i._wrapValColl.rows[t[f].rowIndex][t[f].colIndex]=o))),f++;else for(c=0;c<=y;c++)for(l=0;l<=k;l++)b=!0,e[f].value2&&(s||(v=a[t[f].colIndex]),o=this._getTextContentWidth(e[f],e[f].type=="accounting"?n.trim(e[f].value2):e[f].value2),r=="wrap"&&i._wrapValColl.rows[t[f].rowIndex]&&i._wrapValColl.rows[t[f].rowIndex][g]>o&&(b=!1),!s&&r!="wrap"&&i._wrapColl[t[f].rowIndex]&&i._wrapColl[t[f].rowIndex][t[f].colIndex]<=this.model.rowHeight&&a[t[f].colIndex]<o&&this._wrapCollection(t[f].rowIndex,t[f].colIndex,this._detailsFromGlobalSpan(t[f].rowIndex,t[f].colIndex,"height",e[f].value2,a[t[f].colIndex]),u),v<o&&b&&(v=o,s?(i._wrapValColl.cols[t[f].colIndex]={},i._wrapValColl.cols[t[f].colIndex][t[f].rowIndex]=o):(i._wrapValColl.rows[t[f].rowIndex]={},i._wrapValColl.rows[t[f].rowIndex][t[f].colIndex]=o,g=t[f].colIndex))),f++},_getTextContentWidth:function(n,i){var f,u,r="";return f=document.createElement("canvas"),u=f.getContext("2d"),t.isNullOrUndefined(n.formats)?r="11pt Calibri":(n.formats["font-weight"]&&(r+=n.formats["font-weight"]+" "),r+=n.formats["font-size"]?n.formats["font-size"]+" ":"11pt ",r+=n.formats["font-family"]?n.formats["font-family"]+" ":"Calibri "),u.font=r,u.measureText(i).width+5},_updateWrapCol:function(t,i,r,u,f){var s,h,e,o,c,l;if(t==="wrap")this._wrapTextLenCln(i,r,t,u);else for(s=r._wrapColl,h=i.length,e=i[0].rowIndex;e<=i[h-1].rowIndex;e++){if(t==="unwrap")for(r._wrapValColl.rows[e]&&delete r._wrapValColl.rows[e],s=n.extend(!0,{},r._wrapColl),o=i[0].colIndex;o<=i[h-1].colIndex;o++)s[e]&&s[e][o]&&delete s[e][o];if(s[e])for(c=this.getObjectKeys(s[e]),l=c.length,o=0;o<l;o++)this._wrapTextLenCln([{rowIndex:e,colIndex:c[o]}],r,t,u)}t==="updatecellvalue"&&(this._isRowViewable(u,f)&&(this.getRows(u)[1][this._getRowIdx(f)].style.height=r.rowsHeightCollection[f]+"px"),this.model.allowSelection&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())},_wrapCollection:function(n,t,i,r){var u=this.getSheet(r?r:this.getActiveSheetIndex());this.model.scrollSettings.allowVirtualScrolling&&n>this._getRowIdx(u._virtualContBlockIdx*u._virtualBlockRowCnt+(u._virtualBlockRowCnt-1),r,!0)||(u._wrapColl[n]||(u._wrapColl[n]={}),u._wrapColl[n][t]=i,u.rowsHeightCollection[n]<i&&!this._isInMrgeRnge(n,t,!u._isLoaded)&&(u.rowsHeightCollection[n]=i,this.model.scrollSettings.allowScrolling&&this.XLScroll._getRowHeights(r,n,!0),this._getRowHdrTBody(r).find('tr[data-idx="'+n+'"]').height(i)))},_isInMrgeRnge:function(n,t,i){if(!i)return this.XLEdit.getPropertyValue(n,t,"merge");var u,r,e=this._getSheetIndex(),f=this._impData?this._impData.model.sheets[e].mergedCells:[];for(f||(f=[]),u=0;u<f.length;u++)if(r=this.getRangeIndices(f[u].range),r[0]<=n&&r[2]>=n&&r[1]<=t&&r[3]>=t)return!0;return!1},_setWrapHeight:function(t,i,r,u,f,e){var o,h,c=r[i],s=this.getSheet(t),l=s.rowsHeightCollection;l[i]>0?o=l[i]:(s.hideRowsCollection.indexOf(i)===-1||e==="visible")&&(h=n(r[i].outerHTML).attr("id","ss"),f[0].insertBefore(h[0],f[0].childNodes[0]),o=f[0].rows[0].getBoundingClientRect().height,f[0].rows[0].parentNode.removeChild(f[0].rows[0]));o=o<20?20:o;parseInt(c.style.height)<o&&(c.style.height=o+"px",n(u[i])[0].style.height=o+"px",s.rowsHeightCollection[i]=o)},_setRowHdrHeight:function(n,t){var r=this._getRowIdx(t),u,f,i=this.getSheet(n),e=this.getRows(n),o=i.rowsHeightCollection[t];this._isRowViewable(n,t)&&(f=parseInt(e[0][r].style.height),f!=o&&(e[0][r].style.height=o+"px",this.model.allowSelection&&(u=this._intrnlReq,this._intrnlReq=!0,this.XLSelection.refreshSelection(),i._isFreezed&&this.XLFreeze._refreshSelection(),this._intrnlReq=u),(!i._isImported||i._isLoaded)&&this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()))},_refreshRangeTRHght:function(n,t){for(var r=t[0]<1?t[0]:t[0]-1,u=this.getSheet(n),i=r;i<=t[2];i++)this._setRowHdrHeight(n,i);this.XLScroll._getRowHeights(n,r);(!u._isImported||u._isLoaded)&&this.model.allowSelection&&this.XLSelection._refreshBorder()},_renderAlertdlg:function(){var u,f,e,o,s,r,h="<div class='e-dlg-btnctnr' id=",i=this._id+"_alertdlg",c={text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._alertOkClick,this),enabled:!0,cssClass:"e-ss-okbtn"};document.getElementById(this._id+"_alertdlg")||(o="<input id="+this._id+"_dialog_Ok ><\/input><input id="+this._id+"_dialog_Can style= 'margin-left: 10'; ><\/input>",u="<input id="+this._id+"_dialog_alertOk > <\/input>",e=h+i+"_condiv >"+o+"<\/div>",f=h+i+"_alertdiv >"+u+"<\/div>",r="<div class='e-alertdlgcontent' id="+i+"_dlgcontent > <\/div>",r=r+"<div class='e-dlg-btnfields' id="+i+"_dlgbtncontent >"+e+f+"<\/div>",s=n("<div id="+i+" class='e-alertdlg' style= 'display : none;'>"+r+"<\/div>"),this.element[0].appendChild(s[0]),n("#"+this._id+"_dialog_alertOk").ejButton(c),n("#"+this._id+"_dialog_Ok").ejButton(c),n("#"+this._id+"_dialog_Can").ejButton({text:this._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._alertCanClick,this)}))},alert:function(t){var i=n("#"+this._id+"_alertdlg");this._renderAlertDlgContent(i,"Alert",t);i.ejDialog("open")},_renderAlertDlgContent:function(n,i,r,u,f,e){var o=n.find("#"+this._id+"_alertdlg_dlgcontent"),s=n.find("#"+this._id+"_alertdlg_condiv"),h=n.find("#"+this._id+"_alertdlg_alertdiv");this._tabMode||this._phoneMode?f>this._responsiveWidth/1.2&&(f=this._responsiveWidth/1.2):f=f||400;e=e||"";i==="Alert"?(s.hide(),h.show()):(s.show(),h.hide());o.text("");o.html(r);n.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,enableAnimation:!1,allowKeyboardNavigation:!1,title:this._getLocStr("Title"),width:f,height:"auto",minHeight:0,cssClass:"e-ss-dialog e-"+this._id+"-dlg"+e,open:t.proxy(this._alertDlgOpen)});this._alertDialog={element:n,action:u}},_alertDlgOpen:function(){this.element.find("input:visible:first").focus()},_alertOkClick:function(){var r,t=this.getActiveSheetIndex(),u=this._isUndoRedo,i;this._alertDialog.element.ejDialog("close");switch(this._alertDialog.action){case"findPrevComment":this.gotoPage(this.model.sheetCount,!1);r=this.model.sheets[this.model.sheetCount];this.XLComment._updateCurrentCell(r.rowCount-1,r.colCount-1);this.XLComment.findPrevComment();this._alertDialog.action=null;break;case"findNextComment":this.gotoPage(1,!1);this.XLComment._updateCurrentCell(0,0);this.XLComment.findNextComment();this._alertDialog.action=null;break;case"sheetRenameActn":n("#"+this._id+"_Sheet_RenamePanel").select().focus();break;case"sheetDeleteActn":this._removeSheet(t);this._alertDialog.action=null;break;case"New":this.blankWorkbook();break;case"Open":n("#"+this._id+"_file .e-uploadinput").click();break;case"MergeCells":this._mergeCells(t,this.model.sheets[t]._selectedCells,{},[]);this._alertDialog.action=null;break;case"MergeAcrossCells":this._mergeAcrossCells(t,this.model.sheets[t]._selectedCells);this._alertDialog.action=null;break;case"MergeInsertDelete":this._refreshMergeCells();this._alertDialog.action=null;break;case"InvalidChartTitleActn":n("#"+this._id+"_chartnamedlg").find("input:first").focus();break;case"ConvertToRange":this.XLFormat._convertToRange({});break;case"TotalRow":this._isUndoRedo=this._dupDetails=!0;this.insertEntireRow(this._insRows.startRow,this._insRows.endRow);this.XLFormat._calculateTotalRow(t,null,!0,!1,!0);this._isUndoRedo=u;break;case"Drop":i=this.getSheet(t);this.XLDragDrop.moveRangeTo([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex],[this._dStartCell.rowIndex,this._dStartCell.colIndex,this._dEndCell.rowIndex,this._dEndCell.colIndex]);i._startCell=this._dStartCell;i._endCell=this._dEndCell;this._trigger("drop",{sheetIndex:t,target:this.XLDragDrop._target,currentCell:this.XLDragDrop._dragAndDropCell,dragAndDropRange:{startCell:i._startCell,endCell:i._endCell}});break;case"FormulaAlert":this.XLEdit._editElem.focus();break;case"NMUniqueNameAlert":case"NMNameAlert":document.getElementById(this._id+"_nmgridname")&&document.getElementById(this._id+"_nmgridname").focus();break;case"NMRangeAlert":document.getElementById(this._id+"_nmgridrefersto")&&document.getElementById(this._id+"_nmgridrefersto").focus();break;case"OpenValDlg":n("#"+this._id+"_ValDialog").ejDialog("open");break;case"cellStyleAlert":this._showDialog(this._id+"_CustomCellDialog");break;case"multipleArrayFormula":var f=this.XLEdit._editCell,e=this.getActiveCell(t).rowIndex,o=this.getActiveCell(t).colIndex,s=this.XLEdit.getPropertyValue(e,o,"value2");this.element.find("#"+this._id+"_Edit").hide();this.XLEdit._refreshTextNode(f[0],s);this.model.showRibbon&&this.XLRibbon._enableRibbonIcons();this._formulaArray=!0;this.model.allowFormulaBar&&this.updateFormulaBar();this._formulaArray=!1;this.XLEdit._isEdit=!1;break;default:this._setSheetFocus()}},blankWorkbook:function(){var t=1,i;this._isNew=!0;this._destroy();this._dataContainer.sheets[t]={};this.clearUndoRedo();this._updateCellType();this.model.sheetCount=t;this.model.activeSheetIndex=t;this._sheetSettings(t);this._newSIndex++;this._initCSSTag();this.gotoPage(t,!1);this.model.allowLockCell&&this.protectSheet(!1);i=n("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").data("ejToggleButton");i&&(i.option("toggleState",!1),this.model.exportSettings.password=null,n("#"+this._id+"_AddSheet").removeClass("e-disable"));this.XLRibbon._toggleFormatTab();this.XLRibbon._toggleChartDesignTab();this.XLRibbon._toggleAnalyzeTab();this._refreshSpreadSheetPager();this.hideWaitingPopUp();this._isNew=!1},_alertCanClick:function(){var t=this._alertDialog,i;(t.action=="findNextComment"||t.action=="findPrevComment")&&n(this.getActiveCellElem()).find(".e-comment-txtarea").css("display","inline-table");t.action=="TotalRow"&&n("#"+this._id+"_Ribbon_Design_TableStyleOptions_TotalRow").length&&(this.XLRibbon._isSetModel=!0,n("#"+this._id+"_Ribbon_Design_TableStyleOptions_TotalRow").data("ejCheckBox").option("checked",!1),this.XLRibbon._isSetModel=!1);t.element&&t.element.ejDialog("close");switch(t.action){case"Drop":i=this.getSheet(this.getActiveSheetIndex());this.performSelection(i._startCell,i._endCell)}this.hideWaitingPopUp()},_showAlertDlg:function(t,i,r,u,f){var o=n("#"+this._id+"_alertdlg"),s="Alert",e,h={reqType:"alert",action:r};if(i instanceof Array?i[0]==="SheetRenameEmptyAlert"?e="<ul><li>"+this._getLocStr(i[0])+"<\/li><li>"+this._getLocStr(i[1])+"<\/li><li>"+this._getLocStr(i[2])+"\\ / ? * ["+this._getLocStr("OR")+"  ] <\/li><li>"+this._getLocStr(i[3])+"<\/li><\/ul>":i[0]==="ClipboardAccessError"&&(e=this._getLocStr(i[0])+"<br /><br />"+this._getLocStr(i[1])+"  = Ctrl + X <br />"+this._getLocStr(i[2])+"  = Ctrl + C <br />"+this._getLocStr(i[3])+"  = Ctrl + V"):(e=i.indexOf("T-")===0?i.slice(2):this._getLocStr(i),e||(e=i)),this._trigActionBegin(h)){this._alertDialog.action=r;this._alertCanClick();return}t===s?this._renderAlertDlgContent(o,s,e,r,u,f):this._renderAlertDlgContent(o,"",e,r,u,f);o.ejDialog("open")},_isSheetsDirty:function(){var n=1,t=this._dataContainer.sheets,i=this.getObjectLength(t)+1;if(this.model.nameManager.length||this.getObjectLength(t)>1)return!0;while(n<i){if(this.getObjectLength(t[n]))return!0;n++}return!1},getCell:function(t,i,r){r=this._getSheetIndex(r);var u=0,f=this.getSheet(r);return this.model.scrollSettings.allowVirtualScrolling&&(u=1,t=this._getRowIdx(t,r),t===-1)?null:(this.isImport||this.model.isImport||f._isImported||this._isPrint)&&this._detachTable?n(this._detachTable[0].tBodies[u].rows[t].cells[i]):this._getContTBody(r)?n(this._getContTBody(r)[0].rows[t].cells[i]):null},getRange:function(i,r,u){r=this._getSheetIndex(r);i=this._getRangeArgs(i,"object",r);var l=i[0],e=i[1],h=i[2],f=i[3],o,y,c,s,a,w,v,p=[],b=this.getSheet(r);if(c=(this.isImport||this.model.isImport||b._isImported)&&this._detachTable?n(this._detachTable[0].tBodies[1].rows):n(this._getContTBody(r)[0].rows),l>h&&(a=l,l=h,h=a),e>f&&(a=e,e=f,f=a),this.model.scrollSettings.allowVirtualScrolling)for(o=l;o<=h;o++)y=this._getRowIdx(o),y>-1&&(s=n(c[y].cells),v=f===e?[s[f]]:this._browserDetails.version==="8.0"?s.slice(e,f+1).toArray():s.slice(e,f+1),t.merge(p,v));else for(c=h!==l?c.slice(l,h+1):c.eq(h),w=c.length,o=0;o<w;o++)u&&this._isHiddenRow(o,r)||(s=n(c[o].cells),v=f===e?[s[f]]:this._browserDetails.version==="8.0"?s.slice(e,f+1).toArray():s.slice(e,f+1),t.merge(p,v));return n(p)},getRangeIndices:function(n){n=n.indexOf(":")===-1?n+":"+n:n;n=n.replace(/\$/g,"");var r=n.split(":"),t,i=[];return t=r[0].split(/[A-Z]/i),i.push(parseInt(t[t.length-1])-1),i.push(this._generateColCount(r[0].split(/[0-9]/)[0].toUpperCase())-1),t=r[1].split(/[A-Z]/i),i.push(parseInt(t[t.length-1])-1),i.push(this._generateColCount(r[1].split(/[0-9]/)[0].toUpperCase())-1),this.swapRange(i),i},swapRange:function(n){return n[0]>n[2]&&t.dataUtil.swap(n,0,2),n[1]>n[3]&&t.dataUtil.swap(n,1,3),n},updateRange:function(n,t){this._updateRangeValue(n,t,!t.range)},_updateRangeValue:function(n,t,r){var h;if(!this.model.isReadOnly){var e,s,c,l,w,a,v,f,y,u=[],p=[],o=t.dataSource,b=o.length,k=this.getObjectLength(o[0]);if(v=t.startCell,t.range?u=t.range:(a=v.split(/[A-Z]/i),u.push(parseInt(a[a.length-1])-1),u.push(this._generateColCount(v.split(/[0-9]/)[0].toUpperCase())-1),u.push(u[0]+b-(t.showHeader?0:1)),u.push(u[1]+k-1)),f=this._getSelectedRange({rowIndex:u[0],colIndex:u[1]},{rowIndex:u[2],colIndex:u[3]}),w=this._getContent(n),y=this._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content >table"),this.model.allowAutoCellType&&this.model.allowCellType||y.detach(),t.showHeader)for(l in o[0])p.push(l);for(s=0;s<b;s++)if(o[s]!=i)for(l in o[0])p.push(o[s][l]);for(this._dupDetails=!0,e=0,c=f.length;e<c;e++)this.XLEdit._updateCell(f[e],p[e],n),t.showHeader&&e<k&&(u=t.startCell+":"+(this._generateHeaderText(f[f.length-1].colIndex+1)+(f[0].rowIndex+1)),t.headerStyles&&this.XLFormat.format({style:t.headerStyles},u));if(r&&(this.model.sheets[n].rangeSettings.push(t),this._initRangeSettings(n),t.count=t._jsonData.length,this._isPublic=!0,this._initDataRange(n),this._isPublic=!1),this._dupDetails=!1,this.model.allowAutoCellType&&this.model.allowCellType||w.find(".e-content").append(y),this._isUndoRedo||(h={sheetIndex:n,reqType:"update-range",rangeSettings:t,isHighlightData:!1},this._completeAction(h),this._trigActionComplete(h)),h.isHighlightData&&(this._pushHighlightData([f[0].rowIndex,f[0].colIndex,f[f.length-1].rowIndex,f[f.length-1].colIndex]),this.XLClipboard._highLightRange.length&&h.operation!="hl-data")){for(c=this.XLClipboard._highLightRange.length,e=0;e<c;e++)this.XLValidate.highlightInvalidData(this.XLClipboard._highLightRange[e]);this.XLClipboard._highLightRange=[]}}},editRange:function(t,i){var o,s,v,r,y,u,a,h,f=this.getActiveSheetIndex(),e=this.getSheet(f).rangeSettings[t],c=this.getRangeIndices(e.range),l=this.getRange(c);for(this._trigger("editRangeBegin",{range:e,sheetIndex:f}),e.cssClass&&l.addClass(e.cssClass),e.readOnly&&l.addClass("e-readonly"),y=this._getContent(f),a=this._getJSSheetContent(f).find(".e-spreadsheetcontentcontainer > .e-content >table"),a.detach(),o=0,v=l.length;o<v;o++)r=l[o],h=n(r),n.trim(t).length&&this.XLEdit._updateDataContainer({rowIndex:r.parentNode.rowIndex,colIndex:r.cellIndex},{dataObj:{range:t}}),u=i(r,r.cellIndex,o),typeof u=="string"?this.XLEdit._updateCell({rowIndex:r.parentNode.rowIndex,colIndex:r.cellIndex},u):typeof u=="object"&&(u.Value.indexOf("=")!==0?this.XLEdit._updateCell({rowIndex:r.parentNode.rowIndex,colIndex:r.cellIndex},u.Value):this.XLEdit._updateCellValue({rowIndex:r.parentNode.rowIndex,colIndex:r.cellIndex},u.Value),h.data("value2",u.Value2),h.data("type",u.NumberFormat),u.StyleIndex>1&&h.addClass(this._styleColl[u.StyleIndex]));for(y.find(".e-content").append(a),s=c[0];s<c[2]+1;s++)this._setRowHdrHeight(f,s);this._trigger("editRangeComplete",{range:e,sheetIndex:f});this.XLScroll._getRowHeights(f,c[0])},removeRange:function(n){this.clearRange(n);delete this.getSheet(this.getActiveSheetIndex()).rangeSettings[n]},clearRange:function(n){if(!this.model.isReadOnly){var r,t,i=this.getSheet(this.getActiveSheetIndex()).rangeSettings[n];r=this.getRangeIndices(i.range);t=this.getRange(r);i.cssClass&&t.removeClass(i.cssClass);i.readOnly&&t.removeClass("e-readonly");this.clearRangeData(null,["range","value","type","value2"],t);t.empty()}},getObjectLength:function(n){var t,i=0;if(n=Object.prototype.toString.call(n)===Object.prototype.toString()?n:{},Object.keys)return Object.keys(n).length;for(t in n)n.hasOwnProperty(t)&&i++;return i},getObjectKeys:function(n){var t,i=[];if(n=Object.prototype.toString.call(n)===Object.prototype.toString()?n:{},!Object.keys){for(t in n)n.hasOwnProperty(t)&&i.push(t);return i}if(Object.keys)return Object.keys(n)},toArrayLowerCase:function(n){for(var t=0;t<n.length;t++)n[t]=n[t].toString().toLowerCase();return n},_isValueAlreadyExist:function(n,t,i){for(var r=0,u=n.length;r<u;){if(n[r][t]===i)return!0;r++}return!1},addClass:function(n,t){if(n&&n.localName!=="svg"&&n.localName!=="path"&&n.localName!=="rect"){(n instanceof jQuery||n instanceof Array)&&(n=n[0]);var i=n.className;i.indexOf(t)===-1&&(n.className=i+" "+t)}},_removeClass:function(n,t){n&&((n instanceof jQuery||n instanceof Array)&&(n=n[0]),n.className=t?n.className.replace(new RegExp(t,"g"),"").replace(/ +/g," "):"")},_hasClass:function(n,t){return n?((n instanceof jQuery||n instanceof Array)&&(n=n[0]),!n||this._isAnimatedString(n.className))?!1:n.className.indexOf(t)>-1:!1},isUndefined:function(n){return n===i},_isString:function(n){return typeof n=="string"},_isEmptyString:function(n){return!n.toString().length},_isObject:function(n){return typeof n!="object"?!1:Object.prototype.toString.call(n)==="[object Object]"},_getObjectValues:function(n){var t,i=[];n=Object.prototype.toString.call(n)===Object.prototype.toString()?n:{};for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);return i},_isAnimatedString:function(n){return Object.prototype.toString.call(n)==="[object SVGAnimatedString]"},_isBool:function(n){return n=n+"",n=n.toUpperCase(),n==="TRUE"||n==="FALSE"},isRange:function(n){return n&&(n[0]!==n[2]||n[1]!==n[3])},_isMultiRange:function(n){return!this._isString(n)&&!this.isNumber(n[0])},inRange:function(n,t,i){return n&&t>=n[0]&&t<=n[2]&&i>=n[1]&&i<=n[3]},_inRow:function(n,t){return n&&t>=n[0]&&t<=n[2]},_inColumn:function(n,t){return n&&t>=n[1]&&t<=n[3]},_isUniqueRange:function(n,t){return n.toString()===t.toString()},_isUniqueTarget:function(n,t){var i=this._getOriginalEvt(t),r=document.elementFromPoint(i.clientX,i.clientY);return n.target===r},_getClientDiff:function(n,t){return{x:n[0]-t[0],y:n[1]-t[1]}},hasSpan:function(n){return this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"merge")?!0:!1},_isFrozen:function(n){return n>0},_isSelected:function(t){return this._hasClass(t,"e-selected")||this._hasClass(t,"e-rowselected")||this._hasClass(t,"e-colselected")||n(t).parents(".e-colselected").length?!0:!1},_getMergedIdx:function(n,t){var u,e,o,s,h,i,c,l,a,f=this.getActiveSheetIndex(),r=this.XLEdit.getPropertyValue(n,t,"merge",f);if(l=a=0,r){if(r.mRange){if(u=this.getRangeIndices(r.mRange),c=this.getSheet(f),c.hideRowsCollection.length&&(e=u[0],o=u[2],o-e>1))for(i=e+1;i<o;)this.XLEdit.getPropertyValue(i,0,["isRHide"],f)&&l++,i++;if(this.getObjectLength(c.hideColsCollection)&&(s=u[1],h=u[3],h-s>1))for(i=s+1;i<h;)this.XLEdit.getPropertyValue(0,i,["isCHide"],f)&&a++,i++}if(r.mSpan)return{rowIndex:n+r.mSpan.rowSpan+l-1,colIndex:t+r.mSpan.colSpan+a-1}}return{rowIndex:n,colIndex:t}},_getMergeParent:function(n,t){var i=this.XLEdit.getPropertyValue(n,t,"mergeIdx");return i?{rowIndex:i.rowIndex,colIndex:i.colIndex}:{rowIndex:n,colIndex:t}},_getCellInfo:function(n,t){var i=this.getSheet(this._getSheetIndex(t)),s,h,u,f=0,e=0,o,r;if(s=this.model.allowFreezing&&n.rowIndex>=i._frozenRows?i._rowHeightCollection[n.rowIndex]-(i._rowHeightCollection[i._ftopRowIdx]-i._rowHeightCollection[i._frozenRows-1]):i._rowHeightCollection[n.rowIndex],h=this.model.allowFreezing&&n.colIndex>=i._frozenColumns?i._colWidthCollection[n.colIndex]-(i._colWidthCollection[i._fleftColIdx]-i._colWidthCollection[i._frozenColumns-1]):i._colWidthCollection[n.colIndex],u=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"merge"),u){for(o=u.mSpan,r=0;r<o.rowSpan;r++)e+=i.hideRowsCollection.indexOf(n.rowIndex+r)===-1?i.rowsHeightCollection[n.rowIndex+r]:0;for(r=0;r<o.colSpan;r++)f+=i.columnsWidthCollection[n.colIndex+r]}else e=i.hideRowsCollection.indexOf(n.rowIndex)===-1?i.rowsHeightCollection[n.rowIndex]:0,f=i.columnsWidthCollection[n.colIndex];return{top:s-1,left:h-1,height:e,width:f}},_getRowIdx:function(n,t,i,r){var u,f=this.getSheet(t);return i?(u=f._rowIdxColl[n],n=this.isUndefined(u)?f._rowIdxColl[f._rowIdxColl.length-1]:u):r?(u=f._rowIdxColl.indexOf(n),n=u===-1?n:u):this.model.scrollSettings.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&(n=f._virtualRowIdx.indexOf(n)),n},_getMinRowIdx:function(n){for(var t=0;t<n.rowCount;t++)if(n.hideRowsCollection.indexOf(t)===-1&&n._hiddenFreezeRows.indexOf(t)===-1)return t;return 0},_arrayAsString:function(n){return n.join(" ").replace(/,/g," ")},_rangeHasData:function(n){var t,i,r;for(n=this.swapRange(n),t=this._getSelectedRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]}),i=t.length;i--;)if(r=t[i],this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex))return!0;return!1},_isTableRange:function(n,t,i){i=this._getSheetIndex(i);var r,u=this.getSheet(i).tableManager;for(r in u)if(this.inRange(u[r].range,n,t))return!0;return!1},_hasCellStyle:function(n,t,i){for(var r,u=["borders","formats"],f=u.length;f--;)if(r=this.XLEdit.getPropertyValue(n,t,u[f],i),r)return!0;return!1},_isHiddenRow:function(n,t){return this.XLEdit.getPropertyValue(n,0,"isFilterHide",t)||this.XLEdit.getPropertyValue(n,0,"isRHide",t)||!1},_refreshViewVar:function(n,i,r){r=this._getSheetIndex(r);var u=this.getSheet(r);t.isNullOrUndefined(n)||(u._topRow.idx=this.XLShape._getCellIndexFromOffset(n,null,r).rowIndex,u._topRow.value=this._getRowOffsetTop(u,u._topRow.idx),u._bottomRow.idx=u._rowIdxColl[u._topRow.idx+(u._virtualBlockRowCnt-this._bufferCnt-1)],u._bottomRow.value=this._getRowOffsetTop(u,u._bottomRow.idx),u.topLeftCell=this.getAlphaRange(u._topRow.idx,u._leftCol.idx));t.isNullOrUndefined(i)||(u._leftCol.idx=this.XLShape._getCellIndexFromOffset(null,i,r).colIndex,u._leftCol.value=this._getColOffsetLeft(u,u._leftCol.idx),u._rightCol.idx=this.XLShape._getCellIndexFromOffset(null,i+u._vPortWth,r).colIndex||u.colCount-1,u._rightCol.value=this._getColOffsetLeft(u,u._rightCol.idx),u.topLeftCell=this.getAlphaRange(u._topRow.idx,u._leftCol.idx))},_getFormatString:function(n,i){var r=t.Spreadsheet.CellFormat[n];return this.isNumber(i)&&!t.isNullOrUndefined(r)&&(r="{0:"+r.substr(3,1)+i+"}"),r||""},_refreshVrtlBlocks:function(n){n=this._getSheetIndex(n);for(var r,u,f=["_virtualTopTBodyOffset","_virtualContTBodyOffset","_virtualBottomTBodyOffset"],t=this.getSheet(n),i=u=0;i<3;)(i||t._isVirtualTopReached)&&i!==1&&(i!==2||t._isVirtualEndReached)||(r=t._virtualRowIdx[u],t[f[i]].top=this._getRowOffsetTop(t,r),u+=t._virtualBlockRowCnt,r=t._virtualRowIdx[u-1],t[f[i]].bottom=this._getRowOffsetBottom(r,n)),i++;t._virtualTBodyHgt=t._rowHeightCollection[t._rowHeightCollection.length-1]+t.rowsHeightCollection[t.rowsHeightCollection.length-1]},getRangeDataAsObject:function(n,i,r){var f,s,e,h,c,w=t.Spreadsheet.CellType,o=this._dataContainer,l=o.sheets[this.getActiveSheetIndex()],u,a,v,y,b=[],k=[],p=[];for(n.rowIndex>i.rowIndex?(u=i.rowIndex,a=n.rowIndex):(u=n.rowIndex,a=i.rowIndex),n.colIndex>i.colIndex?(v=i.colIndex,y=n.colIndex):(v=n.colIndex,y=i.colIndex);u<=a;){if(!r||!this._isHiddenRow(u)){for(h={},c={},f=v;f<=y;f++)s=this._generateHeaderText(f+1),u in l&&f in l[u]&&(e=l[u][f],h[s]=o.sharedData[e.value],c[s]=[w.General,w.Text].indexOf(o.cellType[e.type])===-1?e.value2:o.sharedData[e.value2]);b.push(h);k.push(c)}u++}return p.push(b),p.push(k),p},getRangeDataAsJSON:function(n,i,r,u){var o,y,f,l,s=t.Spreadsheet.CellType,h=this._dataContainer,c=h.sheets[u?u:this.getActiveSheetIndex()],e,p,w,b,k=[],v=!0,d=[],a;for(n.rowIndex>i.rowIndex?(e=i.rowIndex,p=n.rowIndex):(e=n.rowIndex,p=i.rowIndex),n.colIndex>i.colIndex?(w=i.colIndex,b=n.colIndex):(w=n.colIndex,b=i.colIndex);e<=p;){if(!r||!this._isHiddenRow(e)){for(l={},o=w;o<=b;o++)v?e in c&&o in c[e]&&(f=c[e][o],d[o]=this.isUndefined(f.type)||[s.General,s.Text].indexOf(h.cellType[f.type])!==-1?h.sharedData[f.value2]:f.value2):(y=d[o],e in c&&o in c[e]?(f=c[e][o],a=this.isUndefined(f.type)||[s.General,s.Text].indexOf(h.cellType[f.type])!==-1?h.sharedData[f.value2]:[s.Currency,s.Accounting,s.Percentage].indexOf(h.cellType[f.type])>-1?h.sharedData[f.value]:f.value2,l[y]=t.isNullOrUndefined(a)?"":this.isNumber(a)?parseInt(a):a):l[y]="");!v&&this.getObjectLength(l)&&k.push(l)}e++;v&&(v=!1)}return k},_getColorFromFormat:function(n){var r=[],i,u,f;return t.isNullOrUndefined(n)||(i=n.replace("e-format","").toLowerCase(),u=i.startsWith("6n")?"#"+i.substr(2,6):"#"+i.substr(6,6),f="#"+i.substr(0,6),r.push(f),r.push(u)),r},getRangeData:function(i){var r,f;i=i||{};i.sheetIdx=this._getSheetIndex(i.sheetIdx);r=this.getSheet(i.sheetIdx);i.range=this._toIntrnlRange(i.range,i.sheetIdx);f=this.getDataSettings(i.sheetIdx);r._isLoaded||!f||r._hasDataSrc||(f[0].count=f[0]._jsonData.length,this._initDataRange(i.sheetIdx),this._refreshRowColCnt(i.sheetIdx),this._initViewPort(i.sheetIdx),this._refreshDataSrc(i.range,i.sheetIdx),r._renderedRange=n.extend(!0,r._renderedRange,r._virtualDataLoadedBlks),r._hasDataSrc=!1);i.property=i.property||["value","value2","type","formatStr","decimalPlaces","thousandSeparator","range","format","border","comment","hyperlink","picture","cFormatRule","rule","chart","isLocked","wrap","formats","cellType","altTxt"];var h=0,v,y,u,e,c,l,o,a=[],s=[];if(i.rowIdxs)for(v=i.rowIdxs.length;h<v;)this._pushRowData(i,i.rowIdxs[h],0,r.colCount-1,s,a),h++;else for(o=!1,this.model.scrollSettings.allowVirtualScrolling&&i.skipHiddenRow&&!t.isNullOrUndefined(i.virtualRowIdx)?(o=!0,u=i.virtualRowIdx,e=u+(i.virtualRowCount-1),c=r.colCount-1):(u=i.range[0],e=i.range[2],c=i.range[3]);u<=e;)l=this._isHiddenRow(u,i.sheetIdx),o&&l?e++:i.skipHiddenRow&&l||(y=o?0:i.range[1],this._pushRowData(i,u,y,c,s,a,!0)),u++;return i.withRowIdx?{rowIdx:a,data:s}:s},_pushRowData:function(n,t,i,r,u,f,e){var o,h,c,s,a,v="value",p=this._intrnlUpdate,y=this._dataContainer,l=y.sheets[n.sheetIdx];if(e||this.XLEdit._refreshContainer(t,n.sheetIdx),l[t])if(n.valueOnly)while(i<=r)o="",s=l[t][i],s&&v in s&&(a=y.sharedData,o=a[s[v]],n.skipDateTime&&this._isDateTime(o)?o=this.XLEdit.getPropertyValue(t,i,"value2",n.sheetIdx):n.skipFormula&&this.isFormula(o)&&(o=this.XLEdit.getPropertyValue(t,i,"calcValue",n.sheetIdx)||this.XLEdit.getPropertyValue(t,i,"value2",n.sheetIdx),this.isUndefined(o)&&(o=this.XLEdit.getPropertyValue(t,i,"value2",n.sheetIdx),o=this.XLEdit._parseValue(o).value))),n.skipEmptyCell&&(this.isUndefined(o)||!o.toString().length)||u.push(o),i++;else{for(this._intrnlUpdate=!0;i<=r;){if(s=l[t][i],s){h={};for(c in s)n.property.indexOf(c)>-1&&(h[c]=this.XLEdit.getPropertyValue(t,i,c,n.sheetIdx));(!n.skipEmptyCell||this.getObjectLength(h))&&u.push(h)}else n.skipEmptyCell||u.push({});i++}this._intrnlUpdate=p}else if(!n.skipEmptyCell)while(i<=r)n.valueOnly?u.push(""):u.push({}),i++;f.push(t)},_processBindings:function(n){if(this.model.query=new t.Query,this._trigger("actionBegin",n))return!0;if(this._ensureDataSource(n),n.action==="sorting"){if(this.XLSort._sortComplete(n),this._isUndoRedo||(this._completeAction(n),this._trigActionComplete(n)),n.isHighlightData&&(this._pushHighlightData([n.range[0],n.range[1],n.range[2],n.range[3]]),this.XLClipboard._highLightRange.length&&n.operation!="hl-data")){for(var i=0,r=this.XLClipboard._highLightRange.length;i<r;i++)this.XLValidate.highlightInvalidData(this.XLClipboard._highLightRange[i]);this.XLClipboard._highLightRange=[]}}else this._completeAction(n),this._trigActionComplete(n)},_ensureDataSource:function(n){var r,v,o,u,s,h,f,c,l=this.getActiveSheetIndex(),a=this.getSheet(l),e,y;if(n.action==="filtering"||n.action==="clearfiltering"||n.requestType==="filterbycell"){for(r=a.filterSettings.filteredRange==null?this._dataSource(l):a.filterSettings.filteredRange,c=a.filterSettings.tableRange,e=0,y=c.length;e<y;e++)if(c[e].tableID===n.tableID){c[e].filteredRange=r;break}if(this._dataManager=t.DataManager(r),r instanceof t.DataManager||(this.model.currentViewData=r),this.model.query.requiresCount(),n.filteredcolumns.length){s=this._excelFilter._predicates[l];v=r[0];for(o in s)v.hasOwnProperty(o)&&(h=s[o]),h=s[o],u=u!=i?u.and(h):h;t.isNullOrUndefined(u)||this.model.query.where(u);r instanceof t.DataManager||(f=this._dataManager.executeLocal(this.model.query),this._filteredRecordsCount=f.count,this.model.currentViewData=f.result)}}else n.requestType==="sorting"&&(this._dataManager=t.DataManager(n.rangeData),n.rangeData instanceof t.DataManager||(this.model.currentViewData=n.rangeData),this.model.query.sortBy(n.columnName,n.sortDirection),n.rangeData instanceof t.DataManager||(f=this._dataManager.executeLocal(this.model.query),this.model.currentViewData=f));this._dataManager=null},_toArrayData:function(n){for(var u,t,i=0,r=[],f=n.length;i<f;){if(t=n[i],this.getObjectLength(t))for(u in t)r.push(t[u]);else r.push("");i++}return r},_updateRangeStyle:function(n,t,i){for(var u=this._getSelectedRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]}),r=0;r<u.length;r++)this.model.allowCellFormatting&&this.XLFormat._hasFormat(t[r].format)&&(this.XLFormat._updateFormatClass(u[r],t[r].format),this.XLEdit._updateDataContainer(u[r],{dataObj:{formats:t[r].formats},sheetIdx:this.getActiveSheetIndex(),status:i}))},updateRangeData:function(n,i){var u,f,r;if(!this.model.isReadOnly&&(n=this._getRangeArgs(n,"object"),n.length&&(n.startCell={rowIndex:n[0],colIndex:n[1]},n.endCell={rowIndex:n[2],colIndex:n[3]}),u=this._getSelectedRange(n.startCell,n.endCell),f=this._toArrayData(i),f.length===u.length))for(r=0;r<u.length;r++)t.isNullOrUndefined(f[r])||this.XLEdit._updateCellValue(this.getCell(u[r].rowIndex,u[r].colIndex),f[r])},dataSource:function(n,t){var r=this.getActiveSheetIndex(),i=this.getSheet(r),u,f,e;if(this._isDataSrcMethod=!0,n.dataSource)for(i.rangeSettings=[],i._virtualDataLoadedBlks=[],i._virtualRowIdx=[],i.dataSource=n,i._dataManager=n,this._isInitLoad=!0,this.model.allowOverflow=!1,i._isVPRendered=!1,i.fieldAsColumnHeader=t||!1,u=this.getDataSettings(r),u._dataManager=n,f=0,e=u.length;f<e;)this._initDataSrc(r,i,u[f]),f++;else i.rangeSettings=[{dataSource:n}],i._isVPRendered=!1,i._virtualRowIdx=[],this._dataContainer.sheets[r]={},i.fieldAsColumnHeader=t||!1,this._initRangeSettings(r),i.rangeSettings[0].count=i.rangeSettings[0]._jsonData.length,i._virtualDataLoadedBlks=[],this.model.scrollSettings.allowScrolling?this._refreshContent(r):this.model.scrollSettings.allowScrolling||(this._initDataRange(r),this._setScrolling(this.model.scrollSettings.allowScrolling)),this.model.scrollSettings.allowVirtualScrolling?this._setVirtualScrolling(!0):this.model.scrollSettings.allowVirtualScrolling||(this._initDataRange(r),i._isDataMoved=!0,this._canOverflow=!1,this._refreshDataSrc(null,r),this._refreshCellData(null,r),this._canOverflow=!0,this._refreshOverflow(),this._setVirtualScrolling(!1));this._isAutoWHMode&&this._setElemDimension()},_setElemDimension:function(){var n=this._getElementDimension();this.element.css({height:n.height,width:n.width})},updateData:function(n,i,r){var s;if(!this.model.isReadOnly){var f,y,e,p,a,o,v,w,u,c,b=0,k="clear-format",h={},l=this._cellProp,d=this.getActiveSheetIndex();for(i=this._getRangeArgs(i,"object"),f=i[0],y=i[2],p=i[3];f<=y;){for(e=i[1];e<=p;){if(u=n[b],w=u.value,o=this.getCell(f,e,d),"wrap"in u&&(v=!0,delete u.wrap),this._ddCellSave){if(s={cellIndex:{rowIndex:f,colIndex:e},value:u.value,sheetIdx:d,reqType:"drag-drop"},this._trigger("cellSave",s))return;s.value?u.value=s.value:delete u.value;w!=s.value&&(u.value2=s.value&&s.value.toString())}this.XLEdit._updateDataContainer({rowIndex:f,colIndex:e},{dataObj:u});v&&this.setWrapText("wrap",i);v=!1;o&&(l[13]in u&&(c=u.hyperlink,c&&(r===k?o.find("a").css({color:this._hlColor,"text-decoration":"underline"}).addClass("e-hyperlinks"):c.webAddr?o.html(t.buildTag("a",u.value2,"",{href:c.webAddr,target:"_blank","class":"e-hyperlinks"})):o.html(t.buildTag("a",u.value2,"",{"class":"e-hyperlinks"})))),l[6]in u&&(u.rule.isApply?this.addClass(o[0],"e-hlcell"):this._removeClass(o[0],"e-hlcell")),r===k&&(u.formatStr&&(h.formatStr=u.formatStr),u.type&&(h.type=u.type),t.isNullOrUndefined(u.decimalPlaces)||(h.decimalPlaces=u.decimalPlaces),t.isNullOrUndefined(u.thousandSeparator)||(h.thousandSeparator=u.thousandSeparator),this.XLFormat.format(h,[f,e,f,e])),l[21]in u&&this.XLComment._updateCmntFrmCntnr(f,e),l[0]in u&&(a=u.value,this.XLEdit._refreshCalcEngine(f,e,this.isFormula(a),a)));b++;e++}f++}}},updateUniqueData:function(n,t,i,r){if(!this.model.isReadOnly){t=this._getRangeArgs(t,"object");var u,f={dataObj:n},e=t[0],o=t[2],s=t[3];for(i&&(f.skipCell=i),f.sheetIdx=r;e<=o;){for(u=t[1];u<=s;)this.XLEdit._updateDataContainer({rowIndex:e,colIndex:u},f),u++;e++}}},_getCellValue:function(n,t,i){var u=this._dataContainer,f=this._dataContainer.sharedData,i=i?i:this.getActiveSheetIndex(),r=u.sheets[i][n]&&u.sheets[i][n][t];return{value:r&&r.value&&f[r.value],value2:r&&r.value2&&f[r.value2]}},clearRangeData:function(n,i,r,u,f,e){if(!this.model.isReadOnly){var s,h,a,v,c=this.getActiveSheetIndex(),o,y,l;for(n=this._getRangeArgs(n,"object",c),i=i?i:["value","value2","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","isFilterHighlight"],s=n[0],a=n[2],v=n[3];s<=a;){if(!u||!this._isHiddenRow(s))for(h=n[1];h<=v;){if(o={rowIndex:s,colIndex:h},l=this._getCellValue(o.rowIndex,o.colIndex).value,this._overFlowRowIdx=!0,this._isTrigCellSave&&l!=""&&!t.isNullOrUndefined(l)&&i.indexOf("value")>-1&&(y={cellIndex:o,value:"",prevValue:this._getCellValue(o.rowIndex,o.colIndex).value,sheetIdx:c,reqType:"clear"},this._trigger("cellSave",y)))return;this.XLEdit._clearDataContainer({cellIdx:{rowIndex:o.rowIndex,colIndex:o.colIndex},property:i,status:f,skipCell:e});h++}this._overFlowRowIdx=!1;i.indexOf("wrap")>-1&&this._setRowHdrHeight(c,s);s++}this._isTrigCellSave=!1}},_getArrayRangeCells:function(n){return n?(n=this.swapRange(n),this.getRange(n)):this._getContent(this.getActiveSheetIndex()).find(".e-selected")},_getAlphaRangeCells:function(n,t){return n?(n=this.getRangeIndices(n),this.getRange(n,t)):this._getContent(this.getActiveSheetIndex()).find(".e-selected")},_getMultiRangeCells:function(n){var i,t,u,r,f;if(n){if(i=0,u=[],r=[],this._isString(n))r.push(this.getRangeIndices(n));else if(this.isNumber(n[0]))r.push(n);else for(f=n.length;i<f;)t=n[i],r.push(Array.isArray(t)?t:this.getRangeIndices(t)),i++;for(i=0,f=r.length;i<f;)t=r[i],u=u.concat(this._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]})),i++}else n=this._getRangeArgs(n,"object"),u=this._getSelectedCells(this.getActiveSheetIndex(),n).selCells;return u},_completeAction:function(n){var v,u=this.getActiveSheetIndex(),e=this.getSheet(u),i,o,s,y,p,h,c,l,r,f,a;if(n.reqType==="filter"||n.reqType==="filterbycolor"){if(n.operation!=="apply-filter"&&n.operation!=="remove-filter"&&n.operation!=="clearfilter")for(s=n.model.currentViewData,i={sheetIndex:u,range:e._selectedRange,currentViewData:s,fieldName:n.currentFilteringColumn,ejpredicate:n.ejpredicate,activeCell:n.activeCell,filteredValue:n.filteredValue,filterCollection:n.filteredcolumns,requestType:n.requestType,reqType:n.reqType,selectedCell:n.selectedCell,action:n.action,operation:"filter",selectedDataSource:e.selectedDataSource,tableID:n.tableID,filteredCells:n.filteredCells,fltrdIdxes:[],selRange:n.selRange},r=0,v=s.length;r<v;r++)i.fltrdIdxes.push(i.range.startRow+e.filterSettings.filteredRange.indexOf(s[r]));else i=n.operation==="remove-filter"||n.operation==="clearfilter"?n:{sheetIndex:u,filteredCells:n.filteredCells,reqType:"filter",operation:"apply-filter",tableID:n.tableID,fRange:this.getSheet(u).filterSettings.range};i.rowIndex=n.rowIndex;i.colIndex=n.colIndex}else if(n.requestType===t.Spreadsheet.Actions.Sorting){for(l=[],c=n.filterIcon.length>0?n.range[0]-1:n.range[0],r=0;r<n.filterIcon.length;r++)h=this.XLFilter._getFilterHeader(u,c,n.filterIcon[r].colIndex),y=t.isNullOrUndefined(h)?"":h.status.indexOf("-asc")>-1?"-asc":h.status.indexOf("-dsc")>-1?"-dsc":"",p=n.filterIcon[r].colIndex===this._generateColCount(n.columnName)-1?n.sortDirection==="ascending"?"-asc":"-dsc":"",l.push({rowIdx:c,colIdx:n.filterIcon[r].colIndex,prevIcon:y,currIcon:p});i={sheetIndex:u,filterIcons:l,isSortByFilter:n.isSortByFilter,colSelected:n.colSelected,range:n.range,columnName:n.columnName,rangeData:n.rangeData,reqType:"sort",direction:n.sortDirection,operation:"unsort"}}else if(n.requestType==="sortbycolor"||n.requestType==="filterbycolor"){if(i={sheetIndex:u,operation:n.operation,oprType:n.oprType,requestType:n.requestType,action:n.action,bgcolor:n.bgcolor,fgcolor:n.fgcolor,tableID:n.tableID,reqType:n.requestType,sortRange:n.sortRange},i.columnName=n.requestType==="sortbycolor"?n.sortColumn:n.filterColumn,n.requestType==="filterbycolor"){for(a=this._generateColCount(i.columnName),o=[],r=n.range.endRow;r>=n.range.startRow;r--)f=this.XLEdit.getPropertyValue(r,a-1,"formats"),t.isNullOrUndefined(f)||(n.operation==="filterbgcolor"?t.isNullOrUndefined(f["background-color"])||n.bgcolor.toLowerCase()===f["background-color"].toLowerCase()&&o.push(r):t.isNullOrUndefined(f.color)||n.fgcolor.toLowerCase()===f.color.toLowerCase()&&o.push(r));i.fltrdIdxes=o;i.rowIndex=n.range.startRow-1;i.colIndex=a-1}}else i=n;!this.model.allowUndoRedo||this._isPublic||i.requestType==="sortbycolor"||this._dupDetails||this.updateUndoRedoCollection(i);(n.requestType==="filtering"||n.requestType==="filterbycolor"||n.requestType==="sortbycolor"||n.requestType==="filterbycell")&&n.operation!=="apply-filter"&&n.operation!=="remove-filter"&&this.sendDataRenderingRequest(i,this.getActiveSheetIndex());this.model.allowAutoFill&&n.reqType!=="find-replace"&&this.element.find(".e-ss-activeimg").length<1&&!e._isFreezed&&this.XLDragFill.positionAutoFillElement();!this.model.allowUndoRedo||this._isPublic||this.XLComment&&this.XLComment._isCommentEdit||this._updateUndoRedoIcons();n.reqType!=="paging"&&n.reqType==="edit"&&n.hasValidation&&this._trigrDdlActnCmplt(n.cValue,n.pValue)},updateUndoRedoCollection:function(n){this._isUndoRedo||n.reqType==="update-range"||(this._undoCollection.push(n),this._redoCollection=[]);this._undoCollection.length>this.undoRedoStep&&this._undoCollection.splice(0,1);this.model.showRibbon&&this.XLRibbon._updateRibbonIcons();this._updateUndoRedoIcons()},_trigActionBegin:function(n){return!this._isSaveAsJSON&&!this._isRefresh&&this._trigger("actionBegin",n)},_trigActionComplete:function(n){return!this._isSaveAsJSON&&!this._isRefresh&&this._trigger("actionComplete",n)},_updateUndoRedoIcons:function(){if(!this.model.showRibbon||!this.model.allowUndoRedo){this.XLComment&&this.XLComment._isCommentEdit||this._setSheetFocus();return}if(n("#"+this._id+"_Ribbon_Home_Actions_Undo").length&&n("#"+this._id+"_Ribbon_Home_Actions_Redo").length&&!this.model.isReadOnly){var t=n("#"+this._id+"_Ribbon_Home_Actions_Undo").data("ejButton"),i=n("#"+this._id+"_Ribbon_Home_Actions_Redo").data("ejButton");t&&(this._undoCollection.length?t.enable():t.disable());i&&(this._redoCollection.length?i.enable():i.disable());this.XLEdit._isEdit||this.XLComment&&this.XLComment._isCommentEdit||this._isSheetRename||!document.activeElement||!(document.activeElement.id.indexOf(this._id+"_Ribbon")<0)||this._setSheetFocus()}},_filterMergeCells:function(n,t){for(var s=this.getActiveSheetIndex(),h=this._dataContainer.sheets[s],e=this.getObjectKeys(h[n]),r,i,o=!1,u,f=0;f<e.length;f++)u=this.XLEdit.getPropertyValue(n,e[f],"mergeIdx"),u&&(r=u,o=!0);o&&(i=this.getCell(r.rowIndex,r.colIndex)[0],i.rowSpan=t==="incr"?i.rowSpan+1:i.rowSpan-1)},_isRowVisible:function(n,t){var i=this._dataContainer.sheets[n];return t in i?0 in i[t]&&(i[t][0].isRHide||i[t][0].isFRHide)?!1:!0:!0},_selectFirstCell:function(n,t,i,r){var u=this.getSheet(n);return u._isImported&&!u._isLoaded||r||(r=!r,this.performSelection({rowIndex:t,colIndex:i},{rowIndex:t,colIndex:i})),r},_clearAllMergeCells:function(t,i,r,u,f,e){var l,v=this.getSheet(t),p=!1,k=this._dupDetails,w,y=v._mergeColl,d=v._unmergeColl,o,c,a={isCancel:!1,isAlert:!0},s,b,h;for(this._dupDetails=!0,o=this.getObjectKeys(y),o.length<1&&(p=!0),s=0,b=o.length;s<b;s++)for(c=this.getObjectKeys(y[o[s]]),h=0;h<c.length;h++)l=n.extend(!0,{},this.XLEdit.getPropertyValue(o[s],c[h],"merge")),w=this.getRangeIndices(l.mRange),a=this._checkFilterMerge(t,w,i,r,u,f,e,"merge",p,o[s],c[h],l),a.isClear&&(o[s]in d||(v._unmergeColl[o[s]]={}),v._unmergeColl[o[s]][c[h]]={type:y[o[s]][c[h]],merge:l,isClear:!0},this.unmergeCells(l.mRange,!0)),a.isClear=!1;return this._dupDetails=k,{isCancel:a.isCancel,isAlert:a.isAlert}},_checkFilterMerge:function(n,t,i,r,u,f,e,o,s,h,c,l){var v,y=this._getSelectedCells(n,[i,u,i+r-1,u+f-1]).range,p,a=!1;return e.indexOf("shift")>-1||o!="merge"&&(e.indexOf("insert")>-1||e.indexOf("delete")>-1)?(o==="merge"&&(this._removeMergeColl=[]),e.indexOf("Bottom")>-1||e.indexOf("Up")>-1||o!="merge"&&e.indexOf("Row")>-1?(u>=t[1]||t[3]>=u+f-1||e.indexOf("Row")>-1?(i>=t[2]||i<=t[2])&&(u<t[1]&&u+f-1<t[1]?s=!0:u>t[3]&&u+f-1>t[3]?s=!0:this._isTotalRow||u!==t[1]||t[3]!==u+f-1||(a=!0,s=!0),!s&&i>=t[2]&&(s=!0)):u<t[1]&&t[3]<u+f-1&&(s=!0,a=!0),o!=="merge"||this._isUndoRedo||e.indexOf("Up")>-1&&this.XLEdit._rangeHasProperty(y,"merge")&&(this._showAlertDlg("Alert","MergePreventInsertDelete","MergePreventInsertDelete",450),a=!1,v=!0)):(e.indexOf("Right")>-1||e.indexOf("Left")>-1||o!="merge"&&e.indexOf("Column")>-1)&&(i>=t[0]||t[2]>=i+r-1||e.indexOf("Column")>-1?(u>=t[3]||u<=t[3])&&(i<t[0]&&i+r-1<t[0]?s=!0:i>t[2]&&i+r-1>t[2]?s=!0:i===t[0]&&t[2]===i+r-1&&(a=!0,s=!0),!s&&u>t[3]&&(s=!0)):i<t[0]&&t[2]<i+r-1&&(s=!0,a=!0),o!=="merge"||this._isUndoRedo||e.indexOf("Left")>-1&&this.XLEdit._rangeHasProperty(y,"merge")&&(this._showAlertDlg("Alert","CtrlKeyErrorAlert","CtrlKeyErrorAction",450),a=!1,v=!0)),o!=="merge"||s||a||this._removeMergeColl.push({type:p[h][c],merge:l})):(this._isUndoRedo&&(s=!0),(i===-1||i!=-1&&t[0]<=i&&t[2]>i)&&(a=!0),(u===-1||u!=-1&&t[1]<=u&&t[3]>u)&&(a=!0)),{isClear:a,isAlert:s,isCancel:v}},_checkTableApplied:function(n,t,i,r,u,f){var o,a=this.getSheet(n),s,h=a.tableManager,c=this.getObjectKeys(h),e,l;for(this._isTableApplied=!1,e=0,l=c.length;e<l;e++)if(s=h[c[e]].range,o=this._checkFilterMerge(n,s,t,i,r,u,f,"filter",!1),this._isTableApplied=!o.isAlert,this._isTableApplied)return!0;return!1},_checkChartApplied:function(n,t,i,r,u){for(var h=0,c=0,e,f,v=this.getSheet(n),l=v.shapeMngr.chart,a=this.getObjectKeys(l),o=!1,s=0,y=a.length;s<y;s++){for(f=l[a[s]],o=f.isChartSeries,e=f.range;h<u;){if(this._inColumn(e,i)||o&&this.XLChart._isSeriesRange(f,t,i))return!0;i++;h++}while(c<r){if(this._inRow(e,t)||o&&this.XLChart._isSeriesRange(f,t,i))return!0;t++;c++}return!1}return!1},_refreshAllMergeCells:function(n,i,r,u,f,e){var w,k,p=this.getSheet(n),v=!1,d=p._unmergeColl,nt=this._dupDetails,l,y,o,s,h,b,c,g,a;for(l=this.getObjectKeys(d),this._dupDetails=!0,c=0,g=l.length;c<g;c++)for(y=this.getObjectKeys(d[l[c]]),a=0;a<y.length;a++)w=p._unmergeColl[l[c]][y[a]].merge,this.mergeCenter=p._unmergeColl[l[c]][y[a]].type==="center",b=p._unmergeColl[l[c]][y[a]].isClear,o=this.getRangeIndices(w.mRange),(i>-1||u>-1)&&(t.isNullOrUndefined(o)||(e.indexOf("Shift")>-1?(this._unMergeRange=w.mRange,this._showAlertDlg("","MergeCellsAlert","MergeCellsInsertAlert",498)):(i>-1&&(o[0]===o[2]&&(v=!0),(!v||b)&&(s=o[0],h=o[2],i<=o[0]&&(s=e==="insert"?o[0]+r:o[0]-r),i<=o[2]&&(h=e==="insert"?o[2]+r:o[2]-r),s<=h&&(o[0]=s),h>=s&&(o[2]=h))),u>-1&&(o[1]===o[3]&&(v=!0),(!v||b)&&(s=o[1],h=o[3],u<=o[1]&&(s=e==="insert"?o[1]+f:o[1]-f),u<=o[3]&&(h=e==="insert"?o[3]+f:o[3]-f),s<=h&&(o[1]=s),h>=s&&(o[3]=h))),!v||v&&e==="insert"?(k=this._getAlphaRange(n,o[0],o[1],o[2],o[3]),this.mergeCells(k,!0),delete p._unmergeColl[l[c]][y[a]],v=!1):p._unmergeColl[l[c]][y[a]].isClear=!1)));this._dupDetails=nt},_clearMergeColl:function(n,t,i){n[t]&&delete n[t][i];this.getObjectKeys(n[t]).length<1&&delete n[t]},_refreshSHMergeCells:function(i,r,u,f,e){var y,ht,dt,gt,ni,ct,rt,ut,tt,nt,ti,c=this.getSheet(i),a,b,k=n.extend(!0,{},c._mergeColl),h,v,vt=0,p,o,lt,yt=!1,at,ii,fi=[],pt,w,d,ft,et,wt=!1,ot,st,it,bt,kt,s,ri,l,ui,g;if(h=this.getObjectKeys(k),ct=c._isFreezed?f==="column"?c._fHMergeCols:c._fHMergeRows:f==="column"?this.getObjectKeys(c.hideColsCollection):c.hideRowsCollection,e==="hide")for(s=0,ri=h.length;s<ri;s++)for(v=this.getObjectKeys(k[h[s]]),l=0,ui=v.length;l<ui;l++)if(rt=!1,p=this.XLEdit.getPropertyValue(h[s],v[l],"merge"),!(this.getObjectKeys(p).length<1)){for(o=this.getRangeIndices(p.mRange),a=f==="column"?o[1]:o[0],b=f==="column"?o[3]:o[2],y=a;y<=b;y++)if(r.indexOf(y)>-1){rt=!0;break}if(rt){if(this._dupDetails=!0,ut=r[0],tt=r[r.length-1],nt=tt-ut+1,this.mergeCenter=k[h[s]][v[l]].type==="center",it=k[h[s]][v[l]].oldRange,ot=it?it:p.mRange,this.unmergeCells(p.mRange),tt<a)a=a+nt,b=b+nt;else if(b<ut)continue;else{for(vt=0,lt=!1,pt=0,ht=r.length,y=0;y<ht;y++)r[y]>=a&&r[y]<=b&&vt++,r[y]===a&&(lt=!0),ii=f==="column"?r[y].toString():r[y],ct.indexOf(ii)>-1&&pt++;for(r.indexOf(a)>-1&&(lt=!0),at=0,g=a;g<=b;g++)f==="column"&&(g=g.toString()),ct.indexOf(g)>-1&&at++;(a===b||at===b-a+1)&&(yt=!0);lt&&!yt&&(a=a+vt+(at-pt))}ni=this.XLEdit.getPropertyValue(parseInt(h[s]),parseInt(v[l]),"value2");w=f==="row"?a:o[0];ft=f==="row"?b:o[2];d=f==="column"?a:o[1];et=f==="column"?b:o[3];yt?h[s]in c._delmergeColl?c._delmergeColl[h[s]][v[l]]={type:k[h[s]][v[l]].type,merge:p,oldRange:ot}:(c._delmergeColl[h[s]]={},c._delmergeColl[h[s]][v[l]]={type:k[h[s]][v[l]].type,merge:p,oldRange:ot}):(w==ft&&d==et?h[s]in c._delmergeColl?c._delmergeColl[h[s]][v[l]]={type:k[h[s]][v[l]].type,merge:p,oldRange:ot}:(c._delmergeColl[h[s]]={},c._delmergeColl[h[s]][v[l]]={type:k[h[s]][v[l]].type,merge:p,oldRange:ot}):this.mergeCells(this._getAlphaRange(i,w,d,ft,et),!0),c._mergeColl[w]&&c._mergeColl[w][d]&&(c._mergeColl[w][d].oldRange=ot),this._updateMergeColl(i,w,d,k[h[s]][v[l]].type,e==="hide"),(tt+1===w&&f==="row"||tt+1===d&&f==="column")&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(w,d))&&(this.XLEdit.updateCellValue({rowIndex:w,colIndex:d},ni),c._wrapColl[parseInt(h[s])]&&c._wrapColl[parseInt(h[s])][parseInt(v[l])]&&(this._wrapCollection(w,d,c._wrapColl[parseInt(h[s])][parseInt(v[l])],i),this._isRowViewable(i,w)?fi.push({rowIndex:w,height:c.rowsHeightCollection[parseInt(h[s])]}):c.rowsHeightCollection[w]=c.rowsHeightCollection[parseInt(h[s])])));this.mergeCenter=!1}}if(e==="show")for(this.getObjectLength(c._delmergeColl)>0&&(k=n.extend(!0,k,c._delmergeColl)),h=this.getObjectKeys(k),dt=h.length,s=0;s<dt;s++)for(v=this.getObjectKeys(k[h[s]]),gt=v.length,l=0;l<gt;l++){if(rt=!1,ti=k[h[s]][v[l]].mergeType,p=k[h[s]][v[l]].merge,this.getObjectKeys(p).length<1&&(p=this.XLEdit.getPropertyValue(h[s],v[l],"merge")),this.getObjectKeys(p).length>0){for(o=this.getRangeIndices(p.mRange),a=f==="column"?o[1]:o[0],b=f==="column"?o[3]:o[2],it=k[h[s]][v[l]].oldRange,it?(st=this.getRangeIndices(it),bt=f==="column"?st[1]:st[0],kt=f==="column"?st[3]:st[2]):(bt=a,kt=b),ut=r[0],tt=r[r.length-1],y=ut;y<=tt;y++)if(y>=bt&&y<=kt){rt=!0;break}if(!rt)continue;for(ti==="merge-cells"&&(this._dupDetails=!0,nt=tt-ut+1,tt<a&&(this.mergeCenter=p.isCenterAlign,this.unmergeCells(p.mRange),nt!=u&&(b=b-nt),a=a-nt,w=f==="row"?a:o[0],ft=f==="row"?b:o[2],d=f==="column"?a:o[1],et=f==="column"?b:o[3],w==ft&&d==et||this.mergeCells(this._getAlphaRange(i,w,d,ft,et),!0),this._updateMergeColl(i,w,d,k[h[s]][v[l]].type,e==="hide"),c._mergeColl[w][d].oldRange=it)),wt=!1,ht=r.length,y=0;y<ht;y++)if(f==="row"&&o[0]<=r[y]||f==="column"&&o[1]<=r[y]){wt=!0;break}if(wt){for(this.mergeCenter=p.isCenterAlign,this.unmergeCells(p.mRange),o=this.getRangeIndices(p.mRange),nt=0,g=a;g<=b;g++)if(f==="column"&&(g=g.toString()),ct.indexOf(g)>-1)nt++;else break;a=a+nt;f==="column"?o[1]=a:o[0]=a;o[0]==o[2]&&o[1]==o[3]||this.mergeCells(this._getAlphaRange(i,o[0],o[1],o[2],o[3]),!0);this._updateMergeColl(i,o[0],o[1],k[h[s]][v[l]].type,!0);c._mergeColl[o[0]][o[1]].oldRange=it;o[0]==o[2]&&o[1]==o[3]||this._clearMergeColl(c._delmergeColl,h[s],v[l])}}this.mergeCenter=!1}this.model.showRibbon&&this._isScrolling&&this.XLRibbon._updateRibbonIcons();this._dupDetails=!1},_getSpanFromMCells:function(n,t,i){var u=this.getSheet(this.getActiveSheetIndex()),r=u._hideMergeColl;return!this.isUndefined(r[n])&&!this.isUndefined(r[n][t])?i==="row"?r[n][t].rowspan:r[n][t].colspan:0},_setSpanToMCells:function(n,t,i,r){var f=this.getSheet(this.getActiveSheetIndex()),u=f._hideMergeColl;this.isUndefined(u[n])&&(u[n]={});this.isUndefined(u[n][t])&&(u[n][t]={});i==="row"?u[n][t].rowspan=r:u[n][t].colspan=r},sendDataRenderingRequest:function(r,u){for(var s,f,it,rt=!1,nt,pt,at,ft,oi=this._rAlign,o=this.getSheet(u),g=this.model.scrollSettings.allowVirtualScrolling,e=o._selectedRange,k=[],h,dt,l=o.filteredRowsCollection,v,et,y,p=o.filterSettings.tableRange,ot=[],gt,st,b=[],ht,ti=this.getSheetElement(u)[0].querySelectorAll(".e-spreadsheetcolumnheader"),ii=n(this._getJSSheetHeader(u)[0].querySelectorAll("colgroup")[0].outerHTML).attr("id","ss"),ri=this.getSheetElement(u)[0].querySelectorAll(".e-rowheadercontent td"),vt,ct,yt,c,tt,w,wt,ni,bt,kt,d,ui,lt,fi,ei,a=0,ut=p.length;a<ut;a++)if(p[a].tableID==r.tableID){y=a;break}if(g&&(nt=o.hideRowsCollection),this._dupDetails=!0,!t.isNullOrUndefined(r)&&(r.reqType=="filter"||r.action.indexOf("clearfiltering")>-1&&r.reqType=="filterbycolor")){if(h=this._generateColCount(r.fieldName)-1,it=n.inArray(r.fieldName,o._filteredColumns),r.action.indexOf("clearfiltering")>-1?o._filteredColumns.splice(it,1):it<0&&o._filteredColumns.push(r.fieldName),e=r.range,ot=p[y].hiddenIdx,pt=r.currentViewData,r.requestType.indexOf("filtering")>-1||r.requestType.indexOf("filterbycell")>-1||r.action.indexOf("clearfiltering")===-1||r.action.indexOf("clearfiltering")>-1&&r.reqType=="filterbycolor"){for(at=o.filterSettings.filteredRange,pt.length<1&&k.push(at[at.length-1].idx+1),a=0,ut=pt.length;a<ut;a++)it=at.indexOf(pt[a]),it>-1&&k.push(at[it].idx);for(p[y].fltrdIdxes=k,v=e.startRow===0?0:e.startRow,f=v;f<=e.endRow;f++){for(ht=!1,s=0,ft=k.length;s<ft;s++)k[s]==f&&(ht=!0);ht?(t.isNullOrUndefined(this._dataContainer.sheets[u][f])||t.isNullOrUndefined(this._dataContainer.sheets[u][f][0])||(delete this._dataContainer.sheets[u][f][0].isFilterHide,delete this._dataContainer.sheets[u][f][0].filterID,o._filterHRowsColl.indexOf(f)>-1&&o._filterHRowsColl.splice(o._filterHRowsColl.indexOf(f),1)),g?(nt.indexOf(f)>-1&&(this._refreshSHMergeCells(u,[f],1,"row","show"),nt.splice(nt.indexOf(f),1)),v=f===0?0:f-1,this.XLEdit.getPropertyValue(v,0,"hRow")&&(delete this._dataContainer.sheets[u][v][0].hRow,l.indexOf(f)>-1&&l.splice(l.indexOf(f),1))):(this._dupDetails=this._isFilter=!0,this._showRow(f+1,f,i,i,ti,ii,ri),this._dupDetails=this._isFilter=!1,l.indexOf(f)>-1&&l.splice(l.indexOf(f),1),o._isImported&&!o._isLoaded||rt||(rt=!rt,this.performSelection({rowIndex:f,colIndex:h},{rowIndex:f,colIndex:h})))):(t.isNullOrUndefined(this.XLEdit.getPropertyValue(f,0,"isRHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(f,0,"isFHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(f,0,"isFilterHide"))&&(this.XLEdit._updateDataContainer({rowIndex:f,colIndex:0},{dataObj:{isFilterHide:!0,filterID:r.tableID}}),l.indexOf(f)<0&&l.push(f),et=!0),g?(et&&(nt.push(f),et=!1,this._refreshSHMergeCells(u,[f],1,"row","hide")),v=f===0?0:f-1,this.XLEdit._updateDataContainer({rowIndex:v,colIndex:0},{dataObj:{hRow:!0}}),l.indexOf(f)<0&&l.push(f)):(this._dupDetails=this._isFilter=!0,this._hideRow(f,f,"isFilterHide"),this._dupDetails=this._isFilter=!1,l.indexOf(f)===-1&&l.push(f)))}v=e.startRow===0?0:e.startRow-1;g&&(!o._isImported||o._isLoaded)&&(this.refreshContent(u),this.performSelection({rowIndex:v,colIndex:h},{rowIndex:v,colIndex:h}));!g&&this._hideRowColl.length&&(this._getRowHdrTBody(u).append(this._renderRowHdr(this._hideRowColl,u)),this._getContTBody(u).append(n(this._renderData(i,u,0,o.colCount,!1,this._hideRowColl[0],this._hideRowColl.length))),this._hideRowColl=[]);this.XLScroll._getRowHeights(u,v);r.action==="clearfiltering"&&(o._filteredByColor=-1,this._excelFilter.closeXFDialog());this.model.allowFiltering&&this.XLFilter._updateFilterIcons(v,e.startRow,h,r.action);p[y].hiddenIdx=n.extend(!0,[],ot);ot=[]}}else if(!t.isNullOrUndefined(r)&&(r.requestType==="sortbycolor"||r.requestType==="filterbycolor"))if(vt=[],yt=[],h=this._generateColCount(r.columnName)-1,r.prev={},r.cur={},r.oprType.indexOf("Put")<0&&(o._filterColl[e.startRow-1][h].status.indexOf("e-ssfilter")>-1&&r.requestType==="filterbycolor"?this._isRowViewable(u,e.startRow-1)&&(dt=this.getCell(e.startRow-1,h),dt.removeClass(oi),this.XLFilter._changeFilterIcon({rowIndex:e.startRow-1,colIndex:h},"filter",this.XLEdit.getPropertyValue(e.startRow-1,h,"filterState"))):o._filterColl[e.startRow-1][h].status.indexOf("-asc")&&(r.prev.icon=o._filterColl[e.startRow-1][h].status,this._isRowViewable(u,e.startRow-1)&&(dt=this.getCell(e.startRow-1,h),this.XLFilter._changeSortIcon({rowIndex:e.startRow-1,colIndex:h},"ascending")),r.cur.icon=o._filterColl[e.startRow-1][h].status)),r.requestType==="sortbycolor"){for(c=[e.startRow,h,e.endRow,h],tt=this.getRangeData({range:c,skipHiddenRow:!0}),ft=tt.length,a=0;a<ft;a++)ct=tt[a].formats,t.isNullOrUndefined(ct)||(r.operation==="sortbgcolor"?t.isNullOrUndefined(ct["background-color"])||r.bgcolor===ct["background-color"].toLowerCase()&&vt.push(a):t.isNullOrUndefined(ct.color)||r.fgcolor===ct.color.toLowerCase()&&vt.push(a));if((r.oprType==="PutCellColor"||r.oprType==="PutFontColor")&&(c=r.sortRange),this.isUndefined(r.tableID))for(w=[],kt=c[1];kt<=c[3];kt++)w.push(kt);else w=p[y].multifilterIdx;for(c=[e.startRow,w[0],e.endRow,w[w.length-1]],tt=this.getRangeData({range:c,skipHiddenRow:!0}),r.prev.data=n.extend(!0,[],tt),c.colIndex=h,r.range=c,s=0,ut=w.length;s<ut;s++){for(wt=[],ni=[],c=[e.startRow,w[s],e.endRow,w[s]],tt=this.getRangeData({range:c,skipHiddenRow:!0}),bt=vt.length-1;bt>=0;bt--)wt.push(tt.splice(vt[bt],1)[0]);ni=wt.reverse().concat(tt);wt.length>0&&(this._isSort=!0,this._dupDetails=!0,this.XLComment.deleteComment(c,null,!0,null),this._removeHyperlink(null,null,!0,c),this.clearRangeData(c,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0),this.XLFormat.removeStyle(c,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0}),this._isSort=!1,this._dupDetails=!1,this.XLEdit.updateCellWithContainer(ni,c,u,!0))}c=[e.startRow,w[0],e.endRow,w[w.length-1]];r.cur.data=n.extend(!0,[],this.getRangeData({range:c,skipHiddenRow:!0}));this.updateUndoRedoCollection(r)}else{for(yt=[],ot=[],p[y].fltrdIdxes=k=r.fltrdIdxes,v=e.startRow===0?0:e.startRow,f=v;f<=e.endRow;f++){for(ht=!1,s=0,ft=k.length;s<ft;s++)k[s]==f&&(ht=!0);ht?(lt=this.XLEdit.getPropertyValue(f,h,"value2"),lt=t.isNullOrUndefined(lt)?"":lt,gt={field:r.columnName,value:lt,predicate:"or",operator:"equal",matchcase:!1},st=t.Predicate(r.columnName,"equal",lt),this.XLEdit.getPropertyValue(f,0,"filterID")===r.tableID&&(delete this._dataContainer.sheets[u][f][0].isFilterHide,delete this._dataContainer.sheets[u][f][0].filterID,g?(nt.splice(nt.indexOf(f),1),this._refreshSHMergeCells(u,[f],1,"row","show")):(this._dupDetails=this._isFilter=!0,this._showRow(f+1,f,i,i,ti,ii,ri),this._dupDetails=this._isFilter=!1,l.indexOf(f)>-1&&l.splice(l.indexOf(f),1),o._isImported&&!o._isLoaded||rt||(rt=!rt,this.performSelection({rowIndex:f,colIndex:h},{rowIndex:f,colIndex:h})))),yt.push(gt),b.push(gt),d=b[0],ui=d.from):(t.isNullOrUndefined(this.XLEdit.getPropertyValue(f,0,"isRHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(f,0,"isFHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(f,0,"isFilterHide"))&&(this.XLEdit._updateDataContainer({rowIndex:f,colIndex:0},{dataObj:{isFilterHide:!0,filterID:r.tableID}}),et=!0),g?et&&(nt.push(f),this._refreshSHMergeCells(u,[f],1,"row","hide")):(this._dupDetails=this._isFilter=!0,this._hideRow(f,f,"isFilterHide"),this._dupDetails=this._isFilter=!1,l.indexOf(f)===-1&&l.push(f)),et=!1)}for(g&&(!o._isImported||o._isLoaded)&&(this.refreshContent(u),this.performSelection({rowIndex:k[0],colIndex:h},{rowIndex:k[0],colIndex:h})),!g&&this._hideRowColl.length&&(this._getRowHdrTBody(u).append(this._renderRowHdr(this._hideRowColl,u)),this._getContTBody(u).append(n(this._renderData(i,u,0,o.colCount,!1,this._hideRowColl[0],this._hideRowColl.length))),this._hideRowColl=[]),this.XLScroll._getRowHeights(u,v),r.filterCollection=yt,st=d.ejpredicate?d.ejpredicate:t.Predicate(d.field,d.operator,d.value,!d.matchcase),s=1;s<b.length;s++)st=b[s].ejpredicate!=i?st[b[s].predicate](b[s].ejpredicate):st[b[s].predicate](b[s].field,b[s].operator,b[s].value,!b[s].matchcase);t.isNullOrUndefined(p[y].predicate[r.columnName])&&(p[y].predicate[r.columnName]={});p[y].filteredColumns=yt;p[y].predicate[r.columnName]=ui?{from:d.from,take:d.take}:st;p[y].hiddenIdx=n.extend(!0,[],ot);ot=[]}t.isNullOrUndefined(r)||r.action!=="filter"&&r.action!=="filtering"&&r.action!=="filterbycolor"?r.action==="clearfiltering"&&(r.tableID>-1&&o.filterSettings.tableRange[y].filterColumnName.pop(r.fieldName),this.XLFilter._fltrRowHighlight(e.startRow,e.endRow,"clear",r.tableID,r.filterCollection.length)):(r.tableID>-1&&o.filterSettings.tableRange[y].filterColumnName.push(r.fieldName),this.XLFilter._fltrRowHighlight(e.startRow,e.endRow,"add",r.tableID,r.filterCollection.length));this._dupDetails=!1;this.model.showRibbon&&this.model.allowFiltering&&(fi=n("#"+this._id+"_Ribbon_Data_SortFilter_ClearFilter").data("ejButton"),ei={rowIndex:this.getActiveCell().rowIndex,colIndex:this.getActiveCell().colIndex},this.XLRibbon._changeClrFltrStatus(fi,"button",ei));this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(u,"refresh","vertical","filter")},_filterClose:function(t){this.model.allowFiltering&&!this._hasClass(t,"e-filterspan")&&n(t).parents(".e-excelfilter").length<1&&this._excelFilter._openedFltr&&n(this._excelFilter._openedFltr).is(":visible")&&(this._excelFilter.closeXFDialog(),this.XLFilter._isSearchEdit=!1)},showPager:function(n){this.model.showPager=n;this.element.find(".e-spreadsheetfooter").css("display",n?"block":"none");this._setSheetWidthHeight(this.getActiveSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight})},_refreshClipboard:function(n,t){var r=this.model,i=this._id;n.length&&(r.allowFormatPainter&&r.allowCellFormatting||n.find("#"+i+"_Ribbon_home_Clipboard")[t](),n.find("#"+i+"_Ribbon_home_Clipboard_1")[t](),n.find("#"+i+"_Ribbon_home_Clipboard_Home_Clipboard_Cut")[t](),n.find("#"+i+"_Ribbon_home_Clipboard_Home_Clipboard_Copy")[t]())},_setScrolling:function(t){var f,i=1,e=this.model.sheetCount,o=this.getActiveSheetIndex(),u={},r;if(u.width=this._responsiveWidth,u.height=this._responsiveHeight,t)while(i<=e)f=this.getSheet(i),r=this.getSheetElement(i),f._isLoaded&&(this._isAutoWHMode=!t,this.model.scrollSettings.scrollMode="infinite",this._renderScroller(i,u,"initial"),n.extend(!0,u,this.model.scrollSettings),this.element.height(u.height).width(u.width),n("#"+this._id+"_Ribbon").ejRibbon("option",{width:u.width}),this._updateResponsiveSettings(),this._setSheetWidthHeight(i,{height:this._responsiveHeight,width:this._responsiveWidth}),r.find("#"+this._id+"_content").removeClass("e-rmvrghtbdr")),i++;else{for(this._isAutoWHMode=!t,this._isallowScrollingSetModel=!0,this.model.scrollSettings.isResponsive=t;i<=e;)f=this.getSheet(i),r=this.getSheetElement(i),f._isLoaded&&(f._isVPRendered=!1,this.model.scrollSettings.isResponsive=!1,this.model.scrollSettings.scrollMode="normal",this.model.scrollSettings.allowVirtualScrolling=!1,this._isAutoWHMode=!t,this.setActiveSheetIndex(i),this._isInitLoad=!0,f._isDataMoved=!0,r.find("#"+this._id+"_content").find(".e-table").empty(),this._sheets[i]._contTBody=null,this._refreshDataSrc(null,i),this._refreshCellData(null,i),this._canOverflow=!0,this._refreshOverflow(),this.refreshContent(i),r.find(".e-spreadsheetrowheader")[0].style.height="",r.find(".e-rowheadercontent")[0].style.height="",this.element.find(".e-spreadsheetmainpanel")[0].style.height="",this.element.find(".e-spreadsheetgrppanel")[0].style.height="",r.find(".e-spreadsheetcontent")[0].style.height="",r.find(".e-spreadsheetcontentcontainer")[0].style.height="",r.find("#"+this._id+"_content")[0].style.height="",n("#"+this._id)[0].style.minHeight="",this._updateResponsiveSettings(),i==o&&this._autoSSWidthHeight(i),this._setElemDimension()),i++;this._isInitLoad=!1;this.setActiveSheetIndex(o)}},_setScrollMode:function(n){var i=1,u=this.getActiveSheetIndex(),r={};r.width=this._responsiveWidth;r.height=this._responsiveHeight;n==="normal"?t.Spreadsheet.scrollMode.Normal:t.Spreadsheet.scrollMode.Infinite;this.setActiveSheetIndex(i);this.refreshContent(i);this.setActiveSheetIndex(u)},_setVirtualScrolling:function(n){var i,t=1,r=this.model.sheetCount,f=this.getActiveSheetIndex(),u={};if(u.width=this._responsiveWidth,u.height=this._responsiveHeight,n)while(t<=r)i=this.getSheet(t),i._isLoaded&&(i._virtualBlockRowCnt=Math.ceil(i._vPortHgt/i.rowHeight)+this._bufferCnt,this._isInitLoad=!0,this.setActiveSheetIndex(t),this.refreshContent(t)),t++;else for(this._isallowVirtualScrollingSetModel=!0;t<=r;)i=this.getSheet(t),i._isLoaded&&(this.setActiveSheetIndex(t),this.refreshContent(t)),t++;this.setActiveSheetIndex(f)},_setModel:function(i){var f,y,b,c,k,g,p,l=this.getActiveSheetIndex(),e=this.model,u=this._id,h=n("#"+u+"_Ribbon").ejRibbon("instance"),r=this.model.showRibbon?h.element:[],a,s,d,o,nt,tt,v,it,w;for(y in i){f=i[y];switch(y){case"allowClipboard":f?(this._refreshClipboard(r,"show"),t.isNullOrUndefined(this.XLClipboard)&&(this.XLClipboard=new t.spreadsheetFeatures.clipboard(this)),this.XLClipboard._initCopyPaste()):this._refreshClipboard(r,"hide");break;case"activeSheetIndex":this.gotoPage(f,!1);break;case"pageSettings":this.isUndefined(i.pageSettings.currentPage)||this.gotoPage(i.pageSettings.currentPage,!1);this.isUndefined(i.pageSettings.pageCount)||(this.getPager().ejPager("option","pageCount",i.pageSettings.pageCount),this._refreshSpreadSheetPager(!0));break;case"allowComments":f?(t.isNullOrUndefined(this.XLComment)&&(this.XLComment=new t.spreadsheetFeatures.comments(this)),r.length&&r.find("#"+u+"_Ribbon_review_Comments").show(),this.XLComment._updateCmntRibIcons()):this.model.showRibbon&&r.find("#"+u+"_Ribbon_review_Comments").hide();break;case"allowFormatPainter":e.allowCellFormatting&&(f?(e.allowClipboard||r.find("#"+u+"_Ribbon_home_Clipboard").show(),t.isNullOrUndefined(this.XLFormat)&&(this.XLFormat=new t.spreadsheetFeatures.cellFormatting(this)),r.length&&r.find("#"+u+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").show()):r.length&&(e.allowClipboard||r.find("#"+u+"_Ribbon_home_Clipboard").hide(),r.length&&r.find("#"+u+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").hide()));break;case"allowFormulaBar":f?(b=n("#"+this._id+"_formulabar"),b.length?this.showFormulaBar():(this._renderFormulaBar(!0),this._setSheetWidthHeight(l,{width:this._responsiveWidth,height:this._responsiveHeight}))):this.hideFormulaBar();break;case"allowHyperlink":r.length&&(f?r.find("#"+u+"_Ribbon_insert_Links").show():r.find("#"+u+"_Ribbon_insert_Links").hide());break;case"enableContextMenu":f&&t.isNullOrUndefined(this.XLCMenu)&&(this.XLCMenu=new t.spreadsheetFeatures.contextmenu(this),this.XLCMenu._initContextMenu(),this.XLCMenu._initColorDialog(),this.XLCMenu._initCMenuFooter());break;case"allowEditing":f?(t.isNullOrUndefined(this.XLEdit)&&(this.XLEdit=new t.spreadsheetFeatures.editing(this)),this.model.showRibbon&&r.length&&r.find("#"+u+"_Ribbon_home_Editing").show(),this.XLEdit._processEditing(),this.model.enableContextMenu&&this.XLCMenu._enableMenuOpt(["RenameSheet"],"contextMenuFooter")):(r.length&&r.find("#"+u+"_Ribbon_home_Editing").hide(),this.model.enableContextMenu&&this.XLCMenu._disableMenuOpt(["RenameSheet"],"contextMenuFooter"));break;case"allowResizing":f&&t.isNullOrUndefined(this.XLResize)&&(this.XLResize=new t.spreadsheetFeatures.resizing(this));break;case"allowDataValidation":f?(r.find("#"+u+"_Ribbon_data_DataTools").show(),t.isNullOrUndefined(this.XLValidate)&&(this.XLValidate=new t.spreadsheetFeatures.validation(this),this.XLRibbon._renderValDialog(this.XLRibbon._initValDialog()),this.XLValidate._addDVMethod())):r.length&&r.find("#"+u+"_Ribbon_data_DataTools").hide();break;case"allowConditionalFormats":f?(r.find("#"+u+"_Ribbon_home_Styles_Home_Styles_ConditionalFormatting").show(),this.XLRibbon._initCFDialog(),t.isNullOrUndefined(this.XLCFormat)&&(this.XLCFormat=new t.spreadsheetFeatures.cFormat(this))):r.length&&r.find("#"+u+"_Ribbon_home_Styles_Home_Styles_ConditionalFormatting").hide();break;case"allowSearching":this.model.allowSearching=f;f?(t.isNullOrUndefined(this.XLSearch)&&(this.XLSearch=new t.spreadsheetFeatures.findnreplace(this)),r.length&&r.find("#"+u+"_Ribbon_others_Editing").show()):r.length&&r.find("#"+u+"_Ribbon_others_Editing").hide();break;case"pictureSettings":for(k in f)switch(k){case"allowPictures":e.pictureSettings.allowPictures=f[k];f[k]?(t.isNullOrUndefined(this.XLShape)&&(this.XLShape=new t.spreadsheetFeatures.shape(this)),r.length&&r.find("#"+u+"_Ribbon_insert_Illustrations").show()):r.length&&r.find("#"+u+"_Ribbon_insert_Illustrations").hide()}break;case"showRibbon":for(this.model.showRibbon=f,a=n("#"+u+"_Ribbon"),f?(a.length?a.show():this.XLRibbon._renderRibbon(!0),h=n("#"+u+"_Ribbon").ejRibbon("instance"),r=h.element,r[0].style.overflow==="hidden"&&(r[0].style.overflow=""),n._data(n(".e-ss-"+this._id+".e-chartcell")[0],"events")||this._on(n(".e-ss-"+this._id+".e-chartcell"),"click",this._chartClickHandler),n._data(n("#"+this._id+"_cellstyles")[0],"events")||this._on(n("#"+this._id+"_cellstyles"),"click",this._cellStyleClick),n._data(n("#"+this._id+"_formatastable")[0],"events")||this._on(n("#"+this._id+"_formatastable"),"click",this._formatAsTableClick)):a.hide(),this.refreshSpreadsheet(),s=1,d=e.sheets.length;s<d;s++)e.sheets[s]._isResized=s!=l;break;case"isGridMode":a=n("#"+u+"_Ribbon");b=n("#"+this._id+"_formulabar");f?(this.model.showRibbon=!f,this.model.allowFormulaBar=!f,a.length&&a.hide(),b.length&&this.hideFormulaBar()):(a.show(),this.showFormulaBar());break;case"exportSettings":e.ribbonSettings.applicationTab.type==="menu"&&(o=n("#"+u+"_Menu").data("ejMenu"));for(c in f)switch(c){case"allowExporting":e.exportSettings.allowExporting=f[c];f[c]?((e.exportSettings.excelUrl||e.exportSettings.csvUrl||e.exportSettings.pdfUrl)&&(r.length&&r.find("#saveas_backStageTab").show(),o&&o.enableItemByID("Save")),t.isNullOrUndefined(this.XLExport)&&(this.XLExport=new t.spreadsheetFeatures.exporting(this))):(r.length&&r.find("#saveas_backStageTab").hide(),r.length&&r.find("#"+u+"_Ribbon_BackStage_saveas").hide(),o&&o.disableItemByID("Save"));break;case"excelUrl":e.exportSettings.excelUrl=f[c];f[c]?(r.length&&r.find("#saveas_backStageTab").show(),r.find("#"+u+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").show(),o&&o.enableItemByID("ExportXL")):(r.find("#"+u+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").hide(),o&&o.disableItemByID("ExportXL"));break;case"csvUrl":e.exportSettings.csvUrl=f[c];f[c]?(r.length&&r.find("#saveas_backStageTab").show(),r.find("#"+u+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").show(),o&&o.enableItemByID("ExportCsv")):(r.find("#"+u+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").hide(),o&&o.disableItemByID("ExportCsv"));break;case"pdfUrl":e.exportSettings.pdfUrl=i[y][c];f[c]?(r.length&&r.find("#saveas_backStageTab").show(),r.find("#"+u+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").show(),o&&o.enableItemByID("ExportPdf")):(r.find("#"+u+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").hide(),o&&o.disableItemByID("ExportPdf"))}break;case"allowKeyboardNavigation":f&&t.isNullOrUndefined(this.XLCellNav)&&(this.XLCellNav=new t.spreadsheetFeatures.cellNavigation(this));break;case"allowAutoFill":f?(t.isNullOrUndefined(this.XLDragFill)?(this.XLDragFill=new t.spreadsheetFeatures.dragFill(this),this._createAutoFillElement()):this.getAutoFillElem().show(),this.XLDragFill.positionAutoFillElement()):(this.getAutoFillElem().hide(),this.XLDragFill.hideAutoFillOptions());break;case"autoFillSettings":for(g in f)switch(g){case"fillType":e.allowAutoFill&&(e.autoFillSettings.fillType=f[g]);break;case"showFillOptions":e.allowAutoFill&&(f.showFillOptions?this._removeClass(this._getAutoFillOptElem(),"e-hide"):this.XLDragFill.hideAutoFillOptions(),e.autoFillSettings.showFillOptions=f.showFillOptions)}break;case"allowSelection":f&&t.isNullOrUndefined(this.XLSelection)&&(this.XLSelection=new t.spreadsheetFeatures.selection(this),this._initSelection());break;case"allowDragAndDrop":f&&t.isNullOrUndefined(this.XLDragDrop)&&(this.XLDragDrop=new t.spreadsheetFeatures.dragAndDrop(this));break;case"allowCellFormatting":f?((e.allowConditionalFormats||e.allowFormatAsTable)&&r.find("#"+u+"_Ribbon_home_Styles").show(),r.length&&(r.find("#"+u+"_Ribbon_home_Font").show(),r.find("#"+u+"_Ribbon_home_Number").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_TopAlign").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_MiddleAlign").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_BottomAlign").show(),r.find("#"+u+"_Ribbon_separator_Home_Alignment_BottomAlign").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_AlignLeft").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_AlignCenter").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_AlignRight").show(),r.find("#"+u+"_Ribbon_separator_Home_Alignment_AlignRight").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_DecreaseIndent").show(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_IncreaseIndent").show(),r.find("#"+u+"_Ribbon_home_Styles_Home_Styles_CellStyles").show(),e.allowFormatPainter&&r.find("#"+u+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").show(),e.allowClipboard&&r.find("#"+u+"_Ribbon_home_Clipboard").show()),t.isNullOrUndefined(this.XLFormat)&&(this.XLFormat=new t.spreadsheetFeatures.cellFormatting(this)),t.isNullOrUndefined(this.XLCellFrmtDlg)&&(this.XLCellFrmtDlg=new t.spreadsheetFeatures.formatCellDialog(this)),n("#"+u+"_formatdlg").length===0&&this.XLCellFrmtDlg._renderCellFrmtDlg()):r.length&&(r.find("#"+u+"_Ribbon_home_Font").hide(),r.find("#"+u+"_Ribbon_home_Number").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_TopAlign").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_MiddleAlign").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_BottomAlign").hide(),r.find("#"+u+"_Ribbon_separator_Home_Alignment_BottomAlign").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_AlignLeft").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_AlignCenter").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_AlignRight").hide(),r.find("#"+u+"_Ribbon_separator_Home_Alignment_AlignRight").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_DecreaseIndent").hide(),r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_IncreaseIndent").hide(),r.find("#"+u+"_Ribbon_home_Styles_Home_Styles_CellStyles").hide(),r.find("#"+u+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").hide(),e.allowClipboard||r.find("#"+u+"_Ribbon_home_Clipboard").hide(),e.allowConditionalFormats||e.allowFormatAsTable||r.find("#"+u+"_Ribbon_home_Styles").hide());break;case"allowImport":r.length&&(f?r.find("#open_backStageTab").show():r.find("#open_backStageTab").hide());break;case"importSettings":e.ribbonSettings.applicationTab.type==="menu"&&(o=n("#"+u+"_Menu").data("ejMenu"));for(p in f)switch(p){case"importMapper":f[p]?(e.importSettings.importMapper=f[p],r.length&&r.find("#open_backStageTab").show(),o&&o.enableItemByID("Open")):(r.length&&r.find("#open_backStageTab").hide(),o&&o.disableItemByID("Open"));break;case"importUrl":e.importSettings.importUrl=f[p];break;case"password":e.importSettings.password=f[p]}break;case"allowSorting":if(nt=document.getElementById(u+"number_MenuItem"),tt=document.getElementById(u+"string_MenuItem"),o=n("#"+u+"_Ribbon_SortFilter").data("ejMenu"),f?(t.isNullOrUndefined(this.XLSort)&&(this.XLSort=new t.spreadsheetFeatures.sorting(this)),r.length&&(r.find("#"+u+"_Ribbon_data_SortFilter_1").show(),r.find("#"+u+"_Ribbon_data_Sort").show(),r.find("#"+u+"_Ribbon_home_Editing_1").show()),o&&o.enableItemByID("Ribbon_SortAtoZ"),o&&o.enableItemByID("Ribbon_SortZtoA")):r.length&&(r.find("#"+u+"_Ribbon_data_SortFilter_1").hide(),this.model.allowFiltering||(r.find("#"+u+"_Ribbon_data_Sort").hide(),r.find("#"+u+"_Ribbon_home_Editing_1").hide()),o&&o.disableItemByID("Ribbon_SortAtoZ"),o&&o.disableItemByID("Ribbon_SortZtoA")),this.model.allowFiltering)for(s=0;s<3;s++)t.isNullOrUndefined(nt)||(nt.childNodes[s].style.display=this.model.allowSorting?s===2?"block":"inline":"none"),t.isNullOrUndefined(tt)||(tt.childNodes[s].style.display=this.model.allowSorting?s===2?"block":"inline":"none");break;case"formatSettings":if(e.allowCellFormatting)for(v in f)switch(v){case"allowFontFamily":e.formatSettings.allowFontFamily=f[v];r.length&&(f[v]?r.find("#"+u+"_Ribbon_home_Font_Home_Font_FontFamily").show():r.find("#"+u+"_Ribbon_home_Font_Home_Font_FontFamily").hide());break;case"allowDecimalPlaces":e.formatSettings.allowDecimalPlaces=f[v];r.length&&(f[v]?(r.find("#"+u+"_Ribbon_home_Number_Home_Number_IncreaseDecimal").show(),r.find("#"+u+"_Ribbon_home_Number_Home_Number_DecreaseDecimal").show(),r.find("#"+u+"_Ribbon_separator_Home_Number_CommaStyle").show()):(r.find("#"+u+"_Ribbon_home_Number_Home_Number_IncreaseDecimal").hide(),r.find("#"+u+"_Ribbon_home_Number_Home_Number_DecreaseDecimal").hide(),r.find("#"+u+"_Ribbon_separator_Home_Number_CommaStyle").hide()));break;case"allowCellBorder":e.formatSettings.allowCellBorder=f[v];r.length&&(f[v]?(r.find("#"+u+"_Ribbon_separator_border").show(),r.find("#"+u+"_Ribbon_home_Font_Home_Font_Border").show()):(r.find("#"+u+"_Ribbon_separator_border").hide(),r.find("#"+u+"_Ribbon_home_Font_Home_Font_Border").hide()))}break;case"sheets":for(d=f.length,s=0;s<d;s++)for(it in f[s]){if(this.model.sheetCount<s+1&&f.length>l)return;switch(it){case"showGridlines":s+1===l?this._showGridlines(f[s].showGridlines,l):this.getSheet(s+1).showGridlines=f[s].showGridlines;break;case"showHeadings":s+1===l?this._showHeadings(f[s].showHeadings,l):this.getSheet(s+1).showHeadings=f[s].showHeadings}}break;case"scrollSettings":t.isNullOrUndefined(i.scrollSettings)||(t.isNullOrUndefined(i.scrollSettings.allowScrolling)||(e.scrollSettings.allowScrolling=i.scrollSettings.allowScrolling,this._setScrolling(i.scrollSettings.allowScrolling)),t.isNullOrUndefined(i.scrollSettings.allowVirtualScrolling)||(e.scrollSettings.allowVirtualScrolling=i.scrollSettings.allowVirtualScrolling,this._setVirtualScrolling(i.scrollSettings.allowVirtualScrolling)),t.isNullOrUndefined(i.scrollSettings.isResponsive)||(e.scrollSettings.isResponsive=i.scrollSettings.isResponsive),t.isNullOrUndefined(i.scrollSettings.scrollMode)||this._setScrollMode(i.scrollSettings.scrollMode),t.isNullOrUndefined(i.scrollSettings.width)||(e.scrollSettings.width=i.scrollSettings.width),t.isNullOrUndefined(i.scrollSettings.height)||(e.scrollSettings.height=i.scrollSettings.height));break;case"allowFiltering":o=n("#"+u+"_Ribbon_SortFilter").data("ejMenu");f?(r.length&&(r.find("#"+u+"_Ribbon_data_SortFilter_2").show(),r.find("#"+u+"_Ribbon_data_Sort").show(),r.find("#"+u+"_Ribbon_home_Editing_1").show()),o&&o.enableItemByID("Ribbon_Filter"),t.isNullOrUndefined(this.XLFilter)&&(this.XLFilter=new t.spreadsheetFeatures.filter(this)),this.XLFilter._renderExcelFilter()):r.length&&(this.model.allowSorting||(r.find("#"+u+"_Ribbon_data_Sort").hide(),r.find("#"+u+"_Ribbon_home_Editing_1").hide()),r.find("#"+u+"_Ribbon_data_SortFilter_2").hide(),o&&o.disableItemByID("Ribbon_Filter"));break;case"allowInsert":f?(r.length&&!e.allowDelete&&r.find("#"+u+"_Ribbon_others_Cells").show(),r.length&&r.find("#"+u+"_Ribbon_others_Cells_1").show(),this.getPager().find(".e-new").removeClass("e-disable"),e.enableContextMenu&&(this.XLCMenu._enableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"),this.XLCMenu._enableMenuOpt(["Insert"],"contextMenuCell"),this.XLCMenu._enableMenuOpt(["Insert"],"contextMenuColumnHeader"),this.XLCMenu._enableMenuOpt(["Insert"],"contextMenuRowHeader"))):(r.length&&!e.allowDelete&&r.find("#"+u+"_Ribbon_others_Cells").hide(),r.length&&r.find("#"+u+"_Ribbon_others_Cells_1").hide(),this.getPager().find(".e-new").addClass("e-disable"),e.enableContextMenu&&(this.XLCMenu._disableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"),this.XLCMenu._disableMenuOpt(["Insert"],"contextMenuCell"),this.XLCMenu._disableMenuOpt(["Insert"],"contextMenuColumnHeader"),this.XLCMenu._disableMenuOpt(["Insert"],"contextMenuRowHeader")));break;case"allowDelete":f?(!e.allowInsert&&r.length&&r.find("#"+u+"_Ribbon_others_Cells").show(),r.length&&r.find("#"+u+"_Ribbon_others_Cells_2").show(),e.enableContextMenu&&this._getSheetNames(!0).length>1&&(this.XLCMenu._enableMenuOpt(["DeleteSheet"],"contextMenuFooter"),this.XLCMenu._enableMenuOpt(["Delete"],"contextMenuCell"),this.XLCMenu._enableMenuOpt(["Delete"],"contextMenuColumnHeader"),this.XLCMenu._enableMenuOpt(["Delete"],"contextMenuRowHeader"))):(!e.allowInsert&&r.length&&r.find("#"+u+"_Ribbon_others_Cells").hide(),r.length&&r.find("#"+u+"_Ribbon_others_Cells_2").hide(),e.enableContextMenu&&(this.XLCMenu._disableMenuOpt(["DeleteSheet"],"contextMenuFooter"),this.XLCMenu._disableMenuOpt(["Delete"],"contextMenuCell"),this.XLCMenu._disableMenuOpt(["Delete"],"contextMenuColumnHeader"),this.XLCMenu._disableMenuOpt(["Delete"],"contextMenuRowHeader")));break;case"allowFreezing":f?(t.isNullOrUndefined(this.XLFreeze)&&(this.XLFreeze=new t.spreadsheetFeatures.freezepane(this),this.XLFreeze._initFreeze()),r.length&&r.find("#"+u+"_Ribbon_others_Window").show()):r.length&&r.find("#"+u+"_Ribbon_others_Window").hide();break;case"allowMerging":r.length&&(f?r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_Merge").show():r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_Merge").hide());break;case"allowWrap":r.length&&(f?r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_WrapText").show():r.find("#"+u+"_Ribbon_home_Alignment_Home_Alignment_WrapText").hide());break;case"allowUndoRedo":r.length&&(f?r.find("#"+u+"_Ribbon_home_Actions").show():r.find("#"+u+"_Ribbon_home_Actions").hide());break;case"frozenRows":e.allowFreezing&&this.XLFreeze.freezeRows(f);break;case"frozenColumns":e.allowFreezing&&this.XLFreeze.freezeColumns(f);break;case"freezePanes":e.allowFreezing&&this.XLFreeze.freezePanes(f.rowIndex,f.colIndex);break;case"allowFormatAsTable":f?(e.enablePivotTable||r.find("#"+u+"_Ribbon_insert_Tables").show(),t.isNullOrUndefined(this.XLFormat)&&(this.XLFormat=new t.spreadsheetFeatures.cellFormatting(this)),r.length&&(r.find("#"+u+"_Ribbon_home_Styles_Home_Styles_FormatAsTable").show(),r.find("#"+u+"_Ribbon_insert_Tables_Insert_Tables_Table").show())):r.length&&(e.enablePivotTable||r.find("#"+u+"_Ribbon_insert_Tables").hide(),r.find("#"+u+"_Ribbon_home_Styles_Home_Styles_FormatAsTable").hide(),r.find("#"+u+"_Ribbon_insert_Tables_Insert_Tables_Table").hide());break;case"enablePivotTable":r.length&&(f?(t.isNullOrUndefined(this.XLPivot)&&(this.XLPivot=new t.spreadsheetFeatures.pivot(this)),r.length&&r.find("#"+u+"_Ribbon_insert_Tables_Insert_Tables_PivotTable").show()):(r.length&&r.find("#"+u+"_Ribbon_insert_Tables_Insert_Tables_PivotTable").hide(),this.hideActivationPanel(),this.XLRibbon._toggleAnalyzeTab(),this.getSheetElement(l).find(".e-ss-activepivot").removeClass("e-ss-activepivot")));break;case"allowAutoSum":r.length&&(f?r.find("#"+u+"_Ribbon_home_Editing_Home_Editing_AutoSum").show():r.find("#"+u+"_Ribbon_home_Editing_Home_Editing_AutoSum").hide());break;case"allowCharts":f?((t.isNullOrUndefined(this.XLChart)||t.isNullOrUndefined(this.XLShape))&&(this.XLShape=new t.spreadsheetFeatures.shape(this),this.XLChart=new t.spreadsheetFeatures.chart(this)),r.length&&r.find("#"+u+"_Ribbon_insert_Charts").show()):r.length&&r.find("#"+u+"_Ribbon_insert_Charts").hide();break;case"allowSparkline":f?(t.isNullOrUndefined(this.XLSparkline)&&(this.XLSparkline=new t.spreadsheetFeatures.sparkLine(this)),h=n("#"+this._id+"_Ribbon").data("ejRibbon"),this.XLRibbon._contextualTabCollection[4]&&this.XLRibbon._tabCollection[1].groups[4]?(h.hideTab("Sparkline Design"),r.find("#"+u+"_Ribbon_insert_SparklineCharts").show()):this.XLRibbon._contextualTabCollection[4]||this.XLRibbon._tabCollection[1].groups[4]||(this.XLSparkline._renderSparklineTab(),h.addTabGroup(2,this.XLSparkline._tabInsert(),4),this.XLRibbon._tabCollection[1].groups.push(this.XLSparkline._tabInsert()),h.addContextualTabs(this.XLSparkline._contextualTabInsert(),11),this.XLRibbon._contextualTabCollection.push(this.XLSparkline._contextualTabInsert()),h.hideTab("Sparkline Design"))):(r.find("#"+u+"_Ribbon_insert_SparklineCharts").hide(),h.hideTab("Sparkline Design"));break;case"printSettings":for(w in f)switch(w){case"allowPrinting":e.printSettings.allowPrinting=f[w];f[w]?(this.XLPrint=new t.spreadsheetFeatures.print(this),r.length&&(r.find("#"+u+"_Ribbon_pagelayout_Print").show(),r.find("#print_backStageTab").show())):r.length&&(r.find("#print_backStageTab").hide(),r.find("#"+u+"_Ribbon_pagelayout_Print").hide());break;case"allowPageSize":e.printSettings.allowPageSize=f[w];r.length&&(f[w]?r.find("#"+u+"_Ribbon_pagelayout_PageLayout").show():r.find("#"+u+"_Ribbon_pagelayout_PageLayout").hide())}break;case"allowLockCell":r.length&&(f?(r.find("#"+u+"_Ribbon_review_Changes_Review_Changes_ProtectSheet").show(),r.find("#"+u+"_Ribbon_review_Changes_Review_Changes_LockCell").show()):(r.find("#"+u+"_Ribbon_review_Changes_Review_Changes_ProtectSheet").hide(),r.find("#"+u+"_Ribbon_review_Changes_Review_Changes_LockCell").hide()));break;case"undoRedoStep":this.undoRedoStep=f;break;case"enableTouch":this._wireTouchEvts(f?"_on":"_off");break;case"showPager":this.showPager(i[y]);this._refreshSpreadSheetPager();break;case"allowOverflow":this._refreshOverflow();break;case"allowClear":r.length&&(f?r.find("#"+u+"_Ribbon_home_Editing_Home_Editing_Clear").show():r.find("#"+u+"_Ribbon_home_Editing_Home_Editing_Clear").hide());break;case"isReadOnly":this._readOnly();break;case"locale":this.model.locale=i[y];this._destroy();this.model.sheets.splice(0,1);this.addClass(this.element[0],this._rootCSS+" e-js");this._init();break;case"allowCellType":f&&(this.XLCellType=new t.spreadsheetFeatures.cellType(this));break;case"activationPanelWidth":this.model.apWidth=f;this.getActivationPanel().width(f-1);break;case"cssClass":this.element.removeClass(this._cssClass).addClass(i[y]);break;case"ribbonSettings":this.model.ribbonSettings.applicationTab.type=i.ribbonSettings.applicationTab.type;n("#"+this._id+"_Menu")[0].style.display=i.ribbonSettings.applicationTab.type==="menu"?"block":"none";this.XLRibbon._refreshBSItems(i.ribbonSettings.applicationTab.type);this.XLRibbon._menuCustomize();h.setModel({applicationTab:this.XLRibbon._appTabCollection});i.ribbonSettings.applicationTab.type==="backstage"&&(this.XLRibbon._isAppTabCreate=!1)}}r.length&&h.model&&(e.allowAutoSum||e.allowFiltering||e.allowUndoRedo||e.allowSorting||e.allowClipboard||e.allowFormatPainter||e.allowCellFormatting||e.allowMerging||e.allowWrap||e.allowConditionalFormats||e.allowFormatAsTable?h.showTab(this._getLocStr("HOME")):h.hideTab(this._getLocStr("HOME")),e.allowFormatAsTable||e.allowPictures||e.allowHyperlink||e.allowCharts||e.allowSparkline?h.showTab(this._getLocStr("INSERT")):h.hideTab(this._getLocStr("INSERT")),e.allowDataValidation||e.allowFiltering||e.allowSorting?h.showTab(this._getLocStr("DATATAB")):h.hideTab(this._getLocStr("DATATAB")),e.printSettings.allowPrinting?h.showTab(this._getLocStr("PAGELAYOUT")):h.hideTab(this._getLocStr("PAGELAYOUT")),e.allowComments||e.allowLockCell?h.showTab(this._getLocStr("REVIEW")):h.hideTab(this._getLocStr("REVIEW")),e.allowFreezing||e.allowInsert||e.allowDelete||e.allowSearching?h.showTab(this._getLocStr("OTHERS")):h.hideTab(this._getLocStr("OTHERS")))},"import":function(t){var i,r,u,f;if(this.model.allowImport){if(i={},r={},t.dataContainer||(this.model.allowCellFormatting&&this.XLFormat&&this.getObjectLength(this.XLFormat._customFontFamily)>0&&(r.customFontFamily=this.XLFormat._customFontFamily),this._isDefaultLocked&&(r.ExcelLikeLockedCells=!0),this.getObjectLength(r)&&(t.dataContainer=JSON.stringify(r))),t.password&&t.password.length&&(i.password=t.password),t.file&&t.file.name&&(i.fileName=t.file.name),this.model.beforeImport&&this._trigger("beforeImport",i))return!1;i.password&&i.password.length&&(t.password=i.password);u=this;f={type:"POST",data:this._import(t),async:this.isUndefined(t.async)?!0:t.async,url:this.model.importSettings.importMapper,success:function(n){u.element&&u._importSuccess(n)},error:function(n,t){u._importFailed({type:t,xhr:{status:n.status,statusText:n.statusText}})}};(this._browserDetails.name!=="msie"||this._browserDetails.version!=="9.0"||f.data.append)&&(f.processData=!1,f.contentType=!1);n("#"+this._id+"_Ribbon_BackStage").hide();u.showWaitingPopUp();n.ajax(f)}},_import:function(n){if(window.FormData&&this._isObject(n)){var t,i=new FormData;for(t in n)t!="async"&&i.append(t,n[t]);return i}return n},_importSuccess:function(n){var t=["UnsupportedFile","IncorrectPassword","InvalidUrl","NeedPassword","CancellationRequested","ImportPreventedOnUnknownFormula"],i;if(this._renderAlertdlg(),t.indexOf(n)>-1){switch(n){case t[0]:case t[1]:case t[2]:case t[4]:case t[5]:this._showAlertDlg("Alert",n,"",null,110);break;case t[3]:this._showDialog(this._id+"_ImportPasswordDialog");this.model.importSettings.password=""}this.hideWaitingPopUp()}else{if(i={data:n,reqType:"importing"},this._trigActionBegin(i)){this.hideWaitingPopUp();return}n=i.data;this.loadFromJSON(JSON.parse(n))}},loadFromJSON:function(t){var o,r,s,i,h,u,f,c,e;if(this.isImport=!0,this.model.isImport=!0,o=this.model.isReadOnly,o&&(this.model.isReadOnly=!1),n("#"+this._id+"_file").ejUploadbox("option","autoUpload",!0),this._isSheetReq)r=Number(this.getObjectKeys(t.dataContainer.sheets)[0]),this._refreshImpStyles(t.dataContainer.hashCode),this._impData.dataContainer=n.extend(!0,{},t.dataContainer),this._impData.dataContainer.sheets=this._dataContainer.sheets,this._impData.dataContainer.cellType=this._dataContainer.cellType,this._impData.dataContainer.sheets[r]=t.dataContainer.sheets[r],this._impData.model.sheets[r]=t.sheet,this._dataContainer=n.extend(!0,{},this._impData.dataContainer),this._dataContainer.sheetCellType={},this._refreshModel(t.sheet,!0,r),this._sheetSettings(r),this._intrnlReq||this.gotoPage(r,!1),this._isSheetReq=!1;else{if(typeof t.model=="string"&&(t.model=JSON.parse(t.model)),typeof t.dataContainer=="string"&&(t.dataContainer=JSON.parse(t.dataContainer)),this.getObjectLength(t.model.sheets[0])&&t.model.sheets.unshift({}),i=1,u=t.model&&t.model.nameManager,u&&u.length)for(f=0,c=u.length;f<c;f++)u[f].refersto=this._decode(u[f].refersto);if(this.model.scrollSettings.allowVirtualScrolling||(s=this._getMaxRowColCnt(t.model.sheets,!0)),this.model.scrollSettings.allowVirtualScrolling||t.dataContainer.sharedData.length<50001&&s.rowCount<10001&&s.colCount<126){if(this._impData=t,h={importData:t},this._trigger("onImport",h))return!1;if(this._isInitLoad)this._initBase();else{for(this._destroy(),this._refreshModel(t.model),this._dataContainer=n.extend(!0,{},t.dataContainer),this._dataContainer.sheetCellType={},this._initCSSTag();i<=this.model.sheetCount;)this._sheetSettings(i),this._newSIndex++,i++;for(i=1;i<=this.model.sheetCount;)this.model.scrollSettings.allowVirtualScrolling||this.model.importSettings.allowSheetOnDemand||this._initSheet(i),i++;this._refreshNameMngr(t.model.nameManager);this.gotoPage(this.getActiveSheetIndex(),!1);this._isRibbonDestroyed=!1}this._calcEngine.setCalculatingSuspended(t.model.isManualCalculation||!1);this._trigger("loadComplete");this.clearUndoRedo()}else this._showAlertDlg("Alert","HugeDataAlert")}for(e=this.getObjectKeys(t.dataContainer.customCellStyle),i=0;i<e.length;i++)this.XLFormat.addNewCustomStyle(e[i],t.dataContainer.customCellStyle[e[i]]);this._intrnlReq||(this.isImport=!1,this.model.isImport=!1);this._intrnlReq=!1;this._renderDDownList();this.hideWaitingPopUp();this.model.showRibbon&&this.XLRibbon._updateRibbonIcons();this.model.isReadOnly=o;this._isSSLoaded=!0},_importFailed:function(n){var t={failureType:n.type};n.xhr?(t.status=n.xhr.status,t.statusText=n.xhr.statusText):t.statusText=n.error;this.hideWaitingPopUp();this._trigger("openFailure",t)},_importSheet:function(n,t){var i={},r=this.model.importSettings;this._isSheetReq=!0;i={sheetIndex:n,allowSheetOnDemand:r.allowSheetOnDemand,password:r.password,async:t};i.dataContainer=JSON.stringify({hashCode:this._dataContainer.hashCode,sharedData:this._dataContainer.sharedData,valData:this._dataContainer.valData,cFormatData:this._dataContainer.cFormatData});this["import"](i);this.getSheet(n)._isRequested=!0},_decode:function(t){return n("<div/>").html(t).text()},_refreshModel:function(n,t,i){var u,e,r,f=1;if(n)if(t)r=this.model.sheets[this._getSheetIndex(i)],r.rowCount=n.rowCount||this.defaults.rowCount,r.colCount=n.colCount||this.defaults.colCount;else{if(this.model.sheetCount=n.sheetCount||this.defaults.sheetCount,this.model.activeSheetIndex=n.activeSheetIndex||this.defaults.activeSheetIndex,this.model.rowHeight=n.rowHeight||this.defaults.rowHeight,this.model.columnWidth=n.columnWidth||this.defaults.columnWidth,!this._isRefresh)for(this.model.sheets=[{}],u=n.sheets.length;f<u;)r=n.sheets[f],e={rowCount:r.rowCount||this.defaults.rowCount,colCount:r.colCount||this.defaults.colCount},this.model.sheets.push(e),f++;n.nameManager&&n.nameManager.length&&(this.model.nameManager=n.nameManager)}else u=this.model.sheets.length,this.model.sheetCount<u&&(this.model.sheetCount=u);this.model.apWidth===300&&this.model.activationPanelWidth!==300?this.model.apWidth=this.model.activationPanelWidth:this.model.apWidth!==300&&this.model.activationPanelWidth===300&&(this.model.activationPanelWidth=this.model.apWidth)},_refreshImpStyles:function(n){for(var r,t,i=0,u=n.length;i<u;)t=n[i],this._dataContainer.hashCode.indexOf(t)===-1&&(t.indexOf("e-format")===-1?(this._dataContainer.hashCode.push(t),t.length<25&&this.XLFormat._writeCssRules(t,this.XLFormat._getCssPropertyAsString({border:this.XLFormat.getBorderFromHashCode(t)}))):(r=this.XLFormat.getFormatFromHashCode(t),this.XLFormat._createFormatClass(r))),i++},_refreshImpSheets:function(t){var i=this._impData.model.sheets[t];this._refreshImpTable(i.tableManager);this._refreshImpCells(t);this._refreshImpCF(t);this.model.allowMerging&&i.mergedCells&&this._refreshImpMC(i.mergedCells);this.model.allowFiltering&&i.filterSettings&&i.filterSettings.range&&this.XLFilter._filterCellRange(t,i.filterSettings.range);this._refreshImpHC(i.hideColsCollection);this._refreshImpHR(i.hideRowsCollection);this._refreshOverflow();this.model.allowCellType&&this._refreshSheetCellTypes(this._impData.dataContainer.sheetCellType,t);this._refreshShapePosOnImp(i.shapeMngr,t);this._refreshImpCharts(i.shapeMngr.chart);this._refreshImpSparkline(i.shapeMngr.sparkline,t);this._refreshImpPics(i.shapeMngr,t);this._refreshImpPvts(i.pivotMngr,t);this.XLComment._updateCmntArrowPos();i.showGridlines===!1&&n("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").ejCheckBox({checked:i.showGridlines});i.isSheetProtected&&this.protectSheet(!0)},_refreshImpCells:function(n){for(var e,t,i=0,h=this.getSheet(n),f=h.usedRange,c,l,s,o,r=this.XLEdit._getPropWithCellIdx([0,0,f.rowIndex,f.colIndex],"value",n,!0),u=r.length;i<u;)t=r[i],c=this.XLEdit.getPropertyValue(t.rowIdx,t.colIdx,"formulaRange"),c&&(this.XLEdit._formulaArrayRange=this.getRangeIndices(c)),this.XLEdit._refreshCalcEngine(t.rowIdx,t.colIdx,!0,t.value,n),this.XLEdit._formulaArrayRange="",i++;if(this.model.allowCellFormatting){for(i=0,r=this.XLEdit._getPropWithCellIdx([0,0,f.rowIndex,f.colIndex],"type",n),u=r.length;i<u;)t=r[i],s=t.rowIdx,o=t.colIdx,e=this.getRangeData({range:[s,o,s,o],property:["value","formatStr"]})[0],t.value=="accounting"&&h.columnsWidthCollection[o]>h.columnWidth&&e.value&&!this.isFormula(e.value)&&(l=this.toAccounting(e.formatStr,e.value),this.XLEdit._updateDataContainer({rowIndex:s,colIndex:o},{dataObj:{type:"accounting",value2:l},sheetIdx:n})),i++;if(this.model.formatSettings.allowCellBorder)for(i=0,r=this.XLEdit._getPropWithCellIdx([0,0,f.rowIndex,f.colIndex],"borders",n),u=r.length;i<u;)t=r[i],this.XLFormat.applyBorder(t.value,[t.rowIdx,t.colIdx,t.rowIdx,t.colIdx]),i++}},_refreshSheetCellTypes:function(n,t){var r=[],i,u;if(!(this.getObjectLength(n)<1)){for(i=1,u=this.getObjectLength(n[t]);i<=u;i++)r.push({range:n[t][i].settings.range,settings:n[t][i].settings});this.XLCellType._rangeCellTypes(r,t,!0)}},_refreshImpCF:function(n){if(this.model.allowConditionalFormats)for(var t,u,e=this._impData.dataContainer.cFormatData.length,f,r,o,i=0;i<e;i++)if(t=this._impData.dataContainer.cFormatData[i].split("_"),f=t[6].split(","),u=Number(t[5]),u===n){for(r=0,o=f.length;r<o;r++)this.XLCFormat._cFormat(t[0],t[1],t[2],t[3],t[4],f[r],u,this.getRangeIndices(t[6]));this._impData.dataContainer.cFormatData.splice(i,1);e=this._impData.dataContainer.cFormatData.length;i--}},_refreshImpMC:function(n){var t,i=n.length;if(i)while(i--)t=n[i],t.isCenterAlign&&(this.mergeCenter=!0),this.mergeCells(t.range,!0),this.mergeCenter=!1},_refreshImpHC:function(n){var t,r=this.getObjectKeys(n),i=r.length;if(i)while(i--)t=parseInt(r[i]),this._hideColumn(t,t)},_refreshImpResRowHght:function(n){for(var o,u,l,t,r,a,f,e=this.getSheet(n),b=e._restrictedHeightRows,d=this._dataContainer.sheets[n],g=this._dataContainer.hashCode,i,v,y=!0,p=[],h,c,k,w=this._impData&&this._impData.model.sheets[n]&&this._impData.model.sheets[n].mergedCells?this._impData.model.sheets[n].mergedCells:this._copySheet?e.mergedCells:[],s=0;s<w.length;s++)i=this.getRangeIndices(w[s].range),p.push(i);for(u=this.element.find("#"+this._id+"_emptyDiv"),o=0;o<b.length;o++){r=b[o];f=d[r];for(t in f)if((h=this._dataContainer.sharedData[f[t].value],h&&!this.isFormula(h))&&(a=f[t].formats,a)){if(l=g[a],f[t].wrap){for(c=0,k=p.length;c<k;c++)if(i=p[c],i[0]<=r&&i[2]>=r&&i[1]<=t&&i[3]>=t){y=!1;break}y&&(u.width(e.columnsWidthCollection[t]-3),l+=" e-sswraptext")}this.addClass(u[0],l);u.text(h);v=u[0].offsetHeight+1;e.rowsHeightCollection[r]<v&&(e.rowsHeightCollection[r]=v);this._refreshGlobalSpan(null,!0);y=!0}}},_refreshImpHR:function(n){var r,t,i,u=this.getActiveSheetIndex(),s=this.getSheet(u);n=n||[];var f=this.getRows(u),h=f[1],c=f[0],e=this._getJSSheetRowHeaderContent(u),l=e.find("tr"),o;for(r=0,o=n.length;r<o;r++)t=parseInt(n[r]),i=t?t-1:0,this.isUndefined(this.XLEdit.getPropertyValue(i,0,"isRHide"))&&this.XLEdit._updateDataContainer({rowIndex:i,colIndex:0},{dataObj:{hRow:!0}}),this.model.scrollSettings.allowVirtualScrolling?this.addClass(e.find("[idx ="+i+"] .e-rowheader")[0],"e-hrow"):(this.addClass(l.find(".e-rowheader")[i],"e-hrow"),this.addClass(h[t],"e-r-hide"),this.addClass(c[t],"e-r-hide")),this.XLScroll._getRowHeights(u,s.hideRowsCollection.sort()[0])},_refreshImpTable:function(n){var i,r,t,u=this.getObjectLength(n);if(this.model.allowFormatAsTable&&u)while(u--)t=n[u],i=t.range,r=this.XLFormat._getTableLayoutFromName(t.formatName),r||(r=this.XLFormat._formatAsTableStyle,t.formatName=r.formatName),t.totalRow&&(i[2]=i[2]-1),this.XLFormat._isTableNameAdded=!0,this.XLFormat.createTable({header:!0,name:t.name,format:r.format,formatName:t.formatName,showHeaderRow:t.showHeaderRow,totalRow:t.totalRow},this._getAlphaRange(this.getActiveSheetIndex(),i[0],i[1],i[2],i[3])),this.XLFormat._isTableNameAdded=!1},_refreshImpCharts:function(n){var o,i,f,c,s,r,e,h,u,l;if(this.model.allowCharts)for(f=0,c=this.getObjectLength(n);f<c;){if(s=!1,i=n["chart"+f],o=this.getSheet(i.dataSheetIdx),i.dataSheetIdx!=this.getActiveSheetIndex()&&o._isImported&&!o._isRequested&&(this._intrnlReq=!0,this._importSheet(i.dataSheetIdx,!1)),!t.isNullOrUndefined(i.series))for(u=0,l=i.series.length;u<l;u++)if(r=i.series[u].name.toString().trim(),r.indexOf("=")==0&&(r=r.slice(1),r.indexOf("!")>-1?(h=this._getSheetIndexByName(r.split("!")[0]),e=this.getRangeIndices(r.split("!")[1])):(h=this.getActiveSheetIndex(),e=this.getRangeIndices(r)),r=this.XLEdit.getPropertyValue(e[0],e[1],"value2",h)),i.series[u].name=r,!t.isNullOrUndefined(i.series[u].trendlines)&&i.series[u].trendlines.length>0){s=!0;break}s?this.XLChart.createChart(i.range,{type:i.commonSeriesOptions.type,enable3D:i.enable3D,marker:i.commonSeriesOptions.marker,top:i.top,left:i.left,height:i.size.height,width:i.size.width,title:i.title,legend:i.legend,primaryYAxis:i.primaryYAxis,primaryXAxis:i.primaryXAxis||{labelIntersectAction:"wrapByWord"},dataSheetIdx:i.dataSheetIdx,series:i.series,seriesRange:i.seriesRange,isRowColSwitched:i.isRowColSwitched}):this.XLChart.createChart(i.series?null:i.range,{type:i.commonSeriesOptions.type,enable3D:i.enable3D,marker:i.commonSeriesOptions.marker,top:i.top,left:i.left,height:i.size.height,width:i.size.width,title:i.title,legend:i.legend,primaryYAxis:i.primaryYAxis,primaryXAxis:i.primaryXAxis||{labelIntersectAction:"wrapByWord"},dataSheetIdx:i.dataSheetIdx,series:i.series,seriesRange:i.seriesRange,isRowColSwitched:i.isRowColSwitched});f++}},_refreshImpSparkline:function(n,t){if(this.model.allowSparkline)for(var u=0,r,o,f,s,h=this.getObjectKeys(n),e=[],i;u<h.length;){for(i=n[h[u]],o=this._getCellInfo({rowIndex:i.rowIndex,colIndex:i.colIndex},i.sheetIdx),f=this.getRangeData({range:this._getRangeArgs(i.DataRange,Array,i.SheetIndex),property:["value"],sheetIdx:i.SheetIndex}),r=0,s=f.length;r<s;r++)e.push(parseInt(f[r].value));i.dataSource=e;this.XLSparkline._createSparkline(i,o,t);e=[];u++}},_refreshImpPics:function(n,t){if(this.model.pictureSettings.allowPictures)for(var i,r=0,u=this.getObjectKeys(n.picture),f=u.length;r<f;)i=n.picture[u[r]],i.sheetIdx=t,this.getSheet(t)._isUpdated?(i.imgData=n.sharedPics[i.data],this.XLShape._refreshPictureElement(i)):this.XLShape._createPicture(t,null,n.sharedPics[i.data],i.top,i.left,i.width,i.height,null,i.bcolor,i.bstyle,i.bwidth,i),r++},_refreshShapePosOnImp:function(n,t){var f=n.chart,e=n.picture,i,o,r,s,u,c=this.getSheet(t),a=c._rowHeightCollection,l=c.rowsHeightCollection,h=this._impData?this._impData.model.sheets[t].rowsHeightCollection:[];if(!this.getObjectLength(e)&&!this.getObjectLength(f))return!1;for(i=0;i<h.length;i++)if(h[i]!==l[i]){o=l[i]-h[i];s=a[i+1]-o;for(r in e)u=e[r].top,u>s&&(e[r].top=u+o);for(r in f)u=f[r].top,u>s&&(f[r].top=u+o)}},_refreshImpPvts:function(n,t){if(this.model.enablePivotTable&&n)for(var i,r=0,e=this.getObjectLength(n.pivot),u=this.getObjectKeys(n.pivot),f;r<e;)i=n.pivot[u[r]],f={rows:i.rows,columns:i.columns,values:i.values,filters:i.filters},this.getSheet(t)._isUpdated?this.XLPivot._refreshPivotElement(i.dataSheetName+"!"+this._getProperAlphaRange(this._getSheetIndexByName(i.dataSheetName),i.dataRange[0],i.dataRange[1],i.dataRange[2],i.dataRange[3]),this.getSheet(i.sheetIdx).sheetInfo.text+"!"+this._getProperAlphaRange(i.sheetIdx,i.rowIndex,i.colIndex,i.rowIndex,i.colIndex),u[r],f,i):this.XLPivot.createPivotTable(i.dataSheetName+"!"+this._getProperAlphaRange(this._getSheetIndexByName(i.dataSheetName),i.dataRange[0],i.dataRange[1],i.dataRange[2],i.dataRange[3]),this.getSheet(i.sheetIdx).sheetInfo.text+"!"+this._getProperAlphaRange(i.sheetIdx,i.rowIndex,i.colIndex,i.rowIndex,i.colIndex),u[r],f,i),r++;this._isExport||this._getContent(t).find(".e-ss-activepivot").removeClass("e-ss-activepivot");this.hideActivationPanel()},_refreshNameMngr:function(n){n=n||this.model.nameManager;var t=n.length;if(this.model.showRibbon){if(t)while(t--)this.XLRibbon._addNamedRange(n[t].name,n[t].refersto,n[t].comment,n[t].sheetIndex,n[t].scope);this.XLRibbon._updateUseInFormulaTrgt()}this.model.nameManager=n;this.XLEdit._refreshAutoComplete()},_getBorderInput:function(n){n=n.split("_");for(var t=4,i={},r=["top","right","bottom","left"];t--;)n[t].length&&(i[r[t]]=n[t]);return i},_refreshHashCode:function(n){n=n||this._dataContainer.hashCode;for(var t,i=n.length;i--;)t=n[i],t.indexOf("e-format")===-1&&t.indexOf("e-border")===-1&&(n[i]="")},clearUndoRedo:function(){this._undoCollection=[];this._redoCollection=[];this._updateUndoRedoIcons()},_initializePicture:function(n){this._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content").append(t.buildTag("div.e-ss-imgvisual"))},_getShapePositionInManager:function(n,t,i,r){for(var o=this.getActiveSheetIndex(),f=this._dataContainer.sheets[o][n][t],u=0,e=f.length;u<e;u++)if(f[r][u].id===i)break;return u},_swapVal:function(n){var t=n.prev;n.prev=n.cur;n.cur=t},_getValue:function(n,t){for(var i,r=n.length;r--;)if(i=n[r],i.value===t)return i.value},_isRowViewable:function(n,t){var i=this.getSheet(n),r=i._isVPRendered;return this.model.scrollSettings.allowVirtualScrolling&&(r=i._virtualRowIdx.indexOf(t)>-1),r},_isColumnViewable:function(){return!0},_undoRedoOperation:function(t){var r,u,i=this.getActiveCell();(t.which===90||t.keyCode===90)&&t.ctrlKey?(t.preventDefault(),t.target.id.indexOf("_Edit")>-1||t.target.id.indexOf("_input")>-1?(r=this.XLEdit.getCurrentEditCellData(),r!==this._cureditedCell&&(u=r,t.target.id.indexOf("_Edit")>-1?t.target.textContent=this._cureditedCell:n("#"+this._id+"_Edit")[0].textContent=this._cureditedCell,this.model.allowFormulaBar&&this._getInputBox().val(this._cureditedCell),this._undoInputobj={value:u,rowIndex:i.rowIndex,colIndex:i.colIndex})):(this._isUndo=!0,this._performUndoRedo())):(t.which===89||t.keyCode===89)&&t.ctrlKey&&(t.preventDefault(),t.target.id.indexOf("_Edit")>-1||t.target.id.indexOf("_input")>-1?i.rowIndex===this._undoInputobj.rowIndex&&i.colIndex===this._undoInputobj.colIndex&&(t.target.id.indexOf("_Edit")>-1?t.target.textContent=this._undoInputobj.value:n("#"+this._id+"_Edit")[0].textContent=this._undoInputobj.value,this.model.allowFormulaBar&&this._getInputBox().val(this._undoInputobj.value)):(this._isUndo=!1,this._performUndoRedo()))},undo:function(){this._isUndo=!0;this._performUndoRedo()},redo:function(){this._isUndo=!1;this._performUndoRedo()},_performUndoRedo:function(){var n=this._isUndo?this._undoCollection.pop():this._redoCollection.pop(),i,r;if(!t.isNullOrUndefined(n)){n.sheetIndex!==this.getActiveSheetIndex()&&this.gotoPage(n.sheetIndex,null);this._isUndoRedo=!0;switch(n.reqType){case"auto-fill":this._undoForAutoFill(n);break;case"auto-sum":this._undoForAutoSum(n);break;case"cell-format":this._undoForFormat(n);break;case"cell-styles":this._undoForStyle(n);break;case"clear-all":this._undoForClAll(n);break;case"clear-comment":this._undoForClComment(n);break;case"clear-content":this._undoForClContent(n);break;case"clear-format":this._undoForClFormat(n);break;case"clear-link":this._undoForCLLink(n);break;case"comment":this._undoForComment(n);break;case"cond-format":this._undoForCondFormat(n);break;case"copy-paste":this._isCopyPaste=!0;this._undoForCopyPaste(n);this._isCopyPaste=!1;break;case"cut-paste":this._isCopyPaste=!0;this._undoForCutPaste(n);this._isCopyPaste=!1;break;case"delete":this._undoForDel(n);break;case"edit":this._undoForEdit(n);break;case"filter":this._undoForFilter(n);break;case"filterbycolor":this._undoForFilterByColor(n);break;case"find-replace":this._undoForFind(n);break;case"format-painter":this._undoForFormatPaint(n);break;case"format-table":this._undoForFormatTable(n);break;case"hyperlink":this._undoForHyperlink(n);break;case"insert":this._undoForIns(n);break;case"merge-cells":this._undoForMerge(n);break;case"paging":r=n.nSheetIndex;n.nSheetIndex=n.sheetIndex;n.sheetIndex=r;break;case"pivotgrid":this._undoForPivot(n);break;case"resize-column":this._undoForResizeCol(n);break;case"resize-row":this._undoForResizeRow(n);break;case"resize-fit-height":this._undoForResizeFHeight(n);break;case"resize-fit-width":this._undoForResizeFWidth(n);break;case"reorder-cells":this._undoForReOrder(n);break;case"show-hide":this._undoForShowHide(n);break;case"shape":this._undoForShape(n);break;case"sort":this._undoForSort(n);break;case"sortbycolor":this._undoForSortByColor(n);break;case"textwrap":this._undoForTextWrap(n);break;case"validation":this._undoForValidation(n);break;case"sparkline":this.XLSparkline._undoForSparkline(n)}if(this._isUndo?this._redoCollection.push(n):this._undoCollection.push(n),i={sheetIdx:n.sheetIndex,reqType:this._isUndo?"undo":"redo",operation:n},this._undoCollection.length>this.undoRedoStep&&this._undoCollection.splice(0,1),this._redoCollection.length>this.undoRedoStep&&this._redoCollection.splice(0,1),this._updateUndoRedoIcons(),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this._isUndoRedo=!1,this._isUndo=!1,this.model.allowSelection&&n.reqType!="shape"&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._trigActionComplete(i))return}},_undoForAutoFill:function(t){var r=this.getSheet(t.sheetIndex),i;if(this._isUndo){if(this.clearRangeData(t.range,this._cellProp),this.model.allowCellFormatting&&(this.XLFormat.removeStyle(t.range),this.XLFormat.updateFormat(t.bFormat,t.range),this.XLResize))for(i=t.range[0];i<=t.range[2];i++)this.XLResize.setRowHeight(i,t.bHeight[i]);this.updateData(n.extend(!0,[],t.bData),t.range);t.actionType=="flash-fill"&&this.updateData(n.extend(!0,[],t.bdData),t.bRange);t.colSel?this.XLSelection.selectColumns(r._startCell.colIndex,r._endCell.colIndex):t.rowSel?this.XLSelection.selectRows(r._startCell.rowIndex,r._endCell.rowIndex):this.performSelection({rowIndex:t.bRange[0],colIndex:t.bRange[1]},{rowIndex:t.bRange[2],colIndex:t.bRange[3]})}else{for(this.model.allowCellFormatting&&(this.XLFormat.removeStyle(t.range),this.XLFormat.updateFormat(t.aFormat,t.range)),this.updateData(n.extend(!0,[],t.aData),t.range),this.XLCFormat.refreshCFormat(),t.actionType=="flash-fill"&&this.updateData(n.extend(!0,[],t.adData),t.bRange),i=t.range[0];i<=t.range[2];i++)this.XLResize.setRowHeight(i,t.aHeight[i]);this.performSelection({rowIndex:t.bRange[0],colIndex:t.bRange[1]},{rowIndex:t.range[2],colIndex:t.range[3]})}},_undoForAutoSum:function(t){var e=this._dataContainer.sheets[t.sheetIndex],r,u,i,f;if(this._isUndo){for(i=0,f=t.updCell.length;i<f;i++)r=this.getCell(t.updCell[i].rowIndex,t.updCell[i].colIndex,t.sheetIndex),this._clearFormula(t.updCell[i].rowIndex,t.updCell[i].colIndex),this.clearRangeData([t.updCell[i].rowIndex,t.updCell[i].colIndex,t.updCell[i].rowIndex,t.updCell[i].colIndex],["value2"],null,!0),u=n.extend(!0,{},t.updCell[i].pObj),e[t.updCell[i].rowIndex][t.updCell[i].colIndex]=u,r.text(t.updCell[i].pValue);this.performSelection(t.range)}else this.XLRibbon.autoSum(t.oprType,t.range)},_undoForClAll:function(t){var i,r;if(this._isPaste=this._dupDetails=!0,this._isUndo){for(this.updateData(n.extend(!0,[],t.bData),t.range),this.XLFormat.updateFormat(n.extend(!0,[],t.bBorder),t.range),i=0,r=t.wrapColl.length;i<r;i++)this.setWrapText("wrap",[t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx,t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx]);for(i=0,r=t.mergeColl.length;i<r;i++)this.mergeCenter=t.mergeColl[i].mergeObj.isCenterAlign,this.mergeCells(t.mergeColl[i].mergeObj.mRange,!0)}else this.model.showRibbon&&this.XLRibbon._isMergeSelect&&this.XLRibbon._isFilterSelect.status?(this.clearRangeData(t.range,["value","value2","hyperlink","cFormatRule","comment"],"",!1),this.XLFormat.removeStyle(null,{cellStyle:!0,format:!0})):this.clearRangeData(t.range,["value","value2","format","formats","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","comment","cFormatRule","border"]),this.setWrapText("unwrap",t.range),this.unmergeCells(t.range);this._isPaste=this._dupDetails=!1;t.tblObj&&(this._isUndo?(this.XLClipboard._isCut=!0,this.XLFormat.createTable(t.tblObj,t.tblObj.range),this.XLClipboard._isCut=!1):(this.XLFormat.removeTable(t.tblObj.tblId),this.clearRangeData(t.range,["value","value2","format","formats","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","comment","cFormatRule"]),this.XLFormat.removeStyle(t.range,{cellStyle:!0,tableStyle:!0,format:!0,border:!0}),this.XLRibbon._toggleDesignTab(this.getActiveCell())));this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t.range);this.model.allowDataValidation&&!this._isUndo&&this.XLValidate.clearDV();this.model.allowFormulaBar&&this.updateFormulaBar()},_undoForClComment:function(n){var r,u,f,t,e;if(n.selectedCell.length){if(u={rowIndex:n.selectedCell[0].rowIndex,colIndex:n.selectedCell[0].colIndex},f={rowIndex:n.selectedCell[n.selectedCell.length-1].rowIndex,colIndex:n.selectedCell[n.selectedCell.length-1].colIndex},this._isUndo)for(t=0,e=n.selectedCell.length;t<e;t++)r={rowIndex:n.selectedCell[t].rowIndex,colIndex:n.selectedCell[t].colIndex},this.XLEdit._updateDataContainer({rowIndex:n.selectedCell[t].rowIndex,colIndex:n.selectedCell[t].colIndex},{dataObj:{comment:n.selectedCell[t].prevComment}}),this.XLSelection.selectRange(r,r),this.XLComment.setComment(),this.XLComment._updateCurCmntVal();else this.XLSelection.selectRange(u,f),this.XLComment.deleteComment(i,null,!1,"clear");this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()}},_undoForClContent:function(t){this._isUndo?this.updateData(n.extend(!0,[],t.bData),t.range):this.clearRangeData(t.range,["value","value2","type","hyperlink"],t.reqType);this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t.range);this.model.allowFormulaBar&&this.updateFormulaBar()},_undoForClFormat:function(t){if(this._isUndo){for(var i=0,r=t.wrapColl.length;i<r;i++)this.setWrapText("wrap",[t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx,t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx]);for(i=0,r=t.mergeColl.length;i<r;i++)this.mergeCenter=t.mergeColl[i].mergeObj.isCenterAlign,this.mergeCells(t.mergeColl[i].mergeObj.mRange,!0);this.updateData(n.extend(!0,[],t.bData),t.range,t.reqType)}else this.XLRibbon._isMergeSelect&&this.XLRibbon._isFilterSelect.status?(this.clearRangeData(t.range,["decimalPlaces","thousandSeparator","hyperlink","cFormatRule"],"",!1,t.reqType),this.XLFormat.removeStyle(null,{cellStyle:!0,format:!0})):this.clearRangeData(t.range,["format","formats","border","type","formatstr","decimalPlaces","thousandSeparator","hyperlink","cFormatRule"],"",!1,t.reqType),this.setWrapText("unwrap",t.range),this.unmergeCells(t.range);this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t.range)},_undoForCLLink:function(n){var i,r,f={rowIndex:n.selectedCell[0].rowIndex,colIndex:n.selectedCell[0].colIndex},e,u,o={rowIndex:n.selectedCell[n.selectedCell.length-1].rowIndex,colIndex:n.selectedCell[n.selectedCell.length-1].colIndex};if(this.setActiveCell(n.selectedCell[0].rowIndex,n.selectedCell[0].colIndex),this.XLSelection.selectRange(f,o),this._isUndo)for(i=0,r=n.selectedCell.length;i<r;i++)n.selectedCell[i].prevLink&&(u=this.getCell(n.selectedCell[i].rowIndex,n.selectedCell[i].colIndex),n.selectedCell[i].prevLink.webAddr?u.html(t.buildTag("a.e-hyperlinks",n.selectedCell[i].prevText,"",{href:n.selectedCell[i].prevLink.webAddr,target:"_blank"})):u.html(t.buildTag("a.e-hyperlinks",n.selectedCell[i].prevText,"")),this.isUndefined(n.selectedCell[i].prevLink.cellAddr)?this.XLEdit._updateDataContainer({rowIndex:n.selectedCell[i].rowIndex,colIndex:n.selectedCell[i].colIndex},{dataObj:{hyperlink:{webAddr:n.selectedCell[i].prevLink.webAddr}}}):this.XLEdit._updateDataContainer({rowIndex:n.selectedCell[i].rowIndex,colIndex:n.selectedCell[i].colIndex},{dataObj:{hyperlink:{cellAddr:n.selectedCell[i].prevLink.cellAddr}}}));else this._removeHyperlink("clear",n.selectedCell);for(this.XLSelection.selectRange(f,o),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),i=0,r=n.selectedCell.length;i<r;i++)e=n.selectedCell[i].prevLink,n.selectedCell[i].prevLink=n.selectedCell[i].curLink,n.selectedCell[i].curLink=e},_undoForComment:function(n){var t,u,f,r,i,e;for(u={rowIndex:n.selectedCell[0].rowIndex,colIndex:n.selectedCell[0].colIndex},f={rowIndex:n.selectedCell[n.selectedCell.length-1].rowIndex,colIndex:n.selectedCell[n.selectedCell.length-1].colIndex},i=0,e=n.selectedCell.length;i<e;i++)t={rowIndex:n.selectedCell[i].rowIndex,colIndex:n.selectedCell[i].colIndex},this.XLSelection.selectRange(t,t),this.getSheet(n.sheetIndex)._startCell=t,n.action==="add"?(n.selectedCell[i].prevComment=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"comment"),this.XLComment&&this.XLComment.deleteComment()):n.action==="edit"?(this._isRowViewable(n.sheetIndex,t.rowIndex)&&this.getCell(t.rowIndex,t.colIndex).find(".e-comment-txtarea").val(n.selectedCell[i].prevComment.value),this.XLComment._updateCurCmntVal(),r=n.selectedCell[i].prevComment,n.selectedCell[i].prevComment=n.selectedCell[i].curComment,n.selectedCell[i].curComment=r):(this.XLEdit._updateDataContainer(t,{dataObj:{comment:n.selectedCell[i].prevComment}}),this.XLComment.setComment([t.rowIndex,t.colIndex,t.rowIndex,t.colIndex],null,!1),this.XLSelection.selectRange(t,t),this.XLComment._updateCurCmntVal(),r=n.selectedCell[i].prevComment,n.selectedCell[i].prevComment=n.selectedCell[i].curComment,n.selectedCell[i].curComment=r);n.action==="add"?n.action="delete":n.action==="delete"&&(n.action="add");this.XLSelection.selectRange(u,f);this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForCondFormat:function(n){var i,e,o,v,y,h,l,r,s=[],c,u,f,a,p;if(n.range=n.data,this._isUndo){if(n.action==="add"){for(f=this._getSelectedRange({rowIndex:n.range[0],colIndex:n.range[1]},{rowIndex:n.range[2],colIndex:n.range[3]}),l=this.XLEdit.getPropertyValue(f[0].rowIndex,f[0].colIndex,"cFormatRule"),n.poppedRule=l[l.length-1],i=0,o=f.length;i<o;i++){if(c=this.XLEdit.getPropertyValue(f[i].rowIndex,f[i].colIndex,"cFormatRule"),!this.isUndefined(c))for(c.pop(),e=0,y=c.length;e<y;e++)h=c[e],s.length===0?(r=h.indexOf("true")>-1?h.replace("_true",""):h.replace("_false",""),s.push(r)):s=this._addCondFormatRule(s,h);this._isRowViewable(n.sheetIndex,f[i].rowIndex)&&(u=this.getCell(f[i].rowIndex,f[i].colIndex,n.sheetIndex),u.removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),u[0].style.color="",u[0].style.backgroundColor="",u.removeClass("e-cformat"),a=u.children().find(".e-databar-value"),p=a[0]&&a[0].textContent,u.children().hasClass("e-cf-databar")&&(u.find(".e-cf-databar").remove(),this.XLEdit._refreshTextNode(u[0],p)),(u.hasClass("e-iconset")||u.children().find(".e-iconsetspan").length>0)&&(u.removeClass(".e-iconset"),u.find(".e-iconsetspan").remove()))}for(this.clearRangeData(n.range,["cFormatRule"],f),i=0,o=s.length;i<o;i++)r=s[i].split("_"),this.XLCFormat._cFormat(r[0],r[2],r[3],r[4],r[5],r[6],n.sheetIndex,n.range)}else if(n.action==="clear")for(i=0,o=n.rule.length;i<o;i++)for(e=0,v=n.rule[i].length;e<v;e++)this.XLCFormat.setCFRule(n.rule[i][e])}else n.action==="add"?t.isNullOrUndefined(n.poppedRule)||(r=n.poppedRule.split("_"),this.XLCFormat._cFormat(r[0],r[2],r[3],r[4],r[5],r[6],n.sheetIndex,n.range)):n.action==="clear"&&(n.selection?this.XLCFormat.clearCF(n.range):this.XLCFormat.clearCF())},_getCopyText:function(n){for(var i,u,e=[],r,t=0,f=n.length;t<f;t++)for(r=n[t].split("\t"),i=0,u=r.length;i<u;i++)e.push(r[i]);return e},_cutShape:function(t,i,r,u){for(var o,h,e=["picture","chart"],s,f=0,c=e.length;f<c;f++)if(e[f]in t)for(this.XLShape._picCellIdx={rowIndex:i.rowIndex,colIndex:i.colIndex},o=0,h=t[e[f]].length;o<h;o++)s=n.extend(!0,{},r[e[f]][t[e[f]][o]]),this.XLShape._deleteShape(u,this.element.find("#"+s.id))},_pasteShape:function(t,i,r,u){for(var h,l,s=["picture","chart"],f,e,c,o=0,a=s.length;o<a;o++)if(s[o]in t){for(h=0,l=t.picture.length;h<l;h++)f=n.extend(!0,{},r[s[o]][t[s[o]][h]]),this.XLChart._shapeCnt===1||this.XLChart._shapeCnt--,s[o]==="picture"?(c=this._id+"_picture",this.XLShape._createPicture(u,{rowIndex:i.rowIndex,colIndex:i.colIndex},r.sharedPics[f.data],f.top,f.left,f.width,f.height,parseInt(f.id.replace(c,"")))):(e=f.range,this.XLChart.createChart(this._getAlphaRange(u,e[0],e[1],e[2],e[3]),f));s[o]==="chart"&&this.XLSelection.selectRange({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]},u)}},_undoForCopyPaste:function(i){var f={},e=this._dataContainer,d,v=this.getSheet(i.pSheetIndex).shapeMngr,u,s,g,nt,y,tt,l,a,it,rt,o,p,w,ut,b,h,r,k,ft,et,ot,c;if(i.operation==="shape")d=i.pShapeId.indexOf("picture")>-1?"picture":"chart",u=n.extend(!0,{},i.pasteCell.obj),t.isNullOrUndefined(u)||(this.XLShape._picCellIdx={rowIndex:i.pasteCell.rowIndex,colIndex:i.pasteCell.colIndex},d==="chart"?"chart"in u&&(this._isUndo?(f=n.extend(!0,{},v.chart[i.pShapeId]),t.isNullOrUndefined(e.sheets[i.pSheetIndex][i.pasteCell.rowIndex])&&(e.sheets[i.pSheetIndex][i.pasteCell.rowIndex]={}),e.sheets[i.pSheetIndex][i.pasteCell.rowIndex][i.pasteCell.colIndex]=u,this.XLShape._deleteShape(i.pSheetIndex,this.element.find("#"+f.id))):(this.setActiveCell(i.pasteCell.rowIndex,i.pasteCell.colIndex,i.pSheetIndex),f=n.extend(!0,{},i.pasteCell.shapeObj),f.isChartSeries?this.XLChart.createChart(null,f):(o=f.range,this.XLChart.createChart(this._getAlphaRange(i.sheetIndex,o[0],o[1],o[2],o[3]),f),this.XLSelection.selectRange({rowIndex:o[0],colIndex:o[1]},{rowIndex:o[2],colIndex:o[3]},i.cSheetIndex)))):"picture"in u&&(this._isUndo?(f=n.extend(!0,{},v.picture[i.pShapeId]),t.isNullOrUndefined(e.sheets[i.pSheetIndex][i.pasteCell.rowIndex])&&(e.sheets[i.pSheetIndex][i.pasteCell.rowIndex]={}),e.sheets[i.pSheetIndex][i.pasteCell.rowIndex][i.pasteCell.colIndex]=u,this.XLShape._deleteShape(i.pSheetIndex,this.element.find("#"+f.id))):(f=n.extend(!0,{},i.pasteCell.shapeObj),ut=this._id+"_picture",this.XLShape._createPicture(i.pSheetIndex,{rowIndex:i.pasteCell.rowIndex,colIndex:i.pasteCell.colIndex},v.sharedPics[f.data],f.top,f.left,f.width,f.height,parseInt(f.id.replace(ut,"")),f.bcolor,f.bstyle,f.bwidth)))),this.XLScroll._getRowHeights(i.pSheetIndex,i.pasteCell.rowIndex);else{for(k=!1,ft=[],e=this._dataContainer,this._getCopyText(i.text),this._dupDetails=!0,this.element.find(".e-cdata").length&&n("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),this.setActiveSheetIndex(i.pSheetIndex),y=0,tt=i.pasteCells.length;y<tt;y++)r=i.pasteCells[y],u=t.isNullOrUndefined(e.sheets[i.pSheetIndex][r.rowIndex])?{}:e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex],this._isUndo||"merge"in r.prevObj&&(this.mergeCenter=r.prevObj.merge.isCenterAlign,this.mergeCells(r.prevObj.merge.mRange,!0)),this._isRowViewable(i.pSheetIndex,r.rowIndex)&&(l=this.getCell(r.rowIndex,r.colIndex,i.pSheetIndex)[0],this._isUndo||u&&!u.selIdxChange&&(l.textContent=ft[y],this._removeClass(l,"e-cellreadonly")),k=!0),t.isNullOrUndefined(u)||(this._cutShape(u,r,v,i.pSheetIndex),a=this._generateHeaderText(r.colIndex+1)+(r.rowIndex+1),"wrap"in u&&this.setWrapText("unwrap",a+":"+a),this.model.allowSparkline&&"sparkline"in u&&(this.XLSparkline._removeSparklineElem(r.rowIndex,r.colIndex,i.pSheetIndex),nt=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"sparkline",i.pSheetIndex),r.newSparklineProp=n.extend(!0,{},this.getSheet(i.pSheetIndex).shapeMngr.sparkline[nt])),"merge"in u&&this._isUndo&&(r.newObj=n.extend(!0,{},e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex]),this.unmergeCells(this._getAlphaRange(i.pSheetIndex,r.rowIndex,r.colIndex,r.rowIndex,r.colIndex)),this.getCell(r.rowIndex,r.colIndex,i.pSheetIndex).prop("rowspan",1).prop("colspan",1),"merge"in r.prevObj&&(this.mergeCenter=r.prevObj.merge.isCenterAlign,this.mergeCells(r.prevObj.merge.mRange,!0),this.mergeCenter=!1))),k&&this._isUndo&&("cellType"in u||(l.textContent=""),this._removeClass(l,"e-commentcell")),t.isNullOrUndefined(e.sheets[i.pSheetIndex][r.rowIndex])&&(e.sheets[i.pSheetIndex][r.rowIndex]={}),t.isNullOrUndefined(e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex])||(b=e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex].overflow),this.model.allowCellFormatting&&this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0,border:!0}),e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex]=n.extend(!0,{},r.prevObj),b&&(e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex].overflow=b),this._textClip(r.rowIndex,r.colIndex,"delete"),this._setRowHdrHeight(i.pSheetIndex,r.rowIndex),u=t.isNullOrUndefined(e.sheets[i.pSheetIndex][r.rowIndex])?{}:e.sheets[i.pSheetIndex][r.rowIndex][r.colIndex],p=r.rowIndex,w=r.colIndex,this._applyCommentLink(u,{rowIndex:r.rowIndex,colIndex:r.colIndex},p,w),this._isPaste=!0,t.isNullOrUndefined(u)||(this._pasteShape(u,{rowIndex:p,colIndex:w},v,i.pSheetIndex),"cellType"in u&&(this._isUndo?(this._removeClass(l,"e-cellreadonly"),u.cTypeObj&&this.model.allowCellType&&(h=this._dataContainer.sheetCellType[u.cellType],h.text="",h.dataSource&&(h.field="text")),this.XLCellType._renderControls(r.rowIndex,r.colIndex,i.pSheetIndex,h,!0)):(h=this._dataContainer.sheetCellType[u.cellType],h.text="",this.model.allowCellType&&this.XLCellType._renderControls(r.rowIndex,r.colIndex,i.pSheetIndex,h,!0))),this.model.allowSparkline&&"sparkline"in u&&(this.getSheet(i.pSheetIndex).shapeMngr.sparkline[u.sparkline[0]]=r.prevSparklineProp,this._isRowViewable(i.cSheetIndex,r.rowIndex)&&(this._getContent(i.cSheetIndex).find("#"+r.prevSparklineProp.id).length||(et=this._getCellInfo({rowIndex:r.rowIndex,colIndex:r.colIndex},i.cSheetIndex),this.XLSparkline._createSparkline(r.prevSparklineProp,et,i.pSheetIndex)))),a=this._generateHeaderText(r.colIndex+1)+(r.rowIndex+1),"wrap"in u&&(this.XLEdit._clearDataContainer({cellIdx:r,property:["wrap"]}),this.setWrapText("wrap",a+":"+a)),this._isPaste=!1),it=r.prevObj,r.prevObj=r.newObj,r.newObj=it,ot=r.prevSparklineProp,r.prevSparklineProp=r.newSparklineProp,r.newSparklineProp=ot;if(i.isSpecial&&(this.model.allowCellFormatting&&(this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0}),this.isUndefined(i.pasteBorder.prevBorder)||this.XLFormat.updateFormat(i.pasteBorder.prevBorder,i.pasteBorder.range,"format")),rt=i.pasteBorder.prevBorder,i.pasteBorder.prevBorder=i.pasteBorder.newBorder,i.pasteBorder.newBorder=rt),!t.isNullOrUndefined(i.pfat))for(c=i.pfat.ptable,s=0,g=c.length;s<g;s++)t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),this._isUndo?(this.XLFormat.removeTable(c[s].id),this.XLFormat.removeStyle(c[s].range)):(c[s].header=!0,this.XLFormat.createTable(c[s],c[s].range)));t.isNullOrUndefined(i.filter)||(this.XLFilter.clearFilter(),this.XLFilter.filter(i.filter));this._dupDetails=!1}i.operation!=="shape"&&(this._isUndo?(t.isNullOrUndefined(i.cSheetIndex)||this.setActiveSheetIndex(i.cSheetIndex),i.cutCells.length>0&&this.XLSelection._focusBorder(i.cutCells[0],i.cutCells[i.cutCells.length-1],this._cutFocus),this.setActiveSheetIndex(i.pSheetIndex),this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1])):(t.isNullOrUndefined(i.cSheetIndex)||this.setActiveSheetIndex(i.cSheetIndex),i.cutCells.length>0&&this.XLSelection._focusBorder(i.cutCells[0],i.cutCells[i.cutCells.length-1],this._cutFocus),this.setActiveSheetIndex(i.pSheetIndex),i.pasteCells.length>0&&this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1])),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this.XLScroll._getRowHeights(i.pSheetIndex,i.pasteCells[0].rowIndex))},_undoForCutPaste:function(i){var d,f,p,s,ot,g,o={},e=this._dataContainer,w=this.getSheet(i.pSheetIndex).shapeMngr,st,nt,et,tt,ht,r,ct,it,v,h,u,c,a,lt,at,y,vt,rt,wt,bt,kt;if(i.operation==="shape")d=i.pShapeId.indexOf("picture")>-1?"picture":"chart",f=n.extend(!0,{},i.pasteCell.obj),t.isNullOrUndefined(f)||(this.XLShape._picCellIdx={rowIndex:i.pasteCell.rowIndex,colIndex:i.pasteCell.colIndex},o=n.extend(!0,{},w[d][i.pShapeId]),t.isNullOrUndefined(e.sheets[i.pSheetIndex][i.pasteCell.rowIndex])&&(e.sheets[i.pSheetIndex][i.pasteCell.rowIndex]={}),e.sheets[i.pSheetIndex][i.pasteCell.rowIndex][i.pasteCell.colIndex]=f,this.XLShape._deleteShape(i.pSheetIndex,this.element.find("#"+o.id))),f=n.extend(!0,{},i.cutCell.obj),d=i.cShapeId.indexOf("picture")>-1?"picture":"chart",t.isNullOrUndefined(f)||(this.setActiveCell(i.cutCell.rowIndex,i.cutCell.colIndex,i.cSheetIndex),d==="chart"?"chart"in f&&(o=n.extend(!0,{},i.cutCell.shapeObj),h=o.range,this.setActiveSheetIndex(i.cSheetIndex),this.XLChart.createChart(o.isChartSeries?null:this._getAlphaRange(i.sheetIndex,h[0],h[1],h[2],h[3]),o),this.setActiveSheetIndex(i.sheetIndex),o.isChartSeries||this.XLSelection.selectRange({rowIndex:h[0],colIndex:h[1]},{rowIndex:h[2],colIndex:h[3]},i.cSheetIndex)):"picture"in f&&(o=n.extend(!0,{},i.cutCell.shapeObj),st=this._id+"_picture",this.XLShape._createPicture(i.cSheetIndex,{rowIndex:i.cutCell.rowIndex,colIndex:i.cutCell.colIndex},w.sharedPics[o.data],o.top,o.left,o.width,o.height,parseInt(o.id.replace(st,"")),o.bcolor,o.bstyle,o.bwidth))),this.XLShape._picCellIdx={rowIndex:i.cutCell.rowIndex,colIndex:i.cutCell.colIndex},tt=i.pasteCell,i.pasteCell=i.cutCell,i.cutCell=tt,ht=i.pShapeId,i.pShapeId=i.cShapeId,i.cShapeId=ht;else{for(at=[],this.element.find(".e-cdata").length&&n("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),this._getCopyText(i.text),r=0,ct=i.pasteCells.length;r<ct;r++)t.isNullOrUndefined(i.pSheetIndex)||(this.isUndefined(e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex])||(f=e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex]),v=this._generateHeaderText(i.pasteCells[r].colIndex+1)+(i.pasteCells[r].rowIndex+1),"wrap"in f&&this.setWrapText("unwrap",v+":"+v),this._isRowViewable(i.pSheetIndex,i.pasteCells[r].rowIndex)&&(nt=this.getCell(i.pasteCells[r].rowIndex,i.pasteCells[r].colIndex,i.pSheetIndex)[0],this.model.allowSparkline&&"sparkline"in f&&(this.XLSparkline._removeSparklineElem(i.pasteCells[r].rowIndex,i.pasteCells[r].colIndex,i.pSheetIndex),vt=this.XLEdit.getPropertyValue(i.pasteCells[r].rowIndex,i.pasteCells[r].colIndex,"sparkline",i.pSheetIndex),i.pasteCells[r].newSparklineProp=n.extend(!0,{},this.getSheet(i.pSheetIndex).shapeMngr.sparkline[vt])),nt.textContent="",this._removeClass(nt,"e-commentcell")),this.isUndefined(f)||(this._cutShape(f,i.pasteCells[r],w,i.pSheetIndex),"merge"in f&&(this._isUndo?(n.extend(!0,i.pasteCells[r].newObj,e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex]),this.setActiveSheetIndex(i.pSheetIndex),this.unmergeCells(f.merge.mRange),this.getCell(i.pasteCells[r].rowIndex,i.pasteCells[r].colIndex,i.pSheetIndex).prop("rowspan",1).prop("colspan",1),"merge"in i.pasteCells[r].prevObj&&(this.mergeCenter=i.pasteCells[r].prevObj.merge.isCenterAlign,this.mergeCells(i.pasteCells[r].prevObj.merge.mRange,!0),this.mergeCenter=!1)):(this.setActiveSheetIndex(i.pSheetIndex),this.unmergeCells(f.merge.mRange,!0),"merge"in i.pasteCells[r].prevObj&&(this.mergeCenter=i.pasteCells[r].prevObj.merge.isCenterAlign,this.mergeCells(i.pasteCells[r].prevObj.merge.mRange,!0),this.mergeCenter=!1),this.setActiveSheetIndex(i.cSheetIndex),this.unmergeCells(this._getAlphaRange(i.pSheetIndex,i.cutCells[r].rowIndex,i.cutCells[r].colIndex,i.cutCells[r].rowIndex,i.cutCells[r].colIndex)),h=this.getRangeIndices(i.cutCells[r].prevObj.merge.mRange),this.XLSelection.selectRange({rowIndex:h[0],colIndex:h[1]},{rowIndex:h[2],colIndex:h[3]},i.sheetIndex))),"cellType"in f&&(this._removeClass(nt,"e-cellreadonly"),f.cTypeObj&&this.model.allowCellType&&(y=this._dataContainer.sheetCellType[f.cellType],y.text="",y.dataSource&&(y.field="text")),this.XLCellType._renderControls(tt.rowIndex,tt.colIndex,i.pSheetIndex,y,!0))),this.isUndefined(e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex])&&(e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex]={}),t.isNullOrUndefined(e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex])||(p=e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex].overflow),this.model.allowCellFormatting&&this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0,border:!0}),e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex].wrap&&(et=!0),e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex]=n.extend(!0,{},i.pasteCells[r].prevObj),this._textClip(i.pasteCells[r].rowIndex,i.pasteCells[r].colIndex,"delete"),this.isUndefined(e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex])||(p&&(e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex].overflow=p),this._setRowHdrHeight(i.pSheetIndex,i.pasteCells[r].rowIndex),f=e.sheets[i.pSheetIndex][i.pasteCells[r].rowIndex][i.pasteCells[r].colIndex],c=i.pasteCells[r].rowIndex,a=i.pasteCells[r].colIndex,this._applyCommentLink(f,{rowIndex:c,colIndex:a},c,a),et&&(f.wrap=et),this._isPaste=!0,t.isNullOrUndefined(f)||(this._pasteShape(f,{rowIndex:c,colIndex:a},w,i.pSheetIndex,i.sheetIndex),v=this._generateHeaderText(a+1)+(c+1),"wrap"in f&&(this.XLEdit._clearDataContainer({cellIdx:i.pasteCells[r],property:["wrap"]}),this.setWrapText("wrap",v+":"+v)))),it=i.pasteCells[r].prevObj,i.pasteCells[r].prevObj=i.pasteCells[r].newObj,i.pasteCells[r].newObj=it,rt=i.pasteCells[r].prevSparklineProp,i.pasteCells[r].prevSparklineProp=i.pasteCells[r].newSparklineProp,i.pasteCells[r].newSparklineProp=rt,this._isPaste=!1);for(r=0;r<i.cutCells.length;r++)t.isNullOrUndefined(i.cSheetIndex)||(u=i.cutCells[r],this._isRowViewable(i.cSheetIndex,u.rowIndex)&&(lt=this.getCell(u.rowIndex,u.colIndex,i.cSheetIndex)[0],lt.textContent=at[r]),this.setActiveSheetIndex(i.cSheetIndex),f=t.isNullOrUndefined(e.sheets[i.cSheetIndex][u.rowIndex])?{}:e.sheets[i.cSheetIndex][u.rowIndex][u.colIndex],t.isNullOrUndefined(f)||this._cutShape(f,u,w,i.cSheetIndex),t.isNullOrUndefined(e.sheets[i.cSheetIndex][u.rowIndex])&&(e.sheets[i.cSheetIndex][u.rowIndex]={}),t.isNullOrUndefined(e.sheets[i.cSheetIndex][u.rowIndex][u.colIndex])||(p=e.sheets[i.cSheetIndex][u.rowIndex][u.colIndex].overflow),u.prevObj.tableName&&delete u.prevObj.tableName,e.sheets[i.cSheetIndex][u.rowIndex][u.colIndex]=n.extend(!0,{},u.prevObj),this.getObjectLength(p)>0&&(e.sheets[i.cSheetIndex][u.rowIndex][u.colIndex].overflow=p)&&(p={}),it=u.prevObj,u.prevObj=u.newObj,u.newObj=it,rt=u.prevSparklineProp,u.prevSparklineProp=u.newSparklineProp,u.newSparklineProp=rt,c=u.rowIndex,a=u.colIndex,this._setRowHdrHeight(i.cSheetIndex,c),this.XLScroll._getRowHeights(i.cSheetIndex,c),f=t.isNullOrUndefined(e.sheets[i.cSheetIndex][c])?{}:e.sheets[i.cSheetIndex][c][a],this._applyCommentLink(f,{rowIndex:c,colIndex:a},c,a),this._isPaste=!0,t.isNullOrUndefined(f)||(this._pasteShape(f,{rowIndex:c,colIndex:a},w,i.cSheetIndex),"merge"in f&&(this.mergeCenter=f.merge.isCenterAlign,this.mergeCells(f.merge.mRange,!0),this.mergeCenter=!1),"cellType"in f&&(y=this._dataContainer.sheetCellType[f.cellType],y.text="",this.model.allowCellType&&this.XLCellType._renderControls(u.rowIndex,u.colIndex,i.pSheetIndex,y,!0)),this.model.allowSparkline&&"sparkline"in f&&(this.getSheet(i.pSheetIndex).shapeMngr.sparkline[f.sparkline[0]]=u.newSparklineProp,this._isRowViewable(i.cSheetIndex,u.rowIndex)&&(this._getContent(i.cSheetIndex).find("#"+u.newSparklineProp.id).length||this.XLSparkline._refreshSparklineClipboard(u.rowIndex,u.colIndex,i.pSheetIndex,i.cSheetIndex,!0))),this._dupDetails=!0,v=this._generateHeaderText(u.colIndex+1)+(u.rowIndex+1),"wrap"in f&&(this.XLEdit._clearDataContainer({cellIdx:u,property:["wrap"]}),this.setWrapText("wrap",v+":"+v)),this._dupDetails=!1),this._isPaste=!1);if(this.XLScroll._getRowHeights(i.pSheetIndex,i.pasteCells[0].rowIndex<i.cutCells[0].rowIndex?i.pasteCells[0].rowIndex:i.cutCells[0].rowIndex),this.model.allowCellFormatting&&!t.isNullOrUndefined(i.pSheetIndex)&&(this.setActiveSheetIndex(i.pSheetIndex),this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0}),this.isUndefined(i.pasteBorder.prevBorder)||this.XLFormat.updateFormat(i.pasteBorder.prevBorder,i.pasteBorder.range,"format")),g=i.pasteBorder.prevBorder,i.pasteBorder.prevBorder=i.pasteBorder.newBorder,i.pasteBorder.newBorder=g,this.model.allowCellFormatting&&!t.isNullOrUndefined(i.cSheetIndex)&&(this.setActiveSheetIndex(i.cSheetIndex),i.isSpecial&&this.XLFormat.removeStyle(i.cutBorder.range,{cellStyle:!0,tableStyle:!0,format:!0}),i.cutBorder.prevBorder&&this.XLFormat.updateFormat(i.cutBorder.prevBorder,i.cutBorder.range,"format")),g=i.cutBorder.prevBorder,i.cutBorder.prevBorder=i.cutBorder.newBorder,i.cutBorder.newBorder=g,!t.isNullOrUndefined(i.pfat)){var b,l=i.pfat.table,k,yt=i.pfat.minRowIdx,pt=i.pfat.minColIdx,ut,ft=i.pfat.range;for(s=0,ot=l.length;s<ot;s++)k=l[s].range,t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),ut=l[s].tblObj.tblId,b=i.pfat.ptable[s].range,this.XLFormat.removeTable(ut),this.XLFormat.removeStyle(b)),t.isNullOrUndefined(i.cSheetIndex)||(this.setActiveSheetIndex(i.cSheetIndex),this.XLClipboard._isCut=!0,this._isUndo?(this.XLFormat.createTable(l[s].tblObj,l[s].range),l[s].tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,ut,l[s].tblObj.fnNumber,l[s].range,!0)):(b=this.getRangeIndices(this._getAlphaRange(i.cSheetIndex,k[0]+yt-ft[0],k[1]+pt-ft[1],yt-ft[0]+k[2],pt-ft[1]+k[3])),this.XLFormat.createTable(l[s].tblObj,b),l[s].tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,ut,l[s].tblObj.fnNumber,b,!0)),this.XLClipboard._isCut=!1)}t.isNullOrUndefined(i.filter)||(this.XLFilter.clearFilter(),this.XLFilter.filter(i.filter))}i.operation!=="shape"&&(this._isUndo?(t.isNullOrUndefined(i.cSheetIndex)||(this.setActiveSheetIndex(i.cSheetIndex),this.XLSelection.selectRange(i.cutCells[0],i.cutCells[i.cutCells.length-1])),t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1]))):(t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),this.XLSelection._focusBorder(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1],this._cutFocus),this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1])),t.isNullOrUndefined(i.cSheetIndex)||(this.setActiveSheetIndex(i.cSheetIndex),this.XLSelection.selectRange(i.cutCells[0],i.cutCells[i.cutCells.length-1]))));this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();wt=i.pasteCells;i.pasteCells=i.cutCells;i.cutCells=wt;bt=i.pasteBorder;i.pasteBorder=i.cutBorder;i.cutBorder=bt;kt=i.cSheetIndex;i.cSheetIndex=i.pSheetIndex;i.pSheetIndex=kt},_undoForDel:function(t){this._delCells=n.extend(!0,[],t.delCells);this._deletedText=n.extend(!0,[],t.text);this._removeMergeColl=n.extend(!0,[],t.removeMerge);this._deletedDimension=n.extend(!0,[],t.deletedDimension);this._isUndo&&(this._fRow.fRowCnt=t.fRow.fRowCnt,this._fCol.fColCnt=t.fCol.fColCnt,this._fRow.rowAdj=t.fRow.rowAdj,this._fCol.colAdj=t.fCol.colAdj,this._nmRef=t.nmref);n.extend(!0,this._cellTypesUndo,t.prevCellTypes);n.extend(!0,this._cellTypesRedo,t.curCellTypes);n.extend(!0,this._chartUndo,t.prevChartDetails);n.extend(!0,this._chartRedo,t.curChartDetails);n.extend(!0,this._valDataUndo,t.prevValData);n.extend(!0,this._valDataRedo,t.curValData);switch(t.action){case"deleteShiftUp":this.deleteShiftUp(t.startCell,t.endCell);break;case"deleteShiftLeft":this.deleteShiftLeft(t.startCell,t.endCell);break;case"deleteRow":this.deleteEntireRow(t.startCell.rowIndex,t.endCell.rowIndex);break;case"deleteColumn":this.deleteEntireColumn(t.startCell.colIndex,t.endCell.colIndex)}},_undoForEdit:function(n){var o,r,h,l,e,u,a,s=n.cFormatRule,f={rowIndex:n.rowIndex,colIndex:n.colIndex},c,i,v,y=this.getRows(n.sheetIndex);if(this.setActiveCell(n.rowIndex,n.colIndex,n.sheetIndex),this.XLSelection.selectRange(n.startCell,n.endCell),this._isRowViewable(n.sheetIndex,n.rowIndex)&&(i=this.getCell(n.rowIndex,n.colIndex),v=i.find("a").css("text-decoration"),n.altwrap&&(this._isUndo?(this.XLEdit._clearDataContainer({cellIdx:f,property:["altTxt"]}),this.unWrapText([n.rowIndex,n.colIndex,n.rowIndex,n.colIndex])):(this.XLEdit._updateDataContainer(f,{dataObj:{altTxt:!0}}),this.wrapText([n.rowIndex,n.colIndex,n.rowIndex,n.colIndex])))),r=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"hyperlink",n.sheetIndex),t.isNullOrUndefined(r)||(h=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"value2"),n.action=h.length<1?"add":"delete",n.reqType="edit",f.prevLink=r,f.prevText=h,n.selectedCell=[]),c=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"comment"),this.XLEdit._updateCellValue({rowIndex:n.rowIndex,colIndex:n.colIndex},n.pValue),this._dupDetails=!0,s&&s.length){for(o=0,a=s.length;o<a;o++)u=s[o].split("_"),this.XLCFormat._cFormat(u[0],u[2],u[3],u[4],u[5],u[6]);this.XLCFormat.refreshCFormat(this._getAlphaRange(n.sheetIndex,n.rowIndex,n.colIndex,n.rowIndex,n.colIndex))}n.prevFrmtObj&&n.curFrmtObj&&(l=this._isUndo?n.prevFrmtObj:n.curFrmtObj,this.XLFormat.format(l,this._getAlphaRange(n.sheetIndex,n.rowIndex,n.colIndex,n.rowIndex,n.colIndex)));this._dupDetails=!1;this._textClip(n.rowIndex,n.colIndex,n.pValue.length>0?"add":"delete");t.isNullOrUndefined(c)||(this.XLEdit._updateDataContainer({rowIndex:n.rowIndex,colIndex:n.colIndex},{dataObj:{comment:c}}),this.XLComment.setComment(),this.XLComment._updateCurCmntVal());this._isRowViewable(n.sheetIndex,n.rowIndex)&&(r&&(r.webAddr?i.html(t.buildTag("a",i.text(),"",{href:r.webAddr,target:"_blank","class":"e-hyperlinks"})):i.html(t.buildTag("a",i.text(),"",{"class":"e-hyperlinks"}))),i.find("a").css("text-decoration",v),i.removeClass("e-commentcell"));t.isNullOrUndefined(r)||(f.curLink=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"hyperlink"),f.curText=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"value2"),n.selectedCell.push(f));n.prevHeight!=n.newHeight&&(this.getSheet(n.sheetIndex).rowsHeightCollection[n.rowIndex]=n.prevHeight,this._isRowViewable(n.sheetIndex,n.rowIndex)&&(y[0][n.rowIndex].style.height=n.prevHeight+"px",y[1][n.rowIndex].style.height=n.prevHeight+"px"),this._setRowHdrHeight(n.sheetIndex,n.rowIndex),this.XLScroll._getRowHeights(n.sheetIndex,n.rowIndex),e=n.newHeight,n.newHeight=n.prevHeight,n.prevHeight=e);e=n.cValue;n.cValue=n.pValue;n.pValue=e;this.XLEdit._isEdit=!1;e=n.previousValue;n.previousValue=n.value;n.value=e;this.model.allowFormulaBar&&this.updateFormulaBar();this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForFilter:function(i){var y=!1,v=[],u,k,c=[],r,e,o,s,f,d=i.sheetIndex||this.getActiveSheetIndex(),b=this._dataContainer.sheets[d],p,g,l,h,w,a,nt;if(i.operation==="filter"&&i.requestType!=="filterbycell")if(this._isUndo){for(r=this._undoCollection.length-1;r>=0;r--){if(this._undoCollection[r].reqType==="filter"&&this._undoCollection[r].tableID===i.tableID&&this._undoCollection[r].action==="filtering"&&this._undoCollection[r].status!=="apply-filterIcon"&&this._undoCollection[r].rowIndex===i.rowIndex&&this._undoCollection[r].colIndex===i.colIndex){for(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],u=this._undoCollection[r],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,u.tableID),r=0,e=u.filterCollection.length;r<e;r++)v.push(u.filterCollection[r]);this.model.sheets[u.sheetIndex].filterSettings.filteredColumns=v;t.isNullOrUndefined(this._excelFilter._predicates[u.sheetIndex][u.fieldName])&&(this._excelFilter._predicates[u.sheetIndex][u.fieldName]={});this._excelFilter._predicates[u.sheetIndex][u.fieldName]=u.ejpredicate;this.model.sheets[u.sheetIndex]._selectedRange=u.range;this.XLFilter._filterHandler(u);y=!0;break}if(this._undoCollection[r].reqType==="filter"&&this._undoCollection[r].tableID===i.tableID&&this._undoCollection[r].action==="clearfiltering"){delete this._excelFilter._predicates[i.sheetIndex][i.fieldName];u=this._undoCollection[r];this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,u.tableID);y=!0;break}if(this._undoCollection[r].requestType==="filterbycell"&&this._undoCollection[r].rowIndex===i.rowIndex&&this._undoCollection[r].colIndex===i.colIndex){u=this._undoCollection[r];delete this._excelFilter._predicates[u.sheetIndex][u.fieldName];this.XLFilter._clearFilterColumn(u.fieldName,"","","Or",null,null,u.tableID);n.extend(!0,c,u.selCells);this.XLFilter._filterActiveCell(u.sheetIndex,u.activeCell,c,u.filteredValue,u.selRange);y=!0;break}}y||(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID))}else{for(v=[],delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),r=0,e=i.filterCollection.length;r<e;r++)v.push(i.filterCollection[r]);this.model.sheets[i.sheetIndex].filterSettings.filteredColumns=v;t.isNullOrUndefined(this._excelFilter._predicates[i.sheetIndex][i.fieldName])&&(this._excelFilter._predicates[i.sheetIndex][i.fieldName]={});this._excelFilter._predicates[i.sheetIndex][i.fieldName]=i.ejpredicate;i.filterCollection.length&&this.XLFilter._filterHandler(i)}else if(this._isUndo){if(i.operation==="apply-filter"&&i.requestType!=="filterbycell")for(r=0,e=i.filteredCells.length;r<e;r++)o=i.filteredCells[r].rowIndex,s=i.filteredCells[r].colIndex,f=this.getCell(o,s,i.sheetIndex),f.find(".e-ssfilter").remove(),this._removeClass(f[0],"e-filterhdr"),this.addClass(f[0],"e-wrapword"),(this.isNumber(f.text())||this.XLEdit._parseValue(f.text(),{rowIndex:o,colIndex:s}).type==="datetime"||this.XLEdit._parseValue(f.text(),{rowIndex:o,colIndex:s}).type==="currency"||this.XLEdit._parseValue(f.text()).type==="percentage")&&f.addClass(this._rAlign),delete b[o][s].isFilterHeader,delete b[o][s].filterState,delete b[o][s].isFilterVisible,this.XLEdit.getPropertyValue(o,s,"isFilterWrap")&&this.setWrapText("wrap",this._getAlphaRange(d,o,s,o,s));if(i.requestType==="filterbycell"&&(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),!this.isUndefined(i.filteredCells)))for(r=0,e=i.filteredCells.length;r<e;r++)f=this.getCell(i.filteredCells[r].rowIndex,i.filteredCells[r].colIndex,i.sheetIndex),f.find(".e-ssfiltered, .e-ssfilter").remove(),this._removeClass(f[0],"e-filterhdr"),this.addClass(f[0],"e-wrapword"),(this.isNumber(f.text())||this.XLEdit._parseValue(f.text(),{rowIndex:i.filteredCells[r].rowIndex,colIndex:i.filteredCells[r].colIndex}).type==="datetime"||this.XLEdit._parseValue(f.text(),{rowIndex:i.filteredCells[r].rowIndex,colIndex:i.filteredCells[r].colIndex}).type==="currency"||this.XLEdit._parseValue(f.text(),{rowIndex:i.filteredCells[r].rowIndex,colIndex:i.filteredCells[r].colIndex}).type==="percentage")&&f.addClass(this._rAlign);if(this.model.sheets[i.sheetIndex].filterSettings.range="",i.operation==="apply-filter"&&i.requestType!="filterbycell"||i.requestType==="filterbycell"&&!this.isUndefined(i.filteredCells)){for(p=this.model.sheets[i.sheetIndex].filterSettings.tableRange,r=0,e=p.length;r<e;r++)if(p[r].tableID===i.tableID){g=r;break}i.filterRange=p.splice(g,1)[0]}if(i.operation==="remove-filter"){if(l=this._undoCollection[this._undoCollection.length-1],h=this.getSheet(i.sheetIndex),l.requestType==="filterbycell")n.extend(!0,c,l.selCells),this.XLFilter._filterActiveCell(l.sheetIndex,l.activeCell,c,l.filteredValue,l.selRange);else for(r=0,e=i.filteredCells.length;r<e;r++)w=this.XLFilter._getFilterIcon(),this.XLFilter._applyFilterIcon(i.filteredCells[r],w);for(h._selectedRange=i.selRange,h.filterSettings.filteredRange=i.fltrdRange,h.filterSettings.filteredColumns=i.filteredCols,h.filterSettings.range=i.fRange,h.filterSettings.tableRange.push(i.filterRange),a=0,nt=i.filterCollection.length;a<nt;a++)this._excelFilter._predicates[i.sheetIndex][i.filterCollection[a].fieldName]=i.filterCollection[a].predicate,this.XLFilter._filterHandler(i.filterCollection[a])}}else if(i.operation==="remove-filter"&&(i.requestType==="filterbycell"?(this._isRowViewable(i.sheetIndex,i.activeCell.rowIndex)&&(k=this.getCell(i.activeCell.rowIndex,i.activeCell.colIndex),k.find("span.e-ssfilter").remove()),delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),n.extend(!0,c,i.selectedCell),this.XLFilter._filterActiveCell(i.sheetIndex,i.activeCell,c,i.filteredValue,i.selRange)):this.XLFilter.clearFilter("remove")),i.operation==="filter"&&i.requestType==="filterbycell"&&(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),n.extend(!0,c,i.selectedCell),this.XLFilter._filterActiveCell(i.sheetIndex,i.activeCell,c,i.filteredValue,i.selRange)),i.operation==="apply-filter"){for(h=this.getSheet(i.sheetIndex),r=0,e=i.filteredCells.length;r<e;r++)w=this.XLFilter._getFilterIcon(),this.XLFilter._applyFilterIcon({rowIndex:i.filteredCells[r].rowIndex,colIndex:i.filteredCells[r].colIndex},w);h.filterSettings.range=i.fRange;h.filterSettings.tableRange.push(i.filterRange)}},_undoForFilterByColor:function(n){var i,r=[],t;for(r.push(n),i=this._isUndo?this._undoCollection:r,delete this._excelFilter._predicates[n.sheetIndex][n.columnName],n.columnName&&this.XLFilter._clearFilterColumn(n.columnName,"","","Or",null,null,n.tableID),t=i.length-1;t>=0;t--)if((i[t].reqType==="filterbycolor"||i[t].reqType==="filter")&&i[t].tableID===n.tableID&&i[t].rowIndex===n.rowIndex&&i[t].colIndex===n.colIndex){this.XLFilter._filterHandler(i[t]);break}},_undoForFind:function(n){var i,t,r,u;switch(n.operation){case"replace":this.XLEdit._updateCellValue({rowIndex:n.rowIndex,colIndex:n.colIndex},n.prevData.value,null,n.sheetIndex);u=n.prevData;n.prevData=n.newData;n.newData=u;this.XLSelection.selectRange({rowIndex:n.rowIndex,colIndex:n.colIndex},{rowIndex:n.rowIndex,colIndex:n.colIndex});break;case"replaceAll":for(t=0,r=n.selectedCell.length;t<r;t++)this.XLEdit._updateCellValue({rowIndex:n.selectedCell[t].rowIndex,colIndex:n.selectedCell[t].colIndex},n.selectedCell[t].prevData.value,null,n.selectedCell[t].sheetIndex),u=n.selectedCell[t].prevData,n.selectedCell[t].prevData=n.selectedCell[t].newData,n.selectedCell[t].newData=u;break;case"blanks":case"conditions":case"validations":case"formulas":case"rowdiff":case"coldiff":case"comments":case"constants":for(t=0,r=n.selectedCell.length;t<r;t++)i=this.getCell(n.selectedCell[t].rowIndex,n.selectedCell[t].colIndex,n.sheetIndex),this._isUndo?i.operation==="coldiff"||i.operation==="rowdiff"?n.selectedCell[t].isApply?i.removeClass("e-selected"):i.addClass("e-selected"):n.selectedCell[t].isApply?i.addClass("e-selected"):i.removeClass("e-selected"):i.removeClass("e-selected")}this.model.allowFormulaBar&&this.updateFormulaBar()},_undoForFormat:function(i){var l=!1,r,e,o,s=this._dataContainer.sheets[i.sheetIndex],a,f,v,h="",u,c;if(t.isNullOrUndefined(i.process))for(i.oprType==="style"&&(this.XLFormat.removeStyle(i.range,{cellStyle:!0,format:!0}),h="e-format",!t.isNullOrUndefined(i.process)&&i.process.indexOf("border")>-1&&(h="e-border"),v=new RegExp("\\b"+h+".*?\\b","g")),u=0,c=i.selectedCell.length;u<c;u++)r=i.selectedCell[u],this._isRowViewable(i.sheetIndex,r.rowIndex)&&(o=this.getCell(r.rowIndex,r.colIndex)[0],l=!0),t.isNullOrUndefined(s[r.rowIndex])&&(s[r.rowIndex]={}),t.isNullOrUndefined(s[r.rowIndex][r.colIndex])&&(s[r.rowIndex][r.colIndex]={}),n.extend(!0,s[r.rowIndex][r.colIndex],i.selectedCell[u].beforeFormat),l&&(i.oprType==="format"?(a=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2"),this.XLEdit._refreshTextNode(o,t.isNullOrUndefined(a)?"":a),this.XLEdit._refreshCellAlignment({cellIdx:{rowIndex:r.rowIndex,colIndex:r.colIndex}})):(e=h==="e-format"?this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"format"):this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border"),o.className=o.className.replace(v,""),e=t.isNullOrUndefined(e)?"":e,this.addClass(o,e))),i.selectedCell[0].colIndex===i.selectedCell[u].colIndex&&this.model.allowResizing&&(this._isUndo?this.XLResize.setRowHeight(i.selectedCell[u].rowIndex,i.selectedCell[u].bRowHeight):this.XLResize.setRowHeight(i.selectedCell[u].rowIndex,i.selectedCell[u].aRowHeight)),f=i.selectedCell[u].beforeFormat,i.selectedCell[u].beforeFormat=i.selectedCell[u].afterFormat,i.selectedCell[u].afterFormat=f,l=!1;if(!t.isNullOrUndefined(i.process)&&i.process.indexOf("border")>-1&&(this.XLFormat.removeStyle(i.range,{cellStyle:!0,tableStyle:!0,format:!1,border:!0}),this._isUndo?this.XLFormat.updateFormat(i.beforeFormat,i.range):i.process==="noborder"?this.XLFormat.format({border:{}},i.range):this.XLFormat.applyBorder(n.extend(!0,{},i.options),i.range),f=i.beforeFormat,i.beforeFormat=i.afterFormat,i.afterFormat=f,i.prevHeight.length)){for(u=0,c=i.prevHeight.length;u<c;u++)this.XLResize.setRowHeight(i.prevHeight[u][0],i.prevHeight[u][1]);f=i.prevHeight;i.prevHeight=i.newHeight;i.newHeight=f}i.status="undo-cellformat";this.performSelection(i.range)},_undoForFormatPaint:function(t){var r,i,u,f;for(this.XLCFormat.clearCF(t.range),this.XLFormat.removeStyle(t.range),this.updateData(n.extend(!0,[],t.beforeData),t.range),this.XLCFormat.refreshCFormat(t.range),i=0,f=t.unwrapCells.length;i<f;i++)this.setWrapText("unwrap",this._getAlphaRange(t.sheetIndex,t.unwrapCells[i].rowIndex,t.unwrapCells[i].colIndex,t.unwrapCells[i].rowIndex,t.unwrapCells[i].colIndex));for(i=0,u=t.wrapCells.length;i<u;i++)this.setWrapText("wrap",this._getAlphaRange(t.sheetIndex,t.wrapCells[i].rowIndex,t.wrapCells[i].colIndex,t.wrapCells[i].rowIndex,t.wrapCells[i].colIndex));r=t.unwrapCells;t.unwrapCells=t.wrapCells;t.wrapCells=r;r=t.beforeData;t.beforeData=t.afterData;t.afterData=r},_undoForFormatTable:function(i){var f,g,c,l,nt,a,s,w,b,y,tt,e=0,u=i.sheetIndex,r=this.getSheet(u).tableManager,o=i.header,ut=n("#"+this._id+"_Ribbon").data("ejRibbon"),v,p,it,k,rt,d,h;switch(i.action){case"Design_Tools_ConvertToRange":if(this._isUndo)for(r[i.tableID]={name:i.name,range:i.beforeRange,format:i.format,formatName:i.formatName},this.performSelection(this._getAlphaRange(u,i.beforeRange[0],i.beforeRange[1],i.beforeRange[2],i.beforeRange[3])),this.XLFilter._filterTable(u,i.tableID),this.updateUniqueData({tableName:"e-table"+i.tableID},r[i.tableID].range),r[i.tableID].isFilter=i.isFilter,r[i.tableID].firstColumn=i.firstColumn,r[i.tableID].lastColumn=i.lastColumn,r[i.tableID].totalRow=i.totalRow,r[i.tableID].fnNumber=i.fnNumber,this.getSheet(u)._header[i.tableID]=o,tt=this._getDollarAlphaRange(r[i.tableID].range,!0),this.XLRibbon.addNamedRange(i.name,tt,null,u),this.XLFormat._updateTableFormula("addRange",r[i.tableID],u),p=this.getObjectKeys(this._tableRangesFormula[i.name]),it=p.length,this._tableFormulaCollection[i.name]=[],f=0;f<it;f++)this._tableFormulaCollection[i.name].push({text:"["+p[f]+"]",display:p[f]});else i.tableID in r&&(this.XLFormat.removeTable(i.tableID),this.XLFilter._clearFilterTable(u,i.tableID),delete r[i.tableID],delete this.model.sheets[u]._header[i.tableID]);break;case"filtericon":k=n("#"+i.id).data("ejCheckBox");rt=i.tableId;i.check?k.option("checked",!1):k.option("checked",!0);r[rt].isFilter=!i.check;i.check=!i.check;break;case"firstlastcolumn":d=n("#"+i.id).data("ejCheckBox");i.check?(this.XLFormat.format({style:{"font-weight":"normal"}},i.range),d.option("checked",!1)):(this.XLFormat.format({style:{"font-weight":"bold"}},i.range),d.option("checked",!0));r[i.tableId][i.prop]=!i.check;i.check=!i.check;break;case"totalrow":n("#"+i.id).ejCheckBox("option",{checked:!i.check});i.check=!i.check;break;case"Design_Tools_ResizeTable":if(this._isUndo){for(this._isFATResize=!0,i.afterRange=n.extend(!0,[],i.afterRange),i.totalRow&&(this._dupDetails=!0,this.XLFormat._calculateTotalRow(u,i.tableId,!1),i.beforeRange[2]-=1,r[i.tableId].range[2]-=1),a=r[i.tableId].name,this.XLFormat.removeTable(i.tableId),this.XLFormat.removeStyle(i.afterRange),c=i.beforeRange[3]-i.beforeRange[1]+1,s=o[i.tableId].header?this.getRangeData({range:i.beforeRange}):this.getRangeData({range:i.beforeRange}).splice(c,this.getRangeData({range:i.beforeRange}).length),this.clearRangeData(i.beforeRange),o[i.tableId].header?this.updateData(s,[i.beforeRange[0],i.beforeRange[1],i.beforeRange[2],i.beforeRange[3]]):this.updateData(s,[i.beforeRange[0],i.beforeRange[1],i.beforeRange[2]-1,i.beforeRange[3]]),h={header:o[i.tableId].header,tblId:i.tableId,name:a,range:i.beforeRange,format:i.format,formatName:i.formatName,firstColumn:i.firstColumn,lastColumn:i.lastColumn,isFilter:i.isFilter,totalRow:i.totalRow},this.XLClipboard._isCut=!0,o[i.tableId].header?this.XLFormat.createTable(h,i.beforeRange):this.XLFormat.createTable(h,[i.beforeRange[0],i.beforeRange[1],i.beforeRange[2]-1,i.beforeRange[3]]),i.totalRow&&(this._dupDetails=!0,this.XLFormat._calculateTotalRow(u,i.tableId,!0),i.beforeRange=r[i.tableId].range),v=this.getSheet(u).filterSettings.tableRange,e=0;e<v.length;e++)if(v[e].tableID==i.tableId){v[e].endRow=v[e].selectedRange.endRow=i.beforeRange[2];break}this.XLClipboard._isCut=!1;this._isFATResize=!1}else this._isFATResize=!0,i.beforeRange=n.extend(!0,[],i.beforeRange),i.totalRow&&(this.XLFormat._calculateTotalRow(u,i.tableId,!1),i.afterRange=r[i.tableId].range=[i.afterRange[0],i.afterRange[1],i.afterRange[2]-1,i.afterRange[3]]),a=r[i.tableId].name,this.XLFormat.removeTable(i.tableId),this.XLFormat.removeStyle(i.beforeRange),c=i.beforeRange[3]-i.beforeRange[1]+1,s=o[i.tableId].header?this.getRangeData({range:i.afterRange}):this.getRangeData({range:i.afterRange}).splice(c,this.getRangeData({range:i.afterRange}).length),this.clearRangeData(i.afterRange),o[i.tableId].header?this.updateData(s,i.afterRange):this.updateData(s,[i.afterRange[0],i.afterRange[1],i.afterRange[2]-1,i.afterRange[3]]),h={header:o[i.tableId].header,tblId:i.tableId,name:a,range:i.beforeRange,format:i.format,formatName:i.formatName,firstColumn:i.firstColumn,lastColumn:i.lastColumn,isFilter:i.isFilter,totalRow:i.totalRow},this.XLClipboard._isCut=!0,o[i.tableId].header?this.XLFormat.createTable(h,i.afterRange):this.XLFormat.createTable(h,[i.afterRange[0],i.afterRange[1],i.afterRange[2]-1,i.afterRange[3]]),this.XLFilter._extendFilterRange(i.tableId,i.afterRange),i.totalRow&&(this.XLFormat._calculateTotalRow(u,i.tableId,!0),i.afterRange=r[i.tableId].range),this.XLClipboard._isCut=!1,this._isFATResize=!1;break;case"renaming":this.XLRibbon.removeNamedRange(r[i.tableId].name);document.getElementById(this._id+"_Ribbon_Design_Properties_TableName")&&(document.getElementById(this._id+"_Ribbon_Design_Properties_TableName").value=r[i.tableId].name=this._isUndo?i.prevName:i.newName);this.XLRibbon.addNamedRange(r[i.tableId].name,i.range,null,u);ut.showTab(this._getLocStr("Design"));break;default:if(this._isUndo){if(a=r[i.tableID].name,this.XLFormat.removeTable(i.tableID),this.XLFormat.removeStyle(i.afterRange),i.tableStyle.header)for(f=0,g=i.beforeRangeHeader.length;f<g;f++)t.isNullOrUndefined(i.beforeRangeHeader[f].value2)?this.XLEdit._updateCellValue(this._getCellIdx(i.pcells[f]),""):this.isNumber(i.pcells[f].innerHTML)&&this.XLEdit._refreshCellAlignment({cellIdx:this._getCellIdx(i.pcells[f])});else c=i.afterRange[3]-i.afterRange[1]+1,this.clearRangeData(i.afterRange),this.updateData(n.extend(!0,[],i.beforeRangeData),i.afterRange);if(this.XLFormat.updateFormat(i.beforeFormat,i.afterRange),w=i.beforeMergeRange,b=w.length,b)while(e<b)y=w[e].value,y&&(l=this.getRangeIndices(y.mRange),nt=this._getSelectedRange({rowIndex:l[0],colIndex:l[1]},{rowIndex:l[2],colIndex:l[3]}),this.mergeCenter=y.isCenterAlign,this._mergeCells(i.sheetIndex,nt,{},[])),e++}else this.XLFormat.createTable(i.tableStyle,i.beforeRange)}},_autosumFormatUpdate:function(n,t,i,r){var f={},u,e=this.getActiveSheetIndex();n.type!=="general"&&(this._dupDetails=!0,f.type=n.type,u=i?this._getAlphaRange(e,t[2]+1,t[3],t[2]+1,t[3]):this._getAlphaRange(e,t[0],t[1],t[2],t[3]),r?this.XLFormat.format({type:"general"},u+":"+u):this.XLFormat.format(f,u+":"+u),this._dupDetails=!1)},_undoForHyperlink:function(n){var t,i,r={rowIndex:n.selectedCell[n.selectedCell.length-1].rowIndex,colIndex:n.selectedCell[n.selectedCell.length-1].colIndex},u={rowIndex:n.selectedCell[0].rowIndex,colIndex:n.selectedCell[0].colIndex},f,e,o;for(this.setActiveCell(n.selectedCell[0].rowIndex,n.selectedCell[0].colIndex),this.XLSelection.selectRange(u,r),n.action==="add"?this._removeHyperlink(n.reqType,n.selectedCell):n.action==="edit"?this._setLink(n.selectedCell):this._setLink(n.selectedCell),t=0,i=n.selectedCell.length;t<i;t++)f=n.selectedCell[t].prevLink,n.selectedCell[t].prevLink=n.selectedCell[t].curLink,n.selectedCell[t].curLink=f,e=n.selectedCell[t].prevText,n.selectedCell[t].prevText=n.selectedCell[t].curText,n.selectedCell[t].curText=e,o=n.selectedCell[t].prevColor,n.selectedCell[t].prevColor=n.selectedCell[t].curColor,n.selectedCell[t].curColor=o;n.action==="add"?n.action="delete":n.action==="delete"&&(n.action="add");this.XLSelection.selectRange(u,r);this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForIns:function(t){n.extend(!0,this._delCells,t.delCells);n.extend(!0,this._deletedText,t.text);n.extend(!0,this._removeMergeColl,t.removeMerge);n.extend(!0,this._cellTypesUndo,t.prevCellTypes);n.extend(!0,this._cellTypesRedo,t.curCellTypes);n.extend(!0,this._chartUndo,t.prevChartDetails);n.extend(!0,this._chartRedo,t.curChartDetails);n.extend(!0,this._valDataUndo,t.prevValData);n.extend(!0,this._valDataRedo,t.curValData);switch(t.action){case"insertShiftRight":this.insertShiftRight(t.startCell,t.endCell);break;case"insertShiftBottom":this.insertShiftBottom(t.startCell,t.endCell);break;case"insertRow":this.insertEntireRow(t.startCell.rowIndex,t.endCell.rowIndex);break;case"insertColumn":this.insertEntireColumn(t.startCell.colIndex,t.endCell.colIndex)}},_undoForMerge:function(n){var r,u,s,e,f,i,o,h;this._delCells=n.hideCells;this._selMergeCells=[];switch(n.action){case"merge-all":case"merge-across":case"un-merge":for(i=0,o=n.mCells.length;i<o;i++)e=t.isNullOrUndefined(n.mCells[i].prevObj)?{}:t.isNullOrUndefined(n.mCells[i].prevObj.merge)?{}:n.mCells[i].prevObj.merge,f=t.isNullOrUndefined(n.mCells[i].curObj)?{}:t.isNullOrUndefined(n.mCells[i].curObj.merge)?{}:n.mCells[i].curObj.merge,n.action==="un-merge"?t.isNullOrUndefined(e.mRange)||(r=this.getRangeIndices(e.mRange),u=this._getSelectedRange({rowIndex:r[0],colIndex:r[1]},{rowIndex:r[2],colIndex:r[3]}),this.mergeCenter=e.isCenterAlign,this._mergeCells(n.sheetIndex,u,{},[])):(s=this._getHiddenRowColumnCount(n.sheetIndex,f.mRange),this._unMergeAllCells(n.sheetIndex,i,n.mCells,[],s.hRow,s.hCol)),h=n.mCells[i].prevObj,n.mCells[i].prevObj=n.mCells[i].curObj,n.mCells[i].curObj=h;if(n.action!=="un-merge")for(i=0,o=n.mCells.length;i<o;i++)e=t.isNullOrUndefined(n.mCells[i].prevObj)?{}:t.isNullOrUndefined(n.mCells[i].prevObj.merge)?{}:n.mCells[i].prevObj.merge,f=t.isNullOrUndefined(n.mCells[i].curObj)?{}:t.isNullOrUndefined(n.mCells[i].curObj.merge)?{}:n.mCells[i].curObj.merge,t.isNullOrUndefined(f.mRange)||(r=this.getRangeIndices(f.mRange),u=this._getSelectedRange({rowIndex:r[0],colIndex:r[1]},{rowIndex:r[2],colIndex:r[3]}),this.mergeCenter=f.isCenterAlign,this._mergeCells(n.sheetIndex,u,{},[]));n.action=n.action==="un-merge"?"merge-all":"un-merge"}r=this._getSelectedCells(n.sheetIndex,n.range).range;u=this._getSelectedRange({rowIndex:r[0],colIndex:r[1]},{rowIndex:r[2],colIndex:r[3]});this.performSelection(u[0],u[u.length-1]);this._delCells=[]},_undoForReOrder:function(i){var f=this.getSheet(i.sheetIndex),r,u;if(this._isUndo){for(this.XLComment&&this.XLComment.deleteComment(),r=i.destinationRange[0];r<=i.destinationRange[2];r++)for(u=i.destinationRange[1];u<=i.destinationRange[3];u++)this.XLEdit.getPropertyValue(r,u,"wrap")&&this.setWrapText("unwrap",this._getAlphaRange(i.sheetIndex,r,u,r,u));this.clearRangeData(i.destinationRange,i.property);this.XLFormat.removeStyle(i.destinationRange);this.XLCFormat.clearCF(i.destinationRange);this.isUndefined(i.tblObj)||(this.XLFormat.removeTable(i.tblObj.tblId),this.XLClipboard._isCut=!0,this.XLFormat.createTable(i.tblObj,i.sourceRange),i.tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,i.tblObj.tblId,i.tblObj.fnNumber,i.sourceRange,!1),this.XLClipboard._isCut=!1);this.updateData(n.extend(!0,[],i.sourceData),i.sourceRange);this.updateData(n.extend(!0,[],i.destinationData),i.destinationRange);i.tRange&&(this._dupDetails=!0,this.XLFilter.clearFilter("remove"),this.XLFilter.filter(i.tRange),this._dupDetails=!1);this.XLFormat.updateFormat(i.sourceFormat,i.sourceRange);this.XLFormat.updateFormat(i.destinationFormat,i.destinationRange);this.isUndefined(i.sourceCFormat)||i.sourceCFormat instanceof Array||this.XLCFormat.setCFRule(i.sourceCFormat);this.setActiveCell(i.sourceRange[0],i.sourceRange[1]);this.XLSelection.selectRange({rowIndex:i.sourceRange[0],colIndex:i.sourceRange[1]},{rowIndex:i.sourceRange[2],colIndex:i.sourceRange[3]},i.sheetIndex);f._startCell={rowIndex:i.sourceRange[0],colIndex:i.sourceRange[1]};f._endCell={rowIndex:i.sourceRange[2],colIndex:i.sourceRange[3]};this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this.setHeightToRows(i.prevDestRowHt)}else{for(this.XLSelection.selectRange({rowIndex:i.sourceRange[0],colIndex:i.sourceRange[1]},{rowIndex:i.sourceRange[2],colIndex:i.sourceRange[3]},i.sheetIndex),this.XLComment&&this.XLComment.deleteComment(),r=i.sourceRange[0];r<=i.sourceRange[2];r++)for(u=i.sourceRange[1];u<=i.sourceRange[3];u++)this.XLEdit.getPropertyValue(r,u,"wrap")&&this.setWrapText("unwrap",this._getAlphaRange(i.sheetIndex,r,u,r,u));this.clearRangeData(i.sourceRange,i.property);this.clearRangeData(i.destinationRange,i.property);t.isNullOrUndefined(this.XLEdit.getPropertyValue(i.destinationRange[0],i.destinationRange[1],"tableName"))&&this.XLFormat.removeStyle(i.destinationRange);this.isUndefined(i.tblObj)||(this.XLFormat.removeTable(i.tblObj.tblId),this.XLClipboard._isCut=!0,this.XLFormat.createTable(i.tblObj,i.destinationRange),this.XLClipboard._isCut=!1);t.isNullOrUndefined(this.XLEdit.getPropertyValue(i.sourceRange[0],i.sourceRange[1],"tableName"))&&this.XLFormat.removeStyle(i.sourceRange);this.XLCFormat.clearCF(i.sourceRange);this.updateData(n.extend(!0,[],i.sourceData),i.destinationRange);i.tRange&&(this._dupDetails=!0,this.XLFilter.clearFilter("remove"),this.XLFilter.filter(i.destinationRange),this._dupDetails=!1);this.XLFormat.updateFormat(i.sourceFormat,i.destinationRange);i.tblObj&&i.tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,i.tblObj.tblId,i.tblObj.fnNumber,i.destinationRange,!1);this.isUndefined(i.destinationCFormat)||i.destinationCFormat instanceof Array||this.XLCFormat.setCFRule(i.destinationCFormat);this.setHeightToRows(i.destHeight);this.setActiveCell(i.destinationRange[0],i.destinationRange[1]);this.XLSelection.selectRange({rowIndex:i.destinationRange[0],colIndex:i.destinationRange[1]},{rowIndex:i.destinationRange[2],colIndex:i.destinationRange[3]},i.sheetIndex);f._startCell={rowIndex:i.destinationRange[0],colIndex:i.destinationRange[1]};f._endCell={rowIndex:i.destinationRange[2],colIndex:i.destinationRange[3]};this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()}},_undoForPivot:function(n){var t=this._isUndo?this._undoCollection:this._redoCollection,i={curOperation:n,prevOperation:t[t.length-1],isUndo:this._isUndo};this._trigger("_readUndoRedo",i)},_undoForResizeCol:function(n){this.XLResize._resizeColumnUsingDiff(n.oldWidth,n.newWidth,n.cols);var t=n.oldWidth;n.oldWidth=n.newWidth;n.newWidth=t;this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForResizeRow:function(n){this.XLResize._resizeRowUsingDiff(n.oldHeight,n.newHeight,n.rows);var t=n.oldHeight;n.oldHeight=n.newHeight;n.newHeight=t;this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForResizeFHeight:function(n){var t=this._isUndo,i=n.newHeight;n.newHeight=n.oldHeight;n.oldHeight=i;this.XLResize.setRowHeight(n.rowIndex,n.newHeight);this._isUndo?this.XLEdit._clearDataContainer({sheetIdx:n.sheetIndex,cellIdx:{rowIndex:n.rowIndex,colIndex:0},property:["isFitHeight"]}):this.XLEdit._updateDataContainer({rowIndex:n.rowIndex,colIndex:0},{dataObj:{isFitHeight:!0}});this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this._isUndo=t},_undoForResizeFWidth:function(n){var t=this.getCell(0,n.colIndex).get(0),i=this._isUndo,r=n.newWidth;n.newWidth=t.offsetWidth===n.oldWidth?n.newWidth:n.oldWidth;n.oldWidth=r;this.XLResize._applyWidth(n.target,n.sheetIndex,n.colIndex,n.newWidth);this.XLScroll._getColWidths(n.sheetIndex,n.colIndex);this._isUndo?this.XLEdit._clearDataContainer({sheetIdx:n.sheetIndex,cellIdx:{rowIndex:0,colIndex:n.colIndex},property:["isFitWidth"]}):this.XLEdit._updateDataContainer({rowIndex:0,colIndex:n.colIndex},{dataObj:{isFitWidth:!0}});this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this._isUndo=i},_undoForShape:function(i){var u,r,v,w,g=0,b,ft=this.getSheet(i.sheetIndex).shapeMngr,y,p,it,c,rt,d,a,ut;this.model.showRibbon&&(b=this.XLRibbon._chartThemes);i.action!="chartType"&&i.action!=="create"&&i.action!=="remove"&&i.action!=="edit"&&i.action!=="border"&&i.action!=="resetpicture"&&i.action!=="changepicture"&&i.action!=="picturesize"&&i.action!=="chartTheme"&&i.action!=="chartType"&&i.action!=="selectData"&&(u=n("#"+i.cid).data("ejChart"),r=this.getSheet(i.sheetIndex).shapeMngr.chart[this.XLEdit.getPropertyValue(i.rowIndex,i.colIndex,"chart")[0]]);switch(i.action){case"create":this.XLShape._picCellIdx=this.XLShape._getCellIndexFromOffset(i.position.top,i.position.left);this.XLShape._deleteShape(i.sheetIndex,n("#"+i.id));i.action="remove";break;case"remove":i.shapeType==="picture"?(this.XLShape._createPicture(i.sheetIndex,i.actCell,i.img,i.position.top,i.position.left,i.position.width,i.position.height,i.cnt,i.bcolor,i.bstyle,i.bwidth),this.XLRibbon._formatTabUpdate(),n(i.actCell).addClass("e-activecell")):(i.options.isChartSeries||(this.XLSelection.selectRange({rowIndex:i.range[0],colIndex:i.range[1]},{rowIndex:i.range[0],colIndex:i.range[1]},i.sheetIndex),this.setActiveCell(i.range[0],i.range[1],i.sheetIndex)),this.XLChart.createChart(i.options.isChartSeries?null:this._getAlphaRange(i.sheetIndex,i.range[0],i.range[1],i.range[2],i.range[3]),i.options,i.id));i.action="create";break;case"edit":var s,e,l,nt,h=this._dataContainer.sheets[i.sheetIndex],o=i.id.split("_")[1].replace(/[0-9]/g,""),k={},tt,f;n("#"+i.id).css({left:i.prev.left,top:i.prev.top,height:i.prev.height,width:i.prev.width});o==="chart"&&this.XLChart.resizeChart(i.id,i.prev.height,i.prev.width);i.visualImg.hide();this.XLShape._picCellIdx=this.XLShape._getCellIndexFromOffset(i.prev.top,i.prev.left);f=this.XLShape._getCellIndexFromOffset(i.cur.top,i.cur.left);nt=this._getShapePositionInManager(f.rowIndex,f.colIndex,i.id,o);k[o]=i.obj[o][nt];i.actionType!="resize"&&(this.getObjectLength(h[f.rowIndex][f.colIndex])<2&&h[f.rowIndex][f.colIndex][o].length<2?delete h[f.rowIndex][f.colIndex]:h[f.rowIndex][f.colIndex][o].length<2?delete h[f.rowIndex][f.colIndex][o]:(h[f.rowIndex][f.colIndex][o].some(function(n,t){if(k.id===n.id)return tt=t,!0}),h[f.rowIndex][f.colIndex][o].splice(tt,1)));this.XLEdit._updateDataContainer({rowIndex:this.XLShape._picCellIdx.rowIndex,colIndex:this.XLShape._picCellIdx.colIndex},{dataObj:k});this.getCell(this.XLShape._picCellIdx.rowIndex,this.XLShape._picCellIdx.colIndex,i.sheetIndex).addClass("e-activecell");this.model.showRibbon&&this.element.find(".e-ss-activeimg").length<1&&(o==="picture"?this.XLRibbon._toggleFormatTab():this.XLRibbon._toggleChartDesignTab());this.XLRibbon._setShapeWidthHeight({width:i.prev.width,height:i.prev.height,shapeType:o});this._swapVal(i);break;case"PHAxis":case"PVAxis":y=i.action=="PHAxis"?"primaryXAxis":"primaryYAxis";p=i.action==="PHAxis"?"xAxis":"yAxis";i.visibility=!i.visibility;u.option(y,{visible:i.visibility});r[p].visible=i.visibility;break;case"PX":case"PY":y=i.action=="PX"?"primaryXAxis":"primaryYAxis";p=i.action==="PX"?"xAxis":"yAxis";t.isNullOrUndefined(i.prev.text)&&(i.prev.text="");u.option(y,{title:{text:i.prev.text}});r[p].title.text=i.prev.text;this._swapVal(i);break;case"CT":u.option("title",{textAlignment:i.prev.align,text:i.prev.text});r.title={text:i.prev.text,textAlignment:i.prev.align};this._swapVal(i);break;case"DLNone":u.option({series:i.prev.series});r.dataLabel={visible:i.prev.series[0].marker.dataLabel.visible};this._swapVal(i);break;case"DL":u.option({series:i.prev.series});r.dataLabel={visible:i.prev.series[0].marker.dataLabel.visible,vAlign:i.prev.series[0].marker.dataLabel.verticalTextAlignment,tPosn:i.prev.series[0].marker.dataLabel.textPosition};this._swapVal(i);break;case"PMajorH":i.visibility=!i.visibility;u.option("primaryYAxis",{majorGridLines:{visible:i.visibility}});r.yAxis.majorGridLines={visible:i.visibility};break;case"PMajorV":i.visibility=!i.visibility;u.option("primaryXAxis",{majorGridLines:{visible:i.visibility}});r.xAxis.majorGridLines={visible:i.visibility};break;case"PMinorH":i.visibility=!i.visibility;u.option("primaryYAxis",{minorGridLines:{visible:i.visibility},minorTicksPerInterval:5,minorTickLines:{visible:i.visibility}});r.yAxis.minorGridLines={visible:i.visibility};break;case"PMinorV":i.visibility=!i.visibility;u.option("primaryXAxis",{minorGridLines:{visible:i.visibility},minorTicksPerInterval:5,minorTickLines:{visible:i.visibility}});r.xAxis.minorGridLines={visible:i.visibility};break;case"LNone":i.visibility=!i.visibility;u.option("legend",{visible:i.visibility});r.legend.visible=i.visibility;break;case"Legend":u.option("legend",{position:i.prev.position});r.legend.position=i.prev.position;this._swapVal(i);break;case"width":s={width:i.prev.width,height:i.prev.height,shapeType:"chart"};l=n("#"+u._id);u.option("size",n.extend(!0,{},s));l[0].style.height=i.prev.height+"px";l[0].style.width=i.prev.width+"px";r.width=i.prev.width;r.height=i.prev.height;this.XLRibbon._setShapeWidthHeight(s);this._swapVal(i);break;case"height":s={width:i.prev.width,height:i.prev.height,shapeType:"chart"};l=n("#"+u._id);u.option("size",n.extend(!0,{},s));l[0].style.height=i.prev.height+"px";l[0].style.width=i.prev.width+"px";r.width=i.prev.width;r.height=i.prev.Height;this.XLRibbon._setShapeWidthHeight(s);this._swapVal(i);break;case"srcolumn":u.model.series.length=0;r.isRowColSwitched=!r.isRowColSwitched;it={xRange:r.xRange,yRange:r.yRange,lRange:r.lRange,isRowColSwitched:r.isRowColSwitched,dataSheetIdx:r.dataSheetIdx};c=this.XLChart._processChartSeries(it);u.option({series:c.series});this.getActiveSheetIndex()===r.dataSheetIdx&&this.XLChart._focusChartRange(c.xRange,c.yRange,c.lRange);r.xAxis.range=c.xRange;r.yAxis.range=c.yRange;r.legend.range=c.lRange;break;case"border":e=n("#"+i.id);this._removeClass(e[0],i.curClass);this.addClass(e[0],i.prevClass);rt=i.prevClass;i.prevClass=i.curClass;i.curClass=rt;break;case"resetpicture":e=n("#"+i.id);d=new RegExp("\\be-shapebdr.*?\\b","g");this._isUndo?e[0].className.match(d)&&this.XLShape.changePictureBorder(e[0].id,i.prev.bwidth,i.prev.bstyle,i.prev.bcolor):e[0].className=e[0].className.replace(d,"");i.actionType!=="resetpicture"&&(e.css({width:i.prev.width,height:i.prev.height}),this.XLShape._selectImg(e),this.XLShape._updateShapeObj(e[0]));this._swapVal(i);break;case"changepicture":h=this._dataContainer;n("#"+i.id).css("background-image","url('"+i.prev.img+"')");ft.picture[i.prev.pcIdx].data=i.prev.data;this._swapVal(i);break;case"picturesize":e=n("#"+i.id);s={width:i.prev.width,height:i.prev.height,shapeType:"picture"};e.css(s);this.XLRibbon._setShapeWidthHeight(s);this._swapVal(i);break;case"chartTheme":for(v=this.element.find("#"+this._id+"_chart").val(),w=n("#"+this._id+"_Ribbon_ChartDesign_ChartThemes_ChartThemes").data("ejDropDownList"),i.prev.theme.indexOf("dark")>-1?n("#"+v).addClass("e-ss-charttheme"):n("#"+v).removeClass("e-ss-charttheme"),this.XLChart.refreshChart(v,{theme:i.prev.theme}),a=0,ut=b.length;ut>a;a++)if(i.prev.theme===b[a].value.toLowerCase()){g=a;break}w&&w.option({selectedItemIndex:g});this._swapVal(i);break;case"chartType":this.XLChart.refreshChart(i.chartId,{type:i.prev.chartType,enable3D:i.prev.enable3D,marker:i.prev.marker});this._swapVal(i);break;case"selectData":this.XLChart.changeDataRange(document.getElementById(this._id+"_chart").value,i.prev.xRange,i.prev.yRange,i.prev.lRange);this._swapVal(i)}},_undoForShowHide:function(n){var t,i,r,u,f,e,o;if(n.operation==="row"){for(r=this._getJSSheetRowHeaderContent(n.sheetIndex),n.action==="show"?this._hideRow(n.hideRows[0],n.hideRows[n.hideRows.length-1],"isRHide"):this._showRow(n.hideRows[0],n.hideRows[n.hideRows.length-1],"isRHide"),t=0,i=n.remBRows.length;t<i;t++)this.addClass(r.find("td")[n.remBRows[t]],"e-hrow"),this.XLEdit._updateDataContainer({rowIndex:n.remBRows[t],colIndex:0},{dataObj:{hRow:!0}});for(t=0,i=n.addBRows.length;t<i;t++)this._removeClass(r.find("td")[n.addBRows[t]],"e-hrow"),this._dataContainer.sheets[n.sheetIndex][n.addBRows[t]][0].hRow;this.setActiveCell(n.bSelect.startRow,0);n.bSelect.startRow===n.bSelect.endRow?this.XLSelection.selectRow(n.bSelect.startRow,n.sheetIndex):this.XLSelection.selectRows(n.bSelect.startRow,n.bSelect.endRow,n.sheetIndex);f=n.addBRows;n.addBRows=n.remBRows;n.remBRows=f}else{for(u=this._getJSSheetHeader(n.sheetIndex).find("th"),n.action==="show"?this._hideColumn(n.hideCols[0],n.hideCols[n.hideCols.length-1]):this._showColumn(n.hideCols[0],n.hideCols[n.hideCols.length-1]),t=0,i=n.remBCols.length;t<i;t++)this.XLEdit._updateDataContainer({rowIndex:0,colIndex:n.remBCols[t]},{dataObj:{hCol:!0}}),this.addClass(u[n.remBCols[t]],"e-hcol");for(t=0,i=n.addBCols.length;t<i;t++)this._removeClass(u[n.addBCols[t]],"e-hcol"),this._dataContainer.sheets[n.sheetIndex][0][n.addBCols[t]].hCol;this.setActiveCell(0,n.bSelect.startCol);n.bSelect.startCol===n.bSelect.endCol?this.XLSelection.selectColumn(n.bSelect.startCol,n.sheetIndex):this.XLSelection.selectColumns(n.bSelect.startCol,n.bSelect.endCol,n.sheetIndex);e=n.addBCols;n.addBCols=n.remBCols;n.remBCols=e}n.action=n.action==="show"?"hide":"show";o=n.bSelect;n.bSelect=n.aSelect;n.aSelect=o;this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForSort:function(n){var u,i,r,f=this.getSheet(n.sheetIndex)._filterColl,t;if(n.operation==="unsort"?(this._dupDetails=!0,this.XLComment.deleteComment(n.range,null,!0,null),this._removeHyperlink(null,null,!0,n.range),this.clearRangeData(n.range,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0),this.XLFormat.removeStyle(n.range,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0}),this.XLEdit.updateCellWithContainer(n.rangeData,n.range,n.sheetIndex,!0),this.XLSort._refreshRowHeight(n.range,n.rangeData),this._dupDetails=!1,n.operation="sort"):(this.XLSort._isSortByFilter=n.isSortByFilter,this.XLSort.sortByRange(n.range,n.columnName,n.direction),n.operation="unsort"),n.isSortByFilter)for(t=0;t<n.filterIcons.length;t++)r=f[n.filterIcons[t].rowIdx][n.filterIcons[t].colIdx],r.status=r.status.indexOf("-asc")>1?r.status.replace("-asc",n.filterIcons[t].prevIcon):r.status.indexOf("-dsc")>1?r.status.replace("-dsc",n.filterIcons[t].prevIcon):r.status+n.filterIcons[t].prevIcon,this._isRowViewable(n.sheetIndex,n.filterIcons[t].rowIdx)&&(i=this.getCell(n.filterIcons[t].rowIdx,n.filterIcons[t].colIdx).find(".e-filterspan")[0],i.className=i.className.indexOf("-asc")>1?i.className.replace("-asc",n.filterIcons[t].prevIcon):i.className.indexOf("-dsc")>1?i.className.replace("-dsc",n.filterIcons[t].prevIcon):i.className.indexOf("e-ssfiltered")>-1?i.className.replace("e-ssfiltered","e-ssfiltered"+n.filterIcons[t].prevIcon):i.className.replace("e-ssfilter","e-ssfilter"+n.filterIcons[t].prevIcon)),u=n.filterIcons[t].prevIcon,n.filterIcons[t].prevIcon=n.filterIcons[t].currIcon,n.filterIcons[t].currIcon=u},_undoForSortByColor:function(n){var t=n.range,r=n.prev.data,u=this._generateColCount(n.columnName)-1,i;this.XLComment.deleteComment(t,null,!0,null);this._isSort=!0;this._dupDetails=!0;this._removeHyperlink(null,null,!0,t);this._isSort=!1;this._dupDetails=!1;this.clearRangeData(t,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0);this.XLFormat.removeStyle(t,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0});this.XLEdit.updateCellWithContainer(r,t,n.sheetIndex,!0);n.oprType.indexOf("Put")<0&&(i=this.getCell(t[0]-1,u).find(".e-filterspan"),i.length>0&&(i[0].className=i[0].className.replace(n.cur.icon,n.prev.icon)));this._swapVal(n)},_undoForStyle:function(n){this.XLFormat.updateUniqueFormat(n.beforeFormat,n.range,n.opr);this._updateRangeStyle(n.range,n.beforeFormat);var t=this.changePosition(n.beforeFormat,n.afterFormat);this._refreshRangeTRHght(this.getActiveSheetIndex(),n.range);n.beforeFormat=t[1];n.afterFormat=t[0];this._isUndoRedo=!0;n.status="undo-cellstyles"},_undoForTextWrap:function(n){n.operation==="wrap"?(this.setWrapText("unwrap",n.range),n.operation="unwrap"):(this.setWrapText("wrap",n.range),n.operation="wrap");this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForValidation:function(n){var i,f,e=this.getRangeIndices(n.range),r,u,s,o;if(this.performSelection({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]}),n.operation==="cl-hl-data")this.XLValidate.highlightInvalidData(n.range),n.operation="hl-data";else if(n.operation==="apply-validation"){for(r=n.selectedCell,o=[],i=0,f=r.length;i<f;i++)s=this.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"rule"),u=this.changePosition(r[i].prevRule,s),n.selectedCell[i].prevRule=u[1],t.isNullOrUndefined(u[0])||this.XLEdit._updateDataContainer({rowIndex:r[i].rowIndex,colIndex:r[i].colIndex},{dataObj:{rule:u[0]}}),o.push(r[i]);t.isNullOrUndefined(u[0])&&this.clearRangeData(null,["rule"],o)}else if(n.operation==="hl-data")this.XLValidate.clearHighlightedValData(n.range),n.operation="cl-hl-data";else if(this._isUndo){for(i=0,f=n.selectedCell.length;i<f;i++)this.XLEdit._updateDataContainer({rowIndex:n.selectedCell[i].rowIndex,colIndex:n.selectedCell[i].colIndex},{dataObj:{rule:n.selectedCell[i].rules}});n.hlStatus&&this.XLValidate.highlightInvalidData(n.range)}else this.XLValidate.clearDV(n.range)},_applyCommentLink:function(i,r,u,f){var a=this._dataContainer,s,w=a.cFormatData,e,c=!1,l=this.getActiveSheetIndex(),v,y,o,h,p;if(this._isRowViewable(l,r.rowIndex)&&(e=this.getCell(r.rowIndex,r.colIndex),c=!0,n(e).removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),e.hasClass("e-cformat")&&(e[0].style.color="",e[0].style.backgroundColor="",e.removeClass("e-cformat"))),i){if(v=this.isNumber(i.value2)?a.sharedData[i.value2]:i.value2,i=n.extend(!0,{},i),this.XLEdit._updateCellValue(r,v),"cFormatRule"in i)for(y=i.cFormatRule,h=0,p=y.length;h<p;h++)o=w[h].split("_"),this.XLCFormat._cFormat(o[0],o[2],o[3],o[4],o[5],null,null,[u,f,u,f]);"hyperlink"in i&&(s=i.hyperlink,c&&(s&&!s.webAddr?e.html(t.buildTag("a.e-hyperlinks",this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",l),"")):e.html(t.buildTag("a.e-hyperlinks",this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",l),"",{href:s.webAddr,target:"_blank"}))));"comment"in i&&(c&&e.removeClass("e-commentcell"),this.XLComment.setComment([r.rowIndex,r.colIndex,r.rowIndex,r.colIndex],null,!1))}},changePosition:function(n,i){var r=[];return r.push(i),r.push(n),t.swap(r,0,1),r},_addValidationRule:function(t,i){var u=[],r,f;for(n.extend(!0,u,t),r=0,f=t.length;r<f;r++)t[r].customVal!==i.customVal&&t[r].required!==i.required&&t[r].Number!==i.number&&u.push(i);return u},_addCondFormatRule:function(t,i){var f=!1,u=[],r,e;for(n.extend(!0,u,t),r=0,e=t.length;r<e;r++)if(i=i.indexOf("true")>-1?i.replace("_true",""):i.replace("_false",""),t[r]===i){f=!0;break}return f||u.push(i),u},getCellClass:function(n){var t=this._formatRegx;return n&&n.className.indexOf("e-format")>-1?n.className.match(t)[0]:""},_renderInsertDeleteDialog:function(){var n=this._id+"_insertdeletedlg",i,e,r,u,f,o;i=t.buildTag("div#"+n,"",{display:"none"});e=t.buildTag("div#"+n+"_content.e-dlg-fields e-dlgctndiv");i.append(e);f=t.buildTag("div#"+n+"_btndiv.e-dlg-btnfields");o=t.buildTag("div");r=t.buildTag("input#"+n+"_okbtn","",{"margin-left":4});u=t.buildTag("input#"+n+"_cantn");r.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._insertDeleteOk,this),enabled:!0,cssClass:"e-ss-okbtn"});u.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._insertDeleteCancel,this),showRoundedCorner:!0,width:60});f.append(o.append(r,u));i.append(f);i.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg e-ss-insdeldlg",minWidth:150})},_refreshInsDelDialog:function(t){var u,i=n("#"+this._id+"_insertdeletedlg"),r,f;i.ejDialog({title:this._getLocStr(t)});i.ejDialog("open");this._insDelStatus=t.toLowerCase();r=n("#"+i[0].id+"_content");f=this._insDelStatus==="insert"?["ShiftRight","ShiftBottom","EntireRow","EntireColumn"]:["ShiftLeft","ShiftUp","EntireRow","EntireColumn"];r.children().empty();this._createRadioButton(i,r,f);u=this._insDelStatus==="insert"?"ShiftBottom":"ShiftLeft";n("#"+i[0].id+"_"+u).ejRadioButton({checked:!0});i.find("input[type='submit']:first").focus()},_createRadioButton:function(n,i,r){var o,h,s,e,u,f,c;for(s=t.buildTag("table"),f=0,c=r.length;f<c;f++)e=t.buildTag("tr"),u=t.buildTag("td"),h=t.buildTag("label",this._getLocStr(r[f]),{"padding-bottom":4},{"for":n[0].id+"_"+r[f]}),o=t.buildTag("input#"+n[0].id+"_"+r[f],"",{},{type:"radio",name:"inserdelete"}),u.append(o),e.append(u),u=t.buildTag("td"),u.append(h),o.ejRadioButton({size:"medium"}),e.append(u),s.append(e);i.append(s)},_getSelectedOption:function(t){for(var u,f=this._id+"_insertdeletedlg",r=0,i=0;i<4;i++)if(u=n("#"+f+"_"+t[i]).data("ejRadioButton"),u.model.checked){r=i;break}return r},_insertDeleteOk:function(){var o,f;this._isUndo=!1;this._isUndoRedo=!1;this._delCells=[];this._deletedText=[];this._removeMergeColl=[];this._deletedDimension=[];var t,i,e=this.getActiveSheetIndex(),r=this.model.sheets[e]._selectedCells[0],u=this.model.sheets[e]._selectedCells[this.model.sheets[e]._selectedCells.length-1];for(this._insDelStatus.indexOf("insert")>-1?(t=["ShiftRight","ShiftBottom","EntireRow","EntireColumn"],i=this._getSelectedOption(t),t[i].indexOf("ShiftRight")>-1?this.insertShiftRight(r,u):t[i].indexOf("ShiftBottom")>-1?this.insertShiftBottom(r,u):t[i].indexOf("EntireRow")>-1?this.insertEntireRow(r.rowIndex,u.rowIndex):this.insertEntireColumn(r.colIndex,u.colIndex)):(t=["ShiftLeft","ShiftUp","EntireRow","EntireColumn"],i=this._getSelectedOption(t),t[i].indexOf("ShiftLeft")>-1?this.deleteShiftLeft(r,u):t[i].indexOf("ShiftUp")>-1?this.deleteShiftUp(r,u):t[i].indexOf("EntireRow")>-1?this.deleteEntireRow(r.rowIndex,u.rowIndex):this.deleteEntireColumn(r.colIndex,u.colIndex)),n("#"+this._id+"_insertdeletedlg").ejDialog("close"),o=this.model.sheets[this.model.activeSheetIndex].shapeMngr.chart,f=0;f<o.length;f++)this.XLChart._refreshChart(o[f])},_insertDeleteCancel:function(){n("#"+this._id+"_insertdeletedlg").ejDialog("close")},_undoredoDetails:function(t,i,r,u,f){var e={sheetIndex:t,startCell:i,endCell:r,reqType:u,action:f,delCells:n.extend(!0,[],this._delCells),text:this._deletedText,deletedDimension:this._deletedDimension,removeMerge:this._removeMergeColl,fRow:n.extend(!0,{},this._fRow),fCol:n.extend(!0,{},this._fCol),nmref:this._nmRef,prevCellTypes:this._prevCellTypes,curCellTypes:this._curCellTypes,prevChartDetails:this._prevChartDetails,curChartDetails:this._curChartDetails,prevValData:this._prevValData,curValData:this._curValData};this.isImport||this.model.isImport||this._isExport||this._intrnlReq||(this._completeAction(e),this._trigActionComplete(e));this._removeMergeColl=[];this._delCells=[];this._nmRef=[];this._fRow.fRowCnt=0;this._fCol.fColCnt=0;this._fRow.rowAdj=!0;this._fCol.colAdj=!0},_getRangeFrmFormula:function(n){var t=n.substring(n.indexOf("(")+1,n.indexOf(")")),i=new RegExp("^\\b[a-zA-Z][0-9]*:[a-zA-Z][0-9]*\\b$","g");if(i.test(t))return t;if(t.indexOf(",")>1){if(i.test(t.split(",")[1]))return t.split(",")[1];if(i.test(t.replace(",",":")))return t.replace(",",":")}},_refreshNamedRange:function(n,i,r,u){for(var v,c,l,w,o,s,f,b,k,e,a,tt=this.getActiveSheetIndex(),y=this.model.nameManager,it=y.length,d,p,nt,g,h=0;h<it;h++){for(p=y[h].refersto.split(","),d=[],v=0,nt=p.length;v<nt;v++)b=v==0?this.XLRibbon._getAddrFromDollarAddr(p[v].replace("=","")):this.XLRibbon._getAddrFromDollarAddr(p[v].trim()),f=this._getRangeArgs(b[1]),w=r+n-1,o="",k=!1,s=y[h].name.toUpperCase(),e=u?f[0]:f[1],a=u?f[2]:f[3],g=this._getSelectedCells().range,(i=="shiftBottom"||i=="shiftUp")&&(u=g[0]==f[0]&&g[1]==f[1]?!0:!1),tt===b[0]&&r<=a&&(i=="insertRow"||i=="insertColumn"||i=="shiftRight"||i=="shiftBottom"?(c=r<=e?e+n:e,l=a+n,k=!0):(i=="deleteRow"||i=="deleteColumn"||i=="shiftLeft"||i=="shiftUp")&&(w<e?(c=e-n,l=a-n):r>e&&w<=a?(c=e,l=a-n):(this._nmRef[s]=y[h].refersto,o="#REF!")),o||(o=u?this._getDollarAlphaRange([c,f[1],l,f[3]],!0):this._getDollarAlphaRange([f[0],c,f[2],l],!0))),this._isUndo&&(i=="insertRow"||i=="insertColumn"||i=="shiftRight"||i=="shiftBottom")&&(t.isNullOrUndefined(this._nmRef[s])?e==a&&e>-1&&!k&&(c=e,l=a+n,o=u?this._getDollarAlphaRange([c,f[1],l,f[3]],!0):this._getDollarAlphaRange([f[0],c,f[2],l],!0)):(o=this._nmRef[s],delete this._nmRef[s])),s&&o&&(d.push(v==0?"="+o:o),y[h].scope.toUpperCase()!=this._getLocStr("Workbook").toUpperCase()&&(s=y[h].scope.toUpperCase()+"!"+s),this._calcEngine.removeNamedRange(s),this._calcEngine.addNamedRange(s,o.replace("=","")));y[h].refersto=d.join(",")}},_refreshFormula:function(n,t,i,r,u,f){var w=this.getActiveSheetIndex(),v,h,c=this.XLEdit.getPropertyValue(n,t,"value"),nt,y,e,b,k=this.getSheet(w),d=[],o,l,a,g,p=!1,s;if((!this._isUndo||this._formulaChanged.pop()!=="true")&&this.isFormula(c)){if(r==="delete")for(o=1;o<=i;o++)d.push(f+o);for(l=this.XLDragFill._parseFormula(c),o=0;o<l.length;o++)if(a=l[o].trim(),this._isCellReference(a)){if(s=o&&l[o-1].trim(),s&&s[s.length-1]=="!"&&(s=s.replace(/['!]/g,""),s!=k.sheetInfo.text))continue;e=this.getRangeIndices(a);v=u==="column"?r==="insert"?e[3]+i:e[3]-i:r==="insert"?e[2]+i:e[2]-i;h=u==="column"?r==="insert"?e[1]+i:e[1]-i:r==="insert"?e[0]+i:e[0]-i;u==="column"?f>e[1]&&(h=e[1]):f>e[0]&&(h=e[0]);u==="column"?f>e[3]&&(v=e[3]):f>e[2]&&(v=e[2]);h>-1?y=u==="column"?this._getAlphaRange(w,e[0],h,e[2],v):this._getAlphaRange(w,h,e[1],v,e[3]):(y="#REF!",p=!0);r==="delete"&&(g=parseInt(u==="row"?a.replace(/[A-Z]/g,""):this._generateColCount(a.replace(/[0-9]/g,""))),d.indexOf(g)>-1&&(y="#REF!",p=!0));l[o]=y}else a=="#REF!"&&(p=!0);return p&&!this._isUndo&&this._ref.push(c),c=p&&this._isUndo?this._ref.pop():"="+l.join(""),b=new ValueChangedArgs(n+1,t+1,this.XLEdit._parseSheetRef(c)),this._intrnlUpdate=!0,this._calcEngine.valueChanged(k.sheetInfo.value,b),this.XLEdit._updateDataContainer({rowIndex:n,colIndex:t},{dataObj:{value:c}}),this._intrnlUpdate=!1,this._applyFormula(w,n,t),this._isUndo||(nt===y?this._formulaChanged.push("true"):this._formulaChanged.push("false")),!0}},_applyFormula:function(n,i,r){var u=this.getSheet(n),f=u._formulaCollection[i];t.isNullOrUndefined(f)&&(u._formulaCollection[i]={});u._formulaCollection[i][r]=this._calcEngine.getFormulaInfoTable().getItem(this._calcEngine.cell)},_clearFormula:function(n,t){var r,e,u,f,i=this.getCalcEngine(),s=this.getActiveSheetIndex(),o=this.getSheet(s),h=this.XLEdit.getPropertyValue(n,t,"value");this.isFormula(h)&&(e=o._formulaCollection[n][t],f=i.getFormulaInfoTable().values(),u=f.indexOf(e),r=i.getFormulaInfoTable().keys()[u],f.splice(u,1),i.getFormulaInfoTable().remove(r),i.clearFormulaDependentCells(r),delete o._formulaCollection[n][t])},_refreshValAndCF:function(n,t,i,r,u,f,e){var o,w=this.getActiveSheetIndex(),v=this._dataContainer.sheets[w],h=this._dataContainer.cFormatData,l,a,y,s,p,c;this.isUndefined(i)||this.isUndefined(r)?delete v[n][t]:(this.isUndefined(i)||(v[n][t]={rule:i}),this.isUndefined(r)||(o=h[r[0]],o.indexOf("true")>-1?(c=o.replace("true","false"),p=h.indexOf()):(c=o.replace("false","true"),p=h.indexOf(c)),a=o.split("_")[5],s=this.getRangeIndices(a),e.indexOf("Bottom")>-1||e.indexOf("Row")>-1?s[2]=s[2]+u:s[3]=s[3]+f,y=this._getAlphaRange(w,s[0],s[1],s[2],s[3]),o=o.replace(a,y),c=c.replace(a,y),h[r[0]]=o,h[p]=c,l=o.replace("true","false"),h.indexOf(l)<0&&h.push(l),v[n][t]={cFormatRule:[h.indexOf(l)]}))},_refreshRows:function(n){var t=this._getRowHdrTBody(n).find("tr"),i=this._getContTBody(n).find("tr");this.setRows([t,i],n)},_refreshFilterColl:function(t,i,r,u,f){var k,o,h,s,e=this.getSheet(t),g=e._filterColl,a=this.getObjectKeys(g),l,y,v,p,w,b,d,c;if(u==="row")if(f==="insert")for(h=a.length-1;h>=0;h--)o=parseInt(a[h]),o>=i&&(e._filterColl[o+r]=n.extend(!0,{},e._filterColl[o]),delete e._filterColl[o]);else for(h=0;h<a.length;h++)o=parseInt(a[h]),o>=i&&(e._filterColl[o-r]=n.extend(!0,{},e._filterColl[o]),delete e._filterColl[o]);else for(b=!1,d=this.model.scrollSettings.allowVirtualScrolling,h=0;h<a.length;h++)if(o=parseInt(a[h]),l=this.getObjectKeys(e._filterColl[o]),f==="insert")for(w=!1,c=l.length-1;c>=0;c--)k=l[c]-l[c-(c===0?0:1)],b=k===1||k===0?!0:!1,s=parseInt(l[c]),(s>=i||w)&&(w=!0,y=e._filterColl[o][s],y.status.indexOf("filtered")>-1&&(v=n.inArray(this._generateHeaderText(s+1),e._filteredColumns),v>-1&&e._filteredColumns.splice(v,1),p=n.inArray(this._generateHeaderText(s+r+1),e._filteredColumns),p<0&&e._filteredColumns.push(this._generateHeaderText(s+r+1))),e._filterColl[o][s+r]=n.extend(!0,{},e._filterColl[o][s]),d||this._isUndoRedo?b?(e._filterColl[o][s].status="e-ssfilter",this.XLEdit._updateDataContainer({rowIndex:o,colIndex:s},{dataObj:{isFilterHeader:!0,filterState:"filter",isFilterVisible:!0},sheetIdx:t})):delete e._filterColl[o][s]:delete e._filterColl[o][s],b||(w=!1));else for(c=0;c<l.length;c++)s=parseInt(l[c]),s>=i&&(y=e._filterColl[o][s],y.status.indexOf("filtered")>-1&&(v=n.inArray(this._generateHeaderText(s+1),e._filteredColumns),v>-1&&e._filteredColumns.splice(v,1),p=n.inArray(this._generateHeaderText(s-r+1),e._filteredColumns),p<0&&e._filteredColumns.push(this._generateHeaderText(s-r+1))),s-r>=0&&(e._filterColl[o][s-r]=n.extend(!0,{},e._filterColl[o][s])),delete e._filterColl[o][s])},_refreshDataContainer:function(r,u){var b,ft,it,kt,dt,gt,f,s,c,p,hi,ci,li,bt=0,pi=0,wi,ti,ot,st,di,gi,nr=0,tr=0,l=this._dataContainer.sheets[r],bi,ei,ir,w,d,k,ni,ht,ct,vt,ii=this.model.scrollSettings.allowVirtualScrolling,h=this.getSheet(r),oi=h.usedRange,yt=this.getFrozenRows(),pt=this.getFrozenColumns(),lt,at,ut,o,nt,g,y=this._dataContainer.valData,rt,v,a,e,ai,vi,yi,wt,ri,tt,ui,et,fi,ki,si;for(ti=parseInt(this.getObjectKeys(l)[this.getObjectLength(l)-1]),tt=h.rowsHeightCollection,ri=h.columnsWidthCollection,f=0;f<=ti;f++)t.isNullOrUndefined(l[f])||(wi=this.getObjectKeys(l[f]),pi=parseInt(wi[wi.length-1]),pi>bt&&(bt=pi));if(ir=u.startCol<=bt?u.colCount+u.startCol:bt-1,bi=u.status.indexOf("shift")>-1?ir:bt-1,ei=u.status.indexOf("shift")>-1?u.rowCount+u.startRow:ti,b=u.startRow,ft=u.startRow+u.rowCount-1,it=u.startCol,kt=u.startCol+u.colCount-1,this._isFrozen(yt-1)&&yt>b){for(f=h._frozenRows-1;f<h._ftopRowIdx;f++)nr+=h.rowsHeightCollection[f];this._scrollContent({y:-nr})}if(this._isFrozen(pt-1)&&pt>it){for(f=h._frozenColumns-1;f<h._fleftColIdx;f++)tr+=h.columnsWidthCollection[f];this._scrollContent({x:-tr})}switch(u.status){case"insertRow":for(this._refreshNamedRange(u.rowCount,u.status,u.startRow,!0),f=ti,p=u.startRow;f>=p;f--){if(!t.isNullOrUndefined(l[f])){if(l[f+u.rowCount]=n.extend(!0,{},l[f]),!t.isNullOrUndefined(l[f+u.rowCount]))for(k=this.getObjectKeys(l[f+u.rowCount]),s=0,hi=k.length;s<hi;s++)this._clearFormula(f,k[s]),this._checkIndicesInContainer(r,f,k[s],"wrap")&&h._wrapColl[f]&&(this._wrapCollection(f+u.rowCount,k[s],h._wrapColl[f][k[s]],r),delete h._wrapColl[f][k[s]]),f>=b&&f<=ft?(dt=this._checkIndicesInContainer(r,b,k[s],"rule")?this._dataContainer.sheets[r][b][k[s]].rule:i,gt=this._checkIndicesInContainer(r,b,k[s],"cFormatRule")?this._dataContainer.sheets[r][b][k[s]].cFormatRule:i,this._refreshValAndCF(f,k[s],dt,gt,u.rowCount,0,u.status),ii||b<1||this.addClass(this.getCell(f,k[s])[0],this.XLFormat.getFormatClass(this.getCell(b-1,k[s])[0].className,!1))):delete l[f][k[s]],this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f+u.rowCount,parseInt(k[s]),u.rowCount,"row","insert",r),ut=this._refreshFormula(f+u.rowCount,parseInt(k[s]),u.rowCount,"insert","row",u.startRow,!1),ut||this.XLEdit._refreshCalcEngine(f+u.rowCount,parseInt(k[s]));this.getObjectLength(l[f])<1&&delete l[f]}tt[f+u.rowCount]=tt[f];tt[f]=this.model.rowHeight;h._rowIdxColl[f+u.rowCount]=h._rowIdxColl[f]+u.rowCount}if(this._refreshHideRowColCollection(h.hideRowsCollection,u.startRow,u.rowCount,"row","insert"),this._refreshFilterColl(r,u.startRow,u.rowCount,"row","insert"),this._isUndo&&this._delCells.length>0){for(w=this._delCells,ni=w[w.length-1].row-w[0].row,f=0,p=w.length;f<p;f++){for(l[w[f].row]=w[f].value,k=this.getObjectKeys(l[w[f].row]),s=0,hi=k.length;s<hi;s++)this._refreshFormula(w[f].row,parseInt(k[s]),ni,"insert","row","",!1),this.XLEdit._refreshCalcEngine(w[f].row,parseInt(k[s])),this._checkIndicesInContainer(r,w[f].row,k[s],"wrap")&&this._wrapCollection(w[f].row,k[s],this._delWrapColl[w[f].row][k[s]],r);tt[w[f].row]=w[f].height}this._delWrapColl={}}if(this.model.allowFreezing&&this._isFrozen(yt)&&(b<yt||this._isUndo&&this._fRow.fRowCnt>0)&&(ot=h.frozenRows+(this._fRow.fRowCnt>0?this._fRow.fRowCnt:u.rowCount),st=h.frozenColumns,this._fRow.fRowCnt=0,this._fRow.rowAdj||(ot-=1,this._fRow.rowAdj=!this._fRow.rowAdj),this._isFrozen(pt)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(ot,st)):this.XLFreeze.freezeRows(ot)),this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else for(this._prevValData=n.extend(!0,[],y),v=0,p=y.length;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),u.startRow<=e[2]&&u.startCol<=e[3]&&(u.startRow>e[0]&&(nt=u.startRow-e[0],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[0]+(nt-1),e[3]),this._highlightValidationRng(a,v,b+u.rowCount,e[1],e[2]+u.rowCount,e[3])),u.startRow<=e[0]&&this._highlightValidationRng(a,v,e[0]+u.rowCount,e[1],e[2]+u.rowCount,e[3])),this._curValData=n.extend(!0,[],y);if(this._isUndo)h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),c=0,p=h.cellTypes.length;c<p;c++)o=this.getRangeIndices(h.cellTypes[c].range),u.startRow<=o[2]&&u.startCol<=o[3]&&(u.startRow>o[0]&&(nt=u.startRow-o[0],g={range:this.getAlphaRange(o[0],o[1],o[0]+(nt-1),o[3]),settings:h.cellTypes[c].settings},h.cellTypes[h.cellTypes.length]=g,h.cellTypes[c].range=this.getAlphaRange(b+u.rowCount,o[1],o[2]+u.rowCount,o[3])),u.startRow<=o[0]&&(h.cellTypes[c].range=this.getAlphaRange(o[0]+u.rowCount,o[1],o[2]+u.rowCount,o[3]))),this._curCellTypes=n.extend(!0,[],h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}this.XLScroll._getRowHeights(r,u.startRow);break;case"insertColumn":for(ai=!1,this._refreshNamedRange(u.colCount,u.status,u.startCol,!1),f=0;f<=ei;f++)for(s=bt,p=u.startCol;s>=p;s--)ht=ct=null,f==0&&(t.isNullOrUndefined(l[0])||t.isNullOrUndefined(l[0][s])||"isCHide"in l[0][s]&&(this._deleteRule(s,r),ai=!0)),t.isNullOrUndefined(l[f])||(t.isNullOrUndefined(l[f][s])||(t.isNullOrUndefined(l[f][s+u.colCount])||(t.isNullOrUndefined(l[f][s+u.colCount].picture)||(ht=l[f][s+u.colCount].picture),t.isNullOrUndefined(l[f][s+u.colCount].chart)||(ct=l[f][s+u.colCount].chart)),l[f][s+u.colCount]=l[f][s],t.isNullOrUndefined(l[f][s].picture)&&t.isNullOrUndefined(l[f][s].chart)||(t.isNullOrUndefined(l[f][s].picture)||(ht=l[f][s].picture),t.isNullOrUndefined(l[f][s].chart)||(ct=l[f][s].chart)),t.isNullOrUndefined(l[f][s+u.colCount])||(t.isNullOrUndefined(ht)||(l[f][s+u.colCount].picture=ht),t.isNullOrUndefined(ct)||(l[f][s+u.colCount].chart=ct)),l[f][s].wrap&&h._wrapColl[f]&&(this._wrapCollection(f,s+u.colCount,h._wrapColl[f][s],r),delete h._wrapColl[f][s])),this._clearFormula(f,s),s>=it&&s<=kt?(dt=this._checkIndicesInContainer(r,f,it,"rule")?this._dataContainer.sheets[r][f][it].rule:i,gt=this._checkIndicesInContainer(r,f,it,"cFormatRule")?this._dataContainer.sheets[r][f][it].cFormatRule:i,this._refreshValAndCF(f,s,dt,gt,0,u.colCount,u.status),ii||!it<1&&this.addClass(this.getCell(f,s)[0],this.XLFormat.getFormatClass(this.getCell(f,it-1)[0].className,!1))):delete l[f][s],!t.isNullOrUndefined(l[f][s])||t.isNullOrUndefined(ht)&&t.isNullOrUndefined(ct)||(l[f][s]={}),t.isNullOrUndefined(ht)||(l[f][s].picture=ht),t.isNullOrUndefined(ct)||(l[f][s].chart=ct),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f,s+u.colCount,u.colCount,"column","insert",r),ut=this._refreshFormula(f,s+u.colCount,u.colCount,"insert","column",u.startCol,!1),ut||this.XLEdit._refreshCalcEngine(f,s+u.colCount)),f===0&&(ai&&(this._writeRule(s+u.colCount,r),ai=!1),ii&&!this._isUndoRedo&&(ri[s+u.colCount]=ri[s],ri[s]=h.columnWidth));if(this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else for(this._prevValData=n.extend(!0,[],y),v=0,p=y.length;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),e[0]==e[2]&&e[1]==e[3]?u.startCol<=e[1]&&this._highlightValidationRng(a,v,e[0],e[1]+u.colCount,e[2],e[3]+u.colCount):(e[1]==e[3]||e[0]!=e[2]&&e[1]!=e[2]||e[0]==e[2])&&(u.startCol<=e[1]&&this._highlightValidationRng(a,v,e[0],e[1]+u.colCount,e[2],e[3]+u.colCount),u.startCol>e[1]&&u.startCol<=e[3]&&this._highlightValidationRng(a,v,e[0],e[1],e[2],e[3]+u.colCount)),this._curValData=n.extend(!0,[],y);if(this._refreshHideRowColCollection(h.hideColsCollection,u.startCol,u.colCount,"column","insert"),this._refreshFilterColl(r,u.startCol,u.colCount,"column","insert"),this.model.allowFreezing&&this._isFrozen(pt)&&(it<pt||this._isUndo&&this._fCol.fColCnt>0)&&(ot=h.frozenRows,st=h.frozenColumns+(this._fCol.fColCnt>0?this._fCol.fColCnt:u.colCount),this._fCol.fColCnt=0,this._fCol.colAdj||(st-=1,this._fCol.colAdj=!this._fCol.colAdj),this._isFrozen(yt)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(ot,st)):this.XLFreeze.freezeColumns(st)),this._isUndo)h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),c=0,p=h.cellTypes.length;c<p;c++)o=this.getRangeIndices(h.cellTypes[c].range),o[0]==o[2]&&o[1]==o[3]?u.startCol<=o[1]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1]+u.colCount,o[2],o[3]+u.colCount)):(o[0]==o[2]&&u.startCol>o[1]&&(nt=u.startCol-o[1],g={range:this.getAlphaRange(o[0],o[1],o[2],o[1]+(nt-1)),settings:h.cellTypes[c].settings},h.cellTypes[h.cellTypes.length]=g,h.cellTypes[c].range=this.getAlphaRange(o[0],it+u.colCount,o[2],o[3]+u.colCount)),o[1]==o[3]&&u.startCol<=o[1]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1]+u.colCount,o[2],o[3]+u.colCount))),this._curCellTypes=n.extend(!0,[],h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}if(this._isUndo&&this._delCells.length>0)for(w=this._delCells,ni=w[w.length-1].col-w[0].col,c=0,p=w.length;c<p;c++)t.isNullOrUndefined(l[w[c].row])&&(l[w[c].row]={}),l[w[c].row][w[c].col]=w[c].value,this._refreshFormula(w[c].row,w[c].col,ni,"insert","column","",!1),this.XLEdit._refreshCalcEngine(w[c].row,w[c].col),w[c].value.wrap&&this._wrapCollection(w[c].row,w[c].col,w[c].height,r);break;case"deleteRow":for(this._refreshNamedRange(u.rowCount,u.status,u.startRow,!0),this._delCells=[],d=[],f=0;f<u.startRow;f++)for(k=this.getObjectKeys(l[f]),s=0,p=k.length;s<p;s++)ut=this._refreshFormula(f,parseInt(k[s]),u.rowCount,"delete","row",u.startRow,!1),ut||this.XLEdit._refreshCalcEngine(f,parseInt(k[s]));for(f=u.startRow;f<=ti;f++){if(f<u.startRow+u.rowCount){if(this._delCells.push({row:f,value:n.extend(!0,{},l[f]),height:tt[f]}),!t.isNullOrUndefined(l[f]))for(k=this.getObjectKeys(l[f]),s=0,p=k.length;s<p;s++)this._checkIndicesInContainer(r,f,k[s],"wrap")&&(this._delWrapColl[f]||(this._delWrapColl[f]={}),this._delWrapColl[f][k[s]]=n.extend(!0,{},h._wrapColl[f][k[s]]),delete h._wrapColl[f][k[s]]),l[f][k[s]]={};l[f]={};d.push({row:f})}if(!t.isNullOrUndefined(l[f+u.rowCount])){for(l[f]=n.extend(!0,{},l[f+u.rowCount]),k=this.getObjectKeys(l[f]),s=0,p=k.length;s<p;s++)this._checkIndicesInContainer(r,f+u.rowCount,k[s],"wrap")&&(this._wrapCollection(f,k[s],h._wrapColl[f+u.rowCount][k[s]],r),delete h._wrapColl[f+u.rowCount][k[s]]),this._clearFormula(f+u.rowCount,k[s]),l[f+u.rowCount][k[s]]={},this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f,k[s],u.rowCount,"row","delete",r),ut=this._refreshFormula(f,parseInt(k[s]),u.rowCount,"delete","row",u.startRow,!1),ut||this.XLEdit._refreshCalcEngine(f,parseInt(k[s]));l[f+u.rowCount]={};d.push({row:f+u.rowCount})}this.isUndefined(tt[f+u.rowCount])||(tt[f]=tt[f+u.rowCount],tt[f+u.rowCount]=this.model.rowHeight,h._rowIdxColl[f]=h._rowIdxColl[f+u.rowCount]-u.rowCount)}for(this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(tt.splice(tt.length-u.rowCount,u.rowCount),h._rowHeightCollection.splice(h._rowHeightCollection.length-u.rowCount,u.rowCount)),this._refreshHideRowColCollection(h.hideRowsCollection,u.startRow,u.rowCount,"row","delete"),c=0,p=d.length;c<p;c++)this.getObjectLength(l[d[c].row])===0&&(this._clearFormula(d[c].row,d[c].col),delete l[d[c].row]);if(this._refreshFilterColl(r,u.startRow,u.rowCount,"row","delete"),this.XLScroll._getRowHeights(r,u.startRow),this.model.allowFreezing&&this._isFrozen(yt)&&b<yt){if(ft>=yt)for(f=b;f<yt;f++)this._fRow.fRowCnt++;else this._fRow.fRowCnt=0;ot=h.frozenRows-(this._fRow.fRowCnt>0?this._fRow.fRowCnt:u.rowCount);di=h.frozenRows-(this._fRow.fRowCnt>0?this._fRow.fRowCnt:u.rowCount)-h._topRow.idx;st=h.frozenColumns;this._fRow.rowAdj=di>1;this._isFrozen(pt)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(this._fRow.rowAdj?ot:ot+1,st)):this.XLFreeze.freezeRows(this._fRow.rowAdj?ot:1)}if(this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else{for(this._prevValData=n.extend(!0,[],y),v=0,p=y.length;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),rt=this.getAlphaRange(e[0]-u.rowCount,e[1],e[2]-u.rowCount,e[3]),e[0]==e[2]&&e[1]==e[3]?u.startRow<e[0]?(a[6]=rt,y[v]=a.join("_"),this._isSameRowColumn&&(h.cellTypes[c-1].range=rt)):u.startRow==e[0]&&u.startCol<=e[1]&&(y[v]=[]):(e[1]==e[3]&&u.startRow>=e[0]&&this._highlightValidationRng(a,v,e[0],e[1],e[2]-u.rowCount,e[3]),e[0]==e[2]&&(u.startRow==e[0]&&(y[v]={}),u.startRow<e[0]&&(a[6]=rt,y[v]=a.join("_")))),e[0]!=e[2]&&e[1]!=e[2]&&(u.startRow<=e[0]&&this._highlightValidationRng(a,v,e[0]-u.rowCount,e[1],e[2]-u.rowCount,e[3]),u.startRow>e[0]&&u.startRow<=e[2]&&this._highlightValidationRng(a,v,e[0],e[1]-u.rowCount,e[2],e[3]));this._dataContainer.valData=y.filter(function(n){return Object.keys(n).length>0});this._curValData=n.extend(!0,[],this._dataContainer.valData)}if(this._isUndo)h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),c=0,p=this._prevCellTypes.length;c<p;c++)o=this.getRangeIndices(this._prevCellTypes[c].range),rt=this.getAlphaRange(o[0]-u.rowCount,o[1],o[2]-u.rowCount,o[3]),o[0]==o[2]&&o[1]==o[3]?u.startRow<o[0]?(h.cellTypes[c].range=rt,this._isSameRowColumn&&(h.cellTypes[c-1].range=rt)):u.startRow==o[0]&&u.startCol<=o[1]&&(h.cellTypes[c]={}):(o[1]==o[3]&&u.startRow>=o[0]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1],o[2]-u.rowCount,o[3])),o[0]==o[2]&&(u.startRow==o[0]&&(h.cellTypes[c]={}),u.startRow>o[0]&&(h.cellTypes[c].range=rt)));h.cellTypes=h.cellTypes.filter(function(n){return Object.keys(n).length>0});this._curCellTypes=n.extend(!0,[],h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}break;case"deleteColumn":for(this._delCells=[],d=[],vi=!1,yi=n.extend(!0,{},l[0]),this._refreshNamedRange(u.colCount,u.status,u.startCol,!1),f=0;f<=ei;f++){for(s=u.startCol;s<=bt;s++)ht=ct=null,f==0&&(t.isNullOrUndefined(yi)||t.isNullOrUndefined(yi[s])||"isCHide"in yi[s]&&(this._deleteRule(s,r),vi=!0)),s<u.startCol+u.colCount&&(t.isNullOrUndefined(l[f])||t.isNullOrUndefined(l[f][s])||(this._delCells.push({row:f,col:s,value:n.extend(!0,{},l[f][s],l[f][s].wrap?h._wrapColl[f][s]:tt[f])}),this._clearFormula(f,s),l[f][s]={},t.isNullOrUndefined(this._delCells[this._delCells.length-1])||(vt=this._delCells.length-1,t.isNullOrUndefined(this._delCells[vt].value.picture)||(l[f][s].picture=this._delCells[vt].value.picture),t.isNullOrUndefined(this._delCells[vt].value.chart)||(l[f][s].chart=this._delCells[vt].value.chart)),d.push({row:f,col:s}),h._wrapColl[f]&&delete h._wrapColl[f][s])),t.isNullOrUndefined(l[f])||t.isNullOrUndefined(l[f][s+u.colCount])||(l[f][s]=n.extend(!0,{},l[f][s+u.colCount]),l[f][s+u.colCount].wrap&&(this._wrapCollection(f,s,h._wrapColl[f][s+u.colCount],r),delete h._wrapColl[f][s+u.colCount]),t.isNullOrUndefined(l[f][s+u.colCount].picture)||(ht=l[f][s+u.colCount].picture),t.isNullOrUndefined(l[f][s+u.colCount].chart)||(ct=l[f][s+u.colCount].chart),this._clearFormula(f,s+u.colCount),l[f][s+u.colCount]={},t.isNullOrUndefined(ht)||(l[f][s+u.colCount].picture=ht),t.isNullOrUndefined(ct)||(l[f][s+u.colCount].chart=ct),t.isNullOrUndefined(this._delCells[this._delCells.length-1])||(vt=this._delCells.length-1,t.isNullOrUndefined(this._delCells[vt].value.picture)||(l[f][s].picture=this._delCells[vt].value.picture),t.isNullOrUndefined(this._delCells[vt].value.chart)||(l[f][s].chart=this._delCells[vt].value.chart)),d.push({row:f,col:s+u.colCount}),ut=this._refreshFormula(f,s,u.colCount,"delete","column",u.startCol,!1),ut||this.XLEdit._refreshCalcEngine(f,s),ii||this.XLComment&&(this._isRowViewable(r,f)&&this._removeClass(this.getCell(f,s),"e-commentcell"),this.XLComment._updateCmntFrmCntnr(f,s))),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f,s,u.colCount,"column","delete",r),f==0&&vi&&(this._writeRule(s-u.colCount,r),vi=!1);for(c=0,p=d.length;c<p;c++)this.getObjectLength(l[d[c].row][d[c].col])===0&&(this._clearFormula(d[c].row,d[c].col),delete l[d[c].row][d[c].col]);d=[]}if(this._refreshHideRowColCollection(h.hideColsCollection,u.startCol,u.colCount,"column","delete"),this.model.allowFreezing&&this._isFrozen(pt)&&it<pt){if(kt>=pt)for(f=it;f<pt;f++)this._fCol.fColCnt++;else this._fCol.fColCnt=0;ot=h.frozenRows;st=h.frozenColumns-(this._fCol.fColCnt>0?this._fCol.fColCnt:u.colCount);gi=h.frozenColumns-(this._fCol.fColCnt>0?this._fCol.fColCnt:u.colCount)-h._leftCol.idx;this._fCol.colAdj=gi>1;this._isFrozen(yt)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(ot,this._fCol.colAdj?st:st+1)):this.XLFreeze.freezeColumns(this._fCol.colAdj?st:1)}if(this._refreshFilterColl(r,u.startCol,u.colCount,"column","delete"),this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else{for(this._prevValData=n.extend(!0,[],y),v=0,p=y.length;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),rt=this.getAlphaRange(e[0],e[1]-u.colCount,e[2],e[3]-u.colCount),e[0]==e[2]&&e[1]==e[3]?u.startCol<e[1]?this._isSameRowColumn?(a[6]=rt,y[v-1]=a.join("_"),v==y.length-1&&(y.pop(),this._isSameRowColumn=!1)):(a[6]=rt,y[v]=a.join("_")):u.startRow<=e[0]&&u.startCol==e[1]&&(y[v]=[]):(e[1]==e[3]&&(u.startCol==e[1]?y[v]=[]:u.startCol<e[1]&&(a[6]=rt,y[v]=a.join("_"))),e[0]==e[2]&&u.startCol<=e[1]&&this._highlightValidationRng(a,v,e[0],e[1],e[2],e[3]-u.colCount),e[0]!=e[2]&&e[1]!=e[3]&&(u.startCol<e[1]?(a[6]=rt,y[v]=a.join("_")):u.startCol>=e[1]&&u.startCol<e[3]&&this._highlightValidationRng(a,v,e[0],e[1],e[2],e[3]-u.colCount)));this._dataContainer.valData=y.filter(function(n){return Object.keys(n).length>0});this._curValData=n.extend(!0,{},this._dataContainer.valData)}if(this._isUndo)h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),c=0,p=this._prevCellTypes.length;c<p;c++)o=this.getRangeIndices(this._prevCellTypes[c].range),rt=this.getAlphaRange(o[0],o[1]-u.colCount,o[2],o[3]-u.colCount),o[0]==o[2]&&o[1]==o[3]?u.startCol<o[1]?this._isSameRowColumn?(h.cellTypes[c-1].range=rt,h.cellTypes[c-1].settings=h.cellTypes[c].settings,c==h.cellTypes.length-1&&(h.cellTypes.pop(),this._isSameRowColumn=!1)):h.cellTypes[c].range=rt:u.startRow<=o[0]&&u.startCol==o[1]&&(h.cellTypes[c]={}):(o[1]==o[3]&&(u.startCol==o[1]&&(t.isNullOrUndefined(h.cellTypes[c+1])||(h.cellTypes[c]=n.extend(!0,{},h.cellTypes[c+1]),this._isSameRowColumn=!0)),u.startCol<o[1]&&(this._isSameRowColumn?(h.cellTypes[c-1].range=rt,h.cellTypes[c-1].settings=h.cellTypes[c].settings,c==h.cellTypes.length-1&&(h.cellTypes.pop(),this._isSameRowColumn=!1)):h.cellTypes[c].range=rt)),o[0]==o[2]&&u.startCol<=o[1]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1],o[2],o[3]-u.colCount)));h.cellTypes=h.cellTypes.filter(function(n){return Object.keys(n).length>0});this._curCellTypes=n.extend(!0,{},h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}break;case"shiftRight":for(this._refreshNamedRange(u.colCount,u.status,u.startCol,!1),f=u.startRow;f<ei;f++)for(s=bt,p=u.startCol;s>=p;s--)t.isNullOrUndefined(l[f])||t.isNullOrUndefined(l[f][s])||(l[f][s+u.colCount]=n.extend(!0,{},l[f][s]),l[f][s].wrap&&(this._wrapCollection(f,s+u.colCount,h._wrapColl[f][s],r),delete h._wrapColl[f][s]),this._clearFormula(f,s),s>=it&&s<=kt?(this._checkIndicesInContainer(r,f,it,"rule")&&(dt=this._dataContainer.sheets[r][f][it].rule),this._checkIndicesInContainer(r,f,it,"cFormatRule")&&(gt=this._dataContainer.sheets[r][f][it].cFormatRule),this._refreshValAndCF(f,s,dt,gt,0,u.colCount,u.status),it<1||this.addClass(this.getCell(f,s)[0],this.XLFormat.getFormatClass(this.getCell(f,it-1)[0].className,!1))):delete l[f][s],ut=this._refreshFormula(f,s+u.colCount,u.colCount,"insert","column",u.startCol,!0),ut||this.XLEdit._refreshCalcEngine(f,s+u.colCount),ut||this.XLEdit._refreshCalcEngine(f,s),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f,s+u.colCount,u.colCount,"column","insert",r));if(this._isUndo&&this._delCells.length>0)for(w=this._delCells,ni=w[w.length-1].col-w[0].col,c=0,p=w.length;c<p;c++)l[w[c].row][w[c].col]=w[c].value,this._refreshFormula(w[c].row,w[c].col,ni,"insert","column",u.startRow,!1),this.XLEdit._refreshCalcEngine(w[c].row,w[c].col),ii||this.XLComment&&this.XLComment._updateCmntFrmCntnr(w[c].row,w[c].col),w[c].value.wrap&&this._wrapCollection(w[c].row,w[c].col,w[c].height,r);if(this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else for(this._prevValData=n.extend(!0,[],y),p=y.length,v=0;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),rt=this.getAlphaRange(e[0],e[1]+u.colCount,ft,e[3]+u.colCount),e[1]==e[3]&&e[0]==e[2]?e[1]>=u.startCol&&e[0]==u.startRow&&this._highlightValidationRng(a,v,b,e[1]+u.colCount,b,e[3]+u.colCount):(e[1]==e[3]&&e[1]>=u.startCol&&(u.startRow==e[0]?e[0]==e[2]&&e[1]==e[3]?this._highlightValidationRng(a,v,b,e[1]+u.colCount,b,e[3]+u.colCount):(y[y.length]=[],this._highlightValidationRng(a,v,b,b+u.rowCount,o[1],o[2],o[3])):u.startRow<e[2]&&u.startCol<=e[1]&&(nt=u.startRow-e[0],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[0]+(nt-1),e[3]),this._highlightValidationRng(a,v,b+u.rowCount,e[1],e[2],e[3]),this._highlightValidationRng(a,y[y.length],b,e[1]+u.colCount,ft,e[3]+u.colCount))),e[0]==e[2]&&u.startCol<=e[3]&&u.startRow==e[2]&&(u.startCol>e[1]&&(nt=u.startCol-e[1],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[2],e[1]+(nt-1)),this._highlightValidationRng(a,v,e[0],it+u.colCount,e[2],e[3]+u.colCount)),u.startCol<e[1]&&this._highlightValidationRng(a,v,e[0],e[1]+u.colCount,e[2],e[3]+u.colCount))),this._curValData=n.extend(!0,[],y);if(this._isUndo)delete h.cellTypes,h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)delete h.cellTypes,h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),p=h.cellTypes.length,c=0;c<p;c++)o=this.getRangeIndices(h.cellTypes[c].range),g={range:this.getAlphaRange(o[0],o[1]+u.colCount,ft,o[3]+u.colCount),settings:h.cellTypes[c].settings},o[1]==o[3]&&o[0]==o[2]?o[1]>=u.startCol&&o[0]==u.startRow&&(h.cellTypes[c].range=this.getAlphaRange(b,o[1]+u.colCount,b,o[3]+u.colCount)):(o[1]==o[3]&&o[1]>=u.startCol&&(u.startRow==o[0]?o[0]==o[2]&&o[1]==o[3]?h.cellTypes[c].range=this.getAlphaRange(b,o[1]+u.colCount,b,o[3]+u.colCount):(h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(b+u.rowCount,o[1],o[2],o[3])):u.startRow<o[2]&&u.startCol<=o[1]&&(nt=u.startRow-o[0],g.range=this.getAlphaRange(o[0],o[1],o[0]+(nt-1),o[3]),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(b+u.rowCount,o[1],o[2],o[3]),g.range=this.getAlphaRange(b,o[1]+u.colCount,ft,o[3]+u.colCount),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=g)),o[0]==o[2]&&u.startCol<=o[3]&&u.startRow==o[2]&&(u.startCol>o[1]&&(nt=u.startCol-o[1],g.range=this.getAlphaRange(o[0],o[1],o[2],o[1]+(nt-1)),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=g,h.cellTypes[c].range=this.getAlphaRange(o[0],it+u.colCount,o[2],o[3]+u.colCount)),u.startCol<o[1]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1]+u.colCount,o[2],o[3]+u.colCount)))),this._curCellTypes=n.extend(!0,[],h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}break;case"shiftLeft":for(this._refreshNamedRange(u.colCount,u.status,u.startCol,!1),this._delCells=[],d=[],f=u.startRow;f<ei;f++){for(s=u.startCol;s<=bt;s++)s<u.startCol+u.colCount&&!t.isNullOrUndefined(l[f])&&(t.isNullOrUndefined(l[f][s])||(this._delCells.push({row:f,col:s,value:n.extend(!0,{},l[f][s]),height:l[f][s].wrap?h._wrapColl[f][s]:tt[f]}),this._clearFormula(f,s),l[f][s].wrap&&delete h._wrapColl[f][s],l[f][s]={},d.push({row:f,col:s}))),t.isNullOrUndefined(l[f])||t.isNullOrUndefined(l[f][s+u.colCount])||(l[f][s]=n.extend(!0,{},l[f][s+u.colCount]),l[f][s+u.colCount].wrap&&(this._wrapCollection(f,s,h._wrapColl[f][s+u.colCount],r),delete h._wrapColl[f][s+u.colCount]),lt=this.getCell(f+u.rowCount,s),at=this.getCell(f,s),lt&&(ci=lt[0].outerHTML,this.clearTextNode(lt)),at&&(li=at[0].outerHTML,this.clearTextNode(at,this.XLEdit.getPropertyValue(f,s,"value2"))),d.push({row:f,col:s+u.colCount}),this._clearFormula(f,s+u.colCount),l[f][s+u.colCount]={},ut=this._refreshFormula(f,s,u.colCount,"delete","column",u.startCol,!0),lt&&(lt[0].outerHTML=ci),at&&(at[0].outerHTML=li),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f,s,u.colCount,"column","delete",r)),ut||this.XLEdit._refreshCalcEngine(f,s);for(p=d.length,c=0;c<p;c++)this.getObjectLength(l[d[c].row][d[c].col])===0&&(this._clearFormula(d[c].row,d[c].col),this.XLEdit._refreshCalcEngine(d[c].row,d[c].col),delete l[d[c].row][d[c].col]);d=[]}if(this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else{for(this._prevValData=n.extend(!0,[],y),p=y.length,v=0;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),rt=this.getAlphaRange(e[0],e[1]-u.colCount,e[0],e[3]-u.colCount),e[1]==e[3]&&e[0]==e[2]?u.startRow==e[0]&&u.startCol==e[1]?y[v]=[]:u.startCol<=e[1]&&u.startRow==e[0]&&this._highlightValidationRng(a,v,b,e[1]-u.colCount,ft,e[3]-u.colCount):e[1]==e[3]&&e[1]>=u.startCol&&(u.startRow==e[0]?e[0]==e[2]&&e[1]==e[3]?this._highlightValidationRng(a,v,b,o[1]-u.colCount,ft,o[3]-u.colCount):(y[y.length]=[],this._highlightValidationRng(a,v,e[0]+u.rowCount,e[1],e[2],e[3])):u.startRow<e[2]&&u.startCol<=e[1]&&(nt=u.startRow-o[0],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[0]+(nt-1),e[3]),this._highlightValidationRng(a,v,e[0]+u.rowCount,e[1],e[2],e[3]),this._highlightValidationRng(a,y[y.length],b,e[1]-u.colCount,ft,e[3]-u.colCount)));this._dataContainer.valData=y.filter(function(n){return Object.keys(n).length>0});this._curValData=n.extend(!0,[],this._dataContainer.valData)}if(this._isUndo)delete h.cellTypes,h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)delete h.cellTypes,h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),p=this._prevCellTypes.length,c=0;c<p;c++)o=this.getRangeIndices(this._prevCellTypes[c].range),g={range:this.getAlphaRange(o[0],o[1]-u.colCount,o[0],o[3]-u.colCount),settings:h.cellTypes[c].settings},o[1]==o[3]&&o[0]==o[2]?u.startRow==o[0]&&u.startCol==o[1]?h.cellTypes[c]={}:u.startCol<=o[1]&&u.startRow==o[0]&&(h.cellTypes[c].range=this.getAlphaRange(b,o[1]-u.colCount,ft,o[3]-u.colCount)):o[1]==o[3]&&o[1]>=u.startCol&&(u.startRow==o[0]?o[0]==o[2]&&o[1]==o[3]?h.cellTypes[c].range=this.getAlphaRange(b,o[1]-u.colCount,ft,o[3]-u.colCount):(h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(o[0]+u.rowCount,o[1],o[2],o[3])):u.startRow<o[2]&&u.startCol<=o[1]&&(nt=u.startRow-o[0],g.range=this.getAlphaRange(o[0],o[1],o[0]+(nt-1),o[3]),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(o[0]+u.rowCount,o[1],o[2],o[3]),g.range=this.getAlphaRange(b,o[1]-u.colCount,ft,o[3]-u.colCount),g.settings=this.getAlphaRange(b,o[1]-u.colCount,ft,o[3]-u.colCount),h.cellTypes[h.cellTypes.length]=n.extend(!0,[],g)));h.cellTypes=h.cellTypes.filter(function(n){return Object.keys(n).length>0});this._curCellTypes=n.extend(!0,[],h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}break;case"shiftBottom":for(this._refreshNamedRange(u.rowCount,u.status,u.startRow,!0),ri=this.getSheet(r).columnsWidthCollection,tt=this.getSheet(r).rowsHeightCollection,f=ti,p=u.startRow;f>=p;f--){for(wt=this._checkIndicesInContainer(r,f,0,"wrapRow"),s=u.startCol;s<bi;s++)t.isNullOrUndefined(l[f])||t.isNullOrUndefined(l[f][s])||(t.isNullOrUndefined(l[f+u.rowCount])&&(l[f+u.rowCount]={}),wt&&(ui=h._wrapColl[f][s],tt[f+u.rowCount]=t.max([ui,tt[f+u.rowCount]]),this._checkIndicesInContainer(r,f+u.rowCount,0,"wrapRow")||this.XLEdit._updateDataContainer({rowIndex:f+u.rowCount,colIndex:0},{dataObj:{wrapRow:!0}}),this._wrapCollection(f+u.rowCount,s,ui,r)),l[f+u.rowCount][s]=n.extend(!0,{},l[f][s]),this._clearFormula(f,s),f>=b&&f<=ft?(this._checkIndicesInContainer(r,b,s,"rule")&&(dt=this._dataContainer.sheets[r][b][s].rule),this._checkIndicesInContainer(r,b,s,"cFormatRule")&&(gt=this._dataContainer.sheets[r][b][s].cFormatRule),this._refreshValAndCF(f,s,dt,gt,u.rowCount,0,u.status),ii||b<1||this.addClass(this.getCell(f,s)[0],this.XLFormat.getFormatClass(this.getCell(b-1,s)[0].className,!1))):delete l[f][s],wt&&delete h._wrapColl[f][s],ut=this._refreshFormula(f+u.rowCount,s,u.rowCount,"insert","row",u.startRow,!0),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f+u.rowCount,s,u.rowCount,"row","insert",r)),ut||this.XLEdit._refreshCalcEngine(f,s),ut||this.XLEdit._refreshCalcEngine(f+u.rowCount,s);wt&&(tt[f]=t.max(this._getObjectValues(h._wrapColl[f])),tt[f]||(tt[f]=this.model.rowHeight),this.getObjectLength(h._wrapColl[f])||delete this._dataContainer.sheets[r][f][0].wrapRow);t.isNullOrUndefined(l[f])||this.getObjectLength(l[f])===0&&delete l[f]}if(this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else for(this._prevValData=n.extend(!0,[],y),v=0,p=y.length;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),rt=this.getAlphaRange(e[0]+u.rowCount,e[1],e[2]+u.rowCount,e[3]),u.startRow<=e[2]&&u.startCol<=e[3]&&(u.startCol==e[1]&&u.startRow==e[0]?(a[6]=rt,y[v]=a.join("_")):(e[1]==e[3]&&(u.startRow>e[0]&&(nt=u.startRow-e[0],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[0]+(nt-1),e[3]),this._highlightValidationRng(a,v,b+u.rowCount,e[1],e[2]+u.rowCount,e[3])),u.startRow<e[0]&&(a[6]=rt,y[v]=a.join("_"))),e[0]==e[2]&&(u.startCol>e[1]&&(nt=u.startCol-e[1],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[2],e[1]+(nt-1)),this._highlightValidationRng(a,v,e[0],it+u.colCount,e[2],e[3]+u.colCount)),it<e[1]&&this._highlightValidationRng(a,v,e[0],e[1]+u.rowCount,e[2],e[3]+u.rowCount)))),this._curValData=n.extend(!0,{},y);if(this._isUndo)h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),p=h.cellTypes.length,c=0;c<p;c++)o=this.getRangeIndices(h.cellTypes[c].range),g={range:this.getAlphaRange(o[0]+u.rowCount,o[1],o[2]+u.rowCount,o[3]),settings:h.cellTypes[c].settings},u.startRow<=o[2]&&u.startCol==o[3]&&(u.startCol==o[1]&&u.startRow==o[0]?h.cellTypes[c].range=g.range:(o[1]==o[3]&&(u.startRow>o[0]&&(nt=u.startRow-o[0],g.range=this.getAlphaRange(o[0],o[1],o[0]+(nt-1),o[3]),h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(b+u.rowCount,o[1],o[2]+u.rowCount,o[3])),u.startRow<o[0]&&(h.cellTypes[c].range=g.range)),o[0]==o[2]&&(u.startCol>o[1]&&(nt=u.startCol-o[1],g.range=this.getAlphaRange(o[0],o[1],o[2],o[1]+(nt-1)),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(o[0],it+u.colCount,o[2],o[3]+u.colCount)),it<o[1]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1]+u.rowCount,o[2],o[3]+u.rowCount))))),this._curCellTypes=n.extend(!0,{},h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(u)}if(this._isUndo&&this._delCells.length>0)for(w=this._delCells,ni=w[w.length-1].row-w[0].row,f=0,p=w.length;f<p;f++)et=w[f].row,fi=w[f].col,t.isNullOrUndefined(l[et])&&(l[et]={}),l[et][fi]=w[f].value,this._refreshFormula(et,fi,ni,"insert","row",u.startRow,!0),this.XLEdit._refreshCalcEngine(et,fi),wt=this._checkIndicesInContainer(r,et,0,"wrapRow"),ki=w[f].value.wrap,(wt||ki)&&(ui=ki?w[f].height:this.model.rowHeight,tt[et]=t.max([ui,tt[et]]),this._checkIndicesInContainer(r,et,0,"wrapRow")||this.XLEdit._updateDataContainer({rowIndex:et,colIndex:0},{dataObj:{wrapRow:!0}}),this._wrapCollection(et,fi,ui,r)),ii||this.XLComment&&this.XLComment._updateCmntFrmCntnr(et,fi);break;case"shiftUp":for(this._refreshNamedRange(u.rowCount,u.status,u.startRow,!0),d=[],ri=this.getSheet(r).columnsWidthCollection,tt=this.getSheet(r).rowsHeightCollection,f=u.startRow;f<=ti;f++){for(si=this._checkIndicesInContainer(r,f,0,"wrapRow"),wt=this._checkIndicesInContainer(r,f+u.rowCount,0,"wrapRow"),s=u.startCol;s<bi;s++)f<u.startRow+u.rowCount&&!t.isNullOrUndefined(l[f])&&(t.isNullOrUndefined(l[f][s])||(this._delCells.push({row:f,col:s,value:n.extend(!0,{},l[f][s]),height:si?h._wrapColl[f][s]:tt[f]}),this._clearFormula(f,s),l[f][s]={},d.push({row:f,col:s}),si&&delete h._wrapColl[f][s])),t.isNullOrUndefined(l[f+u.rowCount])?tt[f+u.rowCount]=this.model.rowHeight:t.isNullOrUndefined(l[f+u.rowCount][s])||(t.isNullOrUndefined(l[f])&&(l[f]={}),l[f][s]=n.extend(!0,{},l[f+u.rowCount][s]),wt&&(this._wrapCollection(f,s,h._wrapColl[f+u.rowCount][s],r),delete h._wrapColl[f+u.rowCount][s]),lt=this.getCell(f+u.rowCount,s),at=this.getCell(f,s),lt&&(ci=lt[0].outerHTML,this.clearTextNode(lt)),at&&(li=at[0].outerHTML,this.clearTextNode(at,this.XLEdit.getPropertyValue(f,s,"value2"))),this._clearFormula(f+u.rowCount,s),l[f+u.rowCount][s]={},d.push({row:f+u.rowCount,col:s}),ut=this._refreshFormula(f,s,u.rowCount,"delete","row",u.startRow,!0),lt&&(lt[0].outerHTML=ci),at&&(at[0].outerHTML=li),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(f,s,u.colCount,"column","delete",r)),ut||this.XLEdit._refreshCalcEngine(f,s);si&&this.getObjectLength(h._wrapColl[f])<1&&delete this._dataContainer.sheets[r][f][0].wrapRow;wt&&(this.XLEdit._updateDataContainer({rowIndex:f,colIndex:0},{dataObj:{wrapRow:!0}}),tt[f+u.rowCount]=t.max(this._getObjectValues(h._wrapColl[f+u.rowCount])),tt[f+u.rowCount]||(tt[f+u.rowCount]=this.model.rowHeight),this.getObjectLength(h._wrapColl[f+u.rowCount])||delete this._dataContainer.sheets[r][f+u.rowCount][0].wrapRow);(si||wt)&&(tt[f]=t.max(this._getObjectValues(h._wrapColl[f])),tt[f]||(tt[f]=this.model.rowHeight))}for(c=0,p=d.length;c<p;c++)this.getObjectLength(l[d[c].row][d[c].col])===0&&(this._clearFormula(d[c].row,d[c].col),delete l[d[c].row][d[c].col]),this.getObjectLength(l[d[c].row])===0&&delete l[d[c].row];if(this._isUndo)this._dataContainer.valData=n.extend(!0,[],u.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=n.extend(!0,[],u.curValData);else{for(this._prevValData=n.extend(!0,[],y),v=0,p=y.length;v<p;v++)a=y[v].split("_"),e=this.getRangeIndices(a[1]==="list"?a[3]:a[6]),rt=this.getAlphaRange(b-u.rowCount,kt,b-u.rowCount,kt),u.startRow<=e[2]&&u.startCol==e[3]&&(e[1]==e[3]&&e[0]==e[2]?u.startRow==e[0]&&u.startCol==e[1]?y[v]=[]:u.startCol==e[1]&&u.startRow<=e[0]&&this._highlightValidationRng(a,v,e[0]-u.rowCount,e[1],e[2]-u.rowCount,e[3]):(e[1]==e[3]&&(e[1]==u.startCol&&(y[y.length]=[],this._highlightValidationRng(a,v,b,e[1],e[2]-u.rowCount,e[3])),u.startRow>e[0]&&(nt=u.startRow-e[0],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[0]+(nt-1),e[3]),this._highlightValidationRng(a,v,b-u.rowCount,e[1],e[2]-u.rowCount,e[3])),u.startRow<e[0]&&this._highlightValidationRng(a,v,e[0]-u.rowCount,e[1],e[2]-u.rowCount,e[3])),e[0]==e[2]&&(u.startCol>e[1]&&(nt=u.startCol-e[1],this._highlightValidationRng(a,y[y.length],e[0],e[1],e[2],e[1]+(nt-1)),this._highlightValidationRng(a,v,e[0],it-u.colCount,e[2],e[3]-u.colCount)),u.startCol<e[1]&&this._highlightValidationRng(a,v,e[0],e[1]-u.rowCount,e[2],e[3]-u.rowCount))));this._dataContainer.valData=y.filter(function(n){return Object.keys(n).length>0});this._curValData=n.extend(!0,{},this._dataContainer.valData)}if(this._isUndo)h.cellTypes=n.extend(!0,[],u.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else if(!this._isUndo&&this._isUndoRedo)h.cellTypes=n.extend(!0,[],u.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(u);else{for(this._prevCellTypes=n.extend(!0,[],h.cellTypes),p=this._prevCellTypes.length,c=0;c<p;c++)o=this.getRangeIndices(this._prevCellTypes[c].range),g={range:this.getAlphaRange(b-u.rowCount,kt,b-u.rowCount,kt),settings:h.cellTypes[c].settings},u.startRow<=o[2]&&u.startCol==o[3]&&(o[1]==o[3]&&o[0]==o[2]?u.startRow==o[0]&&u.startCol==o[1]?h.cellTypes[c]={}:u.startCol==o[1]&&u.startRow<=o[0]&&(h.cellTypes[c].range=this.getAlphaRange(o[0]-u.rowCount,o[1],o[2]-u.rowCount,o[3])):(o[1]==o[3]&&(o[1]==u.startCol&&(h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(b,o[1],o[2]-u.rowCount,o[3])),u.startRow>o[0]&&(nt=u.startRow-o[0],g.range=this.getAlphaRange(o[0],o[1],o[0]+(nt-1),o[3]),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(b-u.rowCount,o[1],o[2]-u.rowCount,o[3])),u.startRow<o[0]&&(h.cellTypes[c].range=this.getAlphaRange(o[0]-u.rowCount,o[1],o[2]-u.rowCount,o[3]))),o[0]==o[2]&&(u.startCol>o[1]&&(nt=u.startCol-o[1],g.range=this.getAlphaRange(o[0],o[1],o[2],o[1]+(nt-1)),g.settings=h.cellTypes[c].settings,h.cellTypes[h.cellTypes.length]=n.extend(!0,{},g),h.cellTypes[c].range=this.getAlphaRange(o[0],it-u.colCount,o[2],o[3]-u.colCount)),u.startCol<o[1]&&(h.cellTypes[c].range=this.getAlphaRange(o[0],o[1]-u.rowCount,o[2],o[3]-u.rowCount)))));h.cellTypes=h.cellTypes.filter(function(n){return Object.keys(n).length>0});this._curCellTypes=n.extend(!0,{},h.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(o,u)}}u.status.indexOf("insert")>-1&&(oi.rowIndex=oi.rowIndex+u.rowCount,oi.colIndex=oi.colIndex+u.colCount,this.getSheet(r).usedRange=oi)},refreshArrayformulaInsDel:function(i,r,u,f,e,o){var c,et,it,l,h,p,w,rt,b,ut,ot,ft,a=this.getActiveSheetIndex(),st=[],k=this._dataContainer.sheets[a],d,g,s,nt,ht,tt,v,y;if(ft=this.getSheet(a).usedRange,ot=ft.rowIndex,ut=ft.colIndex,rt=this.XLEdit.getPropertyValue(ot,ut,"value"),i.startCol<=ut&&(it=this.getRangeIndices(o),!(it[1]<i.startCol||it[0]<i.startRow))){for(p=this.XLDragFill._parseFormula(o),c=0;c<p.length;c++)this._isCellReference(p[c])&&(s=this.getRangeIndices(p[c]),l=r==="column"?u==="insert"?s[3]+f:s[3]-f:u==="insert"?s[2]+f:s[2]-f,h=r==="column"?u==="insert"?s[1]+f:s[1]-f:u==="insert"?s[0]+f:s[0]-f,r==="column"?e>s[1]&&(h=s[1]):e>s[0]&&(h=s[0]),r==="column"?e>s[3]&&(l=s[3]):e>s[2]&&(l=s[2]),b=h>-1?r==="column"?this._getAlphaRange(a,s[0],h,s[2],l):this._getAlphaRange(a,h,s[1],l,s[3]):"#REF!",p[c]=b);if(et=this.getSheet(a).formulaRange[o],u==="delete")for(c=1;c<=f;c++)st.push(e+c);for(g=this.XLDragFill._parseFormula(et),tt=0;tt<g.length;tt++)nt=g[tt].trim(),this._isCellReference(nt)&&(s=this.getRangeIndices(nt),l=r==="column"?u==="insert"?s[3]+f:s[3]-f:u==="insert"?s[2]+f:s[2]-f,h=r==="column"?u==="insert"?s[1]+f:s[1]-f:u==="insert"?s[0]+f:s[0]-f,r==="column"?e>s[1]&&(h=s[1]):e>s[0]&&(h=s[0]),r==="column"?e>s[3]&&(l=s[3]):e>s[2]&&(l=s[2]),b=h>-1?r==="column"?this._getAlphaRange(a,s[0],h,s[2],l):this._getAlphaRange(a,h,s[1],l,s[3]):"#REF!",u==="delete"&&(ht=parseInt(r==="row"?nt.replace(/[A-Z]/g,""):this._generateColCount(nt.replace(/[0-9]/g,""))),st.indexOf(ht)>-1&&(b="#REF!")),g[tt]=b);for(w=n.extend(!0,{},this.getSheet(a).formulaRange[o]),w=p.join(""),rt=g.join(""),delete this.getSheet(a).formulaRange[o],this.getSheet(a).formulaRange[w]=rt,d=this.getRangeIndices(o),v=d[0];v<=d[2];v++)for(y=d[1];y<=d[3];y++)t.isNullOrUndefined(k[v])||(t.isNullOrUndefined(k[v][y])?(k[v][y]={},k[v][y].formulaRange=w):k[v][y].formulaRange=w);this.XLEdit._formulaArrayRange=w}},_undoInsDelMerge:function(){if(this._isUndo){this._dupDetails=!0;for(var n=0,t=this._removeMergeColl.length;n<t;n++)this.mergeCenter=this._removeMergeColl[n].merge.isCenterAlign,this.mergeCells(this._removeMergeColl[n].merge.mRange,!0);this._dupDetails=!1}},_updateCommentColl:function(n){this.getSheet(n)._commentColl={};this._isInsdel=!0;this.XLComment._updateCmntArrowPos();this._isInsdel=!1},insertShiftRight:function(n,t){var r,o,f,c,h,l,i,s,u,e;if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode&&(r=this.getActiveSheetIndex(),o={startCell:n,endCell:t,sheetIndex:r,reqType:"insert",action:"insertShiftRight",type:"actionBegin"},!this._trigActionBegin(o))){for(h=!1,n=o.startCell,t=o.endCell,this._isUndo?(f="shiftLeft",this._insDelStatus="delete"):(f="shiftRight",this._insDelStatus="insert"),i={startCol:n.colIndex,colCount:t.colIndex-n.colIndex+1,startRow:n.rowIndex,rowCount:t.rowIndex-n.rowIndex+1,status:f,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},s=this.getObjectKeys(this.getSheet(r).formulaRange),l=s.length,e=0;e<l;e++)if(c=s[e],u=this.getRangeIndices(s[e]),n.rowIndex<=u[0]&&t.rowIndex>=u[2]&&n.colIndex<=u[1]&&t.colIndex<=u[3])this.refreshArrayformulaInsDel(i,"column","insert",i.colCount,i.startCol,c);else if(n.rowIndex>=u[0]&&t.rowIndex<=u[2]&&n.colIndex<=u[1]&&t.colIndex<=u[3]){this._showAlertDlg("Alert","ArrayaFormula",430);return}(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,f),this._checkTableApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,f),this._isChartApplied=this._checkChartApplied(r,n.rowIndex,n.colIndex,i.rowCount,i.colCount),this._isChartApplied)||(this._isFilterApplied||this._isTableApplied?this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630):(h=this._clearAllMergeCells(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,f),h.isAlert?this._insertShiftRight(r,n,t,i):(this._insData={sheetIdx:r,startCell:n,endCell:t,value:i},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge()),this._insDelStatus="",this.model.allowFormulaBar&&this.updateFormulaBar())}},_insertShiftRight:function(t,i,r,u){var o,l=r.colIndex-i.colIndex+1,a=this.getRows(t)[1],v=this._getJSSheetHeader(t).find("col"),y=this._getContent(t).find("col"),s,h,e,f,c;if(this._updateWrapCol("insertShiftRight",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,this.getSheet(t),t),this._isUndo){for(h=i.rowIndex;h<=r.rowIndex;h++)for(o=n(a[this._getRowIdx(h)]).find("td"),s=o.length-1,e=i.colIndex;e<=s-l;e++)o[e].outerHTML=o[e+l].outerHTML;for(f=s;f>s-l;f--)for(v.eq(f).remove(),y.eq(f).remove(),c=0;c<a.length;c++)n(a[this._getRowIdx(c)]).find("td:eq("+f+")").remove()}else this.XLScroll._createNewColumn(t,i,r,"shift");this.performSelection(i,r);this._refreshDataContainer(t,u);this._isInsdel=!0;this.model.allowCellType&&this.XLCellType._rangeCellTypes(this.getSheet(t).cellTypes,t);this._isInsdel=!1;this._isUndo?this._refreshAllMergeCells(t,-1,0,i.colIndex,u.colCount,"delete"):this._refreshAllMergeCells(t,-1,0,i.colIndex,u.colCount,"insert");this.model.allowComments&&this._updateCommentColl(t);this.model.allowComments&&(this.XLComment._curCommentHCell=null);this._isUndoRedo||this._undoredoDetails(t,i,r,"insert","insertShiftRight");this._refreshRows(t)},insertShiftBottom:function(n,t){var r,o,h,f,i,s,u,c,e,l;if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode&&(r=this.getActiveSheetIndex(),o={startCell:n,endCell:t,sheetIndex:r,reqType:"insert",action:"insertShiftBottom",type:"actionBegin"},!this._trigActionBegin(o))){for(h=!1,n=o.startCell,t=o.endCell,f=this._isUndo?"shiftUp":"shiftBottom",i={startCol:n.colIndex,colCount:t.colIndex-n.colIndex+1,startRow:n.rowIndex,rowCount:t.rowIndex-n.rowIndex+1,status:f,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},s=this.getObjectKeys(this.getSheet(r).formulaRange),e=0,l=s.length;e<l;e++)if(c=s[e],u=this.getRangeIndices(s[e]),n.colIndex<=u[1]&&t.colIndex<=u[3]&&n.rowIndex<=u[0]&&t.rowIndex<=u[2])this.refreshArrayformulaInsDel(i,"row","insert",i.rowCount,i.startRow,c);else if(n.colIndex>=u[1]&&t.colIndex>=u[3]&&n.rowIndex<=u[0]&&t.rowIndex<=u[2]){this._showAlertDlg("Alert","ArrayaFormula",430);return}if(this._isChartApplied=this._checkChartApplied(r,n.rowIndex,n.colIndex,i.rowCount,i.colCount),!this._isChartApplied){if(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,f),this._checkTableApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,f),this._isFilterApplied||this._isTableApplied)if(this._isTotalRow)if(this._isUndoRedo)this._isUndoRedo=this._dupDetails=!0,this._isUndo||this.insertEntireRow(this._insRows.startRow,this._insRows.endRow),this._isUndoRedo=!1;else return this._showAlertDlg("","TotalRowAlert","TotalRow",630),!0;else this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630);else h=this._clearAllMergeCells(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,f),h.isAlert?this._insertShiftBottom(r,n,t,i):(this._insData={sheetIdx:r,startCell:n,endCell:t,value:i},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge();this._insDelStatus=""}}},_aSortBehavior:function(n,t){return n>t?1:t>n?-1:0},_dSortBehavior:function(n,t){return n<t?1:t<n?-1:0},_insertShiftBottom:function(t,i,r,u){var b=this.model.scrollSettings.allowVirtualScrolling,f,e,c,a,p;if(this._updateWrapCol("insertShiftBottom",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,this.getSheet(t),t),this._refreshDataContainer(t,u),this._isInsdel=!0,b)this._refreshViewport(this.getSheet(t)._scrollTop,t);else{var h,s,l,v=this.getSheet(t).rowsHeightCollection,w=this.getRows(t),o=w[1],y=w[0];if(this._isUndo){for(o=this._getContent(t).find("tbody").get(0).rows,f=i.rowIndex,a=o.length;f<a;f++){if(h=f+(r.rowIndex-i.rowIndex+1),l=n(o[f]).find("td"),h<o.length)for(s=n(o[h]).find("td"),e=i.colIndex;e<=r.colIndex;e++)l[e].outerHTML=s[e].outerHTML,s[e].innerHTML="";o[f].style.height=v[f]+"px";y[f].style.height=v[f]+"px"}for(e=i.colIndex;e<=r.colIndex;e++)for(p=a-1-(r.rowIndex-i.rowIndex+1),c=a-1;c>p;c--)n(o[c]).remove(),n(y[c]).remove(),this.model.sheets[t].rowCount=this.model.sheets[t].rowCount-1;this.XLScroll._refreshScroller(1,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"all")}else{for(f=i.rowIndex;f<=r.rowIndex;f++)this.XLScroll._createNewRow(t,-1,-1,"insert");for(f=o.length-1;f>=i.rowIndex;f--){if(h=f-(r.rowIndex-i.rowIndex+1),l=n(o[f]).find("td"),h>=i.rowIndex)for(s=n(o[h]).find("td"),e=i.colIndex;e<=r.colIndex;e++)l[e].outerHTML=s[e].outerHTML,s[e].innerHTML="",l[e].className=s[e].className,s[e].className="e-rowcell e-wrapword";o[f].style.height=v[f]+"px";y[f].style.height=v[f]+"px"}}this._isInsdel=!1;this._refreshRows(t)}this.XLScroll._getRowHeights(t,i.rowIndex);this.performSelection(i,r);this.model.allowComments&&this._updateCommentColl(t);this.model.allowComments&&(this.XLComment._curCommentHCell=null);this._isUndo?this._refreshAllMergeCells(t,i.rowIndex,u.rowCount,-1,0,"delete"):this._refreshAllMergeCells(t,i.rowIndex,u.rowCount,-1,0,"insert");this._isUndoRedo||this._dupDetails||this._undoredoDetails(t,i,r,"insert","insertShiftBottom");this.model.allowFormulaBar&&this.updateFormulaBar()},insertEntireRow:function(t,i){var l,a,k,it,d,g;if(this.model.allowInsert&&!this.model.isReadOnly){var r=this.getActiveSheetIndex(),v={startRow:t,endRow:i,sheetIndex:r,reqType:"insert",action:"insertRow",type:"actionBegin"},y,h,nt,p=!1;if(!this._trigActionBegin(v)){var rt=this.model.scrollSettings.allowVirtualScrolling,f,tt,w,o,s,u,e=this.getSheet(r),ut=e._isRowSelected,b,c=e._selectedCells,ft=c[0].colIndex,et=c[c.length-1].colIndex;for(t=v.startRow,i=v.endRow,this._updateWrapCol("insertEntireRow",c,e,r),this._isUndo?(s="deleteRow",this._insDelStatus="delete"):(s="insertRow",this._insDelStatus="insert"),u={startCol:0,colCount:e.colCount,startRow:t,rowCount:i-t+1,status:s,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},b=this.getObjectKeys(this.getSheet(r).formulaRange),o=b.length,l=0;l<o;l++)if(w=b[l],tt=this.getRangeIndices(w),u.startRow<=tt[0])this.refreshArrayformulaInsDel(u,"row","insert",u.rowCount,u.startRow,w);else{this._showAlertDlg("Alert","ArrayaFormula",430);return}if(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(r,t,u.rowCount,0,e.colCount,s)){this._showAlertDlg("Alert","InsertDeleteAlert",440);return}for(this._clearAllMergeCells(r,t,u.rowCount,-1,0,s),this._isUndo&&this.XLShape&&this.XLShape._refreshChartdataInsDel(u,u.rowCount,u.startRow,r),y=this.getSheet(r).cellTypes,o=y.length,a=0;a<o;a++)if(h=this.getRangeIndices(y[a].range),nt=h[3]-h[1],nt>=1){h[2]>t&&(p=!0);break}if(p?(this._showAlertDlg("Alert","CellTypeInsertDeleteAlert",440),p=!1):this._refreshDataContainer(r,u),this._isInsdel=!0,this._isUndo?this._batchDeleteRow(t,i,r,!0):this._batchAddRow(t,i,r),rt)this.model.allowFiltering&&this.XLFilter._updateFilterCollection(r,t,i-t,"row",this._insDelStatus),e.rowCount=this._isUndo?e.rowCount-u.rowCount:e.rowCount+u.rowCount,this.refreshContent(r);else{if(this._isUndo){for(k=this.getRows(r),it=k[1],d=k[0],f=i;f>=t;f--)n(it[f]).remove(),n(d[f]).remove(),e.rowCount=e.rowCount-1;for(g=d.find("td"),f=0,o=g.length;f<o;f++)n(g[f]).text(f+1)}else for(f=t;f<=i;f++)this.XLScroll._createNewRow(r,f,0,"insert");this.model.allowFiltering&&this.XLFilter._updateFilterCollection(r,t,i-t,"row",this._insDelStatus);this.XLScroll._getRowHeights(r,t);this._refreshRows(r)}this._isInsdel=!1;this._isFrozen(e.frozenRows)&&(t<e._frozenRows||i<e._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv();this._isUndo?this._refreshAllMergeCells(r,t,u.rowCount,-1,0,"delete"):this._refreshAllMergeCells(r,t,u.rowCount,-1,0,"insert");ut?this.XLSelection.selectRows(t,i):this.performSelection({rowIndex:t,colIndex:ft},{rowIndex:i,colIndex:et});this.model.allowComments&&this._updateCommentColl(r);this._isUndoRedo||this._dupDetails||this._undoredoDetails(r,{rowIndex:t,colIndex:0},{rowIndex:i,colIndex:e.colCount-1},"insert","insertRow");this.XLShape&&(this._isUndo?this.XLShape._refreshChartdataInsDel(u,u.rowCount,u.startRow,r,!0):this.XLShape._refreshChartdataInsDel(u,u.rowCount,u.startRow,r));this._insDelStatus="";this.model.allowFormulaBar&&this.updateFormulaBar();this._isAutoWHMode&&this._setElemDimension()}}},insertEntireColumn:function(n,t){var i,e,w,o,d,a,v,y,p;if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode&&(i=this.getActiveSheetIndex(),e={startCol:n,endCol:t,sheetIndex:i,reqType:"insert",action:"insertColumn",type:"actionBegin"},!this._trigActionBegin(e))){var s,g=this.model.scrollSettings.allowVirtualScrolling,f,r,u=this.getSheet(i),it=u._isColSelected,h,c,b,l=u._selectedCells,rt=l[0].rowIndex,ut=l[l.length-1].rowIndex,nt=u.columnsWidthCollection,tt,k;if(n=e.startCol,t=e.endCol,this._updateWrapCol("insertEntireColumn",l,u,i),this._isUndo?(this._insDelStatus="delete",f="deleteColumn"):(f="insertColumn",this._insDelStatus="insert"),!u._isTemplate||!(n<u._templateColCount||t<u._templateColCount)){for(r={startCol:n,colCount:t-n+1,startRow:0,rowCount:u.rowCount,status:f,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevChartDetails:this._chartUndo,curChartDetails:this._chartRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},b=this.getObjectKeys(this.getSheet(i).formulaRange),a=0,v=b.length;a<v;a++)if(k=b[a],tt=this.getRangeIndices(k),r.startCol<=tt[1])this.refreshArrayformulaInsDel(r,"column","insert",r.colCount,r.startCol,k);else{this._showAlertDlg("Alert","ArrayaFormula",430);return}if(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(i,r.startRow,u.rowCount,n,r.colCount,f)){this._showAlertDlg("Alert","InsertDeleteAlert",440);return}if(this._clearAllMergeCells(i,-1,0,n,r.colCount,f),this._isUndo&&this.XLShape&&this.XLShape._refreshChartdataInsDel(r,r.colCount,r.startCol,i,!1),f==="deleteColumn"&&g)for(s=t;s>=n;s--)nt.splice(s,1),nt.push(u.columnWidth);if(h={rowIndex:rt,colIndex:n},c={rowIndex:ut,colIndex:t},this._isInsdel=!0,g){for(y=!1,w=this.getSheet(i).cellTypes,v=w.length,p=0;p<v;p++)if(o=this.getRangeIndices(w[p].range),d=o[3]-o[1],d>=1){o[3]>n&&(y=!0);break}y?(this._showAlertDlg("Alert","CellTypeInsertDeleteAlert",440),y=!1):(this._refreshDataContainer(i,r),this.refreshContent(i))}else this.XLScroll._createNewColumn(i,h,c,"insert"),this._refreshDataContainer(i,r);this._isInsdel=!1;this._isUndo?this._refreshAllMergeCells(i,-1,0,n,r.colCount,"delete"):this._refreshAllMergeCells(i,-1,0,n,r.colCount,"insert");this.model.allowFiltering&&this.XLFilter._updateFilterCollection(i,n,t-n,"column",this._insDelStatus);this._isFrozen(u.frozenColumns)&&(n<u._frozenColumns||t<u._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv();this.model.allowComments&&this._updateCommentColl(i);this._refreshRows(i);(this._isFrozen(u.frozenRows)||this._isFrozen(u.frozenColumns))&&this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this._isAutoWHMode&&this._autoSSWidthHeight(i);this.XLShape&&(this._isUndo?this.XLShape._refreshChartdataInsDel(r,r.colCount,r.startCol,i,!0):this.XLShape._refreshChartdataInsDel(r,r.colCount,r.startCol,i,!0));it?this.XLSelection.selectColumns(n,t):this.performSelection(h,c);this._isUndoRedo||this._undoredoDetails(i,h,c,"insert","insertColumn");this._insDelStatus="";this.model.allowFormulaBar&&this.updateFormulaBar()}}},deleteShiftLeft:function(n,t){var r,f,e,u,i,s,h,o,c;if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode&&(r=this.getActiveSheetIndex(),f={startCell:n,endCell:t,sheetIndex:r,reqType:"delete",action:"deleteShiftLeft",type:"actionBegin"},!this._trigActionBegin(f))){for(e=!1,n=f.startCell,t=f.endCell,this._isUndo?(this._insDelStatus="insert",u="shiftRight"):(this._insDelStatus="delete",u="shiftLeft"),i={startCol:n.colIndex,colCount:t.colIndex-n.colIndex+1,startRow:n.rowIndex,rowCount:t.rowIndex-n.rowIndex+1,status:u,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},s=this.getObjectKeys(this.getSheet(r).formulaRange),o=0,c=s.length;o<c;o++)if(h=this.getRangeIndices(s[o]),n.colIndex<=h[1]){this._showAlertDlg("Alert","ArrayaFormula",430);return}(this._isChartApplied=this._checkChartApplied(r,n.rowIndex,n.colIndex,i.rowCount,i.colCount),this._isChartApplied)||(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,u),this._checkTableApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,u),this._isFilterApplied||this._isTableApplied?this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630):(e=this._clearAllMergeCells(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,u),e.isAlert?e.isCancel||this._deleteShiftLeft(r,n,t,i):(this._insData={sheetIdx:r,startCell:n,endCell:t,value:i},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge()),this._insDelStatus="")}},_deleteShiftLeft:function(t,i,r,u){var o,s,a,f,e,h,c=r.colIndex-i.colIndex+1,v=this.getRows(t)[1],l=[],y;if(this._updateWrapCol("deleteShiftLeft",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,this.getSheet(t),t),this._isUndo)for(n.extend(!0,l,this._deletedText),o=i.rowIndex;o<=r.rowIndex;o++){for(h=this._getRowIdx(o),f=n(v[h]).find("td"),y=f.length-1,e=y-c;e>i.colIndex-1;e--)f[e+c].outerHTML=f[e].outerHTML;for(s=i.colIndex;s<=r.colIndex;s++)f[s].outerHTML=l.shift()}else for(this._insDelStatus="delete",o=i.rowIndex;o<=r.rowIndex;o++){for(h=this._getRowIdx(o),f=n(v[h]).find("td"),s=i.colIndex;s<=r.colIndex;s++)l.push(f[s].outerHTML);for(a=f.length,e=i.colIndex;e<a-c;e++)f[e].outerHTML=f[e+c].outerHTML}this.performSelection(i,r);this._refreshDataContainer(t,u);this._isInsdel=!0;this.model.allowCellType&&this.XLCellType._rangeCellTypes(this.getSheet(t).cellTypes,t);this._isInsdel=!1;this.model.allowComments&&(this.XLComment._curCommentHCell=null);this._deletedText=l;this.model.allowComments&&this._updateCommentColl(t);this._isUndo?this._refreshAllMergeCells(t,-1,0,i.colIndex,u.colCount,"insert"):this._refreshAllMergeCells(t,-1,0,i.colIndex,u.colCount,"delete");this._isUndoRedo||this._undoredoDetails(t,i,r,"delete","deleteShiftLeft");this._refreshRows(t);this.model.allowFormulaBar&&this.updateFormulaBar()},deleteShiftUp:function(n,t){var r,f,e,u,i;if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode&&(r=this.getActiveSheetIndex(),f={startCell:n,endCell:t,sheetIndex:r,reqType:"delete",action:"deleteShiftUp",type:"actionBegin"},!this._trigActionBegin(f))){if(e=!1,n=f.startCell,t=f.endCell,u=this._isUndo?"shiftBottom":"shiftUp",i={startCol:n.colIndex,colCount:t.colIndex-n.colIndex+1,startRow:n.rowIndex,rowCount:t.rowIndex-n.rowIndex+1,status:u,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"hasFormulaArray")){this._showAlertDlg("Alert","ArrayaFormula","multipleArrayFormula",430);return}if(this._isChartApplied=this._checkChartApplied(r,n.rowIndex,n.colIndex,i.rowCount,i.colCount),!this._isChartApplied){if(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,u),this._checkTableApplied(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,u),this._isFilterApplied||this._isTableApplied){if(this._isTotalRow)return;this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630)}else e=this._clearAllMergeCells(r,n.rowIndex,i.rowCount,n.colIndex,i.colCount,u),e.isAlert?e.isCancel||this._deleteShiftUp(r,n,t,i):(this._insData={sheetIdx:r,startCell:n,endCell:t,value:i},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge();this._insDelStatus=""}}},_deleteShiftUp:function(t,i,r,u){var k=this.model.scrollSettings.allowVirtualScrolling,f,e,p,a=[],c,s,y=this.getSheet(t);if(this._refreshDataContainer(t,u),this._isInsdel=!0,this._updateWrapCol("deleteShiftUp",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,y,t),k)this._refreshViewport(y._scrollTop,t);else{var h,l,v=y.rowsHeightCollection,w=this.getRows(t),o=w[1],b=w[0];if(!this._isUndo||this._isTotalRow)for(f=i.rowIndex,p=o.length;f<p;f++){if(c=f+(r.rowIndex-i.rowIndex+1),s=this._getRowIdx(f),h=n(o[s]).find("td"),c<o.length)for(l=n(o[this._getRowIdx(c)]).find("td"),e=i.colIndex;e<=r.colIndex;e++)a.push(h[e].outerHTML),h[e].outerHTML=l[e].outerHTML,l[e].innerHTML="";o[s].style.height=v[f]+"px";b[s].style.height=v[f]+"px"}else{for(n.extend(!0,a,this._deletedText),f=o.length-1;f>=i.rowIndex;f--){if(c=f-(r.rowIndex-i.rowIndex+1),s=this._getRowIdx(f),h=n(o[s]).find("td"),c>=i.rowIndex)for(l=n(o[this._getRowIdx(c)]).find("td"),e=i.colIndex;e<=r.colIndex;e++)h[e].outerHTML=l[e].outerHTML,l[e].innerHTML="";o[s].style.height=v[f]+"px";b[s].style.height=v[f]+"px"}for(f=i.rowIndex;f<=r.rowIndex;f++)for(h=n(o[this._getRowIdx(f)]).find("td"),e=i.colIndex;e<=r.colIndex;e++)h[e].outerHTML=a.shift()}this._refreshRows(t)}this._isInsdel=!1;this.XLScroll._getRowHeights(t,i.rowIndex);this.performSelection(i,r);this.model.allowComments&&this._updateCommentColl(t);this.model.allowComments&&(this.XLComment._curCommentHCell=null);this._deletedText=a;this._isUndo?this._refreshAllMergeCells(t,i.rowIndex,u.rowCount,-1,0,"insert"):this._refreshAllMergeCells(t,i.rowIndex,u.rowCount,-1,0,"delete");this._isUndoRedo||this._dupDetails||this._undoredoDetails(t,i,r,"delete","deleteShiftUp");this.model.allowFormulaBar&&this.updateFormulaBar()},deleteEntireRow:function(t,i){var u,h,a;if(this.model.allowDelete&&!this.model.isReadOnly&&(u=this.getActiveSheetIndex(),h={startRow:t,endRow:i,sheetIndex:u,reqType:"delete",action:"deleteRow",type:"actionBegin"},!this._trigActionBegin(h))){var k,y,it=this.model.scrollSettings.allowVirtualScrolling,e,c,s,r=this.getSheet(u),l=r._selectedCells,rt=l[0].colIndex,ut=l[l.length-1].colIndex,ft=r.rowsHeightCollection,p;if(t=h.startRow,i=h.endRow,this.model.isGridMode){if(i-t+1==r.rowCount||r.showHeader&&r.rowCount<3||(r.showHeader&&r.rowCount-(i-t+1))==1){this._showAlertDlg("Alert","GridModeRecordsCount",430);return}if(r.showHeader&&(t==0||i==0)){this._showAlertDlg("Alert","GridModeDataHeader",430);return}}for(this._updateWrapCol("deleteEntireRow",l,r,u),this._isUndo?(this._insDelStatus="insert",s="insertRow"):(s="deleteRow",this._insDelStatus="delete"),f={startCol:0,colCount:r.colCount,startRow:t,rowCount:i-t+1,status:s,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},p=this.getObjectKeys(this.getSheet(u).formulaRange),c=p.length,a=0;a<c;a++){if(y=p[a],k=this.getRangeIndices(y),t==k[2]){this._showAlertDlg("Alert","ArrayaFormula",430);return}this.refreshArrayformulaInsDel(f,"row","delete",f.rowCount,f.startRow,y)}if(!this._isUndoRedo&&(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(u,t,f.rowCount,0,r.colCount,s))){this._showAlertDlg("Alert","InsertDeleteAlert",440);return}if(!this._isUndo&&this.XLShape&&this.XLShape._refreshChartdataInsDel(f,f.rowCount,f.startRow,u,!1),this._clearAllMergeCells(u,t,f.rowCount,-1,0,s),this._refreshDataContainer(u,f),this._isInsdel=!0,this._isUndo?this._batchAddRow(t,i,u,!0):this._batchDeleteRow(t,i,u),it||this.model.isGridMode)this.model.scrollSettings.scrollMode==="normal"&&(r.rowCount=this._isUndo?r.rowCount+f.rowCount:r.rowCount-f.rowCount),this.refreshContent(u);else{var w,o,d,v=[],g,f,nt=this.getRows(u),b=nt[1],tt=nt[0];if(this._isUndo){for(n.extend(!0,v,this._deletedText),e=t;e<=i;e++)o=this._getRowIdx(e),g=v.pop(),n(b[o]).before(g),d=this.XLScroll._rowHeaderTemplate(1,ft[e]),n(tt[o]).before(d),r.rowCount=r.rowCount+1;this._refreshRows(u)}else for(e=i;e>=t;e--)o=this._getRowIdx(e),v.push(b[o].outerHTML),n(b[o]).remove(),n(tt[o]).remove(),r.rowCount=r.rowCount-1,this.XLScroll._createNewRow(u,-1,-1,"insert");for(w=n(this.getRows(u)[0]).find("td"),e=0,c=w.length;e<c;e++)n(w[e]).text(e+1);this._refreshRows(u)}this._isInsdel=!1;this._isFrozen(r.frozenRows)&&(t<r._frozenRows||i<r._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv();(this.model.isGridMode&&i==r.rowCount||r.showHeader&&r.rowCount<3)&&(t=i=r.rowCount-1);r._isRowSelected?this.XLSelection.selectRows(t,i):this.performSelection({rowIndex:t,colIndex:rt},{rowIndex:i,colIndex:ut});this._deletedText=v;this.model.allowComments&&this._updateCommentColl(u);this._isUndo?this._refreshAllMergeCells(u,t,f.rowCount,-1,0,"insert"):this._refreshAllMergeCells(u,t,f.rowCount,-1,0,"delete");this.model.allowFiltering&&this.XLFilter._updateFilterCollection(u,t,i-t,"row",this._insDelStatus);this.XLScroll._getRowHeights(u,t);this._isUndoRedo||this._dupDetails||this._undoredoDetails(u,{rowIndex:t,colIndex:0},{rowIndex:i,colIndex:r.colCount-1},"delete","deleteRow");this.XLShape&&(this._isUndo?this.XLShape._refreshChartdataInsDel(f,f.rowCount,f.startRow,u):this.XLShape._refreshChartdataInsDel(f,f.rowCount,f.startRow,u,!0));this._insDelStatus="";this.model.allowFormulaBar&&this.updateFormulaBar();this.model.isGridMode&&this._setElemDimension()}},deleteEntireColumn:function(i,r){var u,w,tt,c,it;if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode&&(u=this.getActiveSheetIndex(),w={startCol:i,endCol:r,sheetIndex:u,reqType:"delete",action:"deleteColumn",type:"actionBegin"},!this._trigActionBegin(w))){var rt,ut,f,e,a,b,et=0,ot=this.getFrozenColumns(),o=this.getSheet(u),v=this.getRows(u)[1],y=this._getContent(u).find("col"),ft,k=this._getJSSheetHeader(u).find("col"),l=this._getJSSheetHeader(u).find("th"),d=o._selectedCells,lt=d[0].rowIndex,at=d[d.length-1].rowIndex,p,h=[],s,st,g,ht=this.XLScroll._colGroupTemplate(1),nt=o.columnsWidthCollection,ct=this.model.scrollSettings.allowVirtualScrolling,vt=ct?this._getContent(u).find("tbody").get(1):this._getContent(u).find("tbody").get(0);if(i=w.startCol,r=w.endCol,this._updateWrapCol("deleteEntireRow",d,o,u),this._isUndo?(p="insertColumn",this._insDelStatus="insert"):(p="deleteColumn",this._insDelStatus="delete"),!o._isTemplate||!(i<o._templateColCount||r<o._templateColCount)){for(s={startCol:i,colCount:r-i+1,startRow:0,rowCount:o.rowCount,status:p,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevChartDetails:this._chartUndo,curChartDetails:this._chartRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},ft=this.getObjectKeys(this.getSheet(u).formulaRange),a=ft.length,tt=0;tt<a;tt++){if(ut=ft[tt],rt=this.getRangeIndices(ut),i==rt[1]||i==rt[3]){this._showAlertDlg("Alert","ArrayaFormula",430);return}this.refreshArrayformulaInsDel(s,"column","delete",s.colCount,s.startCol,ut)}if(!this._isUndoRedo&&(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(u,s.startRow,s.rowCount,0,o.colCount,p))){this._showAlertDlg("Alert","InsertDeleteAlert",440);return}if(this._clearAllMergeCells(u,-1,0,i,s.colCount,p),this._isUndo){for(h=n.extend(!0,h,this._deletedText),c=0,f=v.length-1;f>=0;f--){for(b=n(v[f]).find("td"),e=i;e<=r;e++)b.eq(e-c).before(h.pop()),c++;c=0}for(e=i;e<=r;e++)y.eq(e-c).before(h.pop()),l.eq(e-c).before("<th class='e-headercell'><div class='e-headercelldiv'><\/div><\/th>"),k.eq(e-c).before(h.pop()),c++;g=nt.splice(0,i);t.merge(g,this._deletedDimension.reverse());t.merge(g,nt);o.columnsWidthCollection=g;this._deletedDimension=[];this.XLShape&&this.XLShape._refreshChartdataInsDel(s,s.colCount,s.startCol,u,!1)}else{if(this.XLShape&&this.XLShape._refreshChartdataInsDel(s,s.colCount,s.startCol,u,!1),this._deletedDimension=[],this._isFrozen(ot)&&ot>=i){for(f=o._frozenColumns-1;f<o._fleftColIdx;f++)et+=o.columnsWidthCollection[f];this._scrollContent({x:-et})}for(e=r;e>=i;e--)h.push(k[e].outerHTML),h.push(y[e].outerHTML),this._deletedDimension.push(nt.splice(e,1)[0]),k.eq(e).remove(),y.eq(e).remove(),k.parent().append(ht),y.parent().append(ht),nt.push(o.columnWidth);for(f=0,a=v.length;f<a;f++)for(b=n(v[f]).find("td"),e=r;e>=i;e--)st=this.XLScroll._columnTemplate(),n(v[f]).append(st),h.push(b[e].outerHTML),n(vt.rows[f]).find("td:eq("+e+")").remove()}for(this.XLScroll._getColWidths(u,i),this._isFrozen(o.frozenColumns)&&(i<o._frozenColumns||r<o._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv(),this.model.allowFiltering&&this.XLFilter._updateFilterCollection(u,i,r-i,"column",this._insDelStatus),o.colCount=y.length,l=this._getJSSheetHeader(u).find("th"),this._refreshDataContainer(u,s),this._isInsdel=!0,f=0,a=l.length;f<a;f++)this._checkIndicesInContainer(u,0,f,"hCol")&&(it="e-hcol"),this._checkIndicesInContainer(u,0,f,"isCHide")&&(it+="e-hide"),this._removeClass(l[f],"e-hcol"),this._removeClass(l[f],"e-hide"),this.addClass(l[f],it),it="",n(l[f]).find("div").text(this._generateHeaderText(f+1));ct&&this.refreshContent(u);this._isInsdel=!1;this._isUndo?this._refreshAllMergeCells(u,-1,0,i,s.colCount,"insert"):this._refreshAllMergeCells(u,-1,0,i,s.colCount,"delete");this._deletedText=h;this.model.allowComments&&this._updateCommentColl(u);this._refreshRows(u);this.XLShape&&this.XLShape._refreshChartdataInsDel(s,s.colCount,s.startCol,u,!0);o._isColSelected?this.XLSelection.selectColumns(i,r):this.performSelection({rowIndex:lt,colIndex:i},{rowIndex:at,colIndex:r});this._isUndoRedo||this._undoredoDetails(u,{rowIndex:0,colIndex:i},{rowIndex:o.rowCount-1,colIndex:r},"delete","deleteColumn");this._insDelStatus="";this.model.allowFormulaBar&&this.updateFormulaBar()}}},_getSelectedRange:function(n,t){for(var r,e,o=[],u=this.swapRange([n.rowIndex,n.colIndex,t.rowIndex,t.colIndex]),i=u[0],f=u[2];i<=f;){for(r=u[1],e=u[3];r<=e;)o.push({rowIndex:i,colIndex:r}),r++;i++}return o},performSelection:function(n,t){var u=this.getActiveSheetIndex(),i,r=this.getSheet(u),f=r._selectedCells,e,o,s,h;if(typeof n!="string"&&this.getObjectLength(n)||(i=this._getRangeArgs(n,"object"),n={rowIndex:i[0],colIndex:i[1]},t={rowIndex:i[2],colIndex:i[3]}),JSON.stringify(n)===JSON.stringify(f[0])&&JSON.stringify(t)==JSON.stringify(f[f.length-1])){r._startCell=n;r._endCell=t;this.model.allowSelection&&this.XLSelection._refreshBorder();this._updateContextualTab(u);return}this.setActiveCell(n.rowIndex,n.colIndex);this.model.allowSelection&&(e=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"merge"),o=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"merge"),e&&(s=this.getRangeIndices(e.mRange),n={rowIndex:s[0],colIndex:s[1]}),o&&(h=this.getRangeIndices(o.mRange),t={rowIndex:h[2],colIndex:h[3]}),this.XLSelection.selectRange(n,t));this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();r._startCell=n;r._endCell=t;this._updateContextualTab(u)},_updateContextualTab:function(t){var r=this.getSheet(t)._startCell,u,f,i;this.model.showRibbon&&!this._isScrolling&&(this.XLRibbon._updateRibbonIcons(),u=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tableName",t),i=n("#"+this._id+"_Ribbon").data("ejRibbon"),u?(f=this._getTableID(u),this.isNumber(f)&&this.XLRibbon._designTabUpdate(f,r)):this.model.showRibbon&&((i.model.selectedItemIndex===this.XLRibbon._getTabIndex("design")||i.isVisible(this._getLocStr("Design")))&&this.XLRibbon._toggleDesignTab(r),(i.model.selectedItemIndex===this.XLRibbon._getTabIndex("format")||i.isVisible(this._getLocStr("FORMAT")))&&this.XLRibbon._toggleFormatTab(r),(i.model.selectedItemIndex===this.XLRibbon._getTabIndex("chartdesign")||i.isVisible(this._getLocStr("CHARTDESIGN")))&&this.XLRibbon._toggleChartDesignTab(r),(i.model.selectedItemIndex===this.XLRibbon._getTabIndex("analyze")||i.isVisible(this._getLocStr("ANALYZE")))&&this.XLRibbon._toggleAnalyzeTab(r),(this.model.allowSparkline&&i.model.selectedItemIndex===this.XLRibbon._getTabIndex("sparklinedesign")||i.isVisible(this._getLocStr("SPARKLINEDESIGN")))&&this.XLSparkline._toggleSparklineDesignTab(r)))},_checkRowCol:function(n,i){if(n!==0&&i!==0)return t.isNullOrUndefined(i)&&(i=n),{start:n,end:i}},hideRow:function(n,t){if(!this.model.isGridMode){var i=this._checkRowCol(n,t);this._hideRow(i.start-1,i.end-1,"isRHide")}},showRow:function(n,t){if(!this.model.isGridMode){var i=this._checkRowCol(n,t);this._showRow(i.start,i.end,"isRHide")}},hideColumn:function(n,t){if(!this.model.isGridMode){var i=this._checkRowCol(n,t);this._hideColumn(i.start-1,i.end-1)}},showColumn:function(n,t){if(!this.model.isGridMode){var i=this._checkRowCol(n,t);this._showColumn(i.start,i.end)}},_hideRow:function(n,i,r,u){var e=this.getActiveSheetIndex(),f=this.getSheet(e),a=this.getRows(e),y=a[1],p=a[0],h=this.model.scrollSettings,s=h.allowVirtualScrolling,v=f.hideRowsCollection,c=[],o,l;for(this._isUndoRedo||u||(this.XLEdit._updateDataContainer({rowIndex:n?n-1:n,colIndex:0},{dataObj:{hRow:!0}}),s||this.addClass(this._getJSSheetRowHeaderContent(e).find(".e-rowheader")[n?n-1:n],"e-hrow")),o=n;o<=i;o++)r==="isRHide"&&this.XLEdit._updateDataContainer({rowIndex:o,colIndex:0},{dataObj:{isRHide:!0}}),c.push(o),v.indexOf(o)===-1&&(v.push(o),s||(this._isRowViewable(e,o)&&(this.addClass(y[o],"e-r-hide"),this.addClass(p[o],"e-r-hide")),h.allowScrolling&&h.scrollMode===t.Spreadsheet.scrollMode.Infinite&&(!f._isImported||f._isLoaded)&&(this._isFilter?(f.rowsHeightCollection.push(this.model.rowHeight),this._hideRowColl.push(f.rowCount++)):this.XLScroll._createNewRow(e,-1,-1,"insert"))),this.XLShape&&this.XLShape._refreshShapePosOnResize(o,0,!1,e));this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(n,i,!0,!0);this._isFilter||this.XLScroll._getRowHeights(e,n);this._showHideRows(e,f,c,n,i,s,"hide");f._isImported&&!f._isLoaded||this._isFilter||this._isExport||(this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this._isFrozen(f.frozenRows)&&(n<f._frozenRows||i<f._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv(),this.model.scrollSettings.allowScrolling&&!s&&this.XLScroll._refreshScroller(e,"refresh","vertical"),this._isUndoRedo||u||(f._activeCell.rowIndex=i+1,l={sheetIndex:e,reqType:"show-hide",action:"hide",operation:"row",bSelect:{startRow:n,endRow:i},aSelect:{startRow:i+1,endRow:i+1},addBRows:n?[n-1]:[n],remBRows:[],hideRows:c},this._completeAction(l),this._trigActionComplete(l)));u||this._isFilter||(this.XLSelection.selectRow(i+1,e),this.model.allowAutoFill&&this.XLDragFill.hideAutoFillElement())},_showRow:function(i,r,u,f,e,o,s){for(var y,p,c=this.getActiveSheetIndex(),nt=!1,w=this._isUndoRedo?i:i-1>0?i-1:0,h=w,l=this.getSheet(c),tt=this.getRows(c),it=tt[1],rt=tt[0],b=[],ut=[],ft=l.rowsHeightCollection,k=l.hideRowsCollection,v=t.buildTag("table#wrapTable.e-table",{}),d=this._dataContainer.sheets[c],a=this.model.scrollSettings.allowVirtualScrolling,g;h<=r;){if(k.indexOf(h)>-1){nt=!0;break}h++}if(!nt)return!1;for(e=e||this.getSheetElement(c)[0].querySelectorAll(".e-spreadsheetcolumnheader"),o=o||n(this._getJSSheetHeader(c)[0].querySelectorAll("colgroup")[0].outerHTML).attr("id","ss"),s=s||this.getSheetElement(c)[0].querySelectorAll(".e-rowheadercontent td"),a||(v.append(o),this.element[0].insertBefore(v[0],this.element[0].childNodes[0])),this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(i,r,!0),h=w;h<=r;h++)y=k.indexOf(h),y>-1&&(u==="isRHide"&&delete d[h][0].isRHide,b.push(h),k.splice(y,1),a||(this._removeClass(it[h],"e-r-hide"),this._removeClass(rt[h],"e-r-hide")),!this._isUndoRedo&&h>0&&!f?(ut.push(h-1),delete d[h-1][0].hRow,a||this._removeClass(s[h-1],"e-hrow")):h!==0||f||(delete d[0][0].hRow,a||(e.height(20.5),this._removeClass(e[0],"e-hrow"))),this.XLShape&&this.XLShape._refreshShapePosOnResize(h,ft[h]*2,!1,c)),a||(this._setWrapHeight(c,h,it,rt,v,"visible"),v.remove()),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this._isFilter||this.XLScroll._getRowHeights(c,w);this._showHideRows(c,l,b,i,r,a,"show");f||l._isImported&&!l._isLoaded||this._isUndoRedo||this._isFilter||(i<r?(this.setActiveCell(i,0),this.XLSelection.selectRows(i,r,c),p={startRow:i,endRow:r}):i>0&&(this.setActiveCell(i-1,0),this.XLSelection.selectRow(i-1,c),p={startRow:i-1,endRow:i-1}),this.XLDragFill.positionAutoFillElement(),g={sheetIndex:c,reqType:"show-hide",action:"show",operation:"row",bSelect:{startRow:i,endRow:r},aSelect:p,addBRows:[],remBRows:ut,hideRows:b},this._completeAction(g),this._trigActionComplete(g));this._isFrozen(l.frozenRows)&&(i<l._frozenRows||r<l._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv();this._isFilter||((!l._isImported||l._isLoaded)&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(c,"refresh","vertical"))},_showHideRows:function(n,t,i,r,u,f,e){f&&(e==="show"&&this.refreshContent(n),this._refreshViewport(this._isFrozen(t.frozenRows)?t._contScrollTop:t._scrollTop,n));this._refreshSHMergeCells(n,i,u-r+1,"row",e);f&&e==="hide"&&this.refreshContent(n);t.selectedRange[0]<r&&t.selectedRange[2]>u&&(this.model.allowSelection&&this.XLSelection.selectRange(t._activeCell,t._activeCell),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())},_colgroupRefresh:function(t){var i,r,u,f;this.model.allowResizing&&(i=this._getJSSheetHeader(t).find("colgroup"),r=this._getContent(t).find("colgroup"));u=n(i).clone();f=n(r).clone();n(r).remove();n(i).remove();n(u).prependTo(this._getJSSheetHeader(t).find(".e-table"));n(f).prependTo(this._getContent(t).find(".e-table"))},_updateFilterIcon:function(n,i,r){t.isNullOrUndefined(r)&&(r=this.getActiveSheetIndex());for(var o=this.getSheet(r).filterSettings.tableRange,u,e,f=0,s=o.length;f<s;f++)e=o[f].multifilterIdx,n>=e[0]&&n<=e[e.length-1]&&(u=o[f].startRow-1,this._isRowViewable(r,u)&&(i==="hide"?this.addClass(this.getCell(u,n).find(".e-filterspan")[0],"e-hide"):this._removeClass(this.getCell(u,n).find(".e-filterspan")[0],"e-hide")),this.XLEdit._updateDataContainer({rowIndex:u,colIndex:n},{dataObj:{isFilterVisible:i!="hide"}}))},_hideColumn:function(n,i){for(var e,v,h,o,y=!1,u=this.getActiveSheetIndex(),k=this._getJSSheetHeader(u).find("th"),d=this._getJSSheetHeader(u).find("col"),p,f=this.getSheet(u),g=f.hideColsCollection,c=[],l=[],nt=this._getContent(u).find("col"),w=f._filterColl,s=f.columnsWidthCollection,b=this.element.find(".e-spreadsheetcolumnheader"),a,r=n;r<=i;r++)if(this._getContent(u).find(".e-rowcell:nth-child("+(r+1)+")").addClass("e-soverflow"),p=this.XLEdit.getPropertyValue(0,r,"isCHide"),this._isColumnViewable(u,r)&&(y=!0),t.isNullOrUndefined(p))for(this.XLShape&&this.XLShape._refreshShapePosOnResize(r,0,!0,u),this.XLEdit._updateDataContainer({rowIndex:0,colIndex:r},{dataObj:{isCHide:!0}}),this._writeRule(r,u),y&&(this.addClass(k[r],"e-hide"),this.addClass(d[r],"e-hide"),this.addClass(nt[r],"e-hide")),c.push(r),s[r]>0&&(g[r]=s[r],s[r]=0),o=this.getObjectKeys(w),e=0,v=o.length;e<v;e++)t.isNullOrUndefined(w[o[e]])||t.isNullOrUndefined(this.XLEdit.getPropertyValue(o[e],r,"isSpanHide"))&&this.XLEdit._updateDataContainer({rowIndex:o[e],colIndex:r},{dataObj:{isSpanHide:!0}});this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(n,i,!1,!0);this._isUndoRedo||(n?l.push(n-1):l.push(n),this._isColumnViewable(u,n)&&(n===0?(b.width(28),this.addClass(b[u-1],"e-hfcol"),this.XLEdit._updateDataContainer({rowIndex:0,colIndex:0},{dataObj:{hCol:!0}})):(this.XLEdit._updateDataContainer({rowIndex:0,colIndex:n-1},{dataObj:{hCol:!0}}),this.addClass(this._getJSSheetHeader(u).find("th:eq("+(n-1)+")")[0],"e-hcol"))));this._refreshSHMergeCells(u,c,i-n+1,"column","hide");this.XLScroll._getColWidths(u,n);this._isFrozen(f.frozenColumns)&&(this.XLScroll._refreshContHgt(u),(n<f._frozenColumns||i<f._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv());this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(u,"refresh","horizontal");!f._isImported||f._isLoaded?(s.length-1===i?(this.XLSelection.selectColumn(i-1,u),this.setActiveCell(0,i-1),h={startCol:i-1,endCol:i-1}):(h={startCol:i+1,endCol:i+1},this.setActiveCell(0,i+1),this.XLSelection.selectColumn(i+1,u)),this.XLDragFill&&this.XLDragFill.positionAutoFillElement(),this._isUndoRedo||(a={sheetIndex:u,reqType:"show-hide",action:"hide",operation:"column",bSelect:{startCol:n,endCol:i},aSelect:h,hideCols:c,addBCols:l,remBCols:[]},this._completeAction(a),this._trigActionComplete(a)),this.model.allowComments&&this.XLComment._updateCmntArrowPos()):this.setActiveCell(0,0);this._browserDetails.name.indexOf("msie")>-1&&this._colgroupRefresh(u)},_showColumn:function(n,t){var i,o,r=this.getActiveSheetIndex(),f=this._isUndoRedo?n:n-1>0?n-1:0,u=this.getSheet(r),e=u.hideColsCollection,s=[],h=!1,l=[],a=this._getJSSheetHeader(r).find("th"),v=this._getContent(r).find("col"),y=this._getJSSheetHeader(r).find("col"),p=u.columnsWidthCollection,w=this.element.find(".e-spreadsheetcolumnheader"),c;for(this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(n,t),i=f;i<=t;i++)this._getContent(r).find(".e-rowcell:nth-child("+(i+1)+")").removeClass("e-soverflow"),i in e&&(this._deleteRule(i,r),this._isColumnViewable(r,i)&&(h=!0),h&&(this._removeClass(a[i],"e-hide"),this._removeClass(y[i],"e-hide"),this._removeClass(v[i],"e-hide"),v[i].style.width=e[i]+"px",y[i].style.width=e[i]+"px"),p[i]=e[i],delete e[i],delete this._dataContainer.sheets[r][0][i].isCHide,this.model.allowFiltering&&this._updateFilterIcon(i,"show",r),s.push(i),!this._isUndoRedo&&i>0?(h&&this._removeClass(a.get(i-1),"e-hcol"),delete this._dataContainer.sheets[r][0][i-1].hCol,l.push(i-1)):i===0&&(w.width(29),this._removeClass(w[r-1],"e-hfcol"),delete this._dataContainer.sheets[r][0][0].hCol),this.XLShape&&this.XLShape._refreshShapePosOnResize(i,p[i]*2,!0,r));this._refreshSHMergeCells(r,s,t-n+1,"column","show");this.XLScroll._getColWidths(r,f);this._isUndoRedo||u._isImported&&!u._isLoaded||(n<t?(this.XLSelection.selectColumns(n,t,r),o={startCol:n,endCol:t}):(this.XLSelection.selectColumn(f,r),o={startCol:f,endCol:f}),this.XLDragFill&&this.XLDragFill.positionAutoFillElement(),c={sheetIndex:r,reqType:"show-hide",action:"show",operation:"column",bSelect:{startCol:n,endCol:t},aSelect:o,addBCols:[],remBCols:l,hideCols:s},this._completeAction(c),this._trigActionComplete(c));this._browserDetails.name.indexOf("msie")>-1&&this._colgroupRefresh(r);(!u._isImported||u._isLoaded)&&this.model.allowComments&&this.XLComment._updateCmntArrowPos();this._isFrozen(u.frozenColumns)&&(n<u._frozenColumns||t<u._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv();this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(r,"refresh","horizontal")},_refreshHideRowColCollection:function(n,t,i,r,u){var e,f;if(r==="row"){for(f=0;f<n.length;f++)if(n[f]>=t+i){u==="insert"?n[f]+=i:n[f]-=i;break}}else for(e=this.getObjectKeys(n),f=e.length-1;f>=0;f--)if(e[f]>=t+i){u==="insert"?(n[parseInt(e[f])+i]=n[e[f]],delete n[e[f]]):(n[parseInt(e[f])-i]=n[e[f]],delete n[e[f]]);break}},_destroySheet:function(n){this.element.find("#"+this._id+"_"+this.model.sheets[n].sheetInfo.value).empty()},_destroy:function(){var r,t=1,i;if(this.isImport||this.model.isImport||this._isNew){while(t<=this.model.sheetCount)delete n.templates[this._id+"JSONTemplate"+t],delete n.templates[this._id+"JSONRowHdrTemplate"+t],r=this.getSheet(t).sheetInfo.value,CalcEngine.unregisterGridAsSheet(r,r),t++;if(this.model.sheets=[],this.model.nameManager=[],this._sheets=[],this.getActivationPanel().empty(),this.model.enablePivotTable&&(this.XLPivot._hasPvtField=!1),this.isDirty=!1,this.isImport||this.model.isImport){if(this._detachTable=null,this._updateFormulaCollection(),this.XLFormat._isHeaderAdded){for(t=0;t<2;t++)n("#"+this._id+"_cellstyles").children().eq(0).remove();this.XLFormat._isHeaderAdded=!1}}else document.getElementById(this._id+"_nmgrid")&&n("#"+this._id+"_nmgrid").ejGrid("option",{dataSource:[]}),this._dataContainer={sheets:{},hashCode:[],sharedData:[],cellType:[],valData:[],cFormatData:[],customCellStyle:{}},this.XLRibbon._updateUseInFormulaTrgt(),this.XLEdit._refreshAutoComplete();this.element.append([this.getFocusTopElem(),this.getFocusRightElem(),this.getFocusBottomElem(),this.getFocusLeftElem(),this.getAutoFillElem(),this._getAutoFillOptElem()]);this.element.find(".e-spreadsheet-list .e-sheet").remove();document.getElementById(this._id+"ddl")&&n("#"+this._id+"ddl").data("ejDropDownList").destroy();n("#"+this._id+"ddl").remove();this._tableCnt=this._newSIndex=1;this.XLChart&&(this.XLChart._shapeCnt=1);CalcEngine._tokenCount=0;this._isVPRendered=!1}else this._wireEvents("_off"),this._destroySubControls(),this.element.empty(),this.element.css({height:"",width:"","min-height":"","min-width":""}),this.element.removeAttr("tabindex"),this.element.removeEleEmptyAttrs(),this._removeClass(this.element[0],"e-spreadsheet e-js"),this.model.cssClass.length&&this._removeClass(this.element[0],this.model.cssClass),n("#"+this._id+" _formatastable").parent().remove(),n("#"+this._id+" _cellstyles").parent().remove(),n("#"+this._id+"_Ribbon_Home_Font_BorderColor_popup").remove();this._isRefresh||(n("#"+this._id+"_sscustomformat").remove(),document.getElementById(this._id+"_sshide")&&(document.getElementById(this._id+"_sshide").outerHTML=""),i=this.getCalcEngine(),i.getFormulaInfoTable().clear(),i.getDependentCells().clear(),i.getDependentFormulaCells().clear(),i.getNamedRanges().clear(),i.getDependentNamedRangeCells().clear(),this._tableFormulaCollection={},this._tableRangesFormula={});this._isRibbonDestroyed=!0},_destroySubControls:function(){var r,u=this._id,t,f,i,o,e;if(t=n("span.e-"+u+"-ddl input.e-dropdownlist"),t.length)for(i=0,o=t.length;i<o;i++)f=n(t[i]).data("ejDropDownList"),f&&f.destroy();if(this.model.allowFiltering){e=n(".e-"+this._id+"_customddl");e.length&&e.ejDropDownList("destroy").remove();var s=n("#"+this._id+"_filter_custom_string_acString"),h=n("#"+this._id+"_filter_custom_number_acString"),c=n("#"+this._id+"_filter_custom_date_acString");s.length&&s.ejAutocomplete("destroy").remove();h.length&&h.ejNumericTextbox("destroy").remove();c.length&&c.ejDatePicker("destroy").remove()}n("#"+this._id+"_colordlg_cpicker").ejColorPicker("destroy").remove();this.model.showRibbon&&(this.XLRibbon&&this.XLRibbon._rbnDestroy({destroy:!0}),n(".e-"+this._id+"-spltbtn").ejSplitButton("destroy"),n("#"+this._id+"_Ribbon").ejRibbon("destroy"));document.getElementById(this._id+"_nmgrid")&&n("#"+this._id+"_nmgrid").ejGrid("destroy");r=n(".e-"+u+"-dlg");r.length&&r.remove();this.model.allowFormulaBar&&n("#"+this._id+"_inputbox").ejAutocomplete("destroy");n("#"+this._id+"_AutoComplete").ejAutocomplete("destroy");this.model.allowAutoFill&&n("#"+this._id+"_dragfilloptionbtn").ejSplitButton("destroy");this.model.enableContextMenu&&(n("#"+this._id+"_contextMenuCell").ejMenu("destroy").remove(),n("#"+this._id+"_contextMenuColumnHeader").ejMenu("destroy").remove(),n("#"+this._id+"_contextMenuRowHeader").ejMenu("destroy").remove(),n("#"+this._id+"_contextMenuFooter").ejMenu("destroy").remove(),n(".e-"+u+"-cmenu").remove());this.model.allowFiltering&&(this._excelFilter&&this._excelFilter.resetExcelFilter(),n("#"+this._id+"number_excelDlg").remove(),n("#"+this._id+"string_excelDlg").remove(),n("#"+this._id+"date_excelDlg").remove());n("#"+this._id+"_copyPaste").remove();n("#"+this._id+"_wait").ejWaitingPopup("destroy");n("#"+this._id+"_wait").remove();this.XLRibbon._isAppTabCreate=!1;this.XLRibbon._isHomeTabCreate=!1;this.XLRibbon._isInsertTabCreate=!1;this.XLRibbon._isDataTabCreate=!1;this.XLRibbon._isPageLayoutTabCreate=!1;this.XLRibbon._isReviewTabCreate=!1;this.XLRibbon._isOthersTabCreate=!1;this.XLRibbon._isDesignTabCreate=!1;this.XLRibbon._isFormatTabCreate=!1;this.XLRibbon._isChartTabCreate=!1;this.XLRibbon._analyzeTabCreate=!1;this.XLRibbon._isHomeTabTrgt=!1;this.XLRibbon._isInsertTabTrgt=!1;this.XLRibbon._isDataTabTrgt=!1;this.XLRibbon._isPageLayoutTabTrgt=!1;this.XLRibbon._isOthersTabTrgt=!1;this.XLRibbon._isChartTabTrgt=!1;this.XLRibbon._analyzeTabTrgt=!1;this.XLRibbon._isFormatTabTrgt=!1;this.XLRibbon._isDesignTabTrgt=!1;this._focusTopElem=null;this._focusRightElem=null;this._focusBottomElem=null;this._focusLeftElem=null;this._autoFillElem=null;this._autoFillOptElem=null},_getXYPos:function(n,t,i,r){var e=this.element.offset().top,o=this.element.offset().left,s=t.height(),h=t.width(),u=n.offset().left-o,f=n.offset().top-e;return f+i+s>this._responsiveHeight?f=f-(f+i+s-this._responsiveHeight)+(e-6):f+=e,f<e&&(f+=e-f),u+r+h>this._responsiveWidth?u=u-(u+r+h-this._responsiveWidth)+(o-6):u+=o+r,u<o&&(u+=o-u),{xPos:u,yPos:f}},getValueRowCol:function(n,t,i){var r,f,u,e;return(n=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+n),f=this.getSheet(n),u=this.getRangeData({range:[t-1,i-1,t-1,i-1],property:["value","type","customFormat"],sheetIdx:n})[0],n==-1)?"#REF!":(f._isImported&&!f._isRequested&&(this._intrnlReq=!0,this._importSheet(n,!1)),r=u.value,this.model.locale!="en-US"&&!this.isFormula(r)&&this.isNumber(r)&&(r=this._getlocaleNumVal(r,!0)),(this.isFormula(r)||u.type=="shortdate"||u.type=="longdate"||u.type=="date"||u.type=="time")&&(r=this.XLEdit.getPropertyValue(t-1,i-1,"value2",n),r=r.replace(this._currencySymbol,""),u.type=="time"&&(r="1/1/1990 "+r),(r[0]=="%"||r[r.length-1]=="%")&&(r=r.split("%").join(""),e=parseFloat(r),isNaN(e)||(r=(e/100).toString())),r=r.replace(this._percentSymbol,"")),u.customFormat&&r.toString().indexOf("(")>-1&&(r=u.type=="currency"?u.customFormat.indexOf(")")>-1?"-"+r.split(/[()$]/g)[2]:"-"+r.split("$")[1]:u.customFormat.indexOf(")")>-1?"-"+r.split(/[(\)]/)[1]:+r),r)},setValueRowCol:function(n,i,r,u){var g;if(r--,u--,r!==-2||u!==-2){var a,f,s,y={rowIndex:r,colIndex:u},p=!1,e,w,h,o,c,b,k,v=!0,l,d=!1;if(typeof i=="string"&&(i=i.replace(/^\"|\"$/g,"")),typeof i=="object"&&(i=i.toString()),n=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+n),f=this.getRangeData({range:[r,u,r,u],property:["value","formatStr","type","thousandSeparator","decimalPlaces","customFormat"],sheetIdx:n})[0],!t.isNullOrUndefined(f.value))for(h=this.XLDragFill._parseFormula(f.value),c=0,b=h.length;c<b;c++)if(o=h[c],o.indexOf(":")>-1&&(o=o.split(":")[0]),this._isCellReference(o)){o=o.replace(/\$/g,"");k=this.getRangeData({range:this.getRangeIndices(o),property:["type"]})[0];k.type=="text"&&(v=!1);break}(l=this.XLEdit._parseValue(i,{rowIndex:r,colIndex:u}),v&&f.formatStr&&!this._isFormulaError(i)&&(i=isNaN(parseInt(i))&&!isNaN(Date.parse(i))?new Date(i):l.value,s=this.XLFormat._format(i,{formatStr:f.formatStr,type:f.type,thousandSeparator:f.thousandSeparator,decimalPlaces:f.decimalPlaces})),v&&f.type=="fraction"&&(s=this.XLFormat._format(i,{type:f.type})),s=t.isNullOrUndefined(s)?i:s,!this._isInitLoad||this.isImport||this.model.isImport||(p=!0),e={value2:s,calcValue:l.value},t.isNullOrUndefined(f.value)||(h=this.XLDragFill._parseFormula(f.value)[0],h=="DATE"&&(e.type=l.type)),f.type&&(e.type=f.type),w={isRefCells:!0,calcValue:e.calcValue,value:f.value,rowIndex:r,colIndex:u},this._saveTriggered||this._isInitLoad||this.isImport||this.model.isImport||!this._trigger("cellSave",w))&&(this._isInitLoad||this.isImport||this.model.isImport||this.getSheet(n)._isLoaded||(a=this.XLEdit.getPropertyValue(r,u,"tableName",n),!this.XLFormat._isFAT&&a&&(g=this.XLEdit.getPropertyValue(r,u,"value2",n),e.value2=this.XLFormat._updateTableColName(r,u,g,e.value2,n,a))),f.customFormat=="(#,##0);#,##0"&&e.value2.indexOf("-")>-1&&(d=!0),f.customFormat&&(e.value2=f.customFormat.indexOf(")")>-1&&!d&&f.type=="number"?"("+(e.value2.indexOf("-")>-1?e.value2.split("-")[1]:e.value2)+")":e.value2.indexOf("-")>-1?e.value2.split("-")[1]:e.value2),this.XLEdit._updateDataContainer(y,{dataObj:e,sheetIdx:n,skipCell:p}),this.XLEdit._refreshCellAlignment({cellIdx:y,value:i,type:f.type}))}},getActiveCellElem:function(n){n=this._getSheetIndex(n);var t=this.getSheet(n);return this.getCell(t._activeCell.rowIndex,t._activeCell.colIndex,n)},_pushHighlightData:function(n){for(var f,i,o=n[0],r=this._dataContainer.valData,u,e=!1,t=0;t<r.length;t++){for(u=r[t].split("_")[1]=="list"?r[t].split("_")[3]:r[t].split("_")[6],f=this.getRangeIndices(u);n[0]<=n[2];){for(i=n[1];i<=n[3];i++)e=this.inRange(f,n[0],i),e&&this.XLClipboard._highLightRange.indexOf(u)==-1&&this.XLClipboard._highLightRange.push(u);n[0]++}n[0]=o}},_highlightValidationRng:function(n,t,i,r,u,f){n[6]=this.getAlphaRange(i,r,u,f);this._dataContainer.valData[t]=n.join("_")},_hlDlgOpen:function(){var f=this.getActiveSheetIndex(),e=this.getActiveCellElem(f),o;if(!e.length||!this.model.allowEditing)return!1;if(this.XLEdit._rangeHasProperty(this.getSheet(f).selectedRange,"cellType")){this._showAlertDlg("Alert","CellTypeAlert","CellTypeAlert",372);return}var t=this._id,c,l=n("#"+t+"_Ribbon_webAddress"),a=n("#"+t+"_Ribbon_cellAddress"),s=n("#"+t+"_Ribbon_findText"),i,r=this.XLEdit.getPropertyValue(e.parent("tr").index(),e[0].cellIndex,"hyperlink",f),v,h,u=n("#"+t+"_Ribbon_cellText");n("#"+t+"_HLDialog").ejDialog("open");this._responsiveHeight<365&&n("#"+this._id+"_HLDialog_wrapper").css("top","0px");h=n("#"+t+"_Ribbon_sheentName").data("ejTreeView");h.option("fields",{dataSource:this.XLRibbon._sheetData()});c=n("#"+t+"_HLDialogTab").data("ejTab");u.attr("disabled",!1);s.attr("disabled",!1);this.isUndefined(r)?c.model.selectedItemIndex===0?(l.val("http://"),u.val("")):(h.selectNode(f+1),u.val(h.getText(f+1)+"!A1"),a.val("A1")):(this.isUndefined(r.webAddr)?c.option({selectedItemIndex:1}):c.option({selectedItemIndex:0}),this.isUndefined(r.cellAddr)?(l.val(r.webAddr),a.val("A1")):(a.val(r.cellAddr.split("_")[0]),v=parseInt(r.cellAddr.split("_")[1])+1,h.selectNode(v),l.val("http://")));n.validator&&(n("#"+t+"_Form_Ribbon_cellAddress").validate().resetForm(),n("#"+t+"_Form_Ribbon_webAddress").validate().resetForm());s.val("");i=this.XLEdit.getPropertyValueByElem(e);this.isUndefined(i)||(o=this.XLEdit.getPropertyValueByElem(e,"type"),this.isFormula(i)||o&&o.indexOf("date")>-1||n.isNumeric(i)||o&&o.indexOf("time")>-1?(u.val(this._getLocStr("HyperLinkHide")),s.val(this._getLocStr("HyperLinkHide")),u.attr("disabled",!0),s.attr("disabled",!0)):(u.val(i),s.val(i)))},_setLink:function(i){var o,h,s,c,e,y,l,a=this.getActiveSheetIndex(),p,u,r=this.getActiveCell(a),f,v;e=this.getSheet(a).selectedRange;n("#"+this._id+"_HLDialog").length||this.XLRibbon._initHLDialog();v=n("#"+this._id+"_HLDialogTab").ejTab("option","selectedItemIndex");o=n("#"+this._id+"_Ribbon_cellText").val();h=n("#"+this._id+"_Ribbon_cellAddress").val();s=n("#"+this._id+"_Ribbon_findText").val();c=n("#"+this._id+"_Ribbon_webAddress").val();l=n("#"+this._id+"_Ribbon_sheentName").data("ejTreeView");y=this._getSheetIndexByName(l.getSelectedNode().text()||this._getSheetNames()[this.getActiveSheetIndex()-1].text);o.length||s.length||(o=l.getSelectedNode().text()+"!"+h,s=c);f=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex);this._prevText=t.isNullOrUndefined(f)?"":this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2");this._prevVal=t.isNullOrUndefined(f)?"":this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value");u=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"type")&&(this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"type").indexOf("date")>-1||this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"type").indexOf("time")>-1)?this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2"):n.isNumeric(f)||this.isFormula(f)?f:v===0?s:o;this._isUndoRedo&&(u=i[0].prevText);this._dupDetails=!0;this.XLEdit._updateCellValue(r,u);this._dupDetails=!1;(this.isFormula(u)||n.isNumeric(u))&&(u=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2"));p=v===0?{webAddr:c,text:u}:{cellAddr:h,text:u};this.setHyperlink(this._getAlphaRange(a,e[0],e[1],e[2],e[3]),p,y,i);this._dlgHLClick=!1},_getRangeArgs:function(n,i,r){return t.isNullOrUndefined(n)&&(n=this.getSheet(r).selectedRange),n.indexOf("!")>-1&&(n.split("!").length==3?(n=n.split("!"),n=n[1].split(":")[0].replace(/\$/g,"")+":"+n[2]):n=n.split("!")[1].replace(/\$/g,"")),i===typeof n?n:typeof n=="object"?this._getAlphaRange(this.getActiveSheetIndex(),n[0],n[1],n[2],n[3]):this.getRangeIndices(n)},setHyperlink:function(i,r,u,f){var c;if((!this.model.isGridMode||!(u>1))&&(i=this._getRangeArgs(i,"string"),this.model.allowHyperlink&&!this.model.isReadOnly)){if(c={range:i,address:r.webAddr,text:r.text,sheetIndex:u,reqType:"hyperlink",action:"add",type:"actionBegin"},this.XLEdit._rangeHasProperty(i,"cellType")){this._showAlertDlg("Alert","CellTypeAlert","CellTypeAlert",372);return}if(this._trigActionBegin(c))return;i=c.range;r.webAddr=c.address;r.text=c.text;u=c.sheetIndex;var w,h,ft,b,it,d,g,o,v=r.cellAddr?this.getActiveSheetIndex():u?u:this.getActiveSheetIndex(),et=this.getSheet(v),k,nt,a=[],rt,l,e,y,s=this._getAlphaRangeCells(i,v),p={sheetIndex:v,reqType:"hyperlink"},ut,tt;if(g=this._getRangeArgs(i,"object"),o=this._getSelectedCells(p.sheetIndex,g).selCells,p.action=t.isNullOrUndefined(this.XLEdit.getPropertyValue(o[0].rowIndex,o[0].colIndex,"hyperlink"))?"add":"edit",this._isUndoRedo)for(e=0,y=o.length;e<y;e++)!f||t.isNullOrUndefined(f[e])||t.isNullOrUndefined(f[e].prevLink)||(this.XLEdit._updateDataContainer({rowIndex:o[e].rowIndex,colIndex:o[e].colIndex},{dataObj:{hyperlink:f[e].prevLink}}),this._isRowViewable(u,o[e].rowIndex)&&(ut=n(s[e]).text(),n(s[e]).find("a").remove(),s[e].lastChild?s[e].lastChild.textContent="":n(s[e]).text(""),e===0?t.isNullOrUndefined(this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink").cellAddr)?n(s[e]).append(t.buildTag("a",f[e].prevText,"",{href:this.XLEdit.getPropertyValueByElem(n(s[e]),"hyperlink").webAddr,target:"_blank"})):n(s[e]).append(t.buildTag("a",f[e].prevText,"")):t.isNullOrUndefined(this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink").cellAddr)?n(s[e]).append(t.buildTag("a",ut,"",{href:this.XLEdit.getPropertyValueByElem(n(s[e]),"hyperlink").webAddr,target:"_blank"})):n(s[e]).append(t.buildTag("a",ut,"")),n(s[e]).find("a").addClass("e-hyperlinks")),this._dupDetails=!0,this.XLFormat.format({style:{color:this._hlColor}}),this._dupDetails=!1);else{for(t.isNullOrUndefined(r.webAddr)?(h=r.cellAddr,w=t.isNullOrUndefined(r.text)?this.XLEdit.getPropertyValue(o[0].rowIndex,o[0].colIndex,"value2"):r.text,h.indexOf("!")>-1&&(k=h.split("!"),u=k[0].indexOf("=")>-1?this._getSheetIndexByName(k[0].split("=")[1]):this._getSheetIndexByName(k[0]),h=k[1]),h.indexOf("$")>-1&&(h=h.split("$").join("")),nt=t.isNullOrUndefined(w)?h:w):(it=r.webAddr,b=t.isNullOrUndefined(r.text)?this.XLEdit.getPropertyValue(o[0].rowIndex,o[0].colIndex,"value2"):r.text,nt=t.isNullOrUndefined(b)?it:b),this._dupDetails=!0,this._dlgHLClick||(tt=this.XLEdit.getPropertyValue(o[0].rowIndex,o[0].colIndex,"value2"),this._prevText=t.isNullOrUndefined(tt)?"":tt,this._prevVal=t.isNullOrUndefined(tt)?"":this.XLEdit.getPropertyValue(o[0].rowIndex,o[0].colIndex,"value"),this.XLEdit._updateCellValue({rowIndex:o[0].rowIndex,colIndex:o[0].colIndex},nt)),e=0,y=o.length;e<y;e++)a.push({rowIndex:o[e].rowIndex,colIndex:o[e].colIndex,prevLink:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink"),prevColor:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"formats")});for(this.isUndefined(c.text)||this.XLEdit._updateCellValue(o[0],c.text),this.isUndefined(h)?this.updateUniqueData({hyperlink:{webAddr:it}},g,"",u):this.updateUniqueData({hyperlink:{cellAddr:h+"_"+u}},g),e=0,y=o.length;e<y;e++){if(l=this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"value2"),a[e].prevText=e===0?this._prevText:l,a[e].prevVal=e===0?this._prevVal:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"value"),this._isRowViewable(v,o[e].rowIndex)&&(n(s.eq(e).find("a")).remove(),this.XLEdit._refreshTextNode(s[e]),d=!0,n(s.eq(e).find(".e-cf-databar")).length)){s.eq(e).find(".e-databar-value")[0].innerHTML=nt;continue}rt=this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink",v);rt.cellAddr?(l=e===0?w:l,d&&s.eq(e).append(t.buildTag("a",l,"")),a[e].curText=w):(l=e===0?b:l,d&&!this.isUndefined(s[e])&&s.eq(e).append(t.buildTag("a",l,"",{href:rt.webAddr,target:"_blank"})),a[e].curText=b);a[e].curLink=this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink");d&&n(s[e]).find("a").addClass("e-hyperlinks")}i="Sheet"+v+"!"+i;this.XLFormat.format({style:{color:this._hlColor}},i);this._dupDetails=!1;p.selectedCell=a;ft={sheetIndex:this.getActiveSheetIndex(),range:i,linkData:r,reqType:"hyperlink",selectedCell:p.selectedCell,action:p.action};et._isImported&&(!et._isLoaded||this._isExport)||(this._completeAction(p),this._trigActionComplete(ft))}}},removeHyperlink:function(n,i,r,u,f){var s,c;if(!this.model.allowHyperlink||this.model.isReadOnly)return!1;if(s=this.getActiveSheetIndex(),c={range:n,sheetIndex:s,reqType:t.isNullOrUndefined(r)?"hyperlink":"clear-link",type:"actionBegin",action:t.isNullOrUndefined(r)?"delete":"clear-link"},!this._trigActionBegin(c)){var e,l,h,v,y=[],k=this._dupDetails,o,w=this.getSheet(s),b=[],p,a={sheetIndex:s,reqType:"hyperlink",action:"delete",range:c.range};for(o=this._getMultiRangeCells(c.range),e=0,l=o.length;e<l;e++)f&&this._isHiddenRow(o[e].rowIndex)||(h={rowIndex:o[e].rowIndex,colIndex:o[e].colIndex,prevLink:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink"),prevText:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"value2"),prevVal:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"value"),prevColor:this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"formats")},this._dupDetails=!0,h.prevLink&&(i?this.XLFormat.format({style:{"text-decoration":"underline"}},this._getAlphaRange(s,o[e].rowIndex,o[e].colIndex,o[e].rowIndex,o[e].colIndex)):(t.isNullOrUndefined(u)||this.isUndefined(u[e].prevColor)||(v=u[e].prevColor.color),this.XLFormat.format({style:{color:this.isUndefined(v)?"#444445":v,"text-decoration":"none"}},this._getAlphaRange(s,o[e].rowIndex,o[e].colIndex,o[e].rowIndex,o[e].colIndex))),h.curColor=this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"formats")),this._dupDetails=k,this.clearRangeData([o[e].rowIndex,o[e].colIndex,o[e].rowIndex,o[e].colIndex],["hyperlink"]),this._isUndoRedo||(h.curLink=this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"hyperlink")),this._isUndoRedo&&!this._dupDetails&&(t.isNullOrUndefined(u[e].prevText)||this.XLEdit._updateDataContainer({rowIndex:o[e].rowIndex,colIndex:o[e].colIndex},{dataObj:{value2:u[e].prevText,value:u[e].prevVal},sheetIdx:s})),this._isUndoRedo||(h.curText=this.XLEdit.getPropertyValue(o[e].rowIndex,o[e].colIndex,"value2")),!this._isUndoRedo||this._dupDetails||t.isNullOrUndefined(u[e].prevLink)||(this.XLEdit._updateDataContainer({rowIndex:o[e].rowIndex,colIndex:o[e].colIndex},{dataObj:{hyperlink:u[e].prevLink}}),p={rowIndex:u[e].rowIndex,colIndex:u[e].colIndex},this.XLSelection.selectRange(p,p),this._setLink([u[e]]),y.push(e)),b.push(h));for(e=0,l=y.length;e<l;e++)o.splice(y[e],1);a.selectedCell=b;a.reqType=t.isNullOrUndefined(r)?"hyperlink":"clear-link";w._isImported&&!w._isLoaded||this._isUndoRedo||this._dupDetails||this._isExport||(this._completeAction(a),this._trigActionComplete(a))}},_removeHyperlink:function(n,t,i,r){var u=this.getActiveSheetIndex();r=r?r:this.getSheet(u).selectedRange;this.removeHyperlink(this._getAlphaRange(u,r[0],r[1],r[2],r[3]),n==="clear",n,t,i)},_openLink:function(){var n=this.getActiveSheetIndex(),t=this.getSheetElement(n).find(".e-activecell");this._hlClick(this.XLEdit.getPropertyValue(t.closest("tr").index(),t[0].cellIndex,"hyperlink",n))},_hlClick:function(n){var r,f,t,o,s=this.getActiveSheetIndex(),l,u,i=this.getSheet(s),a,h,c,v=this.getActiveCell(s),e={rowIndex:v.rowIndex,colIndex:v.colIndex,cellAddr:n.cellAddr,webAddr:n.webAddr,target:"_blank",action:"hyperlinkclick",sheetIndex:s,reqType:"hyperlink-click",type:"cellClick"};(this.model.enableContextMenu&&this.XLCMenu.hideCMenu(),this._trigger("cellClick",e))||(c=e.cellAddr,a=e.target,h=e.webAddr,c?(u=c.split("_"),l=u[0].indexOf("$")>-1?u[0].split("$").join(""):u[0],r=this.getRangeIndices(l),t={rowIndex:r[0],colIndex:r[1]},o={rowIndex:r[2],colIndex:r[3]},f=Number(u[1]),this.gotoPage(f,!1),i._activeCell=t,this.XLSelection.selectRange(t,o,f),i._startCell=t,i._endCell=o,this.XLScroll._scrollSelectedPosition(f,t),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()):(t={rowIndex:i._activeCell.rowIndex,colIndex:i._activeCell.colIndex},i._startCell=t,i._endCell=t,this._isValidUrl(h)?window.open(h,a):this._showAlertDlg("Alert","HyperLinkAlert")))},_isValidUrl:function(n){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(n)},showWaitingPopUp:function(){n("#"+this._id+"_wait").data("ejWaitingPopup").show()},hideWaitingPopUp:function(){n("#"+this._id+"_wait").data("ejWaitingPopup").hide()},_getSelRange:function(n){var t,i;return t=n[0],i=n[n.length-1],this._generateHeaderText(t.colIndex+1)+(t.rowIndex+1)+":"+this._generateHeaderText(i.colIndex+1)+(i.rowIndex+1)},_getSelectedCells:function(n,i){var u,r,f=this.getSheet(n?n:this.getActiveSheetIndex());return t.isNullOrUndefined(i)?(u=f._selectedCells,u.length>0?(i=this._getSelRange(u),r=this.getRangeIndices(i)):(r=[0,0,0,0],u=[{rowIndex:0,colIndex:0}])):(r=this._getRangeArgs(i,"object"),u=this._getSelectedRange({rowIndex:r[0],colIndex:r[1]},{rowIndex:r[2],colIndex:r[3]})),{range:r,selCells:u}},_getHiddenCells:function(i,r,u,f){var e=this._dataContainer.sheets[i],c,s,h,o;return t.isNullOrUndefined(f[u.rowIndex])&&(f[u.rowIndex]={}),t.isNullOrUndefined(f[u.rowIndex][u.colIndex])&&(f[u.rowIndex][u.colIndex]={value:{},text:""}),t.isNullOrUndefined(e[u.rowIndex])||(f[u.rowIndex][u.colIndex].value=n.extend(!0,{},e[u.rowIndex][u.colIndex]),c=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",i),s=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"wrap",i),h=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"wrapRow",i),this.isUndefined(this.XLEdit.getPropertyValue(u.rowIndex,u.colIndex,"border",i))&&this.isUndefined(this.XLEdit.getPropertyValue(u.rowIndex,u.colIndex,"format",i))?delete e[u.rowIndex][u.colIndex]:(o=this.getObjectKeys(this._dataContainer.sheets[i][u.rowIndex][u.colIndex]),o.splice(o.indexOf("border"),1),o.splice(o.indexOf("format"),1),this.XLEdit._clearDataContainer({cellIdx:{rowIndex:u.rowIndex,colIndex:u.colIndex},property:o})),f[u.rowIndex][u.colIndex].text=t.isNullOrUndefined(c)?"":c,(s||h)&&(t.isNullOrUndefined(e[u.rowIndex])&&(e[u.rowIndex]={}),t.isNullOrUndefined(e[u.rowIndex][u.colIndex])&&(e[u.rowIndex][u.colIndex]={}),s&&(e[u.rowIndex][u.colIndex].wrap=s),h&&(e[u.rowIndex][u.colIndex].wrapRow=h))),this._isRowViewable(i,r.rowIndex)&&(r=this.getCell(r.rowIndex,r.colIndex,i).empty()),f},_getRowSpan:function(n,i){for(var u=0,r=i[0].rowIndex,f=i[i.length-1].rowIndex;r<=f;r++)t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isRHide",n))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isFHide",n))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isFilterHide",n))&&this.getSheet(n)._fHMergeRows.indexOf(r)===-1&&(u=u+1);return u},_getColSpan:function(n,i){for(var u=0,r=i[0].colIndex,f=i[i.length-1].colIndex;r<=f;r++)t.isNullOrUndefined(this.XLEdit.getPropertyValue(0,r,"isCHide",n))&&this.getSheet(n)._fHMergeCols.indexOf(r.toString())===-1&&(u=u+1);return u},_getHiddenRowColumnCount:function(n,i){var f=this.getRangeIndices(i),e=0,o=0,r,u,s=this.model.scrollSettings.allowVirtualScrolling,h;for(s||(h=this._getJSSheetHeader(n).find("col")),r=f[0];r<=f[2];r++)t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isRHide",n))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isFHide",n))||(e=e+1);for(u=f[1];u<=f[3];u++)(s||!s&&this._hasClass(h[u],"e-hide")||!t.isNullOrUndefined(this.XLEdit.getPropertyValue(0,u,"isCHide",n)))&&(o=o+1);return{hRow:e,hCol:o}},_updateMergeColl:function(n,i,r,u,f,e,o,s){var c=this.getSheet(n),h=c._mergeColl;t.isNullOrUndefined(h[i])?(h[i]={},h[i][r]={}):t.isNullOrUndefined(h[i][r])&&(h[i][r]={});h[i][r].type=u;s&&(h[i][r].mergeType=s);f&&(h[i][r].isSamePosn=f);c.mergedCells.push({isCenterAlign:o,range:e})},mergeCells:function(n,i){var r,l,o,y,a=1,v=1,s,w=[],f=this.getActiveSheetIndex(),h=this.getSheet(f),u,c=!1,p,e=this._getRangeArgs(n,"object",f),b=e[2]-e[0]||e[3]-e[1],k,d;if(this.model.allowMerging&&this.model.allowSelection&&b&&!(this.getSheetElement(f).find(".e-ss-activeimg").length>0)&&(!h._isLoaded||!this.model.isReadOnly)){if(u=this._getSelectedCells(f,e).selCells,this._selMergeCells=[],this._mergeType="merge-cells",(!h._isImported||h._isLoaded)&&!this._isUndoRedo)if(this.performSelection(e),this.mergeCenter){for(c=!1,s=u.length,r=0;r<s;r++)o=this.XLEdit.getPropertyValue(u[r].rowIndex,u[r].colIndex,"merge",f),t.isNullOrUndefined(o)||(a=o.mSpan.rowSpan,v=o.mSpan.colSpan,(a>1||v>1)&&(p=this._getHiddenRowColumnCount(f,this.XLEdit.getPropertyValue(u[r].rowIndex,u[r].colIndex,"merge").mRange),this._unMergeAllCells(f,r,u,w,p.hRow,p.hCol),c=!0));!c||this._dupDetails||this._isUndoRedo||(t.isNullOrUndefined(n)&&(n=this._getSelRange(u)),y={sheetIndex:f,cells:u,range:n,reqType:"merge-cells",action:"un-merge",operation:"un-merge",mCells:w},this._completeAction(y),this._trigActionComplete(y),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this.performSelection(e))}else for(s=u.length,r=0;r<s;r++)if(o=this.XLEdit.getPropertyValue(u[r].rowIndex,u[r].colIndex,"merge",f),t.isNullOrUndefined(o)||(a=o.mSpan.rowSpan,v=o.mSpan.colSpan),a===1&&v===1){c=!1;break}for(h._isImported&&!h._isLoaded||this._isUndoRedo||!this._rangeHasData(e)||i||c||!b?c||this._mergeCells(f,u,{},[]):this._showAlertDlg("","MergeCellsAlert","MergeCells",498),n=this.getObjectKeys(h.formulaRange),s=n.length,l=0;l<s;l++)k=n[l],d=this.getRangeIndices(k),e[3]==d[3]&&this._showAlertDlg("Alert","ArrayaFormula",430)}},_mergeCells:function(i,r,u,f){var a,b,l=this._dataContainer.sheets[i],y,v,e,o,tt={},h,p,k,c=this.getSheet(i),d=this.XLEdit,w,g,nt,s,it;if(b=e=r[0].rowIndex,o=r[0].colIndex,nt=this.XLEdit.getPropertyValue(e,o,"format"),this.model.scrollSettings.allowVirtualScrolling||(k=this._getJSSheetHeader(i).find("col")),(t.isNullOrUndefined(d.getPropertyValue(e,0,"isFRHide"))||t.isNullOrUndefined(d.getPropertyValue(e,0,"isRHide")))&&k&&k.eq(o).hasClass("e-fc-hide"))return{hideCell:[],mCells:[]};for(a={rowSpan:this._getRowSpan(i,r),colSpan:this._getColSpan(i,r)},t.isNullOrUndefined(l[e])||t.isNullOrUndefined(l[e][o])||(delete l[e][o].isMHide,delete l[e][o].mergeIdx),this._isRowViewable(i,e)&&(h=this.getCell(e,o),h[0].colSpan=a.colSpan,h[0].rowSpan=a.rowSpan,h[0].className=h[0].className.replace("e-mc-hide",""),this.mergeCenter&&h.addClass("e-calign "),h.hasClass("e-commentcell")&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(h)),this._selMergeCells.push(r[0]),this._textClip(r[0].rowIndex,r[0].colIndex,"add"),this._textClip(r[0].rowIndex,r[0].colIndex,"delete","",!0),this._isRowViewable(i,r[0].rowIndex)&&this.addClass(this.getCell(r[0].rowIndex,r[0].colIndex)[0],"e-moverflow"),s=1,it=r.length;s<it;s++)this._isRowViewable(i,r[s].rowIndex)&&(p=this.getCell(r[s].rowIndex,r[s].colIndex),this._hasClass(p[0],"e-mc-hide")||this.addClass(p[0],"e-mc-hide"),this.addClass(p[0],"e-moverflow")),b!==r[s].rowIndex&&c.hideRowsCollection.indexOf(r[s].rowIndex)==-1&&(b=r[s].rowIndex),this._textClip(r[s].rowIndex,r[s].colIndex,"add"),this._textClip(r[s].rowIndex,r[s].colIndex,"delete","",!0),u=this._getHiddenCells(i,{rowIndex:r[s].rowIndex,colIndex:r[s].colIndex},r[s],u),this.isUndefined(nt)?this.XLEdit._updateDataContainer({rowIndex:r[s].rowIndex,colIndex:r[s].colIndex},{dataObj:{isMHide:!0,mergeIdx:{rowIndex:e,colIndex:o}},sheetIdx:i}):this.XLEdit._updateDataContainer({rowIndex:r[s].rowIndex,colIndex:r[s].colIndex},{dataObj:{isMHide:!0,mergeIdx:{rowIndex:e,colIndex:o},format:nt},sheetIdx:i}),this._selMergeCells.push(r[s]);return v=this._getSelRange(r),t.isNullOrUndefined(l[e])||n.extend(!0,tt,l[e][o]),c._activeCell=r[0],(!c._isImported||c._isLoaded)&&this.performSelection(r[0],r[r.length-1]),this.XLEdit._updateDataContainer({rowIndex:e,colIndex:o},{dataObj:{merge:{mSpan:a,isMerge:!0,mRange:v,isCenterAlign:this.mergeCenter}}}),g=this._getMCellBorderProps(this.getRangeIndices(v)),this.getObjectLength(g)&&this.XLFormat._applyBorderCss(g,this.getRangeIndices(v)),this._updateMergeColl(i,e,o,this.mergeCenter?"center":"merge",null,v,this.mergeCenter,this._mergeType),f.push({rowIndex:e,colIndex:o,prevObj:tt,curObj:n.extend(!0,{},l[e][o])}),d.getPropertyValue(e,o,"wrap")&&(w=this._getWrapCellHeight(i,e,o).rowHt,(this._getRowHeight(e,i)<=w||c._isImported||!c._isLoaded)&&(this.setHeightToRows([{rowIndex:e,height:w}]),this._wrapCollection(e,o,w.cellHt,i))),c._isImported&&!c._isLoaded||this._isUndoRedo||this._dupDetails||this._paste||this._mergeType!=="merge-cells"||(y={sheetIndex:i,cells:[{rowIndex:e,colIndex:o}],range:v,reqType:"merge-cells",action:"merge-all",hideCells:u,mCells:f},y.operation=this.mergeCenter?"merge-center":"merge-all",this._paste||(this._completeAction(y),this._trigActionComplete(y))),this.model.showRibbon&&!this._isScrolling&&this.XLRibbon._updateRibbonIcons(),this.mergeCenter=!1,this._paste=!1,this.XLEdit._updateUsedRange(e+a.rowSpan,o+a.colSpan,i),this.model.allowCellFormatting&&this.XLEdit.getPropertyValue(e,o,"cFormatRule",i)&&this.XLCFormat.refreshCFormat(this._getAlphaRange(i,e,o,e,o)),{hideCells:u,mCells:f}},mergeAcrossCells:function(n,t){if(!this.model.isReadOnly){var r=this.getActiveSheetIndex(),u=this.getSheet(r),f,i=this._getRangeArgs(n,"object",r),o=i[2]-i[0]||i[3]-i[1],e=i[3]-i[1];!this.model.allowMerging||this.getSheetElement(r).find(".e-ss-activeimg").length>0||!o||this.model.isReadOnly||(this._selMergeCells=[],f=this._getSelectedCells(r,i),this.isUndefined(n)||this.performSelection(i),!this._isUndoRedo&&this._rangeHasData(i)&&(!u._isImported||u._isLoaded)&&!t&&e?this._showAlertDlg("","MergeCellsAlert","MergeAcrossCells",498):e&&this._mergeAcrossCells(r,f.selCells),this.performSelection(i),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons())}},_mergeAcrossCells:function(i,r){var u,e,a,o,s=1,v=1,h=!0,c,y,p,w,b,l=[],f={mCells:[],hideCells:{}},k=this.getSheet(i);for(this._mergeType="merge-across",u=0,a=r.length;u<a;u++)if(o=this.XLEdit.getPropertyValue(r[u].rowIndex,r[u].colIndex,"merge",i),t.isNullOrUndefined(o)||(s=o.mSpan.rowSpan,v=o.mSpan.colSpan),s===1&&v===1){h=!1;break}else s>1&&(h=!1);if(!h)for(w=r[0].rowIndex,b=r[r.length-1].rowIndex,y=r[0].colIndex,p=r[r.length-1].colIndex,u=w;u<=b;u++){for(l=[],e=y;e<=p;e++)l.push({rowIndex:u,colIndex:e});f=this._mergeCells(i,l,f.hideCells,f.mCells)}k._isImported&&!k._isLoaded||this._isUndoRedo||this._dupDetails||(c={sheetIndex:i,cells:n.extend(!0,[],this._selMergeCells),range:this._getSelRange(r),reqType:"merge-cells",action:"merge-across",operation:"merge-across",hideCells:f.hideCells,mCells:f.mCells},this._paste||(this._completeAction(c),this._trigActionComplete(c)),this._paste=!1);this._mergeType="merge-cells";this.performSelection(r[0],r[r.length-1])},_getMCellBorderProps:function(n){for(var f,t,e,s,r={},i,o=["bottom","right"],u=0;u<o.length;u++)for(t=o[u],s=t==o[0]?[n[2],n[1],n[2],n[3]]:[n[0],n[3],n[2],n[3]],i=this.getRangeData({range:s,property:["border"]}),f=0;f<i.length;f++)if(i[f].border)if(e=this.XLFormat.getBorderFromHashCode(i[0].border),e[t]){if(r[t]&&r[t]!=e[t]){delete r[t];break}r[t]=e[t]}else{delete r[t];break}else{delete r[t];break}return i=this.XLEdit.getPropertyValue(n[0],n[1],"borders"),i&&(i.top&&(r.top=i.top),i.left&&(r.left=i.left)),r},unmergeCells:function(n){var u,l;if(!this.model.isReadOnly){var r=this.getActiveSheetIndex(),f=this.getSheet(r),o=[],i,s,h,e,a=f._clrMergeColl,c=this._getRangeArgs(n,"object",r);if(this.model.allowMerging&&!(this.getSheetElement(r).find(".e-ss-activeimg").length>0)&&!this.model.isReadOnly){for(this._selMergeCells=[],i=this._getSelectedCells(r,c).selCells,u=0,l=i.length;u<l;u++)e=this.XLEdit.getPropertyValue(i[u].rowIndex,i[u].colIndex,"merge",r),this.isUndefined(e)||(h=this._getHiddenRowColumnCount(r,e.mRange),o=this._unMergeAllCells(r,u,i,o,h.hRow,h.hCol),a.push({rowIdx:i[u].rowIndex,colIdx:i[u].colIndex,mergeObj:e}));t.isNullOrUndefined(n)&&(n=this._getSelRange(i));f._isLoaded&&this.performSelection(c);f._isImported&&!f._isLoaded||this._isUndoRedo||this._dupDetails||this._isExport||(s={sheetIndex:r,cells:i,range:n,reqType:"merge-cells",action:"un-merge",operation:"un-merge",mCells:o},this._completeAction(s),this._trigActionComplete(s));this.model.showRibbon&&!this._isScrolling&&this.XLRibbon._updateRibbonIcons()}}},_unMergeAllCells:function(i,r,u,f,e,o){var s,h,d,y,g,nt,tt=1,ut=1,b,k=!1,a=this._dataContainer.sheets[i],ot={},p,ft,v,c,l,st,ht,et,ct=this.getSheet(i),it,w=!1,rt;if(c=u[r].rowIndex,l=u[r].colIndex,st=this.getRows(i)[0],rt=this.model.sheets[i].mergedCells,p=this.getCell(c,l),y=this.XLEdit.getPropertyValue(c,l,"merge",i),!t.isNullOrUndefined(y))for(tt=y.mSpan.rowSpan,ut=y.mSpan.colSpan,w=this.XLEdit.getPropertyValue(c,l,"borders",i),w&&(!w||w.right&&w.bottom)||this.XLEdit._clearDataContainer({cellIdx:{rowIndex:c,colIndex:l},property:["border"]}),w&&w.bottom&&tt===1&&this.XLFormat._updateFormatClass({rowIndex:c,colIndex:l},this.XLFormat._getBorderHashCode(w),!0),d=0;d<rt.length;d++)rt[d].range==y.mRange&&rt.splice(d,1);if(ut>1||tt>1)for(et=a[c][l],n.extend(!0,ot,et),delete et.merge,this._clearMergeColl(ct._mergeColl,c,l),this._isRowViewable(i,c)&&(p=this.getCell(c,l),this.XLEdit.getPropertyValue(c,l,"cellType",i)||(g=p.find("#"+this._id+"_Merge"),g.length&&(p[0].innerHTML=g[0].innerHTML,g.remove())),t.isNullOrUndefined(y.isCenterAlign)||p.removeClass("e-calign"),p[0].colSpan=p[0].rowSpan=1,ct._isLoaded&&(it=p[0].offsetHeight,n(st[c]).height()<it&&(this.setHeightToRows([{rowIndex:c,height:it}]),this._updateFormatColl(i,c,l,it)),this.XLScroll._getRowHeights(i,c))),f.push({rowIndex:c,colIndex:l,prevObj:ot,curObj:n.extend(!0,{},a[c][l])}),ht=[],s=c;s<c+tt+e;s++)for(h=l;h<l+ut+o;h++)this._selMergeCells.push({rowIndex:s,colIndex:h}),k=!1,this._isRowViewable(i,s)&&(v=this.getCell(s,h,i),k=!0),t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,h,"isMHide",i))||(this._isUndoRedo&&(b=this.XLEdit.getPropertyValue(s,h,"merge",i),t.isNullOrUndefined(b)||(b.mergeSpan.rowSpan>1||b.mergeSpan.colSpan>1)&&(ht.push({rowIndex:s,colIndex:h,rowSpan:b.mergeSpan.rowSpan,colSpan:b.mergeSpan.colSpan}),a[s][h].merge.mSpan={rowSpan:1,colSpan:1},v[0].rowSpan=1,v[0].colSpan=1)),nt=this.XLEdit.getPropertyValue(s,h,"mergeIdx",i),t.isNullOrUndefined(nt)||nt.rowIndex===c&&nt.colIndex===l&&(k&&(v.removeClass("e-mc-hide"),v[0].rowSpan=1,v[0].colSpan=1),delete a[s][h].isMHide,delete a[s][h].mergeIdx)),this._isUndoRedo&&!t.isNullOrUndefined(this._delCells)&&(t.isNullOrUndefined(this._delCells[s])||t.isNullOrUndefined(this._delCells[s][h])||t.isNullOrUndefined(a[s])||(ft=!t.isNullOrUndefined(a[s][h])&&a[s][h].overflow,a[s][h]=this._delCells[s][h].value,ft&&(a[s][h].overflow=ft),k&&v.text(this._delCells[s][h].text),y=this.XLEdit.getPropertyValue(s,h,"merge"),!t.isNullOrUndefined(y)&&y.isMerge&&this.mergeCells(y.mRange,!0))),k&&v.hasClass("e-commentcell")&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(v),k&&(this._removeClass(v[0],"e-moverflow"),v.text().length>0?this._textClip(s,h,"add"):this._textClip(s,h,"delete")),t.isNullOrUndefined(a[s])||(this.getObjectLength(a[s][h])<1&&delete a[s][h],this.getObjectLength(a[s])<1&&delete a[s]);return f},_refreshMergeCells:function(){var i,t,r,n;for(this._dupDetails=!0,i=this._removeMergeColl,t=0,r=i.length;t<r;t++)this.unmergeCells(i[t].merge.mRange,!0);this._dupDetails=!1;n=this._insData;switch(n.value.status){case"shiftRight":this._insertShiftRight(n.sheetIdx,n.startCell,n.endCell,n.value);break;case"shiftBottom":this._insertShiftBottom(n.sheetIdx,n.startCell,n.endCell,n.value);break;case"shiftUp":this._deleteShiftUp(n.sheetIdx,n.startCell,n.endCell,n.value);break;case"shiftLeft":this._deleteShiftLeft(n.sheetIdx,n.startCell,n.endCell,n.value)}},_showHeadings:function(n,t){if(!this.model.isReadOnly){t=t?t:this.getActiveSheetIndex();var i,e,r=this.getSheet(t),o=this._getJSSheetHeader(t),s=this._getContent(t).find(".e-content"),h=this._getJSSheetRowHeader(t),u=this.getFrozenRows(),f=this.getFrozenColumns();r.showHeadings=n;this._isDisplayHeader=!0;r.showHeadings?(h.show(),o.show(),s.removeClass("e-viewbrdr")):(h.hide(),o.hide(),s.addClass("e-viewbrdr"));this._heightWidthCalculation(t,{action:r._isLoaded?"":"initial"});this.model.showRibbon&&(i=this.element.find("#"+this._id+"_Ribbon_PageLayout_Show_Headings").data("ejCheckBox"),i&&(n?i._checked():i._unChecked()));this.model.allowFreezing&&r._isFreezed&&(this.XLFreeze.unfreezePanes(),this._isFrozen(u)&&this._isFrozen(f)?this.XLFreeze.freezePanes(u,f):this._isFrozen(u)?this.XLFreeze.freezeRows(u):this._isFrozen(f)&&this.XLFreeze.freezeColumns(f));e={reqType:"headings",showHeadings:n,sheetIndex:t};this._trigActionComplete(e)}},showHeadings:function(n){this._showHeadings(n)},showGridlines:function(n){this._showGridlines(n)},_showGridlines:function(n,t){if(!this.model.isReadOnly){t=t?t:this.getActiveSheetIndex();var i,r,u=this.getSheet(t),f=this._getContent(t).find(".e-rowcell");this.model.showRibbon&&(i=this.element.find("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").data("ejCheckBox"),i&&(n?i._checked():i._unChecked()));u.showGridlines=n;u.showGridlines?f.removeClass("e-hborder"):f.addClass("e-hborder");r={reqType:"gridlines",showGridlines:n,sheetIndex:t};this._trigActionComplete(r)}},setSheetFocus:function(){this._isPublic=!0;this._setSheetFocus();this._isPublic=!1},_setSheetFocus:function(){if(this._isSSLoaded||this._isPublic){if(!this._hasClass(document.activeElement,"e-datepicker"))if(t.browserInfo().name=="msie")try{this.element[0].setActive()}catch(n){}else this.element.focus();this._isInitLoad||window.scrollTo(window.pageXOffset,window.pageYOffset)}},_diffNumbers:function(n,t){return n-t},_isValidDate:function(n){var t,i;return/^\d{1,4}[\.|\/|-]\d{1,2}[\.|\/|-]\d{1,4}$/.test(n)?(n=n.replace(/0*(\d*)/gi,"$1"),t=n.split(/[\.|\/|-]/),t[0]=t[0]-1,t[2].length<4&&(t[2]=parseInt(t[2])<50?2e3+parseInt(t[2]):1900+parseInt(t[2])),i=new Date(t[2],t[0],t[1]),i.getDate()!=t[1]||i.getMonth()!=t[0]||i.getFullYear()!=t[2]?!1:!0):!1},_isValidTime:function(n){for(var t,r,i=0,o=!1,f,e,u=0,s=n.length;u<s;u++){if(t=n.substring(u,u+1),(t<"0"||t>"9")&&t!=":"&&t!=" "&&t!="a"&&t!="A"&&t!="p"&&t!="P"&&t!="m"&&t!="M")return!1;t==":"&&i++;(t=="p"||t=="P"||t=="a"||t=="A")&&(o=!0)}return i<1||i>2?!1:(r=n.substring(0,n.indexOf(":")),parseFloat(r)<0||parseFloat(r)>23)?!1:o&&(parseFloat(r)<1||parseFloat(r)>12)?!1:(f=i==2?n.substring(n.indexOf(":")+1,n.lastIndexOf(":")):n.substring(n.indexOf(":")+1,n.length),parseFloat(f)<0||parseFloat(f)>59)?!1:(e=i==2?n.substring(n.lastIndexOf(":")+1,n.length):"00",parseFloat(e)<0||parseFloat(e)>59)?!1:!0},_setXY:function(n,t){var i=0,r=0;return t=t?"page":"client",n.type==="mousemove"||n.type==="mousedown"||n.type==="mouseup"?(i=n[t+"X"],r=n[t+"Y"]):n.type==="touchmove"||n.type==="touchstart"||n.type==="touchend"?(i=n.originalEvent.changedTouches[0][t+"X"],r=n.originalEvent.changedTouches[0][t+"Y"]):(n.type==="MSPointerMove"||n.type==="pointermove"||n.type==="MSPointerUp"||n.type==="pointerup"||n.type==="MSPointerDown"||n.type==="pointerdown")&&(i=n.originalEvent[t+"X"],r=n.originalEvent[t+"Y"]),[i,r]},_getSelectedItems:function(n,i,r){var f,e,o,u;return n=n?n:this.getActiveSheetIndex(),u=this.getSheet(n),t.isNullOrUndefined(r)&&t.isNullOrUndefined(i)?(f=u._selectedCells,e=u._startCell,o=u._endCell,r=this._generateHeaderText(e.colIndex+1)+(e.rowIndex+1)+":"+this._generateHeaderText(o.colIndex+1)+(o.rowIndex+1)):(i=this.isUndefined(i)?this.getRangeIndices(r):i,f=this.getRange(i,n),r=this._generateHeaderText(i[1]+1)+(i[0]+1)+":"+this._generateHeaderText(i[3]+1)+(i[2]+1)),[f,r]},setBorder:function(n,t){var h;if(this.model.allowCellFormatting&&!this.model.isReadOnly){t=this._getRangeArgs(t);t[0]===t[2]&&t[1]===t[3]&&(h=this.XLEdit.getPropertyValue(t[0],t[1],"merge"),h&&(t=h.mRange));var u,f="",e=!1,a=n.style,r=n.type,c=n.color,o,v,l,y,i,p,s=this._getContent(this.getActiveSheetIndex()).find("div:first-child");if(this.model.allowSelection||r!=="drawborder"&&r!=="drawbordergrid"){o=["bottom","top","left","right","outside","allborder"];v=["thickbox","thickbottom","doublebottom","topandbottom","topandthickbottom","topanddoublebottom"];l={top:{top:""},right:{right:""},bottom:{bottom:""},left:{left:""},outside:{top:"",right:"",bottom:"",left:""},thickbox:{top:"2px solid",right:"2px solid",bottom:"2px solid",left:"2px solid"},thickbottom:{bottom:"2px solid"},doublebottom:{bottom:"3px double"},topandbottom:{top:"1px solid",bottom:"1px solid"},topandthickbottom:{top:"1px solid",bottom:"2px solid"},topanddoublebottom:{top:"1px solid",bottom:"3px double"}};y={solid:"1px solid",dashed:"1px dashed",dotted:"1px dotted",double:"3px double"};this.model.allowSelection&&(this.XLSelection._isGridBordering=this.XLSelection._isOutsideBordering=!1);switch(!0){case o.indexOf(r)>-1:e=r===o[5];i=l[e?o[4]:r];for(u in i)i[u]=y[a]+" "+c;e&&(i.isGridBorder=e);i.property=n;this.XLFormat.applyBorder(i,t);break;case v.indexOf(r)>-1:i=l[r];for(u in i)f="",p=i[u].split(" "),f=p.length===2?f+i[u]+" "+c:f+i[u]+" "+a+" "+c,i[u]=f;i.property=n;this.XLFormat.applyBorder(i,t);break;case r==="noborder":this.XLFormat.applyBorder("noborder",t);break;case r==="drawborder":this.XLSelection._isOutsideBordering=!0;s.removeClass("e-ss-cursor");s.addClass("e-ss-drwbrdrcursor");this.XLSelection._cleanUp(!0);break;case r==="drawbordergrid":this.XLSelection._isGridBordering=!0;s.removeClass("e-ss-cursor");s.addClass("e-ss-drwbrdrgridcursor");this.XLSelection._cleanUp(!0)}}}},clearBorder:function(n){this.model.isReadOnly||(n=this._getRangeArgs(n,"object"),this.XLFormat.removeStyle(n,{cellStyle:!0,tableStyle:!0,border:!0}))},clearHyperlinks:function(){this.model.allowClear&&!this.model.isReadOnly&&this._removeHyperlink("clear")},clearComments:function(n){this.model.allowClear&&!this.model.isReadOnly&&this.model.allowComments&&this.XLComment.deleteComment(i,n,!1,"clear")},clearAllFormat:function(i){var s,c;if(this.model.allowClear&&!this.model.isReadOnly&&(s=this.getActiveSheetIndex(),c={range:i,sheetIndex:s,reqType:"clear-format",type:"actionBegin",action:"clearformat"},!this._trigActionBegin(c))){var l,a=this._dataContainer.sheets[s],f=[],e,o,h=this.getSheet(s),r=this._getRangeArgs(c.range,"object"),v,u={sheetIndex:s,reqType:"clear-format",range:r};(u.bData=n.extend(!0,[],this.getRangeData({range:r,property:["format","tformats","type","formatStr","decimalPlaces","thousandSeparator","formats","hyperlink","cFormatRule"]})),this._dupDetails=!0,e=this.getObjectKeys(a),f[0]=r[0]>parseInt(e[0])?r[0]:parseInt(e[0]),f[2]=r[2]<parseInt(e[e.length-1])?r[2]:parseInt(e[e.length-1]),o=this.getObjectKeys(a[f[2]]),f[1]=r[1]>parseInt(o[0])?r[1]:parseInt(o[0]),f[3]=r[3]<parseInt(o[o.length-1])?r[3]:parseInt(o[o.length-1]),t.isNullOrUndefined(e))||(v=this._checkTableRange(this._getAlphaRange(s,f[0],f[1],f[2],f[3])),v.status!=="partial")&&(this.clearRangeData(r,["format","formatStr","decimalPlaces","thousandSeparator","formats","hyperlink","cFormatRule","border"],"",!1,u.reqType),this.clearBorder(i),this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(r),h._clrWrapColl=[],h._clrMergeColl=[],this._isPaste=!0,this.setWrapText("unwrap",r),this._isPaste=!1,this.unmergeCells(r),u.wrapColl=n.extend(!0,[],h._clrWrapColl),u.mergeColl=n.extend(!0,[],h._clrMergeColl),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this._dupDetails=!1,this._isUndoRedo||(this._completeAction(u),l={sheetIndex:u.sheetIndex,reqType:u.reqType,range:u.range,prevData:u.bData,prevMergeColl:u.mergeColl,prevWrapColl:u.wrapColl},this._trigActionComplete(l)))}},clearContents:function(t){var r,u,f,e,i;this.model.isReadOnly||(r=this.getActiveSheetIndex(),u={range:t,sheetIndex:r,reqType:"clear-content",type:"actionBegin",action:"clearContent"},this._trigActionBegin(u))||(t=this._getRangeArgs(u.range,"object"),e=this.getRangeData({range:t,property:["value","value2","type","hyperlink"]}),i={sheetIndex:r,reqType:"clear-content",range:t,bData:n.extend(!0,[],e)},this.model.allowClear&&!this._isPropExists([t],"isReadOnly",r))&&(this.clearRangeData(t,["value","value2","hyperlink"],"",!1,i.reqType),this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t),this._completeAction(i),f={sheetIndex:i.sheetIndex,reqType:i.reqType,range:i.range,prevData:i.bData},this._trigActionComplete(f),this._setSheetFocus(),this.model.allowFormulaBar&&this.updateFormulaBar())},clearAll:function(i){var e,l;if(!this.model.isReadOnly&&(e=this.getActiveSheetIndex(),l={range:i,sheetIndex:e,reqType:"clear-all",type:"actionBegin",action:"clearall"},!this._trigActionBegin(l))){var o,s,v,a,h,c=this.getSheet(e),f=[],u=this._getRangeArgs(l.range,"object"),r={sheetIndex:e,reqType:"clear-all",range:u},y=this._dataContainer.sheets[e];if(this.model.allowClear&&!this._isPropExists([u],"isReadOnly",e)&&(this._dupDetails=!0,o=this.getObjectKeys(y),f[0]=u[0]>parseInt(o[0])?u[0]:parseInt(o[0]),f[2]=u[2]<parseInt(o[o.length-1])?u[2]:parseInt(o[o.length-1]),s=this.getObjectKeys(y[f[2]]),f[1]=u[1]>parseInt(s[0])?u[1]:parseInt(s[0]),f[3]=u[3]<parseInt(s[s.length-1])?u[3]:parseInt(s[s.length-1]),a=this._getAlphaRange(e,f[0],f[1],f[2],f[3]),!t.isNullOrUndefined(o)&&!t.isNullOrUndefined(s))){if(r.bData=n.extend(!0,[],this.getRangeData({range:u,property:["value","value2","hyperlink","merge","rule","cFormatRule","comment","format","formatStr","formats","tformat","decimalPlaces","thousandSeparator","type","borders","tborders"],sheetIdx:e})),r.bBorder=this.XLFormat.getHashCodeClassAsArray(u),h=this._checkTableRange(a),h.status==="full")r.tblObj=h.tableObj,r.tblObj.tblId=h.tblId,r.tblObj.header=!0,this.XLFormat.removeTable(r.tblObj.tblId);else if(h.status==="partial")return;this.clearRangeData(u,["value","value2","hyperlink","cFormatRule","comment","format","formats","formatStr","decimalPlaces","thousandSeparator","border"],"",!1);this.clearBorder(a);this.model.allowFiltering&&this.XLFilter.clearFilter("remove");c._clrMergeColl=[];c._clrWrapColl=[];this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(u);this.model.allowDataValidation&&this.XLValidate.clearDV();this._isPaste=!0;this.setWrapText("unwrap",u);this._isPaste=!1;this.unmergeCells(u);r.mergeColl=n.extend(!0,[],c._clrMergeColl);r.wrapColl=n.extend(!0,[],c._clrWrapColl);this._dupDetails=!1;this.model.showRibbon&&(this.XLRibbon._updateRibbonIcons(),this.XLRibbon._toggleDesignTab(this.getActiveCell()));this._completeAction(r);v={sheetIndex:r.sheetIndex,reqType:r.reqType,range:r.range,prevData:r.bData,prevBorder:r.bBorder,tblObj:r.tblObj,mergeColl:r.mergeColl,wrapColl:r.wrapColl};this._trigActionComplete(v)}}},_checkTableRange:function(n,t){var o,s=this.getActiveSheetIndex(),h=this.model.sheets[s],u,f,i,c=this.getRangeIndices(n),r,e;return t?r=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"tableName"):(e=this.XLEdit._getPropWithCellIdx(c,"tableName"),e.length&&(r=e[0].value)),r?(u=this._getTableID(r),f=h.tableManager[u],i=f.range,o=this._getAlphaRange(s,i[0],i[1],i[2],i[3]),n===o?{status:"full",tableObj:f,tblId:u}:{status:"partial"}):{status:"no-table"}},_checkFilterRange:function(n,t){var u,s=this.getActiveSheetIndex(),h=this.getSheet(s),i,c=this.getRangeIndices(n),f,e,o=h.filterSettings.tableRange,r;if(t?f=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"isFilterHeader"):(e=this.XLEdit._getPropWithCellIdx(c,"isFilterHeader"),e.length&&(f=e[0].value)),f){for(r=0;r<o.length;r++)if(o[r].tableID===-1)return i=o[r],u=this._getAlphaRange(s,i.startRow-1,i.multifilterIdx[0],i.endRow,i.multifilterIdx[i.multifilterIdx.length-1]),n===u?{status:"full",tRange:u,tblId:-1}:{status:"partial"};return{status:"no-table"}}return{status:"no-table"}},clearTextNode:function(n,i){if(!t.isNullOrUndefined(n)&&!this.model.isReadOnly){var r=this.getActiveSheetIndex(),u=n[0].parentNode.rowIndex,f=n[0].cellIndex,o=this._dataContainer.sheets[r],e=n[0].childNodes[n[0].childNodes.length-1];(i=i||"",this._checkIndicesInContainer(r,u,f,"rule")&&o[u][f].rule.type==="list")||t.isNullOrUndefined(e)||e.hasChildNodes("a")||(n[0].lastChild.textContent=i)}},_isClassHasProperty:function(n,t,i){var r=this.XLFormat.getFormatFromHashCode(n);return r[t]&&r[t].toLowerCase()===i?!0:!1},_changeTargetWithOffset:function(t){var r,i=n(t.target),u=t.offsetX||t.pageX-i.offset().left;if(this._hasClass(document.activeElement,"e-datepicker")&&t.type==="mouseup"&&n("#"+this._id).focus(),i.is("a")&&(r=t.target,t.target=t.target.parentNode),i.is("#"+this._id+"_Merge"))return i.parents().closest("td")[0];if(this._hasClass(i.parents().closest("td"),"e-cellreadonly"))return this._hasClass(i,"e-datepicker")&&t.type==="mouseup"&&i.focus(),i.parents().closest("td")[0];if(i.is("td")&&this._hasClass(i,"e-cellreadonly")&&i.find(".e-chk-image").length>0&&t.type==="mouseup")return n("#"+i.find(".e-checkbox")[0].id).ejCheckBox("instance")._checkedHandler(),t.target;if((u>t.target.offsetWidth||u<0)&&i.is("td")&&i.parents(".e-spreadsheetmainpanel").length&&this._hasClass(i,"e-rowcell")){var f=this.getSheet(this.getActiveSheetIndex()),e=this._getCellIdx(t.target),o=f._colWidthCollection[e.colIndex]+u,s=f._rowHeightCollection[e.rowIndex];return r&&this.addClass(r,"e-rmanchor"),this.getCell(this.XLShape._getCellIndexFromOffset(s,o).rowIndex,this.XLShape._getCellIndexFromOffset(s,o).colIndex)[0]}return r?(this._removeClass(r,"e-rmanchor"),r):(this._removeClass(i.find("a")[0],"e-rmanchor"),t.target)},_textClip:function(n,i,r,u,f,e){var c=this.getActiveSheetIndex(),st,s,y,d,o;if(this._canOverflow&&!this.XLEdit.getPropertyValue(n,i,"merge")&&!this.XLEdit.getPropertyValue(n,i,"wrap")){var p,w,b,v,rt,a,ht,ft,ct,l,lt,et,g,ot=!1,tt=!1,k=!1,at=!1,h=this.XLEdit,vt=this.getSheet(c),nt=vt._isLoaded||this.isImport||this.model.isImport,it=this.getCell(n,i),ut=h.getPropertyValue(n,i,"format",c);if(it&&(b=it[0]),this._isClassHasProperty(ut,"text-align","right")&&(k=!0),!(h.getPropertyValue(n,i,"cellType",c)>-1)){if(this._dupDetails||(this._dupDetails=ot=!0),e||(lt=this._dataContainer.sheets[c],e=this.getObjectKeys(lt[n])),r==="add"){if(!this.model.allowOverflow){this.addClass(b,"e-overflow");h._updateDataContainer({rowIndex:n,colIndex:i},{dataObj:{isOverflow:!1},skipCell:!0});ot&&(this._dupDetails=!1);return}if(this._removeClass(b,"e-overflow"),this.clearRangeData([n,i,n,i],["isOverflow"],"","","",!0),h.getPropertyValue(n,i+1,"value2",c)&&!k&&(tt=!0),tt||(ct=vt._ofColWidthColl,et=b?this.XLFormat.getFormatFromHashCode(this.XLFormat.getFormatClass(b.className)):{},u||(g=document.getElementById(this._id+"_emptySpan"),this.addClass(g,"e-rowcell e-wrapword"),this.addClass(g,ut),g.textContent=h.getPropertyValue(n,i,"value2",c),u="text-indent"in et?Math.round(4/3*Number(et[t.Spreadsheet.SupportedStyles.TextIndent].replace("pt",""))+this._detailsFromGlobalSpan(n,i,"width",g.textContent,null,!0)):g.offsetWidth),this._refreshGlobalSpan(g),ht=this.XLShape._getCellIndexFromOffset(null,ct[i]+u,c,!0),w=ht.colIndex-i),!f&&h.getPropertyValue(n,i,"value2",c)&&(l=h.getPropertyValue(n,i,"overflow",c),!t.isNullOrUndefined(l)&&l.rowIndex===n))if(ft=this.getCell(l.rowIndex,l.colIndex),ft&&this.addClass(ft[0],"e-overflow"),h._updateDataContainer({rowIndex:l.rowIndex,colIndex:l.colIndex},{dataObj:{isOverflow:!1},skipCell:!0}),l.colIndex<i)for(y=l.cellCount,o=0;o<=y;o++)d=[],o!==0&&d.push("overflow"),o!==y&&(v=this.getCell(n,l.colIndex+o),nt&&v&&this._removeClass(v[0],"e-ofbrdr"),d.push("isOfBrdr")),this.clearRangeData([n,l.colIndex+o,n,l.colIndex+o],d,"","","",!0);else for(o=l.cellCount;o>0;o--)v=this.getCell(n,l.colIndex-o),nt&&v&&this._removeClass(v[0],"e-ofbrdr"),this.clearRangeData([n,l.colIndex-o,n,l.colIndex-o],["isOfBrdr","overflow"],"","","",!0);if(k||tt){for(y=i-w,o=i-1;o>=y;o--)if(a=h.getPropertyValue(n,o,"overflow",c),a&&a.colIndex!==i&&!at&&(at=!0,this._textClip(a.rowIndex,a.colIndex,"delete","",!0),it=this.getCell(a.rowIndex,a.colIndex),it&&this.addClass(it[0],"e-overflow")),h.getPropertyValue(n,o,"value2",c)){tt=!0;break}}else for(o=1;o<=w;o++)if(h.getPropertyValue(n,i+o,"value2",c)||h.getPropertyValue(n,i+o,"merge",c)||h.getPropertyValue(n,i+o,"isMHide",c)||h.getPropertyValue(n,i+o,"overflow",c)&&h.getPropertyValue(n,i+o,"overflow",c).colIndex!==i){tt=!0;break}if(tt)this.addClass(b,"e-overflow"),h._updateDataContainer({rowIndex:n,colIndex:i},{dataObj:{isOverflow:!1},skipCell:!0});else if(w!==0)for(o=0;o<=w;o++)rt=k?i-o:i+o,o&&h._updateDataContainer({rowIndex:n,colIndex:rt},{dataObj:{overflow:{rowIndex:n,colIndex:i,cellCount:w}},skipCell:!0}),((!k||k&&o!==0)&&o!==w||o===w&&k)&&(nt&&this._isRowViewable(c,n)&&this.addClass(this.getCell(n,rt)[0],"e-ofbrdr"),h._updateDataContainer({rowIndex:n,colIndex:rt},{dataObj:{isOfBrdr:!0},skipCell:!0}))}else if(r==="delete"){if(this._hasClass(b,"e-overflow"))this._removeClass(b,"e-overflow"),this.clearRangeData([n,i,n,i],["isOverflow"],"","","",!0);else if(k){if(a=h.getPropertyValue(n,i-1,"overflow",c),!t.isNullOrUndefined(a)&&a.colIndex===i)for(y=i-a.cellCount,s=i-1;s>=y;s--)nt&&(v=this.getCell(n,s),v&&this._removeClass(v[0],"e-ofbrdr")),this.clearRangeData([n,s,n,s],["isOfBrdr","overflow"],"","","",!0)}else if(a=h.getPropertyValue(n,i+1,"overflow",c),!t.isNullOrUndefined(a)&&a.colIndex===i)for(y=i+1+a.cellCount,s=i;s<y;s++)d=[],s!==i&&d.push("overflow"),s!==y&&(nt&&(v=this.getCell(n,s),v&&this._removeClass(v[0],"e-ofbrdr")),d.push("isOfBrdr")),this.clearRangeData([n,s,n,s],d,"","","",!0);if(!f&&this.model.allowOverflow){for(s=e.indexOf(i.toString())-1;s>-1;s--)if(nt&&(p=this.getCell(n,e[s])),h.getPropertyValue(n,e[s],"value2",c)||h.getPropertyValue(n,e[s],"isMHide",c)){this._hasClass(p,"e-overflow")&&(p&&this._removeClass(p[0],"e-overflow"),this.clearRangeData([n,e[s],n,e[s]],["isOverflow"],"","","",!0),this._textClip(n,parseInt(e[s]),"add",null,null,e));break}for(st=e.length,s=e.indexOf(i.toString())+1;s<st;s++)if(nt&&(p=this.getCell(n,e[s])),h.getPropertyValue(n,e[s],"value2",c)||h.getPropertyValue(n,e[s],"isMHide",c)){ut=h.getPropertyValue(n,e[s],"format",c);this._hasClass(p,"e-overflow")&&this._isClassHasProperty(ut,"text-align","right")&&(p&&this._removeClass(p[0],"e-overflow"),this.clearRangeData([n,e[s],n,e[s]],["isOverflow"],"","","",!0),this._textClip(n,parseInt(e[s]),"add",null,null,e));break}}}ot&&(this._dupDetails=!1)}}},selectAll:function(n){if(this.model.allowSelection){var d,y=[],w=[],k=[],b=[],r,i,h,g=!1,p=0,v=this.XLEdit,nt=this.getActiveCell(),e=nt.rowIndex,o=nt.colIndex,c=this.getActiveSheetIndex(),rt=this._dataContainer.sheets[c],ut=this.getObjectKeys(rt),l=this.getSheet(c),tt=this._getUsedRangeFromSheet(c,!1),it=tt.rowCount+tt.colCount;if(l._startCell.rowIndex!==l._endCell.rowIndex||l._startCell.colIndex!==l._endCell.colIndex&&l._isMultiSelect){var f={rowIndex:l._startCell.rowIndex,colIndex:l._startCell.colIndex},u={rowIndex:l._endCell.rowIndex,colIndex:l._endCell.colIndex},a={rowIndex:l._startCell.rowIndex,colIndex:l._startCell.colIndex},s={rowIndex:l._endCell.rowIndex,colIndex:l._endCell.colIndex};for(g=!0,r=1;r<it;r++){for(i=a.colIndex;i<s.colIndex+2;i++)(v.getPropertyValue(a.rowIndex-1,i,"value2",c)||this._getDataObj(a.rowIndex-1,i,"mergeIdx",c))&&(f.colIndex=a.colIndex<i?a.colIndex:i,u.colIndex=s.colIndex>i?s.colIndex:i,f.rowIndex=a.rowIndex<a.rowIndex-1?a.rowIndex:a.rowIndex-1);for(i=a.rowIndex;i<s.rowIndex+2;i++)(v.getPropertyValue(i,s.colIndex+1,"value2",c)||this._getDataObj(i,s.colIndex+1,"mergeIdx",c))&&(u.rowIndex=s.rowIndex>i?s.rowIndex:i);for(i=s.colIndex;i>a.colIndex-2;i--)(v.getPropertyValue(s.rowIndex+1,i,"value2",c)||this._getDataObj(s.rowIndex+1,i,"mergeIdx",c))&&(u.rowIndex=s.rowIndex>s.rowIndex+1?s.rowIndex:s.rowIndex+1,f.colIndex=a.colIndex<i?a.colIndex:i);for(i=s.rowIndex;i>a.rowIndex-2;i--)(v.getPropertyValue(s.rowIndex+1,i,"value2",c)||this._getDataObj(s.rowIndex+1,i,"mergeIdx",c))&&(u.rowIndex=s.rowIndex>s.rowIndex+1?s.rowIndex:s.rowIndex+1,f.colIndex=a.colIndex<i?a.colIndex:i);if(u.colIndex===s.colIndex&&u.rowIndex===s.rowIndex&&f.rowIndex===a.rowIndex&&f.colIndex===a.colIndex)if(r===1){l._isRangeSelected=!0;break}else{l._isRangeSelected=!1;break}a={rowIndex:f.rowIndex,colIndex:f.colIndex};s={rowIndex:u.rowIndex,colIndex:u.colIndex}}}if(!l._isRangeSelected&&!g){for(f={rowIndex:e,colIndex:o},u={rowIndex:e,colIndex:o},a={rowIndex:e,colIndex:o},s={rowIndex:e,colIndex:o},r=1;r<it+1;r++){for(i=-p;i<p+1;i++)(v.getPropertyValue(e+i,o+r,"value2",c)||this._getDataObj(e+i,o+r,"mergeIdx",c))&&(u.rowIndex=u.rowIndex>e+i?u.rowIndex:e+i,u.colIndex=u.colIndex>o+r?u.colIndex:o+r);for((v.getPropertyValue(e+r,o+r,"value2",c)||this._getDataObj(e+r,o+r,"mergeIdx",c))&&(u.rowIndex=u.rowIndex>e+r?u.rowIndex:e+r,u.colIndex=u.colIndex>o+r?u.colIndex:o+r),i=-p;i<p+1;i++)(v.getPropertyValue(e+r,o+i,"value2",c)||this._getDataObj(e+r,o+i,"mergeIdx",c))&&(u.rowIndex=u.rowIndex>e+r?u.rowIndex:e+r,u.colIndex=u.colIndex>o+i?u.colIndex:o+i);if(!v.getPropertyValue(e,o,"value2",c)&&u.colIndex===s.colIndex&&u.rowIndex===s.rowIndex&&f.rowIndex===a.rowIndex&&f.colIndex===a.colIndex&&p===0){l._isRangeSelected=!0;break}for((v.getPropertyValue(e+r,o-r,"value2",c)||this._getDataObj(e+r,o-r,"mergeIdx",c))&&(u.rowIndex=u.rowIndex>e+r?u.rowIndex:e+r,f.colIndex=f.colIndex<o-r?f.colIndex:o-r),i=-p;i<p+1;i++)(v.getPropertyValue(e+i,o-r,"value2",c)||this._getDataObj(e+i,o-r,"mergeIdx",c))&&(f.rowIndex=f.rowIndex<e+i?f.rowIndex:e+i,f.colIndex=f.colIndex<o-r?f.colIndex:o-r,u.rowIndex=u.rowIndex>e+i?u.rowIndex:e+i);for((v.getPropertyValue(e-r,o-r,"value2",c)||this._getDataObj(e-r,o-r,"mergeIdx",c))&&(f.rowIndex=f.rowIndex<e-r?f.rowIndex:e-r,f.colIndex=f.colIndex<o-r?f.colIndex:o-r),i=-p;i<p+1;i++)(v.getPropertyValue(e-r,o+i,"value2",c)||this._getDataObj(e-r,o+i,"mergeIdx",c))&&(f.rowIndex=f.rowIndex<e-r?f.rowIndex:e-r,f.colIndex=f.colIndex<o+i?f.colIndex:o+i,u.colIndex=u.colIndex>o+i?u.colIndex:o+i);if((v.getPropertyValue(e-r,o+r,"value2",c)||this._getDataObj(e-r,o+r,"mergeIdx",c))&&(f.rowIndex=f.rowIndex<e-r?f.rowIndex:e-r,u.colIndex=u.colIndex>o+r?u.colIdx:o+r),u.colIndex===s.colIndex&&u.rowIndex===s.rowIndex&&f.rowIndex===a.rowIndex&&f.colIndex===a.colIndex)if(p!==0){l._isRangeSelected=!1;break}else{l._isRangeSelected=!0;break}a={rowIndex:f.rowIndex,colIndex:f.colIndex};s={rowIndex:u.rowIndex,colIndex:u.colIndex};p++;y.push(u.colIndex);w.push(f.rowIndex);k.push(u.rowIndex);b.push(f.colIndex)}for(b=t.dataUtil.mergeSort(t.distinct(b)),f.colIndex=b[b.length-1],h=b.length-1;h>-1;h--)if(b[h-1]===b[h]-1)f.colIndex=b[h-1];else break;for(k=t.dataUtil.mergeSort(t.distinct(k)),u.rowIndex=k[0],h=0,d=k.length-1;h<d;h++)if(k[h+1]===k[h]+1)u.rowIndex=k[h+1];else break;for(w=t.dataUtil.mergeSort(t.distinct(w)),f.rowIndex=w[w.length-1],h=w.length-1;h>-1;h--)if(w[h-1]===w[h]-1)f.rowIndex=w[h-1];else break;for(y=t.dataUtil.mergeSort(t.distinct(y)),u.colIndex=y[0],h=0,d=y.length-1;h<d;h++)if(y[h+1]===y[h]+1)u.colIndex=y[h+1];else break;for(h=0,d=y.length-1;h<d;h++)if(y[h+1]===y[h]+1)u.colIndex=y[h+1];else break}l._isEmptyActiveCell||(!l._isRangeSelected&&!ut.length<1?(this.XLSelection.selectRange(f,u,c,n),l._isMultiSelect=!1,l._startCell=f,l._endCell=u,l._isRangeSelected=!0,l._isEmptyActiveCell=v.getPropertyValue(e,o,"value2",c)?!1:!0):(this.XLSelection.selectSheet(),l._isRangeSelected=!0))}},multiSelection:function(n){for(var i,r,u=n.split(","),f=this._getJSSheetContent(this.getActiveSheetIndex()),t=0;t<u.length;t++)if(f.find("td[class *='activecell']")&&t>0){for(f.find("td[class *='activecell']").removeClass("e-activecell"),f.find("td[class *='focus']").removeClass("e-focustop e-focusleft"),n=this._getRangeArgs(u[t].trim()),i=n[0];i<=n[2];i++)for(r=n[1];r<=n[3];r++)this.getRange([i,r,i,r]).addClass("e-selected");this.getCell(n[0],n[1]).addClass("e-activecell");this.XLSelection._focusRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[0],colIndex:n[1]},this._selectionBorder);this.model.allowAutoFill&&this.XLDragFill.hideAutoFillElement()}else this.XLSelection.selectRange(u[t])},_getDataObj:function(n,t,i,r){var u=this._dataContainer.sheets[r?r:this.getActiveSheetIndex()];return u[n]&&u[n][t]?u[n][t][i]:!1},_getUsedRangeFromSheet:function(n,t){n=this._getSheetIndex(n);for(var r,o=this.getSheet(n),c=this._dataContainer,h=c.sheets[n],e=this.getObjectKeys(h),u={rowIndex:parseInt(e[0])||0,colIndex:0},i={rowIndex:parseInt(e[e.length-1])||0,colIndex:0},s=e.length,f=0;f<s;f++)r=this.getObjectKeys(h[parseInt(e[f])]),f===0?(u.colIndex=parseInt(r[0]),i.colIndex=parseInt(r[r.length-1])):(u.colIndex=u.colIndex<parseInt(r[0])?u.colIndex:parseInt(r[0]),i.colIndex=i.colIndex>parseInt(r[r.length-1])?i.colIndex:parseInt(r[r.length-1]));return i.rowIndex<o.usedRange.rowIndex&&(i.rowIndex=o.usedRange.rowIndex),i.colIndex<o.usedRange.colIndex&&(i.colIndex=o.usedRange.colIndex),t?this._getAlphaRange(n,u.rowIndex,u.colIndex,i.rowIndex,i.colIndex):{startCell:u,endCell:i,rowCount:i.rowIndex-u.rowIndex+1,colCount:i.colIndex-u.colIndex+1}},sheetRename:function(n){this.model.isReadOnly||this._updateSheetNames(n)},_isSubMenuOpen:function(){for(var i=["_formatastable","_cellstyles","_Ribbon_CElement","_contextMenuCell","_contextMenuColumnHeader","_contextMenuRowHeader","_contextMenuFooter"],t=0,r=i.length;t<r;){if(n("#"+this._id+i[t]).is(":visible"))return!0;t++}return!1},copySheet:function(n,i,r){if(!this.model.isReadOnly&&!this.model.isGridMode){var y=this._getSheetIndex(y),u,f,a,e,v=!1,c=2,h,s=this.model.sheets,o=this.element.find(".e-numericcontainer").children().eq(n-1),l=i;if(!r&&s[l].sheetInfo.text===o.text()){this._setSheetFocus();return}for(f=1,a=s.length;f<a;f++)s.length-1!==l&&s[l].sheetInfo.text===s[f].sheetInfo.text&&(u=f),o.text()===s[f].sheetInfo.text&&(h=f);if(r){for(o.text().match(".*[ ]+[(]+[0-9]+[)]$")===null?e=o.text()+" ("+c+")":o.text().lastIndexOf(" ")>-1&&(c=parseInt(o.text().substring(o.text().lastIndexOf("(")+1,o.text().lastIndexOf(")"))),e=o.text().substring(0,o.text().lastIndexOf(" "))+" ("+c+")");!v;){for(e=e.substring(0,e.lastIndexOf(" "))+" ("+c+")",f=1,a=s.length;f<a;f++)e===s[f].sheetInfo.text&&c++;c===parseInt(e.substring(e.lastIndexOf("(")+1,e.lastIndexOf(")")))&&(v=!0)}this._copySheetProcess(h,e);h=this.model.sheetCount;t.isNullOrUndefined(u)&&(u=h)}else!t.isNullOrUndefined(u)&&u>h&&(u=u-1);t.isNullOrUndefined(u)&&(u=l);r||u!==h?(this._swapSheetDtCntr(h,u),this.getPager().ejPager("option",{currentPage:l}),this.gotoPage(l,!1),this._setSheetFocus()):this._setSheetFocus()}},getHyperlink:function(n){return this.XLEdit.getPropertyValueByElem(n,"hyperlink",this.getActiveSheetIndex())},getComment:function(n){return this.XLEdit.getPropertyValueByElem(n,"comment",this.getActiveSheetIndex())},saveAsJSON:function(){var ot,i,y,p,ft,st,g,ht;if(!this.model.isReadOnly){var b,k,l,d,nt,e=1,r,f,o,tt,s,c,v,u,it,rt=[],w,ut,t,a,ct=["_activeCell","_endCell","_startCell","colCount","rowHeight","columnWidth","columnsWidthCollection","rowsHeightCollection","rowCount","frozenColumns","frozenRows","styleIndex","usedRange","sheetName","dataAttribute","filterSettings","tableManager","sheetInfo","hideColsCollection","hideRowsCollection","mergedCells","showGridlines","showHeadings","isSheetProtected","shapeMngr","pivotMngr","chart","rangeSettings","cellTypes","startCell","primaryKey","showHeader","fieldAsColumnHeader","headerStyles","rows","paneTopLeftCell"],lt=["type","value","value2","decimalPlaces","format","formats","borders","formatStr","comment","hyperlink","rule","cFormatRule","wrap","merge","picture","chart","pivot","thousandSeparator","isLocked","align","isRHide"],et,h;this._isSaveAsJSON=!0;this._isExport=!0;this.model.exportSettings.allowExporting&&this.XLExport._renderAll();this._isExport=!1;b={dataContainer:n.extend(!0,{},this._dataContainer),model:n.extend(!0,{},this.model)};f=b.dataContainer;o=b.model;tt=f.hashCode.length;w=f.sheetCellType;f.sheetCellType={};for(t in f.hashCode)u=f.hashCode[t],u.indexOf("e-border")>-1&&u.length<25&&rt.push(u);for(t=0;t<rt.length;t++)f.hashCode.splice(f.hashCode.indexOf(rt[t]),1);t="sheets";for(s in f[t])for(c in f[t][s]){for(v in f[t][s][c]){for(u in f[t][s][c][v])["format","formats","borders"].indexOf(u)>-1&&(ot=this._dataContainer.hashCode[this._dataContainer[t][s][c][v][u]],f[t][s][c][v][u]=f.hashCode.indexOf(ot)),lt.indexOf(u)<0&&delete f[t][s][c][v][u];this.getObjectLength(f[t][s][c][v])||delete f[t][s][c][v]}this.getObjectLength(f[t][s][c])||delete f[t][s][c]}for(t in o)o[t]===this.defaults[t]||Object.prototype.toString.call(o[t])===Object.prototype.toString()?delete o[t]:Array.isArray(o[t])&&(o[t].length||delete o[t]);for(l=o.sheets;e<l.length;){r=l[e];for(t in r){switch(t){case"frozenColumns":case"frozenRows":r[t]===0&&delete r[t];break;case"fieldAsColumnHeader":case"isSheetProtected":r[t]||delete r[t];break;case"showHeadings":case"showGridlines":case"showHeader":r[t]&&delete r[t];break;case"filterSettings":for(u in r[t])u==="range"?this._isEmptyString(r[t][u])&&delete r[t][u]:delete r[t][u];break;case"sheetInfo":for(u in r[t])if(u!=="text"){if(u==="isVisible"&&!r[t][u])continue;delete r[t][u]}break;case"_startCell":case"_endCell":case"_activeCell":case"usedRange":for(u in r[t])r[t][u]===0&&delete r[t][u];break;case"columnWidth":r[t]===64&&delete r[t];break;case"rowHeight":r[t]===20&&delete r[t];break;case"primaryKey":r[t].length||delete r[t];break;case"startCell":r[t]==="A1"&&delete r[t]}ct.indexOf(t)<0||r[t]===null?delete r[t]:Object.prototype.toString.call(r[t])===Object.prototype.toString()?this.getObjectLength(r[t])||delete r[t]:Array.isArray(r[t])&&(r[t].length||delete r[t])}if(k=l[e].shapeMngr.chart,it={},this.getObjectLength(k)){a=0;for(t in k){if(i=n.extend(!0,{},k[t]),y={commonSeriesOptions:{type:i.type,marker:i.marker},enable3D:i.enable3D,top:i.top,left:i.left,size:{width:i.width,height:i.height},title:i.title,legend:i.legend,primaryXAxis:i.primaryXAxis,primaryYAxis:i.primaryYAxis,dataSheetIdx:i.dataSheetIdx,animation:i.animation,isRowColSwitched:i.isRowColSwitched,colIndex:i.colIndex,rowIndex:i.rowIndex,theme:i.theme},i.range&&(y.range=this._getAlphaRange(e,i.range[0],i.range[1],i.range[2],i.range[3])),i.series)for(y.series=[],h=0,et=i.series.length;h<et;h++){for(ft=[],p=0,st=i.series[h].points.length;p<st;p++)ft.push({x:i.series[h].points[p].x,y:i.series[h].points[p].y,size:i.series[h].points[p].size});y.series.push({name:i.series[h].name,points:ft})}i.seriesRange&&(y.seriesRange=i.seriesRange);i.colIndex&&i.rowIndex?f.sheets[e][i.rowIndex][i.colIndex].chart=[]:f.sheets[e][i.activeCell.rowIndex][i.activeCell.colIndex].chart=[];it["chart"+a]=y;a++}l[e].shapeMngr.chart=it}if(d=l[e].tableManager,nt={},this.getObjectLength(d)){a=0;for(t in d){for(g=n.extend(!0,{},d[t]),delete g.format,h=0,ht=o.nameManager.length;h<ht;h++)o.nameManager[h].name===g.name&&o.nameManager.splice(parseInt(h),1);nt[a]=g;a++}l[e].tableManager=nt}r.cellTypes=[];tt=this.getObjectLength(w);tt&&(f.sheetCellType[e]={});a=1;for(t in w)(u=w[t],this.getObjectLength(u))&&(ut=u.id.split("_")[2],s=parseInt(ut.match(/[0-9]+/)[0]),e===s&&(delete u.id,u.range=ut.replace(/[0-9]+/,""),f.sheetCellType[e][a]={settings:u},w[t]={},a++));l[e]._scrollTop=this.getSheet(e)._scrollTop;l[e]._scrollLeft=this.getSheet(e)._scrollLeft;e++}return o.isManualCalculation=this._calcEngine.getCalculatingSuspended(),this._isSaveAsJSON=!1,o.sheets.shift(),b}},_isvalidRange:function(n){var t=new RegExp(/^\$?(?:\b[a-z]{1,3})\$?(?:\d{1,7}):\$?(?:\b[a-z]{1,3})\$?(?:\d{1,7})$/i);return t.test(n)},_renderFUpload:function(){this.element.append(t.buildTag("div","",{height:"0px"},{id:this._id+"_file"}));n("#"+this._id+"_file").ejUploadbox({width:"0px",height:"0px",uploadName:"file",autoUpload:!0,showFileDetails:!1,dialogAction:{content:this.element},saveUrl:this.model.importSettings.importMapper,fileSelect:n.proxy(this._fileSelect,this),complete:n.proxy(this._changeImport,this),error:n.proxy(this._importFailed,this)});n("#"+this._id+"_file_SelectButton").hide()},_fileSelect:function(t){if(t.files.length){var r,u=t.files[0],i=u.extension;if(this._uploadImage&&(i===".xlsx"||i===".csv")||!this._uploadImage&&((this._browserDetails.name==="msie"&&parseInt(this._browserDetails.version)<10)?i.indexOf("jpg")>-1||i.indexOf("png")>-1||i.indexOf("jpeg")>-1||i.indexOf("gif")>-1:u.rawFile.type.indexOf("image")>-1))return this._showAlertDlg("Alert","CorrectFormat","",290),this._uploadImage=!1,!1;this._browserDetails.name==="msie"&&parseInt(this._browserDetails.version)<=11||this._uploadImage?this.showWaitingPopUp():(r=n("#"+this._id+"_file"),r.ejUploadbox("option","autoUpload",!1),this["import"]({file:u.rawFile,password:this.model.importSettings.password,allowSheetOnDemand:this.model.importSettings.allowSheetOnDemand}),r.find(".e-uploadinput").val(""),t.cancel=!0);this._uploadImage=!1}},_changeImport:function(t){var r,i=n("#"+this._id+"_file").data("ejUploadbox");((this._browserDetails.name==="msie"&&parseInt(this._browserDetails.version)<10)?t.files[0].extension.indexOf("jpg")>-1||t.files[0].extension.indexOf("png")>-1||t.files[0].extension.indexOf("jpeg")>-1||t.files[0].extension.indexOf("gif")>-1:t.files.rawFile.type.indexOf("image")>-1)?(i.updialog.ejDialog("close"),this.XLShape._insertPicture(t),this.model.showRibbon&&this.XLRibbon._formatTabUpdate(),i.option("autoUpload",!0)):(r=this._browserDetails.name==="msie"&&parseInt(this._browserDetails.version)<10?t.responseText:t.xhr.response,i.updialog.ejDialog("close"),this._importSuccess(r));this.hideWaitingPopUp()},_dlgBeforeOpen:function(){this.hideWaitingPopUp();n("#"+this._id+"_workBookName").text("'"+n("#"+this._id+"_file").data("ejUploadbox")._files[0].name+"'"+this._getLocStr("Protect"))},_dlgOk:function(){var t,i=n("#"+this._id+"_PasswordDialog").data("ejDialog"),r=n("#"+this._id+"_xlpassword"),u=n("#"+this._id+"_confirmpassword");t=n("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").data("ejToggleButton");i.model.title==="Protect Workbook"?r.val().length&&u.val().length?r.val()===u.val()?(this.model.exportSettings.password=r.val(),n("#"+this._id+"_AddSheet").addClass("e-disable"),n("#"+this._id+"_confirm").hide(),i.option("title",this._getLocStr("UnProtectWorkbook"))):(n("#"+this._id+"_confirm").show(),this._showAlertDlg("Alert","PasswordAlert1"),t&&t.option("toggleState",!1),i.option("title",this._getLocStr("ProtectWorkbook"))):(n("#"+this._id+"_confirm").show(),t&&t.option("toggleState",!1),i.option("title",this._getLocStr("ProtectWorkbook")),this._showAlertDlg("Alert","PasswordAlert2")):i.model.title==="Unprotect Workbook"&&(this.model.exportSettings.password===r.val()?(n("#"+this._id+"_AddSheet").removeClass("e-disable"),this.model.exportSettings.password=null,n("#"+this._id+"_confirm").show(),i.option("title",this._getLocStr("ProtectWorkbook"))):(i.option("title",this._getLocStr("UnProtectWorkbook")),t&&t.option("toggleState",!0),this._showAlertDlg("Alert","PasswordAlert3")));r.val("");u.val("");n("#"+this._id+"_PasswordDialog").ejDialog("close")},_passwordDlg:function(){var n,f,i,r,u,e;n=t.buildTag("div","","",{id:this._id+"_PasswordDialog"});u=t.buildTag("div.e-dlg-btnfields");e=t.buildTag("div.e-dlg-btnctnr");f="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields'><td><label>"+this._getLocStr("Password")+":<\/label><\/td><td><input id ='"+this._id+"_xlpassword' type ='password' class = 'ejinputtext'/><\/td><\/tr><tr class= 'e-dlgtd-fields' id ='"+this._id+"_confirm'><td><label>"+this._getLocStr("ConfirmPassword")+"<\/label><\/td><td><input id ='"+this._id+"_confirmpassword' type ='password'  class = 'ejinputtext'/><\/td><\/tr><\/table><\/div>";n.append(f);i=t.buildTag("input","","",{type:"submit"});r=t.buildTag("input");i.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgOk,this),enabled:!0,cssClass:"e-ss-okbtn"});r.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,this),showRoundedCorner:!0,width:60});u.append(e.append(i,r));n.append(u);n.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("ProtectWorkbook"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg e-ss-pwddlg",close:t.proxy(this._dlgCancel,this)})},_importPasswordDlg:function(){var i,e,r,u,f,o;return i=t.buildTag("div","","",{id:this._id+"_ImportPasswordDialog"}),f=t.buildTag("div.e-dlg-btnfields"),o=t.buildTag("div.e-dlg-btnctnr"),e="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields'><td><label id ='"+this._id+"_workBookName' ><\/label><\/td><\/tr><tr class= 'e-dlgtd-fields'><td><label>"+this._getLocStr("Password")+":<\/label><\/td><td><input id ='"+this._id+"_importpassword' type ='password'  class = 'ejinputtext'/><\/td><\/tr><\/table><\/div>",i.append(e),r=t.buildTag("input","","",{type:"submit"}),u=t.buildTag("input"),r.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._importDlgOk,this),enabled:!0}),u.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,this),showRoundedCorner:!0,width:60}),f.append(o.append(r,u)),i.append(f),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("Password"),beforeOpen:n.proxy(this._dlgBeforeOpen,this),width:420,height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg",close:t.proxy(this._dlgCancel,this)}),i},_dlgCancel:function(){this._showDialog(this._id+"_Ribbon_Review_Changes_ProtectWorkbook");var t=n("#"+this._id+"_PasswordDialog").data("ejDialog");t.model.title==="Protect Workbook"?n("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").ejToggleButton("option","toggleState",!1):t.model.title==="Unprotect Workbook"&&n("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").ejToggleButton("option","toggleState",!0);n("#"+this._id+"_confirmpassword").val("");n("#"+this._id+"_xlpassword").val("");n("#"+this._id+"_importpassword").val("");n("#"+this._id+"_PasswordDialog").ejDialog("close");n("#"+this._id+"_ImportPasswordDialog").ejDialog("close")},_importDlgOk:function(){var t={},i=n("#"+this._id+"_importpassword");this.model.importSettings.password=i.val();i.val("");n("#"+this._id+"_ImportPasswordDialog").ejDialog("close");t.file=n("#"+this._id+"_file").data("ejUploadbox")._files[0].rawFile;t.password=this.model.importSettings.password;t.allowSheetOnDemand=this.model.importSettings.allowSheetOnDemand;this["import"](t)},lockCells:function(n,t){if(!this.model.isReadOnly){var r,i,u=this.getActiveSheetIndex(),f=this.getSheet(u);if(i=t!=!1,this.model.allowLockCell&&!f.isSheetProtected){if(n=this._getRangeArgs(n,"object",u),r={sheetIdx:u,reqType:"lockCells",range:n,isLock:i,type:"actionBegin",action:"lock-cells"},this._trigActionBegin(r))return;if(n=r.range,i=r.isLock,this._isDefaultLocked&&(i=!i),i?this.updateUniqueData({isLocked:!0},n):this.clearRangeData(n,["isLocked"]),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),r={sheetIdx:u,reqType:"lockCells",range:n,isLocked:i,type:"actionComplete",action:"lock-cells"},this._trigActionComplete(r))return}}},protectSheet:function(t){if(!this.model.isReadOnly&&!this.model.isGridMode){var i,r,f,u=this.getActiveSheetIndex(),o=this.getSheet(u),e=this.XLRibbon;if(r=t!==!1,this.XLEdit._isEdit&&this.XLEdit.saveCell(),this.model.allowLockCell){if(i={reqType:"protectSheet",isProtect:t,sheetIdx:u,type:"actionBegin",action:"protect-sheet"},this._trigActionBegin(i))return;if(r=i.isProtect,o.isSheetProtected=r,this.model.showRibbon&&(f=n("#"+this._id+"_Ribbon_Review_Changes_LockCell").data("ejToggleButton"),f&&f.option("enabled",!r),r?e._disableRibbonIcons():e._enableRibbonIcons(),e._updateRibbonIcons()),o._showLockCellAlert=!0,this.model.allowFormulaBar&&this.updateFormulaBar(),this.model.allowUndoRedo&&(this.model.sheetCount>1?this._removeUndoRedoForCurSheet(u,"undo"):(this._undoCollection=[],this._redoCollection=[])),i={reqType:"protectSheet",isSheetProtected:t,sheetIdx:u,type:"actionComplete",action:"protect-sheet"},!this._isSheetNavigate&&this._trigActionComplete(i))return}}},_readOnly:function(){var i=this.XLRibbon,n=this.element.find("#"+this._id+"_Ribbon_BackStage"),t=this.element.find("#"+this._id+"_inputbox");this.model.isReadOnly?(i._disableRibbonIcons(),i.enableRibbonItems(["Spreadsheet_Ribbon_Home_Clipboard_Copy","Spreadsheet_Ribbon_Review_Comments_ShowAllComments","Spreadsheet_Ribbon_Others_Editing_FindSelect"]),this.XLCMenu&&this.XLCMenu._disableMenuOpt(["Replace","GoTo","GoToSpecial","Formulas","Comments","CFormat","Constants","DataValidation"],"Ribbon_FindRep"),n.length&&(n.find("#saveas_backStageTab").hide(),n.find("#print_backStageTab").hide()),this.addClass(this.element.find("#"+this._id+"_AddSheet")[0],"e-disable"),t.length&&(t[0].disabled=!0)):(i._enableRibbonIcons(),this.XLCMenu&&this.XLCMenu._enableMenuOpt(["Replace","GoTo","GoToSpecial","Formulas","Comments","CFormat","Constants","DataValidation"],"Ribbon_FindRep"),n.length&&(n.find("#saveas_backStageTab").show(),n.find("#print_backStageTab").show()),this._removeClass(this.element.find("#"+this._id+"_AddSheet")[0],"e-disable"),t.length&&(t[0].disabled=!1))},_isPropExists:function(n,t,i,r){for(var u,f,h,e,c,s=0,o=!1;s<n.length;){for(u=this.swapRange(n[s]),f=u[0],h=u[2];f<=h;){for(e=u[1],c=u[3];e<=c;){if(this.XLEdit.getPropertyValue(f,e,t,i)){r||(t==="isLocked"?this._popUplockCellAlert():t==="isReadOnly"&&this._showAlertDlg("Alert","ReadOnly","",400));o=!0;break}e++}if(o)break;f++}if(o)break;s++}return o},_isCellProtected:function(n,t,i){return this.model.allowLockCell&&this.getSheet(this.getActiveSheetIndex()).isSheetProtected&&this.XLEdit.getPropertyValue(n,t,"isLocked")?(i&&this._popUplockCellAlert(),!0):this.XLEdit.getPropertyValue(n,t,"isReadOnly")?(this._showAlertDlg("Alert","ReadOnly","",400),!0):void 0},_popUplockCellAlert:function(){this.getSheet(this.getActiveSheetIndex())._showLockCellAlert&&this._showAlertDlg("Alert","LockAlert","",500)},_removeUndoRedoForCurSheet:function(n,t){var r=t==="undo"?this._undoCollection:this._redoCollection,i=r.length;if(i)while(i--)n===r[i].sheetIndex&&r.splice(i,1);t==="undo"&&this._removeUndoRedoForCurSheet(n,"redo")},_detailsFromGlobalSpan:function(i,r,u,f,e,o){var s,h,c="e-rowcell e-wrapword ",l=this.getRangeData({range:[i,r,i,r],property:["format","border","wrap"]})[0],v=l.format,y=l.border,p=l.wrap,a;return a=!t.isNullOrUndefined(e),f=f||"K",s=a?n("#"+this._id+"_emptyDiv"):n("#"+this._id+"_emptySpan"),e&&(s[0].style.width=e-4+"px"),t.isNullOrUndefined(v)||(c+=v+" "),t.isNullOrUndefined(y)?s[0].className.indexOf("e-rowcell")>-1&&(s[0].style.borderRight=0):c+=y+" ",t.isNullOrUndefined(p)||(c+="e-sswraptext"),this.addClass(s[0],c),s[0].className.indexOf("e-rowcell")>-1&&(s[0].style.padding=0),s.text(f),u==="height"?(h=this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0"?Math.ceil(s.outerHeight()):s[0].getBoundingClientRect().height,!o&&this.model.rowHeight>h&&(h=this.model.rowHeight)):(h=this._browserDetails.name==="msie"&&this._browserDetails.version==="8.0"?Math.ceil(s.outerWidth()):s[0].getBoundingClientRect().width,!o&&this.model.columnWidth>h&&(h=this.model.columnWidth)),this._refreshGlobalSpan(null,a),h},_writeRule:function(n,t){var i,r;t=this.getSheetElement(t).index()+1;r="#"+this._id+" .e-sheet:nth-child("+t+") .e-content td.e-rowcell:nth-of-type("+(n+1)+")";i=document.getElementById(this._id+"_sshide");i.sheet.insertRule(r+"{display: none}",i.sheet.cssRules.length)},_deleteRule:function(n,t){var r,u,i,s;t=this.getSheetElement(t).index()+1;r=document.getElementById(this._id+"_sshide");var f=r.sheet.cssRules,e=" .e-sheet:nth-child("+t+") ",o=".e-rowcell:nth-of-type("+(n+1)+")";for(this._browserDetails.name==="msie"&&(e=" :nth-child("+t+").e-sheet ",o=":nth-of-type("+(n+1)+").e-rowcell"),u="#"+this._id+e+".e-content td"+o,i=0,s=f.length;i<s;i++)if(f[i].selectorText===u){r.sheet.deleteRule(i);break}},_refreshRowHeight:function(n,t){var i=this.XLEdit.getPropertyValue(t,0,"pHeight"),r=this.getSheet(n);this.isUndefined(i)||(this.XLEdit._updateDataContainer({rowIndex:t,colIndex:0},{dataObj:{cHeight:i,pHeight:r.rowsHeightCollection[t]}}),r.rowsHeightCollection[t]=i,this._isRowViewable(n,t)&&(this.getRows(n)[1][this._getRowIdx(t)].style.height=i+"px"))},_batchAddRow:function(n,t,i,r){var c,u,o,f,s,h=0,e=n,l=this.getDataSettings(i);if(l)while(e<=t){while(h<l.length)u=l[h],f=u.range,s=u.batchChanges.deleted,e>f[0]&&e<=f[2]+1?(o=f[0]?this._getPosDiff(e,f[0]):e,!u.fieldAsColumnHeader&&u.showHeader&&(o=o-1),c=this._getRowData(e,f[1],f[3],u),u._jsonData.splice(o,0,c),u._isDataManager&&(r?s.length?s.pop():s.push(c):u.batchChanges.added.push(u._jsonData[o])),f[2]++,u.count++):e<=f[0]&&(f[2]++,f[0]++),h++;h=0;e++}},_batchDeleteRow:function(n,t,i,r){var s,u,h,f,o,l,c=0,e=t,a=this.getDataSettings(i);if(a)while(e>=n){while(c<a.length)u=a[c],f=u.range,o=u.batchChanges.added,e>=f[0]&&e<=f[2]?(h=f[0]?this._getPosDiff(e,f[0]):e,!u.fieldAsColumnHeader&&u.showHeader&&(h=h-1),s=u._jsonData.splice(h,1)[0],u._isDataManager&&(r?o.length?(l=o.indexOf(s),l>-1&&o.splice(l,1)):o.push(s):u.batchChanges.deleted.push(s)),f[2]--,u.count--):e<f[0]&&(f[2]--,f[0]--),c++;c=0;e--}},_updateBatchDetails:function(t,i,r){var s,v,f,h,e,o,c,u,y=!0,l=0,a=this.getDataSettings(r);if(a)while(l<a.length){if(u=a[l],f=u.range,f&&this.inRange(f,t,i)){c=u.batchChanges.changed;s=f[0]?this._getPosDiff(t,f[0]):t;v=f[1]?this._getPosDiff(i,f[1]):i;!u.fieldAsColumnHeader&&u.showHeader&&(t===f[0]?y=!1:s=s-1);y&&(o=u._jsonData[s],h=u.fields[v],e=this.getRangeData({range:[t,i,t,i],valueOnly:!0,sheetIdx:r,skipFormula:!0})[0],(this.isUndefined(e)||this._isEmptyString(e))&&(e=null),o&&o[h]!==e&&(o[h]=e,!u.primaryKey||h!==u.primaryKey||this.XLEdit.getPropertyValue(t,i,"isReadOnly",r)||this.isUndefined(e)||this.XLEdit._updateDataContainer({rowIndex:t,colIndex:i},{dataObj:{isReadOnly:!0}}),u._isDataManager&&n.inArray(o,c)===-1&&n.inArray(o,u.batchChanges.added)===-1&&c.push(o)));break}l++}},_getRowData:function(n,i,r,u){for(var f,s={},e=i,o=0,h=u.fields;e<=r;)f=this.getRangeData({range:[n,e,n,e],valueOnly:!0,skipDateTime:!0})[0],this._isEmptyString(f)&&(f=null),u.primaryKey&&h[o]===u.primaryKey&&t.isNullOrUndefined(f)&&(f=0),s[h[o]]=f,e++,o++;return s},saveBatchChanges:function(n){var t,o,u,r,s,f=0,h=this,i=this.getSheet(n),e=this.getDataSettings(n);if(e)while(f<e.length)t=e[f],t._isDataManager&&(r=t.batchChanges,o={sheetIdx:n,dataSetting:t,batchChanges:r},s=this._trigger("beforeBatchSave",o),!s&&(r.changed.length||r.added.length||r.deleted.length)&&(u=t._dataManager.saveChanges(r,t.primaryKey,t.query._fromTable),t._isOffline||(this.showWaitingPopUp(),u.done(function(){i._resCnt++;i._reqCnt===i._resCnt&&h.hideWaitingPopUp()}),u.fail(function(){i._resCnt++;i._reqCnt===i._resCnt&&h.hideWaitingPopUp()}),i._reqCnt++,t.batchChanges={added:[],changed:[],deleted:[]}))),f++},setReadOnly:function(n){this.updateUniqueData({isReadOnly:!0},n);var t={reqType:"setreadonly",range:n,sheetIndex:this.getActiveSheetIndex()};this._trigActionComplete(t)},removeReadOnly:function(n){this.clearRangeData(n,["isReadOnly"])},_updateCustomFormulas:function(n,t){for(var r=this._calcEngine,u,i=0,f=n.length;i<f;i++)t==="add"&&this.isUndefined(this.getCalcEngine().getLibraryFunctions().getItem(n[i].formulaName))&&!this.XLEdit._isNamedRange("="+n[i].formulaName)?(u=r.addCustomFunction(n[i].formulaName,n[i].functionName),this._formulaCollection.push({text:"="+n[i].formulaName,display:n[i].formulaName})):t==="delete"&&r.getCustomLibraryFunctions().contains(n[i].formulaName)?u=r.removeFunction(n[i].formulaName,n[i].functionName):this._showAlertDlg("Alert","CorrectFormula","FormulaAlert",372);return u},addCustomFormula:function(n,t){if(!this.model.isReadOnly){var i=this._updateCustomFormulas([{formulaName:n,functionName:t}],"add");i&&(this.model.customFormulas.push({formulaName:n,functionName:t}),this.XLEdit._refreshAutoComplete())}},removeCustomFormula:function(n,t){if(!this.model.isReadOnly){var i,f=this._updateCustomFormulas([{formulaName:n.toUpperCase(),functionName:t}],"delete"),r,u;if(f){for(r=this.model.customFormulas,i=0,u=r.length;i<u;i++)r[i].formulaName===n&&r.splice(1,parseInt(i));this._updateFormulaCollection();this.XLEdit._refreshCalcEngine(null,null,!1,null,null);this.XLEdit._refreshAutoComplete()}}},getValueFromFormulaArg:function(n){var e=1,f,o=this._calcEngine,r,t,s={},u=[],i,h,c;for(r=n.split(o.getParseArgumentSeparator()),i=0,h=r.length;i<h;i++)u=u.concat(r[i].indexOf(":")>-1?o.getCellsFromArgs(r[i]):[r[i]]);for(f=0,c=u.length;f<c;f++)t=o.getValueFromArg(u[f]),s["arg"+e]=this.XLEdit._parseValue(t).value,u.indexOf(t)>-1&&t[0]==='"'&&t[t.length-1]==='"'&&(s["arg"+e]=t.substring(1,t.length-1)),e++;return s},getCalcEngine:function(){return this._calcEngine},_updateFormatColl:function(n,t,i,r){var f=this.getSheet(n),u=f._formatColl;r>this.model.rowHeight?(this.isUndefined(u[t])&&(u[t]={}),u[t][i]=r):(t in u&&i in u[t]&&delete u[t][i],u[t]&&this.getObjectLength(u[t])<1&&delete u[t])},_getFormattedHeight:function(n,i){var u=this.getSheet(n),r;return r=t.max(this._getObjectValues(u._formatColl[i])),r?r:this.model.rowHeight},getVisibleCellDetails:function(){var n=this.getSheet();return{topLeftCell:n.topLeftCell,rowCount:n._bottomRow.idx-n._topRow.idx,colCount:n._rightCol.idx-n._leftCol.idx}}});t.Spreadsheet.Locale=t.Spreadsheet.Locale||{};t.Spreadsheet.Locale["default"]=t.Spreadsheet.Locale["en-US"]={Cut:"Cut",Copy:"Copy",FormatPainter:"Format Painter",Paste:"Paste",PasteValues:"Paste Values Only",PasteSpecial:"Paste",Filter:"Filter",FilterContent:"Turn on filtering for the selected cells.",FilterSelected:"Filter by Selected Cell's value",Sort:"Sort",Clear:"Clear",ClearContent:"Delete everything in the cell, or remove just the formatting, contents, comments or hyperlinks.",ClearFilter:"Clear Filter",ClearFilterContent:"Clear the filter and sort state for the current range of data.",SortAtoZ:"Sort A to Z",SortAtoZContent:"Lowest to Highest.",SortZtoA:"Sort Z to A",SortZtoAContent:"Highest to Lowest.",SortSmallesttoLargest:"Sort Smallest to Largest",SortLargesttoSmallest:"Sort Largest to Smallest",SortOldesttoNewest:"Sort Oldest to Newest",SortNewesttoOldest:"Sort Newest to Oldest",Insert:"Insert",InsertTitle:"Insert Cells",InsertContent:"Add new cells, rows, or columns to your workbook.",MultipleInsertContent:"FYI: To insert multiple rows or columns at a time, select multiple rows or columns in the sheet, and click Insert.",InsertSBContent:"Add cells, rows, columns, or sheets to your workbook.",Delete:"Delete",DeleteTitle:"Delete Cells",DeleteContent:"Delete cells, rows, columns, or sheets from your workbook.",MultipleDeleteContent:"FYI: To delete multiple rows or columns at a time, select multiple rows or columns in the sheet, and click Delete.",FindSelectTitle:"Find & Select",FindSelectContent:"Click to see options for finding text in your document.",CalculationOptions:"Calculation Options",CalcOptTitle:"Calculation Options",CalcOptContent:"Choose to calculate formulas automatically or manually.",CalcOptRecalcContent:"If you make a change that affects a value, Spreadsheet will automatically recalculate it.",CalculateSheet:"Calculate Sheet",CalculateNow:"Calculate Now",CalculateNowContent:"Calculate the entire workbook now.",CalculateNowTurnOffContent:"You only need to use this if automatic calculation is turned off.",CalculateSheetContent:"Calculate the active sheet now.",CalculateSheetTurnOffContent:"You only need to use this if automatic calculation is turned off.",Title:"Spreadsheet",ColorPicker:"Color Picker",Ok:"OK",Cancel:"Cancel",Alert:"We couldn't do this for the selected range of cells. Select a single cell within a range of data and then try again.",HeaderAlert:"The command could not be completed as you are attempting to filter with the filter header. Select a single cell in the filter range and try the command again.",FlashFillAlert:"All the data next to your selection was checked and there was no pattern for filling in values.",Formatcells:"Format Cells",FontFamily:"Font",FFContent:"Pick a new font for your text.",FontSize:"Font Size",FSContent:"Change the size of your text.",IncreaseFontSize:"Increase Font Size",IFSContent:"Make your text a bit bigger.",DecreaseFontSize:"Decrease Font Size",DFSContent:"Make your text a bit smaller.",Bold:"Bold",Italic:"Italic",Underline:"Underline",Linethrough:"Linethrough",FillColor:"Fill Color",FontColor:"Font Color",TopAlign:"Top Align",TopAlignContent:"Align text to the top.",MiddleAlign:"Middle Align",MiddleAlignContent:"Align text so that it is centered between the top and bottom of the cell.",BottomAlign:"Bottom Align",BottomAlignContent:"Align text to the bottom.",WrapText:"Wrap Text",WrapTextContent:"Wrap extra-long text into multiple lines so you can see all of it.",AlignLeft:"Align Left",AlignLeftContent:"Align your content to the left.",AlignCenter:"Center",AlignCenterContent:"Center your content.",AlignRight:"Align Right",AlignRightContent:"Align your content to the right.",IncreaseIndent:"Increase Indent",IncreaseIndentContent:"Move your content farther away from the cell border.",DecreaseIndent:"Decrease Indent",DecreaseIndentContent:"Move your content closer to the cell border.",Undo:"Undo",Redo:"Redo",NumberFormat:"Number Format",NumberFormatContent:"Choose the format for your cells, such as percentage, currency, date or time.",AccountingStyle:"Accounting Style",AccountingStyleContent:"Format as dollar accounting number format.",PercentageStyle:"Percent Style",PercentageStyleContent:"Format as a percent.",CommaStyle:"Comma Style",CommaStyleContent:"Format with a thousands separator.",IncreaseDecimal:"Increase Decimal",IncreaseDecimalContent:"Show more decimal places for a more precise value.",DecreaseDecimal:"Decrease Decimal",DecreaseDecimalContent:"Show fewer decimal places.",AutoSum:"AutoSum",AutoSumTitle:"Sum",AutoSumContent:"Automatically add a quick calculation to your worksheet, such as sum or average.",Fill:"Fill",ExportXL:"Excel",ExportCsv:"CSV",ExportPdf:"PDF",BackgroundColor:"Fill Color",BGContent:"Color the background of the cells to make them stand out.",ColorContent:"Change the color of your text.",Border:"Border",BorderContent:"Apply borders to the currently selected cells.",BottomBorder:"Bottom Border",TopBorder:"Top Border",LeftBorder:"Left Border",RightBorder:"Right Border",OutsideBorder:"Outside Borders",NoBorder:"No Border",AllBorder:"All Borders",ThickBoxBorder:"Thick Box Border",ThickBottomBorder:"Thick Bottom Border",BottomDoubleBorder:"Bottom Double Border",TopandBottomDoubleBorder:"Top and Bottom Double Border",TopandThickBottomBorder:"Top and Thick Bottom Border",DrawBorderGrid:"Draw Border Grid",DrawBorder:"Draw Border",TopandBottomBorder:"Top and Bottom Border",BorderColor:"Line Color",BorderStyle:"Line Style",Number:"Number is used for general display of numbers. Currency and Accounting offer specialized formatting for monetary value.",General:"General format cells have no specific number format.",Currency:"Currency formats are used for general monetary values. Use Accounting formats to align decimal points in a column.",Accounting:"Accounting formats line up the currency symbols and decimal points in a column.",Text:"Text format cells are treated as text even when a number is in the cell. The cell is displayed exactly as entered.",Percentage:"Percentage formats multiply the cell value by 100 and displays the result with a percent symbol.",CustomMessage:"Type number format code, using one of existing codes as a starting point.",Fraction:"Fraction is used to indicate a part of a whole number or a ratio between two numbers.",Scientific:"Scientific is used to represent a decimal number between 1 and 10 multiplied by ten, so the large numbers using less digits.",Type:"Type:",CustomFormatAlert:"Enter a valid format",Date:"Date formats display date and time serial numbers as date values.",Time:"Time formats display date and time serial numbers as date values.",File:"FILE",New:"New",Open:"Open",SaveAs:"Save As",Print:"Print",PrintContent:"Print the current sheet.",PrintSheet:"Print Sheet",PrintSelected:"Print Selected",PrintSelectedContent:"Select an area on the sheet you would like to print.",HighlightVal:"Format Invalid Data",ClearVal:"Clear Validation",Validation:"Validation",DataValidation:"Data Validation",DVContent:"Pick from a list of rules to limit the type of data that can be entered in a cell.",PageSize:"Page Size",PageSizeContent:"Choose a page size for your document.",FormatCells:"FormatCells",ConditionalFormat:"Conditional Formatting",CFContent:"Easily spot trends and patterns in your data using colors to visually highlight important values.",And:"and",With:"with",GTTitle:"Greater Than",GTContent:"Format cells that are GREATER THAN:",LTTitle:"Less Than",LTContent:"Format cells that are LESS THAN:",BWTitle:"Between",BWContent:"Format cells that are BETWEEN:",EQTitle:"Equal To",EQContent:"Format cells that are EQUAL TO:",DateTitle:"A Date Occurring",DateContent:"Format cells that contain a DATE:",ContainsTitle:"Text That Contains",ContainsContent:"Format cells that contain the text:",GreaterThan:"Greater Than",LessThan:"Less Than",Between:"Between",EqualTo:"Equal To",TextthatContains:"Text that Contains",DateOccurring:"A Date Occurring",DataBars:"Data Bars",BlueDataBar:"Blue Data Bar",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",ClearRulesfromSelected:"Clear Rules from Selected Cells",ClearRulesfromEntireSheets:"Clear Rules from Entire Sheet",CellStyles:"Cell Styles",CellStylesContent:"A colorful style is a great way to make important data stand out on the sheet.",CellStyleHeaderText:"Good, Bad and Neutral/Titles and Headings/Themed Cell Styles",Custom:"Type the number format code, using one of the existing codes as starting point.",CellStyleGBN:"Normal/Bad/Good/Neutral",CellStyleTH:"Heading 4/Title",Accent:"Accent",Style:"Style",FormatAsTable:"Format As Table",FormatasTable:"Format as Table",FATContent:"Quickly convert a range of cells to a table with its own style.",FATHeaderText:"Light/Medium/Dark",FATNameDlgText:"Table Name:/My table has headers",InvalidReference:"The range you have specified is invalid",ResizeAlert:"The specified range is invalid. The top of the table must remain in the same row, and the resulting table must overlap the original table. Specify a valid range.",RangeNotCreated:"Increasing the row beyond the maximum sheet rowcount is restricted in Format as Table.",ResizeRestrictAlert:"Increase or decrease of column count and decrease of row count is restricted in Format as Table.",FATResizeTableText:"Enter new data range for your table:",FATReizeTableNote:"Note: The headers must remain in the same row and the resulting table range must overlap the original table range.",FormatAsTableAlert:"Cannot create a table with a single row. A table must have at least two rows, one for the table header, and one for data",FormatAsTableTitle:"Light 1/Light 2/Light 3/Light 5/Light 8/Light 9/Light 10/Light 12/Light 15/Light 16/Light 17/Light 19/Medium 8/Medium 9/Medium 10/Medium 12/Medium 22/Medium 23/Medium 24/Medium 26/Dark 1/Dark 2/Dark 3/Dark 5",NewTableStyle:"New Table Style",ResizeTable:"Resize Table",ResizeTableContent:"Resize this table by adding or removing rows and columns.",ConvertToRange:"Convert to Range",ConvertToRangeContent:"Convert this table into a normal range of cells.",ConverToRangeAlert:"Do you want to convert the table to a normal range?",TableID:"Table ID:",Table:"Table",TableContent:"Create a table to organize and analyze related data.",TableStyleOptions:"First Column/Last Column/Total Row/Filter Button",Format:"Format",NameManager:"Name Manager",NameManagerContent:"Create, edit, delete and find all the names used in the workbook.",NameManagerFormulaContent:"Names can be used in formulas as substitutes for cell references.",DefinedNames:"Defined Names",DefineName:"Define Name",DefineNameContent:"Define and apply names.",UseInFormula:"Use In Formula",UseInFormulaContent:"Choose a name used in this workbook and insert it into the current formula.",RefersTo:"Refers To",Name:"Name",Scope:"Scope",NMNameAlert:"The name that you entered is not valid./Reason for this can include:/The name does not begin with a letter or an underscore/The name contains a space or other invalid characters/The name conflicts with a spreadsheet built-in name or the name of another object in the workbook",NMUniqueNameAlert:"The name entered already exists. Enter a unique name.",NMRangeAlert:"Enter a valid range",FORMULAS:"FORMULAS",Value:"Values",DataValue:"Values:",Formula:"Formulas",MissingParenthesisAlert:"Your formula is missing a parenthesis--) or (. Check the formula, and then add the parenthesis in the appropriate place.",UnsupportedFile:"Unsupported File",IncorrectPassword:"Unable to open the file or worksheet with the given password",InvalidUrl:"Please specify proper URL",Up:"Up",Down:"Down",Sheet:"Sheet",Workbook:"Workbook",Rows:"By Rows",Columns:"By Columns",FindReplace:"Find Replace",FindnReplace:"Find and Replace",Find:"Find",Replace:"Replace",FindLabel:"Find what:",ReplaceLabel:"Replace with:",ReplaceAll:"Replace All",Close:"Close",FindNext:"Find Next",FindPrev:"Find Prev",Automatic:"Automatic",Manual:"Manual",Settings:"Settings",MatchCase:"Match case",MatchAll:"Match entire cell contents",Within:"Within:",Search:"Search:",Lookin:"Look in:",ShiftRight:"Shift cells right",ShiftBottom:"Shift cells down",EntireRow:"Entire row",EntireColumn:"Entire column",ShiftUp:"Shift cells up",ShiftLeft:"Shift cells left",Direction:"Direction:",GoTo:"Go To",GoToName:"Go to:",Reference:"Reference:",Special:"Special",Select:"Select",Comments:"Comments",Formulas:"Formulas",Constants:"Constants",RowDiff:"Row differences",ColDiff:"Column differences",LastCell:"Last cell",CFormat:"Conditional formats",Blanks:"Blanks",GotoError:"Error",GotoLogicals:"Logicals",GotoNumbers:"Numbers",GotoText:"Text",FindSelect:"Find & Select",Comment:"Comment",NewComment:"New",InsertComment:"Insert Comment",EditComment:"Edit",DeleteComment:"Delete Comment",DeleteCommentContent:"Delete the selected comment.",HideComment:"Hide Comment",Next:"Next",NextContent:"Jump to the next comment.",Previous:"Previous",PreviousContent:"Jump to the previous comment.",ShowHide:"Show/Hide Comment",ShowHideContent:"Show or hide the comment on the active cell.",ShowAll:"Show All Comments",ShowAllContent:"Display all comments in the sheet.",UserName:"User Name",Hide:"Hide",Unhide:"Unhide",Add:"Add",DropAlert:"Do you want to replace the existing data?",PutCellColor:"Put Selected Cell Color To The Top",PutFontColor:"Put Selected Font Color To The Top",WebPage:"Web Page",WorkSheet:"Worksheet Reference",SheetReference:"Sheet Reference",InsertHyperLink:"Insert Hyperlink",HyperLink:"Hyperlink",EditLink:"Editlink",OpenLink:"Openlink",HyperlinkText:"Text:",RemoveLink:"Removelink",WebAddress:"Web Address:",CellAddress:"Cell Reference:",SheetIndex:"Select a place in this document",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearContents:"Clear Contents",ClearComments:"Clear Comments",ClearHyperLinks:"Clear Hyperlinks",SortFilter:"Sort & Filter",SortFilterContent:"Organize your data so it's easier to analyze.",NumberStart:"Minimum:",NumberEnd:"Maximum:",DecimalStart:"Minimum:",DecimalEnd:"Maximum:",DateStart:"Start Date:",DateEnd:"End Date:",ListStart:"Source:",FreeText:"Show error after invalid data is entered",ListEnd:"Cell Reference:",TimeStart:"Start Time:",TimeEnd:"End Time:",TextLengthStart:"Minimum:",TextLengthEnd:"Maximum:",CommentFindEndAlert:"Spreadsheet reached the end of the workbook. Do you want to continue reviewing from the beginning of the workbook?",InsertSheet:"Insert",DeleteSheet:"Delete",RenameSheet:"Rename",MoveorCopy:"Move or Copy",HideSheet:"Hide",UnhideSheet:"Unhide",SheetRenameAlert:"That name is already taken. Try a different one.",SheetRenameEmptyAlert:"You typed an invalid name for a sheet. Make sure that:",SheetRenameEmptyCharExceedAlert:"The name that you type does not exceed 31 characters.",SheetRenameEmptySplCharAlert:"The name does not contain any of the following characters: ",SheetRenameEmptyBlankAlert:"You did not leave the name blank.",SheetDeleteAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",SheetDeleteErrorAlert:"A workbook must contain at least one visible worksheet. To hide, delete, or move the selected sheet, you must first insert a new sheet or unhide a sheet that is already hidden.",CtrlKeyErrorAlert:"That command cannot be used on  multiple selections.",ClipboardAccessError:"Your browser can't access the clipboard, so use these shortcuts:",MoveToEnd:"Move To End",Beforesheet:"Before sheet:",CreateaCopy:"Create a copy",AutoFillOptions:"Copy Cells/Fill Series/Fill Formatting Only/Fill Without Formatting/Flash Fill",NumberValidationMsg:"Enter only digits",DateValidationMsg:"Enter only date",Required:"Required",TimeValidationMsg:"The value you entered for the Time is invalid.",CellAddrsValidationMsg:"Reference is not valid.",PivotTable:"Pivot Table",PivotTableContent:"Easily arrange and summarize complex data in a PivotTable.",NumberTab:"Number",AlignmentTab:"Alignment",FontTab:"Font",FillTab:"Fill",TextAlignment:"Text alignment",Horizontal:"Horizontal:",Vertical:"Vertical:",Indent:"Indent",TextControl:"Text Control",FontGroup:"Font:",FontStyle:"Font style",Size:"Size:",PSize:"Page size",Effects:"Effects",Color:"Color",StrikeThrough:"Strikethrough",Overline:"Overline",NormalFont:"Normal font",Preview:"Preview",Line:"Line",Presets:"Presets",None:"None",Outline:"Outline",AllSide:"All sides",InsCells:"Insert Cells",InsRows:"Insert Sheet Rows",InsCols:"Insert Sheet Columns",InsSheet:"Insert Sheet",DelCells:"Delete Cells",DelRows:"Delete Sheet Rows",DelCols:"Delete Sheet Columns",DelSheet:"Delete Sheet",HyperLinkAlert:"The address of this site is not valid.Check the address and try again.",ReplaceData:"All done. We made / replacements.",NotFound:"We couldn't find what you were looking for. Select settings tab for more ways to search",Data:"Data:",Allow:"Allow:",IgnoreBlank:"Ignore blank",NotFind:"Unable to find the match to replace",FreezeTopRow:"Freeze Top Row",FreezeFirstColumn:"Freeze First Column",UnFreezePanes:"Unfreeze Panes",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",ImageValAlert:"Upload image files only",Pictures:"Pictures",PicturesTitle:"From File",PicturesContent:"Insert pictures from computer or from other computers that you are connected to.",ImportAlert:"Are you sure you want to destroy the current workbook without saving and open a new workbook?",UnmergeCells:"Unmerge Cells",MergeCells:"Merge Cells",MergeAcross:"Merge Across",MergeAndCenter:"Merge & Center",MergeAndCenterContent:"Combine and center the contents of the selected cells in a new larger cell.",MergeCellsAlert:"Merging Cells keeps only upper left cell value and discards the other values.",MergeInsertAlert:"This operation will causes some merged cells to unmerge. Do you wish to continue?",Axes:"Axes",PHAxis:"Primary Horizontal",PVAxis:"Primary Vertical",AxisTitle:"Axis Title",CTNone:"None",CTCenter:"Center",CTFar:"Far",CTNear:"Near",DataLabels:"Data Labels",DLNone:"None",DLCenter:"Center",DLIEnd:"Inside End",DLIBase:"Inside Base",DLOEnd:"Outside End",ErrorBar:"Error Bars",Gridline:"Gridlines",PMajorH:"Primary Major Horizontal",PMajorV:"Primary Major Vertical",PMinorH:"Primary Minor Horizontal",PMinorV:"Primary Minor Vertical",Legend:"Legends",LNone:"None",LLeft:"Left",LRight:"Right",LBottom:"Bottom",LTop:"Top",ChartTitleDlgText:"Enter Title",ChartTitle:"Title",InvalidTitle:"You typed an invalid name for the Title.",CorrectFormat:"Select the correct Format File",ResetPicture:"Reset Picture",ResetPictureContent:"Discard all of the formatting changes made to this picture.",PictureBorder:"Picture Border",PictureBorderContent:"Pick the color, width, and line style for the outline of your shape.",ResetSize:"Reset Picture & Size",Height:"Height",Width:"Width",ThemeColor:"Theme Colors",NoOutline:"No Outline",Weight:"Weight",Dashes:"Dashes",ColumnChart:"Column",ColumnChartTitle:"Insert Column Chart",ColumnChartContent:"Use this chart type to visually compare values across a few categories.",BarChart:"Bar",BarChartTitle:"Insert Bar Chart",BarChartContent:"Use this chart type to visually compare values across a few categories when the chart shows duration or the category text is long.",StockChart:"Radar",StockChartTitle:"Insert Radar Chart",StockChartContent:"Use this chart type to show values relative to a center point.",LineChart:"Line",LineChartTitle:"Insert Line Chart",LineChartContent:"Use this chart type to show trends over time (years, months, and days) or categories.",AreaChart:"Area",AreaChartTitle:"Insert Area Chart",AreaChartContent:"Use this chart type to show trends over time (years, months, and days) or categories. Use it to highlight the magnitude of change over time.",ComboChart:"Combo",PieChart:"Pie",PieChartTitle:"Insert Pie/Doughnut Chart",PieChartContent:"Use this chart type to show proportions of a whole. Use it when the total of your numbers is 100%.",ScatterChart:"Scatter",ScatterChartTitle:"Insert Scatter (X, Y) Chart",ScatterChartContent:"Use this chart type to show the relationship between sets of values.",ClusteredColumn:"Clustered&nbsp;Column",StackedColumn:"Stacked&nbsp;Column",ClusteredBar:"Clustered&nbsp;Bar",StackedBar:"Stacked&nbsp;Bar",Radar:"Radar",RadarMarkers:"Radar&nbsp;with&nbsp;Markers",LineMarkers:"Line&nbsp;with&nbsp;Markers",Area:"Area",StackedArea:"Stacked&nbsp;Area",Pie:"Pie",Doughnut:"Doughnut",Scatter:"Scatter",ChartRange:"Chart Range",XAxisRange:"Enter X-axis range:",YAxisRange:"Enter Y-axis range:",LegendRange:"Enter legend range:",YAxisMissing:"Enter Y-axis range to create chart",InvalidYAxis:"Y-axis range must be within the selected range",InvalidXAxis:"X-axis range must be within the selected range",InvalidLegend:"Legend range must be within the selected range",InvalidXAxisColumns:"X-axis range should be within a single column",FreezePanes:"Freeze Panes",FreezePanesContent:"Freeze a portion of the sheet to keep it visible while you scroll through the rest of the sheet.",PasteContent:"Add content on the Clipboard to your document.",PasteSplitContent:"Pick a paste option, such as keeping formatting or pasting only content.",CutContent:"Remove the selection and put it on the Clipboard so you can paste it somewhere else.",CopyContent:"Put a copy of the selection on the Clipboard so you can paste it somewhere else.",FPTitle:"Format Painter",FPContent:"Like the look of a particular selection? You can apply that look to other content in the document.",BoldContent:"Make your text bold.",ItalicContent:"Italicize your text.",ULineContent:"Underline your text.",LineTrContent:"Cross something out by drawing a strike through it.",UndoContent:"Undo your last action.",RedoContent:"Redo your last action.",HyperLinkTitle:"Add a Hyperlink",HyperLinkContent:"Create a link in your document for quick access to webpages and files.",HyperLinkPlaceContent:"Hyperlinks can also take you to places in your document.",NewCommentTitle:"Insert a Comment",NewCommentContent:"Add a note about this part of the document.",RefreshTitle:"Refresh",RefreshContent:"Get the latest data from the source connected to the active cell",FieldListTitle:"Field List",FieldListContent:"Show or hide the Field List.",FieldListRemoveContent:"The field list allows you to add and remove fields from your PivotTable report",AddChartElement:"Add Chart Element",AddChartElementContent:"Add elements to the created chart.",SwitchRowColumn:"Switch Row/ Column",SwitchRowColumnContent:"Swap the data over the axis.",MergeAlert:"We can't do that to a merged cell.",UnhideDlgText:"Unhide Sheet:",ChartThemes:"Chart Themes",ChartThemesContent:"Pick a new theme for your chart.",ChangePicture:"Change Picture",ChangePictureContent:"Change to a different picture, preserving the formatting and size of the current picture.",ChangeChartType:"Change Chart Type",SelectData:"Select Data",SelectDataContent:"Change the data range included in the chart.",Sum:"Sum",Average:"Average",CountNumber:"Count Numbers",Max:"Max",Min:"Min",ChartTypeContent:"Change to a different chart type.",AllCharts:"All Charts",defaultfont:"Default",LGeneral:"General",LCurrency:"Currency",LAccounting:"Accounting",LDate:"Date",LTime:"Time",LPercentage:"Percentage",LFraction:"Fraction",LScientific:"Scientific",LText:"Text",LCustom:"Custom",LShortdate:"Short Date",LLongdate:"Long Date",FormatSample:"Sample",Category:"Category:",Top:"Top",Center:"Center",Bottom:"Bottom",Left:"Left (Indent)",Right:"Right",Justify:"Justify",GeneralTxt:"General format cells have no specific number format.",NegativeNumbersTxt:"Negative Numbers",ThousandSeparatorTxt:"Use 1000 Separator",DecimalPlacesTxt:"Decimal Places:",TextTxt:"Text format cells are treated as text even when a number is in the cell. The cell is displayed exactly as entered.",BoldItalic:"Bold Italic",Regular:"Regular",HyperLinkHide:"<<Selection in Document>>",InvalidSheetIndex:"Specify proper SheetIndex",HugeDataAlert:"File too large to open.",ImportExportUrl:"Give import/export URL and try again.",BetweenAlert:"The Maximum must be greater or equal to the Minimum.",BorderStyles:"Solid/Dashed/Dotted/Double",FPaneAlert:"Freeze Pane is not applied for the First Cell",ReplaceNotFound:"Spreadsheet cannot find a match.",BlankWorkbook:"Blank workbook",SaveAsExcel:"Save As Excel",SaveAsCsv:"Save As CSV",SaveAsPdf:"Save As PDF",Design:"DESIGN",NewName:"New Name",FormulaBar:"Formula Bar",NameBox:"Name Box",NumberValMsg:"Decimal values cannot be used for number conditions.",NumberAlertMsg:"Enter only digits.",ListAlert:"Cell range is incorrect, Please enter correct cell range.",ListValAlert:"The list source must be a delimited list, or a reference to single row or column.",ListAlertMsg:"The value you entered is not valid",AutoFillTitle:"AutoFillOptions",NewSheet:"New Sheet",FullSheetCopyPasteAlert:"We can't paste because the Copy area and paste area aren't the same size.",Heading:"Headings",Gridlines:"Gridlines",Firstsheet:"Scroll to the first sheet",Lastsheet:"Scroll to the last sheet",Nextsheet:"Scroll to the next sheet",Prevsheet:"Scroll to the previous sheet",ProtectWorkbook:"Protect Workbook",UnProtectWorkbook:"Unprotect Workbook",ProtectWBContent:"Keep others from making structural changes to your workbook",Password:"Password",ConfirmPassword:"Reenter password to proceed:",PasswordAlert1:"Confirmation password is not identical.",PasswordAlert2:"Please enter a password.",PasswordAlert3:"The password you supplied is not correct. Verify that the CAPS LOCK key is off and be sure to use the correct capitalization.",Protect:"is protected.",Lock:"LockCell",Unlock:"UnlockCell",Protectsheet:"Protect Sheet",ProtectSheetToolTip:"Prevent unwanted changes from others by limiting their ability to edit",Unprotect:"Unprotect Sheet",LockAlert:"The cell you are trying to change is on protected sheet. To make changes, click Unprotect Sheet in the Review tab.",InsertDeleteAlert:"This operation is not allowed. The operation is attempting to shift cells in a table/Filter range on your worksheet.",CreateRule:"New Rule",NewRule:"New Formatting Rule",NewRuleLabelContent:"Format values where this formula is true:",ReadOnly:"The range you are trying to change contains readonly cells.",CreatePivotTable:"Create PivotTable",Range:"Range:",ChoosePivotTable:"Choose where you want the PivotTable to be placed",NewWorksheet:"New Worksheet",ExistingWorksheet:"Existing Worksheet",Location:"Location:",Refresh:"Refresh",PivotRowsAlert:"This command requires at least two rows of source data. You cannot use the command on a selection in only one row.",PivotLabelsAlert:"The PivotTable field name is not valid, To create a PivotTable report, you must use data that is organized as a list with labeled columns. If you are changing the name of a PivotTable field, you must type a new name for the field.",FieldList:"Field List",MergeSortAlert:"To do this, all the merged cells need to be the same size.",FormulaSortAlert:"The sort range with formula cannot be sorted.",MergePreventInsertDelete:"This operation is not allowed. The operation is attempting to shift a merge cells on your worksheet.",FormulaRuleMsg:"Please enter correct format.",MovePivotTable:"Move PivotTable",MovePivotTableContent:"Move the PivotTable to another location in the workbook.",ClearAllContent:"Remove fields and filters.",ChangeDataSource:"Modify",ChangeDataSourceContent:"Change the source data for this PivotTable",ChangePivotTableDataSource:"Change PivotTable Data Source",TotalRowAlert:"This operation is not allowed. The operation is attempting to shift cells in a table on your worksheet. Click OK to proceed with entire row.",CellTypeAlert:"This operation is not allowed in cell type applied range.",PivotOverlapAlert:"A PivotTable report cannot overlap another PivotTable report",NoCellFound:"No cells were found",MoreValidationAlert:"The selection contains more than one type of validation. Erase current settings and continue ?",CorrectArgument:"Please enter the correct argument",CorrectFormula:"Please enter the correct formula",CorrectCellAddress:"Please enter the correct cell address",ChartType:"Chart Type",NumberValidationAlert:"The Maximum must be greater than or equal to Minimum",DateValidationAlert:"The End Date must be greater than or equal to Start Date",TimeValidationAlert:"The End Time must be greater than or equal to Start Time",NewRuleAlert:"There's a problem with this formula",DragAlert:"The command could not be completed as you are attempting to move cells within the filter range. Select a range out of the filter range and try the command again.",OR:"or",HOME:"HOME",INSERT:"INSERT",DATATAB:"DATA",PAGELAYOUT:"PAGE LAYOUT",REVIEW:"REVIEW",OTHERS:"OTHERS",FORMAT:"Format",DESIGN:"DESIGN",CHARTDESIGN:"Chart Design",ANALYZE:"Analyze",FileName:"File Name",Save:"Save",SaveFile:"Save the file ",HighlightCellRules:"Highlight Cell Rules",LightRedFillDark:"Light Red Fill with Dark Red Text",YellowFillDark:"Yellow Fill with Dark Yellow Text",GreenFillDark:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Column:"Column",Bar:"Bar",DataValidationType:"Number/Decimal/Date/Time/TextLength/List",DataValidationAction:"greater than/greater than or equal to/less than/less than or equal to/equal to/not equal to/between/not between",FilterAlert:"This will remove a filtered range on your worksheet. To complete this task, please remove auto filters.",cellStyleAlert:"This style name already exists",modifyCellStyleAlert:"This style name does not exists",Modify:"Modify",StyleName:"Style Name",Clipboard:"Clipboard",Font:"Font",Actions:"Actions",Styles:"Styles",Editing:"Editing",Tables:"Tables",Illustrations:"Illustrations",Links:"Links",Charts:"Charts",DataTools:"Data Tools",Show:"Show",PageLayout:"Page Layout",Changes:"Changes",Window:"Window",Cells:"Cells",Calculation:"Calculation",Properties:"Properties",Tools:"Tools",TableStyleOption:"Table Style Options",ChartLayouts:"Chart Layouts",ChartDesignData:"Data",ChartDesignType:"Type",ChartDesignSize:"Size",Adjust:"Adjust",FormatSize:"Size",AnalyzePivotTable:"PivotTable",DataSource:"DataSource",Apply:"Apply",FATTitlePrefix:"Table Style ",NewCellStyle:"New Cell Style",HighPoint:"High Point",LowPoint:"Low Point",FirstPoint:"First Point",LastPoint:"Last Point",NegativePoint:"Negative Points",Markers:"Markers",NegativePoints:"Negative Points",LineSparklineTitle:"Insert Line Sparkline",LineSparklineContent:"Sparklines are mini charts placed in a single cells,each representing a row of data in your selection",ColumnSparklineTitle:"Insert Column Sparkline",ColumnSparklineContent:"Sparklines are mini charts placed in a single cells,each representing a row of data in your selection",WinLossSparklineTitle:"Insert Win/Loss Sparkline",WinLossSparklineContent:"Sparklines are mini charts placed in a single cells,each representing a row of data in your selection",SparklineColor:"Sparkline Color",SparklineColorTitle:"Sparkline Color",SparklineColorContent:"Specify the color of the sparklines in the selected sparkline group",MarkerColor:"Marker Color",MarkerColorContent:"Change the color for negative points, markers, and all other points for selected sparkline group",ChooseDataRange:"Choose the Data Range",ChooseLocationRange:"Choose the Location Range",DataRange:"Data Range",LocationRange:"Location Range",EmptyDLRnge:"Data Source or Location reference is not valid",SourceDataRange:"Select a source data range for the sparkline",SparklineAlert:"Location reference is not valid because the cells are not all in same column or same row. Select cells that are all in single row or single column.",SparklineDataAlert:"Enter the Correct Data Format",SparklineLocAlert:"The reference for the location or data range is not valid",SDataRangeAlert:"Data Source reference is not valid",LineAlert:"Cannot create the line chart for single value",EditData:"Edit Data",EditDataContent:"Edit Group Location & Data",EditSingleSparklineData:"Edit Single Sparkline Data",EditSparklineData:"Edit Sparkline Data",HiddenEmptyCells:"Hidden & Empty Cells",SwitchRowCol:"Switch Row/Column",CreateSparkline:"Create Sparkline",SelectDataSource:"Select a source data range for the sparkline",SPARKLINEDESIGN:"Sparkline Design",CancellationRequested:"Couldn't open within the timeout specified",ArrayaFormula:"You can't change part of an array",ArrayaFormulaTableAlert:"Multi-cell array formulas aren't allowed in tables",PivotTableName:"PivotTable Name",ValueFieldSettings:"Value Field Settings",FieldTab:"Summarize Values By",SummarizeValue:"Summarize Value Field By",SummarizeChooseType:"Choose the type of calculation that you want to use to summarize data from the selected field",FieldValue:"Source Name:",ImportPreventedOnUnknownFormula:"This file cannot be loaded since it contains unsupported formulas.",CellTypeInsertDeleteAlert:"Couldn't insert the row/column for multiple range celltypes",GridModeRecordsCount:"Grid mode must contains atleast one record",GridModeDataHeader:"Grid mode must contains data header",GridDataSourceAlert:"DataSource must not be empty at initial load since columns are generated from dataSource in Spreadsheet grid mode",Directional:"Directional",Shapes:"Shapes",Indicators:"Indicators",Ratings:"Ratings"};t.Spreadsheet.scrollMode={Normal:"normal",Infinite:"infinite"};t.Spreadsheet.AutoFillOptions={CopyCells:"copycells",FillSeries:"fillseries",FillFormattingOnly:"fillformattingonly",FillWithoutFormatting:"fillwithoutformatting",FlashFill:"flashfill"};t.Spreadsheet.autoFillDirection={Up:"up",Right:"right",Down:"down",Left:"left"};t.Spreadsheet.pageSize={A4:"A4",A3:"A3",Letter:"Letter"};t.Spreadsheet.Actions={Sorting:"sorting",Selection:"selection",AutoFill:"autofill",CellNavigation:"cellnavigation",Filtering:"filtering"};t.Spreadsheet.exportType={Excel:"Excel",Csv:"Csv",Pdf:"Pdf"};t.Spreadsheet.CustomCellType={Button:"Button",CheckBox:"CheckBox",DropDownList:"DropDownList",DatePicker:"DatePicker"};t.Spreadsheet.CellType={String:"string",Number:"number",Custom:"custom",Formula:"formula",Time:"time",LongDate:"longdate",ShortDate:"shortdate",Scientific:"scientific",Fraction:"fraction",Text:"text",General:"general",Accounting:"accounting",Currency:"currency",Percentage:"percentage",Date:"date",DateTime:"datetime"};t.Spreadsheet.SupportedStyles={FontFamily:"font-family",FontSize:"font-size",FontStyle:"font-style",FontWeight:"font-weight",TextAlign:"text-align",TextDecoration:"text-decoration",VerticalAlign:"vertical-align",TextIndent:"text-indent"};t.Spreadsheet.Validation={">":"GreaterThan",">=":"GreaterOrEqualTo","<":"LessThan","<=":"LessThanOrEqualTo","==":"EqualTo","!=":"NotEqualTo","!":"Not","=":""};t.Spreadsheet.ValidationText={">":"greater than",">=":"greater than or equal to","<":"less than","<=":"less than or equal to","==":"equal to","!=":"not equal to","!":" not","=":""};t.Spreadsheet.msg=" ";t.Spreadsheet.getMsg=function(){return t.Spreadsheet.msg};t.Spreadsheet.SelectionType={Row:"row",Column:"column",Default:"default"};t.Spreadsheet.SelectionUnit={Single:"single",Range:"range",MultiRange:"multirange"};t.Spreadsheet.Align={Left:"left",Right:"right",Center:"center"};t.Spreadsheet.CFormatRule={GreaterThan:"greaterthan",LessThan:"lessthan",Between:"between",EqualTo:"equalto",TextContains:"textcontains",DateOccur:"dateoccur",DataBar:"databar",ColorScale:"colorscale",IconSet:"iconset"};t.Spreadsheet.ContextMenu={Cell:"cell",RowHeader:"rowheader",ColumnHeader:"columnheader",Footer:"footer"};t.Spreadsheet.CFormatHighlightColor={RedFillwithDarkRedText:"redft",YellowFillwithDarkYellowText:"yellowft",GreenFillwithDarkGreenText:"greenft",RedFill:"redf",RedText:"redt"};t.Spreadsheet.DataBar={Blue:"b",Green:"g",Red:"r",Orange:"o",LightBlue:"lb",Purple:"p"};t.Spreadsheet.ColorScale={GreenYellowRed:"gyr",RedYellowGreen:"ryg",GreenWhiteRed:"gwr",RedWhiteGreen:"rwg",BlueWhiteRed:"bwr",RedWhiteBlue:"rwb",WhiteRed:"wr",RedWhite:"rw",GreenWhite:"gw",WhiteGreen:"wg",GreenYellow:"gy",YellowGreen:"yg"};t.Spreadsheet.IconSet={ThreeArrows:"threearrows",ThreeArrowsGray:"threearrowsgray",ThreeTriangles:"threetriangles",ThreeTrafficLights:"threetrafficlights",ThreeTrafficLightsRimmed:"threetrafficlightsrimmed",ThreeSigns:"threesigns",ThreeSymbolsCircled:"threesymbolscircled",ThreeSymbolsUnCircled:"threesymbolsuncircled",ThreeFlags:"threeflags",ThreeStars:"threestars"};t.Spreadsheet.BorderType={Top:"top",Left:"left",Right:"right",Bottom:"bottom",OutSide:"outside",AllBorder:"allborder",ThickBox:"thickbox",ThickBottom:"thickbottom",TopandBottom:"topandbottom",TopandThickBottom:"topandthickbottom"};t.Spreadsheet.ChartProperties={PrimaryHorizontal:"PHAxis",PrimaryVertical:"PVAxis",PrimaryHorizontalAxisTitle:"PHAxisTitle",PrimaryVerticalAxisTitle:"PVAxisTitle",TitleNone:"CTNone",TitleCenter:"CTCenter",TitleFar:"CTFar",TitleNear:"CTNear",DataLabelNone:"DLNone",DataLabelCenter:"DLCenter",DataLabelInsideBase:"DLIBase",DataLabelInsideEnd:"DLIEnd",DataLabelOutsideEnd:"DLOEnd",PrimaryMajorHorizontal:"PMajorH",PrimaryMajorVertical:"PMajorV",PrimaryMinorHorizontal:"PMinorH",PrimaryMinorVertical:"PMinorV",LegendsNone:"LNone",LegendsLeft:"LLeft",LegendsRight:"LRight",LegendsBottom:"LBottom",LegendsTop:"LTop"};t.Spreadsheet.HideTypes={Default:"default",Freeze:"freeze"}})(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.selection=function(n){this.XLObj=n;this._isRightClick=!1;this._colhdrClick=!1;this._rowhdrClick=!1;this._aFillDownHandler=!1;this._isOutsideBordering=!1;this._isGridBordering=!1;this._isRowSelected=!1;this._isColSelected=!1;this._isEndReached=!0;this._canTouchMove=!1};t.spreadsheetFeatures.selection.prototype={_selectionMouseDownHandler:function(i){var e,o,r=this.XLObj,f=r.getSheet(),u=i.target;n(u).hasClass("e-cf-databar")||n(u).hasClass("e-databar")?(u=n(u).parents("td")[0]||i.target,r._isCFDirty=!0):r._isCFDirty=!1;r._isTouchEvt?(r._browserDetails.name==="msie"&&i.preventDefault(),(r._isSelected(i.target)||r._hasClass(i.target,"e-autofill"))&&(e=r._getBrowserEvt("move"),this._canTouchMove=!0),o=r._getBrowserEvt("end")):(i.preventDefault(),e=r._getBrowserEvt("move",!0),o=r._getBrowserEvt("end",!0)+" mouseleave");r._on(n(document),o,this._mouseUpHandler);i.which===3||i.button===2||r.model.selectionSettings.selectionUnit===t.Spreadsheet.SelectionUnit.Single?this._isRightClick=!0:e&&r._on(r.element,e,this._mouseMoveHandler);u.tagName=="TD"?(r.XLEdit._isFormulaEdit?(i.ctrlKey&&(this._clearBorder(r._arrayAsString(r._ctrlFormulaBorder)),r._ctrlKeyCount=r._formulaRange.length),r._dStartCell=r._getCellIdx(u)):i.shiftKey&&f._startCell.rowIndex!=-1?f._endCell=r._getCellIdx(u):(f._startCell=r._getCellIdx(u),f._activeCell=r._getCellIdx(u)),u.className.indexOf("e-rowheader")>-1&&(this._rowhdrClick=!0)):u.parentNode&&u.parentNode.tagName=="TH"?(i.shiftKey&&f._startCell.rowIndex!=-1?f._endCell={rowIndex:0,colIndex:u.parentNode.cellIndex}:(f._startCell={rowIndex:0,colIndex:u.parentNode.cellIndex},f._activeCell={rowIndex:0,colIndex:u.parentNode.cellIndex}),u.className.indexOf("e-headercelldiv")>-1&&(this._colhdrClick=!0)):u.className=="e-autofill"&&(this._aFillDownHandler=!0)},_mouseMoveHandler:function(i){var o,l,a,u=this,e=u.XLSelection,s=u.getActiveSheetIndex(),r=u.getSheet(s),f=i.target,p,h=u.model.selectionSettings.selectionType,c=t.Spreadsheet.SelectionType,v=n(i.target).get(0),y;if(!u._isTouchEvt||(u._isTouchMoveSel=!0,l=u._getOriginalEvt(i),f=document.elementFromPoint(l.clientX,l.clientY),f))if((n(f).hasClass("e-cf-databar")||n(f).hasClass("e-databar"))&&(u._isCFDirty=!0),n(f).hasClass("e-rowcell")||n(f).hasClass("e-rowheader")||n(f).hasClass("e-cf-databar")||n(f).hasClass("e-databar")){if(this.XLSelection._isEndReached=!1,u._getContent(s).find("td[class *='border']").removeClass(u._ctrlFormulaBorder[u._ctrlKeyCount%6].join(" ")),u.XLEdit._isFormulaEdit){i.ctrlKey?(u._dEndCell=u._getCellIdx(f),e._processFormulaRange(u._ctrlFormulaBorder,!0)):(u._dEndCell=u._getCellIdx(f),e._processFormulaRange(u._ctrlFormulaBorder,!0));return}if(e._aFillDownHandler&&n(f).parents(".e-rowheadercontent").length===0){if(u.model.allowAutoFill){a=u._getCellIdx(i.target);r._isFreezed&&a.rowIndex<=r.frozenRows&&r._hiddenFreezeRows.indexOf(r.frozenRows)>-1?e._scrollCalculation(s,f,{position:"vertical",action:"Decrement"}):r._isFreezed&&a.colIndex<=r.frozenColumns&&r._hiddenFreezeCols.indexOf(r.frozenColumns)>-1?e._scrollCalculation(s,f,{position:"horizontal",action:"Decrement"}):u.XLDragFill._selectAutoFillRange(f);return}}else if(f.nodeName!=="TD"&&(f=n(f).parents("td")[0]),r._startCell=r._activeCell,r._endCell=u._getCellIdx(f),r._isFreezed&&u.XLFreeze._selectionScroll(),e._processBoundary(),n(f).parents(".e-spreadsheetcontentcontainer").length>0){if(i.ctrlKey&&u.model.selectionSettings.selectionType===t.Spreadsheet.SelectionType.Default&&u.model.selectionSettings.selectionUnit===t.Spreadsheet.SelectionUnit.MultiRange){y=u._getContent(u.getActiveSheetIndex());y.find("td[class *='activecell']").removeClass("e-activecell");y.find("td[class *='focus']").removeClass("e-focusright e-focusbottom");p=u.swapRange([r._startCell.rowIndex,r._startCell.colIndex,r._endCell.rowIndex,r._endCell.colIndex]);u.getRange(p).addClass("e-ctrlselected");e._focusRange(r._startCell,r._endCell,u._selectionBorder);u.model.allowAutoFill&&u.XLDragFill.hideAutoFillElement();return}h===c.Row||e._rowhdrClick?e.selectRows(r._startCell.rowIndex,r._endCell.rowIndex):h===c.Column||e._colhdrClick?e.selectColumns(r._startCell.colIndex,r._endCell.colIndex):e.selectRange(r._startCell,r._endCell,f);r._isFreezed&&u.XLFreeze._refreshSelection()}else if(n(f).parents(".e-rowheadercontent").length>0)e._colhdrClick||e._rowhdrClick?(h===c.Column?e.selectColumns(0,r.colCount-1):e.selectRows(r._startCell.rowIndex,r._endCell.rowIndex),r._isFreezed&&u.XLFreeze._refreshSelection()):(o={position:"horizontal",action:"Decrement"},e._scrollCalculation(s,f,o));else return}else if(t.isNullOrUndefined(f.parentNode)||f.parentNode.tagName!="TH")if(v.id.indexOf("sparkline")>1||v.id.indexOf("chart")<1&&(f.className.indexOf("e-hhandlespace")>-1||f.className.indexOf("e-hhandle")>-1||f.className.indexOf("e-hup")>-1||f.className.indexOf("e-hdown")>-1))o={position:"vertical",action:"Increment"},e._scrollCalculation(s,f,o);else if(v.id.indexOf("chart")<1&&(f.className.indexOf("e-vhandlespace")>-1||f.className.indexOf("e-vhandle")>-1||f.className.indexOf("e-vup")>-1||f.className.indexOf("e-vdown")>-1))o={position:"horizontal",action:"Increment"},e._scrollCalculation(s,f,o);else return;else r._endCell={rowIndex:0,colIndex:f.parentNode.cellIndex},r._startCell=r._activeCell,r._isFreezed&&u.XLFreeze._selectionScroll(),e._processBoundary(),e._colhdrClick||e._rowhdrClick?(h===c.Row?e.selectRows(0,r.rowCount-1):e.selectColumns(r._startCell.colIndex,r._endCell.colIndex),r._isFreezed&&u.XLFreeze._refreshSelection()):(o={position:"vertical",action:"Decrement"},e._scrollCalculation(s,f,o))},_mouseUpHandler:function(i){i.target=this._changeTargetWithOffset(i);var e,h,y,l,d,g,a,o,nt,tt,p,it,rt,w=!0,r=this,u=r.XLSelection,s=r.getActiveSheetIndex(),f=r.getSheet(s),ut=f.selectedRange,ft=r.getSheetElement(s),b=r.model.selectionSettings.selectionType,et=f._startCell,ot=f._endCell,k=t.Spreadsheet.SelectionType,c=r._getJSSheetContent(s).find(".e-spreadsheetcontentcontainer > .e-content"),v=!1;if(r.XLEdit._isEdit||r._setSheetFocus(),r._isTouchEvt?(it=r._getBrowserEvt("end"),u._canTouchMove&&(p=r._getBrowserEvt("move")),r._isTouchMoveSel=!1):(p=r._getBrowserEvt("move",!0),it=r._getBrowserEvt("end",!0)+" mouseleave"),p&&r._off(r.element,p,u._mouseMoveHandler),r._off(n(document),it,u._mouseUpHandler),r._isTouchEvt){if(!u._aFillDownHandler&&r._isTouchScroll||!u._canTouchMove&&!r._isUniqueTarget(r._touchArgs,i)){u._canTouchMove=r._isTouchScroll=!1;return}if(u._canTouchMove=r._isTouchScroll=!1,rt=r._getOriginalEvt(i),e=document.elementFromPoint(rt.clientX,rt.clientY),!e){this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();return}}if(e=e||i.target,h=n(e),e.tagName=="TD"||e.tagName=="INPUT"&&!h.parents(".e-formulabar").length||u._aFillDownHandler){if(h.parents(".e-rowheadercontent").length&&(u._isOutsideBordering=u._isGridBordering=!1,c.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor")),r._preventctrlkey=i.ctrlKey,r.XLEdit._isFormulaEdit){c.find("td[class *='border']").removeClass(r._ctrlFormulaBorder.join(" ").replace(/,/g," "));i.ctrlKey?(r._dEndCell=r._getCellIdx(e),u._processFormulaRange(r._formulaBorder)):(u._clearBorder(r._formulaBorder.join(" ").replace(/,/g," ")+" "+r._ctrlFormulaBorder.join(" ").replace(/,/g," ")),r._ctrlKeyCount=0,r._dEndCell=r._getCellIdx(e),u._processFormulaRange(r._formulaBorder),r._formulaRange=[]);r._formulaRange.push(r._getProperAlphaRange(s,r._dStartCell.rowIndex,r._dStartCell.colIndex,r._dEndCell.rowIndex,r._dEndCell.colIndex));return}if(u._aFillDownHandler){if(a=e.tagName==="TD"?r._getCellIdx(e):r._dautoFillCell,r.model.allowAutoFill&&(o=r.XLDragFill._getAutoFillRange(a)),!o||!o.fillRange){u._aFillDownHandler=!1;r.XLDragFill&&r.XLDragFill.positionAutoFillElement();return}if(d=r.swapRange(o.fillRange),r.model.allowLockCell&&r.getSheet(s).isSheetProtected&&r._isPropExists([d],"isLocked",s)&&(w=!1),w&&r._isPropExists([d],"isReadOnly",s)&&(w=!1),w)"direction"in o?(r._pStartCell=f._startCell,r._pEndCell=f._endCell,r._pFillCell=a,r.inRange(f.selectedRange,a.rowIndex,a.colIndex)?r.clearRangeData(null,null,n(u.getSelectedCells()).not(".e-autofillcell")):r.model.allowAutoFill&&r.XLDragFill.autoFill({dataRange:f.selectedRange,fillRange:o.fillRange,direction:o.direction,fillType:r.model.autoFillSettings.fillType}),f._startCell=o.startCell,f._endCell=o.endCell):u._aFillDownHandler=!1;else{u._aFillDownHandler=!1;r.XLSelection.selectRange(et,ot);v=!0;r.XLDragFill.positionAutoFillElement();return}u.refreshSelection(r.swapRange([o.startCell.rowIndex,o.startCell.colIndex,o.endCell.rowIndex,o.endCell.colIndex]))}else if(u._isOutsideBordering||u._isGridBordering)if(l=r._borderStyle=="double"?"3px "+r._borderStyle+" "+r._borderColor:"1px "+r._borderStyle+" "+r._borderColor,u._isRightClick?f._endCell=f._startCell:(f._startCell=f._activeCell,f._endCell=r._getCellIdx(e),u._processBoundary()),h.parents(".e-spreadsheetcontentcontainer").length)nt={top:l,right:l,bottom:l,left:l},u._isGridBordering&&(nt.isGridBorder=!0),r.XLFormat.applyBorder(nt,r.swapRange([f._startCell.rowIndex,f._startCell.colIndex,f._endCell.rowIndex,f._endCell.colIndex])),u._cleanUp(!0);else return;else if(e.tagName=="INPUT"&&h.parents("tr").length?f._endCell=u._isRightClick?f._startCell:r._getCellIdx(h.parents("td")[0]):u._isRightClick?f._endCell=f._startCell:(f._startCell=f._activeCell,f._endCell=r._getCellIdx(e),u._processBoundary()),h.parents(".e-spreadsheetcontentcontainer").length){if(i.ctrlKey&&r.model.selectionSettings.selectionType===t.Spreadsheet.SelectionType.Default&&r.model.selectionSettings.selectionUnit===t.Spreadsheet.SelectionUnit.MultiRange){c.find("td[class *='activecell']").removeClass("e-activecell");c.find("td[class *='focus']").removeClass("e-focustop e-focusleft");c.find("td[class *='ctrlselected']").removeClass("e-ctrlselected");ut=r.swapRange([f._startCell.rowIndex,f._startCell.colIndex,f._endCell.rowIndex,f._endCell.colIndex]);r.getRange(ut).addClass("e-selected");r.getCell(f._activeCell.rowIndex,f._activeCell.colIndex).addClass("e-activecell");u._focusRange(f._startCell,f._endCell,r._selectionBorder);r.model.allowAutoFill&&r.XLDragFill.hideAutoFillElement();r.getSheet(s)._selectedCells.push(r._getSelectedRange(r.getSheet(s)._startCell,r.getSheet(s)._endCell));r.model.showRibbon&&r.model.allowComments&&ft.find(".e-selected.e-commentcell").length&&r.XLRibbon._enableButtons(["Review_Comments_DeleteComment"],"ejButton");return}b===k.Row||u._rowhdrClick?u.selectRows(f._startCell.rowIndex,f._endCell.rowIndex):b===k.Column||u._colhdrClick?u.selectColumns(f._startCell.colIndex,f._endCell.colIndex):u.selectRange(f._startCell,f._endCell,e);v=!0;f._isFreezed&&r.XLFreeze._refreshSelection()}else if(h.parents(".e-rowheadercontent").length)(u._colhdrClick||u._rowhdrClick)&&(b===k.Column?u.selectColumns(0,f.colCount-1):u.selectRows(f._startCell.rowIndex,f._endCell.rowIndex),v=!0,u._hdrClick=!1),u._isOutsideBordering=u._isGridBordering=!1,c.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor");else return;e.tagName==="TD"&&r.model.showRibbon&&(tt=n("#"+r._id+"_Ribbon_clearfilter").data("ejButton"),tt&&r.XLRibbon._changeClrFltrStatus(tt,"button",r._getCellIdx(e)))}else u._aFillDownHandler||t.isNullOrUndefined(e.parentNode)||e.parentNode.tagName!="TH"?typeof e.className!="object"&&e.className&&e.className.indexOf("e-spreadsheetcolumnheader")>-1&&(u.selectSheet(!0),u._isOutsideBordering=u._isGridBordering=!1,c.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor")):(f._startCell=f._activeCell,f._endCell=u._isRightClick?f._startCell:{rowIndex:0,colIndex:e.parentNode.cellIndex},u._processBoundary(),(u._colhdrClick||u._rowhdrClick)&&(b===k.Row?u.selectRows(0,f.rowCount-1):u.selectColumns(f._startCell.colIndex,f._endCell.colIndex),v=!0),u._isOutsideBordering=u._isGridBordering=!1,c.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor"));r.model.allowCellFormatting&&r.XLFormat._formatEnable&&r.XLFormat._fPMouseUp(i);r.model.showRibbon&&!v&&(r.XLEdit._isEdit?r.XLRibbon._disableRibbonIcons():r.XLRibbon._updateRibbonIcons());!r.model.allowAutoFill||u._isOutsideBordering||u._isGridBordering||r.XLDragFill.positionAutoFillElement(u._aFillDownHandler);u._isRightClick=u._aFillDownHandler=!1;u._colhdrClick=u._rowhdrClick=!1;r.model.showRibbon&&(y=n("#"+r._id+"_Ribbon_merge").data("ejSplitButton"),t.isNullOrUndefined(y)||!r.model.allowLockCell||f.isSheetProtected||(r.XLRibbon._isDirtySelect?y.option("enabled",!1):y.option("enabled",!0)));r.model.allowEditing&&this.XLEdit._isEdit&&(g=r.getSheet(s)._startCell,r.getCell(g.rowIndex,g.colIndex).find(".e-ss-input").focus())},_processBoundary:function(){var u,o,f,t,e,r,s=[],i=this.XLObj,c=i.getActiveSheetIndex(),h=i.getSheet(c),l=h._startCell,a=h._endCell,n=i.swapRange([l.rowIndex,l.colIndex,a.rowIndex,a.colIndex]);for(h._startCell={rowIndex:n[0],colIndex:n[1]},h._endCell={rowIndex:n[2],colIndex:n[3]},t=i._getSelectedRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[0],colIndex:n[3]}),t=t.concat(i._getSelectedRange({rowIndex:n[0],colIndex:n[3]},{rowIndex:n[2],colIndex:n[3]})),t=t.concat(i._getSelectedRange({rowIndex:n[2],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]})),t=t.concat(i._getSelectedRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[1]})),u=t.length;u--;)if(f=t[u],e=i.XLEdit.getPropertyValue(t[u].rowIndex,t[u].colIndex,"mergeIdx",c),r=(f.rowIndex+":"+f.colIndex).toString(),o=i.hasSpan(f)&&s.indexOf(r)===-1&&(s.push(r),this._updateRange(f,n)),e&&(r=(e.rowIndex+":"+e.colIndex).toString(),s.indexOf(r)===-1&&(s.push(r),o=this._updateRange(e,n))),o)break;o&&this._processBoundary()},_updateRange:function(n,t){var r=this.XLObj,c=r.getActiveSheetIndex(),u=r.getSheet(c),i=t.slice(0),f=r._getMergedIdx(n.rowIndex,n.colIndex),e=n.rowIndex,o=n.colIndex,s=f.rowIndex,h=f.colIndex;return e<t[0]&&(t[0]=e),o<t[1]&&(t[1]=o),s>t[2]&&(t[2]=s),h>t[3]&&(t[3]=h),t[0]!=i[0]||t[1]!=i[1]||t[2]!=i[2]||t[3]!=i[3]?(u._startCell={rowIndex:t[0],colIndex:t[1]},u._endCell={rowIndex:t[2],colIndex:t[3]},!0):void 0},selectRange:function(n,t,i,r){var s,c,l,e,v,a,y,p,f,h,o=n,u=this.XLObj;if(u.model.allowSelection){if(u._isObject(n)||(n=u._getRangeArgs(n,"object"),o={rowIndex:n[0],colIndex:n[1]},t={rowIndex:n[2],colIndex:n[3]}),h=u.getActiveSheetIndex(),f=u.getSheet(h),y=u.model.scrollSettings.allowVirtualScrolling,y&&(f._goToCollection={multiple:!1,selected:[]}),p=f.selectedRange,e=u.swapRange([o.rowIndex,o.colIndex,t.rowIndex,t.colIndex]),v=!(u.isImport||u.model.isImport)&&(!f._isImported||f._isLoaded),v&&u.model.beforeCellSelect&&(s={prevRange:p,currRange:e,sheetIdx:h},i&&(s.target=i),!u._intrnlReq&&u._trigger("beforeCellSelect",s)))return!1;if(u._dStartCell=o,u._dEndCell=t,f.selectedRange=e.slice(0),u._isScrolling||this._cleanUp(!1),u.model.scrollSettings.allowScrolling&&y&&f._isColSelected&&(f._virtualRowIdx.indexOf(e[0])===-1&&(e[0]=f._virtualRowIdx[0]),f._virtualRowIdx.indexOf(e[2])===-1&&(e[2]=f._virtualRowIdx[f._virtualRowIdx.length-1])),a=u.isUndefined(r),a&&(c=u.getRange(e),l=c.length,l))while(l--)u.addClass(c[l],"e-selected");u.inRange(f.selectedRange,f._activeCell.rowIndex,f._activeCell.colIndex)||(f._activeCell={rowIndex:f.selectedRange[0],colIndex:f.selectedRange[1]});f._activeCell=u._getMergeParent(f._activeCell.rowIndex,f._activeCell.colIndex);u._isRowViewable(h,f._activeCell.rowIndex)&&u.addClass(u.getCell(f._activeCell.rowIndex,f._activeCell.colIndex)[0],"e-activecell");a&&(this._focusRange(o,t,u._selectionBorder),this._highlightHeader(e));f._selectedCells=u._getSelectedRange(o,t);u.model.allowFormulaBar&&!u.XLEdit._isFormulaEdit&&u.updateFormulaBar();u.XLDragFill&&u.XLDragFill.positionAutoFillElement();a&&(u.model.enableContextMenu||u.model.showRibbon)&&u.XLRibbon._dirtySelect(c);u._isMultiSelect=!0;u.model.showRibbon&&!u._isScrolling&&u.XLRibbon._updateRibbonIcons();u._isSheetNavigate||(f._isEmptyActiveCell=f._isRangeSelected=f._isRowSelected=f._isColSelected=f._isSheetSelected=!1);v&&u.model.cellSelected&&(s={selectedRange:f.selectedRange,target:i,sheetIdx:h,activeCell:u.getActiveCell()},u._intrnlReq||u._trigger("cellSelected",s))}},selectRow:function(n){var i=this.XLObj,t=i.getSheet(i.getActiveSheetIndex());i.model.allowSelection&&(t._startCell={rowIndex:n,colIndex:0},t._endCell={rowIndex:n,colIndex:t.colCount-1},this.selectRange(t._startCell,t._endCell),this._selectRow(i._getRowIdx(n),"e-rowselected"),t._isRowSelected=!0,this._isRowSelected=!0)},selectRows:function(n,t){var i,r=this.XLObj;r.model.allowSelection&&(i=r.getSheet(r.getActiveSheetIndex()),i._startCell={rowIndex:n,colIndex:0},i._endCell={rowIndex:t,colIndex:i.colCount-1},this.selectRange(i._startCell,i._endCell),this._markHeaderSelection([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex],"row"),i._isRowSelected=!0,this._isRowSelected=!0)},selectColumn:function(n){var t,i=this.XLObj;i.model.allowSelection&&(t=i.getSheet(i.getActiveSheetIndex()),t._startCell={rowIndex:0,colIndex:n},t._endCell={rowIndex:t.rowCount-1,colIndex:n},this.selectRange(t._startCell,t._endCell),this._selectColumn(n,"e-colselected"),t._isColSelected=!0,this._isColSelected=!0)},selectColumns:function(n,t){var i,r=this.XLObj;r.model.allowSelection&&(i=r.getSheet(r.getActiveSheetIndex()),i._startCell={rowIndex:0,colIndex:n},i._endCell={rowIndex:i.rowCount-1,colIndex:t},this.selectRange(i._startCell,i._endCell),this._markHeaderSelection([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex],"column"),i._isColSelected=!0,this._isColSelected=!0)},selectSheet:function(n){var r,u,i=this.XLObj,e=i.getActiveSheetIndex(),t=i.getSheet(e),f=i.getActiveCell();i.model.allowSelection&&(n&&(r=t._topRow.idx,u=t._leftCol.idx,(f.rowIndex!=r||f.colIndex!=u)&&(t._activeCell={rowIndex:t._topRow.idx,colIndex:t._leftCol.idx},i.XLScroll.scrollToCell(i._getRangeArgs([r,u,r,u])))),t._startCell={rowIndex:0,colIndex:0},t._endCell={rowIndex:t.rowCount-1,colIndex:t.colCount-1},this.selectRange(t._startCell,t._endCell),i.element.find(".e-spreadsheetcolumnheader").addClass("e-sheetselected"),t._isSheetSelected=!0)},refreshSelection:function(n){var t=this.XLObj;n=t._getRangeArgs(n,"object");var i=t.getSheet(t.getActiveSheetIndex()),r=n[0],u=n[1],f=n[2],e=n[3];i._isRowSelected?this.selectRows(r,f):i._isColSelected?this.selectColumns(u,e):i._isSheetSelected?this.selectSheet():this.selectRange({rowIndex:r,colIndex:u},{rowIndex:f,colIndex:e})},getSelectedCells:function(n){return this.XLObj._getContent(this.XLObj._getSheetIndex(n))[0].querySelectorAll("td.e-selected")},_select:function(n,t){var i=this.XLObj.getCell(n.rowIndex,n.colIndex);i&&i.addClass(t)},_selectRow:function(n,t){var i=this.XLObj._getJSSheetRowHeaderContent(this.XLObj.getActiveSheetIndex()).find("td:eq("+n+")");i&&i.addClass(t)},_selectRows:function(n,t,i){var r,e,u,f=this.XLObj,h=f.getActiveSheetIndex(),s=f.getSheet(h),o=f._getJSSheetRowHeaderContent(h).find("td");if(e=f._getRowIdx(n),u=f._getRowIdx(t),e===-1)if(n<s._virtualRowIdx[0])e=0;else return;if(u===-1)if(r=s._virtualRowIdx.length-1,t>s._virtualRowIdx[r])u=r;else return;if(o=e!==u?o.slice(e,u+1):o.eq(u),r=o.length,r)while(r--)f.addClass(o[r],i)},_selectColumn:function(n,t){var i=this.XLObj._getJSSheetHeader(this.XLObj.getActiveSheetIndex()).find("th:eq("+n+")");i&&i.addClass(t)},_selectColumns:function(n,t,i){var u,f=this.XLObj,r=f._getJSSheetHeader(f.getActiveSheetIndex()).find("th");if(r=t!==n?r.slice(n,t+1):r.eq(t),u=r.length,u)while(u--)f.addClass(r[u],i)},_focusBorder:function(n,t,i){var r=this.XLObj,e=r.swapRange([n.rowIndex,n.colIndex,t.rowIndex,t.colIndex]),u=e[0],f=e[1],o=e[2],s=e[3];u&&r.getRange([u-1,f,u-1,s]).addClass(i[1]);r.getRange([u,s,o,s]).addClass(i[0]);r.getRange([o,f,o,s]).addClass(i[1]);f&&r.getRange([u,f-1,o,f-1]).addClass(i[0])},_focusRange:function(n,t,i){for(var f,u=4,r=this.XLObj,e=[r.getFocusTopElem(),r.getFocusRightElem(),r.getFocusBottomElem(),r.getFocusLeftElem()],o=["e-focustop ","e-focusright ","e-focusbottom ","e-focusleft "];u--;)f=e[u][0],r._removeClass(f),r.addClass(f,o[u]+i[u]);this._refreshBorder(r.swapRange([n.rowIndex,n.colIndex,t.rowIndex,t.colIndex]))},_refreshBorder:function(n){n=n?n:this.XLObj.getSheet().selectedRange;for(var s,h,a,c,v,f="e-hide",w=4,b=n[0],k=n[1],i=this.XLObj,t=this._focusInfo(n),r=i.getFocusTopElem(),e=i.getFocusRightElem(),o=i.getFocusBottomElem(),u=i.getFocusLeftElem(),ut=[r,e,o,u],d=c=t.topLeft.top,g=t.topRight.left+t.topRight.width-t.topLeft.left,y=t.topRight.top,nt=t.topRight.left+t.topRight.width,tt=t.bottomRight.top+t.bottomRight.height-y,p=t.bottomLeft.top+t.bottomLeft.height,it=t.bottomRight.left+t.bottomRight.width-t.bottomLeft.left,rt=p-c,l=a=v=t.topLeft.left;w--;)i._removeClass(ut[w][0],f);i.model.selectionSettings.enableAnimation?(s=i.model.selectionSettings.animationType,h=i.model.selectionSettings.animationTime,b?r.animate({top:c.toString(),left:v.toString(),width:g.toString()},h,s):r.addClass(f),e.animate({top:y.toString(),left:nt.toString(),height:tt.toString()},h,s),o.animate({top:p.toString(),left:l.toString(),width:it.toString()},h,s),k?u.removeClass(f).animate({top:d.toString(),left:a.toString(),height:rt.toString()},h,s):u.addClass(f)):(r&&(b?(r[0].style.top=c+"px",r[0].style.left=v+"px",r[0].style.width=g+"px"):r.addClass(f)),e&&(e[0].style.top=y+"px",e[0].style.left=nt+"px",e[0].style.height=tt+"px"),o&&(o[0].style.top=p+"px",o[0].style.left=l+"px",o[0].style.width=it+"px"),u&&(k?(u[0].style.top=d+"px",u[0].style.left=a+"px",u[0].style.height=rt+"px"):u.addClass(f)))},_focusInfo:function(n){var i={},u=n[0],f=n[1],e=n[2],r=n[3],t=this.XLObj;return i.topLeft=t._getCellInfo({rowIndex:u,colIndex:f}),i.topRight=t._getCellInfo(f===r?{rowIndex:u,colIndex:r}:t._getMergedIdx(u,r)),i.bottomLeft=t._getCellInfo({rowIndex:e,colIndex:f}),i.bottomRight=t._getCellInfo(t._getMergedIdx(e,r)),i},_highlightHeader:function(n){this._selectRows(n[0],n[2],"e-rowhighlight");this._selectColumns(n[1],n[3],"e-colhighlight")},_hideShowSelElem:function(n){var t=this.XLObj,i=n==="block"?"_removeClass":"addClass";t.model.allowSelection&&(t[i](t.getAutoFillElem()[0],"e-hide"),t[i](t.getFocusBottomElem()[0],"e-hide"),t[i](t.getFocusTopElem()[0],"e-hide"),t[i](t.getFocusLeftElem()[0],"e-hide"),t[i](t.getFocusRightElem()[0],"e-hide"))},_markHeaderSelection:function(n,t){var i,r,u=this.XLObj;if(n=u.swapRange(n),i=n[0],t==="row")for(r=n[2];i<=r;)u._isRowViewable(u.getActiveSheetIndex(),i)&&this._selectRow(u._getRowIdx(i),"e-rowselected"),i++;else for(i=n[1],r=n[3];i<=r;)this._selectColumn(i,"e-colselected"),i++},_processFormulaRange:function(n){var u,t=this.XLObj,f=t.getActiveSheetIndex(),i=t._dStartCell,r=t._dEndCell,e=t._getContent(f).find(".e-editedcell");this._focusBorder(i,r,n[t._ctrlKeyCount%6]);t.model.allowAutoFill&&(u=t._getAlphaRange(f,i.rowIndex,i.colIndex,r.rowIndex,r.colIndex),t.XLDragFill.hideAutoFillElement(),t.XLEdit._updateFormulaCellRange(u));t.XLEdit._isCellEdit?t.XLEdit._focusElements(e):t._getInputBox().focus()},_scrollCalculation:function(n,i,r){var s,c,e,o,f=this.XLObj,u,h;f.model.scrollSettings.allowVirtualScrolling||(u=f.getSheet(f.getActiveSheetIndex()),f.XLSelection._isEndReached=!0,s=setInterval(function(){if(e=f.XLScroll._hScroller(n),o=f.XLScroll._vScroller(n),!f.XLSelection._isEndReached){clearInterval(s);return}if(r.position==="horizontal")r.action=="Increment"?(c=Math.ceil(parseFloat(e.element.find(".e-hhandle").css("left")))+Math.ceil(parseFloat(e.element.find(".e-hhandle").width()))>=e.element.find(".e-hhandlespace").width()-2,c?f.model.scrollSettings.scrollMode!=t.Spreadsheet.scrollMode.Normal?f.XLScroll._scrollX(n):clearInterval(s):e.scroll(e.value()+u.columnWidth,!0),f.XLShape._shapeROStart||f.XLShape._shapeRSStart||(u._endCell.colIndex=u.colCount-1)):(h=e.value()-u.columnWidth,h<0&&(h=0),e.value()>=0&&e.scroll(h,!0),f.XLSelection._aFillDownHandler&&(u._endCell.colIndex=u._leftCol.idx),u._frozenColumns>1&&(u._startCell=u._activeCell,u._endCell.rowIndex=u.selectedRange[2]===u._startCell.rowIndex?u.selectedRange[0]:u.selectedRange[2],u._endCell.colIndex=u._fleftColIdx));else if(r.position==="vertical")if(r.action=="Increment")c=Math.ceil(parseFloat(o.element.find(".e-vhandle").css("top")))+Math.ceil(parseFloat(o.element.find(".e-vhandle").height()))>=o.element.find(".e-vhandlespace").height()-2,c?f.model.scrollSettings.scrollMode!=t.Spreadsheet.scrollMode.Normal?f.XLScroll._scrollY(n):clearInterval(s):o.scroll(o.value()+f.model.rowHeight,!0),f.XLShape._shapeROStart||f.XLShape._shapeRSStart||(u._endCell.rowIndex=u.rowCount-1);else if(h=o.value()-f.model.rowHeight,h<0&&(h=0),o.value()>0&&o.scroll(h,!0),!f.XLShape._shapeROStart&&!f.XLShape._shapeRSStart){if(u._topRow.idx<1&&u._ftopRowIdx+1===u._frozenRows)return;u._startCell=u._activeCell;u._endCell.rowIndex=u._frozenRows>1?u._ftopRowIdx:u._topRow.idx-1;u._endCell.colIndex=u._frozenRows>1?u.selectedRange[3]===u._startCell.colIndex?u.selectedRange[1]:u.selectedRange[3]:i.parentNode.cellIndex}f.XLShape._shapeROStart||f.XLShape._shapeRSStart||(f.XLSelection._aFillDownHandler?f.XLDragFill._selectAutoFillRange(null,u._endCell):f.XLSelection.selectRange(u._startCell,u._endCell))},200),f._browserDetails.name==="msie"&&f._browserDetails.version==="8.0"?(i.attachEvent("onmouseup",function(){clearInterval(s)}),document.attachEvent("onmouseup",function(){clearInterval(s)})):(i.addEventListener("mouseup",function(){clearInterval(s)}),document.addEventListener("mouseup",function(){clearInterval(s)})))},_cleanUp:function(n){var i,r,o=!1,u="e-hide",t=this.XLObj,f=t.getActiveSheetIndex(),s=t.getSheet(f),h=t.getFocusTopElem(),e=t.getSheetElement(f);for(t.model.allowAutoFill&&t.XLDragFill._autoFillCleanUp(),s._isSheetSelected&&!t.model.scrollSettings.allowVirtualScrolling&&(o=!0,e.detach()),r=e.find(".e-selected,.e-rowselected,.e-colselected,.e-rowhighlight,.e-colhighlight,.e-sheetselected,.e-activecell"),i=r.length;i--;)r[i].className=r[i].className.replace(new RegExp("e-activecell|e-selected|e-rowhighlight|e-colhighlight|e-rowselected|e-colselected|e-sheetselected","g"),"").replace(/ +/g," ");o&&t.getMainPanel(f).find(".e-spreadsheet-list").append(e);n&&h&&(t.addClass(h[0],u),t.addClass(t.getFocusRightElem()[0],u),t.addClass(t.getFocusBottomElem()[0],u),t.addClass(t.getFocusLeftElem()[0],u));s._selectedCells=[]},clearAll:function(n){this._cleanUp(!n)},_clearBorder:function(n){var t=this.XLObj;t._getContent(t.getActiveSheetIndex()).find("td[class *='border']").removeClass(n)}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.filter=function(n){this.XLObj=n;this._isSearchEdit=!1;this._isDecimal=!1;this._colName="";this._colType="";this._tableId=""};t.spreadsheetFeatures.filter.prototype={_renderExcelFilter:function(){var n=this.XLObj,i={instance:n,showSortOptions:n.model.allowSorting,maxFilterLimit:n.model.sheets[n.getActiveSheetIndex()].filterSettings.maxFilterChoices,filterHandler:t.proxy(this._filterHandler,this),cancelHandler:t.proxy(this._cancelHandler,this),customFilterHandler:t.proxy(this._customFilterHandler,this),enableComplexBlankFilter:!1,blankValue:"",interDeterminateState:!0};n._excelFilter=new t.excelFilter(i);n.element.append(t.buildTag("div#"+n._id+"_filter_custom.e-filterdlg.e-"+n._id+"-dlg","",{display:"none"}))},_customFilterHandler:function(){var t=this.XLObj;this._isDecimal&&(n("#"+t._id+"number_CustomValue1").ejNumericTextbox("option",{decimalPlaces:2}),n("#"+t._id+"number_CustomValue2").ejNumericTextbox("option",{decimalPlaces:2}))},_renderFilterDialogs:function(t){var i=this.XLObj;document.getElementById(i._id+"_filter_custom").className.indexOf("e-dialog")<0&&this._renderCustomFilter();i._excelFilter.renderDialog(t);this._refreshCustomFilter(t);i.element.find(".e-excelfilter.e-dlgcontainer").hide();n(document.body).append(n("#"+i._id+t+"_excelDlg"))},_createSelection:function(n,t,i,r){for(var f=this.XLObj,h=f.getSheet(n).usedRange.rowIndex,e=t,o,s,u=t;u<=h;u++){if(o=f.XLEdit.getPropertyValue(u,0,"isHide"),s=f.XLEdit.getPropertyValue(u,i,"value2",n),f.XLEdit.getPropertyValue(u,i,"tableName",n))break;if(!o&&!f.XLEdit.getPropertyValue(u,i,"isMHide")&&!s&&u>=t)return{endRowIndex:u,filteredIndex:r};!o&&s?(e=u+1,r.push(u)):e=e}return{endRowIndex:e,filteredIndex:r}},_getSelectedRangeData:function(n,i,r,u){var c,o=this.XLObj,s=0,w=o.getActiveSheetIndex(),l=o.getSheet(w),k=[],y,f,h,a,d=[],p,g,nt=[],v=o._dataContainer,e=v.sheets[w],b=o.getSheet(w)._multifilterIdx;for(r===-1&&(l.filterSettings.range=o._generateHeaderText(b[0]+1)+n.rowIndex+":"+o._generateHeaderText(b[b.length-1]+1)+(i.rowIndex+1)),l._multipleFiltering&&(i.colIndex=l._multifilterIdx[l._multifilterIdx.length-1]),f=n.rowIndex;f<=i.rowIndex;f++){for(c={},h=n.colIndex;h<=i.colIndex;h++)y=o._generateHeaderText(h+1),f in e&&(!(s in e[f])||s in e[f]&&t.isNullOrUndefined(e[f][s].isRHide)&&t.isNullOrUndefined(e[f][s].isFHide))&&(!(s in e[f])||s in e[f]&&(t.isNullOrUndefined(e[f][s].isFilterHide)||!t.isNullOrUndefined(e[f][s].isFilterHide)&&e[f][s].filterID===r))&&(c.idx=f,f in e&&h in e[f]?(a=e[f][h],h===u&&(p=o.XLEdit.getPropertyValue(f,h,"formats"),t.isNullOrUndefined(p)||(g={id:h,background:p["background-color"],foreground:p.color},d.push(g))),c[y]=t.isNullOrUndefined(v.sharedData[a.value])?"":o._isDateTime(v.sharedData[a.value])?a.value2:v.sharedData[o.isFormula(v.sharedData[a.value])?a.value2:a.value]):c[y]=""),!(f in e)&&f<i.rowIndex&&(c.idx=f,c[y]="");o.getObjectLength(c)>0&&(nt.push(c),k.push(f))}l._selectedCellColors=d;l._selectedRange={startRow:n.rowIndex,endRow:i.rowIndex,dataSourceIndexes:k};l.filterSettings.filteredRange=nt},_getColumnType:function(t,i,r,u){for(var o="string",e,s,f=i;f<r;f++)if(e=this.XLObj.XLEdit.getPropertyValue(f,u,"value",t),s=this.XLObj.XLEdit.getPropertyValue(f,u,"type",t),s!="text"&&n.isNumeric(e))this._isDecimal||(this._isDecimal=e%1!=0),o="number";else return"string";return o},_getColumnByField:function(n,t){for(var u=this.XLObj,r=u.getSheet(n),i=0;i<r.columns.length;i++)if(r.columns[i].field===t)break;return i===r.columns.length?null:r.columns[i]},_checkEmptyText:function(n){for(var r=this.XLObj,u=r.model.sheets[n]._selectedCells,i=0,f=u.length;i<f;i++)if(!t.isNullOrUndefined(r.XLEdit.getPropertyValue(u[i].rowIndex,u[i].colIndex,"value",n)))return!0;return r._showAlertDlg("Alert","Alert",null,440),!1},_getFilterIcon:function(){var n=t.buildTag("span .e-icon","",{});return n.addClass("e-spanfilter e-filterspan e-ssfilter"),n},filterByActiveCell:function(){var n=this.XLObj,i=n.getActiveSheetIndex(),r;if(n.model.allowFiltering&&!n.model.isReadOnly){var t=n.model.sheets[i]._activeCell,u=n.getCell(t.rowIndex,t.colIndex),f=n.model.sheets[i]._selectedCells;this._checkEmptyText(i)&&(u.find("span").is(".e-ssfiltered, .e-ssfilter, .e-ssfilter-asc, .e-ssfiltered-asc, .e-ssfilter-dsc, .e-ssfiltered-dsc")?n._showAlertDlg("Alert","HeaderAlert","",440):(r=n.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"value",i),r=n._isDateTime(r)?n.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"value2",i):r,this._filterActiveCell(i,t,f,r)))}},_filterActiveCell:function(n,t,i,r,u){var f=this.XLObj,e=f.getSheet(n);e._activeCell=t;this._filterByValue(n,u,e.columns[t.colIndex].field,"or","equal",r,i);f.model.allowComments&&f.XLComment._updateCmntArrowPos();f.model.isGridMode&&f._isAutoWHMode&&f._setElemDimension()},_filterByValue:function(i,r,u,f,e,o,s){var c=this.XLObj,a,p,k,tt,it,d,g=-1,l,rt,w,ft,h,v,ut=c.XLEdit.getColumnIndexByField(u),y=c.getSheet(i),b,nt;if(t.isNullOrUndefined(r)?s=s:(a=c.getRangeIndices(r),s=c._getSelectedRange({rowIndex:a[0]+1,colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]})),p=s[0],!t.isNullOrUndefined(r)&&(w=c.XLEdit.getPropertyValue(p.rowIndex,p.colIndex,"value2",i),t.isNullOrUndefined(w)||w!==o))for(l=a[0];l<a[2];l++)if(w=c.XLEdit.getPropertyValue(l,ut,"value2",i),!t.isNullOrUndefined(w)&&w===o){p={rowIndex:l,colIndex:ut};break}for(v={currentFilteringColumn:u,action:"filter",predicated:f,requestType:"filterbycell",reqType:"filter",filteredValue:o,selCells:n.extend(!0,[],s),activeCell:p},h=this._applyFilterByValue(i,p,s,o),c._excelFilter._predicates[i]={},k={field:u,value:o,predicate:f,operator:e,matchcase:!1},{}.currentFilterCollection=o,c._excelFilter._predicates[i][u]=t.Predicate(u,e,o),y.filterSettings.filteredColumns.push(k),tt=t.DataManager(y.filterSettings.filteredColumns),it=(new t.Query).where("field",t.FilterOperators.equal,u),d=tt.executeLocal(it),l=0,rt=d.length;l<rt;l++)g=n.inArray(d[l],y.filterSettings.filteredColumns),g>-1&&y.filterSettings.filteredColumns.splice(g,1);if(y.filterSettings.filteredColumns.push(k),v.filteredcolumns=h.filteredColumns=y.filterSettings.filteredColumns,h.filteredColumns.length<1)for(b=h.multifilterIdx,l=b[0];l<=b[b.length-1];l++)nt=c._generateHeaderText(l+1),t.isNullOrUndefined(h.fColumns[nt])||(h.fColumns[nt]=[]);else h.fColumns[u]=n.extend(!0,[],h.filteredColumns);h.predicate=c._excelFilter._predicates[i];v.tableID=h.tableID;v.filteredCells=h.filteredCells;c.XLSelection._refreshBorder();v.operation="filterbycell";v.selRange=c._getAlphaRange(i,h.startRow-1,h.multifilterIdx[0],h.endRow,h.multifilterIdx[h.multifilterIdx.length-1]);c._processBindings(v)&&(y.filterSettings.filteredColumns=ft)},_applyFilterByValue:function(i,r,u){var c=this.XLObj,e=c.getSheet(i),k=[],v,h,y,it,a,s=e.filterSettings.tableRange,rt=[],o,l,ut=!1,g,f,w,p,nt=c.getSheet(i)._filterColl,b,d,tt;for(a=c.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tableName",i),a=a?c._getTableID(a):-1,f=0,p=s.length;f<p;f++)if(s[f].tableID===a){l=f;break}if(!t.isNullOrUndefined(l)&&s[l].tableID===a&&s[l].selectedCellIndexes.indexOf(r.colIndex)!==-1&&s[f].startRow<=r.rowIndex&&s[f].endRow>=r.rowIndex)o=s[l],e.filterSettings.filteredRange=s[l].filteredRange,e._selectedRange=s[l].selectedRange,o.action="filtering";else{for(e._multipleFiltering=!1,e._multifilterIdx=[],c._dupDetails=!0,this.clearFilter("remove"),c._dupDetails=!1,b=c.getObjectKeys(nt),f=b.length-1;f>=0;f--)for(d=c.getObjectKeys(nt[f]),w=d.length-1;w>=0;w--)c._isRowViewable(i,b[f])&&(tt=c.getCell(b[f],d[w]),tt.find(".e-filterspan").remove(),tt.removeClass("e-filterhdr")),delete nt[b[f]][d[w]];if(u.length<2||u[0].rowIndex===u[u.length-1].rowIndex){for(h=-1,y=u[u.length-1].rowIndex,f=u[0].rowIndex;f>=0;f--)if(t.isNullOrUndefined(c.XLEdit.getPropertyValue(f,u[0].colIndex,"value2"))){h=f;break}h=h===-1?1:h+2;y=this._createSelection(i,y,u[0].colIndex,[]).endRowIndex-1;v={rowIndex:y,colIndex:r.colIndex};this._getSelectedRangeData({rowIndex:h,colIndex:r.colIndex},v,-1,r.colIndex)}else h=r.rowIndex,y=this._createSelection(i,u[u.length-1].rowIndex,u[0].colIndex,[]).endRowIndex-1,v={rowIndex:y,colIndex:r.colIndex},this._getSelectedRangeData({rowIndex:h,colIndex:r.colIndex},v,-1,r.colIndex);for(f=u[0].colIndex,p=u[u.length-1].colIndex;f<=p;f++)k.push(f),it=this._getFilterIcon(),h=h===0?1:h,g={rowIndex:h-1,colIndex:f},this._applyFilterIcon(g,it),rt.push(g);for(c.XLScroll._getColWidths(i,u[0].colIndex),k.length>1&&(e._multipleFiltering=!0),e._multifilterIdx=k,e._selectedCellIndexes=k,f=0,p=s.length;f<p;f++)if(s[f].tableID===a){l=f;ut=!0;break}ut?(o=s[l],o.startRow=r.rowIndex,o.endRow=v.rowIndex,o.multiFiltering=e._multipleFiltering,o.multifilterIdx=e._multifilterIdx,o.selectedCellIndexes=e._multifilterIdx,o.selectedRange=n.extend(!0,{},e._selectedRange),o.filteredRange=n.extend(!0,{},e.filterSettings.filteredRange),o.hiddenIdx=[],o.flterdIdxes=[],o.fColumns={},o.tableID=a,o.filterCollection=[],o.action="filtering"):(e.filterSettings.tableRange.push({action:"filtering",filterCollection:[],startRow:h,endRow:v.rowIndex,tableID:-1,fColumns:{},flterdIdxes:[],multiFiltering:e._multipleFiltering,multifilterIdx:e._multifilterIdx,selectedCellIndexes:e._multifilterIdx,selectedRange:n.extend(!0,{},e._selectedRange),filteredRange:e.filterSettings.filteredRange,hiddenIdx:[]}),o=s[s.length-1]);o.filteredCells=rt}return o},clearFilter:function(i){var r=this.XLObj,k;if(!r.model.isReadOnly){var d=!1,g=!1,f=r.getActiveSheetIndex(),a,nt,v=r.getSheet(f),y=n.extend(!0,{},v._filterColl),ft=r._dupDetails,tt,l=v.filterSettings.tableRange,p=-1,u,e,it,rt=[],b=r._dataContainer.sheets[f],o,h,c=r.getObjectKeys(y),s,w,ut=[],et=v.filterSettings.filteredRange,ot=v.filterSettings.filteredColumns;if(l.length){for(u=0;u<l.length;u++)if(l[u].tableID===-1){p=u;g=!0;break}if(g){for(tt=l[p].selectedRange,u=c.length-1;u>=0;u--)for(s=r.getObjectKeys(y[c[u]]),e=s.length-1;e>=0;e--)o=parseInt(c[u]),h=parseInt(s[e]),t.isNullOrUndefined(r.XLEdit.getPropertyValue(o,h,"tableName",f))&&(rt.push({rowIndex:o,colIndex:h}),nt=y[c[u]][s[e]],nt.status.indexOf("e-ssfiltered")>-1&&(a=r.model.sheets[f].columns[s[e]].field,ut.push({fieldName:a,filterCollection:l[p].filterCollection,action:"filtering",tableID:-1,predicate:r._excelFilter._predicates[f][a]}),delete r._excelFilter._predicates[f][a],r._dupDetails=!0,this._clearFilterColumn(a,"","","Or","","",-1),r._dupDetails=!1,d=!0),i==="remove"&&(delete y[c[u]][s[e]],delete b[c[u]][s[e]].isFilterHeader,delete b[c[u]][s[e]].filterState,delete b[c[u]][s[e]].isFilterVisible,r._isRowViewable(f,o)&&(w=r.getCell(o,h),n.isNumeric(r.XLEdit.getPropertyValue(o,h))&&w.addClass(r._rAlign),w.find(".e-filterspan").remove(),r.addClass(w[0],"e-wrapword"),r.XLEdit.getPropertyValue(o,h,"isFilterWrap")&&r.setWrapText("wrap",r._getAlphaRange(f,o,h,o,h)),r._removeClass(w[0],"e-filterhdr"))));i==="remove"&&(r._dupDetails=ft,v._filterColl=y,p>-1&&(it=l.splice(p,1)[0]),r.model.allowComments&&r.XLComment._updateCmntArrowPos(),r._isUndoRedo||r._dupDetails||(k={sheetIndex:f,operation:"remove-filter",status:i,process:"apply-filter",filteredCells:rt,requestType:"filter",reqType:"filter",fRange:r.getSheet(f).filterSettings.range,filterRange:it,filterCollection:ut,filteredCols:ot,fltrdRange:et,selRange:tt},r._completeAction(k),r._trigActionComplete(k)));d&&n("#"+r._id+"_Ribbon_Data_SortFilter_ClearFilter").ejButton("disable")}}}},filter:function(n){var i=this.XLObj;if(i.model.allowFiltering&&!i.model.isReadOnly){var f=i.getActiveSheetIndex(),u=i.getSheet(f),o=!1,y=u._activeCell,e,l,h=u.filterSettings.tableRange,a,r,c,p,v,s;for(u._multipleFiltering=!1,u._multifilterIdx=[],e=i.XLEdit.getPropertyValue(y.rowIndex,y.colIndex,"tableName",f),t.isNullOrUndefined(e)||(e=i._getTableID(e)),r=0,c=h.length;r<c;r++)h[r].tableID===-1&&(o=!0),a=r;if(s={range:i._getRangeArgs(n,"string"),reqType:t.Spreadsheet.Actions.Filtering,sheetIndex:f},i._trigActionBegin(s))return!0;if(n=s.range,o&&(this.clearFilter("remove"),u.filterSettings.filteredRange=[],u._selectedRange={},u._selectedCellIndexes=[],u.filterSettings.filteredColumns=[],i._excelFilter._predicates[f]={}),!t.isNullOrUndefined(e)&&e>-1){for(p=h[a].startRow,l=h[a].multifilterIdx,r=0,c=l.length;r<c;r++)v=this._getFilterHeader(f,p,l[r]),!t.isNullOrUndefined(v)&&v.status.indexOf("e-ssfiltered")>-1&&this._clearFilterColumn(u.columns[r].field,"","","","","",e);this._clearFilterTableIcon(f,e);o=!0}if(o){if(s={sheetIdx:f,reqType:"clear-Filter"},i._trigActionComplete(s))return}else this._filterCellRange(f,n);i._isFiltered=!o;i.model.allowComments&&i.XLComment._updateCmntArrowPos()}},_applyFilterIcon:function(n,t){var f,r=this.XLObj,c=this.XLObj._rAlign,e=r.getActiveSheetIndex(),i=n.rowIndex,u=n.colIndex,l=r.getSheet(e),s=r._isRowViewable(e,i),o=l._filterColl,h=!1;s&&(f=r.getCell(i,u,e),f[0].insertBefore(t[0],f[0].childNodes[f[0].childNodes.length-1]),f.addClass("e-filterhdr"),f.removeClass("e-ralign"));r.XLEdit.getPropertyValue(i,u,"wrap",e)&&(h=!0,r.setWrapText("unwrap",r._getAlphaRange(e,i,u,i,u)));r.XLEdit._updateDataContainer({rowIndex:i,colIndex:u},{dataObj:{isFilterHeader:!0,filterState:"filter",isFilterVisible:!0,isFilterWrap:h},sheetIdx:e});r.isNumber(r.model.allowFiltering&&r.XLEdit.getPropertyValue(i,u,"value2",e))&&s&&r._removeClass(f[0],c);i in o||(o[i]={});u in o[i]||(o[i][u]={});o[i][u].status="e-ssfilter";o[i][u].isTable=t[0].className.indexOf("e-ft")>-1},_filterCellRange:function(n,i){var f=this.XLObj,u,w=!1,tt,it,b,rt,k=[],s=-1,ut=!1,ft=0,et,e,h,a,ot,y,v,p,o,r=f.getSheet(n),st=[],ht=!1,c,l=[],d=[],g=!1,nt={sheetIndex:n,reqType:"filter",operation:"apply-filter"},ct={sheetIndex:n,range:i,reqType:"filter",type:"actionBegin",action:"filtercellrange"};if(!f._trigActionBegin(ct)){if(i=ct.range,t.isNullOrUndefined(i)){if(!f.model.allowSelection)return;u=r._selectedCells}else y=f.getRangeIndices(i),u=f._getSelectedRange({rowIndex:y[0],colIndex:y[1]},{rowIndex:y[2],colIndex:y[3]});if(u.length<2&&(c=u,t.isNullOrUndefined(i)||f.performSelection(i,n),f.selectAll(!1),u=r._selectedCells,ht=!0),f.XLRibbon._dirtySelect(),!f.XLRibbon._isDirtySelect&&u.length!=0){for(e=u[0].colIndex,a=u[u.length-1].colIndex;e<=a;e++){if(k.push(e),s=u[0].rowIndex,ht)r._isSheetSelected||(l.push(e),r._multifilterIdx.push(e),w=!0);else{if(!ut||k.length>0)for(h=s,ot=u[u.length-1].rowIndex;h<=ot;h++)rt=f._isRowVisible(n,h),rt&&(f.XLEdit.getPropertyValue(h,e,"value2",n)||l.length&&f.XLEdit.getPropertyValue(0,e,"isCHide",n))&&((s===-1||s>h)&&(s=h),ut=!0,w=!0,g=!0),s<h&&ft===0&&st.push(h);g&&(l.push(e),r._multifilterIdx.push(e),g=!1)}ft++}if(l.length>1&&(r._multipleFiltering=!0),d=[],w){for(e=0,a=l.length;e<a;e++)et=this._getFilterIcon(),this._applyFilterIcon({rowIndex:s,colIndex:l[e]},et),d.push({rowIndex:s,colIndex:l[e]});for(v={rowIndex:s+1,colIndex:u[0].colIndex},p={rowIndex:u[u.length-1].rowIndex},r._selectedRange={startRow:v.rowIndex,endRow:p.rowIndex,dataSourceIndexes:st},this._getSelectedRangeData(v,u[u.length-1],-1,v.colIndex),r._selectedCellIndexes=k,nt={sheetIndex:n,filteredCells:d,reqType:"filter",operation:"apply-filter",tableID:-1,type:"actionBegin"},b=r.filterSettings.tableRange,e=0,a=b.length;e<a;e++)b[e].tableID===-1&&(tt=!0,it=e);tt?(o=r.filterSettings.tableRange[it],o.startRow=v.rowIndex,o.endRow=p.rowIndex,o.multiFiltering=r._multipleFiltering,o.multifilterIdx=r._multifilterIdx,o.selectedCellIndexes=r._multifilterIdx,o.selectedRange=r._selectedRange,o.filteredRange=r.filterSettings.filteredRange,o.filteredColumns=r.filterSettings.filteredColumns,o.predicate=f._excelFilter._predicates[n],o.hiddenIdx=[],o.flterdIdxes=[],o.fColumns={},o.filterColumnName=[],o.filterCollection=[]):r.filterSettings.tableRange.push({filterCollection:[],startRow:v.rowIndex,endRow:p.rowIndex,tableID:-1,multiFiltering:r._multipleFiltering,multifilterIdx:r._multifilterIdx,selectedCellIndexes:r._multifilterIdx,selectedRange:r._selectedRange,filteredRange:r.filterSettings.filteredRange,filteredColumns:r.filterSettings.filteredColumns,fColumns:{},predicate:{},hiddenIdx:[],fltrdIdxes:[],filterColumnName:[]});f.XLScroll._getColWidths(n,r._multifilterIdx[0]);r._isImported&&!r._isLoaded||f._isExport||(i=c?[c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex]:f.isUndefined(i)?[u[0].rowIndex,u[0].colIndex,u[u.length-1].rowIndex,u[u.length-1].colIndex]:f.getRangeIndices(i),f._completeAction(nt),f._trigActionComplete(nt),t.isNullOrUndefined(i)||f.performSelection(i,n))}else f._showAlertDlg("Alert","Alert","",440)}}},openFilterDialog:function(n){var t,i=this.XLObj;i.model.isReadOnly||(typeof n=="string"&&(n=i.getRangeIndices(n)),t=i.getCell(n[0],n[1]).find("span.e-filterspan"),t.length>0&&this._filterClickHandler({target:t[0]}))},_filterClickHandler:function(i){var r=this.XLObj,tt,it,w=n(i.target),o=r.getActiveSheetIndex(),e=r.getSheet(o),st=!1,c,y,b,ht,u,l,rt,ut,a,ft,h,s,f,ct=[],lt={},et,ot,k,v,p,d,g,nt=["showItems","hideItems"];if(y=r._generateHeaderText(i.target.parentNode.cellIndex+1),this._isDecimal=!1,(!r.model.allowLockCell||!r.getSheet(o).isSheetProtected)&&!r.preventFilterPopup){if(w[0].className.indexOf("e-ssfiltered")>-1&&(st=!0),a=i.target.parentNode.cellIndex,w[0].className.indexOf("e-ssfilter")>-1){for(f=r.model.sheets[o].filterSettings.tableRange,tt=r._getCellIdx(w.parent()[0]),it=r.XLEdit.getPropertyValue(tt.rowIndex,tt.colIndex,"tableName"),h=t.isNullOrUndefined(it)?-1:parseInt(it.replace("e-table","")),u=0,l=f.length;u<l;u++)f[u].tableID===h&&(v=u,f[u].multiFiltering?(rt=f[u].multifilterIdx[0],ut=f[u].multifilterIdx[f[u].multifilterIdx.length-1]):rt=ut=i.target.parentNode.cellIndex,ot={rowIndex:f[u].startRow,colIndex:rt},k={rowIndex:f[u].endRow,colIndex:ut},e._multipleFiltering=f[u].multiFiltering,e._multifilterIdx=f[u].multifilterIdx,s=e._selectedRange=f[u].selectedRange,e.filterSettings.filteredRange=f[u].filteredRange,e._selectedCellIndexes=f[u].selectedCellIndexes);if(h===-1){if(p=this._createSelection(o,s.endRow,a,s.dataSourceIndexes),c=p.endRowIndex>s.endRow?p.endRowIndex-1:p.endRowIndex,s.endRow!=c)for(u=s.endRow+1;u<=c;u++)ft={field:y,value:r.XLEdit.getPropertyValue(u,a,"value2",o),matchcase:!1,operator:"equal",predicate:"or"},e.filterSettings.filteredColumns.push(ft),f[v].filteredColumns.push(ft),f[v].selectedRange.endRow=c;k={rowIndex:c,colIndex:a};f[v].selectedRange=e._selectedRange={startRow:ot.rowIndex,endRow:k.rowIndex,dataSourceIndexes:p.filteredIndex};f[v].endRow=c}for(this._getSelectedRangeData(ot,k,h,a),b=e.columns,ht=this._getColumnType(o,s.startRow,s.endRow,a),u=0,l=b.length;u<l;u++)if(b[u].field===y){r._$colType=ht;r._$curFieldName=b[u].field;break}for(r._showDialog(r._id+"_Filter",r._$colType),et=r._getXYPos(w,n("#"+r._id+r._$colType+"_excelDlg"),18,18),f=r.model.sheets[o].filterSettings.tableRange,u=0,l=f.length;u<l;u++)f[u].tableID===h&&(ct=f[u].filteredColumns,lt=f[u].predicate);r._excelFilter._predicates[o]=lt;this._isSearchEdit=!0;n.extend(!0,r._excelFilter._columnsFiltered,e._filteredColumns);r._phoneMode||r._tabMode?this._openNormalFilterDlg(y,r._$colType,h,v):r._excelFilter.openXFDialog({field:y,dataSource:e.filterSettings.filteredRange?e.filterSettings.filteredRange:e.dataSource,position:{X:et.xPos,Y:et.yPos},type:r._$colType,format:r._$colFormat,filteredColumns:ct,sortedColumns:[],key:o,tableID:h,selectedColors:e._selectedCellColors,isFiltered:st,blank:"",enableColor:!0,filteredByColor:e._filteredByColor})}d=n("#"+r._id+"string_MenuItem").data("ejMenu");g=n("#"+r._id+"number_MenuItem").data("ejMenu");d&&d[r.model.allowSorting?nt[0]:nt[1]](d.element.find("li:lt(4)"));g&&g[r.model.allowSorting?nt[0]:nt[1]](g.element.find("li:lt(4)"))}},_cancelHandler:function(){this._isSearchEdit=!1},applyFilter:function(n){var i=this.XLObj,f=n.predicate||t.Predicate(n.field,n.operator,n.value,!n.matchcase),u=[],r=i.getActiveSheetIndex();i._isFiltered||i.XLFilter.filter(n.filterRange);t.isNullOrUndefined(i._excelFilter._predicates[r])&&(i._excelFilter._predicates[r]={},i._excelFilter._predicates[r][n.field]={});i._excelFilter._predicates[r][n.field]=f;n.filterCollection?u=n.filterCollection:u.push({actualFilterOperator:n.operator,actualFilterValue:n.value,actualPredicate:n.predicate,field:n.field,isCustom:!0,matchcase:n.matchcase,operator:n.operator,predicate:n.predicate,value:n.value});this._filterHandler({action:"filtering",fieldName:n.field,tableID:n.tableID||-1,ejpredicate:f,filterCollection:u})},_filterHandler:function(i){var d,b,it,s,k,y,rt,ut,ft;if(!i.originalEvent||(d=i.originalEvent.target.parentElement.className,!d||!(d.indexOf("hdr")>-1))){var f,v,e,et=!1,o=-1,g,h,u={},ot,r=this.XLObj,a=r.getActiveSheetIndex(),l=r.getSheet(a),st,nt,tt,c=[],p={},w,ht=l.columnsWidthCollection[l.colCount-1],ct=r.element.find("#vscrollBar").width();for(u.requestType=i.action==="sorting"||i.action==="filterbycolor"?i.action:"filtering",e=l.filterSettings.tableRange,r.XLFilter._isSearchEdit=!1,f=0,v=e.length;f<v;f++)e[f].tableID===i.tableID&&(n.extend(!0,c,e[f].filteredColumns),p=e[f].predicate,et=!0,o=f);if(i.action==="clearfiltering"&&i.reqType==="filterbycolor"&&(u.requestType=e[o].action),u.tableID=i.tableID,i.action==="filtering"||i.action==="clearfiltering"){for(u.rowIndex=e[o].startRow-1,u.colIndex=r._generateColCount(i.fieldName)-1,ot=t.DataManager(c),st=(new t.Query).where("field",t.FilterOperators.equal,i.fieldName),nt=ot.executeLocal(st),u.filteredColumns=c,f=0,v=nt.length;f<v;f++)tt=n.inArray(nt[f],c),tt>=0&&c.splice(tt,1);i.action==="clearfiltering"?delete r._excelFilter._predicates[a][i.fieldName]:t.merge(c,i.filterCollection);p=r._excelFilter._predicates[a]}if(et)if(e[o].filteredColumns=c,e[o].filterCollection=i.filterCollection,e[o].predicate=p,e[o].action=i.action,c.length<1)for(b=e[o].multifilterIdx,f=b[0];f<=b[b.length-1];f++)it=r._generateHeaderText(f+1),t.isNullOrUndefined(e[o].fColumns[it])||(e[o].fColumns[it]=[]);else e[o].fColumns[i.fieldName]=n.extend(!0,[],c);if(h=l.filterSettings.tableRange[o].selectedRange,s=l.filterSettings.tableRange[o].selectedCellIndexes,k=l._filterColl,i.action==="filtering"||i.action==="clearfiltering")u.currentFilteringColumn=i.fieldName,u.ejpredicate=i.ejpredicate,u.filterCollection=n.extend(!0,[],i.filterCollection),u.action=i.action,u.reqType=u.requestType==="filterbycolor"?u.requestType:"filter",u.sheetIndex=a,u.filteredcolumns=c,u.predicate=p;else if(i.action==="sorting"){if(!r.model.allowSorting)return;if(u.requestType=u.action=i.action,g=r.XLEdit.getColumnIndexByField(i.sortDetails.field),r.XLSort._isSortByFilter=!0,r.XLSort.sortByRange(r.swapRange([h.startRow,s[0],h.endRow,s[s.length-1]]),i.sortDetails.field,i.sortDetails.direction,i.tableID))return;for(this._changeSortIcon({rowIndex:h.startRow-1,colIndex:g},i.sortDetails.direction),f=0,v=s.length;f<v;f++)s[f]!=g&&(k[h.startRow-1][s[f]].status.indexOf("-asc")>-1||k[h.startRow-1][s[f]].status.indexOf("-dsc")>-1)&&(k[h.startRow-1][s[f]].status="e-ssfilter",r._isRowViewable(a,h.startRow-1)&&(w=r.getCell(h.startRow-1,s[f]).find(".e-filterspan")[0],r._removeClass(w,"e-ssfilter-asc"),r._removeClass(w,"e-ssfilter-dsc"),r.addClass(w,"e-ssfilter")))}else{if(u.requestType=u.action=i.action,u.range=l._selectedRange,r.model.allowSorting&&r.XLSort._sortRangeAlert([h.startRow,s[0],h.endRow,s[s.length-1]]))return;i.action==="sortbycolor"?(u.sortColumn=i.sortDetails.field,u.operation=i.sortDetails.operation,y=i.sortDetails.color.replace("rgb(","").replace(")","").split(",")):(r._isUndoRedo?(u.filterColumn=i.columnName,u.operation=i.operation):(u.filterColumn=i.filterDetails.field,u.operation=i.filterDetails.operation,y=i.filterDetails.color.replace("rgb(","").replace(")","").split(",")),u.tableID=i.tableID,r.model.sheets[a]._filteredByColor=u.filterColumn);r._isUndoRedo||(rt=y[0],ut=y[1],ft=y[2]);u.operation==="sortbgcolor"||u.operation==="filterbgcolor"?u.bgcolor=r._isUndoRedo?i.bgcolor:this._convertrgbtohex(parseInt(rt),parseInt(ut),parseInt(ft)):u.fgcolor=r._isUndoRedo?i.fgcolor:this._convertrgbtohex(parseInt(rt),parseInt(ut),parseInt(ft))}u.oprType="filter";u.selRange=r._getAlphaRange(a,e[o].startRow-1,e[o].multifilterIdx[0],e[o].endRow,e[o].multifilterIdx[e[o].multifilterIdx.length-1]);i.action!=="sorting"&&r._processBindings(u);i.action==="clearfiltering"&&(r.XLRibbon._isFilterSelect.status=!1);r.model.allowComments&&r.XLComment._updateCmntArrowPos();r.model.allowSelection&&r.XLSelection._refreshBorder();r.model.showRibbon&&r.XLRibbon._refreshRibbonIcons();r._isFrozen(r.getFrozenRows())&&r.XLFreeze._refreshFreezeRowDiv();r.model.isGridMode&&(r._isAutoWHMode&&r._setElemDimension(),r.model.scrollSettings.allowScrolling&&(r.element.find("#vscrollBar")[0].style.display!="none"||r._isGridModeWidthChange?r._isGridModeWidthChange&&(r.setWidthToColumns([{colIndex:l.colCount-1,width:ht-ct}]),r._isGridModeWidthChange=!1):(r.getSheetElement(a).find(".e-spreadsheetheader").removeClass("e-scrollcss"),r.setWidthToColumns([{colIndex:l.colCount-1,width:ht+ct}]),r._isGridModeWidthChange=!0)))}},_convertrgbtohex:function(n,t,i){return"#"+(16777216+(n<<16)+(t<<8)+i).toString(16).slice(1)},_clearFilterColumn:function(i,r,u,f,e,o,s){var c=this.XLObj,v,l={},h,k,w=c.getActiveSheetIndex(),a=c.getSheet(w),it=!1,d={},rt,ut,g,nt,y=a.filterSettings.tableRange,p=[],tt,b,ft;for(l.requestType=t.Grid.Actions.Filtering,l.currentFilterObject=[],Array.isArray(r)||(r=n.makeArray(r)),Array.isArray(u)||(u=n.makeArray(u)),this._currentFilterColumn=this._getColumnByField(w,i),b=0,ft=r.length;b<ft;b++)if(d={field:i,operator:r[b],value:u[b],matchcase:e,predicate:f,actualFilterValue:o},!it){for(h=0,k=y.length;h<k;h++)y[h].tableID===s&&(v=y[h],n.extend(!0,p,y[h].filteredColumns),c._excelFilter._predicates[w]=y[h].predicate,a.filterSettings.filteredRange=a.filterSettings.tableRange[h].filteredRange,a._selectedCellIndexes=y[h].selectedCellIndexes,a._selectedRange=y[h].selectedRange,a._multifilterIdx=y[h].multifilterIdx);for(rt=t.DataManager(p),ut=(new t.Query).where("field",t.FilterOperators.equal,d.field),g=rt.executeLocal(ut),h=0,k=g.length;h<k;h++)nt=n.inArray(g[h],p),nt!==-1&&p.splice(nt,1)}(tt=n.inArray(i,a._filteredColumns),tt>-1&&a._filteredColumns.splice(tt,1),c._isUndoRedo&&c.isUndefined(v))||(it=!0,delete c._excelFilter._predicates[w][i],v.filteredColumns=p,v.predicate=c._excelFilter._predicates[w],l.currentFilterObject.push(d),l.filterCollection=p,l.currentFilteringColumn=i,l.filteredcolumns=p,l.action="clearfiltering",l.reqType="filter",l.tableID=s,l.selRange=c._getAlphaRange(w,v.startRow-1,v.multifilterIdx[0],v.endRow,v.multifilterIdx[v.multifilterIdx.length-1]),c._processBindings(l)&&(a.filterSettings.filteredColumns.reverse().splice(0,r.length),a.filterSettings.filteredColumns.reverse()),c.model.allowComments&&c.XLComment._updateCmntArrowPos(),c.model.allowSelection&&c.XLSelection._refreshBorder())},_getFilterHeader:function(n,i,r){var f=this.XLObj,e=f.getSheet(n),u=e._filterColl;if(!t.isNullOrUndefined(u[i])&&!t.isNullOrUndefined(u[i][r]))return u[i][r]},_filterTable:function(i,r,u){var c=this.XLObj,e=c.getSheet(i),l=[],y=!1,p=!1,s,a,w,v,h,o,f,b;for(e._multipleFiltering=!1,e._multifilterIdx=[],h=u?u.endCell:n.extend(!0,{},e._endCell),o=u?u.startCell:n.extend(!0,{},e._startCell),f=o.colIndex;f<=h.colIndex;f++)v=this._getFilterHeader(i,o.rowIndex,f),!t.isNullOrUndefined(v)&&v.status.indexOf("e-ssfilter")>-1?y=!0:(a=this._getFilterIcon(),w="e-ft"+r,a.addClass(w),this._applyFilterIcon({rowIndex:o.rowIndex,colIndex:f},a),l.push(f),e._multifilterIdx.push(f));if(c.XLScroll._getColWidths(i,o.colIndex),!y)if(l.length>1&&(e._multipleFiltering=!0,p=!0),o.rowIndex=o.rowIndex+1,this._getSelectedRangeData(o,h,r,o.colIndex),c._isFATResize){if(s=e.filterSettings.tableRange,b=s.length,s.length)for(f=0;f<b;f++)if(s[f].tableID===r){s[f].endRow=h.rowIndex;break}c._isFATResize=!1}else e.filterSettings.tableRange.push({filterCollection:[],startRow:o.rowIndex,endRow:h.rowIndex,tableID:r,multiFiltering:p,multifilterIdx:l,selectedCellIndexes:l,selectedRange:n.extend(!0,{},e._selectedRange),filteredRange:e.filterSettings.filteredRange,filteredColumns:e.filterSettings.filteredColumns,fColumns:{},predicate:{},hiddenIdx:[],filterColumnName:[]})},_clearFilterTable:function(n,t,i){var e=this.XLObj.getSheet(n?n:this.getActiveSheetIndex()),u,r,f;for(u=e.filterSettings.tableRange,r=0,f=u.length;r<f;r++)u[r].tableID===t&&(this._clearAllFilter(n,r,i),f=u.length)},_clearAllFilter:function(i,r,u){var s=this.XLObj,a=s._dataContainer.sheets[i],c=s.getSheet(i),h=c.filterSettings.tableRange,l,y,f,p,w,e,o,v;for(c._selectedRange=h[r].selectedRange,e=h[r].multifilterIdx,o=h[r].startRow,f=0,p=e.length;f<p;f++)w=c.columns[e[f]].field,v=s.XLEdit.getPropertyValue(o-1,e[f],"filterState"),!t.isNullOrUndefined(v)&&v.indexOf("filtered")>-1&&this._clearFilterColumn(w,"","","Or","","",h[r].tableID),u||(s._isRowViewable(i,o-1)&&(l=s.getCell(o-1,e[f]),s.addClass(l[0],"e-wrapword"),y=l.find(".e-filterspan"),n(y).remove(),l.removeClass("e-filterhdr")),a[o-1][e[f]]&&(delete a[o-1][e[f]].isFilterHeader,delete a[o-1][e[f]].filterState),delete c._filterColl[o-1][e[f]]);u||h.splice(r,1)},_clearFilterTableIcon:function(n,t){for(var i=this.XLObj,h,c,l=i.getSheet(n),u=l.filterSettings.tableRange,e,o,f,a,s,r=0,v=u.length;r<v;r++)if(u[r].tableID===t)for(l._selectedRange=u[r].selectedRange,l.filterSettings.filteredRange=u[r].filteredRange,e=u[r].multifilterIdx,o=u[r].startRow,f=0,a=e.length;f<a;f++)h=i.XLEdit.getPropertyValue(o-1,e[f],"isFilterVisible"),i._isRowViewable(n,o-1)&&(s=i.getCell(o-1,e[f]),c=s.find(".e-filterspan"),h?(c.hide(),i._removeClass(s[0],"e-filterhdr")):(i.addClass(s[0],"e-filterhdr"),c.show())),i.XLEdit._updateDataContainer({rowIndex:o-1,colIndex:e[f]},{dataObj:{isFilterVisible:!h}})},_insertFilterIcon:function(n,t,i){var r;r=this._getFilterIcon();i.tableID>-1&&this.XLObj.XLEdit._updateDataContainer({rowIndex:n,colIndex:t},{dataObj:{tableName:"e-table"+i.tableID}});this._applyFilterIcon({rowIndex:n,colIndex:t},r)},_changeFilterIcon:function(n,t,i){var f,s,h,c=!1,r=this.XLObj,u=n.rowIndex,e=n.colIndex,l=r._rAlign,o=r.getActiveSheetIndex();h=this._getFilterHeader(o,u,e).status;r._isRowViewable(o,u)&&(s=r.getCell(u,e),f=s.find(".e-filterspan")[0],s.removeClass(l),c=!0);t==="filter"?i.indexOf("filtered")<0&&(r.XLEdit._updateDataContainer({rowIndex:u,colIndex:e},{dataObj:{filterState:i.replace("filter","filtered")}}),r.getSheet(o)._filterColl[u][e].status=h.replace("e-ssfilter","e-ssfiltered"),c&&(f.className=f.className.replace("e-ssfilter","e-ssfiltered"))):(r.XLEdit._updateDataContainer({rowIndex:u,colIndex:e},{dataObj:{filterState:i.replace("filtered","filter")}}),r.getSheet(o)._filterColl[u][e].status=h.replace("e-ssfiltered","e-ssfilter"),c&&!r.isUndefined(f)&&(f.className=f.className.replace("e-ssfiltered","e-ssfilter")))},_changeSortIcon:function(n,t){var u=this.XLObj,h=u.getActiveSheetIndex(),f,r,i,e,o=!1,s=u.getSheet(h)._filterColl;i=s[n.rowIndex][n.colIndex].status;r=i.indexOf("e-ssfiltered")>-1?12:10;e=i.substr(0,r);u._isRowViewable(h,n.rowIndex)&&(f=u.getCell(n.rowIndex,n.colIndex).find(".e-filterspan")[0],i=f.className,r=i.indexOf("e-ssfilter")+r,o=!0);t==="ascending"?(s[n.rowIndex][n.colIndex].status=e+"-asc",o&&(f.className=i.substr(0,r)+"-asc")):(s[n.rowIndex][n.colIndex].status=e+"-dsc",o&&(f.className=i.substr(0,r)+"-dsc"))},_extendFilterRange:function(n,t){var o=this.XLObj,f,u,r=o.getSheet(o.getActiveSheetIndex()).filterSettings.tableRange,i,e;if(r.length)for(i=0,e=r.length;i<e;i++)if(r[i].tableID==n){if(r[i].endRow<t[2]&&(u=r[i].selectedRange.dataSourceIndexes,r[i].endRow=r[i].selectedRange.endRow=t[2],u[u.length-1]<r[i].endRow))for(f=u[u.length-1],e=r[i].endRow;f<e;f++)u.push(f+1);break}},_updateFilterIcons:function(t,i,r,u){for(var o=this.XLObj,f,s,h=n("#"+o._id+"numberSelectAll").ejCheckBox("instance"),l=h?!1:h.model.checked,c=n("#"+o._id+"stringSelectAll").ejCheckBox("instance"),a=c?!1:c.model.checked,e=t;e<=i;e++){s={rowIndex:e,colIndex:r};f=o.XLEdit.getPropertyValue(e,r,"filterState");f.indexOf("filtered")>-1&&(u=="clearfiltering"||l||a)?this._changeFilterIcon(s,"filtered",f):f.indexOf("filtered")<0&&u!="clearfiltering"&&this._changeFilterIcon(s,"filter",f);break}},_fltrRowHighlight:function(t,i,r){var f=this.XLObj,c=f.getActiveSheetIndex(),h=f._getJSSheetRowHeaderContent(c),l=h.find("table tr:gt("+(t-1)+"):lt("+(i-t+1)+")"),e=f.model.sheets[c].filterSettings.tableRange,a,u,s=f.model.sheets[c].filteredRowsCollection,o;if(f.model.scrollSettings.allowVirtualScrolling&&(l=h.find("table tr").filter(function(){return n(this).attr("data-idx")>=t&&n(this).attr("data-idx")<=i})),r==="clear"){if(l.find("td[class *='filterhiglight']").removeClass("e-filterhiglight"),f.clearRangeData([t,0,i,0],["isFilterHighlight"]),s.length)for(o=0;o<s.length;o++)for(u=0,a=e.length;u<a;u++)s[o]>=e[u].startRow&&s[o]<=e[u].endRow&&!f.XLEdit.getPropertyValue(s[o],0,"isRHide")&&(f.updateUniqueData({isFilterHighlight:!0},[e[u].startRow,0,e[u].endRow,0]),f.model.scrollSettings.allowVirtualScrolling?h.find("table tr").filter(function(){return n(this).attr("data-idx")>=e[u].startRow&&n(this).attr("data-idx")<=e[u].endRow}).find("td").addClass("e-filterhiglight"):h.find("table tr:gt("+(e[u].startRow-1)+"):lt("+(e[u].endRow-e[u].startRow+1)+")").find("td").addClass("e-filterhiglight"))}else r==="add"&&(l.find("td").addClass("e-filterhiglight"),f.updateUniqueData({isFilterHighlight:!0},[t,0,i,0]))},_checkFilterApplied:function(n,t,i,r,u,f){var h,s=this.XLObj,a=s.getSheet(n),o=a.filterSettings.tableRange,c,e,l;for(s._isFilterApplied=!1,e=0,l=o.length;e<l;e++)if(c=!1,o[e].filteredColumns.length?(h=s._checkFilterMerge(n,[o[e].startRow-1,o[e].multifilterIdx[0],o[e].endRow,o[e].multifilterIdx[o[e].multifilterIdx.length-1]],t,i,r,u,f,"filter",c),s._isFilterApplied=!h.isAlert):s._isFilterApplied=!1,s._isFilterApplied)return!0;return!1},_updateFilterCollection:function(i,r,u,f,e){var l,h,a,p,nt,tt,w,b,c=this.XLObj,v=c.getSheet(i),k=v.filterSettings.tableRange,o,s,g,it,d,y;if(u=u+1,f==="row")for(l=0,p=k.length;l<p;l++)o=k[l],s=o.multifilterIdx,e==="insert"?r<=o.endRow&&(o.endRow=o.endRow+u,r<o.startRow?(o.startRow=o.startRow+u,o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:u,isInsertBefore:!0})):o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:u})):r<=o.endRow&&(o.endRow=o.endRow-u,r<o.startRow?(o.startRow=o.startRow-u,o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:-u,isInsertBefore:!0})):o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:-u})),w={rowIndex:o.startRow,colIndex:s[0]},b={rowIndex:o.endRow,colIndex:s[s.length-1]},this._getSelectedRangeData(w,b,o.tableID),o.selectedRange=n.extend(!0,{},v._selectedRange),o.filteredRange=n.extend(!0,{},v.filterSettings.filteredRange);else for(l=0,p=k.length;l<p;l++){if(o=k[l],s=o.multifilterIdx,y=n.extend(!0,[],s),d=0,this._updateFilteredColumns(l,r,u,e),e==="insert"){if(r<=s[0]){for(h=s.length-1;h>=0;h--)s[d]=s[d]+u,d++;o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:u,isInsertBefore:!0})}else if(r<=s[s.length-1])for(o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:u}),h=y[y.length-1],nt=y[y.length-1]+u;h<=nt;h++)s.indexOf(h)===-1&&s.push(h)}else if(r<=s[0]){for(h=0;h<s.length;h++)s[h]=s[h]-u;o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:-u,isInsertBefore:!0})}else if(r<=s[s.length-1]){for(a=r,tt=s[s.length-1];a<=tt;a++)it=c._generateHeaderText(a+1),g=c.XLEdit.getPropertyValue(o.startRow-1,a,"filterState"),!t.isNullOrUndefined(g)&&g.indexOf("filtered")>-1&&this._clearFilterColumn(it,"","","Or","","",o.tableID);s.splice(s.length-u,u);o.tableID>-1&&c.XLFormat._refreshTableRowCol({tid:o.tableID,pos:f,cnt:-u})}w={rowIndex:o.startRow,colIndex:s[0]};b={rowIndex:o.endRow,colIndex:s[s.length-1]};this._getSelectedRangeData(w,b,o.tableID);o.selectedRange=n.extend(!0,{},v._selectedRange);o.filteredRange=n.extend(!0,{},v.filterSettings.filteredRange);s.length<2&&(o.multiFiltering=!1)}},_updateFilteredColumns:function(t,i,r,u){for(var s,h,w,k,c,v,b,l,y,f=this.XLObj,d,nt=f.getActiveSheetIndex(),e=f.getSheet(nt).filterSettings.tableRange[t],p=n.extend(!0,[],e.filteredColumns),g=n.extend(!0,{},e.fColumns),a=n.extend(!0,{},e.fColumns),o=0,tt=p.length;o<tt;o++)s=f.XLEdit.getColumnIndexByField(e.filteredColumns[o].field),i<=s&&(u==="delete"?i===s?p.splice(o,1):p[o].field=f._generateHeaderText(s-r+1):p[o].field=f._generateHeaderText(s+r+1));for(e.filteredColumns=p,b=f.getObjectKeys(g),e.predicate=e.predicate,o=b.length-1;o>=0;o--)for(d=f.XLEdit.getColumnIndexByField(b[o]),l=i;l<i+r;l++)if(l<=d){for(h=n.extend(!0,[],g[b[o]]),y=0;y<h.length;y++)s=f.XLEdit.getColumnIndexByField(h[y].field),l<=s&&(u==="delete"?l===s?h.splice(o,1):h[y].field=f._generateHeaderText(s-r+1):h[y].field=f._generateHeaderText(s+r+1));w=f.XLEdit.getColumnIndexByField(b[o]);c=f._generateHeaderText(w+1);u==="delete"?(k=w-r,l===w?(delete e.predicate[c],delete a[c]):(v=f._generateHeaderText(k+1),a[v]=h,delete a[c],e.predicate[v]=f._excelFilter.generatePredicate(h),delete e.predicate[c])):(k=w+r,v=f._generateHeaderText(k+1),a[v]=h,delete a[c],e.predicate[v]=f._excelFilter.generatePredicate(h),delete e.predicate[c])}e.fColumns=a},_renderCustomFilter:function(){var i=this.XLObj,r=i._id+"_filter_custom",u=n("#"+r),o=t.buildTag("div#"+r+"_content"),f=t.buildTag("input#"+r+"_filterBtn.e-filter",{},{},{type:"button",value:"Filter"}),e=t.buildTag("input#"+r+"_clearBtn.e-clear",{},{},{type:"button",value:"Clear"});u.append(o.append(t.buildTag("div.e-fltrbtndiv").append(f).append(e)));this._createButton("filter",f);this._createButton("clear",e);u.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("Filter"),width:"100%",height:"100%",cssClass:"e-ss-dialog e-"+i._id+"-dlg",open:function(){n("#"+i._id+"_formatdlg_okbtn").focus()},close:t.proxy(this._customFltrDlgClose,this)})},_customFltrDlgClose:function(){n("#"+this.XLObj._id+"_filter_custom_"+this._colType).hide()},_refreshCustomFilter:function(i){var e=this.XLObj,u=e._id+"_filter_custom",f=t.buildTag("input#"+u+"_"+i+"_ddinput.e-"+e._id+"_customddl",{},{},{type:"text"}),r=t.buildTag("input#"+u+"_"+i+"_acString.e-filterval",{},{height:"26px",width:"100%"},{type:"text"}),o=n("#"+u+"_content");o.prepend(t.buildTag("div#"+u+"_"+i,"",{display:"none"}).append(t.buildTag("div.e-operdiv").append(f)).append(t.buildTag("div.e-textdiv").append(r)));f.ejDropDownList({dataSource:[{text:"Equal",value:"equal"},{text:"Not Equal",value:"notequal"},{text:"Less Than",value:"lessthan"},{text:"Less Than Or Equal",value:"lessthanorequal"},{text:"Greater Than",value:"greaterthan"},{text:"Greater Than Or Equal",value:"greaterthanorequal"},{text:"Between",value:"between"}],width:"100%",fields:{id:"value",text:"text",value:"value"},select:n.proxy(this._onNumFormatSelect,this),selectedItemIndex:0});switch(i){case"string":f.ejDropDownList("option",{dataSource:[{text:"Equal",value:"equal"},{text:"Not Equal",value:"notequal"},{text:"Starts With",value:"startswith"},{text:"Ends With",value:"endswith"},{text:"Contains",value:"contains"}],selectedItemIndex:0});r.ejAutocomplete({width:"100%",height:26,enableDistinct:!0});break;case"number":r.ejNumericTextbox({showSpinButton:!1,height:"26px",decimalPlaces:2,width:"100%"});break;case"boolean":r.ejCheckBox({});break;case"date":r.ejDatePicker({width:"100%"})}},_createButton:function(n,i){var r=n=="filter"?t.proxy(this._fltrBtnHandler,this):t.proxy(this._fltrClrHandler,this);i.ejButton({size:"normal",type:"button",height:22,width:60,click:r,showRoundedCorner:!0})},_fltrBtnHandler:function(){var r=this.XLObj,e=r.getActiveSheetIndex(),i=r._id+"_filter_custom",u=n("#"+i+"_"+this._colType+"_ddinput").ejDropDownList("model.value"),f=n("#"+i+"_"+this._colType+"_acString").val(),o={action:"filtering",filterCollection:[{field:this._colName,matchcase:!0,operator:u,value:f,predicate:"or"}],fieldName:this._colName,ejpredicate:{field:this._colName,operator:u,value:f,isComplex:!1,ignoreCase:!1},tableID:this._tableId};r._excelFilter._predicates[e][this._colName]=t.Predicate(this._colName,u,f);this._filterHandler(o);n("#"+i).ejDialog("close");n("#"+i+"_"+this._colType).hide()},_fltrClrHandler:function(){var i=this.XLObj,t=i._id+"_filter_custom";this._clearFilterColumn(this._colName,"","","Or","","",this._tableId);n("#"+t).ejDialog("close");n("#"+t+"_"+this._colType).hide()},_openNormalFilterDlg:function(t,i,r,u){var e=this.XLObj,f=e._id+"_filter_custom";n("#"+f+"_"+i).show();n("#"+f).ejDialog("open");n("#"+f+"_"+i+"_ddinput").ejDropDownList("option",{selectedItemIndex:0});this._colName=t;this._colType=i;this._tableId=r;i==="string"&&n("#"+f+"_"+i+"_acString").ejAutocomplete("option",{fields:{key:this._colName,text:this._colName},dataSource:e.getSheet(e.getActiveSheetIndex()).filterSettings.tableRange[u].filteredRange})}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.ribbon=function(n){var i,t;this.XLObj=n;this._appTabCollection={};this._tabCollection=[];this._contextualTabCollection=[];this._smallBtnHeight=25;this._mediumBtnHeight=35;this._bigBtnHeight=75;this._splitBtnHeight=75;this._dropDownHeight=25;this._ribbonState=!0;this._isSetModel=!1;this._isDesignTab=!0;this._isDirtySelect=!1;this._isMergeSelect=!1;this._isFirstColumn=!1;this._isFilterSelect={};this._hasTitle="";this._isNmgrid="";this._sparklineDesignType="";this._isEditGroupLocationClick=!1;this._isEditSingleSparklineClick=!1;this._isPanelVisible=!1;this._ctrlCreated=!1;this._homeBtnIds=["Home_Clipboard_Paste","Home_Font_IncreaseFontSize","Home_Font_DecreaseFontSize","Home_Alignment_DecreaseIndent","Home_Alignment_IncreaseIndent","Home_Number_IncreaseDecimal","Home_Number_DecreaseDecimal","Home_Actions_Undo","Home_Actions_Redo","Home_Number_Accounting","Home_Number_CommaStyle","Home_Number_Percentage","Home_Clipboard_Cut","Home_Clipboard_Copy"];this._homeSptBtnIds=["Home_Clipboard_PasteOptions","Home_Font_Border","Home_Styles_ConditionalFormatting","Home_Styles_FormatAsTable","Home_Styles_CellStyles","Others_Editing_FindSelect","Home_Editing_Clear","Home_Alignment_Merge","Home_Editing_SortFilter","Home_Editing_AutoSum"];this._homeToggleBtnIds=["Home_Font_Bold","Home_Font_Italic","Home_Font_Underline","Home_Font_StrikeThrough","Home_Alignment_AlignLeft","Home_Alignment_AlignRight","Home_Alignment_AlignCenter","Home_Alignment_TopAlign","Home_Alignment_MiddleAlign","Home_Alignment_BottomAlign","Home_Alignment_WrapText","Home_Clipboard_FormatPainter"];this._homeDdIds=["Home_Number_NumberFormat","Home_Font_FontSize","Home_Font_FontFamily"];this._homeCpIds=["Home_Font_FillColor","Home_Font_FontColor"];this._insertBtnIds=["Insert_Tables_PivotTable","Insert_Tables_Table","Insert_Links_Hyperlink","Insert_Illustrations_Pictures","Insert_Sparkline_Line","Insert_Sparkline_Column","Insert_Sparkline_Winloss"];this._insertSptBtnIds=["Insert_Charts_ColumnChart","Insert_Charts_BarChart","Insert_Charts_StockChart","Insert_Charts_LineChart","Insert_Charts_AreaChart","Insert_Charts_PieChart","Insert_Charts_ScatterChart"];this._dataBtnIds=["Data_SortFilter_SortAtoZ","Data_SortFilter_SortZtoA","Data_SortFilter_Filter","Data_SortFilter_ClearFilter","Data_DataTools_DataValidation"];this._dataSptBtnIds=["Data_DataTools_DataValidationOptions"];this._pageLayChckBxIds=["PageLayout_Show_Headings","PageLayout_Show_Gridlines"];this._pageLayBtnIds=["PageLayout_PageLayout_PageSize","PageLayout_Print_Print","PageLayout_Print_PrintSelected"];this._pageLaySptBtnIds=["PageLayout_PageLayout_PageSizeOptions"];this._reviewTglBtnIds=["Review_Changes_ProtectSheet","Review_Changes_ProtectWorkbook","Review_Changes_LockCell"];this._cmntBtnIds=["Review_Comments_NewComment","Review_Comments_DeleteComment","Review_Comments_PreviousComment","Review_Comments_NextComment","Review_Comments_ShowHideComment"];this._cmntTglBtnIds=["Review_Comments_ShowAllComments"];this._othersBtnIds=["Others_Cells_InsertCell","Others_Cells_DeleteCell","Others_Formulas_NameManager","Others_Formulas_DefineName","Others_CalCulation_CalculateNow","Others_CalCulation_CalculateSheet"];this._othersSptBtnIds=["Others_Cells_InsertCellOptions","Others_Cells_DeleteCellOptions","Others_Editing_FindSelect","Others_Window_FreezePanes","Others_CalCulation_CalculationOptions"];this._contextualBtnIds=["Design_Tools_ResizeTable","Design_Tools_ConvertToRange"];this._contextualInputIds=["Ribbon_Design_Properties_TableName"];this._contextualCheckBoxIds=["Design_TableStyleOptions_FirstColumn","Design_TableStyleOptions_LastColumn","Design_TableStyleOptions_TotalRow","Design_TableStyleOptions_FilterColumn"];this._protectStateBtnIds=["Home_Clipboard_Cut","Home_Clipboard_Copy","Others_Editing_FindSelect","Home_Clipboard_Paste","Home_Clipboard_PasteOptions","Home_Actions_Undo","Home_Actions_Redo","Review_Changes_ProtectSheet","Review_Changes_ProtectWorkbook","PageLayout_Print_Print","PageLayout_Print_PrintSelected","Others_Cells_InsertCellOptions","Others_Cells_DeleteCellOptions","Others_Cells_InsertCell","Others_Cells_DeleteCell"];this._chartDesignBtnIds=["ChartDesign_Data_SwitchRowColumn","ChartDesign_Data_SelectData","ChartDesign_Type_ChangeChartType"];this._chartDesignSptBtnIds=["ChartDesign_ChartLayouts_AddChartElement"];this._chartDesignDdIds=["ChartDesign_ChartThemes_ChartThemes"];this._sparklineDesignSptBtnIds=["SparklineDesign_Sparkline_EditData","SparklineDesign_Style_SparklineColor","SparklineDesign_Style_MarkerColor"];this._formatBtnIds=["Format_Adjust_ChangePicture"];this._formatSptBtnIds=["Format_Adjust_ResetPicture","Format_Border_PictureBorder"];this._pasteMenuData=[{id:"PasteSpecial",text:n._getLocStr("PasteSpecial"),parentId:null},{id:"PasteValues",text:n._getLocStr("PasteValues"),parentId:null}];this._fontFamily=[{value:"1",text:"Angsana New"},{value:"2",text:"Arial"},{value:"3",text:"Arial Black"},{value:"4",text:"Batang"},{value:"5",text:"Book Antiqua"},{value:"6",text:"Browallia New"},{value:"7",text:"Calibri"},{value:"8",text:"Cambria"},{value:"9",text:"Candara"},{value:"10",text:"Century"},{value:"11",text:"Comic Sans MS"},{value:"12",text:"Consolas"},{value:"13",text:"Constantia"},{value:"14",text:"Corbel"},{value:"15",text:"Cordia New"},{value:"16",text:"Courier"},{value:"17",text:"Courier New"},{value:"18",text:"DilleniaUPC"},{value:"19",text:"Dotum"},{value:"20",text:"FangSong"},{value:"21",text:"Garamond"},{value:"22",text:"Georgia"},{value:"23",text:"Gulim"},{value:"24",text:"GungSuh"},{value:"25",text:"KaiTi"},{value:"26",text:"JasmineUPC"},{value:"27",text:"Malgun Gothic"},{value:"28",text:"Mangal"},{value:"29",text:"Meiryo"},{value:"30",text:"Microsoft JhengHei"},{value:"31",text:"Microsoft YaHei"},{value:"32",text:"MingLiu"},{value:"33",text:"MingLiU_HKSCS"},{value:"34",text:"MS Gothic"},{value:"35",text:"MS Mincho"},{value:"36",text:"MS PGothic"},{value:"37",text:"MS PMincho"},{value:"38",text:"PMingliU"},{value:"39",text:"PMingLiU-ExtB"},{value:"40",text:"SimHei"},{value:"41",text:"SimSun"},{value:"42",text:"SimSun-ExtB"},{value:"43",text:"Tahoma"},{value:"44",text:"Times"},{value:"45",text:"Times New Roman"},{value:"46",text:"Trebuchet MS"},{value:"47",text:"Verdana"},{value:"48",text:"Yu Gothic"},{value:"49",text:"Yu Mincho"}];this._fontSize=[{value:"8pt",text:"8"},{value:"9pt",text:"9"},{value:"10pt",text:"10"},{value:"11pt",text:"11"},{value:"12pt",text:"12"},{value:"14pt",text:"14"},{value:"16pt",text:"16"},{value:"18pt",text:"18"},{value:"20pt",text:"20"},{value:"22pt",text:"22"},{value:"24pt",text:"24"},{value:"26pt",text:"26"},{value:"28pt",text:"28"},{value:"36pt",text:"36"},{value:"48pt",text:"48"},{value:"72pt",text:"72"}];this._fontStyle=[{value:"1",text:"Normal"},{value:"2",text:"Bold"},{value:"3",text:"Italic"},{value:"4",text:"Bold Italic"}];this._mergeMenuData=[{id:"MergeAndCenter",text:n._getLocStr("MergeAndCenter"),parentId:null,sprite:"e-icon e-ss-mergecenter"},{id:"MergeAcross",text:n._getLocStr("MergeAcross"),parentId:null,sprite:"e-icon e-ss-mergeacross"},{id:"MergeCells",text:n._getLocStr("MergeCells"),parentId:null,sprite:"e-icon e-ss-merge"},{id:"UnmergeCells",text:n._getLocStr("UnmergeCells"),parentId:null,sprite:"e-icon e-ss-unmerge"}];this._sortFltrMenuData=[{id:"Ribbon_SortAtoZ",text:this.XLObj._getLocStr("SortAtoZ"),parentId:null,sprite:"e-icon e-ssdrop-sortatoz"},{id:"Ribbon_SortZtoA",text:this.XLObj._getLocStr("SortZtoA"),parentId:null,sprite:"e-icon e-ssdrop-sortztoa"},{id:"Ribbon_Filter",text:this.XLObj._getLocStr("Filter"),parentId:null,sprite:"e-icon e-ssdrop-filter"},{id:"Ribbon_ClearFilter",text:this.XLObj._getLocStr("ClearFilter"),parentId:null,sprite:"e-icon e-ssdrop-clearfilter"}];this._findMenuData=[{id:"Find",text:n._getLocStr("Find")+"...",parentId:null,sprite:"e-icon e-ss-find"},{id:"Replace",text:n._getLocStr("Replace")+"...",parentId:null,sprite:"e-icon e-ss-replace"},{id:"GoTo",text:n._getLocStr("GoTo")+"...",parentId:null,sprite:"e-icon e-ss-goto"},{id:"GoToSpecial",text:n._getLocStr("GoTo")+" "+n._getLocStr("Special")+"...",parentId:null},{id:"Formulas",text:n._getLocStr("Formulas"),parentId:null},{id:"Comments",text:n._getLocStr("Comments"),parentId:null},{id:"CFormat",text:n._getLocStr("ConditionalFormat"),parentId:null},{id:"Constants",text:n._getLocStr("Constants"),parentId:null},{id:"DataValidation",text:n._getLocStr("DataValidation"),parentId:null}];this._calcOptData=[{id:this.XLObj._id+"_CalcAuto",text:n._getLocStr("Automatic"),parentId:null,sprite:"e-icon e-ss-calcauto"},{id:this.XLObj._id+"_CalcManual",text:n._getLocStr("Manual"),parentId:null,sprite:"e-icon"}];this._valMenuData=[{id:"Validation",text:n._getLocStr("DataValidation")+"...",parentId:null,sprite:"e-icon e-ss-validation"},{id:"HighlightVal",text:n._getLocStr("HighlightVal"),parentId:null,sprite:"e-icon e-ss-hlval"},{id:"ClearHLVal",text:n._getLocStr("ClearFormats"),parentId:null,sprite:"e-icon e-ss-clearval"},{id:"ClearVal",text:n._getLocStr("ClearVal"),parentId:null,sprite:"e-icon e-ss-clearval"}];this._pageSizes=[{id:"A4",text:"A4",parentId:null,sprite:"e-icon e-ss-A4size"},{id:"A3",text:"A3",parentId:null,sprite:"e-icon e-ss-A3size"},{id:"Letter",text:"Letter",parentId:null,sprite:"e-icon e-ss-lettersize"}];this._viewMenuData=[{id:"freezePanes",text:n._getLocStr("FreezePanes"),parentId:null,sprite:"e-icon e-ss-frzpane"},{id:"FreezeTopRow",text:n._getLocStr("FreezeTopRow"),parentId:null,sprite:"e-icon e-ss-frzrow"},{id:"FreezeFirstColumn",text:n._getLocStr("FreezeFirstColumn"),parentId:null,sprite:"e-icon e-ss-frzcln"}];this._insertMenuData=[{id:"InsertCells",text:n._getLocStr("InsCells")+"...",parentId:null,sprite:"e-icon e-ssr-inscell"},{id:"InsertSheetRows",text:n._getLocStr("InsRows"),parentId:null,sprite:"e-icon e-ssr-insrow"},{id:"InsertSheetColumns",text:n._getLocStr("InsCols"),parentId:null,sprite:"e-icon e-ssr-inscol"},{id:"InsertSheet",text:n._getLocStr("InsSheet"),parentId:null,sprite:"e-icon e-ssr-inssheet"}];this._resetPicture=[{id:"resetpicture",text:n._getLocStr("ResetPicture"),parentId:null,sprite:"e-icon e-ss-resetpicture"},{id:"resetsize",text:n._getLocStr("ResetSize"),parentId:null,sprite:"e-icon e-ss-resetpicture"}];i=n._getLocStr("BorderStyles").split("/");this._borderMenuData=[{id:"bottom",text:n._getLocStr("BottomBorder"),parentId:null,sprite:"e-icon e-ss-bottom"},{id:"top",text:n._getLocStr("TopBorder"),parentId:null,sprite:"e-icon e-ss-top"},{id:"left",text:n._getLocStr("LeftBorder"),parentId:null,sprite:"e-icon e-ss-left"},{id:"right",text:n._getLocStr("RightBorder"),parentId:null,sprite:"e-icon e-ss-right"},{id:"noborder",text:n._getLocStr("NoBorder"),parentId:null,sprite:"e-icon e-ss-noborder"},{id:"allborder",text:n._getLocStr("AllBorder"),parentId:null,sprite:"e-icon e-ss-allborder"},{id:"outside",text:n._getLocStr("OutsideBorder"),parentId:null,sprite:"e-icon e-ss-outside"},{id:"thickbox",text:n._getLocStr("ThickBoxBorder"),parentId:null,sprite:"e-icon e-ss-thickbox"},{id:"doublebottom",text:n._getLocStr("BottomDoubleBorder"),parentId:null,sprite:"e-icon e-ss-doublebottom"},{id:"thickbottom",text:n._getLocStr("ThickBottomBorder"),parentId:null,sprite:"e-icon e-ss-thickbottom"},{id:"topandbottom",text:n._getLocStr("TopandBottomBorder"),parentId:null,sprite:"e-icon e-ss-topandbottom"},{id:"topandthickbottom",text:n._getLocStr("TopandThickBottomBorder"),parentId:null,sprite:"e-icon e-ss-topandthickbottom"},{id:"topanddoublebottom",text:n._getLocStr("TopandBottomDoubleBorder"),parentId:null,sprite:"e-icon e-ss-topanddoublebottom"},{id:"drawborder",text:n._getLocStr("DrawBorder"),parentId:null,sprite:"e-icon e-ss-drawborder"},{id:"drawbordergrid",text:n._getLocStr("DrawBorderGrid"),parentId:null,sprite:"e-icon e-ss-drawbordergrid"},{id:n._id+"_bordercolor",text:n._getLocStr("BorderColor"),parentId:null},{id:n._id+"_Ribbon_borderstyle",text:n._getLocStr("BorderStyle"),parentId:null},{id:n._id+"_Ribbon_bordercolor",text:"",parentId:n._id+"_bordercolor"},{id:"solid",text:i[0],parentId:n._id+"_Ribbon_borderstyle"},{id:"dashed",text:i[1],parentId:n._id+"_Ribbon_borderstyle"},{id:"dotted",text:i[2],parentId:n._id+"_Ribbon_borderstyle"},{id:"double",text:i[3],parentId:n._id+"_Ribbon_borderstyle"}];this._cFormatMenuData=[{id:n._id+"_HLCellRules",text:n._getLocStr("HighlightCellRules"),parentId:null,sprite:"e-icon e-ss-hlcellrules"},{id:"greaterthan",text:n._getLocStr("GreaterThan")+"...",parentId:n._id+"_HLCellRules",sprite:"e-icon e-ss-greaterthan"},{id:"lessthan",text:n._getLocStr("LessThan")+"...",parentId:n._id+"_HLCellRules",sprite:"e-icon e-ss-lessthan"},{id:"between",text:n._getLocStr("Between")+"...",parentId:n._id+"_HLCellRules",sprite:"e-icon e-ss-between"},{id:"equalto",text:n._getLocStr("EqualTo")+"...",parentId:n._id+"_HLCellRules",sprite:"e-icon e-ss-equalto"},{id:"textcontains",text:n._getLocStr("TextthatContains")+"...",parentId:n._id+"_HLCellRules",sprite:"e-icon e-ss-textcontains"},{id:"dateoccur",text:n._getLocStr("DateOccurring")+"...",parentId:n._id+"_HLCellRules",sprite:"e-icon e-ss-dateoccur"},{id:n._id+"_DataBars",text:n._getLocStr("DataBars"),parentId:null,sprite:"e-icon e-ss-databars"},{id:"databar",text:"",parentId:n._id+"_DataBars",style:"display: none"},{id:n._id+"_ColorScales",text:n._getLocStr("ColorScales"),parentId:null,sprite:"e-icon e-ss-colorscales"},{id:"colorscale",text:"",parentId:n._id+"_ColorScales"},{id:n._id+"_IconSets",text:n._getLocStr("IconSets"),parentId:null,sprite:"e-icon e-ss-iconsets"},{id:"iconset",text:"",parentId:n._id+"_IconSets"},{id:n._id+"_CreateRule",text:n._getLocStr("CreateRule"),parentId:null,sprite:"e-icon e-ss-createrule"},{id:n._id+"_ClearRules",text:n._getLocStr("ClearRules"),parentId:null,sprite:"e-icon e-ss-clearrules"},{id:"clearselected",text:n._getLocStr("ClearRulesfromSelected"),parentId:n._id+"_ClearRules"},{id:"clearall",text:n._getLocStr("ClearRulesfromEntireSheets"),parentId:n._id+"_ClearRules"}];this._textAlign=[{value:"1",text:"Left"},{value:"2",text:"Center"},{value:"3",text:"Right"}];this._verticalAlign=[{value:"1",text:"Top"},{value:"2",text:"Middle"},{value:"3",text:"Bottom"}];t=n._getLocStr("DataValidationAction").split("/");this._actions=[{value:"Greater",text:t[0]},{value:"GreaterOrEqual",text:t[1]},{value:"Less",text:t[2]},{value:"LessOrEqual",text:t[3]},{value:"Equal",text:t[4]},{value:"NotEqual",text:t[5]},{value:"Between",text:t[6]},{value:"NotBetween",text:t[7]}];t=n._getLocStr("DataValidationType").split("/");this._types=[{value:"number",text:t[0]},{value:"decimal",text:t[1]},{value:"date",text:t[2]},{value:"time",text:t[3]},{value:"text",text:t[4]},{value:"list",text:t[5]}];this._cFormatData={greaterthan:["GTTitle","GTContent"],lessthan:["LTTitle","LTContent"],between:["BWTitle","BWContent"],equalto:["EQTitle","EQContent"],textcontains:["ContainsTitle","ContainsContent"],dateoccur:["DateTitle","DateContent"],toptenitems:["TTTitle","TTContent"],toptenpercent:["TTPTitle","TTPContent"],bottomtenitems:["BTTitle","BTContent"],bottomtenpercent:["BTPTitle","BTPContent"],aboveaverage:["AAverageTitle","AAverageContent"],belowaverage:["BAverageTitle","BAverageContent"]};this._styles=[{value:"redft",text:n._getLocStr("LightRedFillDark")},{value:"yellowft",text:n._getLocStr("YellowFillDark")},{value:"greenft",text:n._getLocStr("GreenFillDark")},{value:"redf",text:n._getLocStr("RedFill")},{value:"redt",text:n._getLocStr("RedText")}];this._currentCFormat="";this._addrList=[];this._within=[{value:"sheet",text:n._getLocStr("Sheet")},{value:"workbook",text:n._getLocStr("Workbook")}];this._sType=[{value:"columns",text:n._getLocStr("Columns")},{value:"rows",text:n._getLocStr("Rows")}];this._vType=[{value:"value",text:n._getLocStr("Value")},{value:"formula",text:n._getLocStr("Formula")},{value:"comment",text:n._getLocStr("Comments")}];this._direction=[{value:"down",text:n._getLocStr("Down")},{value:"up",text:n._getLocStr("Up")}];this._gotoRBtnSet1=["Comments","Blanks","LastCell","Formulas","Constants"];this._gotoRBtnSet2=["RowDiff","ColDiff","CFormat","DataValidation"];this._gotoChkBox=["GotoNumbers","GotoText","GotoLogicals","GotoError"];this._numberFormat=[{value:"General",text:n._getLocStr("LGeneral")},{value:"Number",text:n._getLocStr("NumberTab")},{value:"Currency",text:n._getLocStr("LCurrency")},{value:"Accounting",text:n._getLocStr("LAccounting")},{value:"Percentage",text:n._getLocStr("LPercentage")},{value:"Text",text:n._getLocStr("LText")},{value:"Shortdate",text:n._getLocStr("LShortdate")},{value:"Longdate",text:n._getLocStr("LLongdate")},{value:"Time",text:n._getLocStr("LTime")},{value:"Scientific",text:n._getLocStr("LScientific")},{value:"Fraction",text:n._getLocStr("LFraction")},{value:"Custom",text:n._getLocStr("LCustom")}];this._deleteMenuData=[{id:"DeleteCells",text:n._getLocStr("DelCells")+"...",parentId:null,sprite:"e-icon e-ssr-delcell"},{id:"DeleteSheetRows",text:n._getLocStr("DelRows"),parentId:null,sprite:"e-icon e-ssr-delrow"},{id:"DeleteSheetColumns",text:n._getLocStr("DelCols"),parentId:null,sprite:"e-icon e-ssr-delcol"},{id:"DeleteSheet",text:n._getLocStr("DelSheet"),parentId:null,sprite:"e-icon e-ssr-delsheet"}];this._clearMenuData=[{id:"Clear_All",text:n._getLocStr("ClearAll"),parentId:null,sprite:"e-icon e-ss-clear"},{id:"Clear_Formats",text:n._getLocStr("ClearFormats"),parentId:null,sprite:"e-icon e-ss-clearformat"},{id:"Clear_Contents",text:n._getLocStr("ClearContents"),parentId:null},{id:"Clear_Comments",text:n._getLocStr("ClearComments"),parentId:null},{id:"Clear_Hyperlinks",text:n._getLocStr("ClearHyperLinks"),parentId:null}];this._autosumMenuData=[{id:"Sum",text:n._getLocStr("Sum"),parentId:null,sprite:"e-icon e-ss-autosum"},{id:"Average",text:n._getLocStr("Average"),parentId:null},{id:"Count",text:n._getLocStr("CountNumber"),parentId:null},{id:"Max",text:n._getLocStr("Max"),parentId:null},{id:"Min",text:n._getLocStr("Min"),parentId:null}];this._chartThemes=[{value:"flatlight",text:"Flat Light"},{value:"flatdark",text:"Flat Dark"},{value:"azure",text:"Azure"},{value:"azuredark",text:"Azure Dark"},{value:"lime",text:"Lime"},{value:"limedark",text:"Lime Dark"},{value:"saffron",text:"Saffron"},{value:"saffrondark",text:"Saffron Dark"}];this._isCustomCellStyleReset=!1;this.allButtonIds=["Home_Clipboard_Paste","Home_Font_IncreaseFontSize","Home_Font_DecreaseFontSize","Home_Alignment_DecreaseIndent","Home_Alignment_IncreaseIndent","Home_Number_IncreaseDecimal","Home_Number_DecreaseDecimal","Home_Actions_Undo","Home_Actions_Redo","Home_Number_Accounting","Home_Number_CommaStyle","Home_Number_Percentage","Home_Clipboard_Cut","Home_Clipboard_Copy","Insert_Tables_PivotTable","Insert_Tables_Table","Insert_Links_Hyperlink","Insert_Illustrations_Pictures","Insert_Sparkline_Line","Insert_Sparkline_Column","Insert_Sparkline_Winloss","Data_SortFilter_SortAtoZ","Data_SortFilter_SortZtoA","Data_SortFilter_Filter","Data_SortFilter_ClearFilter","Data_DataTools_DataValidation","PageLayout_PageLayout_PageSize","PageLayout_Print_Print","PageLayout_Print_PrintSelected","Review_Comments_NewComment","Review_Comments_DeleteComment","Review_Comments_PreviousComment","Review_Comments_NextComment","Review_Comments_ShowHideComment","Others_Cells_InsertCell","Others_Cells_DeleteCell","Others_Formulas_NameManager","Others_Formulas_DefineName","Others_CalCulation_CalculateNow","Others_CalCulation_CalculateSheet","Design_Tools_ResizeTable","Design_Tools_ConvertToRange","ChartDesign_Data_SwitchRowColumn","ChartDesign_Data_SelectData","ChartDesign_Type_ChangeChartType","Format_Adjust_ChangePicture"];this.allSplitButtonIds=["Home_Clipboard_PasteOptions","Home_Font_Border","Home_Styles_ConditionalFormatting","Home_Styles_FormatAsTable","Home_Styles_CellStyles","Others_Editing_FindSelect","Home_Editing_Clear","Home_Alignment_Merge","Home_Editing_SortFilter","Home_Editing_AutoSum","Insert_Charts_ColumnChart","Insert_Charts_BarChart","Insert_Charts_StockChart","Insert_Charts_LineChart","Insert_Charts_AreaChart","Insert_Charts_PieChart","Insert_Charts_ScatterChart","Data_DataTools_DataValidationOptions","PageLayout_PageLayout_PageSizeOptions","Others_Cells_InsertCellOptions","Others_Cells_DeleteCellOptions","Others_Editing_FindSelect","Others_Window_FreezePanes","Others_CalCulation_CalculationOptions","ChartDesign_ChartLayouts_AddChartElement","Format_Adjust_ResetPicture","Format_Border_PictureBorder","SparklineDesign_Style_MarkerColor","SparklineDesign_Style_SparklineColor","SparklineDesign_Sparkline_EditData"];this.allToggleButtonIds=["Home_Font_Bold","Home_Font_Italic","Home_Font_Underline","Home_Font_StrikeThrough","Home_Alignment_AlignLeft","Home_Alignment_AlignRight","Home_Alignment_AlignCenter","Home_Alignment_TopAlign","Home_Alignment_MiddleAlign","Home_Alignment_BottomAlign","Home_Alignment_WrapText","Home_Clipboard_FormatPainter","Review_Comments_ShowAllComments","Review_Changes_ProtectSheet","Review_Changes_ProtectWorkbook","Review_Changes_LockCell"];this.allDropDownIds=["ChartDesign_ChartThemes_ChartThemes","Home_Number_NumberFormat","Home_Font_FontSize","Home_Font_FontFamily"];this.colorPickerIds=["Home_Font_FillColor","Home_Font_FontColor"];this.checkBoxIds=["PageLayout_Show_Headings","PageLayout_Show_Gridlines","Design_TableStyleOptions_FirstColumn","Design_TableStyleOptions_LastColumn","Design_TableStyleOptions_TotalRow","Design_TableStyleOptions_FilterColumn"];this.InputIds=["Ribbon_Design_Properties_TableName"];this._fileMenuData=[{id:"File",text:n._getLocStr("File"),parentId:null},{id:"New",text:n._getLocStr("New"),parentId:"File",sprite:"e-icon e-ss-newsheet"},{id:"Open",text:n._getLocStr("Open")+"...",parentId:"File",sprite:"e-icon e-ss-open"},{id:"Save",text:n._getLocStr("SaveAs"),parentId:"File",sprite:"e-icon e-ss-saveas"},{id:"Print",text:n._getLocStr("Print"),parentId:"File",sprite:"e-icon e-ssm-print"},{id:"ExportXL",text:n._getLocStr("ExportXL"),parentId:"Save",sprite:"e-icon e-ssm-exportxl"},{id:"ExportCsv",text:n._getLocStr("ExportCsv"),parentId:"Save",sprite:"e-icon e-ssm-exportcsv"},{id:"ExportPdf",text:n._getLocStr("ExportPdf"),parentId:"Save",sprite:"e-icon e-ssm-exportpdf"},{id:"PrintSheet",text:n._getLocStr("PrintSheet"),parentId:"Print",sprite:"e-icon e-ssm-print"},{id:"PrintSelected",text:n._getLocStr("PrintSelected"),parentId:"Print",sprite:"e-icon e-ssm-printselected"}];this._isAppTabCreate=!1;this._isHomeTabCreate=!1;this._isInsertTabCreate=!1;this._isDataTabCreate=!1;this._isPageLayoutTabCreate=!1;this._isReviewTabCreate=!1;this._isOthersTabCreate=!1;this._isDesignTabCreate=!1;this._isFormatTabCreate=!1;this._isChartTabCreate=!1;this._analyzeTabCreate=!1;this._isSparklineTabCreate=!1;this._isHomeTabTrgt=!1;this._isInsertTabTrgt=!1;this._isDataTabTrgt=!1;this._isPageLayoutTrgtTab=!1;this._isReviewTabTrgt=!1;this._isOthersTabTrgt=!1;this._isDesignTabTrgt=!1;this._isFormatTabTrgt=!1;this._isChartTabTrgt=!1;this._analyzeTabTrgt=!1;this._isSparklineTrgt=!1;this._scopeBookCln={}};t.spreadsheetFeatures.ribbon.prototype={_renderChartTypeDialog:function(){var i,u,f,e,o,s,h,c,l,a,n=this.XLObj,r=n._id+"_charttypedlg";return i=t.buildTag("div#"+r+".e-chartdialog","",{},{overflow:"hidden"}),u=t.buildTag("div#"+r+"_allcharttab.e-chtdlgtab"),l=t.buildTag("div.e-dlg-fields e-dlgctndiv"),s=t.buildTag("ul .e-ul","",""),c=t.buildTag("a",n._getLocStr("AllCharts"),{},{href:"#"+n._id+"_allchart"}),h=t.buildTag("li",c),i.append(l.append(u.append(s.append(h)))),o=t.buildTag("div#"+r+"_btndiv.e-dlg-btnfields"),a=t.buildTag("div.e-dlg-btnctnr"),f=t.buildTag("input#"+r+"_okbtn","",{},{type:"button"}),e=t.buildTag("input#"+r+"_cantn","",{},{type:"button"}),f.ejButton({text:n._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._chartTypeOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),e.ejButton({text:n._getLocStr("Cancel"),click:t.proxy(this._chartTypeCancel,this),showRoundedCorner:!0,width:60}),o.append(a.append(f,e)),i.append(o),n.element.append(i),u.ejTab({cssClass:"e-ss-dlgtab",width:"100%",height:"auto"}),this._renderAllChartTab(),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:n._getLocStr("ChartType"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-charttype-dlg e-ss-mattab e-"+n._id+"-dlg",close:t.proxy(this._dialogClose,this)}),i},_renderAllChartTab:function(){var e,o,k,s,h,c,v,r,y,u,d,p,g=[],w="",nt="",i=this.XLObj,f=i._id,b=f+"_chartdlg_allcharttab",l=["Column-6","Bar-6","Radar-2","Line-2","Area-3","Pie-3","Scatter-1"],a;for(d=t.buildTag("div#"+b+"_content.e-ss-leftdiv",""),v=t.buildTag("div#"+b+"_content.e-chtdlgcontent e-ss-rightdiv","",{overflow:"auto"}),p=t.buildTag("ul #"+b+"_list .e-ul"),s=0,h=l.length;s<h;s++)r=l[s].split("-")[0],nt+="<li><span class='e-icon e-ss-dlg"+r.toLowerCase()+"chart'><\/span>"+i._getLocStr(r)+"<\/li>",g.push(r);for(p.append(n(nt)),a=t.buildTag("div#"+f+"_allchart_table.e-ss-maindiv","",{cellspacing:"0",cellpadding:"0",display:"table",width:"100%"}),n("#"+f+"_allchart").append(a),a.append(d.append(p)),this._createChartList(g),a.append(v),o=0,h=l.length;o<h;o++){c=l[o].split("-");switch(c[0]){case"Column":u=[i._getLocStr("ClusteredColumn"),i._getLocStr("StackedColumn"),"100%&nbsp;"+i._getLocStr("StackedColumn"),"3-D&nbsp;"+i._getLocStr("ClusteredColumn"),"3-D&nbsp;"+i._getLocStr("StackedColumn"),"3-D&nbsp;100%&nbsp;"+i._getLocStr("StackedColumn")];break;case"Bar":u=[i._getLocStr("ClusteredBar"),i._getLocStr("StackedBar"),"100%&nbsp;"+i._getLocStr("StackedBar"),"3-D&nbsp;"+i._getLocStr("ClusteredBar"),"3-D&nbsp;"+i._getLocStr("StackedBar"),"3-D&nbsp;100%&nbsp;"+i._getLocStr("StackedBar")];break;case"Radar":u=[i._getLocStr("Radar"),i._getLocStr("RadarMarkers")];break;case"Line":u=[i._getLocStr("Line"),i._getLocStr("LineMarkers")];break;case"Area":u=[i._getLocStr("Area"),i._getLocStr("StackedArea"),"100%&nbsp;"+i._getLocStr("StackedArea")];break;case"Pie":u=[i._getLocStr("Pie"),"3-D&nbsp;"+i._getLocStr("Pie"),i._getLocStr("Doughnut")];break;case"Scatter":u=[i._getLocStr("Scatter")]}for(r=c[0].toLowerCase(),y=t.buildTag("div#"+f+"_"+r+"chart"),e=1,k=parseInt(c[1]);e<=k;e++)w+="<div class='e-chartimg e-dlg"+r+"chart"+e+"' title='"+u[e-1]+"'><\/div>";v.append(y.append(w));n("#"+f+"_"+r+"chart").find(".e-dlg"+r+"chart1").addClass("e-chartselect");y.hide();w=""}i._on(n("#"+f+"_allchart").find(".e-chartimg"),"click",i._allChartType);n("#"+f+"_columnchart").show()},_createChartList:function(i){var u=this.XLObj,f=u._id+"_chartdlg_allcharttab",r,e=n("#"+f+"_list"),o=t.buildTag("div.e-ss-drpdiv");r=t.buildTag("input#"+f+"_input");n("#"+u._id+"_allchart").prepend(o.append(r));r.ejDropDownList({dataSource:i,width:"100%",fields:{id:"value",text:"text",value:"text"},select:n.proxy(this._onChartChange,this),selectedItemIndex:0});e.ejListBox({selectedItemIndex:0,width:"120",height:"250",fields:{text:"text",value:"value"},select:n.proxy(this._onChartChange,this),allowMultiSelection:!1})},_onChartChange:function(t){for(var r=this.XLObj,u=t.value?t.value.toLowerCase():t.text.toLowerCase(),f=["column","bar","radar","line","area","pie","scatter"],i=0;i<f.length;i++)n("#"+r._id+"_"+f[i]+"chart").hide();n("#"+r._id+"_"+u+"chart").show();n("#"+r._id+"_allchart").find(".e-chartimg").removeClass("e-chartselect");n("#"+r._id+"_"+u+"chart").find(".e-dlg"+u+"chart1").addClass("e-chartselect")},_initValDialog:function(){var i,r,u,f,e,o,s,h,n=this.XLObj,c,l;i=t.buildTag("div#"+n._id+"_ValDialog");r=t.buildTag("div#"+n._id+"_ValDialog_valDlgTab");c=t.buildTag("div.e-dlg-fields e-dlgctndiv");o=t.buildTag("ul .e-ul");h=t.buildTag("a",n._getLocStr("Settings"),{},{href:"#"+n._id+"_Validation"});s=t.buildTag("li",h);o.append(s);r.append(o);i.append(c.append(r));e=t.buildTag("div#"+n._id+"btnDiv.e-dlg-btnfields");l=t.buildTag("div.e-dlg-btnctnr");u=t.buildTag("input#"+n._id+"Dialog_OkBtn","",{},{type:"button"});f=t.buildTag("input#"+n._id+"Dialog_CancelBtn","",{},{type:"button"});u.ejButton({text:n._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._valDlgBtnClick,this,"ok"),enabled:!0,cssClass:"e-ss-okbtn"});f.ejButton({text:n._getLocStr("Cancel"),click:t.proxy(this._valDlgBtnClick,this,"cancel"),showRoundedCorner:!0,width:60});e.append(l.append(u,f));n.element.append(i.append(e));r.ejTab({width:"100%",height:"auto",cssClass:"e-ss-dlgtab"});this._renderValDialog();i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:n._getLocStr("DataValidation"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-valdlg e-ss-mattab e-"+n._id+"-dlg",close:t.proxy(this._dialogClose,this)});this._dialogValidate("_ValDialog")},_initCFDialog:function(){var n=this.XLObj,i,e,r,u,f,o;return i=t.buildTag("div#"+n._id+"_CFDialog"),n.element.append(i),e=t.buildTag("div#"+n._id+"_CondFormat.e-dlgctndiv"),i.append(e),f=t.buildTag("div#"+n._id+"cfBtnDiv.e-dlg-btnfields"),o=t.buildTag("div.e-dlg-btnctnr"),r=t.buildTag("input#"+n._id+"cfDialog_OkBtn","",{},{type:"button"}),u=t.buildTag("input#"+n._id+"cfDialog_CancelBtn","",{},{type:"button"}),r.ejButton({text:n._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._dlgCFOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),u.ejButton({text:n._getLocStr("Cancel"),click:t.proxy(this._dlgCFCancel,this),showRoundedCorner:!0,width:"25%"}),f.append(o.append(r,u)),i.append(f),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:n._getLocStr("ConditionalFormat"),width:"auto",cssClass:"e-ss-dialog e-ss-cfdlg e-"+n._id+"-dlg",close:t.proxy(this._dialogClose,this)}),i},_initHLDialog:function(){var i=this.XLObj,r,u,f,e,o,s,h,c,l,a;r=t.buildTag("div#"+i._id+"_HLDialog");u=t.buildTag("div#"+i._id+"_HLDialogTab");l=t.buildTag("div.e-dlg-fields e-dlgctndiv");f=t.buildTag("ul .e-ul");o=t.buildTag("a",i._getLocStr("WebPage"),{},{href:"#"+i._id+"_Web"});e=t.buildTag("li",o);f.append(e);o=t.buildTag("a",i._getLocStr("WorkSheet"),{},{href:"#"+i._id+"_Doc"});e=t.buildTag("li",o);f.append(e);u.append(f);r.append(l.append(u));s=t.buildTag("div#"+i._id+"hlBtnDiv.e-dlg-btnfields");a=t.buildTag("div.e-dlg-btnctnr");h=t.buildTag("input#"+i._id+"hlDialog_OkBtn","",{},{type:"button"});c=t.buildTag("input#"+i._id+"hlDialog_CancelBtn","",{},{type:"button"});h.ejButton({text:i._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgHLOk,this),enabled:!0,cssClass:"e-ss-okbtn"});c.ejButton({text:i._getLocStr("Cancel"),click:t.proxy(this._dlgHLCancel,this),showRoundedCorner:!0,width:60});s.append(a.append(h,c));r.append(s);r.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("InsertHyperLink"),width:"auto",cssClass:"e-ss-dialog e-ss-hyperlinkdlg e-ss-mattab e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this),open:t.proxy(function(){var t=n("#"+i._id+"_Ribbon_webAddress"),r=n("#"+i._id+"_Ribbon_cellAddress");t.focus().setInputPos(t.val().length);r.focus().setInputPos(r.val().length)})});u.ejTab({width:"100%",itemActive:t.proxy(this._hlTabChange,this),cssClass:"e-ss-dlgtab"});this._renderHLDialog()},_initFRDialog:function(){var i=this.XLObj,e,o,s,h,c,l,y,f,r,p,u,a,v;e=t.buildTag("div#"+i._id+"_FRDialog");o=t.buildTag("div#"+i._id+"_FRDialog_FPDlgTab");p=t.buildTag("div.e-dlg-fields e-dlgctndiv");f=t.buildTag("ul .e-ul");u=t.buildTag("a",i._getLocStr("Find"),{},{href:"#"+i._id+"_Find"});r=t.buildTag("li",u);f.append(r);u=t.buildTag("a",i._getLocStr("Replace"),{},{href:"#"+i._id+"_Replace"});r=t.buildTag("li",u);f.append(r);u=t.buildTag("a",i._getLocStr("Settings"),{},{href:"#"+i._id+"_Settings"});r=t.buildTag("li",u);f.append(r);o.append(f);e.append(p.append(o));l=t.buildTag("div#"+i._id+"btnFRDiv.e-dlg-btnfields");y=t.buildTag("div.e-dlg-btnctnr");a=t.buildTag("input#"+i._id+"FR_ReplaceBtn","",{"margin-left":0},{type:"button"});v=t.buildTag("input#"+i._id+"FR_ReplaceAllBtn","",{},{type:"button"});s=t.buildTag("input#"+i._id+"FR_NextBtn","",{},{type:"button"});h=t.buildTag("input#"+i._id+"FR_PrevBtn","",{},{type:"button"});c=t.buildTag("input#"+i._id+"FR_CloseBtn","",{},{type:"button"});a.ejButton({text:i._getLocStr("Replace"),showRoundedCorner:!0,width:55,click:t.proxy(this._btnFROnClick,this,"FR_ReplaceBtn"),enabled:!0}).css("visibility","hidden");v.ejButton({text:i._getLocStr("ReplaceAll"),showRoundedCorner:!0,click:t.proxy(this._btnFROnClick,this,"FR_ReplaceAllBtn"),enabled:!0}).css("visibility","hidden");s.ejButton({text:i._getLocStr("FindNext"),showRoundedCorner:!0,width:69,click:t.proxy(this._btnFROnClick,this,"FR_NextBtn"),enabled:!0});h.ejButton({text:i._getLocStr("FindPrev"),showRoundedCorner:!0,width:69,click:t.proxy(this._btnFROnClick,this,"FR_PrevBtn"),enabled:!0});c.ejButton({text:i._getLocStr("Close"),click:t.proxy(this._btnFROnClick,this,"FR_CloseBtn"),showRoundedCorner:!0,width:47});l.append(y.append(a,v,s,h,c));e.append(l);e.ejDialog({showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("FindnReplace"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-mattab e-ss-frdlg e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this),open:t.proxy(function(){i._phoneMode?(n("#"+i._id+"FR_ReplaceBtn").hide(),n("#"+i._id+"FR_ReplaceAllBtn").hide()):(n("#"+i._id+"FR_ReplaceBtn").show(),n("#"+i._id+"FR_ReplaceAllBtn").show());var t=n("#"+i._id+"_Ribbon_textFind");t.focus().setInputPos(t.val().length)})});o.ejTab({width:"100%",itemActive:t.proxy(this._findTabChange,this),cssClass:"e-ss-dlgtab"})},_initGoToDialog:function(){var n=this.XLObj,i,e,c,r,u,f,o,s,l,h;i=t.buildTag("div#"+n._id+"_GoDialog");e=t.buildTag("div#"+n._id+"_GoToDlgTab");l=t.buildTag("div.e-dlg-fields e-dlgctndiv");r=t.buildTag("ul .e-ul");f=t.buildTag("a",n._getLocStr("GoTo"),{},{href:"#"+n._id+"_GoTo"});u=t.buildTag("li",f);r.append(u);f=t.buildTag("a",n._getLocStr("GoTo")+" "+n._getLocStr("Special"),{},{href:"#"+n._id+"_GoToSp"});u=t.buildTag("li",f);r.append(u);e.append(r);i.append(l.append(e));c=t.buildTag("div#"+n._id+"btnDiv.e-dlg-btnfields");h=t.buildTag("div.e-dlg-btnctnr");i.append(c.append(h));o=t.buildTag("input#"+n._id+"Dialog_GoOkBtn","",{},{type:"button"});s=t.buildTag("input#"+n._id+"Dialog_GoCancelBtn","",{},{type:"button"});o.ejButton({text:n._getLocStr("Ok"),showRoundedCorner:!0,width:"23%",click:t.proxy(this._gotoBtnClick,this,"ok"),cssClass:"e-ss-okbtn"});s.ejButton({text:n._getLocStr("Cancel"),click:t.proxy(this._gotoBtnClick,this,"cancel"),showRoundedCorner:!0,width:60});h.append(o,s);n.element.append(i)},_initPvtDialog:function(){var n=this.XLObj,i,r,u,f,e;i=t.buildTag("div#"+n._id+"_PvtDialog");n.element.append(i);i.append(t.buildTag("div#"+n._id+"_Pivot.e-dlgctndiv"));f=t.buildTag("div#"+n._id+"pvtBtnDiv.e-dlg-btnfields");e=t.buildTag("div.e-dlg-btnctnr");r=t.buildTag("input#"+n._id+"PvtDialog_OkBtn");u=t.buildTag("input#"+n._id+"PvtDialog_CancelBtn");r.ejButton({text:n._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._dlgPvtOk,this),enabled:!0,cssClass:"e-ss-okbtn"});u.ejButton({text:n._getLocStr("Cancel"),click:t.proxy(this._dlgPvtCancel,this),showRoundedCorner:!0,width:"25%"});f.append(e.append(r,u));i.append(f);i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:n._getLocStr("CreatePivotTable"),width:"auto",cssClass:"e-ss-dialog e-"+n._id+"-dlg e-ss-pvtdlg",close:t.proxy(this._dialogClose,this)})},_dialogClose:function(){this.XLObj._setSheetFocus()},_beforeDlgClose:function(t){var i=n("#"+this.XLObj._id+"_nmgrid_dialogEdit_overLay");i.length&&(t.cancel=!0)},_homeTabObj:function(){var n,r=this.XLObj,f="imagetop",u={id:"home",text:r._getLocStr("HOME"),groups:[]},i=r._id;n={id:"Clipboard",text:r._getLocStr("Clipboard"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Home_Clipboard_Paste","paste","textandimage","e-icon e-ssr-paste",45,this._mediumBtnHeight,"Paste","PasteContent",!1,f,""," (Ctrl+V)"),this._generateSplitBtn("Home_Clipboard_PasteOptions","Paste","textandimage",i+"_Ribbon_Paste",{dataSource:this._pasteMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,45,this._mediumBtnHeight,"bottom","","dropdown","e-ssr-pastesbtn","Paste","PasteSplitContent"," (Ctrl+V)")]},{groups:[this._generateBtn("Home_Clipboard_Cut","Cut","textandimage","e-icon e-ssr-cut",58,this._smallBtnHeight,"Cut","CutContent","","",""," (Ctrl+X)"),this._generateBtn("Home_Clipboard_Copy","Copy","textandimage","e-icon e-ssr-copy",67,this._smallBtnHeight,"Copy","CopyContent","","",""," (Ctrl+C)"),this._generateToggleBtn("Home_Clipboard_FormatPainter","FormatPainter","textandimage","e-icon e-ss-formatpainter","FPTitle",110,this._smallBtnHeight,"FPContent")]}]};u.groups.push(n);n={id:"Font",text:r._getLocStr("Font"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateDD("Home_Font_FontFamily","FontFamily",this._fontFamily,"7",150,this._smallBtnHeight,"FontFamily","FFContent"),this._generateDD("Home_Font_FontSize","FontSize",this._fontSize,"11pt",65,this._smallBtnHeight,"FontSize","FSContent"),this._generateBtn("Home_Font_IncreaseFontSize","IncreaseFontSize","imageonly","e-icon e-ss-increasefontsize","",this._smallBtnHeight,"IncreaseFontSize","IFSContent"),this._generateBtn("Home_Font_DecreaseFontSize","DecreaseFontSize","imageonly","e-icon e-ss-decreasefontsize","",this._smallBtnHeight,"DecreaseFontSize","DFSContent")]},{groups:[this._generateToggleBtn("Home_Font_Bold","Bold","imageonly","e-icon e-ss-bold","Bold","",this._smallBtnHeight,"BoldContent","","","","","",""," (Ctrl+B)"),this._generateToggleBtn("Home_Font_Italic","Italic","imageonly","e-icon e-ss-italic","Italic","",this._smallBtnHeight,"ItalicContent","","","","","",""," (Ctrl+I)"),this._generateToggleBtn("Home_Font_Underline","Underline","imageonly","e-icon e-ss-underline","Underline","",this._smallBtnHeight,"ULineContent","","","","","",""," (Ctrl+U)"),this._generateToggleBtn("Home_Font_StrikeThrough","Linethrough","imageonly","e-icon e-ss-linethrough","Linethrough",25,this._smallBtnHeight,"LineTrContent",!0,"","","","",""," (Ctrl+5)"),this._generateSplitBtn("Home_Font_Border","Border","imageonly",i+"_Ribbon_Border",{dataSource:this._borderMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-bottom",!0,37,this._smallBtnHeight,"","","","e-borderbtn","Border","BorderContent"),this._generateCustomControl(i+"_Ribbon_Home_Font_FillColor","BackgroundColor","BackgroundColor","BGContent"),this._generateCustomControl(i+"_Ribbon_Home_Font_FontColor","FontColor","Color","ColorContent")]}]};u.groups.push(n);n={id:"Alignment",text:r._getLocStr("AlignmentTab"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateToggleBtn("Home_Alignment_TopAlign","TopAlign","imageonly","e-icon e-ss-topalign","TopAlign","","","TopAlignContent"),this._generateToggleBtn("Home_Alignment_MiddleAlign","MiddleAlign","imageonly","e-icon e-ss-middlealign","MiddleAlign","","","MiddleAlignContent"),this._generateToggleBtn("Home_Alignment_BottomAlign","BottomAlign","imageonly","e-icon e-ss-bottomalign","BottomAlign","","","BottomAlignContent",!0),this._generateToggleBtn("Home_Alignment_WrapText","WrapText","textandimage","e-icon e-ss-wraptext","WrapText",85,25,"WrapTextContent")]},{groups:[this._generateToggleBtn("Home_Alignment_AlignLeft","AlignLeft","imageonly","e-icon e-ss-alignleft","AlignLeft","","","AlignLeftContent"),this._generateToggleBtn("Home_Alignment_AlignCenter","AlignCenter","imageonly","e-icon e-ss-aligncenter","AlignCenter","","","AlignCenterContent"),this._generateToggleBtn("Home_Alignment_AlignRight","AlignRight","imageonly","e-icon e-ss-alignright","AlignRight","","","AlignRightContent",!0),this._generateSplitBtn("Home_Alignment_Merge","MergeAndCenter","textandimage",i+"_Ribbon_Merge",{dataSource:this._mergeMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-merge",!1,136,25,"right","","","e-spreadsheet e-mergebtn","MergeAndCenter","MergeAndCenterContent")]},{groups:[this._generateBtn("Home_Alignment_DecreaseIndent","DecreaseIndent","imageonly","e-icon e-ss-decreaseindent","",this._smallBtnHeight,"DecreaseIndent","DecreaseIndentContent"),this._generateBtn("Home_Alignment_IncreaseIndent","IncreaseIndent","imageonly","e-icon e-ss-increaseindent","",this._smallBtnHeight,"IncreaseIndent","IncreaseIndentContent")]}]};u.groups.push(n);n={id:"Actions",text:r._getLocStr("Actions"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Home_Actions_Undo","Undo","textandimage","e-icon e-ss-undo",40,this._bigBtnHeight,"Undo","UndoContent",!1,f,""," (Ctrl+Z)"),this._generateBtn("Home_Actions_Redo","Redo","textandimage","e-icon e-ss-redo",40,this._bigBtnHeight,"Redo","RedoContent",!1,f,""," (Ctrl+Y)")]}]};u.groups.push(n);n={id:"Number",text:r._getLocStr("NumberTab"),alignType:t.Ribbon.alignType.rows,enableGroupExpander:!0,content:[{groups:[this._generateDD("Home_Number_NumberFormat","NumberFormat",this._numberFormat,"General",125,this._smallBtnHeight,"NumberFormat","NumberFormatContent")]},{groups:[this._generateBtn("Home_Number_Accounting","AccountingStyle","imageonly","e-icon e-ss-accounting","",this._smallBtnHeight,"AccountingStyle","AccountingStyleContent"),this._generateBtn("Home_Number_Percentage","PercentageStyle","imageonly","e-icon e-ss-percentage","",this._smallBtnHeight,"PercentageStyle","PercentageStyleContent"),this._generateBtn("Home_Number_CommaStyle","CommaStyle","imageonly","e-icon e-ss-comma","",this._smallBtnHeight,"CommaStyle","CommaStyleContent",!0),this._generateBtn("Home_Number_IncreaseDecimal","IncreaseDecimal","imageonly","e-icon e-ss-increasedecimal","",this._smallBtnHeight,"IncreaseDecimal","IncreaseDecimalContent"),this._generateBtn("Home_Number_DecreaseDecimal","DecreaseDecimal","imageonly","e-icon e-ss-decreasedecimal","",this._smallBtnHeight,"DecreaseDecimal","DecreaseDecimalContent")]}]};u.groups.push(n);n={id:"Styles",text:r._getLocStr("Styles"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateSplitBtn("Home_Styles_ConditionalFormatting","ConditionalFormat","textandimage",i+"_CFormat",{dataSource:this._cFormatMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-condformat",!1,75,this._splitBtnHeight,"bottom",f,"dropdown","e-spreadsheet e-cformatbtn","ConditionalFormat","CFContent"),this._generateSplitBtn("Home_Styles_FormatAsTable","FormatasTable","textandimage",i+"_formatastable","","e-icon e-ssr-formatastable",!1,65,this._splitBtnHeight,"bottom",t.ImagePosition.ImageTop,"dropdown","e-spreadsheet e-formatastablebtn","FormatAsTable","FATContent"),this._generateSplitBtn("Home_Styles_CellStyles","CellStyles","textandimage",i+"_cellstyles","","e-icon e-ssr-cellstyles",!1,55,this._splitBtnHeight,"bottom",t.ImagePosition.ImageTop,"dropdown","e-spreadsheet e-cellstylebtn","CellStyles","CellStylesContent")]}]};u.groups.push(n);n={id:"Editing",text:r._getLocStr("Editing"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Home_Editing_SortFilter","SortFilter","textandimage",i+"_Ribbon_SortFilter",{dataSource:this._sortFltrMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-sortfilter",!1,50,this._splitBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-sortfltrbtn","SortFilter","SortFilterContent")]},{groups:[this._generateSplitBtn("Home_Editing_AutoSum","AutoSum","textandimage",i+"_Ribbon_AutoSum",{dataSource:this._autosumMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-autosum",!1,100,25,"right","","","e-spreadsheet e-autosumbtn","AutoSumTitle","AutoSumContent"),this._generateSplitBtn("Home_Editing_Clear","Clear","textandimage",i+"_Ribbon_Clear",{dataSource:this._clearMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-clear",!1,80,25,"right","","dropdown","e-spreadsheet e-clearbtn","Clear","ClearContent")]}]};u.groups.push(n);this._tabCollection.push(u)},_insertTabObj:function(){var n,i=this.XLObj,f="imagetop",u={id:"insert",text:i._getLocStr("INSERT"),groups:[]},r=i._id;n={id:"Tables",text:i._getLocStr("Tables"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Insert_Tables_PivotTable","PivotTable","textandimage","e-icon e-ssr-pivottable",65,this._bigBtnHeight,"PivotTable","PivotTableContent",!1,f),this._generateBtn("Insert_Tables_Table","Table","textandimage","e-icon e-ssr-table",50,this._bigBtnHeight,"Table","TableContent",!1,f)]}]};u.groups.push(n);n={id:"Illustrations",text:i._getLocStr("Illustrations"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Insert_Illustrations_Pictures","Pictures","textandimage","e-icon e-ssr-pictures",50,this._bigBtnHeight,"PicturesTitle","PicturesContent",!1,f,"")]}]};u.groups.push(n);n={id:"Links",text:i._getLocStr("Links"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Insert_Links_Hyperlink","HyperLink","textandimage","e-icon e-ssr-hyperlink",60,this._bigBtnHeight,"HyperLinkTitle",["HyperLinkContent","HyperLinkPlaceContent"],!1,f,""," (Ctrl+K)")]}]};u.groups.push(n);n={id:"Charts",text:i._getLocStr("Charts"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateSplitBtn("Insert_Charts_ColumnChart","ColumnChart","imageonly",r+"_Ribbon_ColumnChart","","e-icon e-ss-colchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","ColumnChartTitle","ColumnChartContent"),this._generateSplitBtn("Insert_Charts_BarChart","BarChart","imageonly",r+"_Ribbon_BarChart","","e-icon e-ss-barchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","BarChartTitle","BarChartContent"),this._generateSplitBtn("Insert_Charts_StockChart","StockChart","imageonly",r+"_Ribbon_StockChart","","e-icon e-ss-stockchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","StockChartTitle","StockChartContent")]},{groups:[this._generateSplitBtn("Insert_Charts_LineChart","LineChart","imageonly",r+"_Ribbon_LineChart","","e-icon e-ss-linechart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","LineChartTitle","LineChartContent"),this._generateSplitBtn("Insert_Charts_AreaChart","AreaChart","imageonly",r+"_Ribbon_AreaChart","","e-icon e-ss-areachart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","AreaChartTitle","AreaChartContent"),this._generateSplitBtn("Insert_Charts_PieChart","PieChart","imageonly",r+"_Ribbon_PieChart","","e-icon e-ss-piechart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","PieChartTitle","PieChartContent")]},{groups:[this._generateSplitBtn("Insert_Charts_ScatterChart","ScatterChart","imageonly",r+"_Ribbon_ScatterChart","","e-icon e-ss-scterchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","ScatterChartTitle","ScatterChartContent")]}]};u.groups.push(n);i.model.allowSparkline&&u.groups.push(i.XLSparkline._tabInsert());this._tabCollection.push(u)},_dataTabObj:function(){var n,i=this.XLObj,r={id:"data",text:i._getLocStr("DATATAB"),groups:[]};n={id:"SortFilter",text:i._getLocStr("SortFilter"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Data_SortFilter_SortAtoZ","SortAtoZ","textandimage","e-icon e-ssr-sortatoz",90,this._smallBtnHeight,"SortAtoZ","SortAtoZContent",!1,"","e-datapadding"),this._generateBtn("Data_SortFilter_SortZtoA","SortZtoA","textandimage","e-icon e-ssr-sortztoa",90,this._smallBtnHeight,"SortZtoA","SortZtoAContent",!1,"","e-datapadding")]},{groups:[this._generateBtn("Data_SortFilter_Filter","Filter","textandimage","e-icon e-ssr-filter",60,this._smallBtnHeight,"Filter","FilterContent",!1,"","e-datapadding"),this._generateBtn("Data_SortFilter_ClearFilter","ClearFilter","textandimage","e-icon e-ss-clearfilter",90,this._smallBtnHeight,"ClearFilter","ClearFilterContent",!1,"","e-datapadding")]}]};r.groups.push(n);n={id:"DataTools",text:i._getLocStr("DataTools"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Data_DataTools_DataValidation","Validation","imageonly","e-icon e-ssr-validation",70,39,"DataValidation","DVContent",!1,"imagetop"),this._generateSplitBtn("Data_DataTools_DataValidationOptions","DataValidation","textandimage",i._id+"_Ribbon_Validation",{dataSource:this._valMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,70,this._mediumBtnHeight,"bottom","","dropdown","e-ssr-validationsbtn","DataValidation","DVContent")]}]};r.groups.push(n);this._tabCollection.push(r)},_pageTabObj:function(){var n,i=this.XLObj,u="imagetop",r={id:"pagelayout",text:i._getLocStr("PAGELAYOUT"),groups:[]};n={id:"Show",text:i._getLocStr("Show"),alignType:t.Ribbon.alignType.rows,width:105,content:[{groups:[{contentID:i._id+"_Ribbon_pagesetupleft",type:t.Ribbon.type.custom,height:80},]}]};r.groups.push(n);n={id:"PageLayout",text:i._getLocStr("PageLayout"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("PageLayout_PageLayout_PageSize","size","imageonly","e-icon e-ssr-pagesize",65,44,"size","PageSizeContent",!1,u,""),this._generateSplitBtn("PageLayout_PageLayout_PageSizeOptions","PageSize","textandimage",i._id+"_Ribbon_PageSize",{dataSource:this._pageSizes,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,65,this._mediumBtnHeight,"bottom","","dropdown","e-ssr-pagesizesbtn","PageSize","PageSizeContent")]}]};r.groups.push(n);n={id:"Print",text:i._getLocStr("Print"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("PageLayout_Print_Print","Print","textandimage","e-icon e-ssr-print",50,this._bigBtnHeight,"Print","PrintContent",!1,u,"")]},{groups:[this._generateBtn("PageLayout_Print_PrintSelected","PrintSelected","textandimage","e-icon e-ssr-printselected",55,this._bigBtnHeight,"PrintSelected","PrintSelectedContent",!0,u,"")]}]};r.groups.push(n);this._tabCollection.push(r)},_reviewTabObj:function(){var n,r=this.XLObj,i="imagetop",u={id:"review",text:r._getLocStr("REVIEW"),groups:[]};n={id:"Comments",text:r._getLocStr("Comments"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Review_Comments_NewComment","New","textandimage","e-icon e-ssr-newcmnt",49,this._bigBtnHeight,"NewCommentTitle","NewCommentContent",!1,i)]},{groups:[this._generateBtn("Review_Comments_DeleteComment","Delete","textandimage","e-icon e-ssr-deletecmnt",49,this._bigBtnHeight,"DeleteComment","DeleteCommentContent",!1,i)]},{groups:[this._generateBtn("Review_Comments_PreviousComment","Previous","textandimage","e-icon e-ssr-previouscmnt",49,this._bigBtnHeight,"Previous","PreviousContent",!1,i)]},{groups:[this._generateBtn("Review_Comments_NextComment","Next","textandimage","e-icon e-ssr-nextcmnt",49,this._bigBtnHeight,"Next","NextContent",!1,i)]},{groups:[this._generateBtn("Review_Comments_ShowHideComment","ShowHide","textandimage","e-icon e-ssr-showhidecmnt",160,this._smallBtnHeight,"ShowHide","ShowHideContent",!1,"imageLeft","e-ssr-cmntcolbtn"),this._generateToggleBtn("Review_Comments_ShowAllComments","ShowAll","textandimage","e-icon e-ssr-showallcmnt","ShowAll",155,this._smallBtnHeight,"ShowAllContent",!1,"e-ssr-cmntcolbtn")]}]};u.groups.push(n);n={id:"Changes",text:r._getLocStr("Changes"),alignType:t.Ribbon.alignType.row,content:[{groups:[this._generateToggleBtn("Review_Changes_ProtectSheet","Protectsheet","textandimage","e-icon e-ssr-protectsheet","Protectsheet",60,this._bigBtnHeight,"ProtectSheetToolTip",!1,"e-ssr-protectsheetbtn","imagetop","Unprotect"),this._generateToggleBtn("Review_Changes_ProtectWorkbook","ProtectWorkbook","textandimage","e-icon e-ssr-protect","ProtectWorkbook",60,this._bigBtnHeight,"ProtectWBContent",!1,"e-ssr-cmntcolbtn","imagetop"),this._generateToggleBtn("Review_Changes_LockCell","Lock","textandimage","e-icon e-ssr-protlockcell","lock",90,this._smallBtnHeight,"Lock",!1,"e-ssr-lockbtn","","Unlock","e-icon e-ssr-protunlockcell"),]},]};u.groups.push(n);this._tabCollection.push(u)},_otherTabObj:function(){var n,i=this.XLObj,u="imagetop",r={id:"others",text:i._getLocStr("OTHERS"),groups:[]},f=i._id,e=t.ContentType;n={id:"Window",text:i._getLocStr("Window"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Others_Window_FreezePanes","FreezePanes","textandimage",i._id+"_Ribbon_FPane",{dataSource:this._viewMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-frzpane",!1,55,this._splitBtnHeight,"bottom",u,"dropdown","e-spreadsheet e-fpanebtn","FreezePanes","FreezePanesContent")]}]};r.groups.push(n);n={id:"Formulas",text:i._getLocStr("Formula"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Others_Formulas_NameManager","NameManager",e.TextAndImage,"e-icon e-ssr-namemngr",55,this._bigBtnHeight,"NameManager",["NameManagerContent","NameManagerFormulaContent"],!1,u,"")]},{groups:[this._generateBtn("Others_Formulas_DefineName","DefineName",e.TextAndImage,"e-icon e-ssr-definename",110,25,"DefineName","DefineNameContent"),this._generateSplitBtn("Others_Formulas_UseInFormula","UseInFormula","textandimage",i._id+"_nmuseinformula","","e-icon e-ssr-useformula",!1,125,25,t.ArrowPosition.Bottom,t.ImagePosition.ImageLeft,"dropdown","e-spreadsheet e-useinformulabtn","UseInFormula","UseInFormulaContent")]}]};r.groups.push(n);n={id:"Cells",text:i._getLocStr("Cells"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Others_Cells_InsertCell","Insert","imageonly","e-icon e-ssr-insert",54,40,"InsertTitle",["InsertContent","MultipleInsertContent"],!1,u),this._generateSplitBtn("Others_Cells_InsertCellOptions","Insert","textandimage",f+"_Ribbon_Ins",{dataSource:this._insertMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,54,this._mediumBtnHeight,"bottom","","dropdown","e-insertsbtn","InsertTitle","InsertSBContent")]},{groups:[this._generateBtn("Others_Cells_DeleteCell","Delete","imageonly","e-icon e-ssr-delete",54,40,"DeleteTitle",["DeleteContent","MultipleDeleteContent"],!1,u),this._generateSplitBtn("Others_Cells_DeleteCellOptions","Delete","textandimage",f+"_Ribbon_Del",{dataSource:this._deleteMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,54,this._mediumBtnHeight,"bottom","","dropdown","e-deletesbtn","DeleteTitle",["DeleteContent","MultipleDeleteContent"])]}]};r.groups.push(n);n={id:"Editing",text:i._getLocStr("Editing"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateSplitBtn("Others_Editing_FindSelect","FindSelect","textandimage",f+"_Ribbon_FindRep",{dataSource:this._findMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-findselect",!1,55,this._splitBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-findbtn","FindSelectTitle","FindSelectContent")]}]};r.groups.push(n);n={id:"Calculation",text:i._getLocStr("Calculation"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Others_CalCulation_CalculationOptions","CalculationOptions","textandimage",f+"_Ribbon_CalcOpt",{dataSource:this._calcOptData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-calcopt",!1,67,this._splitBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-coptbtn","CalcOptTitle",["CalcOptContent","CalcOptRecalcContent"])]},{groups:[this._generateBtn("Others_CalCulation_CalculateNow","CalculateNow",e.TextAndImage,"e-icon e-ss-calcnow",110,30,"CalculateNow",["CalculateNowContent","CalculateNowTurnOffContent"]),this._generateBtn("Others_CalCulation_CalculateSheet","CalculateSheet",e.TextAndImage,"e-icon e-ss-calcsheet",110,30,"CalculateSheet",["CalculateSheetContent","CalculateSheetTurnOffContent"])]}]};r.groups.push(n);this._tabCollection.push(r)},_renderRibbon:function(i){var r=this.XLObj,e=r._id,o=r.element,h,l=r.model,u=t.buildTag("div","","",{id:e+"_Ribbon"}),f,c=[r._getLocStr("HOME"),r._getLocStr("INSERT"),r._getLocStr("DATATAB"),r._getLocStr("PAGELAYOUT"),r._getLocStr("REVIEW"),r._getLocStr("OTHERS")],s;if(i?o.prepend(u):o.append(u),o.append(t.buildTag("ul","",{display:"none"},{id:e+"_Menu"})),h=t.SplitButton.prototype._documentClick,t.SplitButton.prototype._documentClick=function(t){n(t.target).is(".e-formatastable")||n(t.target).is(".e-formatastable-adaptive")||n(t.target).is(".e-cellstyles")||n(t.target).is(".e-cellstyles-adaptive")||h.call(this,t)},s=[r._getLocStr("HOME"),r._getLocStr("INSERT"),r._getLocStr("PAGELAYOUT"),r._getLocStr("DATATAB"),r._getLocStr("OTHERS"),r._getLocStr("FORMAT"),r._getLocStr("DESIGN"),r._getLocStr("CHARTDESIGN"),r._getLocStr("ANALYZE"),r._getLocStr("SPARKLINEDESIGN")],r.model.ribbonSettings.enableOnDemand&&!r._isRibbonDestroyed)this._createTrgtElement(r._getLocStr("HOME"));else for(f=0;f<s.length;f++)this._createTrgtElement(s[f],u);if(r._isRefresh||(this._menuCustomize(),this._homeTabObj(),this._insertTabObj(),this._dataTabObj(),this._pageTabObj(),this._reviewTabObj(),this._otherTabObj(),this._contextualTabObj()),u.attr("style","overflow:hidden"),u.height(0),u.width(0),u.ejRibbon({width:"100%",allowResizing:!0,applicationTab:this._appTabCollection,tabs:this._tabCollection,contextualTabs:this._contextualTabCollection,tabClick:n.proxy(this._onTabClick,this),tabSelect:n.proxy(this._onTabSelect,this),create:n.proxy(this._onControlCreated,this),collapse:n.proxy(this._onCollapse,this),backstageItemClick:n.proxy(this._onBackStageItemClick,this),groupExpand:n.proxy(this._onGroupExpander,this),pinState:n.proxy(this._onRibbonPin,this),expand:n.proxy(this._onRibbonExpand,this),groupClick:n.proxy(this._onRibbonGroupClick,this),_destroyed:n.proxy(this._rbnDestroy,this),enableOnDemand:r.model.ribbonSettings.enableOnDemand,beforeTabClick:n.proxy(this._onBeforeTabClick,this)}),u.css("height","auto"),u.width("100%"),l.scrollSettings.isResponsive&&(u.ejRibbon("option",{allowResizing:!0}),(r._phoneMode||r._tabMode)&&r._orientation==="landscape"&&u.ejRibbon("collapse")),r.model.ribbonSettings.enableOnDemand&&!r._isRibbonDestroyed)this._homeTabControls(),this._updateRibCustomCss(r._getLocStr("HOME")),this._isHomeTabCreate=!0,this._hideRibbonElem(r._getLocStr("HOME"));else for(this._isHomeTabCreate=!0,this._isInsertTabCreate=!0,this._isDataTabCreate=!0,this._isPageLayoutTabCreate=!0,this._isReviewTabCreate=!0,this._isOthersTabCreate=!0,this._isDesignTabCreate=!0,this._isFormatTabCreate=!0,this._isChartTabCreate=!0,this._analyzeTabCreate=!0,this._isAppTabCreate=!0,this._isSparklineTabCreate=!0,n("#"+e+"_Ribbon_review_Comments_5").css("vertical-align","middle"),f=0;f<6;f++)f!==1&&f!==4&&this._updateRibCustomCss(c[f]),this._hideRibbonElem(c[f]);this._hideOtherControls()},_createTabControls:function(t){var i=this.XLObj;switch(t){case i._getLocStr("HOME"):this._isHomeTabCreate||(this._homeTabControls(),this._isHomeTabCreate=!0,i._on(n("#"+i._id+"_cellstyles"),"click",i._cellStyleClick),i._on(n("#"+i._id+"_formatastable"),"click",i._formatAsTableClick),this._updateRibCustomCss(t),this._hideRibbonElem(t));break;case i._getLocStr("INSERT"):this._isInsertTabCreate||(this._isInsertTabCreate=!0,i._on(n(".e-"+i._id+".e-chartcell"),"click",i._chartClickHandler),this._hideRibbonElem(t));break;case i._getLocStr("DATATAB"):this._isDataTabCreate||(this._isDataTabCreate=!0,this._updateRibCustomCss(t),this._hideRibbonElem(t));break;case i._getLocStr("PAGELAYOUT"):this._isPageLayoutTabCreate||(this._pageTabControls(),this._isPageLayoutTabCreate=!0,this._updateRibCustomCss(t),this._hideRibbonElem(t));break;case i._getLocStr("REVIEW"):this._isReviewTabCreate||(n("#"+i._id+"_Ribbon_review_Comments_5").css("vertical-align","middle"),this._isReviewTabCreate=!0,this._hideRibbonElem(t));break;case i._getLocStr("OTHERS"):this._isOthersTabCreate||(this._othersTabControls(),this._isOthersTabCreate=!0,this._updateRibCustomCss(t),i._on(n("#"+i._id+"_nmuseinformula"),"click",".e-nmuseinformularow",i._useInFormulaClick),this._hideRibbonElem(t));break;case i._getLocStr("FORMAT"):this._isFormatTabCreate||(this._isFormatTabCreate=!0);break;case i._getLocStr("DESIGN"):this._isDesignTabCreate||(this._isDesignTabCreate=!0);break;case i._getLocStr("CHARTDESIGN"):this._isChartTabCreate||(this._isChartTabCreate=!0);break;case i._getLocStr("ANALYZE"):this._analyzeTabCreate||(this._isFormatTabCreate=!0);break;case i._getLocStr("SPARKLINEDESIGN"):this._isSparklineTabCreate||(this._isSparklineTabCreate=!0)}},_createTrgtElement:function(t,i){var r=this.XLObj;i=i?i:n("#"+r._id+"_Ribbon");switch(t){case r._getLocStr("HOME"):this._isHomeTabTrgt||this._homeTabTrgtElem();this._isHomeTabTrgt=!0;break;case r._getLocStr("INSERT"):this._isInsertTabTrgt||this._onTabCreate();this._isInsertTabTrgt=!0;break;case r._getLocStr("DATATAB"):this._isDataTabTrgt||this._dataTabTrgtElem();this._isDataTabTrgt=!0;break;case r._getLocStr("PAGELAYOUT"):this._isPageLayoutTabTrgt||this._pageTabTrgtElem(i);this._isPageLayoutTabTrgt=!0;break;case r._getLocStr("OTHERS"):this._isOthersTabTrgt||this._othersTabTrgtElem();this._isOthersTabTrgt=!0;break;case r._getLocStr("CHARTDESIGN"):this._isChartTabTrgt||this._renderChartDesignTab();this._isChartTabTrgt=!0;break;case r._getLocStr("ANALYZE"):this._analyzeTabTrgt||this._renderAnalyzeTab();this._analyzeTabTrgt=!0;break;case r._getLocStr("FORMAT"):this._isFormatTabTrgt||this._renderFormatTab();this._isFormatTabTrgt=!0;break;case r._getLocStr("DESIGN"):this._isDesignTabTrgt||this._renderDesignTab();this._isDesignTabTrgt=!0;break;case r._getLocStr("SPARKLINEDESIGN"):r.model.allowSparkline&&(this._isSparklineTrgt||r.XLSparkline._renderSparklineTab());this._isSparklineTrgt=!0}},_onTabCreate:function(){var t=this.XLObj,i=t.element,r=n("#"+t._id+"_Ribbon");i.append(this._chartType("ColumnChart",6,2,2,["column","stackingcolumn","stackingcolumn100","column","stackingcolumn","stackingcolumn100"],[t._getLocStr("ClusteredColumn"),t._getLocStr("StackedColumn"),"100%&nbsp;"+t._getLocStr("StackedColumn"),"3-D&nbsp;"+t._getLocStr("ClusteredColumn"),"3-D&nbsp;"+t._getLocStr("StackedColumn"),"3-D&nbsp;100%&nbsp;"+t._getLocStr("StackedColumn")]));i.append(this._chartType("BarChart",6,2,2,["bar","stackingbar","stackingbar100","bar","stackingbar","stackingbar100"],[t._getLocStr("ClusteredBar"),t._getLocStr("StackedBar"),"100%&nbsp;"+t._getLocStr("StackedBar"),"3-D&nbsp;"+t._getLocStr("ClusteredBar"),"3-D&nbsp;"+t._getLocStr("StackedBar"),"3-D&nbsp;100%&nbsp;"+t._getLocStr("StackedBar")]));i.append(this._chartType("StockChart",2,2,2,["radar","radar"],[t._getLocStr("Radar"),t._getLocStr("RadarMarkers")]));i.append(this._chartType("LineChart",2,2,3,["line","line"],[t._getLocStr("Line"),t._getLocStr("LineMarkers")]));i.append(this._chartType("AreaChart",3,3,3,["Area","stackingarea","stackingarea100"],[t._getLocStr("Area"),t._getLocStr("StackedArea"),"100%&nbsp;"+t._getLocStr("StackedArea")]));i.append(this._chartType("PieChart",3,3,4,["pie","pie","doughnut"],[t._getLocStr("Pie"),"3-D&nbsp;"+t._getLocStr("Pie"),t._getLocStr("Doughnut")]));i.append(this._chartType("ScatterChart",1,2,2,["scatter"],[t._getLocStr("Scatter")]));r.append("<div id='"+t._id+"_nmuseinformula' class='e-nmuseinformula' style='width:125px'><\/div>")},_rbnDestroy:function(i){var r=this.XLObj,u=r._id,s="#"+u+"_Ribbon_Home_Font_FillColor",h="#"+u+"_Ribbon_Home_Font_FontColor",c="#"+u+"_Ribbon_PictureColor",l="#"+u+"_Ribbon_SparklineColor",a="#"+u+"_Ribbon_MarkerNegativePoint",v="#"+u+"_Ribbon_MarkerHighPoint",y="#"+u+"_Ribbon_MarkerLowPoint",e="#"+u+"_Ribbon_Home_Font_BorderColor",p="#"+u+"_Ribbon_BorderCP",w=n("#"+u+"_Ribbon").ejRibbon("instance"),b=w.getTabText(w.model.selectedItemIndex),k=r.model.ribbonSettings.enableOnDemand;if(n(s).data("ejColorPicker")&&n(s).ejColorPicker("destroy"),n(h).data("ejColorPicker")&&n(h).ejColorPicker("destroy"),n(c).data("ejColorPicker")&&n(c).ejColorPicker("destroy"),n(e).data("ejColorPicker")&&n(e).ejColorPicker("destroy"),n(l).data("ejColorPicker")&&n(l).ejColorPicker("destroy"),n(a).data("ejColorPicker")&&n(a).ejColorPicker("destroy"),n(v).data("ejColorPicker")&&n(v).ejColorPicker("destroy"),n(y).data("ejColorPicker")&&n(y).ejColorPicker("destroy"),n("#"+u+"_Ribbon_Home_Font_BorderColor_Presets").parent().remove(),n(p).data("ejColorPicker")&&n(p).ejColorPicker("destroy"),i&&!i.destroy){if(r._off(n("#"+u+"_cellstyles"),"click",r._cellStyleClick),r._off(n("#"+u+"_formatastable"),"click",r._formatAsTableClick),r._off(n("#"+u+"_databars_1"),"click",r._databarItemClick),r._off(n("#"+r._id+"_iconsets_2"),"click",r._databarItemClick),r._off(n("#"+r._id+"_iconsets_3"),"click",r._databarItemClick),r._off(n("#"+r._id+"_iconsets_4"),"click",r._databarItemClick),r._off(n("#"+r._id+"_iconsets_5"),"click",r._databarItemClick),r._off(n("#"+r._id+"_colorscales_1"),"click",r._databarItemClick),n(e)[0].style.display="none",r._off(n(".e-"+u+".e-chartcell"),"click",r._chartClickHandler),!k||this._isHomeTabTrgt&&b===r._getLocStr("HOME")){var f=r.element,d=u+"_Ribbon_",o=d+"Home_Font_";f.append(t.buildTag("input","",{display:"none"},{id:o+"FillColor",type:"text"}));f.append(t.buildTag("input","",{display:"none"},{id:o+"FontColor",type:"text"}));f.append(t.buildTag("input","",{display:"none"},{id:o+"BorderColor",type:"text"}));f.append(t.buildTag("div.e-spreadsheet e-formatastable","",{display:"none"},{id:r._id+"_formatastable"}));r.element.append(this._renderCellStyles())}else this._isHomeTabTrgt=!1;!k||this._isInsertTabTrgt&&b===r._getLocStr("INSERT")?this._onTabCreate():this._isInsertTabTrgt=!1;this._isHomeTabCreate=this._isInsertTabCreate=this._isDataTabCreate=this._isPageLayoutTabCreate=this._isReviewTabCreate=!1;this._isOthersTabCreate=this._isDesignTabCreate=this._isFormatTabCreate=this._isChartTabCreate=this._isSparklineTabCreate=this._analyzeTabCreate=this._isAppTabCreate=!1;r._isRibbonDestroyed=!0}else n(document.body).append(n("#"+u+" _formatastable").parent()),n(document.body).append(n("#"+u+" _cellstyles").parent())},_updateRibCustomCss:function(n){var r=this.XLObj,i=r._id,k,d,g,nt,u,s,a,t=0,tt,h="Options",e,o,c,f,p,w,b;switch(n){case r._getLocStr("HOME"):var it="e-ssr-colpickHprt",rt="_Ribbon_Home_Font",ut="_Ribbon_home_Font_Home_Font_",ft="_Ribbon_home_Clipboard_Home_Clipboard_Paste",st=["e-mergebtn","e-borderbtn","e-autosumbtn"],v=[i+ut+"FontFamily",i+ut+"FontSize"],y=["e-ssr-fontfamily","e-ssr-fontsize"];for(c=[i+ft+h],o=[i+ft],e=[i+"_Ribbon_home_Clipboard_1"],f=[" e-ssr-pastebtnHprt"],r.addClass(document.getElementById(i+rt+"_FillColorWrapper").children[0],it),r.addClass(document.getElementById(i+rt+"_FontColorWrapper").children[0],it),nt=r.element[0].querySelectorAll(".e-ssr-colpickHprt .e-color-container,.e-ssr-colpickHprt .e-select");t<4;)r.addClass(nt[t],"e-ssr-colorcontainer"),t++;for(t=0;t<3;)r.addClass(document.querySelectorAll("."+st[t])[0].parentNode,"e-ssr-horizontalprt"),t++;for(t=0;t<2;)r.addClass(document.getElementById(v[t]),y[t]),t++;break;case r._getLocStr("DATATAB"):p="_Ribbon_data_DataTools_Data_DataTools_DataValidation";c=[i+p+h];o=[i+p];e=[i+"_Ribbon_data_DataTools_1"];f=[" e-ssr-dtvaldtnHprt"];break;case r._getLocStr("PAGELAYOUT"):for(w="_Ribbon_pagelayout_PageLayout_PageLayout_PageLayout_PageSize",b="_Ribbon_PageLayout_Show_",v=["ej"+i+b+"Headings","ej"+i+b+"Gridlines"],y=["e-vheading","e-vgridlines"],c=[i+w+h],o=[i+w],e=[i+"_Ribbon_pagelayout_PageLayout_1"],f=[" e-ssr-pagesizebtnHprt"," e-ssr-sizebtnHprt"],t=0;t<2;)r.addClass(document.getElementById(v[t]),y[t]),t++;break;case r._getLocStr("OTHERS"):var et="InsertCell",l="_Ribbon_others_Cells_Others_Cells_",ot="DeleteCell";c=[i+l+et+h,i+l+ot+h];o=[i+l+et,i+l+ot];e=[i+"_Ribbon_others_Cells_1",i+"_Ribbon_others_Cells_2"];f=[" e-ssr-insertbtnHprt"," e-ssr-deletebtnHprt"]}for(t=0,tt=e.length;t<tt;)a=document.getElementById(e[t]),g=document.getElementById(o[t]),k=document.getElementById(o[t]),d=document.getElementById(c[t]),u=document.createElement("span"),u.className="e-ssr-verticalHparent"+f[t],u.style.display="inherit",a.insertBefore(u,g),u.appendChild(k),u.appendChild(d),f[0]===" e-ssr-pagesizebtnHprt"&&(s=document.createElement("span"),s.className="e-ssr-verticalHparent"+f[t+1],s.style.display="inherit",s.appendChild(u),a.appendChild(s)),t++},_hideOtherControls:function(){for(var t=0,i=["CElement","SElement","Paste","Border","Merge","SortFilter","Clear","ColumnChart","BarChart","Validation","PageSize","FPane","Ins","Del","FindRep","PastePic","PictureBorder","AutoSum","ResetPic","PictureBorder","StockChart","LineChart","AreaChart","PieChart","ScatterChart","color_Presets","PictureColor_Presets","Home_Font_BorderColor_Presets"];t--;)n("#"+this._id+"_Ribbon_"+i[t]).hide();for(t=0,i=["CFormat","formatastable","cellstyles","ctxtmenu"];t--;)n("#"+this._id+"_"+i[t]).hide()},_renderAppTab:function(){var i,n=this.XLObj,r=[];i="<div  id='"+n._id+"_backstagetabnew' style='display:none' class='e-ssr-bstabnew'><div class='e-ssr-bscontent' title='"+n._getLocStr("BlankWorkbook")+"'><div class='e-ssr-bsnewtmpl' ><button id='"+n._id+"_bstab_new_blank' type='button' class = 'e-rbn-button' ><\/button><\/div><\/div><\/div>";i=i.concat("<div id='"+n._id+"_backstagetabsaveas' style='display:none' class='e-ssr-bstabsaveas'><div class='e-ssr-bscontent'><div class='e-ssr-bssaveasopt'><button id='"+n._id+"_bstab_saveas_excel' type='button' class = 'e-rbn-button'><\/button><span>"+n._getLocStr("SaveAsExcel")+"<\/span><\/div><div class='e-ssr-bssaveasopt'><button id='"+n._id+"_bstab_saveas_csv' type='button' class = 'e-rbn-button'><\/button><span>"+n._getLocStr("SaveAsCsv")+"<\/span><\/div><div class='e-ssr-bssaveasopt'><button id='"+n._id+"_bstab_saveas_pdf' type='button' class = 'e-rbn-button'><\/button><span>"+n._getLocStr("SaveAsPdf")+"<\/span><\/div><\/div><\/div>");i=i.concat("<div id='"+n._id+"_backstagetabprint' style='display:none' class='e-ssr-bstabprint'><div class='e-ssr-bscontent'><div class='e-ssr-bsprintopt'><button id='"+n._id+"_bstab_print_sheet' type='button' class = 'e-rbn-button'><\/button><span>"+n._getLocStr("PrintSheet")+"<\/span><\/div><div class='e-ssr-bsprintopt'><button id='"+n._id+"_bstab_print_selected' type='button' class = 'e-rbn-button'><\/button><span>"+n._getLocStr("PrintSelected")+"<\/span><\/div><\/div><\/div>");n.element.append(i);r.push({id:"new",text:n._getLocStr("New"),itemType:t.Ribbon.itemType.tab,contentID:n._id+"_backstagetabnew"});r.push({id:"open",text:n._getLocStr("Open")+"...",itemType:t.Ribbon.itemType.tab});r.push({id:"saveas",text:n._getLocStr("SaveAs"),itemType:t.Ribbon.itemType.tab,contentID:n._id+"_backstagetabsaveas"});r.push({id:"print",text:n._getLocStr("Print"),itemType:t.Ribbon.itemType.tab,contentID:n._id+"_backstagetabprint"});this._appTabCollection={type:t.Ribbon.applicationTabType.backstage,backstageSettings:{text:n._getLocStr("File"),headerWidth:124,height:n._responsiveHeight-2,width:n._responsiveWidth-3,pages:r}}},_onBackStageItemClick:function(t){var i,e,r,f,u;if(this._isAppTabCreate||(this._appTabControls(),this._isAppTabCreate=!0),i=this.XLObj,f=i.model.ribbonSettings.applicationTab,i.XLEdit._isEdit&&i.XLEdit.saveCell(),i.XLComment&&i.XLComment._isCommentEdit&&i.XLComment._updateCurCmntVal(),i._isSheetRename&&!i._updateSheetNames(null,!1)){i.element.find("#"+i._id+"_Ribbon").ejRibbon("hideBackstage");return}if(f.type==="menu"){if(e={element:t.element},i._trigger("menuClick",e))return!1;t.ID==="Open"?(i.XLEdit._isEdit&&i.XLEdit.saveCell(),this._bSBtnClickHandler(t.ID.toLowerCase(),t)):this._bSBtnClickHandler(t.ID.toLowerCase(),t)}if(f.type==="backstage")if(t.type==="backstageItemClick"){if(r={id:t.id,text:t.text,type:t.type,target:t.target,prop:t.model},i._trigger("menuClick",r))return!1;t.id==="open_backStageTab"&&(i.XLEdit._isEdit&&i.XLEdit.saveCell(),this._bSBtnClickHandler("open",t))}else{if(r={e:t.e,type:t.type,status:t.status,target:t.target,id:t.target.id},i._trigger("menuClick",r))return!1;n("#"+i._id+"_Ribbon").ejRibbon("hideBackstage");i._phoneMode&&n("#"+i._id+"_Ribbon").ejRibbon("goToMainContent");u=t.model.prefixIcon;this._bSBtnClickHandler(u.indexOf("blank")>-1?u.split("-")[2]:u.split("-")[3],t)}},_bSBtnClickHandler:function(t,i){var r=this.XLObj,f=r.getActiveSheetIndex(),u,e={id:i.id||i.ID||i.target.id,status:i.status,prop:i.model,model:r.model};if(r._trigger("ribbonClick",e))return!1;n("#"+r._id+"_Ribbon").ejRibbon("hideBackstage");switch(t){case"open":if(r.isDirty)r._showAlertDlg("confirm","ImportAlert","Open",470);else{if(r.model.importSettings.importMapper.length<1){r._showAlertDlg("Alert","ImportExportUrl");return}n("#"+r._id+"_file .e-uploadinput").click();r._browserDetails.name!="msie"&&r._browserDetails.name!="edge"&&n("#"+r._id+"_Ribbon_BackStage").show();n("#"+r._id+"_Ribbon").find(".e-backstagetitlecontent").text("").append("Open")}break;case"new":case"blank":r._isSheetsDirty()&&r._showAlertDlg("confirm","DestroyAlert","New",470);break;case"exportxl":case"exportcsv":case"exportpdf":r._showDialog(t);n("#"+r._id+"_ExportFileNameDialog").ejDialog("open");u=t.split("export")[1];r.XLExport._exportType=u.indexOf("xl")>-1?"Excel":u.charAt(0).toUpperCase()+u.slice(1);break;case"print":case"printsheet":r.XLPrint.printSheet(f);break;case"printselected":r.XLPrint.printSelection(f)}},_contextualTabObj:function(){var n=this.XLObj,i=n._id,u="imagetop",r;r={backgroundColor:"#FCFBEB",borderColor:"#F2CC1C",tabs:[{id:"design",text:n._getLocStr("Design"),groups:[{id:"Properties",text:n._getLocStr("Properties"),alignType:t.Ribbon.alignType.rows,type:"custom",contentID:i+"_Ribbon_Design_Properties_TableProperties"},{id:"Tools",text:n._getLocStr("Tools"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Design_Tools_ResizeTable","ResizeTable","textandimage","e-icon e-ssr-resizetable",101,this._smallBtnHeight,"ResizeTable","ResizeTableContent"),this._generateBtn("Design_Tools_ConvertToRange","ConvertToRange","textandimage","e-icon e-ssr-range",130,this._smallBtnHeight,"ConvertToRange","ConvertToRangeContent")]}]},{id:"TableStyleOptions",text:n._getLocStr("TableStyleOption"),alignType:t.Ribbon.alignType.rows,type:"custom",contentID:i+"_Ribbon_Design_TableStyleOptions"}]}]};this._contextualTabCollection.push(r);r={backgroundColor:"#EAF6BD",borderColor:"#90AA3C",tabs:[{id:"chartdesign",text:n._getLocStr("CHARTDESIGN"),groups:[{id:"ChartLayouts",text:n._getLocStr("ChartLayouts"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("ChartDesign_ChartLayouts_AddChartElement","AddChartElement","textandimage",i+"_Ribbon_CElement","","e-icon e-ssr-celements",!0,65,this._bigBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-chartlayoutbtn","AddChartElement","AddChartElementContent")]}]},{id:"Data",text:n._getLocStr("ChartDesignData"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("ChartDesign_Data_SwitchRowColumn","SwitchRowColumn","textandimage","e-icon e-ssr-srcolumn",72,this._bigBtnHeight,"SwitchRowColumn","SwitchRowColumnContent","","imagetop"),this._generateBtn("ChartDesign_Data_SelectData","SelectData","textandimage","e-icon e-ssr-selectdata",50,this._bigBtnHeight,"SelectData","SelectDataContent",!1,u)]}]},{id:"Type",text:n._getLocStr("ChartDesignType"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("ChartDesign_Type_ChangeChartType","ChartType","textandimage","e-icon e-ssr-charttype",65,this._bigBtnHeight,"ChartType","ChartTypeContent",!1,u)]}]},{id:"ChartThemes",text:n._getLocStr("ChartThemes"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateDD("ChartDesign_ChartThemes_ChartThemes","ChartThemes",this._chartThemes,"1",130,this._smallBtnHeight,"ChartThemes","ChartThemesContent")]}]},{id:"Size",text:n._getLocStr("ChartDesignSize"),alignType:t.Ribbon.alignType.columns,content:[{groups:[{contentID:i+"_Ribbon_ChartDesign_Size_ChartSize",enableSeparator:!0,type:t.Ribbon.type.custom,height:80}]}]}]}]};this._contextualTabCollection.push(r);n.model.allowSparkline&&this._contextualTabCollection.push(n.XLSparkline._contextualTabInsert());r={backgroundColor:"#FCFBEB",borderColor:"#F2CC1C",tabs:[{id:"format",text:n._getLocStr("FORMAT"),groups:[{id:"Adjust",text:n._getLocStr("Adjust"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Format_Adjust_ChangePicture","ChangePicture","textandimage","e-icon e-ssr-changepicture",120,this._mediumBtnHeight,"ChangePicture","ChangePictureContent"),this._generateSplitBtn("Format_Adjust_ResetPicture","ResetPicture","textandimage",i+"_Ribbon_ResetPic",{dataSource:this._resetPicture,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-resetpicture",!1,120,this._mediumBtnHeight,"left","","dropdown","e-ss-resetpictbtn","ResetPicture","ResetPictureContent")]}]},{id:"Border",text:n._getLocStr("Border"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Format_Border_PictureBorder","PictureBorder","textandimage",i+"_Ribbon_PictureBorder","","e-icon e-ssr-pictureborder",!1,120,this._mediumBtnHeight,"left","","dropdown","e-ss-pictbrdrbtn","PictureBorder","PictureBorderContent")]}]},{id:"Size",text:n._getLocStr("FormatSize"),alignType:t.Ribbon.alignType.columns,type:"custom",contentID:i+"_Ribbon_Format_Size_PictureSize"}]}]};this._contextualTabCollection.push(r);r={backgroundColor:"#FCF0F7",borderColor:"#C9599C",tabs:[{id:"analyze",text:n._getLocStr("ANALYZE"),groups:[{id:"PivotTable",text:n._getLocStr("AnalyzePivotTable"),alignType:t.Ribbon.alignType.rows,type:"custom",contentID:i+"_pvttableproperties"},{id:"DataSource",text:n._getLocStr("DataSource"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Analyze_DataSource_Refresh","Refresh","textandimage","e-icon e-ssr-datarefresh",50,this._bigBtnHeight,"RefreshTitle","RefreshContent",!1,u),this._generateBtn("Analyze_DataSource_ChangeDataSource","ChangeDataSource","textandimage","e-icon e-ssr-changedatasource",50,this._bigBtnHeight,"ChangeDataSource","ChangeDataSourceContent",!1,u)]}]},{id:"Actions",text:n._getLocStr("Actions"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Analyze_Actions_ClearAll","ClearAll","textandimage","e-icon e-ssr-pivotclearall",75,this._smallBtnHeight,"ClearAll","ClearAllContent",!1,"","e-datapadding"),this._generateBtn("Analyze_Actions_MovePivotTable","MovePivotTable","textandimage","e-icon e-ssr-movepivottable",120,this._smallBtnHeight,"MovePivotTable","MovePivotTableContent",!1,"","e-datapadding")]}]},{id:"Show",text:n._getLocStr("Show"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateToggleBtn("Analyze_Show_FieldList","FieldList","textandimage","e-icon e-ssr-fieldlist","FieldListTitle",50,this._bigBtnHeight,["FieldListContent","FieldListRemoveContent"],!1,"",u,null,null,!0)]}]}]}]};this._contextualTabCollection.push(r)},_onRibbonPin:function(t){var i=this.XLObj,u=n.extend(!0,{},i.model.scrollSettings),r;this._ribbonState=!0;i.getSheet(i.getActiveSheetIndex())._isRibCollapsed=!1;t.action="toggleBtn";i.model._isActPanelVisible=this._isPanelVisible;i._isAutoWHMode?(this._refreshBackstageHeight(),r=i._getElementDimension(),i.element.css({height:r.height,width:r.width})):i._heightWidthCalculation(i.getActiveSheetIndex(),u,t);i.model._isActPanelVisible&&i._refreshActivationPanel()},_onRibbonExpand:function(t){var i=this.XLObj,u=n.extend(!0,{},i.model.scrollSettings),r;t.action="toggleBtn";t.type==="expand"&&t.clickType==="dblclick"||i._isKeyCtrlShftF2||i._phoneMode?(this._ribbonState=!0,i.getSheet(i.getActiveSheetIndex())._isRibCollapsed=!1,i._isAutoWHMode?(this._refreshBackstageHeight(),r=i._getElementDimension(),i.element.css({height:r.height,width:r.width})):i._heightWidthCalculation(i.getActiveSheetIndex(),u,t),this.XLObj.model._isActPanelVisible&&i._refreshActivationPanel(),i._isKeyCtrlShftF2=!1):this.XLObj.model._isActPanelVisible&&(i.getActivationPanel().hide(),this._isPanelVisible=i.model._isActPanelVisible,i.model._isActPanelVisible=!1,i._heightWidthCalculation(i.getActiveSheetIndex(),u,t))},_onRibbonGroupClick:function(t){var i=this.XLObj,u,r;i._phoneMode&&(n(t.target).parents(".e-resizegroupdiv").length>0||t.target.className.indexOf("e-resizegroupdiv")>-1||t.target.className.indexOf("e-ribdownarrow")>-1||t.target.className.indexOf("e-ribuparrow")>-1||t.target.className.indexOf("e-ribleftarrow")>-1)&&(u=n.extend(!0,{},i.model.scrollSettings),this._ribbonState=!0,t.action="toggleBtn",i.model._isActPanelVisible=this._isPanelVisible,i._isAutoWHMode?(this._refreshBackstageHeight(),r=i._getElementDimension(),i.element.css({height:r.height,width:r.width})):i._heightWidthCalculation(i.getActiveSheetIndex(),u,t),i.model._isActPanelVisible&&i._refreshActivationPanel())},_hideTabs:function(){for(var r=n("#"+this.XLObj._id+"_Ribbon").ejRibbon("instance"),i=["",this.XLObj._getLocStr("Design"),this.XLObj._getLocStr("CHARTDESIGN"),this.XLObj._getLocStr("FORMAT"),this.XLObj._getLocStr("ANALYZE"),this.XLObj._getLocStr("SPARKLINEDESIGN")],t=i.length;t=t-1;)r.hideTab(i[t])},_renderDesignTab:function(){var i=this.XLObj,r="",u=i._getLocStr("TableStyleOptions").split("/"),t=i._id+"_Ribbon_Design_TableStyleOptions";i.element.append("<input id="+i._id+'_tableid type="text" style = "display:none"/>');r="<div id="+i._id+'_Ribbon_Design_Properties_TableProperties><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell">Table Name:<\/div><\/div><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell"><input type="text" id='+i._id+'_Ribbon_Design_Properties_TableName class="ejinputtext" style="width:86px;opacity:0.7;height: 18px;text-indent: 3px;padding-left: 0px;box-sizing: content-box;" /><\/div><\/div><\/div>';r=r+"<div id="+t+'><div class="e-tablestyleoptionsrow" ><div class="e-tablestyleoptionscell"><input id='+t+'_FirstColumn type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+t+'_FirstColumn">'+u[0]+'<\/label><\/div><div class="e-tablestyleoptionscell" ><input id='+t+'_LastColumn type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+t+'_LastColumn">'+u[1]+'<\/label><\/div><\/div><div class="e-tablestyleoptionsrow" ><div class="e-tablestyleoptionscell"><input id='+t+'_TotalRow type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+t+'_TotalRow">'+u[2]+'<\/label><\/div><div class="e-tablestyleoptionscell" ><input id='+t+'_FilterColumn type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+t+'_FilterColumn">'+u[3]+"<\/label><\/div><\/div><\/div>";i.element.append(r);n("#"+t+"_FirstColumn").ejCheckBox({change:this._ribbonClickHandler});n("#"+t+"_LastColumn").ejCheckBox({change:this._ribbonClickHandler});n("#"+t+"_TotalRow").ejCheckBox({change:this._ribbonClickHandler});n("#"+t+"_FilterColumn").ejCheckBox({change:this._ribbonClickHandler})},_renderFormatTab:function(){var u=this.XLObj,f=u._id,e=u.element,i=f+"_Ribbon",r=i+"_Format_Size_",o;e.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:i+"_ResetPic"}));e.append(this._borderPicture());e.append("<div id="+r+"PictureSize class= e-ss-numeric style='display:none'><table><tr><td style='padding-right:4px;'>"+u._getLocStr("Height")+": <\/label><\/td><td style='padding-bottom:3px;'><input id='"+r+"PictureHeight' type='text' /><\/td><\/tr><tr><td><labe>"+u._getLocStr("Width")+": <\/label><\/td><td><input id='"+r+"PictureWidth' type='text' /><\/td><\/tr><\/table><\/div>");n("#"+r+"PictureHeight").ejNumericTextbox({name:"numeric",value:100,minValue:25,incrementStep:5,change:n.proxy(this._pictureSizeChange,this,"PictureWidth")});n("#"+r+"PictureWidth").ejNumericTextbox({name:"numeric",value:100,minValue:25,incrementStep:5,change:n.proxy(this._pictureSizeChange,this,"PictureHeight")});n("#"+i+"_PictureColor").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:this._ribbonClickHandler});o=n("#"+i+"_PictureColor").data("ejColorPicker");this._isSetModel=!0;o.show();this._isSetModel=!1;n("#"+i+"_PictureColorWrapper").hide();n("#"+i+"_PictureColor_popup").css({display:"block"});n("#"+f+"picturecolor ul li").find("a").remove();n("#"+f+"picturecolor ul li").append(n("#"+i+"_PictureColor_popup"))},_renderAnalyzeTab:function(){var n=this.XLObj;n.element.find("#"+n._id+"_Ribbon_analyze_PivotTable_content").width(132);n.element.find("#"+n._id+"_pvttableproperties").length||n.element.append("<div id="+n._id+'_pvttableproperties style="display:none" ><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell">'+n._getLocStr("PivotTableName")+':<\/div><\/div><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell"><input type="text" id='+n._id+'_Ribbon_Analyze_PivotTable_PivotTableName class="ejinputtext" style="width:106px;opacity:0.7;height: 18px;text-indent: 3px;" /><\/div><\/div><\/div>')},_renderChartDesignTab:function(){var r=this.XLObj,u=r.element,i=r._id,t=i+"_Ribbon_ChartDesign_Size_";u.append(this._chartElementTag());u.append("<div id="+t+"ChartSize class= e-ss-numeric style='width: 180;height: 80;'><table><tr><td><label class ='e-icon e-ssr-chartheight' style='width:25;height:25;display: visible' id = "+i+"_Ribbon_chartheightlbl /><\/td><td><input id='"+t+"ChartHeight' type='text' /><\/td><\/tr><tr><td><label class ='e-icon e-ssr-chartwidth' style='width: 180;height: 80;' id = "+i+"_Ribbon_chartwidthlbl /><\/td><td><input id='"+t+"ChartWidth' type='text' /><\/td><\/tr><\/table><\/div>");n("#"+t+"ChartWidth").ejNumericTextbox({name:"numeric",value:200,minValue:180,decimalPlaces:1,incrementStep:5,change:this._ribbonClickHandler});n("#"+t+"ChartHeight").ejNumericTextbox({name:"numeric",value:200,minValue:180,decimalPlaces:1,incrementStep:5,change:this._ribbonClickHandler})},_renderNameManagerDlg:function(){var i=this.XLObj,r="<div id = '"+i._id+"_nmdlg' style=display:'none'; ><div class='e-dlgctndiv' style='width: 100%;' ><div class='e-dlg-fields e-nmdlg-content' style='width: 100%;'><div class='e-ss-nm-dlg-grid' style='height: 180px;'><div id='"+i._id+"_nmgrid' style=display:'none';><\/div><\/div><\/div><div class='e-dlg-fields'><label class='e-dlg-fields'>"+i._getLocStr("RefersTo")+":<\/label><input type='text' class='e-nmrange ejinputtext' id='"+i._id+"_nmrange' disabled='true' /><\/div><div class='e-dlg-btnfields' ><div class='e-dlg-btnctnr'><button id='"+i._id+"_nmclose' >"+i._getLocStr("Close")+"<\/button><\/div><\/div><\/div><\/div>";r=r+"<script id='"+i._id+"_nmeditortemplate' class='e-hide' type='text/x-jsrender' ><div class='e-dlg-fields e-dlgctndiv'><table cellpadding='0' cellspacing='0'><tr><td>"+i._getLocStr("Name")+":<\/td><td><input id='"+i._id+"_nmgridname' type='text' class='ejinputtext' name='name' value='{{: name}}'/><\/td><\/tr><tr class='e-dlgtd-fields'><td>"+i._getLocStr("Scope")+":<\/td><td><input class='ejinputtext' id='"+i._id+"_nmgridscope' type='text' name='scope' value='"+i._getLocStr("Workbook")+"'/><\/td><\/tr><tr class='e-dlgtd-fields'><td>"+i._getLocStr("Comment")+":<\/td><td><textarea id='"+i._id+"_nmgridcomment' class='e-ss-textarea' style=' resize: none; height: 44px; width: 100%;' name='comment' value='{{: comment}}'>{{: comment}}<\/textarea><\/td><\/tr><tr class='e-dlgtd-fields'><td>"+i._getLocStr("RefersTo")+":<\/td><td><input type='text' class='ejinputtext' id='"+i._id+"_nmgridrefersto' name = 'refersto' value='{{: refersto}}' /><\/td><\/tr><\/table><\/div><\/script>";i.element.append(r);n("#"+i._id+"_nmclose").ejButton({showRoundedCorner:!0,width:68,click:n.proxy(this._nmdlgClose,i)});this._renderNMGrid();n("#"+i._id+"_nmdlg").ejDialog({enableResize:!1,showOnInit:!1,title:i._getLocStr("NameManager"),enableModal:!0,width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-nmdlg e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this),beforeClose:t.proxy(this._beforeDlgClose,this),open:t.proxy(this._nmDlgOpen,this)})},_renderNMDDownList:function(){var t=this.XLObj;n("#"+t._id+"_nmgridscope").ejDropDownList({dataSource:this._nameMSheetNames(),width:"100%",height:"44px"})},_nameMSheetNames:function(){var u=this.XLObj,t=[],i=[],n,f,r=u._getSheetNames();for(i[0]={value:"Workbook",text:u._getLocStr("Workbook")},n=1,f=r.length;n<=f;n++)r[n-1].isVisible&&(t[n]=r[n-1].text,i[n]={value:t[n],text:t[n]});return i},_renderNMGrid:function(){var i=this.XLObj;n("#"+i._id+"_nmgrid").ejGrid({locale:i.model.locale,dataSource:i.model.nameManager.slice(0),allowScrolling:!0,allowSorting:!0,enableAltRow:!1,isResponsive:!0,minWidth:400,allowPaging:!1,scrollSettings:{height:"100%"},cssClass:"e-ss-dialog e-ss-grid e-"+i._id+"-dlg",selectionType:t.Grid.SelectionType.Single,editSettings:{allowAdding:!0,allowDeleting:!1,editMode:t.Grid.EditMode.DialogTemplate,dialogEditorTemplateID:"#"+i._id+"_nmeditortemplate"},toolbarSettings:{showToolbar:!0,toolbarItems:[t.Grid.ToolBarItems.Add]},actionBegin:n.proxy(this._nmActionBegin,i),actionComplete:n.proxy(this._nmActionComplete,i),rowSelected:n.proxy(this._nmRecordSelected,i),columns:[{field:"name",headerText:i._getLocStr("Name"),isPrimaryKey:!0,width:100},{field:"refersto",headerText:i._getLocStr("RefersTo"),width:120},{field:"scope",headerText:i._getLocStr("Scope"),width:80},{field:"comment",headerText:i._getLocStr("Comment"),width:100}]})},_updateNMRange:function(){var t=this.XLObj;n("#"+t._id+"_nmgridEditForm").find("#"+t._id+"_nmgridrefersto").val("="+t._getDollarAlphaRange(t.getSheet(t.getActiveSheetIndex()).selectedRange,!0))},_nmdlgClose:function(){n("#"+this._id+"_nmdlg").ejDialog("close")},_nmRecordSelected:function(t){n("#"+this._id+"_nmdlg").find(".e-nmrange").val(t.data.refersto)},_nmDlgOpen:function(){var t=this.XLObj;this._isNmgrid==="DefineName"&&(n("#"+t._id+"_nmgrid").ejGrid("instance").addRecord(),n("#"+t._id+"_nmgridEditForm input")[0].focus());this._isNmgrid=""},_nmActionBegin:function(n){var t=0,u=!1,f,e,r,i=this.getSheet(this.getActiveSheetIndex());if(n.requestType==="save"&&n.data.refersto){if(r=n.data,r.sheetIndex=this._getSheetIndexByName(n.data.refersto.split("!")[0].replace(/[=\']/g,"")),n.cancel=!0,!r.sheetIndex){this._showAlertDlg("Alert","InvalidSheetIndex","NMRangeAlert",275);return}if(i._nmEdit)for(e in i._nmValue){for(f=this.model.nameManager.length;t<f;){if(this.model.nameManager[t].name===i._nmValue.name){this.model.nameManager.splice(t,1);this._calcEngine.removeNamedRange(i._nmValue.name);break}t++}for(t=this._formulaCollection.length;t--;)if(this._formulaCollection[t].display===i._nmValue.name){u=!0;this._formulaCollection.splice(t,1);break}if(u)break}this.XLRibbon._validateNamedRange(r.name,r.refersto,r.scope)?n.cancel=!1:u&&this.model.nameManager.push(i._nmValue)}n.requestType==="beginedit"&&(i._nmEdit=!0,i._nmValue={name:n.model.dataSource[n.model.selectedRowIndex].name,refersto:n.model.dataSource[n.model.selectedRowIndex].refersto,comment:n.model.dataSource[n.model.selectedRowIndex].comment,sheetIndex:n.model.dataSource[n.model.selectedRowIndex].sheetIndex,scope:n.model.dataSource[n.model.selectedRowIndex].scope})},_nmActionComplete:function(t){var u=n("#"+this._id+"_nmgrid").data("ejGrid"),f=t.requestType,i,r;switch(f){case"add":i=n("#"+this._id+"_nmgrid_dialogEdit").data("ejDialog");i.model.open=n.proxy(this.XLRibbon._updateNMRange(),this);i.option("allowDraggable",!1);i.option("title",this._getLocStr("NewName"));r=n("#"+this._id+"_nmgridEditForm").find("input[type='button']:first");r.data("ejButton").option({text:this._getLocStr("Ok"),cssClass:"e-ss-okbtn"});r.parent().addClass("e-dlg-btnfields").css("text-align","right");this.XLRibbon._renderNMDDownList();break;case"save":this.XLRibbon._addNamedRange(t.data.name,t.data.refersto,t.data.comment,t.data.sheetIndex,t.data.scope);break;case"delete":this.XLRibbon._removeNamedRange(u,t.data.name,t.data.scope);break;case"cancel":u.element.focus()}},_updateNamedRanges:function(n,t,i,r){var u=this.XLObj;t=u.XLEdit._parseSheetRef(t,!0);r.toUpperCase()===u._getLocStr("Workbook").toUpperCase()?(u._calcEngine.addNamedRange(n,t.replace("=","")),this._scopeBookCln[n]={isName:!0}):u._calcEngine.addNamedRange(r+"!"+n,t.replace("=",""));this._updateScopeRange();i||u.XLEdit._refreshAutoComplete()},_updateUseInFormulaTrgt:function(){for(var i=0,t=this.XLObj,u="",s=n("#"+t._id+"_nmuseinformula"),r=t.model.nameManager,h=r.length,e=t.getActiveSheetIndex(),o,f;i<h;)r[i].scope.toUpperCase()!==t._getLocStr("Workbook").toUpperCase()&&(o=t._getSheetIndexByName(r[i].scope),f=t.getSheet(e)._scopeRanges),(r[i].scope.toUpperCase()===t._getLocStr("Workbook").toUpperCase()||e===o&&f&&f[r[i].name]&&!f[r[i].name].isSameName)&&(u=u+"<div class='e-nmuseinformularow' style = 'color:#333333'>"+r[i].name+"<\/div>"),i++;u.length?n("#"+t._id+"_Ribbon_Others_Formulas_UseInFormula").ejSplitButton("enable"):n("#"+t._id+"_Ribbon_Others_Formulas_UseInFormula").ejSplitButton("disable");s.html("<div>"+u+"<\/div>")},addNamedRange:function(i,r,u,f,e){var h=this.XLObj,s,o;(f=f||h.getActiveSheetIndex(),s=n("#"+h._id+"_nmgrid").data("ejGrid"),o={name:i,refersTo:r,comment:u,scope:t.isNullOrUndefined(e)?"workbook":e,sheetIndex:f,reqType:"named-range",type:"actionBegin",action:"addNamedRange"},h._trigActionBegin(o))||(i=o.name,r=o.refersTo,u=o.comment,e=o.scope,this._validateNamedRange(i,r,e)&&(s?(s.addRecord({name:i,refersto:r,comment:u?u:"",scope:e?e:"WorkBook",sheetIndex:f}),s.refreshContent()):this._addNamedRange(i,r,u,f,e)))},_addNamedRange:function(n,i,r,u,f){var e=this.XLObj,s,o,c;u=u||e.getActiveSheetIndex();var h={name:n,refersTo:i,comment:r,scope:t.isNullOrUndefined(f)?"workbook":f,sheetIndex:u,reqType:"named-range",type:"actionBegin",action:"addNamedRange"},l=e.model.nameManager,a=l.length;if(!e._trigActionBegin(h)){for(n=h.name,i=h.refersTo,r=h.comment,f=h.scope?h.scope:"workbook",o=e._getSheetIndexByName(f),o=o?o:u,f.toUpperCase()!==e._getLocStr("Workbook").toUpperCase()&&(c=e.getSheet(o),c._scopeRanges[n]?(c._scopeRanges[n].name=f+"!"+n,c._scopeRanges[n].refersto=i):c._scopeRanges[n]={name:f+"!"+n,refersto:i}),s=0;s<a;s++)l[s].name.toUpperCase()===n.toUpperCase()&&(l[s].scope.toUpperCase()==="WORKBOOK"&&f.toUpperCase()!=="WORKBOOK"||l[s].scope.toUpperCase()!=="WORKBOOK"&&f.toUpperCase()==="WORKBOOK")&&(o=f.toUpperCase()===e._getLocStr("Workbook").toUpperCase()?e._getSheetIndexByName(l[s].scope):e._getSheetIndexByName(f),e.getObjectLength(e.getSheet(o)._scopeRanges[n])||(e.getSheet(o)._scopeRanges[n]={}),e.getSheet(o)._scopeRanges[n].isSameName=!0);e.isImport||e.model.isImport||e.model.nameManager.push({name:n,refersto:i,comment:r,sheetIndex:u,scope:f});this._updateNamedRanges(n,i,!1,f);e.isImport||e.model.isImport||this._updateUseInFormulaTrgt();e._isSheetNavigate||e._trigActionComplete(h)}},removeNamedRange:function(t,i){if(t){var f=this.XLObj,r=n("#"+f._id+"_nmgrid").data("ejGrid"),u;if(i=i?i:"workbook",r)r.option("editSettings",{allowDeleting:!0}),r.deleteRecord("name",{name:t,scope:i}),r.option("editSettings",{allowDeleting:!1});else{if(u=this._validateNameManager(t,i),u<0)return;f.model.nameManager.splice(u,1);this._removeNamedRange(r,t,i)}}},_removeNamedRange:function(n,t,i){var u,f,r=this.XLObj,e,o;if(n&&(r.model.nameManager=n.model.dataSource.slice(0)),f=r.model.nameManager,i.toUpperCase()===r._getLocStr("Workbook").toUpperCase()?delete this._scopeBookCln[t]:(e=r.getSheet(r._getSheetIndexByName(i))._scopeRanges,o=t,t=e[t].name,delete e[o]),r._calcEngine.removeNamedRange(t),r._updateFormulaCollection(),u=f.length,u)while(u--)r._formulaCollection.push({text:"="+f[u].name,display:f[u].name});this._updateUseInFormulaTrgt()},_updateScopeRange:function(){var n,i=this.XLObj,t=i.model.nameManager,f=t.length,r=i.getActiveSheetIndex(),u=i.getSheet(r);for(i._updateFormulaCollection(),n=0;n<f;n++)(t[n].scope.toUpperCase()===i._getLocStr("Workbook").toUpperCase()||i._getSheetIndexByName(t[n].scope)===r)&&(u._scopeRanges[t[n].name]&&u._scopeRanges[t[n].name].isSameName&&t[n].scope.toUpperCase()!==i._getLocStr("Workbook").toUpperCase()?i._formulaCollection.push({text:"="+t[n].name+" (worksheet)",display:t[n].name+"(worksheet)"}):i._formulaCollection.push({text:"="+t[n].name,display:t[n].name}))},_validateNamedRange:function(n,t,i){var e,o,s,u,r=this.XLObj,h="NMRangeAlert",c="NMNameAlert",l="NMUniqueNameAlert",f;if(e=this._validateDollarRange(t),n&&n.length>0&&(o=/^([a-zA-Z_0-9.]){0,255}$/.test(n)&&this._validateLibraryFunctions(n)),s=this._validateNameManager(n,i),r._isUndoRedo||e&&o&&s<0||r.XLFormat._isTableNameAdded)return!0;e?o?(u=r._getLocStr(l),f=l):(u=r._getLocStr(c).split("/")[0],f=c):(u=r._getLocStr(h),f=h);r._showAlertDlg("Alert","T-"+u,f,370)},_validateLibraryFunctions:function(n){var i,r=[],u=this.XLObj.getCalcEngine().getLibraryFunctions();n=t.isNullOrUndefined(n)?"":n.toString().toUpperCase();for(i in u.items)r.push(i);for(i=r.length;i--;)if(r[i]===n)return!1;return!0},_validateNameManager:function(n,i){var r=0,u=this.XLObj.model.nameManager,f=u.length;for(n=t.isNullOrUndefined(n)?"":n.toString().toUpperCase(),i=i?i:"Workbook";r<f;){if(u[r].scope.toUpperCase()===i.toUpperCase()&&u[r].name.toUpperCase()===n)return r;r++}return-1},_validateDollarRange:function(n){try{if(n&&n.indexOf("!")>-1)return n=n.split("!")[1].replace(/\$/g,""),this.XLObj.getRangeIndices(n),!0}catch(t){return!1}},_renderFormatAsTable:function(){for(var r,f,e,i=this.XLObj,t=0,c=[11,19],o=0,u="",s="",h=i._getLocStr("FATHeaderText").split("/"),l=i._getLocStr("FormatAsTableTitle").split("/"),a=["Light1","Light2","Light3","Light5","Light8","Light9","Light10","Light12","Light15","Light16","Light17","Light19","Medium8","Medium9","Medium10","Medium12","Medium22","Medium23","Medium24","Medium26","Dark1","Dark2","Dark3","Dark5"];t<24;)u=u+i._renderDIV("e-formatastablecell",'<div class="e-ss-cellstyles-'+(t+1)+'" ><\/div>'),t===c[o]&&(u+="<\/br>",o++),t++;for(t=0,u=u.split("<\/br>");t<h.length*2;)s+=i._renderDIV(t%2==0?"e-formatastableheader":"e-formatastablecontent",t%2==0?h[t/2]:u[0]),t%2!=0&&u.shift(),t++;for(r=document.getElementById(i._id+"_formatastable"),r.innerHTML=s,r=n(r),f=r.find(".e-formatastablecell"),t=0,e=f.length;t<e;)n(f[t]).attr("id","Table Style "+a[t]),n(f[t]).attr("title",i._getLocStr("FATTitlePrefix")+l[t]),t++;return i.XLFormat&&(i.XLFormat._formatAsTableStyle=i._FATStyles.TableStyleLight1),r.find(".e-formatastableheader:eq(0)").append("<span id ='"+i._id+"_formatastable_back' class = 'e-formatastable-back e-icon e-ss-leftarrow'/>"),r.data("ejMenu").model.open=function(){r.scrollTop(0)},r},_renderFATNameDlg:function(){var r,i=this.XLObj,u=i._getLocStr("FATNameDlgText").split("/"),f={showRoundedCorner:!0,width:"27%",click:n.proxy(this._fatNameDlgBtnClick,this)};r="<div id="+i._id+'_fatnamedlg><div class="e-dlg-fields e-dlgctndiv e-ss-nmdlg"><table cellspacing="0" cellpadding="0"><tr><td>'+u[0]+'<\/td><td><input id="'+i._id+'_fatname" class="ejinputtext" /><\/td><\/tr><tr class="e-dlgtd-fields"><td><\/td><td><input type="checkbox" id="'+i._id+'_fatheader" style="background-color:#ffffff"/> <label for="'+i._id+'_fatheader" class="e-ss-fathdr">'+u[1]+'<\/label><\/td><\/tr><\/table><\/div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+i._id+"_fatnamedlgok>"+i._getLocStr("Ok")+"<\/button><button id="+i._id+"_fatnamedlgcancel>"+i._getLocStr("Cancel")+"<\/button><\/div><\/div><\/div>";i.element.append(r);n("#"+i._id+"_fatheader").ejCheckBox();n("#"+i._id+"_fatnamedlgok").ejButton(f);n("#"+i._id+"_fatnamedlgok").ejButton("option","cssClass","e-ss-okbtn");n("#"+i._id+"_fatnamedlgcancel").ejButton(f);n("#"+i._id+"_fatnamedlg").ejDialog({showOnInit:!1,width:"auto",showRoundedCorner:!0,title:i._getLocStr("FormatAsTable"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_renderChartNameDlg:function(){var r,i=this.XLObj,f=i._getLocStr("ChartTitleDlgText"),u={showRoundedCorner:!0,width:"23%",click:n.proxy(this._chartNameDlgBtnClick,this)};r="<div id="+i._id+'_chartnamedlg ><div class="e-dlg-fields e-dlgctndiv"><table cellpadding="0" cellspacing="0"><tr><td>'+f+'<\/td><td><input id="'+i._id+'_chartname" class="ejinputtext" /><\/td><\/tr><\/table><\/div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+i._id+"_chartnamedlgok >"+i._getLocStr("Ok")+"<\/button><button id="+i._id+"_chartnamedlgcancel>"+i._getLocStr("Cancel")+"<\/button><\/div><\/div>";i.element.append(r);n("#"+i._id+"_chartnamedlgok").ejButton(u);n("#"+i._id+"_chartnamedlgok").ejButton("option","cssClass","e-ss-okbtn");n("#"+i._id+"_chartnamedlgcancel").ejButton(u);n("#"+i._id+"_chartnamedlg").ejDialog({showOnInit:!1,width:"334px",minHeight:"auto",showRoundedCorner:!0,title:i._getLocStr("ChartTitle"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_renderFATResizeTableDlg:function(){var i=this.XLObj,r={showRoundedCorner:!0,width:"15%",click:n.proxy(this._fatResizeTableBtnClick,this)},u="<div id="+i._id+'_fatresizetabledlg ><div class="e-dlgctndiv"><table><tr><td>'+i._getLocStr("FATResizeTableText")+'<\/td><td style="width: 50%;"><input id="'+i._id+'_fatresizetablerange" class="ejinputtext" style="margin-left: 2px;"><\/td><\/tr><\/table><div class="e-dlg-fields">'+i._getLocStr("FATReizeTableNote")+'<\/div><\/div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+i._id+"_fatresizetabledlgok >"+i._getLocStr("Ok")+"<\/button><button id="+i._id+"_fatresizetabledlgcancel >"+i._getLocStr("Cancel")+"<\/button><\/div><\/div><\/div>";i.element.append(u);n("#"+i._id+"_fatresizetabledlgok").ejButton(r);n("#"+i._id+"_fatresizetabledlgok").ejButton("option","cssClass","e-ss-okbtn");n("#"+i._id+"_fatresizetabledlgcancel").ejButton(r);n("#"+i._id+"_fatresizetabledlg").ejDialog({showOnInit:!1,width:"494px",showRoundedCorner:!0,title:i._getLocStr("ResizeTable"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_fatResizeTableBtnClick:function(t){var i=this.XLObj,o=document.getElementById(i._id+"_fatresizetablerange").value,e=i.getActiveSheetIndex(),u=document.getElementById(i._id+"_tableid").value,f=i.getSheet(e).tableManager,r={sheetIndex:e,reqType:"format-table",action:"Design_Tools_ResizeTable",tableId:u},s=!0;t.model.text===i._getLocStr("Ok")&&(i._isvalidRange(o)?(r=this._resizeTable(o,u,e,r),r.afterRange=i.getRangeIndices(o),r.format=f[u].format,r.formatName=f[u].formatName,r.header=n.extend(!0,{},i.model.sheets[e]._header),r.isFilter=f[u].isFilter,r.firstColumn=f[u].firstColumn,r.lastColumn=f[u].lastColumn,r.totalRow=f[u].totalRow,i.XLSelection.selectRange(f[u].range),i._completeAction(r),i._trigActionComplete(r)):(s=!1,i._showAlertDlg("Alert","InvalidReference","",375)));s&&n("#"+i._id+"_fatresizetabledlg").ejDialog("close")},_resizeTable:function(t,i,r,u){var f=this.XLObj,e=f.getSheet(r).tableManager,s,o,h;return u=u||{sheetIndex:r,reqType:"format-table",action:"Design_Tools_ResizeTable",tableId:i},t=t.indexOf(":")!=-1?f.getRangeIndices(t):f._getRangeArgs(t,"object"),s=this._validateResizeRange(t,e[i].range),s?f._showAlertDlg("Alert",s,"",500):(u.beforeRange=n.extend(!0,[],e[i].range),e[i].totalRow?(h=n("#"+f._id+"_Ribbon_Design_TableStyleOptions_TotalRow").data("ejCheckBox"),f._dupDetails=!0,h.option("checked",!1),e[i].range=[t[0],t[1],t[2]-1,t[3]]):e[i].range=t,this._isFilterSelect.isFiltered&&f.XLFilter._clearFilterTable(r,parseInt(i),!0),f.XLFormat._isFAT=!0,f.XLFormat._createTable(i,{format:e[i].format}),f.XLFormat._isFAT=!1,f.XLFilter._extendFilterRange(i,e[i].range),f.XLFormat._updateTableFormula("updateRange",e[i],r),e[i].range[2]==t[2]-1&&(f._dupDetails=!0,h.option("checked",!0)),e[i].firstColumn&&(f._dupDetails=!0,o=f._getProperAlphaRange(r,e[i].range[0]+1,e[i].range[1],e[i].range[2],e[i].range[1]),f.XLFormat.format({style:{"font-weight":"bold"}},o),f._dupDetails=!1),e[i].lastColumn&&(f._dupDetails=!0,o=f._getProperAlphaRange(r,e[i].range[0]+1,e[i].range[3],e[i].range[2],e[i].range[3]),f.XLFormat.format({style:{"font-weight":"bold"}},o),f._dupDetails=!1)),f.XLSelection.selectRange(e[i].range),u},_firstLastColumn:function(n,i){var f=this.XLObj,s=f.getSheet(i),e="",o,r=s.tableManager,u;o=f._dataContainer.sheets[i][r[n].range[0]][r[n].range[1]];n in r&&(u=r[n].range,u=this._isFirstColumn?f._getProperAlphaRange(i,u[0]+1,u[1],u[2],u[1]):f._getProperAlphaRange(i,u[0]+1,u[3],u[2],u[3]),this._isFirstColumn?(e="firstColumn",t.isNullOrUndefined(r[n].firstColumn)?r[n][e]=!0:delete r[n].firstColumn,o.firstColumn=t.isNullOrUndefined(o.firstColumn)?!0:!1):(e="lastColumn",t.isNullOrUndefined(r[n].lastColumn)?r[n][e]=!0:delete r[n].lastColumn,o.lastColumn=t.isNullOrUndefined(o.lastColumn)?!0:!1),f._dupDetails=!0,f.XLFormat.format({style:{"font-weight":r[n][e]?"bold":"normal"}},u),f._dupDetails=!1)},_totalRow:function(n,i){var r=this.XLObj,u=r.getSheet(i),f=u.tableManager;t.isNullOrUndefined(f[n].totalRow)?r.XLFormat._calculateTotalRow(i,n,!0,!0):r.XLFormat._calculateTotalRow(i,n,!1,!1)},_fatNameDlgBtnClick:function(t){var r,i=this.XLObj,u=i._id,f,e,o;n("#"+u+"_fatnamedlg").ejDialog("close");t.model.text===i._getLocStr("Ok")&&(f=i._getSelectedCells().selCells[0].rowIndex,e=i._getSelectedCells().selCells[0].colIndex,o=i.XLEdit.getPropertyValue(f,e,"hasFormulaArray",i.getActiveSheetIndex()),o?i._showAlertDlg("Alert","ArrayaFormulaTableAlert",430):(r={header:n("#"+u+"_fatheader").ejCheckBox("checked"),name:document.getElementById(u+"_fatname").value,format:i.XLFormat._formatAsTableStyle.format},i.XLFormat._formatAsTableStyle.formatName&&(r.formatName=i.XLFormat._formatAsTableStyle.formatName),i.XLFormat.createTable(r)))},_validateResizeRange:function(n,t){var i=this.XLObj;if(n.length){if(n[0]!=t[0]||n[1]!=t[1])return"ResizeAlert";if(n[3]!=t[3]||n[2]<t[2])return"ResizeRestrictAlert";if(n[2]>i.getSheet(i.getActiveSheetIndex()).rowCount)return"RangeNotCreated"}else return"InvalidReference"},_chartNameDlgBtnClick:function(t,i,r){var o,f,u=this.XLObj,c=u.getActiveSheetIndex(),h=u.getSheet(c).shapeMngr.chart[u.XLEdit.getPropertyValue(u.XLShape._picCellIdx.rowIndex,u.XLShape._picCellIdx.colIndex,"chart")[0]],e,s=u._id,l=document.getElementById(s+"_chart").value;if(o=n("#"+l).data("ejChart"),f={sheetIndex:c,reqType:"shape",shapeType:"chart",cid:l,rowIndex:u.XLShape._picCellIdx.rowIndex,colIndex:u.XLShape._picCellIdx.colIndex,prev:{},cur:{}},e=i||document.getElementById(s+"_chartname").value,t.model.text===u._getLocStr("Ok")){if(!e.length){u._showAlertDlg("Alert","InvalidTitle","InvalidChartTitleActn",375);return}switch(u._hasTitle){case"PX":o.option("primaryXAxis",{title:{text:e}});h.xAxis.title.text=e;f.action="PX";f.operation=r?r:"PHAxisTitle";break;case"PY":o.option("primaryYAxis",{title:{text:e}});h.yAxis.title.text=e;f.action="PY";f.operation=r?r:"PVAxisTitle";break;case"CT":o.option("title",{text:e});h.title.text=e;f.action=f.operation="CT"}}f.prev.text=u._cOpt.prevText;u._hasTitle=="CT"&&(f.prev.align=u._cOpt.prevAlign,f.cur.align=u._cOpt.curAlign);f.cur.text=e;u._completeAction(f);u._trigActionComplete(f);u._cOpt={};document.getElementById(s+"_chartname").value="";n("#"+s+"_chartnamedlg").ejDialog("close")},_designTabUpdate:function(t,i){var r=this.XLObj;if(r.model.showRibbon){var u=r._id,e,o=n("#"+r._id+"_Ribbon").ejRibbon("instance"),f=r.getSheet(r.getActiveSheetIndex()).tableManager;o.showTab(r._getLocStr("Design"));this._isDesignTab&&!o._isCollapsed&&o.option({selectedItemIndex:this._getTabIndex("design")});document.getElementById(r._id+"_Ribbon_Design_Properties_TableName")&&(document.getElementById(r._id+"_Ribbon_Design_Properties_TableName").value=f[t].name);document.getElementById(r._id+"_tableid")&&(document.getElementById(r._id+"_tableid").value=t);this._isSetModel=!0;n("#"+u+"_Ribbon_Design_TableStyleOptions_TotalRow").data("ejCheckBox").option({checked:f[t].totalRow?!0:!1});n("#"+u+"_Ribbon_Design_TableStyleOptions_FirstColumn").data("ejCheckBox").option({checked:f[t].firstColumn?!0:!1});n("#"+u+"_Ribbon_Design_TableStyleOptions_LastColumn").data("ejCheckBox").option({checked:f[t].lastColumn?!0:!1});n("#"+u+"_Ribbon_Design_TableStyleOptions_FilterColumn").data("ejCheckBox").option({enabled:r.model.allowFiltering?!0:!1});n("#"+u+"_Ribbon_Design_TableStyleOptions_FilterColumn").data("ejCheckBox").option({checked:f[t].isFilter?!0:!1});this._isSetModel=!1;e=n("#"+r._id+"_Ribbon_Data_SortFilter_ClearFilter").data("ejButton");e&&this._changeClrFltrStatus(e,"button",i)}},_formatTabUpdate:function(){var t=this.XLObj;if(t.model.showRibbon){var i=n("#"+t._id+"_Ribbon").ejRibbon("instance"),r=t.element.find("#"+t._id+"_Ribbon_Format_Size_PictureHeight"),u=t.element.find("#"+t._id+"_Ribbon_Format_Size_PictureWidth");i.showTab(t._getLocStr("FORMAT"));t._shapeChange=!0;r.length&&r.ejNumericTextbox("option","value",t.element.find(".e-ss-activeimg").height());u&&u.ejNumericTextbox("option","value",t.element.find(".e-ss-activeimg").width());t.model.showRibbon&&!i._isCollapsed&&i.option({selectedItemIndex:t.XLRibbon._getTabIndex("format")});t._shapeChange=!1}},_analyzeTabUpdate:function(){var t=this.XLObj,r,i;if(!t.model.enablePivotTable)return!1;r=t.element.find("#"+t._id+"_Ribbon_Analyze_PivotTable_PivotTableName");i=n("#"+t._id+"_Ribbon").data("ejRibbon");r.length&&r.val(t.XLPivot.names[t._getContent(t.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id]);t.model.showRibbon&&(i.showTab(t._getLocStr("ANALYZE")),i._isCollapsed||i.option({selectedItemIndex:t.XLRibbon._getTabIndex("analyze")}))},_chartDesignTabUpdate:function(t){var i=this.XLObj,e,u,f;if(i.model.showRibbon){var r=n("#"+i._id+"_Ribbon").data("ejRibbon"),o=t.get(0).id,c=t.get(0).offsetLeft,l=t.get(0).offsetTop,s=t.ejChart("model"),h=r.element.find("#"+i._id+"_Ribbon_ChartDesign_ChartThemes_ChartThemes");u=i._getIdxWithOffset(l,c,!0);i.XLShape._picCellIdx={rowIndex:u.rowIdx,colIndex:u.colIdx};r.showTab(i._getLocStr("CHARTDESIGN"));e=i.XLChart._getShapeObj(o,"chart");f=e.isChartSeries?"disable":"enable";n("#"+i._id+"_Ribbon_ChartDesign_Data_SelectData").ejButton(f);n("#"+i._id+"_Ribbon_ChartDesign_Data_SwitchRowColumn").ejButton(f);r._isCollapsed||r.option({selectedItemIndex:i.XLRibbon._getTabIndex("chartdesign")});document.getElementById(i._id+"_chart").value=o;this._isSetModel=!0;this._setShapeWidthHeight({height:s.size.height,width:s.size.width,shapeType:"chart"});h.length&&h.ejDropDownList("setSelectedValue",t.ejChart("option","theme"));this._isSetModel=!1;i.model.allowFormulaBar&&i.updateFormulaBar()}},_setShapeWidthHeight:function(t){var i=this.XLObj,r,u;t.shapeType=="chart"?(r=n("#"+i._id+"_Ribbon_ChartDesign_Size_ChartWidth").data("ejNumericTextbox"),u=n("#"+i._id+"_Ribbon_ChartDesign_Size_ChartHeight").data("ejNumericTextbox")):(r=n("#"+i._id+"_Ribbon_Format_Size_PictureWidth").data("ejNumericTextbox"),u=n("#"+i._id+"_Ribbon_Format_Size_PictureHeight").data("ejNumericTextbox"));i._shapeChange=!0;i.model.showRibbon&&(u.option({value:t.height}),r.option({value:t.width}));i._shapeChange=!1},changeDimension:function(t){var u=this.XLObj,h=u.getActiveSheetIndex(),o,c,e,s,f,i={sheetIndex:h,reqType:"shape",rowIndex:u.XLShape._picCellIdx.rowIndex,colIndex:u.XLShape._picCellIdx.colIndex,actionType:"shapechange"},r;t.shapeType=="picture"?(o=u.getSheetElement(h).find(".e-ss-activeimg"),f=o.length?o[0]:n("#"+t.id),i.prev={width:f.width(),height:f.height()},c=n("#"+t.id),e={width:t.width,height:t.height},c.css(e),i.action="picturesize",i.shapeType="picture",i.cur={width:f.width(),height:f.height()}):(r=n("#"+t.id).data("ejChart"),i.prev={width:r.model.size.width,height:r.model.size.height},e={width:t.width.toString(),height:t.height.toString()},s=r.element,r.option("size",e),s[0].style.height=t.height+"px",s[0].style.width=t.width+"px",i.action="width",i.shapeType="chart",i.cid=t.id,i.cur={width:r.model.size.width,height:r.model.size.height});u._completeAction(i);u._trigActionComplete(i);this._setShapeWidthHeight(t)},_toggleDesignTab:function(i){var r=this.XLObj,f,u,e=r.getActiveSheetIndex();r.model.showRibbon&&(u=n("#"+r._id+"_Ribbon").data("ejRibbon"),(t.isNullOrUndefined(r.XLEdit.getPropertyValue(i.rowIndex,i.colIndex,"tableName"))||r.getSheetElement(e).find(".e-ss-activeimg").length)&&(u.hideTab(r._getLocStr("Design")),u._isCollapsed||u.option({selectedItemIndex:1})));f=n("#"+r._id+"_Ribbon_Data_SortFilter_ClearFilter").data("ejButton");this._changeClrFltrStatus(f,"button",i)},_toggleChartDesignTab:function(){this._toggleContextualTab(this.XLObj._getLocStr("CHARTDESIGN"))},_toggleFormatTab:function(){this._toggleContextualTab(this.XLObj._getLocStr("FORMAT"))},_toggleAnalyzeTab:function(){this._toggleContextualTab(this.XLObj._getLocStr("ANALYZE"))},_toggleContextualTab:function(t){var r=this.XLObj,i;r.model.showRibbon&&(i=n("#"+r._id+"_Ribbon").data("ejRibbon"),i.hideTab(t),i._isCollapsed||i.option({selectedItemIndex:1}))},_getTabIndex:function(t){if(this.XLObj.model.showRibbon){for(var u=n("#"+this.XLObj._id+"_Ribbon").ejRibbon("model"),r=u.tabs,f=u.contextualTabs,i=0;i<f.length;)r=r.concat(f[i].tabs),i++;for(i=r.length;i--;)if(r[i].id===t)return++i}},_getFormatAsTableInput:function(n){var h=this.XLObj,t,r,e,i,o=0,u=0,c=[],s={hl:"headerLayout",cl:"contentLayout",hb:"headerBorder",cb:"contentBorder"},f={};for(n=n.split("&");o<n.length;){if(e=n[o].split("?"),t=e[0],r=e[1],t==="hl")f[s[t]]=h._getStyleAsJSON(r,!0);else if(t==="cl"){for(i=r.split(",");u<i.length;)c.push(i[u].length?h._getStyleAsJSON(i[u],!0):{}),u++;f[s[t]]=c}else t==="cb"&&(i=r.split("-"),f[s[t]]={border:this._getBorderObj(i[0],i[1])});o++}return f},_getBorderObj:function(n,t){var r,i={t:{top:""},r:{right:""},b:{bottom:""},l:{left:""},o:{top:"",right:"",bottom:"",left:""},tb:{top:"",bottom:""},gb:{top:"",right:"",bottom:"",left:""}};for(r in i[n])i[n][r]=t;return n==="gb"&&(i[n].isGridBorder=!0),i[n]},_renderCellStyles:function(){for(var h,f,a=1,v=1,i=0,o=4,s=[],c="e-cellstylecell ",r="",u=this.XLObj,e=u._dataContainer.hashCode,y=u._getLocStr("CellStyleHeaderText").split("/"),w=u._getLocStr("CellStyleGBN").split("/"),b=[e[0],e[1],e[2],e[3]],k=u._getLocStr("CellStyleTH").split("/"),p=e.slice(4,6),d=e.slice(6,18),l;i<o;)f=w[i],r=r+u._renderDIV(c+b[i],f,f),i++;for(s.push(r),r="",i=0,o=2;i<o;)f=k[i],r=i===1?r+'<div class="'+c+p[i]+'"  style="font-size: 11pt;" title="'+f+'">'+f+"<\/div>":r+u._renderDIV(c+p[i],f,f),i++;for(s.push(r),r="",i=0,o=12;i<o;)i>=0&&i<4?f="20% - "+u._getLocStr("Accent")+(i+1):i>=4&&i<8?(f="60% - "+u._getLocStr("Accent")+a,a++):(f=u._getLocStr("Accent")+v,v++),r=r+u._renderDIV(c+d[i],f,f),i++;for(s.push(r),r="",i=0;i<y.length*2;)h=i%2,r=r+u._renderDIV(h===0?"e-cellstyleheader":"e-cellstylecontent",h===0?y[i/2]:s[0]),h!=0&&s.shift(),i++;return l=n("<div id="+u._id+'_cellstyles class="e-spreadsheet e-cellstyles" style="display:none;">'+r+"<\/div>"),l.find(".e-cellstyleheader:eq(0)").append("<span id ='"+u._id+"_cellstyles_back' class = 'e-cellstyles-back e-icon e-ss-leftarrow'/>"),l.append(t.buildTag("div.e-cellstyleheader"),t.buildTag("div.e-cellstylecell e-format6N6N2N111N1N1N1N1N",u._getLocStr("NewCellStyle"),"",{title:u._getLocStr("NewCellStyle")})),l},_homeTabTrgtElem:function(){var r=this.XLObj,u=r._id,n=r.element,i=u+"_Ribbon_",f=i+"Home_Font_";n.append(t.buildTag("input","",{display:"none"},{id:f+"FillColor",type:"text"}));n.append(t.buildTag("input","",{display:"none"},{id:f+"FontColor",type:"text"}));n.append(t.buildTag("input","",{display:"none"},{id:f+"BorderColor",type:"text"}));n.append(t.buildTag("div.e-spreadsheet e-formatastable","",{display:"none"},{id:r._id+"_formatastable"}));n.append(this._renderCellStyles());n.append(t.buildTag("ul","",{display:"none"},{id:u+"_Ribbon_Merge"}));n.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:i+"Paste"}));n.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:i+"Border"}));n.append(t.buildTag("ul.e-spreadsheet","",{display:"none"},{id:u+"_CFormat"}));n.append(t.buildTag("ul","",{display:"none"},{id:i+"Clear"}));n.append(t.buildTag("ul","",{display:"none"},{id:i+"SortFilter"}));n.append(t.buildTag("ul","",{display:"none"},{id:i+"AutoSum"}))},_pageTabTrgtElem:function(i){var f=this.XLObj,p=f._id,g=f.element,e,o,s,h,c,l,a,v,y,w,b,k,d,r=p+"_Ribbon_",u=r+"PageLayout_Show_";i=f.isUndefined(i)?n("#"+p+"_Ribbon").data("ejRibbon").element:i;g.append(t.buildTag("ul","",{display:"none"},{id:r+"PageSize"}));e=t.buildTag("div","",{width:"140",height:"80",display:"none"},{id:r+"pagesetup"});o=t.buildTag("div","",{width:"70",height:"80",float:"left"},{id:r+"pagesetupleft"});s=t.buildTag("table");a=t.buildTag("tr");v=t.buildTag("tr");h=t.buildTag("td","",{padding:"6px 0px 6px 6px"});c=t.buildTag("td","",{padding:"6px 0px 6px 6px"});l=t.buildTag("td","",{padding:"6px 0px 6px 6px"});y=t.buildTag("td","",{padding:"6px 0px 6px 6px"});w=t.buildTag("label.e-viewlinlbl","",{width:"40"},{id:r+"pagesetup_viewgrdlnlbl","for":u+"Gridlines"});b=t.buildTag("label.e-viewhdrlbl","",{width:"40",display:"visible"},{id:r+"pagesetup_viewhdrlbl","for":u+"Headings"});k=t.buildTag("input","","",{id:u+"Headings",type:"checkbox"});d=t.buildTag("input","","",{id:u+"Gridlines",type:"checkbox"});h.append(d);c.append(w);a.append(h).append(c);l.append(k);y.append(b);v.append(l).append(y);s.append(v).append(a);o.append(s);e.append(o);i.append(e)},_othersTabTrgtElem:function(){var r=this.XLObj,u=r._id,n=r.element,i=u+"_Ribbon_";n.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:i+"FPane"}));n.append(t.buildTag("ul","",{width:"auto"},{id:i+"Ins"}));n.append(t.buildTag("ul","",{width:"auto"},{id:i+"Del"}));n.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:i+"FindRep"}));n.append(t.buildTag("ul","",{display:"none"},{id:i+"CalcOpt"}))},_dataTabTrgtElem:function(){var n=this.XLObj;n.element.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:n._id+"_Ribbon_Validation"}))},_formatTabTrgtElem:function(){var n=this.XLObj;n.element.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:n._id+"_Ribbon_ResetPic"}))},_onBeforeTabClick:function(n){this.XLObj.model.ribbonSettings.enableOnDemand&&this._createTrgtElement(n.activeHeader.innerText)},_onTabClick:function(n){var t=this.XLObj,i=n.activeHeader.innerText;t._trigger("beforeTabClick",n);n.prevActiveIndex!==-1&&t.model.allowComments&&t.model.allowEditing&&(t.XLEdit._isEdit||t.XLComment._isCommentEdit||t._isSheetRename||!t.getSheet(t.getActiveSheetIndex()).isSheetProtected)&&!this._isDirtySelect&&this._enableRibbonIcons(n.activeIndex);t.model.ribbonSettings.enableOnDemand&&this._createTabControls(i);t._trigger("tabClick",n)},_onCollapse:function(t){var i=this.XLObj,u=n.extend(!0,{},i.model.scrollSettings),r;i.getSheet(i.getActiveSheetIndex())._isRibCollapsed=!0;(this._ribbonState||t.isMobile)&&(i._phoneMode||(this._ribbonState=!1),t.action="toggleBtn",i._isAutoWHMode?(this._refreshBackstageHeight(),r=i._getElementDimension(),i.element.css({height:r.height,width:r.width})):i._heightWidthCalculation(i.getActiveSheetIndex(),u,t),i.model._isActPanelVisible&&i._refreshActivationPanel())},_onTabSelect:function(t){var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()),f,u;i.model.showRibbon&&(i.XLEdit._isEdit||i.model.allowComments&&i.XLComment._isCommentEdit||i._isSheetRename||r.isSheetProtected?this._disableRibbonIcons():this._enableRibbonIcons(),this._updateRibbonIcons(),i.model.isReadOnly&&i._readOnly(),i._phoneMode&&(f=n.extend(!0,{},i.model.scrollSettings),this._ribbonState=!0,t.action="toggleBtn",i.model._isActPanelVisible=this._isPanelVisible,i._isAutoWHMode?(this._refreshBackstageHeight(),u=i._getElementDimension(),i.element.css({height:u.height,width:u.width})):i._heightWidthCalculation(i.getActiveSheetIndex(),f,t)));i.XLEdit.getPropertyValue(r._activeCell.rowIndex,r._activeCell.colIndex,"tableName")&&(this._isDesignTab=t.activeIndex==this._getTabIndex("design")||t.activeIndex==this._getTabIndex("format")||t.activeIndex==this._getTabIndex("chartdesign"));i._trigger("tabSelect",t)},_valDTypeOnChange:function(t){var i=this.XLObj;n.validator&&n("#"+i._id+"_Form_ValDialog").validate().resetForm();t.value==="Between"||t.value==="NotBetween"?(n("#"+i._id+"_Ribbon_lbMax").show(),n("#"+i._id+"_Ribbon_btnMax").show(),n("#"+i._id+"_Ribbon_lbMin").text(i._getLocStr("NumberStart"))):(n("#"+i._id+"_Ribbon_lbMax").hide(),n("#"+i._id+"_Ribbon_btnMax").hide(),n("#"+i._id+"_Ribbon_lbMin").text(i._getLocStr("DataValue")));this._dialogValidate("_ValDialog")},_valTypeOnChange:function(t){var i=this.XLObj,r=n("#"+i._id+"_Ribbon_ddAction").data("ejDropDownList");r.enable();t.model.dataSource[t.model.selectedItemIndex].value==="list"?(n("#"+i._id+"_Ribbon_lbMax").hide(),n("#"+i._id+"_Ribbon_btnMax").hide(),r.disable()):(r._selectedValue==="Between"||r._selectedValue==="NotBetween")&&(n("#"+i._id+"_Ribbon_lbMax").show(),n("#"+i._id+"_Ribbon_btnMax").show());n("#"+i._id+"_Ribbon_lbMin").text(i._getLocStr(t.selectedText+"Start"));n("#"+i._id+"_Ribbon_lbMax").text(i._getLocStr(t.selectedText+"End"));this._dialogValidate("_ValDialog")},_valDlgBtnClick:function(t){var i=this.XLObj,f,e,r,a,h,u,v;if(t==="ok"&&n.validator&&n("#"+i._id+"_Form_ValDialog").valid()){var c=n("#"+i._id+"_Ribbon_blank").data("ejCheckBox"),l=n("#"+i._id+"_Ribbon_freetext").data("ejCheckBox").isChecked(),o=n("#"+i._id+"_Ribbon_ddType").data("ejDropDownList"),y=n("#"+i._id+"_Ribbon_ddAction").data("ejDropDownList"),p=i.getCalcEngine().getNamedRanges(),s;if(o._selectedValue==="List")if(r=n("#"+i._id+"_Ribbon_btnMin").val(),a=r,f=n("#"+i._id+"_alertdlg"),r.indexOf("=")>-1){if(r=r.split("=")[1],s=p.getItem(r.toUpperCase()),s&&(r=s),r.indexOf("!")>-1&&(h=r.split("!"),e=s?i._getSheetIdxFromSheetValue(h[0]):i._getSheetIndexByName(h[0]),r=h[1]),e===!1){i._renderAlertDlgContent(f,"Alert",i._getLocStr("ListAlert"),"ListValidation");i._alertDialog.element.ejDialog("open")&&f.focus();return}if(r.indexOf("$")>-1&&(r=r.split("$").join("")),r.indexOf(":")<0&&(r=r+":"+r),e=i.isUndefined(e)?i.getActiveSheetIndex():e,v=i.getSheet(e),u=i.getRangeIndices(r),isNaN(u[0])||isNaN(u[1])||isNaN(u[2])||isNaN(u[3])||v.colCount<=u[3]||v.rowCount<=u[2]){i._renderAlertDlgContent(f,"Alert",i._getLocStr("ListAlert"),"ListValidation");i._alertDialog.element.ejDialog("open")&&f.focus();return}if(u[2]===u[0]||u[3]===u[1])i.XLValidate.applyDVRules(null,["list",a],this._types[o.selectedIndexValue].value,c.isChecked(),l);else{i._renderAlertDlgContent(f,"Alert",i._getLocStr("ListValAlert"),"ListValidation");i._alertDialog.element.ejDialog("open")&&f.focus();return}}else i.XLValidate.applyDVRules(null,["list",a],this._types[o.selectedIndexValue].value,c.isChecked(),l);else i.XLValidate.applyDVRules(null,[this._actions[y.selectedIndexValue].value,n("#"+i._id+"_Ribbon_btnMin").val(),n("#"+i._id+"_Ribbon_btnMax").val()],this._types[o.selectedIndexValue].value,c.isChecked(),l);i._setddlCell()}else n.validator||(t="cancel");(t==="cancel"||t==="ok"&&n.validator&&n("#"+i._id+"_Form_ValDialog").valid())&&(n("#"+i._id+"_Ribbon_ddType").data("ejDropDownList").option({selectedItemIndex:0}),n("#"+i._id+"_Ribbon_ddAction").data("ejDropDownList").option({selectedItemIndex:6}),n("#"+i._id+"_Ribbon_blank").data("ejCheckBox").option({checked:!0}),n("#"+i._id+"_Ribbon_freetext").data("ejCheckBox").option({checked:!0}),n("#"+i._id+"_Ribbon_btnMin").val(""),n("#"+i._id+"_Ribbon_btnMax").val(""),n("#"+i._id+"_ValDialog").ejDialog("close"),i._setSheetFocus())},_renderValDialog:function(){var i=this.XLObj,h,e,v,o,c,a,y,p;if(n("#"+i._id+"_Ribbon_MainDiv").length<1){h=t.buildTag("div.e-dlgctndiv","",{},{height:"100%"});e=t.buildTag("div.e-dlg-fields","",{},{id:i._id+"_Ribbon_MainDiv"});n("#"+i._id+"_Validation").append(h);n("#"+i._id+"_Validation").append(e);o=t.buildTag("label.e-dlg-fields",i._getLocStr("Allow"));e.append(o);c=t.buildTag("input.e-"+i._id+"-ddl","","",{id:i._id+"_Ribbon_ddType",type:"text"});e.append(c);c.ejDropDownList({dataSource:this._types,fields:{id:"Types",text:"text",value:"text"},selectedItemIndex:1,cssClass:"e-"+i._id+"-ddl",width:"100%",change:n.proxy(this._valTypeOnChange,this)});var s=t.buildTag("input#"+i._id+"_Ribbon_blank"),l=t.buildTag("label",i._getLocStr("IgnoreBlank"),{},{"for":i._id+"_Ribbon_blank"}),f=t.buildTag("table.e-val-chk"),u=t.buildTag("tr"),r=t.buildTag("td","",{},{width:30});r.append(s);u.append(r);r=t.buildTag("td");r.append(l);u.append(r);f.append(u);s.ejCheckBox();s=t.buildTag("input#"+i._id+"_Ribbon_freetext");l=t.buildTag("label#"+i._id+"_Ribbon_lblfreetext",i._getLocStr("FreeText"),{},{"for":i._id+"_Ribbon_lblfreetext"});u=t.buildTag("tr#"+i._id+"_val_freetext");r=t.buildTag("td","",{},{width:30});r.append(s);u.append(r);r=t.buildTag("td");r.append(l);u.append(r);f.append(u);e.append(f);s.ejCheckBox({checked:!0});o=t.buildTag("label.e-dlg-fields").text(i._getLocStr("Data"));e.append(o);a=t.buildTag("input.e-"+i._id+"-ddl","","",{id:i._id+"_Ribbon_ddAction",type:"text"});e.append(a);a.ejDropDownList({dataSource:this._actions,fields:{id:"Types",text:"text",value:"value"},selectedItemIndex:6,cssClass:"e-"+i._id+"-ddl",width:"100%",change:n.proxy(this._valDTypeOnChange,this)});v=t.buildTag("div.e-dlgctndiv e-dlg-fields","",{},{id:i._id+"_Ribbon_SubDiv"});f=t.buildTag("table");u=t.buildTag("tr");r=t.buildTag("td");o=t.buildTag("label.e-dlg-fields","","",{id:i._id+"_Ribbon_lbMin"}).text(i._getLocStr("NumberStart"));f.append(u.append(r.append(o)));u=t.buildTag("tr");r=t.buildTag("td");y=t.buildTag("input.ejinputtext","",{width:"100%"},{id:i._id+"_Ribbon_btnMin",type:"text",name:i._id+"_valMin"});f.append(u.append(r.append(y)));u=t.buildTag("tr");r=t.buildTag("td");o=t.buildTag("label.e-dlg-fields","","",{id:i._id+"_Ribbon_lbMax"}).text(i._getLocStr("NumberEnd"));f.append(u.append(r.append(o)));u=t.buildTag("tr");r=t.buildTag("td");p=t.buildTag("input.ejinputtext","",{width:"100%"},{id:i._id+"_Ribbon_btnMax",type:"text",name:i._id+"_valMax"});f.append(u.append(r.append(p)));h.append(e,v.append(f));n("#"+i._id+"_Ribbon_SubDiv").wrapInner('<form id="'+i._id+'_Form_ValDialog" onsubmit="return false"><\/form>')}},_dialogValidate:function(t,i){var f=this.XLObj,e=f._id,l,nt=n("#"+e+"_Form"+t),o,r,a,v,s,y,p,u,w,b,h,c,k,d,g;if(n.validator){nt.validate({errorElement:"div",wrapper:"div",errorPlacement:function(n,t){n.insertAfter(t.closest("input"));n.children().addClass("e-dlg-field-validation-error");n.css({position:"relative"});n.offset({left:t.offset().left,top:t.offset().top+19})},onfocusout:function(n){this.element(n)}});c=n("#"+e+"_Ribbon_ddAction").ejDropDownList("getValue");switch(t){case"_ValDialog":l=n("#"+e+"_Ribbon_ddType").data("ejDropDownList");o=l.getSelectedValue();break;case"_CFDialog":o=i===e+"_CreateRule"?"formulaRule":i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();break;case"_GoToDiv":case"_Ribbon_PvtRange":case"_Ribbon_PvtLocation":case"_Ribbon_SparklineRange":case"_Ribbon_SparklineLocation":case"_datarange":case"_Ribbon_cellAddress":o="cellAddr";break;case"_xlFileName":case"_Ribbon_webAddress":o="webAddr"}for(n("#"+e+"_Form"+t).validate().resetForm(),u=[],p=n("#"+e+"_Form"+t).find("input").length,y={required:!0,date:!0,messages:{date:f._getLocStr("DateValidationMsg"),required:f._getLocStr("RequiredField")}},v={required:!0,celladdr:!0},w={required:!0,numberVal:!0},d={required:!0,number:!0,messages:{required:f._getLocStr("RequiredField"),number:f._getLocStr("NumberValidationMsg")}},b={required:!0,time:!0},s={required:!0},k={required:!0,betweentype:!0},g={required:!0,formularule:!0},n.validator.addMethod("time",function(n){return n===""||n.match(/^(([0-1]?[0-9])|([2][0-3])):([0-5]?[0-9])(:([0-5]?[0-9]))?(\s(AM|am|PM|pm))?$/)},f._getLocStr("TimeValidationMsg")),n.validator.addMethod("date",function(n,t){var i=n.split("/");return this.optional(t)||!/Invalid|NaN/.test(new Date(/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())?n:i[1]+"/"+i[0]+"/"+i[2]))},f._getLocStr("DateValidationMsg")),n.validator.addMethod("celladdr",function(t,i){var f,s=n(i).data("parentID"),r=n("#"+s).data("ejSpreadsheet"),u,e,o=!0;return n("#"+r._id+"_Ribbon_sheentName").length&&(u=n("#"+r._id+"_Ribbon_sheentName").ejTreeView("option","selectedNode")),(r.isUndefined(u)||u<0)&&(u=r.getActiveSheetIndex()),t.indexOf("=")>-1&&(t=t.split("=")[1]),t.indexOf("!")>-1&&(h=t.split("!"),u=r._getSheetIndexByName(h[0]),t=h[1]),u<1&&(o=!1),e=r.getSheet(u),t.indexOf("$")>-1&&(t=t.split("$").join("")),f=r.getRangeIndices(t),f=e.colCount<=f[3]||e.rowCount<=f[2]?null:t,(t.match(/^(?:\bxfXF[a-zA-D]|xX[a-eA-E][a-zA-Z]|[a-wA-W][a-zA-Z]{2}|[a-zA-Z]{2}|[a-zA-Z])\$?(?:104857[0-6]|10485[0-6]\d|1048[0-4]\d{2}|104[0-7]\d{3}|10[0-3]\d{4}|[1-9]\d{1,5}|[1-9]):(?:\bxfXF[a-zA-D]|xX[a-eA-E][a-zA-Z]|[a-wA-W][a-zA-Z]{2}|[a-zA-Z]{2}|[a-zA-Z])\$?(?:104857[0-6]|10485[0-6]\d|1048[0-4]\d{2}|104[0-7]\d{3}|10[0-3]\d{4}|[1-9]\d{1,5}|[1-9])$/)||t.match(/^(?:\bxfXF[a-zA-D]|xX[a-eA-E][a-zA-Z]|[a-wA-W][a-zA-Z]{2}|[a-zA-Z]{2}|[a-zA-Z])\$?(?:104857[0-6]|10485[0-6]\d|1048[0-4]\d{2}|104[0-7]\d{3}|10[0-3]\d{4}|[1-9]\d{1,5}|[1-9])$/)&&o)&&f},f._getLocStr("CellAddrsValidationMsg")),n.validator.addMethod("betweentype",function(t,i){var e=i.id.split("_")[0],f=n("#"+i.id.split("_")[0]+"_Ribbon_ddType").ejDropDownList("getSelectedValue"),r=n("#"+e+"_Ribbon_btnMin").val(),u=n("#"+i.id.split("_")[0]+"_Ribbon_btnMax").val();return(r===""||u===""||parseFloat(r)>parseFloat(u))&&(t=null),f==="Date"&&Date.parse(r)>Date.parse(u)&&(t=null),f==="Time"&&new Date("01/01/1990 "+r).getTime()>new Date("01/01/1990 "+u).getTime()&&(t=null),t},f._getLocStr("BetweenAlert")),n.validator.addMethod("numberVal",function(t){if(n.isNumeric(t))return parseFloat(t)%1!=0&&(t=null),n.validator.messages.numberVal=f._getLocStr("NumberValMsg"),t;n.validator.messages.numberVal=f._getLocStr("NumberAlertMsg")},n.validator.messages.numberVal),n.validator.addMethod("formularule",function(n){return n===""||n.startsWith("=")&&n.indexOf("!")<0},f._getLocStr("FormulaRuleMsg")),r=0,a=p;r<a;r++){u[r]=n("#"+e+"_Form"+t).find("input")[r].id;switch(o){case"Date":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",y);break;case"Time":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",b);break;case"Number":case"TextLength":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",w);break;case"Decimal":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",d);break;case"List":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",s);break;case"cellAddr":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",v);break;case"webAddr":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",s);break;case"formulaRule":n("#"+u[r]).rules("remove");n("#"+u[r]).rules("add",g)}o!=="List"&&(c==="Between"||c==="NotBetween")&&n("#"+e+"_Ribbon_btnMax").rules("add",k)}}},_renderCFDialog:function(i){var u,o,f,e,s,r=this.XLObj,h;s=n("#"+r._id+"_CFDialog").data("ejDialog");i.ID===r._id+"_CreateRule"?s.option({title:r._getLocStr("NewRule")}):s.option({title:r._getLocStr(this._cFormatData[i.ID][0])});n("#"+r._id+"_Ribbon_CFSubDiv").length<1&&(o=t.buildTag("div.e-dlg-fields","",{},{id:r._id+"_Ribbon_CFSubDiv"}),f=i.ID==="aboveaverage"||i.ID==="belowaverage"?t.buildTag("label.e-dlg-fields").text(r._getLocStr("BelowAbove")):t.buildTag("label.e-dlg-fields").text(r._getLocStr("With")),o.append(f),h=t.buildTag("input.e-"+r._id+"-ddl","",{},{id:r._id+"_Ribbon_ddStyle",type:"text"}),o.append(h),h.ejDropDownList({dataSource:this._styles,fields:{id:"Types",text:"text",value:"value"},selectedItemIndex:0,cssClass:"e-"+r._id+"-ddl",width:"100%",change:n.proxy(this._ddOnChange,this)}),n("#"+r._id+"_CondFormat").append(o),n("#"+r._id+"_CondFormat").addClass("e-cfdiv"));n("#"+r._id+"_Ribbon_CFMainDiv").length>0&&n("#"+r._id+"_Ribbon_CFMainDiv").remove();u=t.buildTag("div.e-dlg-fields","","",{id:r._id+"_Ribbon_CFMainDiv"});n("#"+r._id+"_CondFormat").prepend(u);i.ID=="between"&&(e=t.buildTag("input.ejinputtext","",{},{id:r._id+"_Ribbon_input2",type:"text"}),u.prepend(e),f=t.buildTag("label.e-dlg-fields").text(r._getLocStr("And")).css("display","table"),u.prepend(f));e=t.buildTag("input.ejinputtext","",{},{id:r._id+"_Ribbon_input1",type:"text"});u.prepend(e);(i.ID=="toptenitems"||i.ID=="toptenpercent"||i.ID=="bottomtenitems"||i.ID=="bottomtenpercent")&&e.ejNumericTextbox({name:"numeric",width:"100%",minValue:1,maxValue:1e3,value:10});f=i.ID===r._id+"_CreateRule"?t.buildTag("label.e-dlg-fields").text(r._getLocStr("NewRuleLabelContent")):t.buildTag("label.e-dlg-fields").text(r._getLocStr(this._cFormatData[i.ID][1]));u.prepend(f);(i.ID==="aboveaverage"||i.ID==="belowaverage")&&e.hide();n("#"+r._id+"_Ribbon_CFMainDiv").wrapInner('<form id="'+r._id+'_Form_CFDialog" onsubmit="return false"><\/form>');this._dialogValidate("_CFDialog",i.ID)},_dlgCFOk:function(){var t=this.XLObj,i,r;n("#"+t._id+"_Form_CFDialog").valid()&&(i=n("#"+t._id+"_Ribbon_ddStyle").data("ejDropDownList"),r=t.XLRibbon._currentCFormat===t._id+"_CreateRule"?"formularule":t.XLRibbon._currentCFormat,t.XLCFormat._cFormat(r,n("#"+t._id+"_Ribbon_input1").val(),n("#"+t._id+"_Ribbon_input2").val(),i.getSelectedValue()),n("#"+t._id+"_CFDialog").ejDialog("close"),t._setSheetFocus())},_dlgCFCancel:function(){var t=this.XLObj;n("#"+t._id+"_Form_CFDialog").validate().resetForm();n("#"+t._id+"_CFDialog").ejDialog("close");t._setSheetFocus()},_sheetData:function(){var r=this.XLObj,u=[],t=[],n,f,i=r._getSheetNames();for(t[0]={id:1,name:r._getLocStr("SheetReference"),hasChild:!0,expanded:!0},n=1,f=i.length;n<=f;n++)i[n-1].isVisible&&(u[n]=i[n-1].text,t[n]={id:n+1,pid:1,name:u[n],hasChild:!0,expanded:!0});return t},_renderHLDialog:function(){var i=this.XLObj,l,f,e,h,c,s,o,u,a,r;n("#"+i._id+"_Ribbon_WebDiv").length<1&&(l=t.buildTag("div.e-dlgctndiv","",{},{id:i._id+"_Ribbon_WebDiv"}),o=t.buildTag("table","",{},{cellpadding:0,cellspacing:0}),u=t.buildTag("tr"),r=t.buildTag("td","",{width:"32%"}),o.append(u.append(r)),f=t.buildTag("label",i._getLocStr("HyperlinkText")),r.append(f),r=t.buildTag("td"),e=t.buildTag("input.ejinputtext","",{},{id:i._id+"_Ribbon_findText",type:"text"}),u.append(r.append(e)),u=t.buildTag("tr.e-dlgtd-fields"),r=t.buildTag("td"),o.append(u.append(r)),f=t.buildTag("label",i._getLocStr("WebAddress"),"",{id:i._id+"_Ribbon_address"}),r.append(f),r=t.buildTag("td"),e=t.buildTag("input.ejinputtext","",{},{id:i._id+"_Ribbon_webAddress",type:"text"}),u.append(r.append(e)),n("#"+i._id+"_Web").append(l.append(o)),h=t.buildTag("div.e-dlgctndiv","","",{id:i._id+"_Ribbon_DocDiv"}),a=t.buildTag("div.e-dlg-fields"),o=t.buildTag("table"),u=t.buildTag("tr"),r=t.buildTag("td","",{width:"32%"}),o.append(u.append(r)),f=t.buildTag("label",i._getLocStr("HyperlinkText")),r.append(f),r=t.buildTag("td"),e=t.buildTag("input.ejinputtext","",{},{id:i._id+"_Ribbon_cellText",type:"text"}),u.append(r.append(e)),u=t.buildTag("tr.e-dlgtd-fields"),r=t.buildTag("td"),o.append(u.append(r)),f=t.buildTag("label",i._getLocStr("CellAddress")),r.append(f),r=t.buildTag("td"),e=t.buildTag("input.ejinputtext","",{},{id:i._id+"_Ribbon_cellAddress",type:"text"}),e.data("parentID",i._id),u.append(r.append(e)),s=t.buildTag("div.e-dlg-fields","","",{id:i._id+"_Ribbon_Sheet"}),h.append(a.append(o),s),f=t.buildTag("label",i._getLocStr("SheetIndex")),s.append(f),c=t.buildTag("div","","",{id:i._id+"_Ribbon_sheentName"}),s.append(c),c.ejTreeView({fields:{id:"id",parentId:"pid",text:"name",hasChild:"hasChild",dataSource:this._sheetData(),expanded:"expanded"},nodeSelect:n.proxy(this._sheetSelect,i),height:90}),n("#"+i._id+"_Doc").append(h),n("#"+i._id+"_Ribbon_cellAddress").wrap("<form id='"+i._id+"_Form_Ribbon_cellAddress' onsubmit='return false'><\/form>"),this._dialogValidate("_Ribbon_cellAddress"),n("#"+i._id+"_Ribbon_webAddress").wrap("<form id='"+i._id+"_Form_Ribbon_webAddress' onsubmit='return false'><\/form>"),this._dialogValidate("_Ribbon_webAddress"))},_sheetSelect:function(t){var i,u,f=this._getSheetNames(),r=n("#"+this._id+"_Ribbon_cellAddress"),e=n("#"+this._id+"hlDialog_OkBtn").data("ejButton"),o=n("#"+this._id+"_Ribbon_cellText");if(t.model.selectedNode>0)for(r.attr("disabled",!1),e.enable(),r.focus().setInputPos(1),i=0,u=f.length;i<u;i++)f[i].text===o.val().split("!")[0]&&o.val(t.value+"!"+r.val());else r.attr("disabled",!0),e.disable()},_dlgHLOk:function(){var t=this.XLObj;n("#"+t._id+"_Form_Ribbon_cellAddress").valid()&&n("#"+t._id+"_Form_Ribbon_webAddress").valid()&&(this.XLObj._dlgHLClick=!0,t._setLink(),this._dlgHLCancel())},_dlgHLCancel:function(){n("#"+this.XLObj._id+"_HLDialog").ejDialog("close")},_renderFRDialog:function(){var h,f,c,l,s,e,a,r=this.XLObj,o,u,i;n("#"+r._id+"_Ribbon_FindDiv").length<1&&(h=t.buildTag("div.e-dlgctndiv e-ss-finddiv","",{height:"auto"},{id:r._id+"_Ribbon_FindDiv"}),n("#"+r._id+"_Find").append(h),o=t.buildTag("table"),u=t.buildTag("tr.e-dlgtd-fields"),i=t.buildTag("td","",{width:"30%"}),o.append(u.append(i)),f=t.buildTag("label",r._getLocStr("FindLabel"),"",{id:r._id+"_Ribbon_lbFind"}),i.append(f),i=t.buildTag("td"),c=t.buildTag("input.ejinputtext","","",{id:r._id+"_Ribbon_textFind",type:"text"}),i.append(c),u.append(i),u=t.buildTag("tr.e-dlgtd-fields"),i=t.buildTag("td"),o.append(u.append(i)),f=t.buildTag("label",r._getLocStr("ReplaceLabel"),"",{id:r._id+"_Ribbon_lbReplace"}),i.append(f),i=t.buildTag("td"),l=t.buildTag("input.ejinputtext","","",{id:r._id+"_Ribbon_textReplace",type:"text"}),i.append(l),u.append(i),h.append(o),n("#"+r._id+"_Ribbon_lbReplace").hide(),n("#"+r._id+"_Ribbon_textReplace").hide(),a=t.buildTag("div.e-dlgctndiv e-ss-stgdiv","",{},{id:r._id+"_Ribbon_SettingsDiv"}),o=t.buildTag("table"),u=t.buildTag("tr"),i=t.buildTag("td","",{width:"50%"}),o.append(u.append(i)),s=t.buildTag("input#"+r._id+"_Ribbon_Case"),f=t.buildTag("label",r._getLocStr("MatchCase"),{},{"for":r._id+"_Ribbon_Case"}),i.append(s),i.append(f),s.ejCheckBox(),i=t.buildTag("td"),s=t.buildTag("input#"+r._id+"_Ribbon_AllContent"),f=t.buildTag("label",r._getLocStr("MatchAll"),{},{"for":r._id+"_Ribbon_AllContent"}),i.append(s),s.ejCheckBox(),i.append(f),u.append(i),u=t.buildTag("tr.e-dlgtd-fields"),i=t.buildTag("td"),o.append(u.append(i)),f=t.buildTag("label").text(r._getLocStr("Within")),i.append(f),i=t.buildTag("td"),f=t.buildTag("label").text(r._getLocStr("Search")),i.append(f),u.append(i),u=t.buildTag("tr.e-dlgtd-fields"),i=t.buildTag("td"),o.append(u.append(i)),e=t.buildTag("input","","",{id:r._id+"_Ribbon_ddWithin",type:"text"}),i.append(e),e.ejDropDownList(r._generateEJDD(this._within,{id:"Types",text:"text",value:"value"},0,110,25)),i=t.buildTag("td"),e=t.buildTag("input","","",{id:r._id+"_Ribbon_ddSearch",type:"text"}),i.append(e),e.ejDropDownList(r._generateEJDD(this._sType,{id:"Types",text:"text",value:"value"},0,120,25)),u.append(i),u=t.buildTag("tr.e-dlgtd-fields"),i=t.buildTag("td"),o.append(u.append(i)),f=t.buildTag("label",r._getLocStr("Lookin")),i.append(f),i=t.buildTag("td"),f=t.buildTag("label",r._getLocStr("Replace")+" "+r._getLocStr("Direction")),u.append(i.append(f)),u=t.buildTag("tr.e-dlgtd-fields"),i=t.buildTag("td"),o.append(u.append(i)),e=t.buildTag("input","","",{id:r._id+"_Ribbon_ddLookin",type:"text"}),i.append(e),e.ejDropDownList(r._generateEJDD(this._vType,{id:"Types",text:"text",value:"value"},0,110,25,"Type")),i=t.buildTag("td"),e=t.buildTag("input","","",{id:r._id+"_Ribbon_ddDirection",type:"text"}),u.append(i.append(e)),e.ejDropDownList(r._generateEJDD(this._direction,{id:"Types",text:"text",value:"value"},0,120,25)),n("#"+r._id+"_Settings").append(a.append(o)))},_frTypeChange:function(t,i){t==="Type"&&i.value==="comment"?(n("#"+this._id+"_Ribbon_textReplace").attr("disabled",!0),n("#"+this._id+"FR_ReplaceBtn").ejButton("disable"),n("#"+this._id+"FR_ReplaceAllBtn").ejButton("disable")):(n("#"+this._id+"_Ribbon_textReplace").prop("disabled",!1),n("#"+this._id+"FR_ReplaceBtn").ejButton("enable"),n("#"+this._id+"FR_ReplaceAllBtn").ejButton("enable"))},_hlTabChange:function(t){var i=this.XLObj,s=n("#"+i._id+"_Ribbon_sheentName").data("ejTreeView"),r=i.getActiveSheetIndex(),h=n("#"+i._id+"_Doc"),c=n("#"+i._id+"_Web"),l=n("#"+i._id+"_Ribbon_webAddress"),f=n("#"+i._id+"_Ribbon_findText"),u=n("#"+i._id+"_Ribbon_cellAddress"),e=n("#"+i._id+"_Ribbon_cellText"),a=i.getActiveCell(r),o=i.XLEdit.getPropertyValue(a.rowIndex,a.colIndex,"hyperlink",r);switch(t.activeIndex){case 0:l.focus().setInputPos(l.val().length);f.val(e.val());h.hide();c.show();n("#"+i._id+"hlDialog_OkBtn").ejButton("enable");break;case 1:u.val().length||u.val("A1");h.show();c.hide();o&&o.cellAddr&&(r=parseInt(o.cellAddr.split("_")[1]));s.selectNode(r+1);f.val().length?e.val(f.val()):e.val(s.getText(r+1)+"!A1");u.focus().setInputPos(u.val().length)}},_findTabChange:function(t){var r,i=this.XLObj;switch(t.activeIndex){case 0:r=n("#"+i._id+"_Ribbon_FindDiv");n("#"+i._id+"_Ribbon_lbReplace").hide();n("#"+i._id+"_Ribbon_textReplace").hide();n("#"+i._id+"FR_ReplaceBtn").css("visibility","hidden");n("#"+i._id+"FR_ReplaceAllBtn").css("visibility","hidden");n("#"+i._id+"_Find").append(r);n("#"+i._id+"FR_PrevBtn").show();n("#"+i._id+"FR_NextBtn").show();n("#"+i._id+"_Ribbon_textFind").focus().setInputPos(n("#"+i._id+"_Ribbon_textFind").val().length);i._phoneMode?(n("#"+i._id+"FR_ReplaceBtn").hide(),n("#"+i._id+"FR_ReplaceAllBtn").hide()):(n("#"+i._id+"FR_ReplaceBtn").show(),n("#"+i._id+"FR_ReplaceAllBtn").show());break;case 1:r=n("#"+i._id+"_Ribbon_FindDiv");n("#"+i._id+"_Ribbon_lbReplace").show();n("#"+i._id+"_Ribbon_textReplace").show();n("#"+i._id+"FR_ReplaceBtn").css("visibility","visible").show();n("#"+i._id+"FR_ReplaceAllBtn").css("visibility","visible").show();i._phoneMode?(n("#"+i._id+"FR_PrevBtn").hide(),n("#"+i._id+"FR_NextBtn").hide()):(n("#"+i._id+"FR_PrevBtn").show(),n("#"+i._id+"FR_NextBtn").show());n("#"+i._id+"_Replace").append(r);n("#"+i._id+"_Ribbon_textFind").focus().setInputPos(n("#"+i._id+"_Ribbon_textFind").val().length);break;case 2:n("#"+i._id+"FR_PrevBtn").hide();n("#"+i._id+"FR_NextBtn").hide();n("#"+i._id+"FR_ReplaceBtn").css("visibility","hidden");n("#"+i._id+"FR_ReplaceAllBtn").css("visibility","hidden");n("#"+i._id+"_Ribbon_ddWithin").focus();i._phoneMode?n("#"+i._id+"_Ribbon_SettingsDiv").find("td:eq(1)").hide():n("#"+i._id+"_Ribbon_SettingsDiv").find("td:eq(1)").show()}},_gotoTabChange:function(t){var i=this.XLObj;t.activeIndex==0&&n("#"+i._id+"_textRef").focus().setInputPos(n("#"+i._id+"_textRef").val().length)},_btnFROnClick:function(t){var i=this.XLObj;i.showWaitingPopUp();var r=i.getActiveSheetIndex(),c=i.getSheet(r)._startCell.rowIndex,l=i.getSheet(r)._startCell.colIndex,u=n("#"+i._id+"_Ribbon_Case").data("ejCheckBox").isChecked(),f=n("#"+i._id+"_Ribbon_AllContent").data("ejCheckBox").isChecked(),e=this._within[n("#"+i._id+"_Ribbon_ddWithin").data("ejDropDownList").selectedIndexValue].value,s=this._sType[n("#"+i._id+"_Ribbon_ddSearch").data("ejDropDownList").selectedIndexValue].value,o=this._vType[n("#"+i._id+"_Ribbon_ddLookin").data("ejDropDownList").selectedIndexValue].value,a=this._direction[n("#"+i._id+"_Ribbon_ddDirection").data("ejDropDownList").selectedIndexValue].value,h;switch(t){case"FR_NextBtn":case"FR_PrevBtn":i.XLSearch._findCount=0;h=t==="FR_NextBtn"?i.XLSearch._findNext(n("#"+i._id+"_Ribbon_textFind").val(),r,u,f,o,e,s):i.XLSearch._findPrev(n("#"+i._id+"_Ribbon_textFind").val(),r,u,f,o,e,s);h||(i.XLSearch._updateSelection(c,l,r),i.hideWaitingPopUp(),i._showAlertDlg("Alert","NotFound"));break;case"FR_ReplaceBtn":i.XLSearch._replaceData(n("#"+i._id+"_Ribbon_textFind").val(),n("#"+i._id+"_Ribbon_textReplace").val(),r,u,f,o,a,e,s);break;case"FR_ReplaceAllBtn":i.XLSearch._replaceAllData(n("#"+i._id+"_Ribbon_textFind").val(),n("#"+i._id+"_Ribbon_textReplace").val(),u,f,o,e);break;case"FR_CloseBtn":n("#"+i._id+"_FRDialog").ejDialog("close");i._setSheetFocus()}i.hideWaitingPopUp()},_renderGoToDialog:function(){var f,o,u,s,e,i=this.XLObj,r;n("#"+i._id+"_GoToDlgTab").ejTab({width:"100%",itemActive:t.proxy(this._gotoTabChange,this),cssClass:"e-ss-dlgtab"});n("#"+i._id+"_GoToDiv").length<1&&(f=t.buildTag("div.e-dlgctndiv","",{},{id:i._id+"_GoToDiv"}),n("#"+i._id+"_GoTo").append(f),r=t.buildTag("div.e-dlg-fields"),u=t.buildTag("label.e-dlg-fields",i._getLocStr("GoToName")),s=t.buildTag("ul#"+i._id+"_GotoAddr"),f.append(r.append(u,s)),n("#"+i._id+"_GotoAddr").ejListBox({dataSource:this._addrList,height:"120",width:"100%",selected:n.proxy(this._gotoValChange,this),fields:{id:"Types",text:"text",value:"value"}}),r=t.buildTag("div.e-dlg-fields"),u=t.buildTag("label.e-dlg-fields",i._getLocStr("Reference")),e=t.buildTag("input.ejinputtext","","",{id:i._id+"_textRef",type:"text"}),e.data("parentID",i._id),f.append(r.append(u,e)),o=t.buildTag("div#"+i._id+"_GoToSpDiv.e-dlgctndiv e-ss-gotosp-content","",""),r=t.buildTag("div.e-dlg-fields e-dlgctndiv"),n("#"+i._id+"_GoToSp").append(o.append(r)),n("#"+i._id+"_GoToSp").css({overflow:"auto",height:"auto"}),u=t.buildTag("label.e-dlg-fields").text(i._getLocStr("Select")).css("display","table"),r.append(u),this._renderGotoSp(r,this._gotoRBtnSet1,this._gotoRBtnSet2,this._gotoChkBox),n("#"+i._id+"_GoDialog").ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,width:"auto",allowKeyboardNavigation:!1,title:i._getLocStr("GoTo"),cssClass:"e-ss-dialog e-ss-gotodlg e-ss-mattab e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this),open:t.proxy(function(){var t=n("#"+i._id+"_textRef");t.focus().setInputPos(t.val().length)})}),n("#"+i._id+"_GoToDiv").wrapInner('<form id="'+i._id+'_Form_GoToDiv" onsubmit="return false"><\/form>'),this._dialogValidate("_GoToDiv"))},_renderGotoSp:function(i,r,u,f){for(var l,c,s,e,h=this.XLObj,v=h._id+"_gotoSpDiv",a,y=t.buildTag("table"),o=0;o<r.length;o++)s=t.buildTag("tr","",{height:35}),e=t.buildTag("td"),l=t.buildTag("input#"+v+"_"+r[o],"",{},{type:"radio",name:"gotospecial"}),e.append(l),s.append(e),l.ejRadioButton({size:"medium",change:n.proxy(this._rBtnOnClick,this,r[o])}),e=t.buildTag("td","",{width:100}),c=t.buildTag("label",h._getLocStr(r[o]),{},{"for":v+"_"+r[o]}),e.append(c),s.append(e),h.isUndefined(u[o])||(e=t.buildTag("td"),l=t.buildTag("input#"+v+"_"+u[o],"",{},{type:"radio",name:"gotospecial"}),e.append(l),s.append(e),l.ejRadioButton({size:"medium",change:n.proxy(this._rBtnOnClick,this,u[o])}),e=t.buildTag("td"),c=t.buildTag("label",h._getLocStr(u[o]),{},{"for":v+"_"+u[o]}),e.append(c),s.append(e)),y.append(s);for(o=0;o<f.length;o=o+2)s=t.buildTag("tr.e-ss-gotosp-chk"),e=t.buildTag("td"),a=t.buildTag("input#"+h._id+"_"+f[o]),e.append(a),s.append(e),e=t.buildTag("td"),c=t.buildTag("label",h._getLocStr(f[o]),{},{"for":h._id+"_"+f[o]}),e.append(c),s.append(e),a.ejCheckBox({checked:!0,enabled:!1}),e=t.buildTag("td"),a=t.buildTag("input#"+h._id+"_"+f[o+1]),e.append(a),s.append(e),e=t.buildTag("td"),c=t.buildTag("label",h._getLocStr(f[o+1]),{},{"for":h._id+"_"+f[o+1]}),e.append(c),s.append(e),a.ejCheckBox({checked:!0,enabled:!1}),y.append(s);i.append(y);n("#"+v+"_Blanks").ejRadioButton("option",{checked:!0})},_renderPvtDialog:function(){var r=this.XLObj,s,e,o,u,i,f;n("#"+r._id+"_Ribbon_PvtDiv").length<1&&(s=t.buildTag("div.e-dlgctndiv","",{},{id:r._id+"_Ribbon_PvtDiv"}),o=t.buildTag("table","",{},{cellpadding:0,cellspacing:0}),u=t.buildTag("tr.e-ss-changerange"),i=t.buildTag("td",""),e=t.buildTag("label",r._getLocStr("Range")),i.append(e),u.append(i),i=t.buildTag("td",""),f=t.buildTag("input.ejinputtext","",{},{id:r._id+"_Ribbon_PvtRange",type:"text"}),f.data("parentID",r._id),u.append(i.append(f)),o.append(u),u=t.buildTag("tr.e-ss-movepvttbl"),i=t.buildTag("td"),e=t.buildTag("label",r._getLocStr("ChoosePivotTable")),i.append(e),i.attr("colspan",2),o.append(u.append(i)),u=t.buildTag("tr.e-ss-movepvttbl"),i=t.buildTag("td"),i.attr("colspan",2),f=t.buildTag("input#"+r._id+"_dlg_newsheet","",{},{type:"radio",name:"sheet"}),i.append(f),e=t.buildTag("label"," "+r._getLocStr("NewWorksheet")),i.append(e),o.append(u.append(i)),f.ejRadioButton({size:"medium",checked:!0,change:n.proxy(this._rBtnPvtOnClick,this,"new")}),u=t.buildTag("tr.e-ss-movepvttbl"),i=t.buildTag("td"),i.attr("colspan",2),f=t.buildTag("input#"+r._id+"_dlg_existsheet","",{},{type:"radio",name:"sheet"}),i.append(f),e=t.buildTag("label"," "+r._getLocStr("ExistingWorksheet")),i.append(e),o.append(u.append(i)),f.ejRadioButton({size:"medium",change:n.proxy(this._rBtnPvtOnClick,this,"existing")}),u=t.buildTag("tr.e-ss-movepvttbl"),i=t.buildTag("td"),e=t.buildTag("label",r._getLocStr("Location")),i.append(e),u.append(i),i=t.buildTag("td"),f=t.buildTag("input.ejinputtext","",{},{id:r._id+"_Ribbon_PvtLocation",type:"text"}),f.data("parentID",r._id),u.append(i.append(f)),o.append(u),n("#"+r._id+"_Pivot").append(s.append(o)),n("#"+r._id+"_Ribbon_PvtLocation").wrap("<form id='"+r._id+"_Form_Ribbon_PvtLocation' onsubmit='return false'><\/form>").prop("disabled",!0),this._dialogValidate("_Ribbon_PvtLocation"),n("#"+r._id+"_Ribbon_PvtRange").wrap("<form id='"+r._id+"_Form_Ribbon_PvtRange' onsubmit='return false'><\/form>"),this._dialogValidate("_Ribbon_PvtRange"))},_dlgPvtOk:function(){var t=this.XLObj,r=n("#"+t._id+"_PvtDialog"),i;n("#"+t._id+"_Form_Ribbon_PvtRange").valid()&&n("#"+t._id+"_Form_Ribbon_PvtLocation").valid()&&(i=t.XLPivot._checkRange(n("#"+t._id+"_Ribbon_PvtRange").val(),n("#"+t._id+"_Ribbon_PvtLocation").val()),i.isRows?t._showAlertDlg("Alert","PivotRowsAlert","",450):i.isHeader?t._showAlertDlg("Alert","PivotLabelsAlert","",550):i.isOverlap?t._showAlertDlg("Alert","PivotOverlapAlert","",450):(n("#"+t._id+"_PvtDialog").ejDialog("close"),r.find(".e-ss-changerange:visible").length&&r.find(".e-ss-movepvttbl:visible").length?t.XLPivot.createPivotTable(n("#"+t._id+"_Ribbon_PvtRange").val(),n("#"+t._id+"_Ribbon_PvtLocation").val(),null):r.find(".e-ss-changerange:visible").length?t.XLPivot._changeDataSource():t.XLPivot._movePivotTable()))},_dlgPvtCancel:function(){var t=this.XLObj;n("#"+t._id+"_PvtDialog").ejDialog("close");t._setSheetFocus()},_rBtnPvtOnClick:function(t){var r=this.XLObj,u=n("#"+r._id+"_Ribbon_PvtRange"),i=n("#"+r._id+"_Ribbon_PvtLocation");i.prop("disabled",t==="new");t==="new"?(u.focus().setInputPos(u.val().length),n("#"+this.XLObj._id+"_Form_Ribbon_PvtLocation").validate().resetForm()):i.setInputPos(i.val().length)},_rBtnOnClick:function(t){var r=this.XLObj,i;if(t==="Formulas"||t==="Constants")for(i=0;i<this._gotoChkBox.length;i++)n("#"+r._id+"_"+this._gotoChkBox[i]).data("ejCheckBox").option({enabled:!0});else for(i=0;i<this._gotoChkBox.length;i++)n("#"+r._id+"_"+this._gotoChkBox[i]).data("ejCheckBox").option({enabled:!1})},_gotoValChange:function(t){n("#"+this.XLObj._id+"_textRef").val(t.model.value)},_getAddrFromDollarAddr:function(n){var i,t;return n.indexOf("!")>-1&&(t=n.split("!"),i=this.XLObj._getSheetIndexByName(t[0]),n=t[1]),n.indexOf("$")>-1&&(n=n.split("$").join("")),n.indexOf(":")<0&&(n=n+":"+n),n=n.replace("=",""),[i,n]},_gotoBtnClick:function(t){var i=this.XLObj,r;switch(t){case"ok":n("#"+i._id+"_Form_GoToDiv").valid()&&(r=n("#"+i._id+"_GoToDlgTab").data("ejTab"),r.model.selectedItemIndex?i.XLSearch._applyGoToRule(n("#"+i._id+"_GoToSpDiv").find(".e-circle_01").parents("div")[0].id.split("ej"+i._id+"_gotoSpDiv_")[1].toLowerCase(),n("#"+i._id+"_"+this._gotoChkBox[0]).data("ejCheckBox").isChecked(),n("#"+i._id+"_"+this._gotoChkBox[1]).data("ejCheckBox").isChecked(),n("#"+i._id+"_"+this._gotoChkBox[2]).data("ejCheckBox").isChecked(),n("#"+i._id+"_"+this._gotoChkBox[3]).data("ejCheckBox").isChecked()):i.XLSearch.goTo(n.trim(n("#"+i._id+"_textRef").val().toString())),n("#"+i._id+"_GoDialog").ejDialog("close"));break;case"cancel":n.validator&&n("#"+i._id+"_Form_GoToDiv").validate().resetForm();n("#"+i._id+"_GoDialog").ejDialog("close")}i._setSheetFocus()},_borderPicture:function(){var n=this.XLObj;return"<ul id="+n._id+"_Ribbon_PictureBorder style='display:none' class='e-ss-pictureborder'><li id='"+n._id+"picturecolor'><a>"+n._getLocStr("ThemeColor")+"<\/a><ul><li><input id='"+n._id+"_Ribbon_PictureColor'><\/input><\/li><\/ul><\/li><li id='nooutline' class='picturecolor'><a>"+n._getLocStr("NoOutline")+"<\/a><\/li><li id='weight' class='picturecolor'><a>"+n._getLocStr("Weight")+"<\/a><ul><li id='1px'><a>1px<\/a><\/li><li id='2px'><a>2px<\/a><\/li><li id='3px'><a>3px<\/a><\/li><\/ul><\/li><li id='dashes' class='picturecolor'><a>"+n._getLocStr("Dashes")+"<\/a><ul><li id='solid'><a><div style='border:2px solid black'><\/div><\/a><\/li><li id='dotted'><a><div style='border:2px dotted black'><\/div><\/a><\/li><li id='dashed'><a><div style='border:2px dashed black'><\/div><\/a><\/li><\/ul><\/li><\/ul>"},_chartElementTag:function(){var n=this.XLObj,t="<ul id="+n._id+'_Ribbon_CElement class="e-spreadsheet" style="display:none">';return t+='<li class="axes" id="Axes"><a><span class="e-ss-chartimg e-icon e-ss-axes"><\/span>'+n._getLocStr("Axes")+'<\/a><ul><li class="phaxis e-ss-cmenuitem" id="PHAxis"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-phaxis"><\/span>'+n._getLocStr("PHAxis")+'<\/a><\/li><li class="pvaxis e-ss-cmenuitem" id="PVAxis"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pvaxis"><\/span>'+n._getLocStr("PVAxis")+"<\/a><\/li><\/ul><\/li>",t+='<li class="axistitle" id="AxisTitle"><a><span class="e-ss-chartimg e-icon e-ss-axistitle"><\/span>'+n._getLocStr("AxisTitle")+'<\/a><ul><li class="phaxistitle e-ss-cmenuitem" id="PHAxisTitle"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-phaxistitle"><\/span>'+n._getLocStr("PHAxis")+'<\/a><\/li><li class="pvaxistitle e-ss-cmenuitem" id="PVAxisTitle"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pvaxistitle"><\/span>'+n._getLocStr("PVAxis")+"<\/a><\/li><\/ul><\/li>",t+='<li class="charttitle" id="ChartTitle"><a><span class="e-ss-chartimg e-icon e-ss-charttitle"><\/span>'+n._getLocStr("ChartTitle")+'<\/a><ul><li class="ctnone e-ss-cmenuitem" id="CTNone"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctnone"><\/span>'+n._getLocStr("CTNone")+'<\/a><\/li><li class="ctcenter e-ss-cmenuitem" id="CTCenter"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctcenter"><\/span>'+n._getLocStr("CTCenter")+'<\/a><\/li><li class="ctfar e-ss-cmenuitem" id="CTFar"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctfar"><\/span>'+n._getLocStr("CTFar")+'<\/a><\/li><li class="ctnear e-ss-cmenuitem" id="CTNear"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctnear"><\/span>'+n._getLocStr("CTNear")+"<\/a><\/li><\/ul><\/li>",t+='<li class="datalabels" id="DataLabels"><a><span class="e-ss-chartimg e-icon e-ss-datalabels"><\/span>'+n._getLocStr("DataLabels")+'<\/a><ul><li class="dlnone e-ss-cmenuitem" id="DLNone"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dlnone"><\/span>'+n._getLocStr("DLNone")+'<\/a><\/li><li class="dlcenter e-ss-cmenuitem" id="DLCenter"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dlcenter"><\/span>'+n._getLocStr("DLCenter")+'<\/a><\/li><li class="dliend e-ss-cmenuitem" id="DLIEnd"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dliend"><\/span>'+n._getLocStr("DLIEnd")+'<\/a><\/li><li class="dlibase e-ss-cmenuitem" id="DLIBase"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dlibase"><\/span>'+n._getLocStr("DLIBase")+'<\/a><\/li><li class="dloend e-ss-cmenuitem" id="DLOEnd"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dloend"><\/span>'+n._getLocStr("DLOEnd")+"<\/a><\/li><\/ul><\/li>",t+='<li class="gridline" id="Gridline"><a><span class="e-ss-chartimg e-icon e-ss-gridline"><\/span>'+n._getLocStr("Gridline")+'<\/a><ul><li class="pmajorh e-ss-cmenuitem" id="PMajorH"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pmajorh"><\/span>'+n._getLocStr("PMajorH")+'<\/a><\/li><li class="pmajorv e-ss-cmenuitem" id="PMajorV"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pmajorv"><\/span>'+n._getLocStr("PMajorV")+'<\/a><\/li><li class="pminorh e-ss-cmenuitem" id="PMinorH"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon  e-ss-pminorh"><\/span>'+n._getLocStr("PMinorH")+'<\/a><\/li><li class="pminorv e-ss-cmenuitem" id="PMinorV"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pminorv"><\/span>'+n._getLocStr("PMinorV")+"<\/a><\/li><\/ul><\/li>",t+('<li class="legend" id="Legend"><a><span class="e-ss-chartimg e-icon e-ss-legend"><\/span>'+n._getLocStr("Legend")+'<\/a><ul><li class="lnone e-ss-cmenuitem" id="LNone"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lnone"><\/span>'+n._getLocStr("LNone")+'<\/a><\/li><li class="lright e-ss-cmenuitem" id="LRight"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lright"><\/span>'+n._getLocStr("LRight")+'<\/a><\/li><li class="lleft e-ss-cmenuitem" id="LLeft"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lleft"><\/span>'+n._getLocStr("LLeft")+'<\/a><\/li><li class="lbottom e-ss-cmenuitem" id="LBottom"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lbottom"><\/span>'+n._getLocStr("LBottom")+'<\/a><\/li><li class="ltop e-ss-cmenuitem" id="LTop"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ltop"><\/span>'+n._getLocStr("LTop")+"<\/a><\/li><\/ul><\/li>")},_cpClickHandler:function(t){var i=this.XLObj;t==="Ribbon_Home_Font_FillColor"?i.XLFormat.format({style:{"background-color":n("#"+i._id+"_Ribbon_Home_Font_FillColor").ejColorPicker("option","value")}}):t==="Ribbon_Home_Font_FontColor"&&i.XLFormat.format({style:{color:n("#"+i._id+"_Ribbon_Home_Font_FontColor").ejColorPicker("option","value")}});i._setSheetFocus()},_ribbonClickHandler:function(i){var d,b,et,v,ut,yi,pi,ni,it,ti,c,l,wi,ot,vt,tt,st,ht,wt,ft,y,bi,f,ii={},r=n("#"+this._id.split("_Ribbon")[0]).data("ejSpreadsheet"),u=r.getActiveSheetIndex(),e=r.getSheet(u),a={},o={},h=this._id.split("_"),k=t.Spreadsheet.SupportedStyles,bt,ki,yt,p,w=e._selectedCells,nt,g,ct,ri,ui,kt,lt,di,at,fi,gi,dt,ei,rt,gt,oi,si,hi,ci,pt,s,li,ai,vi;if(!r._shapeChange&&!r.XLRibbon._isSetModel){if(r._isRibbonClick=!0,yt=r._getJSSheetContent(u).find(".e-spreadsheetcontentcontainer > .e-content"),ut=n("#"+r._id+"_Ribbon_Home_Number_NumberFormat").data("ejDropDownList"),ft=n("#"+r._id+"_Ribbon_Home_Font_FontSize").data("ejDropDownList"),wt=n(r.getCell(e._activeCell.rowIndex,e._activeCell.colIndex)),r.model.allowSelection&&r.model.allowFormatAsTable&&r.model.allowCellFormatting&&(r.XLFormat._formatEnable||r.XLSelection._isOutsideBordering||r.XLSelection._isGridBordering)&&(r._id+"_Ribbon_Home_Font_BorderColor"===this._id||r._id+"_Ribbon_bordercolor"===i.ID||r._borderStyles.indexOf(i.ID)>-1||(r.XLSelection._isGridBordering=r.XLSelection._isOutsideBordering=r.XLFormat._formatEnable=!1,n("#"+r._id+"_Ribbon_Home_Clipboard_FormatPainter").ejToggleButton("option",{toggleState:!1}),(i.type==="itemSelected"||i.type==="click")&&!r.isUndefined(i.model.prefixIcon)&&(i.model.prefixIcon.split("e-ss-")[1]===i.ID||i.model.prefixIcon.indexOf("e-ss-drawborder")>-1||i.model.prefixIcon.indexOf("e-ss-drawbordergrid")>-1)&&(r.XLSelection._isGridBordering=r.XLSelection._isOutsideBordering=!0),yt.addClass("e-ss-cursor"),yt.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor e-ss-fpcursor"),r.XLSelection._cleanUp(!0))),ki={Id:this._id,isChecked:i.isChecked,status:i.status,prop:i.model,model:r.model},r._trigger("ribbonClick",ki))return r.model.showRibbon&&r.XLRibbon._updateRibbonIcons(),!1;!t.isNullOrUndefined(r._getAutoFillOptElem())&&r.model.autoFillSettings.showFillOptions&&(r._getAutoFillOptElem().addClass("e-hide"),n("#"+r._id+"_ctxtmenu").hide());switch(this._id){case r._id+"_Ribbon_Home_Clipboard_Cut":r.XLClipboard.cut();break;case r._id+"_Ribbon_Home_Clipboard_Copy":r.XLClipboard.copy();break;case r._id+"_Ribbon_Home_Clipboard_Paste":case r._id+"_Ribbon_Home_Clipboard_PasteOptions":r.XLClipboard._isSpecial=!(i.ID==="PasteValues");r.XLClipboard.paste();break;case r._id+"_Ribbon_Home_Actions_Undo":r.XLClipboard._triggerKeyDown(90,!0);break;case r._id+"_Ribbon_Home_Actions_Redo":r.XLClipboard._triggerKeyDown(89,!0);break;case r._id+"_Ribbon_Home_Alignment_WrapText":r._textFormatting("wrapText");break;case r._id+"_Ribbon_PageLayout_Print_Print":r.XLPrint.printSheet(u);break;case r._id+"_Ribbon_PageLayout_Print_PrintSelected":r.XLPrint.printSelection(u);break;case r._id+"_Ribbon_new":r._cellFormatHandler(this._id.replace(r._id+"_Ribbon_",""),i.selectedText);break;case r._id+"_Ribbon_Home_Font_Bold":o[k.FontWeight]=i.model.toggleState?"bold":"normal";a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_Home_Font_Italic":o[k.FontStyle]=i.model.toggleState?"italic":"normal";a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_Home_Font_Underline":case r._id+"_Ribbon_Home_Font_StrikeThrough":nt=r.XLFormat.getFormatFromHashCode(r.XLFormat.getFormatClass(wt[0].className))["text-decoration"]||"";h.indexOf("StrikeThrough")>-1?h[h.indexOf("StrikeThrough")]="line-through":h.indexOf("Underline")>-1&&(h[h.indexOf("Underline")]="underline");i.model.toggleState?(nt=nt.replace("none",""),o[k.TextDecoration]=nt?nt.indexOf("underline")<0?nt+" "+h[h.length-1]:h[h.length-1]+" "+nt:h[h.length-1]):(nt=n.trim(nt.replace(h[h.length-1],"")),o[k.TextDecoration]=nt.length?nt:"none");a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_Home_Font_FontSize":o[k.FontSize]=i.value;a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_Home_Font_IncreaseFontSize":case r._id+"_Ribbon_Home_Font_DecreaseFontSize":this._id==r._id+"_Ribbon_Home_Font_IncreaseFontSize"?(ht=t.isNullOrUndefined(ft.selectedIndexValue)?6:ft.selectedIndexValue+1,t.isNullOrUndefined(r.XLRibbon._fontSize[ht])||ft.option({selectedItemIndex:ht})):this._id==r._id+"_Ribbon_Home_Font_DecreaseFontSize"&&(ht=t.isNullOrUndefined(ft.selectedIndexValue)?4:ft.selectedIndexValue-1,t.isNullOrUndefined(r.XLRibbon._fontSize[ht])||ft.option({selectedItemIndex:ht}));break;case r._id+"_Ribbon_Home_Alignment_AlignLeft":case r._id+"_Ribbon_Home_Alignment_AlignRight":case r._id+"_Ribbon_Home_Alignment_AlignCenter":tt=n(this.element.parents("div").eq(1)).find(".e-text-align");t.isNullOrUndefined(tt[0])?this.element.addClass("e-text-align"):(n("#"+tt[0].id).ejToggleButton("option","toggleState",!1),tt.removeClass("e-text-align"),tt[0].id!=this.element[0].id&&this.element.addClass("e-text-align"));o[k.TextAlign]=i.model.toggleState?h[h.length-1].split("Align")[1]:"left";a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_Home_Alignment_DecreaseIndent":case r._id+"_Ribbon_Home_Alignment_IncreaseIndent":if(ri=0,ui=!1,w.length<2)kt=r.getActiveCell(),g=r.XLFormat.getFormatFromHashCode(r.XLFormat.getFormatClass(r.getCell(kt.rowIndex,kt.colIndex)[0].className)),bt=k.TextIndent in g?this._id===r._id+"_Ribbon_Home_Alignment_IncreaseIndent"?Number(g[k.TextIndent].replace("pt",""))+6:Number(g[k.TextIndent].replace("pt",""))-6:this._id===r._id+"_Ribbon_Home_Alignment_DecreaseIndent"?-6:6,r.XLRibbon._applyTextIndent(kt,g,bt,this);else{for(v=0,ct=w.length;v<ct;v++)g=r.XLFormat.getFormatFromHashCode(r.XLFormat.getFormatClass(r.getCell(w[v].rowIndex,w[v].colIndex)[0].className)),g[k.TextAlign]=="right"&&ri++;for(ri===w.length&&(ui=!0),v=0,ct=w.length;v<ct;v++)g=r.XLFormat.getFormatFromHashCode(r.XLFormat.getFormatClass(r.getCell(w[v].rowIndex,w[v].colIndex)[0].className)),ui||(g[k.TextAlign]="left"),bt=k.TextIndent in g?this._id===r._id+"_Ribbon_Home_Alignment_IncreaseIndent"?Number(g[k.TextIndent].replace("pt",""))+6:Number(g[k.TextIndent].replace("pt",""))-6:this._id===r._id+"_Ribbon_Home_Alignment_DecreaseIndent"?-6:6,r.XLRibbon._applyTextIndent(w[v],g,bt,this)}r.XLSelection.refreshSelection();r.XLDragFill&&r.XLDragFill.positionAutoFillElement();break;case r._id+"_Ribbon_Home_Alignment_TopAlign":case r._id+"_Ribbon_Home_Alignment_MiddleAlign":case r._id+"_Ribbon_Home_Alignment_BottomAlign":tt=n(this.element.parents("div").eq(1)).find(".e-vertical-align");t.isNullOrUndefined(tt[0])?this.element.addClass("e-vertical-align"):(n("#"+tt[0].id).ejToggleButton("option","toggleState",!1),tt.removeClass("e-vertical-align"),tt[0].id!=this.element[0].id&&this.element.addClass("e-vertical-align"));o[k.VerticalAlign]=i.model.toggleState?h[h.length-1].split("Align")[0]:"bottom";a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_Home_Font_FontFamily":o[k.FontFamily]=i.text;a.style=o;r.XLFormat.format(a);break;case r._id+"_Ribbon_PageLayout_Show_Headings":r.showHeadings(i.isChecked);break;case r._id+"_Ribbon_PageLayout_Show_Gridlines":r.showGridlines(i.isChecked);break;case r._id+"_Ribbon_PageLayout_PageLayout_PageSize":case r._id+"_Ribbon_PageLayout_PageLayout_PageSizeOptions":lt=t.isNullOrUndefined(i.ID)?i.model.prefixIcon.substring(12):i.ID;r.XLPrint._printSetting(lt);break;case r._id+"_Ribbon_Home_Number_NumberFormat":a.type=i.value.toLowerCase();a.type!=="custom"?r.XLFormat.format(a):r._showDialog(r._id+"_FormatCells");break;case r._id+"_Ribbon_Home_Number_IncreaseDecimal":case r._id+"_Ribbon_Home_Number_DecreaseDecimal":wt.data("type")!="number"&&n.isNumeric(r.XLEdit.getPropertyValueByElem(wt))&&(r.XLRibbon._isSetModel=!0,ut.option({selectedItemIndex:1}),r.XLRibbon._isSetModel=!1);r.XLFormat.updateDecimalPlaces(h[h.length-1]);break;case r._id+"_Ribbon_Home_Number_Accounting":case r._id+"_Ribbon_Home_Number_Percentage":this._id===r._id+"_Ribbon_Home_Number_Accounting"?ut.option({selectedItemIndex:3}):ut.option({selectedItemIndex:4});a.type=ut.model.value.toLowerCase();break;case r._id+"_Ribbon_Home_Number_CommaStyle":ut.option({selectedItemIndex:1});a.type=ut.model.value.toLowerCase();break;case r._id+"_Ribbon_Data_SortFilter_SortAtoZ":r.XLSort._sortHandler("SortAtoZ");break;case r._id+"_Ribbon_Data_SortFilter_SortZtoA":r.XLSort._sortHandler("SortZtoA");break;case r._id+"_Ribbon_Data_SortFilter_Filter":r.XLFilter.filter();break;case r._id+"_Ribbon_Data_SortFilter_ClearFilter":st=r.XLEdit.getPropertyValue(r.getActiveCell().rowIndex,r.getActiveCell().colIndex,"tableName");t.isNullOrUndefined(st)?r.XLFilter.clearFilter():(y=r._getTableID(st),r.XLFilter._clearFilterTable(r.getActiveSheetIndex(),y,!0));break;case r._id+"_Ribbon_Home_Font_BorderColor":ii=n("#"+r._id+"_Ribbon_BorderColor").data("ejColorPicker");t.isNullOrUndefined(ii)||ii.hide();t.isNullOrUndefined(i.value)||(r._borderColor=i.value);break;case r._id+"_Ribbon_Home_Font_Border":r._borderStyles.indexOf(i.ID)<0?t.isNullOrUndefined(i.ID)?i.ID=i.model.prefixIcon.substring(12):i.ID.indexOf("bordercolor")<0&&n(this.element).find(".e-icon ").removeClass().addClass("e-icon e-ss-"+i.ID)&&this.option({prefixIcon:"e-icon e-ss-"+i.ID}):r.XLRibbon._updateBordeStyle(i);pi=r._borderColor||"#000000";c=e._startCell;l=e._endCell;di=r._getAlphaRange(u,c.rowIndex,c.colIndex,l.rowIndex,l.colIndex);r.model.allowSelection&&(r.XLSelection._isOutsideBordering||r.XLSelection._isGridBordering)?!(r._borderStyles.indexOf(i.ID)>-1)&&i.ID.indexOf("bordercolor")<0&&(r.XLSelection._isOutsideBordering=r.XLSelection._isGridBordering=!1):r.setBorder({type:i.ID,color:pi,style:r._borderStyle},di);break;case r._id+"_Ribbon_Data_DataTools_DataValidation":case r._id+"_Ribbon_Data_DataTools_DataValidationOptions":if(r._showDialog(this._id),i.ID=="ClearVal")r.XLValidate.clearDV();else if(i.ID=="HighlightVal")r.XLValidate.highlightInvalidData();else if(i.ID=="ClearHLVal")r.XLValidate.clearHighlightedValData();else{for(e=r.getSheet(u),at=e._selectedCells,ct=at.length,lt=[],v=0;v<ct;v++)gi=r.XLEdit.getPropertyValue(at[v].rowIndex,at[v].colIndex,"rule"),gi&&(fi=r._dataContainer.sheets[u][at[v].rowIndex][at[v].colIndex].rule.customVal,lt.indexOf(fi)==-1&&lt.push(fi));lt.length>0?r._showAlertDlg("","MoreValidationAlert","OpenValDlg",400,130):(n("#"+r._id+"_ValDialog").ejDialog("open"),n.validator&&n("#"+r._id+"_Form_ValDialog").validate().resetForm(),n("#"+r._id+"_Ribbon_ddType_wrapper").focus(),dt=r.XLEdit.getPropertyValueByElem(r.getActiveCellElem(u),"rule"),dt?(ei=dt.customVal,rt=ei.split("_"),ei.indexOf("list")>-1?(n("#"+r._id+"_Ribbon_ddType").ejDropDownList("option","selectedItemIndex",5),n("#"+r._id+"_Ribbon_btnMin").val(rt[0])):(r.XLRibbon._types.some(function(n,t){if(rt[4]===n.value)return gt=t,!0}),n("#"+r._id+"_Ribbon_ddType").ejDropDownList("option","selectedItemIndex",gt),r.XLRibbon._actions.some(function(n,t){if(rt[0]===n.value)return gt=t,!0}),n("#"+r._id+"_Ribbon_ddAction").ejDropDownList("option","selectedItemIndex",gt),n("#"+r._id+"_Ribbon_btnMin").val(rt[1].replace("^","")),n("#"+r._id+"_Ribbon_btnMax").val(rt[2].replace("^",""))),n("#"+r._id+"_Ribbon_blank").ejCheckBox("option","checked",!dt.required),n("#"+r._id+"_Ribbon_freetext").ejCheckBox("option","checked",JSON.parse(rt[rt.length-3]))):(n("#"+r._id+"_Ribbon_ddType").ejDropDownList("option","selectedItemIndex",1),n("#"+r._id+"_Ribbon_ddAction").ejDropDownList("option","selectedItemIndex",6),n("#"+r._id+"_Ribbon_btnMin").val(""),n("#"+r._id+"_Ribbon_btnMax").val(""),n("#"+r._id+"_Ribbon_blank").ejCheckBox("option","checked",!0),n("#"+r._id+"_Ribbon_freetext").ejCheckBox("option","checked",!0)))}break;case r._id+"_Ribbon_Home_Styles_ConditionalFormatting":if(!i.ID.length)break;r.XLRibbon._currentCFormat=i.ID;i.ID.startsWith("clear")?i.ID==="clearselected"?r.XLCFormat.clearCF(r.getSheet(u).selectedRange):r.XLCFormat.clearCF():i.ID.indexOf("_HLCellRules")>0||i.ID.indexOf("_ClearRules")>0||i.ID.indexOf("_CreateRule")<-1||i.ID.indexOf("_ColorScales")>-1||i.ID.indexOf("_IconSets")>-1||i.ID.indexOf("_DataBars")>-1||(r._showDialog(this._id),r.XLRibbon._renderCFDialog(i));break;case r._id+"_Ribbon_Others_Editing_FindSelect":r._showDialog(this._id);ni=n("#"+r._id+"_GoToDlgTab").data("ejTab");oi=n("#"+r._id+"_FRDialog_FPDlgTab").data("ejTab");switch(i.ID){case"Find":r._responsiveHeight<365&&n("#"+r._id+"_FRDialog_wrapper").css("top","0px");n("#"+r._id+"_FRDialog").ejDialog("open");r.XLRibbon._refreshFRDlg();oi.option({selectedItemIndex:0});n("#"+r._id+"_Ribbon_textFind").focus().setInputPos(n("#"+r._id+"_Ribbon_textFind").val().length);r.model.isReadOnly?n("#"+r._id+"_FRDialog_FPDlgTab").ejTab("option",{disabledItemIndex:[1,2]}):n("#"+r._id+"_FRDialog_FPDlgTab").ejTab("option",{enabledItemIndex:[1,2]});break;case"Replace":r._responsiveHeight<365&&n("#"+r._id+"_FRDialog_wrapper").css("top","0px");n("#"+r._id+"_FRDialog").ejDialog("open");r.XLRibbon._refreshFRDlg();oi.option({selectedItemIndex:1});n("#"+r._id+"_Ribbon_textFind").focus().setInputPos(n("#"+r._id+"_Ribbon_textFind").val().length);break;case"GoTo":n("#"+r._id+"_GoDialog").ejDialog("open");ni.option({selectedItemIndex:0});n("#"+r._id+"_textRef").focus().setInputPos(n("#"+r._id+"_Ribbon_textFind").val().length);n.validator&&n("#"+r._id+"_Form_GoToDiv").validate().resetForm();break;case"GoToSpecial":n("#"+r._id+"_GoDialog").ejDialog("open");ni.option({selectedItemIndex:1});n("#"+r._id+"_Blanks").focus();break;default:r.XLSearch._applyGoToRule(i.ID.toLowerCase(),!0,!0,!0,!0)}break;case r._id+"_Ribbon_Others_CalCulation_CalculationOptions":switch(i.ID){case r._id+"_CalcAuto":r.XLEdit.calcOption(!0);break;case r._id+"_CalcManual":r.XLEdit.calcOption(!1)}break;case r._id+"_Ribbon_Others_CalCulation_CalculateNow":r.XLEdit.calcNow();break;case r._id+"_Ribbon_Others_CalCulation_CalculateSheet":r.XLEdit.calcNow(r.getActiveSheetIndex());break;case r._id+"_Ribbon_Home_Clipboard_FormatPainter":if(!i.model.toggleState)return r.performSelection(r.getActiveCell(),r.getActiveCell()),!1;r.XLFormat._formatEnable=!0;yt.removeClass("e-ss-cursor");yt.addClass("e-ss-fpcursor");r.XLFormat._formatPainter();break;case r._id+"_Ribbon_Design_Tools_ConvertToRange":r.XLFormat.convertToRange({alert:!0});break;case r._id+"_Ribbon_Design_Tools_ResizeTable":y=parseInt(document.getElementById(r._id+"_tableid").value);f=e.tableManager[y].range;r._showDialog(r._id+"_Ribbon_Design_Tools_ResizeTable");n("#"+r._id+"_fatresizetablerange").val(r._getAlphaRange(u,f[0],f[1],f[2],f[3]));n("#"+r._id+"_fatresizetabledlg").ejDialog("open");break;case r._id+"_Ribbon_Design_TableStyleOptions_FirstColumn":case r._id+"_Ribbon_Design_TableStyleOptions_LastColumn":this._id===r._id+"_Ribbon_Design_TableStyleOptions_FirstColumn"?(r.XLRibbon._isFirstColumn=!0,y=document.getElementById(r._id+"_tableid").value,f=e.tableManager[y].range,f=r._getProperAlphaRange(u,f[0]+1,f[1],f[2],f[1]),r.XLRibbon._firstLastColumn(y,u),ti="firstColumn"):(r.XLRibbon._isFirstColumn=!1,y=document.getElementById(r._id+"_tableid").value,f=e.tableManager[y].range,f=r._getProperAlphaRange(u,f[0]+1,f[3],f[2],f[3]),r.XLRibbon._firstLastColumn(y,u),ti="lastColumn");ot={sheetIndex:u,reqType:"format-table",action:"firstlastcolumn",range:f,check:i.isChecked,id:i.model.id,tableId:parseInt(y),prop:ti};r._completeAction(ot);r._trigActionComplete(ot);break;case r._id+"_Ribbon_Design_TableStyleOptions_TotalRow":y=document.getElementById(r._id+"_tableid").value;r.XLRibbon._totalRow(y,u);break;case r._id+"_Ribbon_Design_TableStyleOptions_FilterColumn":if(!r.model.allowFiltering)return;bi=e.tableManager;y=document.getElementById(r._id+"_tableid").value;r.XLFilter._clearFilterTableIcon(u,parseInt(document.getElementById(r._id+"_tableid").value));bi[y].isFilter=i.isChecked;ot={sheetIndex:u,reqType:"format-table",action:"filtericon",id:i.model.id,check:i.isChecked,tableId:parseInt(y)};r._completeAction(ot);r._trigActionComplete(ot);break;case r._id+"_Ribbon_Insert_Tables_Table":r._showDialog(this._id);r.XLRibbon._openFATDlg();break;case r._id+"_Ribbon_Review_Comments_NewComment":n("#"+r._id+"_Ribbon_Review_Comments_NewComment").text()===r._getLocStr("NewComment")?r.XLComment.setComment():r.XLComment.editComment();break;case r._id+"_Ribbon_Review_Comments_DeleteComment":r.XLComment.deleteComment();break;case r._id+"_Ribbon_Review_Comments_ShowAllComments":r.XLComment.showAllComments();break;case r._id+"_Ribbon_Review_Comments_ShowHideComment":r.XLComment.showHideComment();break;case r._id+"_Ribbon_Review_Comments_NextComment":r.XLComment.findNextComment();break;case r._id+"_Ribbon_Review_Comments_PreviousComment":r.XLComment.findPrevComment();break;case r._id+"_Ribbon_Insert_Links_Hyperlink":r._showDialog(this._id);break;case r._id+"_Ribbon_Home_Editing_SortFilter":switch(i.ID){case"Ribbon_SortAtoZ":case"Ribbon_SortZtoA":r.model.allowSorting&&r.XLSort._sortHandler(i.ID);break;case"Ribbon_Filter":r.model.allowFiltering&&r.XLFilter.filter();break;default:st=r.getCell(r.getActiveCell().rowIndex,r.getActiveCell().colIndex)[0].className;st.indexOf("e-table")<0?r.XLFilter.clearFilter():(y=r._getTableID(st),r.XLFilter._clearFilterTable(r.getActiveSheetIndex(),parseInt(y),!0))}break;case r._id+"_Ribbon_Others_Cells_InsertCell":case r._id+"_Ribbon_Others_Cells_InsertCellOptions":if(w.length<1)return;c=w[0];l=w[w.length-1];switch(i.ID){case"InsertCells":r._getJSSheetRowHeaderContent(u).find(".e-rowselected").length?r.insertEntireRow(c.rowIndex,l.rowIndex):r._getJSSheetHeader(u).find(".e-colselected").length?(r._insDelStatus="insert",r.insertEntireColumn(c.colIndex,l.colIndex)):r._showDialog(this._id);break;case"InsertSheetRows":r.insertEntireRow(c.rowIndex,l.rowIndex);break;case"InsertSheetColumns":r._insDelStatus="insert";r.insertEntireColumn(c.colIndex,l.colIndex);break;case"InsertSheet":r.insertSheet();break;default:r.element.find(".e-rowselected").length>0?r.insertEntireRow(c.rowIndex,l.rowIndex):r.element.find(".e-colselected").length>0?(r._insDelStatus="insert",r.insertEntireColumn(c.colIndex,l.colIndex)):r.insertShiftBottom(c,l)}break;case r._id+"_Ribbon_Others_Cells_DeleteCell":case r._id+"_Ribbon_Others_Cells_DeleteCellOptions":if(w.length<1)return;c=w[0];l=w[w.length-1];switch(i.ID){case"DeleteCells":r._getJSSheetRowHeaderContent(u).find(".e-rowselected").length?r.deleteEntireRow(c.rowIndex,l.rowIndex,[]):r._getJSSheetHeader(u).find(".e-colselected").length?(r._insDelStatus="delete",r.deleteEntireColumn(c.colIndex,l.colIndex,[])):r._showDialog(this._id);break;case"DeleteSheetRows":r.deleteEntireRow(c.rowIndex,l.rowIndex,[]);break;case"DeleteSheetColumns":r._insDelStatus="delete";r.deleteEntireColumn(c.colIndex,l.colIndex,[]);break;case"DeleteSheet":r.deleteSheet(u,!0);break;default:r.element.find(".e-rowselected").length>0?r.deleteEntireRow(c.rowIndex,l.rowIndex):r.element.find(".e-colselected").length>0?(r._insDelStatus="insert",r.deleteEntireColumn(c.colIndex,l.colIndex)):r.deleteShiftUp(c,l)}break;case r._id+"_Ribbon_Home_Editing_Clear":f=e.selectedRange;switch(i.ID){case"Clear_All":f=r._getAlphaRange(u,f[0],f[1],f[2],f[3]);r._isTrigCellSave=!0;r.clearAll(f);break;case"Clear_Formats":f=r._getAlphaRange(u,f[0],f[1],f[2],f[3]);r.clearAllFormat(f);break;case"Clear_Contents":f=r._getAlphaRange(u,f[0],f[1],f[2],f[3]);r._isTrigCellSave=!0;r.clearContents(f);break;case"Clear_Comments":r.clearComments(u);break;default:r.clearHyperlinks()}r.model.allowSelection&&r.XLSelection._clearBorder(r._arrayAsString(r._cutFocus),u);break;case r._id+"_Ribbon_Insert_Tables_PivotTable":if(r._showDialog(this._id),d=n("#"+r._id+"_PvtDialog"),e=r.getSheet(u),wi={sheetIndex:u,model:r.model.sheets},r._trigger("_createPivotTable",wi))return;n("#"+r._id+"_Ribbon_PvtRange").val("");n("#"+r._id+"_Ribbon_PvtLocation").val("");e._selectedCells.length>1?(f=e.selectedRange,n("#"+r._id+"_Ribbon_PvtRange").val(e.sheetInfo.text+"!$"+r._generateHeaderText(f[1]+1)+"$"+(f[0]+1)+":$"+r._generateHeaderText(f[3]+1)+"$"+(f[2]+1))):r.isUndefined(r.XLEdit.getPropertyValueByElem(r.getActiveCellElem()))||(r.selectAll(!1),n("#"+r._id+"_Ribbon_PvtRange").val(e.sheetInfo.text+"!$"+r._generateHeaderText(e._startCell.colIndex+1)+"$"+(e._startCell.rowIndex+1)+":$"+r._generateHeaderText(e._endCell.colIndex+1)+"$"+(e._endCell.rowIndex+1)));d.find(".e-ss-changerange").show();d.find(".e-ss-movepvttbl").show();d.data("ejDialog").option("title",r._getLocStr("CreatePivotTable"));n("#"+r._id+"_dlg_newsheet").click();d.ejDialog("open");break;case r._id+"_Ribbon_Insert_Sparkline_Column":case r._id+"_Ribbon_Insert_Sparkline_Line":case r._id+"_Ribbon_Insert_Sparkline_Pie":case r._id+"_Ribbon_Insert_Sparkline_Area":case r._id+"_Ribbon_Insert_Sparkline_Winloss":r.XLRibbon._sparklineDesignType=this._id.split("_")[4];r._showDialog(this._id);r.XLSparkline._sparklineDlgBox();break;case r._id+"_Ribbon_Analyze_Show_FieldList":i.model.toggleState?(r.XLPivot._displayActPanel=!0,r.getActivationPanel().find("#"+r._id+"_PivotTableSchema_"+r._getContent(u).find(".e-ss-activepivot")[0].id).show(),r.showActivationPanel()):(r.hideActivationPanel(),r.XLPivot._displayActPanel=!1);break;case r._id+"_Ribbon_Analyze_Actions_ClearAll":si=r.element.find(".e-ss-activepivot")[0].id;hi=n("#"+si).data("ejPivotGrid");ci=n("#"+r._id+"_PivotTableSchema_"+si).data("ejPivotSchemaDesigner");r.XLPivot._clearFilters(hi,ci);ci.model.pivotControl=hi;break;case r._id+"_Ribbon_Analyze_Actions_MovePivotTable":d=n("#"+r._id+"_PvtDialog");f;u=r.getActiveSheetIndex();d.find(".e-ss-movepvttbl").show();d.find(".e-ss-changerange").hide();et=r.getSheet(u).pivotMngr.pivot[r.element.find(".e-ss-activepivot")[0].id];n("#"+r._id+"_Ribbon_PvtLocation").val(r.getSheet(u).sheetInfo.text+"!$"+r._generateHeaderText(et.colIndex+1)+"$"+(et.rowIndex+1));d.data("ejDialog").option("title",r._getLocStr("MovePivotTable"));n("#"+r._id+"_dlg_existsheet").click();d.ejDialog("open");break;case r._id+"_Ribbon_Analyze_DataSource_Refresh":r.XLPivot.refreshDataSource();break;case r._id+"_Ribbon_Analyze_DataSource_ChangeDataSource":d=n("#"+r._id+"_PvtDialog");d.find(".e-ss-changerange").show();d.find(".e-ss-movepvttbl").hide();et=r.getSheet(u).pivotMngr.pivot[r.element.find(".e-ss-activepivot")[0].id];f=et.dataRange;n("#"+r._id+"_Ribbon_PvtRange").val(et.dataSheetName+"!$"+r._generateHeaderText(f[1]+1)+"$"+(f[0]+1)+":$"+r._generateHeaderText(f[3]+1)+"$"+(f[2]+1));d.data("ejDialog").option("title",r._getLocStr("ChangePivotTableDataSource"));d.ejDialog("open");break;case r._id+"_Ribbon_ChartDesign_Type_ChangeChartType":r._showDialog(this._id);r.XLRibbon._refreshChartTypeDlg();break;case r._id+"_Ribbon_Insert_Illustrations_Pictures":if(r.model.importSettings.importMapper.length<1){r._showAlertDlg("Alert","ImportExportUrl","",266);return}r._uploadImage=!0;n("#"+r._id+"_file .e-uploadinput").click();r.XLRibbon._toggleFormatTab();break;case r._id+"_Ribbon_Others_Formulas_NameManager":r.XLRibbon._openNameManagerDlg();r.XLRibbon._isNmgrid="NameManager";break;case r._id+"_Ribbon_Others_Formulas_DefineName":r._showDialog(r._id+"_Ribbon_Others_NameManager");pt=n("#"+r._id+"_nmgrid").data("ejGrid");pt.getContentTable().find("td").addClass("e-ss-emptyrecord");pt.model.dataSource.length<1?pt.getContentTable().find("td").addClass("e-ss-emptyrecord"):pt.getContentTable().find(".e-ss-emptyrecord").removeClass("e-ss-emptyrecord");r.XLRibbon._refreshNMDlg();r.XLRibbon._isNmgrid="DefineName";break;case r._id+"_Ribbon_Others_Window_FreezePanes":switch(i.ID){case"freezePanes":r.XLFreeze.freezePanes();break;case"FreezeTopRow":r.XLFreeze.freezeTopRow();break;case"FreezeFirstColumn":r.XLFreeze.freezeLeftColumn();break;case"UnFreezePanes":r.XLFreeze.unfreezePanes()}break;case r._id+"_Ribbon_Home_Alignment_Merge":t.isNullOrUndefined(i.ID)&&(r.mergeCenter=!0,r.mergeCells());switch(i.ID){case"MergeCells":r.mergeCells();break;case"MergeAcross":r.mergeAcrossCells();break;case"MergeAndCenter":r.mergeCenter=!0;r.mergeCells();break;case"UnmergeCells":r.unmergeCells(e.selectedRange)}break;case r._id+"_Ribbon_Home_Editing_AutoSum":it=e.selectedRange;i.type==="click"?r.XLRibbon.autoSum("SUM",r._getAlphaRange(u,it[0],it[1],it[2],it[3])):r.XLRibbon.autoSum(i.ID.toUpperCase(),r._getAlphaRange(u,it[0],it[1],it[2],it[3]));break;case r._id+"_Ribbon_ChartDesign_ChartLayouts_AddChartElement":r.XLChart.updateChartElement(null,i.ID);break;case r._id+"_Ribbon_ChartDesign_Size_ChartWidth":r.XLRibbon._changeChartSize("height",i.value);break;case r._id+"_Ribbon_ChartDesign_Size_ChartHeight":r.XLRibbon._changeChartSize("width",i.value);break;case r._id+"_Ribbon_ChartDesign_Data_SwitchRowColumn":r.XLChart.switchRowColumn();break;case r._id+"_Ribbon_SparklineDesign_Line":case r._id+"_Ribbon_SparklineDesign_Column":case r._id+"_Ribbon_SparklineDesign_Pie":case r._id+"_Ribbon_SparklineDesign_Area":case r._id+"_Ribbon_SparklineDesign_Winloss":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");this.sparklineDesignType=this._id.split("_")[3];r.XLSparkline.changeType(s[0],this.sparklineDesignType);break;case r._id+"_Ribbon_SparklineDesign_Sparkline_EditData":r._showDialog(this._id);switch(i.ID){case"EditGroupLocation":r.XLRibbon._isEditGroupLocationClick=!0;r.XLRibbon._isEditGroupLocationClick&&r.XLSparkline._sparklineDlgBox();break;case"EditSingleSparklineData":r._showDialog(this._id);r.XLSparkline._sparklinDesignDlg();r.XLRibbon._isEditSingleSparklineClick=!0}break;case r._id+"_Ribbon_SparklineDesign_Show_HighPoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");r.XLSparkline.changePointColor(s[0],{highPointColor:"red"},u,i.isChecked);break;case r._id+"_Ribbon_SparklineDesign_Show_NegativePoints":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");r.XLSparkline.changePointColor(s[0],{negativePointColor:"orange"},u,i.isChecked);break;case r._id+"_Ribbon_SparklineDesign_Show_LowPoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");r.XLSparkline.changePointColor(s[0],{lowPointColor:"orange"},u,i.isChecked);break;case r._id+"_Ribbon_SparklineDesign_Show_FirstPoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");r.XLSparkline.changePointColor(s[0],{startPointColor:"green"},u,i.isChecked);break;case r._id+"_Ribbon_SparklineDesign_Show_LastPoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");r.XLSparkline.changePointColor(s[0],{endPointColor:"violet"},u,i.isChecked);break;case r._id+"_Ribbon_SparklineDesign_Show_Markers":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");r.XLSparkline.changePointColor(s[0],{markerSettings:{visible:!0}},u,i.isChecked);break;case r._id+"_Ribbon_SparklineColor":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");b;b=i.value;r.XLSparkline.changePointColor(s[0],{fill:b},u,i.isInteraction);break;case r._id+"_Ribbon_MarkerNegativePoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");b;b=i.value;r.XLSparkline.changePointColor(s[0],{negativePointColor:b},u,i.isInteraction);break;case r._id+"_Ribbon_MarkerHighPoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");b;b=i.value;r.XLSparkline.changePointColor(s[0],{highPointColor:b},u,i.isInteraction);break;case r._id+"_Ribbon_MarkerLowPoint":s=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline");b;b=i.value;r.XLSparkline.changePointColor(s[0],{lowPointColor:b},u,i.isInteraction);break;case r._id+"_Ribbon_PictureColor":case r._id+"_Ribbon_Format_Border_PictureBorder":if(["weight","dashes",r._id+"picturecolor",""].indexOf(i.ID)===-1&&(vt=r.getSheetElement(u).find(".e-ss-activeimg"),li=new RegExp("\\be-shapebdr.*?\\b","g"),o=vt[0].className.match(li)?r.XLShape._getImgStyleFromHashCode(vt[0].className.match(li)[0]):{"border-color":"transparent","border-width":"1px","border-style":"solid"},b=o["border-color"],ai=o["border-width"],o=o["border-style"],vt[0])){switch(!0){case this._id.indexOf("PictureColor")>-1:b=i.value;break;case i.ID.indexOf("px")>-1:ai=i.ID;break;case i.ID==="nooutline":b="transparent";break;default:o=i.ID}r.XLShape.changePictureBorder(vt[0].id,ai,o,b)}break;case r._id+"_Ribbon_Format_Adjust_ResetPicture":r.XLShape.resetPicture(null,i.ID);break;case r._id+"_Ribbon_Format_Adjust_ChangePicture":r._uploadImage=!0;r.XLShape._changePicture=!0;r.element.find("#"+r._id+"_file .e-uploadinput").click();r.XLRibbon._toggleFormatTab();break;case r._id+"_Ribbon_ChartDesign_Data_SelectData":r._showDialog(this._id);yi=document.getElementById(r._id+"_chart").value;p=r.XLChart._getShapeObj(yi,"chart");p.isChartSeries||(n("#"+r._id+"_crxaxis").val(p.xRange?r._getAlphaRange(u,p.xRange[0],p.xRange[1],p.xRange[2],p.xRange[3]):""),n("#"+r._id+"_cryaxis").val(p.yRange?r._getAlphaRange(u,p.yRange[0],p.yRange[1],p.yRange[2],p.yRange[3]):""),n("#"+r._id+"_crlaxis").val(p.lRange?r._getAlphaRange(u,p.lRange[0],p.lRange[1],p.lRange[2],p.lRange[3]):""),r._selectDataval={xRange:n("#"+r._id+"_crxaxis").val(),yRange:n("#"+r._id+"_cryaxis").val(),lRange:n("#"+r._id+"_crlaxis").val()},n("#"+r._id+"_chartrangedlg").ejDialog("open"),n("#"+r._id+"_crxaxis").focus().setInputPos(0));break;case r._id+"_Ribbon_ChartDesign_ChartThemes_ChartThemes":r.XLChart.changeTheme(r.element.find("#"+r._id+"_chart").val(),this._selectedValue);break;case r._id+"_Ribbon_Review_Changes_LockCell":r.lockCells(null,i.model.toggleState);break;case r._id+"_Ribbon_Review_Changes_ProtectSheet":r.protectSheet(i.model.toggleState);break;case r._id+"_Ribbon_Review_Changes_ProtectWorkbook":r._showDialog(this._id);vi=n("#"+r._id+"_PasswordDialog").data("ejDialog");r.model.exportSettings.password||(vi.option("title",r._getLocStr("ProtectWorkbook")),n("#"+r._id+"_confirm").show());vi.open()}(this._id.indexOf("Comment")<0&&this._id.indexOf("FindSelect")<0||r.XLSearch._isApplied)&&(r._setSheetFocus(),r.XLSearch._isApplied=!1);r._isRibbonClick=!1}},_applyTextIndent:function(n,i,r,u){var f=this.XLObj,h=f.getActiveSheetIndex(),y={},e=t.Spreadsheet.SupportedStyles,p,w,b,c,l,o,s,a=f.getCell(n.rowIndex,n.colIndex),v=f.getSheet(h);if(l=f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"value2"),o=f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"value"),!(u._id.indexOf("DecreaseIndent")<0)||!f._hasClass(a[0],"e-sswraptext")||!(Math.round(4/3*r)+f._detailsFromGlobalSpan(n.rowIndex,n.colIndex,"width","W")>v.columnsWidthCollection[n.colIndex])){if(f.isFormula(o)&&(o=l),!i[e.TextIndent]&&u._id===f._id+"_Ribbon_Home_Alignment_DecreaseIndent"||r<0)return!1;i[e.TextIndent]=r+"pt";(i[e.TextAlign]==="center"||f.isNumber(o)&&!i[e.TextAlign])&&(i[e.TextAlign]="left");y.style=i;f.XLFormat.format(y,[n.rowIndex,n.colIndex,n.rowIndex,n.colIndex]);!i[e.TextIndent]||f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"merge")||f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"mergeIdx")||(s=a.outerHeight(),s>=f.model.rowHeight&&(a.parent().outerHeight(s),v.rowsHeightCollection[n.rowIndex]=s,f._updateFormatColl(h,n.rowIndex,n.colIndex,s),f._setRowHdrHeight(h,n.rowIndex)),p=f._detailsFromGlobalSpan(n.rowIndex,n.colIndex,"width",l,null,!0),b=4/3*r,w=Math.round(b+p),c=v.columnsWidthCollection[n.colIndex],f.XLResize&&f.isNumber(o)&&u._id===f._id+"_Ribbon_Home_Alignment_IncreaseIndent"&&w>=c&&f.XLResize.setColWidth(n.colIndex,8+c))}},_changeChartSize:function(t,i){if(!this._ctrlCreated){var r=this.XLObj,f,e=document.getElementById(r._id+"_chart").value,u=n("#"+e).ejChart("instance"),s=n("#"+e),h=r.XLChart._getShapeObj(e,"chart"),o={sheetIndex:r.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:t,cid:e,rowIndex:r.XLShape._picCellIdx.rowIndex,colIndex:r.XLShape._picCellIdx.colIndex,prev:{width:u.model.size.width,height:u.model.size.height}};r.model.allowFormulaBar&&(f=r.element.find(".e-formulabar")[0]);f&&(f.style.display="none");t==="height"?(u.option("size",{width:i.toString()}),h.width=i,s[0].style.width=i+"px",o.cur={width:i.toString(),height:u.model.size.height}):(u.option("size",{height:i.toString()}),h.height=i,s[0].style.height=i+"px",o.cur={width:u.model.size.width,height:i.toString()});f&&(f.style.display="block");r._completeAction(o);r._trigActionComplete(o);r.XLShape._shapeType="chart";r.XLShape._updateShapeObj(s[0]);r.XLShape._shapeType="img"}},_updateBordeStyle:function(n){var t=this.XLObj;t._borderStyle=n.ID&&n.ID.length>0&&n.ID},_colorPickerHandler:function(t,i){var u,r=this.XLObj,f;i.type==="open"?(n("#"+r._id+"_"+t+"_popup").find(".e-buttons, .e-button").hide(),n("#"+r._id+"_"+t+"_popup").focus()):i.type==="change"&&(u=r.XLFormat,f=n("#"+r._id+"_"+t).data("ejColorPicker"),t==="Ribbon_Home_Font_FontColor"?(u.format({style:{color:i.value}}),n("#"+r._id+"_Ribbon_home_Font_Color").find(".e-selected-color").css("background-color",i.value)):(u.format({style:{"background-color":i.value}}),n("#"+r._id+"_Ribbon_home_Font_Background").find(".e-selected-color").css("background-color",i.value)),f.hide(),r._dupDetails=!0,f.setValue(i.value),r._dupDetails=!1)},updateRibbonIcons:function(){this._updateRibbonIcons()},_updateRibbonIcons:function(){var r,a,k,i=this.XLObj,d=i.getActiveSheetIndex(),e=i.getSheet(d),b;if(this.XLObj.model.showRibbon&&(!e._isImported||e._isLoaded)){var y,p,g,w,v,u,o,s=n("#"+i._id+"_Ribbon_Home_Number_NumberFormat").data("ejDropDownList"),h,c=n("#"+i._id+"_Ribbon_Home_Font_FontSize").data("ejDropDownList"),nt=!1;n("#"+i._id+"_Ribbon_Home_Font_FontSize").css("width","auto");var l=n("#"+i._id+"_Ribbon_Home_Font_FontFamily").data("ejDropDownList"),f=-1,tt=n("#"+i._id+"_Ribbon").data("ejRibbon"),it=tt.getTabText(tt.model.selectedItemIndex);switch(it){case i._getLocStr("HOME"):if(o=e._activeCell,w=i.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"wrap"),g=i.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"merge"),k=i.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"format"),v=i.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"type"),t.isNullOrUndefined(i.XLFormat)||(u=i.XLFormat.getFormatFromHashCode(k)),i.isUndefined(w)&&(w=!1),n("#"+i._id+"_Ribbon_Home_Alignment_WrapText").ejToggleButton("option",{toggleState:w}),i.isUndefined(g)?(n("#"+i._id+"_Ribbon_Home_Alignment_Merge").removeClass("e-ss-active"),n("#"+i._id+"_Ribbon_Home_Alignment_Mergedrpbtn").removeClass("e-ss-active")):(n("#"+i._id+"_Ribbon_Home_Alignment_Merge").addClass("e-ss-active"),n("#"+i._id+"_Ribbon_Home_Alignment_Mergedrpbtn").addClass("e-ss-active")),["date"].indexOf(v)>-1&&(v="custom"),v)for(f=-1,r=0,a=this._numberFormat.length;r<a;r++)if(v===this._numberFormat[r].value.toLowerCase()){f=r;break}if(t.isNullOrUndefined(s)||(s._initValue=!0,f>-1?s.option({selectedItemIndex:f}):!t.isNullOrUndefined(s.selectedIndexValue)&&s.selectedIndexValue!=0&&s.option({selectedItemIndex:0}),s._initValue=!1),u){if(f=-1,!t.isNullOrUndefined(u["font-size"]))for(r=0,a=this._fontSize.length;r<a;r++)if(u["font-size"]===this._fontSize[r].value){f=r;break}if(!t.isNullOrUndefined(c)&&(c._initValue=!0,f>-1?c.option({selectedItemIndex:f})||(f=-1):!t.isNullOrUndefined(c.selectedIndexValue)&&c.selectedIndexValue!=3&&c.option({selectedItemIndex:3}),c._initValue=!1,f=-1,!t.isNullOrUndefined(u["font-family"])))for(r=0,a=this._fontFamily.length;r<a;r++)if(u["font-family"]===this._fontFamily[r].text.toLowerCase()){f=r;break}t.isNullOrUndefined(l)||(l._initValue=!0,f>-1?l.option({selectedItemIndex:f}):!t.isNullOrUndefined(l.selectedIndexValue)&&l.selectedIndexValue!=6&&l.option({selectedItemIndex:6}),l._initValue=!1);n("#"+i._id+"_Ribbon_Home_Font_Bold").length&&(u["font-weight"]=="bold"?n("#"+i._id+"_Ribbon_Home_Font_Bold").data("ejToggleButton").option("toggleState",!0):n("#"+i._id+"_Ribbon_Home_Font_Bold").data("ejToggleButton").option("toggleState",!1));n("#"+i._id+"_Ribbon_Home_Font_Italic").length&&(u["font-style"]=="italic"?n("#"+i._id+"_Ribbon_Home_Font_Italic").data("ejToggleButton").option("toggleState",!0):n("#"+i._id+"_Ribbon_Home_Font_Italic").data("ejToggleButton").option("toggleState",!1));u["text-decoration"]=u["text-decoration"]||"";n("#"+i._id+"_Ribbon_Home_Font_Underline").length&&n("#"+i._id+"_Ribbon_Home_Font_Underline").data("ejToggleButton").option("toggleState",u["text-decoration"].indexOf("underline")!==-1);n("#"+i._id+"_Ribbon_Home_Font_StrikeThrough").length&&n("#"+i._id+"_Ribbon_Home_Font_StrikeThrough").data("ejToggleButton").option("toggleState",u["text-decoration"].indexOf("line-through")!==-1);this._tglAlignBtn(n(i.element).find(".e-text-align"),u,"text-align");nt=this._tglAlignBtn(n(i.element).find(".e-vertical-align"),u,"vertical-align").isVertical;nt||(h=i.element.find("#"+i._id+"_Ribbon_Home_Alignment_BottomAlign"),h.length&&(h.data("ejToggleButton").option("toggleState",!0),h.addClass("e-vertical-align")));i.getSheetElement(d).find(".e-ss-activeimg").length>0&&(h=i.element.find("#"+i._id+"_Ribbon_Home_Alignment_Merge"),h.length&&h.data("ejSplitButton").option("enabled",!1))}break;case i._getLocStr("REVIEW"):b=n("#"+i._id+"_Ribbon_Review_Changes_LockCell");!i.model.allowLockCell||i.XLComment&&i.XLComment._isCommentEdit||i.XLEdit._isEdit||i._isSheetRename||!b.length||(p=b.data("ejToggleButton"),y=i.XLEdit.getPropertyValue(e._activeCell.rowIndex,e._activeCell.colIndex,"isLocked"),i.isUndefined(y)&&(y=!1),p.option("toggleState",y),n("#"+i._id+"_Ribbon_Review_Changes_ProtectSheet").length&&n("#"+i._id+"_Ribbon_Review_Changes_ProtectSheet").data("ejToggleButton").option("toggleState",e.isSheetProtected),e.isSheetProtected?p.disable():p.enable());e.isSheetProtected&&i.model.allowLockCell||!i.model.allowComments||i.XLComment._isCommentEdit||i.XLEdit._isEdit||i._isSheetRename||i.XLComment._updateCmntRibIcons(i.getActiveCell())}!i.model.allowLockCell||e.isSheetProtected||!i.model.allowComments||i.XLComment._isCommentEdit||i._isSheetRename||this._refreshRibbonIcons(it);i.model.isReadOnly&&i._readOnly()}},_tglAlignBtn:function(n,i,r){var e=!1,u,f=this.XLObj;return t.isNullOrUndefined(n[0])||(u=f.element.find("#"+n[0].id),u.length&&u.data("ejToggleButton").option("toggleState",!1),n.removeClass("e-"+r)),t.isNullOrUndefined(i[r])||(u=r==="vertical-align"?f.element.find("#"+f._id+"_Ribbon_Home_Alignment_"+i[r].charAt(0).toUpperCase()+i[r].slice(1)+"Align"):f.element.find("#"+f._id+"_Ribbon_Home_Alignment_Align"+i[r].charAt(0).toUpperCase()+i[r].slice(1)),u.length&&(u.data("ejToggleButton").option("toggleState",!0),u.addClass("e-"+r)),r==="vertical-align"&&(e=!0)),{isVertical:e}},_disableButtons:function(n,i){for(var e=-1,f,r=this.XLObj,u=0,o=n.length;u<o;u++)r.model.allowLockCell&&(r.XLEdit._isEdit||r._isSheetRename||!r.getSheet(r.getActiveSheetIndex()).isSheetProtected||(e=this._protectStateBtnIds.indexOf(n[u]))),e===-1&&(f=r.element.find("#"+r._id+"_Ribbon_"+n[u]),f.length&&!t.isNullOrUndefined(f.data(i))&&f.data(i).disable())},_enableButtons:function(n,i){for(var e=0,f,r=this.XLObj,u=0,o=n.length;u<o;u++)r.model.allowLockCell&&!r._isSheetRename&&r.getSheet(r.getActiveSheetIndex()).isSheetProtected&&(e=this._protectStateBtnIds.indexOf(n[u])),e>-1&&(f=r.element.find("#"+r._id+"_Ribbon_"+n[u]),f.length&&!t.isNullOrUndefined(f.data(i))&&f.data(i).enable())},_disableInputs:function(t,i){for(var r=0,u=t.length;r<u;r++)n("#"+this.XLObj._id+"_"+t[r]).attr("disabled",i)},_enableRibbonIcons:function(t){if(this.XLObj.model.showRibbon){var c,i=this.XLObj,r=n("#"+i._id+"_Ribbon").data("ejRibbon"),l=i.getActiveSheetIndex(),f=i.getSheet(l)._filterColl,h,u,e,o,s;c=t?t:r.model.selectedItemIndex;switch(r.getTabText(c)){case i._getLocStr("HOME"):this._enableButtons(this._homeBtnIds,"ejButton");this._enableButtons(this._homeSptBtnIds,"ejSplitButton");this._enableButtons(this._homeToggleBtnIds,"ejToggleButton");this._enableButtons(this._homeDdIds,"ejDropDownList");this._enableButtons(this._homeCpIds,"ejColorPicker");i._removeClass(r.element.find("#"+r._id+"_Number_e-groupexpander")[0],"e-disable");break;case i._getLocStr("INSERT"):this._enableButtons(this._insertBtnIds,"ejButton");this._enableButtons(this._insertSptBtnIds,"ejSplitButton");break;case i._getLocStr("DATATAB"):this._enableButtons(this._dataBtnIds,"ejButton");this._enableButtons(this._dataSptBtnIds,"ejSplitButton");break;case i._getLocStr("PAGELAYOUT"):this._enableButtons(this._pageLayBtnIds,"ejButton");this._enableButtons(this._pageLaySptBtnIds,"ejSplitButton");this._enableButtons(this._pageLayChckBxIds,"ejCheckBox");n("#"+r._id+"_pagesetup_viewhdrlbl").eq(0).removeClass("e-disable");n("#"+r._id+"_pagesetup_viewgrdlnlbl").eq(0).removeClass("e-disable");break;case i._getLocStr("REVIEW"):i.model.allowComments&&!i.XLComment._isCommentEdit&&i.XLComment._updateCmntRibIcons();this._enableButtons(this._reviewTglBtnIds,"ejToggleButton");break;case i._getLocStr("OTHERS"):this._enableButtons(this._othersBtnIds,"ejButton");this._enableButtons(this._othersSptBtnIds,"ejSplitButton");break;case i._getLocStr("Design"):this._enableButtons(this._contextualBtnIds,"ejButton");this._enableButtons(this._contextualCheckBoxIds,"ejCheckBox");this._disableInputs(this._contextualInputIds,!1)}for(i.XLClipboard._copyBackup.cells||i.XLClipboard._copyBackup.elem||i.XLRibbon._disableButtons(["Home_Clipboard_Paste"],"ejButton")||i.XLRibbon._disableButtons(["Home_Clipboard_PasteOptions"],"ejSplitButton"),n.isEmptyObject(f)&&this._disableButtons(["Data_SortFilter_ClearFilter"],"ejButton"),s=i.getObjectKeys(f),u=0,o=s.length;u<o;u++)for(h=i.getObjectKeys(f[s[u]]),e=0,o=h.length;e<o;e++)f[s[u]][h[e]].status.indexOf("e-ssfiltered")<0&&this._disableButtons(["Data_SortFilter_ClearFilter"],"ejButton");i._updateUndoRedoIcons()}},_disableRibbonIcons:function(){var t=this.XLObj,i;if(t.model.showRibbon){i=n("#"+t._id+"_Ribbon").data("ejRibbon");switch(i.getTabText(i.model.selectedItemIndex)){case t._getLocStr("HOME"):this._disableButtons(this._homeBtnIds,"ejButton");this._disableButtons(this._homeSptBtnIds,"ejSplitButton");this._disableButtons(this._homeToggleBtnIds,"ejToggleButton");this._disableButtons(this._homeDdIds,"ejDropDownList");this._disableButtons(this._homeCpIds,"ejColorPicker");t.addClass(i.element.find("#"+i._id+"_Number_e-groupexpander"),"e-disable");break;case t._getLocStr("INSERT"):this._disableButtons(this._insertBtnIds,"ejButton");this._disableButtons(this._insertSptBtnIds,"ejSplitButton");break;case t._getLocStr("DATATAB"):this._disableButtons(this._dataBtnIds,"ejButton");this._disableButtons(this._dataSptBtnIds,"ejSplitButton");break;case t._getLocStr("PAGELAYOUT"):this._disableButtons(this._pageLayBtnIds,"ejButton");this._disableButtons(this._pageLaySptBtnIds,"ejSplitButton");this._disableButtons(this._pageLayChckBxIds,"ejCheckBox");n("#"+i._id+"_pagesetup_viewhdrlbl:eq(0)").addClass("e-disable");n("#"+i._id+"_pagesetup_viewgrdlnlbl:eq(0)").addClass("e-disable");break;case t._getLocStr("REVIEW"):this._disableButtons(this._cmntBtnIds,"ejButton");this._disableButtons(this._cmntTglBtnIds,"ejToggleButton");this._disableButtons(this._reviewTglBtnIds,"ejToggleButton");break;case t._getLocStr("OTHERS"):this._disableButtons(this._othersBtnIds,"ejButton");this._disableButtons(this._othersSptBtnIds,"ejSplitButton");break;case this.XLObj._getLocStr("Design"):this._disableButtons(this._contextualBtnIds,"ejButton");this._disableButtons(this._contextualCheckBoxIds,"ejCheckBox");this._disableInputs(this._contextualInputIds,!0)}}},_capitalize:function(n){return n[0].toUpperCase()+n.slice(1)},_generateToggleBtn:function(n,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=s instanceof Array?this.XLObj._getLocStr(s[0])+"<br /><br />"+this.XLObj._getLocStr(s[1]):this.XLObj._getLocStr(s);return{id:n,toolTip:this.XLObj._getLocStr(i),type:t.Ribbon.type.toggleButton,enableSeparator:h,toggleButtonSettings:{width:e,height:o,contentType:r,cssClass:c,toggleState:y,defaultPrefixIcon:u,activePrefixIcon:v?v:u,defaultText:this.XLObj._getLocStr(i),activeText:a?this.XLObj._getLocStr(a):this.XLObj._getLocStr(i),imagePosition:l=="imagetop"?t.ImagePosition.ImageTop:t.ImagePosition.ImageLeft,click:this._ribbonClickHandler},customToolTip:{title:p?this.XLObj._getLocStr(f)+p:this.XLObj._getLocStr(f),content:"<h6>"+w+"<\/h6>"}}},_generateBtn:function(n,i,r,u,f,e,o,s,h,c,l,a){var v=s instanceof Array?this.XLObj._getLocStr(s[0])+"<br /><br />"+this.XLObj._getLocStr(s[1]):this.XLObj._getLocStr(s);return{id:n,text:this.XLObj._getLocStr(i),toolTip:this.XLObj._getLocStr(i),cssClass:l,enableSeparator:h,buttonSettings:{type:t.Ribbon.type.button,contentType:r,width:f,height:e,imagePosition:c=="imagetop"?t.ImagePosition.ImageTop:t.ImagePosition.ImageLeft,prefixIcon:u,click:this._ribbonClickHandler},customToolTip:{title:a?this.XLObj._getLocStr(o)+a:this.XLObj._getLocStr(o),content:"<h6>"+v+"<\/h6>"}}},_generateDD:function(n,i,r,u,f,e,o,s){return{id:n,text:this.XLObj._getLocStr(i),toolTip:this.XLObj._getLocStr(i),type:t.Ribbon.type.dropDownList,dropdownSettings:{dataSource:r,value:u,change:this._ribbonClickHandler,width:f,height:e-1,cssClass:"e-"+this.XLObj._id+"-ddl"},customToolTip:{title:this.XLObj._getLocStr(o),content:"<h6>"+this.XLObj._getLocStr(s)+"<\/h6>"}}},_generateCustomControl:function(n,i,r,u){return{type:t.Ribbon.type.custom,contentID:n,toolTip:this.XLObj._getLocStr(i),click:this._ribbonClickHandler,change:this._ribbonClickHandler,customToolTip:{title:this.XLObj._getLocStr(r),content:"<h6>"+this.XLObj._getLocStr(u)+"<\/h6>"}}},_generateSplitBtn:function(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var k=w instanceof Array?this.XLObj._getLocStr(w[0])+"<br /><br />"+this.XLObj._getLocStr(w[1]):this.XLObj._getLocStr(w);return{id:i,toolTip:this.XLObj._getLocStr(r),text:this.XLObj._getLocStr(r),type:t.Ribbon.type.splitButton,cssClass:y+" e-"+this.XLObj._id+"-spltbtn",enableSeparator:s,splitButtonSettings:{contentType:u,targetID:f,arrowPosition:l=="bottom"?t.ArrowPosition.Bottom:t.ArrowPosition.Right,imagePosition:a=="imagetop"?t.ImagePosition.ImageTop:t.ImagePosition.ImageLeft,buttonMode:v=="dropdown"?t.ButtonMode.Dropdown:t.ButtonMode.Split,fields:e,prefixIcon:o,click:this._ribbonClickHandler,itemSelected:this._ribbonClickHandler,height:c,width:h,beforeOpen:n.proxy(this._splitBeforeOpen,this,i),itemMouseOver:n.proxy(this._splitItemMouseOver,this),close:i==="Home_Font_Border"||"Others_Cells_InsertCellOptions"||i==="Others_Cells_DeleteCellOptions"||i==="Data_DataTools_DataValidationOptions"||i==="Home_Clipboard_PasteOptions"?n.proxy(this._splitbtnClose,this,i):null},customToolTip:{title:b?this.XLObj._getLocStr(p)+b:this.XLObj._getLocStr(p),content:"<h6>"+k+"<\/h6>"}}},_splitItemMouseOver:function(i){var r=this.XLObj,v,f="",h=["b","g","r","o","lb","p"],e=n(i.element),s,y,ft=["Blue","Green","Red","Orange","Light blue","Purple"],o=i.element.childNodes[1],u,it,rt,ut;if(i.ID.indexOf("_DataBars")>-1&&!e.find(".e-ss-databars-div").length){o.childNodes.length&&o.removeChild(o.childNodes[0]);e.children().find(".e-ss-databars-div").remove();var v=t.buildTag("div#"+r._id+"_databars_1.e-ss-databars-div"),p=t.buildTag("div#"+r._id+"_databars_2"),w=t.buildTag("div#"+r._id+"_databars_3");for(u=0;u<h.length;u++)f+=String.format('<span id="{0}" class="e-ss-{0} e-ss-databar-span" title= "{1}"><\/span>',h[u]+"databar",ft[u]+" Data Bar"),u==h.length/2-1&&(n(p).append(f),f=""),u==h.length-1&&(n(w).append(f),f="");n(v).append(p).append(w);e.children("ul").append(n(v));n._data(n("#"+r._id+"_databars_1")[0],"events")||r._on(n("#"+r._id+"_databars_1"),"click",r._databarItemClick)}else if(i.ID.indexOf("_ColorScales")>-1&&!e.find(".e-ss-colorscales-div").length){s=["gyr","ryg","gwr","rwg","bwr","rwb","wr","rw","gw","wg","gy","yg"];y=["Green - Yellow -Red","Red - Yellow - Green","Green - White - Red","Red - White - Green","Blue - White - Red","Red - White - Blue","White - Red","Red - White","Green - White","White - Green","Green - Yellow","Yellow - Green"];o.childNodes.length&&o.removeChild(o.childNodes[0]);e.children().find(".e-ss-colorscales-div").remove();var b=t.buildTag("div#"+r._id+"_colorscales_1.e-ss-colorscales-div"),k=t.buildTag("div#"+r._id+"_colorscales_2"),d=t.buildTag("div#"+r._id+"_colorscales_3"),g=t.buildTag("div#"+r._id+"_colorscales_4");for(u=0;u<s.length;u++)f+=String.format('<span id="{0}" class="e-ss-{0} e-ss-colorscale-span" title= "{1}"><\/span>',s[u]+"colorscale",y[u]+" Color Scale"),u==s.length/3-1&&(n(k).append(f),f=""),u==s.length/2+1&&(n(d).append(f),f=""),u==s.length-1&&(n(g).append(f),f="");n(b).append(k).append(d).append(g);e.children("ul").append(n(b));n._data(n("#"+r._id+"_colorscales_1")[0],"events")||r._on(n("#"+r._id+"_colorscales_1"),"click",r._databarItemClick)}else if(i.ID.indexOf("_IconSets")>-1&&!e.find(".e-ss-iconsets-div").length){f="";o.childNodes.length&&o.removeChild(o.childNodes[0]);e.children().find(".e-ss-iconsets-div").remove();var nt=t.buildTag("div#"+r._id+"_iconsets_1.e-ss-iconsets-div"),c=t.buildTag("div#"+r._id+"_iconsets_2"),l=t.buildTag("div#"+r._id+"_iconsets_3"),a=t.buildTag("div#"+r._id+"_iconsets_4"),tt=t.buildTag("div#"+r._id+"_iconsets_5"),et='<div class="e-ss-iconset-title"> <span>'+r._getLocStr("Directional")+"<\/span><\/div>";c.append('<div id="threecolorarrows" class= "e-ss-iconsets-wrapper" title= "3 Arrows (Colored)"><span class="e-ss-greenarrow e-ss-iconset-span"><\/span><span class="e-ss-yellowarrow e-ss-iconset-span"><\/span><span class="e-ss-redarrow e-ss-iconset-span"><\/span><\/div>');c.append('<div id="threegreyarrows" class= "e-ss-iconsets-wrapper" title= "3 Arrows (Gray)"><span class="e-ss-uparrow e-ss-iconset-span"><\/span><span class="e-ss-midarrow e-ss-iconset-span"><\/span><span class="e-ss-downarrow e-ss-iconset-span"><\/span><\/div>');c.append('<div id="threetriangles" class= "e-ss-iconsets-wrapper" title= "3 Triangles"><span class="e-ss-uptriangle e-ss-iconset-span"><\/span><span class="e-ss-midtriangle e-ss-iconset-span"><\/span><span class="e-ss-downtriangle e-ss-iconset-span"><\/span><\/div>');it='<div class="e-ss-iconset-title"> <span>'+r._getLocStr("Shapes")+"<\/span><\/div>";l.append('<div id="threetrafficlights" title= "3 Traffic Lights (Unrimmed)" class= "e-ss-iconsets-wrapper"><span class="e-ss-greencircle e-ss-iconset-span"><\/span><span class="e-ss-yellowcircle e-ss-iconset-span"><\/span><span class="e-ss-redcircle e-ss-iconset-span"><\/span><\/div>');l.append('<div id="threetrafficlightsrimmed" title= "3 Traffic Lights (Rimmed)" class= "e-ss-iconsets-wrapper"><span class="e-ss-rimgreencircle e-ss-iconset-span"><\/span><span class="e-ss-rimyellowcircle e-ss-iconset-span"><\/span><span class="e-ss-rimredcircle e-ss-iconset-span"><\/span><\/div>');l.append('<div id="threesigns" title= "3 Signs" class= "e-ss-iconsets-wrapper"><span class="e-ss-greencircle e-ss-iconset-span"><\/span><span class="e-ss-yellowtri e-ss-iconset-span"><\/span><span class="e-ss-redsquare e-ss-iconset-span"><\/span><\/div>');rt='<div class="e-ss-iconset-title"> <span>'+r._getLocStr("Indicators")+"<\/span><\/div>";a.append('<div id="threesymbolescircled" title= "3 Symbols (Circled)" class= "e-ss-iconsets-wrapper"><span class="e-ss-greencircleindi e-ss-iconset-span"><\/span><span class="e-ss-yellowcircleindi e-ss-iconset-span"><\/span><span class="e-ss-redcircleindi e-ss-iconset-span"><\/span><\/div>');a.append('<div id="threesymbols" title= "3 Symbols (Uncircled)" class= "e-ss-iconsets-wrapper"><span class="e-ss-tick e-ss-iconset-span"><\/span><span class="e-ss-exclam e-ss-iconset-span"><\/span><span class="e-ss-cross e-ss-iconset-span"><\/span><\/div>');a.append('<div id="threeflags" title= "3 Flags" class= "e-ss-iconsets-wrapper"><span class="e-ss-greenflag e-ss-iconset-span"><\/span><span class="e-ss-yellowflag e-ss-iconset-span"><\/span><span class="e-ss-redflag e-ss-iconset-span"><\/span><\/div>');ut='<div class="e-ss-iconset-title"> <span>'+r._getLocStr("Ratings")+"<\/span><\/div>";tt.append('<div id="threestars" title= "3 Stars" class= "e-ss-iconsets-wrapper"><span class="e-ss-fullstar e-ss-iconset-span"><\/span><span class="e-ss-halfstar e-ss-iconset-span"><\/span><span class="e-ss-drystar e-ss-iconset-span"><\/span><\/div>');nt.append(et).append(c).append(it).append(l).append(rt).append(a).append(ut).append(tt);e.children("ul").append(n(nt));n._data(n("#"+r._id+"_iconsets_2")[0],"events")||n._data(n("#"+r._id+"_iconsets_3")[0],"events")||n._data(n("#"+r._id+"_iconsets_4")[0],"events")||n._data(n("#"+r._id+"_iconsets_5")[0],"events")||(r._on(n("#"+r._id+"_iconsets_2"),"click",r._databarItemClick),r._on(n("#"+r._id+"_iconsets_3"),"click",r._databarItemClick),r._on(n("#"+r._id+"_iconsets_4"),"click",r._databarItemClick),r._on(n("#"+r._id+"_iconsets_5"),"click",r._databarItemClick))}},_splitBeforeOpen:function(i,r){var u=this.XLObj,h;if(i==="Home_Editing_SortFilter")this._sfbeforeOpen(r);else if(i==="Others_Cells_InsertCellOptions"||i==="Others_Cells_DeleteCellOptions")this._insdelbeforOpen(r);else if(i==="Others_Window_FreezePanes")this._fpbeforeOpen(r);else if(i==="ChartDesign_ChartLayouts_AddChartElement")this._celementpbeforeOpen(r);else if(i==="Data_DataTools_DataValidationOptions"||i==="Home_Clipboard_PasteOptions")this._validpasteOpen(r);else if(i==="Home_Editing_Clear")this._clearbeforeOpen(r);else if(i==="Home_Styles_FormatAsTable")h=document.getElementById(u._id+"_formatastable"),h&&(!h||h.children.length)||this._renderFormatAsTable(),u.XLFormat._resizeFormatTableMenu();else if(i==="Home_Styles_CellStyles")u.XLFormat._resizeStyleMenu();else if(i==="Home_Font_Border"){u.XLFormat._resizeBorderMenu(r);this._renderBorderCP(r);var f,v=window.innerHeight,c=n("#"+this.XLObj._id+"_Ribbon_Home_Font_Border")[0].getBoundingClientRect(),s=n("#"+this.XLObj._id+"_Ribbon_Border"),l=s.data("ejMenu"),e=s.find("#"+this.XLObj._id+"_customup")[0],o=s.find("#"+this.XLObj._id+"_customdown")[0],a=s.children(),y=a.length,p=Math.round((v-(c.top+c.height))/26);if(y*26>v-(c.top+c.height)){for(t.isNullOrUndefined(e)&&t.isNullOrUndefined(o)&&(l.insert([{id:this.XLObj._id+"_customdown",parentId:null,text:" ",spriteCssClass:"e-icon e-chevron-down"}],"#"+this.XLObj._id+"_Ribbon_Border"),l.insertBefore([{id:this.XLObj._id+"_customup",parentId:null,text:" ",spriteCssClass:"e-icon e-chevron-up"}],"#"+this.XLObj._id+"_Ribbon_Border"),e=s.find("#"+this.XLObj._id+"_customup")[0],o=s.find("#"+this.XLObj._id+"_customdown")[0],u._browserDetails.name==="msie"&&u._browserDetails.version==="8.0"?(e.attachEvent("onclick",this._menuclick,!0),o.attachEvent("onclick",this._menuclick,!0)):(e.addEventListener("click",this._menuclick,!0),o.addEventListener("click",this._menuclick,!0)),u.addClass(e.querySelector("span"),"e-customup"),u.addClass(o.querySelector("span"),"e-customup")),f=1;f<y-1;f++)u.addClass(a[f],"e-hide");for(f=0;f<p-2;f++)u._removeClass(a[f],"e-hide");l.disableItemByID(e.id);l.enableItemByID(o.id)}else t.isNullOrUndefined(e)||t.isNullOrUndefined(o)||(u.addClass(e,"e-hide"),u.addClass(o,"e-hide"))}else i==="Home_Styles_ConditionalFormatting"?(n("#"+u._id+"_CFormat").width(200),u._phoneMode?n("#"+u._id+"_CFormat").find("ul").addClass("e-adaptive"):n("#"+u._id+"_CFormat").find("ul").removeClass("e-adaptive")):i=="Others_CalCulation_CalculationOptions"&&(u._calcEngine.getCalculatingSuspended()?(n("#"+u._id+"_CalcManual").find("span").addClass("e-ss-calcauto"),n("#"+u._id+"_CalcAuto").find("span").removeClass("e-ss-calcauto")):(n("#"+u._id+"_CalcAuto").find("span").addClass("e-ss-calcauto"),n("#"+u._id+"_CalcManual").find("span").removeClass("e-ss-calcauto")))},_menuclick:function(t){if(t.stopImmediatePropagation(),t.target){var i,c=t.currentTarget,u=n("#"+c.parentElement.id),l=u.children(),f=u.data("ejMenu"),e=u.children()[0],o=u.children()[18],r=n("#"+c.parentElement.id).find("li:visible"),s=r[r.length-2],a=n(s).index(),h=r[1],v=n(h).index();if(t.currentTarget.id.indexOf("customup")>0)if(h.id!="bottom"){for(i=1;i<3;i++)r.eq(r.length-(i+1)).addClass("e-hide"),l.eq(v-i).removeClass("e-hide");n(o).hasClass("e-disable-item")&&f.enableItemByID(o.id)}else h.id=="bottom"&&f.disableItemByID(e.id);else if(s.id.indexOf("borderstyle")==-1){for(i=1;i<3;i++)r.eq(i).addClass("e-hide"),l.eq(a+i).removeClass("e-hide");n(e).hasClass("e-disable-item")&&f.enableItemByID(e.id)}else s.id.indexOf("borderstyle")>-1&&f.disableItemByID(o.id)}},_renderBorderCP:function(){var i=this.XLObj._id,t=i+"_Ribbon_Home_Font_",r=n("#"+t+"BorderColor").data("ejColorPicker");r||(n("#"+t+"BorderColor").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:this._ribbonClickHandler}),n("#"+t+"BorderColor").data("ejColorPicker").show(),n("#"+t+"BorderColorWrapper").hide(),n("#"+i+"_bordercolor ul li").find("a").remove(),n("#"+i+"_bordercolor ul li").append(n("#"+t+"BorderColor_popup")),n("#"+t+"BorderColor_popup").css({display:"block"}))},_splitbtnClose:function(t){if(t=="Home_Font_Border"){var r=n("#"+this.XLObj._id+"_Ribbon_Border"),u=r.data("ejMenu"),i=r.children(),f=r.children().length;i.removeClass("e-hide");n(i[0]).hasClass("e-disable-item")&&u.enableItemByID(i[0].id);n(i[f-1]).hasClass("e-disable-item")&&u.enableItemByID(i[f-1].id)}else this.XLObj.element.find("#"+this.XLObj._id+"_Ribbon_"+t).parents("div.e-controlpadding").siblings().children("button").removeClass("e-active")},_fpbeforeOpen:function(){var i=this.XLObj,r=n("#"+i._id+"_Ribbon_FPane").data("ejMenu"),t=r.model.fields.dataSource.slice(0);i.getSheet()._isFreezed?(t[0].id="UnFreezePanes",t[0].text=i._getLocStr("UnFreezePanes")):(t[0].id="freezePanes",t[0].text=i._getLocStr("FreezePanes"));r.option("fields",{id:"id",dataSource:t,parentId:"parentId"})},_sfbeforeOpen:function(){var i=this.XLObj,t=n("#"+i._id+"_Ribbon_SortFilter").data("ejMenu");i.model.allowFiltering||t.disableItemByID("Ribbon_Filter");i.model.allowSorting||(t.disableItemByID("Ribbon_SortAtoZ"),t.disableItemByID("Ribbon_SortZtoA"));this._refreshRibbonIcons();this._isFilterSelect.isFiltered?t.enableItemByID("Ribbon_ClearFilter"):t.disableItemByID("Ribbon_ClearFilter");this._isDirtySelect&&t.disableItemByID("Ribbon_Filter")},_validpasteOpen:function(t){var i=this.XLObj,r;t.model.targetID===i._id+"_Ribbon_Validation"?i.element.find("#"+i._id+"_Ribbon_Data_DataTools_DataValidation").addClass("e-active"):(r=n("#"+i._id+"_Ribbon_Paste").data("ejMenu"),i.element.find("#"+i._id+"_Ribbon_Home_Clipboard_Paste").addClass("e-active"),i.isPasteValuesOnly?r.disableItemByID("PasteSpecial"):r.enableItemByID("PasteSpecial"))},_insdelbeforOpen:function(t){var i=this.XLObj,r=n("#"+i._id+"_Ribbon_Ins").data("ejMenu"),u=n("#"+i._id+"_Ribbon_Del").data("ejMenu"),h=["DeleteCells","DeleteSheetRows","DeleteSheetColumns"],c=["InsertCells","InsertSheetRows","InsertSheetColumns"],e,o,s,f;if(t.model.targetID===i._id+"_Ribbon_Ins"?i.element.find("#"+i._id+"_Ribbon_Others_Cells_InsertCell").addClass("e-active"):i.element.find("#"+i._id+"_Ribbon_Others_Cells_DeleteCell").addClass("e-active"),e=i.element.find(".e-colselected").length?"disableItemByID":"enableItemByID",r&&r[e]("InsertSheetRows"),u&&u[e]("DeleteSheetRows"),o=i.element.find(".e-rowselected").length?"disableItemByID":"enableItemByID",r&&r[o]("InsertSheetColumns"),u&&u[o]("DeleteSheetColumns"),s=i.model.exportSettings.password?"disableItemByID":"enableItemByID",r&&r[s]("InsertSheet"),u&&u[s]("DeleteSheet"),i.getSheet(i.getActiveSheetIndex()).isSheetProtected)for(f=0;f<3;f++)u&&u.disableItemByID(h[f]),r&&r.disableItemByID(c[f]);else u&&u.enableItemByID("DeleteCells"),r&&r.enableItemByID("InsertCells")},_celementpbeforeOpen:function(){var u=this.XLObj,h=n("#"+u._id+"_chart").val(),f=u.XLChart._getShapeObj(h,"chart").type,r=n("#"+u._id+"_Ribbon_CElement").data("ejMenu"),e=["Axes","AxisTitle","Gridline"],o=["AxisTitle","PMinorH","PMinorV"],s=["Axes","AxisTitle","Gridline","PMinorH","PMinorV"],t,i=0;if(r)return!1;for(t=0,i=s.length;t<i;t++)r.enableItemByID(s[t]);if(f==="pie"||f==="doughnut")for(t=0,i=e.length;t<i;t++)r.disableItemByID(e[t]);else if(f==="radar")for(t=0,i=o.length;t<i;t++)r.disableItemByID(o[t])},_clearbeforeOpen:function(){var i=this.XLObj,t=0,u=n("#"+i._id+"_Ribbon_Clear").data("ejMenu"),r=["Clear_Hyperlinks","Clear_Comments"];if(i.model.allowLockCell)if(i.getSheet(i.getActiveSheetIndex()).isSheetProtected)while(t<r.length)u.disableItemByID(r[t]),t++;else while(t<r.length)u.enableItemByID(r[t]),t++},_changeClrFltrStatus:function(n,t){var i=this.XLObj;i.isUndefined(n)||(this._isFilterSelect.isFiltered?t==="menu"?n._id.indexOf("Ribbon")>-1?n.enableItemByID("Ribbon_ClearFilter"):n.enableItemByID("ClearFilter"):n.enable():t==="menu"?n._id.indexOf("Ribbon")>-1?n.disableItemByID("Ribbon_ClearFilter"):n.disableItemByID("ClearFilter"):n.disable())},_onControlCreated:function(){this._ctrlCreated=!0;this.XLObj.model.ribbonSettings.enableOnDemand||(this._homeTabControls(),this._othersTabControls(),this._pageTabControls(),this._appTabControls());this._hideTabs();this._ctrlCreated=!1},_appTabControls:function(){var r=this.XLObj,i=r._id,t={height:158,width:163,text:r._getLocStr("BlankWorkbook"),contentType:"textandimage",imagePosition:"imagetop",prefixIcon:"e-ss-blank",click:n.proxy(this._onBackStageItemClick,this)};n("#"+i+"_bstab_new_blank").ejButton(t);delete t.text;t.height=t.width=72;t.prefixIcon="e-icon e-ss-exportxl";n("#"+i+"_bstab_saveas_excel").ejButton(t);t.prefixIcon="e-icon e-ss-exportcsv";n("#"+i+"_bstab_saveas_csv").ejButton(t);t.prefixIcon="e-icon e-ss-exportpdf";n("#"+i+"_bstab_saveas_pdf").ejButton(t);t.prefixIcon="e-icon e-ss-print";n("#"+i+"_bstab_print_sheet").ejButton(t);t.prefixIcon="e-icon e-ss-printselected";n("#"+i+"_bstab_print_selected").ejButton(t)},_othersTabControls:function(){var n=this.XLObj;!n.model.allowInsert&&n.model.scrollSettings.allowScrolling&&(this._disableButtons(["Others_Cells_InsertCellOptions"],"ejSplitButton"),this._disableButtons(["Others_Cells_InsertCell"],"ejButton"));!n.model.allowDelete&&n.model.scrollSettings.allowScrolling&&(this._disableButtons(["Others_Cells_DeleteCellOptions"],"ejSplitButton"),this._disableButtons(["Others_Cells_DeleteCell"],"ejButton"))},_pageTabControls:function(){var t=this.XLObj,r=t._id,i=r+"_Ribbon_pagesetup",u=r+"_Ribbon_PageLayout_Show_";n("#"+i+"left").show();n("#"+u+"Headings").ejCheckBox({change:this._ribbonClickHandler,checked:!0});n("#"+u+"Gridlines").ejCheckBox({change:this._ribbonClickHandler,checked:!0});n("#"+i+"_viewhdrlbl").text(t._getLocStr("Heading"));n("#"+i+"_viewgrdlnlbl").text(t._getLocStr("Gridlines"))},_homeTabControls:function(){var r=this.XLObj,u=r._id,i=u+"_Ribbon_",t=i+"Home_Font_";n("#"+t+"FillColor").ejColorPicker({value:"#FFFF00",locale:r.model.locale,modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",toolIcon:"e-ss-backgroundcolor e-icon",open:n.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FillColor"),change:n.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FillColor"),select:n.proxy(this._cpClickHandler,this,"Ribbon_Home_Font_FillColor")});n("#"+t+"FontColor").ejColorPicker({value:"#FF0000",locale:r.model.locale,modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",toolIcon:"e-ss-fontcolor e-icon",open:n.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FontColor"),change:n.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FontColor"),select:n.proxy(this._cpClickHandler,this,"Ribbon_Home_Font_FontColor")});n("#"+i+"BorderCP").ejColorPicker({value:"#278787",displayInline:!0,modelType:"picker"});n("#"+i+"BorderCP_Presets").hide();n("#"+i+"Border").addClass("e-spreadsheet e-border");n("#"+t+"FontColor_Presets").css({top:"40px"});n("#"+t+"FillColor_Presets").css({top:"40px"});this._disableButtons(["Home_Clipboard_Paste"],"ejButton");this._disableButtons(["Home_Clipboard_PasteOptions","Others_Formulas_UseInFormula"],"ejSplitButton");n("#"+t+"FillColor_popup").find(".e-buttons, .e-button").hide();n("#"+t+"FontColor_popup").find(".e-buttons, .e-button").hide()},_hideRibbonElem:function(t){var e=this.XLObj,h=e._id,c=n("#"+e._id+"_Ribbon").data("ejRibbon"),i=e.model,r=c.element,u=h+"_Ribbon",p=u+"_home_Clipboard_Home_Clipboard_",o=u+"_home_Alignment_Home_Alignment_",w=u+"_separator_Home_Alignment_",v=u+"_home_Styles_Home_Styles_",k=u+"_home_Font_Home_Font_",d=u+"_home_Number_Home_Number_",b=u+"_home_Editing_Home_Editing_",s=u+"_insert_",y=u+"_data_",g=u+"_pagelayout_PageLayout",nt=u+"_review_Changes_Review_Changes_",l=u+"_others_",f,a;i.allowFormulaBar||e.hideFormulaBar();e.model.ribbonSettings.applicationTab.type==="menu"&&(f=n("#"+h+"_Menu").data("ejMenu"));switch(t){case e._getLocStr("HOME"):i.allowAutoSum||i.allowFiltering||i.allowUndoRedo||i.allowSorting||i.allowClipboard||i.allowFormatPainter||i.allowCellFormatting||i.allowMerging||i.allowWrap||i.allowConditionalFormats||i.allowFormatAsTable||c.hideTab(e._getLocStr("HOME"));i.allowFormatPainter||r.find("#"+p+"FormatPainter").hide();i.allowClipboard||(r.find("#"+u+"_home_Clipboard_1").hide(),r.find("#"+p+"Cut").hide(),r.find("#"+p+"Copy").hide());i.allowClipboard||i.allowFormatPainter||r.find("#"+u+"_home_Clipboard").hide();i.allowCellFormatting||(r.find("#"+u+"_home_Font").hide(),r.find("#"+u+"_home_Number").hide(),r.find("#"+o+"TopAlign").hide(),r.find("#"+o+"MiddleAlign").hide(),r.find("#"+o+"BottomAlign").hide(),r.find("#"+w+"BottomAlign").hide(),r.find("#"+o+"AlignLeft").hide(),r.find("#"+o+"AlignCenter").hide(),r.find("#"+o+"AlignRight").hide(),r.find("#"+w+"AlignRight").hide(),r.find("#"+o+"DecreaseIndent").hide(),r.find("#"+o+"IncreaseIndent").hide(),r.find("#"+w+"IncreaseIndent").hide(),r.find("#"+v+"CellStyles").hide(),i.allowConditionalFormats||i.allowFormatAsTable||r.find("#"+u+"_home_Styles").hide());i.allowCellFormatting&&(i.formatSettings.allowFontFamily||r.find("#"+k+"FontFamily").hide(),i.formatSettings.allowDecimalPlaces||(r.find("#"+d+"IncreaseDecimal").hide(),r.find("#"+d+"DecreaseDecimal").hide(),r.find("#"+u+"_separator_Home_Number_CommaStyle").hide()),i.formatSettings.allowCellBorder||r.find("#"+k+"Border").hide());i.allowMerging||r.find("#"+o+"Merge").hide();i.allowWrap||r.find("#"+o+"WrapText").hide();i.allowUndoRedo||r.find("#"+u+"_home_Actions").hide();i.allowFormatAsTable||r.find("#"+v+"FormatAsTable").hide();i.allowConditionalFormats||i.allowFormatAsTable||i.allowCellFormatting||r.find("#"+u+"_home_Styles").hide();i.allowConditionalFormats||r.find("#"+v+"ConditionalFormatting").hide();i.allowEditing&&(i.allowAutoSum||r.find("#"+b+"AutoSum").hide(),i.allowSorting||i.allowFiltering||r.find("#"+e._id+"_Ribbon_home_Editing_1").hide());i.allowAutoSum||r.find("#"+b+"AutoSum").hide();i.allowClear||r.find("#"+b+"Clear").hide();break;case e._getLocStr("INSERT"):i.allowFormatAsTable||i.allowPictures||i.allowHyperlink||i.allowCharts||i.allowSparkline||c.hideTab(e._getLocStr("INSERT"));i.enablePivotTable||i.allowFormatAsTable?i.enablePivotTable?i.allowFormatAsTable||r.find("#"+s+"Tables_Insert_Tables_Table").hide():r.find("#"+s+"Tables_Insert_Tables_PivotTable").hide():(r.find("#"+s+"Tables").hide(),r.find("#"+v+"FormatAsTable").hide(),r.find("#"+s+"Tables_Insert_Tables_PivotTable").hide());i.pictureSettings.allowPictures||r.find("#"+s+"Illustrations").hide();i.allowHyperlink||r.find("#"+s+"Links").hide();i.allowCharts||r.find("#"+s+"Charts").hide();i.allowSparkline||r.find("#"+s+"SparklineCharts").hide();i.allowFormatAsTable||i.enablePivotTable||r.find("#"+s+"Tables").hide();break;case e._getLocStr("DATATAB"):i.allowDataValidation||i.allowFiltering||i.allowSorting||c.hideTab(e._getLocStr("DATATAB"));i.allowFiltering||r.find("#"+y+"SortFilter_2").hide();i.allowSorting||r.find("#"+y+"SortFilter_1").hide();i.allowDataValidation||r.find("#"+y+"DataTools").hide();i.allowFiltering||i.allowSorting||r.find("#"+y+"Sort").hide();break;case e._getLocStr("PAGELAYOUT"):i.printSettings.allowPrinting||c.hideTab(e._getLocStr("PAGELAYOUT"));i.printSettings.allowPrinting||r.find("#"+g+"Print_Print").hide();i.printSettings.allowPageSize||r.find("#"+g).hide();i.allowComments||i.allowLockCell||c.hideTab(e._getLocStr("REVIEW"));i.allowLockCell||(r.find("#"+nt+"ProtectSheet").hide(),r.find("#"+nt+"LockCell").hide());i.allowComments||r.find("#"+u+"_review_Comments").hide();break;case e._getLocStr("OTHERS"):i.allowFreezing||i.allowInsert||i.allowDelete||i.allowSearching||c.hideTab(e._getLocStr("OTHERS"));i.allowInsert||i.allowDelete||r.find("#"+l+"Cells").hide();i.allowInsert||r.find("#"+l+"Cells_1").hide();i.allowDelete||r.find("#"+l+"Cells_2").hide();i.allowFreezing||(e._phoneMode?r.find("#"+l+"Window_1").hide():r.find("#"+l+"Window").hide());i.allowSearching||r.find("#"+l+"Editing").hide()}i.allowImport&&i.importSettings.importMapper||(r.find("#open_backStageTab").hide(),f&&f.disableItemByID("Open"));i.serverEvents?(a=i.serverEvents,a.indexOf("excelExporting")<0&&!i.exportSettings.excelUrl&&(r.find("#"+h+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").hide(),f&&f.disableItemByID("ExportXL")),a.indexOf("csvExporting")<0&&!i.exportSettings.csvUrl&&(r.find("#"+h+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").hide(),f&&f.disableItemByID("ExportCsv")),a.indexOf("pdfExporting")<0&&!i.exportSettings.pdfUrl&&(r.find("#"+h+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").hide(),f&&f.disableItemByID("ExportPdf")),a.length||i.exportSettings.excelUrl||i.exportSettings.csvUrl||i.exportSettings.pdfUrl||(r.find("#saveas_backStageTab").hide(),f&&f.disableItemByID("Save"))):(i.exportSettings.excelUrl||(r.find("#"+h+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").hide(),f&&f.disableItemByID("ExportXL")),i.exportSettings.csvUrl||(r.find("#"+h+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").hide(),f&&f.disableItemByID("ExportCsv")),i.exportSettings.pdfUrl||(r.find("#"+h+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").hide(),f&&f.disableItemByID("ExportPdf")),i.exportSettings.allowExporting&&(i.exportSettings.excelUrl||i.exportSettings.csvUrl||i.exportSettings.pdfUrl)||(r.find("#saveas_backStageTab").hide(),f&&f.disableItemByID("Save")));i.printSettings.allowPrinting||r.find("#print_backStageTab").hide()},_pictureSizeChange:function(t,i){var u=this.XLObj,f,o=u.getActiveSheetIndex(),r=u.getSheetElement(o).find(".e-ss-activeimg"),e={sheetIndex:o,reqType:"shape",shapeType:"picture",action:"picturesize",name:t,id:n(r).attr("id"),prev:{},cur:{}};u._shapeChange||this._isSetModel||(e.prev={width:r.width(),height:r.height()},t==="PictureHeight"?(f=parseInt(r.height()*i.value/r.width()),r.css({width:i.value,height:f}),e.cur={width:i.value,height:f}):(f=parseInt(r.width()*i.value/r.height()),r.css({height:i.value,width:f}),e.cur={height:i.value,width:f}),this._isSetModel=!0,n("#"+u._id+"_Ribbon_Format_Size_"+t).ejNumericTextbox("option",{value:f}),this._isSetModel=!1,u._completeAction(e),u._trigActionComplete(e),u.XLShape._updateShapeObj(r[0]))},_chartTypeOk:function(){var r=this.XLObj,o=r.element.find("#"+r._id+"_chart").val(),u=n("#"+o).data("ejChart"),f,t,e,s,h,i;e=n("#"+r._id+"_allchart").find(".e-chartselect:eq(0)").attr("class").split(" ")[1];t=e.split("e-dlg")[1].split("chart");s=["e-dlgcolumnchart4","e-dlgcolumnchart5","e-dlgcolumnchart6","e-dlgbarchart4","e-dlgbarchart5","e-dlgbarchart6","e-dlgpiechart2"];h=["e-dlgstockchart2","e-dlglinechart2","dlgradarchart2"];i={type:t[0],enable3D:!1,marker:{visible:!1}};(t[0]==="column"||t[0]==="bar"||t[0]==="area")&&(t[1]==="1"||t[1]==="4"?i.type=t[0]:t[1]==="2"||t[1]==="5"?i.type="stacking"+t[0]:(t[1]==="3"||t[1]==="6")&&(i.type="stacking"+t[0]+"100"));s.indexOf(e)>-1&&(i.enable3D=!0);h.indexOf(e)>-1&&(i.marker={visible:!0});e==="e-dlgpiechart3"&&(i.type="doughnut");f={sheetIndex:r.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:"chartType",chartId:o};f.prev={chartType:u.model.series[0].type,enable3D:u.model.enable3D,marker:u.model.series[0].marker.visible};i.series=u.model.series;r.XLChart.refreshChart(o,i);f.cur={chartType:u.model.series[0].type,enable3D:u.model.enable3D,marker:u.model.series[0].marker.visible};n("#"+r._id+"_charttypedlg").ejDialog("close");r._completeAction(f);r._trigActionComplete(f)},_chartTypeCancel:function(){var t=this.XLObj;n("#"+t._id+"_charttypedlg").ejDialog("close");t._setSheetFocus()},_chartType:function(t,i,r,u,f,e){for(var v,y,l,s="<div class='e-chartcontent'>",c,a,p="<div class='e-chartheader'><span>",w=t.toLowerCase(),b={visible:!1},h=this.XLObj,k=h._getLocStr(t),d="2-D",o=0;o<i;o++)v="<div class='e-ss-"+h._id+" e-chartcell e-"+w+(o+1)+"' title="+e[o]+"><\/div>",s+=v,o===r&&(s+="<\/div>"+p+"3-D "+k+"<\/span><\/div><div class='e-chartcontent'>");for(s+="<\/div>",(t==="ScatterChart"||t==="StockChart"||t==="PieChart")&&(d=""),c=n("<div id="+h._id+"_Ribbon_"+t+" class='e-ss-dialog e-ss-chart e-ss-"+h._id+"' style='height:auto;'>"+p+d+k+"<\/span><\/div>"+s+"<\/div>"),y=c.find(".e-chartcell"),o=0;o<i;o++)l=n(y[o]),a=f[o],l.data({type:a,enable3D:!1,marker:b}),o>u&&l.data({type:a,enable3D:!0,marker:b});s=n(c).find(".e-"+w+"2");(t==="StockChart"||t==="LineChart")&&s.data({marker:{visible:!0}});t==="PieChart"&&s.data({enable3D:!0});h.element[0].appendChild(c[0])},autoSum:function(i,r){var tt;if(this.XLObj.model.allowAutoSum){var f=this.XLObj,k=f.XLEdit,y,it=!1,a,s=f.getActiveSheetIndex(),d={sheetIndex:s,range:r,calcType:i,reqType:"auto-sum",type:"actionBegin"};if(!f._trigActionBegin(d)&&(r=d.range,i=d.calcType,y=f.getActiveCell(s),!t.isNullOrUndefined(y))){var l,g,p=f.getActiveCell(s),w,nt=f._getRangeArgs(r,"object"),o=f._getSelectedCells(s,nt).selCells,c=o.length-1,rt=o[c].rowIndex-o[0].rowIndex,ut=o[c].colIndex-o[0].colIndex,v={sheetIndex:s,range:r,reqType:"auto-sum",oprType:i,updCell:[]},u,e,b,ft=f.getRangeData({range:[o[0].rowIndex,o[0].colIndex,o[c].rowIndex,o[c].colIndex],valueOnly:!0}).length,h=f._dataContainer.sheets[s];if(c!==0&&ft)if(rt===0&&ut>0){for(w=f._getAlphaRange(s,o[0].rowIndex,o[0].colIndex,o[c].rowIndex,o[c].colIndex),u=o[c].rowIndex,e=o[c].colIndex+1,a=this.XLObj.XLEdit.getPropertyValue(u,e,"value2");!t.isNullOrUndefined(a)&&a!="";)e++,a=this.XLObj.XLEdit.getPropertyValue(u,e,"value2");e===f.getSheet(s).colCount&&f.XLScroll._createNewColumn(s,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"insert");f._isUndoRedo||v.updCell.push({rowIndex:u,colIndex:e,pObj:{},pValue:t.isNullOrUndefined(f.XLEdit.getPropertyValue(u,e,"value2"))?"":f.XLEdit.getPropertyValue(u,e,"value2")});t.isNullOrUndefined(h[u])&&(h[u]={});t.isNullOrUndefined(h[u][e])&&(h[u][e]={});f._isUndoRedo||n.extend(!0,v.updCell[0].pObj,h[u][e]);f._isRowViewable(s,u)&&(b=f.getCell(u,e,s),b.addClass("e-ralign"));k._updateCellValue({rowIndex:u,colIndex:e},"="+i+"("+w+")");"COUNT".indexOf(i)<0&&f._autosumFormatUpdate(f.getRangeData({range:[o[0].rowIndex,o[0].colIndex,o[0].rowIndex,o[0].colIndex]})[0],[u,e,u,e],!1,!1)}else{for(g=o[c].colIndex-o[0].colIndex,u=o[c].rowIndex+1,l=0;l<=g;l++)for(e=o[l].colIndex,a=this.XLObj.XLEdit.getPropertyValue(u,e,"value2"),tt=u;!t.isNullOrUndefined(a)&&a!="";)u++,tt=u,a=this.XLObj.XLEdit.getPropertyValue(u,e,"value2");for(l=0;l<=g;l++)e=o[l].colIndex,u=tt,f.XLEdit.getPropertyValue(o[c].rowIndex+1,e,"tableName")&&(u=u-1),w=f._getAlphaRange(s,o[0].rowIndex,e,o[c].rowIndex,e),o[c].rowIndex===f.getSheet(s).rowCount-1&&f.XLScroll._createNewRow(s,-1,-1,"insert"),f._isUndoRedo||v.updCell.push({rowIndex:u,colIndex:e,pObj:{},pValue:t.isNullOrUndefined(f.XLEdit.getPropertyValue(u,e,"value2"))?"":f.XLEdit.getPropertyValue(u,e,"value2")}),t.isNullOrUndefined(h[u])&&(h[u]={}),t.isNullOrUndefined(h[u][e])&&(h[u][e]={}),f._isUndoRedo||n.extend(!0,v.updCell[l].pObj,h[u][e]),f._isRowViewable(s,u)&&(b=f.getCell(u,e,s),b.addClass("e-ralign")),k._updateCellValue({rowIndex:u,colIndex:e},"="+i+"("+w+")"),"COUNT".indexOf(i)<0&&f._autosumFormatUpdate(f.getRangeData({range:[o[0].rowIndex,o[l].colIndex,o[0].rowIndex,o[l].colIndex]})[0],[u,e,u,e],!1,!1)}else u=y.rowIndex,e=y.colIndex,v.updCell.push({rowIndex:u,colIndex:e,pObj:{},pValue:t.isNullOrUndefined(f.XLEdit.getPropertyValue(u,e,"value2"))?"":f.XLEdit.getPropertyValue(u,e,"value2")}),t.isNullOrUndefined(h[u])&&(h[u]={}),t.isNullOrUndefined(h[u][e])&&(h[u][e]={}),n.extend(!0,v.updCell[0].pObj,h[u][e]),f._isRowViewable(s,p.rowIndex)||f.XLScroll._scrollSelectedPosition(s,p),k.editCell(p.rowIndex,p.colIndex,!0),f.model.allowFormulaBar&&f._getInputBox().val("="+i+"()"),f._isRowViewable(s,u)&&(f.XLEdit._editElem.text("="+i+"()"),f.XLEdit._editElem.focusEnd()),it=!0;f.performSelection({rowIndex:nt[0],colIndex:nt[1]},{rowIndex:u,colIndex:e});f._isUndoRedo||it||(f._completeAction(v),f._trigActionComplete(v))}}},_openNameManagerDlg:function(){var i=this.XLObj,t;i._showDialog(i._id+"_Ribbon_Others_NameManager");t=n("#"+i._id+"_nmgrid").data("ejGrid");t.getContentTable().find("td").addClass("e-ss-emptyrecord");t.model.dataSource.length<1?t.getContentTable().find("td").addClass("e-ss-emptyrecord"):t.getContentTable().find(".e-ss-emptyrecord").removeClass("e-ss-emptyrecord");this._refreshNMDlg();i._browserDetails.name=="msie"&&t.refreshContent();n("#"+i._id+"_nmgrid").focus()},_openFATDlg:function(){var t=this.XLObj;n("#"+t._id+"_fatnamedlg").ejDialog("open");n("#"+t._id+"_fatheader").ejCheckBox("option","checked",!1);n("#"+t._id+"_fatname").val("Table"+t._tableCnt).focus().setInputPos(n("#"+t._id+"_fatname").val().length)},_dirtySelect:function(){var r=this.XLObj,y=r.getActiveSheetIndex(),n,i=r.getSheet(y).filterSettings.tableRange,u=!1,p=!1,h=!1,c=!1,l=!1,w=!1,o=!1,s=!1,f=!1,e=!1,b=-2,a=!1,v=!1,t,k;if(!r.model.allowLockCell||!r.getSheet(y).isSheetProtected){if(n=r.getSheet(y)._selectedCells,n.length>0)for(t=0,k=i.length;t<k;t++){if(e=o=h=c=a=!1,f=s=l=w=v=!1,i[t].startRow-1<=n[0].rowIndex&&i[t].endRow>=n[n.length-1].rowIndex?e=!0:i[t].startRow-1>n[0].rowIndex&&n[n.length-1].rowIndex>=i[t].startRow-1&&i[t].endRow>=n[n.length-1].rowIndex?o=!0:i[t].startRow-1<=n[0].rowIndex&&n[0].rowIndex<=i[t].endRow&&i[t].endRow<n[n.length-1].rowIndex?o=!0:i[t].startRow-1>n[n.length-1].rowIndex?h=!0:i[t].endRow<n[0].rowIndex?c=!0:i[t].endRow<n[n.length-1].rowIndex&&i[t].startRow>n[0].rowIndex?a=!0:e=!1,i[t].multifilterIdx[0]<=n[0].colIndex&&i[t].multifilterIdx[i[t].multifilterIdx.length-1]>=n[n.length-1].colIndex?f=!0:i[t].multifilterIdx[0]>n[0].colIndex&&n[n.length-1].colIndex>=i[t].multifilterIdx[0]&&i[t].multifilterIdx[i[t].multifilterIdx.length-1]>=n[n.length-1].colIndex?s=!0:i[t].multifilterIdx[0]<=n[0].colIndex&&n[0].colIndex<=i[t].multifilterIdx[i[t].multifilterIdx.length-1]&&i[t].multifilterIdx[i[t].multifilterIdx.length-1]<n[n.length-1].colIndex?s=!0:i[t].multifilterIdx[0]>n[n.length-1].colIndex?l=!0:i[t].multifilterIdx[i[t].multifilterIdx.length-1]<n[0].colIndex?w=!0:i[t].multifilterIdx[0]>n[0].colIndex&&i[t].multifilterIdx[i[t].multifilterIdx.length-1]<n[n.length-1].colIndex?v=!0:f=!1,(o&&s||o&&f||e&&s||o&&!w&&!l||s&&!h&&!c||a&&v||e&&v||f&&a)&&(u=!0,r.XLSelection._isRowSelected&&e&&(u=!1),r.XLSelection._isColSelected&&f&&(u=!1),u))break;u||(b=t,(h||c||l)&&(u=!1),e&&f&&(p=!0))}this._isDirtySelect=r._isCFDirty?!0:u;this._isMergeSelect=p||u;this._isFilterSelect={status:p,tableIdx:b,isFiltered:!1}}},_refreshRibbonIcons:function(){var f,t=this.XLObj,s=t.getActiveSheetIndex(),i=n("#"+t._id+"_contextMenuCell").data("ejMenu"),h=["Home_Editing_SortFilter","Home_Editing_Clear","Home_Styles_FormatAsTable"],e=["Insert_Tables_Table","Data_SortFilter_Filter","Data_SortFilter_ClearFilter"],c=n("#"+t._id+"_Ribbon_Home_Alignment_Merge").data("ejSplitButton"),r,o,u,l;if(!t.XLEdit._isEdit&&t.getSheetElement(s).find(".e-ss-activeimg").length<1&&c&&c.option("enabled",!this._isMergeSelect),t._checkTableRange(t._getRangeArgs()).status!="full"&&e.push("Design_Tools_ConvertToRange"),this._isDirtySelect?(this._disableButtons(h,"ejSplitButton"),this._disableButtons(e,"ejButton"),i&&i.disableItemByID("Sort")):t.XLEdit._isEdit||(this._enableButtons(h,"ejSplitButton"),this._enableButtons(e,"ejButton"),!t.model.isReadOnly&&i&&t.model.allowSorting&&i.enableItemByID("Sort")),r=t.getSheet(s).filterSettings.tableRange[this._isFilterSelect.tableIdx],this._isFilterSelect.status&&r)for(o=r.multifilterIdx,u=0,l=o.length;u<l;u++)if(f=t.XLEdit.getPropertyValue(r.startRow-1,o[u],"filterState"),f&&f.indexOf("filtered")>-1){this._isFilterSelect.isFiltered=!0;break}this._isFilterSelect.isFiltered?this._isDataTabCreate&&this._enableButtons(["Data_SortFilter_ClearFilter"],"ejButton"):this._isDataTabCreate&&this._disableButtons(["Data_SortFilter_ClearFilter"],"ejButton")},_onGroupExpander:function(n){var t=this.XLObj;if(!t.model.isReadOnly&&!t.XLEdit._isEdit&&!t.XLComment._isCommentEdit)switch(n.target.id){case t._id+"_Ribbon_Number_e-groupexpander":t._showDialog(t._id+"_FormatCells")}},disableRibbonItems:function(t){var s=this.XLObj,r,h,u,c,i,e,o,f,l;if(!s.model.isReadOnly)for(u=0,c=t.length;u<c;u++){h=t[u].split("_")[2].toUpperCase();i=t[u].split("_Ribbon_")[1];do{switch(h){case"HOME":this._homeBtnIds.indexOf(i)>-1?(r="ejButton",this._homeBtnIds.splice(this._homeBtnIds.indexOf(i),1)):this._homeSptBtnIds.indexOf(i)>-1?(r="ejSplitButton",this._homeSptBtnIds.splice(this._homeSptBtnIds.indexOf(i),1)):this._homeToggleBtnIds.indexOf(i)>-1?(r="ejToggleButton",this._homeToggleBtnIds.splice(this._homeToggleBtnIds.indexOf(i),1)):this._homeDdIds.indexOf(i)>-1?(r="ejDropDownList",this._homeDdIds.splice(this._homeDdIds.indexOf(i),1)):this._homeCpIds.indexOf(i)>-1&&(r="ejColorPicker",this._homeCpIds.splice(this._homeCpIds.indexOf(i),1));break;case"INSERT":this._insertBtnIds.indexOf(i)>-1?(r="ejButton",this._insertBtnIds.splice(this._insertBtnIds.indexOf(i),1)):this._insertSptBtnIds.indexOf(i)>-1&&(r="ejSplitButton",this._insertSptBtnIds.splice(this._insertSptBtnIds.indexOf(i),1));break;case"DATA":this._dataBtnIds.indexOf(i)>-1?(r="ejButton",this._dataBtnIds.splice(this._dataBtnIds.indexOf(i),1)):this._dataSptBtnIds.indexOf(i)>-1&&(r="ejSplitButton",this._dataSptBtnIds.splice(this._dataSptBtnIds.indexOf(i),1));break;case"PAGELAYOUT":this._pageLayBtnIds.indexOf(i)>-1?(r="ejButton",this._pageLayBtnIds.splice(this._pageLayBtnIds.indexOf(i),1)):this._pageLaySptBtnIds.indexOf(i)>-1?(r="ejSplitButton",this._pageLaySptBtnIds.splice(this._pageLaySptBtnIds.indexOf(i),1)):this._pageLayChckBxIds.indexOf(i)>-1&&(r="ejCheckBox",this._pageLayChckBxIds.splice(this._pageLayChckBxIds.indexOf(i),1));break;case"REVIEW":this._cmntBtnIds.indexOf(i)>-1?(r="ejButton",this._cmntBtnIds.splice(this._cmntBtnIds.indexOf(i),1)):this._cmntTglBtnIds.indexOf(i)>-1?(r="ejToggleButton",this._cmntTglBtnIds.splice(this._cmntTglBtnIds.indexOf(i),1)):this._reviewTglBtnIds.indexOf(i)>-1&&(r="ejToggleButton",this._reviewTglBtnIds.splice(this._reviewTglBtnIds.indexOf(i),1));break;case"OTHERS":this._othersBtnIds.indexOf(i)>-1?(r="ejButton",this._othersBtnIds.splice(this._othersBtnIds.indexOf(i),1)):this._othersSptBtnIds.indexOf(i)>-1&&(r="ejSplitButton",this._othersSptBtnIds.splice(this._othersSptBtnIds.indexOf(i),1));break;case"FORMAT":this._formatBtnIds.indexOf(i)>-1?(r="ejButton",this._formatBtnIds.splice(this._formatBtnIds.indexOf(i),1)):this._formatSptBtnIds.indexOf(i)>-1&&(r="ejSplitButton",this._formatSptBtnIds.splice(this._formatSptBtnIds.indexOf(i),1));break;case"DESIGN":this._contextualBtnIds.indexOf(i)>-1?(r="ejButton",this._contextualBtnIds.splice(this._contextualBtnIds.indexOf(i),1)):this._contextualCheckBoxIds.indexOf(i)>-1?(r="ejCheckBox",this._contextualCheckBoxIds.splice(this._contextualCheckBoxIds.indexOf(i),1)):this._contextualInputIds.indexOf(i)>-1&&(r=!0);break;case"CHARTDESIGN":this._chartDesignBtnIds.indexOf(i)>-1?(r="ejButton",this._chartDesignBtnIds.splice(this._chartDesignBtnIds.indexOf(i),1)):this._chartDesignSptBtnIds.indexOf(i)>-1?(r="ejSplitButton",this._chartDesignSptBtnIds.splice(this._chartDesignSptBtnIds.indexOf(i),1)):this._chartDesignDdIds.indexOf(i)>-1&&(r="ejDropDownList",this._chartDesignDdIds.splice(this._chartDesignDdIds.indexOf(i),1));break;case"SPARKLINEDESIGN":this._sparklineDesignSptBtnIds.indexOf(i)>-1&&(r="ejSplitButton",this._sparklineDesignSptBtnIds.splice(this._sparklineDesignSptBtnIds.indexOf(i),1))}if(r)this._disableButtons([i],r);else for(e=["ejSplitButton","ejButton","ejDropDownList","ejCheckBox","ejToggleButton","ejColorPicker"],o=n("#"+s._id+"_Ribbon_"+i),f=0,l=e.length;f<l;f++)if(o.data(e[f])){o.data(e[f]).disable();break}}while((i==="PageLayout_PageLayout_PageSize"||i==="Home_Clipboard_Paste"||i==="Others_Cells_InsertCell"||i==="Others_Cells_DeleteCell"||i==="Data_DataTools_DataValidation")&&(i=i+"Options"))}},enableRibbonItems:function(t){for(var l=this.XLObj,r,s,i,e,o,f,c,u=0,h=t.length;u<h;u++){s=t[u].split("_")[2].toUpperCase();i=t[u].split("_Ribbon_")[1];do{switch(s){case"HOME":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._homeBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1?(r="ejSplitButton",this._homeSptBtnIds.push(i)):this.allToggleButtonIds.indexOf(i)>-1?(r="ejToggleButton",this._homeToggleBtnIds.push(i)):this.allDropDownIds.indexOf(i)>-1?(r="ejDropDownList",this._homeDdIds.push(i)):this.colorPickerIds.indexOf(i)>-1&&(r="ejColorPicker",this._homeCpIds.push(i));break;case"INSERT":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._insertBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1&&(r="ejSplitButton",this._insertSptBtnIds.push(i));break;case"DATA":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._dataBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1&&(r="ejSplitButton",this._dataSptBtnIds.push(i));break;case"PAGELAYOUT":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._pageLayBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1?(r="ejSplitButton",this._pageLaySptBtnIds.push(i)):this.checkBoxIds.indexOf(i)>-1&&(r="ejCheckBox",this._pageLayChckBxIds.push(i));break;case"REVIEW":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._cmntBtnIds.push(i)):this.allToggleButtonIds.indexOf(i)>-1&&t[u].split("_")[4]==="ShowAllComment"?(r="ejToggleButton",this._cmntTglBtnIds.push(i)):this.allToggleButtonIds.indexOf(i)>-1&&(r="ejToggleButton",this._reviewTglBtnIds.push(i));break;case"OTHERS":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._othersBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1&&(r="ejSplitButton",this._othersSptBtnIds.push(i));break;case"FORMAT":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._formatBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1&&(r="ejSplitButton",this._formatSptBtnIds.push(i));break;case"DESIGN":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._contextualBtnIds.push(i)):this.checkBoxIds.indexOf(i)>-1?(r="ejCheckBox",this._contextualCheckBoxIds.push(i)):this._contextualInputIds.indexOf(i)>-1&&(r=!0);break;case"CHARTDESIGN":this.allButtonIds.indexOf(i)>-1?(r="ejButton",this._chartDesignBtnIds.push(i)):this.allSplitButtonIds.indexOf(i)>-1?(r="ejSplitButton",this._chartDesignSptBtnIds.push(i)):this.allDropDownIds.indexOf(i)>-1&&(r="ejDropDownList",this._chartDesignDdIds.push(i))}if(r)this._enableButtons([i],r);else for(e=["ejSplitButton","ejButton","ejDropDownList","ejCheckBox","ejToggleButton","ejColorPicker"],o=n("#"+l._id+"_Ribbon_"+i),f=0,c=e.length;f<c;f++)if(o.data(e[f])){o.data(e[f]).enable();break}}while((i==="PageLayout_PageLayout_PageSize"||i==="Home_Clipboard_Paste"||i==="Others_Cells_InsertCell"||i==="Others_Cells_DeleteCell"||i==="Data_DataTools_DataValidation")&&(i=i+"Options"))}},_refreshFRDlg:function(){var t=this.XLObj;t._dlgWidth<365?(n("#"+t._id+"_Ribbon_lbFind").text(t._getLocStr("Find")),n("#"+t._id+"_Ribbon_lbReplace").text(t._getLocStr("Replace"))):(n("#"+t._id+"_Ribbon_lbFind").text(t._getLocStr("FindLabel")),n("#"+t._id+"_Ribbon_lbReplace").text(t._getLocStr("ReplaceLabel")))},_refreshChartTypeDlg:function(){var t=this.XLObj;n("#"+t._id+"_charttypedlg").ejDialog("open");n("#"+t._id+"_chartdlg_allcharttab_list").ejListBox("refresh")},_refreshNMDlg:function(){var t=this.XLObj,i;n("#"+t._id+"_nmdlg").ejDialog("open");i=n("#"+t._id+"_nmgrid").data("ejGrid");i._refreshScroller({requestType:"refresh"})},_menuCustomize:function(){var r=this.XLObj,f=r._id,u=r.model.ribbonSettings.applicationTab,i=u.menuSettings;u.type==="menu"?(i.isAppend?this._fileMenuData=this._fileMenuData.concat(i.dataSource):i.dataSource.length&&(this._fileMenuData=[{id:"File",text:r._getLocStr("File"),parentId:null},].concat(i.dataSource)),this._appTabCollection={type:t.Ribbon.ApplicationTabType.Menu,menuItemID:f+"_Menu",menuSettings:{click:n.proxy(this._onBackStageItemClick,this),openOnClick:!1,fields:{dataSource:this._fileMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"}}}):i.isAppend?(this._renderAppTab(),this._appTabCollection.backstageSettings.pages=this._appTabCollection.backstageSettings.pages.concat(i.dataSource)):i.dataSource.length?this._appTabCollection={type:t.Ribbon.applicationTabType.backstage,backstageSettings:{text:r._getLocStr("File"),headerWidth:124,height:r._responsiveHeight,width:r.model.scrollSettings.width,pages:i.dataSource}}:this._renderAppTab()},_refreshBackstageHeight:function(){var n=this.XLObj,i=n.element.find("#"+n._id+"_Ribbon").data("ejRibbon"),r=n._isAutoWHMode?n._responsiveHeight:n._responsiveHeight-2;i.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage&&(i.setModel({applicationTab:{backstageSettings:{height:r,width:n._isAutoWHMode?n._responsiveWidth:n._responsiveWidth-2}}}),i.element.find(".e-responsivebackstagecontent .e-resbackstagecontent").css({height:r-(10+i.element.find(".e-backstagerestop").outerHeight())}))},_refreshBSItems:function(i){var r=this.XLObj;i===t.Ribbon.ApplicationTabType.Menu&&(n("#"+r._id+"_backstagetabnew").remove(),n("#"+r._id+"_backstagetabsaveas").remove(),n("#"+r._id+"_backstagetabprint").remove())},hideMenu:function(){var t=this.XLObj;t.model.isReadOnly||(t.model.ribbonSettings.applicationTab.type==="menu"?n("#"+t._id+"_Menu").hide():t.element.find("#"+t._id+"_Ribbon").find(".e-backstagetab").hide())},showMenu:function(){var t=this.XLObj;t.model.isReadOnly||(t.model.ribbonSettings.applicationTab.type==="menu"?n("#"+t._id+"_Menu").show():t.element.find("#"+t._id+"_Ribbon").find(".e-backstagetab").show())},addTab:function(n,t,i){var r=this.XLObj;r.model.isReadOnly||r.element.find("#"+r._id+"_Ribbon").ejRibbon("addTab",n,t,i)},addTabGroup:function(n,t,i){var r=this.XLObj;r.model.isReadOnly||r.element.find("#"+r._id+"_Ribbon").ejRibbon("addTabGroup",n,t,i)},addContextualTabs:function(n,t){var i=this.XLObj;i.model.isReadOnly||i.element.find("#"+this.XLObj._id+"_Ribbon").ejRibbon("addContextualTabs",n,t)},removeTab:function(n,i){var r=this.XLObj,u;r.model.isReadOnly||(t.isNullOrUndefined(n)&&i?(u=r.element.find("#"+r._id+"_Ribbon .e-apptab"),u.length&&(u.find("a").empty(),u.find(".e-menu-wrap").remove(),u.hide(),r.element.find("#"+r._id+"_Ribbon_BackStage").remove())):r.element.find("#"+r._id+"_Ribbon").ejRibbon("removeTab",n))},removeTabGroup:function(n,t){var i=this.XLObj;i.model.isReadOnly||i.element.find("#"+i._id+"_Ribbon").ejRibbon("removeTabGroup",n,t)},addBackStageItem:function(n,t){var i=this.XLObj;i.model.isReadOnly||this._appTabCollection.type!="backstage"||i.element.find("#"+i._id+"_Ribbon").ejRibbon("addBackStageItem",n,t)},removeBackStageItem:function(n){var t=this.XLObj;t.model.isReadOnly||this._appTabCollection.type!="backstage"||t.element.find("#"+t._id+"_Ribbon").ejRibbon("removeBackStageItem",n)},updateBackStageItem:function(n,t){var i=this.XLObj;i.model.isReadOnly||this._appTabCollection.type!="backstage"||i.element.find("#"+i._id+"_Ribbon").ejRibbon("updateBackStageItem",t,n)},removeMenuItem:function(t){var r=this.XLObj,i,u;r.model.isReadOnly||this._appTabCollection.type!="menu"||(i=n("#"+r._id+"_Menu"),u=i.data("ejMenu"),u.remove(["#"+i.find("li").eq(t).attr("id")]))},updateMenuItem:function(t,i){var f=this.XLObj,r,u;f.model.isReadOnly||this._appTabCollection.type!="menu"||(r=n("#"+f._id+"_Menu"),u=r.data("ejMenu"),u.insertBefore(t,"#"+r.find("li").eq(i).attr("id")),u.remove(["#"+r.find("li").eq(i+1).attr("id")]))},addMenuItem:function(t,i){var u=this.XLObj,r,f;u.model.isReadOnly||this._appTabCollection.type!="menu"||(r=n("#"+u._id+"_Menu"),f=r.data("ejMenu"),f.insertAfter(t,"#"+r.find("li").eq(i).attr("id")))}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.freezepane=function(n){this.XLObj=n;this._hfreeze=null;this._vfreeze=null};t.spreadsheetFeatures.freezepane.prototype={_setHFreeze:function(n){this._hfreeze=n},_getHFreeze:function(){return this._hfreeze},_setVFreeze:function(n){this._vfreeze=n},_getVFreeze:function(){return this._vfreeze},_initFreeze:function(){var t,i,u="div",f="e-hide",r=this.XLObj,e=r.getMainPanel().find(".e-spreadsheet-list")[0];t=document.createElement(u);t.id=r._id+"_hfreeze";t.className="e-frow "+f;e.appendChild(t);this._setHFreeze(n(t));i=document.createElement(u);i.id=r._id+"_vfreeze";i.className="e-fcol "+f;e.appendChild(i);this._setVFreeze(n(i))},_refreshFreeze:function(){var u="px",r="e-hide",n=this.XLObj,i=n.getSheet(),t=this._getHFreeze()[0];t||this._initFreeze();n._isFrozen(n.getFrozenRows())?(n._removeClass(t,r),t.style.top=i._fDivTop,t.style.width=n.model._isActPanelVisible?n._getJSSheetContent(n.getActiveSheetIndex()).width()-(i.showHeadings?n._rowHeaderWidth:0)+10+u:i._vPortWth+(i.showHeadings?n._rowHeaderWidth:0)-4+u):n.addClass(t,r);t=this._getVFreeze()[0];n._isFrozen(n.getFrozenColumns())?(n._removeClass(t,r),t.style.left=i._fDivLeft,t.style.height=i._vPortHgt+(i.showHeadings?n._colHeaderHeight:0)-4+u):n.addClass(t,r)},freezeTopRow:function(){var n=this.XLObj,t=n.getSheet();(n._isFrozen(t.frozenRows)||n._isFrozen(t.frozenColumns))&&(n._intrnlReq=!0,this.unfreezePanes(),n._intrnlReq=!1);this._freeze(t._topRow.idx+1)},freezeLeftColumn:function(){var n=this.XLObj,t=n.getSheet();n._isFrozen(t.frozenColumns)&&(n._intrnlReq=!0,this.unfreezePanes(),n._intrnlReq=!1);this._freeze(null,t._leftCol.idx+1)},freezeRows:function(n){var t=this.XLObj,i=t.getSheet();(t._isFrozen(i.frozenRows)||t._isFrozen(i.frozenColumns))&&(t._intrnlReq=!0,this.unfreezePanes(),t._intrnlReq=!1);this._freeze(n)},freezeColumns:function(n){var t=this.XLObj,i=t.getSheet();t._isFrozen(i.frozenColumns)&&(t._intrnlReq=!0,this.unfreezePanes(),t._intrnlReq=!1);this._freeze(null,n)},freezePanes:function(n,t){var i,r=this.XLObj;r.isNumber(n)||(i=r._toIntrnlRange(n),n=i[0],t=i[1]);this._freeze(n,t)},unfreezePanes:function(){this._freeze();this._refreshSelection()},_freeze:function(n,i){var c,f,l,r,e,o,s,h,u=this.XLObj,v,y,a={sheetIndex:u.getActiveSheetIndex()},p=t.isNullOrUndefined(n),w=t.isNullOrUndefined(i);if(a.reqType=p&&w?"unfreezePanes":w?"freezeRow":p?"freezeColumn":"freezePanes",s=h=!0,u.model.allowFreezing){if(c="px",l="e-hide",r=u.getSheet(),o=this._getHFreeze()[0],t.isNullOrUndefined(n))if(f=u.getFrozenRows(),u._isFrozen(f)){for(n=0,v=r._ftopRowIdx-1,this._showFreezeRow(f,v),u.model.scrollSettings.allowVirtualScrolling&&u.refreshContent();v>=f;)r._fHMergeRows.indexOf(f)>-1&&(r._fHMergeRows.splice(r._fHMergeRows.indexOf(f),1),u._refreshSHMergeCells(null,[f],1,"row","show")),f++;u.addClass(o,l);r._isFreezed=!1}else s=!1;else(n===0||n<r._topRow.idx||n>r._bottomRow.idx)&&(n=u._getMidCell().rowIdx),e=u._getIdxWithOffset(n).yOffset,r._topRow.idx===n&&r._scrollTop!==e&&u.XLScroll._vScroller().scroll(e),u._removeClass(o,l),r._isFreezed=!0,o.style.top=r._fDivTop=e-r._scrollTop+(r.showHeadings?u._colHeaderHeight-2:0)+c,o.style.width=r._vPortWth+(r.showHeadings?u._rowHeaderWidth:0)-4+c,r._contScrollTop=r._scrollTop;if(s&&(r._ftopRowIdx=n,r._frozenHeight=u._getRowOffsetTop(r,n),r.paneTopLeftCell=u.getAlphaRange(n,r._fleftColIdx),u.setFrozenRows(n),r._frozenRows=n+1),o=this._getVFreeze()[0],t.isNullOrUndefined(i))if(f=u.getFrozenColumns(),u._isFrozen(f)){for(i=0,y=r._fleftColIdx-1,this._showFreezeCol(f,y);y>=f;)r._fHMergeCols.indexOf(f.toString())>-1&&(r._fHMergeCols.splice(r._fHMergeCols.indexOf(f.toString()),1),u._refreshSHMergeCells(null,[f],1,"column","show")),f++;u.addClass(o,l);r._isFreezed=!1}else h=!1;else(i===0||i<r._leftCol.idx||i>r._rightCol.idx)&&(i=u._getMidCell().colIdx),e=u._getIdxWithOffset(null,i).xOffset,r._leftCol.idx===i&&r._scrollLeft!==e&&u.XLScroll._hScroller().scroll(e),e=e+(r.showHeadings?u._rowHeaderWidth:0)-1,u._removeClass(o,l),r._isFreezed=!0,o.style.left=r._fDivLeft=e-r._scrollLeft+c,o.style.height=r._vPortHgt+(r.showHeadings?u._colHeaderHeight:0)-4+c,r._contScrollLeft=r._scrollLeft;h&&(r._fleftColIdx=i,r._frozenWidth=u._getColOffsetLeft(r,i),r.paneTopLeftCell=u.getAlphaRange(r._ftopRowIdx,i),u.setFrozenColumns(i),r._frozenColumns=i+1);(s||h)&&(u.XLScroll._refreshScroller(null,null,s&&h?"all":s?"vertical":"horizontal"),s&&u.model.scrollSettings.allowScrolling&&u.XLScroll._vScroller().scroll(u._isFrozen(u.getFrozenRows())?0:r._contScrollTop),h&&u.model.scrollSettings.allowScrolling&&u.XLScroll._hScroller().scroll(u._isFrozen(u.getFrozenColumns())?0:r._contScrollLeft));s&&(a.rowIndex=n);h&&(a.colIndex=i);u._intrnlReq||u._trigActionComplete(a)}},_frozenScrollHandler:function(n){var o,f,s=0,r=this.XLObj,u=r.XLScroll,i=r.getSheet(),e=r.getActiveSheetIndex(),c=u._vScroller(e),l=u._hScroller(e),h;if(n.model.orientation===t.ScrollBar.Orientation.Vertical){if(h=c.element.find(".e-vhandle")[0].getBoundingClientRect(),n.reachedEnd=h.top+h.height>=c.element.find(".e-vhandlespace").height()-2,(n.scrollData.up||n.reachedEnd&&r.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite)&&(o=(n.scrollTop-i._scrollTop)/i.rowHeight,i._bottomRow.idx+o>=i.rowCount-1)){if(r.model.scrollSettings.allowVirtualScrolling)while(o>=i.rowCount)for(s=0,i._virtualBlockCnt++,i.rowCount+=i._virtualBlockRowCnt;s<i._virtualBlockRowCnt;)i.rowsHeightCollection.push(i.rowHeight),s++;else r.XLScroll._scrollBottom(e);r.XLScroll._refreshScroller(e,"refresh","vertical")}u._isIntrnlScroll?(this._scrollFreeze(u._scrollIdx),u._scrollIdx=0,i._scrollTop=n.scrollTop):n.scrollTop==i._scrollTop||n.reachedEnd&&r.model.scrollSettings.scrollMode!==t.Spreadsheet.scrollMode.Infinite||(f=this._ensureFreezeScrollPos(n),r.isUndefined(f.resetTo)?(this._scrollFreeze(f.rowIdx),i._scrollTop=n.scrollTop):(u._isIntrnlScroll=!0,u._scrollIdx=f.rowIdx,u._vScroller().scroll(f.resetTo),u._isIntrnlScroll=!1))}else n.reachedEnd=Math.ceil(parseFloat(l.element.find(".e-hhandle").css("left")))+Math.ceil(parseFloat(l.element.find(".e-hhandle").width()))>=r.element.find(".e-hhandlespace").width()-2,o=(n.scrollLeft-i._scrollLeft)/i.columnWidth,(n.reachedEnd||r.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&i._rightCol.idx+o>=i.colCount-1)&&(r.XLScroll._scrollRight(e),r.XLScroll._refreshScroller(e,"refresh","horizontal")),u._isIntrnlScroll?(this._scrollFreeze(null,u._scrollIdx),u._scrollIdx=0,i._scrollLeft=n.scrollLeft):n.scrollLeft==i._scrollLeft||n.reachedEnd&&r.model.scrollSettings.scrollMode!==t.Spreadsheet.scrollMode.Infinite||(f=this._ensureFreezeScrollPos(n),r.isUndefined(f.resetTo)?(this._scrollFreeze(null,f.colIdx),i._scrollLeft=n.scrollLeft):(u._isIntrnlScroll=!0,u._scrollIdx=f.colIdx,u._hScroller().scroll(f.resetTo),u._isIntrnlScroll=!1));r.model.allowComments&&r.XLComment._updateCmntArrowPos()},_ensureFreezeScrollPos:function(n){var r,i,u={},o=[t.Spreadsheet.HideTypes.Freeze],e=this.XLObj,f=e.getSheet();return n.model.orientation===t.ScrollBar.Orientation.Vertical?(r=n.scrollTop+f._frozenHeight,i=e._getIdxWithOffset(r,null,!0,o),u.rowIdx=i.rowIdx,r!==i.yOffset&&(u.resetTo=i.yOffset-f._frozenHeight)):(r=n.scrollLeft+f._frozenWidth,i=e._getIdxWithOffset(null,r,!0,o),u.colIdx=i.colIdx,r!==i.xOffset&&(u.resetTo=i.xOffset-f._frozenWidth)),u},_scrollFreeze:function(n,t){var r,u=this.XLObj,i=u.getSheet(),e=u.getActiveSheetIndex(),f=i.shapeMngr;if(n&&i._ftopRowIdx!==n){for(i._ftopRowIdx<n?(r=n-i._ftopRowIdx==1?i._ftopRowIdx:n-1,this._hideFreezeRow(i._ftopRowIdx,r),(this.XLObj.getObjectLength(f.chart)||this.XLObj.getObjectLength(f.picture))&&this._refreshShape(i._ftopRowIdx,r,!0)):(r=i._ftopRowIdx-n==1?n:i._ftopRowIdx-1,this._showFreezeRow(n,r),(this.XLObj.getObjectLength(f.chart)||this.XLObj.getObjectLength(f.picture))&&this._refreshShape(n,r,!0)),u.model.scrollSettings.allowVirtualScrolling&&u._refreshContent(e,!0);r>=n;)i._fHMergeRows.indexOf(r)>-1&&(i._fHMergeRows.splice(i._fHMergeRows.length-1,1),u._refreshSHMergeCells(null,[r],1,"row","show")),r--;i._ftopRowIdx=n;i.paneTopLeftCell=u.getAlphaRange(n,i._fleftColIdx);u.model.scrollSettings.allowScrolling&&(u.XLScroll._getRowHeights(e,1,null,!0),u.XLScroll._refreshScroller(e,"refresh","vertical"),u.XLScroll._getFirstRow(e))}else if(t&&i._fleftColIdx!==t){for(i._fleftColIdx<t?(r=t-i._fleftColIdx==1?i._fleftColIdx:t-1,this._hideFreezeCol(i._fleftColIdx,r),(this.XLObj.getObjectLength(f.chart)||this.XLObj.getObjectLength(f.picture))&&this._refreshShape(i._fleftColIdx,r)):(r=i._fleftColIdx-t==1?t:i._fleftColIdx-1,this._showFreezeCol(t,r),(this.XLObj.getObjectLength(f.chart)||this.XLObj.getObjectLength(f.picture))&&this._refreshShape(t,r));r>=t;)i._fHMergeCols.indexOf(r.toString())>-1&&(i._fHMergeCols.splice(i._fHMergeCols.length-1,1),u._refreshSHMergeCells(null,[r],1,"column","show")),r--;i._fleftColIdx=t;i.paneTopLeftCell=u.getAlphaRange(i._ftopRowIdx,t)}this._refreshSelection()},_refreshShape:function(t,i,r){var u,o,l,c,a,v,f=this.XLObj,nt=f.getActiveSheetIndex(),s=f.getSheet(nt),e=s.shapeMngr,k=s.pivotMngr,y=r?[t,0,i,s.colCount]:[0,t,s.rowCount,i],d=f.getObjectLength(e.chart),p=!1,h,g=f.getObjectLength(e.picture),w,b;if(d)for(w=f.getObjectKeys(e.chart),h=0;h<d;h++)if(f.inRange(y,e.chart[w[h]].rowIndex,e.chart[w[h]].colIndex)){p=!0;break}if(g)for(b=f.getObjectKeys(e.picture),h=0;h<g;h++)if(f.inRange(y,e.picture[b[h]].rowIndex,e.picture[b[h]].colIndex)){p=!0;break}if(p){for(o=f.getRangeData({range:y,property:["picture","chart"]}),u=0;u<o.length;u++)o[u].picture&&(a=o[u].picture[f.getObjectLength(o[u].picture)],c=r?e.picture[a].rowIndex:e.picture[a].colIndex,this._freezeShape(n("#"+a)[0],r?s._hiddenFreezeRows.indexOf(c)>-1:s._hiddenFreezeCols.indexOf(c)>-1)),o[u].chart&&(l=o[u].chart[f.getObjectLength(o[u].chart)],c=r?e.chart[l].rowIndex:e.chart[l].colIndex,this._freezeShape(n("#"+l)[0],r?s._hiddenFreezeRows.indexOf(c)>-1:s._hiddenFreezeCols.indexOf(c)>-1)),o[u].pivot&&(v=o[u].pivot[f.getObjectLength(o[u].pivot)],c=r?k.pivot[v].rowIndex:k.pivot[v].colIndex,this._freezeShape(n("#"+v)[0],r?s._hiddenFreezeRows.indexOf(c)>-1:s._hiddenFreezeCols.indexOf(c)>-1));this._updateShapePos(r)}},_updateShapePos:function(n){var i,r,h,c,l=0,a=0,v,u,t,f,e,o=this.XLObj,s=o.getSheet(),y=s.shapeMngr,p=s._hiddenFreezeRows,w=s._hiddenFreezeCols;n?l=this._getFreezeHidenDim(!0):a=this._getFreezeHidenDim();for(e in y)if(["chart","picture"].indexOf(e)>-1){f=y[e];for(v in f)t=f[v],u=t.id,i=t.top,r=t.left,h=p[p.length-1]||0,c=w[w.length-1]||0,n?h<=t.rowIndex&&(i-=l,o.getSheetElement().find("#"+u).css({top:i})):c<=t.colIndex&&(r-=a,o.getSheetElement().find("#"+u).css({left:r}))}},_getFreezeHidenDim:function(n){var e=this.XLObj,t=e.getSheet(),i,u,f=0,r=0;for(n?(i=t._hiddenFreezeRows,u=t.rowsHeightCollection):(i=t._hiddenFreezeCols,u=t.columnsWidthCollection),r=0;r<i.length;r++)f+=u[i[r]];return f},_freezeShape:function(n,t){var i=this.XLObj;t?i.addClass(n,"e-hide"):i._removeClass(n,"e-hide")},_hideFreezeRow:function(n,t){for(var u,i=this.XLObj,o=i.model.scrollSettings,c=o.allowScrolling&&o.allowVirtualScrolling,f=i.getActiveSheetIndex(),s=i.getRows(f),l=s[0],a=s[1],r=i.getSheet(f),v=r.usedRange,e,h=!1,y=r.mergedCells.length;n<=t;){for(u=0,r._hiddenFreezeRows.indexOf(n)===-1&&r._hiddenFreezeRows.push(n),!c&&i._isRowViewable(f,n)&&(i.addClass(a[n],"e-r-hide"),i.addClass(l[n],"e-r-hide"));u<v.colIndex;){for(e=0;e<y;e++)h=i.inRange(i._getRangeArgs(r.mergedCells[e].range),n,u);if(h&&i.XLCellNav._isMergedCell({rowIndex:n,colIndex:u})){r._fHMergeRows.push(n);i._refreshSHMergeCells(f,[n],1,"row","hide");break}u++}n++}},_showFreezeRow:function(n,t){for(var r,f=!1,i=this.XLObj,e=i.model.scrollSettings,h=e.allowScrolling&&e.allowVirtualScrolling,o=i.getActiveSheetIndex(),s=i.getRows(o),c=s[0],l=s[1],u=i.getSheet();n<=t;)r=u._hiddenFreezeRows.indexOf(n),i.model.allowFiltering&&i.getObjectLength(u._filterColl)&&(f=this._refreshFiltering(n)),r>-1&&(u._hiddenFreezeRows.splice(r,1),h||!i._isRowViewable(o,n)||f||(i._removeClass(l[n],"e-r-hide"),i._removeClass(c[n],"e-r-hide"))),n++},_refreshFiltering:function(n){var i=this.XLObj,u=i.getActiveSheetIndex(),r=i.getSheet();return t.isNullOrUndefined(i.XLEdit.getPropertyValue(n,0,"isFilterHide",u))?!1:(r._filterHRowsColl.indexOf(n)===-1&&r._filterHRowsColl.push(n),!0)},_hideFreezeCol:function(n,t){for(var s,e,o="e-fcol-hide",i=n,r=this.XLObj,h=r.getActiveSheetIndex(),u=r.getSheet(),y=u.usedRange,c=r.model.scrollSettings.allowVirtualScrolling?u._virtualRowIdx:u._rowIdxColl,l=r._getJSSheetHeader(h),a=r._getContent(h),p=l.find("th"),w=l.find("col"),b=a.find("col"),v=l.find("table"),f=r._getWidth(n,t);i<=t;){for(e=0,u._hiddenFreezeCols.indexOf(i)===-1&&u._hiddenFreezeCols.push(i),r.addClass(p[i],o),r.addClass(w[i],o),r.addClass(b[i],o);e<y.rowIndex;){if(r.XLCellNav._isMergedCell({rowIndex:e,colIndex:i})){u._fHMergeCols.push(i.toString());r._refreshSHMergeCells(h,[i],1,"column","hide");break}e++}i++}if(s=r.getRange([c[0],n,c[c.length-1],t]),i=s.length,i)while(i--)r.addClass(s[i],o);f=v.width()-f;v.width(f);a.find(".e-table").width(f)},_getWidth:function(n,t){for(var i=0,r=this.XLObj.getSheet();n<=t;n++)i+=r.columnsWidthCollection[n];return i},_showFreezeCol:function(n,t){for(var e,s,f="e-fcol-hide",r=n,i=this.XLObj,l=i.getActiveSheetIndex(),u=i.getSheet(),h=i._getJSSheetHeader(l),a=i._getContent(l),v=h.find("th"),c=i.model.scrollSettings.allowVirtualScrolling?u._virtualRowIdx:u._rowIdxColl,y=h.find("col"),p=a.find("col"),w=h.find("table"),o=i._getWidth(0,u.colCount-1)-(u._frozenColumns-1<n?i._getWidth(u._frozenColumns-1,n):0);r<=t;)e=u._hiddenFreezeCols.indexOf(r),e>-1&&(u._hiddenFreezeCols.splice(e,1),i._removeClass(v[r],f),i._removeClass(y[r],f),i._removeClass(p[r],f)),r++;if(s=i.getRange([c[0],n,c[c.length-1],t]),r=s.length,r)while(r--)i._removeClass(s[r],f);w[0].style.width=o+"px";a.find("table")[0].width=o+"px"},_refreshSelection:function(){var r,f,u,e,o=!1,i=this.XLObj,n=i.getSheet(),t=n.selectedRange,s=t[2],h=t[3],c=t[0],l=t[1];if(n._endCell.rowIndex+1>=n._frozenRows&&n._endCell.rowIndex<n._ftopRowIdx&&n._startCell.rowIndex<n._frozenRows-1)s=n._frozenRows-2,o=!0;else if(r=t[0],f=t[2],n._frozenRows-1<=r)while(r<=f)if(r<n._ftopRowIdx)r++;else{c=r;break}if(t[3]+1>=n._frozenColumns&&t[3]<n._fleftColIdx&&t[1]<n._frozenColumns-1)h=n._frozenColumns-2,o=!0;else if(u=t[1],e=t[3],n._frozenColumns-1<=u)while(u<=e)if(u<n._fleftColIdx)u++;else{l=u;break}r==f+1||u==e+1?i.XLSelection._hideShowSelElem("hide"):(i.model.allowSelection&&i.XLSelection._refreshBorder([c,l,s,h]),o?i.addClass(i.getAutoFillElem()[0],"e-hide"):i.model.allowAutoFill&&i.XLDragFill.positionAutoFillElement())},_selectionScroll:function(){var i,r,u,f,e=f=0,t=this.XLObj,n=t.getSheet(),o=t.getActiveSheetIndex();if(t._isFrozen(n.frozenRows))if(n._startCell.rowIndex+1<n._frozenRows&&n._endCell.rowIndex+1>n._frozenRows&&n.selectedRange[2]<n._ftopRowIdx){if(n._ftopRowIdx+1-n._frozenRows>0){for(r=n._endCell.rowIndex-n._ftopRowIdx,n._endCell.rowIndex=n._frozenRows-1+r,i=n._frozenRows-1;i<n._ftopRowIdx;i++)e+=n.rowsHeightCollection[i];t._scrollContent({y:-e})}}else n.selectedRange[2]-n._endCell.rowIndex>0&&n._ftopRowIdx>n._frozenRows-1&&!n._isColSelected&&n._endCell.rowIndex<n._frozenRows-1&&n.selectedRange[2]-n.selectedRange[0]>0&&n.selectedRange[2]>=n._ftopRowIdx-1&&(n._endCell.rowIndex=n._ftopRowIdx-1,u=t.getCell(n._frozenRows-2,n._endCell.colIndex)[0],t.XLSelection._scrollCalculation(o,u,{position:"vertical",action:"Decrement"}));if(t._isFrozen(n.frozenColumns))if(n._startCell.colIndex+1<n._frozenColumns&&n._endCell.colIndex+1>n._frozenColumns&&n.selectedRange[3]<n._fleftColIdx){if(n._fleftColIdx+1-n._frozenColumns>0){for(r=n._endCell.colIndex-n._fleftColIdx,n._endCell.colIndex=n._frozenColumns-1+r,i=n._frozenColumns-1;i<n._fleftColIdx;i++)f+=n.columnsWidthCollection[i];t._scrollContent({x:-f})}}else n.selectedRange[3]-n._endCell.colIndex>0&&n._fleftColIdx>n._frozenColumns-1&&!n._isRowSelected&&n._endCell.colIndex<n._frozenColumns-1&&n.selectedRange[3]-n.selectedRange[1]>0&&n.selectedRange[3]>=n._fleftColIdx-1&&(n._endCell.colIndex=n._fleftColIdx-1,u=t.getCell(n._frozenColumns-2,n._endCell.colIndex)[0],t.XLSelection._scrollCalculation(o,u,{position:"horizontal",action:"Decrement"}))},_refreshFColResize:function(n){var u,f="px",i=this.XLObj,s=i.getActiveSheetIndex(),t=i.getSheet(),e=i.getFrozenColumns()+1,h=this._getVFreeze()[0],r=t._frozenWidth,o=parseInt(this._getVFreeze()[0].style.left);i.XLScroll._getColWidths(s,n);t._frozenWidth=i._getColOffsetLeft(t,e-1);u=r>t._frozenWidth?r-t._frozenWidth:t._frozenWidth-r;n<e-1&&(h.style.left=t._fDivLeft=r>=t._frozenWidth?o-u+f:o+u+f)},_refreshFRowResize:function(n){var u,f="px",i=this.XLObj,s=i.getActiveSheetIndex(),t=i.getSheet(),e=i.getFrozenRows()+1,h=this._getHFreeze()[0],r=t._frozenHeight,o=parseInt(this._getHFreeze()[0].style.top);i.XLScroll._getRowHeights(s,n);t._frozenHeight=i._getRowOffsetTop(t,e-1);u=r>t._frozenHeight?r-t._frozenHeight:t._frozenHeight-r;n<e-1&&(h.style.top=t._fDivTop=r>=t._frozenHeight?o-u+f:o+u+f)},_refreshFreezeRowDiv:function(){var t=this.XLObj,n=t.getSheet();n._fDivTop=t._getIdxWithOffset(n._frozenRows-1).yOffset-n._contScrollTop+(n.showHeadings?t._colHeaderHeight-2:0)+"px";n._frozenHeight=t._getRowOffsetTop(n,n._frozenRows-1);this._refreshFreeze()},_refreshFreezeColDiv:function(){var t=this.XLObj,n=t.getSheet();n._fDivLeft=t._getColOffsetLeft(n,n._frozenColumns-1)-n._contScrollLeft+(n.showHeadings?t._rowHeaderWidth:0)-1+"px";n._frozenWidth=t._getColOffsetLeft(n,n._frozenColumns-1);this._refreshFreeze()}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.math={toFraction:function(n){if(this.isNumber(n)){var r=n.toString(),e=r.split(".")[0],t=r.split(".")[1];if(!t)return{integer:n};var i=(+t).toString(),u=this.getPlaceValue(t,i),f=this.getGcd(i,u);return{integer:e,numerator:Number(i)/f,denominator:Number(u)/f}}return null},toExponential:function(n,t){if(this.isNumber(n)){var r,u=Number(n),i;return t=t||2,t>20&&(t=20),r=u.toExponential(t),r.indexOf("e+")>-1?(i=r.split("e+"),i[0]+"E+"+this.padZeros(i[1])):(i=r.split("e-"),i[0]+"E-"+this.padZeros(i[1]))}return null},toAccounting:function(i,r,u){if(this.isNumber(r)&&i){var e,o,s=t.widgetBase.formatting(i,r,u),f=this._currencySymbol,h=n.trim(s.replace(f,"")),c=s.indexOf(f);!c||r<0&&c===1?(e=f,o=Number(r)?h:"-"):(e=Number(r)?h:"-",o=f);r=e+"   "+o}return r},intToDate:function(n){return new Date((Number(n)-2)*864e5+new Date("01/01/1900").getTime())},getGcd:function(n,t){return(n=Number(n),t=Number(t),!t)?n:this.getGcd(t,n%t)},isNumber:function(n){return n-parseFloat(n)>=0},isTime:function(n){return n?n.toString().indexOf(":")!==-1:!1},isFormula:function(n){var t,i;return n&&!n.toString().indexOf("=")&&n.length>1?(t=n.split("(").length-1,i=n.split(")").length-1,t===i):!1},getPlaceValue:function(n,t){var i=n.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},padZeros:function(n,i,r){return this.isNumber(n)?(i=this.isNumber(i)?i:2,r=t.isNullOrUndefined(t.Spreadsheet.autoFillDirection[r])?t.Spreadsheet.autoFillDirection.Left:t.Spreadsheet.autoFillDirection[r],r===t.Spreadsheet.autoFillDirection.Left?n<=this.maxValue(i)?Array(i-this.getDigits(n)+1).join("0")+n.toString():n.toString():n<this.minValue(i)?n.toString()+Array(i-this.getDigits(n)+1).join("0"):n.toString()):null},maxValue:function(n){return this.isNumber(n)?Number(Array(n+1).join("9")):null},minValue:function(n){return this.isNumber(n)?Number("1"+Array(n).join("0")):null},getDigits:function(n){return this.isNumber(n)?n.toString().length:null},_round:function(n,t){return Number(Math.round(n+"e"+t)+"e-"+t)},_parseTime:function(n){var u,t,i=0,r=3,f={},e;if(this.isTime(n))for(n=n.toString(),t=n.split(" "),u=t.length;i<u;){if(this.isTime(t[i]))for(e=t[i].split(":");r<6;)f[this._datePattern[r]]=e[r-3]||"0",r++;i++}return f},_dateToInt:function(n,t){var r=new Date("01/01/1900"),u=this._isDateTime(n)?n:new Date(n),f=u.getTime()-r.getTime(),i=f/864e5+2;return t?i%1:i},_defTimeFormat:function(n){return[n.getHours(),n.getMinutes(),n.getSeconds()].join(":")},_isDate:function(n){var i={};return t.isNullOrUndefined(t.parseDate(n.toString()))||(n=this._dateToInt(n.toString())),/^((0?[1-9]|1[012])[-.](0?[1-9]|[12][0-9]|3[01])[-.](19|20)?[0-9]{2})*$/.test(n.toString())?(n=n.toString().replace("-","/","g"),n=this._dateToInt(n.toString()),i.text=n,i.isDate=!0):(i.text=n,i.isDate=!1),i},_defDateFormat:function(n){return[n.getMonth()+1,n.getDate(),n.getFullYear()].join("/")},_isCellReference:function(n){return/^[a-z]{1,3}\d{1,7}$/gi.test(n)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(n)?"absolute":/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(n)?"mixed":!1},_isDateTime:function(n){return Object.prototype.toString.call(n)==="[object Date]"&&!isNaN(n.valueOf())},_decimalCnt:function(n){var t,i;return this.isNumber(n)&&(n=Number(n),t=n.toString(),t.indexOf(this._decimalSeparator)>-1)?(i=n.toFixed(),t.length-i.length-1):0},_getPosDiff:function(n,t){return n>t?n-t:t-n}}}(jQuery,Syncfusion),function(n,t,i){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.resizing=function(t){this.XLObj=t;this._$visualElem=n();this._currentHCell=-1;this._colMinWidth=15;this._rowMinHeight=20;this._allowStart=!1;this._resizeStart=!1;this._resizeType="";this._tableY=null;this._oldWidth=null;this._orgX=null;this._orgY=null;this._extra=null;this._initialTableWidth=null;this._resizeElt=null;this._tableX=null;this._oldHeight=null;this._initialTableHeight=null;this._resizerowId=0;this._sparklineResize=!1};t.spreadsheetFeatures.resizing.prototype={getColWidth:function(n){return this.XLObj.getSheet(this.XLObj.getActiveSheetIndex()).columnsWidthCollection[n]},getRowHeight:function(n){return this.XLObj.getSheet(this.XLObj.getActiveSheetIndex()).rowsHeightCollection[n]},setColWidth:function(n,t){if(this.XLObj.model.allowResizing){var i=this.XLObj.getActiveSheetIndex();this._currentHCell=n;this._resizeColumnUsingDiff(t,this.XLObj.getSheet(i).columnsWidthCollection[n],[n]);this.XLObj.XLScroll._getColWidths(i,n);this.XLObj.XLSelection.refreshSelection()}},setRowHeight:function(n,t){var i=this.XLObj,r;i.model.allowResizing&&(r=i.getActiveSheetIndex(),this._currentHCell=n,this._resizeRowUsingDiff(t,i.getSheet(r).rowsHeightCollection[n],[n]))},_headerMouseDown:function(n){n.preventDefault();this._colMouseDown(n)},_colMouseDown:function(t){var u,r=this.XLObj,i={};if(u=r._setXY(t,navigator.userAgent.indexOf("WebKit")>-1),this._orgX=u[0]+document.documentElement.scrollLeft,this._orgY=u[1],r._isTouchEvt&&this._mouseHover(t),this._allowStart&&(n(t.target).css("cursor")==="col-resize"||r._isTouchEvt)){if(i.event=t,i.target=t.target,i.colIndex=this._currentHCell,i.oldWidth=t.target.getBoundingClientRect().width,i.reqType="column-resize",r._trigger("resizeStart",i))return;t.button!==2&&this._start(this._orgX,this._orgY);this._resizeType="Col";t.preventDefault()}},_mouseHover:function(t){var s,i=this.XLObj,r=t.target,c=i.getActiveSheetIndex(),o=i._getJSSheetHeader(c);if(!this._$visualElem.is(":visible")&&(i._hasClass(r,"e-headercelldiv")&&(r=r.parentNode),i._hasClass(r,"e-headercell"))){var e=r,u=e.getBoundingClientRect(),h=i._setXY(t),f=h[0],l=h[1];if(s=n(o.find(".e-table")[0]).width()+n(o.find(".e-columnheader")[0]).offset().left,(f>=u.left+document.documentElement.scrollLeft+e.offsetWidth-(i._isTouchEvt?15:7)||f<u.left+(i._isTouchEvt?13:0))&&f<s&&f>=u.left&&l<=u.top+document.documentElement.scrollTop+r.offsetHeight){if(this._currentHCell=o.find(".e-headercell").index(e),this._currentHCell<1&&f<u.left+e.offsetWidth-(i._isTouchEvt?15:5)||this._preventColResize(this._currentHCell,!1))return;i.addClass(r,"e-ss-colresize");this._allowStart=!0}else i._removeClass(n(".e-ss-colresize")[0],"e-ss-colresize"),this._allowStart=!1,this._currentHCell=-1}},_preventColResize:function(n,t){this._currentHCell=n;var r=this.XLObj,c=r.getActiveSheetIndex(),s=r.getSheet(c).pivotMngr.pivot,u=r.getObjectKeys(s),f,o,h,e,i,l=u.length;if(u.length)for(i=0;i<l;i++)return f=s[u[i]].colIndex,h=r.element.find("#"+u[i]).data("ejPivotGrid"),e=h.calculateCellWidths().columnWidths.length,e||(e=3),o=f+e,t?this._currentHCell>=f&&this._currentHCell<o:this._currentHCell>=f&&this._currentHCell<=o},_start:function(i){var r=this.XLObj,f,e=r.getActiveSheetIndex(),o=r._getJSSheetHeader(e),c=o.find(".e-columnheader"),s=c.find(".e-headercell"),u,h;(this._currentHCell>-1&&this._currentHCell<s.length&&(u=s[this._currentHCell]),t.isNullOrUndefined(u))||(h=u.getBoundingClientRect(),this._tableY=h.top+parseInt(navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollTop:document.documentElement.scrollTop),this._allowStart?(this._$visualElem=n(document.createElement("div")),f=r._getJSSheetContent(e).height()+o.height(),this._$visualElem.addClass("e-reSizeColbg").appendTo(r.element).css({height:f+"px"}).addClass("e-ss-colresize"),this._$visualElem.css({left:i-1,top:this._tableY}),this._oldWidth=u.offsetWidth,this._extra=i-this._orgX,this._resizeStart=!0):this._currentHCell=-1)},_cMouseMove:function(n){if(this._resizeStart){var t=this.XLObj._setXY(n,navigator.userAgent.indexOf("WebKit")>-1)[0];t+=document.documentElement.scrollLeft;n.preventDefault();this._moveVisual(t);this.XLObj.addClass(n.target,"e-ss-colresize")}else this._mouseHover(n)},_reSize:function(t){var f,i=this.XLObj,h,r=i.getActiveSheetIndex(),e,a=i._getJSSheetHeader(r),c=a.find(".e-colselected"),l=c.length,u,o=[],s;if(this._initialTableWidth=i._getJSSheetHeader(r).find(".e-headercontent").width(),this._getResizableCell(),this._currentHCell>-1&&this._resizeStart){for(f=i.getSheet(r).columnsWidthCollection[this._currentHCell],l>0&&(u=c[0].cellIndex),e=0;e<l;e++)this._currentHCell===u&&(h=!0),o.push(u),u++;h||(o=[this._currentHCell]);this._resizeColumnUsingDiff(t-this._orgX+f,f,o);i._isAutoWHMode&&(i._autoSSWidthHeight(),s=i._getElementDimension(),i.element.css({height:s.height,width:s.width}));i.model.allowAutoFill&&(i.XLDragFill.positionAutoFillElement(),i.XLDragFill.hideAutoFillOptions());n("#"+i._id+"ddlspan").length&&i._ddlPosition()}i.XLScroll._getRowHeights(r,this._currentHCell);i.model.allowFreezing&&i.XLFreeze._refreshFColResize(this._currentHCell);i.model.allowSelection&&i.XLSelection._refreshBorder();this._removeVisualElem()},_resizeColumnUsingDiff:function(t,i,r){var a,d,g,h,l,o,v,y,p,w,nt,tt,u=this.XLObj,b={},f=u.getActiveSheetIndex(),it=u._getJSSheetHeader(f),rt,k=u.getSheet(f),e,ut,s,ft,c;if(t>0){for(t=t>this._colMinWidth?t:this._colMinWidth,e=0,ut=r.length;e<ut;e++){if(u.XLEdit.getPropertyValue(0,r[e],"wrapCol")&&u.XLEdit.getPropertyValue(0,r[e],"wrapWidth")>t){u._dupDetails=!0;continue}if(nt=it.find("col:eq("+r[e]+")"),tt=u._getJSSheetContent(f).find(".e-spreadsheetcontentcontainer").find("col:eq("+r[e]+")"),nt.outerWidth(t),tt.width(t),u.XLShape&&u.XLShape._refreshShapePosOnResize(r[e],t,!0,f),k.columnsWidthCollection[r[e]]=t,t<i)for(p=u._getContent(f).find(".e-rowcell:nth-child("+(r[e]+1)+")"),s=0,ft=p.length;s<ft;s++)o=u._getCellIdx(p[s]),v=u.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"value2"),h=u.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"sparkline",f),h&&u.XLSparkline._sparklineResize(h[0],{width:t},f),v&&(u._refreshGlobalSpan(),l=n("#"+u._id+"_emptySpan"),u.addClass(l[0],"e-rowcell"),l.text(v),y=l.outerWidth(),u._refreshGlobalSpan(),t<y&&(u._textClip(o.rowIndex,o.colIndex,"delete"),u._textClip(o.rowIndex,o.colIndex,"add",y)));else{if(w=u._getContent(f).find(".e-rowcell.e-ofbrdr:nth-child("+(r[e]+1)+")"),rt=k.usedRange.rowIndex,u.model.allowSparkline&&u.getObjectLength(k.shapeMngr.sparkline)>0)for(c=0;c<=rt;c++)h=u.XLEdit.getPropertyValue(c,r[e],"sparkline",f),h&&(u.XLScroll._getColWidths(f,r[0]),a=u._getCellInfo({rowIndex:c,colIndex:r[e]},f),u._getContent(f).find("#"+h[0]).css({top:a.top,left:a.left}),g=u._dataContainer.sheets[f][c][r[e]].sparkline[0].split("_")[4],g==r[e]&&u.XLSparkline._sparklineResize(h[0],{width:t},f));for(s=0,d=w.length;s<d;s++)o=u._getCellIdx(w[s]),u._textClip(o.rowIndex,o.colIndex,"delete","",!0),u._textClip(o.rowIndex,o.colIndex,"add","",!0)}}it.find(".e-columnheader").css("cursor","default");u._dupDetails||(b={sheetIndex:f,cols:r,newWidth:t,oldWidth:i,reqType:"resize-column"},i!==t&&(u._completeAction(b),u._trigActionComplete(b)));u._dupDetails&&(u._dupDetails=!1);u.XLScroll._getColWidths(f,r[0]);u.model.scrollSettings.allowScrolling&&(u.XLScroll._refreshScroller(f,"refresh","all"),u.XLScroll._getFirstColumn(f));u.XLSparkline&&u.XLSparkline._refreshSparklinePos({rowIndex:0,colIndex:r[0]},f)}},_calculateWidth:function(){for(var t=this.XLObj,i=t._getJSSheetHeader(t.getActiveSheetIndex()).find("col"),r=0,n=0;n<i.length;n++)r+=i.eq(n).width();return r},_cMouseUp:function(n){if(this._resizeStart){var r,i=this.XLObj,u=this._currentHCell,f=i.getSheet(i.getActiveSheetIndex()).columnsWidthCollection,t={};if(r=i._setXY(n,navigator.userAgent.indexOf("WebKit")>-1)[0],r+=document.documentElement.scrollLeft,t.event=n,t.target=n.target,t.oldWidth=f[u],t.colIndex=this._currentHCell,this._reSize(r),t.newWidth=f[u],t.reqType="column-resize",this.XLObj._trigger("resizeEnd",t))return;i.element.find("#"+i._id+"ddl").ejDropDownList("hidePopup")}},_getResizableCell:function(n){var i=this.XLObj,u=i.getActiveSheetIndex(),f=i._getJSSheetHeader(u).find(".e-columnheader"),r,h=navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollLeft:document.documentElement.scrollLeft,e,o,t,s;for(r=this._resizeStart?f.find(".e-headercell"):f.find(".e-headercell").not(".e-hide"),t=0,s=r.length;t<s;t++)if(o=r[t].getBoundingClientRect(),e=o.left+h+5,e>this._orgX){i.isUndefined(n)?this._currentHCell=this._getVisibleCell(r,t-1):n.target=i._getJSSheetHeader(u).find("th:eq("+(t-1)+")")[0];return}},_getVisibleCell:function(t,i){return n(t[i]).is(":visible")?i:this._getVisibleCell(t,i-1)},_moveVisual:function(n){var i=this.XLObj,t=i._getJSSheetHeader(i.getActiveSheetIndex()).find(".e-headercontent")[0].getBoundingClientRect();t.left+document.documentElement.scrollLeft+t.width<n||n<t.left+document.documentElement.scrollLeft?this._$visualElem.remove():this._currentHCell>-1&&this._$visualElem.css({left:n-1,top:this._tableY})},_rowMouseDown:function(t){var f,r,u,i={},e=this.XLObj;if(e._isTouchEvt&&this._rowMouseHover(t),this._allowStart&&n(t.target).css("cursor")==="row-resize"){if(u=e._setXY(t,navigator.userAgent.indexOf("WebKit")>-1),f=u[0],r=u[1],r+=document.documentElement.scrollTop,i.event=t,i.target=t.target,i.rowIndex=this._currentHCell,i.oldHeight=t.target.getBoundingClientRect().height,i.reqType="row-resize",this.XLObj._trigger("resizeStart",i))return;t.button!==2&&this._rowStart(f,r);this._resizeType="Row";t.preventDefault()}return!1},_rowMouseHover:function(t){var r;if(!this._$visualElem.is(":visible")&&(r=n(t.target),r.hasClass("e-rowheader"))){var i=this.XLObj,o=i.getActiveSheetIndex(),h=i._getJSSheetRowHeaderContent(o),e=r.get(0),u=e.getBoundingClientRect(),s=i._setXY(t),c=s[0],f=s[1],l=i._getJSSheetRowHeader(o).find(".e-table").height()+h.find("tbody").offset().top;if((f>=u.top+document.documentElement.scrollTop+e.offsetHeight-(i._isTouchEvt?8:7)||f<u.top+(i._isTouchEvt?8:0))&&f<l&&f>=u.top&&c<=u.left+document.documentElement.scrollLeft+t.target.offsetWidth){if(this._resizeElt=r.parent(),this._currentHCell=i.model.scrollSettings.allowVirtualScrolling?parseInt(this._resizeElt.attr("data-idx")):this._resizeElt[0].rowIndex,this._currentHCell<1&&f<u.top+e.offsetHeight-(i._isTouchEvt?8:5)||this._preventRowResize(this._currentHCell,!1))return;r.addClass("e-ss-rowresize");this._allowStart=!0}else n(".e-ss-rowresize").removeClass("e-ss-rowresize"),this._allowStart=!1,this._currentHCell=-1;this._resizerowId=t.target.parentNode.getAttribute("data-idx")}},_preventRowResize:function(n,t){this._currentHCell=n;var r=this.XLObj,c=r.getActiveSheetIndex(),s=r.getSheet(c).pivotMngr.pivot,u=r.getObjectKeys(s),f,o,h,e,i,l=u.length;if(u.length)for(i=0;i<l;i++)return f=s[u[i]].rowIndex,h=r.element.find("#"+u[i]).data("ejPivotGrid"),e=h._rowCount,e||(e=4),o=f+e,t?this._currentHCell>=f&&this._currentHCell<o:this._currentHCell>=f-1&&this._currentHCell<=o},_rowStart:function(t,i){var r=this.XLObj,f=r.getActiveSheetIndex(),e=this._resizeElt[0].rowIndex,o=r._getJSSheetRowHeader(f).find(".e-rowheader"),u,s,h;(this._currentHCell>-1&&e<o.length&&(u=o[e]),u)&&(s=u.getBoundingClientRect(),this._tableX=s.left+parseInt(navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollLeft:document.documentElement.scrollLeft),this._allowStart?(this._$visualElem=n(document.createElement("div")),h=r._getJSSheetContent(f).width(),this._$visualElem.addClass("e-reSizeRowbg").appendTo(r.element).css({width:h+"px"}).addClass("e-ss-rowresize"),this._$visualElem.css({top:i-3,left:this._tableX}),this._oldHeight=u.offsetHeight,this._orgX=t,this._orgY=i,this._extra=i-this._orgY,this._resizeStart=!0):this._currentHCell=-1)},_rMouseMove:function(t){if(this._resizeStart){var i=this.XLObj._setXY(t,navigator.userAgent.indexOf("WebKit")>-1)[1];i+=document.documentElement.scrollTop;t.preventDefault();n(t.target).addClass("e-ss-rowresize");this._moveRowVisual(i)}else this._rowMouseHover(t)},_rowResize:function(t,i){var u,r=this.XLObj,f=r.getActiveSheetIndex(),p=r.getRows(f)[1],s=!1,h,w=r._getJSSheetRowHeaderContent(f),l=w.find(".e-rowselected"),a=l.length,e,v,c=[],y=0,o;if(this._initialTableHeight=r._getJSSheetRowHeader(f).find(".e-rowheadercontent").height(),this._getResizableRowCell(),s=n(p[this._currentHCell]).find(".e-sswraptext").length>0,this._currentHCell>-1&&this._resizeStart){for(o=0;o<=this._resizerowId;o++)r.XLEdit.getPropertyValue(o,0,"isRHide")&&y++;if(u=r.getSheet(f).rowsHeightCollection[this._currentHCell+y],!s||s&&i-this._orgY+u>u){for(a>0&&(e=l[0].parentNode.rowIndex),h=0;h<a;h++)this._currentHCell===e&&(v=!0),c.push(e),e++;v||(c=[this._currentHCell]);this._resizeRowUsingDiff(i-this._orgY+u,u,c)}r.model.allowAutoFill&&(r.XLDragFill.positionAutoFillElement(),r.XLDragFill.hideAutoFillOptions());r._isAutoWHMode&&r.model.showRibbon&&r._autoSSWidthHeight(f,!0)}r.model.allowSelection&&r.XLSelection._refreshBorder();this._removeVisualElem()},_resizeRowUsingDiff:function(t,i,r){var e,p,w,u=this.XLObj,f=u.getActiveSheetIndex(),c={},l=u._getJSSheetRowHeaderContent(f),b,k,d,o,a,v,h,y,s;if(t>0){for(t=t>this._rowMinHeight?t:this._rowMinHeight,e=0,b=r.length;e<b;e++){if(o=r[e],a=u.model.scrollSettings.allowVirtualScrolling?u.getSheet(f)._virtualRowIdx.indexOf(o):o,v=this._getContentHeight(o,f)<=t,u._isRowViewable(f,o)&&(u._isUndoRedo||v))for(k=l.find("tr:eq("+a+")"),d=u._getJSSheetContent(f).find(".e-content").find("tr:eq("+a+")"),k.outerHeight(t),d.height(t),y=u.getSheet(f).usedRange.colIndex,s=0;s<=y;s++)h=u.XLEdit.getPropertyValue(r[e],s,"sparkline",f),h&&(u.XLScroll._getRowHeights(f,r[0]),p=u._getCellInfo({rowIndex:r[e],colIndex:y},1),n("#"+h[0]).css({top:p.top}),w=u._dataContainer.sheets[f][r[e]][s].sparkline[0].split("_")[3],w==r[e]&&u.XLSparkline._sparklineResize(h[0],{height:t},f));u.XLShape&&u.XLShape._refreshShapePosOnResize(r[e],t,!1,f);(u._isUndoRedo||v)&&(u.getSheet(f).rowsHeightCollection[o]=t)}u.XLScroll._getRowHeights(f,r[0]);l.find("tbody").css("cursor","default");l.find("tbody").children().css("cursor","default");u._dupDetails||(c={sheetIndex:f,rows:r,newHeight:t,oldHeight:i,reqType:"resize-row"},i===t||u._dupDetails||(u._completeAction(c),u._trigActionComplete(c)));u.model.allowFreezing&&u.XLFreeze._refreshFRowResize(o);u.model.scrollSettings.allowScrolling&&(u.XLScroll._refreshScroller(f,"refresh","all"),u.XLScroll._getFirstRow(f));u.XLSparkline&&u.XLSparkline._refreshSparklinePos({rowIndex:r[0],colIndex:0},f)}},_findRowsHeight:function(n){for(var t=this.XLObj,i=t.getActiveSheetIndex(),f=t.getSheet(i),e=t._getJSSheetContent(i).find("tbody").children(),r,u=0,o=n.length;u<o;u++)r=n[u],t._sheets[i]._Rows[0]&&(f.rowsHeightCollection[r]=e.eq(r).height())},_calculateHeight:function(){for(var t=this.XLObj,i=t.getRows(t.getActiveSheetIndex())[0],r=0,n=0,u=i.length;n<u;n++)r+=i.eq(n).height();return r},_rMouseUp:function(t){if(this._resizeStart){var r=this.XLObj,f=this._currentHCell,e=r.getSheet(r.getActiveSheetIndex()).rowsHeightCollection,i={},o,u,s=r._setXY(t,navigator.userAgent.indexOf("WebKit")>-1);if(o=s[0],u=s[1],u+=document.documentElement.scrollTop,i.event=t,i.target=t.target,i.oldHeight=e[f],i.rowIndex=this._currentHCell,this._rowResize(o,u),i.newHeight=e[f],i.reqType="row-resize",this.XLObj._trigger("resizeEnd",i))return;n("#"+this.XLObj._id+"ddlspan").length&&this.XLObj._ddlPosition()}},_getResizableRowCell:function(t){for(var r=this.XLObj,e=r.getActiveSheetIndex(),u=r._getJSSheetContent(e).find(".e-rowheader"),c=navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollTop:document.documentElement.scrollTop,o,f,s=1,h,i=0,l=u.length;i<l;i++)if(f=u[i].getBoundingClientRect(),f.top===0&&s++,o=f.top+c+5,o>this._orgY){r.isUndefined(t)?(h=n(u[i-1]).is(":visible")?i-1:i-s,this._currentHCell=r._getCellIdx(u[h]).rowIndex):t.target=r._getJSSheetRowHeader(e).find("tr:eq("+i+") td")[0];return}},_moveRowVisual:function(n){var i=this.XLObj,t=i._getJSSheetContent(i.getActiveSheetIndex()).find(".e-rowheadercontent")[0].getBoundingClientRect();t.top+document.documentElement.scrollTop+t.height<n||n<t.top+document.documentElement.scrollTop?this._$visualElem.remove():this._currentHCell>-1&&this._$visualElem.css({top:n-3,left:this._tableX})},_apMouseDown:function(t){var i,r=this.XLObj;return r._isTouchEvt&&this._apMouseHover(t),this._allowStart&&n(t.target).closest("div").css("cursor")==="col-resize"&&(i=r._setXY(t,navigator.userAgent.indexOf("WebKit")>-1)[0],i+=document.documentElement.scrollLeft,t.button!==2&&this._apStart(i),this._resizeType="AP",t.preventDefault()),!1},_apMouseHover:function(t){var i=this.XLObj;if(!this._$visualElem.is(":visible")){var f=n(t.target),r=i.getActivationPanel()[0].getBoundingClientRect(),u=i._setXY(t)[0];u<=r.left+(i._isTouchEvt?20:4)&&u>=r.left?(f.parent().addClass("e-ss-apresize"),this._allowStart=!0):(i.element.find(".e-ss-apresize").removeClass("e-ss-apresize"),this._allowStart=!1)}},_apStart:function(t){var i=this.XLObj,f=i.getActivationPanel()[0],e=f.getBoundingClientRect(),r=i.getActiveSheetIndex(),u;this._tableY=e.top+parseInt(navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollTop:document.documentElement.scrollTop);this._allowStart&&(this._$visualElem=n(document.createElement("div")),u=i._getJSSheetContent(r).height()+i._getJSSheetHeader(r).height(),this._$visualElem.addClass("e-reSizeAPbg").appendTo(i.element).css({height:u+"px"}).addClass("e-ss-apresize"),this._$visualElem.css({left:t,top:this._tableY}),this._resizeStart=!0)},_apMouseMove:function(n){if(this._resizeStart){var i=this.XLObj,t=i._setXY(n,navigator.userAgent.indexOf("WebKit")>-1)[0];t+=document.documentElement.scrollLeft;n.preventDefault();this._apMoveVisual(t)}else this._apMouseHover(n)},_apMouseUp:function(n){if(this._resizeStart){var i=this.XLObj,t=i._setXY(n,navigator.userAgent.indexOf("WebKit")>-1)[0];t+=document.documentElement.scrollLeft;this._apReSize(t)}},_apMoveVisual:function(n){this._$visualElem.css({left:n-5,top:this._tableY})},_apReSize:function(t){var i=this.XLObj,s=i.model.activationPanelWidth,f=0,r=n.extend(!0,{},i.model.scrollSettings),e=i.getActivationPanel(),o,u;r.width=i._responsiveWidth;r.height=i._responsiveHeight;i.model.activationPanelWidth=Math.abs(r.width-(t-i.element.offset().left));i.model.enablePivotTable&&(u=i.getActivationPanel().data("ejScroller"),f=i.getActivationPanel().find(".e-vscrollbar").length?20:2,e.find(".e-ss-pivotfield").width(i.model.activationPanelWidth-f),e.find("#"+i._id+"_PivotField").width(i.model.activationPanelWidth-f),s>i.model.activationPanelWidth?(u.option({width:i.model.activationPanelWidth-1}),i._setSheetWidthHeight(i.getActiveSheetIndex(),{width:r.width,height:r.height},null,"resize")):(i._setSheetWidthHeight(i.getActiveSheetIndex(),{width:r.width,height:r.height},null,"resize"),u.option({width:i.model.activationPanelWidth-1})),o=i.getActivationPanel().find("#"+i._id+"_PivotTableSchema_"+i._getContent(i.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).data("ejPivotSchemaDesigner"),o._reSizeHandler(),u.refresh());this._removeVisualElem()},_removeVisualElem:function(){var n=this.XLObj;this._$visualElem.remove();n.element.find(".e-reSizeRowbg").remove();this._resizeStart=!1;this._currentHCell=-1;this._resizeType="";this._allowStart=!1;n.model.allowComments&&n.XLComment._updateCmntArrowPos()},fitWidth:function(n){var t=this.XLObj,r=t.getActiveSheetIndex(),i,u;if(t.model.allowResizing){for(i=0,u=n.length;i<u;i++)this._fitWidth(n[i],0,t.getSheet(r).usedRange.rowIndex);t.model.scrollSettings.allowScrolling&&(t.XLScroll._getColWidths(r,n[0]+1),t.XLScroll._refreshScroller(r,"refresh","horizontal"));t.model.allowSelection&&t.XLSelection._refreshBorder();t.model.allowComments&&t.XLComment._updateCmntArrowPos(null,r,{colIndex:n[i]})}},_resizeToFitWidth:function(n){var t=this.XLObj,i=t.getActiveSheetIndex(),r=t.getSheet(i).usedRange.rowIndex,u=n.target.cellIndex;this._getResizableCell(n);this._fitWidth(u,0,r);t.model.scrollSettings.allowScrolling&&(t.XLScroll._getColWidths(t.getActiveSheetIndex(),n.target.cellIndex+1),t.XLScroll._refreshScroller(i,"refresh","horizontal"));t.model.allowSelection&&t.XLSelection._refreshBorder();t.model.allowAutoFill&&t.XLDragFill.positionAutoFillElement();t.model.allowComments&&t.XLComment._updateCmntArrowPos(null,i,{colIndex:n.target.cellIndex})},_fitWidth:function(t,i,r){var h,u=this.XLObj,f=u.getActiveSheetIndex(),o=u._getJSSheetHeader(f).find(".e-headercell")[t],y=n(o).children(".e-headercelldiv"),e=0,c=0,s=0,l=u.getSheet(f),a,v;if(r=r?r:l.usedRange.rowIndex,s=Math.round(this._getContentWidth(t,f,i,r)),c=this._getHeaderContentWidth(y,f),s>1&&(e=c>s?c:s,a={target:o,sheetIndex:f,colIndex:t,newWidth:e,oldWidth:o.offsetWidth,reqType:"resize-fit-width"},e>0)){for(e<20&&(e=30),v=i;v<=r+1;v++)h=u.XLEdit.getPropertyValue(i,t,"sparkline",f),h&&u.XLSparkline._sparklineResize(h[0],{width:e},f),i++;u.XLShape&&u.XLShape._refreshShapePosOnResize(t,e,!0,f);this._applyWidth(o,f,t,e);u.model.allowFreezing&&u.XLFreeze._refreshFColResize(t);u.model.allowAutoFill&&u.XLDragFill.positionAutoFillElement();l._isImported&&!l._isLoaded||u._isUndoRedo||u._dupDetails||u._isExport||(u._completeAction(a),u._trigActionComplete(a))}u.XLEdit._updateDataContainer({rowIndex:0,colIndex:t},{dataObj:{isFitWidth:!0}})},_applyWidth:function(n,t,i,r){var u=this.XLObj;u._getJSSheetHeader(t).find("col:eq("+i+")").width(r);u._getJSSheetContent(t).find("col:eq("+(i+1)+")").width(r);u.getSheet(t).columnsWidthCollection[i]=r;u.getSheet(t).columns[i].width=r},_getContentWidth:function(n,r,u,f){var e,a=0,h,c,o=this.XLObj,v=o._dataContainer.sheets[r],s,l=o.getSheet(r),y=o._getSelectedCells(r,[u,n,f,n]).selCells;for(y.length&&(delete l._wrapValColl.cols[n],o._wrapTextLenCln(y,l,"isFitWidth",r)),e=u;e<=f;e++)t.isNullOrUndefined(v[e])||(h=v[e][n]),t.isNullOrUndefined(h)?(h={},c={spanWidth:0,paddingWidth:0}):c=this._getCalculatedCellWidth(r,h),s=l._wrapValColl.cols[n]&&l._wrapValColl.cols[n][e]?o._detailsFromGlobalSpan(e,n,"width",o.XLEdit.getPropertyValue(e,n,"value2"),i,!0):0,s=s+c.spanWidth+c.paddingWidth+4,s>a&&(a=s);return a},_getCalculatedCellWidth:function(n,t){var i=0,r=0;return"isFilterHeader"in t?"isFilterVisible"in t&&(i+=17):i+=0,r=3,{spanWidth:i,paddingWidth:r}},_getHeaderContentWidth:function(n){var i=0,r=t.buildTag("span",{},{}),u=n.html();return r.html(u),n.html(r),i=n.find("span:first").width(),i=i+10,n.html(u),i},fitHeight:function(n){var t=this.XLObj,r,i,u;if(t.model.allowResizing){for(r=t.getActiveSheetIndex(),i=0,u=n.length;i<u;i++)this._fitHeight(n[i],n[i]),t._setRowHdrHeight(r,n[i]);t.model.scrollSettings.allowScrolling&&(t.XLScroll._getRowHeights(r,n[0]),t.XLScroll._refreshScroller(r,"refresh","vertical"));t.model.allowSelection&&t.XLSelection._refreshBorder();t.model.allowComments&&t.XLComment._updateCmntArrowPos(null,r,{rowIndex:n[0]})}},_resizeToFitHeight:function(n){var t=this.XLObj,i=t.getActiveSheetIndex(),r=n.target.parentNode.rowIndex,u;u=t.model.scrollSettings.allowVirtualScrolling?t.getSheet(i)._virtualRowIdx[r]:r;this._getResizableRowCell(n);this._fitHeight(r,u);t._setRowHdrHeight(i,u);t.model.scrollSettings.allowScrolling&&(t.XLScroll._getRowHeights(t.getActiveSheetIndex(),u),t.XLScroll._refreshScroller(i,"refresh","vertical"));t.model.allowSelection&&t.XLSelection._refreshBorder();t.model.allowAutoFill&&t.XLDragFill.positionAutoFillElement();t.model.allowComments&&t.XLComment._updateCmntArrowPos(null,i,{rowIndex:r})},_fitHeight:function(i,r){var s,h,u=this.XLObj,f=u.getActiveSheetIndex(),c=u.getSheet(f),y=u._getJSSheetRowHeader(f).find(".e-rowheader")[i],e=0,l=0,o,p=t.buildTag("span",{},{height:20,width:30}),a,v;for(l=this._getContentHeight(r,f,u.XLEdit.getPropertyValue(r,0,"wrapRow")),p.html(r+1),u.element.append(p),o=u.element.find("span:last").outerHeight(!0),u.element.find("span:last").remove(),o=o+4,e=l<o?o:l,a={target:y,sheetIndex:f,rowIndex:r,newHeight:e,oldHeight:c.rowsHeightCollection[i],reqType:"resize-fit-height"},u.XLShape&&u.XLShape._refreshShapePosOnResize(i,e,!1,f),u._isRowViewable(f,r)&&(n(y.parentElement).height(e),n(u._getContent(f).find("tr")[i]).height(e)),u.getSheet(f).rowsHeightCollection[r]=e,s=u.getSheet(f).usedRange.colIndex,v=0;v<=s;v++)h=u.XLEdit.getPropertyValue(i,s,"sparkline",f),h&&u.XLSparkline._sparklineResize(h[0],{height:e},f);u.model.allowFreezing&&u.XLFreeze._refreshFRowResize(i);u.model.scrollSettings.allowScrolling&&u.XLScroll._refreshScroller(f,"refresh","all");c._isImported&&!c._isLoaded||u._dupDetails||u._isExport||(u._completeAction(a),u._trigActionComplete(a));u.model.allowAutoFill&&u.XLDragFill.positionAutoFillElement();u.XLEdit._updateDataContainer({rowIndex:r,colIndex:0},{dataObj:{isFitHeight:!0}})},_getContentHeight:function(n,t,r){for(var f=this.XLObj,s=0,h,c=f.getSheet(t),e=f.getObjectKeys(f._dataContainer.sheets[t][n]),l=c.rowsHeightCollection,a=c.columnsWidthCollection,o,u=0,v=e.length;u<v;u++)o=f.getRangeData({range:[n,e[u],n,e[u]],property:["value2","merge"]})[0],o&&(h=o.merge?l[n]:f._detailsFromGlobalSpan(n,e[u],"height",o.value2,r?a[u]:i,!0),h>s&&(s=h));return s},_setRowHdrHeightResize:function(i,r){for(var e,f=this.XLObj,o=f.getRows(i),s=o[0],h=f.getSheet(i).usedRange.rowIndex,u=0;u<=h;u++)t.isNullOrUndefined(f.XLEdit.getPropertyValue(u,r,"mergeIdx"))&&t.isNullOrUndefined(f.XLEdit.getPropertyValue(u,r,"merge"))&&f._isRowViewable(i,u)&&(e=f._detailsFromGlobalSpan(u,r,"height",f.XLEdit.getPropertyValue(u,r,"value2")),n(s[u]).height(e))}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.editing=function(n){this.XLObj=n;this._EditCellDetails={value:null,rowIndex:-1,columnIndex:-1,fieldName:null,cell:null};this._isEdit=!1;this._isFEdit=!1;this._isFormulaEdit=!1;this._isFBarFocused=!1;this._skipHTML=!1;this._editElem=null;this._filterIcon=null;this._isCellEdit=!0;this._validOperators=["+","-","*","/",","];this._invalidOperators=["%"];this._validCharacters=["+","-","*","/",",","(","=","&"];this._textDecoration=!1;this._editCell=null;this._acPosition={left:0,top:0};this._isValidation=!1;this._cursorPosn=-1;this._formulaArrayRange="";this._formatCellVal=null;this._sheetNameSpclchar=!1;this._singleQuote=!1;this._isSplChar=!1};t.spreadsheetFeatures.editing.prototype={getCurrentEditCellData:function(){var r,n,t=this.XLObj,i;return this._isEdit?(r=t.element.find("#"+t._id+"_Edit"),n=r.text(),i=t._getCellIdx(this._editCell[0]),this.getPropertyValue(i.rowIndex,i.colIndex,"type")!="text"&&t.model.locale=="en-US"&&t.isNumber(n)&&(n=parseFloat(n)),n):null},getColumnIndexByField:function(n){for(var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()),t=0,u=r.columns.length;t<u;t++)if(r.columns[t].field===n)break;return t},_processEditing:function(){this._editElem||(this._editElem=t.buildTag("div.e-field e-ss-input","",{},{id:this.XLObj._id+"_Edit",contenteditable:!0}),this._editElem.data("parentID",this.XLObj._id))},editCell:function(i,r,u){var f=this.XLObj,h,b,a,s,e,k,o,tt,c,v,it,rt,y,p,ut,ft,d,g,et,l,w,nt;if(f.model.allowEditing&&f.model.allowSelection&&!f._isCellProtected(i,r,!0)&&!f.model.isReadOnly){if((ut=f.element.find("#"+f._id+"_ValElem"),l=f.XLEdit.getPropertyValue(i,r,"merge"),!f._intrnlReq&&f.XLEdit.getPropertyValue(i,r,"mergeIdx"))||(v={rowIndex:i,colIndex:r},s=f.getActiveSheetIndex(),e=f.getSheet(s),h=f.getActiveCell(s),f._isRowViewable(s,i)&&(this._textDecoration=f.getCell(i,r).find("a").css("text-decoration")==="none"),c=f.getCell(i,r),a=e.columns[r],this._editCell=c,o={columnName:a.field,value:f.getRangeData({range:[i,r,i,r],valueOnly:!0,sheetIdx:s,skipDateTime:!0})[0],columnObject:a,cell:c,rowIndex:i,colIndex:r},!f.isFormula(o.value)&&["longdate","shortdate","date","time"].indexOf(this.getPropertyValue(i,r,"type",s))>-1&&!f.isNumber(this.getPropertyValue(i,r,"value",s))&&(o.value=f._getEditValOfDateTime(i,r)),f.model.locale!="en-US"&&f.isNumber(o.value)&&(ft=this.getPropertyValue(i,r,"value2",s),d=o.value+"",g=t.preferredCulture(f.model.locale).numberFormat,et=new RegExp("\\"+g[","]+"\\d{3}"),g[","]=="."&&(et.test(d)||o.value!=ft)&&(o.value=f._getlocaleNumVal(d,!0))),f._trigger("cellEdit",o)))return!1;f._cureditedCell=o.value;this._isValidation&&(ut.rules("remove"),this._isValidation=!1);h.rowIndex===i&&h.colIndex===r||l||(e._activeCell=v,e._startCell.rowIndex<=i&&e._startCell.colIndex<=r&&e._endCell.rowIndex>=i&&e._endCell.colIndex>=r?f.XLSelection.selectRange(e._startCell,e._endCell):f.XLSelection.selectRange(v,v),f.model.allowAutoFill&&f.XLDragFill.positionAutoFillElement());!f._intrnlReq&&l&&(f.XLSelection.selectRange(l.mRange),f.model.allowAutoFill&&f.XLDragFill.positionAutoFillElement());this._EditCellDetails={rowIndex:i,value:o.value,columnIndex:r,fieldName:a.field,cell:c};u||(o.value="");nt=f.XLEdit.getPropertyValue(i,r,"value");w=f.isFormula(nt)?nt:f.XLEdit.getPropertyValue(i,r,"value2");tt=u?t.isNullOrUndefined(w)?o.value:w.toString().indexOf("%")>-1?w:o.value:o.value;this._renderBulkEditObject(o,c,tt);this.getPropertyValue(e._activeCell.rowIndex,e._activeCell.colIndex,"rule",s)&&f.model.allowDataValidation&&f.XLValidate._setValidation();k=n("#"+f._id+"_Edit");this.getPropertyValue(i,r,"hyperlink",s)&&k.addClass("e-hyperlinks");this._textDecoration&&k.css("text-decoration","none");f.model.allowComments&&c.hasClass("e-commentcell")&&f.XLComment._visibleCmntCnt(c);o.cell.addClass(f._browserDetails.name==="msie"?"e-editedcell e-msie-edit":"e-editedcell");f.isFormula(o.value)&&this._processFormulaEditRange(o.value);f.model.allowKeyboardNavigation&&(f.XLCellNav._isNavigate=!1);f.model.enableContextMenu&&n("#"+f._id+"_contextMenuCell").data("ejMenu")._contextMenuEvents("_off");l&&(b=f.getCell(i,r).find("#"+f._id+"_Merge")[0],b&&(b.innerHTML=""));it=f.getFrozenColumns()?e._leftCol.idx:0;e._rightCol.idx+it===h.colIndex&&h.colIndex!=e.colCount-1&&this._isEdit&&(y=f._getIdxWithOffset(null,e._scrollLeft,!0),f.getFrozenColumns()&&(p=parseInt(f.element.find("#"+f._id+"_Edit")[0].style.left),f.element.find("#"+f._id+"_Edit")[0].style.left=p-e.columnsWidthCollection[y.colIdx]+"px"));rt=f.getFrozenRows()?e._topRow.idx:0;e._bottomRow.idx+rt===h.rowIndex&&h.rowIndex!=e.rowCount-1&&this._isEdit&&(y=f._getIdxWithOffset(e._scrollTop,null,!0),f.getFrozenRows()&&(p=parseInt(f.element.find("#"+f._id+"_Edit")[0].style.left),f.element.find("#"+f._id+"_Edit")[0].style.left=p-e.columnsWidthCollection[y.colIdx]+"px"))}},_renderBulkEditObject:function(i,r,u){var s,a,f=this.XLObj,v=r.height(),o=f.getActiveSheetIndex(),h=r.find(".e-filterspan"),l=f._getJSSheetContent(o).find(".e-spreadsheetcontentcontainer > .e-content"),y=f.XLFormat.getFormatClass(r[0].className),c,e;({})[i.columnObject.field]=i.value;h.length&&(a={filterIcon:h,rowIndex:h.parentsUntil("table").eq(1).index(),colIndex:h.parent().index()},this._filterIcon=a);s=r.height();this._refreshTextNode(r[0]);r.hasClass("e-sswraptext")&&v!==s&&r.height(v);e=this._editElem;e.text("");t.isNullOrUndefined(u)||e.text(u);l.append(e);c=f._isClassHasProperty(y,"text-align","right")?{right:l.width()-r[0].offsetLeft-r[0].offsetWidth+2,left:"",maxWidth:r[0].offsetLeft+r[0].offsetWidth+2}:{left:r[0].offsetLeft+2,right:"",maxWidth:l.width()-(r.offset().left-(f.element.offset().left+n(f.getRows(o)[0][0]).width()))-2};e.css({left:c.left,right:c.right,top:r[0].offsetTop+1,"-webkit-user-select":"text",cursor:"text","min-height":s-1,height:"auto",lineHeight:"normal",wordWrap:"break-word",position:"absolute",minWidth:r.width(),whiteSpace:"pre-wrap"});this._editCell.hasClass("e-sswraptext")?(e.css({width:r.width(),maxWidth:""}),n(f.getRows(o)[1][r.parent().attr("data-idx")]).height(f.model.sheets[o].rowsHeightCollection[r.parent().attr("idx")]),f.XLScroll._getRowHeights(o,r.parent().index())):e.css({width:"",maxWidth:c.maxWidth});e.show();this._refreshEditForm(r,e,i.value,u,s);this._isEdit=!0;f.model.showRibbon&&f.XLRibbon._disableRibbonIcons()},_refreshEditForm:function(t,i,r,u){var o,e,f=this.XLObj;i[0].className="";e=this.getPropertyValueByElem(t,"type")||"";e!="percentage"||f.isFormula(r)||u.indexOf("%")>-1||i.prepend("%");!f.isNumber(u)||e.indexOf("text")>-1||i.addClass("e-ralign");(e.indexOf("date")>-1||e.indexOf("time")>-1)&&i.addClass("e-ralign");i.css({border:"none",outline:"none"});this.XLObj.model.allowCellFormatting&&(o=f.XLFormat.getFormatClass(t[0].className));i.addClass(o);f.model.allowCellFormatting&&(i.css({color:t.css("color")}),i.css({"background-color":t.css("background-color")}));i.on("keyup",{xlObj:f},function(t){var i=t.data.xlObj;i.XLEdit._isFormulaEdit=!n(t.target).text().indexOf("=");i.XLEdit._isFormulaEdit&&i.XLEdit._processFormulaEditRange(n(t.target).text());i.model.allowFormulaBar&&i._getInputBox().val(n(t.target).text());i.XLEdit._isCellEdit=!0});i.on("focus",{xlObj:f},function(n){var t=n.data.xlObj;t.XLEdit._isCellEdit=!0});f._setFormulaSuggElem(n("#"+f._id+"_AutoComplete_suggestion"));e=="percentage"?i.focus():i.focusEnd()},_renderAutoComplete:function(t,i,r,u){var f=this.XLObj,e=u?" e-cell-ac e-ss-editinput":"";t.ejAutocomplete({dataSource:f._formulaCollection,value:i,cssClass:"e-ss-autocomplete"+e,width:"100%",height:r,htmlattributes:u?{display:"none"}:"",delaySuggestionTimeout:10,minCharacter:2,popupWidth:"170px",popupHeight:"150px",showEmptyResultText:!1,autoFocus:!0,template:"<span class='e-icon e-ss-function'> <\/span><div> ${display} <\/div>",select:n.proxy(this._formulaSelect,f),open:n.proxy(this._formulaSuggestionStatus,f),close:n.proxy(this._formulaSuggestionStatus,f)});t.data("ejAutocomplete")._bubbleEvent(!0)},_refreshAutoComplete:function(t){var i=this.XLObj,r,u,f="ejAutocomplete",e="dataSource";u=n("#"+i._id+"_inputbox").data(f);r=n("#"+i._id+"_AutoComplete").data(f);i.model.allowFormulaBar&&u&&u.option(e,t?i._tableFormulaCollection[t]:i._formulaCollection);r&&r.option(e,t?i._tableFormulaCollection[t]:i._formulaCollection)},_captureEditing:function(t){var i=this.XLObj,r,o,s,f,e=document.activeElement,c=i.getActiveCell(),h=n("#"+i._id+"_AutoComplete_suggestion"),u;e&&e.tagName==="DIV"&&i._isRowViewable(null,c.rowIndex)&&(r=i.element.find("#"+i._id+"_AutoComplete"),t?r.val("["):r.val(n(e).text()),r.data("ejAutocomplete").search(),u=h.find("li span.e-ss-function"),t?u.removeClass("e-ss-function"):u&&u.addClass("e-ss-function"),o=i.getActiveCellElem(),s=i.element.find("#"+i._id+"_Edit")[0],f=o[0].getBoundingClientRect(),this._acPosition.left=f.left+window.pageXOffset,this._acPosition.top=f.top+window.pageYOffset+n(s).height(),h.css({left:this._acPosition.left,top:this._acPosition.top}))},saveCell:function(){var t=this.XLObj,b,v,y,p,g,o,c,a,ht,nt,s,tt,it,rt,k,d,ct,i,r,u,ut,e,f,h,lt,l,ft,at,et,vt,w,ot,st,yt,pt;if(t.model.allowEditing&&!t.model.isReadOnly&&(this._cursorPosn=-1,ft=!1,at=["ABS","LEFT","RIGHT","TRIM","UPPER","VALUE","YEAR"],this._isEdit)){if(f=t.getActiveSheetIndex(),h=t.getSheet(f),p=n("#"+t._id+"EditForm"),tt=this._editCell,nt=h.columns[this._EditCellDetails.columnIndex],it=t.element.find("#"+t._id+"_ValElem"),vt=t.element.find("#"+t._id+"_Edit")[0],w=n(vt).html(),rt=t._getCellIdx(tt[0]),i=rt.rowIndex,r=rt.colIndex,u={columnName:nt.field,value:this.getCurrentEditCellData(),prevValue:this._EditCellDetails.value,columnObject:nt,rowIndex:i,colIndex:r,cell:tt,isRefCells:!1,sheetIdx:f},this.getPropertyValue(i,r,"hasMultipleFormulaArray")){t.XLCellNav&&(t.XLCellNav._isNavigate=!0);t._showAlertDlg("Alert","ArrayaFormula","multipleArrayFormula",430);t.XLSelection._clearBorder(t._arrayAsString(t._ctrlFormulaBorder.concat(t._formulaBorder)));return}if(t.model.allowDataValidation&&this._isValidation){if(it.val(u.value),p.css("display","block"),!p.validate().element(it[0]))return p.css("display","none"),!1;p.css("display","none");u.hasValidation=!0}if(u.value!==u.prevValue&&t._trigger("cellSave",u))return;if(a=t.getRangeData({range:[i,r,i,r],property:["type","formatStr","decimalPlaces"]})[0],t.isFormula(u.value))if(this._formulaValidate(u.value))ot=u.value.indexOf("(worksheet)")>-1&&u.value.split(" (worksheet)")[0].replace("=",""),u.value=h._scopeRanges[ot]?"="+h._scopeRanges[ot].name:u.value;else return;if(ut=this._EditCellDetails.value||"",e={sheetIndex:f,rowIndex:i,colIndex:r,cValue:u.value,reqType:"edit",iconName:"",pValue:ut},e.prevHeight=h.rowsHeightCollection[i],t._dupDetails=!0,t.isFormula(u.value)&&(t._saveTriggered=!0),this._updateCellValue({rowIndex:i,colIndex:r},u.value),t.isFormula(u.value)&&(t._saveTriggered=!1),t._dupDetails=!1,this.getPropertyValue(i,r,"wrap",f)&&(ut.length!==u.value.length&&t._wrapTextLenCln([{rowIndex:i,colIndex:r}],h,"savcell",f),k=t._getWrapCellHeight(f,i,r),t._wrapCollection(i,r,k.cellHt,f),t._getRowHeight(i,f)<k.rowHt&&(t.setHeightToRows([{rowIndex:i,height:k.rowHt}]),t.model.allowAutoFill&&t.XLDragFill.positionAutoFillElement()),this._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{}})),t.XLEdit.getPropertyValue(i,r,"isFilterHeader")&&t._removeClass(u.cell[0],t._rAlign),this._textDecoration&&u.cell.find("a").css("text-decoration","none"),u.hasValidation&&(e.hasValidation=!0),t.isFormula(u.value)&&(!t.getObjectLength(a)||a.type==="general")&&(e.operation="formula",c=u.value,c=t.XLDragFill._parseFormula(c),at.indexOf(c[0])===-1)){for(v=0,ht=c.length;v<ht;v++)if(o=c[v],o.indexOf("!")>-1)et=t._getSheetIndexByName(o.split("!")[0]),f=et?et:f;else if(o!="("&&c[v+1]!="(")break;o.indexOf(":")>-1&&(o=o.split(":")[0]);t._isCellReference(o)&&(o=o.replace(/\$/g,""),lt=t.getRangeIndices(o),l=t.getRangeData({range:lt,property:["type","formatStr","decimalPlaces"],sheetIdx:f})[0],t.getObjectLength(l)&&l.type!=a.type&&l.type!=="general"&&l.type!=="shortdate"&&(t._dupDetails=!0,ft=!0,t.XLFormat.format(l,t._getAlphaRange(t.getActiveSheetIndex(),i,r,i,r)),t._dupDetails=!1,e.prevFrmtObj=t.getObjectLength(a)?a:{type:"general"},e.curFrmtObj=l))}if(t._setRowHdrHeight(f,i),t.model.scrollSettings.allowScrolling&&t.XLScroll._getRowHeights(f,i),this._isEdit=this._isFormulaEdit=!1,t.model.allowFormulaBar&&t.updateFormulaBar(),u.cell.removeClass("e-editedcell e-msie-edit"),t.model.allowKeyboardNavigation&&(t.XLCellNav._isNavigate=!0),t.model.showRibbon&&(t.XLRibbon._enableRibbonIcons(),t.XLRibbon._updateRibbonIcons()),t._updateUndoRedoIcons(),t.model.allowInsert||(t.XLRibbon._disableButtons(["Others_Cells_InsertCellOptions"],"ejSplitButton"),t.XLRibbon._disableButtons(["Others_Cells_InsertCell"],"ejButton")),t.model.allowDelete||(t.XLRibbon._disableButtons(["Others_Cells_DeleteCellOptions"],"ejSplitButton"),t.XLRibbon._disableButtons(["Others_Cells_DeleteCell"],"ejButton")),e.cFormatRule=d=this.getPropertyValue(i,r,"cFormatRule",f),t._dupDetails=!0,t.model.allowConditionalFormats&&d){for(b=0,ct=d.length;b<ct;b++)s=d[b].split("_"),s[0]!=="formularule"&&s[0]!=="colorscale"&&s[0]!=="databar"&&s[0]!=="iconset"&&t.XLCFormat._cFormat(s[0],s[2],s[3],s[4],s[5],t._generateHeaderText(r+1)+(i+1));(u.value!=u.prevValue||t.XLEdit.getPropertyValue(i,r,"merge"))&&t.XLCFormat.refreshCFormat(t._getAlphaRange(f,i,r,i,r))}return t._dupDetails=!1,e.endCell=h._endCell,e.startCell=h._startCell,y=t.getActiveCellElem(),y&&(t.model.allowComments&&y.hasClass("e-commentcell")&&t.XLComment._visibleCmntCnt(y,!0),y.hasClass("e-hlcell")&&t.XLValidate.highlightInvalidData()),this._shiftKeyEnabled=this._isFBarFocused=!1,t._ctrlKeyCount=0,!this._isFormulaEdit&&t.model.allowSelection&&t.XLSelection._clearBorder(t._formulaBorder.join(" ").replace(/,/g," ")+" "+t._ctrlFormulaBorder.join(" ").replace(/,/g," ")),t.model.allowFormulaBar&&(g=n("#"+t._id+"_inputbox").data("ejAutocomplete"),g&&g.hide()),this._editElem.hide(),t._setSheetFocus(),t._browserDetails.name==="mozilla"&&(w=w.slice(0,-4)),w.indexOf("\n")>-1&&(e.altwrap=!0,this._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{altTxt:!0}})),this.getPropertyValue(i,r,"altTxt",f)&&(this.getPropertyValue(i,r,"wrap",f)||t.wrapText([i,r,i,r]),w.match(/\n/g)||this._clearDataContainer({cellIdx:{rowIndex:i,colIndex:r},property:["altTxt"]})),st=this.getPropertyValue(i,r,"sparkline",f),t.model.allowSparkline&&st&&(yt=t.getCell(i,r,f).find(".e-sparkline"),yt.length<1&&(pt=h.shapeMngr.sparkline[st[0]],t.XLSparkline._createSparkline(pt,null,f))),e.newHeight=h.rowsHeightCollection[i],t.XLScroll._getRowHeights(f,i),t.model.enableContextMenu&&n("#"+t._id+"_contextMenuCell").data("ejMenu")._contextMenuEvents("_on"),(u.value!==u.prevValue||ft)&&(t._completeAction(e),t._trigActionComplete(e)),!0}},_getCellPosition:function(n,t){var s=this.XLObj,i=this._formulaArrayRange||s.getSheet(s.getActiveSheetIndex()).selectedRange,e=0,f={},h=i[2]-i[0],c=i[3]-i[1],o=!1,u,r;for(1<t&&(o=!0),u=0;u<=c;u++){for(r=0;r<=h;r++)s.isUndefined(f[i[0]+r])&&(f[i[0]+r]={}),n<=r||o&&t<=u?f[i[0]+r][i[1]+u]=-1:(f[i[0]+r][i[1]+u]=e,o||e++);o?e++:e=0}return f},_formulaValidate:function(n){for(var t,f,e,s,h,u,c,i=n,r=this.XLObj,l=r.model.customFormulas,a=["RAND","TODAY","NOW","TRUE","FALSE","ROW","COLUMN","SHEET","SHEETS"],y=n.split("[")[0],v=!1,o=0;o<l.length;o++)a.push(l[o].formulaName.toUpperCase());if(r._tableRangesFormula[y.slice(1)]){if(f=i.split("[").length,e=i.split("]").length,f!==e){r._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);return}}else if(!this._isNamedRange(n)){if(n=n.startsWith("=")&&n.replace("=",""),r.getCalcEngine().getNameRangeValues().contains(n.toUpperCase()))return!0;if(s=i.length,f=i.split("(").length,e=i.split(")").length,h=r.getCalcEngine().getLibraryFunctions(),i.startsWith("=")&&s>1){if(t=i=i.substring(1),f!==e){r._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);return}if(f===1&&e===1&&r.isUndefined(h.getItem(t.toUpperCase()))&&!this._isValidCell(i)&&!(t.substring(0,u)=="TRUE"||t.substring(0,u)=="FALSE")){r._showAlertDlg("Alert","CorrectFormula","FormulaAlert",372);return}do{if(u=t.indexOf("("),c=t.indexOf(")"),a.indexOf(t.substring(0,u).toUpperCase())<0&&u+1===c){r._showAlertDlg("Alert","CorrectArgument","FormulaAlert",372);return}t.indexOf("INDIRECT")>-1&&(v=!0);t=t.substring(u+1);t.indexOf(",")>-1&&(t=t.substring(t.indexOf(",")+1));v&&t.indexOf("&")>-1&&(t=t.substring(t.indexOf("&")+1).trim())}while(t.indexOf("(")>-1)}}return!0},_isValidCell:function(n){for(var f=this.XLObj,e,r,o,h=!0,c=!0,i,s=["<=",">=","<",">","=","+","-","/","*","^","&"],u=0,l=s.length;u<l;u++){if(n.indexOf(s[u])>-1)for(r=n.split(s[u]),i=0,o=r.length;i<o;i++)if(r[i].length||t.isNullOrUndefined(r[i+1])||r[i+1].length){if(o==i+1&&r[i].length)return!0}else return!1;if(n.indexOf("%")>-1&&n.split("%").length==2)return!0}return n=n.trim(),n=n.startsWith("=")?n.substring(1):n,n.indexOf("!")>-1&&(e=n.split("!"),n=e[1],f._getSheetIndexByName(e[0])<1&&(h=!1)),this._isNamedRange("="+n)||(c=n.indexOf(":")>-1?f._isvalidRange(n):f._isvalidRange(n+":"+n)),c&&h},updateValue:function(n,t,i,r){var u=this.XLObj,f,e;u.model.isReadOnly||(f=u.getRangeIndices(n),e={rowIndex:f[0],colIndex:f[1]},u._isPublic=!0,u.model.allowCellFormatting&&u.XLFormat._hasFormat(i)&&(u.XLFormat._createFormatClass(u.XLFormat.getFormatFromHashCode(i),i),u.XLFormat._updateFormatClass(e,i)),this._updateCellValue(e,t,i,r),u._isPublic=!1)},updateCellValue:function(n,t,i,r){var u=this.XLObj;u._isPublic=!0;u.model.allowCellFormatting&&u.XLFormat._hasFormat(i)&&(u.XLFormat._createFormatClass(u.XLFormat.getFormatFromHashCode(i),i),u.XLFormat._updateFormatClass(n,i));this._updateCellValue(n,t,i,r);u._isPublic=!1},_updateCellValue:function(n,i,r,u,f){var e=this.XLObj;if(u=e._getSheetIndex(u),n&&!e.model.isReadOnly){var s=n.colIndex,o=n.rowIndex,l=e.getActiveCell(),c=e._getSheetNames(),h;if(e.isFormula(i)&&this.getPropertyValue(o,s,"type",u)!=="text"){for(h=0;h<e.model.sheetCount;h++)isNaN(c[h].text)&&/^[a-zA-Z0-9- ]*$/.test(c[h].text)&&!c[h].text.match("\\s+")||(this._sheetNameSpclchar=!0,i=this._parseSheetRef(i));this._sheetNameSpclchar=!1;this._updateDataContainer({rowIndex:o,colIndex:s},{dataObj:{value:i,hasFormulaArray:e._hasFormulaArray,hasMultipleFormulaArray:e._hasMultipleFormulaArray},sheetIdx:u});this._refreshCalcEngine(o,s,!0,i,u);e._isFormulaSuggestion=!1}else i&&i[0]=="'"?this._updateDataContainer({rowIndex:o,colIndex:s},{dataObj:{value:i,value2:i.substr(1)},sheetIdx:u}):(this._updateCell({rowIndex:o,colIndex:s},i,u,f),this._refreshCalcEngine(o,s,!1,null,u));e._isPublic&&(e.model.allowDataValidation&&this.getPropertyValue(o,s,"isHighlight",u)&&e.XLValidate.highlightInvalidData(),e.model.allowConditionalFormats&&e.XLCFormat.refreshCFormat([o,s,o,s]),e.model.allowComments&&e.XLComment._updateCmntArrowPos(),l.rowIndex===o&&l.colIndex===s&&(e.model.showRibbon&&e.XLRibbon._updateRibbonIcons(),e.model.allowFormulaBar&&e.updateFormulaBar()),this.getPropertyValue(o,s,"wrap",u)&&e._updateWrapCol("updatecellvalue",[n],e.getSheet(u),u,o),t.isNullOrUndefined(r)||e.XLFormat._updateRowHeight([o,s,o,s],u))}},updateCell:function(n,t,i){var r=this.XLObj;r._isPublic=!0;this._updateCell(n,t,i);r._isPublic=!1},_updateCell:function(i,r,u,f){var o=this.XLObj,tt,p,it;if(i&&!o.model.isReadOnly){u=o._getSheetIndex(u);var w,l,d=!0,v=o.getSheet(u),s=i.rowIndex,c=i.colIndex,y=t.Spreadsheet.CellType,a,g=this.getPropertyValue(s,c,"value2")||"",rt=v.rowsHeightCollection[s],b=o.getCell(s,c),e=this._parseValue(r,i),ut=e.type,h=o.getRangeData({range:[s,c,s,c],property:["formatStr","type","thousandSeparator","decimalPlaces","cellType","customFormat"],sheetIdx:u})[0],k=o._dataContainer,nt=!1;if(!o.model.isReadOnly&&(h.type&&h.type!=y.General&&(e.type=h.type,e.type==y.Text&&(e.align=t.Spreadsheet.Align.Left,e.value=e.value2=r),delete e.formatStr),h.formatStr||h.type===y.Scientific||h.type===y.Fraction?(e.value2.indexOf("%")>-1&&(e.value=o.isNumber(e.value)?e.value/100:e.value),e.value2=o.XLFormat._format(e.value,{formatStr:h.formatStr,type:h.type,thousandSeparator:h.thousandSeparator,decimalPlaces:h.decimalPlaces,isTime:ut===t.Spreadsheet.CellType.Time},i),this._formatCellVal&&(e.value=this._formatCellVal)):e.formatStr&&e.type=="percentage"&&e.value2.indexOf("%")>-1&&(e.value=o.isNumber(e.value)?e.value/100:e.value,e.value2=o.XLFormat._format(e.value,{formatStr:e.formatStr,type:e.type,thousandSeparator:e.thousandSeparator,decimalPlaces:e.decimalPlaces},i)),this._formatCellVal=null,o.model.allowCellType&&!o.isUndefined(h.cellType)&&(d=o.XLCellType._rfrshCtrlText(h,e.value)),d?(o._isInitLoad||o.isImport||o.model.isImport||(w=this.getPropertyValue(s,c,"tableName",u),!o.XLFormat._isFAT&&w&&(tt=this.getPropertyValue(s,c,"value2",u),e.value2=o.XLFormat._updateTableColName(s,c,tt,e.value2,u,w),e.type==="general"&&(e.value=e.value2))),h.customFormat=="(#,##0);#,##0"&&e.value2.indexOf("-")>-1&&(nt=!0),h.customFormat&&(e.value2=h.type=="currency"?h.customFormat.indexOf(")")>-1?e.value2:e.value2.split(/[(\)]/)[1]:h.customFormat.indexOf(")")>-1&&!nt?"("+(e.value2.indexOf("-")>-1?e.value2.split("-")[1]:e.value2)+")":e.value2.split("-")[1]),this._updateDataContainer(i,{dataObj:e,sheetIdx:u})):(!o.isUndefined(h.cellType)&&t.isNullOrUndefined(f)&&(n("#"+k.sheetCellType[h.cellType].id).data("ej"+k.sheetCellType[h.cellType].type).destroy(),b&&(b[0].innerHTML=""),o._removeClass(b[0],"e-cellreadonly"),delete k.sheets[u][s][c].cellType),this._updateDataContainer(i,{dataObj:e,sheetIdx:u})),o._isPublic&&!o._isScrolling&&this.getPropertyValue(s,c,"wrap")&&(l=o._getWrapCellHeight(u,s,c),l.cellHt>v.rowsHeightCollection[s]&&(o._isRowViewable(u,s)?o.setHeightToRows([{rowIndex:s,height:l.rowHt}]):(v.rowsHeightCollection[s]=l.rowHt,o.XLScroll._getRowHeights(u,s)),o._wrapCollection(s,c,l.cellHt,u))),this.getPropertyValue(s,c,"wrap",u)&&o._updateWrapCol("updatecellvalue",[i],o.getSheet(u),u,s),a={sheetIndex:u?u:o.getActiveSheetIndex(),rowIndex:s,colIndex:c,reqType:"edit",cValue:r,pValue:g?g:"",prevHeight:rt,newHeight:v.rowsHeightCollection[s],isHighlightData:!1},o._dupDetails||(o._completeAction(a),o._trigActionComplete(a)),a.isHighlightData&&(o._pushHighlightData([s,c,s,c]),o.XLClipboard._highLightRange.length&&a.operation!="hl-data"))){for(p=0,it=o.XLClipboard._highLightRange.length;p<it;p++)o.XLValidate.highlightInvalidData(o.XLClipboard._highLightRange[p]);o.XLClipboard._highLightRange=[]}}},_parseValue:function(i,r){var nt,l,w,v,y,g,p,tt,c=this.XLObj.model.locale,st=i,it,rt,ht=t.isNullOrUndefined(i),ct,ut,b,lt,at,vt;r&&(l=this.getPropertyValue(r.rowIndex,r.colIndex,"decimalPlaces"),w=this.getPropertyValue(r.rowIndex,r.colIndex,"thousandSeparator"),v=this.getPropertyValue(r.rowIndex,r.colIndex,"type"));y=t.preferredCulture(c);g=y.numberFormat[","]||",";tt=y.numberFormat["."]||".";p=new RegExp("^\\d+(\\"+g+"\\d{3,})+$|^\\d+(\\"+g+"\\d{3,})+\\"+tt+"\\d+$|^\\d+(\\"+tt+"\\d+)+$");it=!ht&&t.parseFloat(i.toString(),10,c);it&&(st=it);r&&v=="text"||(ht||(nt=this.XLObj._getlocaleNumVal(st)),i=t.isNullOrUndefined(i)?"":typeof i=="object"&&!this.XLObj._isDateTime(i)?JSON.stringify(i):i);var s,u,a,k,ft,e,o=this.XLObj,h=t.Spreadsheet.CellType,et=t.Spreadsheet.Align.Right,f=typeof i=="object"&&!this.XLObj._isDateTime(i)?JSON.stringify(i):i+"",d=h.General,ot=f.indexOf(o._currencySymbol);if(nt&&(i=nt),(ot===0||ot>-1&&ot===f.length-1)&&(u=t.parseFloat(f,10,c),u))return e=f.indexOf(o._decimalSeparator)>-1?o._decimalCnt(u):0,e=l>-1?l:e,{type:h.Currency,value:u,value2:f,formatStr:o._getFormatString(h.Currency,e),decimalPlaces:e,align:et};if(f.indexOf(o._percentSymbol)>-1&&(u=n.trim(f).replace(o._percentSymbol,""),rt=t.parseFloat(u,10,c),o.isNumber(rt)))return e=f.indexOf(o._decimalSeparator)>-1?o._decimalCnt(u):0,e=l>-1?l:e,{type:h.Percentage,value:rt,value2:f,formatStr:o._getFormatString(h.Percentage,e),decimalPlaces:e,align:et};if(f.indexOf(o._decimalSeparator)>-1&&v&&v!="general"&&(u=t.parseFloat(f,10,c),u))return at=u.toString(),e=at.substr(f.indexOf(o._decimalSeparator)+1).length,e>2&&(e=2),f=t.format(u,"N"+e,c),e=l>-1?l:e,{type:h.Number,value:u,value2:f,formatStr:o._getFormatString(h.Number,e),decimalPlaces:e,thousandSeparator:this.XLObj.isUndefined(w)?!0:w};if(f.indexOf(g)>-1&&v!="shortdate"&&v!="date"&&v!="time"&&v!="longdate"&&p.test(f)&&(u=t.parseInt(f,10,c),u))return e=0,f=t.format(u,"N"+e,c),e=l>-1?l:e,{type:h.Number,value:u,value2:f,formatStr:o._getFormatString(h.Number,e),decimalPlaces:e,thousandSeparator:this.XLObj.isUndefined(w)?!0:w};a=y.calendar.patterns;k=!0;p=y.calendar._parseRegExp;for(s in a)if(p&&a[s]in p?u=new RegExp(p[a[s]].regExp).exec(f):(k=!1,u=t.parseDate(f,a[s],c)),u){if(k||(k=!0),s=="d"){for(ut=a.d.split(y.calendar["/"]),b=0,lt=ut.length;b<lt;b++)if(ut[b].toLowerCase()==="m"){ct=b+1;break}if(parseInt(u[ct])>12){u=null;continue}}break}return(u||(vt="^(\\d\\d?):(\\d\\d?):(\\d\\d?)",u=new RegExp(vt).exec(f),u&&(u=t.parseDate(f,"H:mm:ss",c),s="rT",a[s]="H:mm:ss")),u&&(k&&(u=t.parseDate(f,a[s],c)),u))?(s==="T"||s==="t"||s==="rT"||o.XLFormat._customFormatSpecifierType[s]===h.Time?(u.setYear(1990),u.setMonth(0),u.setDate(1),d=h.Time):d=s==="d"?h.ShortDate:s==="D"?h.LongDate:h.Date,ft="{0:"+a[s]+"}",f=o.XLFormat._format(u,{type:d,formatStr:ft}),{type:d,value:u,value2:f,formatStr:ft,align:et}):((f.toLowerCase()==="true"||f.toLowerCase()==="false")&&(i=f=f.toUpperCase()),{type:d,value:i,value2:f})},updateCellWithContainer:function(n,i,r,u){var f=this.XLObj,o,h,s,e,c,a,y,l,v;if(!f.model.isReadOnly){for(r=f._getSheetIndex(r),l=0,v=0,i=i?i:f.getSheet(r).selectedRange,a=f._getSelectedRange({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]}),y=a.length;l<y;)c=a[l],s=c.rowIndex,u&&f._isHiddenRow(s)||(h=c.colIndex,e=n[v],o=f.getCell(s,h,r),this._updateDataContainer(c,{dataObj:e}),this._refreshCalcEngine(s,h,f.isFormula(e.value),e.value),o&&e.format&&f.addClass(o[0],e.format),o&&e.hyperlink&&o.html(t.buildTag("a.e-hyperlinks",e.value2,"","cellAdr"in e.hyperlink?{href:"#"}:{href:e.hyperlink.webAdr,target:"_blank"})),e.comment&&f.XLComment.setComment([s,h,s,h],null,!1),e.border&&f.XLFormat.applyBorder(f.XLFormat.getBorderFromHashCode(e.border),f._getAlphaRange(r,s,h,s,h)),o&&(e.rule&&e.rule.isApply?f.addClass(o[0],"e-hlcell"):f._removeClass(o[0],"e-hlcell")),v++),l++;f.model.allowConditionalFormats&&f.XLCFormat.refreshCFormat(i)}},_refreshCellAlignment:function(n){n=n||{};var o,s,f=t.Spreadsheet.Align,i=this.XLObj,r=n.cellIdx.rowIndex,u=n.cellIdx.colIndex,e=this.getPropertyValue(r,u,"merge"),h=this.XLObj._getlocaleNumVal(n.value);f in n||(n.value=t.isNullOrUndefined(n.value)?this.getPropertyValue(r,u,"value"):n.value,n.type=n.type?n.type:this.getPropertyValue(r,u,"type"),i.model.locale!=="en-US"&&!isNaN(h)&&["currency","accounting","number","scientific","fraction"].indexOf(n.type)>-1&&(n.value=h),i.isFormula(n.value)&&(n.value=i.XLEdit.getPropertyValue(r,u,"calcValue")),n.align=!(i.isNumber(n.value)||typeof n.value=="object"||(n.type==="shortdate"||n.type==="longdate"||n.type==="time")&&i._isDateTime(new Date(n.value&&n.value.toString())))||n.type===t.Spreadsheet.CellType.Text||e&&e.isCenterAlign?i._isBool(n.value)||e&&e.isCenterAlign?f.Center:f.Left:f.Right);o=this.getPropertyValue(r,u,"align");!i._isInitLoad||i.isImport||i.model.isImport||(s=!0);(!n.align||o&&o!=n.align)&&i.clearRangeData([r,u,r,u],["align"],"","","",s);n.align&&this._updateDataContainer(n.cellIdx,{dataObj:{align:n.align},skipCell:s,sheetIdx:n.sheetIdx})},_editingHandler:function(i){var b,et,r,e,u,o,nt,v,h,c,ot,l,y,k,tt,vt,it,rt,a,yt,d,f,st,pt,ht,g,s,ct,p,lt,ut,ft,w,wt,at;if(!n(i.target).parents(".e-backstagecontent").length){if(r=this.XLObj,i.keyCode===53&&i.shiftKey&&(b=this._editElem.text(),b.split("%").length==2&&this._cursorPosn-b.indexOf("%")==-1)){this._editElem.setCursorPosition(r._browserDetails.version==="8.0"?document.selection.anchorOffset+1:window.getSelection().anchorOffset+1);i.preventDefault();this._cursorPosn=-1;return}if(!(i.keyCode===61||!i.shiftKey&&i.keyCode===32||i.keyCode>=48&&i.keyCode<=59||i.keyCode>=65&&i.keyCode<=90||i.keyCode>=96&&i.keyCode<=111||i.keyCode===173||i.keyCode>=186&&i.keyCode<=192||i.keyCode>=219&&i.keyCode<=222)||i.ctrlKey||i.altKey)if(i.keyCode!==113||i.shiftKey||i.ctrlKey)if(i.keyCode===27&&this._isEdit&&r.model.allowKeyboardNavigation)e=r.getActiveSheetIndex(),u=r.getSheet(e),h=u._activeCell.rowIndex,c=u._activeCell.colIndex,o=r.getCell(h,c),nt=r._dataContainer.sheets[e],r.XLEdit.getPropertyValue(h,c,"wrap")&&r.XLEdit.getPropertyValue(h,c,"merge")&&(pt=r.getCell(h,c,e),ht=pt.find("#"+r._id+"_Merge")[0]),v=h in nt&&c in nt[h]?nt[h][c]:v,g=v?typeof v.value2=="string"?v.value2:r._dataContainer.sharedData[v.value]:"",r.isFormula(g)&&(g=this.getPropertyValue(h,c,"value2")),r.element.find("#"+r._id+"_Edit").hide(),et=r._isRowViewable(e,h),et&&(ht?ht.innerHTML=g:this._refreshTextNode(o[0],g),r._setSheetFocus(),r._setRowHdrHeight(e,u._selectedCells[0].rowIndex)),r.model.allowFormulaBar&&r.updateFormulaBar(),this._isFormulaEdit&&n("#"+r._id+"_AutoComplete").data("ejAutocomplete").suggestionList.hide(),this._isEdit=this._isFormulaEdit=this._isFBarFocused=!1,r._getContent(e).find("td[class *='border']").removeClass(r._formulaBorder.join(" ").replace(/,/g," ")+" "+r._ctrlFormulaBorder.join(" ").replace(/,/g," ")),et&&(r.model.allowComments&&o.hasClass("e-commentcell")&&r.XLComment._visibleCmntCnt(o,!0),r.model.allowAutoFill&&r.XLDragFill.positionAutoFillElement(),o.removeClass("e-editedcell e-msie-edit")),r.model.showRibbon&&r.XLRibbon._enableRibbonIcons(),r._getContent(r.getActiveSheetIndex()).find(".e-error").remove(),t.isNullOrUndefined(r.XLCellNav)||(r.XLCellNav._isNavigate=!0);else if(i.keyCode===46&&r.model.allowKeyboardNavigation)if(this._isEdit)r._ctrlKeyCount>0&&(r._ctrlKeyCount=0,r._formulaRange=[],r.XLSelection._clearBorder(r._formulaBorder.join(" ").replace(/,/g," ")+" "+r._ctrlFormulaBorder.join(" ").replace(/,/g," ")));else{if(r._preventctrlkey){r._showAlertDlg("Alert","CtrlKeyErrorAlert","CtrlKeyErrorAction",450);return}if(e=r.getActiveSheetIndex(),u=r.getSheet(e),lt=r._getRangeArgs(u.selectedRange,"string"),ut={range:lt,sheetIndex:e,reqType:"clear-content",type:"actionBegin",action:"clearContent"},r._trigActionBegin(ut))return;if(lt!=ut.range&&r.XLSelection.selectRange(ut.range),o=r.getCell(u._activeCell.rowIndex,u._activeCell.colIndex),f=u._selectedCells,b=r.getRangeData({range:[f[0].rowIndex,f[0].colIndex,f[f.length-1].rowIndex,f[f.length-1].colIndex]}),r.model.allowLockCell&&u.isSheetProtected&&r._isPropExists([u.selectedRange],"isLocked",e))return;if(r._isPropExists([u.selectedRange],"isReadOnly",e))return;if(ct=this.getPropertyValue(f[0].rowIndex,f[0].colIndex,"formulaRange"),ct&&(p=r.getRangeIndices(ct),p&&!(p[2]==f[f.length-1].rowIndex&&p[0]==f[0].rowIndex&&p[3]==f[f.length-1].colIndex&&p[1]==f[0].colIndex))){r._showAlertDlg("Alert","ArrayaFormula",430);return}if(!this._isEdit){for(r.element.find(".e-cdata").length&&r.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),ft=r.model.sheets[e].tableManager,wt=r.getObjectKeys(ft),it=0,rt=r.getObjectLength(ft);it<rt;it++)if(w=ft[wt[it]].range,r.XLClipboard._compareRange([f[0].rowIndex,f[0].colIndex,f[f.length-1].rowIndex,f[f.length-1].colIndex],w)){yt=r._getAlphaRange(e,w[0],w[1],w[2],w[3]);r.clearAll(yt);return}for(r._hasClass(o,"e-readonly")||(r._isTrigCellSave=!0,r.clearRangeData(null,["value","value2","hyperlink","hasFormulaArray","hasMultipleFormulaArray"]),r._isTrigCellSave=!1),ot=f[0].rowIndex,k=0,vt=f.length;k<vt;k++)if(l=f[k].rowIndex,y=f[k].colIndex,r._textClip(l,y,"delete"),!this.getPropertyValue(l,y,"isReadOnly")){if(r.model.allowFormulaBar&&r._getInputBox().val(""),d=this.getPropertyValue(l,y,"cFormatRule"),r.model.allowConditionalFormats&&d&&d.length){for(tt=0,rt=d.length;tt<rt;tt++)a=d[tt].split("_"),r.XLCFormat._cFormat(a[0],a[2],a[3],a[4],a[5],a[6]);r.XLCFormat.refreshCFormat(r._getAlphaRange(e,l,y,l,y))}ot!==l&&(r._setRowHdrHeight(e,l),ot++)}r.XLSelection._refreshBorder()}st={sheetIndex:e,range:[f[0].rowIndex,f[0].colIndex,f[f.length-1].rowIndex,f[f.length-1].colIndex],bData:b,reqType:"clear-content"};r._completeAction(st);r._trigActionComplete(st)}else i.ctrlKey||i.shiftKey||i.keyCode!==8?(i.keyCode!==13||i.altKey)&&i.keyCode!==9||!this._isEdit||!r.model.allowKeyboardNavigation||r.XLCellNav._isNavigate||this._isFormulaEdit?i.keyCode===13&&i.altKey&&this._isEdit&&(i.preventDefault(),at=r.element.find("#"+r._id+"_Edit"),at.focus(),at.altEnter()):(i.preventDefault(),t.isNullOrUndefined(r.XLCellNav)||(r.XLCellNav._isNavigate=!0)):(e=r.getActiveSheetIndex(),u=r.getSheet(e),o=r.getCell(u._activeCell.rowIndex,u._activeCell.colIndex),this._isEdit||r._hasClass(o,"e-readonly")||r._hasClass(o,"e-cellreadonly")||(r.element.find(".e-cdata").length&&r.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),o=r.getCell(u._activeCell.rowIndex,u._activeCell.colIndex),s=r.XLEdit.getPropertyValue(u._activeCell.rowIndex,u._activeCell.colIndex,"mergeIdx"),r._intrnlReq=!0,this.editCell(s?s.rowIndex:u._activeCell.rowIndex,s?s.colIndex:u._activeCell.colIndex,!1),r._intrnlReq=!1,r._setRowHdrHeight(e,u._activeCell.rowIndex),r.model.allowFormulaBar&&r._getInputBox().val("")));else e=r.getActiveSheetIndex(),u=r.getSheet(e),o=r.getCell(u._activeCell.rowIndex,u._activeCell.colIndex),this._isFEdit=!0,this._isEdit||r._hasClass(o,"e-readonly")||r._hasClass(o,"e-cellreadonly")||(r.element.find(".e-cdata").length&&r.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),r.model.allowKeyboardNavigation&&r.XLCellNav._navToCell(u._activeCell.rowIndex,u._activeCell.colIndex),s=r.XLEdit.getPropertyValue(u._activeCell.rowIndex,u._activeCell.colIndex,"mergeIdx"),r._intrnlReq=!0,this.editCell(s?s.rowIndex:u._activeCell.rowIndex,s?s.colIndex:u._activeCell.colIndex,!0),r._intrnlReq=!1),this._cursorPosn++;else e=r.getActiveSheetIndex(),u=r.getSheet(e),o=r.getCell(u._activeCell.rowIndex,u._activeCell.colIndex),this._isEdit||r._hasClass(o,"e-readonly")||r._hasClass(o,"e-cellreadonly")||(r.element.find(".e-cdata").length&&r.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),r.model.allowKeyboardNavigation&&r.XLCellNav._navToCell(u._activeCell.rowIndex,u._activeCell.colIndex),s=r.XLEdit.getPropertyValue(u._activeCell.rowIndex,u._activeCell.colIndex,"mergeIdx"),r._intrnlReq=!0,this.editCell(s?s.rowIndex:u._activeCell.rowIndex,s?s.colIndex:u._activeCell.colIndex,!1),r._intrnlReq=!1),this._cursorPosn++}},_focusElements:function(t){n(t).not(":hidden").focus().setInputPos(n(t).text().length)},_updateUsedRange:function(n,t,i){var u=this.XLObj,r=u.getSheet(i?i:u.getActiveSheetIndex()).usedRange;r.rowIndex<n&&(r.rowIndex=n);r.colIndex<t&&(r.colIndex=t)},_updateDataContainer:function(i,r){var e,tt,dt,k,o,w,b,it,ct,lt,s,f,c,l,rt,v,y,at,vt,yt,pt,gt,p,ut,nt,ni,ti,ft,d,wt,et,bt,ii,kt=!1,h=r.dataObj,u=this.XLObj,a=u._getSheetIndex(r.sheetIdx),ot=u.getSheet(a),g,st,ri,ui,ht;if(!r.skipCell&&u._isRowViewable(a,i.rowIndex)&&(k=u.getCell(i.rowIndex,i.colIndex,a),o=k[0]),h){ct=t.Spreadsheet.CellType;lt=t.Spreadsheet.Align;p=u._dataContainer;v=i.colIndex;y=i.rowIndex;l=u._cellProp;ut=p.sheets[a];y in ut?(nt=ut[y],v in nt?s=nt[v]:nt[v]=s={}):(nt=ut[y]={},nt[v]=s={});o&&this.getPropertyValue(i.rowIndex,i.colIndex,"merge",a)&&(w=k.find("#"+u._id+"_Merge")[0],w&&(d=w.lastChild,d?d.nodeType===1?(u._hasClass(d,"e-hyperlinks")&&(d.textContent=""),u._hasClass(d,"e-comment")&&(d.lastChild.textContent="")):d.textContent="":w.textContent="",b=w.innerHTML,n(w).remove()));for(e in h){c=h[e];typeof c=="string"&&n.trim(c).length===0&&(c="");switch(e){case l[0]:case l[4]:case l[5]:case l[11]:f=p.sharedData.indexOf(c);f===-1&&(f=p.sharedData.push(c),f--);s[e]=f;ot._isLoaded&&e===l[0]&&!u._intrnlUpdate&&(kt=!0);break;case l[1]:if(ft=this.getPropertyValue(y,v,"value2",a),h.type&&h.type!=ct.General&&h.type!=ct.Text?s[e]=h.value2:(f=p.sharedData.indexOf(h.value2),f===-1&&(f=p.sharedData.push(h.value2),f--),s[e]=f),o&&!("cellType"in h))if(gt=o.getElementsByTagName("a"),gt.length)this._refreshTextNode(o,h.value2);else if(s[l[24]]>-1){if(yt=p.sheetCellType[s[l[24]]],pt=yt.id,n("#"+pt).length===0)return;if(h.value2)switch(yt.type){case"Button":n("#"+pt).ejButton("instance").option("text",h.value2)}}else h.value2&&(at=h.value2.toString().length>7&&!isNaN(new Date(h.value2).valueOf()),vt=["true","yes","false","no"].indexOf(h.value2.toString().toLowerCase())>-1),u.model.allowCellType&&u.model.allowAutoCellType&&(at||vt)?at?(u.XLCellType._rangeCellTypes([{settings:{type:"DatePicker"},range:u._getAlphaRange(a,y,v,y,v)}],a,!0),n("#"+u._dataContainer.sheetCellType[s[l[24]]].id).ejDatePicker("instance").option("value",h.value2)):vt&&(u.XLCellType._rangeCellTypes([{settings:{type:"CheckBox"},range:u._getAlphaRange(a,y,v,y,v)}],a,!0),n("#"+u._dataContainer.sheetCellType[s[l[24]]].id).ejCheckBox("instance").option("checked",["true","yes"].indexOf(h.value2.toString().toLowerCase())>-1?!0:!1)):this._skipHTML?o.innerHTML.concat(h.value2):this._refreshTextNode(o,h.value2);this._refreshCellAlignment({cellIdx:i,value:h.value,type:h.type,sheetIdx:a});u._isSort||(u.model.allowOverflow&&u._canOverflow?(ft||h.value2)&&(wt=t.isNullOrUndefined(ft)?!0:ft.length<=h.value2.length?!0:!1,u._textClip(y,v,wt?"add":"delete"),!wt&&h.value2.length>0&&u._textClip(y,v,"add")):u._canOverflow&&u.refreshOverflow([y,v,y,v],a));s.isDirty=!0;break;case l[2]:s[e]=p.cellType.indexOf(h.type);break;case l[3]:for(tt=0,dt=c.length;tt<dt;)f=p.cFormatData.indexOf(c[tt]),f===-1&&(f=p.cFormatData.push(c[tt]),f--),s[e]?s[e].indexOf(f)===-1&&s[e].push(f):s[e]=[f],tt++;break;case l[6]:f=p.valData.indexOf(c.customVal);f===-1&&(f=p.valData.push(c.customVal),f--);s[e]=JSON.parse(JSON.stringify(c));s[e].customVal=f;break;case l[7]:case l[8]:o&&(ni=e===l[8]?"e-border":"e-format",ti=new RegExp("\\b"+ni+".*?\\b","g"),o.className=o.className.replace(ti,""),u.addClass(o,c));f=p.hashCode.indexOf(c);f===-1&&(f=p.hashCode.push(c),f--);s[e]=f;break;case l[9]:case l[10]:case l[26]:case l[27]:s[e]?s[e].indexOf(c)===-1&&s[e].push(c):s[e]=[c];break;case l[12]:s[e]=c;o&&(c===lt.Center?u.addClass(o,u._cAlign):c===lt.Right?u.addClass(o,u._rAlign):n(o).removeClass(u._rAlign+" "+u._cAlign));break;case l[14]:case l[16]:et=u.XLFormat.getFormatHashCode(c);f=p.hashCode.indexOf(et);f===-1&&(u.XLFormat._createFormatClass(c,et),f=p.hashCode.push(et),f--);s[e]=f;break;case l[15]:case l[17]:c=u.XLFormat._getBorderHashCode(c,!0);f=p.hashCode.indexOf(c);f===-1&&(f=p.hashCode.push(c),f--);s[e]=f;break;default:s[e]=c}}if(this._updateUsedRange(i.rowIndex,i.colIndex,a),kt&&(u.model.allowCharts&&u.XLChart._refreshChartElements(y,v,a),u.model.allowSparkline&&u.XLSparkline.refreshSparkline(y,v,a),u.model.allowConditionalFormats&&u.XLCFormat._refreshCFormatFormula(y,v,a),u._updateBatchDetails(y,v,a),kt=!1),o&&this.getPropertyValue(i.rowIndex,i.colIndex,"merge",a)&&(ui=this.getPropertyValue(i.rowIndex,i.colIndex,"merge",a),ht=ot._rowHeightCollection[i.rowIndex+ui.mSpan.rowSpan]-ot._rowHeightCollection[i.rowIndex]||Math.floor(k.height()),u._isRowViewable(a,i.rowIndex)&&(it=this.getPropertyValue(i.rowIndex,i.colIndex,"value2",a),it=it||"",w=k.find("#"+u._id+"_Merge")[0],w||this._refreshTextNode(o),b=b?b.concat(h.value2||it):h.value2||it,w||(g=this.getPropertyValue(i.rowIndex,i.colIndex,"sparkline",a),!u._isCopyPaste&&u.model.allowSparkline&&g?(g=g[0],st=u.getSheet(a).shapeMngr.sparkline[g],k.find(".e-ss-sparkline").length?(n("#"+g).ejSparkline("destroy"),u.XLSparkline._wireSparklineEvents("_off"),o.innerHTML="<div id ="+u._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(ht-1)+"px'>"+o.innerHTML.concat(t.isNullOrUndefined(b)?"":b)+"<\/div>",n("#"+g).ejSparkline(st),u.XLSparkline._wireSparklineEvents("_on")):(o.innerHTML="<div id ="+u._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(ht-1)+"px'>"+o.innerHTML.concat(t.isNullOrUndefined(b)?"":b)+"<\/div>",n(o).find('svg[id *= "sparkline_svg"]').length?(n(o).find('svg[id *= "sparkline_svg"]').remove(),n("#"+g).ejSparkline(st),u.XLSparkline._wireSparklineEvents("_on")):(ii=u._getCellInfo(i,a),u.XLSparkline._createSparkline(st,ii,a)))):(o.innerHTML="<div id ="+u._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(ht-1)+"px'>"+o.innerHTML.concat(t.isNullOrUndefined(b)?"":b)+"<\/div>",u._hasClass(o,"e-rightalign")&&(u._removeClass(o,"e-rightalign"),ri=k.find("#"+this.XLObj._id+"_Merge"),ri[0].classList.add("e-rightalign"))),w=k.find("#"+u._id+"_Merge")[0]),bt=w.children,bt.length)))for(e=0;e<bt.length;e++)u._hasClass(w.children[e],"e-comment")&&(w.children[e].lastChild.textContent=this.getPropertyValue(i.rowIndex,i.colIndex,"comment",a).value),u._hasClass(w.children[e],"e-hyperlinks")&&(w.lastChild.textContent="",w.children[e].textContent=this.getPropertyValue(i.rowIndex,i.colIndex,"value2",a));(Object.keys?Object.keys(s).length:u.getObjectLength(s))===3&&(rt=u.getRangeData({range:[y,v,y,v],property:l.slice(0,3)})[0],rt.value===""&&rt.value2===""&&rt.type===t.Spreadsheet.CellType.General&&u.clearRangeData([y,v,y,v],l.slice(0,3)));!ot._isLoaded||u.isDirty||u._intrnlReq||u.isImport||u.model.isImport||(u.isDirty=!0)}else o&&this._refreshTextNode(o)},_clearDataContainer:function(i){var y,r,p,s,w,nt,a,b,k,o,tt=!1,f=this.XLObj,l=f._getSheetIndex(i.sheetIdx),h=f._cellProp,u=i.cellIdx.rowIndex,e=i.cellIdx.colIndex,d=i.property||[],it=!1,v,ut=f._dataContainer,c=ut.sheets[l],g,rt;if(d.length&&u in c&&e in c[u]){for(a=c[u][e],y=d.length,!i.skipCell&&f._isRowViewable(l,u)&&(r=f.getCell(u,e,l));y--;){o=null;k=!1;s=d[y];switch(s){case h[0]:o=this.getPropertyValue(u,e,s,l);k=!0;break;case h[1]:nt=this.getPropertyValue(u,e,"value2");r&&(this._refreshTextNode(r[0]),w=r.find("#"+f._id+"_Merge"),w.length&&(w[0].innerHTML=""));nt&&(tt=!0);break;case h[3]:o=this.getPropertyValue(u,e,s,l);o&&r&&r.length>0&&(n(r).removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),r[0].style.color="",r[0].style.backgroundColor="",r.removeClass("e-cformat"),g=r.children().find(".e-databar-value"),rt=g[0]&&g[0].textContent,r.children().hasClass("e-cf-databar")&&(r.find(".e-cf-databar").remove(),this._refreshTextNode(r[0],rt)),(r.hasClass("e-iconset")||r.children().find(".e-iconsetspan").length>0)&&(r.removeClass(".e-iconset"),r.find(".e-iconsetspan").remove()));break;case h[7]:case h[8]:o=this.getPropertyValue(u,e,s,l);o&&r&&f._removeClass(r[0],o);break;case h[14]:o=this.getPropertyValue(u,e,s,l);o&&o["text-align"]&&o["text-align"]==="right"&&r&&f._removeClass(r[0],"e-rightalign");break;case h[12]:o=a[s];o&&r&&f._removeClass(r[0],o===t.Spreadsheet.Align.Center?f._cAlign:f._rAlign);break;case h[13]:if(o=a[s],o&&r){if(b=r[0].lastChild.textContent,i.status==="clear-content"){r[0].lastChild.textContent="";break}else if(i.status==="clear-format"){p=r.find("a");f._hasClass(p[0],"e-hyperlinks")&&p.css({color:"#444445","text-decoration":"none"}).removeClass("e-hyperlinks");break}r.find("a").remove();t.isNullOrUndefined(r[0].lastChild)?r[0].textContent=b:r[0].lastChild.textContent=b}break;case h[18]:o=a[s];o&&r&&(r.removeClass("e-filterhdr"),r.find(".e-filterspan").remove());break;case h[21]:f.XLComment&&f.XLComment.deleteComment([u,e,u,e]);break;case h[5]:case h[22]:case h[23]:it||(o=this.getPropertyValue(u,e),f.isUndefined(o)&&(o=""),v={decimalPlaces:0,thousandSeparator:!1,formatStr:"",type:"general",value:o},v.value2=f.XLFormat._getFormattedValue(u,e,v,o),f.XLEdit._updateDataContainer({rowIndex:u,colIndex:e},{dataObj:v}),it=!0);break;case h[25]:delete c[u][e][s]}i.status==="clear-content"&&s==="hyperlink"?this.getPropertyValue(u,e,s,l)&&(delete c[u][e][s].webAddr,delete c[u][e][s].cellAddr):delete c[u][e][s];k&&(this._refreshCalcEngine(u,e,!1,o),f._updateBatchDetails(u,e,l),f.model.allowCharts&&f.XLChart._refreshChartElements(u,e,l),f.model.allowSparkline&&f.XLSparkline.refreshSparkline(u,e,l))}tt&&f._textClip(u,e,"delete");f._overFlowRowIdx||f.getObjectLength(c[u])||delete c[u];c[u]&&!f.getObjectLength(c[u][e])&&delete c[u][e]}},getPropertyValue:function(i,r,u,f){var e,h,c,a,p,w,o=this.XLObj,l=o._dataContainer,v=l.sheets,y=o._cellProp,s;if(f=o._getSheetIndex(f),o._intrnlUpdate||this._refreshContainer(i,f),v[f]&&v[f][i]&&v[f][i][r]){if(h=v[f][i][r],h){u=u||"value";c=h[u];switch(u){case"value":case"range":case"thousandSeparator":case"calcValue":e=l.sharedData[c];break;case"format":case"border":e=l.hashCode[c];break;case"value2":w=t.Spreadsheet.CellType;e=!o.isUndefined(h.type)&&[w.General,w.Text].indexOf(l.cellType[h.type])===-1?h.value2:l.sharedData[h.value2];break;case"type":e=l.cellType[h.type];break;case"cFormatRule":for(a=p=0,e=[],o.isUndefined(c)||(p=c.length);a<p;)h[u][a]in l.cFormatData&&e.push(l.cFormatData[h[u][a]]),a++;break;case"rule":o.isUndefined(c)||(e={},n.extend(!0,e,c),e.customVal=l.valData[e.customVal]);break;case y[14]:case y[15]:case y[16]:case y[17]:o.isUndefined(c)||(e=l.hashCode[c],e=e.indexOf("e-format")===-1?o.XLFormat.getBorderFromHashCode(e,!0):o.XLFormat.getFormatFromHashCode(e));break;case"cTypeDetail":s=o._dataContainer.sheetCellType[h.cellType];s&&s.type=="DropDownList"&&s.selectedIndex>-1&&s.dataSource&&(s.text=s.dataSource[s.selectedIndex].text,s.value=s.dataSource[s.selectedIndex].value);e=s;break;case"isLocked":e=c;o._isDefaultLocked&&(e=!e);break;default:e=c}}}else o._isDefaultLocked&&u==="isLocked"&&(e=!e);return e},_refreshContainer:function(n,t){var r,i=this.XLObj,u=i.getSheet(t),f;!u._isImported&&u._hasDataSrc&&(i._intrnlUpdate=!0,i.model.scrollSettings.allowVirtualScrolling?(r=i._getBlockInfo(n,t,!0),u._virtualDataMngrLoadedBlks.indexOf(r.orgIdx)===-1&&(u._virtualDataMngrLoadedBlks.push(r.orgIdx),this._ensureDataMngr(r.orgRange,t)),u._virtualDataLoadedBlks.indexOf(r.orgIdx)===-1?(u._virtualDataLoadedBlks.push(r.orgIdx),i._canOverflow=!1,i._refreshDataSrc(r.orgRange,t),i._refreshCellData(r.orgRange,t),i._canOverflow=!0,i._refreshOverflow(r.orgRange)):(f=u._renderedRange.indexOf(r.orgIdx),f>-1&&(i._refreshCellData(r.orgRange,t),i._canOverflow=!0,i._refreshOverflow(r.orgRange),i._isRangeRendered=!1,u._renderedRange.splice(f,1)))):u._isLoaded||u._isDataMoved||(u._isDataMoved=!0,i._canOverflow=!1,i._refreshDataSrc(null,t),i._refreshCellData(null,t),i._canOverflow=!0,i._refreshOverflow()),i._intrnlUpdate=!1)},_ensureDataMngr:function(n,i){var s,e,o,u,r,l,h=0,a=this.XLObj,c=a.getDataSettings(i),v,f;if(c)for(v=c.length;h<v;)r=c[h],a._inRow(r.range,n[0])&&r._dataManager&&(u=this._getQueryPropWithValues(n.slice(0),r.range),f=t.pvt.filterQueries(r.query.queries,"onSkip"),o=u.skip||0,r._skip&&(o+=r._skip),o&&(f.length?f[0].e.nos=o:r.query.skip(o)),f=t.pvt.filterQueries(r.query.queries,"onTake"),u.take&&(f.length?f[0].e.nos=u.take:r.query.take(u.take)),r._dataManager.dataSource.async=!1,l=r._dataManager.executeQuery(r.query),l.done(function(n){if(s=n.result.length,s)for(e=0;e<s;)r._jsonData[u.skip+e]=n.result[e],e++}),r._dataManager.dataSource.async=!0),h++},_getQueryPropWithValues:function(n,t){var i,r={},u=this.XLObj;return i=n[0]-t[0],r.skip=i,t[2]<n[2]&&(n[2]=t[2]),u._inRow(t,n[2])&&(i=n[2]-n[0]+1,r.take=i),r},getPropertyValueByElem:function(n,i,r){if(!t.isNullOrUndefined(n[0])){var u;return u=n.hasClass("e-hyperlinks")?this.XLObj._getCellIdx(n.parent()[0]):this.XLObj._getCellIdx(n[0]),this.getPropertyValue(u.rowIndex,u.colIndex,i,r)}},_getPropWithCellIdx:function(n,t,i,r){var o=this.XLObj;i=o._getSheetIndex(i);for(var e,s=[],u=n[0],c=n[2],f,l=n[3],h=o._dataContainer.sheets[i];u<=c;){if(h[u])for(f=n[1];f<=l;)h[u][f]&&(e=this.getPropertyValue(u,f,t,i),o.isUndefined(e)||(r?o.isFormula(e)&&s.push({rowIdx:u,colIdx:f,value:e}):s.push({rowIdx:u,colIdx:f,value:e}))),f++;u++}return s},_refreshCalcEngine:function(n,i,r,u,f){var o=this.XLObj,w,l,s,h,e,b,a,v,y,p,c,k;if(f=o._getSheetIndex(f),h=o.getSheet(f),e=o._calcEngine,r)u=this._parseSheetRef(u),w=new ValueChangedArgs(n+1,i+1,u),e.valueChanged(h.sheetInfo.value,w,o._computeFormula?!0:o._impData?h._isLoaded:!0),o._applyFormula(f,n,i);else if(l=CalcEngine.getSheetFamilyItem(h.sheetInfo.value),s=RangeInfo.getAlphaLabel(i+1)+(n+1),e.isSheetMember()&&!t.isNullOrUndefined(l.parentObjectToToken)&&(s=l.parentObjectToToken.getItem(h.sheetInfo.value)+s),e.getFormulaInfoTable().containsKey(s)&&(e.getFormulaInfoTable().remove(s),e.getDependentCells().contains(s)&&e.clearFormulaDependentCells(s)),e.getComputedValue().clear(),e.refresh(s),e.getComputedValue().clear(),b=e.getDependentCells(),a=b.keys().indexOf(s),a>-1)for(p=e.getDependentCells().values()[a],c=0,k=p.length;c<k;c++)v=p[c].split("!"),y=o.getRangeIndices(v[2]),o.model.allowCharts&&o.XLChart._refreshChartElements(y[0],y[1],parseInt(v[1])+1)},_parseSheetRef:function(n,t){for(var e,h=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),i=0,f=this.XLObj,c=f.model.sheetCount,u=[],s=[],r=f._getSheetNames(),o='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',l=/'[^'"]*'(?=(?:[^"]*"[^"]*")*[^"]*$)/g;i<r.length;)s.push(r[i].text),i++;for(i=0;i<c;i++)r[i].value!==r[i].text&&(e=new RegExp(r[i].text.replace(h,"\\$&")+o,"gi"),n.match(l)&&(this._singleQuote=!0),n.match(e)&&(n=n.replace(e,i+"/"),u.push(i)),s.indexOf(r[i].value)<0&&n.indexOf(r[i].value)>-1&&!t&&(e=new RegExp(r[i].value+o,"gi"),n.match(e)&&(n=n.replace(e,f._newSIndex+"/"),u.push(f._newSIndex))));for(i=0;i<u.length;){if(e=new RegExp(u[i]+"/"+o,"gi"),this._sheetNameSpclchar){if(!isNaN(r[u[i]].text)||!/^[a-zA-Z0-9- ]*$/.test(r[u[i]].text)||r[i].text.match("\\s+"))return n.replace(e,u[i]===f._newSIndex?f._generateSheetName(f._newSIndex):this._singleQuote?r[u[i]].text:"'"+r[u[i]].text+"'")}else n=n.replace(e,u[i]===f._newSIndex?f._generateSheetName(f._newSIndex):r[u[i]].value);i++;this._singleQuote=!1}return n},_refreshTextNode:function(i,r){var f=this.XLObj,e=n(i).find(".e-cf-databar"),u;r=t.isNullOrUndefined(r)?"":r;f.isUndefined(i)||(u=i.lastChild,u&&(u.nodeType===3||u.nodeType===1&&u.tagName==="A")?f._browserDetails.name==="msie"&&f._browserDetails.version==="8.0"?u.nodeValue=r:u.textContent=r:e.length>0?e.find(".e-databar-value")[0].innerHTML=r:i.appendChild(document.createTextNode(r)))},_formulaSelect:function(n){var i,t=i=n.text,r=this.XLEdit._editElem.text().slice(1);t.indexOf("(worksheet)")>-1&&(i=i.split(" (worksheet)")[0]);r.endsWith("[")&&this._tableRangesFormula[r.split("[")[0]]?(t=i="="+r+n.text.slice(1),this.XLEdit._processFormulaEditRange(t)):this.XLEdit._isNamedRange(i)||t.slice(1)=="TRUE"||t.slice(1)=="FALSE"||(t+="(");this.XLEdit._editElem.text(t);this.model.allowFormulaBar&&this._getInputBox().val(t);this.XLEdit._editElem.focusEnd();this._isFormulaSuggestion=!1;this.XLCellNav._canKeyBoardNavigate=!1},_isNamedRange:function(n){var i=this.XLObj.model.nameManager,t=i.length;if(n=n.slice(1),t)while(t--)if(i[t].name.toUpperCase()===n.toUpperCase())return!0;return!1},_getTableRange:function(n){var t=this.XLObj;return n.startsWith("=")&&(n=n.slice(1)),n=n.split(/[\[\]]+/),n.length>=2&&n[1].length?t._tableRangesFormula[n[0]][n[1]]:t._tableRangesFormula[n[0]]["#Data"]},_formulaBoxInputChange:function(n){var u=this.getActiveSheetIndex(),t=this.getSheet(u)._activeCell,i,r=this.element.find("#"+this._id+"_Edit");this.XLEdit._isFormulaEdit=!n.target.value.indexOf("=");this.XLEdit._isFormulaEdit&&this.XLEdit._processFormulaEditRange(n.target.value,!0);this.XLEdit._isEdit||(this.model.allowKeyboardNavigation&&this.XLCellNav._navToCell(t.rowIndex,t.colIndex),i=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"mergeIdx"),this._intrnlReq=!0,this.XLEdit.editCell(i?i.rowIndex:t.rowIndex,i?i.colIndex:t.colIndex,!0),this._intrnlReq=!1,r=this.element.find("#"+this._id+"_Edit"));r.text(n.target.value);n.target.focus();this.XLEdit._isCellEdit=!1},_formulaSuggestionStatus:function(n){this._isFormulaSuggestion=n.type==="open"},_updateFormulaCellRange:function(n,t){var f,r=this.XLObj,u=r.element.find("#"+r._id+"_Edit").not(":hidden"),i,e;!u.length&&this._isFormulaEdit&&(u=r.element.find("#"+r._id+"_Edit"),n=r.getSheet().sheetInfo.text+"!"+n);i=u.text();e=i[i.length-1];t&&this._validCharacters.indexOf(e)===-1?i=i+",":(f=this._getCharPosition(i),f>-1&&(i=i.substr(0,[f+1])));n=this._isSplChar?i+n.split("!")[1]:i+n;this._isSplChar=!1;u.text(n);this._editElem.focusEnd();r.model.allowFormulaBar&&r._getInputBox().val(n)},_getCharPosition:function(n){for(var t=n.length,i=this.XLObj.getSheet().sheetInfo;t--;){if(n[t]=="!")return this._isSplChar=!0,t;if(this._validCharacters.indexOf(n[t])>-1)return t}return-1},_processFormulaEditRange:function(t,i){var f,l,c,o,u=0,r=this.XLObj,e=r.XLDragFill._parseFormula(t),v=e.length,s,h,a;for(r._ctrlKeyCount=0,r._formulaRange=[],r.XLSelection._clearBorder(r._arrayAsString(r._ctrlFormulaBorder.concat(r._formulaBorder))),c=l=r.getActiveSheetIndex();u<v;){if(f=e[u],this._invalidOperators.indexOf(f)>-1)break;r._isCellReference(f)?(f=f.replace(/\$/g,""),e[u+1]===":"&&(u++,r._isCellReference(e[u+1])&&(f=f+":"+e[u+1],u++)),e[u-1].indexOf("!")===e[u-1].length-1&&(u++,h=e[u-1].split("!"),c=r._getSheetIndexByName(h[0])),l===c&&this._updateFormulaEditRange(f,r._ctrlKeyCount,a),c=l,r._ctrlKeyCount++):r._tableRangesFormula[f.split(/[\[\]]+/)[0]]&&(s=this._getTableRange(f),s&&(h=s.split("!"),a=r._getSheetIndexByName(h[0]),s=h[1].split("$").join(""),a===r.getActiveSheetIndex()&&this._updateFormulaEditRange(s,r._ctrlKeyCount)));u++}o=t.charAt(t.length-1);o==="("&&t.split("(").length===2?(r._isFormulaSuggestion=!1,r.model.allowFormulaBar&&r._getInputBox().val(t),i?n("#"+r._id+"_inputbox_suggestion").hide():r._getFormulaSuggElem().hide()):o===")"&&r.isFormula(t)&&(r.XLEdit._isFormulaEdit=!1,r._formulaRange=[],r._ctrlKeyCount=0);o===":"?(r._shiftKeyEnabled=!0,r._ctrlKeyCount--):this._validOperators.indexOf(o)>-1&&(r._dStartCell=r.getSheet(r.getActiveSheetIndex())._activeCell,r._shiftKeyEnabled=!1)},_updateFormulaEditRange:function(n,t){var i=this.XLObj,r=i.getRangeIndices(n);i._formulaRange[t]=n;i._dStartCell={rowIndex:r[0],colIndex:r[1]};i._dEndCell={rowIndex:r[2],colIndex:r[3]};i.XLSelection._focusBorder(i._dStartCell,i._dEndCell,i._formulaBorder[t%6])},calcOption:function(n){var t=this.XLObj,e,u,o,r,f,i;if(!t.model.isReadOnly&&(u=t.getActiveSheetIndex(),o={sheetIndex:u,reqType:"calc-option",type:"actionBegin",action:"calcoption"},!t._trigActionBegin(o))){for(i=1,e=t._sheets.length;i<e;i++)r=t._calcEngine,n?(r.setCalculatingSuspended(!1),f=t.getSheet(i).usedRange,t.setActiveSheetIndex(i),r.grid=t.model.sheets[i].sheetInfo.value,r.refreshRange(RangeInfo.cells(1,1,f.rowIndex+1,f.colIndex+1))):r.setCalculatingSuspended(!0);t.setActiveSheetIndex(u)}},calcNow:function(n){var t=this.XLObj;if(!t.model.isReadOnly){var u=t.getActiveSheetIndex(),s={sheetIndex:u,reqType:"calc-now",type:"actionBegin",action:"calcnow"},i=1,r,f,o=t._sheets.length,e;if(!t._trigActionBegin(s)){for(n&&(i=n,o=n+1);i<o;)r=t._calcEngine,r.setCalculatingSuspended(!1),f=t.getSheet(i).usedRange,t.setActiveSheetIndex(i),r.grid=t.model.sheets[i].sheetInfo.value,r.refreshRange(RangeInfo.cells(1,1,f.rowIndex+1,f.colIndex+1)),r.setCalculatingSuspended(!0),i++;t.setActiveSheetIndex(u);e={sheetIndex:u,reqType:"calc-now"};t._completeAction(e);t._trigActionComplete(e)}}},_rangeHasProperty:function(n,t,i){n&&(i=this.XLObj.getRangeData({range:n,property:[t]}));for(var r=0,u=i.length;r<u;){if(!this.XLObj.isUndefined(i[r][t]))return!0;r++}},saveEditingValue:function(){var a=this.XLObj,u,f,t,i,e,n,r,v,y,s,o,h,p,w,c,l;if(!a.model.isReadOnly){for(o={},c=a._dataContainer,e=Object.getOwnPropertyNames(c.sheets),o.EditedData=[],t=0,v=e.length;t<v;t++)for(i=c.sheets[e[t]],s=Object.getOwnPropertyNames(i),u=0,p=s.length;u<p;u++)for(n=parseInt(s[u]),h=Object.getOwnPropertyNames(i[n]),f=0,w=h.length;f<w;f++)r=parseInt(h[f]),i[n][r].isDirty&&(l=parseInt(e[t]),y={SheetIndex:l,Value:this.getPropertyValue(n,r,"value2",l),CellIndex:{RowIndex:n,ColIndex:r}},delete i[n][r].isDirty,o.EditedData.push(y));return o}}};n.fn.focusEnd=function(){var r;n(this).focus();var u=n("<span />").appendTo(n(this)),f=u.get(0),t=null,i=null;return document.selection?(t=document.body.createTextRange(),t.moveToElementText(f),t.select()):window.getSelection&&(r=this[0],t=document.createRange(),i=window.getSelection(),t.setStart(r,1),t.collapse(!0),i.removeAllRanges(),i.addRange(t),r.focus()),u.remove(),this};n.fn.altEnter=function(){var u,t,i,f,e,o,r;u=window.getSelection();t=u.anchorNode;i=t.nodeType===3?u.anchorOffset:t.textContent.length;f=t.textContent;e=f.slice(0,i);o=f.slice(i)||" ";t.textContent=e+"\n"+o;r=document.createRange();t.nodeType===3?(r.setStart(t,i+1),r.setEnd(t,i+1)):t.nodeType===1?(r.setStart(t.firstChild,i+1),r.setEnd(t.firstChild,i+1)):n(t).setInputPos(i+1);u.removeAllRanges();u.addRange(r)};n.fn.setCursorPosition=function(n){var u=this,t,i,r;u.focus();t=u[0].firstChild;i=document.createRange();t&&(i.setStart(t,n),i.setEnd(t,n));r=window.getSelection();r.removeAllRanges();r.addRange(i)}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.validation=function(n){this.XLObj=n;this._ruleSymbols={Greater:">",GreaterOrEqual:">=",Less:"<",LessOrEqual:"<=",Equal:"==",NotEqual:"!=",Between:">=&&<=&&=",NotBetween:">=&&<=&&!"};this._isErrorVisible=!1};t.spreadsheetFeatures.validation.prototype={_setValidation:function(){this.XLObj.model.allowDataValidation&&n.validator&&(this._initValidator(),this._setValidationToField())},_initValidator:function(){var i=n("#"+this.XLObj._id+"EditForm");t.isOnWebForms&&n.data(i[0],"validator",null);i.validate({errorClass:"e-field-validation-error",errorElement:"div",wrapper:"div",errorPlacement:function(i,r){var u=n("#"+n(r).data("id")).data("ejSpreadsheet"),o=u._getJSSheetContent(u.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content"),f=u.XLEdit._editCell,e=n(i).addClass("e-error");o.append(e);e.prepend(t.buildTag("div.e-errortail e-toparrow"));e.css({left:f[0].offsetLeft,top:f[0].offsetTop+f[0].offsetHeight});u.XLValidate._isErrorVisible=!0}})},_setValidationToField:function(){var n=this.XLObj,i=n.XLEdit.getPropertyValueByElem(n.getActiveCellElem(),"rule"),r;delete i.type;delete i.isApply;delete i.isHighlight;n.element.find("#"+n._id+"_ValElem").rules("add",i);r=n.element.find("#"+n._id+"EditForm").validate();t.isNullOrUndefined(i.required)||(r.settings.messages[name]={},r.settings.messages[name].required=n.XLEdit._EditCellDetails.fieldName+(n.XLEdit._EditCellDetails.rowIndex+1)+" is required");n.XLEdit._isValidation=!0},applyDVRules:function(n,i,r,u,f){var h,v,w,b,c={},e=this.XLObj,l=e.getActiveSheetIndex(),k=e.getSheet(l),d=!1,g,o,nt,a={range:n,values:i,numType:r,required:u,showErrorAlert:f,sheetIndex:l,reqType:"data-validation",type:"actionBegin",action:"applyvalidation"},tt,it,rt,p,y,s;if(!e._trigActionBegin(a)){n=a.range;i=a.values;r=a.numType;u=a.required;f=a.showErrorAlert;switch(r){case"decimal":if(parseFloat(i[1])>parseFloat(i[2])){e._showAlertDlg("Alert","NumberValidationAlert","",400);return}break;case"date":if(new Date(i[1])>new Date(i[2])){e._showAlertDlg("Alert","DateValidationAlert","",400);return}break;case"time":if(tt=Date.parse("01/01/1990 "+i[1]),it=Date.parse("01/01/1990 "+i[2]),i[2]&&i[2].length&&tt>it){e._showAlertDlg("Alert","TimeValidationAlert","",400);return}break;default:if(parseInt(i[1])>parseInt(i[2])){e._showAlertDlg("Alert","NumberValidationAlert","",400);return}}if(!e.model.isReadOnly&&e.model.allowDataValidation&&(e.model.allowSelection||!t.isNullOrUndefined(n))){g=e._getRangeArgs(n,"object");o=e._getSelectedCells(l,g).selCells;e._showDialog(e._id+"_Ribbon_Data_DataTools_DataValidation");c.required=!u;(i[0]!="Between"||i[0]!="NotBetween")&&i.length<3&&i.push("");switch(r){case"number":i.push("parseInt");c.digits=!0;i.push("number");break;case"decimal":i.push("parseFloat");c.number=!0;i.push("decimal");break;case"date":i.push("parseDate");c.date=!0;i.push("date");break;case"time":i.push("parseTime");i.push("time");break;case"text":i[1]="^"+i[1];i[2]="^"+i[2];i.push("length");i.push("text");break;case"list":rt=i[1];i=[];i.push(rt);i.push("list")}for(i.push(f),i.push(n?n:e._getSelectedItems(l,n)[1]),i.push(l),c.customVal=i.join("_"),c.isApply=!1,c.type=r,p=[],y={},s=0,w=o.length;s<w;s++)y={rowIndex:o[s].rowIndex,colIndex:o[s].colIndex,prevRule:e.XLEdit.getPropertyValue(o[s].rowIndex,o[s].colIndex,"rule")},e._isRowViewable(l,o[s].rowIndex)&&(v=e.getCell(o[s].rowIndex,o[s].colIndex),v.hasClass("e-hlcell")&&(d=!0),v.removeData("rule"),v.removeClass("e-hlcell")),e.XLEdit._updateDataContainer({rowIndex:o[s].rowIndex,colIndex:o[s].colIndex},{dataObj:{rule:c}}),e.model.actionComplete!==null&&(y.newRule=e.XLEdit.getPropertyValue(o[s].rowIndex,o[s].colIndex,"rule")),p.push(y);d===!0&&this.highlightInvalidData();k._isImported&&!k._isLoaded||e._isUndoRedo||e._isExport||(nt=i[2]==""?[i[0],i[1]]:[i[0],i[1],i[2]],h={showErrorAlert:i[5],values:nt,required:!c.required,rule:c,sheetIndex:l,reqType:"validation",operation:"apply-validation",selectedCell:p,range:e._getAlphaRange(l,o[0].rowIndex,o[0].colIndex,o[o.length-1].rowIndex,o[o.length-1].colIndex)},b={showErrorAlert:h.showErrorAlert,values:h.values,isRequired:h.required,rule:h.rule,sheetIndex:h.sheetIndex,reqType:h.reqType,operation:h.operation,selectedCell:h.selectedCell,range:h.range},e._completeAction(h),e._trigActionComplete(b))}}},clearDV:function(n){var i=this.XLObj,o,r,s,e,f,u,h;if(i.model.allowDataValidation&&!i.model.isReadOnly&&i.model.allowSelection){for(e=i.getActiveSheetIndex(),f={sheetIndex:e,reqType:"validation",operation:"clear-validation",selectedCell:[]},s=i._getRangeArgs(n,"object"),r=i._getSelectedCells(e,s).selCells,u=0,h=r.length;u<h;u++)f.selectedCell.push({rowIndex:r[u].rowIndex,colIndex:r[u].colIndex,rules:i.XLEdit.getPropertyValue(r[u].rowIndex,r[u].colIndex,"rule")}),i.clearRangeData([r[u].rowIndex,r[u].colIndex,r[u].rowIndex,r[u].colIndex],["rule"]),i._isRowViewable(e,r[u].rowIndex)&&(o=i.getCell(r[u].rowIndex,r[u].colIndex),t.isNullOrUndefined(i._ddlCell)||(i.element.find("#"+i._id+"ddl").ejDropDownList("hidePopup"),i.element.find("#"+i._id+"ddlspan").remove(),i._ddlCell=null),f.hlStatus=o.hasClass("e-hlcell"),o.removeClass("e-hlcell"));f.range=i._getAlphaRange(e,r[0].rowIndex,r[0].colIndex,r[r.length-1].rowIndex,r[r.length-1].colIndex);i._isUndoRedo||i._dupDetails||(i._completeAction(f),i._trigActionComplete(f))}},clearHighlightedValData:function(n){var r=this.XLObj,i,o,s,f,u,h,e;if(r.model.allowDataValidation&&!r.model.isReadOnly){for(f=r.getActiveSheetIndex(),o=r._getRangeArgs(n,"object"),i=r._getSelectedCells(f,o).selCells,u=0,h=i.length;u<h;u++)r._isRowViewable(f,i[u].rowIndex)&&(s=r.getCell(i[u].rowIndex,i[u].colIndex),s.removeClass("e-hlcell")),t.isNullOrUndefined(r.XLEdit.getPropertyValue(i[u].rowIndex,i[u].colIndex,"rule"))||(r._dataContainer.sheets[f][i[u].rowIndex][i[u].colIndex].rule.isApply=!1);r._isUndoRedo||(e={sheetIndex:f,reqType:"validation",operation:"cl-hl-data",range:t.isNullOrUndefined(n)?this.XLObj._getAlphaRange(1,i[0].rowIndex,i[0].colIndex,i[i.length-1].rowIndex,i[i.length-1].colIndex):n},r._completeAction(e),r._trigActionComplete(e))}},_checkValidation:function(n,i,r,u){var f=this.XLObj,p,o,e,w,l,b=f.model.locale,k=n,y,a,v,s,h,c;if(u=f._getSheetIndex(u),!JSON.parse(i[i.length-3])&&!r)return!0;if(i[4]==="time"&&(y=t.preferredCulture(b).calendar.patterns,n=f.formatting("{0:"+y.T+"}",t.parseDate(n,y.dT),b),n.length||(n=k)),n=this._convertValueByType(n,i[4]),i[1]=this._convertValueByType(i[1],i[4]),i[2]=this._convertValueByType(i[2],i[4]),n.length){if(i[i.length-4]==="list"){for(v=!1,i[0].indexOf(",")>-1?o=i[0].split(","):i[0].indexOf("=")>-1?(e=i[0].split("=")[1],w=f.getCalcEngine().getNamedRanges(),l=w.getItem(e.toUpperCase()),l&&(e=l),e.indexOf("!")>-1?(u=l?f._getSheetIdxFromSheetValue(e.split("!")[0]):f._getSheetIndexByName(e.split("!")[0]),o=e.split("!")[1].indexOf("$")>-1?f.getRangeData({sheetIdx:u,range:f.getRangeIndices(e.split("!")[1].split("$").join("")),valueOnly:!0}):e.indexOf("$")>-1?f.getRangeData({sheetIdx:u,range:f.getRangeIndices(e.split("$").join("")),valueOnly:!0}):f.getRangeData({sheetIdx:u,range:f.getRangeIndices(e.split("!")[1]),valueOnly:!0})):o=f.getRangeData({sheetIdx:u,range:f.getRangeIndices(e),valueOnly:!0})):o=n,a=0,p=o.length;a<p;a++)if(v=o[a].toString()===n,v)break;return t.Spreadsheet.msg=f._getLocStr("ListAlertMsg"),v}return i[0]=this._ruleSymbols[i[0]],i[1].indexOf("=")>-1&&(s=i[1].replace("=",""),h=this.getRangeIndices(s+":"+s),i[1]=f.XLEdit.getPropertyValue(h[0],h[1],null,u).toString()),i[2].indexOf("=")>-1&&(s=i[2].replace("=",""),h=this.getRangeIndices(s+":"+s),i[2]=f.XLEdit.getPropertyValue(h[0],h[1],null,u).toString()),i[0].length<=2?(t.Spreadsheet.msg="The "+i[4]+" should be "+t.Spreadsheet.ValidationText[i[0]]+" "+i[1].replace("^",""),f.operators[i[0]](f.parse[i[3]](n),f.parse[i[3]](i[1]))):(c=[],c=i[0].split("&&"),t.Spreadsheet.msg="The "+i[4]+" should"+t.Spreadsheet.ValidationText[c[2]]+" be between "+i[1].replace("^","")+" and "+i[2].replace("^",""),f.operators[c[2]](f.operators[c[0]](f.parse[i[3]](n),f.parse[i[3]](i[1]))&&f.operators[c[1]](f.parse[i[3]](n),f.parse[i[3]](i[2]))))}return!0},_convertValueByType:function(t,i){if(t.length){var r=this.XLObj;switch(i){case"number":case"decimal":r._isValidDate(t)&&(t=r._dateToInt(t));break;case"date":n.isNumeric(t)&&(t=r.intToDate(t).toString())}}return t},highlightInvalidData:function(n){var u=this.XLObj,l,a,r,h,s,i,o,f,e,c;if(u.model.allowDataValidation&&!u.model.isReadOnly){for(f=u.getActiveSheetIndex(),o=u._getRangeArgs(n,"object"),r=u._getSelectedCells(f,o).selCells,n=u._getAlphaRange(f,o[0],o[1],o[2],o[3]),i=0,l=r.length;i<l;i++)(e=u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"rule",f),e)&&(u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,null,f)&&!t.isNullOrUndefined(e)?(a=u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"type",f)==="datetime"||u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"type",f)==="time"?u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"value2",f).toString():u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,null,f).toString(),s=e?!this._checkValidation(a,e.customVal.split("_"),!0,f):!1,u._dataContainer.sheets[f][r[i].rowIndex][r[i].colIndex].rule.isApply=s):t.isNullOrUndefined(e)||(s=e.required),u._isRowViewable(f,r[i].rowIndex)&&(h=u.getCell(r[i].rowIndex,r[i].colIndex,f),s?h.addClass("e-hlcell"):h.removeClass("e-hlcell")),u.XLEdit._updateDataContainer({rowIndex:r[i].rowIndex,colIndex:r[i].colIndex},{dataObj:{isHighlight:!0},sheetIdx:f}));u._isUndoRedo||(c={sheetIndex:f,reqType:"validation",operation:"hl-data",range:n},u._completeAction(c),u._trigActionComplete(c))}},_replaceRule:function(n,t){this.XLObj._dataContainer.cFormatData[n]=t},_addDVMethod:function(){t.isNullOrUndefined(n.validator)||n.validator.addMethod("customVal",function(t,i,r){var u=n("#"+n(i).data("id")).data("ejSpreadsheet"),f=u._getJSSheetContent(u.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content");return(f.find(".e-error").remove(),u.model.showRibbon&&n("#"+u._id+"_Ribbon_freetext").length&&!n("#"+u._id+"_Ribbon_freetext").data("ejCheckBox").isChecked())?!0:u.XLValidate._checkValidation(t,r.split("_"))},t.Spreadsheet.getMsg)}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.dragFill=function(n){this.XLObj=n;this._customList=[["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["January","February","March","April","May","June","July","August","September","October","November","December"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]];this._property=["value","value2","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","format","rule"];this._fillInfo=null;this._verticalFill=!1;this._uniqueOBracket=String.fromCharCode(129);this._uniqueCBracket=String.fromCharCode(130);this._uniqueCSeparator=String.fromCharCode(131);this._uniqueCOperator=String.fromCharCode(132);this._uniquePOperator=String.fromCharCode(133);this._uniqueSOperator=String.fromCharCode(134);this._uniqueMOperator=String.fromCharCode(135);this._uniqueDOperator=String.fromCharCode(136);this._uniqueModOperator=String.fromCharCode(137);this._uniqueConcateOperator=String.fromCharCode(138);this._uniqueEqualOperator=String.fromCharCode(139);this._uniqueExpOperator=String.fromCharCode(140);this._uniqueGTOperator=String.fromCharCode(141);this._uniqueLTOperator=String.fromCharCode(142)};t.spreadsheetFeatures.dragFill.prototype={positionAutoFillElement:function(n){var l,r,u,f,s,t,e=0,o=0,a=0,h=0,v=0,c=0,i=this.XLObj,y="e-hide";if(i.model.allowAutoFill&&i.model.allowSelection){if(s=i.getActiveSheetIndex(),t=i.getSheet(s),t._isRowSelected)a=-3,h=-1,v=5,c=4,r=t.selectedRange[2],u=t.selectedRange[1],o=i._isFrozen(t.frozenColumns)?i._getContent(s).find(".e-content").scrollLeft():t._scrollLeft;else if(t._isColSelected)h=-3,c=5,r=t.selectedRange[0],u=t.selectedRange[3],e=i._isFrozen(t.frozenRows)?i._getContent(s).find(".e-content").scrollTop():t._scrollTop;else{if(t._isSheetSelected){this.hideAutoFillElement();return}a=-3;h=-3;v=1;c=3;r=t.selectedRange[2];u=t.selectedRange[3]}l=i._getMergedIdx(r,u);r=l.rowIndex;u=l.colIndex;f=i._getCellInfo({rowIndex:r,colIndex:u});t._isColSelected||(e+=f.height);t._isRowSelected||(o+=f.width);e+=f.top;o+=f.left;i.getAutoFillElem()&&i.getAutoFillElem().removeClass(y).css({top:Math.round(e)+a,left:Math.round(o)+h});i.model.autoFillSettings.showFillOptions&&n&&i.model.allowEditing&&!i.model.isReadOnly&&i._getAutoFillOptElem().removeClass(y).css({top:e+v,left:o+c});t._autoFillCell=i._dautoFillCell={rowIndex:r,colIndex:u}}},hideAutoFillElement:function(){var n=this.XLObj.getAutoFillElem();n&&n.addClass("e-hide")},hideAutoFillOptions:function(){var n=this.XLObj._getAutoFillOptElem();n&&(n.find("button").data("ejSplitButton")||this.XLObj._initializeSplitButton(),n.find("button").data("ejSplitButton")._hidePopup(),n.addClass("e-hide"))},autoFill:function(i){var r=this.XLObj,s;if(i=i||{},r.model.allowAutoFill&&i.dataRange&&i.fillRange&&i.direction&&r.model.allowEditing&&!r.model.isReadOnly){var h,u,e=r.getActiveSheetIndex(),o=r.getSheet(e),f=t.Spreadsheet.AutoFillOptions;if(this._fillInfo=this._getFillInfo(i),i.fillType=i.fillType||this._fillInfo.fillType,this._verticalFill=i.direction==="down"||i.direction==="up",i.sheetIdx=e,i.dataRange=r._toIntrnlRange(i.dataRange,e),i.fillRange=r._toIntrnlRange(i.fillRange,e),h=n.extend(!0,{},o.rowsHeightCollection),u={sheetIndex:i.sheetIdx,bHeight:h,reqType:"auto-fill",direction:i.direction,range:i.fillRange,bRange:i.dataRange,bData:r.getRangeData({range:i.fillRange}),bFormat:r.model.allowCellFormatting&&r.XLFormat.getHashCodeClassAsArray(i.fillRange),isHighlightData:!1},u.rowSel=o._isRowSelected,u.colSel=o._isColSelected,r._trigger("autoFillBegin",i))return!1;switch(i.fillType){case f.FillSeries:case f.FillWithoutFormatting:this._fillSeries(i);break;case f.CopyCells:case f.FillFormattingOnly:this._copyCells(i);break;case f.FlashFill:u.actionType="flash-fill";u.bdData=r.getRangeData({range:i.dataRange});this._flashFill(i);u.adData=r.getRangeData({range:i.dataRange})}if(u.aData=r.getRangeData({range:i.fillRange}),u.aHeight=n.extend(!0,{},o.rowsHeightCollection),r.model.allowCellFormatting&&(u.aFormat=r.XLFormat.getHashCodeClassAsArray(i.fillRange)),i.isKeyFill||this.positionAutoFillElement(!0),r._completeAction(u),r._trigActionComplete(u),r._trigger("autoFillComplete",i),u.isHighlightData&&(r._pushHighlightData(u.range),r.XLClipboard._highLightRange.length&&u.operation!="hl-data")){for(s=0;s<r.XLClipboard._highLightRange.length;s++)r.XLValidate.highlightInvalidData(r.XLClipboard._highLightRange[s]);r.XLClipboard._highLightRange=[]}}},_updateFillValues:function(n,t,i,r,u,f,e,o,s,h){var c,l,a,v,y,p;return n?(c={rowIndex:t,colIndex:i+h},l={rowIndex:r,colIndex:i+h},a={rowIndex:f,colIndex:e+h},v={rowIndex:o,colIndex:e+h}):(c={rowIndex:t+h,colIndex:i},l={rowIndex:t+h,colIndex:u},a={rowIndex:f+h,colIndex:e},v={rowIndex:f+h,colIndex:s}),y=[c.rowIndex,c.colIndex,l.rowIndex,l.colIndex],p=[a.rowIndex,a.colIndex,v.rowIndex,v.colIndex],{patrnRange:y,fillRange:p}},_fillSeries:function(n){for(var u,st,o,i,ut,k,h,v,s,ht,c,d,g,ct,l,ft,y,et,p,lt,nt,e,ot=0,w={},r=this.XLObj,tt=t.Spreadsheet.autoFillDirection,it=t.Spreadsheet.CellType,at=n.dataRange[0],vt=n.dataRange[1],yt=n.dataRange[2],pt=n.dataRange[3],wt=n.fillRange[0],bt=n.fillRange[1],kt=n.fillRange[2],dt=n.fillRange[3],rt=[tt.Down,tt.Up].indexOf(n.direction)>-1,b=[tt.Up,tt.Left].indexOf(n.direction)>-1,gt=rt?pt-vt:yt-at,a=n.fillType===t.Spreadsheet.AutoFillOptions.FillSeries,f;ot<=gt;){if(ut=this._updateFillValues(rt,at,vt,yt,pt,wt,bt,kt,dt,ot),k=ut.patrnRange,h=ut.fillRange,o=this._getPattern(k,{isRFill:b,isVFill:rt}),v=r.getRangeData({range:k,property:["hyperlink","rule","cFormatRule","type","formatStr","decimalPlaces","wrap"]}),ht=v.length,!o)return;for(st=o.length,r.clearRangeData(h,[a?"formatStr":null,"hyperlink",a?"cFormatRule":null,"rule","format"]),a&&(r.model.allowCellFormatting&&r.XLFormat.removeStyle(h),y=r.getRangeData({range:k,property:["format","formats"]})),p=r._getSelectedRange({rowIndex:h[0],colIndex:h[1]},{rowIndex:h[2],colIndex:h[3]}),lt=p.length,b&&(p=p.reverse(),o=o.reverse(),o=this._ensurePattern(o),v=v.reverse(),a&&(y=y.reverse())),c=0;c<lt;){w={};nt=p[c];i=o[c%st];r.isNumber(i)&&(i=o[i]);switch(i.type){case it.Number:u=r._round(i.regVal.a+i.regVal.b*i.i,5);b?i.i--:i.i++;break;case it.String:u=i.val[i.i%i.val.length];i.i++;break;case it.Formula:for(ft=!1,u="=",d=0,ct=i.val.length;d<ct;)s=i.val[d],r._isObject(s)?(ft=!0,l=r._round(s.a+s.b*i.i,0),u+=l<1?"#REF!":rt?s.c+(s.b?l:"$"+l):(s.b?r._generateHeaderText(l):"$"+r._generateHeaderText(l))+s.c):u+=s,d++;ft&&b?i.i--:i.i++;break;case it.Custom:u=r._round(i.regVal.a+i.regVal.b*i.i,0);u<0&&(u=u%i.len+i.len);u>=i.len&&(u=u%i.len);u=i.val[u];b?i.i--:i.i++}if(g=c%ht,e=v[g],r._dupDetails=!0,f={cellIndex:nt,value:u,prevValue:r._getCellValue(nt.rowIndex,nt.colIndex).value,sheetIdx:r.getActiveSheetIndex(),reqType:"auto-fill",action:"fill-series"},r._trigger("cellSave",f))return;i.type=="formula"&&(r._saveTriggered=!0);r.XLEdit.updateCellValue(f.cellIndex,f.value,a?y[g].format:null);i.type=="formula"&&(r._saveTriggered=!1);r._dupDetails=!1;a&&(r.model.allowCellFormatting&&e.type&&e.type!="general"&&this._updateNFormat(e,f.cellIndex.rowIndex,f.cellIndex.colIndex),r.model.allowConditionalFormats&&e.cFormatRule&&this._updateCFormat(f.cellIndex,e.cFormatRule),et=y[g].formats,et&&(w.formats=et),r.model.allowHyperlink&&e.hyperlink&&this._updateHyperlinkTag(e.hyperlink,f.cellIndex));r.model.allowDataValidation&&e.rule&&(w.rule=e.rule);r.getObjectLength(w)&&r.XLEdit._updateDataContainer(f.cellIndex,{dataObj:w});r.model.allowWrap&&e.wrap&&r.setWrapText("wrap",[f.cellIndex.rowIndex,f.cellIndex.colIndex,f.cellIndex.rowIndex,f.cellIndex.colIndex]);c++}ot++}},_copyCells:function(n){for(var d=0,o,h,w,r,g,a,nt,c,v,y,tt,b,u,f,s={},i=this.XLObj,k=t.Spreadsheet.autoFillDirection,rt=n.dataRange[0],ut=n.dataRange[1],ft=n.dataRange[2],et=n.dataRange[3],st=n.fillRange[0],ht=n.fillRange[1],ct=n.fillRange[2],lt=n.fillRange[3],ot=[k.Down,k.Up].indexOf(n.direction)>-1,at=[k.Up,k.Left].indexOf(n.direction)>-1,vt=ot?et-ut:ft-rt,it=n.fillType===t.Spreadsheet.AutoFillOptions.FillFormattingOnly,l,p,e;d<=vt;){if(g=this._updateFillValues(ot,rt,ut,ft,et,st,ht,ct,lt,d),w=g.patrnRange,r=g.fillRange,i.model.allowCellFormatting)if(r[0]==r[2])for(l=[1];l<=[3];l++)i.XLEdit.getPropertyValue(r[0],l,"tformats")||i.XLEdit.getPropertyValue(r[0],l,"formats")||i.XLFormat.removeStyle([r[0],l,r[2],l]);else for(p=r[0];p<=r[2];p++)i.XLEdit.getPropertyValue(p,r[1],"tformats")||i.XLEdit.getPropertyValue(r[0],l,"formats")||i.XLFormat.removeStyle([p,r[1],p,r[3]]);if(it?(i.clearRangeData(r,["format"]),a=i.getRangeData({range:w,property:["cFormatRule","type","decimalPlaces","formatStr"]})):(b=["value","value2","type","formatStr","format","decimalPlaces","thousandSeparator","hyperlink"],i.model.allowConditionalFormats&&b.push("cFormatRule"),i.model.allowDataValidation&&b.push("rule"),i.clearRangeData(r,b),a=i.getRangeData({range:w,property:["value","hyperlink","rule","cFormatRule","type","decimalPlaces","formatStr"]})),c=i.getRangeData({range:w,property:["format","formats"]}),nt=c.length,y=i._getSelectedRange({rowIndex:r[0],colIndex:r[1]},{rowIndex:r[2],colIndex:r[3]}),tt=y.length,o=0,at&&(y=y.reverse(),c=c.reverse(),it||(a=a.reverse())),it)while(o<tt)s={},h=o%nt,f=y[o],u=a[h],i.model.allowCellFormatting&&(i.XLFormat._updateFormatClass(f,c[h].format),this._updateNFormat(u,f.rowIndex,f.colIndex)),v=c[h].formats,v&&(s.formats=v),i.getObjectLength(s)&&i.XLEdit._updateDataContainer(f,{dataObj:s}),i.model.allowConditionalFormats&&u.cFormatRule&&this._updateCFormat(f,u.cFormatRule),i.model.allowCellType&&i.XLCellType._rfrshCtrlText(f),o++;else while(o<tt){if(s={},h=o%nt,f=y[o],u=a[h],i._dupDetails=!0,e={cellIndex:f,value:u.value,prevValue:i._getCellValue(f.rowIndex,f.colIndex).value,format:c[h].format,sheetIdx:i.getActiveSheetIndex(),reqType:"auto-fill",action:"copy-cells"},i._trigger("cellSave",e))return;i.XLEdit.updateCellValue(e.cellIndex,e.value,e.format);i._dupDetails=!1;i.model.allowCellFormatting&&u.type&&u.type!="general"&&this._updateNFormat(u,e.cellIndex.rowIndex,e.cellIndex.colIndex);i.model.allowHyperlink&&u.hyperlink&&this._updateHyperlinkTag(u.hyperlink,e.cellIndex);v=c[h].formats;v&&(s.formats=v);i.model.allowDataValidation&&u.rule&&(s.rule=u.rule);i.getObjectLength(s)&&i.XLEdit._updateDataContainer(e.cellIndex,{dataObj:s});i.model.allowConditionalFormats&&u.cFormatRule&&this._updateCFormat(e.cellIndex,u.cFormatRule);o++}d++}},_flashFill:function(n){var r,o,i,t=this.XLObj,h=n.dataRange[0],c=n.dataRange[2],u=n.fillRange[0],l=n.fillRange[1],f=n.fillRange[2],a=n.fillRange[3],e=this._getFlashFillPattern(n.dataRange,"left"),s;if(e)for(o=t.getRangeData({range:[u,e.colIndex,f,e.colIndex],valueOnly:!0,skipDateTime:!0}),e.subStr>-1&&(o=this._splitString(o," ",e.subStr)),r=t._getSelectedRange({rowIndex:u,colIndex:l},{rowIndex:f,colIndex:a}),i=r.length;i--;){if(s={cellIndex:r[i],value:o[i],sheetIdx:t.getActiveSheetIndex(),prevValue:t._getCellValue(r[i].rowIndex,r[i].colIndex).value,reqType:"auto-fill",action:"flash-fill"},t._trigger("cellSave",s))return;t.XLEdit._updateCellValue(s.cellIndex,s.value)}else u>h&&(u=h),f<c&&(f=c),t._getAutoFillOptElem().addClass("e-hide"),t.updateUniqueData({value:"",value2:"",type:"general"},[u,l,f,a]),t._showAlertDlg("Alert","FlashFillAlert")},_getFlashFillPattern:function(n,i){var u,f,c,y,e,l,r=0,o=-1,a=this.XLObj,s=a.getRangeData({range:n,valueOnly:!0,skipDateTime:!0}),p=s.length,v=n[0],w=t.Spreadsheet.autoFillDirection.Right,h=i===w;if(s.join().replace(/,/g,"").length){for(l=s[0].toString(),r=n[1],r===0&&(h=!0),h?r++:r--;r>-1;)if(f=a.XLEdit.getPropertyValue(v,r),f=a.isUndefined(f)?"":f.toString(),f.length){if(f===l)if(p>1){if(u=this._matchData(v,r,s),u)return u}else return{colIndex:r,subStr:o};for(c=f.split(" "),y=c.length,e=0;e<y;){if(l===c[e])if(o=e,p>1){if(u=this._matchData(v,r,s),u)return o>u.subStr&&(u.subStr=o),u}else return{colIndex:r,subStr:o};e++}h?r++:r--}else break;if(!h)return this._getFlashFillPattern(n,w)}},_matchData:function(n,i,r){for(var u,o=!1,s,f,h,l,e=1,c=-1,a=r.length;e<a;){if(o=!1,s=r[e].toString(),f=this.XLObj.XLEdit.getPropertyValue(n+e,i),f=t.isNullOrUndefined(f)?"":f.toString(),s===f){o=!0;e++;continue}for(h=f.split(" "),l=h.length,u=0;u<l;){if(s===h[u]){c<u&&(c=u);o=!0;break}u++}e++}if(o&&e===a)return{colIndex:i,subStr:c}},_splitString:function(n,t,i){for(var e,u,f=n.length,r;f--;){for(r=i,e=n[f].split(t);r>-1;){if(u=e[r],u)break;r--}n[f]=u}return n},_getPattern:function(n,i){var u,o,s,a,l,v,w,b,h,e,y=0,f=[],k=this.XLObj,c=t.Spreadsheet.CellType,p=this._getDataPattern(n),d=p.length,r;if(p){while(y<d){r=p[y];switch(r.type){case c.Number:for(o=f.length,e=r.val.length,h=i.isRFill?-1:e,e===1&&r.val.push(r.val[0]+1),a=this._getPredictionValue(r.val),s={regVal:a,type:r.type,i:h},f.push(s),u=1;u<e;)f.push(o),u++;break;case c.String:for(o=f.length,s={val:r.val,type:r.type,i:0},f.push(s),u=1,e=r.val.length;u<e;)f.push(o),u++;break;case c.Formula:if(e=r.val.length,r=this._getFormulaPattern(r.val,i),h=i.isRFill?-1:e,r.isInPattern)for(o=f.length,s={val:r.val,type:c.Formula,i:h},f.push(s),u=1;u<e;)f.push(o),u++;else for(u=0,h=i.isRFill?-1:1;u<e;)f.push({val:r.val[u],type:c.Formula,i:h}),u++;break;default:if(r.type.indexOf(c.Custom)>-1)for(o=f.length,e=r.val.length,h=i.isRFill?-1:e,l=this._customList[Number(r.type.replace(c.Custom,""))],b=l.indexOf(r.val[0])===-1,v=k.toArrayLowerCase(l.slice(0)),w=k.toArrayLowerCase(r.val),a=this._getCustomPredictionValue(w,v),s={val:b?v:l,regVal:a,i:h,type:c.Custom,len:l.length},f.push(s),u=1;u<e;)f.push(o),u++}y++}return f}},_getCustomPredictionValue:function(n,t){for(var r=0,i=[],u=n.length;r<u;)i.push(t.indexOf(n[r])),r++;return i.length===1&&i.push(i[0]+1),this._getPredictionValue(i)},_getDataPattern:function(n){var i,r,u=0,t={},f=[],e=this.XLObj.getRangeData({range:n,valueOnly:!0,skipDateTime:!0}),o=e.length;if(o){while(u<o)i=e[u],r=this._getType(i),u===0?t={val:[i],type:r}:r===t.type?t.val.push(i):(f.push(t),t={val:[i],type:r}),u++;return f.push(t),f}},_getFormulaPattern:function(n,t){for(var r,o,f,s,c=this.XLObj,e=[],i=0,h=n.length,u;i<h;)e.push(this._parseFormula(n[i])),i++;if(s=this._isInPattern(e,t.isVFill),s){for(r=e[0],i=r.length;i--;)f=r[i],u=c._isCellReference(f),u&&u!=="absolute"&&(r[i]=this._getCellRefPrediction(f,t,null,u));return{isInPattern:s,val:r}}for(i=0;i<h;){for(r=e[i],o=r.length;o--;)f=r[o],u=c._isCellReference(f),u&&u!=="absolute"&&(e[i][o]=this._getCellRefPrediction(f,t,h,u));i++}return{isInPattern:s,val:e}},_getCellRefPrediction:function(n,t,i,r){n=n.toUpperCase();var f="",s=new RegExp("[a-z$]","gi"),h=new RegExp("[0-9$]","g"),e=t.isVFill?n.replace(h,f):n.replace(s,f),u=t.isVFill?Number(n.replace(s,f)):this.XLObj._generateColCount(n.replace(h,f)),o=[u],c=n[0]==="$";return i&&i!==1?o.push(u+i):o.push(u+1),u=this._getPredictionValue(o),r&&r==="mixed"&&(c===t.isVFill?e="$"+e:u.b=0),u.c=e,u},_isInPattern:function(n,t){var o,i,s,a,r,u,h,c,f=this.XLObj,e="",v=0,l=1,y=n.length,p=new RegExp("[0-9$]","g"),w=new RegExp("[a-z$]","gi");if(y===1)return!1;while(l<y){if(o=n[v],s=n[l],i=o.length,a=s.length,i!==a)return!1;while(i--)if(r=o[i],u=s[i],f._isCellReference(r)===f._isCellReference(u)){if(t?(h=Number(r.replace(w,e)),c=Number(u.replace(w,e))):(h=f._generateColCount(r.replace(p,e)),c=f._generateColCount(u.replace(p,e))),h!==c-1)return!1}else if(r!==u)return!1;v++;l++}return!0},_parseFormula:function(n){var t,i,f,u=0,r=[];for(n=this._markSpecialChar(n.replace("=","")),n=n.split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g),f=n.length;u<f;){if(t=n[u],!t){u++;continue}t.length===1?r.push(this._isUniqueChar(t)?this._getUniqueCharVal(t):t):(i=t[0],t.indexOf("!")>0?(this._isUniqueChar(i)&&(r.push(this._getUniqueCharVal(i)),t=t.substr(1)),i=t.indexOf("!")+1,r.push(t.substr(0,i)),r.push(t.substr(i))):this._isUniqueChar(i)?(r.push(this._getUniqueCharVal(i)),r.push(t.substr(1))):r.push(t));u++}return r},_getUniqueCharVal:function(n){switch(n){case this._uniqueOBracket:return"(";case this._uniqueCBracket:return")";case this._uniqueCSeparator:return",";case this._uniqueCOperator:return":";case this._uniquePOperator:return"+";case this._uniqueSOperator:return"-";case this._uniqueMOperator:return"*";case this._uniqueDOperator:return"/";case this._uniqueModOperator:return"%";case this._uniqueConcateOperator:return"&";case this._uniqueEqualOperator:return"=";case this._uniqueExpOperator:return"^";case this._uniqueGTOperator:return">";case this._uniqueLTOperator:return"<"}return""},_isUniqueChar:function(n){var t=n.charCodeAt(n);return t>=129&&t<=142},_markSpecialChar:function(n){return n=n.replace(/\(/g,"("+this._uniqueOBracket).replace(/\)/g,")"+this._uniqueCBracket),n=n.replace(/,/g,","+this._uniqueCSeparator).replace(/:/g,":"+this._uniqueCOperator),n=n.replace(/\+/g,"+"+this._uniquePOperator).replace(/-/g,"-"+this._uniqueSOperator),n=n.replace(/\*/g,"*"+this._uniqueMOperator).replace(/\//g,"/"+this._uniqueDOperator),n=n.replace(/&/g,"&"+this._uniqueConcateOperator),n=n.replace(/=/g,"="+this._uniqueEqualOperator),n=n.replace(/\^/g,"^"+this._uniqueExpOperator),n=n.replace(/>/g,">"+this._uniqueGTOperator).replace(/</g,"<"+this._uniqueLTOperator),n.replace(/%/g,"%"+this._uniqueModOperator)},_getPredictionValue:function(n){for(var t=0,i=0,u=0,f=0,r=0,e=n.length,o,s;t<e;)i=i+t,u=u+Number(n[t]),f=f+t*Number(n[t]),r=r+t*t,t++;return o=this.XLObj._round((u*r-i*f)/(e*r-i*i),5),s=this.XLObj._round((e*f-i*u)/(e*r-i*i),5),{a:o,b:s}},_getType:function(n){var i,u=this._isCustomType(n),r=t.Spreadsheet.CellType,f=this.XLObj;return u?i=u:f.isFormula(n)?i=r.Formula:f.isNumber(n)&&(i=r.Number),i||r.String},_isCustomType:function(n){n=n+"";n=n.toLowerCase();for(var i=this._customList.length;i--;)if(this.XLObj.toArrayLowerCase(this._customList[i].slice(0)).indexOf(n)>-1)return t.Spreadsheet.CellType.Custom+i;return!1},_ensurePattern:function(n){for(var i,u=-1,r=n.length;r--;)i=n[r],this.XLObj._isObject(i)?(u=r,i.type===t.Spreadsheet.CellType.String&&(i.val=i.val.reverse())):n[r]=u;return n},_selectAutoFillRange:function(n,t){n&&(t=this.XLObj._getCellIdx(n));var u,f,r=this.XLObj,i=this._getAutoFillRange(t);if(i){for(this._autoFillCleanUp(),f=r.getRange([i.startCell.rowIndex,i.startCell.colIndex,i.endCell.rowIndex,i.endCell.colIndex]),u=f.length;u--;)r.addClass(f[u],"e-autofillcell");r.XLSelection._focusRange(i.startCell,i.endCell,r._autofillBorder);r._dautoFillCell=t}},_getAutoFillRange:function(n){var o=t.Spreadsheet.autoFillDirection,a=this.XLObj,r=a.getSheet(a.getActiveSheetIndex()),y=r._startCell,p=r._endCell,s=r._autoFillCell,c=r.selectedRange,f=c[0],e=c[1],u=c[2],i=c[3],v=a.inRange(c,n.rowIndex,n.colIndex),h={rowIndex:f,colIndex:e},l={rowIndex:u,colIndex:i};if(n.rowIndex<s.rowIndex){if(r._isFreezed&&n.rowIndex<=r.frozenRows&&r._hiddenFreezeRows.indexOf(r.frozenRows)>-1&&(n.rowIndex=r._ftopRowIdx),f-n.rowIndex>n.colIndex-i&&f-n.rowIndex>e-n.colIndex)return v?{startCell:h,endCell:{rowIndex:n.rowIndex,colIndex:i}}:{startCell:l,endCell:{rowIndex:n.rowIndex,colIndex:e},fillRange:[n.rowIndex,e,f-1,i],direction:o.Up};if(n.colIndex>s.colIndex)return{startCell:h,endCell:{rowIndex:u,colIndex:n.colIndex},fillRange:[f,i+1,u,n.colIndex],direction:o.Right};if(n.colIndex<s.colIndex)return v?{startCell:h,endCell:l}:{startCell:l,endCell:{rowIndex:f,colIndex:n.colIndex},fillRange:[f,n.colIndex,u,e-1],direction:o.Left}}else{if(n.colIndex>s.colIndex)return n.rowIndex-u>n.colIndex-i?{startCell:h,endCell:{rowIndex:n.rowIndex,colIndex:i},fillRange:[u+1,e,n.rowIndex,i],direction:o.Down}:{startCell:h,endCell:{rowIndex:u,colIndex:n.colIndex},fillRange:[f,i+1,u,n.colIndex],direction:o.Right};if(n.colIndex<s.colIndex)return r._isFreezed&&n.colIndex<=r.frozenColumns&&r._hiddenFreezeCols.indexOf(r.frozenColumns)>-1&&(n.colIndex=r._fleftColIdx),n.rowIndex-u>i-n.colIndex||n.rowIndex-f>i-n.colIndex&&n.rowIndex!==u?{startCell:h,endCell:{rowIndex:n.rowIndex,colIndex:i},fillRange:[u+1,e,n.rowIndex,i],direction:o.Down}:v?{startCell:h,endCell:l}:{startCell:l,endCell:{rowIndex:f,colIndex:n.colIndex},fillRange:[f,n.colIndex,u,e-1],direction:o.Left};if(n.rowIndex>s.rowIndex)return{startCell:h,endCell:{rowIndex:n.rowIndex,colIndex:i},fillRange:[u+1,e,n.rowIndex,i],direction:o.Down};if(n.rowIndex===s.rowIndex&&n.colIndex===s.colIndex)return{startCell:y,endCell:p}}},_getDirection:function(n,i,r){var u=t.Spreadsheet.autoFillDirection;if(r=this.XLObj.isUndefined(r)?this._verticalFill:r,r){if(i.rowIndex<n.rowIndex)return u.Up;if(i.rowIndex>n.rowIndex)return u.Down;if(i.colIndex>n.colIndex)return u.Right;if(i.colIndex<n.colIndex)return u.Left}else{if(i.colIndex>n.colIndex)return u.Right;if(i.colIndex<n.colIndex)return u.Left;if(i.rowIndex<n.rowIndex)return u.Up;if(i.rowIndex>n.rowIndex)return u.Down}return null},_getFillRange:function(n,i,r,u){var f=t.Spreadsheet.autoFillDirection;switch(u){case f.Up:return[r.rowIndex,n.colIndex,n.rowIndex-1,i.colIndex];case f.Right:return[n.rowIndex,i.colIndex+1,i.rowIndex,r.colIndex];case f.Down:return[i.rowIndex+1,n.colIndex,r.rowIndex,i.colIndex];case f.Left:return[n.rowIndex,r.colIndex,i.rowIndex,n.colIndex-1]}return null},_autoFillOptionClick:function(t){var r,i,u,f,e,o,s,h=n("#"+t.model.targetID).find("#"+t.ID).find(">>");this._hasClass(h[0],"e-ss-fillselect")||(r=this.XLDragFill,i=this.getSheet(this.getActiveSheetIndex()),u=r._getDirection(this._pEndCell,this._pFillCell),f=this.swapRange([this._pStartCell.rowIndex,this._pStartCell.colIndex,this._pEndCell.rowIndex,this._pEndCell.colIndex]),e=r._getFillRange(this._pStartCell,this._pEndCell,this._pFillCell,u),o=i._startCell,s=i._endCell,this._isUndo=!0,this._performUndoRedo(),i._isColSelected||i._isRowSelected||(i._startCell=o,i._endCell=s,this.XLSelection.selectRange(i._startCell,i._endCell)),r.positionAutoFillElement(!0),r.autoFill({dataRange:f,fillRange:e,direction:u,fillType:t.ID}),r._fillInfo.fillType=t.ID,this._isUndo=!1)},_autoFillCleanUp:function(){var i,n,r,u,f="e-hide",t=this.XLObj,e=t.getAutoFillElem(),o=t._getAutoFillOptElem();for(e&&t.addClass(e[0],f),o&&t.addClass(o[0],f),r=t._getContent(t.getActiveSheetIndex())[0].querySelectorAll("td.e-autofillcell"),i=r.length;i--;)u=r[i],n=u.className,n=n.replace(/e-autofillcell|e-blur/g,""),n=n.replace(/ +/g," "),u.className=n},_autoFillClick:function(){var f,r=0,u="e-ss-fillselect",i=n("#"+this._id+"_ctxtmenu").find("li"),t=i.find("."+u);for(t.length&&(t=t[0],this._removeClass(t,u),this.addClass(t,"e-ss-filloption")),i.show(),f=this.XLDragFill._fillInfo.disableItems.length;r<f;)n(i[this.XLDragFill._fillInfo.disableItems[r]]).hide(),r++;i.filter("#"+this.XLDragFill._fillInfo.fillType).find("span").addClass(u)},_fillRange:function(n,i){var c,v,l,r,u,o,s,f={isKeyFill:!0},e=this.XLObj,a=e.getActiveSheetIndex(),y=e.getSheet(a),h=t.Spreadsheet.autoFillDirection;if(i=i?i:y.selectedRange,r=i[0],u=i[1],o=i[2],s=i[3],c=this._getDirection({rowIndex:r,colIndex:u},{rowIndex:o,colIndex:s},n),v=n?c===h.Down:c===h.Right,e.isRange(i)&&v)n?(f.dataRange=[r,u,r,s],f.fillRange=[r+1,u,o,s]):(f.dataRange=[r,u,o,u],f.fillRange=[r,u+1,o,s]);else{if(n){if(!r)return;f.dataRange=[r-1,u,r-1,s]}else{if(!u)return;f.dataRange=[r,u-1,o,u-1]}f.fillRange=i}(f.direction=n?h.Down:h.Right,f.fillType=t.Spreadsheet.AutoFillOptions.CopyCells,l=e.swapRange(f.fillRange),e.model.allowLockCell&&y.isSheetProtected&&e._isPropExists([l],"isLocked",a))||e._isPropExists([l],"isReadOnly",a)||this.autoFill(f)},_getFillInfo:function(n){var e,i,o=!0,u=t.Spreadsheet.AutoFillOptions.CopyCells,s=[],r=this.XLObj,h=t.Spreadsheet.autoFillDirection,c=[h.Down,h.Up].indexOf(n.direction)>-1,f=r.getRangeData({range:n.dataRange,valueOnly:!0,skipDateTime:!0}),l=f.join().replace(/,/g,"").length;if(r.isRange(n.dataRange)&&l){for(e=f.length;e--;)if(i=f[e],r.isNumber(i)||r.isFormula(i)||this._isCustomType(i)){o=!1;u=r.model.autoFillSettings.fillType;break}}else i=f[0],(r.isNumber(i)||r.isFormula(i)||this._isCustomType(i))&&(o=!1,u=r.model.autoFillSettings.fillType);return(!l||o)&&(s.push(1),u=n.fillType=="fillseries"?u:n.fillType),(!c||c&&n.dataRange[1]!==n.dataRange[3])&&s.push(4),{fillType:u,disableItems:s}},_updateHyperlinkTag:function(i,r){var f,u=this.XLObj,e=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2");u._isRowViewable(u.getActiveSheetIndex(),r.rowIndex)&&(f=u.getCell(r.rowIndex,r.colIndex),f[0].lastChild.nodeType===3&&n(f[0].lastChild).remove(),f.append(t.buildTag("a.e-hyperlinks",e,"",i.webAddr?{href:i.webAddr,target:"_blank"}:{href:"#"})));u.XLEdit._updateDataContainer(r,{dataObj:{hyperlink:i}})},_updateCFormat:function(n,t){var i,r=0,u=this.XLObj,f=t.length;for(u._dupDetails=!0;r<f;)i=t[r].split("_"),i[0]!="iconsets"&&i[0]!="databar"&&i[0]!="colorscale"&&u.XLCFormat._cFormat(i[0],i[2],i[3],i[4],i[5],null,null,[n.rowIndex,n.colIndex,n.rowIndex,n.colIndex]),r++;u._dupDetails=!1},_updateNFormat:function(n,t,i){var u={type:n.type},r=this.XLObj;n.type!="general"&&(n.formatStr&&(u.formatStr=n.formatStr),"decimalPlaces"in n&&(u.decimalPlaces=n.decimalPlaces));r._dupDetails=!0;r.XLFormat.format(u,r._getAlphaRange(r.getActiveSheetIndex(),t,i,t,i));r._dupDetails=!1}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.cellNavigation=function(n){this.XLObj=n;this._canKeyBoardNavigate=!0;this._isNavigate=!0};t.spreadsheetFeatures.cellNavigation.prototype={_selectionKeyDownHandler:function(n){var l,p,e,w,v,g,ut,rt,ft=!1,d=[],t=this.XLObj,b=t.getActiveSheetIndex(),i=t.getSheet(b),f=n.keyCode,k=n.shiftKey,nt=n.ctrlKey,o={keyCode:f,shiftKey:k,ctrlKey:nt,altKey:n.altKey},tt=!1,r=i._activeCell,a=i._endCell,s=i.rowCount,c=i.colCount,it=t._dataContainer,y,u,h=i.usedRange;if((f===9&&this._canKeyBoardNavigate||f===13)&&!nt){if(n.preventDefault(),l=t.XLEdit.getCurrentEditCellData(),t.isFormula(l)&&!t.XLEdit._formulaValidate(l))return;if(t.XLEdit._isFormulaEdit&&!t._isFormulaSuggestion)if(l.length>1)if(this._isValidParameter(l)){if(!t.isFormula(l)){if(l=l+")",l.split("(").length!==l.split(")").length){t._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);return}t.XLEdit._editElem.text(l);t.model.allowFormulaBar&&t._getInputBox().val(l)}t.XLEdit.saveCell();t._getContent(b).find("td").removeClass(t._formulaBorder.join(" ").replace(/,/g," ")+" "+t._ctrlFormulaBorder.join(" ").replace(/,/g," "));t.XLSelection._cleanUp();t.XLSelection.selectRange(i._activeCell,i._activeCell);t.XLEdit._isFormulaEdit=!1;t._formulaRange=[];t._ctrlKeyCount=0}else{t._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);return}else t.XLEdit.saveCell(),t.XLEdit._isFormulaEdit=!1;else f===9&&t.XLEdit._isEdit&&t.XLEdit.saveCell();p=i.selectedRange;rt=i._isRowSelected||i._isColSelected;rt?p[0]===p[2]||p[1]===p[3]?d.push({rowIndex:p[0],colIndex:p[1]}):d=i._selectedCells:d=i._selectedCells;d.length&&(d.length===1||!rt&&this._isRangeMerged(d)?i._isRowSelected?k?r.colIndex>0&&this._navigateRow("Backward",o):r.colIndex<39&&this._navigateRow("Forward",o):i._isColSelected?k?r.rowIndex>0&&this._navigateCol("Backward",o):r.rowIndex<39&&this._navigateCol("Forward",o):k?f===9&&r.colIndex>0?this._navigateCell(r.rowIndex,r.colIndex-1,o):f===13&&r.rowIndex>0&&this._navigateCell(r.rowIndex-1,r.colIndex,o):f===9&&r.colIndex<c?this._navigateCell(r.rowIndex,r.colIndex+1,o):f===13&&r.rowIndex<s&&this._navigateCell(r.rowIndex+1,r.colIndex,o):k?f===9?this._navigateRange("ShiftTab",o):this._navigateRange("ShiftEnter",o):f===9?this._navigateRange("Tab",o):this._navigateRange("Enter",o))}else if((f===37||f===38&&!t._isFormulaSuggestion||f===39||f===40&&!t._isFormulaSuggestion)&&this._isNavigate)if(n.preventDefault(),t.XLEdit._isFormulaEdit)v=t.swapRange([t._dStartCell.rowIndex,t._dStartCell.colIndex,t._dEndCell.rowIndex,t._dEndCell.colIndex]),t.getRange([v[0]?v[0]-1:v[0],v[1]?v[1]-1:v[1],v[2],v[3]]).removeClass(t._formulaBorder[t._ctrlKeyCount%6].join(" ")+" "+t._ctrlFormulaBorder[t._ctrlKeyCount%6].join(" ")),nt&&(e=t._dStartCell,f===37&&e.colIndex>0?t._dStartCell=t._dEndCell={rowIndex:e.rowIndex,colIndex:0}:f===38&&e.rowIndex>0?t._dStartCell=t._dEndCell={rowIndex:0,colIndex:e.colIndex}:f===39&&e.colIndex<i.colCount?t._dStartCell=t._dEndCell={rowIndex:e.rowIndex,colIndex:i.colCount}:f===40&&e.rowIndex<s&&(t._dStartCell=t._dEndCell={rowIndex:i.colCount,colIndex:e.colIndex})),k||t._shiftKeyEnabled?(w=t._dEndCell,e=t._dStartCell,f===37&&e.colIndex>0?t._dStartCell={rowIndex:e.rowIndex,colIndex:e.colIndex-1}:f===38&&e.rowIndex>0?t._dStartCell={rowIndex:e.rowIndex-1,colIndex:e.colIndex}:f===39&&w.colIndex<i.colCount?t._dEndCell={rowIndex:w.rowIndex,colIndex:w.colIndex+1}:f===40&&w.rowIndex<i.rowCount&&(t._dEndCell={rowIndex:w.rowIndex+1,colIndex:w.colIndex})):(e=t._dStartCell,f===37&&e.colIndex>0?t._dStartCell=t._dEndCell={rowIndex:e.rowIndex,colIndex:e.colIndex-1}:f===38&&e.rowIndex>0?t._dStartCell=t._dEndCell={rowIndex:e.rowIndex-1,colIndex:e.colIndex}:f===39&&e.colIndex<i.colCount?t._dStartCell=t._dEndCell={rowIndex:e.rowIndex,colIndex:e.colIndex+1}:f===40&&e.rowIndex<i.rowCount&&(t._dStartCell=t._dEndCell={rowIndex:e.rowIndex+1,colIndex:e.colIndex})),t.XLSelection._processFormulaRange(t._ctrlFormulaBorder),t._formulaRange[t._ctrlKeyCount]=t._getProperAlphaRange(b,t._dStartCell.rowIndex,t._dStartCell.colIndex,t._dEndCell.rowIndex,t._dEndCell.colIndex);else if(nt){if(f===37&&r.colIndex>0){if(y=it.sheets[b][r.rowIndex],u=r.colIndex-1,y&&u<h.colIndex)if(t.XLEdit.getPropertyValue(r.rowIndex,u+1,"value2")&&t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")){while(t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")&&u<=h.colIndex)u--;c=u+1}else{while(!t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")&&u<h.colIndex&&u>0)u--;c=u}else if(t.XLEdit.getPropertyValue(r.rowIndex,h.colIndex,"value2"))c=h.colIndex;else{for(u=h.colIndex;u>0&&!t.XLEdit.getPropertyValue(r.rowIndex,u,"value2");)u--;c=u}this._navigateCell(r.rowIndex,c,o)}else if(f===38&&r.rowIndex>0){if(y=it.sheets[b],u=r.rowIndex-1,u<=h.rowIndex)if(y[u]&&t.XLEdit.getPropertyValue(u+1,r.colIndex,"value2")&&t.XLEdit.getPropertyValue(u,r.colIndex,"value2")){while(t.XLEdit.getPropertyValue(u,r.colIndex,"value2")&&u<=h.rowIndex)u--;s=u+1}else{while(!t.XLEdit.getPropertyValue(u,r.colIndex,"value2")&&u>0)u--;s=u}else if(t.XLEdit.getPropertyValue(h.rowIndex,r.colIndex,"value2"))s=h.rowIndex;else{for(u=h.rowIndex;u>0&&!t.XLEdit.getPropertyValue(u,r.colIndex,"value2");)u--;s=u}this._navigateCell(s,r.colIndex,o)}else if(f===39&&r.colIndex<c-1){if(y=it.sheets[b][r.rowIndex],u=r.colIndex+1,y&&u<=h.colIndex)if(t.XLEdit.getPropertyValue(r.rowIndex,u-1,"value2")&&t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")){while(t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")&&u<=h.colIndex)u++;c=u-1}else{while(!t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")&&u<h.colIndex)u++;c=t.XLEdit.getPropertyValue(r.rowIndex,u,"value2")?u:i.colCount}else c=i.colCount;c===i.colCount&&--c;this._navigateCell(r.rowIndex,c,o)}else if(f===40&&r.rowIndex<s-1){if(y=it.sheets[b],u=r.rowIndex+1,u<h.rowIndex)if(y[u]&&t.XLEdit.getPropertyValue(u-1,r.colIndex,"value2")&&t.XLEdit.getPropertyValue(u,r.colIndex,"value2")){while(t.XLEdit.getPropertyValue(u,r.colIndex,"value2")&&u<=h.rowIndex)u++;s=u-1}else{while(!t.XLEdit.getPropertyValue(u,r.colIndex,"value2")&&u<i.rowCount)u++;s=u}else s=i.rowCount-1;s===i.rowCount&&--s;this._navigateCell(s,r.colIndex,o)}}else if(k){if(f===37&&a.colIndex>0?i._endCell={rowIndex:a.rowIndex,colIndex:a.colIndex-1}:f===38&&a.rowIndex>0?(tt=!0,i._endCell={rowIndex:a.rowIndex-1,colIndex:a.colIndex}):f===39&&a.colIndex<c?i._endCell={rowIndex:a.rowIndex,colIndex:a.colIndex+1}:f===40&&a.rowIndex<s&&(tt=!0,i._endCell={rowIndex:a.rowIndex+1,colIndex:a.colIndex}),(i.rowCount===i._endCell.rowIndex||i.colCount===i._endCell.colIndex)&&t.model.scrollSettings.scrollMode==="normal")return;if((i.rowCount===i._endCell.rowIndex||i.colCount===i._endCell.colIndex)&&!t.model.scrollSettings.allowScrolling)return;t.model.scrollSettings.allowScrolling&&(i.rowCount===i._endCell.rowIndex&&f===40?t._scrollContent({x:0,y:+t.model.rowHeight}):i.colCount-1===i._endCell.colIndex&&f===39&&t._scrollContent({x:+t.model.columnWidth,y:0}));this._isHiddenCell(i._endCell)&&(g={rowIndex:i._endCell.rowIndex,colIndex:i._endCell.colIndex},this._skipHiddenRowsAndCols(g,o),i._endCell.rowIndex=g.rowIndex,i._endCell.colIndex=g.colIndex);(t._isPropExists([[i._startCell.rowIndex,i._endCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex]],"merge")||t._isPropExists([[i._startCell.rowIndex,i._endCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex]],"isMHide"))&&(ft=!0);(t.XLEdit.getPropertyValue(i._endCell.rowIndex,i._endCell.colIndex,"isMHide")||t.XLEdit.getPropertyValue(i._endCell.rowIndex,i._endCell.colIndex,"merge")||tt&&t._isPropExists([[i._endCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex]],"merge")||t._isPropExists([[i._endCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex]],"isMHide")||ft)&&(tt=!1,t.XLSelection._processBoundary(),(f===37||f==38)&&(ut=i._endCell,i._endCell=i._startCell,i._startCell=ut));(i._endCell.colIndex<=i._leftCol.idx||i._endCell.colIndex>=i._rightCol.idx||i._endCell.rowIndex<=i._topRow.idx||i._endCell.rowIndex>=i._bottomRow.idx)&&this._scrollToCell(i._endCell,o);t.XLSelection.selectRange(i._startCell,i._endCell);t.model.allowAutoFill&&t.XLDragFill.positionAutoFillElement()}else if(o={keyCode:f,shiftKey:!1,ctrlKey:!1,altKey:!1},f===37&&r.colIndex>0)this._navigateCell(r.rowIndex,r.colIndex-1,o);else if(f===38&&r.rowIndex>0)this._navigateCell(r.rowIndex-1,r.colIndex,o);else if(f===39&&r.colIndex<c)this._navigateCell(r.rowIndex,r.colIndex+1,o);else if(f===40&&r.rowIndex<s)this._navigateCell(r.rowIndex+1,r.colIndex,o);else return!1},_navigateCell:function(i,r,u){var p,s,nt,w,b,tt,it,rt,k,d,o={rowIndex:i,colIndex:r},e=this.XLObj,c=e.getActiveSheetIndex(),f=e.getSheet(c),a=e._getContent(c),h=a.find("#hscrollBar").data("ejScrollBar"),l=a.find("#vscrollBar").data("ejScrollBar"),y=a.find(".e-content"),ut=e.XLEdit,v=!1,g=y[0].offsetWidth;if((f.rowCount!==o.rowIndex&&f.colCount!==o.colIndex||e.model.scrollSettings.scrollMode!=="normal")&&(f.rowCount!==o.rowIndex||!e.model.scrollSettings.allowVirtualScrolling)&&(f.rowCount!==o.rowIndex&&f.colCount!==o.colIndex||e.model.scrollSettings.allowScrolling)){for(f.rowCount===o.rowIndex&&(e.XLScroll._scrollY(c),v=!0),e._isAutoWHMode||f.colCount!==o.colIndex||e.model.scrollSettings.scrollMode!==t.Spreadsheet.scrollMode.Infinite||(e.XLScroll._scrollX(c),v=!0),this._navToCell(i,r),this._isHiddenCell(o)&&this._skipHiddenRowsAndCols(o,u),b=ut.getPropertyValue(f._activeCell.rowIndex,f._activeCell.colIndex,"merge"),b&&ut.getPropertyValue(o.rowIndex,o.colIndex,"mergeIdx")&&this._updateMergeRange(b,o,u),f._activeCell=f._endCell=f._startCell=o,(e.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"mergeIdx")||e.hasSpan(o))&&(e.XLSelection._processBoundary(),f._activeCell=f._startCell,nt=!0),s=e._getCellInfo(o,c),w=f._leftCol.idx>0?f._leftCol.idx-1:f._leftCol.idx,e.model.scrollSettings.allowScrolling&&f._bottomRow.idx<=o.rowIndex&&(u.keyCode===40||u.keyCode===13&&!u.shiftKey)&&!v&&!f._isFreezed?(l._scrollData.step=1,u.ctrlKey&&u.keyCode===40?e.XLScroll._scrollSelectedPosition(c,e.getActiveCell(c)):l.scroll(l.value()+(e._isFrozen(f.frozenRows)?e._getRowHeight(f._ftopRowIdx,c):s.height),!0)):e.model.scrollSettings.allowScrolling&&!e._isFrozen(f.frozenRows)&&f._topRow.idx>o.rowIndex&&(u.keyCode===38||u.keyCode===13&&u.shiftKey)&&!v&&!e._hasClass(a.find("tr").eq(o.rowIndex)[0],"e-fr-hide")&&(l._scrollData.step=-1,o.rowIndex>0?u.ctrlKey?l.scroll(s.top,!0):l.scroll(l.value()-s.height,!0):l.scroll(0)),e.model.scrollSettings.allowScrolling&&r>=f._rightCol.idx&&g<=f._colWidthCollection[f._activeCell.colIndex]-f._colWidthCollection[w]+s.width&&(u.keyCode===39||u.keyCode===9&&!u.shiftKey)&&!v?(h._scrollData.step=1,u.ctrlKey&&u.keyCode===39?h.scroll(s.left+s.width-h._scrollData.handleSpace,!0):h.scroll(h.value()+(e._isFrozen(f.frozenColumns)?e._getColWidth(f._fleftColIdx,c):s.width),!0)):e.model.scrollSettings.allowScrolling&&!e._isFrozen(f.frozenColumns)&&w>=o.colIndex&&(u.keyCode===37||u.keyCode===9&&u.shiftKey)&&!v?(h._scrollData.step=-1,o.colIndex>0?u.ctrlKey?h.scroll(s.left,!0):h.scroll(h.value()-s.width,!0):h.scroll(0)):e.model.scrollSettings.allowScrolling&&u.ctrlKey&&!v&&!f._isFreezed&&(u.keyCode===37?h.scroll(s.left,!0):u.keyCode===38?l.scroll(s.top,!0):u.keyCode===39?h.scroll(s.left-h._scrollData.handleSpace,!0):e.XLScroll._scrollSelectedPosition(c,e.getActiveCell(c))),p=a.find("col"),tt=n(e.getRows(c)[1]),it=f._startCell.rowIndex,rt=f._startCell.colIndex,(g>=s.left||y.offset().left+g>=s.left+s.width)&&(u.keyCode==39||u.keyCode==9&&!u.shiftKey)?e.XLSelection.selectRange(f._startCell,f._startCell):!p.eq(rt).hasClass("e-fc-hide")||u.keyCode==37||u.keyCode==9&&u.shiftKey?e.XLSelection.selectRange(f._startCell,f._endCell):!tt.eq(it).hasClass("e-fr-hide")&&(u.keyCode==38||u.keyCode==13&&u.shiftKey)?e.XLSelection.selectRange(f._startCell,f._endCell):(y.offset().top+y[0].offsetHeight>=s.top||y.offset().top+y[0].offsetHeight>=s.top+s.height)&&(u.keyCode==40||u.keyCode==13&&!u.shiftKey)&&e.XLSelection.selectRange(f._startCell,f._endCell),nt&&(u.keyCode===37||u.shiftKey&&u.keyCode===9?o.colIndex=f._startCell.colIndex:u.keyCode===38||u.shiftKey&&u.keyCode===13?o.rowIndex=f._startCell.rowIndex:u.keyCode===39||u.keyCode===9?o.colIndex=f._endCell.colIndex:(u.keyCode===40||u.keyCode===13)&&(o.rowIndex=f._endCell.rowIndex),f._activeCell=o),f._startCell=o;(u.keyCode===37||u.shiftKey&&u.keyCode===9)&&e._hasClass(p[f._startCell.colIndex],"e-c-hide");)e._removeClass(p[f._startCell.colIndex],"e-fc-hide"),f._startCell.colIndex--;while((u.keyCode===38||u.shiftKey&&u.keyCode===13)&&e._hasClass(a.find("tr")[f._startCell.rowIndex],"e-r-hide"))e._removeClass(a.find("tr")[f._startCell.rowIndex],"e-fr-hide"),f._startCell.rowIndex--;while((u.keyCode===39||u.keyCode===9)&&e._hasClass(p[f._startCell.colIndex],"e-c-hide"))f._startCell.colIndex++;while((u.keyCode===40||u.keyCode===13)&&e._hasClass(a.find("tr")[f._startCell.rowIndex],"e-r-hide"))f._startCell.rowIndex++;k=f._startCell.rowIndex;d=f._startCell.colIndex;e.model.selectionSettings.selectionType==="row"?e.XLSelection.selectRows(k,k):e.model.selectionSettings.selectionType==="column"&&e.XLSelection.selectColumns(d,d);e.model.showRibbon&&e.XLRibbon._updateRibbonIcons();e.model.allowAutoFill&&e.XLDragFill.positionAutoFillElement()}},_navToCell:function(n,t){var u=this.XLObj,i=u.getSheet(),f,e,r;if(f=e=0,i._isFreezed){if(i._frozenRows-1<=n&&n<i._ftopRowIdx){for(r=n;r<i._ftopRowIdx;r++)f+=i.rowsHeightCollection[r];u._scrollContent({y:-f})}else if(i._frozenRows-1<=n&&n>i._bottomRow.idx){for(r=i._bottomRow.idx;r<n;r++)f+=i.rowsHeightCollection[r];u._scrollContent({y:+f})}if(i._frozenColumns-1<=t&&t<i._fleftColIdx){for(r=t;r<i._fleftColIdx;r++)e+=i.columnsWidthCollection[r];u._scrollContent({x:-e})}else if(i._frozenColumns-1<=t&&t>i._rightCol.idx){for(r=i._rightCol.idx;r<t;r++)e+=i.columnsWidthCollection[r];u._scrollContent({x:+e})}}},_navigateRange:function(n,t){var c=this.XLObj,h=c.getSheet(c.getActiveSheetIndex()),r=h._startCell,u=h._endCell,i=h._activeCell,f=r.rowIndex<u.rowIndex?r.rowIndex:u.rowIndex,e=r.rowIndex>u.rowIndex?r.rowIndex:u.rowIndex,o=r.colIndex<u.colIndex?r.colIndex:u.colIndex,s=r.colIndex>u.colIndex?r.colIndex:u.colIndex;if(n=="Tab")if(i.colIndex<s)this._navigateRow("Forward",t);else if(i.rowIndex<e)this._updateActiveCell(i.rowIndex+1,o,t,n);else if(i.rowIndex==e&&i.colIndex==s)this._updateActiveCell(f,o,t,n);else return!1;else if(n=="Enter")if(i.rowIndex<e)this._navigateCol("Forward",t);else if(i.colIndex<s)this._updateActiveCell(f,i.colIndex+1,t,n);else if(i.rowIndex==e&&i.colIndex==s)this._updateActiveCell(f,o,t,n);else return!1;else if(n=="ShiftTab")if(i.colIndex>o)this._navigateRow("Backward",t);else if(i.rowIndex>f)this._updateActiveCell(i.rowIndex-1,s,t,n);else if(i.rowIndex==f&&i.colIndex==o)this._updateActiveCell(e,s,t,n);else return!1;else if(i.rowIndex>f)this._navigateCol("Backward",t);else if(i.colIndex>o)this._updateActiveCell(e,i.colIndex-1,t,n);else if(i.rowIndex==f&&i.colIndex==o)this._updateActiveCell(e,s,t,n);else return!1},_navigateRow:function(n,t){var i,r,u=this.XLObj,f=u.getSheet(u.getActiveSheetIndex())._activeCell;n==="Forward"?(i=1,r="Tab"):(i=-1,r="ShiftTab");this._updateActiveCell(f.rowIndex,f.colIndex+i,t,r)},_navigateCol:function(n,t){var i,r,u=this.XLObj,f=u.getSheet(u.getActiveSheetIndex())._activeCell;n==="Forward"?(i=1,r="Enter"):(i=-1,r="ShiftEnter");this._updateActiveCell(f.rowIndex+i,f.colIndex,t,r)},_updateActiveCell:function(n,t,i,r){var u=this.XLObj,f=u.getSheet(u.getActiveSheetIndex()),e=f._activeCell;u._removeClass(u.getCell(e.rowIndex,e.colIndex),"e-activecell");f._activeCell={rowIndex:n,colIndex:t};i&&this._isHiddenCell(f._activeCell)&&this._skipHiddenRowsAndCols(f._activeCell,i,!0,r);this._isMergedCell(f._activeCell)&&this._skipMergedCells(f._activeCell,i);this._scrollToCell(f._activeCell,i);u.addClass(u.getCell(f._activeCell.rowIndex,f._activeCell.colIndex),"e-activecell");u.model.allowFormulaBar&&u.updateFormulaBar();u._setSheetFocus()},_isValidParameter:function(n){var t=n.indexOf("(");return t>-1?(n=n.split("("),n[1].length>0):!0},_skipHiddenRowsAndCols:function(n,i,r,u){var e=this.XLObj,f=e.getSheet(e.getActiveSheetIndex()),o=!0;r?this._navigateRange(u,i):((i.keyCode===37||i.keyCode===9&&i.shiftKey||i.keyCode===39&&i.ctrlKey)&&n.colIndex?n.colIndex--:(i.keyCode===38||i.keyCode===13&&i.shiftKey||i.keyCode===40&&i.ctrlKey)&&n.rowIndex?n.rowIndex--:(i.keyCode===39||i.keyCode===9||i.keyCode===37&&i.ctrlKey)&&n.colIndex<f.colCount-1?n.colIndex++:(i.keyCode===40||i.keyCode===13||i.keyCode===38&&i.ctrlKey)&&n.rowIndex<f.rowCount-1?n.rowIndex++:o=!1,this._isHiddenCell(n)&&o?this._skipHiddenRowsAndCols(n,i):o||((i.keyCode===37||i.keyCode===9&&i.shiftKey)&&!n.colIndex?n.colIndex=i.keyCode===37&&i.shiftKey?f._endCell.colIndex+1:f._startCell.colIndex:(i.keyCode===38||i.keyCode===13&&i.shiftKey)&&!n.rowIndex?n.rowIndex=i.keyCode===38&&i.shiftKey?f._endCell.rowIndex+1:f._startCell.rowIndex:e.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(i.keyCode===40||i.keyCode===13||i.keyCode===40&&i.shiftKey)&&n.rowIndex==f.rowCount-1&&(n.rowIndex=i.keyCode===40&&i.shiftKey?f._endCell.rowIndex-1:f._startCell.rowIndex)))},_isHiddenCell:function(n){return this.XLObj.XLEdit.getPropertyValue(0,n.colIndex,"isCHide")||this.XLObj.XLEdit.getPropertyValue(n.rowIndex,0,"isRHide")||this.XLObj.XLEdit.getPropertyValue(n.rowIndex,0,"isFilterHide")||!1},_isMergedCell:function(n){return this.XLObj.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"isMHide")||this.XLObj.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"merge")},_skipMergedCells:function(n,t){var s=this.XLObj,h=s.getSheet(s.getActiveSheetIndex()),i=h._startCell,r=h._endCell,c=!0,u=i.rowIndex<r.rowIndex?i.rowIndex:r.rowIndex,f=i.rowIndex>r.rowIndex?i.rowIndex:r.rowIndex,e=i.colIndex<r.colIndex?i.colIndex:r.colIndex,o=i.colIndex>r.colIndex?i.colIndex:r.colIndex;t.shiftKey&&t.keyCode===9?n.colIndex--:t.keyCode===9?n.colIndex++:t.shiftKey&&t.keyCode===13?n.rowIndex--:t.keyCode===13?n.rowIndex++:c=!1;n.colIndex>o?(n.colIndex=e,n.rowIndex=n.rowIndex===f?u:n.rowIndex+1):n.colIndex<e?(n.colIndex=o,n.rowIndex=n.rowIndex===u?f:n.rowIndex-1):n.rowIndex>f?(n.rowIndex=u,n.colIndex=n.colIndex===o?e:n.colIndex+1):n.rowIndex<u&&(n.rowIndex=f,n.colIndex=n.colIndex===e?o:n.colIndex-1);this._isMergedCell(n)&&c&&this._skipMergedCells(n,t)},_updateMergeRange:function(n,t,i){var r=n.mSpan.colSpan-1,u=n.mSpan.rowSpan-1;i.shiftKey||i.keyCode!==39&&i.keyCode!==9?i.shiftKey||i.keyCode!==40&&i.keyCode!==13||(t.rowIndex=t.rowIndex+u):t.colIndex=t.colIndex+r},_isRangeMerged:function(n){var i,r={},u=this.XLObj,f=n[0],t=u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"merge");if(t&&(r={rowIndex:n[0].rowIndex+t.mSpan.rowSpan-1,colIndex:n[0].colIndex+t.mSpan.colSpan-1},i=u._getSelectedRange(n[0],r),i.length===n.length))return!0},_scrollToCell:function(n,t){var f=this.XLObj,o=f.getActiveSheetIndex(),i=f._getCellInfo(n,o),r=f.getSheet(o),s=f._getContent(o),h=s.find(".e-content"),u=s.find("#hscrollBar").data("ejScrollBar"),e=s.find("#vscrollBar").data("ejScrollBar");(f.model.scrollSettings.scrollMode!=="normal"||r.colCount-1!==n.colIndex)&&(r._bottomRow.idx>0&&n.rowIndex>r._bottomRow.idx-1&&r.rowCount-1>n.rowIndex&&t.keyCode===40?e.scroll(e.value()+i.height,!0):n.rowIndex-1<r._topRow.idx&&t.keyCode===38?(e._scrollData.step=-1,n.rowIndex>0?e.scroll(i.top,!0):e.scroll(0)):n.colIndex<r._leftCol.idx?n.colIndex>0?u.scroll(u.value()-i.width,!0):u.scroll(0):h[0].offsetWidth<=i.left+i.width&&(t.keyCode===39?r.colCount===n.colIndex+1?f.XLScroll._scrollX(o):u.scroll(u.value()+i.width,!0):t.keyCode===37&&(u._scrollData.step=-1,u.scroll(i.left,!0))))}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.cellFormatting=function(n){this.XLObj=n;this._formatEnable=!1;this._thousandSeparator=t.preferredCulture(this.XLObj.model.locale).numberFormat[","];this._formatAsTableStyle={};this._rowLength=null;this._colLength=null;this._getFormat=null;this._getEformatClass=null;this._borderPosition=["top","right","bottom","left"];this._cellObj=null;this._isFAT=!1;this._customFormatSpecifierType={};this._customFontFamily={};this._isHeaderAdded=!1;this._styleDlgClick=!1;this._isTableNameAdded=!1};t.spreadsheetFeatures.cellFormatting.prototype={format:function(i,r){var u=this.XLObj,o,it,vt;if(r&&r.indexOf("!")>0&&(it=r.split("!"),r=it[1],o=parseInt(it[0].match(/\d+$/)[0])),u.model.allowCellFormatting&&!u.model.isReadOnly){o=o?o:u.getActiveSheetIndex();var f,e,v,ht,rt,ct,ut,ft,y,k,h,l,et,d,c,lt,ot=0,b={},at=[],g="style",nt="format",s=u.getSheet(o),p=u._dataContainer,w={formatObj:i,sheetIndex:o,reqType:"cell-format",type:"actionBegin",action:"cellformat"},a={sheetIndex:o,reqType:"cell-format"},yt=u._dupDetails,st=!1,tt;if(!u._trigActionBegin(w)){if(v=u._getMultiRangeCells(r),k=v.length,u._trigger("beforeCellFormat",{sheetIndex:o,format:i,cells:v}))return!1;if(k){if(i=this._getFormatObj(i),g in i||nt in i){for(a.oprType=(g in i)?"style":"format",lt=v[k-1].colIndex;ot<k;)e=v[ot],w={sheetIndex:o,format:i,cell:e},this._cellObj={},f={rowIndex:e.rowIndex,colIndex:e.colIndex,beforeFormat:{},afterFormat:{},bRowHeight:u.model.allowResizing&&u.XLResize.getRowHeight(e.rowIndex)},b=t.isNullOrUndefined(p.sheets[o][f.rowIndex])?{}:t.isNullOrUndefined(p.sheets[o][f.rowIndex][f.colIndex])?{}:p.sheets[o][f.rowIndex][f.colIndex],u._isRowViewable(o,e.rowIndex)&&(ft=u.getCell(e.rowIndex,e.colIndex),y=ft[0]),g in i&&(f.prevClass=u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,nt),f.prevClass=f.prevClass?f.prevClass:"",c=this._getExtendedFormat(e,i.style),c.format["text-align"]&&c.format["text-align"].toLowerCase()==="right"&&!u._hasClass(y,"e-rightalign")?u.addClass(y,"e-rightalign"):(!c.format["text-align"]||c.format["text-align"].toLowerCase()!=="right")&&u._hasClass(y,"e-rightalign")&&u._removeClass(y,"e-rightalign"),this._cellObj.formats=n.extend(!0,{},c.format),rt=u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"tformats"),rt&&(c.format=n.extend(rt,c.format)),this._cellObj.format=f.className=this._createFormatClass(c.format),f.beforeFormat=n.extend(!0,{},b),("font-family"in i.style||"font-size"in i.style)&&!u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"isMHide")&&t.isNullOrUndefined(u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"merge"))&&(d=u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex),u.model.allowResizing&&(u.isNumber(d)||u._isDateTime(d)||u.isTime(d))&&(et=u.XLResize._getContentWidth(f.colIndex,o,f.rowIndex,f.rowIndex)+2,et>s.columnsWidthCollection[f.colIndex]&&u.setWidthToColumns([{colIndex:f.colIndex,width:et}])),u.model.allowSelection&&u.XLSelection._refreshBorder(),st=!0),w.cssClass=c.className),nt in i&&i.type&&(h=u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex),h=t.isNullOrUndefined(h)?"":h,this._cellObj.value=h,this._cellObj.type=i.type,this._cellObj.formatStr=i.format.formatStr,this._cellObj.decimalPlaces=i.format.decimalPlaces,this._cellObj.thousandSeparator=i.format["thousandSeparator"]?!0:!1,this._cellObj.canUpdate=!0,f.beforeFormat=n.extend(!0,{},b),h=this._getFormattedValue(f.rowIndex,f.colIndex,this._cellObj,h),w.value=this._cellObj.value,w.value2=this._cellObj.value2=t.isNullOrUndefined(h)?"":h[0]=="'"?h.substr(1):h+"",delete this._cellObj.canUpdate,f.beforeFormat.Oprtype=this._cellObj.type),u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"value2")&&u._textClip(f.rowIndex,f.colIndex,"delete"),u.XLEdit._updateDataContainer(f,{dataObj:this._cellObj,sheetIdx:o}),g in i&&("font-family"in i.style||"font-size"in i.style)&&!u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"isMHide")&&(ht=s.columnsWidthCollection[f.colIndex],l=u._detailsFromGlobalSpan(f.rowIndex,f.colIndex,"height",u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"value2"),ht),(u.XLEdit.getPropertyValue(f.rowIndex,0,"wrapRow")?s.rowsHeightCollection[f.rowIndex]<l:!0)&&(tt=u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"merge")),(l>=u.model.rowHeight&&!u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"mergeIdx")&&!tt||tt&&tt.mSpan.rowSpan<=1)&&(u._updateFormatColl(o,f.rowIndex,f.colIndex,l),l=u._getFormattedHeight(o,f.rowIndex),y&&ft.parent().outerHeight(l),s.rowsHeightCollection[f.rowIndex]=l,u.XLEdit._updateDataContainer({rowIndex:f.rowIndex,colIndex:0},{dataObj:{pHeight:s.rowsHeightCollection[f.rowIndex],cHeight:l}}),st=!0,u.model.allowFreezing&&(u.XLFreeze._refreshFRowResize(e.rowIndex),u.XLFreeze._refreshFColResize(e.colIndex)))),ct=u._getCellInfo(e),u._dupDetails=!0,nt in i&&["text","general"].indexOf(this._cellObj.type)===-1&&(vt=u.getRangeData({range:[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex],property:["value2","formats","altTxt","type"]}),ut=u._browserDetails.name=="msie"&&u._browserDetails.version=="8.0"?u._detailsFromGlobalSpan(e.rowIndex,e.colIndex,"width",this._cellObj.value2):u._getTextContentWidth(vt[0],this._cellObj.value2),u.model.allowResizing&&ut>ct.width&&u.XLResize.setColWidth(e.colIndex,ut),u.model.allowFreezing&&u.XLFreeze._refreshFColResize(e.colIndex)),u._dupDetails=!1,u._dupDetails=yt,s._isColSelected&&s.selectedRange[1]<=f.colIndex&&f.colIndex<=s.selectedRange[3]&&(s._columnStyles[f.colIndex]=n.extend(!0,s._columnStyles[f.colIndex],this._cellObj)),s._isRowSelected&&s.selectedRange[0]<=f.rowIndex&&f.rowIndex<=s.selectedRange[2]&&(s._rowStyles[f.rowIndex]=n.extend(!0,s._rowStyles[f.rowIndex],this._cellObj)),this._cellObj=null,b=t.isNullOrUndefined(p.sheets[o][f.rowIndex])?{}:t.isNullOrUndefined(p.sheets[o][f.rowIndex][f.colIndex])?{}:p.sheets[o][f.rowIndex][f.colIndex],f.afterFormat=n.extend(!0,{},b),f.afterFormat.Oprtype=f.beforeFormat.Oprtype,a.formtObj=i,f.aRowHeight=u.model.allowResizing&&u.XLResize.getRowHeight(e.rowIndex),at.push(f),u._trigger("cellFormatting",w),u.XLEdit.getPropertyValue(f.rowIndex,f.colIndex,"value2")&&u._textClip(f.rowIndex,f.colIndex,"add"),lt===f.colIndex&&u._setRowHdrHeight(o,f.rowIndex),ot++;a.selectedCell=at;a.range=s.selectedRange;u.XLScroll._getRowHeights(o,v[0].rowIndex);st&&(!s._isImported||s._isLoaded)&&u.model.allowComments&&!u._isExport&&u.XLComment._updateCmntArrowPos(null,o)}u.model.allowFormulaBar&&u.updateFormulaBar();"border"in i&&!u._isMultiRange(r)?this.applyBorder(i.border,r,a):s._isImported&&!s._isLoaded||u._isUndoRedo||u._dupDetails||u._isSort||u._isExport||(u._completeAction(a),u._trigActionComplete(a))}}}},_getFormattedValue:function(n,i,r,u){var o,f=this.XLObj,e={};return u=t.isNullOrUndefined(u)?"":f.XLEdit.getPropertyValue(n,i),t.isNullOrUndefined(u)&&(u=""),f.isFormula(u)&&(u=f.XLEdit.getPropertyValue(n,i,"calcValue"),r.canUpdate=!1),["text","general"].indexOf(r.type)!==-1?(f._isDateTime(u)&&(o=f.XLEdit.getPropertyValue(n,i,"type"),u=f._dateToInt(u,o===t.Spreadsheet.CellType.Time),r.value=u),r.type===t.Spreadsheet.CellType.Text?e.align="":f.isNumber(u)&&f.XLEdit.getPropertyValue(n,i,"align")!="right"&&(e.align=t.Spreadsheet.Align.Right),"align"in e&&(e.cellIdx={rowIndex:n,colIndex:i},f.XLEdit._refreshCellAlignment(e))):(f._isDateTime(u)&&(o=f.XLEdit.getPropertyValue(n,i,"type")),u=this._format(u,{formatStr:r.formatStr,type:r.type,thousandSeparator:r.thousandSeparator,decimalPlaces:r.decimalPlaces,cellObj:r,isTime:o===t.Spreadsheet.CellType.Time},{rowIndex:n,colIndex:i})),u},_format:function(n,i){var u=this.XLObj,e=i.formatStr,r=u.isUndefined(n)?"":n,l=i.type||"",f=t.Spreadsheet.CellType,s=u.model.locale,a=["."].indexOf(this._thousandSeparator)>-1?"\\":"",v=new RegExp(a+this._thousandSeparator,"g");n=r.toString();u.XLEdit._formatCellVal=null;switch(l){case f.Accounting:u._isDateTime(r)&&(r=u._dateToInt(r),u.XLEdit._formatCellVal=r,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=r));u.isNumber(r)&&(r=u.toAccounting(e,r,s));break;case f.Currency:case f.Number:case f.Percentage:u._isDateTime(r)&&(r=u._dateToInt(r),u.XLEdit._formatCellVal=r,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=r));u.isNumber(r)&&(r=u.formatting(e,r,s),!i.thousandSeparator&&[f.Number,f.Percentage].indexOf(l)>-1&&this._thousandSeparator&&(r=r.replace(v,"")));break;case f.Scientific:u._isDateTime(r)&&(r=u._dateToInt(r),u.XLEdit._formatCellVal=r,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=r));u.isNumber(r)&&(r=u.toExponential(r,i.decimalPlaces));break;case f.Fraction:u._isDateTime(r)&&(r=u._dateToInt(r),u.XLEdit._formatCellVal=r,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=r));u.isNumber(r)&&(r=u.toFraction(r),r="numerator"in r?r.integer+" "+r.numerator+"/"+r.denominator:r.integer);break;case f.LongDate:case f.ShortDate:case f.Date:case f.Time:case f.DateTime:typeof r=="string"&&(r=u._isValidTime(r)?new Date("01/01/1990 "+r):new Date(r));isNaN(t.parseFloat(r.toString(),10,s))?u._isDateTime(r)||(r=t.parseDate(r)):r=u.intToDate(r);r&&this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=r,u.XLEdit._formatCellVal=r);u._isDateTime(r)&&(r=u.formatting(e,r,s));break;case f.String:var c=e.indexOf("\\"),o=e.indexOf("#"),h=e.split("\\").join("");o<0&&(o=e.indexOf("0"));c<o?r=h.substr(c,h.length-1)+n:c>o&&(r=n+h.substr(o+1,h.length))}return t.isNullOrUndefined(r)?n:r},createTable:function(i,r){var u=this.XLObj,d,c,g,et;if(u.model.allowFormatAsTable&&(u.model.allowSelection||!t.isNullOrUndefined(r))&&(!u.getSheet()._isLoaded||!u.model.isReadOnly)){t.isNullOrUndefined(i.format)&&(i.format=this._getTableLayoutFromName(i.formatName).format);t.isNullOrUndefined(i.showHeaderRow)&&(i.showHeaderRow=!0);var s,b,it,f,nt,a,o,l=i.name||"",tt,h=u.getActiveSheetIndex(),e=u.getSheet(h),v=e.tableManager,y=e._startCell,p=e._endCell,rt="formatName",k={sheetIndex:h,tableStyle:i,reqType:"format-table"},ut=i.format||this._getTableLayoutFromName(i.formatName).format,w={format:ut},ot=u._dupDetails,ft=u.element.find("#"+u._id+"_Ribbon_tsofiltercolumn");if(b={range:t.isNullOrUndefined(r)?[y.rowIndex,y.colIndex,p.rowIndex,p.colIndex]:r,sheetIndex:k.sheetIndex,tableStyle:k.tableStyle,reqType:k.reqType},!u._trigActionBegin(b)&&ut){if(i=k.tableStyle,this._isFAT=!0,r=u._getRangeArgs(r,"object"),u._isUndoRedo)f=n.merge([],r);else for(f=r?r:e.selectedRange,d=f[0];d<=f[2];d++)for(c=f[1];c<=f[3];c++)if(tt=u.XLFilter._getFilterHeader(h,d,c),!t.isNullOrUndefined(tt)&&tt.status.indexOf("e-ssfilter")>-1){u._showAlertDlg("Alert","FilterAlert","",440);return}if(!i.name||u.XLRibbon._validateNamedRange(i.name,u._getDollarAlphaRange(f,!0),"Workbook")||u.XLClipboard._isCut){if(nt=u.XLEdit.getPropertyValue(f[0],f[1],"tableName")||"",(!e._isImported||e._isLoaded)&&(it=u.getRange(f),s={sheetIndex:h,reqType:"format-table",beforeFormat:this.getHashCodeClassAsArray(),beforeRange:n.extend(!0,[],f),pcells:it,beforeRangeHeader:u.getRangeData({range:[f[0],f[1],f[0],f[3]]})},a=i.header?[f[0],f[1],f[2],f[3]]:[f[0],f[1],f[2]+1,f[3]],s.beforeRangeData=u.getRangeData({range:a}),s.beforeMergeRange=u.XLEdit._getPropWithCellIdx(a,"merge",h),u._dupDetails=!0,s.beforeMergeRange.length&&u.unmergeCells(u._getAlphaRange(h,a[0],a[1],a[2],a[3])),u._dupDetails=!1),rt in i&&(w[rt]=i.formatName),"showHeaderRow"in i&&(w.showHeaderRow=i.showHeaderRow),"totalRow"in i&&(w.totalRow=i.totalRow),nt)this._formatAsTableStyle=w,u._dupDetails=!0,this._createTable(u._getTableID(nt),w),u._dupDetails=!1,u._undoCollection.pop(),u._undoCollection.pop();else{if(u.XLClipboard._isCut){while(i.tblId in v)i.tblId++;o=parseInt(i.tblId)}else o=u.getObjectLength(v)+1;l=l.length?l:"Table"+o;u.model.sheets[h]._header[o]={header:i.header};e._isLoaded&&(i.header?(r?(e._startCell={rowIndex:r[0],colIndex:r[1]},e._endCell={rowIndex:r[2],colIndex:r[3]},u.XLSelection.selectRange(e._startCell,e._endCell),u.model.allowAutoFill&&(!e._isImported||e._isLoaded)&&u.XLDragFill.positionAutoFillElement()):r=u.swapRange([y.rowIndex,y.colIndex,p.rowIndex,p.colIndex]),r[0]===r[2]&&(f=r,f[2]=f[2]+1)):(u._isUndoRedo?f=n.extend(!0,[],r):(f=r?r:u.swapRange([y.rowIndex,y.colIndex,p.rowIndex,p.colIndex]),r=f),u.model.allowDragAndDrop&&u.XLDragDrop._moveRangeTo(f,[f[0]+1,f[1],f[2]+1,f[3]],["value","value2","type","formatStr","decimalPlaces","thousandSeparator","range","format","border","borders","comment","hyperlink","picture","cFormatRule","rule","chart","isLocked","wrap","formats","tformats","tborders","tableName"]),e._startCell={rowIndex:f[0],colIndex:f[1]},e._endCell={rowIndex:f[2]+1,colIndex:f[3]},u.XLSelection.selectRange(e._startCell,e._endCell),u.model.allowAutoFill&&(!e._isImported||e._isLoaded)&&u.XLDragFill.positionAutoFillElement(),f[2]=f[2]+1));"dataSource"in i&&u._updateRangeValue(h,{showHeader:"showHeader"in i?i.showHeader:!0,startCell:u._getAlphaRange(h,r[0],r[1],r[0],r[1]),dataSource:i.dataSource},!1);u.updateUniqueData({tableName:"e-table"+o},r);v[o]={name:l,range:f,showHeaderRow:i.showHeaderRow};i.fnNumber&&(v[o].fnNumber=i.fnNumber);v[o].isFilter=i.showHeaderRow;u.XLRibbon._isDesignTab=!0;u._dupDetails=!0;this._createTable(o,w);i.showHeaderRow&&u.model.allowFiltering&&u.XLFilter._filterTable(h,o,{startCell:{rowIndex:r[0],colIndex:r[1]},endCell:{rowIndex:r[2],colIndex:r[3]}});u._dupDetails=!1;this._updateTblStyleOptns(o,i);e._isImported&&!e._isLoaded||i.hideTab||u.XLRibbon._designTabUpdate(o,{rowIndex:r[0],colIndex:r[1]});u.model.allowComments&&u.XLComment._updateCmntArrowPos()}for((!e._isImported||e._isLoaded)&&(u.XLRibbon._dirtySelect(u.getRange(r)),s.tableID=o,s.tableStyle=i,s.afterRange=f,u._dupDetails=ot,b={pCells:s.pcells,reqType:s.reqType,sheetIndex:s.sheetIndex,tableID:s.tableID,tableStyle:s.tableStyle,range:r},u._isPaste||u._isUndoRedo||u._dupDetails||u._isExport||(u._completeAction(s),u._trigActionComplete(b))),ft.length&&ft.ejCheckBox("option",{checked:!0}),this._isTableNameAdded||u.XLRibbon.addNamedRange(l,u._getDollarAlphaRange(r,!0),null,h,"Workbook"),this._updateTableFormula("addRange",v[o],h),g=u.getObjectKeys(u._tableRangesFormula[l]),et=g.length,u._tableFormulaCollection[l]=[],c=0;c<et;c++)u._tableFormulaCollection[l].push({text:"["+g[c]+"]",display:g[c]});return e._isLoaded&&u.XLSelection._refreshBorder(),this._isFAT=!1,i.name}}}},_createTable:function(t,i){var h,f,c,l,et,u,a,s,rt,ot,g,nt,e,tt,v=1,st="border",ht="tableName",it="e-table"+t,ct=!1,r=this.XLObj,o=r.getActiveSheetIndex(),at=r.getSheet(o),p=at.tableManager[t],w=p.range,y=w[0],b=w[1],k=w[2],d=w[3],ut=[],lt=2,ft;if(p["format"]=i.format,i.formatName&&(p["formatName"]=i.formatName),p.showHeaderRow&&(i.showHeaderRow=p.showHeaderRow),this.removeStyle(w,{tableStyle:!0,border:!0,sheetIdx:o}),i.showHeaderRow&&"headerLayout"in i.format&&(u=n.extend(!0,{},i.format.headerLayout),st in u&&(a=r._getProperAlphaRange(o,y,b,y,d),r._intrnlReq=!0,r._isTableBrdrEnd=!0,this.applyBorder(u.border,a),r._intrnlReq=!1,delete u.border)),ct=r.getObjectLength(u)>0,f=y,c=b,l=d,i.showHeaderRow)while(c<=l)nt=!1,e={},h={rowIndex:f,colIndex:c},s=r.XLEdit.getPropertyValue(f,c,"value2")||"",rt="Column"+v,r.XLEdit.getPropertyValue(f,c,ht,o)!==it&&(e.tableName=it,nt=!0),s.length?s.toLowerCase()===rt.toLowerCase()&&v++:(r.XLEdit._updateCell(h,rt),v++),ft=s.toLowerCase(),s.length&&(ut.indexOf(ft)<0?ut.push(ft):(s=s+lt,lt++,ut.push(s.toLowerCase()),r.XLEdit._updateCell(h,s))),ct&&(g=this._getExtendedFormat(h,u,this._isFAT),e.format=this._createFormatClass(g.format),e.tformats=u,nt=!0),nt&&r.XLEdit._updateDataContainer(h,{dataObj:e,sheetIdx:o}),c++;if((r.isImport||r.model.isImport)&&(k=i.totalRow?k+1:k),"contentLayout"in i.format)for(ot=i.format.contentLayout.length,v=0,f=i.showHeaderRow?y+1:y,c=k;f<=c;){if(u=n.extend(!0,{},i.format.contentLayout[v%ot]),st in u&&(a=r._getProperAlphaRange(o,f,b,f,d),r._intrnlReq=!0,r._isTableBrdrEnd=!0,this.applyBorder(u.border,a),r._intrnlReq=!1,delete u.border),r.getObjectLength(u))for(l=b,et=d;l<=et;)e={},h={rowIndex:f,colIndex:l},tt=n.extend({},u),r.XLEdit.getPropertyValue(f,l,ht,o)!==it&&(e.tableName=it),tt.color&&r.XLEdit.getPropertyValue(f,l,"hyperlink")&&delete tt.color,g=this._getExtendedFormat(h,tt,this._isFAT),e.format=this._createFormatClass(g.format),e.tformats=u,r.XLEdit._updateDataContainer(h,{dataObj:e,sheetIdx:o}),l++;f++;v++}"contentBorder"in i.format&&(a=r._getProperAlphaRange(o,y+1,b,k,d),r._intrnlReq=!0,r._isTableBrdrEnd=!0,this.applyBorder(n.extend({},i.format.contentBorder.border),a),r._intrnlReq=!1);r.model.scrollSettings.allowVirtualScrolling&r._isTableBrdrEnd&&(r.XLScroll._refreshScroller(o,"refresh","vertical"),r._isTableBrdrEnd=!1);r.XLClipboard._isCut||r._tableCnt++},resizeTable:function(n,t,i){var r=this.XLObj,u=r._getTableID(null,t);r.XLRibbon._resizeTable(n,u,i)},firstColumn:function(n,t){var i=this.XLObj,r=i._getTableID(null,n);i.XLRibbon._isFirstColumn=!0;i.XLRibbon._firstLastColumn(r,t);i.XLRibbon._isFirstColumn=!1},lastColumn:function(n,t){var i=this.XLObj,r=i._getTableID(null,n);i.XLRibbon._firstLastColumn(r,t)},totalRow:function(n,t){var i=this.XLObj,r=i._getTableID(null,n);i.XLRibbon._totalRow(r,t)},filterButton:function(n,t,i){var r=this.XLObj,f=r.getSheet(t),e=f.tableManager,u=r._getTableID(null,n);r.XLFilter._clearFilterTableIcon(t,u);e[u].isFilter=i},_updateTblStyleOptns:function(n,t){var i,r,e="firstColumn",o="lastColumn",h="bold",c="normal",l="totalRow",s="isFilter",u=this.XLObj,f=u._getSheetIndex(),v=u.getSheet(f),a=v.tableManager;n in a&&(i=a[n],r=i.range,i[s]=s in t?t.isFilter:"showHeaderRow"in t?t.showHeaderRow:!0,u.model.allowFiltering&&!i[s]&&u.XLFilter._clearFilterTableIcon(f,n),u._dupDetails=!0,e in t&&(i[e]=t.firstColumn,this.format({style:{"font-weight":i[e]?h:c}},u._getProperAlphaRange(f,r[0]+1,r[1],r[2],r[1]))),o in t&&(i[o]=t.lastColumn,this.format({style:{"font-weight":i[o]?h:c}},u._getProperAlphaRange(f,r[0]+1,r[3],r[2],r[3]))),u._dupDetails=!1,l in t&&(i[l]=t.totalRow))},removeTable:function(t){var i=this.XLObj;if(i.model.allowFormatAsTable&&!i.model.isReadOnly){var r,c,l,s,a,h,u=0,f=i.getActiveSheetIndex(),e=i.getSheet(f).tableManager,o=e[t].range,y=e[t].name,v=i.element.find("#"+i._id+"_Ribbon_tsofiltercolumn");if(this._updateTableFormula("removeTable",e[t],f),t in e){if(i.clearRangeData(o,["tableName"]),r=i._getSelectedRange({rowIndex:o[0],colIndex:o[1]},{rowIndex:o[2],colIndex:o[3]}),c=r.length,c)while(u<c)l=i.XLEdit.getPropertyValue(r[u].rowIndex,r[u].colIndex,"formats"),s=i.XLEdit.getPropertyValue(r[u].rowIndex,r[u].colIndex,"tformats"),a=i.XLEdit.getPropertyValue(r[u].rowIndex,r[u].colIndex,"borders"),h=i.XLEdit.getPropertyValue(r[u].rowIndex,r[u].colIndex,"tborders"),s&&(n.extend(s,l),i.XLEdit._updateDataContainer(r[u],{dataObj:{formats:s}})),h&&(n.extend(h,a),i.XLEdit._updateDataContainer(r[u],{dataObj:{borders:h}})),i.XLEdit._clearDataContainer({cellIdx:{rowIndex:r[u].rowIndex,colIndex:r[u].colIndex},property:["tformats","tborders"]}),u++;i.model.allowFiltering&&!i._isFATResize&&i.XLFilter._clearFilterTable(f,parseInt(t));delete e[t];delete i.model.sheets[f]._header[t];i.XLRibbon.removeNamedRange(y);v.length&&v.ejCheckBox("option",{checked:!1});i.XLRibbon._toggleDesignTab(i.getActiveCell(f))}}},_renameTable:function(t){var i=this.XLObj,e=i.getActiveSheetIndex(),u=i.getSheet(e).tableManager,r=i._getTableID(t),f,o,s,c=n("#"+i._id+"_Ribbon").data("ejRibbon"),h;r&&(h=document.getElementById(i._id+"_Ribbon_Design_Properties_TableName")&&document.getElementById(i._id+"_Ribbon_Design_Properties_TableName").value,f=u[r].name,f!=h&&(o=i._getDollarAlphaRange(u[r].range,!0),i.XLRibbon._validateNamedRange(h,o)&&(s={sheetIndex:e,reqType:"format-table",action:"renaming",range:o,tableId:parseInt(r),prevName:f},i.XLRibbon.removeNamedRange(f),u[r].name=h,i.XLRibbon.addNamedRange(u[r].name,o,null,e),this._updateTableFormula("rename",u[r],e,f),s.newName=u[r].name,c.showTab(i._getLocStr("Design")),i._completeAction(s),i._trigActionComplete(s))))},_getTableLayoutFromName:function(n){if(n)return this.XLObj._FATStyles[n]},_getTableIdxFromName:function(n){var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()).tableManager,t=i.getObjectLength(r);if(t)while(t--)if(r[t].name===n)return t;return-1},convertToRange:function(n){var t=this.XLObj;t.model.isReadOnly||(n.alert?t._showAlertDlg("","ConverToRangeAlert","ConvertToRange",498):this._convertToRange(n))},_convertToRange:function(t){for(var h,i=this.XLObj,e=t.sheetIdx||i.getActiveSheetIndex(),c=i.getSheet(e),o,u=i.getSheet(e).tableManager,s=c.filterSettings.tableRange,r=t.tableId||i._getTableID(null,document.getElementById(i._id+"_Ribbon_Design_Properties_TableName")&&document.getElementById(i._id+"_Ribbon_Design_Properties_TableName").value),f=0;f<s.length;f++)s[f].tableID==r&&(h=f);i.getObjectLength(u)&&(o={sheetIndex:e,reqType:"format-table",action:"Design_Tools_ConvertToRange",beforeFormat:i.XLFormat.getHashCodeClassAsArray(),tableID:r,name:u[r].name,format:u[r].format,formatName:u[r].formatName,tableRange:s[h],beforeRange:u[r].range,isFilter:u[r].isFilter,header:n.extend(!0,[],c._header[r]),firstColumn:u[r].firstColumn,lastColumn:u[r].lastColumn,totalRow:u[r].totalRow,fnNumber:u[r].fnNumber});i.isNumber(r)&&i.XLFormat.removeTable(r);i.model.showRibbon&&i.XLRibbon._toggleDesignTab(i.getActiveCell());i._completeAction(o);i._trigActionComplete(o)},_calculateTotalRow:function(n,i,r,u,f){var p,e=this.XLObj,l,d=[],g=[],w,v,o,b=!1,y,nt=e.getSheet(n),s=nt.tableManager,tt,a=nt._selectedCells,k,rt=e._id+"_Ribbon_Design_TableStyleOptions_TotalRow",h,c,it=e._isUndo,ut=e._isUndoRedo,ft=e._dupDetails;if(i=i||parseInt(document.getElementById(e._id+"_tableid").value),o=s[i].range,d.push(e.getRangeData({range:[o[2]+1,o[1],o[2]+1,o[3]]})),w=e._getProperAlphaRange(n,o[0]+1,o[3],o[2],o[3]),l=e._getSelectedRange({rowIndex:o[2]+1,colIndex:o[1]},{rowIndex:o[2]+1,colIndex:o[3]}),r){if(h={rowIndex:o[2]+1,colIndex:o[1]},c={rowIndex:o[2]+1,colIndex:o[3]},e._dupDetails=e._isTotalRow=!0,e._insRows={startRow:h.rowIndex,endRow:c.rowIndex},e._isUndo=!1,!f&&(tt=e.insertShiftBottom(h,c),tt))return;if(e._isUndo=it,e._isUndoRedo=ut,e._dupDetails=e._isTotalRow=!1,!e._isFilterApplied||e._insDelStatus=="insert"){if(l.length>1&&e.XLEdit._updateCellValue(l[0],r?"Total":""),!s[i].fnNumber&&r){if(y=t.distinct(e.getRangeData({range:e.getRangeIndices(w),valueOnly:!0})),y=y.filter(Boolean),p=y.length,p){while(p--)if(!e.isNumber(y[p])){b=!0;break}}else b=!0;s[i].fnNumber=b?103:109}e.XLEdit._updateCellValue(l[l.length-1],r?"=SUBTOTAL("+s[i].fnNumber+","+w+")":"");s[i].range[2]+=1;e._insDelStatus==""}}else h={rowIndex:o[2],colIndex:o[1]},c={rowIndex:o[2],colIndex:o[3]},e._dupDetails=e._isTotalRow=!0,e.model.allowFiltering&&e.XLFilter._checkFilterApplied(n,h.rowIndex,1,h.colIndex,1,"filter"),e._checkTableApplied(n,h.rowIndex,1,h.colIndex,1,"shiftUp"),e._isFilterApplied||e._isTableApplied?(e._intrnlReq=!0,e._isUndo=!1,e.deleteEntireRow(h.rowIndex,c.rowIndex),e._isUndo=it,e._intrnlReq=!1,u=!1):e._deleteShiftUp(n,h,c,{startCol:h.colIndex,colCount:c.colIndex-h.colIndex+1,startRow:h.rowIndex,rowCount:c.rowIndex-h.rowIndex+1,status:"shiftUp"}),e._isTotalRow=!1,s[i].range[2]-=1;e._dupDetails=ft;r?s[i].totalRow=!0:"totalRow"in s[i]&&delete s[i].totalRow;v=s[i].range;e.XLFormat._createTable(i,{format:s[i].format});this._updateTableFormula("totalRow",s[i],n);g.push(e.getRangeData({range:[v[2]+1,v[1],v[2]+1,v[3]]}));k={sheetIndex:n,reqType:"format-table",action:"totalrow",range:w,check:r,id:rt,cell:l,tmgr:s,tableId:i,pcells:d[0],curCells:g[0],fnNumber:s[i].fnNumber,isShift:u};f&&(e._dupDetails=e._isUndoRedo=!1);e._dupDetails||(e._completeAction(k),e._trigActionComplete(k));e.performSelection({rowIndex:a[0].rowIndex,colIndex:a[0].colIndex},{rowIndex:a[a.length-1].rowIndex,colIndex:a[a.length-1].colIndex});e._dupDetails=!1},_updateTotalRow:function(n,t,i,r,u){var f=this.XLObj,o=f.getSheet(n),e=o.tableManager;e[t].fnNumber=i;u&&f._clearFormula(r[2],r[3]);f.XLEdit._updateCellValue({rowIndex:r[2],colIndex:r[3]},"=SUBTOTAL("+e[t].fnNumber+","+f._getAlphaRange(n,r[0]+1,r[3],r[2]-1,r[3])+")")},customFormatParser:function(n){if(this.XLObj.model.allowCellFormatting){var i,f,e,o={},h=t.Spreadsheet.CellType,r="{0:",u="}",c="N",a="P",s=".",l="0";return n=t.isNullOrUndefined(n)?"":n.toString(),Number(n)===0?(n.indexOf(s)>-1?(e=n.split(s),i=r+c+e[1].length+u):i=r+"D"+n.length+u,f=h.Number):!n.indexOf("#")&&n.indexOf(",")>-1&&n.lastIndexOf(l)===n.length-1?(n.indexOf(s)>-1?(e=n.split(s),i=r+c+e[1].length+u):i=r+c+l+u,o.thousandSeparator=!0,f=h.Number):n.lastIndexOf("%")===n.length-1&&Number(n.replace(/%/g,""))===0?(n.indexOf(s)>-1?(e=n.split(s),i=r+a+--e[1].length+u):i=r+a+l+u,f=h.Percentage):/^[dMy/\-\s,]+$/.test(n)?(i=r+n+u,f=h.Date):/^[hmst:\s]+$/.test(n)?(i=r+n+u,f=h.Time):n.indexOf("\\")>-1&&(o.formatStr=n,o.type="string"),i&&(o.formatStr=i,o.type=f),o}},addCustomFormatSpecifier:function(n,i,r){var e,u=t.Spreadsheet.CellType,f=t.preferredCulture(this.XLObj.model.locale);if([u.Date,u.DateTime,u.LongDate,u.ShortDate,u.Time].indexOf(r)>-1){for(e in f.calendar.patterns)if(f.calendar.patterns[e]==i)return;n||(n="cDFrmt"+Object.keys(f.calendar.patterns).length);f.calendar.patterns[n]=i;t.globalize._getDateParseRegExp(f.calendar,i);this._customFormatSpecifierType[n]=r}},addFontFamily:function(i){var h,r,e,c,l=i,o=this._customFontFamily,f=this.XLObj,u=49,s;if(i=i.toLowerCase(),f.isUndefined(o[i])){for(h in o)s=parseInt(o[h]),s>u&&(u=s);u++;f.model.showRibbon&&(r=n("#"+f._id+"_Ribbon_Home_Font_FontFamily").data("ejDropDownList"),e=n.extend(!0,[],f.XLRibbon._fontFamily),e.push({text:l,value:u}),r&&(c=r.model.selectedItemIndex,r.option({dataSource:e}),r._initValue=!0,r.selectItemByIndex(c),r._initValue=!1,f.XLRibbon._fontFamily=e));o[i]=u+"";t.Spreadsheet.FontFamily[i]=u+""}},removeFontFamily:function(i){var e,r,o=this._customFontFamily,u=this.XLObj,f,s;if(u.model.showRibbon)for(r=n("#"+u._id+"_Ribbon_Home_Font_FontFamily").data("ejDropDownList"),f=n.extend(!0,[],u.XLRibbon._fontFamily),e=0;e<f.length;e++)if(f[e].text===i){f.splice(e,1);r&&(s=r.model.selectedItemIndex,r.option({dataSource:f}),r._initValue=!0,r.selectItemByIndex(s),r._initValue=!1);u.XLRibbon._fontFamily=f;break}i=i.toLowerCase();u.isUndefined(o[i])||(delete o[i],u.isUndefined(t.Spreadsheet.FontFamily[i])||delete t.Spreadsheet.FontFamily[i])},applyBorder:function(i,r,u){var f=this.XLObj,e=f.getActiveSheetIndex(),o=f.getSheet(e),s={options:i,range:r,details:u,sheetIndex:e,reqType:"cell-format",type:"actionBegin",action:"applyborder"};f._trigActionBegin(s)||f.model.allowCellFormatting&&f.model.formatSettings.allowCellBorder&&(!o._isLoaded||!f.model.isReadOnly)&&(r=f._getRangeArgs(s.range,"object",e),(!o._isImported||o._isLoaded)&&(u||(u={sheetIndex:e,reqType:"cell-format",process:"border",options:n.extend(!0,{},i)}),u.range=r,u.beforeFormat=this.getHashCodeClassAsArray(r),u.property=i.property,u.prevHeight=[],u.newHeight=[],delete i.property),f.getObjectLength(i)?i.isGridBorder?this._applyAllBorderCss(i,r,u):this._applyBorderCss(i,r,u):this.removeStyle(r,{cellStyle:!0,border:!0,sheetIdx:e}),o._isImported&&!o._isLoaded||f._isUndoRedo||(f._refreshRangeTRHght(e,r),t.isNullOrUndefined(i.tableID)&&!this._dupDetails&&(u.afterFormat=this.getHashCodeClassAsArray(r),f._intrnlReq||(f._completeAction(u),f._trigActionComplete(u)))))},updateDecimalPlaces:function(i,r){var u=this.XLObj,s,y;if(u.model.allowCellFormatting&&u.model.formatSettings.allowDecimalPlaces&&!u.model.isReadOnly&&(s=u.getActiveSheetIndex(),y={range:r,type:i,sheetIndex:s,reqType:"cell-format",type:"actionBegin",action:"decimal"},!u._trigActionBegin(y))){var w,c,b,l,h,e,f,a=0,o={},v,d=u.getSheet(s),p={action:"decimal",reqType:"cell-format",sheetIndex:s,oprType:"format"},k=[];for(r=u._getRangeArgs(y.range,"object"),l=u._getSelectedCells(s,r).selCells,w=l.length;a<w;)h=l[a].rowIndex,e=l[a].colIndex,f=u.getRangeData({range:[h,e,h,e],property:["type","value","value2","calcValue","decimalPlaces","thousandSeparator","formatStr"]})[0],u.isFormula(f.value)&&(f.type="general",f.value=f.calcValue),c={rowIndex:h,colIndex:e,afterFormat:{},beforeFormat:{}},v=u._dataContainer.sheets[s][h][e],n.extend(!0,c.beforeFormat,v),u.isNumber(f.value)&&(u.isUndefined(f.decimalPlaces)&&(f.decimalPlaces=u._decimalCnt(f.value)),o.type=f.type===t.Spreadsheet.CellType.General?t.Spreadsheet.CellType.Number:f.type,o.decimalPlaces=f.decimalPlaces=i==="DecreaseDecimal"?f.decimalPlaces>0?f.decimalPlaces-1:f.decimalPlaces:f.decimalPlaces+1,o.formatStr=u._getFormatString(o.type,o.decimalPlaces),b=this._format(f.value,{formatStr:o.formatStr,type:o.type,thousandSeparator:f.thousandSeparator,decimalPlaces:o.decimalPlaces}),o.value2=b,u.XLResize&&u.XLResize._getContentWidth(e,s,0,u.getSheet(s).usedRange.rowIndex)>=d.columnsWidthCollection[e]-5&&(u._dupDetails=!0,u.XLResize._fitWidth(e),u._dupDetails=!1,u.XLSelection.refreshSelection(),u.model.allowAutoFill&&u.XLDragFill.positionAutoFillElement()),u.XLEdit._updateDataContainer({rowIndex:h,colIndex:e},{dataObj:o}),c.beforeFormat.Oprtype=o.type),f=u.getRangeData({range:[h,e,h,e]})[0],v=u._dataContainer.sheets[s][h][e],n.extend(!0,c.afterFormat,v),c.afterFormat.Oprtype=c.beforeFormat.Oprtype,k.push(c),a++;p.selectedCell=k;u._isUndoRedo||(u._completeAction(p),u._trigActionComplete(p))}},getFormatClass:function(n,t){var i=t?"e-border":"e-format",r=new RegExp("\\b"+i+".*?\\b","g");return n.indexOf(i)!==-1?n.match(r)[0]:""},getHashCodeClassAsArray:function(n){var r,e,u,t=0,f={format:[]},i=this.XLObj,o=i.getActiveSheetIndex(),s=["topborder","leftborder"];for(n=i._toIntrnlRange(n,o),n=n?i.swapRange(n):i.getSheet(o).selectedRange,r=i.getRange(n),e=r.length;t<e;)u=r[t].className,f.format.push(this.getFormatClass(u)+" "+this.getFormatClass(u,!0)),t++;for(t=2;t--;)f[s[t]]=this._getBorderArray(n,s[t]);return f},_getBorderArray:function(n,t){var i,r=0,u=[],o=this.XLObj,f="topborder",s=t===f?n[0]-1:n[1]-1,e;if(s>=0)for(e=t===f?o.getRange([n[0]-1,n[1],n[0]-1,n[3]]):o.getRange([n[0],n[1]-1,n[2],n[1]-1]),i=e.length;r<i;)u.push(this.getFormatClass(e[r].className,!0)),r++;else for(i=t===f?n[3]-n[1]+1:n[2]-n[0]+1;i--;)u.push("");return u},removeStyle:function(t,i){var u=this.XLObj;if(!u.model.isReadOnly){i=i||{cellStyle:!0,tableStyle:!0,format:!0,border:!0};var w,tt,e,r,o,b,l,h,f,c,s,k,a,y,d=0,v=this._borderPosition,g=u._getSheetIndex(i.sheetIdx),p=u.getSheet(g),nt=u.getActiveSheetIndex();for(t=u._getRangeArgs(t,"object"),w=u._getSelectedCells(g,t).selCells,tt=w.length,i.sheetIdx&&i.sheetIdx!=nt&&u.gotoPage(i.sheetIdx,!1);d<tt;)a=!1,r=w[d],i.skipHiddenRow&&u._isHiddenRow(r.rowIndex,i.sheetIdx)||(i.format&&(i.cellStyle&&i.tableStyle?u.XLEdit._clearDataContainer({cellIdx:r,property:["format","formats","tformats"],sheetIdx:i.sheetIdx}):(i.cellStyle&&u._hasCellStyle(r.rowIndex,r.colIndex,i.sheetIdx)||i.tableStyle&&u._isTableRange(r.rowIndex,r.colIndex,i.sheetIdx))&&(k=[i.cellStyle?"formats":"tformats"],b=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,i.cellStyle?"tformats":"formats",i.sheetIdx),b?(o=this.getFormatHashCode(b),this._updateFormatClass(r,o)):k.push("format"),u.XLEdit._clearDataContainer({cellIdx:r,property:k,sheetIdx:i.sheetIdx}))),i.border&&(i.cellStyle&&i.tableStyle?(l=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"borders",i.sheetIdx)||{},h=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(h,l),v[0]in h&&r.rowIndex&&(e=r.rowIndex-1,o=u.XLEdit.getPropertyValue(e,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),c=u.XLEdit.getPropertyValue(e,r.colIndex,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(e,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(s,c),this._remStyle(e,r.colIndex,s,f,"bottom","bottom",!0),a=!0),v[1]in h&&(y=!0,e=r.colIndex+1,o=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),e<p.colCount&&(c=u.XLEdit.getPropertyValue(r.rowIndex,e,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(r.rowIndex,e,"tborders",i.sheetIdx)||{},n.extend(s,c),v[3]in s&&(f.right!=s.left&&(f.right=s.left,o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)),y=!1)),y&&(delete f.right,u.getObjectLength(f)?(o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):u.XLEdit._clearDataContainer({cellIdx:r,property:["border"]})),a=!0),v[2]in h&&(y=!0,e=r.rowIndex+1,o=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),e<p.rowCount&&(c=u.XLEdit.getPropertyValue(e,r.colIndex,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(e,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(s,c),v[0]in s&&(f.bottom!=s.top&&(f.bottom=s.top,o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)),y=!1)),y&&(delete f.bottom,u.getObjectLength(f)?(o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):u.XLEdit._clearDataContainer({cellIdx:r,property:["border"]})),a=!0),v[3]in h&&r.colIndex&&(e=r.colIndex-1,o=u.XLEdit.getPropertyValue(r.rowIndex,e,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),c=u.XLEdit.getPropertyValue(r.rowIndex,e,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(r.rowIndex,e,"tborders",i.sheetIdx)||{},n.extend(s,c),this._remStyle(r.rowIndex,e,s,f,"right","right",!0),a=!0),a&&u.XLEdit._clearDataContainer({cellIdx:r,property:["borders","tborders"]})):i.cellStyle?(l=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"borders",i.sheetIdx)||{},h=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tborders",i.sheetIdx)||{},v[0]in l&&r.rowIndex&&(e=r.rowIndex-1,o=u.XLEdit.getPropertyValue(e,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),c=u.XLEdit.getPropertyValue(e,r.colIndex,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(e,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(s,c),"bottom"in s?l.bottom===f.bottom&&("top"in h?(f.bottom=h.top,o=this._getBorderHashCode(f),this._updateFormatClass({rowIndex:e,colIndex:r.colIndex},o,!0)):s.bottom!=f.bottom&&(f.bottom=s.bottom,o=this._getBorderHashCode(f),this._updateFormatClass({rowIndex:e,colIndex:r.colIndex},o,!0))):this._remStyle(e,r.colIndex,s,f,"top","bottom"),a=!0),v[1]in l&&(e=r.colIndex+1,o=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),e<p.colCount?(c=u.XLEdit.getPropertyValue(r.rowIndex,e,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(r.rowIndex,e,"tborders",i.sheetIdx)||{},n.extend(s,c),"left"in s?l.right===f.right&&("right"in h?(f.right=h.right,o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):s.left!=f.right&&(f.right=s.left,o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0))):this._remStyle(r.rowIndex,r.colIndex,h,f,"right","right")):this._remStyle(r.rowIndex,r.colIndex,h,f,"right","right"),a=!0),v[2]in l&&(e=r.rowIndex+1,o=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),e<p.rowCount?(c=u.XLEdit.getPropertyValue(e,r.colIndex,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(e,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(s,c),"top"in s?l.bottom===f.bottom&&("bottom"in h?(f.bottom=h.bottom,o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):s.top!=f.bottom&&(f.bottom=s.top,o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0))):this._remStyle(r.rowIndex,r.colIndex,h,f,"bottom","bottom")):this._remStyle(r.rowIndex,r.colIndex,h,f,"bottom","bottom"),a=!0),v[3]in l&&r.colIndex&&(e=r.colIndex-1,o=u.XLEdit.getPropertyValue(r.rowIndex,e,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),c=u.XLEdit.getPropertyValue(r.rowIndex,e,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(r.rowIndex,e,"tborders",i.sheetIdx)||{},n.extend(s,c),"right"in s?l.left===f.right&&("left"in h?(f.right=h.left,o=this._getBorderHashCode(f),this._updateFormatClass({rowIndex:r.rowIndex,colIndex:e},o,!0)):s.right!=f.right&&(f.right=s.right,o=this._getBorderHashCode(f),this._updateFormatClass({rowIndex:r.rowIndex,colIndex:e},o,!0))):this._remStyle(r.rowIndex,e,h,f,"left","right"),a=!0),a&&u.XLEdit._clearDataContainer({cellIdx:r,property:["borders"]}),u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"merge",g)&&u.XLEdit._clearDataContainer({cellIdx:r,property:["border"]})):i.tableStyle&&(l=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"borders",i.sheetIdx)||{},h=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tborders",i.sheetIdx)||{},"top"in h&&!("top"in l)&&r.rowIndex&&(e=r.rowIndex-1,o=u.XLEdit.getPropertyValue(e,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),c=u.XLEdit.getPropertyValue(e,r.colIndex,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(e,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(s,c),this._remStyle(e,r.colIndex,s,f,"bottom","bottom",!0),a=!0),"right"in h&&!("right"in l)&&(e=r.colIndex+1,o=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),e<p.colCount?(c=u.XLEdit.getPropertyValue(r.rowIndex,e,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(r.rowIndex,e,"tborders",i.sheetIdx)||{},n.extend(s,c),this._remStyle(r.rowIndex,r.colIndex,s,f,"left","right",!0)):(delete f.right,u.getObjectLength(f)?(o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):u.XLEdit._clearDataContainer({cellIdx:r,property:["border"]})),a=!0),"bottom"in h&&!("bottom"in l)&&(e=r.rowIndex+1,o=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),e<p.rowCount?(c=u.XLEdit.getPropertyValue(e,r.colIndex,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(e,r.colIndex,"tborders",i.sheetIdx)||{},n.extend(s,c),this._remStyle(r.rowIndex,r.colIndex,s,f,"top","bottom",!0)):(delete f.bottom,u.getObjectLength(f)?(o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):u.XLEdit._clearDataContainer({cellIdx:r,property:["border"]})),a=!0),"left"in h&&!("left"in l)&&r.colIndex&&(e=r.colIndex-1,o=u.XLEdit.getPropertyValue(r.rowIndex,e,"border",i.sheetIdx),f=this.getBorderFromHashCode(o),c=u.XLEdit.getPropertyValue(r.rowIndex,e,"borders",i.sheetIdx)||{},s=u.XLEdit.getPropertyValue(r.rowIndex,e,"tborders",i.sheetIdx)||{},n.extend(s,c),this._remStyle(r.rowIndex,e,s,f,"right","right",!0),a=!0),a&&u.XLEdit._clearDataContainer({cellIdx:r,property:["tborders"]})))),d++;i.sheetIdx&&i.sheetIdx!=nt&&u.gotoPage(nt,!1)}},_remStyle:function(n,t,i,r,u,f,e){var o=this.XLObj;u in i?e&&i[u]==r[f]||(r[f]=i[u],this._updateFormatClass({rowIndex:n,colIndex:t},this._getBorderHashCode(r),!0)):(delete r[f],o.getObjectLength(r)?this._updateFormatClass({rowIndex:n,colIndex:t},this._getBorderHashCode(r),!0):o.XLEdit._clearDataContainer({cellIdx:{rowIndex:n,colIndex:t},property:["border"]}))},_refreshStyles:function(t,i){for(var e,f,o,h="format",s="border",r,a=!i||i===h,v=!i||i===s,u=this.XLObj,c=u._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]}),l=c.length;l--;)r=c[l],a&&(e=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"formats")||{},f=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tformats")||{},n.extend(f,e),u.getObjectLength(f)?(o=this._createFormatClass(f),this._updateFormatClass(r,o,!1)):u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,h)&&u.XLEdit._clearDataContainer({cellIdx:r,property:[h]})),v&&(e=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"borders")||{},f=u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tborders")||{},n.extend(f,e),u.getObjectLength(f)?(o=this._getBorderHashCode(f),this._updateFormatClass(r,o,!0)):u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,s)&&u.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,s)&&u.XLEdit._clearDataContainer({cellIdx:r,property:[s]}))},updateFormat:function(n,t){var u=this.XLObj,i,f,e,r;if(!u.model.isReadOnly){for(e=["topborder","leftborder"],r=n.format,t=u._getRangeArgs(t,"object"),f=u._getSelectedCells(u.getActiveSheetIndex(),t).selCells,i=f.length;i--;)r[i]&&this._createFormatClass(this.getFormatFromHashCode(r[i]),r[i]),this._updateHashCodeClass(f[i],r[i]);for(i=2;i--;)this._updateBorderClass(t,n[e[i]],e[i])}},_updateBorderClass:function(n,t,i){var r,u,f=this.XLObj,e="topborder",o=i===e?n[0]-1:n[1]-1;if(o>=0)for(u=i===e?f._getSelectedRange({rowIndex:n[0]-1,colIndex:n[1]},{rowIndex:n[0]-1,colIndex:n[3]}):f._getSelectedRange({rowIndex:n[0],colIndex:n[1]-1},{rowIndex:n[2],colIndex:n[1]-1}),r=u.length;r--;)this._createFormatClass({border:this.getBorderFromHashCode(t[r])},t[r]),this._updateFormatClass(u[r],t[r],!0)},updateUniqueFormat:function(n,i,r){var f=this.XLObj,o,s,u,e,h;if(!f.model.isReadOnly){for(o=f.getActiveSheetIndex(),i=f._getRangeArgs(i,"object"),s=f._getSelectedCells(o,i).selCells,e=s.length;e--;)u=f._isUndoRedo?t.isNullOrUndefined(n[e].format)?"e-format":n[e].format:n,this._createFormatClass(u.indexOf("e-format")>-1?this.getFormatFromHashCode(u):{border:this.getBorderFromHashCode(u)},u,r),this._updateFormatClass(s[e],u),h=this.getFormatFromHashCode(u),f.XLEdit._updateDataContainer(s[e],{dataObj:{formats:h},sheetIdx:o});r!="Title"&&r!="Heading 4"&&t.isNullOrUndefined(h["font-size"])||this._updateRowHeight(i,o)}},_updateRowHeight:function(n,t){var u=this.XLObj,e,i,r,o,f;for(t=t?t:u.getActiveSheetIndex(),e=u.getSheet(t),r=u._getSelectedCells(t,n).selCells,i=r.length;i--;)u._isRowViewable(t,r[i].rowIndex)&&(o=u.getCell(r[i].rowIndex,r[i].colIndex)),f=u._detailsFromGlobalSpan(r[i].rowIndex,r[i].colIndex,"height",u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"value2"),e.columnsWidthCollection[r[i].colIndex]),!(f>=u.model.rowHeight)||u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"wrap")&&u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"merge")||u.XLEdit.getPropertyValue(r[i].rowIndex,r[i].colIndex,"mergeIdx")||(u._updateFormatColl(t,r[i].rowIndex,r[i].colIndex,f),f=u._getFormattedHeight(t,r[i].rowIndex),o&&o.parent().outerHeight(f),u.XLEdit._updateDataContainer({rowIndex:r[i].rowIndex,colIndex:0},{dataObj:{pHeight:e.rowsHeightCollection[r[i].rowIndex],cHeight:f}}),e.rowsHeightCollection[r[i].rowIndex]=f,u.model.allowFreezing&&u.XLFreeze._refreshFRowResize(r[i].rowIndex));u._refreshRangeTRHght(t,u.swapRange(n))},_hasFormat:function(n){return n?!t.isNullOrUndefined(n.match(/e-format|e-border/)):!1},getFormatHashCode:function(n){var i,u,t="",r=0,f="background-color",e="color",o="font-family",s="font-size",h=["font-style","text-decoration","vertical-align","text-align","font-weight"],l=h.length,a=["FontStyle","TextDecoration","VerticalAlign","TextAlign","FontWeight"],c="text-indent";for(t=(f in n)?n[f].replace("#",""):"6N",t+=(e in n)?n[e].replace("#",""):"6N",(o in n)?(i=this._getStyleCode("FontFamily",n[o]),t+=i||"2N"):t+="2N",t+=(s in n)?this._getFontCode(n[s]):"2N";r<l;)u=h[r],u in n?(i=this._getStyleCode(a[r],n[u]),t+=i||"1N"):t+="1N",r++;return t.endsWith("N")||(t=t+"N"),c in n&&(t+=n[c].replace(/pt|-|\+/g,"")),"e-format"+t},getFormatFromHashCode:function(n){var t,f,e,o,s,h,c,l,u,a,i,r={},v="e-format";if(n=n||"",!n.indexOf(v)){for(e="pt",t=f=0,a=["FontStyle","TextDecoration","VerticalAlign","TextAlign"],c=["font-style","text-decoration","vertical-align","text-align"],l=c.length,i=n.replace(v,"").split("N"),i[t].length===1?t++:(r["background-color"]="#"+i[t].slice(0,6),i[t]=i[t].substr(6)),i[t].length===1?t++:(r.color="#"+i[t].slice(0,6),i[t]=i[t].substr(6)),u=i[t].length,u===1?t++:(s="FontFamily",o="font-family",u===2?(r[o]=this._getCodeStyle(s,i[t].slice(0,1)+"1N"),t++):(r[o]=this._getCodeStyle(s,i[t].slice(0,2)),i[t]=i[t].substr(2))),u=i[t].length,u===1?t++:(h="font-size",u===2?(r[h]=i[t].slice(0,1)+e,t++):(r[h]=i[t].slice(0,2)+e,i[t]=i[t].substr(2)));f<l;)i[t].length===1?t++:(r[c[f]]=this._getCodeStyle(a[f],i[t].slice(0,1)),i[t]=i[t].substr(1)),f++;i[t]==="2"&&(r["font-weight"]="bold");t++;i[t]&&(r["text-indent"]=i[t]+e)}return r},getBorderFromHashCode:function(n,t){var r,i=0,u={},e="e-border",f=this._borderPosition;return n=n||"",n.indexOf(e)||(r=n.replace(e,"").split("N"),r[i].length>1?(u[f[1]]=this._concatBorderCode(r[i]),r[i]=r[i].substr(8)):i+=3,r[i].length>1?(u[f[2]]=this._concatBorderCode(r[i]),t&&(r[i]=r[i].substr(8))):i+=3,t&&(r[i].length>1?(u[f[0]]=this._concatBorderCode(r[i]),r[i]=r[i].substr(8)):i+=3,r[i].length>1&&(u[f[3]]=this._concatBorderCode(r[i])))),u},_formatPainter:function(){var n=this.XLObj,o,s,l;if(n.model.allowFormatPainter&&n.model.allowCellFormatting){var f=n.getActiveSheetIndex(),t,i,h=0,c=n.getSheet(f),r=c._startCell,u=c._endCell,e={sheetIndex:f,reqType:"format-painter",type:"actionBegin",action:"formatpainter"};if(!n._trigActionBegin(e)){for(this._rowLength=u.rowIndex-r.rowIndex+1,this._colLength=u.colIndex-r.colIndex+1,o=this._rowLength,s=this._colLength,l=n.getRangeData({range:[r.rowIndex,r.colIndex,u.rowIndex,u.colIndex],property:["value","value2","type","wrap","formatStr","thousandSeparator","decimalPlaces","cFormatRule","hyperlink","format","cellType"]}),this._getEformatClass=new Array(o),t=0;t<o;t++)for(this._getEformatClass[t]=new Array(s),i=0;i<s;i++)this._getEformatClass[t][i]={rangeData:l[h]},h++;e={sheetIndex:f,reqType:"format-painter",type:"actionComplete",action:"formatpainter"};n._trigActionComplete(e)}}},_fPMouseUp:function(){var s,a,k,g,n=this.XLObj,e=n.getActiveSheetIndex(),w=n.getSheet(e),nt=n._getContent(e).find("div.e-content"),d=0,tt,u=w._selectedCells,it=w._startCell,rt=w._endCell,h,c,i=0,ut=0,l,v,ft,et,b,ot=rt.rowIndex-it.rowIndex,st=rt.colIndex-it.colIndex,o,ct=n.XLEdit,r,y=w.selectedRange,p=n.getRangeData({range:y,property:["wrap","hyperlink","value","value2","cFormatRule","format","cellType","formats","formatStr","decimalPlaces","thousandSeparator","type"]}),f={sheetIndex:e,reqType:"format-painter",range:y,beforeData:p,bFormat:this.getHashCodeClassAsArray(y),unwrapCells:[],wrapCells:[]},ht=n.element.find("#"+n._id+"_Ribbon_Home_Clipboard_FormatPainter");for(n._dupDetails=!0,h=0;h<=ot;h++){for(ut++,c=0;c<=st;c++){if(d++,o=n._getAlphaRange(e,u[i].rowIndex,u[i].colIndex,u[i].rowIndex,u[i].colIndex),a=u[i],r=this._getEformatClass[h][c],this.removeStyle([u[i].rowIndex,u[i].colIndex,u[i].rowIndex,u[i].colIndex],{cellStyle:!0,tableStyle:!1,format:!0}),s={type:r.rangeData.type?r.rangeData.type:"general"},r.rangeData.format&&(s.style=this.getFormatFromHashCode(r.rangeData.format)),r.rangeData.formatStr&&(s.formatStr=r.rangeData.formatStr),r.rangeData.decimalPlaces&&(s.decimalPlaces=r.rangeData.decimalPlaces),r.rangeData.thousandSeparator&&(s.thousandSeparator=r.rangeData.thousandSeparator),this.format(s,o),r.rangeData.cellType&&(k=n._dataContainer.sheetCellType[r.rangeData.cellType],k.text="",n.XLCellType._renderControls(u[i].rowIndex,u[i].colIndex,e,k)),!t.isNullOrUndefined(r.rangeData.cFormatRule))for(b=0,et=r.rangeData.cFormatRule.length;b<et;b++)tt=r.rangeData.cFormatRule[b],v=tt.split("_"),ft=v[5],v[v.indexOf(ft)]=o,n._dataContainer.cFormatRule=v.join("_"),l=n._dataContainer.cFormatRule.split("_"),n.XLCFormat._cFormat(l[0],l[2],l[3],l[4],l[5]);if(p[i].wrap&&!r.rangeData.wrap?(n.setWrapText("unwrap",o),f.wrapCells.push({rowIndex:u[i].rowIndex,colIndex:u[i].colIndex})):!p[i].wrap&&r.rangeData.wrap&&(n.setWrapText("wrap",o),f.unwrapCells.push({rowIndex:u[i].rowIndex,colIndex:u[i].colIndex})),r.rangeData.hyperlink&&!p[i].hyperlink?this.format({style:{"text-decoration":"underline",color:n._hlColor}},o):!r.rangeData.hyperlink&&p[i].hyperlink&&(this.format({style:{"text-decoration":"none"}},o),n.addClass(n.getCell(a.rowIndex,a.colIndex,e).find("a"),ct.getPropertyValue(a.rowIndex,a.colIndex,"format",e))),i++,d===st+1){d=0;break}this._colLength===c+1&&(c=-1)}if(ut===ot+1)break;this._rowLength===h+1&&(h=-1)}this._formatEnable=!1;nt.addClass("e-ss-cursor");nt.removeClass("e-ss-fpcursor");ht.length&&ht.ejToggleButton("option",{toggleState:!1});n._dupDetails=!1;f.afterData=n.getRangeData({range:y,property:["wrap","hyperlink","value","value2","cFormatRule","format","cellType","formats","formatStr","decimalPlaces","thousandSeparator","type"]});f.aFormat=this.getHashCodeClassAsArray(y);n.XLSelection.refreshSelection();n.XLDragFill&&n.XLDragFill.positionAutoFillElement();g={sheetIndex:f.sheetIndex,currData:f.afterData,currFormat:f.aFormat,reqType:f.reqType,range:f.range,prevData:f.beforeData,prevFormat:f.bFormat,unwrapCells:f.unwrapCells,wrapCells:f.wrapCells};n._isUndoRedo||(n._completeAction(f),n._trigActionComplete(g))},_getFormatObj:function(n){if("type"in n||"formatStr"in n){var t={},i="thousandSeparator";t.formatStr="formatStr"in n?n.formatStr:this.XLObj._getFormatString(n.type,n.decimalPlaces);t.decimalPlaces="decimalPlaces"in n?n.decimalPlaces:["currency","accounting","number"].indexOf(n.type)!==-1?parseInt(t.formatStr.replace(/{0:|[A-Z]|}/g,"")):0;i in n?t[i]=n[i]:n.type==="number"&&(t[i]=!0);n.format=t}return"style"in n&&n.style.border&&(n.border=n.style.border,delete n.style.border,this.XLObj.getObjectLength(n.style)||delete n.style),n},_createFormatClass:function(n,t,i){var u,r=this.XLObj._dataContainer.hashCode;return(t=t||this.getFormatHashCode(n),r.indexOf(t)!==-1&&!i)?t:(u=this._getCssPropertyAsString(n),this._writeCssRules(t,u,i),r.indexOf(t)===-1&&r.push(t),t)},_writeCssRules:function(n,t,i,r){var u=document.getElementById(this.XLObj._id+"_sscustomformat"),f=".e-js.e-spreadsheet .e-spreadsheetmainpanel ."+n+" {"+t+"}";r||(u.styleSheet?u.styleSheet.cssText+=f:u.appendChild(document.createTextNode(f)));i&&(f=f.replace(".e-spreadsheetmainpanel ",""),u.styleSheet?u.styleSheet.cssText+=f:u.appendChild(document.createTextNode(f)))},_getCssPropertyAsString:function(n){var t="",i,r,u;if("border"in n){i=n.border;for(r in i)n["border-"+r]=i[r];delete n.border}for(u in n)t=t+(u+":"+n[u]+";");return t},_splitBorderCode:function(n){return n=n.split(" "),n[0].replace("px","")+this._getStyleCode("BorderStyle",n[1])+n[2].replace("#","")},_concatBorderCode:function(n){return n.substr(0,1)+"px "+this._getCodeStyle("BorderStyle",n.substr(1,1))+" #"+n.substr(2,6)},_getCodeStyle:function(n,i){n=t.Spreadsheet[n];for(var r in n)if(n.hasOwnProperty(r)&&n[r]===i)return r;return""},_getStyleCode:function(n,i){return i=i||"",t.Spreadsheet[n][i.toLowerCase()]},_getFontCode:function(n){var t=n.replace(/pt|-|\+/g,"");return t.length===2?t:t.length===1?t+"1N":"2N"},_getExtendedFormat:function(t,i,r){var u=this.XLObj.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"formats")||{};return r?(n.extend(i,u),{format:i}):u["text-indent"]&&i["text-align"]?(delete u["text-indent"],delete u["text-align"],n.extend(i,u),{format:i}):(n.extend(u,i),{format:u})},_updateHashCodeClass:function(n,t){var i,r,u=this.XLObj,f={},e=u._formatRegx,o=u._borderRegx;t&&(i=t.indexOf("e-format")>-1,r=t.indexOf("e-border")>-1,i&&(f.format=t.match(e)[0]),r&&(f.border=t.match(o)[0]),(i||r)&&u.XLEdit._updateDataContainer({rowIndex:n.rowIndex,colIndex:n.colIndex},{dataObj:f}))},_updateFormatClass:function(n,t,i){t&&(t.indexOf("e-format")>-1||t.indexOf("e-border")>-1)&&this.XLObj.XLEdit._updateDataContainer(n,{dataObj:i?{border:t}:{format:t}})},_applyBorderCss:function(n,t,i){var o=this._borderPosition,c=o[0],s=o[1],h=o[2],l=o[3],r=t[0],u=t[1],f=t[2],e=t[3];c in n&&(r?this._updateBorder([r-1,u,r-1,e],n,h,!0,i):this._updateBorderObj([r,u,r,e],n,c));s in n&&this._updateBorder([r,e,f,e],n,s,"",i);h in n&&this._updateBorder([f,u,f,e],n,h,"",i);l in n&&(u?this._updateBorder([r,u-1,f,u-1],n,s,!0,i):this._updateBorderObj([r,u,f,u],n,l))},_applyAllBorderCss:function(n,t,i){var f=this._borderPosition[1],e=this._borderPosition[2],r=t[0],u=t[1],o=t[2],s=t[3];this._updateBorder(t,n,f+" "+e,"",i);r&&this._updateBorder([r-1,u,r-1,s],n,e,!0,i);u&&this._updateBorder([r,u-1,o,u-1],n,f,!0,i)},_updateBorderObj:function(n,t,i){for(var r,o,u,f,e=n[0],s=n[2];e<=s;){for(r=n[1],o=n[3];r<=o;)f={rowIndex:e,colIndex:r},u=this._extendBorderObj(f,this._parseBorder(t,i).border,this._isFAT),this.XLObj.XLEdit._updateDataContainer(f,{dataObj:this._isFAT?{tborders:u}:{borders:u}}),r++;e++}},_updateBorder:function(i,r,u,f,e){var b,ot,tt,it,l,o,p,rt,st,d,a,c,w,v,ut=!1,ft=!1,h=this._borderPosition,g=i[0],ht=i[2],ct=r.isGridBorder,s=this.XLObj,lt=s.getActiveSheetIndex(),y=s.getSheet(lt),et=s.getRangeData({range:i,property:["merge","isMHide","mergeIdx"]}),nt=0,k;for(delete r.isGridBorder;g<=ht;){for(b=i[1],ot=i[3];b<=ot;){if(p={rowIndex:g,colIndex:b},tt=g,it=b,f?(ft=u===h[2],ft?tt++:it++,a=this._parseBorder(r,ft?h[0]:h[3]).border):a=this._parseBorder(r,u).border,ct?f||(c=this._extendBorderObj(p,r,this._isFAT),ut=!0):f?(rt={rowIndex:tt,colIndex:it},c=this._extendBorderObj(rt,a,this._isFAT),s.XLEdit._updateDataContainer(rt,{dataObj:this._isFAT?{tborders:c}:{borders:c},skipCell:r.skipCell})):(c=this._extendBorderObj(p,this._parseBorder(r,u).border,this._isFAT),ut=!0),ut&&s.XLEdit._updateDataContainer(p,{dataObj:this._isFAT?{tborders:c}:{borders:c},skipCell:r.skipCell}),!(f&&s.hasSpan(p))){if(l=p.colIndex,u===h[1]&&f&&l)while(l){if(!s.XLEdit.getPropertyValue(0,l,"isCHide"))break;l--}if(o=p.rowIndex,u===h[2]&&f&&o)while(o){if(!s.XLEdit.getPropertyValue(o,0,"isRHide"))break;o--}v=s.XLEdit.getPropertyValue(o,l,"border");v=v?this.getBorderFromHashCode(v):s.XLEdit.getPropertyValue(o,l,"borders")||{};f?(c={},h[1]in v&&(c[h[3]]=v[h[1]]),h[2]in v&&(c[h[0]]=v[h[2]]),a=this._isFAT?n.extend(a,c):n.extend(c,a)):a=this._isFAT?n.extend(a,v):n.extend(v,a);w=this._parseBorder(a,h[1]+" "+h[2],f);d=this._getBorderHashCode(w.border);this._createFormatClass(w,d);et[nt].isMHide&&this._updateFormatClass({rowIndex:et[nt].mergeIdx.rowIndex,colIndex:et[nt].mergeIdx.colIndex},d,!0);this._updateFormatClass({rowIndex:o,colIndex:l},d,!0);(s.getObjectKeys(w.border).indexOf("bottom")>-1&&w.border.bottom.indexOf("double")>-1||!t.isNullOrUndefined(w["border-bottom"])&&w["border-bottom"].indexOf("double")>-1)&&st!=o&&(k=Math.round(s._detailsFromGlobalSpan(o,l,"height",s.XLEdit.getPropertyValue(o,l,"value2"),y.columnsWidthCollection[l])),k>=y.rowsHeightCollection[o]&&(s._isUndoRedo||y._isImported&&!y._isLoaded||e.prevHeight.push([o,y.rowsHeightCollection[o]]),s._dupDetails=!0,s.XLResize.setRowHeight(o,k+3),s._dupDetails=!1,st=o,y.rowsHeightCollection[o]=k+3,s._isUndoRedo||y._isImported&&!y._isLoaded||e.newHeight.push([o,k+3])))}b++;nt++}g++}},_extendBorderObj:function(t,i,r){var f=this.XLObj,u=f.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,r?"tborders":"borders")||{};return n.extend(u,i),u},_getBorderHashCode:function(n,t){var i="",r="1N1N6N",u=this._borderPosition,f=u[0],e=u[1],o=u[2],s=u[3];return i=e in n?this._splitBorderCode(n[e]):r,i+=o in n?this._splitBorderCode(n[o]):r,t&&(i+=f in n?this._splitBorderCode(n[f]):r,i+=s in n?this._splitBorderCode(n[s]):r),"e-border"+i},_parseBorder:function(n,t,i){var r,u,f,e,s={border:{}},o=this._borderPosition;for(t=t.split(" "),r=t.length;r--;)f=u=t[r],i&&(f=u===o[1]?o[3]:o[0]),e=n[f],e&&(s.border[u]=e);return s},_refreshTableRowCol:function(n){var i=this.XLObj,r=i.getActiveSheetIndex(),u=i.getSheet(r),f=u.tableManager,t=f[n.tid];t&&(n.isInsertBefore?n.pos==="row"?(t.range[0]+=n.cnt,t.range[2]+=n.cnt):(t.range[1]+=n.cnt,t.range[3]+=n.cnt):(n.pos==="row"?t.range[2]=t.range[2]+n.cnt:t.range[3]=t.range[3]+n.cnt,i._dupDetails=!0,i.XLFormat._createTable(n.tid,{format:t.format}),this._updateTableFormula("updateRange",t,r),i._dupDetails=!1))},_refreshHiddenBorder:function(n,t,i,r){var c,u,s,e,o,k,d,w,nt,it,h,rt,l,v,g,a,b,y,p,tt,f=this.XLObj.XLEdit,ut=this.XLObj.getSheet().usedRange;if(i?(h="bottom",v="top",rt="isRHide",ut=ut.colIndex):(h="right",v="left",rt="isCHide",ut=ut.rowIndex),r){for(w=n,nt=t;nt++;)if(e=i?nt:0,o=i?0:nt,!f.getPropertyValue(e,o,rt))break;while(w){if(e=i?w:0,o=i?0:w,!f.getPropertyValue(e,o,rt))break;w--}for(c=0;c<=ut;c++)i?(e=w,u=k=n,s=o=d=c):(o=w,u=e=k=c,s=d=n),f.getPropertyValue(u,s,"isMHide")&&(u=f.getPropertyValue(u,s,"mergeIdx"),s=u.colIndex,u=u.rowIndex),g=f.getPropertyValue(e,o,"borders"),a=f.getPropertyValue(u,s,"borders"),b=f.getPropertyValue(e,o,"tborders"),y=f.getPropertyValue(k,d,"tborders"),(!g||g&&!g[h])&&(a&&a[v]||(!b||b&&!b[h])&&y&&y[v])&&(it=f.getPropertyValue(e,o,"border"),l=this.getBorderFromHashCode(it),delete l[h],b&&b[h]&&(l[h]=b[h]),l.bottom||l.right?(it=this._getBorderHashCode(l),f._updateDataContainer({rowIndex:e,colIndex:o},{dataObj:{border:it}})):f._clearDataContainer({cellIdx:{rowIndex:e,colIndex:o},property:["border"]})),i?(d=w,u=e=nt,s=o=k=c):(k=w,s=o=nt,u=e=d=c),f.getPropertyValue(u,s,"isMHide")&&(u=f.getPropertyValue(u,s,"mergeIdx"),s=u.colIndex,u=u.rowIndex),p=f.getPropertyValue(u,s,"borders"),tt=f.getPropertyValue(e,o,"tborders"),(!g||g&&!g[h])&&(p&&p[v]||(!b||b&&!b[h])&&tt&&tt[v])&&(l={},(g||f.getPropertyValue(d,k,"border"))&&(it=f.getPropertyValue(d,k,"border"),l=this.getBorderFromHashCode(it)),l[h]=p&&p[v]?p[v]:tt[v],it=this._getBorderHashCode(l),f._updateDataContainer({rowIndex:d,colIndex:k},{dataObj:{border:it}}))}else{if(e=i?n-1:0,o=i?0:n-1,f.getPropertyValue(e,o,rt)){for(w=n-1;w;){if(e=i?w:0,o=i?0:w,!f.getPropertyValue(e,o,rt))break;w--}for(c=0;c<=ut;c++)i?(e=w,s=o=d=c,u=k=n-1):(o=w,u=e=k=c,s=d=n-1),f.getPropertyValue(u,s,"isMHide")&&(u=f.getPropertyValue(u,s,"mergeIdx"),s=u.colIndex,u=u.rowIndex),g=f.getPropertyValue(e,o,"borders"),a=f.getPropertyValue(u,s,"borders"),b=f.getPropertyValue(e,o,"tborders"),y=f.getPropertyValue(k,d,"tborders"),l=this.getBorderFromHashCode(f.getPropertyValue(e,o,"border")),(!g||g&&!g[h]||g&&g[h]!==(l&&l[h]))&&(!b||b&&!b[h]||b&&b[h]&&(f.getPropertyValue(e,o,"border")!==this._getBorderHashCode(b)||a&&a[v]))&&(a&&a[v]||l&&l[h]&&(!a||a&&!a[v])||y&&y[v])&&(e=i?u:s,o=i?s:u,this._showHiddenBorder(w,e,o,c,i));for(c=0;c<=ut;c++)i?(e=u-1,u=k=n,s=d=o=c):(o=s-1,u=e=k=c,s=d=n),f.getPropertyValue(u,s,"isMHide")&&(u=f.getPropertyValue(u,s,"mergeIdx"),s=u.colIndex,u=u.rowIndex),a=f.getPropertyValue(e,o,"borders"),p=f.getPropertyValue(u,s,"borders"),y=f.getPropertyValue(e,o,"tborders"),tt=f.getPropertyValue(k,d,"tborders"),l=this.getBorderFromHashCode(f.getPropertyValue(e,o,"border")),(!a||a&&!a[h]||a&&a[h]!==(l&&l[h]))&&(!y||y&&!y[h]||y&&y[h]&&f.getPropertyValue(k,d,"border")!==this._getBorderHashCode(y))&&(p&&p[v]||l&&l[h]&&(!p||p&&!p[v])||tt&&tt[v])&&(e=i?u:s,o=i?s:u,this._showHiddenBorder(n-1,e,o,c,i))}for(n;n<t;n++)if(nt=n+1,i?(e=nt,o=s=0,u=n):(o=nt,e=u=0,s=n),f.getPropertyValue(e,o,rt)||f.getPropertyValue(u,s,rt))for(c=0;c<=ut;c++)i?(u=nt,s=o=c,e=n):(u=e=c,s=nt,o=n),f.getPropertyValue(u,s,"isMHide")&&(u=f.getPropertyValue(u,s,"mergeIdx"),s=u.colIndex,u=u.rowIndex),a=f.getPropertyValue(e,o,"borders"),p=f.getPropertyValue(u,s,"borders"),y=f.getPropertyValue(e,o,"tborders"),tt=f.getPropertyValue(u,s,"tborders"),l=this.getBorderFromHashCode(f.getPropertyValue(e,o,"border")),(!a||a&&!a[h]||a&&a[h]!==(l&&l[h]))&&(!y||y&&!y[h]||y&&y[h]&&(f.getPropertyValue(e,o,"border")!==this._getBorderHashCode(y)||p&&p[v]))&&(p&&p[v]||l&&l[h]&&(!p||p&&!p[v])||tt&&tt[v])&&(u=i?s:u,this._showHiddenBorder(n,nt,u,c,i))}},_showHiddenBorder:function(n,t,i,r,u){var c,l,a,v,y,p,f,w,e,b,k,d,s,h,o=this.XLObj.XLEdit;u?(a=t,p=r,l=v=i,c=y=n,f="bottom",h="top"):(v=t,y=r,c=a=i,l=p=n,f="right",h="left");w=o.getPropertyValue(c,l,"border");e=this.getBorderFromHashCode(w);e[f]&&delete e[f];s=o.getPropertyValue(c,l,"tborders");k=o.getPropertyValue(a,v,"borders");d=o.getPropertyValue(a,v,"tborders");b=o.getPropertyValue(y,p,"borders");b&&b[f]?e[f]=b[f]:k&&k[h]?e[f]=k[h]:(s&&s[f]||d&&d[h])&&(e[f]=s&&s[f]?s[f]:d[h]);e.bottom||e.right?(w=this._getBorderHashCode(e),o._updateDataContainer({rowIndex:y,colIndex:p},{dataObj:{border:w}})):o._clearDataContainer({cellIdx:{rowIndex:c,colIndex:l},property:["border"]})},_resizeFormatTableMenu:function(){var t=this.XLObj,i=document.getElementById(t._id+"_formatastable");t._tabMode||t._phoneMode?(n("#"+t._id+"_Ribbon").append(n("#"+t._id+"_formatastable").parent()),t._removeClass(i,"e-formatastable"),t.addClass(i,"e-formatastable-adaptive"),i.style.height=t._dlgHeight+"px"):(t._removeClass(i,"e-formatastable-adaptive"),t.addClass(i,"e-formatastable"))},_resizeStyleMenu:function(){var t=this.XLObj,i=document.getElementById(t._id+"_cellstyles");t._tabMode||t._phoneMode?(n("#"+t._id+"_Ribbon").append(n("#"+t._id+"_cellstyles").parent()),t._removeClass(i,"e-cellstyles"),t.addClass(i,"e-cellstyles-adaptive"),i.style.height=t._dlgHeight+"px"):(t._removeClass(i,"e-cellstyles-adaptive"),t.addClass(i,"e-cellstyles"))},_resizeBorderMenu:function(t){var i=this.XLObj,r=i.element.find(".e-bordercontainer"),u;i._phoneMode&&(n("#"+i._id+"_Ribbon").append(n("#"+i._id+"_Ribbon_Border").parent()),r.length?r.show():(this._createBorderDiv(),i.element.find(".e-bordercontainer").show()),i.addClass(r[0],"e-border e-adaptive"),t.cancel=!0,u=n("#"+i._id+"_Ribbon_Home_Font_Border").ejSplitButton("instance"),u.contstatus=!0)},_customStyleDlg:function(){var i=this.XLObj,r,s,u,f,e,o;r=t.buildTag("div","","",{id:i._id+"_CustomCellDialog"});o=t.buildTag("div.e-dlg-btnfields");var h=t.buildTag("div.e-dlg-btnfields"),c=t.buildTag("div.e-dlg-btnctnr"),l=t.buildTag("div.e-dlg-btnctnr");s="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields '><td style='width: 22%;'><label>"+i._getLocStr("StyleName")+":<\/label><\/td><td style= 'padding-left: 10px;'><input id ='"+i._id+"_StyleName' type ='text' value = 'Style' class = 'ejinputtext'/><\/td><\/tr><\/table><\/div>";r.append(s);u=t.buildTag("input","","",{id:i._id+"_CustomCellDlgOkBtn",type:"submit"});f=t.buildTag("input","","",{id:i._id+"_CustomCellDlgFrmtBtn",type:"submit"});e=t.buildTag("input","","",{id:i._id+"_CustomCellDlgCanBtn"});u.ejButton({text:i._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgOK,this),enabled:!0,cssClass:"e-ss-okbtn"});f.ejButton({text:i._getLocStr("Format")+"...",showRoundedCorner:!0,width:60,click:t.proxy(this._dlgFrmt,this),enabled:!0,cssClass:"e-ss-okbtn"});e.ejButton({text:i._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,i),showRoundedCorner:!0,width:60});r.append(h.append(c.append(f)));o.append(l.append(u,e));r.append(o);r.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("Style"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dlgCancel,i),open:t.proxy(function(){var t=n("#"+i._id+"_StyleName");t.focus().setInputPos(t.val().length).select()})})},_dlgOK:function(){var t=this.XLObj,r=t.XLFormat,i=t.XLCMenu,u=n("#"+t._id+"_formatdlg_format_dataMnger").data();i?r._styleDlgClick?i._modifyClick?this.modifyCustomStyle(i._oldCustomName,n.extend(!0,{},u),n("#"+t._id+"_StyleName").val()):this.addNewCustomStyle(n("#"+t._id+"_StyleName").val(),n.extend(!0,{},u)):i._modifyClick?this.modifyCustomStyle(i._oldCustomName,t._dataContainer.customCellStyle[i._oldCustomName],n("#"+t._id+"_StyleName").val()):this.addNewCustomStyle(n("#"+t._id+"_StyleName").val(),{style:{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"},NumFormat:{type:"general"}}):r._styleDlgClick?this.addNewCustomStyle(n("#"+t._id+"_StyleName").val(),n.extend(!0,{},u)):this.addNewCustomStyle(n("#"+t._id+"_StyleName").val(),{style:{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"},NumFormat:{type:"general"}});n("#"+t._id+"_CustomCellDialog").ejDialog("close");r._styleDlgClick=!1;i&&(i._modifyClick=!1,i._oldCustomName=i._target="")},_dlgFrmt:function(){var n=this.XLObj;n.XLFormat._styleDlgClick=!0;n._showDialog(n._id+"_FormatCells")},_styleDlgOpen:function(){var t=this.XLObj,i=t.model.enableContextMenu?t.XLCMenu._target:"";n("#"+t._id+"_StyleName").val(i);n("#"+t._id+"_CustomCellDialog").ejDialog("open")},_dlgCancel:function(){var t=this.XLCMenu;n("#"+this._id+"_CustomCellDialog").ejDialog("close");this.XLFormat._styleDlgClick=!1;t&&(t._modifyClick=!1,t._oldCustomName=t._target="")},addNewCustomStyle:function(i,r){var u=this.XLObj,e=u._dataContainer,h,l;if(!(u.isImport||u.model.isImport)&&this._isHeaderAdded&&u.getObjectKeys(e.customCellStyle).indexOf(i)>-1){u._showAlertDlg("Alert","cellStyleAlert","cellStyleAlert",200);return}var a=this._createFormatClass(r.style,"",!0),f=u.XLCMenu,o=n("#"+u._id+"_cellstyles"),s=t.buildTag("div.e-cellstylecell e-customcellstyle "+a,i,"",{title:i}),c;parseInt(r.style["font-size"])>11&&s.css({"font-size":"11pt"});this._isHeaderAdded?o.children().eq(1).append(s):(h=t.buildTag("div.e-cellstylecontent"),l=t.buildTag("div.e-cellstyleheader","Custom"),h.append(s),o.prepend(h).prepend(l),o.children().eq(0).append(n("#"+u._id+"_cellstyles_back")),this._isHeaderAdded=!0,f&&f._createMenu(t.buildTag("ul .e-spreadsheet e-"+f._uniqueClass," ",{display:"none"},{id:u._id+"_contextMenuCellStyles"}),u.XLCMenu._cellStylesMenuData,"  .e-cellstylecontent"));t.isNullOrUndefined(e.customCellStyle[i])&&(e.customCellStyle[i]=r);f&&(c=n("#"+u._id+"_contextMenuCellStyles").data("ejMenu"),c.model.contextMenuTarget=" .e-customcellstyle")},modifyCustomStyle:function(t,i,r){var u=this.XLObj,f=u._dataContainer,o,e;if(this._isHeaderAdded&&u.getObjectKeys(f.customCellStyle).indexOf(t)===-1){u._showAlertDlg("Alert","modifyCellStyleAlert","modifyCellStyleAlert",200);return}this._isHeaderAdded&&u.getObjectKeys(f.customCellStyle).indexOf(r)>-1&&t!=r||(n.extend(f.customCellStyle[t],i),o=this._createFormatClass(f.customCellStyle[t].style,"",!0),e=n("#"+u._id+"_cellstyles").children().eq(1).find('div[title="'+t+'"]'),u._removeClass(e[0],e[0].classList[2]),u.addClass(e[0],o),t!=r&&(f.customCellStyle[r]=f.customCellStyle[t],delete f.customCellStyle[t],e.attr("title",r),e.html(r)))},deleteCustomStyle:function(t){var i=this.XLObj,u=i._dataContainer,r;if(this._isHeaderAdded&&i.getObjectKeys(u.customCellStyle).indexOf(t)===-1){i._showAlertDlg("Alert","modifyCellStyleAlert","",200);return}r=n("#"+i._id+"_cellstyles").children();r.eq(1).find('div[title="'+t+'"]').remove();delete u.customCellStyle[t];r.eq(1).children().length===0&&(r[0].remove(),r[1].remove(),n("#"+i._id+"_cellstyles").children().eq(0).append("<span id ='"+i._id+"_cellstyles_back' class = 'e-cellstyles-back e-icon e-ss-leftarrow'/>"),this._isHeaderAdded=!1)},applyCustomCellStyle:function(t,i){var r=this.XLObj,u=r._dataContainer,f;if(this._isHeaderAdded&&r.getObjectKeys(u.customCellStyle).indexOf(t)===-1){r._showAlertDlg("Alert","modifyCellStyleAlert","modifyCellStyleAlert",200);return}f={style:u.customCellStyle[t].style};n.extend(f,u.customCellStyle[t].NumFormat);this.format(f,i)},_createBorderDiv:function(){for(var i=this.XLObj,f="<div class='e-ss-bdr-header'><span id ='"+i._id+"_border_back' class = 'e-border-back e-icon e-ss-leftarrow'/><\/div><div class='e-ss-border-content'>",e="",o=t.buildTag("div#"+i._id+"_bordercontainer.e-bordercontainer",{},{display:"none",height:i._responsiveHeight-2}),u=i.XLRibbon._borderMenuData,r=0;r<13;r++)e+="<div class = 'e-bordercell' id="+u[r].id+">"+i._renderDIV("e-ss-border "+u[r].sprite+" e-ss-menu","",u[r].text)+"<\/div>";f+=e+"<\/div>";o.append(n(f));n("#"+i._id+"_Ribbon").append(o);i._on(n("#"+i._id+"_bordercontainer"),"click",i._borderSelectionClick)},_updateTableFormula:function(n,t,i,r){var u=this.XLObj,e=u.getCalcEngine(),y=!1,a=!1,c=u.XLEdit,w,v;if(n==="updateRange"&&(y=!0),n==="rename"&&(a=!0),n==="addRange"||y){var o,f=t.range,l,s=t.name,h={},p;for(l=u.getRangeData({range:[f[0],f[1],f[0],f[3]],property:["value2"],sheetIdx:i}),o=0,p=l.length;o<p;o++)y&&e.removeNamedRange(s+"["+l[o].value2+"]"),h[l[o].value2]=c._parseSheetRef(u._getDollarAlphaRange([f[0]+1,f[1]+o,f[2],f[1]+o])),e.addNamedRange(s+"["+l[o].value2+"]",h[l[o].value2]);y&&(e.removeNamedRange(s+"[#All]"),e.removeNamedRange(s+"[#Data]"),e.removeNamedRange(s+"[#Headers]"));t.totalRow&&(e.removeNamedRange(s+"[#Rows]"),h["#Rows"]=c._parseSheetRef(u._getDollarAlphaRange([f[2],f[1],f[2],f[3]])),e.addNamedRange(s+"[#Rows]",h["#Rows"]));h["#All"]=c._parseSheetRef(u._getDollarAlphaRange(f));e.addNamedRange(s+"[#All]",h["#All"]);h["#Data"]=c._parseSheetRef(u._getDollarAlphaRange([f[0]+1,f[1],f[2],f[3]]));e.addNamedRange(s+"[#Data]",h["#Data"]);h["#Headers"]=c._parseSheetRef(u._getDollarAlphaRange([f[0],f[1],f[0],f[3]]));e.addNamedRange(s+"[#Headers]",h["#Headers"]);u._tableRangesFormula[t.name]=h}else if(n==="totalRow")e.namedRangeValues.containsKey(t.name+"[#Rows]")&&e.removeNamedRange(t.name+"[#Rows]"),t.totalRow?(u._tableRangesFormula[t.name]["#Rows"]=c._parseSheetRef(u._getDollarAlphaRange([t.range[2],t.range[1],t.range[2],t.range[3]])),e.addNamedRange(t.name+"[#Rows]",u._tableRangesFormula[t.name]["#Rows"])):u._tableRangesFormula[t.name]["#Rows"]&&delete u._tableRangesFormula[t.name]["#Rows"],u._tableRangesFormula[t.name]["#All"]=c._parseSheetRef(u._getDollarAlphaRange(t.range)),e.removeNamedRange(t.name+"[#All]"),e.addNamedRange(t.name+"[#All]",u._tableRangesFormula[t.name]["#All"]);else if(n==="removeTable"||a){for(a||(r=t.name),v=u.getObjectKeys(u._tableRangesFormula[r]),s=t.name,o=0,w=v.length;o<w;o++)e.removeNamedRange(r+"["+v[o]+"]"),a&&e.addNamedRange(s+"["+v[o]+"]",u._tableRangesFormula[r][v[o]]);a&&(u._tableFormulaCollection[s]=u._tableFormulaCollection[r]);delete u._tableRangesFormula[r];delete u._tableFormulaCollection[r]}},_updateTableColName:function(n,t,i,r,u,f){var e=this.XLObj,w=e._getTableID(f),b=e.getSheet(u).tableManager,h=b[w].range,k=r.toUpperCase();if(h[0]===n&&i.length&&i.toUpperCase()!==k){for(var d=e.getCalcEngine(),c,s=b[w].name,v=e.getRangeData({range:[h[0],h[1],h[0],h[3]],property:["value2"],sheetIdx:u}),y=2,p=[],a,o=0,l=v.length;o<l;o++)p[o]=v[o].value2?v[o].value2.toUpperCase():"",p[o]===k&&(r=r+y,y++);while(p.indexOf(r.toUpperCase())>-1)a=parseInt(r.slice(-1)),r=r.substring(0,r.length-1),r=isNaN(a)?r+y:a++&&r+a;for(d.removeNamedRange(s+"["+i+"]"),d.addNamedRange(s+"["+r+"]",e._tableRangesFormula[s][i]),e._tableRangesFormula[s][r]=e._tableRangesFormula[s][i],delete e._tableRangesFormula[s][i],c=e.getObjectKeys(e._tableRangesFormula[s]),e._tableFormulaCollection[s]=[],o=0,l=c.length;o<l;o++)e._tableFormulaCollection[s].push({text:"["+c[o]+"]",display:c[o]})}return r}};t.Spreadsheet.FontFamily={"angsana new":"11N",arial:"21N","arial black":"31N",batang:"41N","book antiqua":"51N","browallia new":"61N",calibri:"71N",cambria:"81N",candara:"91N",century:"10","comic sans ms":"11",consolas:"12",constantia:"13",corbel:"14","cordia new":"15",courier:"16","courier new":"17",dilleniaupc:"18",dotum:"19",fangsong:"20",garamond:"21",georgia:"22",gulim:"23",gungsuh:"24",kaiti:"25",jasmineupc:"26","malgun gothic":"27",mangal:"28",meiryo:"29","microsoft jhenghei":"30","microsoft yahei":"31",mingliu:"32",mingliu_hkscs:"33","ms gothic":"34","ms mincho":"35","ms pgothic":"36","ms pmincho":"37",pmingliu:"38","pmingliu-extb":"39",simhei:"40",simsun:"41","simsun-extb":"42",tahoma:"43",times:"44","times new roman":"45","trebuchet ms":"46",verdana:"47","yu gothic":"48","yu mincho":"49"};t.Spreadsheet.FontStyle={normal:"1",italic:"2",oblique:"3"};t.Spreadsheet.TextAlign={left:"1",right:"2",center:"3",justify:"4"};t.Spreadsheet.VerticalAlign={top:"1",middle:"2",bottom:"3"};t.Spreadsheet.TextDecoration={none:"1",underline:"2",overline:"3","line-through":"4","line-through underline":"5"};t.Spreadsheet.FontWeight={normal:"1",bold:"2"};t.Spreadsheet.BorderStyle={solid:"1",dashed:"2",dotted:"3",double:"4"};t.Spreadsheet.CellFormat={number:"{0:N2}",currency:"{0:C2}",accounting:"{0:C2}",percentage:"{0:P2}",shortdate:"{0:M/d/yyyy}",longdate:"{0:dddd, MMMM dd, yyyy}",time:"{0:h:mm:ss tt}",scientific:"{0:N2}"}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.cellType=function(n){this.XLObj=n;this._isIntrnlUpdate=!1;this._cellTypeDate=""};t.spreadsheetFeatures.cellType.prototype={_renderControls:function(i,r,u,f,e,o){var et,st,it,ht,h,nt,b;if(f&&(!this.XLObj.model.isGridMode||!(u>1||f.dataSourceSheetIndex>1))){var c,l,y,rt,k,s=this.XLObj,ot=s._browserDetails.name,v,a=s._getSheetIndex(u),ut=s.getCell(i,r,a),ct=s.getSheet(a),p=s.XLEdit.getPropertyValue(i,r,"value2",a),tt=f.type,d=s._generateHeaderText(r+1),g=s._dataContainer.sheetCellType,lt=s._getRowHeight(i,u),ft=s.XLEdit.getPropertyValue(i,r,"cellType"),w=ft>-1?ft:s.getObjectLength(g);s._textClip(i,r,"delete","",!0);s._textClip(i,r,"add","");ut&&(l=ut[0]);s.addClass(l,"e-cellreadonly");s._dupDetails||(ft?f.isChecked=g[w].isChecked:ct.cellTypes.push({range:s._getAlphaRange(u,i,r,i,r),settings:n.extend(!0,{},f)}));switch(tt){case"Button":c=s._id+"_btn_"+a+d+(i+1);s.XLFormat._writeCssRules("e-btncls"+i+r,"border: 0px; vertical-align: middle;padding: 0px;color:"+f.color+";background:"+f.backgroundColor+";",!0,!0);l&&(l.innerHTML="<button id ="+c+' class = "e-btncls'+i+r+'"><\/button>');l&&(ot==="mozilla"||ot==="msie")&&(s.addClass(l,"e-btnhgt"),s.addClass(ut.parents(".e-table")[0],"e-btnhgt"));o||(y={type:tt,id:c,text:f.text||p||f.type+d+(i+1),color:f.color||"","background-color":f.backgroundColor||""},g[w]=y,s.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{cellType:w},sheetIdx:a}));n("#"+c).ejButton({type:"button",width:"100%",height:"100%",text:f.text||p||f.type+d+(i+1),create:n.proxy(this._onButtonCreate),click:n.proxy(this.onButtonClick),cssClass:f["class"]||""});break;case"CheckBox":c=s._id+"_chk_"+a+d+(i+1);l&&(l.innerHTML="<input id ="+c+' style = "" />');o||(y={type:tt,id:c,isChecked:e||p&&p.toLowerCase()||f.isChecked||!1},g[w]=y,rt=s.XLEdit._parseValue(y.isChecked,{rowIndex:i,colIndex:r}),rt.cellType=w,s.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:rt,sheetIdx:a}),l&&(l.lastChild.textContent=""));n("#"+c).ejCheckBox({size:"small",change:n.proxy(this.onActiveStateChange),checked:y?y.isChecked.toString()=="true":f.isChecked,cssClass:f["class"]||""});break;case"DropDownList":if(v=f.dataSourceSheetIndex||a,c=s._id+"_drpdwn_"+a+d+(i+1),k=f.dataSourceRange&&s.getRangeIndices(f.dataSourceRange),s.element.find("#"+c).length>0)return;if(l&&(l.innerHTML="<input id ="+c+" />"),v===a||s.getSheet(v)._isLoaded||s._initSheet(v),s.isUndefined(f.selectedIndex)&&p)for(et=f.dataSource||s.getRangeData({range:k,sheetIdx:v}),st=f.field=f.field||{text:"value2"},ht=st.text,it=et.length;--it>=0;)if(et[it][ht]==p){f.selectedIndex=it;break}if(o||(y={type:tt,id:c,text:p,style:"",dataSource:f.dataSource||"",dataSourceRange:f.dataSourceRange||"",selectedIndex:f.selectedIndex>-1?f.selectedIndex:-1,dataSourceSheetIndex:v},g[w]=y,s.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{cellType:w},sheetIdx:a})),f.dataSourceRange)if(h=s._getSelectedRange({rowIndex:k[0],colIndex:k[1]},{rowIndex:k[2],colIndex:k[3]}),nt=s.XLEdit._getPropWithCellIdx([h[0].rowIndex,h[0].colIndex,h[h.length-1].rowIndex,h[h.length-1].colIndex],"ddlRange",v),nt.length===0)s.updateUniqueData({ddlRange:[{rowIndex:i,colIndex:r,sheetIndex:a}]},[h[0].rowIndex,h[0].colIndex,h[h.length-1].rowIndex,h[h.length-1].colIndex],"",v);else for(b=0;b<h.length;b++)nt=s.XLEdit.getPropertyValue(h[b].rowIndex,h[b].colIndex,"ddlRange",v),nt?(nt.push({rowIndex:i,colIndex:r}),s.XLEdit._updateDataContainer({rowIndex:h[b].rowIndex,colIndex:h[b].colIndex},{dataObj:{ddlRange:nt},sheetIdx:v})):s.XLEdit._updateDataContainer({rowIndex:h[b].rowIndex,colIndex:h[b].colIndex},{dataObj:{ddlRange:[{rowIndex:i,colIndex:r}]},sheetIdx:v});n("#"+c).ejDropDownList({loadOnDemand:!0,width:"100%",height:s.model.rowHeight-1,change:n.proxy(this.onActiveValueChange),dataSource:f.dataSource||s.getRangeData({range:k,sheetIdx:v}),fields:f.field?f.field:{text:"value2"},watermarkText:f.watermarkText||"Select an option",cssClass:f["class"]||"",selectedIndex:f.selectedIndex>-1?f.selectedIndex:-1,beforePopupShown:n.proxy(this._onBeforePopupOpen)});break;case"DatePicker":c=s._id+"_dp_"+a+d+(i+1);l&&(l.innerHTML="<input id ="+c+' style = "height:'+(lt-1)+'px" />');o||(y={type:tt,id:c,text:p,style:""},g[w]=y,s.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{cellType:w},sheetIdx:a}));n("#"+c).ejDatePicker({dateFormat:f.format,width:"100%",height:s.model.rowHeight-1,value:p&&t.parseDate(p,f.format)||f.value||new Date,create:n.proxy(this._onDateCreate),change:n.proxy(this.onDateChange),cssClass:f["class"]||"",locale:s.model.locale})}}},addCellTypes:function(n,t,i){var r=this.XLObj;r.model.allowCellType&&(r.model.isReadOnly||(r._isPublic=!0,Array.isArray(n)&&(n=r._getAlphaRange(i,n[0],n[1],n[2],n[3])),this._rangeCellTypes([{range:n,settings:t}],i,!0),r._isPublic=!1))},_rangeCellTypes:function(i,r,u){var d,pt,rt,wt,et,o,lt,at,bt,y,kt,p,w,dt;if(i){var b,f=this.XLObj,ut,ot,g,vt=f._browserDetails.name,h=f._getSheetIndex(r),tt,yt=f._dataContainer,nt,e,l,v,it,c,st,ft,s=f.getSheet(h),ht,a,k,ct=!1;for((u||!s._isLoaded)&&(JSON.stringify(s.cellTypes)!=JSON.stringify(i)&&t.merge(s.cellTypes,i),i=s.cellTypes),d=0,pt=s.cellTypes.length;d<pt;d++)if(st=f.getRangeIndices(i[d].range),e=i[d].settings,ht=e.isChecked,nt=f._getSelectedRange({rowIndex:st[0],colIndex:st[1]},{rowIndex:st[2],colIndex:st[3]}),nt.length===1)f._dupDetails=!0,(f._isRowViewable(h,nt[0].rowIndex)||!s._isLoaded)&&this._renderControls(nt[0].rowIndex,nt[0].colIndex,h,e,ht),f._dupDetails=!1;else{for(g=e.dataSourceSheetIndex||h,rt=0,wt=nt.length;rt<wt;rt++)if(a=nt[rt].rowIndex,k=nt[rt].colIndex,ct=!1,f._isRowViewable(h,a)&&(ct=!0),ct||!s._isLoaded){f._textClip(a,k,"delete","",!0);f._textClip(a,k,"add");ft=f.getObjectLength(yt.sheetCellType);l=ct?f.getCell(a,k,h)[0]:null;b=f.XLEdit.getPropertyValue(a,k,"value2",h);l&&(l.innerHTML="");f._hasClass(l,"e-cellreadonly")||f.addClass(l,"e-cellreadonly");ot=f._generateHeaderText(k+1);switch(e.type){case"Button":if(v=f._id+"_btn"+d+"_"+h+ot+(a+1),f.element.find("#"+v).length>0)return;f.XLFormat._writeCssRules("e-btncls"+a+k,"border: 0px; vertical-align: middle; padding: 0px;color:"+(e.color||"")+";background:"+(e.backgroundColor||"")+";",!0,!0);l&&(l.innerHTML="<button id ="+v+' type="button" class = "e-btncls'+a+k+'"><\/button>');(l&&vt==="mozilla"||vt==="msie")&&(f.addClass(l,"e-btnhgt"),f.addClass(l.parents(".e-table")[0],"e-btnhgt"));(u||!s._isLoaded)&&(tt={type:e.type,id:v,text:e.text||b||e.type+f._generateHeaderText(nt[rt].colIndex+1)+(nt[rt].rowIndex+1),color:e.color||"","background-color":e.backgroundColor||""},ut={cellType:ft});break;case"CheckBox":if(v=f._id+"_chk"+d+"_"+h+ot+(a+1),f.element.find("#"+v).length>0)return;l&&(l.innerHTML="<input id ="+v+" />");tt={type:e.type,id:v,isChecked:ht||b||!1};(u||!s._isLoaded)&&(b&&["false","true","yes","no"].indexOf(b.toLowerCase())===-1&&(b=""),ut=f.XLEdit._parseValue(tt.isChecked,{rowIndex:a,colIndex:k}),ut.cellType=ft);l&&(l.lastChild.textContent="");break;case"DropDownList":if(v=f._id+"_drpdwn"+d+"_"+h+ot+(a+1),f.element.find("#"+v).length>0)return;if(l&&(l.innerHTML="<input id ="+v+" value = "+b+" />"),tt={type:e.type,id:v,style:"",dataSource:e.dataSource||"",dataSourceRange:e.dataSourceRange||"",selectedIndex:e.selectedIndex>-1?e.selectedIndex:"",dataSourceSheetIndex:g},e.dataSource&&e.field&&(tt.field=e.field),e.dataSourceRange&&(it=f.getRangeIndices(e.dataSourceRange)),u||!s._isLoaded){if(e.dataSourceRange)if(it=f.getRangeIndices(e.dataSourceRange),c=f._getSelectedRange({rowIndex:it[0],colIndex:it[1]},{rowIndex:it[2],colIndex:it[3]}),et=f.XLEdit._getPropWithCellIdx([c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex],"ddlRange",g),et.length===0)f.updateUniqueData({ddlRange:[{rowIndex:a,colIndex:k,sheetIndex:h}]},[c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex],"",g);else for(o=0;o<c.length;o++)et=f.XLEdit.getPropertyValue(c[o].rowIndex,c[o].colIndex,"ddlRange",g),et?(et.push({rowIndex:a,colIndex:k,sheetIndex:h}),f.XLEdit._updateDataContainer({rowIndex:c[o].rowIndex,colIndex:c[o].colIndex},{dataObj:{ddlRange:et},sheetIdx:g})):f.XLEdit._updateDataContainer({rowIndex:c[o].rowIndex,colIndex:c[o].colIndex},{dataObj:{ddlRange:[{rowIndex:a,colIndex:k,sheetIndex:h}]},sheetIdx:g});if(g===h||f.getSheet(g)._isLoaded||f._initSheet(g),f.isUndefined(e.selectedIndex)&&b)for(lt=e.dataSource||f.getRangeData({range:it,sheetIdx:g}),at=e.field||{text:"value2"},bt=at.text,e.field||(e.field=at),o=lt.length;--o>=0;){if(lt[o][bt]==b){tt.selectedIndex=o;break}o==0&&delete tt.selectedIndex}}ut={cellType:ft};break;case"DatePicker":if(v=f._id+"_dp"+d+"_"+h+ot+(a+1),f.element.find("#"+v).length>0)return;l&&(l.innerHTML="<input id ="+v+" value = "+b+' style = "height:'+(f._getRowHeight(a,h)-1)+'px" />');(u||!s._isLoaded)&&(tt={type:e.type,id:v,value:e.value||b&&t.parseDate(b)||new Date},ut={cellType:ft})}(u||!s._isLoaded||f._isInsdel)&&(yt.sheetCellType[ft]=tt,f.XLEdit._updateDataContainer({rowIndex:a,colIndex:k},{dataObj:ut,sheetIdx:h}))}switch(e.type){case"Button":n("[id^='"+f._id+"_btn"+d+"_"+h+"']").not("[id *= '_hidden']").ejButton({type:"button",width:"100%",height:"100%",text:b,create:n.proxy(this._onButtonCreate),click:n.proxy(this.onButtonClick),cssClass:i["class"]||""});break;case"CheckBox":n("input[id^='"+f._id+"_chk"+d+"_"+h+"']").not("[id *= '_hidden']").ejCheckBox({change:n.proxy(this.onActiveStateChange),cssClass:i["class"]||"",checked:ht||!1});break;case"DropDownList":n("input[id^='"+f._id+"_drpdwn"+d+"_"+h+"']").not("[id *= '_hidden']").ejDropDownList({loadOnDemand:!0,width:"100%",height:f.model.rowHeight-1,change:n.proxy(this.onActiveValueChange),dataSource:e.dataSource||f.getRangeData({range:it,sheetIdx:g}),fields:e.field?e.field:{text:"value2"},watermarkText:e.watermarkText||"Select an option",cssClass:e["class"]||"",selectedIndex:e.selectedIndex>-1?e.selectedIndex:-1,beforePopupShown:n.proxy(this._onBeforePopupOpen)});break;case"DatePicker":this._cellTypeDate=e.value;n("input[id^='"+f._id+"_dp"+d+"_"+h+"']").not("[id *= '_hidden']").ejDatePicker({dateFormat:e.format,width:"100%",height:f.model.rowHeight-1,create:n.proxy(this._onDateCreate),change:n.proxy(this.onDateChange),cssClass:i["class"]||"",locale:f.model.locale})}}for(this._cellTypeDate="",p=f.getObjectKeys(s._refrshObj),o=0,dt=p.length;o<dt;o++)for(w=f.getObjectKeys(s._refrshObj[p[o]]),y=0,kt=w.length;y<kt;y++)this._isIntrnlUpdate=!0,s._refrshObj[p[o]][w[y]].type==="CheckBox"?n("#"+s._refrshObj[p[o]][w[y]].id).length&&n("#"+s._refrshObj[p[o]][w[y]].id).ejCheckBox("instance").option("checked",s._refrshObj[p[o]][w[y]].isChecked):s._refrshObj[p[o]][w[y]].type==="DropDownList"?n("#"+s._refrshObj[p[o]][w[y]].id).length&&n("#"+s._refrshObj[p[o]][w[y]].id).ejDropDownList("instance").option("selectedIndex",s._refrshObj[p[o]][w[y]].selectedIndex):s._refrshObj[p[o]][w[y]].type==="DatePicker"&&n("#"+s._refrshObj[p[o]][w[y]].id).length&&n("#"+s._refrshObj[p[o]][w[y]].id).ejDatePicker("instance").option("value",s._refrshObj[p[o]][w[y]].value),this._isIntrnlUpdate=!1}},removeCellTypes:function(n,t){var r=this.XLObj,i,f,e,u;if(!r.model.isReadOnly)for(t=r._getSheetIndex(t),e=r._getRangeArgs(n,"object"),u=r.XLEdit._getPropWithCellIdx(e,"cellType",t),i=0,f=u.length;i<f;i++)this._removeControls(u[i].rowIdx,u[i].colIdx,t)},_removeControls:function(n,t,i,r){var u=this.XLObj,e,f,s,o;i=u._getSheetIndex(i);f=u._dataContainer;s=u.getSheet(i);r||(delete f.sheetCellType[f.sheets[i][n][t].cellType],delete f.sheets[i][n][t].cellType,o=this._rangeInColl(u._getAlphaRange(i,n,t,n,t),i),o>-1&&s.cellTypes.splice(o,1));u._isRowViewable(i,n)&&(e=u.getCell(n,t,i)[0],e.innerHTML=u.XLEdit.getPropertyValue(n,t,"value2",i)||"",u._removeClass(e,"e-cellreadonly"))},onActiveValueChange:function(n){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet");if(!i.model.isReadOnly){var h=i._dataContainer,l=this.element.closest("td"),c=i.getActiveSheetIndex(),e=i.getSheet(c),o=i._getCellIdx(l[0]),r=o.rowIndex,u=o.colIndex,f=h.sheetCellType[h.sheets[c][r][u].cellType],s=f.dataSourceRange&&i.getRangeIndices(f.dataSourceRange);f.selectedIndex=n.itemId;f.id.split("_")[1]!="drpdwn"&&(t.isNullOrUndefined(e._refrshObj[r])&&(e._refrshObj[r]={}),e._refrshObj[r][u]={rowIndex:r,colIndex:u,selectedIndex:n.itemId,type:"DropDownList",id:f.id});i.XLEdit._updateDataContainer({rowIndex:r,colIndex:u},{dataObj:i.XLEdit._parseValue(n.text,{rowIndex:r,colIndex:u})});s&&i.XLEdit.getPropertyValue(s[0]+n.itemId,s[1],"type")==="number"&&i.XLFormat.format({type:"number"},[r,u,r,u]);n.cellIndex=o;n.cellType="dropdownlist";i._trigger("cellSave",n);i.model.allowFormulaBar&&i.updateFormulaBar()}},onActiveStateChange:function(n){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),o,v;if(!i.model.isReadOnly&&!i.XLCellType._isIntrnlUpdate){var c=i._dataContainer,l,y=this.element.closest("td"),h=i.getActiveSheetIndex(),f=i.getSheet(h),u=i._getCellIdx(y[0]),e=i._getRowIdx(u.rowIndex,h),r=u.colIndex,s,a;for(s=c.sheetCellType[c.sheets[h][u.rowIndex][r].cellType],s.isChecked=n.isChecked,a=i.getAlphaRange(e,r,e,r),o=0,v=f.cellTypes.length;o<v;o++)f.cellTypes[o].range==a&&(f.cellTypes[o].settings.isChecked=n.isChecked);s.id.split("_")[1]!="chk"&&(t.isNullOrUndefined(f._refrshObj[e])&&(f._refrshObj[e]={}),f._refrshObj[e][r]={rowIndex:e,colIndex:r,isChecked:n.isChecked,type:"CheckBox",id:s.id});l=["yes","no"].indexOf(i.XLEdit.getPropertyValue(u.rowIndex,r,"value2").toString().toLowerCase())>-1?n.isChecked?"YES":"NO":n.isChecked.toString().toUpperCase();i.XLEdit._updateDataContainer({rowIndex:u.rowIndex,colIndex:r},{dataObj:i.XLEdit._parseValue(l,{rowIndex:u.rowIndex,colIndex:r})});n.cellIndex=u;n.cellType="checkbox";i._trigger("cellSave",n);i.model.allowFormulaBar&&i.updateFormulaBar()}},_onDateCreate:function(n){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),s=this.element.closest("td"),h=i.getActiveSheetIndex(),f=i._getCellIdx(s[0]),e=i._getRowIdx(f.rowIndex,h),o=f.colIndex,r=n.model.value||new Date(i.XLCellType._cellTypeDate),u=i.XLEdit._parseValue(r?r.toLocaleString().split(", ")[0]:"",{rowIndex:e,colIndex:o});u.formatStr="{0:"+n.model.dateFormat+"}";u.value=r;u.value2=t.format(r,n.model.dateFormat,i.model.locale);i.XLCellType._cellTypeDate&&this.option("value",r);i.XLEdit._updateDataContainer({rowIndex:e,colIndex:o},{dataObj:u})},onDateChange:function(n){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),s,e;if(!i.model.isReadOnly){var h=i._dataContainer,l=this.element.closest("td"),o=i.getActiveSheetIndex(),c=i.getSheet(o),f=i._getCellIdx(l[0]),r=i._getRowIdx(f.rowIndex,o),u=f.colIndex;s=h.sheetCellType[h.sheets[o][f.rowIndex][u].cellType];h.sheets[o][f.rowIndex][u].SelectedTextValue=n.value;s.id.split("_")[1]!="dp"&&(t.isNullOrUndefined(c._refrshObj[r])&&(c._refrshObj[r]={}),c._refrshObj[r][u]={rowIndex:r,colIndex:u,value:n.model.value,type:"DatePicker",id:s.id});e=i.XLEdit._parseValue(n.model.value?n.model.value.toLocaleString().split(t.isNullOrUndefined(n.model.value.toLocaleString().match(/[,]/))?" ":", ")[0]:"",{rowIndex:r,colIndex:u});e.formatStr="{0:"+n.model.dateFormat+"}";e.value=n.model.value;e.value2=t.format(n.model.value,n.model.dateFormat,i.model.locale);i.XLEdit._updateDataContainer({rowIndex:r,colIndex:u},{dataObj:e});n.cellIndex=f;n.cellType="datepicker";i._isPublic||i._trigger("cellSave",n);i.model.allowFormulaBar&&i.updateFormulaBar()}},_onButtonCreate:function(n){var t=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),f=this.element.closest("td"),e=t.getActiveSheetIndex(),i=t._getCellIdx(f[0]),r=t._getRowIdx(i.rowIndex,e),u=i.colIndex;t.XLEdit._updateDataContainer({rowIndex:r,colIndex:u},{dataObj:t.XLEdit._parseValue(n.model.text,{rowIndex:r,colIndex:u})})},onButtonClick:function(t){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet");i.model.isReadOnly||(t.cellIndex=i._getCellIdx(n(t.target).closest("td")[0]),t.cellType="button",i._trigger("cellClick",t),t.e.stopPropagation())},_onBeforePopupOpen:function(){var t=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),u=t.getActiveSheetIndex(),f=t._dataContainer,s=this.element.closest("td"),e=t._getCellIdx(s[0]),h=e.rowIndex,c=e.colIndex,i=f.sheetCellType[f.sheets[u][h][c].cellType],r=i.dataSourceSheetIndex||u,o;t.getSheet(r)._isLoaded||t._initSheet(r);o=i.dataSource||t.getRangeData({range:t.getRangeIndices(i.dataSourceRange),sheetIdx:r});t._isEmptyString(i.dataSourceRange)||(n("#"+i.id).ejDropDownList("instance").option("dataSource",o),n("#"+i.id).ejDropDownList("instance").option("selectedItemIndex",i.selectedIndex))},_rangeInColl:function(n,t){for(var r=this.XLObj,f=r.getSheet(r._getSheetIndex(t)),u=f.cellTypes,i=0,e=u.length;i<e;i++)if(u[i].range===n)return i},_rfrshCtrlText:function(i,r){var e=this.XLObj,o=!0,f,u,s;if(e.isUndefined(i.rowIndex)||e.isUndefined(i.colIndex)||(i=e.getRangeData({range:[i.rowIndex,i.colIndex,i.rowIndex,i.colIndex],property:["cellType","value"]})[0],r=i.value),f=e._dataContainer.sheetCellType[i.cellType],f)switch(f.type){case t.Spreadsheet.CustomCellType.DropDownList:u=n("#"+f.id).data("ej"+f.type);u&&(s=u.selectedIndexValue,u._raiseEvents=!1,u.selectItemByText(r,!0),u._raiseEvents=!0,s!==u.selectedIndexValue?(f.selectedIndex=u.selectedIndexValue,e._isSelIdxChange=!0):o=!1);break;case t.Spreadsheet.CustomCellType.DatePicker:u=n("#"+f.id).data("ej"+f.type);u&&u.option("value",r)}return o},_refreshCellType:function(n){var h=this.XLObj,c=h.getActiveSheetIndex(),o=h.getSheet(c),u,e,t,s,i,r,l,f,a;for(u=h.getObjectKeys(o._refrshObj),r=0,l=u.length;r<l;r++){for(u[r]=parseInt(u[r]),n.status=="insertRow"&&(o._refrshObj[u[r]+n.rowCount]={}),n.status=="deleteRow"&&(o._refrshObj[u[r]-n.rowCount]={}),e=h.getObjectKeys(o._refrshObj[u[r]]),f=0,a=e.length;f<a;f++)e[f]=parseInt(e[f]),t=o._refrshObj[u[r]][e[f]],s=t.id.split("_"),n.startCol<=e[f]&&(n.status=="insertColumn"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])+n.colCount+1)+(u[r]+1),i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]][parseInt(e[f])+n.colCount]=i,delete o._refrshObj[u[r]][e[f]]),n.status=="deleteColumn"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])-n.colCount+1)+(u[r]+1),i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]][parseInt(e[f])-n.colCount]=i,delete o._refrshObj[u[r]][e[f]])),n.startRow<=u[r]&&(n.status=="insertRow"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])+1)+(u[r]+n.rowCount+1),i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]+n.rowCount][e[f]]=i),n.status=="deleteRow"&&(n.startRow==u[r]?delete o._refrshObj[u[r]]:(s[2]=c+h._generateHeaderText(parseInt(e[f])+1)+(u[r]-n.rowCount+1),i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]-n.rowCount][e[f]]=i))),n.status=="shiftBottom"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])+1)+(u[r]+n.rowCount+1),o._refrshObj[u[r]+n.rowCount]={},i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]+n.rowCount][e[f]]=i,delete o._refrshObj[u[r]]),n.status=="shiftUp"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])+1)+(u[r]-n.rowCount+1),o._refrshObj[u[r]-n.rowCount]={},i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]-n.rowCount][e[f]]=i,delete o._refrshObj[u[r]]),n.status=="shiftRight"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])+n.colCount+1)+(u[r]+1),i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]][parseInt(e[f])+n.colCount]=i,delete o._refrshObj[u[r]][e[f]]),n.status=="shiftLeft"&&(s[2]=c+h._generateHeaderText(parseInt(e[f])-n.colCount+1)+(u[r]+1),i={rowIndex:t.rowIndex,colIndex:t.colIndex+n.colCount,type:t.type,id:s.join("_")},t.type=="DropDownList"&&(i.selectedIndex=t.selectedIndex),t.type=="CheckBox"&&(i.isChecked=t.isChecked),t.type=="DatePicker"&&(i.value=t.value),o._refrshObj[u[r]][parseInt(e[f])-n.colCount]=i,delete o._refrshObj[u[r]][e[f]]);(n.status=="insertRow"||n.status=="deleteRow")&&delete o._refrshObj[u[r]]}}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.cFormat=function(n){this.XLObj=n;this._dataBarStyle=[]};t.spreadsheetFeatures.cFormat.prototype={getCFRule:function(n,t){var f=this.XLObj,u=f.XLEdit.getPropertyValue(n,t,["cFormatRule"]),e=[],s=f._dataContainer.cFormatData,i,r,o;if(u)for(r=0,o=u.length;r<o;r++)i=s[u[r]].split("_"),e.push({action:i[0],inputs:[i[2],i[3]],color:i[4],bgColor:i[5],range:i[6],isApplied:JSON.parse(i[8])});return e},setCFRule:function(n){var i=this.XLObj,r,u;i.model.isReadOnly||i.model.allowConditionalFormats&&(n.action=="databar"||n.action=="colorscale"||n.action=="iconset"?(n.action=="iconset"&&(colors=n.iconSet?this._getIconSet(n.iconSet):n.color?n.color.indexOf(",")>-1&&n.color:this._getIconSet(n.color)),(n.action=="databar"||n.action=="colorscale")&&(colors=n.color),t.isNullOrUndefined(colors)||this._cFormat(n.action,null,null,colors,null,n.range,i.getActiveSheetIndex())):(r=n.inputs[0],u=n.inputs[1],this._cFormat(n.action,r,u,n.color,n.bgColor,n.range,i.getActiveSheetIndex())))},_getIconSet:function(n){var i="greenarrow,yellowarrow,redarrow";switch(n){case t.Spreadsheet.IconSet.ThreeArrows:i="greenarrow,yellowarrow,redarrow";break;case t.Spreadsheet.IconSet.ThreeArrowsGray:i="uparrow,midarrow,downarrow";break;case t.Spreadsheet.IconSet.ThreeTriangles:i="uptriangle,midtriangle,downtriangle";break;case t.Spreadsheet.IconSet.ThreeTrafficLights:i="greencircle,yellowcircle,redcircle";break;case t.Spreadsheet.IconSet.ThreeTrafficLightsRimmed:i="rimgreencircle,rimyellowcircle,rimredcircle";break;case t.Spreadsheet.IconSet.ThreeSigns:i="greencircle,yellowtri,redsquare";break;case t.Spreadsheet.IconSet.ThreeSymbolsCircled:i="greencircleindi,yellowcircleindi,redcircleindi";break;case t.Spreadsheet.IconSet.ThreeSymbolsUnCircled:i="tick,exclam,cross";break;case t.Spreadsheet.IconSet.ThreeFlags:i="greenflag,yellowflag,redflag";break;case t.Spreadsheet.IconSet.ThreeStars:i="fullstar,halfstar,drystar"}return i},_updateCFormatRule:function(n,t){return n.indexOf("true")>-1?n.replace("true",t):n.replace("false",t)},_getRuleIndex:function(n,i){if(t.isNullOrUndefined(i))return-1;for(var r=0,u=i.length;r<u;r++)if(i[r]===n)return r;return-1},_refreshCFormatFormula:function(n,t,i){var u=this.XLObj,f=u.getSheet(i)._cFormatFormula,r,e;u.isUndefined(f[n])||u.isUndefined(f[n][t])||(r=f[n][t][0].Formula,this._applyFormulaValues(r.referCell,r.cFColor,r.bgColor,"formularule",r.addr,i,e,r.applyCell))},_applyFormulaValues:function(n,i,r,u,f,e,o,s,h,c){var a=this.XLObj,v,l,g,w,pt,wt,it,ct=a.getSheet(e),b,k,nt,rt,p,bt=!0,kt=-1,lt,y=[],ut,d,tt,ft,et,ot,st,at,dt,gt,ht,vt,yt;if(v=t.isNullOrUndefined(o)&&t.isNullOrUndefined(f)?ct._selectedCells:t.isNullOrUndefined(f)?a._getMultiRangeCells(o):a._getMultiRangeCells(f),f=a._getAlphaRange(e,v[0].rowIndex,v[0].colIndex,v[v.length-1].rowIndex,v[v.length-1].colIndex),a.isUndefined(u))d=a._calcEngine,ht=new ValueChangedArgs(-1,-1,n),d.valueChanged(ct.sheetInfo.value,ht),n=d.getFormulaInfoTable().getItem("!"+(e-1)+"!-1").getFormulaValue()==="TRUE"?!0:!1,p=a._isBool(n)?n:!1,rt="formularule_"+u+"_"+n+"__"+i+"_"+r+"_"+f+"_"+a.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:s.rowIndex,colIndex:s.colIndex},rt,kt,p,bt,i,r);else{if(nt=["<=",">=","<",">","="],n.startsWith("=")&&(n=n.substr(1)),n.indexOf("==")>-1)return a._showAlertDlg("Alert","NewRuleAlert","",430),!0;for(l=0,w=nt.length;l<w;l++)n.indexOf(nt[l])>-1&&(y=n.split(nt[l]),ut=nt[l]);if(y.length||(y[0]=n),pt=y.slice(),h==="paste"){for(n="",l=0,w=y.length;l<w;l++)a._isvalidRange(y[l]+":"+y[l])&&(s=a._getMultiRangeCells(y[l]),vt=o[0]-c.rowIndex,yt=o[1]-c.colIndex,y[l]=a._getAlphaRange(e,s[0].rowIndex+vt,s[0].colIndex+yt,s[0].rowIndex+vt,s[0].colIndex+yt));n=w===2?y[0]+ut+y[1]:y[0]}for(wt=this._formulaCellRefer(y,v),l=0,w=v.length;l<w;l++){for(et=!1,ot=!1,st=!1,at=!1,ft=!1,b=v[l].rowIndex,k=v[l].colIndex,tt=this._formulaCellRange({rowIndex:b,colIndex:k},wt,pt,ut,e),it=tt.formula,d=a._calcEngine,ht=new ValueChangedArgs(-1,-1,it),d.valueChanged(ct.sheetInfo.value,ht),lt=d.getFormulaInfoTable().getItem("!"+(e-1)+"!-1").getFormulaValue()==="TRUE"?!0:!1,a._isBool(lt)?(p=lt,p&&(ft=!0,dt=b,gt=k,et=!0)):p=!1,n.indexOf("$")>=0&&(n.split("$").length===2?n.charAt(0)==="$"?(p&&v[l].rowIndex===v[0].rowIndex||v[l].rowIndex===dt)&&(ot=!0):(p&&v[l].colIndex===v[0].colIndex||v[l].colIndex===gt)&&(st=!0):at=!0),rt="formularule_"+ut+"_"+n+"/"+it+"__"+i+"_"+r+"_"+f+"_"+a.getActiveSheetIndex(),g=0;g<a.getObjectLength(tt)-1;g++)this._formulaCellUpdate({rowIndex:tt["referCell"+g].rowIndex,colIndex:tt["referCell"+g].colIndex},{rowIndex:b,colIndex:k},n,it,f,i,r,e);this._applyCFormatRule({rowIndex:b,colIndex:k},rt,kt,p,bt,i,r,ft,et,ot,st,at);p||ft||et||ot||st||!a._isRowViewable(e,b)||a.getCell(b,k,e).removeClass("e-redft e-yellowft e-greenft e-redf e-redt")}}},_formulaCellUpdate:function(n,t,i,r,u,f,e,o){var a=this.XLObj,c=a.getSheet(o)._cFormatFormula,s,l=n.rowIndex,h=n.colIndex;l in c?(s=c[l],h in s?s[h].push({Formula:{applyCell:t,formula:i,referCell:r,addr:u,cFColor:f,bgColor:e}}):(s[h]=[],s[h].push({Formula:{applyCell:t,formula:i,referCell:r,addr:u,cFColor:f,bgColor:e}}))):(s=c[l]={},s[h]=[],s[h].push({Formula:{applyCell:t,formula:i,referCell:r,addr:u,cFColor:f,bgColor:e}}))},_formulaCellRange:function(n,t,i,r,u){for(var y,p,e=this.XLObj,w=0,c,l=[],b=0,k=e.getObjectLength(t),o,s,h,a={},v={},f=0;f<k;f++)e._isObject(t["range"+f])?(s=n.rowIndex+t["range"+f].rowIndex,h=n.colIndex+t["range"+f].colIndex,a["range"+f]=e._getAlphaRange(u,s,h,s,h)):(s=n.rowIndex,h=n.colIndex,a["range"+f]=t["range"+f]),v["referCell"+f]={rowIndex:s,colIndex:h};for(c=0;c<i.length;c++){for(o=e.XLDragFill._parseFormula("="+i[c]),f=0,y=o.length;f<y;f++)e._isvalidRange(o[f]+":"+o[f])&&(o[f]=a["range"+w],w++);l[b]=o.join("");b++}return p=e.isUndefined(r)?"="+l[0]:"="+l[0]+r+l[1],v.formula=p,v},_formulaCellRefer:function(n,t){for(var f=this.XLObj,i,y,r,l=0,o,a=[],u,v,s,h,p={},c,e=0;e<n.length;e++)if(f.isFormula("="+n[e]))for(o=f.XLDragFill._parseFormula(n[e]),i=0,y=o.length;i<y;i++)f._isvalidRange(o[i]+":"+o[i])&&(a[l]=o[i],l++);else a[l]=n[e],l++;for(n=a,i=0;i<n.length;i++){if(u=n[i].startsWith("=")?n[i].split("=")[1]:n[i],v=u.split("$").length,f._isvalidRange(n[i]+":"+n[i])){f._isvalidRange(u+":"+u)&&(u.indexOf("$")<0?c="RCRefer":u.startsWith("$")&&v===3?c="CellRefer":u.startsWith("$")&&v===2?c="RRefer":!u.startsWith("$")&&u.indexOf("$")>-1&&(c="CRefer"));n[i].indexOf("$")>-1&&(n[i]=n[i].split("$").join(""));r=f._getMultiRangeCells(n[i]);switch(c){case"RCRefer":s=r[0].rowIndex-t[0].rowIndex;h=r[0].colIndex-t[0].colIndex;break;case"RRefer":s=r[0].rowIndex-t[0].rowIndex;h=r[0].colIndex-t[0].colIndex;break;case"CRefer":s=r[0].rowIndex-t[0].rowIndex;h=r[0].colIndex-t[0].colIndex;break;case"CellRefer":s=r[0].rowIndex-t[0].rowIndex;h=r[0].colIndex-t[0].colIndex}n[i]={rowIndex:s,colIndex:h}}p["range"+i]=n[i]}return p},_clearCFormula:function(n,t,i){var u=this.XLObj,f,o=[],a=[],v=0,c,r,s,h,p=u.XLEdit.getPropertyValue(n,t,"cFormatRule"),e,y,l=u.getSheet(i)._cFormatFormula;if(p&&p[0].split("_")[0]==="formularule"&&(f=p[0].split("_")[2].split("/")[1],f.startsWith("=")&&(f=f.substr(1)),u.isFormula("="+f))){for(y=["<=",">=","<",">","="],r=0,h=y.length;r<h;r++)f.indexOf(y[r])>-1&&(o=f.split(y[r]));for(o.length||(o[0]=f),r=0,h=o.length;r<h;r++)if(u.isFormula("="+o[r]))for(c=u.XLDragFill._parseFormula(o[r]),s=0;s<c.length;s++)u._isvalidRange(c[s]+":"+c[s])&&(a[v]=c[s],v++);else a[v]=o[r],v++;for(r=0,h=a.length;r<h;r++)e=u._getMultiRangeCells(a[r])[0],u.isUndefined(l[e.rowIndex])||(u.isUndefined(l[e.rowIndex][e.colIndex])||delete l[e.rowIndex][e.colIndex],u.getObjectLength(l[e.rowIndex])||delete l[e.rowIndex])}},_getGradient:function(n,i,r,u,f){if(t.isNullOrUndefined(u))return this._getLinear(i,r,n/f);var e=f/2;return n>=e?this._getLinear(r,u,Math.abs((n-e)/e)):this._getLinear(i,r,n/e)},_getLinear:function(n,t,i){var r=this._byteLinear(n[1]+n[2],t[1]+t[2],i),u=this._byteLinear(n[3]+n[4],t[3]+t[4],i),f=this._byteLinear(n[5]+n[6],t[5]+t[6],i);return"#"+r+u+f},_byteLinear:function(n,t,i){this.XLObj._browserDetails.name=="msie"&&this.XLObj._padStart();var r=parseInt(n,16)*(1-i)+parseInt(t,16)*i|0;return Math.abs(r).toString(16).padStart(2,"0")},_cFormat:function(n,i,r,u,f,e,o,s,h,c){var l=this.XLObj,w,v;if(l.model.allowConditionalFormats){f=l.isUndefined(f)?"":f;u=l.isUndefined(u)?"":u;l.showWaitingPopUp();o=o?o:l.getActiveSheetIndex();t.isNullOrUndefined(n)&&(n="lessthan");var y=l.getSheet(o),b=s?l._getRangeArgs(s,"object"):l._getRangeArgs(e,"object"),p={cFAction:n,input1:i,input2:r,cFColor:u,bgColor:f,sheetIndex:o,reqType:"cond-format",action:"add",range:e,data:b},a={cfAction:n,input1:i,input2:r,cfColor:u,bgColor:f,sheetIndex:o,reqType:"cond-format",type:"actionBegin",action:"add",range:s,addr:e,status:h,copyCell:c};if(n=a.cfAction,i=a.input1,r=a.input2,u=a.cfColor,f=a.bgColor,e=a.addr,s=a.range,h=a.status,c=a.copyCell,!l._trigActionBegin(a)){n=n.indexOf("databar")>-1?"databar":n.indexOf("colorscale")>-1?"colorscale":n.indexOf("iconset")>-1?"iconset":n;switch(n){case"greaterthan":this._applyGLEValues(">",i,u,f,n,e,o,s);break;case"greaterequalto":this._applyGLEValues(">=",i,u,f,n,e,o,s);break;case"lessthan":this._applyGLEValues("<",i,u,f,n,e,o,s);break;case"lessequalto":this._applyGLEValues("<=",i,u,f,n,e,o,s);break;case"equalto":this._applyGLEValues("==",i,u,f,n,e,o,s);break;case"notequalto":this._applyGLEValues("!=",i,u,f,n,e,o,s);break;case"between":this._applyBetweenValues("=",i,r,u,f,n,e,o,s);break;case"notbetween":this._applyBetweenValues("!",i,r,u,f,n,e,o,s);break;case"textcontains":this._applyContainsValues(i,u,f,n,e,o,s);break;case"dateoccur":this._applyDateContainsValues(i,u,f,n,e,o,s);break;case"formularule":i.indexOf("/")>-1&&(i=i.split("/")[1]);v=this._applyFormulaValues(i,u,f,n,e,o,s,w,h,c);break;case"databar":this._dataBarsFormatting(u,n,e,o,s,!1);break;case"colorscale":this._dataBarsFormatting(u,n,e,o,s,!1);break;case"iconset":this._dataBarsFormatting(u,n,e,o,s)}y._isImported&&!y._isLoaded||l._isUndoRedo||h==="paste"||l._dupDetails||l._isExport||v||(l._completeAction(p),l._trigActionComplete(p));l.hideWaitingPopUp()}}},_dataBarsFormatting:function(i,r,u,f,e,o){var s=this.XLObj,h,l,a,b=u?s._getRangeArgs(u,"object"):s._getRangeArgs(e,"object");h=s._getSelectedCells(f,b).selCells;var v=s.getSheet(f),y=v._startCell,p=v._endCell,w=i,c;for(l=0,a=h.length;l<a;l++)(rowIdx=h[l].rowIndex,colIdx=h[l].colIndex,s.XLEdit.getPropertyValue(rowIdx,colIdx,"isMHide")||s.XLEdit.getPropertyValue(rowIdx,colIdx,"isFilterHide"))||(value=this._getValueForCFormat({rowIndex:rowIdx,colIndex:colIdx},f),type=s.XLEdit.getPropertyValue(rowIdx,colIdx,"type")?s.XLEdit.getPropertyValue(rowIdx,colIdx,"type"):"general",prevStatus=!0,ruleIdx=-1,n.isNumeric(value)?(value=parseFloat(value),r=="databar"?c=this._applyDataBars(value,h,i,o,rowIdx,colIdx,f,type):r=="colorscale"?c=this._applyColorScale(value,h,w,rowIdx,colIdx,f,type):r=="iconset"&&(c=this._applyIconSets(value,h,rowIdx,colIdx,f,i,type))):!t.isNullOrUndefined(value)&&(s._isValidDate(value)||s._isValidTime(value))?((type=="time"||type=="datetime")&&(value=s.XLEdit.getPropertyValue(rowIdx,colIdx,"value")),r=="databar"?c=this._applyDataBars(s._dateToInt(value),h,i,o,rowIdx,colIdx,f,type):r=="colorscale"?c=this._applyColorScale(s._dateToInt(value),h,w,rowIdx,colIdx,f,type):r=="iconset"&&(c=this._applyIconSets(s._dateToInt(value),h,rowIdx,colIdx,f,i,type))):r=="databar"&&(c=this._applyDataBars(value,h,i,o,rowIdx,colIdx,f,type)),t.isNullOrUndefined(u)&&(u=s._generateHeaderText(y.colIndex+1)+(y.rowIndex+1)+":"+s._generateHeaderText(p.colIndex+1)+(p.rowIndex+1)),tRule=r+"____"+i+"__"+u+"_"+s.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:rowIdx,colIndex:colIdx},tRule,ruleIdx,!1,prevStatus,i,null,null,null,null,null,null,c))},_applyColorScale:function(n,i,r,u,f,e,o){var l=[],h,c=this.XLObj,y,a=this._getColor(r),v,b=c._calcEngine.getParseDecimalSeparator(),s,p,w;for(t.isNullOrUndefined(n)||(o=="time"||o=="datetime"?n=n.toString().split(b)[1]||n:(o=="shortdate"||o=="longdate"||o=="date")&&(n=Math.ceil(n))),s=0,p=i.length;s<p;s++)(h=c.XLEdit.getPropertyValue(i[s].rowIndex,i[s].colIndex,"value",e),h&&h.toString().startsWith("=")&&(h=c.XLEdit.getPropertyValue(i[s].rowIndex,i[s].colIndex,"calcValue",e)),t.isNullOrUndefined(h)||c.isNumber(h)||c._isDateTime(h))&&(v=c.XLEdit.getPropertyValue(i[s].rowIndex,i[s].colIndex,"type",e),(v=="shortdate"||v=="longdate"||v=="date")&&(h=Math.ceil(c._dateToInt(h))),(v=="time"||v=="datetime")&&(h=c._dateToInt(h).toString().split(b)[1]),t.isNullOrUndefined(h)||l.push(Number(h)));for(l=l.sort(c._dSortBehavior),s=0,p=l.length;s<l.length;s++)if(l[s]==n){y=s;break}return hexcode=y==0?a[0]:y==l.length-1?a[a.length-1]:l.length==3&&y==1?a[1]:this._getGradient(y,a[0],a[1],a[2],l.length),w=c.getCell(u,f),t.isNullOrUndefined(w)||(w[0].style.backgroundColor=hexcode),hexcode},_applyIconSets:function(n,i,r,u,f,e,o){var l=[],s,h=this.XLObj,v,p,w,k,d,a,g=h._calcEngine.getParseDecimalSeparator(),y,c,nt,b;if(e=e.split(","),y=h.getCell(r,u),!y||!y.find(".e-cf-databar").length){for(t.isNullOrUndefined(n)||(o=="time"||o=="datetime"?n=n.toString().split(g)[1]||n:(o=="shortdate"||o=="longdate"||o=="date")&&(n=Math.ceil(n))),c=0,nt=i.length;c<nt;c++)(s=h.XLEdit.getPropertyValue(i[c].rowIndex,i[c].colIndex,"value",f),s&&s.toString().startsWith("=")&&(s=h.XLEdit.getPropertyValue(i[c].rowIndex,i[c].colIndex,"calcValue",f)),t.isNullOrUndefined(s)||h.isNumber(s)||h._isDateTime(s))&&(a=h.XLEdit.getPropertyValue(i[c].rowIndex,i[c].colIndex,"type",f),(a=="shortdate"||a=="longdate"||a=="date")&&(s=Math.ceil(h._dateToInt(s))),(a=="time"||a=="datetime")&&(s=h._dateToInt(s).toString().split(g)[1]),t.isNullOrUndefined(s)||l.push(Number(s)));return l=l.sort(h._aSortBehavior),v=l[0],p=l[l.length-1],d=v+.67*(p-v),k=v+.33*(p-v),w="e-ss-"+(n>=d?e[0].trim():n>=k?e[1].trim():e[2].trim()),t.isNullOrUndefined(y)||(b=t.buildTag("span .e-icon","",{}),b.addClass("e-iconsetspan "+w),this._applyIconSetIcon({rowIndex:r,colIndex:u},b)),w}},_applyIconSetIcon:function(n,t){var i,r=this.XLObj,f=r.getActiveSheetIndex(),u=n.rowIndex,e=n.colIndex,o=r._isRowViewable(f,u);i=r.getCell(u,e,f);o&&(i[0].classList.contains("e-iconset")&&i.find(".e-iconset, .e-iconsetspan").remove(),i[0].insertBefore(t[0],i[0].childNodes[0]),i.addClass("e-iconset"));r.XLEdit.getPropertyValue(u,e,"wrap",f)&&(isWrap=!0,r.setWrapText("unwrap",r._getAlphaRange(f,u,e,u,e)))},_applyDataBars:function(n,i,r,u,f,e,o,s){var w=[],v=[],l,k,a=this.XLObj,d=a.model.rowHeight,b,rt=a._calcEngine.getParseDecimalSeparator(),g=0,ot=a.XLEdit.getPropertyValue(f,e,"value",o),p,ut,y,nt,h,c;for(t.isNullOrUndefined(n)||(s=="time"||s=="datetime"?n=n.toString().split(rt)[1]||n:(s=="shortdate"||s=="longdate"||s=="date")&&(n=Math.ceil(n))),p=0,ut=i.length;p<ut;p++)(l=a.XLEdit.getPropertyValue(i[p].rowIndex,i[p].colIndex,"value",o),l&&l.toString().startsWith("=")&&(l=a.XLEdit.getPropertyValue(i[p].rowIndex,i[p].colIndex,"calcValue",o)),t.isNullOrUndefined(l)||a.isNumber(l)||a._isDateTime(l))&&(k=a.XLEdit.getPropertyValue(i[p].rowIndex,i[p].colIndex,"type",o),(k=="shortdate"||k=="longdate"||k=="date")&&(l=Math.ceil(a._dateToInt(l))),(k=="time"||k=="datetime")&&(l=a._dateToInt(l).toString().split(rt)[1]),l&&l!=""&&(l>=0?w.push(Number(l)):v.push(Number(l))));if(posColor=this._getColor(r)[0],negColor=this._getColor("r")[0],w=w.sort(a._dSortBehavior),v=v.sort(a._aSortBehavior),v.length&&w.length)b=w[0]+Math.abs(v[0]),g=Math.abs(parseInt(v[0]/b*100).toFixed());else if(v.length||w.length)b=v.length?v[0]:w[0];else return;if(y=a.getCell(f,e),nt=a.element[0].id,y){if(y.find(".e-iconsetspan").length)return;(t.isNullOrUndefined(n)||n=="")&&y.find(".e-cf-databar").remove()}if(a.isNumber(n)){if(h={},c={},y&&(!y[0].children.length||y[0].children.length&&!y[0].children[0].classList.contains("e-databar"))){var tt=t.buildTag("div#"+nt+"_databar.e-cf-databar"),ft=t.buildTag("span#"+nt+"_leftspan.e-databar"),et=t.buildTag("span#"+nt+"_rightspan.e-databar"),it=t.buildTag("span#"+nt+"_dataspan.e-databar-value");h=et[0].style;c=ft[0].style;tt[0].appendChild(it[0]);tt[0].insertBefore(ft[0],it[0]);tt[0].insertBefore(et[0],it[0]);y[0].textContent="";y[0].appendChild(tt[0]);it[0].innerHTML=a.XLEdit.getPropertyValue(f,e,"value2",o)||"";tt[0].style.height=d-1+"px";it[0].style.fontSize="11pt"}v.length?w.length?n>-1?(c.width=g+"%",c.height=d-3+"px",c.backgroundColor="transparent",c.left="0px",h.width=""+Math.ceil(Math.abs(parseInt(n/b*100).toFixed()))+"%",h.height=d-3+"px",h.backgroundColor=r=posColor,h.left=g+"%",this._refreshDataBarCollection(f+""+e,{width:h.width,height:h.height,backgroundColor:h.backgroundColor,left:h.left},{width:c.width,height:c.height,backgroundColor:c.backgroundColor,left:c.left},this._dataBarStyle)):n<0&&(c.width=""+Math.ceil(Math.abs(parseInt(n/b*100).toFixed()))+"%",c.height=d-3+"px",c.backgroundColor=cFColors=negColor,c.width==g+"%"?c.left="0px":c.right=100-g+"%",this._refreshDataBarCollection(f+""+e,null,{width:c.width,height:c.height,backgroundColor:c.backgroundColor,left:c.left,right:c.right},this._dataBarStyle)):(h.width=""+Math.ceil(Math.abs(parseInt(n/b*100).toFixed()))+"%",h.height=d-3+"px",h.backgroundColor=r=negColor,h.left="0px",this._refreshDataBarCollection(f+""+e,{width:h.width,height:h.height,backgroundColor:h.backgroundColor,left:h.left},null,this._dataBarStyle)):(h.width=""+Math.ceil(Math.abs(parseInt(n/b*100).toFixed()))+"%",h.height=d-3+"px",h.backgroundColor=r=posColor,h.left="0px",this._refreshDataBarCollection(f+""+e,{width:h.width,height:h.height,backgroundColor:h.backgroundColor,left:h.left},null,this._dataBarStyle))}return r},_refreshDataBarCollection:function(n,t,i){var u=!1,r,f;if(this._dataBarStyle.length)for(r=0,f=this._dataBarStyle.length;r<f;r++)if(this._dataBarStyle[r].idx==n){t?this._dataBarStyle[r].rightStyle=t:delete this._dataBarStyle[r].rightStyle;i?this._dataBarStyle[r].leftStyle=i:delete this._dataBarStyle[r].leftStyle;u=!0;break}u||(t&&this._dataBarStyle.push({idx:n,rightStyle:t}),i&&this._dataBarStyle.push({idx:n,leftStyle:i}))},_getColor:function(n){var r,t,i,u;if(n=="lb")return["#008aef"];for(r=n.split(""),t=[],i=0,u=r.length;i<u;i++)switch(r[i].toLowerCase()){case"g":t.push("#63be7b");break;case"y":t.push("#ffeb84");break;case"r":t.push("#f8696b");break;case"w":t.push("#ffffff");break;case"b":t.push("#5a8ac6");break;case"o":t.push("#ffb628");break;case"lb":t.push("#008aef");break;case"p":t.push("#d6007b")}return t},clearCF:function(n){var i=this.XLObj,o,a,h,s,c;if(!i.model.isReadOnly){var r=i.getActiveSheetIndex(),u,f,e={sheetIndex:r,reqType:"cond-format",action:"clear",rule:[]},l=i.getSheet(r);if(i.model.allowConditionalFormats){for(h=i._dataContainer.cFormatData,e.selection=!i.isUndefined(n),n=n?i._getRangeArgs(n,"object"):[0,0,l.rowCount-1,l.colCount-1],s=i._getSelectedCells(r,n).selCells,o=0,a=s.length;o<a;o++)u=s[o].rowIndex,f=s[o].colIndex,t.isNullOrUndefined(i._dataContainer.sheets[r][u])||t.isNullOrUndefined(i._dataContainer.sheets[r][u][f])||t.isNullOrUndefined(i._dataContainer.sheets[r][u][f].cFormatRule)||(e.rule.push(this.getCFRule(u,f)),this._clearCFormula(u,f,r),i.clearRangeData([u,f,u,f],["cFormatRule"]));c=e.selection?"clear_"+r+"_"+i._getSelectedItems()[1]:"clear_"+r+"_entire";h.indexOf(c)===-1&&h.push(c);i._isUndoRedo||i._dupDetails||(i._completeAction(e),i._trigActionComplete(e))}}},_getValueForCFormat:function(n,i){var f=this.XLObj,r=n.rowIndex,u=n.colIndex,s=f.getRangeData({range:[r,u,r,u],sheetIdx:i}),e=f.XLEdit.getPropertyValue(r,u),o=f.XLEdit.getPropertyValue(r,u,"value2");return e=t.isNullOrUndefined(e)?"":e.toString(),(o&&typeof o=="string"&&!s.formatStr&&e[0]==="="||f.XLEdit.getPropertyValue(r,u,"type")==="datetime"||f.XLEdit.getPropertyValue(r,u,"type")==="shortdate"||f.XLEdit.getPropertyValue(r,u,"type")==="longdate"||f.XLEdit.getPropertyValue(r,u,"type")==="time")&&(e=o),e},_applyGLEValues:function(i,r,u,f,e,o,s,h){var a,tt,et,c=this.XLObj,l,d,y,p,v,ot,ut,st,it,rt=new RegExp(/[^.0-9]+/g),yt=new RegExp(/[^.-a-zA-Z 0-9]+/g),ht=c.getSheet(s),ct=ht._startCell,lt=ht._endCell,g,w=r,b,at,k=[],pt=h?c._getRangeArgs(h,"object"):c._getRangeArgs(o,"object"),vt,nt,ft;if(d=c._getSelectedCells(s,pt).selCells,w.startsWith("=")){for(w=w.substr(1),nt=["<=",">=","<",">","="],a=0,tt=nt.length;a<tt;a++)w.indexOf(nt[a])>-1&&(k=k.split(nt[a]),vt=nt[a]);k.length||(k[0]=w);at=this._formulaCellRefer(k,d)}for(a=0,tt=d.length;a<tt;a++)if(y=d[a].rowIndex,p=d[a].colIndex,r=r.replace(/^"|"$/g,""),r.startsWith("=")&&(ft=c._calcEngine,b=this._formulaCellRange({rowIndex:y,colIndex:p},at,k,vt,s),et=new ValueChangedArgs(-1,-1,b.formula),ft.valueChanged(c.getSheet(s).sheetInfo.value,et),r=ft.getFormulaInfoTable().getItem("!0!-1").getFormulaValue(),v=c._isBool(r)?r==="TRUE"?!0:!1:!1,t.isNullOrUndefined(r)&&(r="0")),!c.XLEdit.getPropertyValue(y,p,"isMHide")&&!c.XLEdit.getPropertyValue(y,p,"isFilterHide")){if(l=this._getValueForCFormat({rowIndex:y,colIndex:p},s),it=c.XLEdit.getPropertyValue(y,p,"type")?c.XLEdit.getPropertyValue(y,p,"type"):"general",ot=!0,st=-1,t.isNullOrUndefined(l)||!l.length&&e!="equalto"||r=="0")n.isNumeric(r)&&(v=r>0?e==="lessthan"||e==="lessequalto"||e==="notequalto":r<0?e==="greaterthan"||e==="greaterequalto"||e==="notequalto":e==="equalto"||e==="lessequalto"||e==="greaterequalto");else if(n.isNumeric(r))if(n.isNumeric(l))l=parseFloat(l),v=c.operators[i](l,parseFloat(r.replace(yt,"")));else if(c._isValidDate(l))v=c.operators[i](c._dateToInt(l),parseFloat(r));else if(c._isValidTime(l))continue;else v=c.operators[i](l.toLowerCase(),r.toLowerCase());else r.lastIndexOf("%")===r.length-1&&n.isNumeric(r.replace(rt,""))?v=it==="percentage"?c.operators[i](parseFloat(l),parseFloat(r.replace(rt,""))):n.isNumeric(l)?c.operators[i](parseFloat(l),0):c.operators[i](l.length,0):r.indexOf("$")===0&&n.isNumeric(r.replace(rt,""))?v=it==="accounting"||it!=="currency"||n.isNumeric(l)?c.operators[i](parseFloat(l),parseFloat(r.replace(rt,""))):(c.operators[i](l.length,0)||c._isValidDate(l))&&!c._isValidTime(l):c._isValidDate(r)?c._isValidDate(l)?v=c.operators[i](c._dateToInt(new Date(l)),c._dateToInt(new Date(r))):c._isValidTime(l)||(v=n.isNumeric(l)?c.operators[i](parseFloat(l),c._dateToInt(r)):c.operators[i](l.length,c._dateToInt(r))):v=c._isValidTime(r)?c._isValidTime(l)?c.operators[i](c.parse.parseTime(l),c.parse.parseTime(r)):n.isNumeric(l)?c.operators[i](parseFloat(l),0):c.operators[i](l.length,0):c.operators[i](l.toLowerCase(),r.toLowerCase());if(t.isNullOrUndefined(o)&&(o=c._generateHeaderText(ct.colIndex+1)+(ct.rowIndex+1)+":"+c._generateHeaderText(lt.colIndex+1)+(lt.rowIndex+1)),ut=e+"_"+i+"_"+r+"__"+u+"_"+f+"_"+o+"_"+c.getActiveSheetIndex(),w.startsWith("="))for(r=w.substr(1),ut=e+"_"+i+"_"+r+"__"+u+"_"+f+"_"+o+"_"+c.getActiveSheetIndex(),g=0;g<c.getObjectLength(b)-1;g++)this._formulaCellUpdate({rowIndex:b["referCell"+g].rowIndex,colIndex:b["referCell"+g].colIndex},{rowIndex:y,colIndex:p},r,b.formula,o,u,s);this._applyCFormatRule({rowIndex:y,colIndex:p},ut,st,v,ot,u,f)}},_applyBetweenValues:function(i,r,u,f,e,o,s,h,c){var p,w,l=this.XLObj,a,d,nt,v,tt,it,rt,b,y=new RegExp(/[^.0-9]+/g),g=new RegExp(/[^.-a-zA-Z 0-9]+/g),ht,ut=l.getSheet(h),ft=ut._startCell,et=ut._endCell,k,ot;for(l.operators["<"](l.isNumber(r)?parseFloat(r):r,l.isNumber(u)?parseFloat(u):u)||(nt=u,u=r,r=nt),d=t.isNullOrUndefined(c)&&t.isNullOrUndefined(s)?l.getSheet(h)._selectedCells:l._getSelectedCells(h,s).selCells,k=0,ot=d.length;k<ot;k++)if(p=d[k].rowIndex,w=d[k].colIndex,!l.XLEdit.getPropertyValue(p,w,"isMHide")&&!l.XLEdit.getPropertyValue(p,w,"isFilterHide")){if(a=this._getValueForCFormat({rowIndex:p,colIndex:w},h),b=l.XLEdit.getPropertyValue(p,w,"type")?l.XLEdit.getPropertyValue(p,w,"type"):"general",tt=!0,rt=-1,t.isNullOrUndefined(a)||!a.length)n.isNumeric(r)&&n.isNumeric(u)&&(v=r>0&&u>0||r<0&&u<0?o==="notbetween":o==="between");else if(n.isNumeric(r.replace(g,""))&&n.isNumeric(u.replace(g,""))&&b!=="percentage"&&b!=="currency"&&b!=="accounting")if(r=r.replace(g,""),u=u.replace(g,""),n.isNumeric(a))v=l.operators[i](parseFloat(a)>=parseFloat(r)&&parseFloat(a)<=parseFloat(u));else if(l._isValidDate(a))v=l.operators[i](l._dateToInt(a)>=parseFloat(r)&&ht<=parseFloat(u));else if(l._isValidTime(a))continue;else v=l.operators[i](a.toLowerCase()>=r.toLowerCase()&&a.toLowerCase()<=u.toLowerCase());else if(r.lastIndexOf("%")===r.length-1&&n.isNumeric(r.replace(y,""))&&u.lastIndexOf("%")===u.length-1&&n.isNumeric(u.replace(y,""))&&b==="percentage")v=l.operators[i](parseFloat(a)>=parseFloat(r.replace(y,""))&&parseFloat(a)<=parseFloat(u.replace(y,"")));else if(r.indexOf("$")===0&&n.isNumeric(r.replace(y,""))&&u.indexOf("$")===0&&n.isNumeric(u.replace(y,""))&&(b==="accounting"||b!=="currency"))v=l.operators[i](parseFloat(a)>=parseFloat(r.replace(y,""))&&parseFloat(a)<=parseFloat(u.replace(y,"")));else if(l._isValidDate(r)&&l._isValidDate(u)){var st=l._dateToInt(new Date(a)),ct=l._dateToInt(new Date(r)),lt=l._dateToInt(new Date(u));v=l.operators[i](st>=ct&&st<=lt)}else v=l._isValidTime(r)&&l._isValidTime(u)&&l._isValidTime(a)?l.operators[i](l.parse.parseTime(a)>=l.parse.parseTime(r)&&l.parse.parseTime(a)<=l.parse.parseTime(u)):n.isNumeric(a)?l.operators[i](parseFloat(a)>=parseFloat(r)&&parseFloat(a)<=parseFloat(u)):l.operators[i](a.toLowerCase()>=r.toLowerCase()&&a.toLowerCase()<=u.toLowerCase());t.isNullOrUndefined(s)&&(s=l._generateHeaderText(ft.colIndex+1)+(ft.rowIndex+1)+":"+l._generateHeaderText(et.colIndex+1)+(et.rowIndex+1));it=o+"_"+i+"_"+r+"_"+u+"_"+f+"_"+e+"_"+s+"_"+l.getActiveSheetIndex();this._applyCFormatRule({rowIndex:p,colIndex:w},it,rt,v,tt,f,e)}},_applyContainsValues:function(i,r,u,f,e,o,s){var a,v,h=this.XLObj,c,p,l,w,b,k,d=new RegExp(/[^.-a-zA-Z 0-9]+/g),g=h.getSheet(o),nt=g._startCell,tt=g._endCell,y,it;for(p=t.isNullOrUndefined(s)&&t.isNullOrUndefined(e)?h.getSheet(o)._selectedCells:h._getSelectedCells(o,e).selCells,y=0,it=p.length;y<it;y++)(a=p[y].rowIndex,v=p[y].colIndex,h.XLEdit.getPropertyValue(a,v,"isMHide")||h.XLEdit.getPropertyValue(a,v,"isFilterHide"))||(c=this._getValueForCFormat({rowIndex:a,colIndex:v},o),w=!0,k=-1,t.isNullOrUndefined(c)||!c.length?l=!1:n.isNumeric(i.replace(d,""))?(i=i.replace(d,""),h._isValidDate(c)&&(c=h._dateToInt(c).toString()),l=c.indexOf(i)>-1):h._isValidDate(i)?(h._isValidDate(c)&&(c=h._dateToInt(c).toString()),l=c.indexOf(h._dateToInt(i))>-1):h._isValidTime(i)?(h._isValidTime(c)&&(c=h._dateToInt("01/01/1990 "+c).toString()),l=c.indexOf(h._dateToInt("01/01/1990 "+i))>-1):l=c.toLowerCase().indexOf(i.toLowerCase())>-1,t.isNullOrUndefined(e)&&(e=h._generateHeaderText(nt.colIndex+1)+(nt.rowIndex+1)+":"+h._generateHeaderText(tt.colIndex+1)+(tt.rowIndex+1)),b=f+"__"+i+"__"+r+"_"+u+"_"+e+"_"+h.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:a,colIndex:v},b,k,l,w,r,u))},_applyDateContainsValues:function(n,i,r,u,f,e,o){var h,c,s=this.XLObj,a,y=!1,p,w,b=s.getSheet(e),k=b._startCell,d=b._endCell,v,l,g,nt,tt;for(v=t.isNullOrUndefined(o)&&t.isNullOrUndefined(f)?s.getSheet(e)._selectedCells:s._getSelectedCells(e,f).selCells,l=0,g=v.length;l<g;l++)(h=v[l].rowIndex,c=v[l].colIndex,s.XLEdit.getPropertyValue(h,c,"isMHide")||s.XLEdit.getPropertyValue(h,c,"isFilterHide"))||(a=this._getValueForCFormat({rowIndex:h,colIndex:c},e),w=-1,t.isNullOrUndefined(a)||!a.length?y=!1:s._isValidDate(n)&&(nt=new Date(a),tt=new Date(n),y=nt-tt==0),t.isNullOrUndefined(f)&&(f=s._generateHeaderText(k.colIndex+1)+(k.rowIndex+1)+":"+s._generateHeaderText(d.colIndex+1)+(d.rowIndex+1)),p=u+"__"+n+"__"+i+"_"+r+"_"+f+"_"+s.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:h,colIndex:c},p,w,y,!0,i,r))},refreshCFormat:function(n){var t=this.XLObj,v=t._dupDetails,f,i,o,c,u,s,r,a,l,e,h;if(!t.model.isReadOnly&&(t._dupDetails=!0,t.model.allowConditionalFormats)){for(o=[],c=t.getActiveSheetIndex(),s=t._getSelectedCells(c,n).selCells,f=0,a=s.length;f<a;f++){if(e=s[f].rowIndex,h=s[f].colIndex,r=t.XLEdit.getPropertyValue(e,h,"cFormatRule"),!t.isUndefined(r)&&r.length)for(i=0,l=r.length;i<l;i++)r[i]=r[i].replace("_true","").replace("_false",""),o.indexOf(r[i])<0&&o.push(r[i]);t._isRowViewable(c,e)&&t.getCell(e,h,c).removeClass("e-redft e-yellowft e-greenft e-redf e-redt");t.clearRangeData([e,h,e,h],["cFormatRule"],s[f])}for(i=0,l=o.length;i<l;i++)u=o[i].split("_"),this._cFormat(u[0],u[2],u[3],u[4],u[5],u[6]);t._dupDetails=v}},_applyColors:function(n,t,i,r){n.length&&t.indexOf(n)>-1?i&&i.removeClass(t).addClass("e-"+n):(n.length&&t.indexOf(n)<0&&i&&i.removeClass(t).css({color:n}).addClass("e-cformat"),r.length&&t.indexOf(r)<0&&i&&(i.removeClass(t).css({"background-color":r}),i.hasClass("e-cformat")||i.addClass("e-cformat")))},_applyCFormatRule:function(n,t,i,r,u,f,e,o,s,h,c,l,a){var y=this.XLObj,nt=y.getActiveSheetIndex(),w=n.rowIndex,b=n.colIndex,tt,p,v=y.XLEdit.getPropertyValue(w,b,"cFormatRule"),k,it,ut=!0,d="e-redft e-yellowft e-greenft e-redf e-redt",g,ft;if(this._getRuleIndex(t+"_true",v)>-1&&(i=this._getRuleIndex(t+"_true",v)),this._getRuleIndex(t+"_false",v)>-1&&(i=this._getRuleIndex(t+"_false",v)),i>-1&&(k=v[i],it=y._dataContainer.cFormatData.indexOf(this._updateCFormatRule(k,r)),it>-1?y._dataContainer.sheets[nt][w][b].cFormatRule[i]=it:(y._dataContainer.cFormatData.push(this._updateCFormatRule(k,r)),y._dataContainer.sheets[nt][w][b].cFormatRule[i]=y._dataContainer.cFormatData.length-1)),v=y.XLEdit.getPropertyValue(w,b,"cFormatRule"),y._isRowViewable(nt,w)&&(tt=!0,p=y.getCell(w,b)),!y.isUndefined(v)&&v.length>0&&v.indexOf("databar")<0&&(!(t+"_true"===v[i]||t+"_false"===v[i])||v.length>1)){for(g=0,ft=v.length;g<ft;g++)k=v[g].split("_");tt&&(r||o||s||h||c||l?(r=!0,this._applyColors(f,d,p,e)):p&&p.removeClass(d))}else tt&&(r||o||s||h||c||l?(r=!0,this._applyColors(f,d,p,e)):p&&p.removeClass(d));if(v&&v.length){var et=y.getRangeIndices(t.split("_")[6]),ot=y.getRangeIndices(v[0].split("_")[6]),rt=t.split("_");rt.splice(6,1);rt.splice(5,1);v[0].indexOf(rt.join("_"))>-1&&y.inRange(ot,et[0],et[1])&&(ut=!1)}ut&&this._getRuleIndex(t+"_true",v)<0&&this._getRuleIndex(t+"_false",v)<0&&(v=y.isUndefined(a)?t+"_"+r:t+"_"+r+"_"+a,y.XLEdit._updateDataContainer(n,{dataObj:{cFormatRule:[v]},skipCell:!r}))}}}(jQuery,Syncfusion),function(n,t,i){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.clipboard=function(n){this.XLObj=n;this._cutCells=[];this._copyCells=[];this._copyBackup={};this._cData="";this._isCut=!1;this._copyRange=[];this._isSpecial=!n.isPasteValuesOnly;this._isShape=!1;this._copyRnge={};this._highLightRange=[]};t.spreadsheetFeatures.clipboard.prototype={copy:function(){this._triggerKeyDown(67,!0)},cut:function(){this.XLObj.model.isReadOnly||this._triggerKeyDown(88,!0)},paste:function(){this.XLObj.model.isReadOnly||this._triggerKeyDown(86,!0)},_initCopyPaste:function(){var i=this.XLObj._id,r=t.buildTag("div",{},{position:"fixed",top:-1e3,left:-1e3},{id:i+"_copyPaste"});n("body").append(r);r.append(t.buildTag("textarea ."+i+"_copyTxt",{},{width:1,height:1,overflow:"hidden",opacity:0,resize:"none",cursor:"default"},{id:i+"_hiddenTxt"}))},_copyPasteHandler:function(t){var e,i=this.XLObj,f=i.getActiveSheetIndex(),r=i.getSheet(f),u,o=navigator.platform.toLowerCase().indexOf("mac")>-1,s;if(s=o?n("#"+i._id+"_hiddenTxt").val()===""&&i._browserDetails.name==="chrome"?900:10:0,i._isUndoRedo=!1,!i.model.allowEditing&&(t.keyCode===88||t.keyCode===86))return!1;if((t.keyCode===67||t.keyCode===88||t.keyCode===86)&&i._preventctrlkey){i._showAlertDlg("Alert","CtrlKeyErrorAlert","CtrlKeyErrorAction",450);return}if(t.ctrlKey){if(t.keyCode===67){if(u={reqType:"copy",startcell:r._startCell,endcell:r._endCell,selectedCells:r._selectedCells},i._trigActionBegin(u))return!1;this._getClipboard(t);this._cutCells=[];n.extend(!0,this._copyCells,r._selectedCells);this._copyCells.length||(this._copyCells=[i.XLShape._picCellIdx]);setTimeout(function(){i._setSheetFocus()},0)}else if(t.keyCode===88){if(e=r._selectedCells,i.model.allowLockCell&&r.isSheetProtected&&i._isPropExists([r.selectedRange],"isLocked",f))return;if(e.length&&i._isPropExists([r.selectedRange],"isReadOnly",f))return;if(u={reqType:"cut",startcell:r._startCell,endcell:r._endCell,selectedCells:r._selectedCells},i._trigActionBegin(u))return!1;e.length&&i._isPropExists([r.selectedRange],"rule",f)&&i.getRange(r.selectedRange,f).removeClass("e-hlcell");this._copyCells=[];n.extend(!0,this._cutCells,e);this._cutCells.length||(this._cutCells=[i.XLShape._picCellIdx]);this._getClipboard(t);setTimeout(function(){i._setSheetFocus()},0)}else if(t.keyCode===86){if(u={reqType:"paste",isCopy:!this._cutCells.length,isShape:this._isShape,activecell:r._activeCell},this._isShape||(u.cRange=this._copyRange),i._trigActionBegin(u))return;if(i.isUndefined(t.bubbles)||(this._isSpecial=!i.isPasteValuesOnly),this._cData.length||this._copyBackup.elem)n("#"+i._id+"_hiddenTxt").val(this._cData).select();else if(t.originalEvent||o)n("#"+i._id+"_hiddenTxt").select();else{n("#"+i._id+"_hiddenTxt").val("");i._showAlertDlg("Alert",["ClipboardAccessError","Cut","Copy","Paste"],"ClipboardAccessError",450);return}setTimeout(function(){i.XLClipboard._setClipboard()},s)}}else t.keyCode===27&&i.element.find(".e-cdata").length&&(i.element.find("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),n("#"+i._id+"_hiddenTxt").val(""),this._cData="",this._copyCells=[])},_triggerKeyDown:function(t,i){var u=this.XLObj,r;u._setSheetFocus();r=n.Event("keydown");r.keyCode=t;r.ctrlKey=i;n("#"+u._id).trigger(r)},_getClipboard:function(t){var u,i=this.XLObj,f=i.getActiveSheetIndex(),s=i.getSheet(f),h=s._startCell,c=s._endCell,r=i._getContent(f).find(".e-selected"),l=i.getActiveCellElem(f)[0],e,o;if(i.model.allowClipboard)for(i.XLClipboard._copyBackup.cells||!i.model.showRibbon||i.model.isReadOnly||(i.XLRibbon._enableButtons(["Home_Clipboard_Paste"],"ejButton"),i.XLRibbon._enableButtons(["Home_Clipboard_PasteOptions"],"ejSplitButton")),r.length?(this._copyBackup={cells:[],border:i.model.allowCellFormatting&&i.XLFormat.getHashCodeClassAsArray(),table:[],filterRange:[]},o=this._getSelectedData(h,c),i.element.find(".e-cdata").length&&i.element.find("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),n(r).addClass("e-cdata"),i.XLSelection._focusBorder(h,c,i._cutFocus),this._cData=r.length<2&&!o.length?o=" ":o,this._isCut=!1,n("#"+i._id+"_hiddenTxt").val(o).select(),navigator.platform.toLowerCase().indexOf("mac")>-1&&document.execCommand("copy"),this._copyBackup.actCellPos={top:l.offsetTop,left:l.offsetLeft},t.keyCode==67&&(this._copyBackup.copypaste=!0),this._isShape=!1):(this._isShape=!0,this._copyBackup={elem:i.getSheetElement(f).find(".e-ss-activeimg"),isCut:t.keyCode===88,sIdx:f}),u=0;u<r.length;u++)e=i.XLEdit.getPropertyValue(i._getCellIdx(r[u]).rowIndex,i._getCellIdx(r[u]).colIndex,"formulaRange"),e&&(this._copyRnge[e]?this._copyRnge[e].push({rowIdx:i._getCellIdx(r[u]).rowIndex,colIdx:i._getCellIdx(r[u]).colIndex}):this._copyRnge[e]=[{rowIdx:i._getCellIdx(r[u]).rowIndex,colIdx:i._getCellIdx(r[u]).colIndex}])},_getSelectedData:function(t,i){var f,u=this.XLObj,c="",e,r,s,l=u.getActiveSheetIndex(),p,h,d,y;for(t.rowIndex>=i.rowIndex&&(p=t,t=i,i=p),this._copyRange=[],this._copyRange.push(u.getActiveSheetIndex()),this._copyRange.push(u._getSelectedItems()[1]),e=t.rowIndex;e<=i.rowIndex;e++)if(e!==t.rowIndex&&(c+="\n"),t.colIndex<=i.colIndex)for(r=t.colIndex;r<=i.colIndex;r++)f=u.getRangeData({range:[e,r,e,r],property:["type","value","value2"]})[0],s=u.getObjectLength(f)?f.type!=="general"?f.value2:f.value:"",this._updateCBackupData(e,r),c+=r!==i.colIndex?s+"\t":s;else for(r=i.colIndex;r<=t.colIndex;r++)f=u.getRangeData({range:[e,r,e,r],property:["type","value","value2"]})[0],s=u.getObjectLength(f)?f.type!=="general"?f.value2:f.value:"",this._updateCBackupData(e,r),c+=r!==t.colIndex?s+"\t":s;var w=u.model.sheets[l].tableManager,a,o,v,b=[],k=u.model.sheets[l].selectedRange;for(a=u.getObjectKeys(w),h=0,d=a.length;h<=d;h++)if(o=n.extend(!0,{},w[a[h]]),u.getObjectLength(o)&&(v=o.range,this._compareRange(k,v))){b.push(o.name);o.header=!0;o.tblId=a[h];this._copyBackup.table.push({tblName:b,tblObj:o,range:v,sheetIdx:l});break}return y=u.getRangeIndices(u.model.sheets[l].filterSettings.range),this._compareRange(k,y)&&(this._copyBackup.filterRange=y),c},_updateCBackupData:function(t,i){var e=this.XLObj,o=e.getActiveSheetIndex(),u,f=e._dataContainer.sheets[o],r;t in f&&i in f[t]?(r=n.extend(!0,{},f[t][i]),u=r.format?r.format:""):(r={},u="");this._copyBackup.cells.push({cell:r,format:u})},_setClipboard:function(){var r=this.XLObj,lr,ef,at,wt,iu,ar,ki,e,s,of,ur,sf,vr,di,fr,hf,yr,ri,ru,uu,bt,er,pr,yt,gi,fu,eu,cu,ot,kt,ui,wr,cf,lf,lu,br,au,vu,or;if(!r.model.isReadOnly){r._isCopyPaste=!0;var tt,nr,st,tr,g,dt,yu,pu,gt,f,vt,ht=[],v=[],et,wu=new RegExp("\\be-format.*?\\b","g"),k,fi=!1,hi=!1,d,u=r.getActiveSheetIndex(),bu={cSheetIndex:this._copyRange[0],pSheetIndex:u,sheetIndex:u,reqType:this._copyBackup.isCut?"cut-paste":"copy-paste",type:"actionBegin",action:this._copyBackup.isCut?"cut-paste":"copy-paste",copyRange:this._copyRange[1]},c,ci=[];if(!r._trigActionBegin(bu)){c={cSheetIndex:this._copyRange[0],pSheetIndex:u,sheetIndex:u,isHighlightData:!1};var li=r.getSheet(u)._startCell,ai=r.getSheet(u)._endCell,y,it,ct=0,h,rt,vi,yi,ut,l={},nt,kr,ei,ku=new RegExp("\\be-shapebdr.*?\\b","g"),du=["solid","dashed","dotted"],p=li.rowIndex<ai.rowIndex?li.rowIndex:ai.rowIndex,dr,ir,pi=this._copyBackup.table,ni,sr,hr,b=li.colIndex<ai.colIndex?li.colIndex:ai.colIndex,a=r._dataContainer,o,ti,gr,nu,oi,ii=this._copyCells.length,pt=this._cutCells.length,gu,nf;if(r.isPasteValuesOnly&&(this._isSpecial=!1),this._copyRange.length){if(vt=r.swapRange(r.getRangeIndices(this._copyRange[1])),oi=r._getSelectedRange({rowIndex:vt[0],colIndex:vt[1]},{rowIndex:vt[2],colIndex:vt[3]}),st=[p,b,p+(vt[2]-vt[0]),b+(vt[3]-vt[1])],nu=r._getSelectedRange({rowIndex:st[0],colIndex:st[1]},{rowIndex:st[2],colIndex:st[3]}),r.model.allowLockCell&&r.getSheet(u).isSheetProtected&&r._isPropExists([st],"isLocked",u))return;if(r._isPropExists([st],"isReadOnly",u))return}if(p===0&&b===0&&ii===this.XLObj.model.rowCount*this.XLObj.model.columnCount||ii!==this.XLObj.model.rowCount*this.XLObj.model.columnCount){var tf,rr=r.model.sheets[u],rf=r.model.sheets[this._copyBackup.sIdx],wi=r.getSheetElement(u).find(".e-activecell"),lt=r.getSheet(this._copyBackup.sIdx||this._copyRange[0]||u).shapeMngr,bi,ft,cr,uf,ff,tu,w=this._copyRange[0];if(this._isShape){if(!this._isSpecial)return!1;at=r.XLShape._picCellIdx;wt=r.getActiveCell(u);nt=this._copyBackup.elem;lr=nt[0].id;et=lr.indexOf("picture")>-1?"picture":"chart";c={sheetIndex:u,cSheetIndex:this._copyBackup.sIdx,pSheetIndex:u,operation:"shape",cShapeId:lr,reqType:this._copyBackup.isCut?"cut-paste":"copy-paste"};f=n.extend(!0,{},a.sheets[this._copyBackup.sIdx][at.rowIndex][at.colIndex]);v=r.getCell(wt.rowIndex,wt.colIndex);n.extend(!0,l,lt[et][lr]);c.cutCell={rowIndex:at.rowIndex,colIndex:at.colIndex,obj:f,shapeObj:n.extend(!0,{},l)};nt=r.element.find("#"+l.id);et==="picture"?(ft=nt[0].className,ft.indexOf("e-shapebdr")>-1?(ft=nt[0].className.match(ku)[0],ni=ft.replace("e-shapebdr","").split("N"),sr=ni[2],r.XLShape._createPicture(u,wt,lt.sharedPics[l.data],v[0].offsetTop,v[0].offsetLeft,l.width,l.height,null,"#"+sr,du[parseInt(ni[1])-1],ni[0]+"px"),r.model.showRibbon&&r.XLRibbon._formatTabUpdate()):(r.XLShape._createPicture(u,wt,lt.sharedPics[l.data],v[0].offsetTop,v[0].offsetLeft,l.width,l.height),r.model.showRibbon&&r.XLRibbon._formatTabUpdate())):(l.isChartSeries||(o=l.range,o=r._getAlphaRange(u,o[0],o[1],o[2],o[3]),o.indexOf(":")===-1&&(o=o+":"+o)),l.top=v[0].offsetTop,l.left=v[0].offsetLeft,r.XLChart.createChart(l.isChartSeries?null:o,n.extend(!0,{},l)));this._isShape=this._copyBackup.isCut?!1:!0;this._cutCells=[];r._isUndoRedo||(f=n.extend(!0,{},a.sheets[u][wt.rowIndex][wt.colIndex]),l=n.extend(!0,{},rr.shapeMngr[et][f[et][0]]),c.pShapeId=f[et][0],c.pasteCell={rowIndex:wt.rowIndex,colIndex:wt.colIndex,obj:f,shapeObj:l},g={sheetIndex:c.sheetIndex,cutCell:c.cutCell,pasteSheetIndex:c.pSheetIndex,operation:c.operation,reqType:c.reqType,pasteShapeId:c.pShapeId,pasteCell:c.pasteCell},g.reqType==="cut-paste"?(g.cutSheetIndex=c.cSheetIndex,g.cutShapeId=c.cShapeId):(g.copySheetIndex=c.cSheetIndex,g.copyshapeId=c.cShapeId),r._completeAction(c),r._trigActionComplete(g),this._copyBackup.isCut&&(f=n.extend(!0,{},a.sheets[this._copyBackup.sIdx][at.rowIndex][at.colIndex]),f[et].some(function(n,t){return nt[0].id===rf.shapeMngr[et][f[et][t]].id?(tf=t,!0):!1}),Object.keys(f).length<2&&f[et].length<2?(delete a.sheets[this._copyBackup.sIdx][at.rowIndex][at.colIndex],r.getObjectLength(a.sheets[this._copyBackup.sIdx][at.rowIndex])<1&&delete a.sheets[this._copyBackup.sIdx][at.rowIndex]):f[et].length<2?delete f[et]:f[et].splice(tf,1),delete rf.shapeMngr[et][c.cShapeId]));this._copyBackup.isCut&&nt.remove()}else{if(fi=this._cData===n("#"+r._id+"_hiddenTxt").val()&&this._copyRange.length>0,fi){if(r.model.allowLockCell&&r.getSheet(u).isSheetProtected&&r._isPropExists([st],"isLocked",u))return;if(r._isPropExists([st],"isReadOnly",u))return}if(c.reqType=pt>0?"cut-paste":"copy-paste",r.element.find(".e-selected").hasClass("e-readonly")){r.element.find(".e-cdata").length&&r.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom");return}if(c.text=ht=n("#"+r._id+"_hiddenTxt").val().length?n("#"+r._id+"_hiddenTxt").val().split("\n"):[],this._cData.length<1&&c.text.length<1)return;if(fi||ht[ht.length-1]!==""||ht.splice(ht.length-1,1),iu=[],fi?(c.isSpecial=this._isSpecial,o=r.getRangeIndices(this._copyRange[1]),r.setActiveSheetIndex(this._copyRange[0]),c.cutBorder={range:o,prevBorder:r.model.allowCellFormatting&&r.XLFormat.getHashCodeClassAsArray(o)},r.setActiveSheetIndex(u)):c.isSpecial=!1,c.reqType=="cut-paste")for(gu=r.getObjectKeys(this._copyRnge),nf=r.XLEdit.getPropertyValue(oi[0].rowIndex,oi[0].colIndex,"hasMultipleFormulaArray"),ur=0;ur<gu.length;ur++)if(pt==1&&nf&&(ef=r.XLEdit.getPropertyValue(this._cutCells[ur].rowIndex,this._cutCells[ur].colIndex,"hasFormulaArray"),ef)){r._showAlertDlg("Alert","ArrayaFormula",430);this._copyRnge={};return}if(pt){for(tu=[],w=this._copyRange[0],pi.length||this._cutPasteBorder(vt,st),y=0;y<pt;y++){if(e=this._cutCells[y].rowIndex,s=this._cutCells[y].colIndex,k=r.getCell(e,s,w),v={rowIndex:e,colIndex:s,prevObj:{},newObj:{},shapes:[]},t.isNullOrUndefined(a.sheets[w][e])?v.prevObj={}:n.extend(!0,v.prevObj,a.sheets[w][e][s]),f=t.isNullOrUndefined(a.sheets[w][e])?{}:n.extend(!0,{},a.sheets[w][e][s]),k&&k[0]){if("cFormatRule"in f)for(yi=n.extend(!0,[],f.cFormatRule),f.cFormatRule=[],h=0,rt=yi.length;h<rt;h++)if(ut=r._dataContainer.cFormatData[yi[h]].split("_"),ut[0]==="databar"||ut[0]==="iconsets"||ut[0]==="colorscale")return;if("merge"in v.prevObj||(r.XLEdit._updateCellValue({rowIndex:e,colIndex:s},"","",w),r._refreshRowHeight(w,e)),"wrap"in f&&(vi=r._generateHeaderText(s+1)+(e+1),r._dupDetails=!0,r.setActiveSheetIndex(w),r.setWrapText("unwrap",vi+":"+vi),r.setActiveSheetIndex(u),r._dupDetails=!1),"cellType"in f&&r.model.allowCellType&&r.XLCellType._removeControls(e,s,w,!0),r.model.allowSparkline&&"sparkline"in f&&(gr=r.XLEdit.getPropertyValue(e,s,"sparkline",w),v.prevSparklineProp=n.extend(!0,{},r.getSheet(w).shapeMngr.sparkline[gr]),this._copyBackup.sparkline||(this._copyBackup.sparkline={}),this._copyBackup.sparkline[gr]=v.prevSparklineProp,r.XLSparkline._removeSparklineElem(e,s,w)),k.removeClass("e-hyperlinks e-redft e-yellowft e-greenft e-redf e-redt"),k.find("a").remove(),k.hasClass("e-commentcell")&&r.XLComment.deleteComment([e,s,e,s],w),r.model.allowCellFormatting&&!r.XLRibbon._isDirtySelect)if(hi=r._checkTableRange(r._getRangeArgs(o,"string")).status=="partial",pi.length)for(h=0,rt=pi.length;h<rt;h++)r.XLFormat.removeStyle(o,{cellStyle:!0,tableStyle:!0,format:!0,border:!0,sheetIdx:pi[h].sheetIdx});else hi||r.XLFormat.removeStyle(o,{cellStyle:!0,tableStyle:!0,format:!0});e in a.sheets[w]&&s in a.sheets[w][e]&&(hi?r.XLEdit._clearDataContainer({cellIdx:{rowIndex:e,colIndex:s},sheetIdx:w,property:["value","value2","type","cFormatRule","thousandSeparator","rule","calcValue","align","hyperlink","comment","decimalPlaces","formatStr"]}):(delete a.sheets[w][e][s],r._textClip(e,s,"delete")));k[0].className.match(wu)&&r._checkTableRange(r._getRangeArgs(o,"string")).status!="partial"&&(k[0].className=k[0].className.replace(wu,""));t.isNullOrUndefined(a.sheets[w][e])?v.newObj={}:n.extend(!0,v.newObj,a.sheets[w][e][s]);r._setRowHdrHeight(w,r._getCellIdx(k[0]).rowIndex)}else r.getObjectLength(f)&&(gt=r.getObjectKeys(f),hi=r._checkTableRange(r._getRangeArgs(o,"string")).status=="partial",hi&&(gt.splice(gt.indexOf("tableName"),1),gt.splice(gt.indexOf("tformats"),1),gt.splice(gt.indexOf("format"),1)),r.clearRangeData([e,s,e,s],gt),r.model.allowCellType&&"cellType"in f&&delete a.sheetCellType[a.sheets[w][e][s].cellType]);tu.push(v)}for(h=0,rt=pi.length;h<rt;h++)sf=r.getActiveSheetIndex(),r.gotoPage(w,!1),dr=n.trim(pi[h].tblName),r.XLFormat.removeTable(r._getTableID(null,dr,w)),r.gotoPage(sf,!1);r.model.allowCellFormatting&&!hi&&r.XLFormat.removeStyle(o,{cellStyle:!0,tableStyle:!0,format:!0});r.setActiveSheetIndex(w);r.setActiveSheetIndex(u);c.cutCells=tu;c.cfat={table:dr,range:o};ff=!0;r.element.find(".e-cdata").length&&r.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom")}else{if(vr=[],this._isSpecial)for(y=0;y<ii;y++)e=this._copyCells[y].rowIndex,s=this._copyCells[y].colIndex,v={rowIndex:e,colIndex:s,prevObj:{},newObj:{}},t.isNullOrUndefined(a.sheets[u][e])||n.extend(!0,v.prevObj,a.sheets[u][e][s]),vr.push(v);else vr=this._copyCells;c.cutCells=vr}if(ht.length?bi=[p,b,p+ht.length-1,b+ht[0].split("\t").length-1]:(bi=[p,b,p,b],y=it=1),c.pasteBorder={range:bi,prevBorder:r.model.allowCellFormatting&&r.XLFormat.getHashCodeClassAsArray(bi)},ii)for(yr=[],r.isPasteValuesOnly||r.XLFormat.removeStyle(st,{border:!0,cellStyle:!0,format:!0}),di=0,hf=nu.length;di<hf;di++)fr=nu[di],e=oi[di].rowIndex,s=oi[di].colIndex,yr=r.XLEdit.getPropertyValue(e,s,"borders",this._copyRange[0]),r.isUndefined(yr)||r.XLFormat.applyBorder(yr,[fr.rowIndex,fr.colIndex,fr.rowIndex,fr.colIndex]);for(yu=r._getContTBody(u).find("rows"),y=0,cr=ht.length;y<cr;y++){for(v=ht[y].split("\t"),it=0,uf=v.length;it<uf;it++){if(k=yu[r._getRowIdx(p+y)]?r.getCell(p+y,b+it)[0]:i,t.isNullOrUndefined(k)?(rr.colCount<=b+it?r.XLScroll._createNewColumn(u,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"insert"):r.model.scrollSettings.allowScrolling&&!r.model.scrollSettings.allowVirtualScrolling&&r.XLScroll._createNewRow(u,-1,-1,"insert"),r.XLScroll._refreshScroller(u,"refresh","all"),k=r.getCell(p+y,b+it)):k=n(k),k.find(".e-cf-databar").remove(),d={rowIndex:p+y,colIndex:b+it},d.prevObj=t.isNullOrUndefined(a.sheets[u][p+y])?{}:n.extend(!0,{},a.sheets[u][p+y][b+it]),t.isNullOrUndefined(d.prevObj)||(delete d.prevObj.isMHide,delete d.prevObj.mergeIdx,t.isNullOrUndefined(d.prevObj.cellType)||(d.prevObj.cTypeObj=a.sheetCellType[d.prevObj.cellType])),this._isCut&&fi)return;if(tt={rowIndex:p+y,colIndex:b+it},this._isSpecial&&fi)if(e=tt.rowIndex,s=tt.colIndex,of=oi[ct].rowIndex,ft=r._dataContainer.hashCode[this._copyBackup.cells[ct].format],"merge"in this._copyBackup.cells[ct].cell||t.isNullOrUndefined(ft)||r.addClass(k,ft),f=n.extend(!0,{},this._copyBackup.cells[ct].cell),e in a.sheets[u]||(a.sheets[u][e]={}),s in a.sheets[u][e]?"comment"in a.sheets[u][e][s]&&r.getCell(e,s).removeClass("e-commentcell"):a.sheets[u][e][s]={},f){if(ri=n.extend(!0,{},r.XLEdit.getPropertyValue(e,s,"merge")),ru=r.XLEdit.getPropertyValue(e,s,"isMHide"),uu=n.extend(!0,{},r.XLEdit.getPropertyValue(e,s,"mergeIdx")),delete f.overflow,delete f.isOverflow,delete f.tableName,delete f.isReadOnly,delete f.isLocked,"wrap"in f&&(f.wrap=""),n.extend(!0,a.sheets[u][e][s],f),bt=a.sheets[u][e][s],r.getObjectLength(ri)?bt.merge=ri:delete bt.merge,r.getObjectLength(uu)?bt.mergeIdx=uu:delete bt.mergeIdx,r.isUndefined(ru)?delete bt.isMHide:bt.isMHide=ru,r.XLEdit.getPropertyValue(e,s,"value2")&&(r._textClip(e,s,"delete"),r._textClip(e,s,"add")),ki=f.value2&&typeof f.value2=="string"&&!f.formatStr?a.sharedData[f.value][0]==="="?a.sharedData[f.value]:f.value2:a.sharedData[f.value],f.type===3&&(ki=this._getUpdatedCellFormula(ki,this._copyCells[ct],{rowIdx:e,colIdx:s})),!("merge"in f)){if(r._dupDetails=!0,er={cellIndex:tt,value:ki,prevValue:r._getCellValue(tt.rowIndex,tt.colIndex).value,sheetIdx:u,reqType:"paste"},r._trigger("cellSave",er))return;r._saveTriggered=!0;r.XLEdit._updateCellValue(er.cellIndex,er.value,null,null,f.cellType);r._saveTriggered=!1;r._dupDetails=!1;nr=r.XLEdit.getPropertyValue(of,0,c.reqType==="copy-paste"?"cHeight":"pHeight",this._copyRange[0]);r.isUndefined(nr)||(r.XLEdit._updateDataContainer({rowIndex:er.cellIndex.rowIndex,colIndex:0},{dataObj:{pHeight:r.getSheet(u).rowsHeightCollection[tt.rowIndex],cHeight:nr}}),r.getSheet(u).rowsHeightCollection[tt.rowIndex]=nr,r._isRowViewable(u,tt.rowIndex)&&(r.getRows(u)[1][r._getRowIdx(tt.rowIndex)].style.height=nr+"px"))}if("merge"in f){pr=0;ri=f.merge;o=r.getRangeIndices(ri.mRange);var ou=o[2]-o[0],su=o[3]-o[1],af=r.getSheet(u)._selectedCells,hu=r._getAlphaRange(u,d.rowIndex,d.colIndex,d.rowIndex+ou,d.colIndex+su),si,vf=ai.rowIndex-li.rowIndex,yf=ai.colIndex-li.colIndex;if(yt=r._getSelectedRange({rowIndex:d.rowIndex,colIndex:d.colIndex},{rowIndex:d.rowIndex+ou,colIndex:d.colIndex+su}),oi.length>=af.length||!((yf+1)%(su+1)==0&&(vf+1)%(ou+1)==0)){for(h=0,rt=yt.length;h<rt;h++)t.isNullOrUndefined(r.XLEdit.getPropertyValue(yt[h].rowIndex,yt[h].colIndex,"isMHide"))&&(gi=r.XLEdit.getPropertyValue(yt[h].rowIndex,yt[h].colIndex,"merge"),pr++,t.isNullOrUndefined(gi)||(gi&&(fu=gi.mSpan.rowSpan,eu=gi.mSpan.colSpan),t.isNullOrUndefined(fu)||t.isNullOrUndefined(eu)||(pr+=parseInt(fu)*parseInt(eu)-1),gi.isCenterAlign&&r._isRowViewable(u,yt[h].rowIndex)&&r.getCell(yt[h].rowIndex,yt[h].colIndex).addClass("e-calign").removeClass("e-ralign")));if(yt.length===pr&&pt){for(cu=!1,ui=r._dataContainer.sheets[w],si=r._getSelectedCells(w,ri.mRange).range,ot=si[0];ot<=si[2];ot++)for(kt=si[1];kt<=si[3];kt++)r._isRowViewable(w,ot)&&r.getCell(ot,kt,w).text(""),t.isNullOrUndefined(ui[ot])&&(ui[ot]={}),t.isNullOrUndefined(ui[ot][kt])&&(ui[ot][kt]={}),cu?(ui[ot][kt].isMHide=!0,ui[ot][kt].mergeIdx={rowIndex:o[0],colIndex:o[1]}):(ui[ot][kt].merge=ri,cu=!0);r.setActiveSheetIndex(w);r._unMergeAllCells(this._copyRange[0],0,r._getSelectedRange({rowIndex:o[0],colIndex:o[1]},{rowIndex:o[2],colIndex:o[3]}),[],0,0);r.setActiveSheetIndex(u)}r._paste=!0;r._dupDetails=!0;r.isUndefined(d.prevObj.merge)||r.unmergeCells(d.prevObj.merge.mRange);r.unmergeCells(hu);r.mergeCenter=ri.isCenterAlign;r.isUndefined(si)||si!=="1"?r.mergeCells(hu,!0):r.mergeAcrossCells(hu,!0);r._dupDetails=!1;r.XLEdit._updateCellValue(tt,ki);t.isNullOrUndefined(ft)||r.addClass(k,ft)}else{wr=n.extend(!0,{},f);wr.value=wr.value2=ki;t.isNullOrUndefined(ft)||r.getCell(o[0],o[1],this._copyRange[0]).addClass(ft);r.XLEdit._updateDataContainer({rowIndex:o[0],colIndex:o[1]},{dataObj:wr});r._showAlertDlg("Alert","MergeAlert","",250);return}}if("hyperlink"in f&&(ar=f.hyperlink,k&&(ar&&!ar.webAddr?k.html(t.buildTag("a.e-hyperlinks",r.XLEdit.getPropertyValue(e,s,"value2"),"",{href:"#"})):k.html(t.buildTag("a.e-hyperlinks",r.XLEdit.getPropertyValue(e,s,"value2"),"",{href:ar.webAddr,target:"_blank"})))),"comment"in f&&(r._removeClass(k,"e-commentcell"),r.XLComment.setComment([e,s,e,s],null,!1)),"cFormatRule"in f)for(yi=n.extend(!0,[],f.cFormatRule),f.cFormatRule=[],h=0,rt=yi.length;h<rt;h++)ut=r._dataContainer.cFormatData[yi[h]].split("_"),ut[0]!=="databar"&&ut[0]!=="iconsets"&&ut[0]!=="colorscale"&&r.XLCFormat._cFormat(ut[0],ut[2],ut[3],ut[4],ut[5],ut[0]=="databar"?ut[6]:null,null,[e,s,e,s],"paste",this._copyCells[ct]);if(r._isPaste=!0,"wrap"in f&&(r._dupDetails=!0,vi=r._generateHeaderText(s+1)+(e+1),r.setWrapText("wrap",vi+":"+vi),r._dupDetails=!1),"cellType"in f){for(dt=n.extend(!0,{},r._dataContainer.sheetCellType[f.cellType]),delete dt.id,delete dt.value,delete dt.selectedIndex,delete dt.text,dt.type!=="DropDownList"&&(dt.text=""),lf=r.getAlphaRange(e,s),h=0;h<rr.cellTypes.length;h++)if(cf=rr.cellTypes[h],cf.range==lf){rr.cellTypes.splice(h,1);break}r.XLEdit._clearDataContainer({cellIdx:{rowIndex:e,colIndex:s},property:["cellType"]});r.model.allowCellType&&r.XLCellType._renderControls(e,s,u,dt,!1)}if(r.model.allowSparkline&&"sparkline"in f&&r.XLSparkline._refreshSparklineClipboard(e,s,u,w,this._copyCells.length),r._isPaste=!0,"picture"in f)for(delete bt.picture,h=0,rt=f.picture.length;h<rt;h++)v=ii?this._copyCells[ct]:this._cutCells[ct],ti=this._copyBackup.actCellPos,ei=r.getRangeData([v.rowIndex,v.colIndex,v.rowIndex,v.colIndex],"","",this._copyRange[0])[0],(!r.isUndefined(ei.picture)&&ei.picture.indexOf(f.picture[h])>-1||!ii)&&(n.extend(!0,l,lt.picture[f.picture[h]]),nt=r.element.find("#"+l.id),l.rowIndex===v.rowIndex&&l.colIndex===v.colIndex&&(nt=r.element.find("#"+l.id),ft=nt[0].className,ft.indexOf("e-shapebdr")>-1?(ft=nt[0].className.match(ku)[0],ni=ft.replace("e-shapebdr","").split("N"),sr=ni[2],r.XLShape._createPicture(u,tt,lt.sharedPics[l.data],parseInt(nt.css("top"))-ti.top+wi[0].offsetTop,parseInt(nt.css("left"))-ti.left+wi[0].offsetLeft,l.width,l.height,null,"#"+sr,du[parseInt(ni[1])-1],ni[0]+"px")):r.XLShape._createPicture(u,tt,lt.sharedPics[l.data],parseInt(nt.css("top"))-ti.top+wi[0].offsetTop,parseInt(nt.css("left"))-ti.left+wi[0].offsetLeft,l.width,l.height),this._copyRange[0]===u&&(a.sheets[u][p+y][b+it].picture[h]=r.getObjectKeys(lt.picture)[r.getObjectLength(lt.picture)-1]),pt&&nt.remove()));if("chart"in f)for(delete bt.chart,ei=r.getRangeData([e,s,e,s]),h=0,rt=f.chart.length;h<rt;h++)v=ii?this._copyCells[ct]:this._cutCells[ct],ti=this._copyBackup.actCellPos,ei=r.getRangeData([v.rowIndex,v.colIndex,v.rowIndex,v.colIndex])[0],(!r.isUndefined(ei.chart)&&ei.chart.indexOf(f.chart[h])>-1||!ii)&&(n.extend(!0,l,lt.chart[f.chart[h]]),nt=r.element.find("#"+l.id),l.rowIndex===v.rowIndex&&l.colIndex===v.colIndex&&(l.isChartSeries||(o=l.range,o=r._getAlphaRange(u,o[0],o[1],o[2],o[3]),o.indexOf(":")<0&&(o=o+":"+o)),l.top=parseInt(nt.css("top"))-ti.top+wi[0].offsetTop,l.left=parseInt(nt.css("left"))-ti.left+wi[0].offsetLeft,r.XLChart.createChart(l.isChartSeries?null:o,l),a.sheets[u][p+y][b+it].chart[h]=r.getObjectKeys(lt.chart)[r.getObjectLength(lt.chart)-1],pt&&nt.remove()));"rule"in f&&f.rule.type==="list"&&r._setddlCell();r._isPaste=!1}else r.XLEdit._updateCellValue(tt,""),t.isNullOrUndefined(a.sheets[u][e])||delete a.sheets[u][e][s];else tr=r.XLEdit._parseValue(v[it],tt),tr.type=="time"||tr.type=="datetime"?(pu=r._dateToInt(tr.value),r.XLEdit._updateCellValue(tt,pu)):r.XLEdit._updateCellValue(tt,tr.value),v[it].indexOf("=")>-1&&r.XLEdit._updateCellValue(tt,k.html());ct++;d.newObj=t.isNullOrUndefined(a.sheets[u][p+y])?{}:n.extend(!0,{},a.sheets[u][p+y][b+it]);t.isNullOrUndefined(d.newObj)&&(d.newObj={});d.prevObj.cTypeObj&&(d.prevObj.selIdxChange=r._isSelIdxChange);iu.push(d)}t.isNullOrUndefined(k)||(r._setRowHdrHeight(u,r._getCellIdx(k[0]).rowIndex),r.model.allowFreezing&&r.getSheet(u)._isFreezed&&r.XLFreeze._refreshFRowResize(r._getCellIdx(k[0]).rowIndex))}if(r._hasFormulaArray=!1,r._hasMultipleFormulaArray=!1,ht.length<1&&(y=1),pt&&(this._isCut=ff,this._cutCells=[],this._cData=""),this._formulaArrayPaste(),this._isSpecial&&fi){for(lu=this._copyBackup.table,au=r.getSheet(u).tableManager,o=r.getRangeIndices(this._copyRange[1]),h=0,rt=lu.length;h<rt;h++)ir=this._copyBackup.table[h].range,br=n.extend(!0,{},this._copyBackup.table[h].tblObj),this._copyBackup.copypaste&&(br.name="Table"+r._tableCnt),r._dupDetails=!0,r.XLFormat.createTable(br,r._getAlphaRange(this._copyRange[0],ir[0]+p-o[0],ir[1]+b-o[1],p-o[0]+ir[2],b-o[1]+ir[3])),r._dupDetails=!1,vu=this._isCut?br.tblId:this.XLObj.getObjectLength(au),ci.push(au[vu]),ci[h].id=vu,ci[h].totalRow&&r.XLFormat._updateTotalRow(u,ci[h].id,lu[0].tblObj.fnNumber,ci[h].range,!0);bi=[p,b,y+p-1,it+b-1];pt&&this._copyBackup.filterRange.length>0&&this._copyRange[0]===u&&(or=this._copyBackup.filterRange,r.XLFilter.clearFilter(),kr=r._generateHeaderText(or[1]+b-o[1]+1)+(or[0]+p-o[0]+1)+":"+r._generateHeaderText(b-o[1]+or[3]+1)+(p-o[0]+or[2]+1),r.XLFilter.filter(kr));c.pasteBorder.newBorder=r.model.allowCellFormatting&&r.XLFormat.getHashCodeClassAsArray(bi);r.setActiveSheetIndex(this._copyRange[0]);c.cutBorder.newBorder=r.model.allowCellFormatting&&r.XLFormat.getHashCodeClassAsArray(o);r.setActiveSheetIndex(u)}if(c.pfat={table:this._copyBackup.table,range:o,minRowIdx:p,minColIdx:b,ptable:ci},c.pfilter=kr,c.pasteCells=iu,r.XLSelection.selectRange({rowIndex:p,colIndex:b},{rowIndex:y+p-1,colIndex:it+b-1}),r.getSheet(u)._startCell={rowIndex:p,colIndex:b},r.getSheet(u)._endCell={rowIndex:y+p-1,colIndex:it+b-1},r.model.allowAutoFill&&r.XLDragFill.positionAutoFillElement(),c.sheetIndex=u,r._setSheetFocus(),r.model.showRibbon&&r.XLRibbon._updateRibbonIcons(),g={sheetIndex:c.sheetIndex,pasteCells:c.pasteCells,reqType:c.reqType,isSpecial:c.isSpecial,cutCells:c.cutCells,pasteSheetIndex:c.pSheetIndex,isHighlightData:c.isHighlightData},g.reqType==="cut-paste"?g.cutSheetIndex=c.cSheetIndex:g.copySheetIndex=c.cSheetIndex,r._isUndoRedo||(r._completeAction(c),r._trigActionComplete(g)),g.isHighlightData&&!g.isSpecial&&(r._pushHighlightData([g.pasteCells[0].rowIndex,g.pasteCells[0].colIndex,g.pasteCells[g.pasteCells.length-1].rowIndex,g.pasteCells[g.pasteCells.length-1].colIndex]),this._highLightRange.length&&bu.operation!="hl-data")){for(y=0,cr=this._highLightRange.length;y<cr;y++)r.XLValidate.highlightInvalidData(this._highLightRange[y]);this._highLightRange=[]}hr=c.cutCells.length<1?p:c.cutCells[0].rowIndex;r.XLScroll._getRowHeights(u,p<hr?p>0?p-1:0:hr>0?hr-1:0)}r._isPaste=!1;this._isCut=!1;r.XLSelection._refreshBorder();r.model.allowAutoFill&&r.XLDragFill.positionAutoFillElement();r.getSheet(u)._isFreezed&&r.XLFreeze._refreshSelection()}else r._showAlertDlg("Alert","FullSheetCopyPasteAlert","",375);r._isCopyPaste=!1}}},_formulaArrayPaste:function(){for(var l,a,ut,ft,v,i,et,e,r,n=this.XLObj,w,o=n.getActiveSheetIndex(),ot,b=0,k=0,d=0,g=0,st,ht,t,u,y=n.getObjectKeys(this._copyRnge),p,ct,s,h,lt,f,at,vt,nt,tt,it,rt,c=0,yt=y.length;c<yt;c++)for(ct=this._copyRnge[y[c]],l=n.getSheet(o)._startCell,a=n.getSheet(o)._endCell,ut=l.rowIndex<a.rowIndex?l.rowIndex:a.rowIndex,ft=l.colIndex<a.colIndex?l.colIndex:a.colIndex,s=n.swapRange(n.getRangeIndices(y[c])),h=[ut,ft,ut+(s[2]-s[0]),ft+(s[3]-s[1])],i=n._getSelectedRange({rowIndex:h[0],colIndex:h[1]},{rowIndex:h[2],colIndex:h[3]}),et=n.getAlphaRange(i[0].rowIndex,i[0].colIndex,i[i.length-1].rowIndex,i[i.length-1].colIndex),r=0;r<ct.length;r++)if(n._hasFormulaArray=!0,n._hasMultipleFormulaArray=!0,r==0){for(w=y[c],u=n.getRangeIndices(w),ot=n.getSheet(o).formulaRange[w],e=n.XLDragFill._parseFormula(ot),ht=e[0]+":"+e[e.length-1],t=n.getRangeIndices(ht),this._isCut||(t[0]<u[0]?b=u[0]-t[0]:t[0]>u[0]&&(b=t[0]-u[0]),t[1]<u[1]?g=u[1]-t[1]:t[1]>u[1]&&(g=t[1]-u[1]),lt=n._getAlphaRange(o,i[r].rowIndex,i[r].colIndex,i[r].rowIndex,i[r].colIndex),f=n.getRangeIndices(lt),t[0]<f[0]?k=f[0]-t[0]:t[0]>f[0]&&(k=t[0]-f[0]),t[1]<f[1]?d=f[1]-t[1]:t[1]>f[1]&&(d=t[1]-f[1])),at=k-b,vt=d-g,v=0;v<e.length;v++)nt=e[v].trim(),n._isCellReference(nt)&&(tt=n.getRangeIndices(nt),it=tt[0]+at,rt=tt[1]+vt,st=n._getAlphaRange(o,it,rt,it,rt),e[v]=st);p="="+e.join("");n.getSheet(o).formulaRange[et]=p;n.XLEdit._updateCellValue({rowIndex:i[r].rowIndex,colIndex:i[r].colIndex},p)}else n.XLEdit._updateCellValue({rowIndex:i[r].rowIndex,colIndex:i[r].colIndex},p);this._copyRnge={}},_getUpdatedCellFormula:function(n,t,i){for(var f=this.XLObj,c=/([A-Z].*?[0-9])/g,l=i.rowIdx-t.rowIndex,a=i.colIdx-t.colIndex,r=f.XLDragFill._parseFormula(n),e,o,s,u=0,h=r.length;u<h;u++)r[u].match(c)&&(e=r[u].trim().match(/(\d+|\D+)/g),o=f._generateColCount(e[0])+a,s=parseInt(e[1])+l,r[u]=s>0&&o>0?f._generateHeaderText(o)+s.toString():"#REF!");return r=r.join(""),"="+r},_compareRange:function(n,t){return n[0]<=t[0]&&n[1]<=t[1]&&n[2]>=t[2]&&n[3]>=t[3]},_cutPasteBorder:function(n,t){var r,u,s,h,c,i=this.XLObj,l=i.getActiveSheetIndex(),f=[],e=[],o=[];for(i.isPasteValuesOnly||i.XLFormat.removeStyle(t,{cellStyle:!0,border:!0,format:!0,sheetIdx:l}),e=i._getSelectedRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]}),o=i._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]}),r=0,c=o.length;r<c;r++)u=o[r],h=e[r].rowIndex,s=e[r].colIndex,f=i.XLEdit.getPropertyValue(h,s,"borders",this._copyRange[0]),i.isUndefined(f)||i.XLFormat.applyBorder(f,[u.rowIndex,u.colIndex,u.rowIndex,u.colIndex]);i.setActiveSheetIndex(this._copyRange[0]);i.XLFormat.removeStyle(n,{cellStyle:!0,border:!0,format:!0});i.setActiveSheetIndex(l)}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.comments=function(n){this.XLObj=n;this._isCommentEdit=!1;this._isShowAllComments=!1;this._curCommentHCell=null};t.spreadsheetFeatures.comments.prototype={setComment:function(n,i,r,u){var f=this.XLObj,s,c;if(f.model.allowComments&&!f.model.isReadOnly&&!f.model.isGridMode&&(s=f.getActiveSheetIndex(),c={sheetIndex:s,reqType:"comment",type:"actionBegin",action:"createcomment"},!f._trigActionBegin(c))){var p,w=!1,y,l,e,o,b,v,k,h=f.getSheet(s),d,g=[],a={sheetIndex:s,reqType:"comment"};if(f.model.allowLockCell&&h.isSheetProtected)return!1;if(n)p=f._getRangeArgs(n,"object"),e=p[0],o=p[1],l={rowIndex:e,colIndex:o};else{if(!f.model.allowSelection)return;l=f.getActiveCell(s);e=l.rowIndex;o=l.colIndex}if(c={reqType:"beforeEditComment",cellIndex:l,value:i,sheetIdx:s,disable:!1},f._trigger("beforeEditComment",c)&&(c.disable=!0),i=c.value,!f._isCellProtected(e,o,!1)){if(!f.isUndefined(f.XLEdit.getPropertyValue(e,o,"cellType"))){f._showAlertDlg("Alert","CellTypeAlert","CellTypeAlert",372);return}f.model.showRibbon&&(f._isPaste?!f.XLClipboard._cutCells.length:!0)&&f._commentCount++;f._isRibbonClick||(a.action="add",g.push(l),a.selectedCell=g,a.selectedCell[0].prevComment=f.XLEdit.getPropertyValue(e,o,"comment"));f._isAutoWHMode||f.XLClipboard._copyCells.length||h._isFreezed||f.XLScroll._scrollSelectedPosition(s,l);e in h._commentColl||(h._commentColl[e]={});h._commentColl[e][o]={isComment:!0};r=t.isNullOrUndefined(r)?!0:r;u=t.isNullOrUndefined(u)?!0:u;k=(f.model.userName.length>0?f.model.userName:f._getLocStr("UserName"))+":\n";t.isNullOrUndefined(i)?c.disable&&f.XLEdit._updateDataContainer(l,{dataObj:{comment:{value:k,isVisible:t.isNullOrUndefined(f.XLEdit.getPropertyValue(e,o,"comment",s))?r:f.XLEdit.getPropertyValue(e,o,"comment",s).isVisible}}}):(u&&(i=k+i),f.XLEdit._updateDataContainer(l,{dataObj:{comment:{value:i,isVisible:t.isNullOrUndefined(f.XLEdit.getPropertyValue(e,o,"comment",s))?r:f.XLEdit.getPropertyValue(e,o,"comment",s).isVisible}}}));b=t.isNullOrUndefined(f.XLEdit.getPropertyValue(e,o,"comment",s))?(f.model.userName.length>0?f.model.userName:f._getLocStr("UserName"))+":\n":f.XLEdit.getPropertyValue(e,o,"comment",s).value;!f.model.allowComments||f.XLEdit._isEdit||f._isSheetRename||(f._isRowViewable(s,e)&&e<h._bottomRow.idx&&(y=f.getCell(e,o),y.prepend(t.buildTag("span.e-comment",t.buildTag("span.e-celltoparrow")).append(t.buildTag("textarea.e-comment-txtarea",b,{"z-index":10,"text-align":"left"}))).addClass("e-commentcell"),this._updateCmntArrowPos(y),v=y.find(".e-comment-txtarea"),this._updateCmtAreaPos(y,v),v.focus().setInputPos(v.val().length),w=!0,c.disable&&(v[0].disabled=!0)),(!h._isImported||h._isLoaded)&&(d=f.XLEdit.getPropertyValue(e,o,"comment",s),t.isNullOrUndefined(d)||(d.value=b)),r&&w?(v.focus(),!this._curCommentHCell||t.isNullOrUndefined(f.XLEdit.getPropertyValueByElem(this._curCommentHCell,"comment"))||f.XLEdit.getPropertyValueByElem(this._curCommentHCell,"comment").isVisible||(this._curCommentHCell.find(".e-comment-txtarea").hide(),this._curCommentHCell=null),f.model.allowDragAndDrop&&!f.XLDragDrop._isDragAndDropped&&this._updateCurrentCell(e,o),c.disable?this._updateCmntRibIcons():(this._isCommentEdit=!0,f.model.showRibbon&&f.XLRibbon._disableRibbonIcons())):w&&(this._isShowAllComments||f.XLEdit.getPropertyValue(e,o,"comment",s).isVisible||v.hide(),f.model.showRibbon&&(!h._isImported||h._isLoaded)&&f.model.allowDragAndDrop&&!f.XLDragDrop._isDragAndDropped&&this._updateCmntRibIcons(f.XLClipboard._isSpecial?f.getActiveCell():{rowIndex:e,colIndex:o})),f._isRibbonClick||f._isUndoRedo||f._hasComment||f._isExport||f._dupDetails||(a.selectedCell[0].curComment=f.XLEdit.getPropertyValue(e,o,"comment"),a.showUserName=u,a.showEditPanel=r,f._completeAction(a),f._trigActionComplete(a)))}}},_updateCmtAreaPos:function(n,t){var r=this.XLObj,u=r.getActiveSheetIndex(),s=r._getContent(u).find("#hscrollBar").offset(),f=r._getContent(u).find("#vscrollBar").offset(),h=r._getJSSheetHeader(u).offset(),i=t.offset(),e=t.height(),o=t.width();r.model.scrollSettings.allowScrolling&&(i.top+e+5>s.top&&i.left+o<f.left?t.css({top:-77}):i.left+o>f.left&&i.top+e+5>s.top?t.css({left:-136,top:-81}):i.top+e>h.top&&i.left+o>f.left&&t.css({left:-137,top:n.height()+8}))},deleteComment:function(n,i,r,u){var f=this.XLObj,h,l,e;if(f.model.allowComments&&!f.model.isReadOnly&&!f.model.isGridMode&&(h=i||f.getActiveSheetIndex(),l={range:n,sheetIndex:h,reqType:t.isNullOrUndefined(u)?"comment":"clear-comment",type:"actionBegin",action:t.isNullOrUndefined(u)?"delete":"clear-comment"},!f._trigActionBegin(l))){var o,c,v,y=[],p=[],s,a={sheetIndex:h,reqType:"comment",action:"delete",range:l.range};for(n=f._getRangeArgs(l.range,"object"),s=f._getSelectedCells(i,n).selCells,e=0;e<s.length;e++)f.XLEdit.getPropertyValue(s[e].rowIndex,s[e].colIndex,"comment",i)&&y.push(s[e]);if(f.model.allowComments){for(e=0;e<s.length;e++)if(o=s[e].rowIndex,c=s[e].colIndex,v=f.XLEdit.getPropertyValue(o,c,"comment",i),!t.isNullOrUndefined(v)){if(r&&f._isHiddenRow(o)){s.splice(e,1);continue}f.model.showRibbon&&f._commentCount&&f._commentCount--;p.push({rowIndex:o,colIndex:c,prevComment:v,currComment:{}});f._isRowViewable(h,o)&&f.getCell(o,c,h).removeClass("e-commentcell").find(".e-comment").remove();f.getSheet(h)._commentColl[o]&&delete f.getSheet(h)._commentColl[o][c];delete f._dataContainer.sheets[h][o][c].comment}a.selectedCell=p;f.model.showRibbon&&y.length&&f.model.allowDragAndDrop&&!f.XLDragDrop._isDragAndDropped&&f.XLComment._updateCmntRibIcons();a.reqType=t.isNullOrUndefined(u)?"comment":"clear-comment";f._isUndoRedo||f._dupDetails||(f._completeAction(a),f._trigActionComplete(a))}}},editComment:function(n){var i=this.XLObj,f,u,e,r,o;if(i.model.allowComments&&!i.model.isReadOnly&&!i.model.isGridMode&&(u=i.getActiveSheetIndex(),r={cellIndex:n,sheetIndex:u,reqType:"edit-comment",type:"actionBegin",action:"editcomment"},!i._trigActionBegin(r))){if(n=r.cellIndex,i.model.allowLockCell&&i.getSheet(u).isSheetProtected)return!1;t.isNullOrUndefined(n)&&(n=i.getActiveCell());f=i.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"comment",u);r={reqType:"beforeEditComment",cellIndex:n,value:f.value,sheetIndex:u,isDisable:!1};i._trigger("beforeEditComment",r)&&(r.disable=!0);f.value=r.value;i.XLEdit._updateDataContainer(n,{dataObj:{comment:{value:f.value,isVisible:f.isVisible}}});i.XLEdit._isEdit||i._isSheetRename||(i.model.allowComments&&(t.isNullOrUndefined(i.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"comment"))||(i._isAutoWHMode||i.XLScroll._scrollSelectedPosition(u,n),i._isRowViewable(u,n.rowIndex)&&(e=i.getCell(n.rowIndex,n.colIndex).find(".e-comment-txtarea"),e.text(r.data),e.css("display","inline-table").focus().setInputPos(e.text().length)),r.disable||(this._isCommentEdit=!0))),i.model.showRibbon&&!r.disable&&i.XLRibbon._disableRibbonIcons());o={cellIndex:n,value:f.value,sheetIndex:u,reqType:"edit-comment",type:"actionComplete",action:"editcomment"};i._completeAction(o);i._trigActionComplete(o)}},showHideComment:function(n){var i=this.XLObj;if(i.model.allowComments&&!i.model.isReadOnly&&!i.model.isGridMode){var s=i.getActiveSheetIndex(),r,u,e,o=!1,f=!1;r=t.isNullOrUndefined(n)?i.getActiveCell():i._getCellIdx(n[0]);u=i.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"comment");t.isNullOrUndefined(u)||(i._isRowViewable(s,r.rowIndex)&&(e=i.getCell(r.rowIndex,r.colIndex).find(".e-comment-txtarea"),o=!0),u.isVisible?(o&&e.hide(),f=!1):(o&&e.css("display","inline-table"),this._curCommentHCell=null,f=!0));i.isUndefined(f)||(u.isVisible=f)}},showAllComments:function(){var t=this.XLObj,f;if(t.model.allowComments&&!t.model.isGridMode){for(var r,e,i,a=t.getActiveSheetIndex(),o,s,h,c=n("#"+t._id+"_Ribbon_Review_Comments_ShowAllComments").data("ejToggleButton"),l=["Review_Comments_PreviousComment","Review_Comments_NextComment"],u=1;u<=t.model.sheetCount;u++)for(o=t.getSheet(u)._commentColl,r=t.getObjectKeys(o),i=0;i<r.length;i++){for(e=t.getObjectKeys(o[r[i]]),f=0;f<e.length;f++)t._isRowViewable(a,parseInt(r[i]))&&(s=t.getCell(parseInt(r[i]),parseInt(e[f]),u).find(".e-comment-txtarea"),this._isShowAllComments?s.hide():s.css("display","inline-table")),t.XLEdit.getPropertyValue(r[i],e[f],"comment",u).isVisible=!this._isShowAllComments;i==0&&(h=!0)}this._isShowAllComments=!this._isShowAllComments;t.model.showRibbon&&c&&c.model.toggleState?t.XLRibbon._disableButtons(l,"ejButton"):t.model.showRibbon&&h&&t.XLRibbon._enableButtons(l,"ejButton")}},findPrevComment:function(){var i=this.XLObj,o,u,y,c,l,a,f,r,e,s,p,h,v;if(i.model.allowComments&&!i.model.isReadOnly&&!i.model.isGridMode){for(o=i.getActiveSheetIndex(),p=n("#"+i._id+"_Ribbon_Review_Comments_NewComment"),f=o;f>0;f--)if(u=i.getSheet(f),i.getObjectLength(u._commentColl))for(f!==o&&i.gotoPage(f,!1),i.model.showRibbon&&(v=i.XLRibbon._getTabIndex("review"),v&&n("#"+i._id+"_Ribbon").ejRibbon("option","selectedItemIndex",v)),y=u.rowCount-1,c=u.colCount-1,f!==o&&this._updateCurrentCell(y-1,c-1),l=u._activeCell.rowIndex,a=u._activeCell.colIndex,r=l;r>=0;r--)for(r!==l&&(a=c-1),e=a;e>=0;e--)if(i.XLEdit.getPropertyValue(r,e,"comment",o)&&(u._hiddenFreezeRows.indexOf(r)>-1&&u._isFreezed?i.XLSearch._freezeScroll(r,e,u):i._isRowViewable(o,r)||i._scrollContent({y:i._getRowOffsetTop(u,r)},!0)),i._isRowViewable(o,r)){if(s=n(i.getCell(r,e)),h=n(s.find(".e-comment-txtarea")),u._activeCell.rowIndex!==r&&u._activeCell.colIndex!==e&&!t.isNullOrUndefined(i.XLEdit.getPropertyValueByElem(s,"comment"))&&i.XLEdit.getPropertyValueByElem(s,"comment").isVisible&&h.hide(),s.hasClass("e-commentcell")&&!h.is(":visible"))return h.css("display","inline-table").focus()&&this._updateCurrentCell(r,e),this._updateCommentsBtns(p),i._setSheetFocus(),!0;this._isShowAllComments||this._isCommentEdit||!s.hasClass("e-commentcell")||i.XLEdit.getPropertyValueByElem(s,"comment").isVisible||h.hide()}f===0&&i._showAlertDlg("","CommentFindEndAlert","findPrevComment",630)}},_updateCommentsBtns:function(n){var t=this.XLObj;t.model.showRibbon&&(t.XLRibbon._enableButtons(["Review_Comments_DeleteComment","Review_Comments_ShowHideComment"],"ejButton"),n.find(".e-icon").removeClass("e-ssr-newcmnt").addClass("e-ssr-editcmnt"),n.find(".e-btntxt").text(t._getLocStr("EditComment")))},findNextComment:function(){var i=this.XLObj;if(i.model.allowComments&&!i.model.isReadOnly&&!i.model.isGridMode){for(var u,c,l,v,y,r,o,e,h,a,p=!1,s=i.getActiveSheetIndex(),w=n("#"+i._id+"_Ribbon_Review_Comments_NewComment"),f=s;f<=i.model.sheetCount;f++)if(u=i.getSheet(f),i.getObjectLength(u._commentColl))for(f!==s&&i.gotoPage(f,!1),i.model.showRibbon&&(a=i.XLRibbon._getTabIndex("review"),a&&n("#"+i._id+"_Ribbon").ejRibbon("option","selectedItemIndex",a)),f!==s&&this._updateCurrentCell(0,0),c=u._activeCell.rowIndex,l=u._activeCell.colIndex,v=u.rowCount-1,y=u.colCount-1,r=c;r<v;r++)for(r!==c&&(l=0),o=l;o<y;o++){if(i.XLEdit.getPropertyValue(r,o,"comment",s)&&(u._isFreezed?i.XLSearch._freezeScroll(r,o,u):i._isRowViewable(s,r)||i._scrollContent({y:i._getRowOffsetTop(u,r)},!0),p=!i.getActiveCellElem()),i._isRowViewable(s,r)&&(e=n(i.getCell(r,o)),h=n(e.find(".e-comment-txtarea")),p||i.getActiveCellElem()[0]===e[0]||t.isNullOrUndefined(i.XLEdit.getPropertyValueByElem(e,"comment"))||!i.XLEdit.getPropertyValueByElem(e,"comment").isVisible||h.hide(),e.hasClass("e-commentcell")&&!h.is(":visible")))return h.css("display","inline-table").focus(),this._updateCurrentCell(r,o),this._updateCommentsBtns(w),i._setSheetFocus(),!0;this._isShowAllComments||this._isCommentEdit||!e.hasClass("e-commentcell")||i.XLEdit.getPropertyValueByElem(e,"comment").isVisible||h.hide()}f===i.model.sheetCount+1&&i._showAlertDlg("","CommentFindEndAlert","findNextComment",630)}},_commentMouseMove:function(i){var e=this.XLObj,r,f,u;(r=i.target.tagName==="TD"?n(i.target):n(i.target).parent("td"),r.length)&&(f=r.find(".e-comment-txtarea"),this._isCommentEdit||(t.isNullOrUndefined(this._curCommentHCell)||r!==this._curCommentHCell&&(u=e.XLEdit.getPropertyValueByElem(this._curCommentHCell,"comment"),t.isNullOrUndefined(u)||u.isVisible||(this._curCommentHCell.find(".e-comment-txtarea").hide(),this._curCommentHCell=null)),r[0].tagName==="TD"&&r.hasClass("e-commentcell")&&(f.css("display","inline-table"),this._curCommentHCell=r)))},_commentMouseDownHandler:function(t){var i=this.XLObj,r=i.getActiveCell(),o=i.getActiveSheetIndex(),u,f,e;i._isRowViewable(o,r.rowIndex)&&(u=i.getCell(r.rowIndex,r.colIndex,o),e=n(u.find(".e-comment-txtarea")),u.hasClass("e-commentcell")&&e.get()[0]!==t.target&&(f=i.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"comment"),this._isCommentEdit&&this._updateCurCmntVal(r),this._isShowAllComments||i.isUndefined(f)||f.isVisible||e.hide()));i._hasClass(t.target,"e-comment-txtarea")&&!t.target.disabled&&(n(t.target).focus().css("z-index",10)&&(this._isCommentEdit=!0),this._updateCurrentCell(n(t.target).parents("td").parent().index(),n(t.target).parents("td").index()),i.model.showRibbon&&i.XLRibbon._disableRibbonIcons())},_updateCmntRibIcons:function(t){var u,i=this.XLObj,f=["Review_Comments_ShowHideComment","Review_Comments_DeleteComment"],e=i.getActiveSheetIndex(),r=n("#"+i._id+"_Ribbon_Review_Comments_NewComment"),h=i.getActiveCell(),o=i.getSheet(e),c=o._selectedCells,s=o.selectedRange;t=i.model.allowDragAndDrop&&!i.XLDragDrop._isDragAndDropped?t?t:h:{rowIndex:i._dStartCell.rowIndex,colIndex:i._dStartCell.colIndex};i.XLRibbon._enableButtons(["Review_Comments_NewComment"],"ejButton");i.XLRibbon._enableButtons(i.XLRibbon._cmntTglBtnIds,"ejToggleButton");u=i.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"comment",e);u?(i.XLRibbon._enableButtons(f,"ejButton"),r.find(".e-icon").removeClass("e-ssr-newcmnt").addClass("e-ssr-editcmnt"),r.find(".e-btntxt").text(i._getLocStr("EditComment"))):(r.find(".e-icon").removeClass("e-ssr-editcmnt").addClass("e-ssr-newcmnt"),r.find(".e-btntxt").text(i._getLocStr("NewComment")),i.XLRibbon._disableButtons(f,"ejButton"));this._isShowAllComments||i._commentCount===0?i.XLRibbon._disableButtons(["Review_Comments_PreviousComment","Review_Comments_NextComment"],"ejButton"):i.XLRibbon._enableButtons(["Review_Comments_PreviousComment","Review_Comments_NextComment"],"ejButton");c.length&&i.inRange(s,t.rowIndex,t.colIndex)&&i.XLEdit._rangeHasProperty(s,"comment")&&i.XLRibbon._enableButtons(["Review_Comments_DeleteComment"],"ejButton")},_updateCurCmntVal:function(n,i){i=t.isNullOrUndefined(i)?"":i;var r=this.XLObj,s=r.getActiveSheetIndex(),c=t.isNullOrUndefined(n)?r.getActiveCell():n,o,l=[],a="User Name:",h=!1,e={sheetIndex:s,reqType:"comment"},u=c.rowIndex,f=c.colIndex;r._isRowViewable(e.sheetIndex,u)&&(o=r.getCell(u,f,s).find(".e-comment-txtarea"),h=!0,o.scrollTop(0));l.push({rowIndex:u,colIndex:f});e.action=t.isNullOrUndefined(r.XLEdit.getPropertyValue(u,f,"comment"))?"add":"edit";e.selectedCell=l;e.selectedCell[0].prevComment=r.XLEdit.getPropertyValue(u,f,"comment");h&&(a=o.css("z-index",9).val());r.XLEdit._updateDataContainer({rowIndex:u,colIndex:f},{dataObj:{comment:{value:a,isVisible:r.isUndefined(r.XLEdit.getPropertyValue(u,f,"comment"))?this._isShowAllComments:r.XLEdit.getPropertyValue(u,f,"comment").isVisible}}});!h||this._isShowAllComments||r.XLEdit.getPropertyValue(u,f,"comment").isVisible||o.hide();r._setSheetFocus();this._isCommentEdit=!1;r.model.allowKeyboardNavigation&&(r.XLCellNav._isNavigate=!0);r.model.showRibbon&&r.XLRibbon._enableRibbonIcons();r.XLEdit._updateUsedRange(u,f,s);e.selectedCell[0].curComment=r.XLEdit.getPropertyValue(u,f,"comment");r._isUndoRedo||i==="paste"||(r._completeAction(e),r._trigActionComplete(e))},_updateCurrentCell:function(n,t,i){var r=this.XLObj,u={rowIndex:n,colIndex:t},f;i=i?i:r.model.activeSheetIndex;f=r.getSheet(i);f._activeCell=u;r.model.allowSelection&&r.XLSelection.selectRange(u,u,i);f._startCell=f._endCell=u;r.model.allowAutoFill&&r.XLDragFill.positionAutoFillElement()},_visibleCmntCnt:function(n,t){n.find(".e-comment")[t?"show":"hide"]()},_updateCmntArrowPos:function(t,i,r){var f=this.XLObj,s,a,u,c,e,h,o,l;if(i=f._getSheetIndex(i),o=f.getSheet(i),l=t||f._getContent(i).find(".e-commentcell"),r=r||{},f.model.allowComments)for(s=0,a=l.length;s<a;s++)if((h=n(l[s]),u=f._getCellIdx(h[0]),!(u.rowIndex<r.rowIndex)&&!(u.colIndex<r.colIndex))&&(e=h.find(".e-comment"),f._isInsdel&&(u.rowIndex in o._commentColl||(o._commentColl[u.rowIndex]={}),o._commentColl[u.rowIndex][u.colIndex]={isComment:!0}),e.length)){if(c=f._getCellInfo(u,i),o.columnsWidthCollection[u.colIndex]<5){e.hide();continue}e.is(":hidden")&&e.show();e.css({top:c.top+"px",left:c.left+h.width()+"px"})}},_updateCmntFrmCntnr:function(n,t){var i=this.XLObj;i.XLEdit.getPropertyValue(n,t,"comment")&&(i._isRowViewable(null,t)&&i.getCell(n,t).hasClass("e-commentcell")&&this.deleteComment([n,t,n,t]),i._dupDetails=!0,this.setComment([n,t,n,t],null,!1),i._dupDetails=!1)}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.contextmenu=function(n){this.XLObj=n;this._clrFltrEnable=!1;this._isMenuOpened=!1;this._uniqueClass=n._id+"-cmenu";this._selColor="";this._changedDataSource=!1;this._modifyClick=!1;this._oldCustomName="";this._target="";this._rowCellMenuDataMobile=[{id:"Cut",text:n._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:n._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"PasteSpecial",text:n._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"FormatCells",text:n._getLocStr("FormatCells")+"...",parentId:null,spriteCssClass:"e-icon e-ss-formatcells"},{id:"BackgroundColor",text:n._getLocStr("BackgroundColor"),parentId:null,spriteCssClass:"e-icon e-ss-backgroundcolor"},{id:"FontColor",text:n._getLocStr("FontColor"),parentId:null,spriteCssClass:"e-icon e-ss-fontcolor"},];this._headerMenuDataMobile=[{id:"Cut",text:n._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:n._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"PasteSpecial",text:n._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"Insert",text:n._getLocStr("Insert"),parentId:null},{id:"Delete",text:n._getLocStr("Delete"),parentId:null},{id:"Hide",text:n._getLocStr("Hide"),parentId:null},{id:"Unhide",text:n._getLocStr("Unhide"),parentId:null},];this._rowCellMenuData=[{id:"Cut",text:n._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:n._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"Paste",text:n._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"PasteSpecial",text:n._getLocStr("PasteSpecial"),parentId:"Paste"},{id:"PasteValues",text:n._getLocStr("PasteValues"),parentId:"Paste"},{id:"Insert",text:n._getLocStr("Insert")+"...",parentId:null},{id:"Delete",text:n._getLocStr("Delete")+"...",parentId:null},{id:"Filter",text:n._getLocStr("Filter"),parentId:null,spriteCssClass:"e-icon e-ss-filter"},{id:"ClearFilter",parentId:"Filter",text:n._getLocStr("ClearFilter"),spriteCssClass:"e-icon e-ss-filternone"},{id:"FilterSelected",parentId:"Filter",text:n._getLocStr("FilterSelected"),spriteCssClass:"e-icon e-ss-filter"},{id:"Sort",text:n._getLocStr("Sort"),parentId:null,spriteCssClass:"e-icon e-ss-sortatoz"},{id:"SortAtoZ",parentId:"Sort",text:n._getLocStr("SortAtoZ"),spriteCssClass:"e-icon e-ss-sortatoz"},{id:"SortZtoA",parentId:"Sort",text:n._getLocStr("SortZtoA"),spriteCssClass:"e-icon e-ss-sortztoa"},{id:"PutCellColor",parentId:"Sort",text:n._getLocStr("PutCellColor"),spriteCssClass:""},{id:"PutFontColor",parentId:"Sort",text:n._getLocStr("PutFontColor"),spriteCssClass:""},{id:"ctxComment",parentId:null,text:n._getLocStr("Comment")},{id:"ctxInsrtCmnt",text:n._getLocStr("InsertComment"),parentId:"ctxComment",spriteCssClass:"e-icon e-ss-newcmnt"},{id:"ctxEditCmnt",text:n._getLocStr("EditComment"),parentId:"ctxComment",spriteCssClass:"e-icon e-ss-editcmnt"},{id:"ctxDeleteCmnt",text:n._getLocStr("DeleteComment"),parentId:"ctxComment",spriteCssClass:"e-icon e-ss-deletecmnt"},{id:"ctxShwHdCmnt",text:n._getLocStr("ShowHide"),parentId:"ctxComment",spriteCssClass:"e-icon"},{id:"FormatCells",text:n._getLocStr("FormatCells")+"...",parentId:null,spriteCssClass:"e-icon e-ss-formatcells"},{id:"CmHyperLink",text:n._getLocStr("HyperLink"),parentId:null,spriteCssClass:"e-icon e-ss-hyperlink"},{id:"HyperLink",text:n._getLocStr("HyperLink")+"...",parentId:"CmHyperLink",spriteCssClass:"e-icon e-ss-hyperlink"},{id:"EditLink",text:n._getLocStr("EditLink")+"...",parentId:"CmHyperLink"},{id:"OpenLink",text:n._getLocStr("OpenLink"),parentId:"CmHyperLink"},{id:"RemoveLink",text:n._getLocStr("RemoveLink"),parentId:"CmHyperLink",spriteCssClass:"e-icon e-ss-removelink"},{id:"ClearContents",text:n._getLocStr("ClearContents"),parentId:null,spriteCssClass:"e-icon e-ss-clear"}];this._rowHeaderMenuData=this._columnHeaderMenuData=[{id:"Cut",text:n._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:n._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"Paste",text:n._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"PasteSpecial",text:n._getLocStr("PasteSpecial"),parentId:"Paste"},{id:"PasteValues",text:n._getLocStr("PasteValues"),parentId:"Paste"},{id:"Insert",text:n._getLocStr("Insert"),parentId:null},{id:"Delete",text:n._getLocStr("Delete"),parentId:null},{id:"ClearContents",text:n._getLocStr("ClearContents"),parentId:null,spriteCssClass:"e-icon e-ss-clear"},{id:"Hide",text:n._getLocStr("Hide"),parentId:null},{id:"Unhide",text:n._getLocStr("Unhide"),parentId:null}];this._footerMenuData=[{id:"InsertSheet",text:n._getLocStr("InsertSheet"),parentId:null},{id:"DeleteSheet",text:n._getLocStr("DeleteSheet"),parentId:null,spriteCssClass:"e-icon e-ss-delete"},{id:"RenameSheet",text:n._getLocStr("RenameSheet"),parentId:null,spriteCssClass:"e-icon "},{id:"MoveorCopy",text:n._getLocStr("MoveorCopy")+"...",parentId:null,spriteCssClass:"e-icon "},{id:"HideSheet",text:n._getLocStr("HideSheet"),parentId:null,spriteCssClass:"e-icon "},{id:"UnhideSheet",text:n._getLocStr("UnhideSheet"),parentId:null,spriteCssClass:"e-icon "},{id:"ProtectSheet",text:n._getLocStr("Protectsheet"),parentId:null,spriteCssClass:"e-icon e-ss-cmenuprotect"}];this._chartMenuData=[{id:"Cut",text:n._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:n._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"ChartType",text:n._getLocStr("ChangeChartType")+"...",parentId:null},{id:"SelectData",text:n._getLocStr("SelectData")+"...",parentId:null}];this._imgMenuData=[{id:"Cut",text:n._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:n._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"ChangePicture",text:n._getLocStr("ChangePicture"),parentId:null}];this._pivotMenuData=[{id:"Refresh",text:n._getLocStr("Refresh"),parentId:null,spriteCssClass:"e-icon e-ss-pivotrefresh"}];this._cellStylesMenuData=[{id:"Modify",text:n._getLocStr("Modify"),parentId:null},{id:"DeleteStyle",text:n._getLocStr("Delete"),parentId:null},{id:"Apply",text:n._getLocStr("Apply"),parentId:null}];this._protectRowMenuIds=["Insert","Delete","Filter","ctxComment","Sort","LockCells","CmHyperLink","FormatCells","ClearContents"];this._prtctHeaderIds=["Insert","Delete","Hide","Unhide","ClearContents"];this._footerIds=["InsertSheet","DeleteSheet","RenameSheet","MoveorCopy","HideSheet","UnhideSheet"]};t.Menu.prototype._calculateContextMenuPosition=function(t){var s=this.element.get(0).id,e=this.element.data("id"),o=n("#"+e).data("ejSpreadsheet"),i,r,u,f;return this.element.css({top:"",left:""}),i=t.clientX+this.element.width()<n(window).width()?t.pageX:t.pageX-this.element.width(),u=o&&s.indexOf(e+"_contextMenuFooter")>-1?o.element.height():n(window).height(),r=t.clientY+this.element.height()<u?t.pageY:t.clientY>this.element.height()?t.pageY-this.element.height():u-this.element.outerHeight(),f=n("body").css("position")!="static"?n("body").offset():{left:0,top:0},i-=f.left,r-=f.top,{X:i,Y:r}};t.spreadsheetFeatures.contextmenu.prototype={_initContextMenu:function(){var n=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none",width:"auto"},{id:this.XLObj._id+"_contextMenuCell"});this._createMenu(n,this.XLObj._phoneMode||this.XLObj._tabMode?this._rowCellMenuDataMobile:this._rowCellMenuData,"#"+this.XLObj._id+" .e-spreadsheetcontentcontainer");n=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuColumnHeader"});this._createMenu(n,this._columnHeaderMenuData,"#"+this.XLObj._id+" .e-spreadsheetheader .e-headercontent");n=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuRowHeader"});this._createMenu(n,this._rowHeaderMenuData,"#"+this.XLObj._id+" .e-rowheadercontent");this.XLObj.getObjectLength(this.XLObj._dataContainer.customCellStyle)>=1&&this._createMenu(t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuCellStyles"}),this._cellStylesMenuData,"  .e-cellstylecontent")},_initCMenuFooter:function(){var n=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuFooter"});n.data("id",this.XLObj._id);this._createMenu(n,this._footerMenuData,"#"+this.XLObj._id+" .e-pagercontainer")},_createMenu:function(i,r,u){i.ejMenu({fields:{dataSource:r,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"},menuType:t.MenuType.ContextMenu,openOnClick:!1,beforeOpen:n.proxy(this._beforeOpen,this),close:n.proxy(this._menuClose,this),click:n.proxy(this._menuClick,this),contextMenuTarget:u})},hideCMenu:function(){var t=this.XLObj;t.model.enableContextMenu&&(n("#"+t._id+"_contextMenuCell").data("ejMenu").element.hide(),n("#"+t._id+"_contextMenuColumnHeader").data("ejMenu").element.hide(),n("#"+t._id+"_contextMenuRowHeader").data("ejMenu").element.hide(),n("#"+t._id+"_contextMenuFooter").data("ejMenu").element.hide())},_getCMenuObj:function(i){var r=this.XLObj;switch(i){case t.Spreadsheet.ContextMenu.Cell:return n("#"+r._id+"_contextMenuCell").data("ejMenu");case t.Spreadsheet.ContextMenu.RowHeader:return n("#"+r._id+"_contextMenuRowHeader").data("ejMenu");case t.Spreadsheet.ContextMenu.ColumnHeader:return n("#"+r._id+"_contextMenuColumnHeader").data("ejMenu");case t.Spreadsheet.ContextMenu.Footer:return n("#"+r._id+"_contextMenuFooter").data("ejMenu")}},addItem:function(t,i,r,u){if(t&&!this.XLObj.model.isReadOnly){var c=this._getCMenuObj(t),s=!1,f,e,h,o;f=n.extend(!0,[],c.model.fields.dataSource);switch(r){case"insert":n.merge(f,i);s=!0;break;case"insertbefore":for(e=i.length,o=u-1||0;e>0;)f.splice(o,0,i[e-1]),e--;s=!0;break;case"insertafter":for(e=i.length,h=0,o=u||f.length;h<e;)f.splice(o,0,i[h]),h++,o++;s=!0}s&&this.changeDataSource(t,f)}},removeItem:function(t,i){if(t&&!this.XLObj.model.isReadOnly){var o=this._getCMenuObj(t),f,r,u,e=[];for(u=n.extend(!0,[],o.model.fields.dataSource),r=0,f=u.length;r<f;r++)i.indexOf(u[r].id)==-1&&e.push(u[r]);this.changeDataSource(t,e)}},enableItem:function(n,t){if(n&&!this.XLObj.model.isReadOnly){var r=this._getCMenuObj(n),i,u;if(t&&t.length>0)for(i=0,u=t.length;i<u;i++)r.enableItemByID(t[i]);else r.enable()}},disableItem:function(n,t){if(n&&!this.XLObj.model.isReadOnly){var r=this._getCMenuObj(n),i,u;if(t&&t.length>0)for(i=0,u=t.length;i<u;i++)r.disableItemByID(t[i]);else r.disable()}},hideItem:function(n,t){this._showHideItem(n,t,"hide")},showItem:function(n,t){this._showHideItem(n,t,"show")},_showHideItem:function(n,t,i){if(n&&!this.XLObj.model.isReadOnly){var f=this._getCMenuObj(n),r,u,e;if(t&&t.length>0)for(r=0,e=t.length;r<e;r++)u=t[r],i=="hide"?f.hideItems(["#"+u]):f.showItems(["#"+u])}},changeDataSource:function(n,i){if(n&&!this.XLObj.model.isReadOnly&&i){var r=this._getCMenuObj(n);this._changedDataSource=!0;switch(n){case t.Spreadsheet.ContextMenu.Cell:this._rowCellMenuDataMobile=this._rowCellMenuData=i;break;case t.Spreadsheet.ContextMenu.RowHeader:this._headerMenuDataMobile=this._rowHeaderMenuData=i;break;case t.Spreadsheet.ContextMenu.ColumnHeader:this._headerMenuDataMobile=this._columnHeaderMenuData=i;break;case t.Spreadsheet.ContextMenu.Footer:this._footerMenuData=i}r&&r.option("fields",{dataSource:i})}},_updateContextMenuItems:function(i){var r=this.XLObj,k,d,ut,g=i[0],a=r.getActiveSheetIndex(),v=r.getSheet(a),st=!t.isNullOrUndefined(r.getActiveCellElem())&&r.getActiveCellElem().length>0?r.getActiveCellElem():i,f=r._phoneMode||r._tabMode?this._rowCellMenuDataMobile:this._rowCellMenuData,u=n("#"+r._id+"_contextMenuCell").data("ejMenu"),e=n("#"+r._id+"_contextMenuFooter").data("ejMenu"),l=r.getActiveCell(a),h,s,ft,tt,it,et,p,ot,b,rt,o;if(i.hasClass("e-rowcell")||i.hasClass("e-hyperlinks")){var c,y=[],nt=r.XLEdit.getPropertyValue(v._activeCell.rowIndex,v._activeCell.colIndex),w=r._getCellIdx(r._hasClass(i,"e-hyperlinks")?i.parents("td")[0]:g);if(this._isMenuOpened=!0,r.model.allowLockCell&&v.isSheetProtected&&r.XLEdit.getPropertyValue(w.rowIndex,w.colIndex,"isLocked",a))this._disableMenuOpt(this._protectRowMenuIds);else{if(i.hasClass("e-hyperlinks")&&(i=i.parents("td"),g=i[0]),r.model.allowHyperlink?(this._enableMenuOpt(["CmHyperLink"]),ft=r.XLEdit.getPropertyValue(w.rowIndex,w.colIndex,"hyperlink",a),tt=["EditLink","OpenLink","RemoveLink"],t.isNullOrUndefined(ft)?(this._disableMenuOpt(tt),this._enableMenuOpt(["HyperLink"])):(this._enableMenuOpt(tt),this._disableMenuOpt(["HyperLink"]))):this._disableMenuOpt(["CmHyperLink"]),r.model.allowFiltering){if(u.enableItemByID("Filter"),s=r.model.sheets[a].filterSettings.tableRange,it=r.XLEdit.getPropertyValue(l.rowIndex,l.colIndex,"tableName"),et=t.isNullOrUndefined(it)?-1:parseInt(it.replace("e-table","")),s.length>0){for(p=0,ot=s.length;p<ot;p++)if(s[p].tableID===et){h=p;break}!t.isNullOrUndefined(h)&&l.rowIndex<s[h].selectedRange.endRow+1&&l.rowIndex>s[h].selectedRange.startRow-2&&l.colIndex<s[h].multifilterIdx[s[h].multifilterIdx.length-1]+1&&l.colIndex>s[h].multifilterIdx[0]-1&&(k=r.getCell(s[h].selectedRange.startRow-1,l.colIndex,a).find("span"),k.length&&k[0].className.indexOf("e-ssfiltered")>-1&&(u.enableItemByID("ClearFilter"),this._clrFltrEnable=!0))}this._clrFltrEnable||u.disableItemByID("ClearFilter")}else u.disableItemByID("Filter");r.model.allowInsert?u.enableItemByID("Insert"):u.disableItemByID("Insert");r.model.allowDelete?u.enableItemByID("Delete"):u.disableItemByID("Delete");(r.XLClipboard._copyBackup.cells||r.XLClipboard._copyBackup.elem)&&!r.model.isReadOnly?(this._enableMenuOpt(["Paste"]),r.isPasteValuesOnly?u.disableItemByID("PasteSpecial"):u.enableItemByID("PasteSpecial")):this._disableMenuOpt(["Paste"]);r.model.allowSorting?this._enableMenuOpt(["Sort"]):this._disableMenuOpt(["Sort"]);r.model.allowClear?this._enableMenuOpt(["ClearContents"]):this._disableMenuOpt(["ClearContents"]);r.model.allowCellFormatting?this._enableMenuOpt(["FormatCells"]):this._disableMenuOpt(["FormatCells"]);r._phoneMode||r._tabMode||(y=!t.isNullOrUndefined(nt)&&n.isNumeric(nt)?[r._getLocStr("SortSmallesttoLargest"),r._getLocStr("SortLargesttoSmallest")]:t.isNullOrUndefined(t.parseDate(nt))?[r._getLocStr("SortAtoZ"),r._getLocStr("SortZtoA")]:[r._getLocStr("SortOldesttoNewest"),r._getLocStr("SortNewesttoOldest")],r.model.allowComments?(u.element.find("#ctxComment").hasClass("e-disable-item")&&this._enableMenuOpt(["ctxComment"]),b=r.getSheetElement(r.getActiveSheetIndex()).find(".e-selected"),rt=b.length>1?st:i,rt.hasClass("e-commentcell")?(this._disableMenuOpt(["ctxInsrtCmnt"]),r.XLEdit.getPropertyValueByElem(rt,"comment").isVisible?(c=n.extend(f[19],{text:r._getLocStr("HideComment")}),u.remove(["#"+f[19].id]),u.insert([c],"#"+f[15].id)):(c=n.extend(f[19],{text:r._getLocStr("ShowHide")}),u.remove(["#"+f[19].id]),u.insert([c],"#"+f[15].id)),this._enableMenuOpt(["ctxEditCmnt","ctxDeleteCmnt","ctxShwHdCmnt"])):(this._enableMenuOpt(["ctxInsrtCmnt"]),this._disableMenuOpt(["ctxEditCmnt","ctxDeleteCmnt","ctxShwHdCmnt"])),b.filter(g).length>0&&b.filter(".e-commentcell").length>0&&this._enableMenuOpt(["ctxDeleteCmnt"])):this._disableMenuOpt(["ctxComment"]),f[11].text!==y[0]&&(c=n.extend(f[11],{text:y[0],spriteCssClass:f[11].sprite}),u.remove(["#"+f[11].id]),u.insertBefore([c],"#"+f[13].id)),f[12].text!==y[1]&&(c=n.extend(f[12],{text:y[1],spriteCssClass:f[12].sprite}),u.remove(["#"+f[12].id]),u.insertBefore([c],"#"+f[13].id)));r.model.showRibbon&&r.XLRibbon._dirtySelect(r._getContent(r.getActiveSheetIndex()).find(".e-selected"))}r.model.allowInsert?e.enableItemByID("InsertSheet"):e.disableItemByID("InsertSheet");r.model.allowDelete?e.enableItemByID("DeleteSheet"):e.disableItemByID("DeleteSheet");r.model.allowClipboard?this._enableMenuOpt(["Cut","Copy"]):this._disableMenuOpt(["Cut","Copy"]);(r.XLClipboard._copyBackup.cells||r.XLClipboard._copyBackup.elem)&&!r.model.isReadOnly?this._enableMenuOpt(["Paste"],o):this._disableMenuOpt(["Paste"],o)}else if(i.hasClass("e-link")){if(d=e.model.fields.dataSource.slice(0),r._isSheetRename&&!r._updateSheetNames())return;ut=r.model.allowLockCell&&v.isSheetProtected?r._getLocStr("Unprotect"):r._getLocStr("Protectsheet");d[6].text=ut;e.option("fields",{id:"id",dataSource:d,parentId:"parentId"});this._isMenuOpened=!0;r._isCommentEdit&&r.XLComment._updateCurCmntVal();i.not("a.e-currentitem, a.e-PP, a.e-NP").hasClass("e-numericitem")&&r.gotoPage(i.data("index"));r.model.exportSettings.password?this._disableMenuOpt(this._footerIds,"contextMenuFooter"):(r._getSheetNames(!1).length>0?e.enableItemByID("UnhideSheet"):e.disableItemByID("UnhideSheet"),r._getSheetNames(!0).length>1?(e.enableItemByID("DeleteSheet"),e.enableItemByID("HideSheet"),e.enableItemByID("MoveorCopy")):(e.disableItemByID("DeleteSheet"),e.disableItemByID("HideSheet"),e.disableItemByID("MoveorCopy")));r.model.allowLockCell?e.enableItemByID("ProtectSheet"):e.disableItemByID("ProtectSheet")}else(i.hasClass("e-headercelldiv")||i.hasClass("e-headercell")||i.hasClass("e-rowheader"))&&(o=i.hasClass("e-rowheader")?"contextMenuRowHeader":"contextMenuColumnHeader",r.model.allowClipboard?this._enableMenuOpt(["Cut","Copy"],o):this._disableMenuOpt(["Cut","Copy"],o),(r.XLClipboard._copyBackup.cells||r.XLClipboard._copyBackup.elem)&&!r.model.isReadOnly?this._enableMenuOpt(["Paste"],o):this._disableMenuOpt(["Paste"],o),r.model.allowLockCell&&v.isSheetProtected?this._disableMenuOpt(this._prtctHeaderIds,o):(r.model.allowClear?this._enableMenuOpt(["ClearContents"],o):this._disableMenuOpt(["ClearContents"],o),r.model.allowInsert?this._enableMenuOpt(["Insert"],o):this._disableMenuOpt(["Insert"],o),r.model.allowDelete?this._enableMenuOpt(["Delete"],o):this._disableMenuOpt(["Delete"],o),this._enableMenuOpt(["Hide","Unhide"],o)),r.model.showRibbon&&r.XLRibbon._dirtySelect(r._getContent(r.getActiveSheetIndex()).find(".e-selected")));r.model.allowInsert&&t.isNullOrUndefined(r.model.exportSettings.password)&&!r.model.isGridMode?this._enableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"):this._disableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter");r.model.exportSettings.password?this._disableMenuOpt(["RenameSheet"]):this._enableMenuOpt(["RenameSheet"]);r.model.allowDelete&&r._getSheetNames(!0).length>1?this._enableMenuOpt(["DeleteSheet"],"contextMenuFooter"):this._disableMenuOpt(["DeleteSheet"],"contextMenuFooter");r.model.allowEditing?this._enableMenuOpt(["RenameSheet"],"contextMenuFooter"):this._disableMenuOpt(["RenameSheet"],"contextMenuFooter");r.model.isReadOnly&&(this._disableMenuOpt(["Cut","Insert","Delete","ClearContents"],"contextMenuColumnHeader"),this._disableMenuOpt(["Cut","Insert","Delete","ClearContents"],"contextMenuRowHeader"),this._disableMenuOpt(["Cut","Insert","Delete","Filter","Sort","ctxComment","FormatCells","CmHyperLink","ClearContents"],"contextMenuCell"));r.model.isGridMode&&(this.hideItem("cell",["Insert","Delete","FormatCells","ClearContents","ctxComment"]),this.hideItem("rowheader",["Hide","Unhide","ClearContents","Paste"]),this.hideItem("footer",["HideSheet","DeleteSheet","MoveorCopy","InsertSheet","UnhideSheet","ProtectSheet"]),this.hideItem("columnheader",["Insert","Delete","Hide","Unhide","ClearContents","Paste","Cut"]))},_beforeOpen:function(i){var r=this.XLObj,o=r.XLResize,a,p,c;if(!r.model.enableContextMenu||i.events.type=="mousedown"&&i.target.id.indexOf("_picture")>-1||n(i.target).hasClass("e-numericitem")&&r.model.isReadOnly)return i.cancel=!0,!1;if(n(i.target).hasClass("e-cellstylecell")){if(!n(i.target).hasClass("e-customcellstyle"))return i.cancel=!0,!1;this._target=i.target.innerText}if(n(i.target).hasClass("e-cellstylecontent"))return i.cancel=!0,!1;this._clrFltrEnable=!1;this.hideCMenu();var v=n("#"+r._id+"_contextMenuColumnHeader").data("ejMenu"),y=n("#"+r._id+"_contextMenuRowHeader").data("ejMenu"),l=i.target,b={target:l},u=n(l),s=r.getActiveSheetIndex(),h=r.getSheet(s),f=r._phoneMode||r._tabMode?this._rowCellMenuDataMobile:this._rowCellMenuData,e=n("#"+r._id+"_contextMenuCell").data("ejMenu");if((r.XLEdit._isEdit||r.model.allowComments&&r.XLComment._isCommentEdit||u.hasClass("e-filterspan")||i.events.which===1&&u.hasClass("e-hyperlinks")||u.parents("div").hasClass("e-vscroll")||u.parents("div").hasClass("e-hscroll")||n(l.parentNode).hasClass("e-pagercontainer")&&!u.hasClass("e-link")||!t.isNullOrUndefined(r.XLResize)&&r.XLResize._resizeStart||i.target.id.indexOf("Sheet_RenamePanel")>-1||u.parents().hasClass("e-grid")||u.hasClass("e-autofill"))&&(i.cancel=!0),o&&o._preventColResize(u.parent()[0].cellIndex,!0)&&u.hasClass("e-headercelldiv")&&(i.cancel=!0),o&&o._preventRowResize(parseInt(u.parent().attr("idx")),!0)&&u.hasClass("e-rowheader")&&(i.cancel=!0),u.hasClass("e-rowcell")||u.hasClass("e-hyperlinks"))a=r._getJSSheetHeader(s).find("th"),p=r._getJSSheetRowHeader(s).find("td"),t.isNullOrUndefined(r.XLEdit.getPropertyValueByElem(r.getCell(h._activeCell.rowIndex,h._activeCell.colIndex),"range"))?n(a[u.index()]).hasClass("e-colselected")||n(p[u.parent().index()]).hasClass("e-rowselected")?(f=n(a[u.index()]).hasClass("e-colselected")?this._columnHeaderMenuData:this._rowHeaderMenuData,JSON.stringify(f)!==JSON.stringify(i.model.fields.dataSource)&&this._changedDataSource&&e.option("fields",{dataSource:f,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"})):JSON.stringify(f)!==JSON.stringify(i.model.fields.dataSource)&&e.option("fields",{dataSource:f,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"}):(c=r.model.sheets[s].rangeSettings[r.XLEdit.getPropertyValueByElem(r.getCell(h._activeCell.rowIndex,h._activeCell.colIndex),"range")],e.option("fields",{dataSource:c.contextMenuSettings.dataSource,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"}),e.option("width",c.contextMenuSettings.width),e.option("height",c.contextMenuSettings.height));else if(u.hasClass("e-ss-imgvisual")||u.hasClass("e-ss-object")||u.closest("div").hasClass("e-ss-object")){if(this._isMenuOpened=!0,r.XLShape._shapeType==="chart"){var w=n.extend(!0,[],this._chartMenuData),k=document.getElementById(r._id+"_chart").value,d=r.XLChart._getShapeObj(k,"chart");f=this.XLObj.model.showRibbon?d.isChartSeries?w.splice(0,3):this._chartMenuData:w.splice(0,2)}else f=this._imgMenuData;JSON.stringify(f)!==JSON.stringify(i.model.fields.dataSource)&&e.option("fields",{dataSource:f,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"})}else u.hasClass("e-ss-pivot")||u.closest("div").hasClass("e-ss-pivot")?(f=this._pivotMenuData,JSON.stringify(f)!==JSON.stringify(i.model.fields.dataSource)&&e.option("fields",{dataSource:f,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"})):(u.hasClass("e-headercelldiv")||u.hasClass("e-headercell")||u.hasClass("e-rowheader"))&&(r._phoneMode||r._tabMode?(v.option("fields",{dataSource:this._headerMenuDataMobile}),y.option("fields",{dataSource:this._headerMenuDataMobile})):this._changedDataSource&&(v.option("fields",{dataSource:this._columnHeaderMenuData}),y.option("fields",{dataSource:this._rowHeaderMenuData})));if(this._changedDataSource||this._updateContextMenuItems(u),r._trigger("beforeOpen",b))return!1;i.cancel&&(this._isMenuOpened=!1)},_menuClick:function(n){if(this.XLObj._trigger("contextMenuClick",n))return!1;this._processCMenu(n.ID,n.events.element)},_menuClose:function(){this._isMenuOpened=!1},_processCMenu:function(i,r){var k,f,u=this.XLObj,e=u.getActiveSheetIndex(),a,v,s=u.getSheet(e),y,p,h,c,o=s._selectedCells,w,b,l;switch(i){case"Cut":u.XLClipboard.cut();break;case"Copy":u.XLClipboard.copy();break;case"PasteSpecial":case"PasteValues":u.XLClipboard._isSpecial=!(i==="PasteValues");u.XLClipboard.paste();break;case"Insert":u._insDelStatus="insert";s._isColSelected?(h=u._getJSSheetHeader(e).find(".e-colhighlight"),u.insertEntireColumn(h[0].cellIndex,h[h.length-1].cellIndex)):s._isRowSelected?(c=u._getJSSheetRowHeader(e).find(".e-rowhighlight"),a=u._getCellIdx(c[0]),v=u._getCellIdx(c[c.length-1]),u.insertEntireRow(a.rowIndex,v.rowIndex)):u._showDialog(u._id+"_Ribbon_Others_Cells_InsertCellOptions");break;case"Delete":h=n(u._getJSSheetHeader(e).find("tr")[0]).find(".e-colselected");c=n(u.getRows(e)[0]).find(".e-rowselected");r.parentElement.id.indexOf("ColumnHeader")>-1||s._isColSelected?(h=u._getJSSheetHeader(e).find(".e-colhighlight"),u.deleteEntireColumn(h[0].cellIndex,h[h.length-1].cellIndex,[])):r.parentElement.id.indexOf("RowHeader")>-1||s._isRowSelected?(c=u._getJSSheetRowHeader(e).find(".e-rowhighlight"),a=u._getCellIdx(c[0]),v=u._getCellIdx(c[c.length-1]),u.deleteEntireRow(a.rowIndex,v.rowIndex,[])):u._showDialog(u._id+"_Ribbon_Others_Cells_DeleteCellOptions");break;case"FilterSelected":u._showDialog(u._id+"_Ribbon_Data_SortFilter_Filter");u.XLFilter.filterByActiveCell();this._clrFltrEnable=!1;break;case"ClearFilter":y=u.getActiveCell(e);w=u.XLEdit.getPropertyValue(y.rowIndex,y.colIndex,"tableName");b=t.isNullOrUndefined(w)?-1:parseInt(w.replace("e-table",""));b>-1?(p=u.model.sheets[e].columns[y.colIndex].field,u.XLFilter._clearFilterColumn(p,"","","","","",b),delete u._excelFilter._predicates[e][p]):u.XLFilter.clearFilter("apply");this._clrFltrEnable=!1;break;case"SortAtoZ":case"SortZtoA":case"SortSmallesttoLargest":case"SortLargesttoSmallest":case"SortOldesttoNewest":case"SortNewesttoOldest":case"PutCellColor":case"PutFontColor":u.model.allowSorting&&u.XLSort._sortHandler(i);break;case"ClearContents":u._isTrigCellSave=!0;l=u.model.sheets[e].selectedRange;u.clearContents(u._getAlphaRange(e,l[0],l[1],l[2],l[3]));break;case"InsertSheet":u.insertSheet();break;case"DeleteSheet":u.deleteSheet(e,!0);break;case"RenameSheet":u._renameSheet();break;case"MoveorCopy":u._showDialog(u._id+"_MoveorCopy");break;case"Hide":s._isColSelected&&u._hideColumn(o[0].colIndex,o[o.length-1].colIndex);s._isRowSelected&&u._hideRow(o[0].rowIndex,o[o.length-1].rowIndex,"isRHide");break;case"Unhide":s._isColSelected&&u._showColumn(o[0].colIndex,o[o.length-1].colIndex);s._isRowSelected&&u._showRow(o[0].rowIndex,o[o.length-1].rowIndex,"isRHide");break;case"HyperLink":case"EditLink":u._showDialog(u._id+"_Ribbon_Insert_Links_Hyperlink");break;case"RemoveLink":u._removeHyperlink();break;case"OpenLink":u._openLink();break;case"ctxInsrtCmnt":u._dupDetails=!0;u.XLComment.setComment();u._dupDetails=!1;break;case"ctxEditCmnt":u.XLComment.editComment();break;case"ctxDeleteCmnt":u.XLComment.deleteComment();break;case"ctxShwHdCmnt":u.XLComment.showHideComment();break;case"ChangePicture":u._uploadImage=!0;u.XLShape._changePicture=!0;u.element.find("#"+u._id+"_file .e-uploadinput").click();break;case"ChartType":u._showDialog(u._id+"_Ribbon_ChartDesign_Type_ChangeChartType");u.XLRibbon._refreshChartTypeDlg();break;case"SelectData":u._showDialog(u._id+"_Ribbon_ChartDesign_Data_SelectData");k=document.getElementById(u._id+"_chart").value;f=u.XLChart._getShapeObj(k,"chart");f.isChartSeries||(n("#"+u._id+"_crxaxis").val(f.xRange?u._getAlphaRange(e,f.xRange[0],f.xRange[1],f.xRange[2],f.xRange[3]):""),n("#"+u._id+"_cryaxis").val(f.yRange?u._getAlphaRange(e,f.yRange[0],f.yRange[1],f.yRange[2],f.yRange[3]):""),n("#"+u._id+"_crlaxis").val(f.lRange?u._getAlphaRange(e,f.lRange[0],f.lRange[1],f.lRange[2],f.lRange[3]):""),u._selectDataval={xRange:n("#"+u._id+"_crxaxis").val(),yRange:n("#"+u._id+"_cryaxis").val(),lRange:n("#"+u._id+"_crlaxis").val()},n("#"+u._id+"_chartrangedlg").ejDialog("open"));break;case"HideSheet":u.hideSheet();break;case"UnhideSheet":u._showDialog(u._id+"_UnhideSheet");break;case"ProtectSheet":u.protectSheet(!s.isSheetProtected);break;case"FormatCells":u._showDialog(u._id+"_FormatCells");break;case"Refresh":u.XLPivot.refreshDataSource();break;case"BackgroundColor":n("#"+this.XLObj._id+"_colordlg").ejDialog("open");this._selColor={action:"bg-color",color:""};break;case"FontColor":n("#"+this.XLObj._id+"_colordlg").ejDialog("open");this._selColor={action:"color",color:""};break;case"Modify":this._modifyClick=!0;u._showDialog(this.XLObj._id+"_CustomCellDialog");this._oldCustomName=n("#"+this.XLObj._id+"_StyleName").val();break;case"DeleteStyle":u.XLFormat.deleteCustomStyle(this._target);break;case"Apply":u.XLFormat.applyCustomCellStyle(this._target)}},_disableMenuOpt:function(t,i){var e=i||"contextMenuCell",u=n("#"+this.XLObj._id+"_"+e).data("ejMenu"),r,f;if(u)for(r=0,f=t.length;r<f;r++)u.disableItemByID(t[r])},_enableMenuOpt:function(t,i){var e=i||"contextMenuCell",u=n("#"+this.XLObj._id+"_"+e).data("ejMenu"),r,f;if(u)for(r=0,f=t.length;r<f;r++)u.enableItemByID(t[r])},_initColorDialog:function(){var r=this.XLObj,i=r._id+"_colordlg";if(!n("#"+i).length){var u=t.buildTag("div#"+i+".e-colordlg e-"+r._id+"-dlg ","",{display:"none"}),f=t.buildTag("div#"+i+"_dlgcontent .e-colordlgcontent"),h=t.buildTag("input#"+i+"_cpicker"),c=t.buildTag("div#"+i+"_condiv .e-dlg-btnctnr"),e=t.buildTag("input#"+this._id+"_dialog_Ok"),o=t.buildTag("input#"+this._id+"_dialog_Can","",{"margin-left":10}),s=t.buildTag("div#"+i+"_dlgbtncontent .e-dlg-btnfields");f.append(h);u.append(f);r.element.append(u);u.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,title:r._getLocStr("ColorPicker"),width:"240",height:"auto",minHeight:0,cssClass:"e-ss-dialog e-"+r._id+"-dlg"});n("#"+i+"_cpicker").ejColorPicker({value:"#278787",modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",select:n.proxy(this._cpClickHandler,this),showApplyCancel:!1});n("#"+i+"_cpickerWrapper").hide();f.append(n("#"+i+"_cpicker_popup").css("display","block"));e.ejButton({text:r._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._colorOkClick,this),enabled:!0});o.ejButton({text:r._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._colorCanClick,this)});s.append(c.append(e,o));u.append(s)}},_cpClickHandler:function(n){this._selColor.color=n.value},_colorOkClick:function(){var t=this.XLObj;t.XLFormat.format({style:this._selColor.action==="bg-color"?{"background-color":this._selColor.color}:{color:this._selColor.color}});t._setSheetFocus();n("#"+t._id+"_colordlg").ejDialog("close")},_colorCanClick:function(){n("#"+this.XLObj._id+"_colordlg").ejDialog("close")}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.sorting=function(n){this.XLObj=n;this._isSortByFilter=!1};t.spreadsheetFeatures.sorting.prototype={_sortHandler:function(n){var o,y,p,w,b,k,d,l,h,c,g,s,a={},nt="",r={},i=this.XLObj,e=i.getActiveSheetIndex(),v={sheetIndex:e,reqType:"sorting",type:"actionBegin",action:n},u,f,tt;if(!i._trigActionBegin(v)){if(u=i.getSheet(e),f=u._selectedCells,nt=u.columns[u._activeCell.colIndex].field,this._isSortByFilter=!1,n!="PutCellColor"&&n!="PutFontColor"){if(!i.model.allowSorting||!u._selectedCells.length)return;if(f.length===1&&i.selectAll(!1),k=n==="Ribbon_SortZtoA"||n==="SortZtoA"?t.sortOrder.Descending:t.sortOrder.Ascending,d=i.XLEdit.getPropertyValue(u._activeCell.rowIndex,u._activeCell.colIndex,"tableName",e)||"",l=i._getTableID(d),t.isNullOrUndefined(l)){if(r=u.selectedRange.slice(0),h=r[0],c=r[1],h===r[2])return;for(w=i.XLEdit.getPropertyValue(h,c),o=h+1;o<=r[2];o++)if(!i._isHiddenRow(o)){b=i.XLEdit.getPropertyValue(o,c);break}y=i.isNumber(w)?t.Spreadsheet.CellType.Number:t.Spreadsheet.CellType.String;p=i.isNumber(b)?t.Spreadsheet.CellType.Number:t.Spreadsheet.CellType.String;i.XLEdit.getPropertyValue(h,c,"merge")||i.XLEdit.getPropertyValue(o,c,"merge")||i.XLEdit.getPropertyValue(r[0],r[1],"calcValue")||(y!=p||i.XLEdit.getPropertyValue(r[0],r[1],"wrap")||i.XLEdit.getPropertyValue(r[0],r[1],"isFilterHeader"))&&r[0]++}else r=u.tableManager[l].range.slice(0),r[0]++;this.sortByRange(r,nt,k)}else tt=f.length===1?this._selectSortRange(e,f[0]):u._startCell.rowIndex,g=i._getAlphaRange(e,tt,f[0].colIndex,f.length===1?f[0].rowIndex:u._endCell.rowIndex,f[0].colIndex),s=i.XLEdit.getPropertyValue(u._activeCell.rowIndex,u._activeCell.colIndex,"formats"),i.isUndefined(s)||(s["background-color"]&&(a["background-color"]=s["background-color"].toLowerCase()),s.color&&(a.color=s.color.toLowerCase()),this.sortByColor(n,a,g));f.length===1&&(i.XLSelection.selectRange(f[0],f[0],e),u._startCell=u._endCell=f[0],i.model.allowAutoFill&&i.XLDragFill.positionAutoFillElement());v={sheetIndex:e,reqType:"sorting",type:"actionComplete",action:n,operation:"sorting",range:r};i._trigActionComplete(v)}},_selectSortRange:function(n,t){for(var u=this.XLObj,r=u.getSheet(n).filterSettings.tableRange,i=0,f=r.length;i<f;i++)if(r[i].multifilterIdx.indexOf(t.colIndex)>-1&&t.rowIndex>r[i].startRow-1&&t.rowIndex<r[i].endRow+1)return r[i].startRow;return u.selectAll(),u.getSheet(n)._selectedCells[0].rowIndex},sortByColor:function(n,i,r){var f=this.XLObj;if(r=f._getRangeArgs(r,"object"),f.model.allowSorting&&!this._sortRangeAlert(r)&&!f.model.isReadOnly){var o=f.getActiveSheetIndex(),u={oprType:n},e,s,c=f.getSheet(o),h;h=c.columns[r[1]].field;t.isNullOrUndefined(i)||(n==="PutCellColor"?(i["background-color"]&&(i=i["background-color"]),u.operation="sortbgcolor",u.bgcolor=i):(i.color&&(i=i.color),u.operation="sortfgcolor",u.fgcolor=i),u.requestType=u.action="sortbycolor",u.sortColumn=h,u.selRange={startCell:{rowIndex:r[0],colIndex:r[1]},endCell:{rowIndex:r[2],colIndex:r[3]}},u.rangeData=f.getRangeDataAsObject(u.selRange.startCell,u.selRange.endCell,!0)[0],u.sortRange=r,e=r[0],t.isNullOrUndefined(e)||(s=f.XLFilter._createSelection(o,r[2],r[1],[]).endRowIndex,e=n==="PutCellColor"||n==="PutFontColor"?e:e,u.range=f.model.sheets[o]._selectedRange={startRow:e,endRow:s,dataSourceIndexes:[]},f._processBindings(u)))}},_getSortColorRange:function(n){var r=this.XLObj,i=r.getCell(n.rowIndex,n.colIndex),u=!1,s,t,e=0,h=!1,f=n.rowIndex,o=n.colIndex;if(i.text().length<1){for(t=f;t<f+2;t++)if(i=r.getCell(t,o),i.is(":visible")&&i.text().length>0){u=!0;e=t;break}if(!u){for(t=f;t>f-2;t--)t>-1&&(i=r.getCell(t,o),i.text().length===0&&t>0&&(i=r.getCell(t-1,o),i.text().length==0&&(h=!0)));if(!h)for(t=f-2;t>0;t--)if(i=r.getCell(t,o),i.is(":visible")&&i.text().length===0){s=t+1;u=!0;e=s;break}}}else for(t=f;t>=0;t--){if(i=r.getCell(t,o),i.is(":visible")&&i.text().length===0){s=t+1;u=!0;e=s;break}u||t!=0||(e=t,u=!0)}if(u)return e;r._showAlertDlg("Alert","Alert",null,630)},_sortRangeAlert:function(n){var t=this.XLObj,e,i,u=u?u:t.getActiveSheetIndex(),s,h=t.getSheet(u)._mergeColl,o=t.getObjectKeys(h),r,c,f,l;for(n=t._getRangeArgs(n,"object"),r=0,c=o.length;r<c;r++)for(e=t.getObjectKeys(h[o[r]]),f=0,l=e.length;f<l;f++)if(s=t._dataContainer.sheets[u][o[r]][e[f]].merge,i=t.getRangeIndices(s.mRange),n[0]<=i[0]&&n[2]>=i[2]||n[0]>=i[0]&&n[2]<i[2])return t._showAlertDlg("Alert","MergeSortAlert","",380),!0;return t.XLEdit._rangeHasProperty(n,"calcValue")?(t._showAlertDlg("Alert","FormulaSortAlert","",315),!0):!1},sortByRange:function(n,i,r){var f=this.XLObj;if(f.model.allowSorting&&!f.model.isReadOnly){var c,l=f.getActiveSheetIndex(),o=0,a=[],u={},v=[],e,y,s,h=f._getJSSheetHeader(l).find(".e-colselected").length;if(f.model.allowSorting){if(n=f._getRangeArgs(n,"object"),this._sortRangeAlert(n))return!0;if(this._isSortByFilter&&h<1){for(s=this._isSortByFilter?n[0]-1:n[0],y=f._getAlphaRange(l,s,n[1],s+1,n[3]),e=f._getAlphaRangeCells(y).find(".e-filterspan"),c=e.length;o<c;)v.push({colIndex:e[o].parentNode.cellIndex,rowIndex:e.eq(o).parents("tr").index()}),o++;e.length&&(n[0]=this._isSortByFilter?n[0]:n[0]+1)}return a=f.getRangeDataAsObject({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]},!0)[0],u.requestType=u.reqType=t.Spreadsheet.Actions.Sorting,u.range=n,u.columnName=i,u.rangeData=a,u.action="sorting",u.sortDirection=r,u.filterIcon=v,u.isSortByFilter=this._isSortByFilter,u.colSelected=h,u.isHightlightData=!1,f._processBindings(u),h&&this._isSortByFilter&&f.XLFilter._changeSortIcon({rowIndex:n[0]-1,colIndex:n[1]},r),!1}}},_sortComplete:function(n){var t=this.XLObj,i=n.range,r=this._swapSortedDatas(n),u=r[1];t._dupDetails=!0;n.rangeData=r[0];t.model.allowComments&&t.XLComment.deleteComment(i,null,!0,"comment");t._removeHyperlink(null,null,!0,i);t._isSort=!0;t.clearRangeData(i,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0);t.model.allowCellFormatting&&t.XLFormat.removeStyle(i,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0});t.XLEdit.updateCellWithContainer(u,i,null,!0);t._isSort=!1;t.refreshOverflow([i[0],i[1],i[2],i[3]],t.getActiveSheetIndex());this._refreshRowHeight(i,u);t._dupDetails=!1},_refreshRowHeight:function(n,t){for(var i,u,f=0,s=0,r=this.XLObj,e=r._getSheetIndex(),o=r.getSheet(e),h=r._getJSSheetContent(e).find(".e-content"),c=r._getJSSheetRowHeaderContent(e);n[0]+f<=n[2];){for(i=n[0]+f,u=(f-s)*(n[3]-n[1]+1);o.hideRowsCollection.indexOf(i)>-1||o._hiddenFreezeRows.indexOf(i)>-1&&i<n[2];)i++&&f++&&s++;!r.model.scrollSettings.allowVirtualScrolling&&t[u]&&(h.find("tr:eq("+i+")").height(t[u].rheight),c.find("tr:eq("+i+")").height(t[u].rheight));t[u]&&(o.rowsHeightCollection[i]=t[u].rheight);f++}r.XLScroll._getRowHeights(e,i);r.model.scrollSettings.allowVirtualScrolling&&r.refreshContent(e);o._isFreezed&&r.XLFreeze._refreshFreezeRowDiv()},_swapSortedDatas:function(t){for(var v,f,e,r,s=0,o=0,y=0,p=[],h=[],c=[],l=this.XLObj.getSheet(),w=t.model.currentViewData,k=w.length,d=this.XLObj._generateColCount(t.columnName)-1,b,i=t.range,a=i[3]-i[1]+1,g=d-i[1],u=this.XLObj.getRangeData({range:i,property:["value","value2","type","formatStr","formats","decimalPlaces","thousandSeparator","range","format","comment","hyperlink","rule"],skipHiddenRow:!0});i[0]+o<=i[2];){for(r=i[0]+o,f=(o-y)*(i[3]-i[1]+1);(l.hideRowsCollection.indexOf(r)>-1||l._hiddenFreezeRows.indexOf(r)>-1)&&r<i[2];)r++&&o++&&y++;u[f]&&(u[f].rheight=l.rowsHeightCollection[r]);o++}for(n.extend(!0,p,u),h.push(p);s<k;){for(v=w[s][t.columnName],e=g,b=u.length;e<b;){if(u[e].value===v){f=this._getMinIdx(e,a);c=c.concat(u.splice(f,a));break}e+=a}s++}return h.push(c),h},_getMinIdx:function(n,t){var i,r;if(i=r=t,n<t)return 0;while(i<=n){if(r+=t,r>n)return i;i+=t}}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.dragAndDrop=function(n){this.XLObj=n;this._isDragAndDropStart=!1;this._dragAndDropCell={rowIndex:0,colIndex:0};this._isDragAndDropped=!1;this._allowDragAndDrop=!1;this._target=null;this._cellIdx={}};t.spreadsheetFeatures.dragAndDrop.prototype={moveRangeTo:function(n,t){this._moveRangeTo(n,t)},_moveRangeTo:function(i,r,u){var f=this.XLObj,o,p,it,k;if(f.model.allowDragAndDrop&&!f.model.isReadOnly&&f.model.allowEditing){var s,a,b,e,d,c,v,y,g,h,rt,l,nt=[],tt=[],ut=[],w;for(s=f.getActiveSheetIndex(),a=f.getSheet(s),i=f.swapRange(f._toIntrnlRange(i,s)),r=f.swapRange(f._toIntrnlRange(r,s)),r[2]=r[0]+(i[2]-i[0]),r[3]=r[1]+(i[3]-i[1]),c={rowIndex:r[0],colIndex:r[1]},v={rowIndex:r[2],colIndex:r[3]},u=u||["value","value2","type","formatStr","decimalPlaces","thousandSeparator","range","format","border","borders","comment","hyperlink","picture","cFormatRule","rule","chart","isLocked","wrap","formats","tformats","tborders","isFilterHeader","filterState","isFilterVisible","tableName"],b=f.getRangeData({range:i,property:u}),f.model.allowCellFormatting&&(d=f.XLFormat.getHashCodeClassAsArray(i)),f.model.allowConditionalFormats&&(y=f.XLEdit.getPropertyValue(i[0],i[1],"cFormatRule")),!f.isUndefined(y)&&y.length>0&&(h=y[0].split("_"),y={action:h[0],inputs:[h[2],h[3]],color:h[4],range:h[5]}),o=i[0];o<=i[2];o++)for(nt.push({rowIndex:o,height:a.rowsHeightCollection[o]}),p=i[1];p<=i[3];p++)f.XLEdit.getPropertyValue(o,p,"wrap")&&f.setWrapText("unwrap",f._getAlphaRange(s,o,p,o,p));if(e={sheetIndex:s,reqType:"reorder-cells",sourceData:n.extend(!0,[],b),sourceRange:i,destinationRange:r,sourceFormat:d,destinationFormat:f.model.allowCellFormatting&&f.XLFormat.getHashCodeClassAsArray(r),destinationData:f.getRangeData({range:r}),sourceCFormat:y,sourceHeight:nt,property:u},f.XLRibbon._isDirtySelect){f._showAlertDlg("Alert","DragAlert",null,440);f.performSelection(i);return}if(l=f._checkTableRange(f._getAlphaRange(s,i[0],i[1],i[2],i[3])),w=f._checkFilterRange(f._getAlphaRange(s,i[0],i[1],i[2],i[3])),f._dupDetails=!0,l.status==="full")e.tblObj=l.tableObj,e.tblObj.tblId=l.tblId,e.tblObj.header=!0,f.XLFormat.removeTable(l.tblId),f.XLFormat.removeStyle(l.range);else if(w.status==="full")e.tRange=w.tRange,f.XLFilter.clearFilter("remove");else if(l.status==="partial"||w.status==="partial"||f.XLRibbon._isFilterSelect.isFiltered){f._showAlertDlg("Alert","DragAlert",null,440);f.performSelection(i);return}for(f.model.allowComments&&f.XLComment.deleteComment(),f._ddCellSave=!0,f.clearRangeData(i,u),f.clearRangeData(r,u),t.isNullOrUndefined(f._ddlCell)||(f.element.find("#"+f._id+"ddl").ejDropDownList("hidePopup"),f.element.find("#"+f._id+"ddlspan").remove(),f._ddlCell=null),f.model.allowCellFormatting&&!f.XLRibbon._isDirtySelect&&(f.XLFormat.removeStyle(i),f.XLFormat.removeStyle(r,{cellStyle:!0,format:!0,border:!0})),f.model.allowConditionalFormats&&f.XLCFormat.clearCF(i,!0),b[0].cFormatRule=[],e.tblObj&&(e.tblObj.destrange=f._getAlphaRange(s,r[0],r[1],r[2],r[3]),f.XLClipboard._isCut=!0,f.XLFormat.createTable(e.tblObj,e.tblObj.destrange),f.XLClipboard._isCut=!1),this._dragDefineName(i,r,s),it=0,k=n.extend(!0,[],a.rowsHeightCollection),o=r[0];o<=r[2];o++)ut.push({rowIndex:o,height:k[o]}),tt.push({rowIndex:f._getRowIdx(o),height:k[o]>20?k[o]:nt[it].height}),it++;f.updateData(b,r);f._ddCellSave=!1;w.tRange&&(f.XLFilter.filter(f._getAlphaRange(s,r[0],r[1],r[2],r[3])),f._dupDetails=!1);e.tblObj&&e.tblObj.totalRow&&f.XLFormat._updateTotalRow(s,e.tblObj.tblId,e.tblObj.fnNumber,r,!1);f.model.allowCellFormatting&&f.XLFormat.updateFormat(d,r);f.model.allowConditionalFormats&&!f.isUndefined(h)&&(rt=f._getAlphaRange(1,r[0],r[1],r[2],r[3]),g={action:h[0],inputs:[h[2],h[3]],color:h[4],range:rt},e.destinationCFormat=g,f.XLCFormat.setCFRule(g));f.setHeightToRows(tt);e.destHeight=tt;e.prevDestRowHt=ut;f.setActiveCell(c.rowIndex,c.colIndex);f.model.allowSelection&&(c.rowIndex||v.rowIndex!==a.rowCount-1?c.colIndex||v.colIndex!==a.colCount-1?f.XLSelection.selectRange(c,v):f.XLSelection.selectRows(c.rowIndex,v.rowIndex):f.XLSelection.selectColumns(c.colIndex,v.colIndex),a._isFreezed&&f.XLFreeze._refreshSelection());f._dupDetails=!1;f._isUndoRedo||!f.XLFormat||f.XLFormat._isFAT||(f._completeAction(e),f._trigActionComplete(e))}},_dragDefineName:function(n,t,i){var nt,c,r=this.XLObj,p=r.model.nameManager,tt=p.length,w=r._getSelectedCells(i,n).selCells,l,b,a,k,it=r.getSheet(i),rt=r._getSelectedCells(i,t).selCells,ut,f,e,s,v=r._calcEngine,d,g,y,o,u,h;if(tt){for(o=0;o<tt;o++)if(s=r._getRangeArgs(r.XLRibbon._getAddrFromDollarAddr(p[o].refersto)[1],"object"),r.XLClipboard._compareRange(n,s))for(u=0;u<w.length;u++)w[u].rowIndex==s[0]&&w[u].colIndex==s[3]&&(f=rt[u].rowIndex,e=rt[u].colIndex,nt=v.getDependentCells().items,c=Object.keys(nt)[o],c&&(d=c.split("!")[2],g=r._getRangeArgs(s,"string"),d==g&&(p[o].refersto=r._getDollarAlphaRange([f,e,f,e])),y=v.getDependentCells().remove("!0!"+d),l=c.replace(g,r._getRangeArgs([f,e,f,e],"string")),v.getDependentCells().add(l,y),ut=!0));if(k=Object.keys(it._formulaCollection).length,k)for(h=0;h<k;h++)ut&&y[h]&&(b=r._getRangeArgs(y[h].split("!")[2],"object"),a=it._formulaCollection[b[0]][b[1]],a._formulaValue=r.XLEdit.getPropertyValue(f,e,"value2",i),a._parsedFormula=l,v.getNamedRanges().items[a._formulaText.split("=")[1].toUpperCase()]=l)}},_dMouseHover:function(n){var r,e,o,s,h,i,l,u,f,a=n.target,t=this.XLObj,v=t.getActiveSheetIndex(),c=t.getSheet(v).selectedRange;if(t._hasClass(a,"e-rowcell")&&(r=t._getCellIdx(a)),r&&t.inRange(c,r.rowIndex,r.colIndex)&&(r.rowIndex===c[0]||r.rowIndex===c[2]||r.colIndex===c[1]||r.colIndex===c[3])&&!t._isTouchEvt&&(i=n.target.getBoundingClientRect(),l=t._setXY(n),u=l[0],f=l[1],e=u-t.getFocusLeftElem().offset().left,e=e>=0&&e<=5,o=f-t.getFocusTopElem()[0].getBoundingClientRect().top,o=o>=0&&o<=5,s=t.getFocusRightElem().offset().left-u,s=s>=0&&s<=5,h=t.getFocusBottomElem()[0].getBoundingClientRect().top-f,h=h>=0&&h<=5,e&&u<=i.left+5&&u>=i.left||o&&f<=i.top+5&&f>=i.top||s&&u>=i.right-5&&u<=i.right||h&&f>=i.bottom-5&&f<=i.bottom)){t.addClass(a,"e-cursormove");this._isDragAndDropStart=!0;return}this._isDragAndDropStart&&!t._isTouchEvt&&(t._getContent(v).find(".e-cursormove").removeClass("e-cursormove"),this._isDragAndDropStart=!1)},_dragtouch:function(n,t){var r,u,f,e,i=this.XLObj;r=n-i.getFocusLeftElem().offset().left;u=t-i.getFocusTopElem().offset().top;f=i.getFocusRightElem().offset().left-n;e=i.getFocusBottomElem().offset().top-t;this._isDragAndDropStart=r>=-10&&r<=10||u>=-5&&u<=0||f>=-10&&f<=10||e>=-5&&e<=0?!0:!1},_dMouseDown:function(n){var t=this.XLObj,r,u,i;!t.model.isReadOnly&&t.model.allowEditing&&((u=t.getActiveSheetIndex(),i=t.getSheet(u),n.preventDefault(),n.stopImmediatePropagation(),r=t.swapRange([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex]),n.target.nodeName==="TD"&&(this._dragAndDropCell=t._getCellIdx(n.target)),t._dStartCell={rowIndex:r[0],colIndex:r[1]},t._dEndCell={rowIndex:r[2],colIndex:r[3]},t._trigger("dragStart",{sheetIndex:u,target:n.target,currentCell:this._dragAndDropCell,dragAndDropRange:{startCell:i._startCell,endCell:i._endCell}}))||(this._allowDragAndDrop=!0))},_dMouseMove:function(n){if(this._allowDragAndDrop){var i=this.XLObj,e=i.getActiveSheetIndex(),t=i.getSheet(e),u=n.target,r=i._getCellIdx(u),f;if(i._isTouchEvt&&(f=i._getOriginalEvt(n),u=document.elementFromPoint(f.clientX,f.clientY),u.parentNode&&u.parentNode.attributes.getNamedItem("data-idx")&&(r=i._getCellIdx(u))),i._trigger("drag",{sheetIndex:e,target:u,currentCell:r,dragAndDropRange:{startCell:t._startCell,endCell:t._endCell}}))return;i._isFrozen(t.frozenRows)&&this._isDragAndDropped&&t._frozenRows-1<t._ftopRowIdx&&t._startCell.rowIndex>t._frozenRows-1&&r.rowIndex<t._frozenRows-1&&(r.rowIndex=t._ftopRowIdx);i._isFrozen(t.frozenColumns)&&this._isDragAndDropped&&t._frozenColumns-1<t._fleftColIdx&&t._startCell.colIndex>t._frozenColumns-1&&r.colIndex<t._frozenColumns-1&&(r.colIndex=t._fleftColIdx);this._cellIdx=r;i.XLSelection._focusBorder(t._startCell,t._endCell,i._thinBorder);this._updateDCells(r);t._isFreezed?this._refreshFocusRange():i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder)}else this.XLObj._isTouchEvt||this._dMouseHover(n)},_refreshFocusRange:function(){var t=this.XLObj,n=t.getSheet(),u=t._dEndCell.colIndex,f=t._dEndCell.rowIndex,i=t._dStartCell.colIndex,r=t._dStartCell.rowIndex;n._frozenRows-1<n._ftopRowIdx&&(n._startCell.rowIndex<n._frozenRows-1?f>=n._frozenRows-1&&(f<n._ftopRowIdx?f=n._frozenRows-2:f>n._ftopRowIdx&&r<n._ftopRowIdx&&(r=n._ftopRowIdx)):r=r<n._ftopRowIdx&&r>n._frozenRows-1?n._ftopRowIdx:t._dStartCell.rowIndex);n._frozenColumns-1<n._fleftColIdx&&(n._startCell.colIndex<n._frozenColumns-1?u>=n._frozenColumns-1&&(u<n._fleftColIdx?u=n._frozenColumns-2:u>n._fleftColIdx&&i<n._fleftColIdx&&(i=n._fleftColIdx)):i=i<n._fleftColIdx&&i>n._frozenColumns-1?n._fleftColIdx:t._dStartCell.colIndex);t.XLSelection._focusRange({rowIndex:r,colIndex:i},{rowIndex:f,colIndex:u},t._autofillBorder)},_dMouseUp:function(t){var f,s;if(this._isDragAndDropped){var i=this.XLObj,o=!0,u=i.getActiveSheetIndex(),r=i.getSheet(u),h=n("#vscrollBar").data("ejScrollBar"),c=n("#hscrollBar").data("ejScrollBar"),l=!1,e=[i._dStartCell.rowIndex,i._dStartCell.colIndex,i._dEndCell.rowIndex,i._dEndCell.colIndex],a={rowIndex:-1,colIndex:-1},v={sheetIndex:u,isAlert:!1,target:t.target,currCell:this._dragAndDropCell,dragAndDropRange:{startCell:r._startCell,endCell:r._endCell}},y=i._arrayAsString(i._thinBorder);if(i.model.scrollSettings.allowScrolling&&i._dEndCell.rowIndex>r.rowCount){for(f=0,s=i._dEndCell.rowIndex-i._dStartCell.rowIndex;f<s;f++)i.XLScroll._createNewRow(u,-1,-1,"insert");h._scrollData.step=1;h.scroll(r._scrollTop+(i._dEndCell.rowIndex-i._dStartCell.rowIndex)*r.rowHeight)}if(i._dEndCell.colIndex>r.colCount){for(f=0,s=i._dEndCell.colIndex-i._dStartCell.colIndex;f<s;f++)i.XLScroll._createNewColumn(u,a,a,"insert");c._scrollData.step=1;c.scroll(r._scrollLeft+(i._dEndCell.colIndex-i._dStartCell.colIndex)*r.columnWidth)}if(this._target=t.target,i._isUniqueRange(r.selectedRange,i.swapRange(e)))this._preventDrop(r);else{if(i.model.allowLockCell&&r.isSheetProtected&&i._isPropExists([e,r.selectedRange],"isLocked",u)&&(o=!1),o&&i._isPropExists([e,r.selectedRange],"isReadOnly",u)&&(o=!1),!o){this._preventDrop(r);i.XLSelection._clearBorder(y);this._allowDragAndDrop=this._isDragAndDropStart=this._isDragAndDropped=!1;return}l=i._trigger("beforeDrop",v);v.isAlert||l||!i._rangeHasData(e)?i._rangeHasData(e)?this._preventDrop(r):(this.moveRangeTo([r._startCell.rowIndex,r._startCell.colIndex,r._endCell.rowIndex,r._endCell.colIndex],[i._dStartCell.rowIndex,i._dStartCell.colIndex,i._dEndCell.rowIndex,i._dEndCell.colIndex]),r._startCell=i._dStartCell,r._endCell=i._dEndCell,r._isFreezed&&i.XLFreeze._refreshSelection()):i._showAlertDlg("","DropAlert","Drop",498)}i.XLSelection._clearBorder(y);i.model.allowAutoFill&&i.XLDragFill.positionAutoFillElement()}this._allowDragAndDrop=this._isDragAndDropStart=this._isDragAndDropped=!1},_scrollHover:function(t){var u,f,s,i=this.XLObj,h=i.getActiveSheetIndex(),r=i.getSheet(h),c=this._cellIdx.colIndex,l=this._cellIdx.rowIndex,a=i.XLScroll,e=a._vScroller(h),o=a._hScroller(h);n(t.target).parents(".e-vscrollbar").length>0?f=setInterval(function(){u=r._scrollLeft+(i._isFrozen(r.frozenColumns)?r.columnsWidthCollection[r._fleftColIdx]:r.columnWidth);o._scrollData.step=1;o.scroll(u);i.XLSelection._focusBorder(r._startCell,r._endCell,i._thinBorder);i.XLDragDrop._updateDCells({rowIndex:l,colIndex:r._rightCol.idx-1});i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder);return},200):t.target.className.indexOf("e-rowheader")>-1?f=setInterval(function(){u=r._scrollLeft-r.columnWidth;o._scrollData.step=-1;u>-1?o.scroll(u):o.scroll(0);i.XLSelection._focusBorder(r._startCell,r._endCell,i._thinBorder);i.XLDragDrop._updateDCells({rowIndex:l,colIndex:r._leftCol.idx});i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder);return},200):n(t.target).parents(".e-spreadsheetfooter").length>0||t.target.className.indexOf("e-spreadsheetfooter")>-1||n(t.target).parents(".e-hscrollbar").length>0?f=setInterval(function(){i.model.scrollSettings.allowVirtualScrolling?r._isVirtualEndReached?e.scroll(r._scrollTop):e.scroll(r._scrollTop+(i._isFrozen(r.frozenRows)?r.rowsHeightCollection[r._ftopRowIdx]:r.rowHeight)):(e._scrollData.step=1,e.scroll(r._scrollTop+(i._isFrozen(r.frozenRows)?r.rowsHeightCollection[r._ftopRowIdx]:r.rowHeight)));i.XLSelection._focusBorder(r._startCell,r._endCell,i._thinBorder);i.XLDragDrop._updateDCells({rowIndex:r._bottomRow.idx-1,colIndex:c});i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder);return},200):t.target.className.indexOf("e-headercell")>-1?f=setInterval(function(){u=r._scrollTop-r.rowHeight;e._scrollData.step=-1;u>-1?e.scroll(u):e.scroll(0);i.XLSelection._focusBorder(r._startCell,r._endCell,i._thinBorder);i.XLDragDrop._updateDCells({rowIndex:r._topRow.idx,colIndex:c});i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder);return},200):t.target.className.indexOf("e-rowcell")>-1&&(s=i._getCellIdx(t.target),i._isFrozen(r.frozenRows)&&s.rowIndex<r._frozenRows-1&&r._startCell.rowIndex>=r._frozenRows-1&&(f=setInterval(function(){if(i._dStartCell.rowIndex>r._ftopRowIdx||!i.XLDragDrop._isDragAndDropped||r._frozenRows-1===r._ftopRowIdx){(i._dStartCell.colIndex>r._fleftColIdx||!i.XLDragDrop._isDragAndDropped||r._frozenColumns-1===r._fleftColIdx)&&clearInterval(f);return}u=r._scrollTop-r.rowHeight;e._scrollData.step=-1;u>-1?e.scroll(u):e.scroll(0);i.XLSelection._focusBorder(r._startCell,r._endCell,i._thinBorder);i.XLDragDrop._updateDCells({rowIndex:r._ftopRowIdx,colIndex:i.XLDragDrop._cellIdx.colIndex});i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder);i.XLDragDrop._refreshFocusRange();return},200)),i._isFrozen(r.frozenColumns)&&s.colIndex<r._frozenColumns-1&&r._startCell.colIndex>=r._frozenColumns-1&&(f=setInterval(function(){if(i._dStartCell.colIndex>r._fleftColIdx||!i.XLDragDrop._isDragAndDropped||r._frozenColumns-1===r._fleftColIdx){(i._dStartCell.rowIndex>r._ftopRowIdx||!i.XLDragDrop._isDragAndDropped||r._frozenRows-1===r._ftopRowIdx)&&clearInterval(f);return}u=r._scrollLeft-r.columnWidth;o._scrollData.step=-1;u>-1?o.scroll(u):o.scroll(0);i.XLSelection._focusBorder(r._startCell,r._endCell,i._thinBorder);i.XLDragDrop._updateDCells({rowIndex:i.XLDragDrop._cellIdx.rowIndex,colIndex:r._fleftColIdx});i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder);i.XLDragDrop._refreshFocusRange();return},200)));i._browserDetails.name==="msie"&&i._browserDetails.version==="8.0"?(t.target.attachEvent("onmouseleave",function(){clearInterval(f);return}),document.attachEvent("onmouseleave",function(){clearInterval(f);return}),t.target.attachEvent("onmouseup",function(){clearInterval(f);return})):(t.target.addEventListener("mouseleave",function(){clearInterval(f);return}),document.addEventListener("mouseleave",function(){clearInterval(f);return}),t.target.addEventListener("mouseup",function(){clearInterval(f);i.XLDragDrop._dMouseUp(t);return}))},_preventDrop:function(n){var t=this.XLObj;t.XLSelection._focusRange(n._startCell,n._endCell,t._selectionBorder);t._dStartCell=n._startCell;t._dEndCell=n._endCell},_updateDCells:function(n){var t=this.XLObj,u=t.getActiveSheetIndex(),i=t.getSheet(u),r=t.isRange(i.selectedRange);i._isColSelected&&t.inRange(i.selectedRange,0,i._startCell.colIndex)||(n.rowIndex<this._dragAndDropCell.rowIndex&&t._dStartCell.rowIndex?(t._dStartCell.rowIndex=t._dStartCell.rowIndex-(this._dragAndDropCell.rowIndex-n.rowIndex),t._dEndCell.rowIndex=r?t._dEndCell.rowIndex-(this._dragAndDropCell.rowIndex-n.rowIndex):t._dStartCell.rowIndex):n.rowIndex>this._dragAndDropCell.rowIndex&&(t._dStartCell.rowIndex=t._dStartCell.rowIndex+(n.rowIndex-this._dragAndDropCell.rowIndex),t._dEndCell.rowIndex=r?t._dEndCell.rowIndex+(n.rowIndex-this._dragAndDropCell.rowIndex):t._dStartCell.rowIndex));i._isRowSelected&&t.inRange(i.selectedRange,i._startCell.rowIndex,0)||(n.colIndex<this._dragAndDropCell.colIndex&&t._dStartCell.colIndex?(t._dStartCell.colIndex=t._dStartCell.colIndex-(this._dragAndDropCell.colIndex-n.colIndex),t._dEndCell.colIndex=r?t._dEndCell.colIndex-(this._dragAndDropCell.colIndex-n.colIndex):t._dStartCell.colIndex):n.colIndex>this._dragAndDropCell.colIndex&&(t._dStartCell.colIndex=t._dStartCell.colIndex+(n.colIndex-this._dragAndDropCell.colIndex),t._dEndCell.colIndex=r?t._dEndCell.colIndex+(n.colIndex-this._dragAndDropCell.colIndex):t._dStartCell.colIndex));this._dragAndDropCell=n;this._isDragAndDropped=!0}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.exporting=function(n){this.XLObj=n;this._exportType=""};t.spreadsheetFeatures.exporting.prototype={"export":function(i,r){var u=this.XLObj,o,p,s,f,e,c,l,a,w,v,h,y;if(u.model.exportSettings.allowExporting&&!u.model.isReadOnly)if(t.isNullOrUndefined(r)&&(r="Sample"),o=u.model.exportSettings,c=i===t.Spreadsheet.exportType.Excel?o.excelUrl:i===t.Spreadsheet.exportType.Csv?o.csvUrl:o.pdfUrl,l=this.getExportProps(),h={exportType:i,url:c,customParams:{}},a=t.raiseWebFormsServerEvents?i.toLowerCase()+"Exporting":"",t.raiseWebFormsServerEvents&&u.model.serverEvents&&u.model.serverEvents.indexOf(a)>-1){if(w={model:n.extend(!0,{},u.model),originalEventType:a},v={sheetModel:l.model,sheetData:l.data,fileName:r,password:o.password?o.password:""},u._trigger("onExport",h))return;u.getObjectLength(h.customParams)&&n.extend(v,h.customParams);t.raiseWebFormsServerEvents(a,w,v);setTimeout(function(){t.isOnWebForms=!0},1e3)}else{if(t.isNullOrUndefined(c)){u._showAlertDlg("Alert","ImportExportUrl","",266);return}if(!o.allowExporting||u.isUndefined(c))return;if(u._trigger("onExport",h))return;c=h.url;p={action:c,method:"post"};s=t.buildTag("form","",null,p);f={name:"sheetData",type:"hidden",value:l.data};e=t.buildTag("input","",null,f);s.append(e);f={name:"sheetModel",type:"hidden",value:l.model};e=t.buildTag("input","",null,f);s.append(e);f={name:"fileName",type:"hidden",value:r};e=t.buildTag("input","",null,f);s.append(e);f={name:"Password",type:"hidden",value:o.password};e=t.buildTag("input","",null,f);s.append(e);for(y in h.customParams)f={name:y,type:"hidden",value:h.customParams[y]},e=t.buildTag("input","",null,f),s.append(e);n("body").append(s);s.submit()}},_getRequriedProp:function(n){for(var r=this.XLObj,i={},f,u=["sheetCount","activeSheetIndex","nameManager","exportSettings"],s,o,h,c,t=0,e=u.length;t<e;t++)i[u[t]]=n[u[t]];for(r.model.allowCellFormatting&&r.getObjectLength(r.XLFormat._customFontFamily)>0&&(i.customFontFamily=r.XLFormat._customFontFamily),r._isDefaultLocked&&(i.ExcelLikeLockedCells=!0),o=n.sheets,i.sheets=[],r._calcEngine.getCalculatingSuspended()&&(i.IsManualCalculation=!0),r.model.exportSettings.enableFormulaCalculation&&(i.exportSettings.EnableFormulaCalculation=!0),u=["paperSettings","_activeCell","_endCell","_startCell","colCount","columnsWidthCollection","rowsHeightCollection","rowCount","frozenColumns","frozenRows","usedRange","dataAttribute","filterSettings","tableManager","sheetInfo","hideColsCollection","hideRowsCollection","showGridlines","showHeadings","isSheetProtected","shapeMngr","chart","pivotMngr","topLeftCell","paneTopLeftCell","formulaRange"],t=0,c=o.length;t<c;t++)for(i.sheets[t]={},h=i.sheets[t],s=o[t],f=0,e=u.length;f<e;f++)h[u[f]]=s[u[f]];return i},getExportProps:function(){var f=this.XLObj,r,o,e,y,k,p,w,s,h;f._isExport=!0;this._renderAll();f._isExport=!1;var d=n.extend(!0,{},f._dataContainer),i={},c=[],t,l,u={},v,a,b;for(f._refreshHashCode(d.hashCode),i=JSON.parse(JSON.stringify(f.model)),r=1;r<i.sheets.length;r++){for(u={},n.extend(!0,u,i.sheets[r].shapeMngr.chart),c=f.getObjectKeys(u),i.sheets[r].shapeMngr.chart={},o=0,y=c.length;o<y;o++)if(t=u[c[o]].id,p=n("#"+t).data("ejChart"),p){for(p.model.event=null,w=JSON.parse(JSON.stringify(p.model)),s=w.series,e=0,k=s.length;e<k;e++)delete s[e].dataSource,delete s[e].query,s[e].fill=jQuery.type(s[e].fill)=="array"?s[e].fill[0].color:s[e].fill;if(w.dataSheetIdx=u[t].dataSheetIdx,i.sheets[r].shapeMngr.chart[t]=w,u[t].isChartSeries)for(a=u[t].seriesRange,i.sheets[r].shapeMngr.chart[t].seriesRange=a,h=0;h<a.length;h++)b=i.sheets[r].shapeMngr.chart[t].seriesRange[h],b.xRange=a[h].xRange,b.yRange=a[h].yRange,b.lRange=a[h].lRange;else v=u[t].range,i.sheets[r].shapeMngr.chart[t].range=f._generateHeaderText(v[1]+1)+(v[0]+1)+":"+f._generateHeaderText(v[3]+1)+(v[2]+1);i.sheets[r].shapeMngr.chart[t].top=u[t].top;i.sheets[r].shapeMngr.chart[t].left=u[t].left;i.sheets[r].shapeMngr.chart[t].height=u[t].height;i.sheets[r].shapeMngr.chart[t].width=u[t].width;i.sheets[r].shapeMngr.chart[t].isRowColSwitched=u[t].isRowColSwitched}for(c=f.getObjectKeys(i.sheets[r].pivotMngr.pivot),o=0,y=c.length;o<y;o++)t=c[o],l=n("#"+t).data("ejPivotGrid"),l&&(i.sheets[r].pivotMngr.pivot[t].rows=l.getOlapReport().rows,i.sheets[r].pivotMngr.pivot[t].columns=l.getOlapReport().columns,i.sheets[r].pivotMngr.pivot[t].filters=l.getOlapReport().filters,i.sheets[r].pivotMngr.pivot[t].values=l.getOlapReport().values)}return i.sheets.shift(),{model:JSON.stringify(this._getRequriedProp(i)),data:JSON.stringify(d)}},_renderAll:function(){for(var r,i,u,n=this.XLObj,f=n.getSheets(),e=n.getActiveSheetIndex(),t=1;t<f.length;t++)if(i=f[t],n.model.importSettings.allowSheetOnDemand&&i._isImported&&!i._isRequested&&n._importSheet(t,!1),i._isLoaded||n.gotoPage(t),n.model.scrollSettings.allowVirtualScrolling&&!i._isImported&&i._hasDataSrc)for(r=1;r<=i._virtualBlockCnt;r++)i._virtualDataLoadedBlks.indexOf(r)===-1&&(i._virtualDataLoadedBlks.push(r),u=this._getRange(r,t),n._refreshDataSrc(u,t),n._refreshCellData(u,t));n.hideWaitingPopUp();n.gotoPage(e)},_getRange:function(n,t){var u=this.XLObj,i=u.getSheet(t),r=[0,0,0,i.colCount-1];return r[0]=i._virtualBlockRowCnt*(n-1),r[2]=i._virtualBlockRowCnt*n-1,r},_exportFileNameDlg:function(){var i=this.XLObj,r,o,u,f,e,s;r=t.buildTag("div","","",{id:i._id+"_ExportFileNameDialog"});e=t.buildTag("div.e-dlg-btnfields");s=t.buildTag("div.e-dlg-btnctnr");o="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields'><td><label>"+i._getLocStr("FileName")+":<\/label><\/td><td><form id='"+i._id+"_Form_xlFileName' onsubmit='return false'><input id ='"+i._id+"_xlFileName' type ='text' value = 'Sample' class = 'ejinputtext'/><\/form><\/td><\/tr><\/table><\/div>";r.append(o);u=t.buildTag("input","","",{type:"submit"});f=t.buildTag("input");u.ejButton({text:i._getLocStr("Save"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgSave,this),enabled:!0,cssClass:"e-ss-okbtn"});f.ejButton({text:i._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,i),showRoundedCorner:!0,width:60});e.append(s.append(u,f));r.append(e);r.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("SaveFile"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dlgCancel,i),open:t.proxy(function(){var t=n("#"+i._id+"_xlFileName");t.focus().setInputPos(t.val().length).select()})});i.XLRibbon._dialogValidate("_xlFileName")},_dlgSave:function(){var r=this.XLObj,i=r._id;n("#"+i+"_Form_xlFileName").valid()&&(this["export"](t.Spreadsheet.exportType[this._exportType],n("#"+i+"_xlFileName").val()),n("#"+i+"_ExportFileNameDialog").ejDialog("close"))},_dlgCancel:function(){n("#"+this._id+"_ExportFileNameDialog").ejDialog("close")}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.findnreplace=function(n){this.XLObj=n;this._findCount=0;this._isApplied=!1;this.caseSen={"true":function(n){return n.toString()},"false":function(n){return n.toString().toLowerCase()}};this.isEMatch={"true":function(n,t){return n==t},"false":function(n,t){if(!n.length||t.length)return n.indexOf(t)>-1}}};t.spreadsheetFeatures.findnreplace.prototype={replaceAllBySheet:function(n,t,i,r){this.XLObj.model.allowSearching&&this.XLObj.model.allowEditing&&!this.XLObj.model.isReadOnly&&this._replaceAllData(n,t,i,r,"value","sheet")},replaceAllByBook:function(n,t,i,r){this.XLObj.model.allowSearching&&this.XLObj.model.allowEditing&&!this.XLObj.model.isReadOnly&&this._replaceAllData(n,t,i,r,"value","workbook")},findNext:function(n,i,r){t.isNullOrUndefined(r)&&(r=this.XLObj.getActiveSheetIndex());this._findNext(n,r,i.isCSen,i.isEMatch,i.type,i.mode,i.searchBy)},findPrevious:function(n,i,r){t.isNullOrUndefined(r)&&(r=this.XLObj.getActiveSheetIndex());this._findPrev(n,r,i.isCSen,i.isEMatch,i.type,i.mode,i.searchBy)},_findNext:function(n,t,i,r,u,f,e){var s,h,y,ct,tt,w,b,a,p,ot,it,rt,v,k,d,lt,ut,ft,g=[],l=e==="rows",c=this.XLObj,st=!1,nt=t?t:c.getActiveSheetIndex(),ht=c.getSheet(nt),et=ht._activeCell,o={sheetIndex:t,value:n,isCaseSensitive:i,isEntireMatch:r,searchBy:e,mode:f,findType:u,reqType:"findNext"};if(lt={sheetIndex:o.sheetIndex,value:o.value,isCaseSensitive:o.isCaseSensitive,isEntireMatch:o.isEntireMatch,searchBy:o.searchBy,mode:o.mode,findType:o.findType,reqType:o.reqType},!c._intrnlReq&&c._trigActionBegin(lt))return!0;if(c.model.allowEditing&&c.XLEdit._isEdit&&c.XLEdit.saveCell(),n=o.value,t=o.sheetIndex,i=o.isCaseSensitive,r=o.isEntireMatch,u=o.findType,f=o.mode,e=o.searchBy,w=ht._selectedCells,ot=w.length,p=ht.usedRange,ot===1||f==="workbook"?g=[et.rowIndex,et.colIndex,p.rowIndex+1,p.colIndex+1]:(st=!0,b=w[ot-1],g=[et.rowIndex,et.colIndex,b.rowIndex+1,b.colIndex+1]),a=g[0],v=g[1],k=g[2],d=g[3],l||(tt=a,a=v,v=tt,tt=k,k=d,d=tt),f==="sheet"){for(s=a;s<k;s++)for(s!==a&&(b=w[0],v=st?l?b.colIndex:b.rowIndex:0),h=v;h<d;h++)if(ut=this._compareValues(l?s:h,l?h:s,nt,n,i,r,u),ut&&!(s===a&&h===v))return(this._updateSelection(l?s:h,l?h:s),this._findCount++,o={sheetIdx:t,reqType:"findNext",activeCell:c.getActiveCellElem(),type:"actionComplete",action:"find-next"},c._trigActionComplete(o))?void 0:!0}else for(y=nt,ct=c.model.sheetCount;y<=ct;y++)for(p=c.model.sheets[y].usedRange,y!==nt&&(v=0,a=0,k=l?p.rowIndex:p.colIndex,d=l?p.colIndex:p.rowIndex),s=a;s<k+1;s++)for(s!==a&&(v=0),h=v;h<d+1;h++)if(ut=this._compareValues(l?s:h,l?h:s,y,n,i,r,u),ut&&!(y===nt&&s===a&&h===v))return(this._updateSelection(l?s:h,l?h:s,y),this._findCount++,c._intrnlReq=!1,o={reqType:"findNext",activeCell:c.getActiveCellElem()},c._trigActionComplete(o))?void 0:!0;return this._findCount?!1:(it=0,rt=0,ft=f==="sheet"?nt:1,st&&(b=w[0],rt=w[0].rowIndex,it=w[0].colIndex),this._updateSelection(rt,it,ft),this._findCount++,this._compareValues(rt,it,ft,n,i,r,u)?!0:(c._intrnlReq=!0,this._findNext(n,ft,i,r,u,f,e)))},_findPrev:function(n,t,i,r,u,f,e){var s,h,p,it,k,a,nt,rt,ut,ft,v,y,tt,ct,w,st=!1,d=[],lt=0,at=0,l=e==="rows",et,c=this.XLObj,g=t?t:c.getActiveSheetIndex(),ht=c.getSheet(g),b=ht.usedRange,ot=ht._activeCell,o={sheetIndex:t,value:n,isCaseSensitive:i,isEntireMatch:r,searchBy:e,mode:f,findType:u,reqType:"findPrevious",action:"find-prev",type:"actionBegin"};if(ct={sheetIndex:o.sheetIndex,value:o.value,isCaseSensitive:o.isCaseSensitive,isEntireMatch:o.isEntireMatch,searchBy:o.searchBy,mode:o.mode,findType:o.findType,reqType:o.reqType},c._trigActionBegin(ct))return!0;if(c.model.allowEditing&&c.XLEdit._isEdit&&c.XLEdit.saveCell(),n=o.value,t=o.sheetIndex,i=o.isCaseSensitive,r=o.isEntireMatch,u=o.findType,f=o.mode,e=o.searchBy,nt=ht._selectedCells,rt=nt.length,rt===1||f==="workbook"?d=[ot.rowIndex,ot.colIndex,b.rowIndex+1,b.colIndex+1]:(a=nt[rt-1],d=[ot.rowIndex,ot.colIndex,a.rowIndex,a.colIndex],st=!0),v=d[0],y=d[1],tt=d[2],w=d[3],l||(et=v,v=y,y=et,et=tt,tt=w,w=et),f==="sheet"){for(st&&(a=nt[0],lt=l?a.rowIndex:a.colIndex,at=l?a.colIndex:a.rowIndex),s=v;s>=lt;s--)for(s!==v&&(y=w),h=y;h>=at;h--)if(it=this._compareValues(l?s:h,l?h:s,g,n,i,r,u),it&&!(s===v&&h===y))return(this._updateSelection(l?s:h,l?h:s),this._findCount++,o={sheetIdx:t,reqType:"findPrevious",activeCell:c.getActiveCellElem(),type:"actionComplete",action:"find-prev"},c._trigActionComplete(o))?void 0:!0}else for(p=g;p>=1;p--)for(b=c.model.sheets[p].usedRange,p!==g&&(tt=l?b.rowIndex:b.colIndex,w=l?b.colIndex:b.rowIndex,y=w,v=tt),s=v;s>=0;s--)for(s!==v&&(y=w+1),h=y;h>=0;h--)if(it=this._compareValues(l?s:h,l?h:s,p,n,i,r,u),it&&!(p===g&&s===v&&h===y))return(this._updateSelection(l?s:h,l?h:s,p),this._findCount++,o={reqType:"findPrevious",activeCell:c.getActiveCellElem()},c._trigActionComplete(o))?void 0:!0;return this._findCount?!1:(k=f==="sheet"?g:c.model.sheetCount,ft=c.model.sheets[k].usedRange.rowIndex,ut=c.model.sheets[k].usedRange.colIndex,st&&(a=nt[rt-1],ft=a.rowIndex,ut=a.colIndex),this._updateSelection(ft,ut,k),this._findCount++,this._compareValues(ft,ut,k,n,i,r,u)?!0:this._findPrev(n,k,i,r,u,f,e))},_compareValues:function(n,t,i,r,u,f,e){var o=this.XLObj,s=o.XLEdit.getPropertyValue(n,t,null,i)?o.XLEdit.getPropertyValue(n,t,null,i).toString():"",h=o.isFormula(s)||e==="formula"&&s==="=",c=o._isDateTime(o.XLEdit.getPropertyValue(n,t,"value",i));return s=e==="value"?c?s?this.caseSen[u](o.XLEdit.getPropertyValue(n,t,"value2",i)):"":s&&!h?this.caseSen[u](s):"":e==="formula"?h?this.caseSen[u](s):"":o.XLEdit.getPropertyValue(n,t,"comment",i)?this.caseSen[u](o.XLEdit.getPropertyValue(n,t,"comment",i).value):"",r=this.caseSen[u](r),this.isEMatch[f](s,r)},_replace:function(n,t,i,r,u){var f=this.XLObj,o=f.getActiveSheetIndex();if(f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"isLocked",o))return!1;var e=f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,null,t)?f.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,null,t).toString():"",s=new RegExp(i.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),h=e!==""&&i!==""?u?e.replace(i,r):e.replace(s,r):r;t===o||f.gotoPage(t);f.XLEdit._updateCellValue(n,h)},_replaceData:function(n,t,i,r,u,f,e,o,s){var v,y,h=this.XLObj,c=i?i:h.model.activeSheetIndex,p=h.getSheet(c),l=p._activeCell.rowIndex,a=p._activeCell.colIndex,w,b={sheetIndex:c,reqType:"find-replace",action:"replace",type:"actionBegin"};if(!h.model.allowEditing)return!1;if(!h._trigActionBegin(b)){if(h.model.allowLockCell&&h.XLEdit.getPropertyValue(l,a,"isLocked",c)){h._popUplockCellAlert();return}h.model.allowEditing&&h.XLEdit._isEdit&&h.XLEdit.saveCell();this._compareValues(l,a,c,n,r,u,f)?(y=f==="formula"?"value":"value2",v={sheetIndex:c,reqType:"find-replace",operation:"replace",rowIndex:l,colIndex:a,sIndex:i},v.prevData={value:h.XLEdit.getPropertyValue(l,a,y)},this._replace({rowIndex:l,colIndex:a},i,n,t,r),v.newData={value:h.XLEdit.getPropertyValue(l,a,y)},this._findCount=0,w=e==="up"?this._findPrev(n,c,r,u,f,o,s):this._findNext(n,c,r,u,f,o,s),w||this._updateSelection(l,a,c),h._isUndoRedo||(h._completeAction(v),h._trigActionComplete(v))):h._showAlertDlg("Alert","ReplaceNotFound","")}},_replaceAllData:function(t,i,r,u,f,e){var w,v,l,g=[],it=0,rt=!1,nt,o=this.XLObj,ut=o.model.sheetCount,a=o.model.activeSheetIndex,b=o.getSheet(a),y=b.usedRange,ft=b._activeCell.rowIndex,et=b._activeCell.colIndex,s,h,c,k,d,tt=0,ot={sheetIndex:a,reqType:"find-replace",action:"replaceAll",isCSen:r,isEMatch:u},p;if(!o._trigActionBegin(ot)){if(w={sheetIndex:a,reqType:"find-replace",operation:"replaceAll",isCSen:r,isEMatch:u},v=f==="formula"?"value":"value2",!o.model.allowEditing)return!1;if(o._dupDetails=!0,o.model.allowEditing&&o.XLEdit._isEdit&&o.XLEdit.saveCell(),e==="sheet")if(o.model.allowLockCell&&b.isSheetProtected)rt=!0;else for(s=0,k=y.rowIndex+1;s<k;s++)for(h=0,d=y.colIndex+1;h<d;h++)this._compareValues(s,h,a,t,r,u,f)&&(l={rowIndex:s,colIndex:h,prevData:{value:o.XLEdit.getPropertyValue(s,h,v)},sheetIndex:a},this._replace({rowIndex:s,colIndex:h},a,t,i,r),tt++,l.newData={value:o.XLEdit.getPropertyValue(s,h,v)},g.push(l));else for(c=1;c<=ut;c++){if(nt=o.model.sheets[c],o.model.allowLockCell&&nt.isSheetProtected){it++;continue}for(y=nt.usedRange,s=0,k=y.rowIndex+1;s<k;s++)for(h=0,d=y.colIndex+1;h<d;h++)this._compareValues(s,h,c,t,r,u,f)&&(l={rowIndex:s,colIndex:h,prevData:{value:o.XLEdit.getPropertyValue(s,h,v,c)},sheetIndex:c},this._replace({rowIndex:s,colIndex:h},c,t,i,r),tt++,l.newData={value:o.XLEdit.getPropertyValue(s,h,v)},g.push(l))}if(rt||it===ut){o._popUplockCellAlert();return}o._dupDetails=!1;w.selectedCell=g;this._updateSelection(ft,et);o._isUndoRedo||(o._completeAction(w),o._trigActionComplete(w));o.hideWaitingPopUp();p=o._getLocStr("ReplaceData").split("/");p="T-"+p[0]+tt+" "+p[1];n("#"+o._id+"_FRDialog").ejDialog("close");o._showAlertDlg("Alert",p,"",325)}},_updateSelection:function(n,t,i){var u={rowIndex:n,colIndex:t},r=this.XLObj,e=r.getActiveSheetIndex(),f=r.getSheet(e);i||(i=e);i&&i!==e&&r.gotoPage(i,!1);r.getSheetElement(e).find(".e-selected:visible").length<2||!r.inRange(f.selectedRange,n,t)?(r.setActiveCell(u.rowIndex,u.colIndex,i),r.XLSelection.selectRange(u,u),f._startCell=u,f._endCell=u):r.XLCellNav._updateActiveCell(n,t);r.model.scrollSettings.allowScrolling&&(r._isFrozen(f.frozenRows)||r._isFrozen(f.frozenColumns)?this._freezeScroll(u.rowIndex,u.colIndex,f):r.XLScroll._scrollSelectedPosition(i,r.getActiveCell(i)));r.model.allowAutoFill&&r.XLDragFill.positionAutoFillElement()},_getSelRangeDetails:function(n){var t=n[n.length-1].rowIndex-n[0].rowIndex,i=n[n.length-1].colIndex-n[0].colIndex,r=n[0].rowIndex,u=n[0].colIndex;return[t,i,r,u]},goTo:function(t){var i=this.XLObj;if(!i.model.isReadOnly){i._showDialog(i._id+"_Ribbon_Others_Editing_FindSelect");t.startsWith("=")&&(t=t.split("=")[1]);var c,e,f,l=i.getActiveSheetIndex(),u=i.getSheet(l),r,o,s=i._getDollarAlphaRange(u.selectedRange),h=i.XLRibbon._getAddrFromDollarAddr(t);t=h[1];h[0]&&i.gotoPage(h[0],!1);t=i.getRangeIndices(t);f=i._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]});r=f[0];o=f[f.length-1];i.setActiveCell(r.rowIndex,r.colIndex);i.model.allowSelection&&i.XLSelection.selectRange(r,o);i._isFrozen(u.frozenRows)||i._isFrozen(u.frozenColumns)?this._freezeScroll(r.rowIndex,r.colIndex,u):i.XLScroll._scrollSelectedPosition(i.getActiveSheetIndex(),r);i.XLDragFill&&i.XLDragFill.positionAutoFillElement();u._startCell=r;u._endCell=o;i._setSheetFocus();c=n.grep(i.XLRibbon._addrList,function(n){return n.value===s});c.length<1&&(i.XLRibbon._addrList.push({value:s,text:s}),e=n("#"+i._id+"_GotoAddr").data("ejListBox"),i.XLRibbon._addrList=JSON.parse(JSON.stringify(i.XLRibbon._addrList)),e.model.dataSource=i.XLRibbon._addrList,e.option("fields",{dataSource:i.XLRibbon._addrList}))}},goToSpecial:function(n,t){this._applyGoToRule(n,t.isNumber,t.isText,t.isLogical,t.isError)},_applyGoToRule:function(n,t,i,r,u){var e=this.XLObj,o,f;e.showWaitingPopUp();switch(n){case"blanks":this._applyGotoBlanks();break;case"formulas":this._applyGotoFormulas(t,i,r,u);break;case"comments":this._applyGotoComments();break;case"datavalidation":this._applyGotoValidation();break;case"cformat":this._applyGotoCFormat();break;case"lastcell":o=e.getActiveSheetIndex();f=e.model.sheets[o].usedRange;e.XLSelection.selectRange({rowIndex:f.rowIndex,colIndex:f.colIndex},{rowIndex:f.rowIndex,colIndex:f.colIndex});this._updateSelection(f.rowIndex,f.colIndex,o);break;case"constants":this._applyGotoConstants(t,i,r,u);break;case"rowdiff":this._applyGotoRowDiff();break;case"coldiff":this._applyGotoColDiff()}e.hideWaitingPopUp()},_applyGotoBlanks:function(){var o,s,l,u,a,i,r,h=!1,v=[],f,n=this.XLObj,e=n.getActiveSheetIndex(),y=n.model.sheets[e].usedRange,p,w=y.rowIndex,b=y.colIndex,t=n.getSheet(e),k=t._selectedCells,d=0,g=0,c={sheetIndex:e,reqType:"find-replace",operation:"blanks"};if(!n._trigActionBegin(c)){for(t._goToCollection={multiple:!1,selected:[]},k.length>1&&(f=this._getSelRangeDetails(k),w=f[0],b=f[1],d=f[2],g=f[3],t._goToCollection.multiple=!0),o=0;o<=w;o++){for(s=0;s<=b;s++)i=o+d,r=s+g,p=n.XLEdit.getPropertyValue(i,r)?n.XLEdit.getPropertyValue(i,r).toString():"",n._isRowViewable(e,i)&&(l=n.getCell(i,r,e),h=!0),p.length?h&&l.removeClass("e-selected"):(v.push({rowIndex:i,colIndex:r,isApply:!0}),n.model.scrollSettings.allowVirtualScrolling&&t._goToCollection.selected.push(i+":"+r),h&&(l.addClass("e-selected"),u=[i,r]));h=!1}a=t._goToCollection.selected.length;(n._isFrozen(t.frozenRows)||n._isFrozen(t.frozenColumns))&&(a&&(u=t._goToCollection.selected[a-1].split(":")),u&&u.length&&this._freezeScroll(u[0],u[1],t));c.selectedCell=v;n._isUndoRedo||(n._completeAction(c),n._trigActionComplete(c))}},_applyGotoComments:function(){var s,h,v,u,c,r,f,l=!1,y=[],e,n=this.XLObj,o=n.getActiveSheetIndex(),p=n.getSheet(o).usedRange,w,b=p.rowIndex,k=p.colIndex,i=n.getSheet(o),d=i._selectedCells,g=0,nt=0,a={sheetIndex:o,reqType:"find-replace",operation:"comments"};if(!n._trigActionBegin(a)){for(i._goToCollection={multiple:!1,selected:[]},this._isApplied=!1,d.length>1&&(e=this._getSelRangeDetails(d),b=e[0],k=e[1],g=e[2],nt=e[3],i._goToCollection.multiple=!0),s=0;s<=b;s++){for(h=0;h<=k;h++)r=s+g,f=h+nt,w=n.XLEdit.getPropertyValue(r,f,"comment"),n._isRowViewable(o,r)&&(v=n.getCell(r,f,o),l=!0),t.isNullOrUndefined(w)?l&&v.removeClass("e-selected"):(y.push({rowIndex:r,colIndex:f,isApply:!0}),n.model.scrollSettings.allowVirtualScrolling&&i._goToCollection.selected.push(r+":"+f),l&&(v.addClass("e-selected"),this._isApplied=!0,u=[r,f]));l=!1}c=i._goToCollection.selected.length;(n._isFrozen(i.frozenRows)||n._isFrozen(i.frozenColumns))&&(c&&(u=i._goToCollection.selected[c-1].split(":")),u&&u.length&&this._freezeScroll(u[0],u[1],i));this._isApplied||c||n._showAlertDlg("Alert","NoCellFound","",200);a.selectedCell=y;!n._isUndoRedo&&this._isApplied&&(n._completeAction(a),n._trigActionComplete(a))}},_applyGotoFormulas:function(i,r,u,f){var p,a,d,s,c,l,w,b=!1,nt=[],v,e=this.XLObj,y=e.getActiveSheetIndex(),tt,o,it,rt=e.model.sheets[y].usedRange,ut=rt.rowIndex,ft=rt.colIndex,h=e.getSheet(y),et=h._selectedCells,ot=0,g=0,k={sheetIndex:y,reqType:"find-replace",operation:"formulas"};if(!e._trigActionBegin(k)){for(h._goToCollection={multiple:!1,selected:[]},this._isApplied=!1,et.length>1&&(v=this._getSelRangeDetails(et),ut=v[0],ft=v[1],ot=v[2],g=v[3],h._goToCollection.multiple=!0),p=0;p<=ut;p++){for(a=0;a<=ft;a++)s=p+ot,c=a+g,tt=t.isNullOrUndefined(e.XLEdit.getPropertyValue(s,c))?"":e.XLEdit.getPropertyValue(s,a+g).toString(),o=t.isNullOrUndefined(e.XLEdit.getPropertyValue(s,c,"value2"))?"":e.XLEdit.getPropertyValue(s,c,"value2").toString(),it=tt.charAt(0)==="="&&typeof o=="string",e._isRowViewable(y,s)&&(d=e.getCell(s,c,y),b=!0),it&&(i&&n.isNumeric(o)||r&&!(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&!n.isNumeric(o)&&!(o.length!==0&&o.indexOf("#")===0&&o.lastIndexOf("?")===o.length-1&&o.length>0)||u&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")||f&&o.length!==0&&e._calcEngine.getErrorStrings().indexOf(o)>-1)?(nt.push({rowIndex:s,colIndex:c,isApply:!0}),e.model.scrollSettings.allowVirtualScrolling&&h._goToCollection.selected.push(s+":"+c),b&&(d.addClass("e-selected"),this._isApplied=!0,l=[s,c])):b&&d.removeClass("e-selected");b=!1}w=h._goToCollection.selected.length;(e._isFrozen(h.frozenRows)||e._isFrozen(h.frozenColumns))&&(w&&(l=h._goToCollection.selected[w-1].split(":")),l&&l.length&&this._freezeScroll(l[0],l[1],h));this._isApplied||w||e._showAlertDlg("Alert","NoCellFound","",200);k.selectedCell=nt;!e._isUndoRedo&&this._isApplied&&(e._completeAction(k),e._trigActionComplete(k))}},_applyGotoValidation:function(){var s,h,v,r,u,f,c,l=!1,y=[],e,n=this.XLObj,o=n.getActiveSheetIndex(),p=n.model.sheets[o].usedRange,w,b=p.rowIndex,k=p.colIndex,i=n.getSheet(o),d=i._selectedCells,g=0,nt=0,a={sheetIndex:o,reqType:"find-replace",action:"validations"};if(!n._trigActionBegin(a)){for(this._isApplied=!1,i._goToCollection={multiple:!1,selected:[]},d.length>1&&(e=this._getSelRangeDetails(d),b=e[0],k=e[1],g=e[2],nt=e[3],i._goToCollection.multiple=!0),s=0;s<=b;s++){for(h=0;h<=k;h++)r=s+g,u=h+nt,w=n.XLEdit.getPropertyValue(r,u,"rule"),n._isRowViewable(o,r)&&(v=n.getCell(r,u,o),l=!0),t.isNullOrUndefined(w)?l&&v.removeClass("e-selected"):(y.push({rowIndex:r,colIndex:u,isApply:!0}),n.model.scrollSettings.allowVirtualScrolling&&i._goToCollection.selected.push(r+":"+u),l&&(v.addClass("e-selected"),this._isApplied=!0,f=[r,u]));l=!1}c=i._goToCollection.selected.length;(n._isFrozen(i.frozenRows)||n._isFrozen(i.frozenColumns))&&(c&&(f=i._goToCollection.selected[c-1].split(":")),f&&f.length&&this._freezeScroll(f[0],f[1],i));this._isApplied||c||n._showAlertDlg("Alert","NoCellFound","",200);a.selectedCell=y;!n._isUndoRedo&&this._isApplied&&(n._completeAction(a),n._trigActionComplete(a))}},_applyGotoCFormat:function(){var s,h,v,r,u,f,c,l=!1,p=[],e,n=this.XLObj,o=n.getActiveSheetIndex(),w=n.model.sheets[o].usedRange,y,b=w.rowIndex,k=w.colIndex,i=n.getSheet(o),d=i._selectedCells,g=0,nt=0,a={sheetIndex:o,reqType:"find-replace",operation:"conditions"};if(!n._trigActionBegin(a)){for(this._isApplied=!1,i._goToCollection={multiple:!1,selected:[]},d.length>1&&(e=this._getSelRangeDetails(d),b=e[0],k=e[1],g=e[2],nt=e[3],i._goToCollection.multiple=!0),s=0;s<=b;s++){for(h=0;h<=k;h++)r=s+g,u=h+nt,y=n.XLEdit.getPropertyValue(r,u,"cFormatRule"),n._isRowViewable(o,r)&&(v=n.getCell(r,u,o),l=!0),!t.isNullOrUndefined(y)&&y.length?(p.push({rowIndex:r,colIndex:u,isApply:!0}),n.model.scrollSettings.allowVirtualScrolling&&i._goToCollection.selected.push(r+":"+u),l&&(v.addClass("e-selected"),this._isApplied=!0,f=[r,u])):l&&v.removeClass("e-selected");l=!1}c=i._goToCollection.selected.length;(n._isFrozen(i.frozenRows)||n._isFrozen(i.frozenColumns))&&(c&&(f=i._goToCollection.selected[c-1].split(":")),f&&f.length&&this._freezeScroll(f[0],f[1],i));this._isApplied||c||n._showAlertDlg("Alert","NoCellFound","",200);a.selectedCell=p;!n._isUndoRedo&&this._isApplied&&(n._completeAction(a),n._trigActionComplete(a))}},_applyGotoConstants:function(i,r,u,f){var v,y,d,o,s,l,p,w=!1,et=[],g,a,e=this.XLObj,b=e.getActiveSheetIndex(),h,k,nt=e.model.sheets[b].usedRange,tt=nt.rowIndex,it=nt.colIndex,c=e.getSheet(b),rt=c._selectedCells,ut=0,ft=0;for(this._isApplied=!1,c._goToCollection={multiple:!1,selected:[]},rt.length>1&&(a=this._getSelRangeDetails(rt),tt=a[0],it=a[1],ut=a[2],ft=a[3],c._goToCollection.multiple=!0),v=0;v<=tt;v++){for(y=0;y<=it;y++)o=v+ut,s=y+ft,h=t.isNullOrUndefined(e.XLEdit.getPropertyValue(o,s))?"":e.XLEdit.getPropertyValue(o,s).toString(),k=t.isNullOrUndefined(e.XLEdit.getPropertyValue(o,s,"value2"))?"":e.XLEdit.getPropertyValue(o,s,"value2").toString(),g=h.charAt(0)==="="&&typeof k=="string",e._isRowViewable(b,o)&&(d=e.getCell(o,s,b),w=!0),!g&&(i&&n.isNumeric(h)||r&&!(h.toLowerCase()==="true"||h.toLowerCase()==="false")&&!n.isNumeric(h)&&h.length>0||u&&(h.toLowerCase()==="true"||h.toLowerCase()==="false")||f&&k.length!==0&&k.indexOf("#")===0)?(et.push({rowIndex:o,colIndex:s,isApply:!0}),e.model.scrollSettings.allowVirtualScrolling&&c._goToCollection.selected.push(o+":"+s),w&&(d.addClass("e-selected"),this._isApplied=!0,l=[o,s])):w&&d.removeClass("e-selected");w=!1}p=c._goToCollection.selected.length;(e._isFrozen(c.frozenRows)||e._isFrozen(c.frozenColumns))&&(p&&(l=c._goToCollection.selected[p-1].split(":")),l&&l.length&&this._freezeScroll(l[0],l[1],c));this._isApplied||p||e._showAlertDlg("Alert","NoCellFound","",200)},_applyGotoColDiff:function(){var o,s,v,t,r,u,h,c=!1,y=[],f,n=this.XLObj,e=n.getActiveSheetIndex(),p=n.model.sheets[e].usedRange,w,b=p.rowIndex,k=p.colIndex,i=n.getSheet(e),d=i._selectedCells,l=0,g=0,a={sheetIndex:e,reqType:"find-replace",operation:"coldiff"},nt;if(!n._trigActionBegin(a)){if(this._isApplied=!1,i._goToCollection={multiple:!1,selected:[]},d.length>1)for(f=this._getSelRangeDetails(d),b=f[0],k=f[1],l=f[2],g=f[3],i._goToCollection.multiple=!0,o=0;o<=k;o++){for(t=o+g,nt=n.XLEdit.getPropertyValue(l,t)?n.XLEdit.getPropertyValue(l,t).toString():"",s=0;s<=b;s++)r=s+l,w=n.XLEdit.getPropertyValue(r,t)?n.XLEdit.getPropertyValue(r,t).toString():"",n._isRowViewable(e,r)&&(v=n.getCell(r,t,e),c=!0),w===nt?c&&v.removeClass("e-selected"):(y.push({rowIndex:r,colIndex:t,isApply:!0}),n.model.scrollSettings.allowVirtualScrolling&&i._goToCollection.selected.push(r+":"+t),c&&(v.addClass("e-selected"),this._isApplied=!0,u=[r,t]));c=!1}h=i._goToCollection.selected.length;(n._isFrozen(i.frozenRows)||n._isFrozen(i.frozenColumns))&&(h&&(u=i._goToCollection.selected[h-1].split(":")),u&&u.length&&this._freezeScroll(u[0],u[1],i));this._isApplied||h||n._showAlertDlg("Alert","NoCellFound","",200);a.selectedCell=y;!n._isUndoRedo&&this._isApplied&&(n._completeAction(a),n._trigActionComplete(a))}},_applyGotoRowDiff:function(){var o,s,v,u,h,t,r,c=!1,y=[],f,n=this.XLObj,e=n.getActiveSheetIndex(),p=n.model.sheets[e].usedRange,w,b=p.rowIndex,k=p.colIndex,i=n.getSheet(e),d=i._selectedCells,g=0,l=0,nt,a={sheetIndex:e,reqType:"find-replace",operation:"rowdiff"};if(!n._trigActionBegin(a)){if(this._isApplied=!1,i._goToCollection={multiple:!1,selected:[]},d.length>1)for(f=this._getSelRangeDetails(d),b=f[0],k=f[1],g=f[2],l=f[3],i._goToCollection.multiple=!0,o=0;o<=b;o++){for(t=o+g,nt=n.XLEdit.getPropertyValue(t,l)?n.XLEdit.getPropertyValue(t,l).toString():"",s=0;s<=k;s++)r=s+l,w=n.XLEdit.getPropertyValue(t,r)?n.XLEdit.getPropertyValue(t,r).toString():"",n._isRowViewable(e,t)&&(v=n.getCell(t,r,e),c=!0),w===nt?c&&v.removeClass("e-selected"):(y.push({rowIndex:t,colIndex:r,isApply:!0}),n.model.scrollSettings.allowVirtualScrolling&&i._goToCollection.selected.push(t+":"+r),c&&(v.addClass("e-selected"),this._isApplied=!0,u=[t,r]));c=!1}h=i._goToCollection.selected.length;(n._isFrozen(i.frozenRows)||n._isFrozen(i.frozenColumns))&&(h&&(u=i._goToCollection.selected[h-1].split(":")),u&&u.length&&this._freezeScroll(u[0],u[1],i));this._isApplied||h||n._showAlertDlg("Alert","NoCellFound","",200);a.selectedCell=y;!n._isUndoRedo&&this._isApplied&&(n._completeAction(a),n._trigActionComplete(a))}},_freezeScroll:function(n,t,i){var r,u=this.XLObj;r=u._getIdxWithOffset(n,t,!1,["freeze"]);(i._ftopRowIdx>n||n>i._bottomRow.idx)&&u._scrollContent({y:r.yOffset-i._frozenHeight+1},!0);(i._fleftColIdx>t||t>i._rightCol.idx)&&u._scrollContent({x:r.xOffset-i._frozenWidth+1},!0)}}}(jQuery,Syncfusion);$.fn.setInputPos=function(n,t){return t||(t=n),$(this).is(":visible")?this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}}):void 0},function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.formatCellDialog=function(n){this.XLObj=n;this._categories=[{value:"General",text:n._getLocStr("LGeneral")},{value:"Number",text:n._getLocStr("NumberTab")},{value:"Currency",text:n._getLocStr("LCurrency")},{value:"Accounting",text:n._getLocStr("LAccounting")},{value:"Date",text:n._getLocStr("LDate")},{value:"Time",text:n._getLocStr("LTime")},{value:"Percentage",text:n._getLocStr("LPercentage")},{value:"Fraction",text:n._getLocStr("LFraction")},{value:"Scientific",text:n._getLocStr("LScientific")},{value:"Text",text:n._getLocStr("LText")},{value:"Custom",text:n._getLocStr("LCustom")}];this._effects=[{value:"underline",text:"underline"},{value:"line-through",text:"line-through"},{value:"linethrough-underline",text:"line-through underline"}];this._selValue="General"};t.spreadsheetFeatures.formatCellDialog.prototype={_renderCellFrmtDlg:function(){var i=this.XLObj,w=i._id,r=w+"_formatdlg",o,u,f,e,l,a,v,y,s,p,h,c;o=t.buildTag("div#"+r);u=t.buildTag("div#"+r+"_formattab");f=t.buildTag("div.e-dlg-fields e-dlgctndiv");e=t.buildTag("ul .e-ul");l=t.buildTag("a",i._getLocStr("NumberTab"),{},{href:"#"+r+"_number"});v=t.buildTag("li",l);a=t.buildTag("a",i._getLocStr("FontTab"),{},{href:"#"+r+"_font"});y=t.buildTag("li",a);e.append(v);e.append(y);u.append(e);f.append(u);s=t.buildTag("div.e-dlg-btnfields");p=t.buildTag("div.e-dlg-btnctnr");h=t.buildTag("input#"+r+"_okbtn");c=t.buildTag("input#"+r+"_cantn");h.ejButton({text:i._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgCFOk,this),cssClass:"e-ss-okbtn"});c.ejButton({text:i._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgCFCancel,this)});s.append(p.append(h,c));f.append(t.buildTag("div#"+r+"_format_dataMnger","",{display:"none"}));i.element.append(o.append(f,s));u.ejTab({width:"100%",height:"auto",cssClass:"e-ss-dlgtab",allowKeyboardNavigation:!1,itemActive:t.proxy(this._numberTabChange,this)});n("#"+i._id+"_formatdlg_format_dataMnger").data("style",{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"});this._renderNumberTab();this._renderFontTab();o.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("Formatcells"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-mattab e-ss-fcdlg e-"+i._id+"-dlg",open:function(){n("#"+i._id+"_formatdlg_okbtn").focus()}})},_renderNumberTab:function(){var a,f=this.XLObj,i=f._id+"_fdlg_nTab",ot=this._categories,d,v,g,c,nt,s,e,r,u,y,p,w,b,k,tt,it,h,ft,et;d=[{text:"Wednesday, March 14, 2012",value:"{0:dddd, MMMM dd, yyyy}"},{text:"3/14/2012",value:"{0:M/d/yyyy}"},{text:"March 03",value:"{0:MMMM dd}"},{text:"2012 March",value:"{0:yyyy MMMM}"},{text:"3/14/12 1:30 PM",value:"{0:dd/MM/yyyy h:mm tt}"}];v=[{text:"0",type:"default"},{text:"0.00",type:"default"},{text:"#,##0",type:"default"},{text:"#,##00.00",type:"default"},{text:"0%",type:"default"},{text:"0.00%",type:"default"},{text:"MM/dd/yyyy",type:"default"},{text:"d-MMM",type:"default"},{text:"h:mm",type:"default"},{text:"mm:ss",type:"default"}];g=[{text:"1:30:55 PM",value:"{0:h:mm:ss tt}"},{text:"1:30 PM",value:"{0:h:mm tt}"},{text:"13:30:55",value:"{0:H:mm:ss}"},{text:"1:30",value:"{0:hh:mm}"}];var st=t.buildTag("div.e-ss-maindiv"),rt=t.buildTag("div.e-ss-topdiv","",{display:"table",width:"100%"}),ut=t.buildTag("div.e-ss-centerdiv","",{display:"table",width:"100%"}),l=t.buildTag("div.e-ss-lefttopdiv",""),o=t.buildTag("div.e-ss-righttopdiv","","");for(nt=t.buildTag("label.e-dlg-fields",f._getLocStr("FormatSample")),o.append(nt),rt.append(l,o),l=t.buildTag("div.e-ss-leftdiv",""),o=t.buildTag("div.e-ss-rightdiv","",{float:"left"}),s=t.buildTag("input#"+i+"_sinput.ejinputtext","",{},{disabled:"disabled"}),o.append(s),a=t.buildTag("div#div"+i,""),e=t.buildTag("table","",{"white-space":"normal"}),r=t.buildTag("tr#"+i+"_decimal.e-fdlg-num-options"),u=t.buildTag("td",t.buildTag("label.e-dlg-fields",f._getLocStr("DecimalPlacesTxt")),"",{width:"103px"}),e.append(r.append(u)),r=t.buildTag("tr#"+i+"_decimaldrop.e-fdlg-num-options"),u=t.buildTag("td"),s=t.buildTag("input#"+i+"_decimalplace",""),o.append(a.append(e.append(r.append(u.append(s))))),r=t.buildTag("tr#"+i+"_tseparator.e-fdlg-num-options"),u=t.buildTag("td","","",{colspan:"2"}),c=t.buildTag("input#"+i+"_kseptr"),e.append(r.append(u.append(c))),r=t.buildTag("tr#"+i+"_dtypes.e-fdlg-num-options"),u=t.buildTag("td",t.buildTag("label.e-dlg-fields",f._getLocStr("Type"))),y=t.buildTag("ul#"+i+"_datetypes"),e.append(r.append(u.append(y))),r=t.buildTag("tr#"+i+"_ttypes.e-fdlg-num-options"),u=t.buildTag("td",t.buildTag("label.e-dlg-fields",f._getLocStr("Type"))),p=t.buildTag("ul#"+i+"_timetypes"),e.append(r.append(u.append(p))),r=t.buildTag("tr#"+i+"_custom.e-fdlg-num-options"),u=t.buildTag("td",t.buildTag("label.e-dlg-fields",f._getLocStr("Type"))),w=t.buildTag("input#"+i+"_custominput.ejinputtext"),b=t.buildTag("ul#"+i+"_customtypes"),k=t.buildTag("button#"+i+"_delBtn",f._getLocStr("Delete"),{},{type:"button"}),tt=t.buildTag("div",k),e.append(r.append(u.append(w,b,tt))),f._on(w,"keydown",this._validateCustomFormat),it=t.buildTag("div#"+i+"_typeinfo.e-ss-fcgdiv","",{}),o.append(a),ut.append(l,o),n("#"+f._id+"_formatdlg_number").append(st.append(rt,ut,it)),e.find(".e-fdlg-num-options").hide(),this._createNumList(ot,l),s.ejNumericTextbox({name:"numeric",value:2,height:27,width:"100%",minValue:0,maxValue:30,change:n.proxy(this._refreshFrmtPropChanges,this)}),c.ejCheckBox({change:n.proxy(this._refreshFrmtPropChanges,this)}),c.parent().append(t.buildTag("label.e-dlg-fields",f._getLocStr("ThousandSeparatorTxt"),{"margin-left":6})),y.ejListBox({selectedItemIndex:"0",dataSource:d,fields:{text:"text",value:"value"},width:"100%",height:"120",selected:n.proxy(this._refreshFrmtPropChanges,this)}),p.ejListBox({selectedItemIndex:"0",dataSource:g,fields:{text:"text",value:"value"},width:"100%",height:"120",selected:n.proxy(this._refreshFrmtPropChanges,this)}),b.ejListBox({selectedItemIndex:"0",dataSource:v,fields:{text:"text",value:"value"},width:"100%",height:"100",selected:n.proxy(this._refreshFrmtPropChanges,this)}),n("#"+i+"_datetypes_container").addClass("e-ss-datetypes"),n("#"+i+"_timetypes_container").addClass("e-ss-timetypes"),n("#"+i+"_customtypes_container").addClass("e-ss-customtypes"),h=0;h<4;h++)ft=v[h+6].text,et=h>2?t.Spreadsheet.CellType.Date:t.Spreadsheet.CellType.Time,f.XLFormat.addCustomFormatSpecifier(null,ft,et);k.ejButton({showRoundedCorner:!0,width:60,click:n.proxy(this._customFormatDelete,this)})},_initFormatCellDlg:function(){var t=this.XLObj,i;if(!t.model.allowCellFormatting)return!1;n("#"+t._id+"_formatdlg").ejDialog("open");n("#"+t._id+"_formatdlg_format_dataMnger").data("style",{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"});n("#"+t._id+"_formatdlg_format_dataMnger").removeData("NumFormat");this._updateFormtdata();i=n("#"+t._id+"_formatdlg_formattab").data("ejTab");i&&i._refresh()},_createFontStyleList:function(){var r=this.XLObj,i=r._id+"_fdlg_fonttab",u=t.buildTag("div.e-ss-drpfontdiv"),f=t.buildTag("div .e-ss-stylediv"),e=t.buildTag("div .e-ss-stylediv"),o=t.buildTag("div .e-ss-stylediv"),s=t.buildTag("div .e-ss-stylediv"),h=t.buildTag("input#"+i+"_family"),nt=t.buildTag("label",r._getLocStr("Preview"),"",{id:i+"_previewlabel"}),tt=t.buildTag("input#"+i+"_sinput2.ejinputtext","",{height:"75px","text-align":"center"},{disabled:"disabled",value:"AaBbCcYyZz"}),c=t.buildTag("input#"+i+"_style"),l=t.buildTag("div#"+i+"_normalfont2","",{"padding-left":"10px"}),a=t.buildTag("div .e-ss-colordiv","",{"padding-right":"0px"}),v=t.buildTag("input#"+i+"_size"),y=t.buildTag("div .e-ss-stylediv"),p=t.buildTag("div .e-ss-fontcntdiv"),w=t.buildTag("div .e-ss-colordiv"),b=t.buildTag("div .e-ss-colordiv"),it=t.buildTag("label",r._getLocStr("Color"),"",{id:i+"_colorlabel"}),rt=t.buildTag("label",r._getLocStr("BackgroundColor"),"",{id:i+"_filllabel"}),k=t.buildTag("input#"+i+"_color"),d=t.buildTag("input#"+i+"_fillcolor"),g=t.buildTag("input#"+i+"_effects");f.append(h);e.append(c);o.append(v);s.append(g);w.append(rt,d);b.append(it,k);a.append(t.buildTag("label",r._getLocStr("NormalFont")),l);y.append(w,b,a);p.append(nt,tt);u.append(f,e,o,s,y,p);h.ejDropDownList({dataSource:r.XLRibbon._fontFamily,width:"100%",select:n.proxy(this._onFontFamilySelect,this),selectedItemIndex:6});c.ejDropDownList({dataSource:r.XLRibbon._fontStyle,width:"100%",select:n.proxy(this._onFontStyleSelect,this),selectedItemIndex:0});v.ejDropDownList({dataSource:r.XLRibbon._fontSize,width:"100%",select:n.proxy(this._onFontSizeSelect,this),selectedItemIndex:3});g.ejDropDownList({dataSource:this._effects,width:"100%",watermarkText:"None",select:n.proxy(this._onFontEffectSelect,this)});k.ejColorPicker({value:"#333333",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_color"),change:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_color"),select:n.proxy(this._selectCPHandler,this,"fdlg_fonttab_color")});d.ejColorPicker({value:"#FFFFFF",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolor"),change:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolor"),select:n.proxy(this._selectCPHandler,this,"fdlg_fonttab_fillcolor")});l.ejCheckBox({size:"small",change:n.proxy(this._changeNormalFont,this)});n("#"+r._id+"_formatdlg_font").prepend(u)},_renderFontTab:function(){var r=this.XLObj,i=r._id+"_fdlg_fonttab",ut=t.buildTag("div.e-ss-fontmaindiv"),u=t.buildTag("div .e-ss-fontcntdiv"),f=t.buildTag("div .e-ss-fontstylediv"),e=t.buildTag("div .e-ss-fontstylediv"),o=t.buildTag("div .e-ss-fontstylediv"),ft=t.buildTag("label",r._getLocStr("FontFamily"),"",{id:i+"_familylabel"}),et=t.buildTag("label",r._getLocStr("FontStyle"),"",{id:i+"_stylelabel"}),ot=t.buildTag("label",r._getLocStr("FontSize"),"",{id:i+"_sizelabel"});f.append(ft);o.append(et);e.append(ot);u.append(f,o,e);var s=t.buildTag("div .e-ss-fontcntdiv","",{width:"103%"}),h=t.buildTag("div .e-ss-fontstylediv"),c=t.buildTag("div .e-ss-fontstylediv","",{"margin-right":"0px"}),l=t.buildTag("div .e-ss-fontstylediv"),a=t.buildTag("ul#"+i+"_familylist"),v=t.buildTag("ul#"+i+"_stylelist"),y=t.buildTag("ul#"+i+"_sizelist"),st=t.buildTag("input#"+i+"_familytext .ejinputtext","",{width:"150px"},{value:"Calibri"}),ht=t.buildTag("input#"+i+"_styletext .ejinputtext","",{width:"150px"},{value:"Normal"}),ct=t.buildTag("input#"+i+"_sizetext .ejinputtext","",{width:"150px"},{value:11});h.append(st,a);l.append(ht,v);c.append(ct,y);a.ejListBox({selectedItemIndex:"6",width:"150px",height:"150px",dataSource:r.XLRibbon._fontFamily,fields:{text:"text",value:"value"},select:n.proxy(this._onFontFamilySelect,this),allowMultiSelection:!1});v.ejListBox({selectedItemIndex:"0",width:"150px",height:"150px",dataSource:r.XLRibbon._fontStyle,fields:{text:"text",value:"value"},select:n.proxy(this._onFontStyleSelect,this),allowMultiSelection:!1});y.ejListBox({selectedItemIndex:"3",width:"150px",height:"150px",dataSource:r.XLRibbon._fontSize,fields:{text:"text",value:"value"},select:n.proxy(this._onFontSizeSelect,this),allowMultiSelection:!1});s.append(h,l,c);var p=t.buildTag("div .e-ss-fontcntdiv"),w=t.buildTag("div .e-ss-fontstylediv"),b=t.buildTag("div .e-ss-fontnrmldiv"),k=t.buildTag("div .e-ss-fontcdiv"),d=t.buildTag("div .e-ss-fontcdiv"),lt=t.buildTag("label",r._getLocStr("Effects"),"",{id:i+"_effectslabel"}),at=t.buildTag("label",r._getLocStr("Color"),"",{id:i+"_colorlabel"}),vt=t.buildTag("label",r._getLocStr("BackgroundColor"),"",{id:i+"_filllabel"}),g=t.buildTag("input#"+i+"_effectstext .ejinputtext"),nt=t.buildTag("input#"+i+"_colortext .ejinputtext",""),tt=t.buildTag("input#"+i+"_fillcolortext .ejinputtext",""),it=t.buildTag("label#"+i+"_normalfont","",{"padding-left":"10px"});w.append(lt,g);k.append(at,nt);d.append(vt,tt);b.append(t.buildTag("label",r._getLocStr("NormalFont"),"",{id:i+"_fillcolorlabel"}),it);p.append(w,k,d,b);g.ejDropDownList({dataSource:this._effects,watermarkText:"None",select:n.proxy(this._onFontEffectSelect,this),width:"150px"});it.ejCheckBox({size:"small",change:n.proxy(this._changeNormalFont,this)});nt.ejColorPicker({value:"#333333",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_colortext"),change:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_colortext")});tt.ejColorPicker({value:"#FFFFFF",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolortext"),change:n.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolortext")});var rt=t.buildTag("div .e-ss-fontcntdiv","",{width:"20px"}),yt=t.buildTag("label",r._getLocStr("Preview"),"",{id:i+"_previewlabel"}),pt=t.buildTag("input#"+i+"_sinput.ejinputtext","",{height:"80px",width:"480px","padding-top":"10px","text-align":"center"},{disabled:"disabled",value:"AaBbCcYyZz"});rt.append(yt,pt);n("#"+r._id+"_formatdlg_font").append(ut.append(u,s,p,rt));this._createFontStyleList()},_updateFormtdata:function(){var r=this.XLObj,h=r.getActiveCell(),u=n("#"+r._id+"_fdlg_nTab_list").data("ejListBox"),it=n("#"+r._id+"_fdlg_nTab_decimalplace").data("ejNumericTextbox"),y=n("#"+r._id+"_fdlg_nTab_datetypes").data("ejListBox"),p=n("#"+r._id+"_fdlg_nTab_timetypes").data("ejListBox"),rt=n("#"+r._id+"_fdlg_nTab_input").data("ejDropDownList"),f=n("#"+r._id+"_fdlg_nTab_customtypes").data("ejListBox"),i,w,b,e,o,s,c,l,v,k=n("#"+r._id+"_fdlg_fonttab_familylist").data("ejListBox"),a=n("#"+r._id+"_fdlg_fonttab_stylelist").data("ejListBox"),d=n("#"+r._id+"_fdlg_fonttab_sizelist").data("ejListBox"),g=n("#"+r._id+"_fdlg_fonttab_effectstext").data("ejDropDownList"),nt=n("#"+r._id+"_fdlg_fonttab_colortext").data("ejColorPicker"),tt=n("#"+r._id+"_fdlg_fonttab_fillcolortext").data("ejColorPicker");u&&u._refreshScroller();i=r.getRangeData({range:[h.rowIndex,h.colIndex,h.rowIndex,h.colIndex]})[0];w="decimalPlaces"in i?i.decimalPlaces:2;b="thousandSeparator"in i?i.thousandSeparator:!1;e="type"in i?i.type.indexOf("date")>-1?"date":i.type:"general";"formatStr"in i?(o=y.getIndexByValue(i.formatStr),s=p.getIndexByValue(i.formatStr),r.isUndefined(o)&&r.isUndefined(s)&&["date"].indexOf(e)>-1&&(c=f.model.dataSource,l=i.formatStr.replace(/^\{0\:|\}$/g,""),r._isValueAlreadyExist(c,"text",l)||(c.push({text:l,type:"custom"}),f._setModel({dataSource:c})),v=f.getIndexByText(l),e="custom")):o=s=0;u&&u.selectItemByValue(n.camelCase("-"+e));y.selectItemByIndex(o>-1?o:0);p.selectItemByIndex(s>-1?s:0);f.selectItemByIndex(v>-1?v:0);e==="string"&&(u.selectItemByIndex(10),f.selectItemByText(i.formatStr));"formats"in i?(t.isNullOrUndefined(i.formats["font-size"])?d.selectItemByText("11"):d.selectItemByText(i.formats["font-size"].split("pt")[0]),t.isNullOrUndefined(i.formats["font-style"])&&t.isNullOrUndefined(i.formats["font-weight"])&&a.selectItemByText("Normal"),t.isNullOrUndefined(i.formats["font-style"]&&t.isNullOrUndefined(i.formats["font-weight"]))||a.selectItemByText(i.formats["font-style"].capitalizeFirstString()),t.isNullOrUndefined(i.formats["font-weight"]&&t.isNullOrUndefined(i.formats["font-style"]))||a.selectItemByText(i.formats["font-weight"].capitalizeFirstString()),t.isNullOrUndefined(i.formats["font-style"])||t.isNullOrUndefined(i.formats["font-weight"])||a.selectItemByText("Bold Italic"),t.isNullOrUndefined(i.formats["font-family"])?k.selectItemByText("Calibri"):k.selectItemByText(i.formats["font-family"].replace(/\w\S*/g,function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()})),t.isNullOrUndefined(i.formats["text-decoration"])?g.clearText():g.selectItemByText(i.formats["text-decoration"]),t.isNullOrUndefined(i.formats.color)?nt.setValue("#333333"):nt.setValue(i.formats.color),t.isNullOrUndefined(i.formats["background-color"])?tt.setValue("#FFFFFF"):tt.setValue(i.formats["background-color"])):this._changeNormalFont({isChecked:!0});it.option("value",w);n("#"+r._id+"_fdlg_nTab_kseptr").ejCheckBox({checked:b});this._onNumFormatSelect({value:u?u.model.value:rt.model.value})},_onNumFormatSelect:function(t){var i=this.XLObj,r="#"+i._id+"_fdlg_nTab_",e=n("#"+i._id+"_fdlg_nTab_typeinfo"),f,u=t.value;n("#"+i._id+"_formatdlg_number").find(".e-fdlg-num-options").hide();switch(u){case"Number":i.model.formatSettings.allowDecimalPlaces&&n(r+"decimal, "+r+"tseparator, "+r+"decimaldrop").show();break;case"Currency":case"Accounting":case"Percentage":case"Scientific":n(r+"decimal").show();n(r+"decimaldrop").show();break;case"Date":n(r+"dtypes").show();n("#"+i._id+"_fdlg_nTab_datetypes").data("ejListBox")._refreshScroller();break;case"Time":n(r+"ttypes").show();n("#"+i._id+"_fdlg_nTab_timetypes").data("ejListBox")._refreshScroller();break;case"Custom":n(r+"custom").show();n("#"+i._id+"_fdlg_nTab_customtypes").data("ejListBox")._refreshScroller()}f=this._getFormattedText(u);n("#"+i._id+"_fdlg_nTab_decimalplace").data("ejNumericTextbox").option("maxValue",u==="Scientific"?20:30);n("#"+i._id+"_fdlg_nTab_sinput").val(f);e.text(i._getLocStr(u));this._selValue=u},_getFormattedText:function(i){var f,o,r,h,c,e=0,u=this.XLObj,a=u.getActiveCell(),p=n("#"+u._id+"_fdlg_nTab_decimalplace").data("ejNumericTextbox"),w=n("#"+u._id+"_fdlg_nTab_datetypes").data("ejListBox"),v={Number:"0:N",Currency:"0:C",Accounting:"0:C",Percentage:"0:P",Scientific:"0:N"},b=n("#"+u._id+"_fdlg_nTab_timetypes").data("ejListBox"),l=t.Spreadsheet.CellType,y=t.Spreadsheet.CellFormat,s=n("#"+u._id+"_fdlg_nTab_customtypes").data("ejListBox");u.model.formatSettings.allowDecimalPlaces&&(e=p.getValue());r=u.XLEdit.getPropertyValue(a.rowIndex,a.colIndex)||"";o=n("#"+u._id+"_fdlg_nTab_kseptr").ejCheckBox("checked");switch(i){case"Number":case"Currency":case"Accounting":case"Percentage":f="{"+v[i]+e+"}";u._isDateTime(r)&&(r=u._dateToInt(r));r=u.XLFormat._format(r,u.XLFormat._getFormatObj({formatStr:f,thousandSeparator:o,type:l[i],decimalPlaces:e}));break;case"Date":f=w.getSelectedItems()[0].value;i=f===y.longdate?"longdate":f===y.shortdate?"shortdate":"date";r=u.XLFormat._format(r,u.XLFormat._getFormatObj({formatStr:f,type:i}));break;case"Time":f=b.getSelectedItems()[0].value;r=u.XLFormat._format(r,u.XLFormat._getFormatObj({formatStr:f,type:l[i]}));e=0;break;case"Scientific":f="{"+v[i]+e+"}";u._isDateTime(r)&&(r=u._dateToInt(r));r=u.XLFormat._format(r,u.XLFormat._getFormatObj({formatStr:f,thousandSeparator:o,type:l[i],decimalPlaces:e}));break;case"Fraction":u._isDateTime(r)&&(r=u._dateToInt(r));r=u.toFraction(r);r&&(r=t.isNullOrUndefined(r.numerator)?r.integer:r.integer+" "+r.numerator+"/"+r.denominator);break;case"General":case"Text":u._isDateTime(r)&&(r=u._dateToInt(r));break;case"Custom":h=s.getSelectedItems()[0].text;c=u.XLFormat.customFormatParser(h);n("#"+u._id+"_fdlg_nTab_custominput").val(h);r=u.XLFormat._format(r,c);s.getSelectedItems()[0].index>-1&&n("#"+u._id+"_fdlg_nTab_delBtn").data("ejButton")._setModel({enabled:s.model.dataSource[s.getSelectedItems()[0].index].type==="custom"})}return n("#"+u._id+"_formatdlg_format_dataMnger").data("NumFormat",i==="Custom"?c:{type:i.toLowerCase(),decimalPlaces:e,thousandSeparator:o,formatStr:f}),r},_numberTabChange:function(){var t=this.XLObj,i=n("#"+t._id+"_fdlg_nTab_list").data("ejListBox"),r=n("#"+t._id+"_fdlg_fonttab_familylist").data("ejListBox"),u=n("#"+t._id+"_fdlg_fonttab_stylelist").data("ejListBox"),f=n("#"+t._id+"_fdlg_fonttab_sizelist").data("ejListBox");i&&i._refreshScroller();u&&u._refreshScroller();f&&f._refreshScroller();r&&r._refreshScroller()},_refreshFrmtPropChanges:function(){var i=this.XLObj,t;t=this._getFormattedText(this._selValue);n("#"+i._id+"_fdlg_nTab_sinput").val(t)},_dlgCFCancel:function(){var t=this.XLObj;n("#"+t._id+"_formatdlg").ejDialog("close");t.model.showRibbon&&t.XLRibbon._updateRibbonIcons();t._setSheetFocus()},_dlgCFOk:function(t){var i=this.XLObj,r;if(i.XLFormat._styleDlgClick){n("#"+i._id+"_formatdlg").ejDialog("close");i._setSheetFocus();return}(r=n("#"+i._id+"_formatdlg_format_dataMnger").data(),t&&this._selValue==="Custom"&&this._validateCustomFormat())||(i.getObjectLength(r)&&(i.getObjectLength(r.NumFormat)?(r.NumFormat.style=r.style,i.XLFormat.format(r.NumFormat)):i.XLFormat.format(r)),i.model.showRibbon&&i.XLRibbon._updateRibbonIcons(),n("#"+i._id+"_formatdlg").ejDialog("close"),i._setSheetFocus())},_customFormatDelete:function(){var t=n("#"+this.XLObj._id+"_fdlg_nTab_customtypes").data("ejListBox"),i=t.model.dataSource;i.splice(t.model.selectedItemIndex,1);t._setModel({dataSource:i});t.selectItemByIndex(0);this._refreshFrmtPropChanges()},_validateCustomFormat:function(t){var i=t?this:this.XLObj,u,r,f,e=n("#"+i._id+"_fdlg_nTab_custominput").val(),o=i.XLFormat.customFormatParser(e);if(!t||t.keyCode===13)if(i.getObjectLength(o))u=n("#"+i._id+"_fdlg_nTab_customtypes").data("ejListBox"),r=u.model.dataSource,i._isValueAlreadyExist(r,"text",e)||(r.push({text:e,type:"custom"}),u._setModel({dataSource:r})),n("#"+i._id+"_formatdlg_format_dataMnger").data("NumFormat",o),t&&i.XLCellFrmtDlg._dlgCFOk();else return f=n("#"+i._id+"_alertdlg"),i._renderAlertDlgContent(f,"Alert",i._getLocStr("CustomFormatAlert")),f.ejDialog("open"),!0},_onFontFamilySelect:function(t){var i=this.XLObj,r=t.text;n("#"+i._id+"_fdlg_fonttab_familytext")[0].value=r;n("#"+i._id+"_fdlg_fonttab_sinput")[0].style.fontFamily=r;n("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.fontFamily=r;n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-family"]=r;r!="Calibri"&&(n("#"+i._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),n("#"+i._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))},_changeNormalFont:function(t){if(t&&t.isChecked){var i=this.XLObj,r=n("#"+i._id+"_fdlg_fonttab_familylist").data("ejListBox"),u=n("#"+i._id+"_fdlg_fonttab_stylelist").data("ejListBox"),f=n("#"+i._id+"_fdlg_fonttab_sizelist").data("ejListBox"),e=n("#"+i._id+"_fdlg_fonttab_effectstext").data("ejDropDownList"),o=n("#"+i._id+"_fdlg_fonttab_colortext").data("ejColorPicker"),s=n("#"+i._id+"_fdlg_fonttab_fillcolortext").data("ejColorPicker"),h=n("#"+i._id+"_fdlg_fonttab_family").data("ejDropDownList"),c=n("#"+i._id+"_fdlg_fonttab_style").data("ejDropDownList"),l=n("#"+i._id+"_fdlg_fonttab_size").data("ejDropDownList"),a=n("#"+i._id+"_fdlg_fonttab_effects").data("ejDropDownList"),v=n("#"+i._id+"_fdlg_fonttab_color").data("ejColorPicker"),y=n("#"+i._id+"_fdlg_fonttab_fillcolor").data("ejColorPicker");f.selectItemByText("11");u.selectItemByText("Normal");r.selectItemByText("Calibri");e.clearText();l.selectItemByText("11");c.selectItemByText("Normal");h.selectItemByText("Calibri");a.clearText();y.setValue("#FFFFFF");v.setValue("#333333");n("#"+i._id+"_fdlg_fonttab_sinput")[0].style.textDecoration="none";n("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.textDecoration="none";s.setValue("#FFFFFF");o.setValue("#333333")}},_onFontStyleSelect:function(t){var i=this.XLObj,r=t.text,u=n("#"+i._id+"_fdlg_fonttab_sinput")[0],f=n("#"+i._id+"_fdlg_fonttab_sinput2")[0],e=n("#"+i._id+"_fdlg_fonttab_normalfont").data("ejCheckBox"),o=n("#"+i._id+"_fdlg_fonttab_normalfont2").data("ejCheckBox");n("#"+i._id+"_fdlg_fonttab_styletext")[0].value=r;switch(r){case"Bold":n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-weight"]=r;u.style.fontWeight=r;u.style.removeProperty("font-style");f.style.fontWeight=r;f.style.removeProperty("font-style");e.option({checked:!1});o.option({checked:!1});break;case"Italic":n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-style"]=r;u.style.fontStyle=r;u.style.removeProperty("font-weight");f.style.fontStyle=r;f.style.removeProperty("font-weight");e.option({checked:!1});o.option({checked:!1});break;case"Bold Italic":n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-weight"]="Bold";n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-style"]="Italic";u.style.fontStyle="Italic";u.style.fontWeight="Bold";f.style.fontStyle="Italic";f.style.fontWeight="Bold";e.option({checked:!1});o.option({checked:!1});break;case"Normal":n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-weight"]="normal";n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-style"]="normal";u.style.removeProperty("font-weight");u.style.removeProperty("font-style");f.style.removeProperty("font-weight");f.style.removeProperty("font-style")}},_onFontSizeSelect:function(t){var i=this.XLObj,r=t.text;n("#"+i._id+"_fdlg_fonttab_sizetext")[0].value=r;n("#"+i._id+"_fdlg_fonttab_sinput")[0].style.fontSize=r+"pt";n("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.fontSize=r+"pt";n("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-size"]=r+"pt";r!="11"&&(n("#"+i._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),n("#"+i._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))},_onFontEffectSelect:function(t){var i=this.XLObj,r=t.text;n("#"+i._id+"_formatdlg_format_dataMnger").data().style["text-decoration"]=r;n("#"+i._id+"_fdlg_fonttab_sinput")[0].style.textDecoration=r;n("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.textDecoration=r;r!="None"&&(n("#"+i._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),n("#"+i._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))},_ChangeCPHandler:function(t,i){var r=this.XLObj,u;i.type==="open"?(n("#"+r._id+"_"+t+"_popup").find(".e-buttons, .e-button").hide(),n("#"+r._id+"_"+t+"_popup").focus()):i.type==="change"&&(u=n("#"+r._id+"_"+t).data("ejColorPicker"),t==="fdlg_fonttab_fillcolortext"||t==="fdlg_fonttab_fillcolor"?(n("#"+r._id+"_formatdlg_format_dataMnger").data().style["background-color"]=i.value,n("#"+r._id+"_fdlg_fonttab_sinput").css("background-color",i.value),n("#"+r._id+"_fdlg_fonttab_sinput2").css("background-color",i.value),i.value!="#FFFFFF"&&(n("#"+r._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),n("#"+r._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))):(t==="fdlg_fonttab_colortext"||t==="fdlg_fonttab_color")&&(n("#"+r._id+"_formatdlg_format_dataMnger").data().style.color=i.value,n("#"+r._id+"_fdlg_fonttab_sinput").css("color",i.value),n("#"+r._id+"_fdlg_fonttab_sinput2").css("color",i.value),i.value!="#333333"&&(n("#"+r._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),n("#"+r._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))),u&&(u.hide(),r._dupDetails=!0,u.setValue(i.value),r._dupDetails=!1))},_createNumList:function(i,r){var u=this.XLObj,f=u._id+"_fdlg_nTab",s,e,o,h=t.buildTag("div.e-ss-drpdiv");e=t.buildTag("input#"+f+"_input");h.append(e);n("#"+u._id+"_formatdlg_number").prepend(h);e.ejDropDownList({dataSource:i,cssClass:"e-ss-num-format",width:"100%",fields:{id:"value",text:"text",value:"text"},select:n.proxy(this._onNumFormatSelect,this),selectedItemIndex:0});s=t.buildTag("label#"+f+"_clabel.e-dlg-fields",u._getLocStr("Category"));u.element.find(".e-ss-lefttopdiv").append(s);o=t.buildTag("ul#"+f+"_list");r.append(o);o.ejListBox({selectedItemIndex:"0",width:"120",height:"250",dataSource:i,fields:{text:"text",value:"value"},select:n.proxy(this._onNumFormatSelect,this),allowMultiSelection:!1})}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.shape=function(n){this.XLObj=n;this._imgX=0;this._imgY=0;this._imgOffsetleft=0;this._imgOffsetTop=0;this._shapeType="img";this._shapeROStart=!1;this._shapeRSStart=!1;this._imgRSWStart=!1;this._imgRSEStart=!1;this._imgRSNStart=!1;this._imgRSSStart=!1;this._changePicture=!1;this._picCellIdx={};this._insertShape=!1;this._isRowGreater=!1};t.spreadsheetFeatures.shape.prototype={_insertPicture:function(n){var t=this.XLObj,i=t._browserDetails.name==="msie"&&parseInt(t._browserDetails.version)<10?n.responseText:n.xhr.response,r,u,e,o;if(i.startsWith("Invalid"))t._showAlertDlg("Alert","ImageValAlert");else if(r=t.getActiveSheetIndex(),u=t.getSheet(r),this._changePicture)this.changePicture(null,i);else{var f=t.getActiveCell(),s=t.model.pictureSettings,h=s.height,c=s.width;e=u._colWidthCollection[f.colIndex];o=u._rowHeightCollection[f.rowIndex];this._insertShape=!0;this._createPicture(r,f,i,o,e,c,h)}},changePicture:function(t,i){var u=this.XLObj,s=u.getActiveSheetIndex(),a=u.getSheet(s),r,h,c,l,f,e,o;r=t?n("#"+t).get(0):u.getSheetElement(s).find(".e-ss-activeimg").get(0);h=r.offsetLeft;c=r.offsetTop;l=this._getCellIndexFromOffset(c,h);f=a.shapeMngr;n(r).css("background-image","url('"+i+"')");e=f.picture[r.id];o={sheetIndex:s,reqType:"shape",shapeType:"picture",action:"changepicture",id:n(r).attr("id"),cell:l,prev:{img:f.sharedPics[e.data],data:e.data,pcIdx:r.id},cur:{img:i,pcIdx:r.id}};f.sharedPics.indexOf(i)===-1&&f.sharedPics.push(i);e.data=f.sharedPics.indexOf(i);o.cur.data=e.data;this._changePicture=!1;u._setSheetFocus();u._completeAction(o);u._trigActionComplete(o)},setPicture:function(n,t,i,r,u,f){var e=this.XLObj,o,s,h,c,l;if(e.model.pictureSettings.allowPictures&&!e.model.isReadOnly)return(n=e._getRangeArgs(n,"object"),o=n[0],s=n[1],e.model.allowLockCell&&e._isCellProtected(o,s,!1))?void 0:(h=e.getActiveSheetIndex(),l=e.model.pictureSettings,r=r?r:l.height,i=i?i:l.width,e._isRowViewable(h,o)?(c=e.getCell(o,s)[0],u=u?u:c.offsetTop,f=f?f:c.offsetLeft):(u=u?u:0,f=f?f:0),this._createPicture(h,{rowIndex:o,colIndex:s},t,u,f,i,r))},resetPicture:function(i,r){var f=this.XLObj,u,s,e,o;u=i?n("#"+i):f.element.find(".e-ss-activeimg");s=new RegExp("\\be-shapebdr.*?\\b","g");e={sheetIndex:f.getActiveSheetIndex(),reqType:"shape",shapeType:"picture",action:"resetpicture",id:n(u).attr("id"),actionType:r};f._dupDetails=!0;t.isNullOrUndefined(u[0].className.match(s))||(o=f.XLShape._getImgStyleFromHashCode(u[0].className.match(s)[0]));e.prev=o?{bcolor:o["border-color"],bstyle:o["border-style"],bwidth:o["border-width"]}:{};u[0].className=u[0].className.replace(s,"");e.cur={bcolor:u.css("border-color"),bstyle:u.css("border-style"),bwidth:u.css("border-width")};r!="resetpicture"&&(e.prev.width=u.css("width"),e.prev.height=u.css("height"),u.css({width:f.model.pictureSettings.width,height:f.model.pictureSettings.height}),e.cur.width=u.css("width"),e.cur.height=u.css("height"),f.XLShape._updateShapeObj(u[0]),f._hasClass(u[0],"e-ss-activeimg")&&f.XLRibbon._formatTabUpdate());f._dupDetails=!1;f._completeAction(e);f._trigActionComplete(e)},_createPicture:function(n,i,r,u,f,e,o,s,h,c,l,a){var w,d,g;h=h?h:"transparent";c=c?c:"solid";l=l?l:"1px";var v=this.XLObj,k,b=v.getSheet(n),y={sheetIndex:n,targetCell:i,top:u,left:f,width:e,height:o,bcolor:h,bstyle:c,bwidth:l,reqType:"picture",add:"add"},p;if(k={sheetIndex:y.sheetIndex,targetCell:y.targetCell,top:y.top,left:y.left,width:y.width,height:y.height,bcolor:y.bcolor,bstyle:y.bstyle,bwidth:y.bwidth,reqType:"picture",action:"add"},!v._trigActionBegin(k))return b._isImported||(this._insertShape=!0),u=y.top,f=y.left,e=y.width,o=y.height,s=t.isNullOrUndefined(s)?v.model.allowCharts&&v.XLChart._shapeCnt:s,v._isExport&&(a.cnt=s),p=v._id+"_picture"+s,i=this._getCellIndexFromOffset(u,f,n),d=i.rowIndex,g=i.colIndex,!v._isUndoRedo&&v.model.allowCharts&&v.XLChart._shapeCnt++,this._updateShapeMngr(i,{picture:{data:r,id:p,height:o,width:e,left:f,top:u,rowIndex:d,colIndex:g,bwidth:l,bcolor:h,bstyle:c}},"picture"),v._isExport||this._refreshPictureElement({top:u,left:f,width:e,height:o,bcolor:h,bstyle:c,bwidth:l,imgData:r,cnt:s,sheetIdx:n}),v._setSheetFocus(),b._isImported&&!b._isLoaded||v._isUndoRedo||v._isPaste||v.XLClipboard._isShape||v._isExport||(w={sheetIndex:n,reqType:"shape",shapeType:"picture",action:"create",id:p,actCell:i,img:r,cnt:s},w.position={top:u,left:f,height:o,width:e},v._completeAction(w),v._trigActionComplete(w)),v.model.showRibbon&&v.XLRibbon._formatTabUpdate(),p},_refreshPictureElement:function(i){var r=this.XLObj,u,f,e;r._getJSSheetContent(i.sheetIdx).find(".e-spreadsheetcontentcontainer > .e-content").append(t.buildTag("div.e-ss-object e-ss-image","","",{id:r._id+"_picture"+i.cnt}));u=n("#"+r._id+"_picture"+i.cnt);u.data("parentID",r._id);u.css({"background-image":"url('"+i.imgData+"')",height:i.height,width:i.width,left:i.left,top:i.top});f=i.bwidth+" "+i.bstyle+" "+i.bcolor;e=this._getImgBorderHashCode({"border-color":i.bcolor,"border-style":i.bstyle,"border-width":i.bwidth});r.model.allowCellFormatting&&r.XLFormat._writeCssRules(e,r.XLFormat._getCssPropertyAsString({border:{left:f,right:f,top:f,bottom:f}}));u.addClass(e);this._selectImg(u)},_shapeMouseDown:function(t){var i,f;t.preventDefault();i=this.XLObj;f=document.activeElement.id;i._isTouchEvt&&this._imgMouseMove(t);(f.indexOf("PictureHeight")>-1||f.indexOf("PictureWidth")>-1)&&i._setSheetFocus();var u,s=t.target.id,r=n(t.target),h=r.get(0),e=h.offsetLeft,o=h.offsetTop,c=i._setXY(t);this._selectImg(r);this._picCellIdx=this._getCellIndexFromOffset(o,e);this._imgOffsetleft=e;this._imgOffsetTop=o;this._imgX=c[0];this._imgY=c[1];this._shapeType=s.indexOf("chart")>-1?"chart":"img";this._shapeROStart=!0;r.css("cursor")==="move"?this._shapeROStart=!0:(r.css("cursor")==="col-resize"||r.css("cursor")==="row-resize")&&(this._shapeRSStart=!0,i._getContent(i.getActiveSheetIndex()).find(".e-ss-imgvisual").css({left:e,top:o,height:r.height(),width:r.width()}));this._shapeType==="chart"&&(u=i.XLChart._getShapeObj(s,this._shapeType),i.getActiveSheetIndex()!==u.dataSheetIdx||u.isChartSeries||i.XLChart._focusChartRange(u.xAxis.range,u.yAxis.range,u.legend.range));i.model.enableContextMenu&&i.XLCMenu._isMenuOpened&&i.XLCMenu.hideCMenu()},_imgKeyDown:function(n){var r=this.XLObj,s=r.getActiveSheetIndex(),t=r._getContent(s).find(".e-ss-activeimg"),i=t.get(0),e=i.offsetLeft,o=i.offsetTop,u,f,h;if(this._shapeType=t[0].id.indexOf("chart")>-1?"chart":"img",t[0].id.indexOf("_S")&&(this._shapeType="sparkline"),this._picCellIdx=this._getCellIndexFromOffset(o,e),n.shiftKey||n.ctrlKey)n.shiftKey&&!n.ctrlKey&&(n.keyCode===39||n.keyCode===38?(n.preventDefault(),u=t.height()+2,f=t.width()+2,u<400&&f<600&&t.css({width:f,height:u}),this._updateShapeObj(i),r.XLRibbon._formatTabUpdate()):(n.keyCode===37||n.keyCode===40)&&(n.preventDefault(),u=t.height()-2,f=t.width()-2,u>40&&f>60&&t.css({width:f,height:u}),this._updateShapeObj(i),r.XLRibbon._formatTabUpdate()));else{switch(n.keyCode){case 39:n.preventDefault();t.css({left:e+2});this._updateShapeObj(i);break;case 37:n.preventDefault();e>1&&t.css({left:e-2});this._updateShapeObj(i);break;case 38:n.preventDefault();o>1&&t.css({top:o-2});this._updateShapeObj(i);break;case 40:n.preventDefault();t.css({top:o+2});this._updateShapeObj(i)}this._onKeyscrollShape(s,t,n)}n.keyCode===46&&(n.preventDefault(),h=!1,r.XLClipboard._isShape&&(r.XLClipboard._isShape=!1,h=!0),this._deleteShape(s,t),h&&(r.XLClipboard._isShape=!0))},_shapeMouseUp:function(t){var r=this.XLObj,o={};if(!r._isExport){var l,a,c="chart",f,s=r.getActiveSheetIndex(),v=r.getSheet(s),y=r._getContent(s),u=y.find(".e-ss-activeimg"),h=y.find(".e-ss-imgvisual"),e=n(t.target),i=e.get(0);if((e.hasClass("e-ss-picture")||e[0].id.indexOf(r._id+"_picture")>-1)&&r.model.showRibbon&&r.XLRibbon._formatTabUpdate(),(i.localName==="svg"||i.localName==="rect"||i.localName==="path"||i.localName==="circle")&&i&&i.id.indexOf("chart")<0?i=n(i).closest("div.e-sparkline")[0]:n(i).hasClass("e-sparkline")&&(i=i),i&&i.id.indexOf(c)>-1&&i.id.indexOf("Ribbon")<0&&(i=i.id.indexOf("_svg")>-1?n(i).parents(".e-ss-object").get(0):i),u.length<1&&(this._shapeROStart=!1),i.id.indexOf("sparkline")>-1||i.className.indexOf("e-ss-imgvisual")>-1||i.className.indexOf("e-ss-object")>-1||(this._shapeROStart&&(i=u[0]),this._shapeRSStart&&(i=h[0])),this._shapeROStart)r._isTouchEvt&&(a=r._getOriginalEvt(t),i=document.elementFromPoint(a.clientX,a.clientY)),r._isUndoRedo||(parseInt(u.css("top"))!==i.offsetTop||parseInt(u.css("left"))!==i.offsetLeft)&&(f={sheetIndex:s,reqType:"shape",shapeType:"chart",action:"edit",actionType:"reorder",id:n(u).attr("id"),visualImg:h,trgt:e},f.prev={top:parseInt(u.css("top")),left:parseInt(u.css("left")),height:parseInt(u.css("height")),width:parseInt(u.css("width"))},f.cur={top:i.offsetTop,left:i.offsetLeft,height:e.height(),width:e.width()},u[0].id.indexOf(c)>-1&&(l=r._getIdxWithOffset(f.cur.top,f.cur.left,!0),v.shapeMngr[c][u[0].id].rowIndex=l.rowIdx,v.shapeMngr[c][u[0].id].colIndex=l.colIdx),r._checkIndicesInContainer(s,this._picCellIdx.rowIndex,this._picCellIdx.colIndex)&&(f.obj=n.extend(!0,{},r._dataContainer.sheets[s][this._picCellIdx.rowIndex][this._picCellIdx.colIndex]),r._completeAction(f),r._trigActionComplete(f))),u.css({left:i.offsetLeft,top:i.offsetTop}),this._updateShapeObj(i),h.removeClass("e-ss-picture").hide();else if(this._shapeRSStart&&(r._isUndoRedo||(r._isTouchEvt&&(i=h[0]),i.className.indexOf("e-ss-imgvisual")<0&&h.length>0&&this._shapeROStart&&(i=h[0]),e=n(i),(parseInt(u.css("height"))!==e.height()||parseInt(u.css("width"))!==e.width())&&r._checkIndicesInContainer(s,this._picCellIdx.rowIndex,this._picCellIdx.colIndex)&&(f={sheetIndex:s,reqType:"shape",shapeType:"chart",action:"edit",actionType:"resize",id:n(u).attr("id"),visualImg:h,trgt:e},f.prev={top:parseInt(u.css("top")),left:parseInt(u.css("left")),height:parseInt(u.css("height")),width:parseInt(u.css("width"))},f.cur={top:i.offsetTop,left:i.offsetLeft,height:e.height(),width:e.width()},f.obj=n.extend(!0,{},r._dataContainer.sheets[s][this._picCellIdx.rowIndex][this._picCellIdx.colIndex]),r._completeAction(f),r._trigActionComplete(f))),f&&u.css({left:i.offsetLeft,top:i.offsetTop,height:e.height(),width:e.width()}),this._updateShapeObj(i),h.removeClass("e-ss-picture").hide(),this._shapeType==="img"&&r.model.showRibbon&&r.XLRibbon._formatTabUpdate(),this._shapeType===c&&(r.XLChart.resizeChart(u.attr("id"),e.height(),e.width()),r.model.showRibbon&&r.XLRibbon._chartDesignTabUpdate(n("#"+u.attr("id")))),o.event=t,o.target=t.target,f&&f.cur&&f.prev&&(o.newHeight=f.cur.height,o.newWidth=f.cur.width,o.oldHeight=f.prev.height,o.oldWidth=f.prev.width),o.reqType=i.id.indexOf(c)>-1?"chart-resize":"picture-resize",this.XLObj._trigger("resizeEnd",o))){this._refreshImgResizing();this._shapeRSStart=!1;return}this._refreshImgResizing();this._shapeROStart=this._shapeRSStart=!1}},_imgMouseMove:function(n){var i=this.XLObj,s={};if(i._getContent(i.getActiveSheetIndex()).find(".e-ss-activeimg").length){n.preventDefault();var p=i.getActiveSheetIndex(),h=i._getContent(p),u=h.find(".e-ss-activeimg"),t=h.find(".e-ss-imgvisual"),c=u.get(0),o=c.getBoundingClientRect(),w=i._setXY(n),f=w[0],e=w[1],r,l,a;if(this._shapeROStart){if(this.XLObj._trigger("dragShape",n))return!1;t.show();c.id.indexOf("picture")>-1&&t.addClass("e-ss-picture");l=f-(this._imgX-this._imgOffsetleft);a=e-(this._imgY-this._imgOffsetTop);l>-1&&a>-1&&t.css({left:l,top:a,height:u.height(),width:u.width()})}else{var v=t.width(),y=t.height(),b=c.offsetWidth,k=c.offsetHeight,d=i._getJSSheetContent(p).find(".e-spreadsheetcontentcontainer > .e-content"),g=h.find(".e-hscrollbar").data("ejScrollBar"),nt=h.find(".e-vscrollbar").data("ejScrollBar");if(this._shapeRSStart){if(s.event=n,s.target=n.target,s.height=u.height(),s.width=u.width(),s.reqType=c.id.indexOf("chart")>-1?"chart-resize":"picture-resize",this.XLObj._trigger("resizeStart",s)){this._shapeRSStart=!1;return}if(t.show(),c.id.indexOf("picture")>-1&&t.addClass("e-ss-picture"),u.css("cursor")==="col-resize"||u.css("cursor")==="row-resize")switch(!0){case this._imgRSWStart:r=this._imgX-f;l=t[0].offsetLeft-r;l>-1&&(t.css({width:v+r,left:l}),this._imgX=f);break;case this._imgRSEStart:r=this._imgX-f;i.model.scrollSettings.allowScrolling&&v-r+t[0].offsetLeft+5<d.width()+g.value()&&(t.css({width:v-r}),this._imgX=f);break;case this._imgRSNStart:r=this._imgY-e;a=t[0].offsetTop-r;a>-1&&(t.css({height:y+r,top:a}),this._imgY=e);break;case this._imgRSSStart:r=this._imgY-e;i.model.scrollSettings.allowScrolling&&y-r+t[0].offsetTop+5<d.height()+nt.value()&&(t.css({height:y-r}),this._imgY=e)}}else this._refreshImgResizing(),f<=o.left+(i._isTouchEvt?20:4)&&f>=o.left?(u.addClass("e-ss-imgcresize"),this._imgRSWStart=!0):f<=o.left+b&&f>=o.left+b-(i._isTouchEvt?20:4)?(u.addClass("e-ss-imgcresize"),this._imgRSEStart=!0):h.find(".e-ss-imgcresize").removeClass("e-ss-imgcresize"),e<=o.top+(i._isTouchEvt?20:4)&&e>=o.top?(u.addClass("e-ss-imgrresize"),this._imgRSNStart=!0):e<=o.top+k&&e>=o.top+k-(i._isTouchEvt?20:4)?(u.addClass("e-ss-imgrresize"),this._imgRSSStart=!0):h.find(".e-ss-imgrresize").removeClass("e-ss-imgrresize")}}},_deleteShape:function(n,t){var l,i=this.XLObj,u=t[0].id.indexOf("_S")>-1?{rowIndex:t[0].id.replace(i._id,"").split("_")[3],colIndex:t[0].id.replace(i._id,"").split("_")[4]}:this._picCellIdx,h=i._dataContainer,a=i.getSheet(n),s=a.shapeMngr,e=h.sheets[n][u.rowIndex][u.colIndex],o,p=t.data("parentID"),v=t[0].id.indexOf("_S")>-1?t[0].id:t.get(0).id.replace(p+"_",""),r=t[0].id.indexOf("_S")>-1?"sparkline":v.replace(/[0-9]/g,""),c=t.get(0),y,f=t[0].id.indexOf("_S")>-1?s[r][t[0].id]:s[r][e[r][0]];i._isUndoRedo||i._isPaste||i.XLClipboard._isShape||(o={sheetIndex:n,id:c.id,picIndex:c.id,reqType:"shape",shapeType:r,action:"remove",options:f,range:f.range,img:s.sharedPics[f.data],bcolor:f.bcolor,bstyle:f.bstyle,bwidth:f.bwidth},o.actCell={rowIndex:u.rowIndex,colIndex:u.colIndex},o.position={height:f.height,width:f.width,top:f.top,left:f.left},o.cnt=v.replace(/[a-z]/g,""),i._completeAction(o),i._trigActionComplete(o));e[r].some(function(n,t){return c.id===s[r][e[r][t]].id?(y=t,!0):!1});Object.keys(e).length<2&&e[r].length<2?(delete h.sheets[n][u.rowIndex][u.colIndex],i.getObjectLength(h.sheets[n][u.rowIndex])<1&&delete h.sheets[n][u.rowIndex]):e[r].length<2?delete e[r]:e[r].splice(y,1);delete s[r][c.id];l={rowIndex:u.rowIndex,colIndex:u.colIndex};n===i._getSheetIndex()&&(i.setActiveCell(u.rowIndex,u.colIndex),i.performSelection(l,l));t.remove();i.model.allowFormulaBar&&i.updateFormulaBar();i.model.showRibbon&&(r==="picture"?i.XLRibbon._toggleFormatTab():i.XLRibbon._toggleChartDesignTab());a._isChartBorderDrawn&&i.XLChart._clearChartRange(i._arrayAsString(i._chartBorder))},_selectImg:function(n){this.XLObj._getContent(this.XLObj.getActiveSheetIndex()).find(".e-ss-activeimg").removeClass("e-ss-activeimg");n.addClass("e-ss-activeimg");this.XLObj.XLSelection._cleanUp(!0);this.XLObj.model.allowFormulaBar&&this.XLObj.updateFormulaBar()},_refreshImgResizing:function(){this._imgRSEStart=!1;this._imgRSWStart=!1;this._imgRSNStart=!1;this._imgRSSStart=!1},_getShapePropeties:function(n,t,i){for(var r,u=this.XLObj.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,i);r in u;)return u[r].id===t?u[r]:void 0},_updateShapeMngr:function(t,i,r,u){var s,h={},f=this.XLObj,o=u||f.getActiveSheetIndex(),e=f.getSheet(o).shapeMngr,c=e[r];c[i[r].id]=n.extend(!0,{},i[r]);r==="picture"&&(e.sharedPics.indexOf(i[r].data)<0&&e.sharedPics.push(i[r].data),s=e.sharedPics.indexOf(i[r].data),c[i[r].id].data=s);(f._isPaste||this._insertShape||f.XLClipboard._isShape||f.isImport||f.model.isImport||!f.getSheet(o)._isUpdated)&&(h[r]=i[r].id,f.XLEdit._updateDataContainer(t,{dataObj:h,sheetIdx:o}),this._insertShape=!1)},_updateShapeObj:function(n){var f,r=this.XLObj,s=r.getActiveSheetIndex(),c=r._dataContainer,o,e,u=this._shapeType==="img"?"picture":"chart",i,h,a=r.getSheet(s),v=a.shapeMngr,l,y={},p=r._getContent(s).find(".e-ss-activeimg");(n.id.indexOf("Column")>-1||n.id.indexOf("Line")>-1||n.id.indexOf("Winloss")>-1?(h=n.id.replace(r._id,""),i={rowIndex:parseInt(h.split("_")[3]),colIndex:parseInt(h.split("_")[4])},u="sparkline"):i=this._picCellIdx,r.getObjectLength(this._picCellIdx)||(i=this._picCellIdx=this._getCellIndexFromOffset(n.offsetTop,n.offsetLeft)),f=p.length?p:r._getContent(s).find("#"+n.id),e=c.sheets[s][i.rowIndex][i.colIndex],e&&e[u])&&((o=v[u][f[0].id],e[u].some(function(n,t){return f[0].id===v[u][e[u][t]].id?(l=t,!0):!1}),t.isNullOrUndefined(l))||(y[u]=e[u][l],r.getObjectLength(e)<2&&e[u].length<2?delete c.sheets[s][i.rowIndex][i.colIndex]:e[u].length<2?delete c.sheets[s][i.rowIndex][i.colIndex][u]:c.sheets[s][i.rowIndex][i.colIndex][u].splice(l,1),n.id.indexOf("Column")>-1||n.id.indexOf("Line")>-1||n.id.indexOf("Winloss")>-1?(h=n.id.replace(r._id,""),this._picCellIdx=i={rowIndex:parseInt(h.split("_")[3]),colIndex:parseInt(h.split("_")[4])}):this._picCellIdx=i=this._getCellIndexFromOffset(n.offsetTop,n.offsetLeft),o.shapeType!="sparkline"&&(o.height=f.height(),o.width=f.width()),o.left=a._isFreezed&&r._isFrozen(r.getFrozenColumns())?r.XLFreeze._getFreezeHidenDim()+f[0].offsetLeft:f[0].offsetLeft,o.top=a._isFreezed&&r._isFrozen(r.getFrozenRows())?r.XLFreeze._getFreezeHidenDim(!0)+f[0].offsetTop:f[0].offsetTop,o.rowIndex=i.rowIndex,o.colIndex=i.colIndex,r.XLEdit._updateDataContainer({rowIndex:i.rowIndex,colIndex:i.colIndex},{dataObj:y})))},changePictureBorder:function(i,r,u,f){var e=this.XLObj,v=e.getActiveSheetIndex(),o=n("#"+i)[0],y=o.offsetLeft,p=o.offsetTop,s,w=this._getCellIndexFromOffset(p,y),b=e.getSheet(v).shapeMngr,l,k,a=new RegExp("\\be-shapebdr.*?\\b","g"),h,c;l=b.picture[o.id];s={sheetIndex:v,reqType:"shape",shapeType:"picture",action:"border",id:n(e.getSheetElement(v).find(".e-ss-activeimg")).attr("id"),prevClass:t.isNullOrUndefined(o.className.match(a))?o.className:o.className.match(a)[0],picIdx:k,cellIdx:w};h=r+" "+u+" "+f;c=this._getImgBorderHashCode({"border-color":f,"border-style":u,"border-width":r});e.model.allowCellFormatting&&e.XLFormat._writeCssRules(c,e.XLFormat._getCssPropertyAsString({border:{left:h,right:h,top:h,bottom:h}}));l.bcolor=f;l.bstyle=u;l.bwidth=r;o.className.match(a)&&(o.className=o.className.replace(a,""));n(o).addClass(c);s.curClass=c;s.borderProp=this._getImgStyleFromHashCode(c);e._dupDetails||e._isUndoRedo||(e._completeAction(s),e._trigActionComplete(s))},_getCellIndexFromOffset:function(n,i,r,u){var f,o,s=0,h={},l,c=this.XLObj,e=c.getSheet(c._getSheetIndex(r));if(!t.isNullOrUndefined(n))for(h.rowIndex=c._getMinRowIdx(e),f=0,o=e._rowHeightCollection.length;f<o;f++){if(l=e._rowHeightCollection[f],s=c.isUndefined(l)?s+c.model.rowHeight:l,s>n){h.rowIndex=f-1;break}f==o-1&&o++}if(!t.isNullOrUndefined(i))for(h.colIndex=0,f=0,s=0,o=e.columnsWidthCollection.length;f<o;f++)if(s+=e.columnsWidthCollection[f]===0&&u?e.hideColsCollection[f]:e.columnsWidthCollection[f],s>i){h.colIndex=f;break}return h},_getImgBorderHashCode:function(n){var i=this.XLObj,t="";return"border-width"in n&&(t=parseInt(n["border-width"])+"N"),i.model.allowCellFormatting&&"border-style"in n&&(t=t+i.XLFormat._getStyleCode("BorderStyle",n["border-style"])+"N"),"border-color"in n&&(t=t+n["border-color"].replace("#","")),"e-shapebdr"+t},_getImgStyleFromHashCode:function(n){var t={};return n=n||"",n=n.replace("e-shapebdr","").split("N"),n.length>1&&(t["border-width"]=n[0]+"px",t["border-style"]=["","solid","dashed","dotted"][n[1]],t["border-color"]="#"+n[2]),t},_scrollShape:function(n,t,i,r){var f={position:"none",action:"none"},u=this.XLObj,e=u._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content");parseInt(t.css("width"))+(t.offset().left-u._getContent(n).find(".e-content").offset().left)>u._getContent(n).find(".e-content").width()&&this._imgX<=i?f={position:"horizontal",action:"Increment"}:t.offset().left-e.offset().left<=0?f={position:"horizontal",action:"Decrement"}:parseInt(t.css("height"))+(t.offset().top-u._getContent(n).find(".e-content").offset().top)>u._getContent(n).find(".e-content").height()&&this._imgY<=r?f={position:"vertical",action:"Increment"}:t.offset().top-e.offset().top<=0&&(f={position:"vertical",action:"Decrement"});u.XLSelection._scrollCalculation(n,t.get(0),f)},_onKeyscrollShape:function(n,t,i){var r=this.XLObj,u=r._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content"),f=r._getContent(n).find("#hscrollBar").ejScrollBar("instance"),e=r._getContent(n).find("#vscrollBar").ejScrollBar("instance");u.offset().top+u[0].offsetHeight<=t.offset().top+t[0].offsetHeight&&(i.keyCode===40||i.keyCode===13&&!i.shiftKey)?e.scroll(e.value()+2,!0):t.offset().top-r.model.sheets[n]._frozenHeight<=u.offset().top&&(i.keyCode===38||i.keyCode===13&&i.shiftKey)&&e.value()-2>=0&&e.scroll(e.value()-2,!0);u[0].offsetWidth<=t.offset().left+t[0].offsetWidth&&(i.keyCode===39||i.keyCode===9&&!i.shiftKey)?f.scroll(f.value()+2,!0):t.offset().left-r.model.sheets[n]._frozenWidth<=u.offset().left&&(i.keyCode===37||i.keyCode===9&&i.shiftKey)&&f.value()-2>=0&&f.scroll(f.value()-2,!0)},_refreshShapePosOnResize:function(n,t,i,r){var e=this.XLObj,s=e.getSheet(r),c=s.shapeMngr.chart,l=s.shapeMngr.picture,o,f,u,h;if(!e.getObjectLength(l)&&!e.getObjectLength(c))return!1;o=t-(i?s.columnsWidthCollection[n]:s.rowsHeightCollection[n]);for(h in l)u=l[h],i?n<u.colIndex&&(u.left+=o,f=e.getSheetElement(r).find("#"+u.id),f.length&&f.css({left:u.left})):n<u.rowIndex&&(u.top+=o,f=e.getSheetElement(r).find("#"+u.id),f.length&&f.css({top:u.top}));for(h in c)u=c[h],i?n<u.colIndex&&(u.left+=o,f=e.getSheetElement(r).find("#"+u.id),f.length&&f.css({left:u.left})):n<u.rowIndex&&(u.top+=o,f=e.getSheetElement(r).find("#"+u.id),f.length&&f.css({top:u.top}))},_refreshChartdataInsDel:function(i,r,u,f,e){var v,l,c,y,h=this.XLObj,w=h.getSheet(f),b=w.shapeMngr.chart,a=i.status,p=[],k,o,s,d,g,nt;if(this._isRowGreater=!1,!e){for(v=0;v<r;v++)d=a.indexOf("insert")>-1?(a.indexOf("Column")>-1?w.columnsWidthCollection[u+v]:w.rowsHeightCollection[u+v])*2:0,this._refreshShapePosOnResize(u+v,d,a.indexOf("Column")>-1,f);h.isUndefined(e)&&(e=!0)}if(e)for(k in b){o=b[k];s=o.range;l=o.isRowColSwitched?o.lRange:o.xRange;c=o.yRange;y=o.isRowColSwitched?o.xRange:o.lRange;switch(a){case"insertColumn":s&&(g=s[2]-s[0],nt=s[3]-s[1],g>nt&&(this._isRowGreater=!0));h._isUndo?t.isNullOrUndefined(i.prevChartDetails)||h.XLChart.refreshChart(i.prevChartDetails.id,i.prevChartDetails):!h._isUndo&&h._isUndoRedo?t.isNullOrUndefined(i.curChartDetails)||h.XLChart.refreshChart(i.curChartDetails.id,i.curChartDetails):s&&u<=s[1]&&!o.isChartSeries?(h._prevChartDetails=n.extend(!0,{},{id:o.id,range:o.range,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,isRowColSwitched:o.isRowColSwitched}),s[1]+=r,s[3]+=r,o.range=s,h.XLChart.refreshChart(o.id,{range:o.range}),h._curChartDetails=n.extend(!0,{},{id:o.id,range:o.range,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,isRowColSwitched:o.isRowColSwitched})):this._isRowGreater||!h._inColumn(s,u)||o.isChartSeries?(this._isRowGreater||o.seriesRange.length)&&(h._prevChartDetails=n.extend(!0,{},{id:o.id,range:o.range,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isRowColSwitched:o.isRowColSwitched}),(t.isNullOrUndefined(o.seriesRange)||o.seriesRange.length==0)&&(p=this._constructSeriesRange(o,this._isRowGreater)),o.seriesRange=this._isInSeriesRange(o,p.length!=0?p:o.seriesRange,u,r,a),p=[],o.range=null,o.xRange=null,o.yRange=null,o.lRange=null,o.isChartSeries=!0,h.XLChart._refreshChart(o),h._curChartDetails=n.extend(!0,{},{id:o.id,range:o.range,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,isRowColSwitched:o.isRowColSwitched})):(o.seriesRange=null,h._prevChartDetails=n.extend(!0,{},{id:o.id,range:o.range,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,isRowColSwitched:o.isRowColSwitched}),u<c[1]||u<l[1]?(s[1]+=r,s[3]+=r,o.range=s,o.isChartSeries=!1,h.XLChart.refreshChart(o.id,{range:o.range,isChartSeries:o.isChartSeries})):u>c[1]&&u<=c[3]?(s[3]+=r,o.range=s,o.isChartSeries=!1,h.XLChart.refreshChart(o.id,{range:o.range,isChartSeries:o.isChartSeries})):u<=c[1]&&(c[1]+=r,c[3]+=r,l[1]+=r,l[3]+=r,o.range=null,o.xRange=null,o.yRange=null,o.lRange=null,o.isChartSeries=!0,o.isRowColSwitched=!1,o.seriesRange=[{xRange:[l[0],l[1],l[2],l[3]],yRange:[c[0],c[1],c[2],c[3]],lRange:[y[0],y[1],y[2],y[3]]}],o.seriesRange=this._constructSeriesRange(o,this._isRowGreater),h.XLChart._refreshChart(o)),h._curChartDetails=n.extend(!0,{},{id:o.id,range:o.range,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,isRowColSwitched:o.isRowColSwitched}));break;case"deleteColumn":h._prevChartDetails=n.extend(!0,{},{id:o.id,range:o.range,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isRowColSwitched:o.isRowColSwitched});h._isUndo?t.isNullOrUndefined(i.prevChartDetails)||h.XLChart.refreshChart(i.prevChartDetails.id,i.prevChartDetails):!h._isUndo&&h._isUndoRedo?t.isNullOrUndefined(i.curChartDetails)||h.XLChart.refreshChart(i.curChartDetails.id,i.curChartDetails):s?(u<s[1]?(s[1]-=r,s[3]-=r):u>s[1]&&u<=s[3]?s[3]-=r:u==s[1]&&(s[3]-=r),o.range=s,h.XLChart.refreshChart(o.id,o)):o.seriesRange.length&&(o.seriesRange=this._isInSeriesRange(o,o.seriesRange,u,r,a),h.XLChart._refreshChart(o));h._curChartDetails=n.extend(!0,{},{id:o.id,range:o.range,xRange:o.xRange,yRange:o.yRange,lRange:o.lRange,isChartSeries:o.isChartSeries,seriesRange:o.seriesRange,isRowColSwitched:o.isRowColSwitched});break;case"insertRow":case"deleteRow":!t.isNullOrUndefined(s)&&u<=s[0]?(a=="insertRow"?(s[0]+=r,s[2]+=r):(s[0]-=r,s[2]-=r),h.XLChart.refreshChart(o.id,{range:s})):h._inRow(o.range,u)&&h.XLChart.refreshChart(o.id,{range:s})}}},_constructSeriesRange:function(n,i){var v=0,a=this.XLObj,d,s,h,p=[],w=[],b=[],f=n.seriesRange,c,r,u,y,l,k,e,o;for(c=t.isNullOrUndefined(n.xRange)?!t.isNullOrUndefined(f)&&!t.isNullOrUndefined(f[0])&&!t.isNullOrUndefined(f[0].xRange)?f[0].xRange:null:n.xRange,r=t.isNullOrUndefined(n.yRange)?!t.isNullOrUndefined(f)&&!t.isNullOrUndefined(f[0])&&!t.isNullOrUndefined(f[0].yRange)?f[0].yRange:null:n.yRange,u=t.isNullOrUndefined(n.lRange)?!t.isNullOrUndefined(f)&&!t.isNullOrUndefined(f[0])&&!t.isNullOrUndefined(f[0].lRange)?f[0].lRange:null:n.lRange,t.isNullOrUndefined(u)||(y=u[3]-u[1],o=[u[0],u[1],u[2],u[3]-y]),t.isNullOrUndefined(r)||(l=r[3]-r[1],k=l,e=[r[0],r[1],r[2],r[3]-l]),i||(y=u[2]-u[0],l=r[2]-r[0],k=l,o=[u[0],u[1],u[2]-y,u[3]],e=[r[0],r[1],r[2]-l,r[3]]),p=[];v<=k;)i?(s=a.getAlphaRange(e[0],e[1]++,e[2],e[3]++),b.push(s),h=a.getAlphaRange(o[0],o[1]++,o[2],o[3]++),w.push(h)):(s=a.getAlphaRange(e[0]++,e[1],e[2]++,e[3]),b.push(s),h=a.getAlphaRange(o[0]++,o[1],o[2]++,o[3]),w.push(h)),d=t.isNullOrUndefined(c)?null:a.getAlphaRange(c[0],c[1],c[2],c[3]),s=b[v],h=w[v],p.push({xRange:d,yRange:s,lRange:h}),v++;return p},_isInSeriesRange:function(n,i,r,u,f){var l=this.XLObj,h=f=="insertColumn",e,o,s,c;for(n.seriesRange=[],c=0;c<i.length;c++)e=t.isNullOrUndefined(i[c].xRange)?[]:l.getRangeIndices(i[c].xRange),o=t.isNullOrUndefined(i[c].yRange)?[]:l.getRangeIndices(i[c].yRange),s=t.isNullOrUndefined(i[c].lRange)?[]:l.getRangeIndices(i[c].lRange),r<=e[1]?(e[1]=h?e[1]+u:e[1]-u,e[3]=h?e[3]+u:e[3]-u):r>e[1]&&r<=e[3]&&(e[3]=h?e[3]+u:e[3]-u),r<=o[1]?(o[1]=h?o[1]+u:o[1]-u,o[3]=h?o[3]+u:o[3]-u):r>o[1]&&r<=o[3]&&(o[3]=h?o[3]+u:o[3]-u),r<=s[1]?(s[1]=h?s[1]+u:s[1]-u,s[3]=h?s[3]+u:s[3]-u):r>s[1]&&r<=s[3]&&(s[3]=h?s[3]+u:s[3]-u),n.seriesRange.push({xRange:e.length==0?null:l.getAlphaRange(e[0],e[1],e[2],e[3]),yRange:o.length==0?null:l.getAlphaRange(o[0],o[1],o[2],o[3]),lRange:s.length==0?null:l.getAlphaRange(s[0],s[1],s[2],s[3])});return n.seriesRange}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.chart=function(n){this.XLObj=n;this._shapeCnt=1;this._isNumber=!1;this._isString=!1};t.spreadsheetFeatures.chart.prototype={createChart:function(n,i){var r=this.XLObj,s,tt,it,rt,ut,v,d,g,h,o;if((this._isNumber=!1,this._isString=!1,r.model.allowCharts&&(!r.getSheet()._isLoaded||!r.model.isReadOnly))&&(h=r._getSheetIndex(i.sheetIdx),o={sheetIndex:h,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:i,range:n,id:i.id,position:{top:i.top,left:i.left},operation:"create",seriesRange:i.seriesRange,isChartSeries:i.isChartSeries},!r._trigActionBegin(o))){i=o.options;n=o.range;tt=o.id;it=o.position;rt=o.seriesRange;ut=o.isChartSeries;i=i||{};var c,e,f,y,p,w,u,l,b="chart",a=r.getSheet(h),k,nt=!1;if(r._isUndoRedo&&(k=i.id.split("_"),c=k[k.length-1].replace(/[a-z]/g,"")),i.isChartSeries||(i.isChartSeries=i.series&&n==null),i.isChartSeries||(n=r._getRangeArgs(n,"object")),t.isNullOrUndefined(i.top)||t.isNullOrUndefined(i.left)||(i.activeCell=r.XLShape._getCellIndexFromOffset(i.top,i.left)),i.activeCell||(i.activeCell=a._activeCell),r.isRange(n)&&i.activeCell||i.isChartSeries){if(w=r._getCellInfo(i.activeCell),i.id=c?r._id+"_"+b+c:r._id+"_"+b+this._shapeCnt,i.type=i.type?i.type:"column",i.animation=i.animation?i.animation:!1,i.isChartSeries||(i.range=n),i.dataSheetIdx=i.dataSheetIdx?i.dataSheetIdx:h,i.height=i.height?i.height:r.model.chartSettings.height,i.width=i.width?i.width:r.model.chartSettings.width,i.top=i.top?i.top:w.top+2,i.left=i.left?i.left:w.left+2,i.range&&(d=i.range[2]-i.range[0],g=i.range[3]-i.range[1],d<g&&(nt=!0)),i.isRowColSwitched=nt?!0:i.isRowColSwitched?i.isRowColSwitched:!1,p=r._getIdxWithOffset(i.top,i.left,!0),i.rowIndex=p.rowIdx,i.colIndex=p.colIdx,i.isResponsive=!1,i.canResize=!1,i.isChartSeries||(r.isUndefined(i.xRange)&&(l=this._processChartRange(n,i.dataSheetIdx,i),i.xRange=l.xRange,i.yRange=l.yRange,i.lRange=l.lRange),f=this._processChartSeries(i),i.series&&(r.XLClipboard._copyCells.length||r.XLClipboard._cutCells.length)&&(f.series=i.series)),i.isChartSeries)if(r.isUndefined(i.series))f=this._processChartSeries(i),i.series=f.series;else if(i.seriesRange.length>0)for(v=this._processSeriesValues(i).series,s=0;s<v.length;s++)i.series[s].points=v[s].points;return i.isChartSeries||r.getActiveSheetIndex()===i.dataSheetIdx&&this._focusChartRange(f.xRange,f.yRange,f.lRange),e=this._renderBaseElem(b,i.top,i.left,c),e.ejChart(this._processChartOptions(i,i.isChartSeries?null:f.series)),this._afterChartRefresh(),u=e.ejChart("model"),i.isChartSeries&&(i.series=u.series),i.theme=u.theme,u.primaryXAxis.range=u.primaryXAxis.actualRange,u.primaryYAxis.range=u.primaryYAxis.actualRange,i.title={text:u.title.text.length?u.title.text:"",align:u.title.textAlignment,font:u.title.font},i.xAxis={min:u.primaryXAxis.range.min,max:u.primaryXAxis.range.max,interval:u.primaryXAxis.range.interval,title:{text:u.primaryXAxis.title.text.length?u.primaryXAxis.title.text:""},range:i.isChartSeries?null:f.xRange},i.yAxis={min:u.primaryYAxis.range.min,max:u.primaryYAxis.range.max,interval:u.primaryYAxis.range.interval,title:{text:u.primaryYAxis.title.text.length?u.primaryYAxis.title.text:""},range:i.isChartSeries?null:f.yRange},i.legend={visible:u.legend.visible,range:i.isChartSeries?null:f.lRange,position:u.legend.position},a._isImported||(r.XLShape._insertShape=!0),r.XLShape._updateShapeMngr(i.activeCell,{chart:i},"chart"),r.element.append("<input id="+r._id+'_chart type="text" style="display:none;"/>'),i.theme.indexOf("dark")>-1&&e.addClass("e-ss-charttheme"),r.model.showRibbon&&!i.hideTab&&r.XLRibbon._chartDesignTabUpdate(e),r._on(e,t.eventType.mouseDown,r._mouseDownHandler),r._on(e,t.eventType.mouseMove,r._mouseMove),e.height(e.height()-5),r._setSheetFocus(),r._isSheetNavigate||a._isImported&&!a._isLoaded||r._isUndoRedo||r._isPaste||r.XLClipboard._isShape||(y={sheetIndex:h,reqType:"shape",shapeType:"chart",action:"create",options:i,range:i.range,id:i.id,position:{top:i.top,left:i.left},operation:"create",seriesRange:i.seriesRange,isChartSeries:i.isChartSeries},r._completeAction(y),r._trigActionComplete(y)),i.id}}},resizeChart:function(i,r,u){var o={},s=n("#"+i),h=s.ejChart("model"),e=this.XLObj,f;e.model.isReadOnly||s.length&&(o.height=!t.isNullOrUndefined(r)&&r>180?r.toString():"180",o.width=!t.isNullOrUndefined(u)&&u>180?u.toString():"180",e.model.allowFormulaBar&&(f=e.element.find(".e-formulabar")[0]),f&&(f.style.display="none"),s.ejChart("option",{size:o}),f&&(f.style.display="block"),e.XLRibbon._setShapeWidthHeight({height:h.size.height,width:h.size.width,shapeType:"chart"}))},refreshChart:function(i,r){var e=this.XLObj;if(e.model.allowCharts&&!e.model.isReadOnly){var h,c="marker",u=this._getShapeObj(i,"chart"),o,s=e.element.find("#"+i),l=s.data("ejChart"),f,a;if(u){for(h in r)u[h]=r[h];r.type&&(r.commonSeriesOptions={type:r.type},delete r.type);c in r&&(r.commonSeriesOptions?r.commonSeriesOptions.marker={visible:r.marker.visible}:r.commonSeriesOptions={marker:r.marker},delete r[c]);r.range?(l.model.series.length=0,r.range[0].xRange||r.range[0].yRange||r.range[0].lRange?(r.range[0].lRange=t.isNullOrUndefined(r.range[0].lRange)?"":r.range[0].lRange,u.isChartSeries=!0,u.seriesRange=r.range,o=this._processSeriesValues(u)):(l.model.series.length=0,a=e._getRangeArgs(r.range,"object"),f=this._processChartRange(a,u.dataSheetIdx,u),u.isChartSeries=!1,u.xRange=f.xRange,u.yRange=f.yRange,u.lRange=f.lRange,u.legend.range=f.lRange,o=this._processChartSeries(u),r.xRange=f.xRange,r.yRange=f.yRange,r.lRange=f.lRange,this._focusChartRange(f.xRange,f.yRange,f.lRange)),u.xAxis.range=u.isChartSeries?null:f.xRange,u.yAxis.range=u.isChartSeries?null:f.yRange,r.series=o.series):r.seriesRange&&(u.seriesRange=r.seriesRange,o=this._processSeriesValues(u));n("#"+i).ejChart("option",r);("left"in r||"top"in r)&&(e.XLShape._shapeType="chart",s.css({left:u.left,top:u.top}),e.XLShape._picCellIdx={rowIndex:u.rowIndex,colIndex:u.colIndex},e.XLShape._selectImg(s),e.XLShape._updateShapeObj(s[0]),e.XLShape._shapeType="img")}}},_processChartOptions:function(n,i){var f,e,r={commonSeriesOptions:{type:n.type,enableAnimation:n.animation},series:i==null?n.series:i,canResize:n.canResize,size:{height:n.height.toString(),width:n.width.toString()},enableRotation:!1,depth:100,wallSize:2,tilt:0,rotation:34,perspectiveAngle:90,sideBySideSeriesPlacement:!0},u,o;if(n.series)for(u=0,o=n.series.length;u<o;u++)t.isNullOrUndefined(r.series[u])||(r.series[u].trendlines=n.series[u].trendlines);return f=e=!1,n.enable3D&&(r.enable3D=!0),n.marker&&(r.commonSeriesOptions.marker=n.marker),n.theme&&(r.theme=n.theme),r.title=n.title||{},this.XLObj.getObjectLength(r.title)>0&&(r.title.textAlignment=n.title.align,delete r.title.align),r.legend=n.legend||{},n.xAxis&&n.xAxis.minorGridLines&&(f=n.xAxis.minorGridLines.visible),n.yAxis&&n.yAxis.minorGridLines&&(e=n.yAxis.minorGridLines.visible),r.primaryYAxis=n.primaryYAxis||{labelFormat:this._chartYAxisFormat(n.yRange),minorTicksPerInterval:5,minorGridLines:{visible:e},minorTickLines:{visible:!1}},r.primaryXAxis=n.primaryXAxis||{labelFormat:this._chartYAxisFormat(n.xRange),minorTicksPerInterval:5,minorGridLines:{visible:f},minorTickLines:{visible:!1},labelIntersectAction:"wrapByWord"},this._isNumber&&this._isString&&(r.primaryXAxis.valueType="category"),r},_chartYAxisFormat:function(n){if(!t.isNullOrUndefined(n)){var u=this.XLObj,i,r=t.globalize.preferredCulture().numberFormat.currency.symbol;return i=u.XLEdit.getPropertyValue(n[0],n[1],"type"),i==="accounting"?r+" {value}":i==="currency"?r+"{value}":i==="percentage"?"{value}%":"{value}"}},_processChartRange:function(n,i,r){var e=this.XLObj,y,o,l,c,v,a,u=n[0],f=n[1],b=!1,h=n[2],s=n[3],p=u===h,w=f===s;return c=e.XLEdit.getPropertyValue(u,s,"value2",i),c=e.XLEdit._parseValue(c).value,v=e.XLEdit.getPropertyValue(h,f,"value2",i),v=e.XLEdit._parseValue(v).value,a=e.XLEdit.getPropertyValue(u,f,"value2",i),a=e.XLEdit._parseValue(a).value,e.isNumber(v)&&a||(b=!0),(!e.isUndefined(a)||p||w)&&(r.type!="scatter"||n[3]-n[1]!=1)?t.isNullOrUndefined(v)||!b||p||w?(o=[u,f,h,s],t.isNullOrUndefined(c)||e.isNumber(c)||e._isDateTime(c)?t.isNullOrUndefined(a)&&(p||w)&&(l=[u,f,u,s],p?(o[1]=o[1]+1,l[3]=l[1]):o[0]=o[0]+1):(l=[u,f,u,s],o[0]=o[0]+1)):t.isNullOrUndefined(c)||e.isNumber(c)&&a?(y=[u,f,h,f],o=[u,f+1,h,s]):(y=[u+1,f,h,f],o=[u+1,f+1,h,s],l=[u,f+1,u,s]):(y=[u+1,f,h,f],o=[u+1,f+1,h,s],l=[u,f+1,u,s]),{xRange:y,yRange:o,lRange:l}},_processChartSeries:function(n){n=n||{};var t=this.XLObj,i,g,f=n.xRange,e=n.yRange,o=n.lRange,s,u,l,a,p,w,b,h,c,nt,v=0,r=0,k=[],y=["value2"],d;if(n.isChartSeries)k=this._processSeriesValues(n).series;else for(u=t.getRangeData({range:e,sheetIdx:n.dataSheetIdx,skipFormula:!0}),p=e[2]-e[0]+1,w=e[3]-e[1]+1,n.isRowColSwitched?(s=o?t._toArrayData(t.getRangeData({range:o,property:y,sheetIdx:n.dataSheetIdx})):this._getVirtualXValues(w+1),f&&(l=t._toArrayData(t.getRangeData({range:f,property:y,sheetIdx:n.dataSheetIdx}))),a=p):(s=f?t._toArrayData(t.getRangeData({range:f,property:y,sheetIdx:n.dataSheetIdx})):this._getVirtualXValues(p+1),o&&(l=t._toArrayData(t.getRangeData({range:o,property:y,sheetIdx:n.dataSheetIdx}))),a=w),g=s.length,nt=n.isRowColSwitched?1:a;v<a;){for(c=0,b=[],r=n.isRowColSwitched?r:v;c<g;)u[r]&&(i=u[r].value,t.isFormula(i)&&(i=u[r].value2,u[r].type==="percentage"&&(i=t.XLEdit._parseValue(i).value/100),(u[r].type==="currency"||u[r].type==="accounting")&&(i=t.XLEdit._parseValue(i).value)),t.isNumber(i)?i=Number(i):(d=t._dateToInt(i),i=isNaN(d)?0:d),b.push({x:s[c],y:i})),t.isNumber(s[c])?this._isNumber=!0:this._isString=!0,r+=nt,c++;h={points:b};n.type==="doughnut"&&(h.explode=n.explode,h.enableAnimation=n.enableAnimation);l&&(h.name=l[v]);k.push(h);v++}return{series:k,xRange:n.isChartSeries?null:n.isRowColSwitched?o:f,yRange:n.isChartSeries?null:e,lRange:n.isChartSeries?null:n.isRowColSwitched?f:o}},_processSeriesValues:function(n){for(var p,e,f,a,v,w,b,d,c,g,nt,tt,l,it,k=this.XLObj,u=n.seriesRange,ft=u.length,et=[],r=[],rt={},h,ut,o,y,s,i=0;i<ft;i++){if(r[i]={xValues:[],yValues:[],lValues:[]},d=u[i].xRange,t.isNullOrUndefined(d))for(w=t.isNullOrUndefined(u[i].points)?n.series[i].points.length:u[i].points.length,b=t.isNullOrUndefined(u[i].points)?n.series[i].points:u[i].points,v=0;v<w;v++)r[i].xValues[v]=b[v].x;else for(c=this._processRangeValues(d,n.dataSheetIdx),o=0;o<c.length;o++)c[o]instanceof Date&&(c[o]=c[o].toLocaleDateString(t.cultureObject.name)),r[i].xValues[o]=c[o];if(g=u[i].yRange,t.isNullOrUndefined(g))for(w=t.isNullOrUndefined(u[i].points)?n.series[i].points.length:u[i].points.length,b=t.isNullOrUndefined(u[i].points)?n.series[i].points:u[i].points,a=0;a<w;a++)r[i].yValues[a]=b[a].y;else for(nt=this._processRangeValues(g,n.dataSheetIdx),y=0;y<nt.length;y++)h=nt[y],k.isNumber(h)?h=Number(h):(ut=k._dateToInt(h),h=isNaN(ut)?0:ut),r[i].yValues[y]=h;if(tt=u[i].lRange,t.isNullOrUndefined(tt))r[i].lValues[0]=t.isNullOrUndefined(u[i].name)?n.series[i].name:u[i].name;else for(l=this._processRangeValues(tt,n.dataSheetIdx),s=0;s<l.length;s++)l[s]instanceof Date&&(l[s]=l[s].toLocaleDateString(t.cultureObject.name)),r[i].lValues[s]=l[s]}for(f=0;f<ft;){for(e=0,it=[];e<r[f].xValues.length;)it.push({x:k.isNumber(r[f].xValues[e])?r[f].xValues[e]:new Date(r[f].xValues[e]).toString()!=="Invalid Date"?r[f].xValues[e]:0,y:k.isNumber(r[f].yValues[e])?Number(r[f].yValues[e]):0}),e++;for(rt={points:it},p=0;p<r[f].lValues.length;)rt.name=r[f].lValues[p],p++;et.push(rt);f++}return{series:et}},_processRangeValues:function(n,t){var u=this.XLObj,i,f,e,r;if(n.indexOf(":")>=0)i=u.getRangeData({range:n,property:["value"],sheetIdx:t,valueOnly:!0,skipFormula:!0});else if(n.indexOf(",")>=0)for(f=n.split(","),i=[],r=0;r<f.length;r++)e=u.getRangeData({range:f[r],property:["value"],sheetIdx:t,valueOnly:!0,skipFormula:!0}),i.push(e);else i=u.getRangeData({range:n,property:["value"],sheetIdx:t,valueOnly:!0,skipFormula:!0});return i.toString().indexOf(",")>-1&&(i=i.toString().split(",")),i},_getVirtualXValues:function(n){for(var t=1,i=[];t<n;)i.push(t.toString()),t++;return i},_focusChartRange:function(n,t,i){var r=this.XLObj,u=r._chartBorder;this._clearChartRange(r._arrayAsString(u));i&&r.XLSelection._focusBorder({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]},u[0]);n&&r.XLSelection._focusBorder({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]},u[1]);r.XLSelection._focusBorder({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]},u[2]);r.getSheet(r.getActiveSheetIndex())._isChartBorderDrawn=!0},_clearChartRange:function(n){var t=this.XLObj;t.XLSelection._clearBorder(n);t.getSheet(t.getActiveSheetIndex())._isChartBorderDrawn=!1},_renderBaseElem:function(i,r,u,f){f=t.isNullOrUndefined(f)?this._shapeCnt:f;var e=this.XLObj,o=n("<div id='"+e._id+"_"+i+f+"' class='e-ss-object' style='top:"+r+"px;left:"+u+"px; min-height:180px; min-width:180px' ><\/div>");return o.data("parentID",e._id),e._getContent(e.getActiveSheetIndex()).find(".e-content").first().append(o),e.XLShape._selectImg(o),e._isUndoRedo||this._shapeCnt++,o},_refreshChartElements:function(n,t,i){for(var u,f,r,e=this.XLObj,o=1,s=e.model.sheetCount+1;o<s;){if(u=e.getSheet(o).shapeMngr.chart,f=e.getObjectLength(u),f)while(f--)r=u[e.getObjectKeys(u)[f]],r.dataSheetIdx===i&&(this.XLObj.inRange(r.range,n,t)||this.XLObj._inRow(r.range,n)||this.XLObj._inColumn(r.range,t)||this.XLObj.XLChart._isSeriesRange(r,n,t))&&this._refreshChart(r);o++}},_isSeriesRange:function(n,t,i){var r,f,e,o,s,u;if(n.seriesRange)for(u=0;u<n.seriesRange.length;u++)if(r=n.seriesRange[u],r.xRange&&(e=this._isChartSeriesRange(r.xRange,t,i)),r.yRange&&(o=this._isChartSeriesRange(r.yRange,t,i)),r.lRange&&(s=this._isChartSeriesRange(r.lRange,t,i)),f=e||o||s,f)return f;return!1},_isChartSeriesRange:function(n,t,i){var r=this.XLObj,u,e,o,f;if(n.indexOf(":")>=0){if(u=r._getRangeArgs(n),r.inRange(u,t,i))return!0}else if(n.indexOf(",")>=0){for(e=n.split(","),f=0;f<e.length;f++)if(o=r._getRangeArgs(e[f]),r.inRange(o,t,i))return!0}else if(u=r._getRangeArgs(n),r.inRange(u,t,i))return!0;return!1},_refreshChart:function(i){var u,h;if(n("#"+i.id).length!==0){var s=this.XLObj,f,r=n("#"+i.id).data("ejChart"),e={xRange:i.xRange,yRange:i.yRange,lRange:i.lRange,isRowColSwitched:i.isRowColSwitched,dataSheetIdx:i.dataSheetIdx,seriesRange:i.seriesRange,isChartSeries:i.isChartSeries,series:i.series},o;if(r.model.series.length=0,o=this._processChartSeries(e),e.series)for(u=0,h=e.series.length;u<h;u++)t.isNullOrUndefined(e.series[u])||(o.series[u].trendlines=e.series[u].trendlines);s.model.allowFormulaBar&&(f=s.element.find(".e-formulabar")[0]);f&&(f.style.display="none");r.model.primaryXAxis.range.min=r.model.primaryXAxis.range.max=r.model.primaryXAxis.range.interval=null;r.model.primaryYAxis.range.min=r.model.primaryYAxis.range.max=r.model.primaryYAxis.range.interval=null;r.option({series:o.series,primaryXAxis:{labelFormat:this._chartYAxisFormat(i.xRange)},primaryYAxis:{labelFormat:this._chartYAxisFormat(i.yRange)}});r.model.primaryXAxis.range=r.model.primaryXAxis.actualRange;r.model.primaryYAxis.range=r.model.primaryYAxis.actualRange;f&&(f.style.display="block")}},switchRowColumn:function(t){var i=this.XLObj,f;if(!i.model.isReadOnly&&(f={sheetIndex:i.getActiveSheetIndex(),reqType:"shape",type:"actionBegin",shapeType:"chart",action:"srcolumn",chartId:t,rowIndex:i.XLShape._picCellIdx.rowIndex,colIndex:i.XLShape._picCellIdx.colIndex},!i._trigActionBegin(f))){t=f.chartId;var u,o,e=t||document.getElementById(i._id+"_chart").value,s=n("#"+e).ejChart("instance"),r=i.XLChart._getShapeObj(e,"chart"),h={sheetIndex:i.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:"srcolumn",cid:e,rowIndex:i.XLShape._picCellIdx.rowIndex,colIndex:i.XLShape._picCellIdx.colIndex};r.isChartSeries||(s.model.series.length=0,r.isRowColSwitched=!r.isRowColSwitched,o={xRange:r.xRange,yRange:r.yRange,lRange:r.lRange,isRowColSwitched:r.isRowColSwitched,dataSheetIdx:r.dataSheetIdx},u=i.XLChart._processChartSeries(o),s.option({series:u.series}),i.getActiveSheetIndex()===r.dataSheetIdx&&i.XLChart._focusChartRange(u.xRange,u.yRange,u.lRange),r.xAxis.range=u.xRange,r.yAxis.range=u.yRange,r.legend.range=u.lRange,i._completeAction(h),i._trigActionComplete(h))}},updateChartElement:function(i,r,u){var o=this.XLObj,a,l;if(!o.model.isReadOnly&&(a=o.getActiveSheetIndex(),l={sheetIndex:a,reqType:"shape",shapeType:"chart",type:"actionBegin",action:"updatechartelem",chartId:i,value:r,title:u,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex},!o._trigActionBegin(l))){i=l.chartId;r=l.value;o._showDialog(o._id+"_chartname");var v,y=i||document.getElementById(o._id+"_chart").value,h,e=n("#"+y).ejChart("instance"),c,f={sheetIndex:a,reqType:"shape",shapeType:"chart",cid:y,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex},s=o.getSheet(a).shapeMngr.chart[o.XLEdit.getPropertyValue(o.XLShape._picCellIdx.rowIndex,o.XLShape._picCellIdx.colIndex,"chart")[0]];u?l={model:{text:o._getLocStr("Ok")}}:u="";o.model.allowFormulaBar&&(v=o.element.find(".e-formulabar")[0]);v&&(v.style.display="none");switch(r){case"PHAxis":f.visibility=!e.model.primaryXAxis.visible;e.option("primaryXAxis",{visible:f.visibility});s.xAxis.visible=f.visibility;f.action=f.operation=r;break;case"PVAxis":f.visibility=!e.model.primaryYAxis.visible;e.option("primaryYAxis",{visible:f.visibility});s.yAxis.visible=f.visibility;f.action=f.operation=r;break;case"PHAxisTitle":o._cOpt.prev={text:s.xAxis.title.text};e.model.primaryXAxis.title.text.length!=0?(e.option("primaryXAxis",{title:{text:""}}),s.xAxis.title.text="",f={sheetIndex:a,reqType:"shape",shapeType:"chart",operation:"PHAxisTitle",action:"PX",cid:y,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{text:o._cOpt.prev.text},cur:{text:""}},o._completeAction(f),o._trigActionComplete(f)):(o._hasTitle="PX",document.getElementById(o._id+"_chartname").value=s.xAxis.title.text,u.length<1?(n("#"+o._id+"_chartnamedlg").ejDialog("open"),n("#"+o._id+"_chartname").focus().setInputPos(s.xAxis.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(l,u,"PHAxisTitle"),o._cOpt={prevText:s.title.text,prevAlign:e.model.title.textAlignment,curAlign:e.model.title.textAlignment});break;case"PVAxisTitle":o._cOpt.prev={text:s.yAxis.title.text};e.model.primaryYAxis.title.text.length!=0?(e.option("primaryYAxis",{title:{text:""}}),s.yAxis.title.text="",f={sheetIndex:a,reqType:"shape",shapeType:"chart",operation:"PVAxisTitle",action:"PY",cid:y,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{text:o._cOpt.prev.text},cur:{text:""}},o._completeAction(f),o._trigActionComplete(f)):(o._hasTitle="PY",document.getElementById(o._id+"_chartname").value=s.yAxis.title.text,u.length<1?(n("#"+o._id+"_chartnamedlg").ejDialog("open"),n("#"+o._id+"_chartname").focus().setInputPos(s.yAxis.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(l,u,"PVAxisTitle"),o._cOpt={prevText:s.title.text,prevAlign:e.model.title.textAlignment,curAlign:e.model.title.textAlignment});break;case"CTNone":case"CTnone":o._cOpt.prev={text:s.title.text};e.model.title.text.length&&(e.option("title",{text:""}),s.title.text="",f={sheetIndex:a,reqType:"shape",shapeType:"chart",action:"CT",operation:"CTNone",cid:y,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{text:o._cOpt.prev.text},cur:{text:""}},o._completeAction(f),o._trigActionComplete(f));break;case"CTCenter":case"CTcenter":o._hasTitle="CT";o._cOpt={prevText:e.model.title.text,prevAlign:e.model.title.textAlignment};document.getElementById(o._id+"_chartname").value=s.title.text;u.length<1?(n("#"+o._id+"_chartnamedlg").ejDialog("open"),n("#"+o._id+"_chartname").focus().setInputPos(s.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(l,u,"CTCenter");e.option("title",{textAlignment:"center"});o._cOpt.curAlign=e.model.title.textAlignment;s.title.align="center";break;case"CTFar":case"CTfar":o._hasTitle="CT";o._cOpt={prevText:e.model.title.text,prevAlign:e.model.title.textAlignment};document.getElementById(o._id+"_chartname").value=s.title.text;u.length<1?(n("#"+o._id+"_chartnamedlg").ejDialog("open"),n("#"+o._id+"_chartname").focus().setInputPos(s.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(l,u,"CTFar");e.option("title",{textAlignment:"far"});o._cOpt.curAlign=e.model.title.textAlignment;s.title.align="far";break;case"CTNear":case"CTnear":o._hasTitle="CT";o._cOpt={prevText:e.model.title.text,prevAlign:e.model.title.textAlignment};document.getElementById(o._id+"_chartname").value=s.title.text;u.length<1?(n("#"+o._id+"_chartnamedlg").ejDialog("open"),n("#"+o._id+"_chartname").focus().setInputPos(s.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(l,u,"CTNear");e.option("title",{textAlignment:"near"});o._cOpt.curAlign=e.model.title.textAlignment;s.title.align="near";break;case"DLNone":for(h=[],f.action="DL",f.operation="DLNone",f.prev={series:n.extend(!0,[],e.model.series)},c=0;c<e.model.series.length;c++)h.push({marker:{dataLabel:{visible:!1,verticalTextAlignment:"far",textPosition:"top"}}});e.option({series:h});f.cur={series:n.extend(!0,[],e.model.series)};s.dataLabel={visible:!1};s.series=e.model.series;break;case"DLCenter":for(h=[],f.action="DL",f.operation="DLCenter",f.prev={series:n.extend(!0,[],e.model.series)},c=0;c<e.model.series.length;c++)h.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"center",textPosition:"middle",offset:{y:0}}}});e.option({series:h});f.cur={series:n.extend(!0,[],e.model.series)};s.dataLabel={visible:!0,vAlign:"center",tPosn:"middle"};s.series=e.model.series;break;case"DLIBase":for(h=[],f.action="DL",f.operation="DLIBase",f.prev={series:n.extend(!0,[],e.model.series)},c=0;c<e.model.series.length;c++)h.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"far",textPosition:"bottom",offset:{y:0}}}});e.option({series:h});f.cur={series:n.extend(!0,[],e.model.series)};s.dataLabel={visible:!0,vAlign:"far",tPosn:"bottom"};s.series=e.model.series;break;case"DLIEnd":for(h=[],f.action="DL",f.operation="DLIEnd",f.prev={series:n.extend(!0,[],e.model.series)},c=0;c<e.model.series.length;c++)h.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"near",textPosition:"top",offset:{y:-10}}}});e.option({series:h});f.cur={series:n.extend(!0,[],e.model.series)};s.dataLabel={visible:!0,vAlign:"near",tPosn:"top"};s.series=e.model.series;break;case"DLOEnd":for(h=[],f.action="DL",f.operation="DLOEnd",f.prev={series:n.extend(!0,[],e.model.series)},c=0;c<e.model.series.length;c++)h.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"near",textPosition:"top",offset:{y:0}}}});e.option({series:h});f.cur={series:n.extend(!0,[],e.model.series)};s.dataLabel={visible:!0,vAlign:"near",tPosn:"top"};s.series=e.model.series;break;case"PMajorH":f.visibility=!e.model.primaryYAxis.majorGridLines.visible;e.option("primaryYAxis",{majorGridLines:{visible:f.visibility}});s.yAxis.majorGridLines={visible:f.visibility};f.action=f.operation=r;break;case"PMajorV":f.visibility=!e.model.primaryXAxis.majorGridLines.visible;e.option("primaryXAxis",{majorGridLines:{visible:f.visibility}});s.xAxis.majorGridLines={visible:f.visibility};f.action=f.operation=r;break;case"PMinorH":f.visibility=!e.model.primaryYAxis.minorGridLines.visible;e.option("primaryYAxis",{minorGridLines:{visible:f.visibility},minorTicksPerInterval:5,minorTickLines:{visible:f.visibility}});s.yAxis.minorGridLines={visible:f.visibility};f.action=f.operation=r;break;case"PMinorV":f.visibility=!e.model.primaryXAxis.minorGridLines.visible;e.option("primaryXAxis",{minorGridLines:{visible:f.visibility},minorTicksPerInterval:5,minorTickLines:{visible:f.visibility}});s.xAxis.minorGridLines={visible:f.visibility};f.action=f.operation=r;break;case"LNone":f.visibility=!1;e.option("legend",{visible:f.visibility});s.legend.visible=f.visibility;f.action=r;f.operation="LNone";break;case"LLeft":f.prev={position:e.model.legend.position};e.option("legend",{position:"left",visible:!0});s.legend.position="left";f.cur={position:e.model.legend.position};f.action="Legend";f.operation="LLeft";break;case"LRight":f.prev={position:e.model.legend.position};e.option("legend",{position:"right",visible:!0});s.legend.position="right";f.cur={position:e.model.legend.position};f.action="Legend";f.operation="LRight";break;case"LBottom":f.prev={position:e.model.legend.position};e.option("legend",{position:"bottom",visible:!0});s.legend.position="bottom";f.cur={position:e.model.legend.position};f.action="Legend";f.operation="LBottom";break;case"LTop":f.prev={position:e.model.legend.position};e.option("legend",{position:"top"});s.legend.position="top";f.cur={position:e.model.legend.position};f.action="Legend";f.operation="LTop"}v&&(v.style.display="block");t.isNullOrUndefined(f.action)||(o._completeAction(f),o._trigActionComplete(f))}},changeTheme:function(t,i){var r=this.XLObj,u;t=t||r.element.find("#"+r._id+"_chart").val();u={sheetIndex:r.getActiveSheetIndex(),reqType:"shape",action:"chartTheme",chartId:t};u.prev={theme:n("#"+t).data("ejChart").model.theme};i&&i.indexOf("dark")>-1?n("#"+t).addClass("e-ss-charttheme"):n("#"+t).removeClass("e-ss-charttheme");r.XLChart.refreshChart(t,{theme:i});u.cur={theme:i};r._completeAction(u);r._trigActionComplete(u)},changeType:function(t,i){var u=this.XLObj,r=n("#"+t).data("ejChart"),f={sheetIndex:u.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:"chartType",chartId:t};f.prev={chartType:r.model.series[0].type,enable3D:r.model.enable3D,marker:r.model.series[0].marker.visible};u.XLChart.refreshChart(t,i);f.cur={chartType:r.model.series[0].type,enable3D:r.model.enable3D,marker:r.model.series[0].marker.visible};n("#"+u._id+"_charttypedlg").ejDialog("close");u._completeAction(f);u._trigActionComplete(f)},_getShapeObj:function(n,t){var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()).shapeMngr[t],u=i.getObjectLength(r);if(u)return r[n]},_validateChartRange:function(n,t,i,r){var u=this.XLObj;if(!i)return{msg:u._getLocStr("YAxisMissing")};if(!(u.inRange(n,i[0],i[1])||u.inRange(n,i[2],i[3])))return{msg:u._getLocStr("InvalidYAxis")};if(t)if(u.inRange(n,t[0],t[1])||u.inRange(n,n[2],n[3])){if(t[3]-t[1]!=0)return{msg:u._getLocStr("InvalidXAxisColumns")}}else return{msg:u._getLocStr("InvalidXAxis")};return r&&!(u.inRange(n,r[0],r[1])||u.inRange(n,r[2],r[3]))?{msg:u._getLocStr("InvalidLegend")}:{status:!0}},_renderChartRangeDialog:function(){var t=this.XLObj,i={width:"25%",showRoundedCorner:!0,click:n.proxy(this._chartRangeDlgBtnClick,this)},r=n("<div id='"+t._id+"_chartrangedlg'><div class='e-dlgctndiv e-dlg-fields'><table cellpadding='0' cellspacing='0'><tr class='e-dlgtd-fields'><td>"+t._getLocStr("XAxisRange")+"<\/td><td><input type='text' class='ejinputtext' id='"+t._id+"_crxaxis'/><\/td><\/tr><tr class='e-dlgtd-fields'><td>"+t._getLocStr("YAxisRange")+"<\/td><td><input type='text' class='ejinputtext' id='"+t._id+"_cryaxis' /><\/td><\/tr><tr class='e-dlgtd-fields'><td>"+t._getLocStr("LegendRange")+"<\/td><td><input type='text' class='ejinputtext' id='"+t._id+"_crlaxis'/><\/td><\/tr><\/table><\/div><div class='e-dlg-btnfields' ><div class='e-dlg-btnctnr'><button id='"+t._id+"_crok' >"+t._getLocStr("Ok")+"<\/button><button id='"+t._id+"_crcancel'>"+t._getLocStr("Cancel")+"<\/button><\/div><\/div><\/div>");t.element.append(r);r.ejDialog({width:310,height:"auto",enableResize:!1,showOnInit:!1,enableModal:!0,cssClass:"e-ss-dialog e-"+t._id+"-dlg e-ss-chartrange",title:t._getLocStr("ChartRange")});n("#"+t._id+"_crok").ejButton(i);n("#"+t._id+"_crok").ejButton("option","cssClass","e-ss-okbtn");n("#"+t._id+"_crcancel").ejButton(i)},_chartRangeDlgBtnClick:function(t){var r,u,f,e,i=this.XLObj;t.model.text===i._getLocStr("Ok")&&(r=document.getElementById(i._id+"_chart").value,u=n("#"+i._id+"_crxaxis").val(),f=n("#"+i._id+"_cryaxis").val(),e=n("#"+i._id+"_crlaxis").val(),this.changeDataRange(r,u,f,e));!0&&n("#"+i._id+"_chartrangedlg").ejDialog("close")},changeDataRange:function(t,i,r,u){var l,f=this.XLObj,s,h,c,v=f._getSheetIndex(f.getActiveSheetIndex()),y=f.getSheet(v),a,p,w=!0,o=this._getShapeObj(t,"chart"),e;i.length&&(s=f.getRangeIndices(i));r.length&&(h=f.getRangeIndices(r));u.length&&(c=f.getRangeIndices(u));p={xRange:i,yRange:r,lRange:u};l=this._validateChartRange(o.range,s,h,c);l.status?(o.xRange=s,o.yRange=h,o.lRange=c,this._refreshChart(o),e=n("#"+t).ejChart("model"),o.xAxis={min:e.primaryXAxis.range.min,max:e.primaryXAxis.range.max,interval:e.primaryXAxis.range.interval,title:{text:e.primaryXAxis.title.text.length?e.primaryXAxis.title.text:""},range:s},o.yAxis={min:e.primaryYAxis.range.min,max:e.primaryYAxis.range.max,interval:e.primaryYAxis.range.interval,title:{text:e.primaryYAxis.title.text.length?e.primaryYAxis.title.text:""},range:h},o.legend={visible:e.legend.visible,range:c},f.getActiveSheetIndex()===o.dataSheetIdx&&this._focusChartRange(s,h,c)):(w=!1,f._showAlertDlg("Alert","T-"+l.msg,"",400));y._isImported&&!y._isLoaded||f._isUndoRedo||f._isExport||(a={sheetIndex:v,reqType:"shape",shapeType:"chart",action:"selectData",id:t,prev:f._selectDataval,cur:p},f._completeAction(a),f._trigActionComplete(a))},_afterChartRefresh:function(){var t=this.XLObj,n;t.model.allowFormulaBar&&(n=t.element.find(".e-formulabar")[0],n.style.display="none",n.style.display="")}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.print=function(n){this.XLObj=n;this._printHeight=950;this._pageHeight=970;this._pageWidth=750;this._marginTop=30;this._marginBottom=150;this._printRowLabels=!1;this._isPrintSelection=!1;this._stRow=0;this._stColumn=0;this.shpIndex=[];this.shpObj=[];this.shpPicObj=[]};t.spreadsheetFeatures.print.prototype={_printSetting:function(n){this.XLObj.model.pageSize=n;switch(n){case t.Spreadsheet.pageSize.A4:this._printHeight=950;this._pageHeight=970;this._pageWidth=750;this._marginTop=30;this._marginBottom=150;break;case t.Spreadsheet.pageSize.A3:this._printHeight=1350;this._pageHeight=1330;this._pageWidth=860;this._marginTop=30;this._marginBottom=150;break;case t.Spreadsheet.pageSize.Letter:this._printHeight=1040;this._pageHeight=920;this._pageWidth=860;this._marginTop=30;this._marginBottom=60}},printSelection:function(){var i=this.XLObj,e,s,h,a,v;if(i.model.printSettings.allowPrinting&&!i.model.isReadOnly)if(i.model.printSettings.allowPageSize){var c,y,p,u=i.getActiveSheetIndex(),f=i.getSheet(u)._selectedCells,r=f[0],o=f[f.length-1],w=o.colIndex-r.colIndex,l=t.buildTag("table.e-table"),b=t.buildTag("colgroup"),k=i._getContent(u).find("col"),d=t.buildTag("div#printDiv.e-spreadsheet e-js",null,{border:"none"});for(i._refreshTemplates(u,!0,r.colIndex,r.colIndex+w+1),i._isPrint=!0,c=r.colIndex;c<o.colIndex;c++)n(k[c].outerHTML).attr("id","cc").appendTo(b);p=i.getRangeData({range:[r.rowIndex,r.colIndex,o.rowIndex,o.colIndex],property:["value","value2","format","border","type","isFilterHide","isRHide","isFHide","isMHide","merge","hRow","wrap","overflow","align","hyperlink","cFormatRule","rule"],sheetIdx:u,withRowIdx:!0});l.html(i._renderData(p,u,r.colIndex,w+1,!0));b.insertBefore(l.find("tbody"));this._stRow=r.rowIndex;this._stCol=r.colIndex;this._isPrintSelection=!0;i._isPrint=!1;this._printRowLabels?this._calculateTabCount():this._constructSheet(d,u,l,l[0].rows);i._refreshTemplates(u,!0)}else if(f=i.getSheet(u)._selectedCells,r=f[0],o=f[f.length-1],a=[],v=i.element.find(".e-ss-activeimg").clone(),f.length)this._flatPrint([r.rowIndex,r.colIndex,o.rowIndex,o.colIndex]);else if(v.length){for(s=n("head").find("link").add("style"),e=0,y=s.length;e<y;e++)h=s[e].href||"",(s[e].tagName==="STYLE"&&(s[e].id.indexOf(i._id+"_sshide")>-1||s[e].id.indexOf(i._id+"_sscustomformat")>-1)||h.indexOf("ej.pivotintegration.css")>-1||h.indexOf("ej.widgets.core")>-1||h.indexOf("ej.web.all")>-1||h.indexOf("ej.theme")>-1)&&a.push(s[e]);this.print(t.buildTag("div#printDiv.e-spreadsheet e-js",v.css({top:0,left:0}),{border:"none"}),a)}},printSheet:function(){var i=this.XLObj;if(i.model.printSettings.allowPrinting&&!i.model.isReadOnly)if(i.model.printSettings.allowPageSize){var f,o,s,c=t.buildTag("div#printDiv"),r=i.getActiveSheetIndex(),u=i.getSheet(r),l=u.columnsWidthCollection,a=i._getContent(r).find("col"),e=t.buildTag("table"),h=t.buildTag("colgroup");for(i._refreshTemplates(r,!0,0,u.usedRange.colIndex+1),i._isPrint=!0,f=0,o=l.length;f<o;f++)n(a[f].outerHTML).attr("id","cc").appendTo(h);s=i.getRangeData({range:[0,0,u.usedRange.rowIndex,u.usedRange.colIndex],property:["value","value2","format","border","type","isFilterHide","isRHide","isFHide","isMHide","merge","hRow","wrap","overflow","align","hyperlink","cFormatRule","rule"],sheetIdx:r,withRowIdx:!0});e.html(i._renderData(s,r,0,u.usedRange.colIndex+1,!0));h.insertBefore(e.find("tbody"));this._printRowLabels?this._calculateTabCount():this._constructSheet(c,r,e,e[0].rows);i._isPrint=!1;i._refreshTemplates(r,!0)}else this._flatPrint()},_flatPrint:function(i){var w,u=this.XLObj,e,r,b=0,o,v=0,k,d,g,nt,tt,y=t.buildTag("div#printDiv.e-spreadsheet e-js",null,{border:"none"}),s=u.getActiveSheetIndex(),f=u.getSheet(s),it=f.columnsWidthCollection,rt=f.usedRange.colIndex,ot=u._getContent(s).find("col"),c=t.buildTag("table.e-table"),ut=t.buildTag("colgroup"),h=n("head").find("link").add("style"),ft=[],l=u.element.find(".e-ss-object, .e-ss-pivot").clone(),a,p="",et=f.hideRowsCollection;for(u._refreshTemplates(s,!0,0,f.usedRange.colIndex+1),u._isPrint=!0,i&&(b=i[1],rt=i[3]),r=b;r<=rt;r++)n(ot[r].outerHTML).attr("id","cc").appendTo(ut),v+=it[r],it[r]===0&&(p+="td.e-rowcell:nth-of-type("+(r+1)+"){display: none}");for(y.width(v),tt=u.getRangeData({range:i?i:[0,0,f.usedRange.rowIndex,f.usedRange.colIndex],property:["value","value2","format","border","type","isFilterHide","isRHide","isFHide","isMHide","merge","hRow","wrap","overflow","align","hyperlink","cFormatRule","rule","isOverflow","isOfBrdr"],sheetIdx:s,withRowIdx:!0}),c.append(ut,u._renderData(tt,s,i?i[1]:0,(i?i[3]-i[1]:f.usedRange.colIndex)+1,!0)),c.width(v),i&&c.find('td[class=""]').remove(),r=0;r<et.length;r++)(!i||u.inRange(i,r,i[1]))&&c.find("tr:eq("+et[r]+")").addClass("e-r-hide");if(i)for(y.css({overflow:"hidden"}),k=f._colWidthCollection[i[1]],nt=f._rowHeightCollection[i[0]],r=0;r<l.length;r++)d=parseInt(l[r].style.top),g=parseInt(l[r].style.left),n(l[r]).css({top:d-nt,left:g-k});for(o=t.buildTag("div.e-content e-ss-cursor",c),o.append(l),o=t.buildTag("div.e-spreadsheetcontentcontainer",o),o=t.buildTag("div.e-spreadsheetmainpanel",o,{width:v,float:"none"}),p+=".e-spreadsheet .e-spreadsheetmainpanel .e-content .e-table tr td:first-child{ border-left-width: 1px; }.e-spreadsheet .e-spreadsheetmainpanel .e-content .e-table tr:first-child td{border-top-width: 1px;}table{page-break-inside: auto !important;}table tr{page-break-inside: avoid !important;}html,body{margin: 0; padding: 0; }",y.append(o,t.buildTag("style",p,{},{type:"text/css"})),e=0,w=h.length;e<w;e++)a=h[e].href||"",(h[e].tagName==="STYLE"&&(h[e].id.indexOf(u._id+"_sshide")>-1||h[e].id.indexOf(u._id+"_sscustomformat")>-1)||a.indexOf("ej.pivotintegration.css")>-1||a.indexOf("ej.widgets.core")>-1||a.indexOf("ej.web.all")>-1||a.indexOf("ej.theme")>-1)&&ft.push(h[e]);this.print(y,ft);u._isPrint=!1;u._refreshTemplates(s,!0)},_calculateTabCount:function(){for(var i=this.XLObj,u=[],t=0,r=i.getSheet(i.getActiveSheetIndex()).columnsWidthCollection,n=0,f=r.length;n<f;n++)t+=r[n],t>=this._pageWidth&&(u.push({tCount:1,cellCount:n}),t=0)},_calculateCellRowCount:function(n,t,i){for(var o=this.XLObj,b=o.getActiveSheetIndex(),s=o.getSheet(b),h=s.columnsWidthCollection,c=s.rowsHeightCollection,f,l=0,a=0,v=12,y=40,p=0,w=0,u,r=t,e=h.length;r<e;r++)if(l+=h[r],l>=this._pageWidth){w=v=r;break}else f=Math.floor((this._pageWidth-l)/s.columnWidth),w=v=h.length+f;for(u=i,e=c.length;u<e;u++)if(a+=c[u],a>=this._pageHeight){p=y=u;break}else f=Math.floor((this._pageHeight-a)/o.model.rowHeight),p=y=c.length+f;return{startCell:t,endCell:w,startRow:i,endRow:p,cellCount:v,rowCount:y}},_constructSheet:function(n,i,r,u){var o=t.buildTag("div .e-spreadsheet","",{}),c=t.buildTag("div .e-spreadsheetmainpanel","",{}),e=0,f=this._calculateCellRowCount(u,0,0),s=u[0].cells.length,h=u.length;e=Math.ceil(s/f.cellCount);e=e*Math.ceil(h/f.rowCount);e==1&&(f.rowCount=u.length);o.append(c);this._constructPrintableElement(i,n,o.find(".e-spreadsheetmainpanel"),r,u,h,s,e,f.cellCount,f.rowCount,f.startRow,f.startCell,f.endRow,f.endCell)},_constructPrintableElement:function(i,r,u,f,e,o,s,h,c,l,a,v,y,p){for(var ut,ct,d,lt,et=!1,ft,k=this.XLObj,nt=k.getSheet(i),at=t.buildTag("div"),g,ot=!1,st,ht=!0,vt=!1,yt=!1,pt=0,tt,w,it,rt,wt,b,gt=nt.rowsHeightCollection,bt,kt,dt=h;dt>0;dt--){for(g=this._calculateCellRowCount(e,v,a),v=g.startCell,p=g.endCell,a=g.startRow,y=g.endRow,c=g.cellCount,l=g.rowCount,ft=this._constructTable(i,v,p),nt.showHeadings&&this._constructHeaders(v,p,y,ft),w=a;w<y;w++){for(t.isNullOrUndefined(f[0].rows[w])?(ht=!1,d=t.buildTag("tr","",{height:k.model.rowHeight})):(st=gt[w],ht=!0,d=st>0?t.buildTag("tr","",{height:st}):t.buildTag("tr","",{height:k.model.rowHeight})),ht&&(vt=k.XLEdit.getPropertyValue(w,0,"isRHide"),t.isNullOrUndefined(vt)||k.addClass(d[0],"e-r-hide")),it=v;it<p;it++)nt.showHeadings&&!et&&(lt='<td class="{0}">{1}<\/td>',n(String.format(lt,"e-rowcell e-header",w+1)).appendTo(d),et=!0),n(e[w]).length>0&&n(e[w].cells[it]).length>0?(rt=n(e[w].cells[it].outerHTML).attr("id","ss"),rt.appendTo(d)):(rt=t.buildTag("td.e-rowcell"),rt.appendTo(d)),yt=k.XLEdit.getPropertyValue(0,it,"isCHide"),t.isNullOrUndefined(yt)||k.addClass(rt[0],"e-col-hide");et=!1;ft.append(d)}if(r.append(ft),y<o)a=y,y=y+l;else if(y>=o){if(p>=s)break;a=0;y=l;v=p;p=p+c}}for(w=r.find("table").length-1;w>=0;--w)tt=n(r.find("table")[w]),ot||this._checkEmptyRow(i,tt,"first"),pt=nt.showHeadings?tt.find("tr.empty").length+1:tt.find("tr.empty").length,(tt.find("tr").length!==pt||ot)&&(n(tt.get(0).outerHTML).attr("id","cc").appendTo(at),ot=!0);for(b=at.find("table"),w=b.length-1;w>=0;--w)b.length-1!==w?(k.model.pageSize===t.Spreadsheet.pageSize.A4&&b.eq(w).css({"margin-top":300,"margin-bottom":300}),k.model.pageSize===t.Spreadsheet.pageSize.A3&&b.eq(w).css({"margin-top":120,"margin-bottom":110}),k.model.pageSize===t.Spreadsheet.pageSize.Letter&&(nt.showHeadings?b.eq(w).css({"margin-top":70,"margin-bottom":50}):b.eq(w).css({"margin-top":0,"margin-bottom":50}))):b.length-1===w&&b.eq(w).css({"margin-top":30,"margin-bottom":nt.showHeadings?20:0}),w||(b.length>1&&b.eq(w).css({"margin-top":120,"margin-bottom":0}),this._checkEmptyRow(i,b.eq(w),"last")),n(b[w].outerHTML).attr("id","cc").appendTo(u);for(ut=n("head").find("link"),ct=[],w=0,wt=ut.length;w<wt;w++)if(kt=ut[w].href||"",ut[w].href.indexOf("ej.pivotintegration.css")>-1||kt.indexOf("ej.theme")>-1){ct.push(ut[w]);break}bt=this._constructChartPicElement(u);u.append(bt);u=u.parent();k._trigger("_pivotPrint",{element:u});this.print(u,ct,i)},_hideShapeElement:function(n){if(this._isPrintSelection){var u,i,e,r=this.XLObj,o=r.getActiveSheetIndex(),f=r.getSheet(o)._selectedCells,t=r.getSheet(o).shapeMngr,s=r.getObjectLength(t.chart),h=r.getObjectLength(t.picture);if(n.find(".e-ss-object").hide(),s>=1)for(i=0;i<s;i++)for(u=0,e=f.length;u<e;u++)t.chart[r.getObjectKeys(t.chart)[i]].rowIndex==f[u].rowIndex&&t.chart[r.getObjectKeys(t.chart)[i]].colIndex==f[u].colIndex&&n.find("#"+t.chart[r.getObjectKeys(t.chart)[i]].id).show();if(h>=1)for(i=0;i<h;i++)for(u=0,e=f.length;u<e;u++)t.picture[r.getObjectKeys(t.picture)[i]].rowIndex==f[u].rowIndex&&t.picture[r.getObjectKeys(t.picture)[i]].colIndex==f[u].colIndex&&n.find("#"+t.picture[r.getObjectKeys(t.picture)[i]].id).show()}},_constructChartPicElement:function(t){var r,i,v,s=this.XLObj,g=s.getActiveSheetIndex(),u=s.element.find(".e-ss-object").clone(),h=s.getSheet(g).shapeMngr,o=s.getObjectLength(h.chart),w=s.getObjectLength(h.picture),b=t.find("table"),nt=b.length,c,y,p,k,d,f,e,l,a;for(this.shpIndex=[],this.shpObj=[],this.shpPicObj=[],a=0;a<nt;a++)c=b[a],l=n(c).find("tr"),y=parseInt(l.eq(1).find("td").eq(0).text())-1,p=s.XLEdit.getColumnIndexByField(l.eq(0).find("td").eq(1).children().text().trim()),k=y+(l.length-1),d=p+l.eq(0).children().length-1,this.shpIndex.push({pageNumber:a,startColIdx:p,startRowIdx:y,endRowIdx:k,endColIdx:d,top:c.style.marginTop,bottom:c.style.marginBottom,height:c.style.height});if(o>=1)for(i=0;i<o;i++){for(f=h.chart[u[i].id].rowIndex,e=h.chart[u[i].id].colIndex,r=0,v=this.shpIndex.length;r<v;r++)f>=this.shpIndex[r].startRowIdx&&f<this.shpIndex[r].endRowIdx&&e>=this.shpIndex[r].startColIdx&&e<this.shpIndex[r].endColIdx&&(this.shpObj.push({ID:u[i].id,rowIndex:f,colIndex:e,tableNumber:r}),this.shpObj[i].colIndex=this.shpObj[i].colIndex-this.shpIndex[r].startColIdx,this.shpObj[i].rowIndex=this.shpObj[i].rowIndex-this.shpIndex[r].startRowIdx);n(u[i]).addClass(".e-spreadsheet .e-ss-object .e-datavisualization-chart .e-js");n(u[i]).css({border:"1px solid gray",position:"absolute"})}if(w>=1)for(i=0;i<w;i++){for(f=h.picture[u[o+i].id].rowIndex,e=h.picture[u[o+i].id].colIndex,r=0,v=this.shpIndex.length;r<v;r++)f>=this.shpIndex[r].startRowIdx&&f<this.shpIndex[r].endRowIdx&&e>=this.shpIndex[r].startColIdx&&e<this.shpIndex[r].endColIdx&&(this.shpPicObj.push({ID:u[o+i].id,rowIndex:f,colIndex:e,tableNumber:r}),this.shpPicObj[i].colIndex=this.shpPicObj[i].colIndex-this.shpIndex[r].startColIdx,this.shpPicObj[i].rowIndex=this.shpPicObj[i].rowIndex-this.shpIndex[r].startRowIdx);n(u[o+i]).addClass(".e-spreadsheet .e-ss-object");n(u[o+i]).css({position:"absolute","background-size":"100% 100%"})}return u},_calculateTopForShapes:function(n){for(var s,h=this.XLObj,v=h.getActiveSheetIndex(),r=h.getSheet(v),u,f,c,l,a,i=this.shpObj.concat(this.shpPicObj),y=i.length,e,o,t=0;t<y;t++)if(i[t].tableNumber==0)e=r._colWidthCollection[i[t].colIndex],o=r._rowHeightCollection[i[t].rowIndex],n.find("#"+i[t].ID).css({top:o+60,left:e+20+8});else{for(u=0,s=0;s<i[t].tableNumber;s++)f=n.find(".e-table")[s],c=f.getBoundingClientRect(),l=parseInt(f.style.marginBottom),a=parseInt(f.style.marginTop),u=u+(c.height+l+a);e=r._colWidthCollection[i[t].colIndex];o=r._rowHeightCollection[i[t].rowIndex];n.find("#"+i[t].ID).css({top:o+u+30+parseInt(this.shpIndex[i[t].tableNumber].top),left:e+20+18})}},_checkEmptyRow:function(t,i,r){for(var o,e,f=i.find("tr"),s,h,c,u=f.length-1;u>=0;--u)if(o=n(f[u]).find(".e-rowcell").length,e=n(f[u]).find(".e-rowcell:empty").length,e=this.XLObj.getSheet(t).showHeadings?e+1:e,s=n(f[u]).find('td[class *= "e-format"]').length,h=n(f[u]).find('td[class *= "e-border"]').length,c=n(f[u]).find('td[class *= "e-mc-hide"]').length,e===o&&s<1&&h<1&&c<1)n(f[u]).addClass("empty");else{n(f[u]).addClass("nonempty");break}r==="last"&&(i.find("tr.empty").find("td").removeClass("e-rowcell"),i.find("tr.empty").find("td.e-header").text(""))},_constructTable:function(i,r,u){var e=t.buildTag("colgroup"),s=this.XLObj,l=t.buildTag("div","",{height:this._printHeight,"margin-top":this._marginTop,"margin-bottom":this._marginBottom}),h=t.buildTag("table.e-table","",{height:this._printHeight,"margin-top":this._marginTop,"margin-bottom":this._marginBottom}),c=s._getContent(s.getActiveSheetIndex()).find("col"),o,f;for(s.getSheet(i).showHeadings&&(o='<col class="{0}" style= "width: 30px;" >{1}<\/col>',n(o).appendTo(e)),f=r;f<u;f++)n(c[f]).length>0?n(c[f].outerHTML).attr("id","cc").appendTo(e):(o='<col style= "width: 64px;" ><\/col>',n(o).appendTo(e));return h.append(e),l.append(h),h},_constructHeaders:function(i,r,u,f){var s=this.XLObj,h=t.buildTag("tr","",{height:30}),c,l,o,a,v,y=!1,p="e-rowcell",e;for(this._isPrintSelection&&i<this._stCol&&(r=r+(this._stCol-i),i=this._stCol),c='<td class="{0}">{1}<\/td>',l='<div class = "{0}" > {1}<\/div>',e=i;e<=r;e++)y?(o=s._generateHeaderText(e),p=t.isNullOrUndefined(s.XLEdit.getPropertyValue(0,e-1,"isCHide"))?"e-rowcell e-headercell":"e-rowcell e-col-hide"):(o="",y=!0),a=String.format(l,"e-headercelldiv",o),v=String.format(c,p,a),n(h[0]).append(v);f.append(h)},print:function(i,r,u){var e=this.XLObj,o,a,s,c,v;if(e.model.printSettings.allowPrinting&&!e.model.isReadOnly){var f=window.open("","print","height="+screen.height+",width="+screen.width+",tabbar=no"),h={styleTag:""},l=t.buildTag("style");if(!e.isUndefined(f)){if(c=t.buildTag("div"),v=i.clone(),c.append(v),f.document.write("<!DOCTYPE html>"),e._browserDetails.name==="msie"?(s="",r.length>0&&n(r).each(function(t,i){n(i).attr("href",i.href);s+=i.tagName=="STYLE"&&i.styleSheet?"<style>"+i.styleSheet.cssText+"<\/style>":i.outerHTML}),f.document.write("<html><head><\/head><body>"+s+c[0].innerHTML+"<\/body><\/html>")):(s="",f.document.write("<html><head>"),r.length>0&&n(r).each(function(t,i){n(i).attr("href",i.href);s+=i.outerHTML}),f.document.writeln(s+"<\/head><body>"),f.document.writeln(c[0].innerHTML+"<\/body><\/html>"),e.model.printSettings.allowPageSize&&(n(f.document.head).append("<style><\/style>"),o=e.model.sheets[u].showGridlines?".e-spreadsheet .e-table{table-layout: fixed; width: 100%;}.e-spreadsheet .e-rowcell {border: 1px solid #000000;line-height: 14px;overflow: hidden;white-space: pre;vertical-align: bottom;}.e-spreadsheet .e-table{border-collapse: collapse}":".e-spreadsheet .e-table{table-layout: fixed; width: 100%;}.e-spreadsheet .e-rowcell {line-height: 14px;overflow: hidden;white-space: pre;vertical-align: bottom;}.e-spreadsheet .e-table{border-collapse: collapse}",o=o.concat(n(document).find("style#"+this.XLObj._id+"_sscustomformat").text()),a=n(f.document.head).find("style"),o=o.concat(".e-spreadsheet .e-fr-hide { display: none !important;}.e-spreadsheet .e-fc-hide { display: none !important;}.e-spreadsheet .e-sswraptext {word-break: break-all; white-space: normal;}.e-spreadsheet .e-headercell{text-align:center;}.e-spreadsheet .e-ralign{text-align:right;}.e-spreadsheet .e-calign{text-align:center;}"),o=o.concat(".e-spreadsheet .e-hyperlinks { text-decoration: underline;}"),a.append(o))),e._trigger("beforePrint",h))return!1;h.styleTag&&(typeof h.styleTag=="object"?f.document.head.appendChild(h.styleTag):(l[0].append(h.styleTag),f.document.head.appendChild(l[0])));e.model.printSettings.allowPageSize&&n(f.document).find(".e-ss-object").clone().length&&(this._calculateTopForShapes(n(f.document).find(".e-spreadsheetmainpanel")),this._hideShapeElement(n(f.document).find(".e-spreadsheetmainpanel")));this._isPrintSelection=!1;f.document.close();f.focus();setTimeout(function(){(e._browserDetails.name==="msie"?!e.getObjectLength(f)||t.isNullOrUndefined(f.window)||t.isNullOrUndefined(f.location):t.isNullOrUndefined(f.window)||t.isNullOrUndefined(f.location))||f.print();setTimeout(function(){f.close()},2e3)},2e3)}}}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.scroller=function(n){this.XLObj=n;this._isIntrnlScroll=!1;this._isScrollToCell=!1};t.spreadsheetFeatures.scroller.prototype={_getColWidths:function(n,t){var i,f,h=this.XLObj,r=h.getSheet(n),u=r.columnsWidthCollection,e=r._colWidthCollection,o,s=r._ofColWidthColl;for(t||(t=1),i=t,f=u.length;i<f;i++)e[i]=e[i-1]+u[i-1],o=u[i-1]===0?r.hideColsCollection[i-1]:u[i-1],s[i]=s[i-1]+o},_getRowHeights:function(n,t,i,r){var u,o,f=this.XLObj,e=f.getSheet(n),s=e.rowsHeightCollection,h=e._rowHeightCollection,c=e.hideRowsCollection;for(t||(t=1),u=t,o=s.length;u<o;u++)h[u]=h[u-1]+(c.indexOf(u-1)>-1?0:s[u-1]);!i&&f.model.scrollSettings.allowScrolling&&(f.model.scrollSettings.allowVirtualScrolling&&f._refreshVrtlBlocks(n),r||f._isTableBrdrEnd||this._refreshScroller(n,"refresh","vertical"))},_createScroller:function(i,r,u){var f=this.XLObj,e=!0,o=!0,a=f._getContent(i),h=t.buildTag("div#vscrollBar"),c=t.buildTag("div#hscrollBar"),s=f.getSheet(i),l=f.model.scrollSettings.isResponsive?r.width-2:r.width;s._contWidth=l;s._contHeight=r.height;f.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(s._contWidth>f._getEntireColWidth(i)&&(e=!1),s._contHeight>f._getEntireRowHeight(i)&&(o=!1),c[0].style.display=e?"block":"none",h[0].style.display=o?"block":"none");a.append(h).append(c);f._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").width(l-(o?18:0)).height(r.height-(e?18:0));h.ejScrollBar({orientation:"vertical",height:r.height-(e?18:0),minimum:0,viewportsize:r.height,infiniteScrolling:!0,scroll:n.proxy(this._scrollSpreadY,this)});c.ejScrollBar({orientation:"horizontal",width:l-(o?17:0),minimum:0,infiniteScrolling:!0,viewportsize:r.width,scroll:n.proxy(this._scrollSpreadX,this)});u!="initial"&&this._refreshScroller(i,"initial","all")},_hScroller:function(n){return this.XLObj._getContent(this.XLObj._getSheetIndex(n)).find("#hscrollBar").data("ejScrollBar")},_vScroller:function(n){return this.XLObj._getContent(this.XLObj._getSheetIndex(n)).find("#vscrollBar").data("ejScrollBar")},_refreshScroller:function(n,i,r){var e=this.XLObj,v;n=e._getSheetIndex(n);var c,s,l,h,b,k,a=0,o=e.getSheet(n),f=this._hScroller(n),y=o.columnWidth,p=o.rowHeight,u=this._vScroller(n),w=e.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal,d=e._getContent(n),g=d.find(".e-content")[0];if(w&&f&&u&&d.find("table").length&&(this._refreshContHgt(n),r=r==="horizontal"?"all":r),f&&(r==="all"||r==="horizontal")){if(c=g.offsetWidth,s=e._getWidth(0,o.colCount-1,n)-o._frozenWidth,s<c+2*y&&!w)for(b=Math.floor((c+y*5-s)/y),v=0;v<b;v++)this._createNewColumn(n,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"insert"),s=s+y;f._scrollData.handleSpace=c-2*f.model.buttonSize;a=e._isFrozen(e.getFrozenColumns())?e._getColOffsetLeft(o,e.getFrozenColumns())-o._contScrollLeft:0;f._scrollData.handle=Math.floor((c-a)/s*f._scrollData.handleSpace);f._scrollData.handle<15&&(f._scrollData.handle=15);f._scrollData.scrollable=f.model.maximum=s-(c-a);f._scrollData.onePx=f._scrollData.scrollable/(f._scrollData.handleSpace-f._scrollData.handle)||1;f["e-hhandle"].width(f._scrollData.handle);f.model.scrollLeft=f._scrollData.handleSpace-f._scrollData.handle}if(u&&(r==="all"||r==="vertical")){if(l=g.offsetHeight,h=e._getMaxHgt(n,!0,!0)-o._frozenHeight,!w&&h<l+2*p)for(k=Math.floor((l+p*5-h)/p),v=0;v<k;v++)this._createNewRow(n,-1,-1,"insert"),h=h+p;u._scrollData.handleSpace=l-2*u.model.buttonSize;a=e._isFrozen(e.getFrozenRows())?e._getRowOffsetTop(o,e.getFrozenRows())-o._contScrollTop:0;u._scrollData.handle=Math.floor((l-a)/h*u._scrollData.handleSpace);u._scrollData.handle<15&&(u._scrollData.handle=15);u._scrollData.handle>u._scrollData.handleSpace&&e.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(u._scrollData.handle=u._scrollData.handleSpace);u._scrollData.scrollable=u.model.maximum=h-(l-a);u._scrollData.onePx=u._scrollData.scrollable/(u._scrollData.handleSpace-u._scrollData.handle);u["e-vhandle"].height(u._scrollData.handle);u.model.scrollTop=u._scrollData.handleSpace-u._scrollData.handle}},_refreshContHgt:function(n){var t,i,r,u,v,d,g,y,f="px",p="none",s="block",e="width",h="height",o=this.XLObj,w=o.getSheet(n),c=o._getEntireColWidth(n),nt=o._getEntireRowHeight(n),l=o._getContent(n),a=l.find(".e-content"),k=l.find("#hscrollBar")[0].style,b=l.find("#vscrollBar")[0].style;t=a[0].offsetHeight;i=a[0].offsetWidth;r=k.display===p&&w._contWidth<c;u=b.display===p&&w._contHeight<nt;(r||k.display===s&&w._contWidth>c)&&(k.display=r?s:p,t=r?t-18:t+19,r=!0);(u||b.display===s&&w._contHeight>nt)&&(b.display=u?s:p,i=u?i-19:i+19,u=!0);(r||u)&&(d=t-36+f,t+=f,v=l.find("#vscrollBar"),a[0].style[h]=t,o._getJSSheetRowHeaderContent(n)[0].style[h]=t,v[0].style[h]=t,v.find(".e-vscroll")[0].style[h]=t,v.find(".e-vhandlespace")[0].style[h]=d,y=l.find("#hscrollBar"),a[0].style[e]=i+f,b.display===s&&i++,g=i-36+f,i+=f,y[0].style[e]=i,y.find(".e-hscroll")[0].style[e]=i,y.find(".e-hhandlespace")[0].style[e]=g);c+=f;a.find("table")[0].style[e]=c;o._getJSSheetHeader(n).find("table")[0].style[e]=c},_changeTopSpread:function(n,t,i,r){var f=n.value(),u=f+i;t.step=i;(t.enableRTL?u<t.scrollable:u>t.scrollable)&&(u=t.scrollable);(t.enableRTL?u>0:u<0)&&(u=0);n.scroll(u,r)},_changeLeftSpread:function(n,t,i,r){var f=n.value(),u=f+i;t.step=i;(t.enableRTL?u<t.scrollable:u>t.scrollable)&&(u=t.scrollable);(t.enableRTL?u>0:u<0)&&(u=0);n.scroll(u,r)},_spreadMouseWheel:function(i){var r=this.XLObj,o,s,f=this._vScroller(r.getActiveSheetIndex()),e=this._hScroller(r.getActiveSheetIndex()),u,h;if((r._filterClose(i.target),i.stopImmediatePropagation(),i.preventDefault(),!r.element.find(".e-excelfilter.e-dlgcontainer").is(":visible")&&!r._isSubMenuOpen()&&!r._isSheetRename)&&(r.model.allowComments&&r.XLComment._isCommentEdit&&(o=r.getActiveCell(),t.isNullOrUndefined(o)||r.XLComment._updateCurCmntVal({rowIndex:o.rowIndex,colIndex:o.colIndex})),r.model.allowDataValidation&&n("#"+r._id+"ddl").ejDropDownList("hidePopup"),u=0,h=i,i=i.originalEvent,i.wheelDelta?(s=i.wheelDeltaY,u=-i.wheelDelta/120,window.opera&&parseFloat(window.opera.version,10)<10&&(u=-u)):i.detail&&(u=i.detail/3,s=i.axis==1?0:1),u)){if(s!=0){if(t.isNullOrUndefined(f)||!f.element.is(":visible"))return;this._changeTopSpread(f,f._scrollData,u*f._scrollData.scrollOneStepBy,"wheel")&&(i.preventDefault?i.preventDefault():h.preventDefault())}else{if(t.isNullOrUndefined(e)||!e.element.is(":visible"))return;this._changeLeftSpread(e,e._scrollData,u*e._scrollData.scrollOneStepBy,"wheel")&&(i.preventDefault?i.preventDefault():h.preventDefault())}n.data(this,"timer",setTimeout(function(){r._trigger("scrollStop",{originalEvent:i,scrollData:f._scrollData,reqType:"vertical",position:f.model.value})},250))}},_scrollSpreadX:function(n){var t=this.XLObj;t.XLEdit._isEdit&&t.XLEdit.saveCell();t._isScrolling=!0;t.getSheet()._isFreezed&&t._isFrozen(t.getFrozenColumns())?(t.XLFreeze._frozenScrollHandler(n),this._getFirstColumn(t.getActiveSheetIndex())):this._spreadHS(n);t._isScrolling=!1},_scrollDirection:function(n,t){var i=this.XLObj;n=i._getContent(i.getActiveSheetIndex()).find("#"+n).ejScrollBar("instance");n.value()<t?n._scrollData.step=1:n.value()>t&&(n._scrollData.step=-1);n.scroll(t)},_spreadHS:function(n){var e,i=this.XLObj,f=i.getActiveSheetIndex(),r=i.getSheet(f),u=this._hScroller(f),c=u.element.find(".e-hhandle")[0],l=i._getContent(f),s=l.find(".e-content"),h=(n.scrollLeft-r._scrollLeft)/r.columnWidth,o;if(n.reachedEnd=Math.ceil(parseFloat(c.offsetLeft))+Math.ceil(parseFloat(u.element.find(".e-hhandle").width()))>=i.element.find(".e-hhandlespace").width()-2,e=n.scrollLeft,i.model.enableContextMenu&&i.XLCMenu.hideCMenu(),i.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&n.scrollData.step>-1&&!i._scrollReverse)if(n.reachedEnd&&r._leftCol.idx+h<=r.colCount)n.scrollLeft=n.scrollLeft+u._scrollData.scrollOneStepBy,n.cancel=!0,this._scrollRight(f),this._isScrollToCell||(e=(u._scrollData.handleSpace-u._scrollData.handle)*u._scrollData.onePx),this._refreshScroller(f,"refresh","horizontal"),u.element.find(".e-hhandle")[0].style.left=u._scrollData.handleSpace-(u._scrollData.handle+1)+"px",u.value(e);else if(r._leftCol.idx+h>r.colCount&&n.scrollLeft>=r._scrollLeft&&n.scrollLeft>0&&r.colCount<i._maxColCnt){while(n.scrollLeft>r._colWidthCollection[r._colWidthCollection.length-1])this._scrollRight(f);this._refreshScroller(f,"refresh","horizontal")}o=this._ensureScrollPos(n);r._scrollLeft=i.isUndefined(o.resetTo)||i.model.scrollSettings.scrollMode==t.Spreadsheet.scrollMode.Normal?n.scrollLeft=e:n.scrollLeft=o.resetTo;i._scrollReverse=!1;s.scrollLeft(n.scrollLeft);n.scrollLeft=e;r._scrollLeft=s.scrollLeft();u.value(n.scrollLeft);this._getFirstColumn(f);i._refreshViewVar(null,n.scrollLeft,f)},_scrollSpreadY:function(n){var u,f,h,c,e,s=0,i=this.XLObj,r=i.getActiveSheetIndex(),o=i.getSheet(r),l=i.getSheetElement(r).find("#vscrollBar");i._isScrolling=!0;i.XLEdit._isEdit&&i.XLEdit.saveCell();o._isFreezed&&i._isFrozen(i.getFrozenRows())?(i.XLFreeze._frozenScrollHandler(n),this._isIntrnlScroll||this._getFirstRow(i.getActiveSheetIndex())):(c=i.getDigits(o._bottomRow.idx),this.XLObj.model.scrollSettings.allowVirtualScrolling?this._scrollHandler(n):this._spreadVS(n),this.XLObj.model.allowComments&&this.XLObj.XLComment._isCommentEdit&&(e=this.XLObj.getActiveCell(),t.isNullOrUndefined(e)||this.XLObj.XLComment._updateCurCmntVal({rowIndex:e.rowIndex,colIndex:e.colIndex})),u=i.getDigits(o._bottomRow.idx),h=u-c,h&&(u>3&&(s=(u-3)*10),f=i._rowHeaderWidth+s,i._getJSSheetRowHeaderContent(r).find("col").width(f),i._getJSSheetRowHeader(r).width(f),i._getJSSheetHeader(r).find(".e-spreadsheetcolumnheader").width(f-1),i._getJSSheetContent(r).find(".e-spreadsheetcontentcontainer > .e-content").width(o._contWidth-s-(l[0].style.display==="none"?0:18))));i._isScrolling=!1},_scrollHandler:function(n){var nt,a,h,o,tt,it,e,v,et,rt,c,ut,y,f,p,l,s,w,ft,ot,st,r=this.XLObj,u=r.getActiveSheetIndex(),i=r.getSheet(u),ht=n.scrollTop>=i._scrollTop,ct=(n.scrollTop-i._scrollTop)/i.rowHeight+1,b=r._getContent(u).find(".e-content"),k,d,g;if(f=p=l=0,s=w=!1,(n.scrollTop===i._scrollTop||i._bottomRow.idx+ct>i.rowCount)&&r.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite){if(ht&&n.scrollTop>0&&i.rowCount<r._maxRowCnt){h=i.rowCount;do{i._virtualBlockCnt++;i.rowCount+=i._virtualBlockRowCnt;for(nt in i._columnStyles)for(a=i._virtualBlockRowCnt;a<i.rowCount;)r.XLEdit._updateDataContainer({rowIndex:a,colIndex:parseInt(nt)},{dataObj:i._columnStyles[nt]}),a++;while(f<i._virtualBlockRowCnt)i.rowsHeightCollection.push(i.rowHeight),i.hideRowsCollection.indexOf(h)===-1&&i._hiddenFreezeRows.indexOf(h)===-1?(i._rowIdxColl.push(h),p=i._rowHeightCollection[i._rowHeightCollection.length-1]+i.rowHeight,i._virtualTBodyHgt+=i.rowHeight):p=i._rowHeightCollection[i._rowHeightCollection.length-1],i._rowHeightCollection.push(p),h++,f++;f=0}while(n.scrollTop+i._virtualBlockRowCnt*i.rowHeight>i._rowHeightCollection[i._rowHeightCollection.length-1]);this._refreshScroller(u,"refresh","vertical");i._scrollTop=n.scrollTop;r._refreshViewport(n.scrollTop,u);b.scrollTop(n.scrollTop);i._scrollTop=b.scrollTop();s=!0}}else ft=["value","value2","comment","hyperlink","format","border","type","isFilterHide","filterState","isMHide","isFHide","merge","isFilterHeader","isFilterVisible","text","general","cFormatRule","wrap","wrapRow","rule","align","isOverflow","isOfBrdr","altTxt"],it=r._getRowHdrTBody(u),o=r._getContTBody(u),ht?n.scrollTop>=i._virtualContTBodyOffset.bottom&&n.scrollTop<=i._virtualBottomTBodyOffset.bottom?(l=i._virtualTopTBodyOffset.bottom-i._virtualTopTBodyOffset.top,i._virtualTopTBodyOffset.top=i._virtualContTBodyOffset.top,i._virtualTopTBodyOffset.bottom=i._virtualContTBodyOffset.bottom,i._virtualContTBodyOffset.top=i._virtualBottomTBodyOffset.top,i._virtualContTBodyOffset.bottom=i._virtualBottomTBodyOffset.bottom,i._virtualContBlockIdx++,i._virtualContBlockIdx===i._virtualBlockCnt?(i._virtualBottomTBodyOffset.top=i._virtualBottomTBodyOffset.bottom=0,i._isVirtualEndReached=!0):(i._virtualBottomTBodyOffset.top=i._virtualBottomTBodyOffset.bottom,et=r._getRowIdx(i._virtualContBlockIdx*i._virtualBlockRowCnt,u,!0),rt=r._getRowIdx(i._virtualContBlockIdx*i._virtualBlockRowCnt+(i._virtualBlockRowCnt-1),u,!0),i._virtualBottomTBodyOffset.bottom=r._getRowOffsetBottom(rt,u),y=i._rowIdxColl.slice(i._rowIdxColl.indexOf(et),i._rowIdxColl.indexOf(rt)+1),e=r.getRangeData({property:ft,sheetIdx:u,rowIdxs:y,withRowIdx:!0}),it.append(r._renderRowHdr(e.rowIdx,u)),o.append(r._renderData(e,u)),d=r._getContTBody(u).find("tr"),g=r._getRowHdrTBody(u).find("tr"),r.setRows([g,d],u),i._virtualRowIdx=i._virtualRowIdx.concat(e.rowIdx),s=!0),i._isVirtualTopReached||(r._removeRange(0,i._virtualBlockRowCnt),i._virtualRowIdx.splice(0,i._virtualBlockRowCnt),i._virtualTopTBodyHgt+=l),k=r._browserDetails.name==="msie"||r._browserDetails.name==="edge"?o[0].getBoundingClientRect().height:window.getComputedStyle(o[0],null).height,i._virtualBottomTBodyHgt=i._virtualTBodyHgt-(i._virtualTopTBodyHgt+Math.floor(parseFloat(k))),r._refreshTBodiesHgt(),i._isVirtualTopReached=!1):!i._isVirtualEndReached&&n.scrollTop>=i._virtualBottomTBodyOffset.bottom&&(r._refreshViewport(n.scrollTop,u),s=w=!0):n.scrollTop+n.model.viewportsize<i._virtualContTBodyOffset.top&&n.scrollTop+n.model.viewportsize>=i._virtualTopTBodyOffset.top?(l=i._virtualBottomTBodyOffset.bottom-i._virtualBottomTBodyOffset.top,i._virtualBottomTBodyOffset.top=i._virtualContTBodyOffset.top,i._virtualBottomTBodyOffset.bottom=i._virtualContTBodyOffset.bottom,i._virtualContTBodyOffset.top=i._virtualTopTBodyOffset.top,i._virtualContTBodyOffset.bottom=i._virtualTopTBodyOffset.bottom,i._virtualContBlockIdx--,i._virtualTopTBodyOffset.bottom=i._virtualContTBodyOffset.top,i._virtualContBlockIdx===1?(i._virtualTopTBodyOffset.top=0,i._isVirtualTopReached=!0):(c=r._getRowIdx((i._virtualContBlockIdx-2)*i._virtualBlockRowCnt,u,!0),ut=r._getRowIdx((i._virtualContBlockIdx-2)*i._virtualBlockRowCnt+(i._virtualBlockRowCnt-1),u,!0),i._virtualTopTBodyOffset.top=r._getRowOffsetTop(i,c),y=i._rowIdxColl.slice(i._rowIdxColl.indexOf(c),i._rowIdxColl.indexOf(ut)+1),e=r.getRangeData({property:ft,sheetIdx:u,rowIdxs:y,withRowIdx:!0}),it.prepend(r._renderRowHdr(e.rowIdx,u)),o.prepend(r._renderData(e,u)),d=r._getContTBody(u).find("tr"),g=r._getRowHdrTBody(u).find("tr"),r.setRows([g,d],u),i._virtualRowIdx=e.rowIdx.concat(i._virtualRowIdx),s=!0),i._isVirtualEndReached||(r._removeRange(i._virtualContBlockIdx===1?2*i._virtualBlockRowCnt:3*i._virtualBlockRowCnt,i._virtualBlockRowCnt),i._virtualRowIdx.splice(i._virtualContBlockIdx===1?2*i._virtualBlockRowCnt:3*i._virtualBlockRowCnt,i._virtualBlockRowCnt),i._virtualBottomTBodyHgt+=l,c=r._getRowIdx((i._virtualContBlockIdx-2)*i._virtualBlockRowCnt,u,!0),ut=r._getRowIdx((i._virtualContBlockIdx-2)*i._virtualBlockRowCnt+(i._virtualBlockRowCnt-1),u,!0),i._virtualTopTBodyOffset.top=r._getRowOffsetTop(i,c)),k=r._browserDetails.name==="msie"||r._browserDetails.name==="edge"?o[0].getBoundingClientRect().height:window.getComputedStyle(o[0],null).height,i._virtualTopTBodyHgt=i._virtualTBodyHgt-(i._virtualBottomTBodyHgt+Math.floor(parseFloat(k))),r._refreshTBodiesHgt(),i._isVirtualEndReached=!1,r.model.allowCellType&&r.XLCellType._rangeCellTypes(i.cellTypes,u),r.model.allowSparkline&&r.XLSparkline._refreshContentWithSparkline(u)):!i._isVirtualTopReached&&n.scrollTop+n.model.viewportsize<=i._virtualTopTBodyOffset.top&&(r._refreshViewport(n.scrollTop,u),s=w=!0),tt=this._ensureScrollPos(n),r.isUndefined(tt.resetTo)||r.model.scrollSettings.scrollMode==t.Spreadsheet.scrollMode.Normal?i._scrollTop=n.scrollTop:n.scrollTop=tt.resetTo,w||r._refreshViewVar(n.scrollTop,null,u);if(b.scrollTop(n.scrollTop),i._scrollTop=b.scrollTop(),this._getFirstRow(u),r.model.allowSelection&&(i._isRowSelected||i._isColSelected||i._isSheetSelected)&&(r.XLSelection.refreshSelection(),r.XLDragFill&&r.XLDragFill.positionAutoFillElement()),s){for(r.XLComment&&r.XLComment._updateCmntArrowPos(r._getContent(u).find(".e-commentcell")),v=r.getObjectKeys(r._dataContainer.sheets[u][0]),r._dupDetails=!0,f=0,ot=v.length;f<ot;f++)st=r.XLEdit.getPropertyValue(0,v[f],"isFitWidth"),t.isNullOrUndefined(st)||r.XLResize._fitWidth(v[f]);r._dupDetails=!1}},_spreadVS:function(n){var e,r=this.XLObj,f=r.getActiveSheetIndex(),u=r.getSheet(f),i=this._vScroller(f),c=i.element.find(".e-vhandle")[0],p=c.getBoundingClientRect(),l=r._getJSSheetContent(f).find(".e-spreadsheetcontentcontainer > .e-content"),a=(n.scrollTop-u._scrollTop)/u.rowHeight,s;if(n.reachedEnd=Math.ceil(parseFloat(c.offsetTop))+Math.ceil(parseFloat(p.height))>=i.element.find(".e-vhandlespace").height()-2,e=n.scrollTop,r.model.enableContextMenu&&r.XLCMenu.hideCMenu(),r.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&n.scrollData.step>-1&&!r._scrollReverse)if(n.reachedEnd&&u._bottomRow.idx+a<=u.rowCount){var v=!1,y=!1,h=this,o;!r.isUndefined(n.scrollData.target)&&r._hasClass(n.scrollData.target,"e-vdown")&&(o=setInterval(function(){v=!0;for(var n=0;n<20;n++)h._scrollBottom(f);this._isScrollToCell||(e=(i._scrollData.handleSpace-i._scrollData.handle)*i._scrollData.onePx);h._refreshScroller(f,"refresh","vertical");i.element.find(".e-vhandle")[0].style.top=i._scrollData.handleSpace-i._scrollData.handle+"px";i.scroll(e);clearInterval(o);return},1e3),r._browserDetails.name==="msie"&&r._browserDetails.version==="8.0"?(i.element.find(".e-vdown")[0].attachEvent("onmouseup",function(){clearInterval(o);return}),document.attachEvent("onmouseup",function(){clearInterval(o);return})):(i.element.find(".e-vdown")[0].addEventListener("mouseup",function(){clearInterval(o);return}),document.addEventListener("mouseup",function(){clearInterval(o);return})),y=!0);n.cancel=!0;v&&y||(this._scrollBottom(f,(n.scrollTop-u._scrollTop)/20+1),this._isScrollToCell||(e=(i._scrollData.handleSpace-i._scrollData.handle)*i._scrollData.onePx),h._refreshScroller(f,"refresh","vertical"),i.element.find(".e-vhandle")[0].style.top=i._scrollData.handleSpace-i._scrollData.handle+"px",i.value(e))}else u._bottomRow.idx+a>u.rowCount-1&&n.scrollTop>=u._scrollTop&&n.scrollTop>0&&u.rowCount<r._maxRowCnt&&(this._scrollBottom(f,(n.scrollTop-u._scrollTop)/20+1),this._refreshScroller(f,"refresh","vertical"));s=this._ensureScrollPos(n);n.scrollTop=r.isUndefined(s.resetTo)||r.model.scrollSettings.scrollMode==t.Spreadsheet.scrollMode.Normal?u._scrollTop=e:u._scrollTop=s.resetTo;r._scrollReverse=!1;l.scrollTop(n.scrollTop);u._scrollTop=l.scrollTop();this._getFirstRow(f)},_scrollX:function(i){var e,h,u=this.XLObj,r=this._hScroller(i),o,s=[1],c=u._getContent(i).find("colgroup"),f=u.getSheet(i);for(u.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&this._scrollRight(i),r.model.maximum=r.model.maximum+f.columnWidth,r._scrollData.scrollable=r._scrollData.scrollable+f.columnWidth,this._refreshScroller(i,"refresh","horizontal"),r.element.find(".e-hhandle").css("left",r._scrollData.handleSpace-(r._scrollData.handle+1)),o=(r._scrollData.handleSpace-r._scrollData.handle)*r._scrollData.onePx,r.value(o),e=0,h=u.model.sheets[i]._fCol;e<h;e++)s.push(s[s.length-1]+n(c.find("col")[e]).width());f._isFreezed&&u._isFrozen(u.getFrozenColumns())?r.scroll(r.value()+u._getColWidth(f._fleftColIdx,i),!0):u._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").scrollLeft(o,r._scrollData.onePx);f._scrollLeft=o;this._getFirstColumn(i)},_scrollY:function(i){var f,s,u=this.XLObj,r=this._vScroller(i),e,o=[1],h=u.getRows(i)[1];for(u.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&this._scrollBottom(i),r.model.maximum=r.model.maximum+u.model.rowHeight,r._scrollData.scrollable=r._scrollData.scrollable+u.model.rowHeight,this._refreshScroller(i,"refresh","vertical"),r.element.find(".e-vhandle")[0].style.top=r._scrollData.handleSpace-(r._scrollData.handle+1)+"px",e=(r._scrollData.handleSpace-r._scrollData.handle)*r._scrollData.onePx,r.value(e),f=0,s=u.model.sheets[i]._fRow;f<s;f++)o.push(o[o.length-1]+n(h[f]).height());u._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").scrollTop(e,r._scrollData.onePx);this._getFirstRow(i)},_getFirstRow:function(n){var i=this.XLObj,t=i.getSheet(n),r=0,u,f,e=t._rowHeightCollection;i.getFrozenRows(n)<1&&(r=i._getContent(n).find(".e-content").scrollTop(),u=i._getIdxWithOffset(r,null,!0,null,n).rowIdx,t._topRow={idx:u,value:e[u]});f=i._getIdxWithOffset(r+t._vPortHgt,null,!0,null,n).rowIdx||t.rowCount-1;t._bottomRow={idx:f,value:e[f]};t.topLeftCell=i.getAlphaRange(t._topRow.idx,t._leftCol.idx)},_getFirstColumn:function(n){var i=this.XLObj,t=i.getSheet(n),r=0,u,f,e=t._colWidthCollection;i.getFrozenColumns(n)<1&&(r=document.getElementById(i._id+"_content").scrollLeft,u=i._getIdxWithOffset(null,r,!0,null,n).colIdx,t._leftCol={idx:u,value:e[u]});f=i._getIdxWithOffset(null,r+t._vPortWth,!0,null,n).colIdx||t.colCount-1;t._rightCol={idx:f,value:e[f]};t.topLeftCell=i.getAlphaRange(t._topRow.idx,t._leftCol.idx)},scrollToCell:function(n){var u,f,o=0,s=0,i=this.XLObj,r=i.getRangeIndices(n),e=i.getActiveSheetIndex(),t=i.getSheet(e);u=r[0]>t.rowCount?i._getRowOffsetBottom(t.rowCount-1,e)+(r[0]-t.rowCount)*t.rowHeight:i._getRowOffsetBottom(r[0]-1,e);f=r[1]>t.colCount?i._getWidth(0,t.colCount-1)+(r[1]-t.colCount)*t.columnWidth:i._getWidth(0,r[1]-1);i._isFrozen(t.frozenRows)&&(o=i._getRowOffsetTop(t,t._frozenRows-1));i._isFrozen(t.frozenColumns)&&(s=i._getColOffsetLeft(t,t._frozenColumns-1));this._isScrollToCell=!0;i._scrollContent({x:(f?f:0)-t._scrollLeft-s,y:(u?u:0)-t._scrollTop-o});this._isScrollToCell=!1},_scrollSelectedPosition:function(n,t){if(!this.XLObj._isExport){var s,h,c=0,r=this.XLObj,u=this._hScroller(n),f=this._vScroller(n),i=r._getCellInfo(t),o=r.getSheet(n),e=r._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content"),a=f.element.find(".e-vhandle"),l=a[0].getBoundingClientRect(),v=r._dupDetails,y=l.top+f._scrollData.handle>=f._scrollData.handleSpace,p=l.left+u._scrollData.handle>=u._scrollData.handleSpace;r.isUndefined(u)||parseInt(i.width)+(i.left-e.offset().left)>e.width()&&(s=i.left-(u._scrollData.handleSpace+u.model.buttonSize),s<0?u.scroll(0):(p&&(r._scrollReverse=!0),(parseInt(i.width)+i.left>u._scrollData.handleSpace+u.model.buttonSize*2||i.left-e.offset().left<=0)&&s!=0&&u.scroll(i.left+i.width+1-(u._scrollData.handleSpace+u.model.buttonSize*2)),r._scrollReverse=!1));r.isUndefined(f)||(parseInt(i.height)+(i.top-e.offset().top)>e.height()||i.top-e.offset().top<=0)&&(t.rowIndex<o._topRow.idx||t.rowIndex>o._bottomRow.idx)&&(!t.rowIndex<o._bottomRow.idx&&t.rowIndex<o.rowCount-1&&(c=i.height),h=i.top+c-(f._scrollData.handleSpace+f.model.buttonSize),h<0?f.scroll(0):(y&&(r._scrollReverse=!0),f.scroll(i.top+i.height+1-(f._scrollData.handleSpace+f.model.buttonSize*2)),r._scrollReverse=!1));r._dupDetails=v}},_rowTemplate:function(n,t){for(var i,e="",u=this.XLObj,o=u.getSheet(n),r=0,f=u.model.sheets[n].colCount;r<f;r++)i="e-rowcell",o.showGridlines||(i=i.concat(" e-hborder")),o._hiddenFreezeCols.indexOf(r)>-1&&(i+=" e-fcol-hide"),e+=String.format('<td class="{0}" style="{2}"  >{1}<\/td>',i,"");return String.format("<tr style='{0}' data-idx=\"{1}\">"+e+"<\/tr>","height:"+u.model.rowHeight+"px;",t-1)},_rowHeaderTemplate:function(n,t){var i;return t=t?t:this.XLObj.model.rowHeight,i=String.format('<td class="{0}"  >{1}<\/td>',"e-rowheader",n),String.format("<tr style='{0}' data-idx=\"{1}\">"+i+"<\/tr>","height:"+t+"px;",n-1)},_columnTemplate:function(){var n="e-rowcell e-wrapword",t=this.XLObj,i=t.getActiveSheetIndex();return t.getSheet(i).showGridlines||(n=n.concat(" e-hborder")),String.format('<td class="{0}" style="{2}" >{1}<\/td>',n,"")},_colGroupTemplate:function(n,t){t=t?t:this.XLObj.getSheet(n).columnWidth;return String.format("<col style = '{0}'><\/col>","width:"+t+"px;")},_columnHeaderTemplate:function(n,t){var r,u,i=this.XLObj,f=i.getSheet(t),e=i.getObjectLength(i._copyColumns);return r=i._generateHeaderText(n),f.fieldAsColumnHeader&&e&&i._copyColumns[r]&&(r=i._copyColumns[r].text),u=String.format('<div class = "{0}" > {1}<\/div>',"e-headercelldiv",r),String.format('<th class="{0}"  >{1}<\/th>',"e-headercell",u)},_createNewRow:function(t,i,r,u){var y,s,h,l,e,a,f=this.XLObj,p=f.model.scrollSettings.allowVirtualScrolling,w=f.XLSelection,o=f.getSheet(t),c,v;if(p?(s=f._getContent(t).find("tbody")[1],e=f._getJSSheetRowHeaderContent(t).find("tbody")[1]):(s=f._getContent(t).find("tbody").not("[class *= 'e-ss-virtual']")[0],e=f._getJSSheetRowHeaderContent(t).find("tbody").not("[class *= 'e-ss-virtual']")[0]),l=this._rowTemplate(t,parseInt(e.lastChild.textContent)+1),i===-1||r>-1&&i>-1&&u==="shift"?(n(e).append(this._rowHeaderTemplate(parseInt(e.lastChild.textContent)+1)),n(s).append(l),u=="shift"&&(n(s).find("tr:last td:last").remove(),y=f._getRowIdx(i),n(s).find("tr: eq(' + rowElemIdx + ') td:eq(' + (colIdx - 1) + ')").after(this._columnTemplate()))):(h=s.insertRow(i),n(h).height(f.model.rowHeight),n(h).append(n(l)[0].innerHTML),h=e.insertRow(i),n(h).height(f.model.rowHeight),n(h).append("<td class='e-rowheader'><\/td>")),o.rowCount=f.model.sheets[t].rowCount+1,o.rowsHeightCollection.push(f.model.rowHeight),i>-1){for(a=n(e).find("td"),c=0,v=a.length;c<v;c++)n(a[c]).text(c+1);f.XLScroll._getRowHeights(t,i+1)}o._rowHeightCollection.push(o._rowHeightCollection[o._rowHeightCollection.length-1]+f.model.rowHeight);f.model.allowSelection&&(o._isColSelected||o._isSheetSelected)&&w.refreshSelection();f._refreshRows(t)},_createNewColumn:function(i,r,u,f){var e,s,l,o=this.XLObj,h=o.getSheet(i),st=o.XLSelection,c,d,nt,tt,ft,v,a,p,it,et,ot,rt,w=!1,b,y,ut,k,g;for(c=o._getContTBody(i)[0],d=o._getJSSheetHeader(i).find("tr")[0],nt=o._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer colgroup"),tt=o._getJSSheetHeader(i).find("colgroup"),ft=h.colCount,y=h.filterSettings.tableRange,e=0,l=y.length;e<l;e++)if(rt=y[e].multifilterIdx,r.colIndex>rt[0]&&u.colIndex<rt[rt.length-1]){w=!0;b=y[e].startRow-1;y=y[e];break}if(r.colIndex===-1||r.colIndex>-1&&r.rowIndex>-1&&f==="shift"){if(r.colIndex===-1&&f==="insert"){for(p=this._columnHeaderTemplate(ft+1,i),n(d).append(p),v=this._colGroupTemplate(i),tt.append(v),e=0,l=c.rows.length;e<l;e++)a=this._columnTemplate(e),n(c.rows[o._getRowIdx(e,i,!1,!0)]).append(a);nt.append(v)}if(f==="shift"){for(ut=ft,e=r.colIndex;e<=u.colIndex;e++)p=this._columnHeaderTemplate(ut+1,i),n(d).append(p),v=this._colGroupTemplate(i),tt.append(v),nt.append(v),ut=ut+1;for(e=0,l=c.rows.length;e<l;e++)for(s=r.colIndex;s<=u.colIndex;s++)a=this._columnTemplate(e),n(c.rows[o._getRowIdx(e)]).append(a);if(o._insDelStatus.indexOf("insert")>-1)for(e=r.rowIndex;e<=u.rowIndex;e++)for(s=r.colIndex;s<=u.colIndex;s++)n(c).find("tr:eq("+o._getRowIdx(e)+") td:last").remove(),a=this._columnTemplate(e),n(c).find("tr").eq(o._getRowIdx(e)).find("td:eq("+s+")").before(a),w&&e===b&&o.model.allowFiltering&&o.XLFilter._insertFilterIcon(e,s,y,b,w);else for(e=r.rowIndex;e<=u.rowIndex;e++)for(s=u.colIndex;s>=r.colIndex;s--)n(c).find("tr:eq("+o._getRowIdx(e)+") td:eq("+s+")").remove(),a=this._columnTemplate(e),n(c).find("tr:eq("+o._getRowIdx(e)+")").append(a),w&&e===b&&o.model.allowFiltering&&o.XLFilter._insertFilterIcon(e,s,y,b,w)}h.colCount=h.colCount+1;h.columnsWidthCollection.push(h.columnWidth)}else{if(h._isTemplate&&(r.colIndex<h._templateColCount||u.colIndex<h._templateColCount))return;if(g=n.extend(!0,[],o.getSheet(i).columnsWidthCollection),o._insDelStatus.indexOf("insert")>-1){for(k=g.splice(0,r.colIndex),e=r.colIndex;e<=u.colIndex;e++)p=this._columnHeaderTemplate(e+1,i),n(d).find("th:eq("+e+")").before(p),v=this._colGroupTemplate(i),k.push(h.columnWidth),tt.find("col:eq("+e+")").before(v),nt.find("col:eq("+e+")").before(v),h.colCount=h.colCount+1;for(t.merge(k,g),h.columnsWidthCollection=k,e=0,l=c.rows.length;e<l;e++)for(s=r.colIndex;s<=u.colIndex;s++)a=this._columnTemplate(e),n(c.rows[o._getRowIdx(e)]).find("td:eq("+s+")").before(a),w&&e===b&&o.model.allowFiltering&&o.XLFilter._insertFilterIcon(e,s,y,b,w)}else{for(k=g.splice(0,r.colIndex),e=u.colIndex;e>=r.colIndex;e--)n(d).find("th:eq("+e+")").remove(),tt.find("col:eq("+e+")").remove(),nt.find("col:eq("+e+")").remove(),h.colCount=h.colCount-1;for(g.splice(0,u.colIndex-r.colIndex+1),t.merge(k,g),h.columnsWidthCollection=k,e=0,l=c.rows.length;e<l;e++)for(s=u.colIndex;s>=r.colIndex;s--)n(c.rows[o._getRowIdx(e)]).find("td:eq("+s+")").remove()}for(et=n(d).find("th>.e-headercelldiv"),e=0,l=et.length;e<l;e++)n(et[e]).text(o._generateHeaderText(e+1))}ot=n.trim(n(p).text());it=n(a).text();h.columns.push({field:ot,text:ot,type:it!=null?it.getDay?"date":typeof it:null,width:n(a).width()});o.XLScroll._getColWidths(i,r.colIndex>-1?r.colIndex:h.colCount-2);o.model.allowSelection&&(h._isRowSelected||h._isSheetSelected)&&st.refreshSelection();o._refreshTemplates(i,!0)},_insertColHeaders:function(t,i,r){var f=this._columnHeaderTemplate(i+1,t),u;n(r).append(f);u=this._colGroupTemplate(t);n(r.parentNode.previousSibling).append(u)},_scrollBottom:function(n,t){var i=this.XLObj.getSheet(n),r,u;if(t)this._createRows(i.rowCount-1,i.rowCount+t,n);else{this._createNewRow(n,-1,-1,"insert");for(r in i._columnStyles)u=parseInt(r),this.XLObj.XLEdit._updateDataContainer({rowIndex:i.rowCount-1,colIndex:u},{dataObj:i._columnStyles[r]})}},_createRows:function(n,t,i){i=i||this.XLObj.getActiveSheetIndex();for(var r=n,u=t;r<u;r++)this._createNewRow(i,-1,-1,"insert")},_scrollRight:function(n){var r={rowIndex:-1,colIndex:-1},t,u,i;this._createNewColumn(n,r,r,"insert");t=this.XLObj.getSheet(n);for(i in t._rowStyles)u=parseInt(i),this.XLObj.XLEdit._updateDataContainer({rowIndex:u,colIndex:t.colCount-1},{dataObj:t._rowStyles[i]})},_ensureScrollPos:function(n){var r,i,u={},f=this.XLObj;return n.model.orientation===t.ScrollBar.Orientation.Vertical?(r=n.scrollTop,i=f._getIdxWithOffset(r,null,!0),u.rowIdx=i.rowIdx,r!==i.yOffset&&(u.resetTo=i.yOffset)):(r=n.scrollLeft,i=f._getIdxWithOffset(null,r,!0),u.colIdx=i.colIdx,r!==i.xOffset&&(u.resetTo=i.xOffset)),u},_refreshRowCol:function(n,t){t=this.XLObj._getSheetIndex(t);var i,r=this.XLObj.getSheet(t),u=!1;if(r.colCount<n[3]+1){for(i=n[3]-(r.colCount-1);i--;)this._scrollRight(t);u=!0}if(r.rowCount<n[2]+1){for(i=n[2]-(r.rowCount-1);i--;)this._scrollBottom(t);u=!0}u&&this._refreshScroller(t,"refresh","all")}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.pivot=function(n){this.XLObj=n;this._pivotCnt=1;this._hasPvtField=!1;this._displayActPanel=!0;this.names={};this._valueFieldName=""};t.spreadsheetFeatures.pivot.prototype={createPivotTable:function(t,i,r,u,f){var e=this.XLObj,h,l,a=new RegExp("[^a-z0-9\\s]","gi");if(r&&(r.indexOf(" ")>-1||r.match(a))&&(l=r,r=r.replace(a,"").replace(/ /g,"_")),e.model.enablePivotTable&&(!e.getSheet()._isLoaded||!e.model.isReadOnly)){var v=e.XLRibbon,c=e.getActiveSheetIndex(),s=[],y,p,w,o,b=0,k=0,d;if(e._showDialog(e._id+"_Ribbon_Insert_Tables_PivotTable"),o=v._getAddrFromDollarAddr(t),y=e.model.sheets[o[0]].sheetInfo.text,t=e.getRangeIndices(o[1]),p=e.getRangeDataAsJSON({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]},!1,o[0]),n("#"+e._id+"_dlg_existsheet").data("ejRadioButton").model.checked||e.isImport||e.model.isImport||!e.getSheet(c)._isLoaded?(o=v._getAddrFromDollarAddr(i),s=e.getRangeIndices(o[1]),e._isExport||c===o[0]||(e.gotoPage(o[0],!1),c=o[0])):(e.insertSheet(),c=e.getActiveSheetIndex(),s=[2,0]),e.isUndefined(f)&&(f={}),k=e.model.sheets[o[0]]._rowHeightCollection[s[0]],b=e.model.sheets[o[0]]._colWidthCollection[s[1]],e.hideActivationPanel(),r&&r.length){if(e.getObjectKeys(this.names).indexOf(r)>-1)do r=r+this._pivotCnt,this._pivotCnt++;while(e.getObjectKeys(this.names).indexOf(r)>-1)}else do r="PivotTable"+this._pivotCnt,this._pivotCnt++;while(e.getObjectKeys(this.names).indexOf(r)>-1);return h=e._id+"_"+r,this.names[h]=l?l:r,f.pvtRange=s,f.sheetIdx=c,f.temp=o[0],f.datasource=p,e.getSheet(c)._isUpdated||this._updatePivotMngr({},{pivot:{id:h,top:k,left:b,rowIndex:s[0],colIndex:s[1],dataRange:t,dataSheetName:y,sheetIdx:c,tableName:this.names[h]}}),this._refreshPivotElement(t,i,r,u,f),d=e.element.find("#"+h).data("ejPivotGrid"),this._refreshRowColumn(s,d),e.showActivationPanel(),w={sheetIndex:f.sheetIdx,reqType:"shape",shapeType:"pivot",range:f.pvtRange,ID:h,dataSource:f.datasource},e._trigActionComplete(w),h}},_refreshRowColumn:function(n,t){var f,r=this.XLObj,s=r.getActiveSheetIndex(),h=r.getSheet(s),e=[],u,i,o;for(u=t._rowCount,o=t.calculateCellWidths().rowHeight,e=t.calculateCellWidths().columnWidths,f=e.length,r._focusTopElem||r._createFocusElement(),u||(u=4),i=n[0];i<u+n[0];i++)r.XLResize.setRowHeight(i,o);if(f>0)for(i=0;i<f+n[1];i++)r.XLResize.setColWidth(i+n[1],e[i]);else for(i=0;i<3+n[1];i++)r.XLResize.setColWidth(i+n[1],81);h._isFreezed&&(r.XLFreeze._refreshFreezeRowDiv(),r.XLFreeze._refreshFreezeColDiv())},_refreshPivotElement:function(i,r,u,f,e){var o=this.XLObj,s,h,c,l,a;l=o.model.sheets[e.sheetIdx]._rowHeightCollection[e.pvtRange[0]];a=o.model.sheets[e.sheetIdx]._colWidthCollection[e.pvtRange[1]];c={dataSource:{data:e.datasource},enableToolTipAnimation:!1,cellDoubleClick:n.proxy(this._cellDblClick,this),enableCellDoubleClick:!0,renderSuccess:n.proxy(this._renderSuccess,this),drillSuccess:n.proxy(this._renderSuccess,this)};t.isNullOrUndefined(f)||(c.dataSource={data:e.datasource,rows:f.rows,columns:f.columns,values:f.values,filters:f.filters});o.getSheetElement(o.getActiveSheetIndex()).find(".e-ss-activepivot").removeClass("e-ss-activepivot");s=t.buildTag("div.e-ss-pivot","","",{id:o._id+"_"+u});s.css({left:a-2,top:l-2}).addClass("e-ss-activepivot");o._getContent(e.sheetIdx).find(".e-content").append(s);this._hasPvtField||o.getActivationPanel().append(t.buildTag("div","",{overflow:"hidden"},{id:o._id+"_PivotField"}));o.element.find("#"+o._id+"_PivotField").append(t.buildTag("div.e-ss-pivotfield","","",{id:o._id+"_PivotTableSchema_"+o._id+"_"+u}));h=o.element.find("#"+o._id+"_PivotTableSchema_"+o._id+"_"+u);o.getActivationPanel().find("#"+h[0].id).show();s.ejPivotGrid(c);h.find("#"+o._id+"_PivotTableSchema_"+o._id+"_"+u+"_schemaFieldTree").data("ejTreeView").option("allowDragAndDrop",!1);h.css({float:"left",width:o.model.activationPanelWidth-20});h.find(".schemaFieldList").css({height:150});this._hasPvtField||(o.getActivationPanel().ejScroller({width:o.model.activationPanelWidth,height:o._getContent(e.sheetIdx).height(),scroll:n.proxy(this._pivotScroll,this)}),this._hasPvtField=!0);this._clearBackgroundData(s.data("ejPivotGrid"),o.getSheet(e.sheetIdx).pivotMngr.pivot[s[0].id],e.sheetIdx,"update");o.XLRibbon&&o.XLRibbon._analyzeTabUpdate();o.XLSelection._cleanUp(!0);o.getActivationPanel().data("ejScroller").refresh()},deletePivotTable:function(n){var o,u=this._getPivotIDFromName(n),t=this.XLObj,f,e=t._dataContainer,r,i;if(t.model.enablePivotTable&&!t.model.isReadOnly)for(i=1,o=t.model.sheetCount;i<=o;i++)t._getContent(i).find("#"+u).length&&(r=t.getSheet(i).pivotMngr.pivot[u],f=e.sheets[i][r.rowIndex][r.colIndex],t.getObjectLength(f)<2&&f.pivot.length<2?delete e.sheets[i][r.rowIndex][r.colIndex]:f.pivot.length<2&&delete e.sheets[i][r.rowIndex][r.colIndex].pivot,delete t.getSheet(i).pivotMngr.pivot[u],t._getContent(i).find("#"+u).remove(),t.hideActivationPanel(),t.getActivationPanel().find("#"+t._id+"_PivotTableSchema_"+u).remove(),t.XLRibbon._toggleAnalyzeTab(),t._trigActionComplete({ID:u,rowIndex:r.rowIndex,colIndex:r.colIndex,reqType:"shape",shapeType:"pivot",sheetIndex:i}))},refreshDataSource:function(n,t){var i=this.XLObj,r,f,e,u,o;i.model.enablePivotTable&&!i.model.isReadOnly&&(n&&t?(r=i.element.find("#"+i._id+"_"+n),r&&(f=r[0].id)):(t=i.getActiveSheetIndex(),r=i._getContent(t).find(".e-ss-activepivot"),f=r[0].id),e=r.data("ejPivotGrid"),e&&(u=i.getSheet(t).pivotMngr.pivot[f].dataRange,o=i.getRangeDataAsJSON({rowIndex:u[0],colIndex:u[1]},{rowIndex:u[2],colIndex:u[3]},!1,i._getSheetIndexByName(i.getSheet(t).pivotMngr.pivot[f].dataSheetName)),e.model.dataSource.data=o,e.refreshPivotGrid()))},clearPivotFieldList:function(n){var t=this.XLObj,i=this._getPivotIDFromName(n);t.model.enablePivotTable&&!t.model.isReadOnly&&this._clearFilters(t.element.find("#"+i).data("ejPivotGrid"),t.getActivationPanel().find("#"+t._id+"_PivotTableSchema_"+i).data("ejPivotSchemaDesigner"))},_cellDblClick:function(n){if(n.selectedData.length){var t=this.XLObj,i=t.XLFormat,r;t.insertSheet();r=t.getActiveSheetIndex();t._updateRangeValue(r,{dataSource:n.selectedData,startCell:"A1",showHeader:!0},!1);i.createTable({header:!0,name:"Table"+t._tableCnt,format:i._getTableLayoutFromName("TableStyleMedium9").format,formatName:"TableStyleMedium9"},"A1:"+t._generateHeaderText(t.getObjectLength(n.selectedData[0]))+(n.selectedData.length+1))}},_dragMove:function(){var i=this.XLObj,t,r=i.getActivationPanel().data("ejScroller"),f=i.element.find(".e-spreadsheetactpanel"),u=f.offset().top;f.height()+u-45<n(".e-dragedNode").offset().top?t=setInterval(function(){f.height()+u-45<n(".e-dragedNode").offset().top&&r.scrollY(r.model.scrollTop+25)},300):u+45>n(".e-dragedNode").offset().top&&(t=setInterval(function(){u+45>n(".e-dragedNode").offset().top&&r.scrollY(r.model.scrollTop-25)},300));i._browserDetails.name==="msie"&&i._browserDetails.version==="8.0"?(n(".e-dragedNode")[0].attachEvent("onmouseup",function(){clearInterval(t)}),document.attachEvent("onmouseup",function(){clearInterval(t)})):(n(".e-dragedNode")[0].addEventListener("mouseup",function(){clearInterval(t)}),document.addEventListener("mouseup",function(){clearInterval(t)}))},_renderSuccess:function(i){i.type==="drillSuccess"&&(i=i.gridObj);var r=this.XLObj,e=r.getActiveSheetIndex(),o,s,u,f=i,h=[];r._isExport||this._clearBackgroundData(i,r.getSheet(e).pivotMngr.pivot[i._id],e,"update");r.element.find("#"+r._id+"_PivotTableSchema_"+i._id).ejPivotSchemaDesigner({pivotControl:i,layout:t.PivotSchemaDesigner.Layouts.Excel,dragMove:n.proxy(this._dragMove,this),fieldItemDropped:n.proxy(this._fieldItemDropped,this)});u=r.getSheet(e).pivotMngr.pivot[i._id];s=f._rowCount;o=f.getJSONRecords().length/f._rowCount;h=[u.rowIndex,u.colIndex,u.rowIndex+s,u.colIndex+o];this._refreshRowColumn(h,f);n(".e-spreadsheet .e-pivotgrid th[role='columnheader'").addClass("e-ss-pivottableheader");n(".e-spreadsheet .e-pivotgrid tr:last th.rgtot").addClass("e-ss-pivottableheader");r.XLDragFill.hideAutoFillElement()},_clearBackgroundData:function(n,t,i,r){var u=this.XLObj,f,e,o,s;f=n.getJSONRecords().length/n._rowCount;e=n._rowCount;o=!e||isNaN(e)?t.rowIndex+17:t.rowIndex+e;s=!f||isNaN(f)?t.colIndex+2:t.colIndex+f-1;r&&r!=="update"?u.getRange([t.rowIndex,t.colIndex,o,s],i).removeClass("e-readOnly"):u.getRange([t.rowIndex,t.colIndex,o,s],i).removeClass("e-readOnly").addClass("e-readonly");u._dupDetails=!0;u.clearRangeData([t.rowIndex,t.colIndex,o,s],["value","value2","hyperlink","cFormatRule","comment","format","formats"],"",!1);u._dupDetails=!1},_fieldItemDropped:function(n){if(n.axis==="filter")for(var i=this.XLObj,f=i.getActiveSheetIndex(),r,u=i._getContent(f).find(".e-ss-activepivot").data("ejPivotGrid"),t=i.getSheet(f).pivotMngr.pivot[u._id];t.rowIndex<=u.getOlapReport().filters.length;)t.rowIndex=t.rowIndex+1,r=i.getCell(t.rowIndex,t.colIndex)[0],u.element.css({left:r.offsetLeft-2,top:r.offsetTop-2})},_updatePivotMngr:function(t,i){var r=this.XLObj,u=r.getSheet(r.getActiveSheetIndex()).pivotMngr,f=u.pivot;f[i.pivot.id]=n.extend(!0,{},i.pivot);r.XLEdit._updateDataContainer({rowIndex:i.pivot.rowIndex,colIndex:i.pivot.colIndex},{dataObj:{pivot:i.pivot.id}})},_pivotMouseDown:function(t){var i=this.XLObj;t.preventDefault();i.getActivationPanel().find("#"+i._id+"_PivotTableSchema_"+t.target.id).show();i._getContent(i.getActiveSheetIndex()).find(".e-ss-activepivot").removeClass("e-ss-activepivot");n(t.target).hasClass("e-ss-pivot")?n(t.target).addClass("e-ss-activepivot"):n(t.target).parents("e-ss-object").addClass("e-ss-activepivot");i.XLSelection._cleanUp(!0);i.showActivationPanel()},_pivotScroll:function(t){var i=this.XLObj,r=i.getActivationPanel().find("#"+i._id+"_PivotTableSchema_"+i._getContent(i.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).data("ejPivotSchemaDesigner");t.source==="thumb"&&(n(".e-dragedNode").length||r._isDragging||this.XLObj.XLResize._allowStart)&&(t.cancel=!0)},_pivotMouseUp:function(i){var r=this.XLObj,o=n(i.target),s=n("#"+r._id+"_Ribbon").data("ejRibbon"),e,h=r._getContent(r.getActiveSheetIndex()).find(".e-ss-activepivot"),f=h.length==1?n("#"+r._id+"_PivotTableSchema_"+h[0].id+"_pivotTreeContextMenu"):null,u=t.isNullOrUndefined(f)?null:f.find("#"+r._id+"_fieldSettings")[0];r.model.showRibbon&&(r._getContent(r.getActiveSheetIndex()).find(".e-ss-activepivot").length&&(o.hasClass("e-ss-pivot")||o.parents(".e-ss-pivot").length)?r.XLRibbon._analyzeTabUpdate():!r._getContent(r.getActiveSheetIndex()).find(".e-ss-activepivot").length&&(s.model.selectedItemIndex===r.XLRibbon._getTabIndex("analyze")||s.isVisible("Analyze"))&&r.XLRibbon._toggleAnalyzeTab());this._valueFieldName=i.target.textContent;e=t.isNullOrUndefined(f)?null:f.data("ejMenu");e&&n(i.target).parents().eq(2).hasClass("e-schemaValue")&&n(i.target).hasClass("e-pvtBtn")?u?e.showItems(["#"+u.id]):(e.insert([{id:r._id+"_fieldSettings",parentId:null,text:"Value Field Settings "}],"#"+f[0].id),u=f.find("#"+r._id+"_fieldSettings")[0],r._browserDetails.name=="msie"&&r._browserDetails.version=="8.0"?n(u)[0].attachEvent("onclick",this._cmenuclick,!0):n(u)[0].addEventListener("click",this._cmenuclick,!0)):t.isNullOrUndefined(u)||n(i.target).parents().eq(2).hasClass("e-schemaValue")||e.hideItems(["#"+u.id])},_cmenuclick:function(t){var i=n("#"+t.currentTarget.id.split("_fieldSettings")[0]).data("ejSpreadsheet"),u=i._id,r=n("#"+u+"_fielddlg");r.hasClass("e-dialog")?(r.ejDialog("open"),i.XLPivot._refreshSummaryList()):i.XLPivot._renderFieldSettingDlg()},_renderFieldSettingDlg:function(){var i=this.XLObj,tt=i._id,r=tt+"_fielddlg",u,f,e,o,w,b,k,s,d,h,c,g,l,a,nt,v,y,p;u=t.buildTag("div#"+r);f=t.buildTag("div#"+r+"_fieldtab");e=t.buildTag("div.e-dlg-fields e-dlgctndiv");s=t.buildTag("div.e-ss-maindiv");c=t.buildTag("div.e-ss-topmaindiv");g=t.buildTag("label",i._getLocStr("FieldValue"),"",{id:r+"_fieldnamelabel"});h=t.buildTag("label#"+r+"_fieldnamevaluelabel.e-dlg-fieldlabel");h.text(this._valueFieldName);c.append(g,h);u.append(c);l=t.buildTag("div");d=t.buildTag("label#"+r+"_fieldvallabel.e-dlg-fieldvaluelabel",i._getLocStr("SummarizeChooseType"));p=t.buildTag("ul#"+r+"_summarylist","",{width:"150px",height:"150px"});l.append(d,p);s.append(l);o=t.buildTag("ul .e-ul");w=t.buildTag("a",i._getLocStr("SummarizeValue"),{},{href:"#"+r+"_summary"});k=t.buildTag("li",w);p.ejListBox({selectedItemIndex:"0",width:"150px",height:"150px",dataSource:[{value:"sum",text:"Sum"},{value:"count",text:"Count"},{value:"average",text:"Average"},{value:"max",text:"Max"},{value:"min",text:"Min"}],fields:{text:"text",value:"value"},allowMultiSelection:!1});o.append(k);f.append(o);e.append(f);a=t.buildTag("div.e-dlg-btnfields");nt=t.buildTag("div.e-dlg-btnctnr");v=t.buildTag("input#"+r+"_okbtn");y=t.buildTag("input#"+r+"_cantn");v.ejButton({text:i._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._fielddlgOk,this),cssClass:"e-ss-okbtn"});y.ejButton({text:i._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._fielddlgCancel,this)});a.append(nt.append(v,y));i.element.append(u.append(e,a));f.ejTab({width:"100%",height:"auto",cssClass:"e-ss-dlgtab",allowKeyboardNavigation:!1});b=n("#"+r+"_summary");b.append(s);u.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("ValueFieldSettings"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-mattab e-ss-fcdlg e-"+i._id+"-dlg",open:function(){n("#"+i._id+"_formatdlg_okbtn").focus()}});u.ejDialog("open");this._refreshSummaryList()},_refreshSummaryList:function(){for(var r=this.XLObj,e=r._id,o=e+"_fielddlg",s,h,u,a=r.getActiveSheetIndex(),v=r._getContent(a).find(".e-ss-activepivot")[0].id,c=n("#"+v).data("ejPivotGrid"),y=c.model.dataSource.values.length,f=c.model.dataSource,l,i=0;i<y;i++)f.values[i].fieldName==this._valueFieldName&&(l=t.isNullOrUndefined(f.values[i].summaryType)?"sum":f.values[i].summaryType);s=n("#"+o+"_fieldnamevaluelabel");s.text(this._valueFieldName);h=n("#"+o+"_summarylist").data("ejListBox");h.selectItemByValue(l);u=n("#"+e+"_fielddlg_fieldtab").data("ejTab");u&&u._refresh()},_fielddlgOk:function(){for(var r=this.XLObj,o=r.getActiveSheetIndex(),s=r._id,f=s+"_fielddlg",h=n("#"+f+"_summarylist").data("ejListBox"),c=r._getContent(o).find(".e-ss-activepivot")[0].id,e=n("#"+c).data("ejPivotGrid"),u=e.model.dataSource,l=u.values.length,a=h.getSelectedItems()[0].text,i=0;i<l;i++)u.values[i].fieldName==this._valueFieldName&&(u.values[i].summaryType=t.PivotAnalysis.SummaryType[a]);e.refreshControl();n("#"+f).ejDialog("close")},_fielddlgCancel:function(){n("#"+this.XLObj._id+"_fielddlg").ejDialog("close")},_changePvtName:function(){var n=this.XLObj,r=n.element.find("#"+n._id+"_Ribbon_Analyze_PivotTable_PivotTableName").val(),t=n.getActiveSheetIndex(),i=n._getContent(t).find(".e-ss-activepivot")[0].id;n.getSheet(t).pivotMngr.pivot[i].tableName=this.names[i]=r;n._trigActionComplete({pvtName:r,reqType:"shape",shapeType:"pivot",sheetIndex:t,ID:i})},_checkRange:function(n,t){var i=this.XLObj,g=i.getActiveCell(),y,p=g.rowIndex,w=g.colIndex,b,r=[],k=i._getContent(i.getActiveSheetIndex()).find(".e-ss-activepivot"),e,u,h,c={isHeader:!1,isRows:!1},d,s,o,nt,l,a,v,tt,it,f;if(e=i.XLRibbon._getAddrFromDollarAddr(n),y=e[0],r=i.getRangeIndices(e[1]),p=r[0],w=r[1],n.length)for(u=0,h=r[3]-w+1;u<h;u++)b=i.XLEdit.getPropertyValue(p,w+u,"value",y),(i.isUndefined(b)||b=="")&&(c.isHeader=!0);if(p===r[2]&&(c.isRows=!0),t.length)for(e=i.XLRibbon._getAddrFromDollarAddr(t),y=e[0],r=i.getRangeIndices(e[1]),u=1,h=i.model.sheetCount;u<=h;u++)for(d=i.model.sheets[u].pivotMngr.pivot,s=i.getObjectKeys(d),o=0,nt=s.length;o<nt;o++)if((!k.length||k.length&&s[o]!==k[0].id)&&(l=i.element.find("#"+s[o]).data("ejPivotGrid"),f=d[s[o]],a=l.getJSONRecords().length/l.rowCount,v=l.rowCount,tt=!v||isNaN(v)?f.rowIndex+17:f.rowIndex+v-1,it=!a||isNaN(a)?f.colIndex+2:f.colIndex+a-1,r[0]>=f.rowIndex&&r[0]<=tt&&r[1]>=f.colIndex&&r[1]<=it)){c.isOverlap=!0;break}return c},_updateSheetName:function(n){for(var t=this.XLObj,i,u,f,o,s=t.getSheet(t.getActiveSheetIndex()).sheetInfo.text,r=1,e=t.model.sheetCount;r<=e;r++)for(u=t.getSheet(r).pivotMngr.pivot,f=t.getObjectKeys(u),i=0,o=f.length;i<o;i++)u[f[i]].dataSheetName===s&&(u[f[i]].dataSheetName=n)},_getSheetIdxFromName:function(n){for(var i=this.XLObj,t=1,r=i.model.sheetCount;t<=r;t++)if(i.model.sheets[t].sheetInfo.text==n)return t},_changeDataSource:function(){var i,t=this.XLObj,h=t.getActiveSheetIndex(),f=t._getContent(h).find(".e-ss-activepivot")[0].id,e=n("#"+f).data("ejPivotGrid"),c,o,l,r,s,u=e.getOlapReport();o=t.XLRibbon._getAddrFromDollarAddr(n("#"+t._id+"_Ribbon_PvtRange").val());l=t.model.sheets[o[0]].sheetInfo.text;i=t.getRangeIndices(o[1]);s=t.getSheet(t.getActiveSheetIndex()).pivotMngr.pivot[f];s.dataRange=i;s.dataSheetName=l;r=t.getRangeDataAsJSON({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]},!1,o[0]);t.getObjectKeys(e.model.dataSource.data[0]).length!==t.getObjectKeys(r[0]).length&&(u.rows=[],u.columns=[],u.values=[],u.filters=[]);u.data=r;c=n("#"+t._id+"_PivotTableSchema_"+f).data("ejPivotSchemaDesigner");e.model.dataSource.data=r;this._refreshFieldList(e,c,r);t._trigActionComplete({sheetIndex:h,dataRange:s.dataRange,ID:f,pvtData:r,reqType:"shape",shapeType:"pivot"})},_refreshFieldList:function(i,r,u){for(var o=this.XLObj,s,e=o.getObjectKeys(u[0]),f=0,h=e.length;f<h;f++)s={droppedFieldName:e[f],droppedFieldCaption:e[f],droppedClass:"row",droppedPosition:"",isMeasuresDropped:e[f].toLocaleLowerCase().indexOf("measures")==0},t.Pivot.addReportItem(i.model.dataSource,s);i.refreshPivotGrid();r.model.pivotControl=i;n(r.element).html("");r._load();o._refreshActivationPanel()},_getPivotIDFromName:function(n){for(var t in this.names)if(n===this.names[t])return t},_clearFilters:function(t,i){var u=this.XLObj,r=t.getOlapReport();r.rows=[];r.columns=[];r.values=[];r.filters=[];t.refreshPivotGrid();i.model.pivotControl=t;n(i.element).html("");i._load();u._refreshActivationPanel()},_movePivotTable:function(){var t=this.XLObj,u=t.getActiveSheetIndex(),f=t._getContent(u).find(".e-ss-activepivot"),o=f[0].id,r,s=f.data("ejPivotGrid"),a,h,e,c,i,l,v=!0,y,w,b,p;if(r=t.getSheet(u).pivotMngr.pivot[o],n("#"+t._id+"_dlg_existsheet").data("ejRadioButton").model.checked?(v=!1,a=n("#"+t._id+"_Ribbon_PvtLocation").val().split("!"),h=this._getSheetIdxFromName(a[0]),i=t.getRangeIndices(t.XLRibbon._getAddrFromDollarAddr(a[1])[1]),u!==h&&(t._getContent(h).find(".e-content").append(f),t.gotoPage(h,!1),t.XLSelection._cleanUp(!0),v=!0),r.rowIndex=i[0],r.colIndex=i[1]):(t.insertSheet(),u=t.getActiveSheetIndex(),t._getContent(u).find(".e-content").append(f),i=[2,0]),v&&(l=t.getActiveSheetIndex(),t.getSheet(l).pivotMngr.pivot[o]={},n.extend(!0,t.getSheet(l).pivotMngr.pivot[o],r),l!==u&&delete t.getSheet(u).pivotMngr.pivot[o]),c=t.getCell(i[0],i[1]),!c&&t.model.scrollSettings.allowVirtualScrolling&&(p=t.getSheet(t.getActiveSheetIndex()),t._scrollContent({y:p._rowHeightCollection[i[0]+1]-p._scrollTop}),c=t.getCell(i[0],i[1])),e=c[0],f.css({left:e.offsetLeft-2,top:e.offsetTop-2}),s.getOlapReport().filters.length)while(r.rowIndex<=s.getOlapReport().filters.length)r.rowIndex=r.rowIndex+1,e=t.getCell(r.rowIndex,r.colIndex)[0],f.css({left:e.offsetLeft-2,top:e.offsetTop-2});b=s._rowCount;w=s.calculateCellWidths().columnWidths.length;y=[i[0],i[1],i[0]+b,i[1]+w];this._refreshRowColumn(y,s);t._trigActionComplete({sheetIndex:u,newRange:y,ID:o,reqType:"shape",shapeType:"pivot"})}}}(jQuery,Syncfusion),function(n,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{};t.spreadsheetFeatures.sparkLine=function(n){this.XLObj=n;this.rowIdx="";this.colIdx="";this.dRange="";this.location=""};t.spreadsheetFeatures.sparkLine.prototype={createSparkline:function(t,i,r,u,f){var e=this.XLObj,v,w,y,ot,st,at,vt,it=!1,nt,yt,ht,b,p,c,ct,rt,k,ut,ft,l,d,g,lt,tt=[],o=[],et=!1,a={},s,h;if(e.model.allowSparkline&&!e.model.ReadOnly){if(u=u||{},(t==""||i=="")&&e._showAlertDlg("Alert","EmptyDLRnge",630),f=f||e.getActiveSheetIndex(),yt=e.XLRibbon._getAddrFromDollarAddr(t),ht=e.XLRibbon._getAddrFromDollarAddr(i),s=e._getSelectedCells(f,yt[1])||e._getSelectedCells(),h=e._getSelectedCells(f,ht[1])||e._getSelectedCells(),u.highPointColor=u.highPointColor||null,u.lowPointColor=u.lowPointColor||null,u.negativePointColor=u.negativePointColor||null,u.startPointColor=u.startPointColor||null,u.endPointColor=u.endPointColor||null,ut=s.range,ot=ut[2]-ut[0]+1,st=ut[3]-ut[1]+1,ft=h.range,at=ft[2]-ft[0]+1,vt=ft[3]-ft[1]+1,h.range[0]==h.range[2]||h.range[1]==h.range[3])if(s.range[0]==s.range[2]||s.range[1]==s.range[3])if(h.selCells.length==1){for(v=0,rt=h.selCells.length;v<rt;v++){for(this.rowIdx=h.selCells[v].rowIndex,this.colIdx=h.selCells[v].colIndex,b=e.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"),b&&e._getContent(f).find("#"+b[0]).remove(),k=e._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},f),w=0,lt=s.selCells.length;w<lt;w++)d=s.selCells[w].rowIndex,g=s.selCells[w].colIndex,l=e.XLEdit.getPropertyValue(d,g,"value",f),typeof l=="string"&&(it=!0),tt.push(l),o.push(d,g);nt=e._getAlphaRange(f,o[0],o[1],o[o.length-2],o[o.length-1])}it?e._showAlertDlg("Alert","SparklineDataAlert",630):typeof l=="number"&&(p=this._renderBaseElem(k,r,this.rowIdx,this.colIdx,f),a={dataSource:tt,type:r,isResponsive:!0,id:p[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:k,DataRange:nt,LocationRange:ht[1],reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:o,fill:"#33ccff"},p.ejSparkline(n.extend(a,u)),e.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:n.extend(a,u)},"sparkline"),e._isUndoRedo||(c=n.extend(a,u),c.sheetIndex=f,e._completeAction(c),e._trigActionComplete(c)),et=!0)}else if(s.selCells.length==h.selCells.length)for(y=0,lt=s.selCells.length;y<lt;y++)this.rowIdx=h.selCells[y].rowIndex,this.colIdx=h.selCells[y].colIndex,b=e.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"),b&&e._getContent(f).find("#"+b[0]).remove(),k=e._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},f),l=e.XLEdit.getPropertyValue(s.selCells[y].rowIndex,s.selCells[y].colIndex,"value",f),!1,o.push(s.selCells[y].rowIndex,s.selCells[y].colIndex),typeof l=="string"?e._showAlertDlg("Alert","SparklineDataAlert",630):typeof l=="number"&&(p=this._renderBaseElem(k,r,this.rowIdx,this.colIdx,f),nt=e._getAlphaRange(f,s.selCells[y].rowIndex,s.selCells[y].colIndex,s.selCells[y].rowIndex,s.selCells[y].colIndex),a={dataSource:[l],type:r,isResponsive:!0,id:p[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:k,DataRange:nt,LocationRange:ht[1],reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:o,fill:"#33ccff"},p.ejSparkline(n.extend(a,u)),e.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:n.extend(a,u)},"sparkline"),e._isUndoRedo||(c=n.extend(a,u),c.sheetIndex=f,e._completeAction(c),e._trigActionComplete(c)),et=!0);else e._showAlertDlg("Alert","SparklineLocAlert",630);else if(ot==at||ot==vt)for(d=s.selCells[0].rowIndex,v=0,rt=h.selCells.length;v<rt;v++){for(this.rowIdx=h.selCells[v].rowIndex,this.colIdx=h.selCells[v].colIndex,b=e.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"),b&&e._getContent(f).find("#"+b[0]).remove(),k=e._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},f),o=[],w=0;w<st;w++)g=s.selCells[w].colIndex,l=e.XLEdit.getPropertyValue(d,g,"value",f),typeof l=="string"&&(it=!0),tt.push(l),o.push(d,g);ct=e._getAlphaRange(f,this.rowIdx,this.colIdx,this.rowIdx,this.colIdx);nt=e._getAlphaRange(f,o[0],o[1],o[o.length-2],o[o.length-1]);it?e._showAlertDlg("Alert","SparklineDataAlert",630):typeof l=="number"&&(p=this._renderBaseElem(k,r,this.rowIdx,this.colIdx,f));a={dataSource:tt,type:r,isResponsive:!0,id:p[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:k,DataRange:nt,LocationRange:ct,reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:o,fill:"#33ccff"};p.ejSparkline(n.extend(a,u));e.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:n.extend(a,u)},"sparkline");d++;tt=[];e._isUndoRedo||(c=n.extend(a,u),c.sheetIndex=f,e._completeAction(c),e._trigActionComplete(c));et=!0}else if(st==at||st==vt)for(g=s.selCells[0].colIndex,v=0,rt=h.selCells.length;v<rt;v++){for(this.rowIdx=h.selCells[v].rowIndex,this.colIdx=h.selCells[v].colIndex,b=e.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"),b&&e._getContent(f).find("#"+b[0]).remove(),k=e._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},f),d=s.selCells[0].rowIndex,o=[],w=0;w<ot;w++)l=e.XLEdit.getPropertyValue(d,g,"value",f),typeof l=="string"&&(it=!0),tt.push(l),o.push(d,g),d++;ct=e._getAlphaRange(f,this.rowIdx,this.colIdx,this.rowIdx,this.colIdx);nt=e._getAlphaRange(f,o[0],o[1],o[o.length-2],o[o.length-1]);it?e._showAlertDlg("Alert","SparklineDataAlert",630):typeof l=="number"&&(p=this._renderBaseElem(k,r,this.rowIdx,this.colIdx,f));a={dataSource:tt,type:r,isResponsive:!0,id:p[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:k,DataRange:nt,LocationRange:ct,reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:o,fill:"#33ccff"};p.ejSparkline(n.extend(a,u));e.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:n.extend(a,u)},"sparkline");g++;tt=[];e._isUndoRedo||(c=n.extend(a,u),c.sheetIndex=f,e._completeAction(c),e._trigActionComplete(c));et=!0}else e._showAlertDlg("Alert","SparklineLocAlert",630);else e._showAlertDlg("Alert","SparklineAlert",630);e.model.showRibbon&&et&&this._sparklineDesignTabUpdate(p[0].id);this._wireSparklineEvents("_on")}},_createSparkline:function(n,t,i){var u=this.XLObj,r;i=i||u.getActiveSheetIndex();u.isImport||u.model.isImport?(r=this._renderBaseElement(t.top,t.left,t.height,t.width,n.rowIndex,n.colIndex,i,n.id),r.ejSparkline(n),n.cellInfo=t,n.id=r[0].id,u.XLShape._updateShapeMngr({rowIndex:n.rowIndex,colIndex:n.colIndex},{sparkline:n},"sparkline")):(t=t||n.cellInfo,r=this._renderBaseElement(t.top,t.left,n.cellInfo.height,n.cellInfo.width,n.rowIndex,n.colIndex,i,n.id),r.ejSparkline(n));this._wireSparklineEvents("_on")},_renderBaseElement:function(t,i,r,u,f,e,o,s){var l=this.XLObj,h,c;return h=n("<div id='"+s+"' class='e-ss-sparkline'  style='top:"+t+"px; left:"+i+"px; height:"+(r-1)+"px; width:"+u+"px;' ><\/div>"),h.data("parentID",l._id),c=l.getCell(f,e,o),c.find('div[id *= "_Merge"]').length?c.find('div[id *= "_Merge"]').prepend(h[0]):c.prepend(h[0]),h},_initSparklineDialog:function(){var n=this.XLObj,i,r,u,f,e;i=t.buildTag("div#"+n._id+"_SparklineDialog");n.element.append(i);i.append(t.buildTag("div#"+n._id+"_Sparkline.e-dlgctndiv"));f=t.buildTag("div#"+n._id+"sparklineBtnDiv.e-dlg-btnfields");e=t.buildTag("div.e-dlg-btnctnr");r=t.buildTag("input#"+n._id+"sparklineDialog_OKBtn","",{},{type:"button"});u=t.buildTag("input#"+n._id+"sparklineDialog_CancelBtn","",{},{type:"button"});r.ejButton({text:n._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._dlgSparklineOk,this),enabled:!0,cssClass:"e-ss-okbtn"});u.ejButton({text:n._getLocStr("Cancel"),click:t.proxy(this._dlgSparklineCancel,this),showRoundedCorner:!0,width:"25%"});f.append(e.append(r,u));i.append(f);i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:n._getLocStr("SparklineChart"),width:"auto",cssClass:"e-ss-dialog e-ss-sparklinedlg e-"+n._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_dlgSparklineOk:function(){var t=this.XLObj,f=t.getActiveSheetIndex(),o=t.getSheet(f),s,u,i,e,h=n("#"+t._id+"_SparklineDialog"),r,c;n("#"+t._id+"_Form_Ribbon_SparklineRange").valid()&&n("#"+t._id+"_Form_Ribbon_SparklineLocation").valid()&&(t.XLRibbon._isEditGroupLocationClick?(r=t.XLRibbon._getAddrFromDollarAddr(this.dRange),u=n("#"+t._id+"_Ribbon_SparklineLocation").val(),i=n("#"+t._id+"_Ribbon_SparklineRange").val(),((r[1]==i||r[1].toLowerCase()==i)&&this.location!=u||(r[1]!=i||r[1].toLowerCase()!=i)&&this.location==u||(r[1]!=i||r[1].toLowerCase()!=i)&&this.location!=u)&&(e=t._getContent(f).find("#"+t._id+"_S"+f+"_"+t.XLRibbon._sparklineDesignType+"_"+this.rowIdx+"_"+this.colIdx),s=o.shapeMngr.sparkline[e[0].id],c=s.type,delete t._dataContainer.sheets[f][this.rowIdx][this.colIdx],delete o.shapeMngr.sparkline[e[0].id],e.remove(),this.createSparkline(i,u,c),h.ejDialog("close"),t.XLRibbon._isEditGroupLocationClick=!1)):(this.dRange=n("#"+t._id+"_Ribbon_SparklineRange").val(),this.location=n("#"+t._id+"_Ribbon_SparklineLocation").val(),this.createSparkline(this.dRange,this.location,t.XLRibbon._sparklineDesignType)),h.ejDialog("close"))},_dlgSparklineDesignOk:function(){var t=this.XLObj,i=t.getActiveSheetIndex(),r,u,f=n("#"+t._id+"_sparklinedesigndlg");n("#"+t._id+"_Form_datarange").valid()&&(u=t.getAlphaRange(t._getSelectedCells(i).selCells[0].rowIndex,t._getSelectedCells(i).selCells[0].colIndex),r=t.XLEdit.getPropertyValue(t._getSelectedCells().selCells[0].rowIndex,t._getSelectedCells().selCells[0].colIndex,"sparkline")[0],this.createSparkline(n("#"+t._id+"_datarange").val(),u,t.getSheet(i).shapeMngr.sparkline[r].type),t.XLRibbon._isEditSingleSparklineClick=!1,f.ejDialog("close"))},_dlgSparklineCancel:function(){var t=this.XLObj;n("#"+t._id+"_SparklineDialog").ejDialog("close");t._setSheetFocus()},_dlgSparklineDesignCancel:function(){var t=this.XLObj;n("#"+t._id+"_sparklinedesigndlg").ejDialog("close");t._setSheetFocus()},_renderSparklineDialog:function(){var r=this.XLObj,s,f,e,u,i,o;n("#"+r._id+"_Ribbon_SparklineDiv").length<1&&(s=t.buildTag("div.e-dlgctndiv","",{},{id:r._id+"_Ribbon_SparklineDiv"}),e=t.buildTag("table","",{},{cellpadding:0,cellspacing:0}),u=t.buildTag("tr"),i=t.buildTag("td"),i.attr("colspan",1),e.append(u.append(i)),u=t.buildTag("tr.e-ss-changerange"),i=t.buildTag("td",""),f=t.buildTag("label"," "+r._getLocStr("DataRange")),i.append(f),u.append(i),i=t.buildTag("td",""),o=t.buildTag("input.ejinputtext","",{},{id:r._id+"_Ribbon_SparklineRange",type:"text"}),o.data("parentID",r._id),u.append(i.append(o)),e.append(u),u=t.buildTag("tr"),i=t.buildTag("td"),f=t.buildTag("label",""),i.append(f),i.attr("colspan",2),e.append(u.append(i)),u=t.buildTag("tr"),i=t.buildTag("td"),f=t.buildTag("label"," "+r._getLocStr("LocationRange")),i.append(f),f=t.buildTag("label","  "),i.append(f),u.append(i),i=t.buildTag("td"),o=t.buildTag("input.ejinputtext","",{},{id:r._id+"_Ribbon_SparklineLocation",type:"text"}),o.data("parentID",r._id),u.append(i.append(o)),e.append(u),n("#"+r._id+"_Sparkline").append(s.append(e)),n("#"+r._id+"_Ribbon_SparklineLocation").wrap("<form id='"+r._id+"_Form_Ribbon_SparklineLocation' onsubmit='return false'><\/form>"),r.XLRibbon._dialogValidate("_Ribbon_SparklineLocation"),n("#"+r._id+"_Ribbon_SparklineRange").wrap("<form id='"+r._id+"_Form_Ribbon_SparklineRange' onsubmit='return false'><\/form>"),r.XLRibbon._dialogValidate("_Ribbon_SparklineRange"))},_tabInsert:function(){var n=this.XLObj;return{text:"Sparkline Charts",id:"SparklineCharts",alignType:t.Ribbon.alignType.rows,content:[{groups:[n.XLRibbon._generateBtn("Insert_Sparkline_Line","LineChart","imageonly","e-icon e-ss-linesparkline",30,n.XLRibbon._smallBtnHeight,"LineSparklineTitle","LineSparklineContent",!1,"ej.ImagePosition.ImageTop"),n.XLRibbon._generateBtn("Insert_Sparkline_Column","ColumnChart","imageonly","e-icon e-ss-columnsparkline",30,n.XLRibbon._smallBtnHeight,"ColumnSparklineTitle","ColumnSparklineContent",!1,"ej.ImagePosition.ImageTop"),n.XLRibbon._generateBtn("Insert_Sparkline_Winloss","Win/Loss Chart","imageonly","e-icon e-ss-winlosssparkline",30,n.XLRibbon._smallBtnHeight,"WinLossSparklineTitle","WinLossSparklineContent",!1,"ej.ImagePosition.ImageTop"),]},{groups:[]},]}},_contextualTabInsert:function(){var n=this.XLObj,i=n._id,r="imagetop";return{backgroundColor:"#EAF6BD",borderColor:"#90AA3C",tabs:[{id:"sparklinedesign",text:n._getLocStr("SPARKLINEDESIGN"),groups:[{text:"Sparkline",alignType:t.Ribbon.alignType.columns,content:[{groups:[n.XLRibbon._generateSplitBtn("SparklineDesign_Sparkline_EditData","EditData","textandimage",i+"_Ribbon_SElement","","e-icon e-ss-editdata",!1,65,n.XLRibbon._bigBtnHeight,"bottom",t.ImagePosition.ImageTop,"dropdown","e-spreadsheet e-sparklineeditdatabtn","EditData","EditDataContent")]}]},{text:"Type",alignType:t.Ribbon.alignType.rows,content:[{groups:[n.XLRibbon._generateBtn("SparklineDesign_Line","LineChart","imageonly","e-icon e-ss-linesparkline",30,n.XLRibbon._smallBtnHeight,"LineSparklineTitle","LineSparklineContent",!1,r),n.XLRibbon._generateBtn("SparklineDesign_Column","ColumnChart","imageonly","e-icon e-ss-columnsparkline",30,n.XLRibbon._smallBtnHeight,"ColumnSparklineTitle","ColumnSparklineContent",!1,r),n.XLRibbon._generateBtn("SparklineDesign_Winloss","Win/Loss Chart","imageonly","e-icon e-ss-winlosssparkline",30,n.XLRibbon._smallBtnHeight,"WinLossSparklineTitle","WinLossSparklineContent",!1,r),]},{groups:[]}]},{text:"Show",alignType:t.Ribbon.alignType.rows,type:"custom",contentID:i+"_Ribbon_SparklineDesign_Show"},{text:"Style",alignType:t.Ribbon.alignType.columns,content:[{groups:[n.XLRibbon._generateSplitBtn("SparklineDesign_Style_SparklineColor","SparklineColor","textandimage",i+"_Ribbon_SparklineBorder","","e-icon e-ss-sparklinecolor",!1,140,n.XLRibbon._mediumBtnHeight,"left","","dropdown","e-ss-pictbrdrbtn","SparklineColorTitle","SparklineColorContent"),n.XLRibbon._generateSplitBtn("SparklineDesign_Style_MarkerColor","MarkerColor","textandimage",i+"_Ribbon_MarkerColorBorder","","e-icon e-ss-markercolor",!1,140,n.XLRibbon._mediumBtnHeight,"left","","dropdown","e-ss-markercolorbtn","MarkerColor","MarkerColorContent")]}]},]}]}},_sparklineDlgBox:function(){var t=this.XLObj,e=t.getActiveSheetIndex(),u=n("#"+t._id+"_SparklineDialog"),i=t.getSheet(e),r,f;n("#"+t._id+"_Ribbon_SparklineRange").val("");n("#"+t._id+"_Ribbon_SparklineLocation").val("");i._selectedCells.length>=1?(r=i.selectedRange,f=t.XLEdit.getPropertyValue(t._getSelectedCells().selCells[0].rowIndex,t._getSelectedCells().selCells[0].colIndex,"sparkline"),f?n("#"+t._id+"_Ribbon_SparklineRange").val(t.getSheet(e).shapeMngr.sparkline[f].DataRange):n("#"+t._id+"_Ribbon_SparklineRange").val(i.sheetInfo.text+"!$"+t._generateHeaderText(r[1]+1)+"$"+(r[0]+1)+":$"+t._generateHeaderText(r[3]+1)+"$"+(r[2]+1))):t.isUndefined(t.XLEdit.getPropertyValueByElem(t.getActiveCellElem()))||(t.selectAll(!1),n("#"+t._id+"_Ribbon_SparklineRange").val(i.sheetInfo.text+"!$"+t._generateHeaderText(i._startCell.colIndex+1)+"$"+(i._startCell.rowIndex+1)+":$"+t._generateHeaderText(i._endCell.colIndex+1)+"$"+(i._endCell.rowIndex+1)));u.find(".e-ss-changerange").show();u.data("ejDialog").option("title",t._getLocStr("CreateSparkline"));u.ejDialog("open")},_sparklinDesignDlg:function(){var t=this.XLObj;n("#"+t._id+"_sparklinedesigndlg").ejDialog("open")},_renderSparklineDesignDlg:function(){var r,i=this.XLObj,u=i._getLocStr("SelectDataSource");r="<div id="+i._id+'_sparklinedesigndlg><div class="e-dlg-fields e-dlgctndiv"><table cellspacing="0" cellpadding="0"><tr><td>'+u+'<\/td><\/tr><tr><td style="padding-top: 11px;"><input id="'+i._id+'_datarange" class="e-ss-changerange" style="width: 100%;"/><\/td><tr class="e-dlgtd-fields"><td><\/td><\/tr><\/table><\/div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+i._id+"_sparklinedesigndlgok>"+i._getLocStr("Ok")+"<\/button><button id="+i._id+"_sparklinedesigndlgcancel>"+i._getLocStr("Cancel")+"<\/button><\/div><\/div><\/div>";i.element.append(r);n("#"+i._id+"_datarange").data("parentID",i._id);n("#"+i._id+"_datarange").wrap("<form id='"+i._id+"_Form_datarange' onsubmit='return false'><\/form>");i.XLRibbon._dialogValidate("_datarange");n("#"+i._id+"_sparklinedesigndlgok").ejButton({showRoundedCorner:!0,width:"20%",click:n.proxy(this._dlgSparklineDesignOk,this)});n("#"+i._id+"_sparklinedesigndlgcancel").ejButton({showRoundedCorner:!0,width:"20%",click:n.proxy(this._dlgSparklineDesignCancel,this)});n("#"+i._id+"_sparklinedesigndlg").ejDialog({showOnInit:!1,width:"auto",showRoundedCorner:!0,title:i._getLocStr("EditSingleSparklineData"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_renderBaseElem:function(t,i,r,u,f){var e=this.XLObj,o;return o=n("<div id='"+e._id+"_S"+f+"_"+i+"_"+r+"_"+u+"' class='e-ss-sparkline'  style='top:"+t.top+"px; left:"+t.left+"px; height:"+(t.height-1)+"px; width:"+t.width+"px;'><\/div>"),o.data("parentID",e._id),e.getCell(this.rowIdx,this.colIdx).prepend(o),e._selectActiveCell(this.rowIdx,this.colIdx),o},_sparklineElementTag:function(){var n=this.XLObj,t="<ul id="+n._id+'_Ribbon_SElement class="selement" style="width: 17%">';return t+='<li class="editgrouplocation" id="EditGroupLocation"><a><span id="editsparkline" class="e-ss-editdatasparkline" style= margin-top:"0px";><\/span>'+n._getLocStr("EditDataContent")+"<\/a><li>",t+('<li class="editsinglesparklinedata" id="EditSingleSparklineData"><a>'+n._getLocStr("EditSingleSparklineData")+"<\/a><li>")},_sparklineColor:function(){var n=this.XLObj;return"<ul id="+n._id+"_Ribbon_SparklineBorder style='width:16%'><li id='"+n._id+"sparklinecolor'><input id='"+n._id+"_Ribbon_SparklineColor' style='display:none; width: 18%'><\/input><\/li><\/ul>"},_markerColor:function(){var n=this.XLObj;return"<ul id="+n._id+"_Ribbon_MarkerColorBorder style='display:none' class='e-ss-pictureborder'><li id='"+n._id+"MarkerNegativePoint'><a>"+n._getLocStr("NegativePoints")+"<\/a><ul><li><input id='"+n._id+"_Ribbon_MarkerNegativePoint'><\/input><\/li><\/ul><\/li><li id='"+n._id+"MarkerHighPoint'><a>"+n._getLocStr("HighPoint")+"<\/a><ul><li><input id='"+n._id+"_Ribbon_MarkerHighPoint'><\/input><\/li><\/ul><\/li><li id='"+n._id+"MarkerLowPoint'><a>"+n._getLocStr("LowPoint")+"<\/a><ul><li><input id='"+n._id+"_Ribbon_MarkerLowPoint'><\/input><\/li><\/ul><\/li><\/ul>"},_renderSparklineTab:function(){var t=this.XLObj,u=t.element,e=t._id,i=e+"_Ribbon",f="",r=t._id+"_Ribbon_SparklineDesign_Show";u.append(this._sparklineElementTag());u.append(this._sparklineColor());u.append(this._markerColor());f="<div id="+r+'><div class="e-tablestyleoptionsrow"><div class="e-sparklinedesignshowcell"><input id='+r+'_HighPoint type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+r+'_HighPoint">'+t._getLocStr("HighPoint")+'<\/label><\/div><div class="e-sparklinedesignshowcell"><input id='+r+'_FirstPoint type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+r+'_FirstPoint">'+t._getLocStr("FirstPoint")+'<\/label><\/div><\/div><div class="e-tablestyleoptionsrow"><div class="e-sparklinedesignshowcell"><input id='+r+'_LowPoint type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+r+'_LowPoint">'+t._getLocStr("LowPoint")+'<\/label><\/div><div class="e-sparklinedesignshowcell"><input id='+r+'_LastPoint type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+r+'_LastPoint">'+t._getLocStr("LastPoint")+'<\/label><\/div><\/div><div class="e-tablestyleoptionsrow"><div class="e-sparklinedesignshowcell"><input id='+r+'_NegativePoints type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+r+'_NegativePoints">'+t._getLocStr("NegativePoint")+'<\/label><\/div><div id= "markers" class="e-sparklinedesignshowcell"><input id='+r+'_Markers type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+r+'_Markers">'+t._getLocStr("Markers")+"<\/label><\/div><\/div>";t.element.append(f);n("#"+r+"_HighPoint").ejCheckBox({change:t.XLRibbon._ribbonClickHandler});n("#"+r+"_FirstPoint").ejCheckBox({change:t.XLRibbon._ribbonClickHandler});n("#"+r+"_LowPoint").ejCheckBox({change:t.XLRibbon._ribbonClickHandler});n("#"+r+"_LastPoint").ejCheckBox({change:t.XLRibbon._ribbonClickHandler});n("#"+r+"_NegativePoints").ejCheckBox({change:t.XLRibbon._ribbonClickHandler});n("#"+r+"_Markers").ejCheckBox({change:t.XLRibbon._ribbonClickHandler});n("#"+i+"_SparklineColor").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",open:n.proxy(t.XLRibbon._colorPickerHandler,this,"Ribbon_SparklineDesign_Style_SparklineColor"),change:t.XLRibbon._ribbonClickHandler});t.XLRibbon._isSetModel=!0;n("#"+i+"_SparklineColor").data("ejColorPicker").show();n("#"+i+"_SparklineColor_popup").css({display:"block",height:"135px"});n("#"+t._id+"sparklinecolor").append(n("#"+i+"_SparklineColor_popup"));n("#"+i+"_SparklineColorWrapper").hide();n("#"+i+"_MarkerNegativePoint").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:t.XLRibbon._ribbonClickHandler});n("#"+i+"_MarkerNegativePoint").data("ejColorPicker").show();n("#"+i+"_MarkerNegativePoint_popup").css({display:"block",height:"135px"});n("#"+t._id+"MarkerNegativePoint ul li").append(n("#"+i+"_MarkerNegativePoint_popup"));n("#"+i+"_MarkerNegativePointWrapper").hide();n("#"+i+"_MarkerHighPoint").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:t.XLRibbon._ribbonClickHandler});n("#"+i+"_MarkerHighPoint").data("ejColorPicker").show();n("#"+i+"_MarkerHighPoint_popup").css({display:"block",height:"135px"});n("#"+t._id+"MarkerHighPoint ul li").append(n("#"+i+"_MarkerHighPoint_popup"));n("#"+i+"_MarkerHighPointWrapper").hide();n("#"+i+"_MarkerLowPoint").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:t.XLRibbon._ribbonClickHandler});n("#"+i+"_MarkerLowPoint").data("ejColorPicker").show();n("#"+i+"_MarkerLowPoint_popup").css({display:"block",height:"135px"});n("#"+t._id+"MarkerLowPoint ul li").append(n("#"+i+"_MarkerLowPoint_popup"));n("#"+i+"_MarkerLowPointWrapper").hide();t.XLRibbon._isSetModel=!1},_sparklineDesignTabUpdate:function(t){var r=this.XLObj,e=r.getSheet(r.getActiveSheetIndex()),i=r._id,u,f;u=e.shapeMngr.sparkline;r.model.showRibbon&&(f=n("#"+r._id+"_Ribbon").data("ejRibbon"),f.showTab(r._getLocStr("SPARKLINEDESIGN")),f._isCollapsed||f.option({selectedItemIndex:r.XLRibbon._getTabIndex("sparklinedesign")}),u[t].type=="Winloss"?(n("#"+i+"_Ribbon_SparklineDesign_Show_FirstPoint").ejCheckBox({enabled:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_LastPoint").ejCheckBox({enabled:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_HighPoint").ejCheckBox({enabled:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_LowPoint").ejCheckBox({enabled:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_NegativePoints").ejCheckBox({enabled:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_Markers").ejCheckBox({enabled:!1}),r.element.find("#"+r._id+"_Ribbon_sparklinedesign_Style_SparklineDesign_Style_MarkerColor").hide()):(n("#"+i+"_Ribbon_SparklineDesign_Show_FirstPoint").ejCheckBox({enabled:!0}),n("#"+i+"_Ribbon_SparklineDesign_Show_LastPoint").ejCheckBox({enabled:!0}),n("#"+i+"_Ribbon_SparklineDesign_Show_HighPoint").ejCheckBox({enabled:!0}),n("#"+i+"_Ribbon_SparklineDesign_Show_LowPoint").ejCheckBox({enabled:!0}),n("#"+i+"_Ribbon_SparklineDesign_Show_NegativePoints").ejCheckBox({enabled:!0}),n("#"+i+"_Ribbon_SparklineDesign_Show_Markers").ejCheckBox({enabled:!0}),r.element.find("#"+r._id+"_Ribbon_sparklinedesign_Style_SparklineDesign_Style_MarkerColor").show()),u[t].type=="Column"||u[t].type=="Winloss"?r.element.find("#markers").hide():r.element.find("#markers").show(),r.XLRibbon._isSetModel=!0,n("#"+i+"_Ribbon_SparklineDesign_Show_FirstPoint").data("ejCheckBox").option({checked:u[t].FirstPoint?!0:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_LastPoint").data("ejCheckBox").option({checked:u[t].LastPoint?!0:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_HighPoint").data("ejCheckBox").option({checked:u[t].HighPoint?!0:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_LowPoint").data("ejCheckBox").option({checked:u[t].LowPoint?!0:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_NegativePoints").data("ejCheckBox").option({checked:u[t].NegativePoints?!0:!1}),n("#"+i+"_Ribbon_SparklineDesign_Show_Markers").length&&n("#"+i+"_Ribbon_SparklineDesign_Show_Markers").data("ejCheckBox").option({checked:u[t].Markers?!0:!1}),r.XLRibbon._isSetModel=!1)},_toggleSparklineDesignTab:function(){var n=this.XLObj;n.XLRibbon._toggleContextualTab(n._getLocStr("SPARKLINEDESIGN"))},_undoForSparkline:function(n){var r=this.XLObj,e=r.getSheet(n.sheetIndex),o=r._dataContainer,t=e.shapeMngr.sparkline,f,i=r._getContent(n.sheetIndex).find("#"+n.id),u;switch(n.action){case"create":u=i;f=r.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"sparkline");f&&(u.remove(),t==u[0].id&&delete t[u[0].id],delete t[n.id],delete o.sheets[n.sheetIndex][n.rowIndex][n.colIndex]);n.action="remove";break;case"sparklinehighpoint":r._isUndo?i.ejSparkline({highPointColor:n.prev.sparklinehighpoint}):(i.ejSparkline({highPointColor:n.sparklinehighpoint}),t[n.id].HighPoint=!0,t[n.id].highPointColor=n.sparklinehighpoint);break;case"sparklinenegativepoint":r._isUndo?i.ejSparkline({negativePointColor:n.prev.sparklinenegativepoint}):(i.ejSparkline({negativePointColor:n.sparklinenegativepoint}),t[n.id].NegativePoints=!0,t[n.id].negativePointColor=n.sparklinehighpoint);break;case"sparklinelowpoint":r._isUndo?i.ejSparkline({lowPointColor:n.prev.sparklinelowpoint}):(i.ejSparkline({lowPointColor:n.sparklinelowpoint}),t[n.id].LowPoint=!0,t[n.id].lowPointColor=n.sparklinelowpoint);break;case"sparklinefirstpoint":r._isUndo?i.ejSparkline({startPointColor:n.prev.sparklinefirstpoint}):(i.ejSparkline({startPointColor:n.sparklinefirstpoint}),t[n.id].FirstPoint=!0,t[n.id].startPointColor=n.sparklinefirstpoint);break;case"sparklinelastpoint":r._isUndo?i.ejSparkline({endPointColor:n.prev.sparklinelastpoint}):(i.ejSparkline({endPointColor:n.sparklinelastpoint}),t[n.id].LastPoint=!0,t[n.id].endPointColor=n.sparklinelastpoint);break;case"sparklinetype":r._isUndo?this.changeType(n.id,n.prev.sparklineType,n.sheetIndex):this.changeType(n.prev.sparklineId,n.sparklineType,n.sheetIndex);break;case"sparklinecolor":r._isUndo?i.ejSparkline({fill:n.prev.sColor}):(i.ejSparkline({fill:n.sColor}),t[n.id].sparklineColor=!0,t[n.id].sparklineColor=n.sColor);break;case"remove":this.createSparkline(n.DataRange,n.LocationRange,n.sparklineType,{highPointColor:n.highPointColor,lowPointColor:n.lowPointColor,NegativePointColor:n.NegativePointColor,startPointColor:n.startPointColor,endPointColor:n.endPointColor});n.action="create";break;case"markerSettings":n.isVisible?(t[n.id].Markers=!0,t[n.id].markerSettings={visible:!0},i.ejSparkline({markerSettings:{visible:!0}})):(t[n.id].Markers=!1,t[n.id].markerSettings={visible:!1},i.ejSparkline({markerSettings:{visible:null}}));n.isVisible=!n.isVisible}},changeType:function(n,t,i){var u=this.XLObj,e,f,r,o;i=u.getActiveSheetIndex();e=u.getSheet(i);o=u._getContent(i).find("#"+n);r=e.shapeMngr.sparkline[n];o.remove();delete u._dataContainer.sheets[i][r.rowIndex][r.colIndex];r.type=t;r.id=u._id+"_S"+i+"_"+t+"_"+r.rowIndex+"_"+r.colIndex;this._createSparkline(r,r.cellInfo,i);delete e.shapeMngr.sparkline[n];u.XLShape._updateShapeMngr({rowIndex:r.rowIndex,colIndex:r.colIndex},{sparkline:r},"sparkline");f={sheetIndex:i,reqType:"sparkline",action:"sparklinetype",id:r.id,cellInfo:r.cellInfo,rowIndex:r.rowIndex,colIndex:r.colIndex,dataSource:r.dataSource};f.prev={sparklineType:r.sparklineType,sparklineId:n};f.sparklineType=t;u._completeAction(f);u._trigActionComplete(f)},changePointColor:function(t,i,r,u){var c=this.XLObj,a,e,f,s,o,h,l;r=r||c.getActiveSheetIndex();a=c.getSheet(r);s=c._getContent(r).find("#"+t);f=a.shapeMngr.sparkline;for(h in i)o=i[h];switch(h){case"highPointColor":e={sheetIndex:r,reqType:"sparkline",action:"sparklinehighpoint",id:t};e.prev=f[t].type.toLowerCase()=="line"?{sparklinehighpoint:s.data("ejSparkline").model.stroke}:{sparklinehighpoint:f[t][h]};u?(f[t].HighPoint=!0,f[t].highPointColor=o):(delete f[t].HighPoint,delete f[t].highPointColor,i={highPointColor:null});s.ejSparkline(i);e.sparklinehighpoint=o;break;case"lowPointColor":e={sheetIndex:r,reqType:"sparkline",action:"sparklinelowpoint",id:t};e.prev=f[t].type.toLowerCase()=="line"?{sparklinelowpoint:s.data("ejSparkline").model.stroke}:{sparklinelowpoint:f[t][h]};u?(f[t].LowPoint=!0,f[t].lowPointColor=o):(delete f[t].LowPoint,delete f[t].lowPointColor,i={lowPointColor:null});s.ejSparkline(i);e.sparklinelowpoint=o;break;case"startPointColor":e={sheetIndex:r,reqType:"sparkline",action:"sparklinefirstpoint",id:t};e.prev={sparklinefirstpoint:s.data("ejSparkline").model.stroke};u?(f[t].FirstPoint=!0,f[t].startPointColor=o):(delete f[t].FirstPoint,delete f[t].startPointColor,i={startPointColor:null});s.ejSparkline(i);e.sparklinefirstpoint=o;break;case"endPointColor":e={sheetIndex:r,reqType:"sparkline",action:"sparklinelastpoint",id:t};e.prev={sparklinelastpoint:s.data("ejSparkline").model.stroke};u?(f[t].LastPoint=!0,f[t].endPointColor=o):(delete f[t].LastPoint,delete f[t].endPointColor,i={endPointColor:null});s.ejSparkline(i);e.sparklinelastpoint=o;break;case"negativePointColor":e={sheetIndex:r,reqType:"sparkline",action:"sparklinenegativepoint",id:t};e.prev=f[t].type.toLowerCase()=="line"?{sparklinenegativepoint:s.data("ejSparkline").model.stroke}:{sparklinenegativepoint:f[t][h]};u?(f[t].NegativePoints=!0,f[t].negativePointColor=o):(delete f[t].NegativePoints,delete f[t].negativePointColor,i={negativePointColor:null});s.ejSparkline(i);e.sparklinenegativepoint=o;break;case"fill":f[t].sparklinecolor=!0;e={sheetIndex:r,reqType:"sparkline",action:"sparklinecolor",id:t};e.sColor=o;f[t].type.toLowerCase()=="line"?(f[t].stroke=o,e.prev={sColor:s.data("ejSparkline").model.stroke},s.ejSparkline("option",{stroke:o})):(f[t][h]=o,e.prev={sColor:s.data("ejSparkline").model.fill},s.ejSparkline("option",{fill:o}));break;case"markerSettings":e={sheetIndex:r,reqType:"sparkline",action:"markerSettings",id:t,isVisible:f[t].Markers};f[t].type=="Line"&&(u?(l={visible:!0},n("#"+t).ejSparkline("option",{markerSettings:{visible:!0}}),f[t].Markers=!0):(l={visible:!1},n("#"+t).ejSparkline("option",{markerSettings:{visible:null}}),f[t].Markers=!1),f[t].markerSettings=l)}c._completeAction(e);c._trigActionComplete(e)},_sparklineResize:function(n,t,i){var f=this.XLObj,r,u,e=f._getContent(i).find("#"+n);e.css(t);r=e.data("ejSparkline");r.model.size=t;r.resize();u=f.getSheet(i).shapeMngr.sparkline;u[n].cellInfo.width=t.width;u[n].cellInfo.height=t.height},_clearSparkline:function(n){var t=this.XLObj;t.XLSelection._clearBorder(n);t.getSheet(t.getActiveSheetIndex())._isSparklineBorder=!1},refreshSparkline:function(n,t,i){for(var r=this.XLObj,o,c=!1,l,a,u,s,f,h=1,y=r.model.sheetCount+1,e,v;h<y;){if(o=r.getSheet(h).shapeMngr.sparkline,s=r.getObjectLength(o),s)while(s--)if(f=o[r.getObjectKeys(o)[s]],a=r.getRangeIndices(f.DataRange),h===i&&this.XLObj.inRange(a,n,t)){for(u=r.getRangeData({range:a,valueOnly:!0,sheetIdx:f.sheetIndex,skipFormula:!0}),e=0,v=u.length;e<v;e++)if(l=u[e],l=="")u[e]=0;else if(typeof l=="string"){c=!0;break}c?(r._showAlertDlg("Alert","SparklineDataAlert",630),c=!1):(r._getContent(i).find("#"+f.id).ejSparkline({dataSource:u}),f.dataSource=u)}h++}},_refreshContentWithSparkline:function(t){for(var i=this.XLObj,r,h,c={},l=n.extend(!0,{},i.getSheet(t).shapeMngr.sparkline),f=i.getObjectKeys(l),e,o,u=0,s=f.length;u<s;u++)r=l[f[u]],i._copySheet&&(delete i.getSheet(t).shapeMngr.sparkline[f[u]],e=f[u].replace(i._id,"").split("_"),e[0]=i._id,e[1]="S"+t,o=e.join("_"),r.id=o,c[o]=r,i._dataContainer.sheets[t][r.rowIndex][r.colIndex].sparkline=[o]),i._isRowViewable(t,r.rowIndex)&&(i._getContent(t).find("#"+r.id).length||(h=i._getCellInfo({rowIndex:r.rowIndex,colIndex:r.colIndex},t),this._createSparkline(r,h,t)));i._copySheet&&(i.getSheet(t).shapeMngr.sparkline=c)},_renderSparklineContent:function(t,i){for(var u=this.XLObj,r,h=u.getSheet(i).shapeMngr.sparkline,c=u.getObjectKeys(h),l,f,e,o,s=0,a=c.length;s<a;s++)r=h[c[s]],e=r.rowIndex,o=r.colIndex,l=t.rows[e].cells[o],f=n("<div id='"+u._id+"_S"+i+"_"+r.type+"_"+e+"_"+o+"' class='e-ss-sparkline'  style='height:"+(r.height-1)+"px; width:"+r.width+"px;' ><\/div>"),n(l).append(f),n(t).find("#"+f[0].id).ejSparkline(r)},_refreshSparklinePos:function(t,i){var u=this.XLObj,f,h,e,r,o,s;for(i=i||u._getSheetIndex(i),s=u._getContent(i).find(".e-ss-sparkline"),t=t||{},f=0,h=s.length;f<h;f++)(o=n(s[f]),r=u._getCellIdx(n(o[0]).parents("td")[0]),r.rowIndex<t.rowIndex||r.colIndex<t.colIndex)||(e=u._getCellInfo({rowIndex:r.rowIndex,colIndex:r.colIndex},i),o.css({top:e.top+"px",left:e.left+"px"}))},_refreshSparklineForInsDel:function(t,i,r,u,f,e){var s=this.XLObj,h,c,o;s._checkIndicesInContainer(e,t,i,"sparkline")&&(c=s.XLEdit.getPropertyValue(t,i,"sparkline",e)[0],h=n.extend(!0,{},s.getSheet(e).shapeMngr.sparkline[c]),o=c.replace(s._id,"").split("_"),u==="row"?o[3]=f==="insert"?parseInt(o[3])+r:parseInt(o[3])-r:o[4]=f==="insert"?parseInt(o[4])+r:parseInt(o[4])-r,o[0]=s._id,o=o.join("_"),h.id=o,h.rowIndex=t,h.colIndex=i,delete s.getSheet(e).shapeMngr.sparkline[c],s.getSheet(e).shapeMngr.sparkline[o]=h,s._dataContainer.sheets[e][t][i].sparkline=[o])},_refreshSparklineClipboard:function(t,i,r,u,f){var e=this.XLObj,s=e.XLEdit.getPropertyValue(t,i,"sparkline",r)[0],h=n.extend(!0,{},e.getSheet(u).shapeMngr.sparkline[s]),o,c;h=e.XLClipboard._copyBackup.sparkline&&e.XLClipboard._copyBackup.sparkline[s]?e.XLClipboard._copyBackup.sparkline[s]:n.extend(!0,{},e.getSheet(u).shapeMngr.sparkline[s]);o=s.replace(e._id,"").split("_");o[0]=e._id;o[1]="S"+r;o[3]=t;o[4]=i;o=o.join("_");h.id=o;h.rowIndex=t;h.colIndex=i;e.getSheet(r).shapeMngr.sparkline[o]=h;e._dataContainer.sheets[r][t][i].sparkline=[o];e._isRowViewable(r,t)&&(e._getContent(r).find("#"+o).length||(c=e._getCellInfo({rowIndex:t,colIndex:i},r),this._createSparkline(h,c,r)));f||delete e.getSheet(u).shapeMngr.sparkline[s]},_removeSparklineElem:function(n,t,i,r){var u=this.XLObj,f=u.XLEdit.getPropertyValue(n,t,"sparkline",i),e,o;f&&(f=f[0],e=u._getContent(i).find("#"+f),e.ejSparkline("destroy"),this._wireSparklineEvents("_off"),o={sheetIndex:i,reqType:"sparkline",shapeType:"sparkline",action:"remove"},u._completeAction(o),u._trigActionComplete(o),e.remove(),r&&(delete u._dataContainer.sheets[i][n][t].sparkline,delete u.getSheet(i).shapeMngr.sparkline[f]))},_wireSparklineEvents:function(t){var i=this.XLObj,r=i.element;i[t](r,n.isFunction(n.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",".e-ss-sparkline",i._dblClickHandler);i[t](n("#svg"),n.isFunction(n.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler);i[t](n("#rect"),n.isFunction(n.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler);i[t](n("#path"),n.isFunction(n.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler);i[t](n("#circle"),n.isFunction(n.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler)}}}(jQuery,Syncfusion)});
