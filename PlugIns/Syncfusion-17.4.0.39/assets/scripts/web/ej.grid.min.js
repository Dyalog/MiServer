/*!
*  filename: ej.grid.min.js
*  version : 17.4.0.39
*  Copyright Syncfusion Inc. 2001 - 2019. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.globalize.min","jsrender","jquery-validation","./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.button.min","./ej.checkbox.min","./ej.menu.min","./ej.waitingpopup.min","./ej.radiobutton.min","./ej.autocomplete.min","./ej.datepicker.min","./ej.datetimepicker.min","./ej.dropdownlist.min","./ej.dialog.min","./ej.editor.min","./ej.pager.min","./ej.toolbar.min","./ej.excelfilter.min"],n):n()})(function(){(function(n,t,i){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.common={refreshContent:function(n){n&&(this.refreshTemplate(),this._isLocalData&&this.refreshHeader());this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&this._renderFilterBarTemplate();var i={};this._initialRenderings();i.requestType=t.Grid.Actions.Refresh;i.templateRefresh=t.isNullOrUndefined(n)?!1:n;this.model.scrollSettings.enableVirtualization&&(this._refreshVirtualViewData(),this._virtualDataRefresh=!0);this._processBindings(i)},refreshData:function(t){if(this._isRemoteSaveAdaptor&&this._dataManager.dataSource.url!=i){var r=this;n.ajax({url:r.model.dataSource.dataSource.url,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({value:t}),dataType:"json",cache:!1,success:function(n){r._dataManager.dataSource.json=n;r.dataSource(r._dataManager)}})}else this.refreshContent()},rowHeightRefresh:function(){var i,s,h,f,o;if(this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(this.model.currentViewData)&&this.model.currentViewData.length){var r=this.getContentTable().get(0).rows,e=this.getContentTable().get(1).rows,u=0;if(this.getContent().find(".e-frozencontentdiv").is(":visible")){for(i=0;i<r.length;i++)n(r[i]).css("display")!="none"&&(this._isResized&&(r[i].style.height="",e[i].style.height=""),s=r[i].getClientRects()[0].height,h=e[i].getClientRects()[0].height,u=t.isNullOrUndefined(s)||t.isNullOrUndefined(h)?t.max([r[i].offsetHeight,e[i].offsetHeight]):t.max([s,h]),n(r[i]).height(u),n(e[i]).height(u),i&&(i==this.model.scrollSettings.frozenRows-1||i==r.length-1)&&(u=u+1),this.model.allowTextWrap||i&&i!=this.model.scrollSettings.frozenRows-1||(u=u-1),this.model.isEdit&&n(r[i]).find("#"+this._id+"EditForm").length&&i&&(n(r[i]).find("#"+this._id+"EditForm td").css("height",u),n(e[i]).find("#"+this._id+"EditForm td").css("height",u)));this._isResized=!1}if(this.model.showSummary&&this.model.summaryRows.length>0&&this.element.children(".e-gridfooter").length){var c=t.isNullOrUndefined(this.getFooterTable())?[]:this.getFooterTable().get(0).rows,a=t.isNullOrUndefined(this.getFooterTable())?[]:this.getFooterTable().get(1).rows,l=0;for(f=0;f<c.length;f++)l=t.max([c[f].getClientRects()[0].height,a[f].getClientRects()[0].height]),n(c[f]).height(l),n(a[f]).height(l)}this._getRowHeights();!t.isNullOrUndefined(this.getContent().data("ejScroller"))&&(this.getScrollObject()._vScrollbar!=null||this.getScrollObject().isVScroll())&&(o=this.getScrollObject()._vScrollbar,(t.isNullOrUndefined(o)||o.value()!=o.model.maximum)&&this._scrollObject.refresh(this.model.scrollSettings.frozenColumns>0))}},dataSource:function(n,t){if(t&&(this._templateRefresh=!0),this._dataSource(n),this._currentPage(1),this.model.scrollSettings.enableVirtualization&&(this.model.pageSettings.totalPages=null,this._currentVirtualIndex=1,this.getContent().ejScroller("isVScroll")&&this.getContent().ejScroller("scrollY",0,!0)),this._updateDataSource=!0,this._refreshDataSource(n,t),this.model.allowPaging||this.model.scrollSettings.allowVirtualScrolling){var i=this._refreshVirtualPagerInfo();this._showPagerInformation(i)}this.model.scrollSettings.allowVirtualScrolling&&(this.model.scrollSettings.enableVirtualization&&this._isLocalData?this._refreshVirtualView():this._refreshVirtualContent(),this.getContent().ejScroller("isHScroll")&&this.getContent().ejScroller("scrollX",0,!0),this.getContent().ejScroller("isVScroll")?(this.model.scrollSettings.enableVirtualization||this.getContent().ejScroller("scrollY",0,!0),this.element.find(".e-gridheader").addClass("e-scrollcss")):this.element.find(".e-gridheader").removeClass("e-scrollcss"));(!this.model.scrollSettings.enableVirtualization||this._gridRows.length<this._virtualRowCount)&&this._addLastRow();this._trigger("dataBound",{})},_refreshDataSource:function(n,i){this._dataManager=n instanceof t.DataManager?n:t.DataManager(n);this._isRemoteSaveAdaptor=this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.remoteSaveAdaptor;this._isLocalData=!(this._dataSource()instanceof t.DataManager)||this._dataManager.dataSource.offline||this._isRemoteSaveAdaptor||this._dataSource().adaptor instanceof t.ForeignKeyAdaptor;this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(this._refreshVirtualViewData(),this._virtualDataRefresh=!0,this._isLocalData&&this._refreshVirtualViewDetails(!0));this.refreshContent(t.isNullOrUndefined(i)?!0:i)},_hideRowTemplateColumns:function(t,i){var r=n.inArray(t,this.model.columns);this.getContentTable().find("tbody:first > tr").find("> td:nth-child("+(r+1)+")")[i=="hide"?"addClass":"removeClass"]("e-hide")},hideColumns:function(i){var b=0,h={},u,s,g=[],nt,v,k=0,y,r,p,o,l,a,d,w;nt=typeof i=="string"?this.getColumnByHeaderText(i):this.getColumnByHeaderText(i[0]);s=typeof i=="number"?this.getColumnByIndex(i):this.getColumnByIndex(i[0]);v=typeof i=="string"?this.getColumnByField(i):this.getColumnByField(i[0]);this._showHideColumns=!0;y=[];n.map(this.model.columns,function(n){y.push(n.headerText)});var c=this._isDuplicate(y),e=c?"_hiddenColumnsField":"_hiddenColumns",f=c?"_visibleColumnsField":"_visibleColumns";if(!c&&(v!=null||s!=null))if(n.isArray(i))for(r=0;r<i.length;r++)p=s!=null?this.getColumnByIndex(i[r]):this.getColumnByField(i[r]),i[r]=p!=null?p.headerText:i[r];else i=s!=null?s.headerText:v.headerText;if(o=s!=null?"getColumnByIndex":"getColumnByHeaderText",n.isArray(i))for(r=0;r<i.length;r++)u=n.inArray(i[r],this[f]),u!=-1?(this[e].push(i[r]),this[f].splice(u,1)):u==-1&&f=="_visibleColumnsField"&&n.inArray(i[r],this[e])==-1&&t.isNullOrUndefined(this.getColumnByField(i[r]))&&(this[e].push(this[o](i[r]).field)&&this._hiddenColumns.push(this[o](i[r]).field),this[f].splice(n.inArray(this[o](i[r]).field,this[f]),1)&&this._visibleColumns.splice(n.inArray(i[r],this._visibleColumns),1)),this.model.rowTemplate!=null&&(l=u!=-1?this.getColumnByHeaderText(i[r]):this[o](i[r]),this._hideRowTemplateColumns(l,"hide"));else u=n.inArray(i,this[f]),u!=-1?(this[e].push(i),this[f].splice(u,1)):u==-1&&f=="_visibleColumnsField"&&n.inArray(i,this[e])==-1&&t.isNullOrUndefined(this.getColumnByField(i))&&(this[e].push(this[o](i).field)&&this._hiddenColumns.push(this[o](i).field),this[f].splice(n.inArray(this[o](i).field,this[f]),1)&&this._visibleColumns.splice(n.inArray(i,this._visibleColumns),1)),this.model.rowTemplate!=null&&(l=u!=-1?this.getColumnByHeaderText(i):this[o](i),this._hideRowTemplateColumns(l,"hide"));for(r=0;r<this.model.columns.length;r++)if(a=c?"field":"headerText",n.inArray(t.isNullOrUndefined(this.model.columns[r][a])||this.model.columns[r][a]==""?this.model.columns[r].headerText:this.model.columns[r][a],this[e])!=-1&&(this.model.columns[r].visible&&g.push(this.model.columns[r]),this.model.columns[r].visible=!1,this.model.allowScrolling&&this.model.scrollSettings.frozenColumns>0&&this.model.columns.indexOf(this.model.columns[r])<this.model.scrollSettings.frozenColumns&&k++,b++),this[e].length==b)break;h.requestType="refresh";h.action="hideColumn";this._hideHeaderColumn(this[e],c);this.model.allowScrolling&&this.model.scrollSettings.frozenColumns>0&&(d=this._renderGridHeader(),this.element.find(".e-gridheader").replaceWith(d[0]),this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&this._renderFiltering(),this.model.allowReordering&&this._headerCellreorderDragDrop());this.refreshTemplate();this.model.scrollSettings.allowVirtualScrolling&&this._virtualShowHide(h);this._isAddNew&&this.model.isEdit&&(this.model.query=this.commonQuery.clone(),this._ensureDataSource(h),this._isAddNew=!1);this.sendDataRenderingRequest(h);this.rowHeightRefresh();this.model.allowScrolling&&(this.model.scrollSettings.frozenColumns!=0||t.isIOSWebView()||this.getBrowserDetails().browser!="msie"||(w=this._calculateWidth(),this.getHeaderTable().width(w),t.isNullOrUndefined(this.getFooterTable())||this.getFooterTable().width(w)),t.isNullOrUndefined(this._scrollObject)||this.getScrollObject().refresh());this.model.showColumnChooser&&this._refreshColumnChooserList();this.model.allowScrolling&&this.model.scrollSettings.frozenColumns>0&&(k==this.model.scrollSettings.frozenColumns&&this._frozenPaneRefresh(),this.getScrollObject().refresh());this._showHideColumns=!1},showColumns:function(i){var k=0,h={},s,v=[],g,y,p,w,o,l,a,b,u,r,d;g=typeof i=="string"?this.getColumnByHeaderText(i):this.getColumnByHeaderText(i[0]);s=typeof i=="number"?this.getColumnByIndex(i):this.getColumnByIndex(i[0]);y=typeof i=="string"?this.getColumnByField(i):this.getColumnByField(i[0]);this._showHideColumns=!0;p=[];n.map(this.model.columns,function(n){p.push(n.headerText)});var c=this._isDuplicate(p),f=c?"_hiddenColumnsField":"_hiddenColumns",e=c?"_visibleColumnsField":"_visibleColumns";if(!c&&(y!=null||s!=null))if(n.isArray(i))for(r=0;r<i.length;r++)w=s!=null?this.getColumnByIndex(i[r]):this.getColumnByField(i[r]),i[r]=w!=null?w.headerText:i[r];else i=s!=null?s.headerText:y.headerText;if(o=s!=null?"getColumnByIndex":"getColumnByHeaderText",n.isArray(i))for(r=0;r<i.length;r++)u=n.inArray(i[r],this[f]),u!=-1?(this[f].splice(u,1),this[e].push(i[r])):u==-1&&f=="_hiddenColumnsField"&&n.inArray(i[r],this[e])==-1&&t.isNullOrUndefined(this.getColumnByField(i[r]))&&(this[e].push(this[o](i[r]).field)&&this._visibleColumns.push(i[r]),this[f].splice(n.inArray(this[o](i[r]).field,this[f]),1)&&this._hiddenColumns.splice(n.inArray(i[r],this._hiddenColumns),1)),this.model.rowTemplate!=null&&(l=u!=-1?this.getColumnByHeaderText(i[r]):this[o](i[r]),this._hideRowTemplateColumns(l,"show"));else u=n.inArray(i,this[f]),u!=-1?(this[f].splice(u,1),this[e].push(i)):u==-1&&f=="_hiddenColumnsField"&&n.inArray(i,this[e])==-1&&t.isNullOrUndefined(this.getColumnByField(i))&&(this[e].push(this[o](i).field)&&this._visibleColumns.push(i),this[f].splice(n.inArray(this[o](i).field,this[f]),1)&&this._hiddenColumns.splice(n.inArray(i,this._hiddenColumns),1)),this.model.rowTemplate!=null&&(l=u!=-1?this.getColumnByHeaderText(i):this[o](i),this._hideRowTemplateColumns(l,"show"));for(r=0;r<this.model.columns.length;r++)if(a=c?"field":"headerText",n.inArray(t.isNullOrUndefined(this.model.columns[r][a])||this.model.columns[r][a]==""?this.model.columns[r].headerText:this.model.columns[r][a],this[e])!=-1&&(this.model.columns[r].visible||v.push(this.model.columns[r]),this.model.columns[r].visible=!0,k++),this[e].length==k)break;if(this.model.allowScrolling&&this.model.scrollSettings.frozenColumns>0){for(b=!1,r=0;r<v.length;r++)u=this.model.columns.indexOf(v[r]),u<this.model.scrollSettings.frozenColumns&&(b=!0);if(b){for(r=0;r<this.model.columns.length;r++)n.inArray(this.model.columns[r].headerText,this._hiddenColumns)!=-1?this.model.columns[r].visible=!1:n.inArray(this.model.columns[r].headerText,this._visibleColumns)!=-1&&(this.model.columns[r].visible=!0);d=this._renderGridHeader();this.element.find(".e-gridheader").replaceWith(d[0]);this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&this._renderFiltering();this.model.allowReordering&&this._headerCellreorderDragDrop()}}h.requestType="refresh";h.action="showColumn";this._showHeaderColumn(this[e],c);this.refreshTemplate();this.model.scrollSettings.allowVirtualScrolling&&this._virtualShowHide(h);this._isAddNew&&this.model.isEdit&&(this.model.query=this.commonQuery.clone(),this._ensureDataSource(h),this._isAddNew=!1);this.sendDataRenderingRequest(h);this.rowHeightRefresh();this.model.allowScrolling&&!t.isNullOrUndefined(this._scrollObject)&&this.getScrollObject().refresh();this.model.showColumnChooser&&this._refreshColumnChooserList();this._showHideColumns=!1},_virtualShowHide:function(n){this._currentPage(1);this.model.query=this.commonQuery.clone();this._ensureDataSource(n);this._loadedJsonData=[];this._prevPage=this._currentPage()},resizeColumns:function(n,i){var r,u;if(n instanceof Array)for(r=0;r<n.length;r++)u=i instanceof Array?i[r]:i,this._setWidthColumnCollection(n[r],u);else this._setWidthColumnCollection(n,i);this.setWidthToColumns();this.model.scrollSettings.frozenColumns&&(this._frozenAlign(),this.rowHeightRefresh());t.isNullOrUndefined(this.getFooterContent())||this._scrollFooterColgroup();this._refreshScroller({requestType:"refresh"})},_setWidthColumnCollection:function(t,i){var r=this.getColumnByHeaderText(t)||this.getColumnByField(t);r.width=i;n.inArray(r.field,this._disabledResizingColumns)==-1&&(this.columnsWidthCollection[n.inArray(r,this.model.columns)]=i)},refreshTemplate:function(){this.addInitTemplate();(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&this._processEditing();this.model.allowGrouping&&this.addGroupingTemplate()},refreshHeader:function(){var t=this.element.find(".e-gridheader"),n,i;this.element[0].replaceChild(this._renderGridHeader()[0],t[0]);this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&this._renderFiltering();this.model.allowGrouping&&this.model.groupSettings.showDropArea&&this._headerCellgDragDrop();this.model.allowReordering&&this._headerCellreorderDragDrop();this.model.showColumnChooser&&this._renderColumnChooserData(!0);this.model.gridLines!="both"&&this._showHeaderGridLines();this.model.mergeHeaderCellInfo!=null&&(this.setWidthToColumns(),n={columnHeaders:this.getHeaderContent().find(".e-columnheader"),model:this.model},i=this,this._headerCellMerge(n),this._trigger("mergeHeaderCellInfo",n));this.refreshScrollerEvent()},set_dropColumn:function(r,u){var b,k,p,ht,ct,lt,et,at,d,vt,g,it,e,l,f,s,ft;if(this.model.allowReordering&&r!=u){this.model.columns.splice(u,0,this.model.columns.splice(r,1)[0]);var o=this.model.columns,h=this.getHeaderTable().find(".e-columnheader:last .e-headercell").not(".e-stackedHeaderCell"),v=h.find(".e-headercelldiv"),yt=this.getHeaderContent().find("div").first().scrollLeft();(this.model.allowSorting&&this.model.sortSettings.sortedColumns.length||this.model.groupSettings.showToggleButton)&&(h.find("span.e-ascending").remove(),h.find("span.e-descending").remove(),h.find("span.e-gridgroupbutton").remove());this.model.allowSorting&&this.model.sortSettings.sortedColumns.length&&h.eq(r).find("span").remove();this.model.scrollSettings.frozenColumns||this.getHeaderTable().find("colgroup").replaceWith(this._getMetaColGroup());(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&this.getHeaderTable().find("colgroup").prepend(this._getIndentCol());b=function(t){var r=[],o,e,s;if(t!=i){["",i].indexOf(t.value)==-1&&(r.push({name:"value",value:t.value}),t.value="");t.hasAttribute("value")&&t.removeAttribute("value");for(var u=0,f=t.attributes,h=f.length;u<h;u++)o=/^jQuery[0-9]+$/,f[u].name.match(o)||r.push({name:f[u].name,value:f[u].value});for(e=0,s=r.length;e<s;e++)n(t).removeAttr(r[e].name);return r}};k=function(t,r){if(r!=i)for(var u=0,f=t.length;u<f;u++)t[u].name=="value"&&(r.value=t[u].value),n(r).attr(t[u].name,t[u].value)};this.getHeaderTable().find(".e-fltrtempdiv").length==0&&this.getHeaderTable().find(".e-filterdiv").length>0&&(p=this.getHeaderTable().find(".e-filterdiv input"));var tt=t.isNullOrUndefined(p),c={cellattributes:[],headerattributes:[],filtercellattributes:[],filterThattributes:[]},ot=r<u?r:u,st=r<u?u:r;for(f=ot,s=0;f<=st;f++)ht=this.model.detailsTemplate!=null||this.model.childGrid!=null?f+1:f,c.headerattributes[s]=b(h[ht]),c.cellattributes[s]=b(v[f]),c.filtercellattributes[s]=tt?[]:b(p[f]),c.filterThattributes[s]=tt?[]:b(n(p[f]).closest("th")[0]),s++;ct=r<u?c.cellattributes.length-1:0;lt=r<u?0:c.cellattributes.length-1;for(et in c)c[et].splice(ct,0,c[et].splice(lt,1)[0]);for(f=ot,s=0;f<=st;f++)at=this.model.detailsTemplate!=null||this.model.childGrid!=null?f+1:f,k(c.headerattributes[s],h[at]),k(c.cellattributes[s],v[f]),tt||k(c.filtercellattributes[s],p[f]),tt||k(c.filterThattributes[s],n(p[f]).closest("th")[0]),s++;if(this.model.allowFiltering&&["menu","excel"].indexOf(this.model.filterSettings.filterType)!=-1){for(this._$fDlgIsOpen&&this._closeFDialog(),d=this.model.columns,h.find(".e-filtericon").remove(),f=0;f<d.length;f++)(d[f].allowFiltering||t.isNullOrUndefined(d[f].allowFiltering))&&(vt=h.find('.e-headercelldiv[data-ej-mappingname="'+d[f].field+'"]').closest(".e-headercell"),vt.append(t.buildTag("div.e-filtericon e-icon e-filterset")));this._refreshFilterIcon()}for(this.columnsWidthCollection.splice(u,0,this.columnsWidthCollection.splice(r,1)[0]),this._fieldColumnNames=this._headerColumnNames=[],e=0;e<o.length;e++)this._fieldColumnNames[o[e].headerText]=o[e].field,this._headerColumnNames[o[e].field]=o[e].headerText,g=n(v[e]),it=n(h[e]),t.isNullOrUndefined(o[e].headerTemplateID)?o[e].type=="checkbox"&&t.isNullOrUndefined(o[e].headerText)?g.html("<input type = 'checkbox' class = 'e-checkselectall'><\/input>"):o[e].disableHtmlEncode?g.text(o[e].headerText):g.html(o[e].headerText):g.html(n(o[e].headerTemplateID).html()),this.model.groupSettings.showToggleButton&&(t.isNullOrUndefined(o[e].allowGrouping)||o[e].allowGrouping)&&(n.inArray(o[e].field,this.model.groupSettings.groupedColumns)!=-1?it.append(this._getToggleButton().addClass("e-toggleungroup")):it.append(this._getToggleButton().addClass("e-togglegroup")),l=this.getHeaderTable().find("thead tr:not('.e-stackedHeaderRow')").find(".e-headercell").not(".e-detailheadercell").find(".e-filterset"),l.addClass("e-groupfiltericon"),this.model.enableRTL&&!l.length&&it.find(".e-togglegroupbutton").addClass("e-rtltoggle"));if(this.model.allowGrouping&&this.model.allowSorting!=!0)for(f=0;f<this.model.sortSettings.sortedColumns.length;f++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[f].field,this.model.sortSettings.sortedColumns[f].direction);if(this.model.allowSorting)for(f=0;f<this.model.sortSettings.sortedColumns.length;f++){var rt=1,y=this.model.sortSettings.sortedColumns[f],pt=this.getsortColumnByField(y.field),a=this.getColumnIndexByField(y.field),wt=n.inArray(pt,this.model.sortSettings.sortedColumns),ut=y.direction!="descending"?"e-rarrowup-2x":"e-rarrowdown-2x";if(this.model.allowMultiSorting){for(s=1;s<=wt;s++)rt=rt+1;v.eq(a).css("text-align")=="right"?(this.model.sortSettings.sortedColumns.length>1&&v.eq(a).prepend(this._createSortNumber(rt,v.eq(a)).addClass("e-sortnumber")),h.eq(a).append(this._createSortElement().addClass("e-"+(y.direction||"ascending")+" "+ut))):(h.eq(a).append(this._createSortElement().addClass("e-"+(y.direction||"ascending")+" "+ut)),this.model.sortSettings.sortedColumns.length>1&&v.eq(a).append(this._createSortNumber(rt,v.eq(a)).addClass("e-sortnumber")))}else ut=y.direction!="descending"?"e-rarrowup-2x":"e-rarrowdown-2x",h.eq(a).append(this._createSortElement().addClass("e-"+(y.direction||"ascending")+" "+ut));var w=this.getHeaderTable().find("thead tr:not('.e-stackedHeaderRow')").find(".e-headercell").not(".e-detailheadercell").eq(a),l=w.find(".e-filterset"),nt=w.find(".e-gridgroupbutton");l.addClass("e-sortfiltericon");this.model.groupSettings.showToggleButton&&(l.addClass("e-sortfiltergroupicon"),nt.addClass("e-togglesortgroupfilter"),this.model.enableRTL&&l.length&&w.find(".e-ascending,.e-descending").addClass("e-rtlsortfiltertoggle"));this.model.enableRTL?l.length&&nt.length||l.length||nt.length?l.length&&nt.length||w.find(".e-ascending,.e-descending").addClass("e-rtlgrouporfilter"):w.find(".e-ascending,.e-descending").addClass("e-rtlsortadjust"):this.model.enableRTL||l.length||nt.length||w.find(".e-ascending,.e-descending").addClass("e-sortadjust")}this.getHeaderTable().find(".e-fltrtempdiv").length>0&&(this.getHeaderTable().find(".e-filterbar").first().remove(),this._renderFiltering(),this._renderFilterBarTemplate());ft={};ft.requestType=t.Grid.Actions.Reorder;this._isReorder=!0;this.refreshTemplate();this._isAddNew&&this.model.isEdit&&(this.model.query=this.commonQuery.clone(),this._ensureDataSource(ft),this._isAddNew=!1);this.setWidthToColumns();this.model.scrollSettings.frozenColumns||this.getHeaderContent().find("div").first().scrollLeft(yt);this.sendDataRenderingRequest(ft);this._isReorder=!1}},getPager:function(){return this._gridPager},getFooterTable:function(){return this._gridFooterTable},setGridFooterTable:function(n){this._gridFooterTable=n},getFooterContent:function(){return this._gridFooterContent},setGridFooterContent:function(n){this._gridFooterContent=n},getScrollObject:function(){return(this._scrollObject==null||t.isNullOrUndefined(this._scrollObject.model))&&(this._scrollObject=this.getContent().ejScroller("instance")),this._scrollObject},setGridPager:function(n){this._gridPager=n},getRowHeight:function(){var r=-1,i,f,u,o;if(this.getContentTable()!=null)i=this.getContentTable().find("tr:not(.e-virtualrow)"),f=i.length>2?1:0,i.length&&(u=i[f].getBoundingClientRect()),i.length>1&&(r=u&&u.height?u.height:i[f].offsetHeight);else if(!t.isNullOrUndefined(this.model.rowTemplate)&&!t.isNullOrUndefined(this._dataSource())&&this._dataSource().length>0){var e=document.createElement("div"),s=n.templates(this.model.rowTemplate),h=this._dataSource()[0];e.innerHTML=['<table class="e-template-table">',s.render(h),"<\/table>"].join("");n("body").append(e.firstChild);o=n("body").find(".e-template-table").find("tr")[0];r=o.offsetHeight;n("body").find(".e-template-table").remove()}return r==-1?32:r},getCurrentIndex:function(){return(this._currentPage()-1)*this.model.pageSettings.pageSize},getColumnByIndex:function(n){return n<this.model.columns.length?this.model.columns[n]:null},set_currentPageIndex:function(n){var i=this.model.pageSettings,u=this.model.filterSettings.filteredColumns.length==0?this._searchCount==null?this._gridRecordsCount:this._searchCount:this._filteredRecordsCount,r;return(i.totalPages==null&&(i.totalPages=Math.ceil(u/i.pageSize)),n>i.totalPages||n<1||n==this._currentPage())?!1:(t.isNullOrUndefined(this._prevPageNo)&&(this._prevPageNo=this._currentPage()),this._currentPage(n),this._currentPage()!=this._prevPageNo?(r={},r.requestType="paging",this.gotoPage(this._currentPage(),r),!0):!1)},set_currentVirtualIndex:function(n){var t,i;return n<1||n!=1&&n!=this._totalVirtualViews&&n==this._currentVirtualIndex&&this._checkCurrentVirtualView(this._virtualLoadedRows,n)?!1:(this._prevVirtualIndex=this._currentVirtualIndex,this._currentVirtualIndex=n,t=this._calculateCurrentViewPage(),t<=this.model.pageSettings.totalPages&&!this._checkCurrentVirtualView(this._virtualLoadedRecords,this._currentVirtualIndex)?this._prevVirtualIndex<n&&n!=1?(i=this._isThumbScroll&&t!=1?t:t+1,!this._virtualPageRecords[i]&&i<=this.model.pageSettings.totalPages?this._setCurrentViewPage(i):this._renderVirtulViewContent(t)):this._prevVirtualIndex>n?(i=this._isThumbScroll?t:t-1,this._virtualPageRecords[i]&&!this._virtualLoadedRecords[n-1]&&(i=t-1),!this._virtualPageRecords[i]&&i>=1&&this._setCurrentViewPage(i)):this._renderVirtulViewContent(t):this._renderVirtulViewContent(t),!0)},_setCurrentViewPage:function(n){this._needPaging=!0;this._prevPageNo=this._currentPage();this.gotoPage(n)},_renderVirtulViewContent:function(){this._needPaging=!1;this._refreshVirtualView(this._currentVirtualIndex);this.element.ejWaitingPopup("hide")},_checkCurrentVirtualView:function(t,i){var f=this._virtualRowCount,u=i-1,r=i+1,e;if(t instanceof Array){if(t.length&&((u==0||r==this._totalVirtualViews+1)&&n.inArray(i,t)!=-1||n.inArray(u,t)!=-1&&n.inArray(i,t)!=-1&&n.inArray(r,t)!=-1))return!0}else if(e=r==this._totalVirtualViews?this._lastViewData:f,!this.initialRender&&i==1&&this._virtualLoadedRows[i]||i==this._totalVirtualViews&&t==this._virtualLoadedRows&&t[i]||u==0&&t[i]&&t[i].length==f||r==this._totalVirtualViews+1&&t[i]&&t[i].length==this._lastViewData||t[u]&&t[u].length==f&&t[i]&&t[i].length==f&&t[r]&&t[r].length==e)return!0;return!1},expandCollapse:function(r){var v,b,k,d,l,g,e,a,w,it,o,s,h,u;if(r.prop("tagName")=="DIV"&&(r.parent().hasClass("e-recordplusexpand")||r.parent().hasClass("e-recordpluscollapse")||r.parent().hasClass("e-detailrowcollapse")||r.parent().hasClass("e-detailrowexpand"))&&(r=r.parent()),v=-1,this.model.allowGrouping&&(t.isOnWebForms||this.initialRender))for(b=r.attr("data-ej-mappingname"),k=r.attr("data-ej-mappingvalue"),r.parents(".e-tabletd").length&&(d=r.parents(".e-tabletd").parent("tr").prev("tr").find(".e-recordplusexpand").attr("data-ej-mappingvalue")),l=this.model._groupingCollapsed,u=0;u<l.length;u++)if(l[u].key==b&&l[u].value==k&&(l[u].parent==i||l[u].parent==d)){v=u;break}if(r.hasClass("e-recordplusexpand")||r.hasClass("e-recordpluscollapse")||r.hasClass("e-detailrowcollapse")||r.hasClass("e-detailrowexpand")){if(r.hasClass("e-recordplusexpand")&&this.model.groupSettings.groupedColumns.length)g=r.index(),e=r.closest("tr").next(),e.hide(),r.removeClass("e-recordplusexpand").addClass("e-recordpluscollapse").find("div").removeClass("e-gdiagonalnext").addClass("e-gnextforward"),(t.isOnWebForms||this.initialRender)&&v==-1&&this.model._groupingCollapsed.push({key:b,value:k,parent:d});else if(r.hasClass("e-recordpluscollapse")&&this.model.groupSettings.groupedColumns.length){var g=r.index(),e=r.closest("tr").next(),o=[],s=e;for(n(s[0].cells[g]).hasClass("e-indentcell")&&s.children(".e-indentcell").length==r.parent().children(".e-indentcell").length+1&&(s.show(),h=s.children(".e-recordplusexpand"),h!=null&&h.length>0&&o.push(h)),r.removeClass("e-recordpluscollapse").addClass("e-recordplusexpand").find("div").removeClass("e-gnextforward").addClass("e-gdiagonalnext"),u=0;u<o.length;u++)o[u].removeClass("e-recordplusexpand").addClass("e-recordpluscollapse").find("div").removeClass("e-gdiagonalnext").addClass("e-gnextforward"),this.expandCollapse(o[u]);(t.isOnWebForms||this.initialRender)&&v!=-1&&this.model._groupingCollapsed.splice(v,1)}else if(r.hasClass("e-detailrowexpand")){var g=r.index(),f=this,y=this.getIndexByRow(r.closest("tr")),e=r.closest("tr").next();e.hide(0,function(){var n={masterRow:r.closest("tr"),detailsRow:e,masterData:f._currentJsonData[y]},i=f._getForeignKeyData(n.masterData);t.isNullOrUndefined(i)||(n.foreignKeyData=i);f._trigger("detailsCollapse",n)});(f.model.childGrid!=null||f.model.detailsTemplate!=null)&&f.model.allowScrolling&&f._refreshScroller({requestType:"refresh"});r.removeClass("e-detailrowexpand").addClass("e-detailrowcollapse").find("div").addClass("e-gnextforward").removeClass("e-gdiagonalnext")}else if(r.hasClass("e-detailrowcollapse")){var g=r.index(),f=this,y=this.getIndexByRow(r.closest("tr")),nt=r.closest("tr").next();if(nt.hasClass("e-detailrow"))e=nt;else{var c=t.buildTag("tr.e-detailrow","",{display:"none"},{}),rt=t.buildTag("td.e-detailindentcell"),tt=t.buildTag("td.e-detailcell","",{},{colspan:this._visibleColumns.length}),p=t.buildTag("div"),ut=n(r.closest("tr")).parents(".e-grid").length;p.attr("id","child"+ut+"_grid"+y+Math.round(Math.random()*1e3));n(c).append(rt);n(c).append(tt);a=this._currentJsonData[y];this.model.detailsTemplate&&(w=this.model.detailsTemplate,it=!t.isNullOrUndefined(this.model.ngTemplateId)&&(w.startsWith("#")||w.startsWith(".")||typeof w=="object")?this.model.ngTemplateId+"griddetailstemplate":null,n(c).append(tt.append(this._renderEjTemplate(this.model.detailsTemplate,a,y,null,it))));n(r.closest("tr")).after(c);this.model.childGrid&&(this.model.childGrid.parentDetails={parentID:this._id,parentPrimaryKeys:this.getPrimaryKeyFieldNames(),parentKeyField:this.model.childGrid.queryString,parentKeyFieldValue:a[this.model.childGrid.queryString],parentRowData:a},n(c).append(tt.append(p)));e=c}for(this._showGridLines(),o=[],s=e,n(s[0].cells[g]).hasClass("e-detailindentcell")&&(s.show(0,function(){var n={masterRow:r.closest("tr"),detailsRow:e,masterData:f._currentJsonData[y]},i=f._getForeignKeyData(n.masterData);t.isNullOrUndefined(i)||(n.foreignKeyData=i);f._trigger("detailsExpand",n)}),nt.hasClass("e-detailrow")||(this._trigger("detailsDataBound",{detailsElement:c,data:a,rowData:a}),this._trigger("refresh")),this.model.childGrid&&!t.isNullOrUndefined(p)&&p.ejGrid(this.model.childGrid),(f.model.childGrid!=null||f.model.detailsTemplate!=null)&&f.model.allowScrolling&&f._refreshScroller({requestType:"refresh"}),h=s.children(".e-detailrowexpand"),h!=null&&h.length>0&&o.push(h)),r.removeClass("e-detailrowcollapse").addClass("e-detailrowexpand").find("div").addClass("e-gdiagonalnext").removeClass("e-gnextforward"),u=0;u<o.length;u++)o[u].removeClass("e-detailrowexpand").addClass("e-detailrowcollapse").find("div").removeClass("e-gdiagonalnext").addClass("e-gnextforward"),this.expandCollapse(o[u])}!this.model.allowScrolling||t.isNullOrUndefined(this._scrollObject&&this._scrollObject.model)||r.closest(".e-hscroll").length||this.getScrollObject().refresh();this.model.isResponsive&&this.windowonresize()}},_refreshGridPager:function(){var i,n,r;this.getPager()!=null&&(i=this.getPager().ejPager("model"),n={},n.currentPage=this._currentPage(),(t.isNullOrUndefined(this._filteredRecordsCount)||this._filteredRecordsCount==0)&&this.model.currentViewData!=null&&this.model.currentViewData.length==0&&(t.isNullOrUndefined(this._prevPageNo)||this._prevPageNo)?(n.currentPage=0,this._prevPageNo=i.currentPage,this.model.pageSettings.currentPage=0):i.currentPage==0&&(t.isNullOrUndefined(this._prevPageNo)||this._prevPageNo)&&(n.currentPage=this._prevPageNo),r=this.model.editSettings.showAddNewRow&&this.model.groupSettings.groupedColumns.length==0?1:0,n.totalRecordsCount=this.model.filterSettings.filteredColumns.length==0?this._searchCount==null?this._gridRecordsCount-r:this._searchCount:this._filteredRecordsCount,n.totalRecordsCount==0&&n.currentPage!=0&&(n.currentPage=0,this.model.pageSettings.currentPage=0),t.util.isNullOrUndefined(n.currentPage)&&(n.currentPage=this._currentPage()),this.getPager().ejPager("option",n).ejPager("refreshPager"),this.model.pageSettings.totalPages=i.totalPages||null,this.model.pageSettings.totalRecordsCount=i.totalRecordsCount||null)},_showHeaderColumn:function(i,r){for(var u,o,a,s,h=this.getHeaderTable().find("thead"),c=h.find("tr").not(".e-stackedHeaderRow").find(".e-headercell"),v=h.find(".e-filterbar").find(".e-filterbarcell"),e=this.getHeaderTable().find("colgroup").find("col"),l,f=0;f<i.length;f++)l=r?t.isNullOrUndefined(this.getColumnByField(i[f]))?this.getColumnByHeaderText(i[f],t.isNullOrUndefined(this.getColumnByField(i[f]))):this.getColumnByField(i[f]):this.getColumnByHeaderText(i[f]),u=n.inArray(l,this.model.columns),u=this.model.detailsTemplate!=null||this.model.childGrid?u+1:u,o=this.model.scrollSettings.frozenColumns,a=o!=0&&u>=o?c.eq(u).removeClass("e-hide").index()+o:c.eq(u).removeClass("e-hide").index(),v.eq(a).removeClass("e-hide"),e.length>this.model.columns.length&&this.model.groupSettings.groupedColumns.length&&(s=e.length-this.model.columns.length,e=e.slice(this.model.detailsTemplate||this.model.childGrid?s+1:s)),e.eq(u).css("display","");this.model.showStackedHeader&&this._refreshStackedHeader()},_hideHeaderColumn:function(i,r){for(var a,s=this.getHeaderTable().find("thead"),h=s.find("tr").not(".e-stackedHeaderRow").find(".e-headercell"),v=s.find(".e-filterbar").find(".e-filterbarcell"),f=this.getHeaderTable().find("colgroup").find("col"),c,u=0;u<i.length;u++){c=r?t.isNullOrUndefined(this.getColumnByField(i[u]))?this.getColumnByHeaderText(i[u],t.isNullOrUndefined(this.getColumnByField(i[u]))):this.getColumnByField(i[u]):this.getColumnByHeaderText(i[u]);var e=n.inArray(c,this.model.columns),l=this.model.detailsTemplate!=null||this.model.childGrid?e+1:e,o=this.model.scrollSettings.frozenColumns;a=o!=0&&e>=o?h.eq(l).addClass("e-hide").index()+o:h.eq(l).addClass("e-hide").index();v.eq(a).addClass("e-hide");f.length>this.model.columns.length&&(f=f.slice(f.length-this.model.columns.length));f.eq(e).css("display","none")}this.model.showStackedHeader&&(this._refreshStackedHeader(),this._colgroupRefresh())},_refreshStackedHeader:function(){var i,r,u,t;if(this.model.showStackedHeader){for(i=this.model.stackedHeaderRows,t=0;t<i.length;t++)if(this.model.scrollSettings.frozenColumns!=0){var f=n(this.getHeaderContent().find(".e-frozenheaderdiv")),e=n(this.getHeaderContent().find(".e-movableheader")),o=this._createStackedRow(i[t],!0),s=this._createStackedRow(i[t],!1);n(f.find("tr.e-stackedHeaderRow")[t]).replaceWith(o);n(e.find("tr.e-stackedHeaderRow")[t]).replaceWith(s)}else r=this._createStackedRow(i[t],!1),this.getHeaderTable().find("tr.e-stackedHeaderRow")[t]?n(this.getHeaderTable().find("tr.e-stackedHeaderRow")[t]).replaceWith(r):r.insertBefore(this.getHeaderTable().find("tr.e-columnheader:last"));if(u={},u.requestType="refresh",this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length>0)for(t=0;t<this.model.groupSettings.groupedColumns.length;t++)this.getHeaderTable().find(".e-stackedHeaderRow").prepend(this._getGroupTopLeftCell());this.model.allowScrolling&&this._refreshScroller(u)}},_getStackedColumnByTarget:function(n){var r=(n.get(0)||{}).className,i=/e-row([0-9])-column([0-9])/.exec(r),u=i[1],f=i[2],e=[u,"stackedHeaderColumns",f].join(".");return t.getObject(e,this.model.stackedHeaderRows)},_checkSkipAction:function(n){switch(n.requestType){case t.Grid.Actions.Save:case t.Grid.Actions.Delete:return!0}return!1},_unboundTemplateRendering:function(t){return n("#"+t).html()},_processBindings:function(i){var r,f,e;if(this._requestType=i.requestType,this.model.query=this.commonQuery.clone(),!this._checkSkipAction(i)&&this._trigger("actionBegin",i))return!0;if(this.model.editSettings.editMode=="batch"&&i.requestType!="batchsave"&&i.requestType!="cancel"&&!this._confirmedValue&&this._bulkChangesAcquired()&&this.model.editSettings.showConfirmDialog)return this._confirmDialog.find(".e-content").html(this.localizedLabels.BatchSaveLostChanges),this._confirmDialog.ejDialog("open"),this._requestArgs=i,!1;if(!t.isNullOrUndefined(this.model.dataSource)&&(i.requestType=="refresh"||i.requestType=="filtering")&&this.model.scrollSettings.allowVirtualScrolling&&(this._currentPage(1),this._scrollValue=0,this._loadedJsonData=[],this._prevPage=this._currentPage()),this._ensureDataSource(i),this.model.scrollSettings.allowVirtualScrolling&&(i.requestType=="virtualscroll"?(this._loadedJsonData.push({pageIndex:this._prevPage,data:this._currentJsonData}),this._prevPage=this._currentPage()):this.model.scrollSettings.enableVirtualization||(this._virtualLoadedRecords[this._currentPage()]=t.isNullOrUndefined(this._currentPageData)?this.model.currentViewData:this._currentPageData,this._currentPageData=null),i.requestType=="filtering"&&(this._loadedJsonData=[],this._prevPage=this._currentPage(),n("#"+this._id+"_externalEdit").remove()),(i.requestType==t.Grid.Actions.Delete||i.requestType==t.Grid.Actions.Add)&&this._refreshVirtualViewDetails()),this.model.scrollSettings.allowVirtualScrolling&&i.requestType=="filtering"&&this.model.filterSettings.filteredColumns.length>0&&this.getScrollObject().scrollY(0),this.model.enableRTL?this.element.hasClass("e-rtl")||this.element.addClass("e-rtl"):this.element.hasClass("e-rtl")&&this.element.removeClass("e-rtl"),i.requestType==t.Grid.Actions.Delete&&this.model.groupSettings.groupedColumns.length==0&&(this.model.editSettings.showAddNewRow&&this.getContentTable().find(".e-addedrow").remove(),i.tr.remove()),this._editForm=this.model.scrollSettings.frozenColumns>0||this.model.editSettings.showAddNewRow?this.element.find(".gridform"):n("#"+this._id+"EditForm"),!(this.model.editSettings.showAddNewRow&&i.requestType=="beginedit")&&this._editForm.length!=0)for(r=0;r<this._editForm.length;r++)n(this._editForm[r]).find("select.e-dropdownlist").ejDropDownList("destroy"),n(this._editForm[r]).find(".e-datepicker.e-js").ejDatePicker("destroy"),n(this._editForm[r]).find(".e-datetimepicker.e-js").ejDateTimePicker("destroy"),n(this._editForm[r]).find(".e-numerictextbox.e-js").ejNumericTextbox("destroy");if(!(this._dataSource()instanceof t.DataManager)||this._isRemoteSaveAdaptor||i.requestType==t.Grid.Actions.BeginEdit||i.requestType==t.Grid.Actions.Cancel||i.requestType==t.Grid.Actions.Add||this._dataSource().adaptor instanceof t.SqlDataSourceAdaptor&&(i.requestType==t.Grid.Actions.Save||i.requestType==t.Grid.Actions.Delete))this._isRelationalRendering(i)?this._setForeignKeyData(i):this.sendDataRenderingRequest(i);else{this.model.scrollSettings.allowVirtualScrolling&&!this.model.scrollSettings.enableVirtualization&&this.model.pageSettings.totalPages==this.model.pageSettings.currentPage&&this.virtualLoadedPages.indexOf((this.model.pageSettings.currentPage-2)*this.model.pageSettings.pageSize)==-1&&(f=t.pvt.filterQueries(this.model.query.queries,"onPage"),this.model.query.queries.splice(n.inArray(f[0],this.model.query.queries),1),this.model.query.page(this._currentPage()-1,this.model.pageSettings.pageSize),e=this._dataSource().executeQuery(this.model.query),this.model.query.queries.splice(n.inArray(f[0],this.model.query.queries),1),this.model.query.page(this._currentPage(),this.model.pageSettings.pageSize));this._virtualSelectedRows&&this._virtualSelectedRows.length>0&&this.model.query.addParams("virtualSelectRecords",this._virtualSelectedRows);var o=this._queryPromise=this._dataSource().executeQuery(this.model.query),s=this.element.ejWaitingPopup("instance"),u=this;this.element.ejWaitingPopup("show");u._dataSource().ready?u._dataSource().ready.done(function(){u._processDataRequest(u,i,o,e)}):u._processDataRequest(u,i,o,e)}},_processDataRequest:function(n,i,r,u){r.done(t.proxy(function(r){var e,f,o;if(r.count>0&&!n._currentPage()&&n._currentPage(1),!t.isNullOrUndefined(n.element)&&!(n._dataSource().adaptor instanceof t.SqlDataSourceAdaptor)){if(u&&!n._previousPageRendered)n._processLastPageData(n,i,r,u);else if(n._remoteLastPageRendered&&n.model.pageSettings.currentPage==n.model.pageSettings.totalPages-1&&!n.model.scrollSettings.enableVirtualization){for(e=n.model.pageSettings.pageSize-n._previousPageLength,f=0;f<e;f++)o=n.getRows()[n.getRows().length-(n.model.pageSettings.pageSize-f)],o.remove();n._tempPageRendered=!0;n.model.currentViewData=r.result;n._relationalColumns.length==0&&n.element.ejWaitingPopup("hide")}else n._identityKeys.length&&i.action=="add"&&this.adaptor instanceof t.ODataAdaptor&&n._processIdentityField(r.result,i),n.model.pageSettings.currentPage!=n.model.pageSettings.totalPages-1||n._remoteLastPageRendered||(n._previousPageRendered=!0),n.model.currentViewData=r.result==null?[]:r.result,n._$fkColumn&&n.model.filterSettings.filterType=="excel"&&n.model.filterSettings.filteredColumns.length>0&&(n._fkParentTblData=r.result),n._relationalColumns.length==0&&n.element.ejWaitingPopup("hide");n.model.allowScrolling&&n.model.scrollSettings.allowVirtualScrolling&&n.model.scrollSettings.enableVirtualization&&(i.requestType=="filtering"&&(n._gridRecordsCount=n._filteredRecordsCount=r.count,n._refreshVirtualViewDetails()),r.result.length?(n._isInitNextPage||n._isLastVirtualpage?(n._gridRecordsCount=r.count,n._refreshVirtualViewDetails(),n._setInitialCurrentIndexRecords(r.result,n._currentPage()),n._isInitNextPage=n._isLastVirtualpage=!1):(n._gridRecordsCount=r.count,n._refreshVirtualViewDetails(),n._setVirtualLoadedRecords(r.result,n._currentPage())),n._isThumbScroll&&!n._checkCurrentVirtualView(n._virtualLoadedRecords,n._currentVirtualIndex)&&n._checkPrevNextViews(),n._remoteRefresh=!0):n.getContent().find(".e-virtualtop, .e-virtualbottom").remove());t.isNullOrUndefined(r.aggregates)||(n._remoteSummaryData=r.aggregates);i.templateRefresh&&n.refreshHeader();(t.isNullOrUndefined(u)||t.isNullOrUndefined(n._previousPageRendered)||n._previousPageRendered)&&n._processData(r,i);t.isNullOrUndefined(n._unboundRow)||i.selectedRow==n._unboundRow||i.requestType!="save"||(n._unboundRow.find(".e-editbutton").trigger("click"),n._unboundRow=null)}}));r.fail(t.proxy(function(r){t.isNullOrUndefined(n.element)||(n.element.ejWaitingPopup("hide"),i.error=r.error,r=[],n.model.currentViewData=[],n._processData(r,i),t.isNullOrUndefined(n.getPager())||n.getPager().ejPager({currentPage:0,totalRecordsCount:0}),n._trigger("actionFailure",i))}))},_processIdentityField:function(i,r){var u=this._primaryKeys[0],e=t.distinct(i,u),o=t.distinct(this.model.currentViewData,u),s=n.grep(e,function(t){return n.inArray(t,o)==-1?!0:!1}),f=t.DataManager(i).executeLocal((new t.Query).where(u,"equal",s))[0];r.data=t.isNullOrUndefined(f)?r.data:f},_processLastPageData:function(n,i,r,u){u.done(t.proxy(function(u){n.element.ejWaitingPopup("hide");n.model.previousViewData=u.result;n.model.previousViewData&&n.model.previousViewData.length!=0&&(n._previousPageLength=r.result.length,n._currentPageData=r.result,t.merge(n.model.previousViewData,r.result),n.model.currentViewData=n.model.previousViewData,n._remoteLastPageRendered=!0);n._processData(r,i)}));u.fail(t.proxy(function(t){n.element.ejWaitingPopup("hide");i.error=t.error;t=[];n.model.previousViewData=[];n._processData(t,i);n._trigger("actionFailure",i)}))},_createUnboundElement:function(i,r){var o=document.createElement("div"),s,f,u,e;for(i.headerText=t.isNullOrUndefined(i.headerText)?t.isNullOrUndefined(i.field)?"":i.field:i.headerText,t.isNullOrUndefined(i.headerText)||(o.id=this._id+i.headerText.replace(/[^a-z0-9|s_]/gi,"")+r+"_UnboundTemplate"),s=t.buildTag("div.e-unboundcelldiv"),f=i.commands,u=0;u<f.length;u++)e=t.buildTag("button.e-flat e-"+f[u].type.replace(/\s+/g,"")+"button","",{},{type:"button"}),e.val(f[u].type),(f[u].type=="save"||f[u].type=="edit")&&e.addClass("e-btnsub"),(f[u].type=="cancel"||f[u].type=="delete")&&e.addClass("e-btncan"),s.append(e);return n("body").append(n(o).html(s).hide()),o},_refreshUnboundTemplate:function(i){var h,e,s,u,r,f,o;if(this._isUnboundColumn)for(h=0,e=0;e<this.model.columns.length;e++)if(this.model.columns[e].commands)for(s=i.find(".e-unboundcell.e-"+this.model.columns[e].headerText.replace(/[^a-z0-9|s_]/gi,"")+e).find(".e-unboundcelldiv"),u=n.extend(!0,[],this.model.columns[e].commands),r=0;r<u.length;r++){for(t.isNullOrUndefined(u[r].buttonOptions)&&(u[r].buttonOptions={}),u[r].buttonOptions.width=t.isNullOrUndefined(u[r].buttonOptions.width)?"52":u[r].buttonOptions.width,u[r].buttonOptions.height=t.isNullOrUndefined(u[r].buttonOptions.height)?"28":u[r].buttonOptions.height,u[r].buttonOptions.cssClass=t.isNullOrUndefined(u[r].buttonOptions.cssClass)?this.model.cssClass:u[r].buttonOptions.cssClass,u[r].buttonOptions.enableRTL=this.model.enableRTL,f=s.find(".e-"+u[r].type.replace(/\s+/g,"")+"button"),this.model.isEdit&&this._requestType!="cancel"&&this._requestType!="sorting"&&this._requestType!="grouping"&&this._requestType!="filtering"&&this._requestType!="paging"||(i.closest(".e-editcell").length?u[r].type=="save"||u[r].type=="cancel"?f.show():(f.hasClass("e-deletebutton")&&f.hide(),f.hasClass("e-editbutton")&&f.hide()):u[r].type=="save"||u[r].type=="cancel"?f.hide():(f.hasClass("e-deletebutton")&&f.show(),f.hasClass("e-editbutton")&&f.show())),o=0;o<f.length;o++)n(f[o]).data("ejButton")&&n(f[o]).ejButton("destroy");f.ejButton(u[r].buttonOptions)}else continue},_gridTemplate:function(n,i,r){var u=n.model.columns[r];return n.model.scrollSettings.enableVirtualization&&(this.index+=n._currentVirtualRowIndex),(t.isNullOrUndefined(n.model.ngTemplateId)||!n._isAddNew)&&t.isNullOrUndefined(n._isGrouping)||(this.index=n._isAddNew?0:n._currentJsonData.indexOf(this.data)),this.index=t.isNullOrUndefined(this.index)?0:this.index,n._renderEjTemplate("#"+i,this.data,this.index,u)},_createTemplateElement:function(i,r,u){var e=i["templateID"in i?"templateID":"template"],s=/^#([\w-]*)/.exec(e),r=r||n("body"),f,h=u?"Pager":i.headerText+n.inArray(i,this.model.columns)+"_Template",o={name:"SCRIPT",type:"text/x-template",text:e,id:(this._id+h).replace(/(\\|[^0-9A-z-_])/g,"")};return f=s&&s[1]?document.getElementById(s[1]):/^<script/i.test(e)?n(e).get(0):t.buildTag(o.name,o.text).get(0),f.id=f.id||o.id,f.type=f.type||o.type,r.append(u?n(f).html():f),f},_renderGridPager:function(){var r=n(document.createElement("div")),t={};return this.model.pageSettings.change=this._gPagerClickHandler,this.model.pageSettings.pageSizeSelected=this._gPageSize,this.model.pageSettings.totalRecordsCount=this._gridRecordsCount||null,this.model.pageSettings.enableRTL=this.model.enableRTL,this.model.pageSettings.locale=this.model.locale,this.model.pageSettings.enableQueryString=this.model.pageSettings.enableQueryString,this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&(t.enableExternalMessage=this.model.filterSettings.showFilterBarStatus),n.extend(t,this.model.pageSettings),t.currentPage=this._currentPage(),t.masterObject=this,this.setGridPager(r),t.template!=i&&(t.template=null),r.ejPager(t),r.ejPager("refreshPager"),t=r.ejPager("model"),this.model.pageSettings.totalPages=t.totalPages||null,this._currentPage()!==t.currentPage&&this._currentPage(t.currentPage),this._renderPagerTemplate(r),r},_renderPagerTemplate:function(n,i){var r=this.model.pageSettings,f=n.find(".e-pagercontainer").not(".e-template").length==0,u;n.find(".e-pagercontainer.e-template").remove();(i||!r.enableTemplates)&&f&&n.ejPager("renderPager");r.enableTemplates&&(r.showDefaults||n.children().remove(),u=t.buildTag("div",null,null,{"class":"e-pagercontainer e-template",style:"width: auto;"}),this._createTemplateElement(this.model.pageSettings,u,!0),n.append(u))},_renderContext:function(){var p=this.model.contextMenuSettings.contextMenuItems,w,b,e=0,r=t.buildTag("ul","",{},{id:this._id+"_Context"}),i,s,d,g,h,v,nt,y,c;if(!this.model.contextMenuSettings.disableDefaultItems)for(e;e<p.length;e++)w=p[e],b=this._items(w,"contextMenuItem"),r.append(b);var k=this.model.contextMenuSettings.customContextMenuItems,u=this.model.contextMenuSettings.subContextMenu,f,l,o=0,a;for(o;o<k.length;o++){for(f=k[o],l=this._items(f,"customContextMenuItem"),i=0;i<u.length;i++)if(typeof f=="string"&&f==u[i].contextMenuItem||typeof f=="object"&&f.id==u[i].contextMenuItem){if(a=u[i].template,s=t.buildTag("ul","",{},{id:this._id+"_subMenuContext"+i}),t.isNullOrUndefined(a))for(h=0;h<u[i].subMenu.length;h++)d=u[i].subMenu[h],g=this._items(d,"subMenuItems"),s.append(g);else s=this._renderEjTemplate(a);l.append(s)}r.append(l)}r.find("li").length>0&&(this.element.append(r),v=this.element.parents("div.e-grid"),nt=t.Menu.prototype._showContextMenu,t.Menu.prototype._showContextMenu=function(t,i,r,u){n(this.model.contextMenuTarget).hasClass("e-grid")&&(++t,++i);nt.apply(this,[t,i,r,u])},n(r).ejMenu({menuType:t.MenuType.ContextMenu,openOnClick:!1,contextMenuTarget:"#"+this._id,click:n.proxy(this._clickevent,this),width:"auto",beforeOpen:n.proxy(this._menu,this)}),v.length&&(y=n("#"+v[0].id+"_Context"),c=y.ejMenu("model.excludeTarget"),y.ejMenu({excludeTarget:!t.isNullOrUndefined(c)&&c.length!=0?c.concat(",#"+this._id):"#"+this._id})),this._conmenu=r.data("ejMenu"))},_clickevent:function(i){var o=i.events.text,e=n(this._contexttarget.parentNode),r=n(this._contexttarget),u,f;if(r.hasClass("e-filterset")?r=r.siblings():(r.hasClass("e-icon")||r.hasClass("e-number"))&&(r=r.parent()),u=r.attr("data-ej-mappingname")||r.find(".e-headercelldiv").attr("data-ej-mappingname"),!this._trigger("contextClick",i))switch(o){case this.localizedLabels.AddRecord:this._startAdd();break;case this.localizedLabels.EditRecord:if(this.model.editSettings.editMode=="batch"){var s=n(this._contexttarget.parentNode).find(".e-rowcell").index(r),h=this._excludeDetailRows().index(e),c=this.model.columns[s].field;this.editCell(h,c)}else this.startEdit(e);break;case this.localizedLabels.DeleteRecord:this.model.editSettings.showDeleteConfirmDialog?this._confirmDialog.find(".e-content").html(this.localizedLabels.ConfirmDelete).end().ejDialog("open"):this.multiDeleteMode&&this.selectedRowsIndexes.length>1?this._multiRowDelete():this.deleteRow(e);break;case this.localizedLabels.Save:this.model.editSettings.editMode=="batch"?this.batchSave():this.endEdit();break;case this.localizedLabels.Cancel:this.cancelEdit();break;case this.localizedLabels.SortInDescendingOrder:f=t.sortOrder.Descending;this.sortColumn(u,f);break;case this.localizedLabels.SortInAscendingOrder:f=t.sortOrder.Ascending;this.sortColumn(u,f);break;case this.localizedLabels.Grouping:this.groupColumn(u);break;case this.localizedLabels.Ungrouping:this.ungroupColumn(u);break;case this.localizedLabels.NextPage:case this.localizedLabels.PreviousPage:case this.localizedLabels.LastPage:case this.localizedLabels.FirstPage:this._page(i)}},_menu:function(i){var r=this._conmenu.element,u,d,p,o,g,tt,s,e,k,c,l,v,y,a,f;if(this._contexttarget=i.target,u=n(i.target),o=n(this._contexttarget),this.model.allowSelection&&(o.hasClass("e-rowcell")||o.closest(".e-rowcell").length)&&!u.hasClass("e-selectionbackground")&&(g=o.hasClass("e-rowcell")?o.parent():o.closest(".e-rowcell").parent(),this.model.isEdit||this.selectRows(this.getIndexByRow(g),null,o)),(u.hasClass("e-ascending")||u.hasClass("e-descending"))&&!u.parent().hasClass("e-headercelldiv"))return!1;d=u.hasClass("e-filtericon")||u.hasClass("e-headercelldiv")?i.target.parentNode.getAttribute("aria-sort"):u.hasClass("e-headercell")?i.target.getAttribute("aria-sort"):u.parent().parent().attr("aria-sort");tt=i.target.className;s=n(r);p=u.hasClass("e-filterset")?u.siblings().attr("data-ej-mappingname"):u.hasClass("e-icon")||u.hasClass("e-number")?u.parent().attr("data-ej-mappingname"):u.hasClass("e-headercell")?u.find(".e-headercelldiv").attr("data-ej-mappingname"):u.attr("data-ej-mappingname");r.css("visibility","visible");var nt=u.closest("tr").hasClass("e-insertedrow")?this.model.groupSettings.groupedColumns.length:0,w=u.closest(".e-rowcell"),b=u.closest(".e-headercell"),it=w.index()!=-1?w.index():b.index()-this.model.groupSettings.groupedColumns.length,h=u.hasClass("e-rowcell")?u.index()-nt:it-nt;h=this.model.detailsTemplate!=null||this.model.childGrid!=null?h-1:h;e=this.model.columns[h];k={allowGrouping:".e-contextgrouping",allowSorting:".e-contextascending, .e-contextdescending","editSettings.allowAdding":".e-contextadd","editSettings.allowEditing":".e-contextedit","editSettings.allowDeleting":".e-contextdelete"};for(c in k)l=r.find(k[c]).parent(),t.getObject(c,this.model)==!1||t.getObject(c,e)===!1?l.css("display","none"):l.css("display")=="none"&&l.css("display","block");if(u.closest(".e-grid").attr("id")!==this._id||u.is("input")){r.css("visibility","hidden");return}if(this.getHeaderTable().find(u).length>0){if(!(b.length!=0&&b.children().hasClass("e-headercelldiv"))){r.css("visibility","hidden");return}f=n(r.find(".e-head"));r.find(".e-page").css("display","none");r.find(".e-content").css("display","none");r.find(".e-savcan").css("display","none");f.css("display","block");(t.isNullOrUndefined(e.field)||e.field=="")&&(f.css("display","none"),r.find(".e-customitem").length==0&&r.css("visibility","hidden"));a={columnIndex:h,headerText:e.headerText};n.extend(i,a)}else if(this.getContentTable().find(u).length>0){if(v=this.getIndexByRow(n(i.target.parentElement)),y=this.model.editSettings.editMode=="batch"?this.getDataByIndex(v):this.getSelectedRecords(),w.length==0){r.css("visibility","hidden");return}f=n(r.find(".e-content"));r.find(".e-head").css("display","none");r.find(".e-page").css("display","none");r.find(".e-savcan").css("display","none");f.css("display","block");(t.isNullOrUndefined(e.field)||e.field=="")&&this.model.editSettings.editMode=="batch"&&(f.css("display","none"),r.find(".e-customitem").length==0&&r.css("visibility","hidden"));a=this.model.editSettings.editMode=="batch"?{columnIndex:h,rowIndex:v,rowData:y,headerText:e.headerText,cellValue:t.getObject(t.isNullOrUndefined(e.field)?"":e.field,y)}:{columnIndex:h,rowIndex:v,rowData:y,headerText:e.headerText};n.extend(i,a)}else if(!t.isNullOrUndefined(this.getPager())&&this.getPager().find(u).length>0||u.hasClass("e-pager"))f=n(r.find(".e-page")),r.find(".e-head").css("display","none"),r.find(".e-content").css("display","none"),r.find(".e-savcan").css("display","none"),f.css("display","block");else return f=n(r),r.css("visibility","hidden"),!1;switch(d){case"ascending":s.find(".ascending").parent().css("display","none");break;case"descending":s.find(".descending").parent().css("display","none")}u.hasClass("e-rowcell")&&this.model.editSettings.showAddNewRow&&(f=n(r.find(".e-savcan")),r.find(".e-contextadd").parent().css("display","none"),f.css("display","block"));this.model.editSettings.editMode=="batch"&&(this.batchChanges.changed.length||this.batchChanges.deleted.length||this.batchChanges.added.length)&&(f=n(r.find(".e-savcan")),r.find(".e-head").css("display","none"),r.find(".e-page").css("display","none"),f.css("display","block"));this.model.isEdit&&u.closest(".e-rowcell").length&&(!this.model.editSettings.showAddNewRow||n(".e-editedrow").length>0)&&(f=n(r.find(".e-savcan")),r.find(".e-head").css("display","none"),r.find(".e-content").css("display","none"),r.find(".e-page").css("display","none"),f.css("display","block"));this.model.pageSettings.totalPages==1&&f.hasClass("e-page")?r.find(".e-customitem").length==0?r.css("visibility","hidden"):r.find(".e-page").css("display","none"):this.model.pageSettings.currentPage==1?(s.find(".previous").parent().css("display","none"),s.find(".first").parent().css("display","none")):this.model.pageSettings.currentPage==this.model.pageSettings.totalPages&&(s.find(".last").parent().css("display","none"),s.find(".nextpage").parent().css("display","none"));this.model.groupSettings.groupedColumns.indexOf(p)!=-1?f.find(".group").parent().css("display","none"):this.model.groupSettings.groupedColumns.indexOf(p)==-1&&f.find(".ungroup").parent().css("display","none");this.model.contextOpen&&this._trigger("contextOpen",i)},_items:function(i,r){var f,u,e,o;return i==""?!1:(r=="contextMenuItem"&&(i.indexOf("Record")!=-1?(u=t.buildTag("li","",{},{"class":"e-content"}),u.css("display","none")):i.indexOf("Page")!=-1?(u=t.buildTag("li","",{},{"class":"e-page"}),i.indexOf("Next")!=-1?f=t.buildTag("div","",{},{"class":"nextpage"}):i.indexOf("Previous")!=-1?f=t.buildTag("div","",{},{"class":"previous"}):i.indexOf("Last")!=-1?f=t.buildTag("div","",{},{"class":"last"}):i.indexOf("First")!=-1&&(f=t.buildTag("div","",{},{"class":"first"})),u.css("display","none")):i=="Save"||i=="Cancel"?(u=t.buildTag("li","",{},{"class":"e-savcan"}),u.css("display","none")):(i.indexOf("Order")!=-1||i=="Grouping"||i=="Ungrouping")&&(u=t.buildTag("li","",{},{"class":"e-head"}),i.indexOf("Ascending")!=-1?f=t.buildTag("div","",{},{"class":"ascending"}):i.indexOf("Descending")!=-1?f=t.buildTag("div","",{},{"class":"descending"}):i=="Grouping"?f=t.buildTag("div","",{},{"class":"group"}):i=="Ungrouping"&&(f=t.buildTag("div","",{},{"class":"ungroup"})),u.css("display","none"))),t.isNullOrUndefined(u)&&(u=t.buildTag("li","",{},{"class":"e-customitem"}),u.css("display","block")),u.append(f),e=document.createElement("a"),o="",typeof i=="string"&&(o=i.indexOf("Ascending")!=-1?"ascending":i.indexOf("Descending")!=-1?"descending":i.split(" ")[0].toLowerCase(),e.innerHTML=t.isNullOrUndefined(this.localizedLabels[i.replace(/\s+/g,"")])?i:this.localizedLabels[i.replace(/\s+/g,"")]),typeof i=="object"&&(o=i.id=="Ascending"?"ascending":i.id=="Descending"?"descending":i.id.split(" ")[0].toLowerCase(),e.innerHTML=t.isNullOrUndefined(this.localizedLabels[i.text.replace(/\s+/g,"")])?i.text:this.localizedLabels[i.text.replace(/\s+/g,"")],u.attr("id",i.id)),r=="contextMenuItem"?n(e).append(t.buildTag("span","",{},{"class":"e-gridcontext e-icon e-context"+o})):n(e).append(t.buildTag("span","",{},{"class":"e-gridcontext e-icon e-custommenu"+o})),u.append(e),u)},_page:function(n){var t;n.events.text==this.localizedLabels.NextPage?(t=this.model.pageSettings.currentPage,++t,this.gotoPage(t)):n.events.text==this.localizedLabels.PreviousPage?(t=this.model.pageSettings.currentPage,t>1?(--t,this.gotoPage(t)):this.gotoPage(t)):n.events.text==this.localizedLabels.LastPage?(t=this.model.pageSettings.totalPages,this.gotoPage(t)):this.gotoPage(1)},changePageSize:function(n){var i={},r,u=this.getPager().ejPager("instance");this.model.pageSettings.pageSize=n;this.model.pageSettings.currentPage=u.model.currentPage;this.getPager().ejPager({pageSize:n});i.requestType=t.Grid.Actions.Refresh;r=this._processBindings(i)},gotoPage:function(n){var i,r,u;n&&(n!=this._currentPage()||this.model.scrollSettings.allowVirtualScrolling)&&(this.model.allowPaging||this.model.allowScrolling||this.model.scrollSettings.allowVirtualScrolling)&&(i={},i.previousPage=this._currentPage(),this._currentPage(n),i.endIndex=this._currentPage()*this.model.pageSettings.pageSize>this._gridRecordsCount?this._gridRecordsCount:this._currentPage()*this.model.pageSettings.pageSize,i.startIndex=this._currentPage()*this.model.pageSettings.pageSize-this.model.pageSettings.pageSize,i.currentPage=n,this.model.allowPaging&&(i.requestType=t.Grid.Actions.Paging),this.model.scrollSettings.allowVirtualScrolling&&this.model.allowScrolling&&(this._isVirtualRecordsLoaded=!1,u=this._refreshVirtualPagerInfo(),this._showPagerInformation(u),i.requestType=t.Grid.Actions.VirtualScroll),r=this._processBindings(i),r&&this._currentPage(i.previousPage),this._primaryKeyValues=[])},_gPagerClickHandler:function(n){if(this._prevPageNo!=n.currentPage)return this.model.masterObject.gotoPage(n.currentPage),!1},_gPageSize:function(n){this.model.masterObject.changePageSize(n.pageSize)},_processData:function(i,r){var u,f;if(this.initialRender)this._initDataProcessed=!0,this._initDataProcess(i,r);else{if(this._gridRecordsCount=i.count==0&&this.model.currentViewData.length?i.result.length:i.count,this.getPager()!=null&&(this.model.pageSettings.totalRecordsCount=this._gridRecordsCount),(r.requestType==t.Grid.Actions.Filtering||t.Grid.Actions.Save||this.model.filterSettings.filteredColumns.length>0&&r.requestType==t.Grid.Actions.Refresh)&&(this._filteredRecordsCount=i.count),this.model.allowScrolling&&this.model.scrollSettings.enableVirtualization)for(this.model.currentViewData=[],u=0;u<this._currentLoadedIndexes.length;u++)f=this._currentLoadedIndexes[u],n.merge(this.model.currentViewData,this._virtualLoadedRecords[f]||[]);this._setForeignKeyData(r);this.model.groupSettings.groupedColumns.length&&!this.initialRender&&this._setAggregates();this._relationalColumns.length==0&&this.sendDataRenderingRequest(r)}},_frozenCell:function(t,i){var r=i,u=0,f=this.getRowByIndex(t);return i>=this.model.scrollSettings.frozenColumns&&(u=1,r=r-this.model.scrollSettings.frozenColumns),n(f.eq(u).find(".e-rowcell:eq("+r+")"))},_frozenColumnSelection:function(t,i,r){var e=i,f=0,o,u;if(r)for(u=i;u<r;u++){for(e=u,u>=this.model.scrollSettings.frozenColumns&&(f=1,e=u-this.model.scrollSettings.frozenColumns),o=0;o<t[f].length;o++)n(t[f][o].cells[e]).addClass("e-columnselection");n(this.getHeaderTable().find("th.e-headercell")[u]).addClass("e-columnselection");this.selectedColumnIndexes.push(u)}else for(i>=this.model.scrollSettings.frozenColumns&&(f=1,e=i-this.model.scrollSettings.frozenColumns),u=0;u<t[f].length;u++)n(t[f][u].cells[e]).addClass("e-columnselection")},_renderGridFooter:function(){var n;if(this.model.summaryRows.length>0){var s=t.DataManager(this.model.summaryRows).executeLocal(t.Query().where("showTotalSummary",t.FilterOperators.equal,!1)),i=t.buildTag("div.e-gridfooter"),r=t.buildTag("div");if(this.model.allowScrolling&&r.addClass("e-footercontent"),n=t.buildTag("table.e-gridsummary"),this.setGridFooterContent(i),this.model.scrollSettings.frozenColumns>0){var f=t.buildTag("div.e-frozenfooterdiv"),e=t.buildTag("div.e-movablefooter"),u=n.clone(),o=t.buildTag("div.e-movablefooterdiv");e.append(o);n.append(this.getHeaderTable().first().find("colgroup").clone());u.append(this.getHeaderTable().last().find("colgroup").clone());f.append(n);o.append(u);this.setGridFooterTable(n.add(u));this._createSummaryRows(this.getFooterTable());i.append(f.add(e));i.find(".e-frozenfooterdiv").outerWidth(this.getHeaderContent().find(".e-frozenheaderdiv").width()).end().find(".e-movablefooterdiv").outerWidth(this.getContent().find(".e-movablecontentdiv").width())}else n.append(this.getHeaderTable().find("colgroup").clone()),this.setGridFooterTable(n),this._createSummaryRows(this.getFooterTable()),r.append(n),i.html(r);return this.model.summaryRows.length==s.length?void 0:i}throw"summary row collection is missing";},_setSummaryAggregate:function(n){for(var t,f,u=this.model.summaryRows,i,r=0,e=u.length;r<e;r++)for(i=u[r].summaryColumns,t=0,f=i.length;t<f;t++)n.aggregate(i[t].summaryType,i[t].dataMember)},_createSummaryRows:function(i,r,u,f,e){var l=i.find("col");i.find("tbody").length>0&&i.find("tbody").remove();var s=t.buildTag("tbody"),o=this,h=s.clone(),c=this.model.summaryRows;!t.isNullOrUndefined(r)&&this._isCaptionSummary&&(c=this._captionSummary(e));n.each(c,function(c,a){var y,k,w,d,tt,p;if(a.showTotalSummary===!1&&t.isNullOrUndefined(r)||a.showGroupSummary===!1&&e&&!t.isNullOrUndefined(r))return!0;if(y=t.buildTag("tr.e-gridSummaryRows"),t.isNullOrUndefined(f&&f.level))for(p=0;p<o.model.groupSettings.groupedColumns.length;p++)y.prepend(t.buildTag("td").addClass("e-indentcell"));k=e?" e-gcsummary":"";(o.model.detailsTemplate!=null||o.model.childGrid!=null)&&(o.model.groupSettings.groupedColumns.length!=0?y.children("td.e-indentcell").last().after("<td class='e-summaryrow"+k+"'><\/td>"):y.prepend("<td class='e-summaryrow'><\/td>"));var v=o.getHeaderTable().find("td").slice(0,o.model.columns.length).clone().addClass("e-summaryrow"+k+""),w=0;if(t.isNullOrUndefined(a.titleColumn)||(w=o.getColumnIndexByField(a.titleColumn),w==-1&&(w=o.getColumnIndexByHeaderText(a.titleColumn))),w!=-1&&(v=o._assignTitleColumn(w,a.title,v,0)),o._hideSummaryColumn(v,l),o.model.scrollSettings.frozenColumns>0)d=y.clone(),s.append(y.append(v.slice(0,o.model.scrollSettings.frozenColumns))),h.append(d.append(v.slice(o.model.scrollSettings.frozenColumns)));else if(o._isCaptionSummary&&!e||t.isNullOrUndefined(f&&f.level))s.append(y.append(v));else{var g=o.model.groupSettings.groupedColumns.length-f.level+1,b=i.clone().addClass("e-groupsummary"),nt={};for(nt.data={items:f},y.prepend("<td class='e-summaryrow"+k+"' colspan="+o._colSpanAdjust(null,null,nt)+" style = 'padding:0;' ><\/td>"),n(y[0].cells).filter(".e-summaryrow").html(b.append(t.buildTag("tr",v))),tt=b.find("col").length-(o.model.columns.length+g),(o.model.detailsTemplate!=null||o.model.childGrid!=null)&&y.find("tr").prepend("<td class='e-summaryrow'><\/td>"),p=0;p<tt;p++)b.find("col").first().remove();for(p=0;p<g;p++)n(b[0].rows).prepend("<td class='e-indentcell'><\/td>"),n(b.find("col")[p]).addClass("e-summary");s.append(y)}n.each(a.summaryColumns,function(i,f){var s=f.summaryType!="custom"?u?u[f.dataMember+" - "+f.summaryType]:o._remoteSummaryData[f.dataMember+" - "+f.summaryType]:o.getSummaryValues(f,r);var h=f.prefix?f.prefix:"",e=o.getColumnIndexByField(f.displayColumn),a=f.suffix?f.suffix:"";if(o.model.allowScrolling&&n(v[e]).addClass("e-scroller"),n(v[e]).html()!=""&&h==""&&(h=n(v[e]).html()),t.isNullOrUndefined(f.template))e!=-1&&n(v[e]).html(h+(f.format?o.formatting(f.format,s,o.model.locale):s)+a).css("text-align",o.model.columns[e].textAlign);else{var c={summaryValue:f.format?o.formatting(f.format,s,o.model.locale):s,summaryColumn:f},l=c.summaryColumn.template,y=!t.isNullOrUndefined(o.model.ngTemplateId)&&(l.startsWith("#")||l.startsWith(".")||typeof l=="object")?o.model.ngTemplateId+"gridsummarytemplate":null;o._summaryContextIndex=o._summaryContextIndex+1;n(v[e]).html(o._renderEjTemplate(c.summaryColumn.template,c,o._summaryContextIndex,null,y)).css("text-align",o.model.columns[e].textAlign);n(v[e]).addClass("e-summarytemplate")}})});this.model.scrollSettings.frozenColumns>0?(i.first().append(s),i.last().append(h)):i.append(s)},_assignTitleColumn:function(n,t,i,r){for(var f,u=n;u<this.model.columns.length;u++)if(f=this.model.columns[u],r==0&&f.visible!=!1){i.eq(u).html(t);break}return i},getSummaryValues:function(i,r){var f,u,o,s,h,e;u=t.isNullOrUndefined(r)?this.model.filterSettings.filteredColumns.length>0?this._filteredRecords:this._dataSource():r;u instanceof t.DataManager?(o=u,u=u.dataSource.json):o=t.DataManager(u);switch(i.summaryType){case t.Grid.SummaryType.Maximum:s=t.max(u,i.dataMember);f=t.getObject(i.dataMember,s);break;case t.Grid.SummaryType.Minimum:s=t.min(u,i.dataMember);f=t.getObject(i.dataMember,s);break;case t.Grid.SummaryType.Average:f=t.avg(u,i.dataMember);break;case t.Grid.SummaryType.Sum:f=t.sum(u,i.dataMember);break;case t.Grid.SummaryType.Count:f=u.length;break;case t.Grid.SummaryType.TrueCount:h=t.Predicate(i.dataMember,"equal",!0);f=o.executeLocal(t.Query().where(h)).length;break;case t.Grid.SummaryType.FalseCount:h=t.Predicate(i.dataMember,"equal",!1);f=o.executeLocal(t.Query().where(h)).length;break;case t.Grid.SummaryType.Custom:e=i.customSummaryValue;e&&(typeof e=="string"&&(e=t.util.getObject(e,window)),n.isFunction(e)&&(f=e.call(this,i,u)))}return f},_hideCaptionSummaryColumn:function(){var f=this.getHeaderTable().find(".e-headercelldiv[data-ej-mappingname]").first(),e=this.getContentTable().find(".e-groupcaption").clone(),i=this.getContentTable().find(".e-groupcaption").parent(),o=this.model.columns.length-1,r,n,t,u;if(this._isCaptionSummary&&(this.getContentTable().find(".e-summaryrow:not(.e-gcsummary)").remove(),this.getFooterTable().find("tbody td").slice(-o).removeClass("e-groupcaptionsummary").addClass("e-summaryrow"),this.getFooterTable()!=null&&this.getContentTable().find(".e-recordplusexpand").parent().children(".e-indentcell").remove(),!this.model.groupSettings.showGroupedColumn&&this.getContentTable().find(".e-groupcaptionsummary").not(".e-hide").length&&(r=+this.getContentTable().find(".e-recordtable:first").parents("tbody:first").find(".e-groupcaption").attr("colspan"),this._hiddenColumnsField.length==this.model.columns.length-1&&f.parent().hasClass("e-hide")||!r)))for(n=0;n<e.length;n++)i.eq(n).children().not(".e-hide,.e-recordplusexpand").filter("td.e-groupcaptionsummary:first").addClass("e-hide"),t=i.eq(n).find(".e-groupcaption"),u=parseInt(t.attr("colspan")),t.attr("colspan",++u);this.getContentTable().find(".e-recordtable").find(".e-indentcell").remove()},_hideSummaryColumn:function(t,i){var r,u,f;if(i.length>this.model.columns.length&&(i=i.slice(i.length-this.model.columns.length)),!this.model.groupSettings.showGroupedColumn&&this.model.showSummary)for(r=0;r<this.model.columns.length;r++)for(u=0;u<this.model.groupSettings.groupedColumns.length||u<this._hiddenColumnsField.length;u++)if(f=this.getHeaderTable().find(".e-headercelldiv:not(.e-emptyCell)"),f.eq(r).parent().hasClass("e-hide")){i.eq(r).css("display","none");n(t[r]).addClass("e-hide");break}else i.eq(r).css("display")=="none"&&i.eq(r).css("display","");else for(r=0;r<this.model.columns.length;r++)this.model.columns[r].visible?i.eq(r).css("display")=="none"&&i.eq(r).css("display",""):(i.eq(r).css("display","none"),n(t[r]).addClass("e-hide"))},_initScrolling:function(){var r=[],f=[],e=0,i,u;for(this.model.scrollSettings.enableVirtualization&&(this.model.scrollSettings.allowVirtualScrolling=!0),i=0;i<this.model.columns.length;i++)this.model.columns[i].visible===!1&&i<this.model.scrollSettings.frozenColumns&&e++,this.model.columns[i].isFrozen===!0?r.push(this.model.columns[i]):f.push(this.model.columns[i]);if(r.length>0&&(u=this.model.scrollSettings.frozenColumns,this.model.columns=n.merge(n.merge([],r),f),this.model.scrollSettings.frozenColumns=r.length,r.length!=u&&u!=0&&(this.model.scrollSettings.frozenColumns=u)),(this.model.scrollSettings.frozenColumns>0||this.model.scrollSettings.frozenRows>0)&&(this.model.allowGrouping||this.model.rowTemplate!=null||this.model.detailsTemplate!=null||this.model.childGrid!=null||this.model.scrollSettings.allowVirtualScrolling||this.model.editSettings.editMode=="batch")){this._renderAlertDialog();this._alertDialog.find(".e-content").text(this._getLocalizedLabels().FrozenNotSupportedException);this._alertDialog.ejDialog("open");return}this.model.scrollSettings.allowVirtualScrolling&&this.model.allowScrolling&&(this.model.scrollSettings.enableVirtualization?(this._vRowHeight=Math.floor(this.getRowHeight()+1),this._virtualRowCount=Math.round(this.model.scrollSettings.height/this._vRowHeight)+1,this.model.pageSettings.pageSize=this.model.pageSettings.pageSize<=this._virtualRowCount*5?this._virtualRowCount*5:this.model.pageSettings.pageSize):(this.model.pageSettings.pageSize=this.model.pageSettings.pageSize==12?Math.round(this.model.scrollSettings.height/32)+1:this.model.pageSettings.pageSize,this.model.pageSettings.totalPages=Math.ceil(this._gridRecordsCount/this.model.pageSettings.pageSize)));(this.model.width||this.model.height)&&(this.model.allowScrolling=!0,this.model.width&&(this.model.scrollSettings.width=this.model.width),this.model.height&&(this.model.scrollSettings.height=this.model.height));this._originalScrollWidth=t.isNullOrUndefined(this.model.scrollSettings.previousStateWidth)?this.model.scrollSettings.width:this.model.scrollSettings.previousStateWidth},_checkScrollActions:function(n){return!this.model.scrollSettings.allowVirtualScrolling&&(n==t.Grid.Actions.Sorting||n==t.Grid.Actions.Reorder)||n==t.Grid.Actions.Grouping||n==t.Grid.Actions.Ungrouping||n==t.Grid.Actions.Add||n==t.Grid.Actions.Cancel||n==t.Grid.Actions.Save||n==t.Grid.Actions.BatchSave||n==t.Grid.Actions.Delete||n==t.Grid.Actions.Filtering||n==t.Grid.Actions.Paging||n==t.Grid.Actions.Refresh||n==t.Grid.Actions.Search?!0:!1},_frozenAlign:function(){var r=this.getContent().first(),n=!t.isIOSWebView()&&this.getBrowserDetails(),i;i=this.model.enableRTL?"margin-right":"margin-left";r.find(".e-movablecontent").css(i,n&&n.browser==="safari"?"auto":r.find(".e-frozencontentdiv").width()+"px");this.getHeaderContent().find(".e-movableheader").removeAttr("style").css(i,n&&n.browser==="safari"?"auto":this.getHeaderContent().find(".e-frozenheaderdiv").width()+"px");this.getFooterContent()&&this.getFooterContent().find(".e-movablefooter").removeAttr("style").css(i,n&&n.browser==="safari"?"auto":this.getFooterContent().find(".e-frozenfooterdiv").width()+"px")},_refreshScroller:function(i){var r=this.getContent().first(),o,f,s,u,h,e,a,v,l,w;if(!t.isNullOrUndefined(r.data("ejScroller"))){if(this.model.scrollSettings.frozenColumns>0){if(this.model.scrollSettings.targetPane=this._gridRecordsCount||this._isAddNew?".e-movablecontent":null,this.getScrollObject().option({targetPane:this.model.scrollSettings.targetPane}),this._isFrozenColumnVisible())if(this._visibleColumns.length<=this.model.scrollSettings.frozenColumns){for(o=!1,f=this.model.scrollSettings.frozenColumns;f<this.model.columns.length;f++)if(this._visibleColumns.indexOf(this.model.columns[f].headerText)!=-1){o=!0;break}o||(r.find(".e-frozencontentdiv").removeAttr("style"),this.getHeaderContent().find(".e-frozenheaderdiv").removeAttr("style"),r.find(".e-movablecontent").width(0),r.find(".e-movablecontentdiv").width(0),r.find(".e-movablecontent").height(0),r.find(".e-movablecontentdiv").height(0))}else this._frozenAlign(),r.find(".e-movablecontent").scrollLeft(this.getHeaderContent().find(".e-movableheader").scrollLeft()),!t.isNullOrUndefined(this.getScrollObject()._vScrollbar)&&this.getScrollObject()._vScrollbar.value()>this.getScrollObject()._vScrollbar.model.maximum&&(u=this.getScrollObject()._vScrollbar.model.maximum);else r.find(".e-movablecontentdiv").removeAttr("style"),this.getHeaderContent().find(".e-movableheaderdiv").removeAttr("style"),this.getFooterContent()&&this.getFooterContent().find(".e-movablefooter").removeAttr("style"),r.find(".e-frozencontent").width(0),r.find(".e-frozencontentdiv").width(0),r.find(".e-frozencontent").height(0),r.find("e-frozencontentdiv").height(0);this.refreshScrollerEvent()}if(this.model.scrollSettings.frozenRows>0){for(this._initFrozenRows(),f=0;f<this.getRows().length;f++)n(this.getRows()[f]).filter(":hidden").css("display","table-row");!this.initialRender&&t.isNullOrUndefined(this.getScrollObject()._vScrollbar)&&this.element.height()>this.model.scrollSettings.height&&this.getContent().attr("tabindex","0").ejScroller(this.model.scrollSettings);u=this.getScrollObject().model.scrollTop;s=this.getScrollObject().model.scrollLeft;!t.isNullOrUndefined(this.getScrollObject()._vScrollbar)&&u>this.getScrollObject()._vScrollbar.model.maximum&&(u=this.getScrollObject()._vScrollbar.model.maximum);(i.requestType=="cancel"||i.requestType=="save")&&u>this._editFormHeight&&this.model.editSettings.editMode.indexOf("inlineform")!=-1&&(u=u-this._editFormHeight);i.requestType==t.Grid.Actions.Add&&this.getScrollObject().scrollY(0,!0);t.isNullOrUndefined(this.getScrollObject()._vScrollbar)||t.isNullOrUndefined(this.getScrollObject()._vScrollbar._scrollData)||(this.getScrollObject()._vScrollbar._scrollData.skipChange=!0)}if((i.requestType=="beginedit"||i.requestType=="save")&&!this.model.editSettings.editMode=="inlineformtemplate"&&!this.model.editSettings.editMode=="inlineform"&&(u=this.getScrollObject().model.scrollTop,this.getScrollObject().scrollY(0,!0)),!t.isNullOrUndefined(this.model.dataSource)&&(i.requestType=="refresh"||i.requestType=="searching")&&this.model.scrollSettings.allowVirtualScrolling&&(this.model.scrollSettings.enableVirtualization&&(this._isLocalData||this._virtualDataRefresh)&&this._gridRecordsCount>0?this._refreshVirtualView(this._currentVirtualIndex):this._refreshVirtualContent(1),this._currentVirtualIndex==1&&this.getScrollObject().scrollY(0)),this.model.scrollSettings.frozenColumns>0&&this.rowHeightRefresh(),this.getScrollObject().refresh(),r.ejScroller("model.enableRTL",this.model.enableRTL),this.model.isResponsive&&(i.requestType=="searching"||i.requestType=="filtering")&&(h=this.getScrollObject(),e=h.isHScroll()?this.getContentTable().height()+h.model.buttonSize:this.getContentTable().height(),e=typeof this.model.scrollSettings.height=="string"||e>this.model.scrollSettings.height?this.model.scrollSettings.height:e,a=typeof this.model.scrollSettings.width=="string"?this.element.width():this.model.scrollSettings.width,v=a,this.getContent().ejScroller({height:e,width:v})),this.getScrollObject().isVScroll()&&!this.getScrollObject().model.autoHide?(this.getHeaderContent().addClass("e-scrollcss"),this.getHeaderContent().find(".e-headercontent").hasClass("e-hscrollcss")||this.getHeaderContent().find(".e-headercontent").addClass("e-hscrollcss"),this.model.showSummary&&this.getScrollObject().isHScroll()&&!t.isNullOrUndefined(this.getFooterContent())?this.getFooterContent().find("div table").first().width(this.getContentTable().width()+this.model.scrollSettings.scrollerSize):this.getScrollObject().isHScroll()||t.isNullOrUndefined(this.getFooterContent())||this.getFooterContent().find("div table").first().width(this.getFooterContent().find("div").width())):this._showHideScroller(),this.model.scrollSettings.frozenColumns||!this.model.allowPaging||this.getScrollObject().isVScroll()||this.getScrollObject().isHScroll()||this.getContentTable().width()==this.getContent().width()||t.isNullOrUndefined(this.getFooterTable())||this.getFooterTable().width(this.getContentTable().width()),this._getRowHeights(),u&&!t.isNullOrUndefined(this.getScrollObject()._vScrollbar)&&i.requestType!=t.Grid.Actions.Add&&this.model.editSettings.editMode!="inlineformtemplate"&&this.model.editSettings.editMode!="inlineform"&&(this._currentTopFrozenRow=0,u>this.getScrollObject()._vScrollbar.model.maximum&&(u=this.getScrollObject()._vScrollbar.model.maximum),this.getScrollObject()._vScrollbar.scroll(u)),i.requestType=="beginedit"&&!t.isNullOrUndefined(this.getScrollObject()._vScrollbar)&&(this.model.editSettings.editMode=="inlineformtemplate"||this.model.editSettings.editMode=="inlineform")){var y=n("#"+this._id+"EditForm").parents("tr.e-editedrow")[0].offsetTop+n("#"+this._id+"EditForm").parents("tr.e-editedrow")[0].offsetHeight,b=this.getContent().find(".e-content"),k=b.height(),c=this.getScrollObject().scrollTop(),p=c+k;Math.round(y)>Math.round(p)?(l=this.getScrollObject()._vScrollbar.model.value+(y-p),this.getScrollObject()._vScrollbar.scroll(l),this.model.scrollSettings.scrollTop=l):(this.getScrollObject()._vScrollbar.scroll(c),this.model.scrollSettings.scrollTop=c)}s&&this.model.scrollSettings.frozenColumns>0&&i.requestType==t.Grid.Actions.BeginEdit&&this.getScrollObject()._hScrollbar.scroll(s);i.requestType=="virtualscroll"&&(w=this.getScrollObject().model.scrollTop+this.getScrollObject().model.height-this.getScrollObject().model.height*.3,this.getScrollObject().scrollY(w,!0));i.requestType=="sorting"&&this.model.scrollSettings.virtualScrollMode=="continuous"&&this.getScrollObject().scrollY(0,!0)}},_isFrozenColumnVisible:function(){for(var n=0;n<this.model.scrollSettings.frozenColumns;n++)if(this.model.columns[n].visible)return!0;return!1},_frozenPaneRefresh:function(){this.getContent().find(".e-frozencontentdiv").css("display","none");this.getHeaderContent().find(".e-frozenheaderdiv").css("display","none");this.getHeaderContent().find(".e-movableheader")[0].style["margin-left"]="";this.getContent().find(".e-movablecontent")[0].style["margin-left"]="";var i=t.isNullOrUndefined(this._scrollObject._vScrollbar)?0:this._scrollObject._vScrollbar["e-vscroll"].width(),n=this.model.scrollSettings.width-i-1;this.model.scrollSettings.width>this.getContent().find(".e-movablecontentdiv").width()&&(this.getContent().find(".e-movablecontentdiv").width(n),this.getHeaderContent().find(".e-movableheaderdiv").width(n),t.isNullOrUndefined(this.getFooterContent())||this.getFooterContent().find(".e-movablefooterdiv").width(n));this._scrollObject.option("scrollLeft",0)},_renderScroller:function(){var o,r,e,u,i,l,f,s,h,c;if(this.model.scrollSettings||(this.model.scrollSettings={}),this.model.enablePersistence&&(t.isNullOrUndefined(this.model.scrollSettings.previousStateWidth)||!this.model.scrollSettings.previousStateWidth)&&this.model.isResponsive&&(this.model.scrollSettings.previousStateWidth=this.model.scrollSettings.width),typeof this._originalScrollWidth!="string"||this.model.isResponsive||(this.element.css("width","auto"),r=this.element.width(),(this.model.scrollSettings.width=="auto"||this._originalScrollWidth=="auto")&&(this._originalScrollWidth="100%"),this.model.scrollSettings.width=r*(parseFloat(this._originalScrollWidth)/100)),typeof this.model.scrollSettings.height!="string"||this.model.isResponsive||(o=this.element.height(),this.model.scrollSettings.height=="auto"&&(this.model.scrollSettings.height="100%"),this.model.scrollSettings.height=o*(parseFloat(this.model.scrollSettings.height)/100)),(this.model.scrollSettings.width||this.model.width)&&!this._mediaQuery&&(r=this.model.scrollSettings.width||this.model.width,typeof r=="string"?this.element.css("width",this.model.scrollSettings.width||this.model.width):this.element.width(this.model.scrollSettings.width||this.model.width)),e=this.getContent().attr("tabindex","0"),l=this.getRows(),this.model.scrollSettings.frozenColumns>0){for(f=0;f<this.getRows().length;f++)n(this.getRows()[f]).filter(":hidden").css("display","table-row");if(s=this.getContent().find(".e-frozencontentdiv").width()+20,s>this.model.scrollSettings.width){this.getContent().remove();this.getHeaderTable().eq(1).remove();this._alertDialog.find(".e-content").text(this.localizedLabels.FrozenColumnsViewAlert);this._alertDialog.ejDialog("open");return}u=this.getContent().find(".e-frozencontentdiv").width();i=this.model.enableRTL?"margin-right":"margin-left";this.getContent().find(".e-movablecontent").css(i,u+"px");this.getHeaderContent().find(".e-movableheader").css(i,u+"px");t.isNullOrUndefined(this.getFooterContent())||this.getFooterContent().find(".e-movablefooter").css(i,u+"px");this.model.scrollSettings.targetPane=".e-movablecontent"}else this.model.scrollSettings.targetPane=null;this._initFrozenRows();this.model.scrollSettings.autoHide&&(this.model.scrollSettings.show=n.proxy(this._showHideScroller,this));!this.model.scrollSettings.allowVirtualScrolling&&this.model.currentIndex>0&&!this.model.scrollSettings.scrollTop&&t.isNullOrUndefined(this.getContent().data("ejScroller"))&&(h=this.model.currentIndex*this.getRowHeight(),this.model.scrollSettings.scrollTop=h);e.ejScroller(this.model.scrollSettings);this.model.allowRowDragAndDrop&&this.model.allowScrolling&&t.gridFeatures.dragAndDrop&&e.ejScroller({thumbStart:function(){return!1}});this.model.rowTemplate==null||t.isIOSWebView()||this.getBrowserDetails().browser!="msie"&&this.getBrowserDetails().browser!="safari"||this.getScrollObject().refresh();this.model.scrollSettings.frozenColumns>0&&this.model.scrollSettings.frozenRows==0&&this.getScrollObject()._vScrollbar&&this.getScrollObject()._hScrollbar&&(this.getScrollObject()._vScrollbar._scrollData.skipChange=this.getScrollObject()._hScrollbar._scrollData.skipChange=!0);this.model.scrollSettings.autoHide||this._showHideScroller();!t.isIOSWebView()&&this.getBrowserDetails().browser=="safari"&&this.model.scrollSettings.frozenColumns>0&&this.getHeaderContent().find(".e-movableheader").add(this.getContent().find(".e-movablecontent")).css(i,"auto");this.refreshScrollerEvent();this.model.scrollSettings.frozenColumns>0&&!this._isFrozenColumnVisible()&&this._frozenPaneRefresh();this.model.scrollSettings.allowVirtualScrolling&&(c=this._refreshVirtualPagerInfo(),this._showPagerInformation(c),this.refreshScrollerEvent())},_checkScroller:function(n,t){var i=n.scrollLeft>0?n.scrollLeft:Math.abs(n.scrollLeft),r;n.source=="thumb"&&(t.content()[0].scrollWidth-i==t.content()[0].clientWidth||i==0)&&(this.model.enableRTL&&(r=i==0?n.scrollData.scrollable:0,n.scrollData.sTop=n.model.scrollLeft=r,t.content().scrollLeft(r)),t._hScrollbar.refresh())},_showHideScroller:function(){this.getScrollObject().isVScroll()?(this.getHeaderContent().find("div").first().addClass("e-headercontent"),this.model.showSummary&&!t.isNullOrUndefined(this.getFooterContent())&&this.getFooterContent().find("div").first().addClass("e-footercontent"),this.model.scrollSettings.autoHide||this.getHeaderContent().addClass("e-scrollcss")):this.element.find(".e-gridheader").removeClass("e-scrollcss");this.model.scrollSettings.frozenColumns!=0||this._mediaQuery||(!this.element.find(".e-gridheader").hasClass("e-scrollcss")&&(this.model.filterSettings.filteredColumns.length||this._hiddenColumns.length&&!this.model.minWidth)?(this.getHeaderTable().removeAttr("style"),this.getContentTable().removeAttr("style"),this.model.showSummary&&!t.isNullOrUndefined(this.getFooterTable())&&this.getFooterTable().removeAttr("style")):this.model.showSummary&&!t.isNullOrUndefined(this.getFooterContent())&&this.getScrollObject().isVScroll()&&this.getScrollObject().isHScroll()&&(this.model.minWidth&&this.model.isResponsive?this.getFooterContent().find("div table").first().width(this.getContentTable().width()+this.model.scrollSettings.scrollerSize):this.getFooterContent().find("div table").first().width(this.getContentTable().width()),this.getFooterContent().find("div").width(this.getHeaderContent().width()+this.model.scrollSettings.scrollerSize)));this._isHscrollcss()},_isHscrollcss:function(){var n=this.getContent().data("ejScroller"),i=n&&n.isVScroll()&&!t.isNullOrUndefined(n._vScrollbar)&&n._vScrollbar.element[0].style.display!="none"?"addClass":"removeClass";this.getHeaderContent().find(".e-headercontent")[i]("e-hscrollcss");this.getHeaderContent()[i]("e-scrollcss")},_initFrozenRows:function(){var i=this.getRows(),r;this.model.currentViewData&&this.model.currentViewData.length!=0&&this.model.scrollSettings.frozenRows>0&&i!=null&&(this.getContent().find(".e-frozeny").removeClass("e-frozeny").end().find(".e-frozenrow").removeClass("e-frozenrow"),!t.isNullOrUndefined(i[0][this.model.scrollSettings.frozenRows-1])&&!t.isNullOrUndefined(i[1][this.model.scrollSettings.frozenRows-1])&&this.model.scrollSettings.frozenColumns>0?n(i[0][this.model.scrollSettings.frozenRows-1].cells).add(i[1][this.model.scrollSettings.frozenRows-1].cells).addClass("e-frozeny").parent().addClass("e-frozenrow"):t.isNullOrUndefined(this.getRowByIndex(this.model.scrollSettings.frozenRows-1)[0])||n(i[this.model.scrollSettings.frozenRows-1].cells).addClass("e-frozeny").parent().addClass("e-frozenrow"),this.getContent().height()>this.model.scrollSettings.height&&(r=t.isNullOrUndefined(this.getContent().data("ejScroller"))?null:this.getScrollObject(),this.initialRender||t.isNullOrUndefined(r)||!t.isNullOrUndefined(r._vScrollbar)||this._getRowHeights(),this.model.scrollSettings.height=this._rowHeightCollection[Math.floor(this.model.scrollSettings.height/this._rowHeightCollection[1])]+18))},refreshScrollerEvent:function(){var i=this,u=this.getContent().attr("tabindex","0"),r=u.data("ejScroller");t.isNullOrUndefined(r)||r.model.scroll!=null||u.ejScroller({scroll:function(r){var l,u,o,s,h,e,a,c;if(t.isNullOrUndefined(r.scrollData)||r.scrollData.scrollVal!="scrollLeft"||(i.model.scrollSettings.targetPane||!t.isNullOrUndefined(i.getHeaderContent())&&i.getHeaderContent().find(".e-movableheader").length?i.getHeaderContent().find(".e-movableheader").scrollLeft(r.scrollLeft):i.getHeaderContent().find("div").first().scrollLeft(r.scrollLeft),i.model.scrollSettings.frozenRows>0&&i.model.editSettings.editMode.indexOf("inlineform")!=-1&&i.model.isEdit&&(l=r.scrollTop,i.getContent().find(".e-content").scrollTop(0),this.scrollY(this.model.scrollTop+l,!0))),i.model.scrollSettings.frozenRows>0&&i.getRows()!=null)if(r.scrollData!=null&&r.scrollData.dimension!="width"){r.cancel=!0;var y=i.getRows(),v=i._getTopRow(r.scrollTop),f=v.imaginaryIndex;if(f>i._currentTopFrozenRow?i._showHideRow(i.model.scrollSettings.frozenRows,f,"hide",r.scrollTop):f<i._currentTopFrozenRow&&i._showHideRow(f,i._currentTopFrozenRow+1,"show",r.scrollTop),u=i.getContentTable().last().find("tr"),o=parseInt(u.last().find("td:first").css("border-top-width"))*2+1,r.scrollTop==this._vScrollbar.model.maximum&&u.last()[0].offsetTop+u.last().height()-o>i.element.find(".e-content").height()){for(s=u.last().prev()[0].offsetTop+u.last().prev().height(),h=1,e=u.length-2;s-o>i.element.find(".e-content").height();e++){s=u[e].offsetTop+u.eq(e).height();h++;break}i._showHideRow(i.model.scrollSettings.frozenRows,f+h,"hide",r.scrollTop)}r.model.scrollTop=r.scrollTop}else t.isNullOrUndefined(this._vScrollbar)||t.isNullOrUndefined(this._vScrollbar._scrollData)||(this._vScrollbar._scrollData.skipChange=!0);i.model.scrollSettings.allowVirtualScrolling&&(i.model.scrollSettings.enableVirtualization&&r.scrollData!=null&&r.scrollData.handler!="e-hhandle"?(r.reachedEnd=r.scrollData.scrollable-r.scrollTop==0,r.source=="thumb"&&(a=t._getObjectKeys(i._virtualLoadedRows),c=(i._currentVirtualIndex+2).toString(),i.model.scrollSettings.virtualScrollMode=="continuous"&&n.inArray(c,a)==-1&&c<i._totalVirtualViews?i._isContinuous=!0:(r.model.scrollTop=r.scrollTop,i._isContinuous=!1,r.cancel=!0)),(r.source=="button"||r.source=="key"||r.source=="wheel"||r.source=="custom"&&r.model.keyConfigs.down==""||r.source=="thumb"&&r.originalEvent=="touchmove")&&(n("#"+i._id+"_WaitingPopup").is(":visible")?r.cancel=!0:(i._isThumbScroll=!1,i._virtualViewScroll(r)),i.model.scrollSettings.virtualScrollMode=="continuous"&&r.reachedEnd&&this.refresh()),i.model.currentIndex=r.scrollTop==0?r.scrollTop:Math.floor(r.scrollTop/i._vRowHeight)):(!t.isNullOrUndefined(r.scrollData)&&r.scrollData.handler=="e-hhandle"&&i.model.allowFiltering&&(i.model.filterSettings.filterType=="menu"||i._isExcelFilter)&&(i._isExcelFilter?i._excelFilter.closeXFDialog():i._closeFilterDlg()),r.reachedEnd=this.content()[0].scrollHeight-r.scrollTop==this.content()[0].clientHeight,(r.source=="button"||r.source=="key"||r.source=="wheel")&&i.model!=null&&(n("#"+i._id+"_WaitingPopup").is(":visible")?r.cancel=!0:i._virtualScroll(r)),r.source=="wheel"&&r.scrollTop!=i._scrollValue&&(r.scrollTop=i._scrollValue),i._checkScroller(r,this)));i.model.scrollSettings.frozenRows||i.model.scrollSettings.frozenColumns||(t.isNullOrUndefined(r.scrollData)||r.scrollData.handler!="e-hhandle"?(i._scrollValue=r.scrollTop,i.model.currentIndex=r.scrollTop==0?r.scrollTop:Math.floor(r.scrollTop/i._vRowHeight)):(i.model.allowFiltering&&(i.model.filterSettings.filterType=="menu"||i._isExcelFilter)&&(i._isExcelFilter?i._excelFilter.closeXFDialog():i._closeFilterDlg()),i._checkScroller(r,this)))},scrollStop:function(t){if(i.model.scrollSettings.allowVirtualScrolling){if(i.model.scrollSettings.enableVirtualization&&i.model.scrollSettings.virtualScrollMode=="continuous"?t.reachedEnd=t.scrollData.scrollable-t.model.scrollTop==0:t.originalEvent&&!n(t.originalEvent.target).hasClass("e-rowcell")&&(t.reachedEnd=this.content()[0].scrollHeight-t.scrollData.sTop==this.content()[0].clientHeight),t.scrollData.handler=="e-hhandle")return;i.model!=null&&t.originalEvent&&(i.model.scrollSettings.enableVirtualization?(i._isThumbScroll=!0,i._virtualViewScroll(t),i.model.scrollSettings.virtualScrollMode=="continuous"&&t.reachedEnd&&this.refresh()):i._virtualScroll(t))}},scrollHide:function(){i.getHeaderContent().find(".e-headercontent").removeClass("e-hscrollcss");i.getHeaderContent().removeClass("e-scrollcss");i.getHeaderContent().css({"padding-right":"0px"})},scrollVisible:function(n){var t=n.model.scrollerSize-1;r&&r.isVScroll()&&(i.getHeaderContent().find(".e-headercontent").addClass("e-hscrollcss"),i.getHeaderContent().css({"padding-right":t}),i.getHeaderContent().addClass("e-scrollcss"))},thumbEnd:function(t){if(i.model.scrollSettings.allowVirtualScrolling){if(i.model.scrollSettings.enableVirtualization&&i.model.scrollSettings.virtualScrollMode=="continuous"?t.reachedEnd=t.scrollData.scrollable-t.model.scrollTop==0:t.originalEvent&&!n(t.originalEvent.target).hasClass("e-rowcell")&&(t.reachedEnd=this.content()[0].scrollHeight-Math.round(t.scrollData.sTop)==this.content()[0].clientHeight),t.scrollData.handler=="e-hhandle")return;i.model!=null&&t.originalEvent&&(i.model.scrollSettings.enableVirtualization?(i._isThumbScroll=!0,i._virtualViewScroll(t),i.model.scrollSettings.virtualScrollMode=="continuous"&&t.reachedEnd&&this.refresh()):i._virtualScroll(t))}},scrollEnd:function(t){var r,u,f;if(i.model.scrollSettings.allowVirtualScrolling){if(t.scrollData.type=="mousewheel"||t.scrollData.model!=null&&t.scrollData.model.orientation=="horizontal")return;if(r=i._calculateCurrentVirtualIndex(t),!i._checkCurrentVirtualView(i._virtualLoadedRows,r)&&t.scrollData.source!="thumb")return;i.model.scrollSettings.enableVirtualization&&!i._isContinuous&&(u=i._calculateCurrentViewPage(t.model),f=n.inArray(u,i._virtualLoadedPages)!=-1,f?(i._isThumbScroll=!0,i._virtualViewScroll(t),i.element.ejWaitingPopup("hide"),i._totalVirtualViews<=i._maxViews*3&&(this._content[0].scrollTop=t.scrollData.scrollTop)):t.cancel=!0)}}});this.element.find(".e-gridheader").find(".e-headercontent,.e-movableheader").scroll(t.proxy(function(i){var r=n(i.currentTarget);this.model.scrollSettings.targetPane?(this.getContent().find(".e-movablecontent").scrollLeft(r.scrollLeft()),this.model.showSummary&&!t.isNullOrUndefined(this.getFooterContent())&&this.getFooterContent().find(".e-movablefooter").scrollLeft(r.scrollLeft())):(this.model.showSummary&&!t.isNullOrUndefined(this.getFooterContent())&&this.getFooterContent().find("div").first().scrollLeft(r.scrollLeft()),this.getContent().find(".e-content").first().scrollLeft(r.scrollLeft()))},this))},clearFiltering:function(n){var i,t;if(this.model.filterSettings.filterType=="filterbar"&&(this.OldfilterValue=null),n){if(this._clearFilter(n),this.model.filterSettings.filterType!="filterbar")for(t=0;t<this.filterColumnCollection.length;t++)this.filterColumnCollection[t].field==n&&this.filterColumnCollection.splice(t,1)}else{for(i=this.model.filterSettings.filteredColumns,t=0;t<i.length;)this._clearFilter(i[t].field);this.filterColumnCollection=[];(this.model.filterSettings.filterType=="menu"||this.model.filterSettings.filterType=="excel")&&this.getHeaderTable().find(".e-filtericon").removeClass("e-filteredicon e-filternone")}},_clearFilter:function(i){var f=this.model.filterSettings.filterType,u,r;t.isNullOrUndefined(this.getColumnByField(i).filterType)||(f=this.getColumnByField(i).filterType);switch(f){case t.Grid.FilterType.FilterBar:n.inArray(this.getColumnByField(i),this.filterColumnCollection)!=-1&&(u=this.getColumnIndexByField(i),this.getHeaderTable().find(".e-filtertext").eq(u).val(""),this._currentFilterbarValue="",u=n.inArray(i,this.filterColumnCollection),this._currentFilterColumn=this.getColumnByField(i),this._showFilterMsg());break;case t.Grid.FilterType.Menu:r="#"+this._id+"_"+this._$colType+"Dlg";this._$colType=="boolean"?n(r).find(".e-value .e-js").ejCheckBox("model.checked",!1):this._$colType=="number"?n(r).find(".e-numerictextbox.e-js").ejNumericTextbox("model.value",""):n(r).find(".e-value input").val("");n(r).find(".e-value1 input").val("");(this._excelFilterRendered||this._isExcelFilter)&&this._excelFilter._predicates.length&&delete this._excelFilter._predicates[0][i];this._$curFieldName=i;break;case t.Grid.FilterType.Excel:this._excelFilter._predicates.length&&delete this._excelFilter._predicates[0][i];this._excelFilter.closeXFDialog();this._$curFieldName=i}this.filterColumn(i,"","","or")},clearSearching:function(){this.element.find(".e-gridtoolbar #"+this._id+"_search").val("");this.search("");n.extend(this.model.searchSettings,this.defaults.searchSettings)},_renderByFrozenDesign:function(){var r=n(document.createElement("div")),u=this._getMetaColGroup().find("col"),i={};i.colgroup1=r.append(t.buildTag("colgroup").append(u.splice(0,this.model.scrollSettings.frozenColumns))).html();i.colgroup2=r.html(t.buildTag("colgroup").append(u)).html();this.getContent().find("div").first().get(0).innerHTML=n.render[this._id+"_FrozenTemplate"]({datas:this.model.currentViewData},i);this.setGridContentTable(this.getContent().find(".e-table").attr("data-role","grid"))},addFrozenTemplate:function(){var i="<div class='e-frozencontentdiv'><table class='e-table'>{{:~colgroup1}}<tbody>{{for datas tmpl='"+this._id+"_JSONFrozenTemplate'/}}<\/tbody><\/table><\/div><div class='e-movablecontent'><div class='e-movablecontentdiv'><table class='e-table'>{{:~colgroup2}}<tbody>{{for datas tmpl='"+this._id+"_JSONTemplate'/}}<\/tbody><\/table><\/div><\/div>",t={};t[this._id+"_FrozenTemplate"]=i;n.templates(t)},_getTopRow:function(n){var i=this.model.scrollSettings.frozenRows,t=0;if(n>10)for(t=0;t<this._rowHeightCollection.length;t++)if(this._rowHeightCollection[t]>n){i=this.model.scrollSettings.frozenRows+t-1;break}return{imaginaryIndex:i,actualIndex:t}},_showHideRow:function(t,i,r,u){var f=this.getRows();this.model.scrollSettings.frozenColumns>0?n(f[0]).slice(t,i).add(n(f[1]).slice(t,i).toArray())[r]():n(f).slice(t,i)[r]();this._currentTopFrozenRow=r=="show"?t:i;this.getScrollObject()._changevHandlerPosition(u)},_renderAlertDialog:function(){var r=t.buildTag("div.e-content",this._getLocalizedLabels().frozenColumnsMessage),i=t.buildTag("span.e-buttons","<input type='button' class='e-flat' id="+this._id+"ConfirmDialogOK value='"+this._getDeprecatedLocalizedLabel("OKButton")+"'/>");this._alertDialog=t.buildTag("div#"+this._id+"AlertDialog");this._alertDialog.append(r).append(i);this.element.append(this._alertDialog);i.find("input").ejButton({cssClass:this.model.cssClass,showRoundedCorner:!0,size:"mini",click:n.proxy(function(){this._alertDialog.ejDialog("close")},this)});this._renderFDialog(this._id+"AlertDialog");this._alertDialog.ejDialog({width:"auto",enableModal:!0})},_renderFDialog:function(t){n("#"+t).ejDialog({showOnInit:!1,enableRTL:this.model.enableRTL,cssClass:this.model.cssClass,showHeader:!1,width:260,enableResize:!1,allowKeyboardNavigation:!1,content:"#"+this._id})},_virtualScroll:function(t){var r,e;if(this.selectedRowsIndexes.length==this._gridRecordsCount&&this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").prop("checked","checked"),t!=null){var f=0,o=this.model.filterSettings.filteredColumns.length==0?this._searchCount==null?this._gridRecordsCount:this._searchCount:this._filteredRecordsCount,u=this.model.pageSettings,s=this.getContentTable()[0].tBodies[0],h=n(s).find("tr.e-virtualrow");if(u.totalPages=Math.ceil(o/u.pageSize),t.scrollTop!==i&&(t.model.scrollTop=t.scrollTop),t.reachedEnd!=i&&(t.model.reachedEnd=t.reachedEnd),r=this._calculateCurrenPage(h,this.getContentTable(),t.model),r>u.totalPages&&(r=u.totalPages),u.currentPage!=r&&n.inArray((r-1)*u.pageSize,this.virtualLoadedPages)==-1&&this.element.find(".gridform:visible").length==0&&(this._isVirtualRecordsLoaded=!1),this._isVirtualRecordsLoaded)u.currentPage=r;else{if(n.inArray((r-1)*u.pageSize,this.virtualLoadedPages)==-1){if(this.model.scrollSettings.virtualScrollMode=="continuous"&&!t.reachedEnd)return;r==u.totalPages&&n.inArray((r-2)*u.pageSize,this.virtualLoadedPages)==-1&&(f++,this.set_currentPageIndex(r));f==1&&(this._lastRow=!0);this.set_currentPageIndex(r)}u.currentPage=r}e=this._refreshVirtualPagerInfo();this._showPagerInformation(e)}},_virtualViewScroll:function(t){if(t!=null){t.scrollTop!==i&&(t.model.scrollTop=t.scrollTop);t.reachedEnd!=i&&(t.model.reachedEnd=t.reachedEnd);var r=this._calculateCurrentVirtualIndex(t);this.model.isEdit&&this.cancelEdit();n.inArray(r,this._currentLoadedIndexes)==-1&&(this._isVirtualRecordsLoaded=!1);this._isVirtualRecordsLoaded||this.set_currentVirtualIndex(r)}},_createPagerStatusBar:function(){var n=this.element.find(".e-pagerstatusbar"),i,r;n.length&&n.remove();i=t.buildTag("div.e-pagermsgdiv");this.$pagerStatusBarDiv=t.buildTag("div.e-pagerstatusbar").append(i);this.model.scrollSettings.allowVirtualScrolling&&this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&(r=t.buildTag("div.e-pagerfiltermsg").css("display","none"),this.$pagerStatusBarDiv.append(r));this.$pagerStatusBarDiv.appendTo(this.element);this.$pagerStatusBarDiv.css("display","none")},_refreshVirtualContent:function(t){var e=this.getRowHeight(),o=this.model.filterSettings.filteredColumns.length==0?this._searchCount==null?this._gridRecordsCount:this._searchCount:this._filteredRecordsCount,s,h,r,i,f,c,l,a,u;t!=null&&(this._currentPage(t),s=this._refreshVirtualPagerInfo(),this._showPagerInformation(s));h=this.model.currentViewData;this.model.scrollSettings.enableVirtualization||(this._virtualLoadedRecords[t]=h);r=0;this.model.scrollSettings.enableVirtualization&&(r=1);i=r==1?this.getCurrentIndex()+1:this.getCurrentIndex();f=this.getContentTable()[0].tBodies[0];i>1&&(c=document.createElement("tr"),n(c).addClass("e-virtualrow").css("height",e*i).prependTo(f));i+this.model.pageSettings.pageSize<=o&&this.getContentTable().find("tr").last().hasClass("e-virtualrow")!=!0&&this.model.scrollSettings.frozenColumns==0&&(l=document.createElement("tr"),a=this.model.scrollSettings.virtualScrollMode=="normal"?e*(o-(i+this.model.pageSettings.pageSize)):1,n(l).addClass("e-virtualrow").css("height",a).appendTo(n(f)));this.virtualLoadedPages=[];this.orderedVirtualLoadedPage=[];this.virtualLoadedPages.push(i>=r?i:r);this.orderedVirtualLoadedPage.push(i>=r?i:r);u=n(f).find("tr:not(.e-virtualrow)").attr("name",i>=r?i:r)[0];u&&u.previousSibling&&(n(u.previousSibling).hasClass("e-virtualrow")||u.previousSibling.offsetTop>i*this.getContent().height())&&(this.getContent().children("div").first().scrollTop(this.getContent().find(".content").scrollTop()-(this.getContent().find(".content").scrollTop()-u.offsetTop)),this._isVirtualRecordsLoaded=!0)},isIntermediate:function(){return this.model.currentIndex<this.model.pageSettings.pageSize*(this.model.pageSettings.currentPage-1)?!0:!1},_refreshVirtualView:function(i,r,u){var o,s,e,v,c,a,h,f;if(this._singleView)this._singleView=!1,this._addLastRow(),this.getContent().find(".e-virtualtop, .e-virtualbottom").remove(),h=this._currentVirtualIndex.toString(32),n(this._gridRows).attr("name",h),this._virtualLoadedRows[this._currentVirtualIndex]=this._gridRows,this._eventBindings();else{if(o=this._virtualRowCount,i)i>this._totalVirtualViews&&(i=1,s=!0),r=="selectRows"&&(s=!0),this._currentVirtualIndex=i,this._virtualLoadedRecords[i]?(v=this.getScrollObject(),e=Math.ceil((v.scrollTop()+this.model.scrollSettings.height)/this._vRowHeight/this.model.pageSettings.pageSize)):(this._virtualDataRefresh||this._currentVirtualIndex==this._totalVirtualViews||(s=!0),e=Math.ceil(i*this._virtualRowCount/this.model.pageSettings.pageSize)),this._refreshVirtualViewScroller(s,r,u),e>this.model.pageSettings.totalPages&&(e=this.model.pageSettings.totalPages),e<=0&&(e=1),n.inArray(e,this._virtualLoadedPages)==-1?this.gotoPage(e):(this._currentPage(e),this._needPaging=this._checkCurrentVirtualView(this._virtualLoadedRecords,i)?!1:!0,this._getVirtualLoadedRecords(this.model.query),this._replacingVirtualContent());else{if(this._refreshVirtualViewDetails(),c=n(this.getContentTable()[0].rows),this._setVirtualTopBottom(),this.initialRender){for(f=0;f<this._currentLoadedIndexes.length;f++){var l=this._currentLoadedIndexes[f],p=(f+1)*o,y=f*o;n(c[p-1]).addClass("e-virtualview"+l);h=l.toString(32);a=c.slice(y,y+o).attr("name",h).detach();this._virtualLoadedRows[l]=a;a.appendTo(this.getContentTable())}this._currentVirtualIndex>1&&this._refreshVirtualViewScroller()}this._eventBindings()}n.inArray(this._currentPage(),this._virtualLoadedPages)==-1&&this._virtualLoadedPages.push(this._currentPage())}if(!i&&(this.model.queryCellInfo||this.model.rowDataBound))for(f=0;f<this._currentLoadedIndexes.length;f++)n.inArray(this._currentLoadedIndexes[f],this._queryCellView)!=-1||t.isNullOrUndefined(this._virtualLoadedRows[this._currentLoadedIndexes[f]])||this._queryCellView.push(this._currentLoadedIndexes[f]);this._isThumbScroll=!1;this._virtualDataRefresh=!1},_refreshVirtualViewData:function(){this._virtualSelectedRowIndex=[];this._virtualLoadedRecords={};this._virtualLoadedRows={};this._virtualLoadedPages=[];this._virtualPageRecords={};this._queryCellView=[];this.model.pageSettings.totalPages!=null&&(this._currentPage()>this.model.pageSettings.totalPages||!this.model.pageSettings.totalPages)&&(this._currentPage(1),this._currentVirtualIndex=1)},setCurrentPageData:function(n){this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(this._refreshVirtualViewData(),this._refreshVirtualViewDetails(),this._setVirtualLoadedRecords(n,this._currentPage()),this._refreshVirtualView(this._currentVirtualIndex))},_refreshVirtualViewScroller:function(n,t,i){var r,u;(this.initialRender&&!this.model.scrollSettings.scrollTop||n)&&(u=this._vRowHeight,r=this.model.currentIndex*this._vRowHeight);r=t=="selectRows"?i*this._vRowHeight:this._scrollObject.model.scrollTop;this.getContent().ejScroller("model.scrollTop",r);this._scrollValue=r},_calculateCurrentViewPage:function(n){n||(n=this._scrollObject.model);var i=this.model.pageSettings.pageSize,t=Math.ceil((n.scrollTop+this.model.scrollSettings.height)/this._vRowHeight/i);return this.model.pageSettings.totalPages==null&&(this.model.pageSettings.totalPages=Math.ceil(this._getVirtualTotalRecord()/i)),t>this.model.pageSettings.totalPages&&(t=this.model.pageSettings.totalPages),this.model.pageSettings.currentPage=t,t},_calculateCurrentVirtualIndex:function(t){var h=t.model,y=this._getVirtualTotalRecord(),i,c,l,u=[],e,o,a,r=h.scrollTop,p=r+this.model.scrollSettings.height,s,v,f;if(i=(r+this._vRowHeight)/this._vRowHeight/this._virtualRowCount,i=Math.ceil(i),r>=this._scrollValue&&h.virtualScrollMode=="continuous"&&h.reachedEnd&&(i=i+1),i>this._totalVirtualViews&&(i=this._totalVirtualViews),i<=0&&(i=1),n.inArray(i,this._currentLoadedIndexes)!==-1&&this._virtualLoadedRows[i]&&r!=t.scrollData.scrollable){for(s=this.getContentTable()[0].rows,a=s.length,v=this.getContent().find(".e-virtualtop").height(),l=r>=this._scrollValue,f=0;f<a;f++){if(e=s[f],o=e.offsetHeight+e.offsetTop+v,o>r+this.model.scrollSettings.height){u.length===0&&f!==0&&(u=[s[e.offsetTop<=r+this.model.scrollSettings.height?f:f-1]]);break}if(o>=r&&o<=r+this.model.scrollSettings.height&&(u.push(e),l===!1&&u.length>1))break}c=n(r>=this._scrollValue?u[u.length-1]:u[0]);c.length&&(i=parseInt(c.attr("name"),32))}return this._scrollValue=r,i},_calculateCurrenPage:function(t,i,r){var o=this.model.pageSettings.pageSize,u,a=this,v,w,f=[],s,h,b,k,y,g=this.getRowHeight(),c,e,l,p,d;if(u=(r.scrollTop+this.model.scrollSettings.height)/g/o,k=this.model.pageSettings.pageSize*(this.model.pageSettings.currentPage-1),y=this.getContentTable().find("tr[name="+k+"]").eq(0),u=y.length&&y.offset().top>0&&u>=1&&r.scrollTop<this._scrollValue&&this.virtualLoadedPages.indexOf(Math.ceil(u-1)*o)!==-1?Math.floor(u):Math.ceil(u),r.scrollTop>=this._scrollValue&&r.virtualScrollMode=="continuous"&&r.reachedEnd&&(u=this.virtualLoadedPages[this.virtualLoadedPages.length-1]/o+2),n.inArray((u-1)*o,this.virtualLoadedPages)!==-1){for(c=this.getContentTable().children("tbody").children("tr"),b=c.length,w=r.scrollTop>=this._scrollValue,e=0;e<b;e++){if(s=c[e],h=s.offsetHeight+s.offsetTop,h>r.scrollTop+a.model.scrollSettings.height){f.length===0&&e!==0&&(f=[c[s.offsetTop<=r.scrollTop+a.model.scrollSettings.height?e:e-1]]);break}if(h>=r.scrollTop&&h<=r.scrollTop+a.model.scrollSettings.height&&(f.push(s),w===!1&&f.length>1))break}v=n(r.scrollTop>=this._scrollValue?f[f.length-1]:f[0]);v.hasClass("e-virtualrow")?f.length===1&&u++:u=parseInt(v.attr("name"),10)/o+1}for(this._scrollValue=r.scrollTop,l=0;l<t.length;l++)if(p=t[l],p.offsetTop+p.offsetHeight>=r.scrollTop)return d=this._calculatePrevPage(t,i,r),this._prevPageNo=d,u==0&&(u=1),u>this.model.pageSettings.totalPages?this.model.pageSettings.totalPages:u;return u},_calculatePrevPage:function(t,i,r){for(var f,e,u=0;u<t.length;u++)if(f=t[u],f.offsetTop+f.offsetHeight>=r.scrollTop&&(e=n(f).prevAll("tr[name]")[0],e!=null))return Math.ceil(parseInt(n(e).attr("name"),10)/this.model.pageSettings.pageSize)+1;return-1},_refreshVirtualPagerInfo:function(){var n={};return n.pageSize=this.model.pageSettings.pageSize,n.totalRecordsCount=this.model.filterSettings.filteredColumns.length==0?this._searchCount==null?this._gridRecordsCount:this._searchCount:this._filteredRecordsCount,n.totalRecordsCount==0&&this._currentPage(0),n.currentPage=this._currentPage(),n.totalPages=Math.ceil(n.totalRecordsCount/n.pageSize),n},_showPagerInformation:function(t){var i=(t.currentPage-1)*t.pageSize;n(this.$pagerStatusBarDiv).find("div:first").html(String.format(this.localizedLabels.PagerInfo,t.currentPage,t.totalPages,t.totalRecordsCount),i,i+t.pageSize);n(this.$pagerStatusBarDiv).css("display","block")},_headerCellMerge:function(n){n.headerCellMerge=function(n,i){var u=this.model.showStackedHeader&&this.model.stackedHeaderRows.length?this.columnHeaders.parent().find("tr:not('.e-stackedHeaderRow')"):this.columnHeaders,r;for(u.find("th").eq(n).attr("colspan",i),r=1;r<i;r++)t.isNullOrUndefined(u[0].children[n+r])||(u[0].children[n+r].className+=" e-hide")}},_cellMerging:function(i){i.colMerge=function(n){if(this.cell.className.indexOf("e-colmerge")==-1){this.cell.className+=" e-colmerge";this.model.columns.length-this.cell.cellIndex<n&&(n=this.model.columns.length-this.cell.cellIndex);this.cell.colSpan=n;for(var i=1;i<n;i++)t.isNullOrUndefined(this.cell.parentElement.children[this.cell.cellIndex+i])||(this.cell.parentElement.children[this.cell.cellIndex+i].className+=" e-hide")}};i.rowMerge=function(i){var r,u;if(this.cell.className.indexOf("e-rowmerge")==-1)for(this.cell.className+=" e-rowmerge",r=this.cell.parentNode.parentNode,r.rows.length-this.cell.parentElement.rowIndex<i&&(i=r.rows.length-this.cell.parentElement.rowIndex),this.cell.rowSpan=i,u=0;u<i-1;u++)if(t.isNullOrUndefined(r.children[this.cell.parentElement.rowIndex+u].nextSibling))break;else(!n(".e-grid").children().is(".e-dialog")||n(".e-grid").find(".e-dialog").attr("style").indexOf("display: none")!=-1||this.model.allowFiltering)&&(r.children[this.cell.parentElement.rowIndex+u].nextSibling.children[this.cell.cellIndex].className+=" e-merged e-hide")};i.merge=function(r,u){var o,s,e,f;if(r>1&&u>1){if(this.cell.className.indexOf("e-colmerge")==-1){if(this.cell.className+=" e-colmerge",o=this.cell.parentNode.parentNode,o.rows.length-this.cell.parentElement.rowIndex<u&&(u=o.rows.length-this.cell.parentElement.rowIndex),!n(".e-grid").children().is(".e-dialog")||n(".e-grid").find(".e-dialog").attr("style").indexOf("display: none")!=-1||this.model.allowFiltering)for(s=0;s<u;s++)if(t.isNullOrUndefined(o.children[this.cell.parentElement.rowIndex+s]))break;else for(e=o.children[this.cell.parentElement.rowIndex+s].children[this.cell.cellIndex],this.model.columns.length-e.cellIndex<r&&(r=this.model.columns.length-e.cellIndex),e.colSpan=r,f=1;f<r;f++)t.isNullOrUndefined(e.parentElement.children[this.cell.cellIndex+f])||(e.parentElement.children[this.cell.cellIndex+f].className+=" e-hide");else for(this.cell.colSpan=r,f=1;f<r;f++)t.isNullOrUndefined(this.cell.nextSibling)||(this.cell.parentElement.children[this.cell.cellIndex+f].className+=" e-hide");i.rowMerge(u)}}else r>1&&i.colMerge(r),u>1&&i.rowMerge(u)}},_replacingContent:function(){var dt=document.createElement("div"),e=0,f,y,st,g,nt,p,s,b,ct,tt,lt,it,at,vt,ut,r,c,bt,ft,ii,ri,et,kt;this.model.scrollSettings.enableVirtualization&&(e=1);var u=e==1?this.getCurrentIndex()+1:this.getCurrentIndex(),h=this.getContentTable()[0],ot=n(h).find("colgroup").first(),v=this.getRowHeight();ot.replaceWith(this._getMetaColGroup());(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&ot.prepend(this._getIndentCol());f=h.tBodies[0];y=this.model.currentViewData;t.isNullOrUndefined(this._currentPageData)?this._virtualLoadedRecords[this._currentPage()]=y:(this._virtualLoadedRecords[this._currentPage()]=this._currentPageData,this._currentPageData=null);var gt=n("<tbody><\/tbody>").append(n.render[this._id+"_JSONTemplate"](y)),d=this,o=gt.children("tr");if(this._allowcolumnSelection&&this.selectedColumnIndexes.length>0)for(c=0;c<this.selectedColumnIndexes.length;c++)st=this.selectedColumnIndexes[c]+1,o.find("td:nth-of-type("+st+")").addClass("e-columnselection");this.virtualLoadedPages.push(u>=e?u:e);this._lastRow?(g=this._virtualLoadedRecords[this._currentPage()].length,o.slice(-g).attr("name",u),nt=o.slice(0,o.length-g),nt.length&&(p=(this._currentPage()-2)*this.model.pageSettings.pageSize,nt.attr("name",p),this.virtualLoadedPages[this.virtualLoadedPages.length-1]=p>=e?p:e,this.virtualLoadedPages.push(u>=e?u:e))):n(o).attr("name",u);var l=t.dataUtil.mergeSort(t.distinct(this.virtualLoadedPages)),w=t.dataUtil.min(l),ht=t.dataUtil.max(l);for(n(f).children(".e-virtualrow").remove(),r=0;r<l.length;r++)s=l[r],b=l[r-1],(s!=this.orderedVirtualLoadedPage[r]||this.orderedVirtualLoadedPage[r]==i)&&(b!=i?o.insertAfter(n(f).children("[name="+b+"]:last")):o.insertBefore(n(f).children("[name="+this.orderedVirtualLoadedPage[r]+"]:first")),this.orderedVirtualLoadedPage=l),s!=0&&(ct=s==w?w:b,tt=s-ct-d.model.pageSettings.pageSize,tt>0&&(lt=document.createElement("tr"),n(lt).addClass("e-virtualrow").css("height",v*tt).insertBefore(n(f).children("[name="+s+"]:first")))),s==ht&&(it=d._gridRecordsCount-ht-d.model.pageSettings.pageSize,it>0&&(at=document.createElement("tr"),n(at).addClass("e-virtualrow").css("height",v*it).appendTo(f)));w>0&&(vt=document.createElement("tr"),n(vt).addClass("e-virtualrow").css("height",v*w).prependTo(f));var yt=this.getContent(),k=n(f).children("tr[name="+u+"]")[0],rt=k.previousSibling,pt=yt.height(),wt=k.offsetTop;if(this._virtaulUnSel)for(ut=n.extend(!0,[],this._virtaulUnSel),r=0;r<ut.length;r++){var a=ut[r],ni=this.model.pageSettings.currentPage,ti=a%this.model.pageSettings.pageSize==0?parseInt(a/this.model.pageSettings.pageSize):parseInt(a/this.model.pageSettings.pageSize)+1;ti==ni&&(c=a%this.model.pageSettings.pageSize,bt=n(f).find("tr[name="+u+"]").eq(c),bt.attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active"),ft=this._virtaulUnSel.indexOf(a),ft!=-1&&this._virtaulUnSel.splice(ft,1))}(k&&rt&&(this._virIndex||n(rt).hasClass("e-virtualrow")||rt.offsetTop>u*pt)&&(this._gridRecordsCount-u>=this.model.pageSettings.pageSize||k.offsetParent.offsetHeight-wt<pt)||this._lastRow)&&(this._lastRow&&(this._lastRow=!1),this._virIndex&&(this._virIndex=!1),this._isVirtualRecordsLoaded=!0,yt.find(".e-content").scrollTop(wt),this._scrollValue=this.getContent()[0].firstChild.scrollTop);ii=n(h).get(0);ri=dt.firstChild;this._currentJsonData=y;this._gridRows=n(h).get(0).rows;et=n(h).find(".e-virtualrow").last();kt=this.model.scrollSettings.virtualScrollMode=="normal"?et.height()-(n(h).height()-this._gridRecordsCount*v):1;et.css("height",kt);this._enableCheckSelect&&this.element.find(".e-checkselectall").prop("checked")&&this._virtualCheckSelection(u);this._eventBindings()},_virtualCheckSelection:function(t){var i=this.getContentTable()[0].tBodies[0];n(i).find("tr[name="+t+"]").find(".e-checkcelldiv input").prop("checked","checked");n(i).find("tr[name="+t+"]").attr("aria-selected","true").find("td").addClass("e-selectionbackground e-active")},_replacingVirtualContent:function(){var o=this.getContentTable()[0],s=this._currentLoadedIndexes,u=n("<tbody><\/tbody>"),c,p,r,e,w,l,a,d,v,b,y,f,i;if(this._checkCurrentVirtualView(this._virtualLoadedRows,this._currentVirtualIndex)){for(c=[],i=0;i<s.length;i++)n.merge(c,this._virtualLoadedRows[s[i]]);n(u).append(c)}else for(p=n("<tbody><\/tbody>"),i=0;i<s.length;i++)if(r=s[i],e=this._virtualLoadedRows[r],e)r<this._currentVirtualIndex?(a=u.find(".e-virtualview"+r),a.length?n(e).insertBefore(a):u.prepend(e)):n(e).insertAfter(u.find(".e-virtualview"+(r-1)));else{this._currentVirtualRowIndex=r>0?(r-1)*this._virtualRowCount:0;var p=n("<tbody><\/tbody>").append(n.render[this._id+"_JSONTemplate"](this._virtualLoadedRecords[r])),h=p[0].rows,k=h.length-1;n(h[k]).addClass("e-virtualview"+r);w=r.toString(32);l=n(h).attr("name",w);(l.length==this._virtualRowCount||r==this._totalVirtualViews)&&(this._virtualLoadedRows[r]=l,u.append(h))}if(o.replaceChild(u[0],o.lastChild),this.selectedRowsIndexes.length&&!this._enableCheckSelect&&(v=n.inArray(this._prevVirtualIndex,this._currentLoadedIndexes),b=n.inArray(this._prevVirtualIndex,this._prevLoadedIndexes),v!=-1&&v!=b&&(y=this._prevVirtualIndex>this._currentVirtualIndex?this._virtualRowCount:-this._virtualRowCount,this.selectedRowsIndexes=this.selectedRowsIndexes.map(function(n){return n+y}),f=this._selectedRow()+y,f=f>=0?f:-1,this._selectedRow(f),d=f)),n(o.rows).removeClass("e-hover"),this._setVirtualTopBottom(),(this._isThumbScroll||this._remoteRefresh)&&(this._scrollObject._content[0].scrollTop=this._scrollObject.scrollTop(),this._isThumbScroll=this._remoteRefresh=!1),this.model.allowSelection&&this._checkVirtualSelection(),this._gridRows=o.rows,this._currentJsonData=this.model.currentViewData,this._checkCurrentVirtualView(this._queryCellView,this._currentVirtualIndex)||this._eventBindings(),this.model.queryCellInfo||this.model.rowDataBound)for(i=0;i<this._currentLoadedIndexes.length;i++)n.inArray(this._currentLoadedIndexes[i],this._queryCellView)!=-1||t.isNullOrUndefined(this._virtualLoadedRows[this._currentLoadedIndexes[i]])||this._queryCellView.push(this._currentLoadedIndexes[i]);this._trigger("refresh")},_setVirtualTopBottom:function(){var e=this.getContentTable()[0],l=this._vRowHeight,p=t.dataUtil.mergeSort(t.distinct(this._currentLoadedIndexes)),h=t.dataUtil.min(p),u,v,y,a,w,i,f,c,o,r,s;if(this.initialRender||this._virtualLoadedRows[h]||(h=h+1),u=t.dataUtil.max(p),v=this._getVirtualTotalRecord(),this.model.scrollSettings.virtualScrollMode=="continuous"&&this._virtualLoadedRows[u+1]&&(w=Object.keys(this._virtualLoadedRows),a=parseInt(t.dataUtil.max(w),10),u=a-u),y=u*this._virtualRowCount*l,n.inArray(this._totalVirtualViews,this._currentLoadedIndexes)!=-1&&this._currentVirtualIndex!=this._totalVirtualViews&&(y=(v-(this._virtualRowCount-this._lastViewData))*l),i=v*l-y,this.model.scrollSettings.virtualScrollMode!="continuous"||this._virtualLoadedRows[u+1]||(i=a&&a<=u+1?i:1),this.getContent().find(".e-virtualtop, .e-virtualbottom").remove(),f=1e6,i>0&&this._getVirtualTotalRecord()>this._virtualRowCount*2)if(Math.round(i).toString().length<7)t.buildTag("div.e-virtualbottom","",{height:i}).insertAfter(e);else for(t.buildTag("div.e-virtualbottom").insertAfter(e),o=Math.ceil(i/f),r=0;r<o;r++)s=f,r==o-1&&(s=i%f),n(e).next().append(t.buildTag("div","",{height:s}));if(h>1)if(c=(h-1)*this._virtualRowCount*l,Math.round(c).toString().length<7)t.buildTag("div.e-virtualtop","",{height:c}).insertBefore(e);else for(t.buildTag("div.e-virtualtop").insertBefore(e),o=Math.ceil(c/f),r=0;r<o;r++)s=f,r==o-1&&(s=c%f),n(e).prev().append(t.buildTag("div","",{height:s}));this._scrollObject.model.scrollTop!=this._scrollValue&&this.getContent().ejScroller("model.scrollTop",this._scrollValue)},_checkVirtualSelection:function(){var u=this.getContentTable()[0],s,f,p,e,h,w,v,l,o,i,y,r,a,b;if(this._enableCheckSelect?(this.selectedRowsIndexes=[],this._virtualSelectedRowIndex=[],this._virtualSelectedRecords=[],this.model.selectedRecords=[],p=this.model.pageSettings.pageSize,s=[].concat.apply([],this.checkSelectedRowsIndexes.map(function(n,t){return n.map(function(n){return n+t*p})}))):s=this._virtualSelectedRowIndex,s)for(i=0;i<s.length;i++){var r=s[i],c=this._getSelectedViewData(r),h=c.viewIndex;n.inArray(h,this._currentLoadedIndexes)!=-1&&(e=r%this._virtualRowCount+this._currentLoadedIndexes.indexOf(h)*this._virtualRowCount,t.isNullOrUndefined(u.rows[e])||(!n(u.rows[e].cells).hasClass("e-selectionbackground")&&this._virtualSelectedRowIndex.length-1&&(n(n(u.rows[e]).attr("aria-selected","true")[0].cells).addClass("e-selectionbackground e-active"),this.model.selectedRowIndex=e),(this._enableCheckSelect||!n(u.rows[e].cells).hasClass("e-selectionbackground"))&&(f=n(u.rows[e]).index(),this.selectedRowsIndexes.push(f),this._virtualSelectedRowIndex.push(f),this._virtualSelectedRecords[f]=c.data,this._virtualCheckSelectedRecords[(h-1)*this._virtualRowCount+f]=c.data,this.model.selectedRecords.push(c.data),n(u.rows[e]).find(".e-checkcelldiv [type=checkbox]").prop("checked",!0))))}for(i=0;i<this._rowIndexesColl.length;i++)if(r=this._rowIndexesColl[i],h=this._getSelectedViewData(r).viewIndex,n.inArray(h,this._currentLoadedIndexes)!=-1&&n.inArray(r,this._virtualRowCellSelIndex)==-1||this._virtualDataRefresh)for(w=n.inArray(r,this._rowIndexesColl),v=this.selectedRowCellIndexes[w].cellIndex,l=0;l<v.length;l++)this._selectMultipleCells(r,v[l]);for(o=n(u.rows).find(".e-active, .e-cellselectionbackground").closest("tr"),i=0;i<o.length;i++){var k=parseInt(n(o[i]).attr("name"),32)*this._virtualRowCount,d=this._virtualRowCount-n(o[i]).index()%this._virtualRowCount,g=k-d;f=n(o[i]).index();y=n(o[i]).attr("name");r=parseInt(y,32)*this._virtualRowCount-this._virtualRowCount+n(o[i]).prevAll("tr[name="+y+"]").length;this._virtualSelectedRowIndex.length&&n.inArray(this._enableCheckSelect?f:r,this._virtualSelectedRowIndex)==-1&&(this._clearVirtualSelection=!0,this.clearSelection(r));this._rowIndexesColl.length&&n.inArray(g,this._rowIndexesColl)==-1&&n(this.getRowByIndex(f)[0].cells).removeClass("e-cellselectionbackground e-activecell")}for(n(u.rows).find(".e-columnselection").removeClass("e-columnselection"),a=0;a<this.selectedColumnIndexes.length;a++)b=this.selectedColumnIndexes[a]+1,n(u.rows).find("td:nth-of-type("+b+")").addClass("e-columnselection");this._clearVirtualSelection=!1},_refreshPagerTotalRecordsCount:function(){this.model.filterSettings.filteredColumns.length?this.getPager().ejPager({totalRecordsCount:this._searchCount==null?this._filteredRecordsCount:this._searchCount,currentPage:this._currentPage()}):this.getPager().ejPager({totalRecordsCount:this._searchCount==null?this._gridRecordsCount:this._searchCount,currentPage:this._currentPage()})},_maxZindex:function(){var t=1;return t=Math.max.apply(null,n.map(n("body *"),function(t){if(n(t).css("position")=="absolute")return parseInt(n(t).css("z-index"))||1})),(t==i||t==null)&&(t=1),t},_keyPressed:function(r,u,f,e){var a=n(u),ut,ft,et,y,v,d,nt,it,ot,w,tt,g,rt,h,p,k,s,o,c,l,b;if(a.hasClass("e-tooltxt")&&f.code==13)return ft={currentTarget:u,target:u.firstChild},et=n(u).closest(".e-gridtoolbar"),et.ejToolbar("instance")._trigger("click",ft),!1;if((!this._allowcellSelection||this._previousRowCellIndex&&this._previousRowCellIndex.length!=0||this._lastSelectedCellIndex&&this._lastSelectedCellIndex.length!=0||(this._previousRowCellIndex=[],this._previousRowCellIndex.push([0,[0]]),this._lastSelectedCellIndex.push([0,[0]])),a.hasClass("e-ddl")&&f.code==13&&n(document.activeElement).parents("td").hasClass("e-templatecell"))||!this.model.allowKeyboardNavigation||(u.tagName=="INPUT"||u.tagName=="TEXTAREA")&&this.model.keyConfigs[r].indexOf(",")==-1&&f.code!=13&&f.code!=27&&f.code!=9||String.fromCharCode(f.code).toLowerCase()==this.element[0].accessKey.toLowerCase()||n(u).prop("type")=="checkbox"&&f.code!=13&&f.code!=9&&f.code!=27||this.model.editSettings.editMode=="batch"&&(u.tagName=="INPUT"||u.tagName=="TEXTAREA")&&f.code!=13&&f.code!=9&&f.code!=27&&(u.selectionStart!=0&&r!="moveCellRight"||u.selectionEnd!=u.value.length&&r!="moveCellLeft")||this.model.allowFiltering&&a.hasClass("e-filtertext")&&f.code==13||a.hasClass("e-fltrbtn")&&f.code==13||(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate")&&n(u).closest("#"+this._id+"EditForm").length||n(u).parent().siblings("#"+this._id+"EditForm").length||f.code==13&&a.parent().hasClass("e-unboundcelldiv"))return!0;if(f.code==13&&u.tagName=="INPUT"&&a.closest("#"+this._id+"_search").length&&(r="searchRequest"),f.code==13&&this._excelFilter!=null&&!t.isNullOrUndefined(this._excelFilter._openedFltr)&&this._excelFilter._openedFltr.length&&this._excelFilter._openedFltr.is(":visible")&&(r="excelfilter"),f.code==13&&n(u).hasClass("e-gridtoolbar")&&(ut=a.find(".e-hover").attr("Id"),r="toolbarOperationRequest"),(r=="multiSelectionByRightArrow"&&f.code==39&&f.shift==!0||r=="multiSelectionByLeftArrow"&&f.code==37&&f.shift==!0)&&(r="multiSelectionByRLArrow"),!this.model.isEdit&&r=="cancelRequest")return this.clearSelection(),this.clearCellSelection(),this.clearColumnSelection(),!0;if(n(u).find("input.e-dropdownlist").attr("aria-expanded")=="true"&&this.model.isEdit&&r=="saveRequest")return!0;if(this.getPager()!=null&&(y=this.getPager().ejPager("model"),v=y.currentPage),d=!1,a=n(u),a.closest(".e-grid").attr("Id")===this._id){switch(r){case"insertRecord":!t.gridFeatures.edit||this.model.isEdit||this.model.editSettings.showAddNewRow||this.model.editSettings.editMode!="normal"||this._toolbarOperation(this._id+"_add");v==0&&(v=1);break;case"toolbarOperationRequest":this._toolbarOperation(ut);this.element.focus();break;case"searchRequest":this.search(a.val());break;case"excelfilter":it=this._id+this._excelFilter._$colType;this._excelFilter._openedFltr.hasClass("e-dlgcustom")&&(it+="Custom");this._excelFilter._openedFltr.find("#"+it+"_OkBtn").trigger("click");break;case"saveRequest":t.gridFeatures.edit&&(this.model.editSettings.editMode=="batch"?(this._enterKey=!0,ot=n(this.getRowByIndex(this._bulkEditCellDetails.rowIndex)),t.copyObject(this._copyBulkEditCellDetails,this._bulkEditCellDetails,!0),this.model.isEdit&&ot.hasClass("e-insertedrow")&&this._batchCellValidation(this._bulkEditCellDetails.rowIndex),this._moveCurrentCell("down")):this._toolbarOperation(this._id+"_update"),e.stopPropagation());break;case"cancelRequest":t.gridFeatures.edit&&this._toolbarOperation(this._id+"_cancel");break;case"deleteRecord":t.gridFeatures.edit&&this._toolbarOperation(this._id+"_delete");break;case"editRecord":t.gridFeatures.edit&&(!this.model.isEdit||this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal")&&this._toolbarOperation(this._id+"_edit");break;case"totalGroupCollapse":t.gridFeatures.group&&(this.collapseAll(),this.element.focus());break;case"totalGroupExpand":t.gridFeatures.group&&(this.expandAll(),this.element.focus());break;case"selectedGroupExpand":t.gridFeatures.group&&(this._$currentTr=n(this.getRows()).eq(this._selectedRow()),nt=this._$currentTr.parents("tr").first().prev().find(".e-recordpluscollapse"),this.expandCollapse(nt));break;case"selectedGroupCollapse":t.gridFeatures.group&&(this._$currentTr=n(this.getRows()).eq(this._selectedRow()),nt=this._$currentTr.parents("tr").first().prev().find(".e-recordplusexpand"),this.expandCollapse(nt));break;case"firstRowSelection":t.gridFeatures.selection&&this.selectRows(0);break;case"lastRowSelection":t.gridFeatures.selection&&(h=this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(this.getRows()[0])?n(this.getRows()[0]).length-1:n(this._excludeDetailRows()).length-1);this.selectRows(h);break;case"rowUpSelection":this.element.find(".e-row.e-hover,.e-alt_row.e-hover").removeClass("e-hover");w=this._traverseRow!=null?this._traverseRow:this._selectedRow();w>0&&(this._nextRow=w,this._prevRow=w-1,tt=n(this.getContent().find("tr.e-traverse")[0]),tt.removeClass("e-traverse"),this.getRowByIndex(this._prevRow).addClass("e-traverse"),g=this.getContent().find("tr.e-traverse"),this._traverseRow=this.getIndexByRow(g));break;case"rowDownSelection":this.element.find(".e-row.e-hover,.e-alt_row.e-hover").removeClass("e-hover");w=this._traverseRow!=null?this._traverseRow:this._selectedRow();(w+1<this.model.currentViewData.length||this.model.scrollSettings.allowVirtualScrolling)&&(this._prevRow=w,this._nextRow=w+1,tt=n(this.getContent().find("tr.e-traverse")[0]),tt.removeClass("e-traverse"),this.getRowByIndex(this._nextRow).addClass("e-traverse"),g=this.getContent().find("tr.e-traverse"),this._traverseRow=this.getIndexByRow(g));break;case"randomSelection":this.element.find(".e-row.e-hover,.e-alt_row.e-hover").removeClass("e-hover");this.model.selectionType=="multiple"&&(this.multiSelectCtrlRequest=!0);g=this.getContent().find("tr.e-traverse");this._traverseRow=this.getIndexByRow(g);this._traverseRow!=-1&&(this.model.selectionSettings.enableToggle&&this.getSelectedRecords().length==1&&n.inArray(this._traverseRow,this.selectedRowsIndexes)!=-1?this.clearSelection(this._traverseRow):this.selectRows(this._traverseRow));this.getRowByIndex(w).removeClass("e-traverse");this.multiSelectCtrlRequest=!1;break;case"upArrow":if(this.multiSelectCtrlRequest=!1,this._traverseRow=null,this.model.isEdit&&a.hasClass("e-ddl"))break;if(t.gridFeatures.selection&&(this._selectedRow()!=-1||this._previousRowCellIndex!=i)&&(this.element.is(document.activeElement)||this.element.find(document.activeElement).not(".e-gridtoolbar").length)){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;this._selectedRow()>0&&(s=this.getRowByIndex(this._selectedRow()-1),this._enableCheckSelect||this.selectRows(this._selectedRow()-1,null,s),this.model.editSettings.editMode!="batch"||this.model.scrollSettings.enableVirtualization||n.inArray("cell",this.model.selectionSettings.selectionMode)!=-1||this._moveCurrentCell("up"));this._allowcellSelection&&this._previousRowCellIndex&&this._previousRowCellIndex.length!=0&&this._lastSelectedCellIndex[0][0]>0&&this.selectCells([[this._lastSelectedCellIndex[0][0]-1,this._lastSelectedCellIndex[0][1]]])}break;case"downArrow":if(this.multiSelectCtrlRequest=!1,this._traverseRow=null,this.model.isEdit&&a.hasClass("e-ddl"))break;if(t.gridFeatures.selection&&(this.element.is(document.activeElement)||this.element.find(document.activeElement).not(".e-gridtoolbar").length)){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;this._selectedRow()==-1&&(this.model.selectedRowIndex=0);h=this._excludeDetailRows().length-1;this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(this.getRows()[0])&&(h=this.getRows()[0].length-1);this._selectedRow()!=h&&this._selectedRow()!=-1&&(s=this._selectedRow()==0?this.getRowByIndex(this._selectedRow()):this.getRowByIndex(this._selectedRow()-1),this._enableCheckSelect||this.selectRows(this._selectedRow()+1,null,s),this.model.editSettings.editMode!="batch"||this.model.scrollSettings.enableVirtualization||n.inArray("cell",this.model.selectionSettings.selectionMode)!=-1||(t.copyObject(this._copyBulkEditCellDetails,this._bulkEditCellDetails,!0),this._moveCurrentCell("down")));this._allowcellSelection&&this._previousRowCellIndex&&this._previousRowCellIndex.length!=0&&this._lastSelectedCellIndex[0][0]<h&&this.selectCells([[this._lastSelectedCellIndex[0][0]+1,this._lastSelectedCellIndex[0][1]]])}break;case"rightArrow":if(t.gridFeatures.selection&&this._allowcellSelection&&(this.element.is(document.activeElement)||this.element.find(document.activeElement).not(".e-gridtoolbar").length)){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;o=this._lastSelectedCellIndex[0][0];s=this.getRowByIndex(o);c=this._lastSelectedCellIndex[0][1][0];t.isNullOrUndefined(c)&&(c=this._lastSelectedCellIndex[0][1]);l=n(s.find("td:gt("+c+")").not(".e-hide")[0]).index();l==-1&&(o=o+1,s=this.getRowByIndex(o),l=n(s.find("td").not(".e-hide")[0]).index());o!=-1&&l!=-1&&this.selectCells([[o,[l]]])}break;case"leftArrow":if(t.gridFeatures.selection&&this._allowcellSelection&&(this.element.is(document.activeElement)||this.element.find(document.activeElement).not(".e-gridtoolbar").length)){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;o=this._lastSelectedCellIndex[0][0];s=this.getRowByIndex(o);c=this._lastSelectedCellIndex[0][1];b=s.find("td:lt("+c+")").not(".e-hide").length-1;l=n(s.find("td:lt("+c+")").not(".e-hide")[b]).index();l==-1&&(o=o-1,s=this.getRowByIndex(o),b=s.find("td:lt("+this.model.columns.length+")").not(".e-hide").length-1,l=n(s.find("td:lt("+this.model.columns.length+")").not(".e-hide")[b]).index());o!=-1&&l!=-1&&this.selectCells([[o,[l]]])}break;case"firstCellSelection":if(t.gridFeatures.selection&&this._allowcellSelection){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;h=n(this.getRows()).length-1;h>-1&&this.selectCells([[0,[0]]])}break;case"lastCellSelection":if(t.gridFeatures.selection&&this._allowcellSelection){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;h=this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(this.getRows()[0])?this.getRows()[0].length-1:n(this._excludeDetailRows()).length-1;h>-1&&this.selectCells([[h,[this.model.columns.length-1]]])}break;case"nextPage":this.getPager()!=null&&(v=v+1);t.isIOSWebView()||this.getBrowserDetails().browser!="msie"||this.element.focus();break;case"previousPage":this.getPager()!=null&&(v=v-1);t.isIOSWebView()||this.getBrowserDetails().browser!="msie"||this.element.focus();break;case"lastPage":this.getPager()!=null&&(v=y.totalPages);break;case"firstPage":this.getPager()!=null&&(v=1);break;case"nextPager":this.getPager()!=null&&(v=Math.ceil(y.currentPage/y.pageCount)*y.pageCount+1);break;case"previousPager":this.getPager()!=null&&(v=(Math.floor(y.currentPage/y.pageCount)-1)*y.pageCount+1);break;case"moveCellLeft":this.model.editSettings.editMode=="batch"?(this._tabKey=!0,d=this._moveCurrentCell("left",e)):d=!0;f.code==9&&n.inArray("cell",this.model.selectionSettings.selectionMode)!=-1&&this.selectCells([[this._bulkEditCellDetails.rowIndex,this._bulkEditCellDetails.columnIndex]]);break;case"moveCellRight":this.model.editSettings.editMode=="batch"&&a?(this._tabKey=!0,d=this._moveCurrentCell("right",e)):d=!0;f.code==9&&n.inArray("cell",this.model.selectionSettings.selectionMode)!=-1&&this.selectCells([[this._bulkEditCellDetails.rowIndex,this._bulkEditCellDetails.columnIndex]]);break;case"multiSelectionByDownArrow":t.gridFeatures.selection&&(this._selectedRow()!=-1||this._previousRowCellIndex!=i)&&(h=this._excludeDetailRows().length-1,a=this.element.find(".e-gridcontent").find(".e-rowcell"),this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(this.getRows()[0])&&(h=this.getRows()[0].length-1),this.multiSelectShiftRequest=!0,this._allowcellSelection&&this._lastSelectedCellIndex[0][0]<=h&&this._lastSelectedCellIndex[0][0]!=-1&&(o=this._lastSelectedCellIndex[0][0]+1,c=parseInt(this._lastSelectedCellIndex[0][1]),o<=h&&this.selectCells([[o,[c]]])),this.multiSelectShiftRequest=!1,this._selectedRow()<=h&&this._selectedRow()!=-1&&(p=this._selectedRow()+1,k=this._previousIndex,this.multiSelectShiftRequest=!0,this.selectRows(k,p,a),this.multiSelectShiftRequest=!1,p-1==h&&(this.selectRows(k,h),p=h)),this._selectedRow(p),this._previousIndex=k);this.model.editSettings.editMode=="batch"&&this.element.focus();break;case"multiSelectionByUpArrow":rt=0;t.gridFeatures.selection&&(this._selectedRow()!=-1||this._previousRowCellIndex!=i)&&(h=this._excludeDetailRows().length-1,a=this.element.find(".e-gridcontent").find(".e-rowcell"),this.multiSelectShiftRequest=!0,this._allowcellSelection&&this._lastSelectedCellIndex[0][0]<=h&&this._lastSelectedCellIndex[0][0]!=-1&&(o=this._lastSelectedCellIndex[0][0]-1,c=parseInt(this._lastSelectedCellIndex[0][1]),o!=-1&&this.selectCells([[o,[c]]])),this.multiSelectShiftRequest=!1,this._selectedRow()>=0&&this._selectedRow()>=-1&&(p=this._selectedRow()-1,k=this._previousIndex,this.multiSelectShiftRequest=!0,this.selectRows(k,p,a),this.multiSelectShiftRequest=!1,p<0&&(this.selectRows(k,rt),p=rt)),this._selectedRow(p),this._previousIndex=k);this.model.editSettings.editMode=="batch"&&this.element.focus();break;case"multiSelectionByRLArrow":if(t.gridFeatures.selection&&this._allowcellSelection&&(this.element.is(document.activeElement)||this.element.find(document.activeElement).not(".e-gridtoolbar").length)){if((u.type=="text"||u.type=="textarea"||u.type=="checkbox")&&this.model.isEdit&&this.model.editSettings.editMode!="batch")return!0;this.multiSelectShiftRequest=!0;o=this._lastSelectedCellIndex[0][0];s=this.getRowByIndex(o);f.code==37&&f.shift==!0?(c=this._lastSelectedCellIndex[0][1],b=s.find("td:lt("+c+")").not(".e-hide").length-1,l=n(s.find("td:lt("+c+")").not(".e-hide")[b]).index(),l==-1&&(o=o-1,s=this.getRowByIndex(o),b=s.find("td:lt("+this.model.columns.length+")").not(".e-hide").length-1,l=n(s.find("td:lt("+this.model.columns.length+")").not(".e-hide")[b]).index())):(c=this._lastSelectedCellIndex[0][1][0],t.isNullOrUndefined(c)&&(c=this._lastSelectedCellIndex[0][1]),l=n(s.find("td:gt("+c+")").not(".e-hide")[0]).index(),l==-1&&(o=o+1,s=this.getRowByIndex(o),l=n(s.find("td").not(".e-hide")[0]).index()));o!=-1&&l!=-1&&this.selectCells([[o,[l]]]);this.multiSelectShiftRequest=!1}break;default:d=!0}return this.getPager()!=null&&v<=y.totalPages&&y.currentPage!==v&&r!="searchRequest"&&r!=="deleteRecord"&&this.getPager().ejPager("goToPage",v),d}},_findColumnsWidth:function(){for(var t=this.getHeaderTable().find(".e-headercell").not(".e-stackedHeaderCell, .e-detailheadercell"),n=0;n<this.model.columns.length;n++)this.model.columns[n].visible&&(this.columnsWidthCollection[n]=t.eq(n+0).outerWidth())},_calculateWidth:function(){for(var t=this.getHeaderTable().find(".e-columnheader").last().find("th:visible"),i=0,n=0;n<t.length;n++)i+=t.eq(n).outerWidth();return i},_initIndicators:function(){var t=this._id+"_ColumnDropIndicator";n("#"+t).length&&n("#"+t).remove();this._Indicator=document.createElement("DIV");n(this._Indicator).attr("id",t).addClass("e-columndropindicator").addClass("e-dropAcceptor").appendTo(document.body);n(this._Indicator).css({display:"none"})},_refreshGridFooterColGroup:function(){this.getFooterTable().find("colgroup").remove();this._scrollFooterColgroup()},_refreshGroupSummary:function(){var r=this.getHeaderContent().find("colgroup col").clone(),i,t;for(r.splice(0,this.model.groupSettings.groupedColumns.length),i=this.getContentTable().find(".e-groupsummary colgroup"),t=0;t<i.length;t++)n(i[t]).find(".e-summary").is("visible")||n(i[t]).find(".e-summary").show(),n(i[t]).find("col:not('.e-summary')").remove(),n(i[t]).append(r.clone())},reorderColumns:function(n,t){var i,r;(typeof n=="string"&&typeof t=="string"?(i=this.getColumnIndexByField(n),r=this.getColumnIndexByField(t)):(i=n,r=t),i!=-1&&r!=-1&&typeof i!="string"&&typeof r!="string")&&(this.set_dropColumn(i,r),this.model.showStackedHeader&&this._refreshStackedHeader(),this.model.scrollSettings.allowVirtualScrolling&&(this.model.scrollSettings.enableVirtualization?(this._virtualDataRefresh=!0,this._queryCellView=[],this._virtualLoadedRows={},this._refreshVirtualView(this._currentVirtualIndex)):this._refreshVirtualContent()))},columns:function(i,r){var f,u,e,s,o,h,c;if(!t.isNullOrUndefined(i)){for(f=!1,typeof i=="string"?(i=[i],f=!0):i instanceof Array&&i.length&&typeof i[0]=="string"&&(f=!0),u=0;u<i.length;u++)e=f?i[u]:i[u].field,s=f?i[u]:i[u].headerText,o=(t.isNullOrUndefined(e)||e=="")&&(t.isNullOrUndefined(s)||s=="")?-1:t.isNullOrUndefined(e)||e==""?n.inArray(this.getColumnByHeaderText(s),this.model.columns):n.inArray(this.getColumnByField(e),this.model.columns),r=="add"||t.isNullOrUndefined(r)?o==-1?this.model.columns.push(f?{field:i[u]}:i[u]):this.model.columns[o]=f?{field:i[u]}:i[u]:o!=-1&&this.model.columns.splice(o,1);for(this.columnsWidthCollection=[],h=!1,c=0;c<this.model.columns.length;c++)this.columnsWidthCollection.push(this.model.columns[c].width),t.isNullOrUndefined(h)||(h=!0);this._enableRowHover(h);this.refreshHeader();(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&this._processEditing();this.refreshContent(!0);this.model.allowScrolling&&(this.refreshScrollerEvent(),this.model.allowResizeToFit&&this.getContent().ejScroller("isVScroll")&&this._showHideScroller())}},_resetDisabledCollections:function(){this._disabledResizingColumns=[];this._disabledSortableColumns=[];this._disabledGroupableColumns=[];this._disabledEditableColumns=[]},_enableRowHover:function(n){var r=!0,i;if(t.isNullOrUndefined(n)){for(i=0;i<this.model.columns.length;i++)if(!t.isNullOrUndefined(this.model.columns[i].tooltip)){r=!0;break}}else r=n;this.model.enableRowHover||r?this._on(this.element,"mouseenter mouseleave",".e-gridcontent tr td",this._rowHover):this._off(this.element,"mouseenter mouseleave",".e-gridcontent tr td")},_rowHover:function(i){var r=n(i.target),u,f,o,h;if(r.hasClass("e-rowcell")||(r=r.closest(".e-rowcell")),u=this.model.scrollSettings.frozenColumns?n(this.getRows()):this.element.find(".e-row.e-hover,.e-alt_row.e-hover"),(!r.closest("#"+this._id+"EditForm").length||!r.hasClass("e-rowcell"))&&r.hasClass("e-rowcell")){if(i.type=="mouseenter"&&r.hasClass("e-gridtooltip")&&this._showTooltip(r),this.model.enableRowHover){this.element.find(".e-traverse").removeClass("e-traverse");this._traverseRow=null;i.type!="mouseenter"||this._dragActive?(this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(u[0])&&!t.isNullOrUndefined(u[1])&&(u=n(u[0]).add(u[1])),u.removeClass("e-hover")):this.model.scrollSettings.frozenColumns>0&&!t.isNullOrUndefined(u[0])&&!t.isNullOrUndefined(u[1])?(u=n(u[0]).add(u[1]),u.removeClass("e-hover"),f=this.getIndexByRow(r.parent()),f!=-1&&this.getRowByIndex(f).addClass("e-hover")):(u.removeClass("e-hover"),(r.parent().hasClass("e-row")||r.parent().hasClass("e-alt_row"))&&r.parent().addClass("e-hover"));var s=r.parent(),f=this.getIndexByRow(s),e=this._currentJsonData[f];this.model.scrollSettings.allowVirtualScrolling&&!this.model.scrollSettings.enableVirtualization?(f=f%this.model.pageSettings.pageSize,e=this._currentJsonData[f]):this.model.scrollSettings.enableVirtualization&&(o=this._getSelectedViewData(f,r),e=o.data,f=o.rowIndex);h={row:s,rowIndex:f,rowData:e,cell:r};this._trigger("rowHover",h)}return!1}},_showTooltip:function(i,r){var u=i.index(),a=i.hasClass("e-stackedHeaderCell"),o={},f,h,v,y,e,c,s,l,p,w,b;if(i.hasClass("e-headercelldiv")&&(u=i.parent(".e-headercell").index()-this.model.groupSettings.groupedColumns.length),!a&&(this.model.childGrid||this.model.detailsTemplate)&&u--,this.model.scrollSettings.frozenColumns>0&&(i.closest(".e-movableheaderdiv").length||i.closest(".e-movablecontentdiv").length)&&(u=u+this.model.scrollSettings.frozenColumns),f=a?this._getStackedColumnByTarget(i):this.getColumnByIndex(u),f.clipMode!=t.Grid.ClipMode.Ellipsis){if(f.clipMode==t.Grid.ClipMode.EllipsisWithTooltip&&(h=i,i.find("span").hasClass("e-ellipsistooltip")||(v=t.buildTag("span.e-ellipsistooltip",{},{}),v.html(i.html()),h.append(v)),h.find("span.e-ellipsistooltip").css("display","inline-block"),y=h.find("span:first")[0].getBoundingClientRect().width,h.find("span.e-ellipsistooltip").remove(),i.width()>y)){i.removeAttr("title");return}if(e=document.createElement("script"),t.isNullOrUndefined(f.tooltip)&&t.isNullOrUndefined(f.headerTooltip))return;e.id=(this._id+f.headerText+n.inArray(f,this.model.columns)+"_TemplateToolTip").split(" ").join("");e.type="text/x-template";s=r?"headerTooltip":"tooltip";t.isNullOrUndefined(f[s])||f[s].slice(0,1)==="#"?c=n(f[s]):e.text=f[s];c&&(e.text=c.html(),e.type=c.attr("type")||e.type);t.isNullOrUndefined(c)||f[s].slice(0,1)==="#"||n("body").append(e);l=i.closest("tr");n(l).hasClass("e-columnheader")||i.hasClass("e-gridheader")||(u=this.getIndexByRow(l),this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling?this.model.scrollSettings.enableVirtualization?(p=l.attr("name"),u=u%this._virtualRowCount,w=parseInt(p,32),o=this._virtualLoadedRecords[w][u]):u=u%this.model.pageSettings.pageSize:o=this.getCurrentViewData()[u]);o.value=!i.hasClass("e-headercell")||a?i.text():i.find("e-gridheadertooltip").text();b=n(e).render(o);i.attr("title",b);t.isNullOrUndefined(o.value)||delete o.value}else i.removeAttr("title")},_rightClickHandler:function(i){var o,h,r,e;if(i.preventDefault(),o=t.browserInfo(),i.which==3||o.name=="msie"&&o.version=="8.0"){var f={},u=n(i.target),c=n(this.getRows());if(this.getContentTable().has(u).length){var r=c.index(u.parent()),l=this.getRowByIndex(r),s=this._currentJsonData[r];if(this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(h=this._getSelectedViewData(r,u),s=h.data,r=h.rowIndex),r==-1)return;f={rowIndex:r,row:l,data:s,rowData:s,cellIndex:u.index(),cellValue:u.html(),cell:u}}else if(this.getHeaderTable().has(u).length){if(r=0,e=this.getHeaderTable().find("th").not(".e-detailheadercell,.e-grouptopleftcell,.e-filterbarcell"),r=u.is(".e-headercelldiv")?e.index(u.closest(".e-headercell")):e.index(u),r==-1)return;f={headerIndex:r,headerText:this.getColumnFieldNames()[r],headerCell:e.eq(r),column:this.getColumnByIndex(r)}}else(u.is(".e-pager")||this.getPager()!=null&&this.getPager().has(u).length)&&(f={pager:this.model.pageSettings});this._trigger("rightClick",f)}},_touchGrid:function(n){var r=this._currentPage(),u=!0,i;(this.model.allowScrolling||this.model.isResponsive&&this.model.minWidth!=0)&&(i=t.isNullOrUndefined(this.getContent().data("ejScroller"))?null:(this.getScrollObject()||{})._scrollXdata,i&&(u=n.type=="swipeleft"?i.scrollable-i.sTop==0:i.sTop==0));switch(n.type){case"swipeleft":this.model.allowPaging&&r!=this.model.pageSettings.totalPages&&!this.model.isEdit&&u&&this.element.ejGrid("gotoPage",r+1);break;case"swiperight":this.model.allowPaging&&r>1&&!this.model.isEdit&&u&&this.element.ejGrid("gotoPage",r-1)}},_recorddblClickHandler:function(i){if(!t.isNullOrUndefined(this._previousTr)){var u,r=(u=this._previousTr.length>1)?this.getRowByIndex(n(i.target).closest("tr").index()):n(i.target).closest("tr");if(u&&r[0]!=this._previousTr[0]&&r[1]!=this._previousTr[1])return;if(r[0]!=this._previousTr[0])return}this._recordClickProcess(i,this,"recordDoubleClick")},_recordClickProcess:function(i,r,u){var h={},f=n(i.target).is(".e-rowcell")?n(i.target):n(i.target).closest("td"),c,o,l;if(f.closest(".e-grid").attr("id")===r._id&&(f.is(".e-rowcell")||f.closest("td").is(".e-rowcell"))&&!(f.closest(".e-editcell,.e-insertedrow").length>0)&&(c=r.model.detailsTemplate!=null||r.model.childGrid!=null?f.index()-1:f.index(),o=r.getColumnByIndex(c),r.model.editSettings.editMode!="batch"||o.allowEditing==!1||o.isPrimaryKey==!0)){var e=r.getIndexByRow(f.closest("tr")),a=r.getRowByIndex(e),s=r._currentJsonData[e];if(r.model.scrollSettings.allowVirtualScrolling)if(r.model.scrollSettings.enableVirtualization)l=r._getSelectedViewData(e,f),s=l.data,e=l.rowIndex;else{var v=e%r.model.pageSettings.pageSize,y=(parseFloat(a.attr("name"))-(this.model.scrollSettings.enableVirtualization?1:0))/r.model.pageSettings.pageSize+1,p=t.isNullOrUndefined(t.getObject(y,this._virtualLoadedRecords))?this.model.previousViewData:t.getObject(y,this._virtualLoadedRecords);s=t.isNullOrUndefined(p)?this._currentJsonData[v]:p[v]}h={rowIndex:e,row:a,data:s,rowData:s,cell:f,cellIndex:c,columnName:o.headerText,cellValue:f.text(),event:i};r._previousTr=h.row;r._trigger(u,h)}},_invokeRecordClick:function(n,t){this._recordClickProcess(n,t,"recordClick")},_recordClick:function(i){this._click++;var r=this,u=null;r._click==1?n.inArray("recordClick",this.model.serverEvents)!==-1&&n.inArray("recordDoubleClick",this.model.serverEvents)!==-1?u=setTimeout(function(){r._click=0;r._invokeRecordClick(i,r)},400):(r._click=0,t.isNullOrUndefined(u)||clearTimeout(u),r._invokeRecordClick(i,r)):r._click==2&&(t.isNullOrUndefined(u)||clearTimeout(u),r._click=0)},_headerMouseDown:function(t){if(n(t.target).hasClass("e-headercelldiv")&&!n(t.target).parent().hasClass("e-grouptopleftcell")||n(t.target).hasClass("e-headercell")){var i=n(t.target).hasClass("e-headercelldiv")?n(t.target).parent():n(t.target);this.model.enableHeaderHover&&i.removeClass("e-hover e-headercell-hover").addClass("e-headercellactive e-active")}if(this.model.allowResizing)return this._resizer._mouseDown(t)},_contentMouseDown:function(i){var u,f,r;n(i.target).closest("td").hasClass("e-selectionbackground")||n(i.target).closest("tr").length&&(u=i.type=="touchstart"?i.originalEvent.touches[0].pageX:i.pageX,f=i.type=="touchstart"?i.originalEvent.touches[0].pageY:i.pageY,this._dragDiv=t.buildTag("div.e-griddragarea","",{position:"absolute",width:"0px",height:"0px"}),this.getContent().append(this._dragDiv),r=n(i.target).closest("tr.e-row"),r.length||(r=n(i.target).closest("tr.e-alt_row")),this._startIndex=r.length?this.getIndexByRow(r):null,this._previousRowCellIndex=[[this._startIndex,[i.target.cellIndex]]],this._on(n(document),"touchmove mousemove",this._mouseMoveDragHandler),t.isIOSWebView()||this.getBrowserDetails().browser!="safari"||this.model.contextMenuSettings.enableContextMenu||this._on(this.element,"contextmenu",function(n){n.preventDefault()}),this._on(n(document),"touchend mouseup",this._mouseUpDragHandler),this._startDrag={_x:u,_y:f})},_mouseMoveDragHandler:function(i){var l,e,v,c,f;if(i.pageY!=this._startDrag._y){l=i.type=="touchmove"?i.originalEvent.touches[0].pageX:i.pageX;e=i.type=="touchmove"?i.originalEvent.touches[0].pageY:i.pageY;this._selectDrag=!0;var y=this._dragDiv[0].offsetLeft,p=this._dragDiv[0].offsetTop,r=this._startDrag._x,u=this._startDrag._y,o=l,s=e,h,a=e+2;r>o&&(h=o,o=r,r=h);u>s&&(h=s,s=u,u=h,a=e-2);v=this._dragDiv.height();this._dragDiv.css({left:r,top:u,width:o-r,height:s-u});c=n(document.elementFromPoint(l,a));f=c.closest("tr.e-row");f.length||(f=c.closest("tr.e-alt_row"));f.length&&(this._endIndex=this.getIndexByRow(f),t.isNullOrUndefined(this._startIndex)&&(this._startIndex=this._endIndex),this.selectRows(this._startIndex,this._endIndex),this.selectCells([[this._endIndex,[c.index()]]]))}},_mouseUpDragHandler:function(i){this._off(n(document),"touchend mouseup",this._mouseUpDragHandler);this._off(n(document),"touchmove mousemove",this._mouseMoveDragHandler);t.isIOSWebView()||this.getBrowserDetails().browser!="safari"||this.model.contextMenuSettings.enableContextMenu||this._off(this.element,"contextmenu",function(n){n.preventDefault()});i.stopPropagation();this._selectDrag=!1;this._dragDiv.remove()},_headerHover:function(t){var i=n(t.target);t.type=="mouseover"||t.type=="mousemove"||t.type=="touchmove"||t.type=="MSPointerMove"?((this.model.allowResizing||this.model.allowResizeToFit)&&this._resizer._mouseHover(t),this.model.enableHeaderHover&&!this._dragActive&&(i.hasClass("e-headercelldiv")&&!i.parent().hasClass("e-grouptopleftcell")||i.hasClass("e-headercell"))&&(i.hasClass("e-headercelldiv")&&(i=i.parent()),this.getHeaderTable().find(".e-columnheader").find(".e-headercell-hover").removeClass("e-headercell-hover").removeClass("e-hover"),i.addClass("e-headercell-hover e-hover")),i.hasClass("e-gridtooltip")&&this._showTooltip(i),(i.hasClass("e-gridheadertooltip")||i.find(".e-gridheadertooltip").length)&&this._showTooltip(i,!0),t.type=="mouseover"&&this._addCursor()):this.model.enableHeaderHover&&this.getHeaderTable().find(".e-columnheader").find(".e-headercell-hover").removeClass("e-headercell-hover").removeClass("e-hover")},_addCursor:function(){var e=this.model.allowResizing||this.model.allowResizeToFit||this.model.allowGrouping||this.model.allowFiltering||this.model.allowSorting||this.model.allowReordering||this.model.contextMenuSettings.enableContextMenu||this._allowcolumnSelection,f,i,r,n,u;if(e){if(this.getHeaderTable().find(".e-columnheader").removeClass("e-defaultcursor"),!(this.model.contextMenuSettings.enableContextMenu||this.model.selectionSettings.selectionMode=="column")){for(i=[{val:this.model.allowSorting,str:"sort"},{val:this.model.allowGrouping,str:"group"},{val:this.model.allowReordering,str:"reorder"},{val:this.model.allowFiltering,str:"filter"},{val:this.model.allowResizing,str:"resize"}],r=0,n=0;n<i.length;n++)i[n].val==!1&&(i.splice(n,1),n--);for(n=0;n<this.model.columns.length&&i.length>0;n++){for(u=0;u<i.length;u++)switch(i[u].str){case"sort":t.isNullOrUndefined(this.model.columns[n].allowSorting)||this.model.columns[n].allowSorting||r++;break;case"group":t.isNullOrUndefined(this.model.columns[n].allowGrouping)||this.model.columns[n].allowGrouping||r++;break;case"reorder":t.isNullOrUndefined(this.model.columns[n].allowReordering)||this.model.columns[n].allowReordering||r++;break;case"filter":t.isNullOrUndefined(this.model.columns[n].allowFiltering)||this.model.columns[n].allowFiltering||r++;break;case"resize":t.isNullOrUndefined(this.model.columns[n].allowResizing)||this.model.columns[n].allowResizing||r++}f=t.isNullOrUndefined(this.model.columns[n].template)&&t.isNullOrUndefined(this.model.columns[n].templateID)?!1:!0;r!=i.length||f||this.getHeaderTable().find(".e-headercell").eq(n).addClass("e-defaultcursor");r=0}}}else this.getHeaderTable().find(".e-columnheader").addClass("e-defaultcursor"),this.getHeaderTable().find(".e-headercell").removeClass("e-defaultcursor")},_colgroupRefresh:function(){var t,i,r,u;(this.model.allowResizing||this.model.allowResizeToFit)&&this.model.scrollSettings.frozenColumns>0?(t=n(this.getHeaderTable()).find("colgroup"),i=n(this.getContentTable()).find("colgroup")):(t=n(this.getHeaderTable()).find("colgroup")[0],i=n(this.getContentTable()).find("colgroup")[0]);r=n(t).clone();u=n(i).clone();n(i).remove();n(t).remove();(this.model.allowResizing||this.model.allowResizeToFit)&&this.model.scrollSettings.frozenColumns>0?(n(r[0]).prependTo(this.getHeaderTable()[0]),n(r[1]).prependTo(this.getHeaderTable()[1]),n(u[0]).prependTo(this.getContentTable()[0]),n(u[1]).prependTo(this.getContentTable()[1])):(n(r).prependTo(this.getHeaderTable()),n(u).prependTo(this.getContentTable()))},_detailColsRefresh:function(){this._$headerCols=this.getHeaderTable().children("colgroup").find("col");this._$contentCols=this.getContentTable().children("colgroup").find("col");var n=this.model.columns.length;this._$headerCols.length>n&&this._$headerCols.splice(0,this._$headerCols.length-n);this._$contentCols.length>n&&this._$contentCols.splice(0,this._$contentCols.length-n)},_summaryColRrefresh:function(){for(var t=this.getFooterContent().find(".e-gridsummary"),n=0;n<this.columnsWidthCollection.length;n++)t.find("col").eq(n).width(this.columnsWidthCollection[n])},_headerdblClickHandler:function(n){this.model.allowResizeToFit&&this._resizer._columnResizeToFit(n);this.model.allowScrolling&&(this.getScrollObject().refresh(this.model.scrollSettings.frozenColumns>0),this.getScrollObject().isVScroll()&&(this.getHeaderContent().addClass("e-scrollcss"),this.getHeaderContent().find(".e-headercontent").addClass("e-hscrollcss")))},_mouseUp:function(n){this.model.allowResizing&&this._resizer._mouseUp(n)},_mouseMove:function(n){this.model.allowResizing&&this._resizer._mouseMove(n)},_setModel:function(r){var u,k,d,ot,g,h,a,s,st,y,ht,ct,p,nt,w,c,tt,it,lt,at,vt,e,rt,f,v,l,b,yt,o,et;for(u in r)switch(u){case"enableResponsiveRow":r[u]?(this.element.addClass("e-responsive"),this.model.minWidth&&(this._removeMedia(),this._scrollerAddedOnMedia=!1),this.model.allowFiltering&&(this.element.find(".e-filterDialog").remove(),this._renderFilterDialogs(),this._renderResponsiveFilter(),this.element.find(".e-gridtoolbar").remove())):(this.model.allowFiltering&&(n("body").find(".e-filterDialog").remove(),this._renderFilterDialogs()),this.element.css("display")=="none"&&this.element.css("display","block"),this.element.removeClass("e-responsive"),this.model.minWidth&&this._addMedia(),this.model.allowScrolling&&(this.getScrollObject().refresh(),this.getScrollObject().isVScroll()?this.getScrollObject().isVScroll()&&(this.getHeaderContent().addClass("e-scrollcss"),this.getHeaderContent().find(".e-headercontent").addClass("e-hscrollcss")):(this.getHeaderContent().removeClass("e-scrollcss"),this.getHeaderContent().find(".e-headercontent").removeClass("e-hscrollcss"))));this._tdsOffsetWidth=[];(this.model.allowFiltering||this.model.allowSorting)&&(k=this.model.toolbarSettings.toolbarItems.indexOf("responsiveFilter"),k!=-1&&this.model.toolbarSettings.toolbarItems.splice(k,1),d=this.model.toolbarSettings.toolbarItems.indexOf("responsiveSorting"),d!=-1&&this.model.toolbarSettings.toolbarItems.splice(d,1),this.element.find(".e-gridtoolbar").remove(),this._renderToolBar().insertBefore(this.element.find(".e-gridheader").first()));break;case"showColumnChooser":r[u]?(this._visibleColumns=[],this._hiddenColumns=[],this._visibleColumnsField=[],this._hiddenColumnsField=[],this._renderGridHeaderInternalDesign(this.model.columns),this._renderColumnChooser()):(ot=n("#"+this._id+"ccDiv").data("ejDialog"),ot.isOpened()&&n("#"+this._id+"_ccTail").remove(),g=0,t.isNullOrUndefined(this.element.find(".e-ccButton").outerHeight())||(g+=this.element.find(".e-ccButton").outerHeight()),this.element.find(".e-ccButton").remove(),n("#"+this._id+"ccDiv_wrapper").remove(),this.element.css("margin-top",parseInt(this.element.css("margin-top"),10)-g));break;case"gridLines":this.getContent().removeClass("e-horizontallines e-verticallines e-hidelines");this.getHeaderContent().removeClass("e-horizontallines e-verticallines e-hidelines");this._showHeaderGridLines();this._showGridLines();break;case"showDeleteConfirmDialog":this.model.editSettings.showDeleteConfirmDialog=r[u];r[u]?this._renderConfirmDialog():this.element.find("#"+this._id+"ConfirmDialog_wrapper").remove();break;case"showConfirmDialog":this.model.editSettings.showConfirmDialog=r[u];r[u]?this._renderConfirmDialog():this.element.find("#"+this._id+"ConfirmDialog_wrapper").remove();break;case"pageSettings":if(h=this.getPager().ejPager("model"),t.isNullOrUndefined(r[u].currentPage)||h.currentPage!=this._currentPage()){for(a in r[u])a!="currentPage"&&r[u][a]===h[a]&&delete r[u][a];if(n.isEmptyObject(r[u]))break;r[u].currentPage=this._currentPage();s={};n.extend(s,r[u]);s.template!=i&&s.template!=h.template&&(s.template=null);this.getPager().ejPager("option",s);this._renderPagerTemplate(this.getPager(),s.showDefaults);this._currentPage(this._currentPage()>h.totalPages?h.totalPages:this._currentPage());this.refreshContent()}break;case"columns":st=r.columns;this.model.columns=[];this.columns(st,"add");break;case"allowPaging":this.model.allowPaging=r[u];r[u]&&this.element.children(".e-pager").length==0?(this.model.isResponsive&&(this.model.pageSettings.isResponsive=!0),this.element.append(this._renderGridPager()),this.refreshContent(),this.getPager().ejPager("refreshPager")):(this.getPager().remove(),this.setGridPager(null),this.refreshContent(),this.model.filterSettings.filterType=="filterbar"&&this.model.allowFiltering&&this._createPagerStatusBar());break;case"selectionType":this.multiDeleteMode=this.model.editSettings.allowDeleting&&this.model.selectionType=="multiple";break;case"allowSearching":this.model.allowSearching=r[u];break;case"searchSettings":n.extend(this.model.searchSetings,r[u]);this.refreshContent();break;case"allowGrouping":if(r[u]&&this.element.children(".e-groupdroparea").length==0)this.model.allowGrouping=r[u],this.addGroupingTemplate(),this.model.showColumnChooser&&this.element.find(".e-ccButton").length>0?this.element.find(".e-ccButton").after(this._renderGroupDropArea()):this.element.prepend(this._renderGroupDropArea()),this._enableGroupingEvents(),this.model.groupSettings.showDropArea&&this._headerCellgDragDrop(),this._off(this.element,"mouseenter mouseleave",".e-groupdroparea,.e-groupheadercell",this._dropAreaHover),this._on(this.element,"mouseenter mouseleave",".e-groupdroparea,.e-groupheadercell",this._dropAreaHover);else{if(this.element.children(".e-groupdroparea").remove(),this.model.groupSettings.groupedColumns.length>0)for(f=this.model.groupSettings.groupedColumns.length;f>0;f--)this.ungroupColumn(this.model.groupSettings.groupedColumns[0]);this.model.allowReordering||(this.element.find(".e-draggable, .e-droppable").ejDraggable(),this.element.find(".e-draggable, .e-droppable").ejDraggable("destroy"))}this.model.allowGrouping&&(t.isNullOrUndefined(r.groupSettings)||n.extend(this.model.groupSettings,r.groupSettings),this._enableGrouping());break;case"groupSettings":n.extend(this.model.groupSettings,r[u]);this.model.allowGrouping&&t.isNullOrUndefined(r.allowGrouping)&&this._enableGrouping();t.isNullOrUndefined(this.model.groupSettings.enableDropAreaAnimation)||(this.model.groupSettings.enableDropAreaAutoSizing=this.model.groupSettings.enableDropAreaAnimation);this.model.allowReordering||this.model.groupSettings.showDropArea||(this.element.find(".e-draggable, .e-droppable").ejDraggable(),this.element.find(".e-draggable, .e-droppable").ejDraggable("destroy"));break;case"cssClass":this.element.removeClass(this.model.cssClass).addClass(r[u]);break;case"allowFiltering":case"filterSettings":if(u=="filterSettings"?n.extend(this.model.filterSettings,r[u]):this.model.allowFiltering=r[u],this.filterColumnCollection=[],this._excelColTypes=[],this._$fDlgIsOpen&&this._closeFDialog(),this.model.allowFiltering){if(this.model.filterSettings.filterType==t.Grid.FilterType.FilterBar)for(this.getHeaderTable().find(".e-filterbar").remove(),this.getHeaderTable().find(".e-columnheader").find(".e-filtericon").remove().end().find(".e-headercellfilter").removeClass("e-headercellfilter"),this._renderFiltering(),this._renderFilterBarTemplate(),this.model.filterSettings.showFilterBarStatus&&!this.model.allowPaging?this._createPagerStatusBar():this.model.allowPaging&&this.getPager().ejPager({enableExternalMessage:this.model.filterSettings.showFilterBarStatus}),ht=this.getHeaderTable().find(".e-filterbar"),f=0;f<this.model.groupSettings.groupedColumns.length;f++)ht.prepend(this._getEmptyFilterBarCell());else if(!ct&&(this.model.filterSettings.filterType==t.Grid.FilterType.Menu||this.model.filterSettings.filterType==t.Grid.FilterType.Excel)){for(ct=1,this.getHeaderTable().find(".e-columnheader").find(".e-filtericon").remove().end().find(".e-headercellfilter").removeClass("e-headercellfilter"),this.getHeaderTable().find(".e-columnheader").find(".e-headercellsort").removeClass("e-headercellsort"),this.getHeaderTable().find(".e-filterbar").remove(),p=this.getHeaderTable().find(".e-columnheader").find(".e-headercell").not(".e-detailheadercell"),f=0;f<p.length;f++)nt=p.eq(f).find(".e-headercelldiv").attr("data-ej-mappingname"),t.isNullOrUndefined(nt)||(w=this.getColumnByField(nt),!t.isNullOrUndefined(w)&&(t.isNullOrUndefined(w.allowFiltering)||w.allowFiltering)&&p.eq(f).addClass("e-headercellfilter").append(t.buildTag("div.e-filtericon e-icon e-filterset")));this.model.groupSettings.showToggleButton&&(this.getHeaderTable().find(".e-columnheader").find(".e-headercellgroup").removeClass("e-headercellgroup"),c=this.getHeaderTable().find("thead tr:not('.e-stackedHeaderRow')").find(".e-headercell").not(".e-detailheadercell"),c.addClass("e-headercellgroupfilter"),c.find(".e-filterset").addClass("e-groupfiltericon"),c.find(".e-gridgroupbutton").addClass("e-togglegroup"),this.model.enableRTL&&(c.find(".e-gridgroupbutton").removeClass("e-rtltoggle"),c.find(".e-headercelldiv").addClass("e-headercelldivgroup")));this.model.filterSettings.filterType==t.Grid.FilterType.Excel?(this._isExcelFilter=!0,this._renderExcelFilter()):this._isExcelFilter&&(this._isExcelFilter=!1,this._excelFilter.resetExcelFilter(),this._excelFilter=null);this.model.filterSettings.filterType==t.Grid.FilterType.Menu&&this._renderFilterDialogs();r[u].hasOwnProperty("filterType")&&(this.model.filterSettings.filteredColumns=[]);this.refreshContent()}this._enableFilterEvents()}else this.model.filterSettings.filterType==t.Grid.FilterType.FilterBar?this.getHeaderTable().find(".e-filterbar").remove():(this.model.filterSettings.filterType==t.Grid.FilterType.Menu||this.model.filterSettings.filterType==t.Grid.FilterType.Excel)&&(this.getHeaderTable().find(".e-columnheader").find(".e-filtericon").remove().end().find(".e-headercellfilter").removeClass("e-headercellfilter"),this.getHeaderTable().find(".e-columnheader").find(".e-headercellsortfilter").removeClass("e-headercellsortfilter"),this.getHeaderTable().find(".e-columnheader").find(".e-headercellsort").removeClass("e-headercellsort"),y=this.getHeaderTable().find(".e-columnheader"),this.model.groupSettings.showToggleButton&&(this.getHeaderTable().find("thead tr:not('.e-stackedHeaderRow')").find(".e-headercell").not(".e-detailheadercell").addClass("e-headercellgroup"),y.find(".e-headercellgroupfilter").removeClass("e-headercellgroupfilter"),this.model.enableRTL&&(y.find(".e-gridgroupbutton").addClass("e-rtltoggle"),y.find(".e-headercelldivgroup").removeClass("e-headercelldivgroup")))),(this._isExcelFilter||this._excelFilterRendered)&&(this._isExcelFilter=this._excelFilterRendered=!1,this._excelFilter.resetExcelFilter(),this._excelFilter=null),this.model.filterSettings.filteredColumns=[],this.refreshContent();this.model.isResponsive&&this.model.allowScrolling&&(tt={},tt.requestType="filtering",this._refreshScroller(tt));break;case"enableRowHover":this.model.enableRowHover=r[u];this._enableRowHover();break;case"allowScrolling":case"scrollSettings":if(it=!1,e=this.getContent(),u!="allowScrolling"){if(!t.util.isNullOrUndefined(r.scrollSettings)){if(n.isEmptyObject(r.scrollSettings))break;t.util.isNullOrUndefined(r.scrollSettings.enableVirtualization)||t.util.isNullOrUndefined(r.scrollSettings.allowVirtualScrolling)||(r.scrollSettings.allowVirtualScrolling=r.scrollSettings.enableVirtualization);n.extend(this.model.scrollSettings,r.scrollSettings)}this._initHeight=this.model.scrollSettings.height;this._isHeightResponsive=this.model._isHeightResponsive=this.model.scrollSettings.height=="100%"?!0:!1;t.util.isNullOrUndefined(r.allowScrolling)||(this.model.allowScrolling=r.allowScrolling);this._columnsPixelConvert();this.model.scrollSettings.allowVirtualScrolling&&(this._currentPage(1),this.model.currentIndex=1,this.model.scrollSettings.enableVirtualization?(this.model.scrollSettings.scrollTop=this.getScrollObject().model.scrollTop,this._virtualRowCount=Math.round(this.model.scrollSettings.height/this.getRowHeight())+1,this._refreshVirtualViewDetails(),this._singleView||this._refreshVirtualViewData(),this._refreshVirtualView(this._currentVirtualIndex)):(this._createPagerStatusBar(),this._showPagerInformation(this.model.pageSettings)));r.scrollSettings.frozenColumns!==i||r.scrollSettings.frozenRows!==i||r.scrollSettings.allowVirtualScrolling!==i||r.scrollSettings.virtualScrollMode!==i||r.scrollSettings.enableVirtualization!=i?(o=this.model,o.query=this.commonQuery.clone(),this._selectedRow()!=-1&&(this.clearSelection(this._selectedRow()),this._selectedRow(-1),this._selectAllCheck||this._selectedMultipleRows([])),r.scrollSettings.virtualScrollMode!=i&&(o.pageSettings.currentPage=1),it=!0,this.element.ejGrid("destroy").ejGrid(o)):(t.util.isNullOrUndefined(e.data("ejScroller"))||e.ejScroller("destroy"),this.getContentTable().css("width","100%"),this.getHeaderTable().css("width","100%"),this.model.allowScrolling?(this.getHeaderContent().find("div").first().addClass("e-headercontent"),this._originalScrollWidth=this.model.scrollSettings.width,this._renderScroller(),this.setWidthToColumns(),t.util.isNullOrUndefined(e.data("ejScroller"))||this.getScrollObject().refresh(),this.refreshScrollerEvent()):(this.element.children(".e-gridheader").removeClass("e-scrollcss"),this.element.get(0).style.width.length==0&&this.element.css("width","auto"),this.setWidthToColumns()),this._addLastRow())}it||t.isNullOrUndefined(this.model)||(t.util.isNullOrUndefined(r.scrollSettings)&&this._columnsPixelConvert(),this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length>0&&(this._groupingAction(!0),this._recalculateIndentWidth()),!t.isNullOrUndefined(this.getContent().data("ejScroller"))&&this.model.allowScrolling&&(lt=this.getScrollObject()),at=this.model.enableRTL?"e-summaryscroll e-rtl":"e-summaryscroll",this.model.allowScrolling&&this.model.showSummary&&(lt._vScroll&&this.element.find(".e-summaryrow.e-scroller").addClass(at),this._scrollFooterColgroup()));break;case"currentIndex":this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization?(vt=Math.ceil(r.currentIndex/this._virtualRowCount),this._isThumbScroll=!0,this._refreshVirtualView(vt),this._refreshVirtualViewScroller(!0)):this._scrollObject.option("scrollTop",r.currentIndex*this.getRowHeight());break;case"locale":this.model.locale=r[u];this.model.query=this.commonQuery.clone();this._destroy();this.element.css("margin-top","0px").addClass("e-grid"+this.model.cssClass);this._init();break;case"dataSource":for(e=this.element.find(".e-gridcontent").first(),n.isFunction(r.dataSource)||this.resetModelCollections(),this._gridRecordsCount==1&&!t.isNullOrUndefined(this._cDeleteData)&&n.inArray(this._cDeleteData[0],this._dataSource())==-1&&this.model.editSettings.allowDeleting&&(this._gridRecordsCount=this._dataSource().length),f=0;f<this.model.columns.length;f++)this.model.columns[f].template!==i&&(this._columntemplaterefresh=!0);this._updateDataSource=!0;this._refreshDataSource(this._dataSource());this.element.children(".e-gridfooter").remove();this.model.showSummary&&this.model.currentViewData.length>0&&(l=this._renderGridFooter(),t.isNullOrUndefined(l)||l.insertAfter(e));(!this.model.scrollSettings.enableVirtualization||this._gridRows.length<this._virtualRowCount)&&this._addLastRow();break;case"selectedRowIndex":this._selectedRow()!=-1&&n.inArray(this._selectedRow(),this.selectedRowsIndexes)==-1?(this.model.currentIndex=this._selectedRow(),this.selectRows(this._selectedRow())):this._selectedRow()==-1&&(this.clearSelection(),this.selectedRowsIndexes=[]);break;case"selectedRowIndices":this.model.allowSelection==!0&&this.model.selectionType=="multiple"&&this._selectedMultipleRows().length>0?(rt=typeof r[u]=="function"?r[u]():r[u],this.clearSelection(),this.selectedRowsIndexes=rt,this.selectRows(rt),this.model.selectedRecords=this.getSelectedRecords()):this._selectedMultipleRows().length==0&&this.clearSelection();break;case"editType":this._selectedRow()!=-1&&n.inArray(this._selectedRow(),this.selectedRowsIndexes)==-1&&this.selectRows(this._selectedRow());break;case"editSettings":n.extend(this.model.editSettings,r[u]);this.refreshToolbar();this.refreshContent(!0);this.refreshBatchEditMode();this._tdsOffsetWidth=[];n("#"+this._id+"_dialogEdit").data("ejDialog")&&n("#"+this._id+"_dialogEdit").ejDialog("destroy");n("#"+this._id+"_dialogEdit_wrapper,#"+this._id+"_dialogEdit").remove();n("#"+this._id+"_externalEdit").remove();this.getContentTable().find(".e-insertedrow").remove();this.model.isEdit=!1;this.model.editSettings.editMode!="normal"&&(this.model.editSettings.showAddNewRow=!1);this.model.editSettings.showAddNewRow||this.getContentTable().find(".e-addedrow").length&&this.cancelEdit();(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?this.element.append(this._renderDialog()):(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&this.element.append(this._renderExternalForm()));(this.model.editSettings.allowDeleting&&this.model.editSettings.showDeleteConfirmDialog||this.model.editSettings.editMode=="batch"&&this.model.editSettings.showConfirmDialog)&&t.isNullOrUndefined(this._confirmDialog)&&this._renderConfirmDialog();this._enableEditingEvents();this.refreshToolbar();break;case"allowResizing":this.model.allowResizing=r[u];this.model.allowResizing?(this._on(this.element,t.eventType.mouseMove,this._mouseMove),this._on(this.element,"mouseup",this._mouseUp),this._resizer=this._resizer||new t.gridFeatures.gridResize(this)):(this._off(this.element,t.eventType.mouseMove,this._mouseMove),this._off(this.element,"mouseup",this._mouseUp),this.model.allowResizeToFit||(this._resizer=null));break;case"allowResizeToFit":this.model.allowResizeToFit?(this._on(this.element,"dblclick",".e-gridheader",this._headerdblClickHandler),this._resizer=this._resizer||new t.gridFeatures.gridResize(this),this.setWidthToColumns()):(this._off(this.element,"dblclick",".e-gridheader",this._headerdblClickHandler),this.model.allowResizing||(this._resizer=null));break;case"allowReordering":this.model.allowReordering=r[u];this.model.allowReordering?this._headerCellreorderDragDrop():this.model.allowGrouping||this.element.find(".e-draggable, .e-droppable").ejDraggable("destroy");break;case"allowRowDragAndDrop":this.model.allowRowDragAndDrop?(this._rowsDragAndDrop(),this.model.selectionType=="multiple"&&this._on(this.element,"touchstart mousedown",".e-gridcontent",this._contentMouseDown),this.model.allowScrolling&&this.getContent().ejScroller({thumbStart:function(){return!1}})):(this._off(this.element,"touchstart mousedown",".e-gridcontent",this._contentMouseDown),this.getContent().ejDroppable("destroy"),n(this.getRows()).ejDraggable("destroy"),this.getContent().ejScroller({thumbStart:null}));break;case"showSummary":case"summaryRows":if(u=="showSummary"&&r[u]&&this.addSummaryTemplate(),u!="showSummary"||r[u]){if(u=="summaryRows"&&this.model.showSummary||u=="showSummary"){this.element.children(".e-gridfooter").remove();this.element.children(".e-gridfooter").remove();var e=this.element.find(".e-gridcontent").first(),ut=this.model.query.queries,ft=[];for(f=0;f<ut.length;f++)ut[f].fn==="onPage"&&(ft=ut.splice(f,1));v=this.model.query;this._setSummaryAggregate(v);ft.length&&v.queries.push(ft[0]);this.model.currentViewData.length&&(this._isLocalData?(this._remoteSummaryData=this._dataManager.executeLocal(v).aggregates,l=this._renderGridFooter(),t.isNullOrUndefined(l)||l.insertAfter(e)):(b=this,yt=this._dataManager.executeQuery(v),yt.done(function(n){b.element.children(".e-gridfooter").remove();b._remoteSummaryData=n.aggregates;var i=b._renderGridFooter();t.isNullOrUndefined(i)||i.insertAfter(e)})));this.model.allowGrouping&&(this._rowCol=this._captionSummary(),this._isCaptionSummary=(this._rowCol!=null&&this._rowCol.length)>0?!0:!1,this.refreshContent(!0))}}else this.element.children(".e-gridfooter").remove();break;case"enableAltRow":this.model.enableAltRow=r[u];this.addInitTemplate();this.refreshContent();break;case"toolbarSettings":n.extend(this.model.toolbarSettings,r[u]);this.element.children(".e-gridtoolbar").remove();this.model.toolbarSettings.showToolbar&&this._renderToolBar().insertBefore(this.element.find(".e-gridheader").first());break;case"allowSorting":this.model.allowSorting=r[u];this.model.allowSorting||this.clearSorting();break;case"selectionSettings":n.extend(this.model.selectionSettings,r[u]);this.clearSelection();this.clearCellSelection();this.clearColumnSelection();this._allowrowSelection=this._allowcellSelection=this._allowcolumnSelection=!1;this.model.selectionSettings.selectionMode.length>0&&this.model.allowSelection&&this._initSelection();break;case"sortSettings":n.extend(this.model.sortSettings,r[u]);this.refreshContent();break;case"contextMenuSettings":n.extend(this.model.contextMenuSettings,r[u]);!t.isNullOrUndefined(n("#"+this._id+"_Context").data("ejMenu"))&&n("#"+this._id+"_Context").ejMenu("destroy")&&n("#"+this._id+"_Context").remove();this.model.contextMenuSettings.enableContextMenu&&this._renderContext();break;case"enableRTL":this.model.enableRTL=r[u];o=this.model;o.query=this.commonQuery.clone();this.element.ejGrid("destroy");o.enableRTL?n("#"+this._id).addClass("e-rtl"):n("#"+this._id).removeClass("e-rtl");n("#"+this._id).ejGrid(o);break;case"enableTouch":this.model.enableTouch=r[u];this.model.enableTouch?(this._on(this.element,"swipeleft swiperight",".e-gridcontent .e-table",n.proxy(this._touchGrid,this)),this.element.removeClass("e-touch")):(this.element.addClass("e-touch"),this._off(this.element,"swipeleft swiperight",".e-gridcontent .e-table"));break;case"allowSelection":r[u]?(this._off(this.element,n.isFunction(n.fn.tap)&&this.model.enableTouch?"tap":"click",this._clickHandler),this._on(this.element,"click",this._clickHandler),this._initSelection()):(this.clearSelection(),this.clearCellSelection(),this.clearColumnSelection(),this._allowrowSelection=this._allowcellSelection=this._allowcolumnSelection=!1);break;case"query":this.commonQuery=n.extend(!0,{},r[u]);break;case"showStackedHeader":case"stackedHeaderRows":this.model.showStackedHeader&&r.stackedHeaderRows&&r.stackedHeaderRows.length>0?(t.getObject("stackedHeaderRows.length",r)&&(this.model.stackedHeaderRows=r.stackedHeaderRows),this._refreshStackedHeader()):this.getHeaderTable().find(".e-stackedHeaderRow").remove();break;case"allowTextWrap":case"textWrapSettings":n.extend(this.model.textWrapSettings,r[u]);this._setTextWrap();break;case"rowTemplate":this.refreshContent(!0);break;case"keySettings":this.model.keySettings&&n.extend(this.model.keyConfigs,this.model.keySettings);break;case"detailsTemplate":this.model.scrollSettings.frozenColumns>0||this.model.scrollSettings.frozenRows>0?(this._renderAlertDialog(),this._alertDialog.find(".e-content").text(this._getLocalizedLabels("FrozenNotSupportedException")),this._alertDialog.ejDialog("open")):(et=this.element.children(".e-gridheader"),et.find("div").first().empty().append(this._renderGridHeader().find("table")),this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&this._renderFiltering(),this.setGridHeaderContent(et),this.refreshContent(!0),this.model.allowReordering&&this._headerCellreorderDragDrop(),this.model.allowGrouping&&this.model.groupSettings.showDropArea&&this._headerCellgDragDrop())}},resetModelCollections:function(){this.model.groupSettings.groupedColumns=[];this.model.filterSettings.filteredColumns=[];this.filterColumnCollection=[];this.model.sortSettings.sortedColumns=[];this.model.pageSettings.currentPage=this.defaults.pageSettings.currentPage},_enableGrouping:function(){var h,f,r,e,o,s,u;if(this.refreshTemplate(),this.model.groupSettings.showToggleButton)for(h=this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this.model.filterSettings.filterType=="excel"),f=this.model.columns,r=0;r<f.length;r++)e=this.getHeaderTable().find(".e-columnheader").find(".e-headercell").not(".e-stackedHeaderCell, .e-detailheadercell").eq(r),o=f[r].field,n.inArray(o,this._disabledGroupableColumns)!=-1||t.isNullOrUndefined(o)||o==""||e.find(".e-gridgroupbutton").length||(n.inArray(o,this.model.groupSettings.groupedColumns)!=-1?e.append(this._getToggleButton().addClass("e-toggleungroup")):e.append(this._getToggleButton().addClass("e-togglegroup")),h&&(f[r].allowFiltering==i||f[r].allowFiltering===!0)&&(!t.isNullOrUndefined(f[r].field)||f[r].field=="")&&f[r].type!="checkbox"&&(e.addClass("e-headercellgroupfilter"),e.find(".e-filtericon").addClass("e-groupfiltericon")),e.addClass("e-headercellgroup"));if(this.model.groupSettings.showToggleButton||this.getHeaderTable().find(".e-gridgroupbutton").remove(),this.element.find(".e-groupdroparea").remove(),this.model.groupSettings.showDropArea&&(this.model.showColumnChooser&&this.element.find(".e-ccButton").length>0?this.element.find(".e-ccButton").after(this._renderGroupDropArea()):this.element.prepend(this._renderGroupDropArea()),t.gridFeatures.dragAndDrop&&(this._groupHeaderCelldrag(),this._headerCellgDragDrop())),!t.isNullOrUndefined(this.model.groupSettings.groupedColumns.length)&&this.model.groupSettings.groupedColumns.length){for(s={},s.columnName=this.model.groupSettings.groupedColumns[this.model.groupSettings.groupedColumns.length-1],s.requestType=t.Grid.Actions.Grouping,this.element.find(".e-groupdroparea").empty(),u=0;u<this.model.groupSettings.groupedColumns.length-1;u++)this._addColumnToGroupDrop(this.model.groupSettings.groupedColumns[u]);for(u=0;u<this.model.groupSettings.groupedColumns.length;u++)t.isNullOrUndefined(this.getsortColumnByField(this.model.groupSettings.groupedColumns[u]))&&this.model.sortSettings.sortedColumns.push({field:this.model.groupSettings.groupedColumns[u],direction:t.sortOrder.Ascending});this._processBindings(s)}},addIgnoreOnExport:function(n){typeof n=="string"?this.ignoreOnExport.push(n):this.ignoreOnExport=this.ignoreOnExport.concat(n)},addIgnoreOnToolbarServerClick:function(n){typeof n=="string"?this.ignoreOnToolbarServerClick.push(n):this.ignoreOnToolbarServerClick=this.ignoreOnToolbarServerClick.concat(n)},_decode:function(t){return n("<div/>").html(t).text()},_htmlEscape:function(n){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};return n.replace(/[&<>"']/g,function(n){return t[n]})},_mappingSelection:function(){var i,n;if(t.gridFeatures.selection&&this._enableCheckSelect){for(this.multiSelectCtrlRequest=!0,i=[],n=0;n<this._currentJsonData.length;n++)t.pvt.getObject(this._selectionMapColumn,this._currentJsonData[n])==!0&&i.push(n);this.selectedRowsIndexes=[];this.checkSelectedRowsIndexes=[];this._selectedRow(-1);this._selectionByGrid=!0;i.length&&this.selectRows(i);this._selectionByGrid=!1}},_headerCheckUpdateAll:function(n){for(var r=[],r=this._isLocalData?this.model.searchSettings.key!=""||this.model.filterSettings.filteredColumns.length?this.getFilteredRecords():this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json:this._dataSource():this._currentJsonData,i=0;i<r.length;i++)r[i][this._selectionMapColumn]=n,this.batchChanges.changed.push(r[i]);this.clearSelection();this.batchSave();return},_getForeignKeyData:function(n){for(var r=this,f={},u,e,i=0;i<this.model.columns.length;i++)this.model.columns[i].foreignKeyValue&&this.model.columns[i].dataSource&&(u=t.isNullOrUndefined(r.model.columns[i].foreignKeyField)?r.model.columns[i].field:r.model.columns[i].foreignKeyField,e=this.model.columns[i].dataSource instanceof t.DataManager?this.model.columns[i].foreignKeyData:this.model.columns[i].dataSource,e.filter(function(e){var o=t.getObject(r.model.columns[i].field,n),s=!isNaN(parseFloat(o))&&isFinite(o)?parseFloat(o):o;e[u]==s&&(f[u]=e)}));return f},_foreignKeyBinding:function(i,r,u){var f,e,o=n("#"+u).ejGrid("instance"),s;return i=o.model.columns[i],s=i.dataSource instanceof t.DataManager?i.foreignKeyData:i.dataSource,s.filter(function(n){if(t.getObject(i.foreignKeyField,n)==r)return e=t.getObject(i.foreignKeyValue,n),f=i.type=="date"?new Date(e):e}),i.format&&(f=o.formatting(i.format,f,o.model.locale)),f},_checkForeignKeyBinding:function(){if(this.model.columns.length){var i,r,u,n;for(i=0,r=this.model.columns,u=r.length;i<u;i++)n=r[i],n.hasOwnProperty("foreignKeyField")&&n.dataSource instanceof t.DataManager&&this._relationalColumns.push({field:n.field,key:n.foreignKeyField,value:n.foreignKeyValue,dataSource:n.dataSource});this._$fkColumn=!0}},_setForeignKeyData:function(r){var h,k,c,p,l,s,a;if(this._relationalColumns.length){var w=this._relationalColumns,d=this._relationalColumns.length,v=[],o=this.model.currentViewData,u={},f,y,b,e=this;if(o.length==0)for(h=0,k=this.model.columns.length;h<k;h++)c=this.model.columns[h],!t.isNullOrUndefined(c.foreignKeyField)&&c.dataSource instanceof t.DataManager&&(c.foreignKeyData=[]);for(p=t.proxy(function(n){this._trigger("actionFailure",{requestType:"fetchingforeigndata",error:n.error})},this),this.element.ejWaitingPopup("model.showOnInit")||this.element.ejWaitingPopup("show"),l=0;l<d;l++)if(0 in o){for(f=w[l],u.field=f.field,u.keyField=f.key,u.valueField=f.value,u.dataSource=f.dataSource,u.query=(new t.Query).select([u.valueField,u.keyField]),y=t.distinct(o.level?o.records:o,u.field,!0),s=[],a=0;a<y.length;a++)s.push(new t.Predicate(u.keyField,"equal",y[a][u.field],!0));if(s=t.Predicate.or(s),u.query.where(s),this._trigger("actionBegin",n.extend(u,{requestType:"fetchingforeigndata",column:this.getColumnByField(u.field)})))return;b=u.dataSource.ready===i?u.dataSource.executeQuery(u.query,null,p):u.dataSource.ready.fail(p);v.push(b)}n.when.apply(this,v).then(function(){var u,n,t,o,i,s;for(e.element.ejWaitingPopup("hide"),u=[].slice.call(arguments,0,arguments.length),t=0,o=v.length;t<o;t++)for(f=w[t],i=0,s=e.model.columns.length;i<s;i++)n=e.model.columns[i],n.foreignKeyField==f.key&&n.foreignKeyValue==f.value&&n.field==f.field&&(n.foreignKeyData=u[t].result);e.initialRender?e._initGridRender():e.sendDataRenderingRequest(r)})}},_isRelationalRendering:function(n){return 0 in this._relationalColumns&&["add","beginedit","cancel"].indexOf(n.requestType)==-1}}})(jQuery,Syncfusion),function(n,t,i){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.edit={_processEditing:function(){var o=this._columnToSelect(),c=o.query,r=[],p=o.fields,f=[],w,s=this._relationalColumns,b=s.length,v,e,k,l,d,y,u,h,a,g;if(this.model.query._fromTable!=""&&c.from(this.model.query._fromTable),v=p.length,v&&!t.isNullOrUndefined(this._dataManager)&&f.push(this._dataManager.executeQuery(c)),b!=0)for(l=0;l<b;l++)e=s[l],k=(new t.Query).select([e.key,e.value]),w=e.dataSource.ready===i?e.dataSource.executeQuery(k):e.dataSource.ready,f.push(w);if(o.fieldsDrop.length)for(d=o.fieldsDrop.length,y=o.fieldsDrop,u=0;u<d;u++)h=[],a=this.getColumnByField(y[u]),t.isNullOrUndefined(t.getObject("editParams.fields.text",a))?r.push(y[u]):(g=a.editParams,r.push(g.fields)),r[u]instanceof Object?(h.push(r[u].text),h.push(r[u].value)):h.push(r[u]),c=(new t.Query).select(h),f.push(a.dataSource.executeQuery(c));f.length!=0?n.when.apply(this,f).then(t.proxy(function(){for(var o,l,i=[].slice.call(arguments,0,arguments.length),n=0,e=0,u=0,h=v,c,a=f.length;n<a;n++){while(h>0)t.createObject(p[--h],i[n].result,this._dropDownManager),c=!0;if(!c||n!=0){if(s.length!=e){o=s[e];l=o.field+"."+o.key+"."+o.value;t.createObject(l,i[n].result,this._dropDownManager);e++;continue}s.length==e&&r.length&&(r[u]instanceof Object?(t.createObject(r[u].text,i[n].result,this._dropDownManager),t.createObject(r[u].value,i[n].result,this._dropDownManager)):t.createObject(r[u],i[n].result,this._dropDownManager),u++)}}this._initiateTemplateRendering()},this)):this._initiateTemplateRendering()},_initiateTemplateRendering:function(){this.model.editSettings.editMode=="normal"?this.addEditingTemplate():this.model.editSettings.editMode=="batch"?this.addBatchEditTemplate():this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="inlineform"?this.addDialogEditingTemplate():this.addExternalDialogEditingTemplate();this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal"&&this._startAdd()},addEditingTemplate:function(){var c,s,r,u,e,w,f,b,h;if(this.model.columns.length!=0){var o=t.buildTag("tbody"),v=t.buildTag("tr"),y=t.buildTag("td","",{},{colSpan:this.model.scrollSettings.frozenColumns>0?this.model.scrollSettings.frozenColumns:this.model.columns.length}),p=t.buildTag("form","",{},{id:this._id+"EditForm","class":"gridform"}),l=t.buildTag("table.e-table"),k=t.buildTag("tbody"),a=t.buildTag("tr");for(o.append(v),v.append(y),y.append(p),c=n(document.createElement("colgroup")),p.append(l),l.append(c),k.append(a).appendTo(l),this.model.scrollSettings.frozenColumns>0&&(s=o.clone(),s.find("td").first().prop("colSpan",this.model.columns.length-this.model.scrollSettings.frozenColumns)),r=0;r<this.model.columns.length;r++)(u=t.buildTag("td.e-rowcell"),a.append(u.get(0)),this.model.columns[r].type!="checkbox"||this._isMapSelection)&&(t.isNullOrUndefined(this.model.columns[r].commands)&&(!this.model.columns[r].template||this.model.columns[r].template&&this.model.columns[r].allowEditing!=!1&&this.model.columns[r].field)?this._initCellEditType(r,u):this.model.columns[r].template?(f={},e=this.model.columns[r].headerText,f["_"+this._id+"ColumnTemplating"]=t.proxy(this._gridTemplate,null,this),n.views.helpers(f),t.isNullOrUndefined(e)||t.isNullOrUndefined(e.match(/[^0-9\s\w]/g))||(e=e.replace(/[^0-9\s\w]/g,"_")),n("#"+this._id+e+r+"_Template").remove(),w=this._createTemplateElement(this.model.columns[r]),u.addClass("e-templatecell").html("{{:~_"+this._id+"ColumnTemplating('"+w.id+"','"+r+"')}}")):this.model.columns[r].commands&&(f={},f["_"+this._id+"UnboundTemplate"]=this._unboundTemplateRendering,n.views.helpers(f),n("#"+this._id+this.model.columns[r].headerText.replace(/[^a-z0-9|s_]/gi,"")+r+"_UnboundTemplate").remove(),b=this._createUnboundElement(this.model.columns[r],r),u.addClass("e-unboundcell").addClass("e-"+this.model.columns[r].headerText.replace(/[^a-z0-9|s_]/gi,"")+r).html("{{:~_"+this._id+"UnboundTemplate('"+b.id+"')}}"),this.model.scrollSettings.frozenColumns>0&&u.addClass("e-frozenunbound"),this._isUnboundColumn=!0),this.model.columns[r].textAlign!=i&&u.css("text-align",this.model.columns[r].textAlign),this.model.columns[r].allowEditing==!1&&u.find(".e-field").attr("disabled",!0).addClass("e-disable"),this.model.columns[r].isPrimaryKey===!0&&u.find(".e-field").attr("disabled",!0).addClass("e-disable"),this.model.columns[r].isIdentity===!0&&(u.find(".e-field").addClass("e-identity"),this._identityKeys.push(n.trim(this.model.columns[r].field)),this._identityKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._identityKeys.sort()):n.uniqueSort(this._identityKeys.sort())),h=n(document.createElement("col")),this.model.columns[r].priority&&(u.addClass("e-table-priority-"+this.model.columns[r].priority),h.addClass("e-table-priority-"+this.model.columns[r].priority)),this.model.columns[r].visible===!1&&(h.css("display","none"),u.addClass("e-hide")),t.isNullOrUndefined(this.model.columns[r].cssClass)||u.addClass(this.model.columns[r].cssClass),!this.model.groupSettings.showGroupedColumn&&u.addClass("{{for ~groupedColumns}} {{if #data == '"+this.model.columns[r].field+"'}}e-hide{{/if}}{{/for}}")&&h.css("display","none"),c.append(h),r==this.model.scrollSettings.frozenColumns-1&&(a=s.find("tr").last(),c=s.find("colgroup"),n.templates(this._id+"_JSONFrozenEditingTemplate",o.html()),o=s));n.templates(this._id+"_JSONEditingTemplate",o.html())}},addDialogEditingTemplate:function(){var r,o,y,e,p;if(this.model.columns.length!=0){var h=t.buildTag("div"),s=t.buildTag("form.gridform","",{},{id:this._id+"EditForm"}),l=t.buildTag("table"),f,a,u,v,c;for(r=0;r<this.model.columns.length;r++)(this.model.columns[r].type!="checkbox"||this._isMapSelection)&&(this.model.editSettings.editMode=="dialog"?(v="tr",c="td"):v=c="div",f=t.buildTag(v),a=t.buildTag(c,"",{"text-align":"right"}).addClass("e-label"),u=t.buildTag(c,"",{"text-align":"left"}).addClass("e-rowcell"),f.is("div")&&f.addClass("e-gridFromDiv"),this.model.columns[r].priority&&this.model.editSettings.editMode=="inlineform"&&f.addClass("e-table-priority-"+this.model.columns[r].priority),f.append(a.get(0)).append(u.get(0)),this.model.columns[r].headerText==i&&(this.model.columns[r].headerText=this.model.columns[r].field),a.append("<label for='"+this.model.columns[r].field+"'>"+this.model.columns[r].headerText+"<\/label>"),t.isNullOrUndefined(this.model.columns[r].commands)&&(!this.model.columns[r].template||this.model.columns[r].template&&this.model.columns[r].allowEditing!=!1&&this.model.columns[r].field)?this._initCellEditType(r,u):this.model.columns[r].template?(e={},o=this.model.columns[r].headerText,e["_"+this._id+"ColumnTemplating"]=t.proxy(this._gridTemplate,null,this),n.views.helpers(e),t.isNullOrUndefined(o)||t.isNullOrUndefined(o.match(/[^0-9\s\w]/g))||(o=o.replace(/[^0-9\s\w]/g,"_")),n("#"+this._id+o+r+"_Template").remove(),y=this._createTemplateElement(this.model.columns[r]),u.addClass("e-templatecell").html("{{:~_"+this._id+"ColumnTemplating('"+y.id+"','"+r+"')}}")):this.model.columns[r].commands&&(e={},e["_"+this._id+"UnboundTemplate"]=this._unboundTemplateRendering,n.views.helpers(e),n("#"+this._id+this.model.columns[r].headerText.replace(/[^a-z0-9|s_]/gi,"")+r+"_UnboundTemplate").remove(),p=this._createUnboundElement(this.model.columns[r],r),u.addClass("e-unboundcell").addClass("e-"+this.model.columns[r].headerText.replace(/[^a-z0-9|s_]/gi,"")+r).html("{{:~_"+this._id+"UnboundTemplate('"+p.id+"')}}"),this.model.scrollSettings.frozenColumns>0&&u.addClass("e-frozenunbound"),this._isUnboundColumn=!0,f.addClass("e-hide")),this.model.columns[r].allowEditing==!1&&u.find(".e-field").attr("disabled",!0).addClass("e-disable"),this.model.columns[r].isIdentity===!0&&(u.find(".e-field").addClass("e-identity"),this._identityKeys.push(n.trim(this.model.columns[r].field)),this._identityKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._identityKeys.sort()):n.uniqueSort(this._identityKeys.sort())),this.model.columns[r].visible===!1&&f.addClass("e-hide"),t.isNullOrUndefined(this.model.columns[r].cssClass)||u.addClass(this.model.columns[r].cssClass),this.model.editSettings.editMode=="dialog"?(s.append(l),l.append(f)):s.append(f),s.appendTo(h),this.model.columns[r].isPrimaryKey===!0&&(u.find(".e-field").attr("disabled",!0).addClass("e-disable"),this._primaryKeys.push(n.trim(this.model.columns[r].field)),this._primaryKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._primaryKeys.sort()):n.uniqueSort(this._primaryKeys.sort())));this.model.editSettings.editMode=="dialog"&&s.append(l);h=this.renderDiaglogButton(s,h);n.templates(this._id+"_JSONDialogEditingTemplate",h.html())}},_editEventTrigger:function(n){if(n.requestType=="save"||n.requestType=="delete"){var r={data:n.data,rowData:n.data,previousData:n.previousData,action:n.action!==i?n.action:n.requestType};t.isNullOrUndefined(n.foreignKeyData)||(r.foreignKeyData=n.foreignKeyData);this._trigger("end"+r.action.charAt(0).toUpperCase()+r.action.slice(1),r)}},_compiledDropDownTemplate:function(i,r,u,f){var s={_gridFormatting:this.formatting},e,o;return n.views.helpers(s),e=t.buildTag("select"),o=t.buildTag("option",f!=null?"{{:~_gridFormatting('"+f+"',"+r+",'"+this.model.locale+"')}}":"{{:"+r+"}}",{},{value:"{{:"+i+"}}"}),e.append(o),n.templates(e.html())},_initCellEditType:function(r,u){var o=this.model.columns[r].field,a,it,c,d,g,ut,ft,f,h,nt,tt,et,w,l,y,s,e,k,ot,st,ht;this.model.columns[r].foreignKeyValue&&(this.model.columns[r].editType="dropdownedit");this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&(e=n.inArray(this.model.columns[r].field,this._dataSource().adaptor.value),e!=-1&&(a=this._dataSource().adaptor.value[e],it=this._dataSource().adaptor.key[e]));this.model.columns[r].editTemplate&&(this.model.columns[r].editType="edittemplate");t.isNullOrUndefined(this.model.columns[r].editType)&&(this.model.columns[r].editType=this.model.columns[r].type=="date"||this.model.columns[r].type=="datetime"?this.model.columns[r].type+"picker":"stringedit");this.model.isResponsive&&u.attr("data-cell",this._decode(this.model.columns[r].headerText));var v=(o||"").split("."),rt=v.length-1,p="";for(t.isNullOrUndefined(o)||(o=o.replace(/[^a-z0-9\s_]/gi,""));rt;)p+="(",rt--;switch(this.model.columns[r].editType){case"edittemplate":c=this.model.columns[r].editTemplate.create;typeof c=="string"?(d=t.util.getObject(c,window),g=n.isFunction(d)?n(d()).attr({id:this._id+o,name:this.model.columns[r].field,"class":"e-field"}):n(c).length==1&&n(c).get(0).tagName=="SCRIPT"?n(n(c).html()).attr({id:this._id+o,name:this.model.columns[r].field,"class":"e-field"}):n(c).attr({id:this._id+o,name:this.model.columns[r].field,"class":"e-field"})):g=n(c()).attr({id:this._id+o,name:this.model.columns[r].field,"class":"e-field"});u.append(g);break;case"stringedit":u.html(t.buildTag("input.e-field e-ejinputtext","",{},{value:"{{html:"+p+"#data['"+v.join("'] || {})['")+"']}}",id:this._id+o,name:this.model.columns[r].field,type:"text"}));break;case"booleanedit":u.html('{{if #data["'+v.join('"]["')+'"]}} <input class="e-field e-checkbox" type ="checkbox" id='+this._id+o+" name="+this.model.columns[r].field+' checked="checkbox"><\/input>{{else}} <input class="e-field e-checkbox" type ="checkbox" id='+this._id+o+" name="+this.model.columns[r].field+" > {{/if}}");this.model.editSettings.editMode=="normal"&&u.addClass("e-boolcell");break;case"numericedit":ut=t.buildTag("input.e-numerictextbox e-js e-field","",{},{type:"text",value:"{{:"+p+"#data['"+v.join("'] || {})['")+"']}}",id:this._id+o,name:this.model.columns[r].field});u.append(ut);break;case"datepicker":case"datetimepicker":ft=t.buildTag("input.e-"+this.model.columns[r].editType+" e-js e-field","",{},{type:"text",value:"{{:"+p+"#data['"+v.join("'] || {})['")+"']}}",id:this._id+o,name:this.model.columns[r].field});u.append(ft);break;case"dropdownedit":if(f=this.model.columns[r],h=[],t.isNullOrUndefined(f.dataSource)){if(t.isNullOrUndefined(f.dataSource)&&this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&f.field==a&&(et=this.model.dataSource.adaptor.foreignData[e],nt=this.model.dataSource.adaptor.key[e],tt=this.model.dataSource.adaptor.value[e],h=et),l=f.field,t.isNullOrUndefined(t.getObject(l,this._dropDownManager)))return;if(w=t.getObject(l,this._dropDownManager),y=0 in w&&typeof w[0]=="object",s=s=t.dataUtil.mergeSort(t.distinct(w,y?l:i,y?!1:i)),h.length==0)if(t.isNullOrUndefined(f.dataSource)&&this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&f.field==a)for(e=0;e<s.length;e++)h.push({text:s[e][0],value:s[e][1]});else for(e=0;e<s.length;e++)h.push({text:s[e],value:s[e]})}else if(t.isNullOrUndefined(f.foreignKeyField)&&f.dataSource instanceof t.DataManager){var l=f.field,b=t.getObject(l,this._dropDownManager),y=0 in b&&typeof b[0]=="object",s=s=t.dataUtil.mergeSort(t.distinct(b,y?l:i,y?!1:i));if(t.isNullOrUndefined(t.getObject("editParams.fields.text",f))||(h=b),h.length==0)for(e=0;e<s.length;e++)h.push({text:s[e],value:s[e]})}else h=!t.isNullOrUndefined(f.foreignKeyField)&&(f.field in this._dropDownManager||f.dataSource instanceof t.DataManager)?t.getObject(f.field+"."+f.foreignKeyField+"."+f.foreignKeyValue,this._dropDownManager):f.dataSource;ot=t.isNullOrUndefined(f.foreignKeyField)?f.field:f.foreignKeyField;f.foreignKeyValue?k=this._compiledDropDownTemplate(ot,f.foreignKeyValue,f.type,f.format):this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&f.field==a?k=this._compiledDropDownTemplate(nt?nt:"value",tt?tt:"text",f.type,f.format):(st=t.getObject("editParams.fields.value",f)||"value",ht=t.getObject("editParams.fields.text",f)||"text",k=this._compiledDropDownTemplate(st,ht,f.type,f.format));u.get(0).innerHTML=!t.isNullOrUndefined(f.editParams)&&this._dataSource()instanceof t.DataManager&&this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&f.field==a?"<input data-value='{{:"+it+"}}'/>":["<select>",k.render(h),"<\/select>"].join("");u.find("select,input").prop({id:this._id+o,name:f.field}).addClass("e-field e-dropdownlist")}},addBatchEditTemplate:function(){if(this.model.columns.length!=0){for(var u=t.buildTag("div","",{display:"none"},{id:this._id+"_BulkEditTemplate"}),r,i=0,f=this.model.columns.length;i<f;i++)(t.isNullOrUndefined(this.model.columns[i].commands)&&t.isNullOrUndefined(this.model.columns[i].template)||this.model.columns[i].template&&this.model.columns[i].allowEditing!=!1&&this.model.columns[i].field)&&(r=t.buildTag("div","",{},{id:this.model.columns[i].field.replace(/[^a-z0-9\s_]/gi,t.pvt.consts.complexPropertyMerge)+"_BulkEdit"}),this._initCellEditType(i,r),u.append(r)),this.model.columns[i].isPrimaryKey===!0&&(this._primaryKeys.push(n.trim(this.model.columns[i].field)),this._primaryKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._primaryKeys.sort()):n.uniqueSort(this._primaryKeys.sort())),this.model.columns[i].isIdentity===!0&&(r.find(".e-field").addClass("e-identity"),this._identityKeys.push(n.trim(this.model.columns[i].field)),this._identityKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._identityKeys.sort()):n.uniqueSort(this._identityKeys.sort()));u.children().length&&(this._bulkEditTemplate=u)}},addExternalDialogEditingTemplate:function(){var e,i,u,r,f;if(this.model.columns.length!=0){for(e=t.buildTag("td","",{"text-align":"left"}).addClass("e-rowcell"),i=0;i<this.model.columns.length;i++)(this.model.columns[i].type!="checkbox"||this._isMapSelection)&&(t.isNullOrUndefined(this.model.columns[i].commands)&&!t.isNullOrUndefined(this.model.columns[i].template)&&this.model.columns[i].allowEditing!=!1&&this.model.columns[i].field&&!t.isNullOrUndefined(this.model.columns[i].editTemplate)&&this._initCellEditType(i,e),this.model.columns[i].isPrimaryKey===!0&&(this._primaryKeys.push(n.trim(this.model.columns[i].field)),this._primaryKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._primaryKeys.sort()):n.uniqueSort(this._primaryKeys.sort())),this.model.columns[i].isIdentity===!0&&(this._identityKeys.push(n.trim(this.model.columns[i].field)),this._identityKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._identityKeys.sort()):n.uniqueSort(this._identityKeys.sort())));u=t.buildTag("div","",{display:"none"});r=t.buildTag("form.gridform","",{},{id:this._id+"EditForm"});this.model.editSettings.editMode=="dialogtemplate"&&this.model.editSettings.dialogEditorTemplateID!=null?f=this.model.editSettings.dialogEditorTemplateID:this.model.editSettings.editMode=="externalformtemplate"&&this.model.editSettings.externalFormTemplateID!=null?(f=this.model.editSettings.externalFormTemplateID,r.addClass("e-display")):(f=this.model.editSettings.inlineFormTemplateID,r.addClass("e-display"));r.html(n(f).html());u=this.renderDiaglogButton(r,u);n.templates(this._id+"_JSONdialogTemplateMode",u.html())}},_editdblClickHandler:function(i){var r=n(i.target);if(r.closest(".e-grid").attr("id")===this._id&&(r.hasClass("e-rowcell")||r.closest("td").hasClass("e-rowcell"))&&(!this.model.isEdit||this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal")){if(this._$currentTr=this.model.scrollSettings.frozenColumns>0||this.model.scrollSettings.frozenRows>0?this.getRowByIndex(r.closest("tr").index()):r.closest("tr"),!t.isNullOrUndefined(this._previousTr)){if(this._$currentTr.length>1&&this._$currentTr[0]!=this._previousTr[0]&&this._$currentTr[1]!=this._previousTr[1])return;if(this._$currentTr[0]!=this._previousTr[0])return}this.startEdit(this._$currentTr)}},_columnToSelect:function(){for(var r=[],u=[],f=this.model.columns,i=0;i<this.model.columns.length;i++)this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&n.inArray(this.model.columns[i].field,this._dataSource().adaptor.value)!=-1&&t.isNullOrUndefined(this.model.columns[i].editType)&&(this.model.columns[i].editType="dropdownedit"),this.model.columns[i].editType===t.Grid.EditingType.Dropdown&&t.isNullOrUndefined(this.model.columns[i].dataSource)&&r.push(this.model.columns[i].field),f[i].editType===t.Grid.EditingType.Dropdown&&t.isNullOrUndefined(f[i].foreignKeyField)&&f[i].dataSource instanceof t.DataManager&&u.push(this.model.columns[i].field);return r.length?{query:t.Query().select(r),fields:r,fieldsDrop:u}:{query:t.Query(),fields:[],fieldsDrop:u}},_renderExternalForm:function(){var f=t.buildTag("div","",{display:"none"},{id:this._id+"_externalEdit","class":"e-form-container"}),n=t.buildTag("div","","",{id:this._id+"_eFormHeader","class":"e-form-titlebar"}),e=t.buildTag("span","","",{"class":"e-form-title"}),i=t.buildTag("div","","",{id:this._id+"_eFormToggleBtn","class":"e-form-togglebtn"}),o=t.buildTag("span","","",{"class":"e-form-toggle-icon e-icon"});i.append(o);n.append(e).append(i);var r=t.buildTag("div","","",{id:this._id+"_eFormContent","class":"e-form-content"}),u=t.buildTag("div","","",{id:this._id+"_externalForm","class":"e-externalform"}),s=t.buildTag("div","","",{"class":"e-externalformedit"});return u.append(s),r.append(u),f.append(n).append(r)},_buttonClick:function(t){if(t.type=="close"){if(!this.model.isEdit)return;this.model.isEdit=!1;this.element.ejGrid("cancelEdit");this.refreshToolbar();return}if(t.keyCode!==i&&t.keyCode!=13&&t.keyCode!=0||this.model==null)return!0;this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?t.target.id=="EditDialog_"+this._id+"_Save"?this.element.ejGrid("endEdit"):t.target.id=="EditDialog_"+this._id+"_Cancel"&&(this.element.ejGrid("cancelEdit"),n("#"+this._id+"_dialogEdit").ejDialog("close")):this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate"?n(t.target).hasClass("e-form-toggle-icon")?(this.element.ejGrid("cancelEdit"),n("#"+this._id+"_externalEdit").css("display","none")):t.target.id=="EditExternalForm_"+this._id+"_Save"?this.element.ejGrid("endEdit").length!==i&&n("#"+this._id+"_externalEdit").css("display","none"):t.target.id=="EditExternalForm_"+this._id+"_Cancel"&&(this.element.ejGrid("cancelEdit"),n("#"+this._id+"_externalEdit").css("display","none")):this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?t.target.id=="InlineEditForm_"+this._id+"_Save"?this.element.ejGrid("endEdit"):t.target.id=="InlineEditForm_"+this._id+"_Cancel"&&this.element.ejGrid("cancelEdit"):this.element.ejGrid("cancelEdit")},_enableEditingEvents:function(){if(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding){if(this.model.editSettings.allowEditing&&this.model.editSettings.editMode!="batch"&&this.model.editSettings.allowEditOnDblClick?this._on(this.element,n.isFunction(n.fn.doubletap)&&this.model.enableTouch?"doubletap":"dblclick",".e-gridcontent",this._editdblClickHandler):(this._off(this.element,"dblclick",".e-gridcontent"),this._off(this.element,"doubletap",".e-gridcontent")),this._off(n("#"+this._id+"_dialogEdit"),"click ","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel"),this._off(n("#"+this._id+"_externalEdit"),"click ","#EditExternalForm_"+this._id+"_Save ,#EditExternalForm_"+this._id+"_Cancel"),n(this.element).off("click",".e-form-toggle-icon"),n(this.element).off("click ","#InlineEditForm_"+this._id+"_Save ,#InlineEditForm_"+this._id+"_Cancel"),this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate")this._on(n("#"+this._id+"_dialogEdit"),"click ","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel",this._buttonClick);else if(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate"){this._on(n("#"+this._id+"_externalEdit"),"click ","#EditExternalForm_"+this._id+"_Save ,#EditExternalForm_"+this._id+"_Cancel",this._buttonClick);n(this.element).on("click",".e-form-toggle-icon",n.proxy(this._buttonClick,this))}else if(this.model.editSettings.editMode=="batch")this._on(n(document),"touchstart mousedown",this._saveCellHandler),this._batchEnabled=!0;else if(this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate")n(this.element).on("click ","#InlineEditForm_"+this._id+"_Save ,#InlineEditForm_"+this._id+"_Cancel",n.proxy(this._buttonClick,this));this.model.editSettings.editMode!="batch"&&this._batchEnabled&&(this._off(n(document),"touchstart mousedown",this._saveCellHandler),this._batchEnabled=!1)}else this._off(n("#"+this._id+"_dialogEdit"),"click","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel"),n(this.element).off("click",".e-icon"),this._off(n("#"+this._id+"_externalEdit"),"click","#EditExternalForm_"+this._id+"_Save ,#EditExternalForm_"+this._id+"_Cancel"),n(this.element).off("click",".e-form-toggle-icon"),n(this.element).off("click","#InlineEditForm_"+this._id+"_Save ,#InlineEditForm_"+this._id+"_Cancel")},_multiRowDelete:function(){var i={},n,r,u;if(i.added=[],i.deleted=[],i.changed=[],i.deleted=this.getSelectedRecords(),n={},n.data=this.getSelectedRecords(),n.tr=this.getSelectedRows(),r=this._getForeignKeyData(n.data),t.isNullOrUndefined(r)||(n.foreignKeyData=r),n.requestType="delete",this._trigger("actionBegin",n))return!0;u=this;this._sendBulkReuqest(i,n)},deleteRow:function(r){var l,s,f,h,u,c,e,o;if(this.model.editSettings.allowDeleting&&(!this.model.isEdit||this.model.editSettings.editMode=="batch"||this.model.editSettings.showAddNewRow)){if(this.model.editSettings.showDeleteConfirmDialog&&!this._confirmDialog.is(":visible")){this._cDeleteData=r;this._confirmDialog.find(".e-content").html(this.localizedLabels.ConfirmDelete).end().ejDialog("open");return}if(n.isArray(r))this.selectRows(r),this._multiRowDelete();else if(this.model.editSettings.editMode=="batch")this._bulkDelete(this.getIndexByRow(r));else{if(this._primaryKeys.length==0&&!this.model.editSettings.allowEditing&&!this.model.editSettings.allowAdding)for(f=0;f<this.model.columns.length;f++)this.model.columns[f].isPrimaryKey===!0&&(this._primaryKeys.push(n.trim(this.model.columns[f].field)),this._primaryKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._primaryKeys.sort()):n.uniqueSort(this._primaryKeys.sort()));if(this._selectedRow()==-1&&t.isNullOrUndefined(r)){alert(this.localizedLabels.DeleteOperationAlert);return}for(t.isNullOrUndefined(r)&&(r=this.model.scrollSettings.enableVirtualization?this.getContentTable().find("tr[aria-selected='true']"):this.getRowByIndex(this._selectedRow())),this._primaryKeyValues=[],this._getPrimaryKeyValues(r),l=t.DataManager(this._currentJsonData),s=new t.Query,f=0;f<this._primaryKeys.length;f++)s=s.where(this._primaryKeys[f],t.FilterOperators.equal,this._primaryKeyValues[f]);if(h=l.executeLocal(s),u={},u.tr=r,u.data=u.rowData=h[0],c=this._getForeignKeyData(u.data),t.isNullOrUndefined(c)||(u.foreignKeyData=c),u.requestType=t.Grid.Actions.Delete,this._trigger("actionBegin",u))return!0;this._cDeleteData=h;!(t.isOnWebForms&&this.model.serverEvents&&this.model.serverEvents.indexOf("endDelete")!=-1)&&this._dataSource()instanceof t.DataManager&&!this._dataManager.dataSource.offline&&this._dataManager.dataSource.json!==i||this._dataSource().adaptor instanceof t.remoteSaveAdaptor?(e=this._dataManager.remove(this._primaryKeys[0],this._primaryKeys.length?t.getObject(this._primaryKeys[0],h[0]):null,this.model.query),o=this,n.isFunction(e.promise)?(e.done(function(){o._processBindings(u);o._primaryKeyValues=[];o._cDeleteData=null}),e.fail(function(n){u.error=n;o._cDeleteData=null;o._trigger("actionFailure",u)})):this._processBindings(u)):this._processBindings(u);e!=i&&n.isFunction(e.promise)||(this._primaryKeyValues=[],this._cDeleteData=null)}}},_htmlEncode:function(n){var i=n;return t.isNullOrUndefined(i)||(i=isNaN(i)?i.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'"):i),i},startEdit:function(i){if(this.model.editSettings.allowEditing&&(!this.model.editSettings.showAddNewRow||this.model.editSettings.editMode!="normal"||!this._excludeDetailRows().hasClass("e-editedrow"))&&!this.element.ejWaitingPopup("model.showOnInit")){if(this._selectedRow()==-1&&t.isNullOrUndefined(i)){alert(this.localizedLabels.EditOperationAlert);return}if(this.model.scrollSettings.enableVirtualization&&t.isNullOrUndefined(i)&&(i=this.getContentTable().find("tr[aria-selected='true']")),t.isNullOrUndefined(i)?(this._currentTrIndex=this._selectedRow(),this._$currentTr=this.getRowByIndex(this._currentTrIndex)):(this._currentTrIndex=this.getIndexByRow(i),this._$currentTr=i),this.model.scrollSettings.allowVirtualScrolling&&!this.model.scrollSettings.enableVirtualization&&(this._currentTrIndex=this._currentTrIndex%this.model.pageSettings.pageSize),!n(this._$currentTr).is(":visible"))return!1;this._primaryKeyValues=[];this._getPrimaryKeyValues(this._$currentTr);var u=this._editedData=this._currentJsonData[this._currentTrIndex],r={row:this._$currentTr,rowIndex:this._currentTrIndex,primaryKey:this._primaryKeys,primaryKeyValue:this._primaryKeyValues,rowData:u},f=this._trigger("beginEdit",r);if(f){this._primaryKeyValues=[];return}r.requestType=t.Grid.Actions.BeginEdit;this._processBindings(r)}},_getPrimaryKeyValues:function(i){var u,f,o=i.attr("name"),s,r,h,c=!1,e;for(this._lastVirtualPage=null,e=0;e<this._primaryKeys.length;e++)s=this.getColumnByField(this._primaryKeys[e]),u=this.getIndexByRow(i),f=this._currentJsonData,this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&(this.model.scrollSettings.enableVirtualization?(u=u%this._virtualRowCount,r=parseInt(o,32)):(u=u%this.model.pageSettings.pageSize,r=parseFloat(o)/this.model.pageSettings.pageSize+1,this._currentJsonData=this._virtualLoadedRecords[r],r!=this.model.pageSettings.totalPages||this._prevPageRendered||this._virtualLoadedRecords[r].length==this.model.pageSettings.pageSize||(f=n.extend(!0,[],this._previousPageRecords),h=n.extend(!0,[],this._virtualLoadedRecords[r]),t.merge(f,h),this._lastVirtualPage=this._currentJsonData=n.extend(!0,[],f),c=!0)),f=c?f:this._virtualLoadedRecords[r],this._vCurrentTrIndex=u,this._currentVIndex=r),this._primaryKeyValues.push(this._htmlEncode(t.getObject(s.field,f[u])))},_startAdd:function(){var f,r,u,e,i,h,o,c,s,l;if(this.model.editSettings.allowAdding)if(this._isAddNew=!0,this.model.editSettings.editMode=="batch")this._bulkAddRow();else{for(f={},r=this.model.columns,i=0;i<r.length;i++)t.isNullOrUndefined(this.model.parentDetails)||r[i].field!=this.model.parentDetails.parentKeyField||(r[i].defaultValue=this.model.parentDetails.parentKeyFieldValue),!t.isNullOrUndefined(r[i].field)&&r[i].field.indexOf(".")>0?t.createObject(r[i].field,r[i].defaultValue||"",f):f[r[i].field]=t.isNullOrUndefined(r[i].defaultValue)?r[i].type=="date"||r[i].type=="datetime"?null:"":r[i].defaultValue;if(u={},e={},u.data=u.rowData=f,this.model.editSettings.editMode.indexOf("template")!=-1)for(i=0;i<this.model.columns.length;i++)t.isNullOrUndefined(this.model.columns[i].field)||this.model.columns[i].field.indexOf(".")==-1||(h=this.model.columns[i].field.split("."),t.createObject(this.model.columns[i].field,u.data[this.model.columns[i].field],e),u.data[h[0]]=e,delete u.data[this.model.columns[i].field]);o=this._getForeignKeyData(u.data);t.isNullOrUndefined(o)||(u.foreignKeyData=o);u.requestType="add";this._enableCheckSelect&&this._isMapSelection||this.clearSelection();this.model.selectionSettings.selectionMode.indexOf("cell")!=-1&&this.clearCellSelection();this.model.scrollSettings.allowVirtualScrolling&&(this._currentVIndex=null,this._lastVirtualPage=null,this.model.scrollSettings.enableVirtualization?this._refreshVirtualView(1):this._virtualLoadedRecords[1]?this._currentPage(1):this.gotoPage(1),this.getScrollObject().scrollY(0));c=this._processBindings(u);c||(this.model.editSettings.showAddNewRow?this._selectedRow(-1):this._selectedRow(0));s=this.model.groupSettings.groupedColumns.length;s>1&&(l=this.getContentTable().find(".e-addedrow").find("table").find("colgroup").children(),n(l.slice(0,s-1)).css("width",this.getHeaderTable().find("colgroup").children()[0].style.width))}},endEdit:function(){var e,l,w,b,c,v,k,o,tt,y,p,ft,et,ot,h,it,st,rt,d,ht,ut,ct;if(this.model.isEdit){if(b=0,!this.editFormValidate())return!0;if(c={},this.model.editSettings.editMode=="batch")this.saveCell();else{for((this._isAddNew||this.model.editSettings.editMode=="externalformtemplate"||this.model.editSettings.editMode=="inlineformtemplate"||this.model.editSettings.editMode=="dialogtemplate")&&(this._isEditChangesApplied=!0),this.model.editSettings.showAddNewRow&&(w=this.getContentTable().find(".e-editedrow")),e=this.model.scrollSettings.frozenColumns>0?this.element.find(".gridform"):!t.isNullOrUndefined(w)&&w.length==1?w[0].lastChild.lastChild:document.getElementById(this._id+"EditForm"),l=n(e),v=this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?l.closest("tr"):l.closest("div"),v.find("td.e-rowcell").removeClass("e-validError"),e=this.model.scrollSettings.frozenColumns>0?e[0]:e,o=0;o<e.length;o++)if(!v.hasClass("e-addedrow")||!n(e[o]).hasClass("e-identity")){var f=e[o].name,s=n(e[o]),u=this.getColumnByField(f);if(!s.hasClass("e-dropdownlist e-input")||s.attr("id").indexOf("_input")==-1||!t.isNullOrUndefined(l[1])){if(f!=i&&f!=""&&c[f]==null){u=this.getColumnByField(f);var r=e[o].value,g=e[o].type,nt=n(e[o]).is(":checked"),k=u?u.originalType:null,a;if(n(e[o]).attr("type")=="hidden"&&t.isNullOrUndefined(s.attr("value")))continue;if(t.isNullOrUndefined(u)||u.editType!="edittemplate")n(e[o]).hasClass("e-datepicker e-js")?(r=s.ejDatePicker("model.value"),this._isEditChangesApplied||(a=!t.isNullOrUndefined(u)&&!t.isNullOrUndefined(u.format)?u.format:"{0:MM/dd/yyyy}",this.formatting(a,r,this.model.locale)!=this.formatting(a,this._editedData[f],this.model.locale)&&(this._isEditChangesApplied=!0))):n(e[o]).hasClass("e-datetimepicker e-js")?(r=s.ejDateTimePicker("model.value"),this._isEditChangesApplied||(a=!t.isNullOrUndefined(u)&&!t.isNullOrUndefined(u.format)?u.format:"{0:MM/dd/yyyy hh:mm:ss}",this.formatting(a,r,this.model.locale)!=this.formatting(a,this._editedData[f],this.model.locale)&&(this._isEditChangesApplied=!0))):s.is(".e-numerictextbox.e-js")?(r=s.ejNumericTextbox("getValue"),t.isNullOrUndefined(u)||u.type!="string"||t.isNullOrUndefined(r)||(r=r.toString()),this._isEditChangesApplied||this._editedData[f]==r||(this._isEditChangesApplied=!0)):(s.data("ejDropDownList")||s.is(".e-dropdownlist"))&&(s.is(":hidden")&&s.is("input")&&t.isNullOrUndefined(s.data("ejDropDownList"))&&(s=s.siblings(".e-dropdownlist")),r=s.ejDropDownList("getSelectedValue"),t.isNullOrUndefined(u)||t.isNullOrUndefined(u.format)||u.type!="date"&&u.type!="datetime"||(r=r.length>0?new Date(r):r),this._isEditChangesApplied||this._editedData[f]==r||(this._isEditChangesApplied=!0));else if(this._isEditChangesApplied=!0,tt=n(e[o]).attr("type")=="hidden",n(e[o]).is("#"+this._id+f)||tt||n(e[o]).attr("name")==f)y=u.editTemplate.read,s=n(e[o]),s=tt?n(e[o]).siblings("#"+this._id+f).length?n(e[o]).siblings("#"+this._id+f):s:s,typeof y=="string"&&(y=t.util.getObject(y,window)),r=y(s);else continue;k&&(r=k=="number"?+r:k=="boolean"?r===this.localizedLabels.True?!0:!1:k==="date"?new Date(r):r);u==null?r=!isNaN(parseFloat(r))&&isFinite(r)?parseFloat(r):r:u.type=="number"&&!t.isNullOrUndefined(r)&&r.length&&(r=t.parseFloat(r,this.model.locale),this._isEditChangesApplied||this._editedData[f]==r||(this._isEditChangesApplied=!0));typeof r!="string"||r.length||(r=null);this._isEditChangesApplied||t.isNullOrUndefined(u)||u.type!="string"||this._editedData[f]==r||(this._isEditChangesApplied=!0);this._isEditChangesApplied||t.isNullOrUndefined(u)||u.type!="date"||u.editType!="stringedit"||u.format!=null&&this.formatting(u.format,this._editedData[f],this.model.locale)!=r&&(this._isEditChangesApplied=!0);(g!="checkbox"&&!t.isNullOrUndefined(r)&&r!==""||nt)&&b++;p=g=="checkbox"&&(t.isNullOrUndefined(u)||u.type=="boolean"||u.type=="checkbox")?nt:r;this._isEditChangesApplied||t.isNullOrUndefined(u)||u.type!="boolean"&&u.type!="checkbox"||(ft=g=="checkbox"?nt:JSON.parse(r),this._editedData[f]!=ft&&(this._isEditChangesApplied=!0));this._isEditChangesApplied||typeof p!="string"||typeof this._editedData[f]!="string"||this._editedData[f]==p||(this._isEditChangesApplied=!0);this._isEditChangesApplied||t.isNullOrUndefined(u)||u.type!="object"||(et=typeof r=="object"?JSON.stringify(r):r,ot=typeof this._editedData[f]=="object"?JSON.stringify(this._editedData[f]):this._editedData[f],et!=ot&&(this._isEditChangesApplied=!0));f.indexOf(".")!=-1?t.createObject(f,p,c):c[f]=p}o==e.length-1&&l.length>1&&l.index(e)==0&&(e=l[1],o=-1)}}if(h={data:c,rowData:c},it=this._getForeignKeyData(h.data),t.isNullOrUndefined(it)||(h.foreignKeyData=it),h.requestType=t.Grid.Actions.Save,h.selectedRow=this._selectedRow(),h.previousData=jQuery.extend({},this.model.currentViewData[h.selectedRow]),this._trigger("actionBegin",h))return!0;if(v.hasClass("e-editedrow")?(this._cModifiedData=c,h.action="edit"):v.hasClass("e-addedrow")&&(b&&(this._cAddedRecord=c),h.action="add"),h.action=="add"&&this.editFormValidate()&&(t.isNullOrUndefined(this.model.queryString)||(st=this.model.foreignKeyField||this.model.queryString,h.data[st]=this.model.parentDetails.parentRowData[this.model.queryString]),!b))return rt=this.model.scrollSettings.frozenColumns>0?this.element.find(".gridform"):n("#"+this._id+"EditForm"),d=t.buildTag("div"),rt.addClass("field-validation-empty"),ht=rt.find("input:visible").not(".e-identity").first(),this._renderValidator(d,ht),d.width("auto"),ut=t.buildTag("div.e-field-validation-error",this.localizedLabels.EmptyRowValidationMessage),ct=n(d).find(".e-errortail"),ut.insertAfter(ct),ut.css("display","block"),!1;(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&n("#"+this._id+"_externalEdit").css("display","none");this._isAddNew||this._isEditChangesApplied?(this._isEditChangesApplied=!1,this._updateAction(h)):this.cancelEdit()}}},_updateAction:function(r){var f,u;this._dataSource()instanceof t.DataManager&&!this._dataManager.dataSource.offline&&this._dataManager.dataSource.json!==i||this._dataSource().adaptor instanceof t.remoteSaveAdaptor||this._dataSource().adaptor instanceof t.ForeignKeyAdaptor?this.model.editSettings.editMode=="batch"?(this.batchChanges.added.push(r.data),this.batchSave()):(t.isNullOrUndefined(this._cModifiedData)||t.isOnWebForms&&this.model.serverEvents&&this.model.serverEvents.indexOf("endEdit")!=-1?t.isOnWebForms&&this.model.serverEvents&&this.model.serverEvents.indexOf("endAdd")!=-1||(f=this._dataManager.insert(r.data,this.model.query)):f=this._dataManager.update(this._primaryKeys[0],r.data,this.model.query),u=this,this.element.ejWaitingPopup("show"),f&&n.isFunction(f.promise)?(f.done(function(i){u.model.isEdit=!1;!t.isNullOrUndefined(i)&&n.isPlainObject(i.record)&&(n.extend(r.data,i.record),r.action=="add"&&(u._cAddedRecord=r.data),r.action=="edit"&&(u._cModifiedData=r.data));u._processBindings(r);u._isRemoteSaveAdaptor&&(u.element.ejWaitingPopup("hide"),t.isNullOrUndefined(u._unboundRow)||r.selectedRow==u._unboundRow||r.requestType!="save"||(u._unboundRow.find(".e-editbutton").trigger("click"),u._unboundRow=null));u._cModifiedData=null;u._cAddedRecord=null;u._primaryKeyValues=[]}),f.fail(function(t){r.error=t&&t.error?t.error:t;u._cModifiedData=null;u._cAddedRecord=null;u.element.ejWaitingPopup("hide");(u.model.editSettings.editMode=="externalform"||u.model.editSettings.editMode=="externalformtemplate")&&n("#"+u._id+"_externalEdit").css("display","block");u._trigger("actionFailure",r)})):(u.model.isEdit=!1,u._processBindings(r))):this._processBindings(r);f!=i&&n.isFunction(f.promise)||(this._cModifiedData=null,this._cAddedRecord=null,this._primaryKeyValues=[])},cancelEdit:function(){var i={};i.requestType=t.Grid.Actions.Cancel;this._cModifiedData=null;this._processBindings(i);this._primaryKeyValues=[];this._currentData=null;(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&n("#"+this._id+"_externalEdit").css("display","none")},refreshToolbar:function(){var r=n("#"+this._id+"_toolbarItems"),t=r.find("li"),u,i;if(r.ejToolbar("enableItem",t),u=this.getContentTable().find(".e-editedrow"),this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal"&&u.length==0)this._disabledToolItems.push(t.filter("[id="+this._id+"_add]"));else for(i=0;i<t.length;i++)switch(t[i].id){case this._id+"_add":case this._id+"_edit":case this._id+"_delete":case this._id+"_responsiveFilter":case this._id+"_responsiveSorting":case this._id+"_search":this.model.isEdit?this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal"&&u.length==0||(n(t[i]).hasClass("e-hover")&&n(t[i]).removeClass("e-hover"),this._disabledToolItems.push(t[i])):this.model.enableToolbarItems||this.model.editSettings.allowAdding||t[i].id!=this._id+"_add"?this.model.enableToolbarItems||this.model.editSettings.allowEditing||t[i].id!=this._id+"_edit"?this.model.enableToolbarItems||this.model.editSettings.allowDeleting||t[i].id!=this._id+"_delete"||this._disabledToolItems.push(t[i]):this._disabledToolItems.push(t[i]):this._disabledToolItems.push(t[i]);break;case this._id+"_update":case this._id+"_cancel":this.model.isEdit||this.getContentTable().find(".e-updatedtd.e-icon.e-gupdatenotify").length!=0||this._isBatchDeleteApplied||(n(t[i]).hasClass("e-hover")&&n(t[i]).removeClass("e-hover"),this._disabledToolItems.push(t[i]))}r.ejToolbar("disableItem",this._disabledToolItems);r.ejToolbar("model.enableRTL",this.model.enableRTL);this._disabledToolItems=n()},_getHiddenCount:function(n){for(var i=0,t=0;t<n.length;t++)n.eq(t).hasClass("e-hide")&&i++;return i},_refreshTemplateCell:function(t,i){for(var f,u=t.find(".e-templatecell"),r=0;r<u.length;r++)f={cell:u[r],data:i,column:this.model.columns[n(u[r]).index()],rowIndex:t.index()},this._trigger("templateRefresh",f)},_edit:function(i){var tt=this.model.scrollSettings.enableVirtualization?t.DataManager(this._virtualLoadedRecords[this._currentVIndex]):t.DataManager(this._currentJsonData),e,y=new t.Query,o,a,l,nt,h,s,c,d,f;for(this.model.allowFiltering&&(this._previousFilterCount=this._filteredRecordsCount),l=0;l<this._primaryKeys.length;l++)y=y.where(this._primaryKeys[l],t.FilterOperators.equal,this._primaryKeyValues[l]);this._currentData=tt.executeLocal(y);var r=document.createElement("div"),p=t.isNullOrUndefined(this.model.editSettings.titleColumn)?this._primaryKeys[0]:this.model.editSettings.titleColumn,u=n(r),e;if(this.model.editSettings.editMode=="normal"){r.innerHTML=["<table>",n.render[this._id+"_JSONEditingTemplate"](this._currentData,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join("");var w=u.find("tr").first(),h=0,g=this.model.columns.length,b=i.row.first(),k,v;this.model.scrollSettings.frozenColumns>0&&(u.prepend(["<table>",n.render[this._id+"_JSONFrozenEditingTemplate"](this._currentData,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join("")),w.splice(0,0,u.find("table").first().find("tr").first().get(0)),k=i.row.last(),v=w.last());e=u.find("tr").first();u.find("td").not(".e-rowcell").addClass("e-editcell e-normaledit");this._setEditDropdownValue(u);this.model.groupSettings.groupedColumns.length>=2&&(nt=i.row.find("td.e-indentcell"),u.find("tr").first().prepend(nt));(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&(h++,u.find(".e-editcell").find("tr").prepend(i.row.find("[class*=e-detailrow]").eq(0).removeClass("e-selectionbackground e-active")),this.model.gridLines!="both"&&u.find(".e-editcell .e-rowcell:first").addClass("e-detailrowvisible"));this.model.scrollSettings.frozenColumns>0&&(u.find(".e-editcell").get(1).colSpan=this.model.columns.length-this.model.scrollSettings.frozenColumns-i.row.last().find(".e-hide").length+h,g=this.model.scrollSettings.frozenColumns,k.hasClass("e-alt_row")&&v.addClass("e-alt_row"));u.find(".e-editcell").get(0).colSpan=g-b.find("td").not(":visible").length+h;b.hasClass("e-alt_row")&&e.addClass("e-alt_row");b.empty().replaceWith(e.addClass("e-editedrow"));i.row=e;e.is(":last-child")||e.find("td.e-rowcell").addClass("e-validError");this.model.scrollSettings.frozenColumns>0&&(k.empty().replaceWith(v.addClass("e-editedrow")),i.row=v);this._refreshUnboundTemplate(w.find(".gridform"));this._gridRows=this.model.scrollSettings.frozenColumns==0?this.model.detailsTemplate!=null||this.model.childGrid!=null?this._excludeDetailRows():this.getContentTable().first().find(".e-rowcell").closest("tr.e-row, tr.e-alt_row, tr.e-editedrow").toArray():n(this.getContentTable().get(0).rows).toArray();this.model.scrollSettings.frozenColumns>0&&(this.getScrollObject().scrollY(this.getScrollObject().model.scrollTop,!0),this._gridRows=[this._gridRows,n(this.getContentTable().get(1).rows).toArray()])}else this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?(h=0,this.model.editSettings.editMode=="inlineformtemplate"&&(o=this.model.editSettings.inlineFormTemplateID,a=!t.isNullOrUndefined(this.model.ngTemplateId)&&(o.startsWith("#")||o.startsWith(".")||typeof o=="object")?this.model.ngTemplateId+"gridedittemplate":null),r.innerHTML=this.model.editSettings.editMode=="inlineform"?n.render[this._id+"_JSONDialogEditingTemplate"](this._currentData):this._renderEjTemplate(this.model.editSettings.inlineFormTemplateID,this._currentData[0],i.rowIndex,null,a),this.model.editSettings.editMode=="inlineformtemplate"&&(r.innerHTML=this._appendForm(r.innerHTML)),this._setEditDropdownValue(u),s=t.buildTag("tr"),c=t.buildTag("td"),s.addClass("e-editedrow"),c.addClass("e-inlineformedit"),r=n(r).clone(!0).children(),c.html(r),s.append(c),s.is(":last-child")||s.find(".e-rowcell").addClass("e-validError"),this.model.scrollSettings.frozenColumns>0?(d=s.clone(),d.find("td").empty().prop("colspan",this.model.scrollSettings.frozenColumns),i.row.eq(1).after(s).end().eq(0).after(d),this._gridRows=[this._gridRows,this.getContentTable().last().find("tr").toArray()]):i.row.after(s),this.model.detailsTemplate!=null||this.model.childGrid!=null?(this._gridRows=this._excludeDetailRows(),h++):this._gridRows=this.getContentTable().first().find(".e-rowcell,.e-inlineformedit").closest("tr").toArray(),this.model.scrollSettings.frozenColumns>0?c.prop("colspan",this.model.columns.length-this.model.scrollSettings.frozenColumns-s.find("form").children().not(":visible").length+h):c.prop("colspan",this.model.columns.length-this._hiddenColumns.length+h),this.model.scrollSettings.frozenColumns>0&&(this._gridRows=[this._gridRows,this.getContentTable().last().find("tr").toArray()]),n("#"+this._id+"_inlineFormTitle").text(this.localizedLabels.EditFormTitle+this._currentData[0][p]),i.row.find("input").attr("disabled","disabled").addClass("e-disable")):(u.addClass("e-editedrow"),(this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalformtemplate")&&(o=this.model.editSettings.editMode=="dialogtemplate"?this.model.editSettings.dialogEditorTemplateID:this.model.editSettings.externalFormTemplateID,a=!t.isNullOrUndefined(this.model.ngTemplateId)&&(o.startsWith("#")||o.startsWith(".")||typeof o=="object")?this.model.ngTemplateId+"gridedittemplate":null),r.innerHTML=this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="externalform"?n.render[this._id+"_JSONDialogEditingTemplate"](this._currentData):this._renderEjTemplate(o,this._currentData[0],i.rowIndex,null,a),(this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalformtemplate")&&(r.innerHTML=this._appendForm(r.innerHTML)),this._setEditDropdownValue(u),this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?(n("#"+this._id+"_dialogEdit").html(n(r)),f={},f.cssClass=this.model.cssClass,f.enableRTL=this.model.enableRTL,f.width="auto",f.enableResize=this.phoneMode,f.close=n.proxy(this._buttonClick,this),f.content="#"+this._id,f.enableModal=!0,f.allowKeyboardNavigation=!1,f.title=this.localizedLabels.EditFormTitle+this._currentData[0][p],n("#"+this._id+"_dialogEdit").ejDialog(f),n("#"+this._id+"_dialogEdit").ejDialog("open")):(n("#"+this._id+"_externalEdit").css("display","block").css("z-index",this._maxZindex()+1),n("#"+this._id+"_externalForm").find(".e-externalformedit").html(n(r)),n("#"+this._id+"_eFormHeader").find(".e-form-title").text(this.localizedLabels.EditFormTitle+this._currentData[0][p]),this._externalFormPosition(),i.row.find("input").attr("disabled","disabled").addClass("e-disable")));this.model.editSettings.editMode!="normal"&&(e=n(r));t.isNullOrUndefined(this.model.templateRefresh)||e.find(".e-templatecell").length==0||this._refreshTemplateCell(e,this.model.currentViewData[e.index()])},_appendForm:function(n){var r=t.buildTag("form.gridform","",{},{id:this._id+"EditForm"}),i;return r.addClass("e-display"),i=t.buildTag("div","",{display:"none"}),r.html(n),i=this.renderDiaglogButton(r,i),i.html()},_setEditDropdownValue:function(i){for(var s,h,e,l,f,u=i.find("select.e-field"),o,c=i.find("input.e-field.e-dropdownlist"),r=0;r<u.length;r++){if(s={},h="",u[r].name.indexOf(".")!=-1){for(f=1;f<u[r].name.split(".").length;f++)h=h.concat("(");s[this._id+"ddlTemp"]="{{:"+h+"#data['"+u[r].name.split(".").join("'] || {})['")+"']}}"}else s[this._id+"ddlTemp"]="{{:"+u[r].name.replace(/[^a-z0-9\s_]/gi,"")+"}}";n.templates(s);o=n.render[this._id+"ddlTemp"](this._currentData);e=i.find("select:eq("+r+') option[value="'+o+'"]');u.eq(r).data("ej-value",o);l=this.getColumnByField(u[r].name);this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&this._dataSource().adaptor.value.indexOf(l.field)!=-1&&(e=i.find("select:eq("+r+') option:contains("'+o+'")'),u.eq(r).val(e[0].value),u.eq(r).data("ej-value",e[0].value));e.attr("selected","selected")}for(f=0;f<c.length;f++)c.eq(f).data("ej-value",t.getObject(c.eq(f).attr("name"),this._currentData[0]))},_add:function(i){var u=document.createElement("div"),e,h,l,v,a,y,p,c,w,b,k,f,r,s;if(this._isLocalData&&this.model.groupSettings.groupedColumns.length==0&&this.model.scrollSettings.frozenColumns==0&&this.model.scrollSettings.frozenRows==0&&((this._dataSource()instanceof t.DataManager)?this._dataSource().dataSource.json.splice(0,1):this._dataSource().splice(0,1)),this._previousFilterCount=this._filteredRecordsCount,this.model.editSettings.editMode=="normal"){for(a=n(u),y=this.model.columns.length,u.innerHTML=["<table>",n.render[this._id+"_JSONEditingTemplate"](i.data,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join(""),f=n(u).find("select.e-field"),r=0;r<f.length;r++)f.eq(r).val(i.data[f[r].name]),f.eq(r).data("ej-value",i.data[f[r].name]);if(this.model.scrollSettings.frozenColumns>0&&(p=a.find("table").first().find("tr").first(),a.prepend(["<table>",n.render[this._id+"_JSONFrozenEditingTemplate"](i.data,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join("")),n(p).find("td").first().addClass("e-editcell")),v=a.find("tr").first(),c=n(u).find(".e-editcell").get(0),n(u).find("td").first().addClass("e-editcell"),this.model.allowPaging&&this.model.pageSettings.pageSize<=this._currentJsonData.length&&this.model.groupSettings.groupedColumns.length==0&&!this.model.editSettings.showAddNewRow&&this.getContentTable().get(0).lastChild.removeChild(this.getContentTable().get(0).lastChild.lastChild),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&n(this.getContentTable().get(0).lastChild.lastChild).children(".e-detailrowexpand").length&&this.getContentTable().get(0).lastChild.removeChild(this.getContentTable().get(0).lastChild.lastChild),(this.model.currentViewData.length==0||this.getContentTable().find("td.e-rowcell").length==0)&&this.model.scrollSettings.frozenColumns==0?(this.getContentTable().find("tr").first().replaceWith(n(u).find("tr").first().addClass("e-addedrow e-normaledit")),this.getContentTable().find("tr").length==0&&this.getContentTable().append(n(u).find("tr").first().addClass("e-addedrow e-normaledit"))):(this.model.scrollSettings.frozenColumns>0&&this._renderByFrozenDesign(),w=this.getContentTable().first().find("tbody").first(),this.model.editSettings.rowPosition=="top"?w.prepend(v.addClass("e-addedrow e-normaledit")):this.model.editSettings.rowPosition=="bottom"&&w.append(v.addClass("e-addedrow e-normaledit")),this.model.scrollSettings.frozenColumns>0&&this.getContentTable().last().find("tbody").first().prepend(p.addClass("e-addedrow e-normaledit"))),e=this.getContentTable().find("tr.e-addedrow"),this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&e.attr("name",0),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&e.find("tr").first().prepend(t.buildTag("td.e-detailrowcollapse")),this.model.groupSettings.groupedColumns.length){for(r=0;r<this.model.groupSettings.groupedColumns.length;r++)r==0?e.prepend(t.buildTag("td.e-indentcell")):e.find("tr").prepend(t.buildTag("td.e-indentcell"));this.model.groupSettings.groupedColumns.length>0&&(this.model.detailsTemplate!=null||this.model.childGrid!=null)?e.find("td.e-editcell").prop("colspan",this.model.columns.length+this.model.groupSettings.groupedColumns.length-this._hiddenColumns.length):this.model.groupSettings.groupedColumns.length>=2?e.find("td.e-editcell").prop("colspan",this.model.columns.length+(this.model.groupSettings.groupedColumns.length-1)-this._hiddenColumns.length):e.find("td.e-editcell").prop("colspan",this.model.columns.length-this._hiddenColumns.length)}else this.model.detailsTemplate!=null||this.model.childGrid!=null?e.find(".e-editcell").prop("colspan",this.model.columns.length-this._hiddenColumns.length+1):(this.model.scrollSettings.frozenColumns>0&&(e.find(".e-editcell").last().prop("colspan",this.model.columns.length-this.model.scrollSettings.frozenColumns-this._hiddenColumns.length),y=this.model.scrollSettings.frozenColumns),e.find(".e-editcell").first().prop("colspan",y-this._hiddenColumns.length));e.is(":last-child")||e.find("td.e-rowcell").addClass("e-validError");t.isIOSWebView()||this.getBrowserDetails().browser!="msie"||this.model.editSettings.rowPosition!="bottom"||this._colgroupRefresh();this._refreshUnboundTemplate(e.find(".gridform"));this._gridRows=this.getContentTable().first().find(".e-rowcell").closest("tr.e-row, tr.e-alt_row").toArray();this.model.scrollSettings.frozenColumns>0&&(this._gridRows=[this._gridRows,this.getContentTable().last().find(".e-rowcell").closest("tr.e-row, tr.e-alt_row").toArray()])}else if(this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"){this.model.editSettings.editMode=="inlineformtemplate"&&(h=this.model.editSettings.inlineFormTemplateID,l=!t.isNullOrUndefined(this.model.ngTemplateId)&&(h.startsWith("#")||h.startsWith(".")||typeof h=="object")?this.model.ngTemplateId+"gridedittemplate":null);u.innerHTML=this.model.editSettings.editMode=="inlineform"?n.render[this._id+"_JSONDialogEditingTemplate"](i.data):this._renderEjTemplate(this.model.editSettings.inlineFormTemplateID,i.data,0,null,l);this.model.editSettings.editMode=="inlineformtemplate"&&(u.innerHTML=this._appendForm(u.innerHTML));var d=0,o=t.buildTag("tr"),c=t.buildTag("td");for(o.addClass("e-addedrow"),c.addClass("e-inlineformedit e-editcell"),u=n(u).clone(!0).children(),f=n(u).find("select.e-field"),r=0;r<f.length;r++)f.eq(r).val(i.data[f[r].name]),f.eq(r).data("ej-value",i.data[f[r].name]);if(c.html(u),o.append(c),o.is(":last-child")||o.find(".e-rowcell").addClass("e-validError"),this.model.groupSettings.groupedColumns.length)for(r=0;r<this.model.groupSettings.groupedColumns.length;r++)o.prepend(t.buildTag("td.e-indentcell"));else o.find("td.e-editcell").prop("colspan",this.model.columns.length-this._hiddenColumns.length);this.model.scrollSettings.frozenColumns>0?(b=o.clone(),k=c.find(".gridform").children(),b.find("td").empty().prop("colSpan",this.model.scrollSettings.frozenColumns-this._getHiddenCount(k.slice(0,this.model.scrollSettings.frozenColumns))),c.prop("colSpan",this.model.columns.length-this.model.scrollSettings.frozenColumns-this._getHiddenCount(k.slice(this.model.scrollSettings.frozenColumns))),(this.model.currentViewData.length==0||this.getContentTable().find("td.e-rowcell").length==0)&&this._renderByFrozenDesign(),this.getContentTable().first().find("tbody").first().prepend(b),this.getContentTable().last().find("tbody").first().prepend(o)):((this.model.detailsTemplate!=null||this.model.childGrid!=null)&&d++,c.prop("colspan",this.model.columns.length-this._hiddenColumns.length+d),this.model.currentViewData.length==0||this.getContentTable().find("td.e-rowcell").length==0?this.getContentTable().find("tr").first().replaceWith(n(o)):this.model.allowPaging&&this.model.pageSettings.pageSize<=this.model.currentViewData.length&&this.model.groupSettings.groupedColumns.length==0&&this.getContentTable().get(0).lastChild.removeChild(this.getContentTable().get(0).lastChild.lastChild),this.model.editSettings.rowPosition=="top"?this.getContentTable().first().find("tbody").first().prepend(o):this.model.editSettings.rowPosition=="bottom"&&this.getContentTable().first().find("tbody").first().append(o));(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&n(this.getContentTable().get(0).lastChild.lastChild).children(".e-detailrowexpand").length&&this.getContentTable().get(0).lastChild.removeChild(this.getContentTable().get(0).lastChild.lastChild);n("#"+this._id+"_inlineFormTitle").text(this.localizedLabels.AddFormTitle);this._refreshUnboundTemplate(n("#"+this._id+"EditForm"));this._gridRows=this.getContentTable().first().find(".e-rowcell,.e-inlineformedit").closest("tr.e-row, tr.e-alt_row").toArray();this.model.scrollSettings.frozenColumns>0&&(this._gridRows=[this._gridRows,this.getContentTable().last().find(".e-rowcell").closest("tr.e-row, tr.e-alt_row").toArray()])}else{for(n(u).addClass("e-addedrow"),(this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalformtemplate")&&(h=this.model.editSettings.editMode=="dialogtemplate"?this.model.editSettings.dialogEditorTemplateID:this.model.editSettings.externalFormTemplateID,l=!t.isNullOrUndefined(this.model.ngTemplateId)&&(h.startsWith("#")||h.startsWith(".")||typeof h=="object")?this.model.ngTemplateId+"gridedittemplate":null),u.innerHTML=this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="externalform"?n.render[this._id+"_JSONDialogEditingTemplate"](i.data):this._renderEjTemplate(h,i.data,0,null,l),(this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalformtemplate")&&(u.innerHTML=this._appendForm(u.innerHTML)),f=n(u).find("select.e-field"),r=0;r<f.length;r++)f.eq(r).val(i.data[f[r].name]),f.eq(r).data("ej-value",i.data[f[r].name]);this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?(n("#"+this._id+"_dialogEdit").html(n(u)),s={},s.cssClass=this.model.cssClass,s.width="auto",s.enableResize=this.phoneMode,s.content="#"+this._id,s.enableModal=!0,s.close=n.proxy(this._buttonClick,this),s.enableRTL=this.model.enableRTL,s.allowKeyboardNavigation=!1,s.title=this.localizedLabels.AddFormTitle,n("#"+this._id+"_dialogEdit").ejDialog(s),n("#"+this._id+"_dialogEdit").ejDialog("open")):(n("#"+this._id+"_externalEdit").css("display","block").css("z-index",this._maxZindex()+1),n("#"+this._id+"_externalForm").find(".e-externalformedit").html(n(u)),n("#"+this._id+"_eFormHeader").find(".e-form-title").text(this.localizedLabels.AddFormTitle),this._externalFormPosition())}this.model.editSettings.editMode!="normal"&&(e=n(u));t.isNullOrUndefined(this.model.templateRefresh)||e.find(".e-templatecell").length==0||this._refreshTemplateCell(e,i.data);this.model.allowPaging&&(this.model.filterSettings.filteredColumns.length?this.getPager().ejPager({totalRecordsCount:this._searchCount==null?this._filteredRecordsCount:this._searchCount,currentPage:this._currentPage()}):this.getPager().ejPager({totalRecordsCount:this._searchCount==null?this._gridRecordsCount:this._searchCount,currentPage:this._currentPage()}),this._refreshGridPager())},editFormValidate:function(){var t,i,r;return n.isFunction(n.validator)?this.model.scrollSettings.frozenColumns>0?(t=this.element.find(".gridform"),t.length>1?(i=t.eq(0).validate().form(),r=t.eq(1).validate().form(),i&&r?!0:!1):t.validate().form()):this.model.editSettings.showAddNewRow?n(this.getRows()).hasClass("e-editedrow")?this.element.find(".e-editedrow .gridform").validate().form():this.element.find(".e-addedrow .gridform").validate().form():n("#"+this._id+"EditForm").validate().form():!0},_refreshAltRow:function(){for(var t,r=this._excludeDetailRows(),i=0;i<r.length;i++)t=n(r[i]),t.hasClass("e-alt_row")&&t.removeClass("e-alt_row"),i%2!=0?t.addClass("e-alt_row"):t.addClass("e-row")},_editCompleteAction:function(i){var o=this.element.find(".gridform"),s,h,u,r,f,e;if(this.model.isEdit=!0,s=this.getContentTable().children("colgroup").find("col"),h=this.element.width(),this.setWidthToColumns(),t.Grid.Actions.Add==i.requestType){for(u=o.find(".e-field:disabled"),r=0;r<u.length;r++)f=n(u[r]).attr("name"),n(u[r]).hasClass("e-identity")||(n.inArray(f,this._disabledEditableColumns)==-1||n.inArray(f,this._primaryKeys)!==-1)&&n(u[r]).prop("disabled",!1).removeClass("e-disable");for(e=0;e<this.model.groupSettings.groupedColumns.length-1;e++)o.find("colgroup").prepend(this._getIndentCol())}(this._tdsOffsetWidth.length==0||this.model.groupSettings.groupedColumns.length||n.inArray(0,this._tdsOffsetWidth)!=-1||this._hiddenColumns.length>0)&&this._setoffsetWidth();this._refreshEditForm(i);this.model.scrollSettings.frozenColumns>0&&(this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate")&&(i.requestType=="beginedit"?i.row.eq(0).next().find("td").height(i.row.eq(1).next().find("td").height()):this.getContentTable().first().find("tr").first().find("td").height(this.getContentTable().last().find("tr").first().find("td").height()));this.model.scrollSettings.frozenRows>0&&i.requestType=="beginedit"&&(this._initFrozenRows(),t.getObject("_vScrollbar._scrollData",this.getScrollObject())&&(this.getScrollObject()._vScrollbar._scrollData.skipChange=!0));this.model.scrollSettings.frozenColumns>0&&(this.rowHeightRefresh(),this._refreshScroller(i));this.model.allowScrolling&&this.model.scrollSettings.frozenColumns<=0&&this.getScrollObject()&&this.getScrollObject().isHScroll()&&this.getScrollObject().refresh()},_refreshEditForm:function(r){var nt,st,rt,y,ut,e,k,tt,u,c,o,ht,d,it,p,h,l,f,a,w,v,b,g,s,ct,ft;for(this.model.editSettings.showAddNewRow&&(nt=this.getContentTable().find(".e-editedrow")),st=this.model.scrollSettings.frozenColumns>0?this.element.find(".gridform"):!t.isNullOrUndefined(nt)&&nt.length==1?nt[0].lastChild.lastChild:document.getElementById(this._id+"EditForm"),rt=!1,this.model.enableResponsiveRow&&n.isFunction(window.matchMedia)&&(ut=window.matchMedia("(max-width: 320px)")),e=n(st).find("input,select,div.e-field,textarea"),k=86,(this._isUnboundColumn||this.getContentTable().find(".e-templatecell")!=null)&&this.model.editSettings.editMode!="batch"&&(e=e.filter(function(){return!n(this).closest(".e-rowcell").hasClass("e-unboundcell")&&!n(this).closest(".e-rowcell").hasClass("e-templatecell")})),tt=null,l=0;l<e.length;l++){if(u=e.eq(l),o=this.getColumnByField(t.isNullOrUndefined(u.prop("name"))?u.attr("name"):u.prop("name")),o!=null&&(y=n.inArray(o,this.model.columns)),this.model.editSettings.editMode=="batch"?k=95:this.model.editSettings.editMode=="normal"&&(k=96),this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate"||this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?(u.parent().css("width",t.dataUtil.max(this._tdsOffsetWidth)+"px"),c=t.max(this._tdsOffsetWidth)*(k/100)):c=this._tdsOffsetWidth[l]*(k/100),(this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="batch"||this.model.allowResizing||this.model.allowResizeToFit)&&!u.hasClass("e-checkbox")&&(c="100%"),o!=null&&y!==i&&y<this.model.columns.length&&this.model.columns[y].editTemplate)ht={rowdata:r.rowData,column:this.model.columns,element:u,requestType:r.requestType,type:r.type},d=this.model.columns[y].editTemplate.write,typeof d=="string"&&(d=t.util.getObject(d,window)),d(ht),this.model.columns[y].isPrimaryKey&&r.requestType=="beginedit"&&u.addClass("e-disable").attr("disabled","disabled");else if(u.hasClass("e-numerictextbox e-js")||u.hasClass("e-datepicker e-js")||u.hasClass("e-datetimepicker e-js")||u.hasClass("e-dropdownlist"))it=this.getColumnByField(u.prop("name")),p=u.val(),(!t.isNullOrUndefined(ut)&&ut.matches||it.width&&typeof it.width=="string"&&it.width.indexOf("%")!=-1&&(this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="batch"))&&(c="100%"),u.css("width",c),u.hasClass("e-numerictextbox e-js")&&(p.length&&u.attr("value",parseFloat(p)),u.prop("name",u.prop("name").replace(this._id,""))),u.hasClass("e-disable")&&u.attr("disabled","disabled");else if(u.hasClass("e-save e-button")||u.hasClass("e-cancel e-button"))u.ejButton({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,width:"100","text-align":"centre",height:"35px"});else switch(u.prop("tagName")){case"INPUT":if(!t.isNullOrUndefined(o)&&o.format&&u.val()!="")switch(o.type){case"date":var p=u.val(),vt=new Date(p),s=o.format.replace("{0:","").replace("}",""),yt=t.format(vt,s,this.model.locale);u.val(yt);break;case"number":p=u.val();s=new RegExp("\\{0(:([^\\}]+))?\\}","gm").exec(o.format);s!=null&&(s[2].toLowerCase().split("")[0]=="c"?s[2]=s[2].toLowerCase().replace("c","n"):s[2],u.val(t.format(parseFloat(p),s[2],this.model.locale)))}u.attr("type")!="checkbox"?(u.css("text-align",u.attr("name")!=null&&this.getColumnByField(u.attr("name"))!=null?this.getColumnByField(u.attr("name")).textAlign:"center"),this.model.editSettings.editMode=="batch"?(u.css("width","100%").css("height","28px"),t.browserInfo().name=="msie"&&parseInt(t.browserInfo().version,10)==8&&u.css("line-height","22px")):this.model.editSettings.editMode=="normal"?(u.css("width","100%").css("height","30px"),t.browserInfo().name=="msie"&&parseInt(t.browserInfo().version,10)==8&&u.css("line-height","24px")):(u.outerWidth(c).height(28),t.browserInfo().name=="msie"&&parseInt(t.browserInfo().version,10)==8&&u.css("line-height","26px"))):u.width(c>0?u.width()>c?c:u.width():this.model.editSettings.editMode.indexOf("template")!=-1?u.width():1);this.model.editSettings.editMode!="batch"||this._tabKey||this._enterKey||(u.is(":checked")?u.prop("checked",!1):u.prop("checked",!0));break;case"SELECT":u.width(c).height(28)}o==null||o.visible||!o.validationRules||this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalformtemplate"||this.model.editSettings.editMode=="inlineformtemplate"||u.addClass("e-hide");u.is(":disabled")||rt||u.is(":hidden")&&typeof(u.data("ejDropDownList")||u.data("ejNumericTextbox"))!="object"||(tt=u,rt=!0)}for(h={},h.enableRTL=this.model.enableRTL,h.cssClass=this.model.cssClass,h.watermarkText=this.localizedLabels.NumericTextBoxWaterMark,h.locale=this.model.locale,e.filter(".e-numerictextbox.e-js").ejNumericTextbox(n.extend({showSpinButton:!0},h)),h.watermarkText=this.localizedLabels.DatePickerWaterMark,e.filter(".e-datepicker.e-js").ejDatePicker(n.extend({displayDefaultDate:!0,showPopupButton:!1},h)),delete h.watermarkText,e.filter(".e-datetimepicker.e-js").ejDateTimePicker(n.extend({showPopupButton:!1},h)),e.filter(".e-dropdownlist").ejDropDownList(n.extend({enableIncrementalSearch:!0,htmlAttributes:{style:"width: 100%"}},h)),l=0;l<this.model.columns.length;l++){if(f=this.model.columns[l],!t.isNullOrUndefined(f.editParams)){a=f.field;a=/^[a-zA-Z0-9- ]*$/.test(a)?a:a.replace(/[^a-z0-9\s_]/gi,"");switch(f.editType){case t.Grid.EditingType.DateTimePicker:e.filter("#"+this._id+a+".e-datetimepicker.e-js").ejDateTimePicker(f.editParams);break;case t.Grid.EditingType.DatePicker:e.filter("#"+this._id+a+".e-datepicker.e-js").ejDatePicker(f.editParams);break;case t.Grid.EditingType.Numeric:e.filter("#"+this._id+a+".e-numerictextbox.e-js").ejNumericTextbox(f.editParams);break;case t.Grid.EditingType.Dropdown:e.filter("#"+this._id+a+".e-dropdownlist").ejDropDownList(f.editParams)}}if(f.editType==t.Grid.EditingType.Dropdown&&(w=-1,this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&(w=this._dataSource().adaptor.value.indexOf(f.field)),v=e.filter("#"+this._id+f.field.replace(/[^a-z0-9\s_]/gi,"")+".e-dropdownlist"),b=null,!t.isNullOrUndefined(f.dataSource)&&!t.isNullOrUndefined(f.editParams)&&t.isNullOrUndefined(f.foreignKeyField)&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&w!=-1?b=f.dataSource:t.isNullOrUndefined(f.dataSource)&&w!=-1&&!t.isNullOrUndefined(f.editParams)?b=this._dataSource().adaptor.foreignData[w]:!t.isNullOrUndefined(f.editParams)&&"fields"in f.editParams&&t.isNullOrUndefined(f.foreignKeyField)&&(b=f.dataSource),b!=null&&v.ejDropDownList({dataSource:b}),g=v.data("ej-value"),this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.ForeignKeyAdaptor&&w!=-1&&!t.isNullOrUndefined(f.editParams)?v.ejDropDownList("setSelectedText",r.requestType=="add"&&t.isNullOrUndefined(f.defaultValue)&&t.isNullOrUndefined(g)?v.val(""):g):v.ejDropDownList("setSelectedValue",r.requestType=="add"&&t.isNullOrUndefined(f.defaultValue)&&t.isNullOrUndefined(g)?v.val(""):g),f==null||f.visible||!f.validationRules||this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalformtemplate"||this.model.editSettings.editMode=="inlineformtemplate"||f.editType==t.Grid.EditingType.Dropdown&&v.closest(".e-rowcell").find("input").addClass("e-hide")),s=null,f.format!==i&&f.format.length>0&&(ct=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),ft=ct.exec(f.format),ft!=null&&(s=ft[2])),[t.Grid.EditingType.DatePicker,t.Grid.EditingType.DateTimePicker].indexOf(f.editType)!=-1){var lt=f.editType==t.Grid.EditingType.DatePicker?"datePicker":"dateTimePicker",at="ej"+lt.replace(/\b\w/g,function(n){return n.toUpperCase()}),pt=this._id+f.field,et=e.filter(function(t,i){return i.id==pt&&(n(i).hasClass("e-datepicker")||n(i).hasClass("e-datetimepicker"))}),ot={};s==null||!t.isNullOrUndefined(f.editParams)&&(f.editParams.dateFormat||f.editParams.dateTimeFormat)||(ot[lt.replace("Picker","")+"Format"]=s);et.hasClass("e-disable")&&(ot.enabled=!1);et[at](ot);this.model.editSettings.editMode=="batch"&&setTimeout(function(){et[at]("show")})}}n.isFunction(n.validator)&&this.model.editSettings.editMode!="batch"&&this.initValidator();tt!=null&&this._focusElements(tt)},_focusElements:function(n){if(n.length){var t=n;(t[0].tagName.toLowerCase()!="select"||t.hasClass("e-field e-dropdownlist"))&&(t[0].tagName.toLowerCase()!="input"||t.hasClass("e-numerictextbox")||t.hasClass("e-datepicker"))?t.hasClass("e-field e-dropdownlist")?t.closest(".e-ddl").focus():t.hasClass("e-numerictextbox")?t.siblings("input:visible").first().select().focus():t.find("input:visible,select").first().select().focus():(t.focus().select(),t[0].focus())}},_renderToolBar:function(){var r=t.buildTag("div.e-gridtoolbar","",{},{id:this._id+"_toolbarItems"}),f=t.buildTag("ul"),u,i;return(!t.isNullOrUndefined(this.model.toolbarSettings.toolbarItems)&&this.model.toolbarSettings.toolbarItems.length||(this.model.allowSorting||this.model.allowFiltering)&&this.model.enableResponsiveRow)&&this._renderLi(f),r.append(f),u=t.buildTag("ul"),r.append(u),!t.isNullOrUndefined(this.model.toolbarSettings.customToolbarItems)&&this.model.toolbarSettings.customToolbarItems.length&&this._renderCustomLi(u),i={},i.click=this._toolBarClick,i.cssClass=this.model.cssClass,i.enableRTL=this.model.enableRTL,i.enableSeprator=!1,r.ejToolbar(i),r.ejToolbar("disableItem",this._disabledToolItems),this._disabledToolItems=n(),r},_renderCustomLi:function(i){for(var u,o,f,e,r=0;r<this.model.toolbarSettings.customToolbarItems.length;r++){e=this.model.toolbarSettings.customToolbarItems[r].templateID?this.model.toolbarSettings.customToolbarItems[r].templateID.replace("#",""):this.model.toolbarSettings.customToolbarItems[r];f=t.buildTag("li","",{},{id:this._id+"_"+e,title:e});switch(typeof this.model.toolbarSettings.customToolbarItems[r]){case"string":o=t.buildTag("a.e-toolbaricons e-icon","",{}).addClass(this.model.toolbarSettings.customToolbarItems[r]);break;case"object":u=this.model.toolbarSettings.customToolbarItems[r];f.attr("title",t.isNullOrUndefined(u.tooltip)?u.templateID.replace("#",""):u.tooltip);o=n(u.templateID).hide().html()}f.html(o);i.append(f)}},_renderLi:function(i){var f,r,u,e;for(n.isFunction(window.matchMedia)&&this.model.enableResponsiveRow&&this.phoneMode&&(f=this.model.toolbarSettings.toolbarItems.indexOf("search"),f!=-1&&this.model.toolbarSettings.toolbarItems.splice(f,1),this.model.allowFiltering&&this.model.toolbarSettings.toolbarItems.push("responsiveFilter"),this.model.allowSorting&&this.model.toolbarSettings.toolbarItems.push("responsiveSorting"),f!=-1&&this.model.toolbarSettings.toolbarItems.push("search")),r=0;r<this.model.toolbarSettings.toolbarItems.length;r++)u=t.buildTag("li","",{},{id:this._id+"_"+this.model.toolbarSettings.toolbarItems[r],title:this.localizedLabels[this.model.toolbarSettings.toolbarItems[r].slice(0,1).toUpperCase()+this.model.toolbarSettings.toolbarItems[r].slice(1)]}),this._renderLiContent(u,this.model.toolbarSettings.toolbarItems[r]),e=this.model.toolbarSettings.toolbarItems[r],this.model.enableResponsiveRow&&(e==="responsiveFilter"||e==="responsiveSorting")&&(u.addClass("e-gridresponsiveicons"),u.css("display","none")),i.append(u)},_renderLiContent:function(n,i){var r,u,f,e;switch(i){case"add":r=t.buildTag("a.e-addnewitem e-toolbaricons e-icon e-addnew","",{});break;case"edit":r=t.buildTag("a.e-edititem e-toolbaricons e-icon e-edit","",{});break;case"delete":r=t.buildTag("a.e-deleteitem e-toolbaricons e-icon e-delete","",{});break;case"update":r=t.buildTag("a.e-saveitem e-toolbaricons e-disabletool e-icon e-save","",{});this._disabledToolItems.push(n.get(0));break;case"cancel":r=t.buildTag("a.e-cancel e-toolbaricons e-disabletool e-icon e-gcancel","",{});this._disabledToolItems.push(n.get(0));break;case"search":r=t.buildTag("a.e-searchitem e-toolbaricons e-disabletool e-icon e-searchfind","",{});this.model.enableResponsiveRow&&this.phoneMode||(u=t.buildTag("input.e-ejinputtext e-gridsearchbar","",{},{type:"text",id:this._id+"_searchbar"}),e=t.buildTag("span.e-cancel e-icon e-hide","",{right:"1%"}),f=t.buildTag("div.e-filterdiv e-searchinputdiv","",{display:"inline-table",width:"85.5%"}),f.append(u).append(e),n.append(f),t.isNullOrUndefined(this.model.searchSettings.key)||u.val(this.model.searchSettings.key));this.model.allowSearching=!0;break;case"printGrid":r=t.buildTag("a.e-print e-toolbaricons e-icon","",{});break;case"excelExport":r=t.buildTag("a.e-toolbaricons e-excelIcon e-icon","",{});break;case"wordExport":r=t.buildTag("a.e-toolbaricons e-wordIcon e-icon","",{});break;case"pdfExport":r=t.buildTag("a.e-toolbaricons e-pdfIcon e-icon","",{});break;case"responsiveFilter":r=t.buildTag("a.e-toolbaricons e-filterset e-icon","",{});break;case"responsiveSorting":r=t.buildTag("a.e-toolbaricons e-respponsiveSorting e-icon","",{})}n.append(r);i=="search"&&(this._searchBar=n,n.css("display","flex"))},_toolBarClick:function(r){var c=n(this.itemsContainer).closest(".e-grid"),u=c.ejGrid("instance"),f=c.attr("id"),h,l,o;if(r.event!=i||r.target.tagName!="INPUT"||r.currentTarget.id!=f+"_search"){n.isFunction(n.fn.ejDatePicker)&&n("#"+f+"EditForm").find(".e-datepicker.e-js").ejDatePicker("hide");var s=r.currentTarget,y=r.target,p=n.extend({},u.model);if(u.ignoreOnToolbarServerClick.length)for(h=0;h<u.ignoreOnToolbarServerClick.length;h++)delete p[u.ignoreOnToolbarServerClick[h]];if(l={itemName:n(s).attr("data-content"),itemId:s.id,currentTarget:s,target:y,itemIndex:n(s).index(),itemCurrentTarget:s.outerHTML,gridModel:p,itemTarget:y.outerHTML,toolbarData:r},!c.ejGrid("instance")._trigger("toolbarClick",l)){switch(l.itemId){case f+"_add":u._toolbarOperation(f+"_add");break;case f+"_edit":u._toolbarOperation(f+"_edit");break;case f+"_delete":u._toolbarOperation(f+"_delete");break;case f+"_update":u._toolbarOperation(f+"_update");break;case f+"_cancel":u.model.editSettings.editMode=="batch"?u.model.editSettings.showConfirmDialog?u._confirmDialog.find(".e-content").html(u.localizedLabels.CancelEdit).end().ejDialog("open"):u.cancelEdit():u._toolbarOperation(f+"_cancel");break;case f+"_search":if(u.model.enableResponsiveRow&&u.phoneMode)if(t.isNullOrUndefined(u.element.find(".e-responsesearch")[0])){var a=t.buildTag("div.e-gridtoolbar","",{},{id:this._id+"_toolbarItems"}),w=t.buildTag("div.e-responsesearch","",{width:"95%",height:"38px","margin-top":"7px","margin-left":"6px"}),v=t.buildTag("span.e-ttoltxt","",{width:"98%","margin-left":"2%"},{id:u._id+"_search"}),e=t.buildTag("span.e-searchitem e-toolbaricons e-disabletool e-icon e-searchfind","",{position:"absolute",right:"2%","margin-top":"1%"});t.browserInfo().name==="webkit"&&e.css("margin-top","-2px");o=t.buildTag("input.e-ejinputtext","",{width:"97%",height:"30px"},{type:"search",id:u._id+"_searchInput"});t.isNullOrUndefined(u.model.searchSettings.key)||o.val(u.model.searchSettings.key);v.append(o);v.append(e);w.append(v);a.append(w);a.ejToolbar({click:function(t){u._toolbarOperation(f+"_search",n(t.currentTarget).find("input").val(),r)}});o.on("keyup",function(){o.val()!=""?(e.removeClass("e-searchfind"),e.addClass("e-cancel")):(e.removeClass("e-cancel"),e.addClass("e-searchfind"))});e.click(function(){e.hasClass("e-cancel")&&(o.val(""),e.removeClass("e-cancel"),e.addClass("e-searchfind"),u._toolbarOperation(f+"_search",n("#"+f+"_searchInput").val(),r))});a.insertBefore(u.getHeaderContent())}else u.element.find(".e-responsesearch").css("display")=="block"?u.element.find(".e-responsesearch").css("display","none"):u.element.find(".e-responsesearch").css("display","block");else u._toolbarOperation(f+"_search",n(r.target).hasClass("e-cancel")?"":n(r.currentTarget).find("input").val(),r);break;case f+"_printGrid":u._toolbarOperation(f+"_printGrid");break;case f+"_excelExport":u._toolbarOperation(f+"_excelExport");break;case f+"_wordExport":u._toolbarOperation(f+"_wordExport");break;case f+"_pdfExport":u._toolbarOperation(f+"_pdfExport");break;case f+"_responsiveFilter":u._toolbarOperation(f+"_responsiveFilter");break;case f+"_responsiveSorting":u._toolbarOperation(f+"_responsiveSorting")}return!1}}},_toolbarOperation:function(i,r,u){var c=this.element,f=c.ejGrid("instance"),s=f.model.editSettings.editMode=="batch",e=c.attr("id"),l,h,o,a,w;f._exportTo=f["export"];switch(i){case e+"_add":s?f._bulkAddRow():f._startAdd();break;case e+"_edit":if(s&&f.model.editSettings.allowEditing){if(f._bulkEditCellDetails.columnIndex==-1){alert(this.localizedLabels.EditOperationAlert);return}l=f.model.columns[f._bulkEditCellDetails.columnIndex].field;l&&f.editCell(f._bulkEditCellDetails.rowIndex,l)}else f.startEdit();break;case e+"_delete":if(this._selectedRow()==-1){alert(this.localizedLabels.DeleteOperationAlert);return}this.model.editSettings.showDeleteConfirmDialog?this._confirmDialog.find(".e-content").html(this.localizedLabels.ConfirmDelete).end().ejDialog("open"):s?this._bulkDelete():this.multiDeleteMode?this._multiRowDelete():this.deleteRow();break;case e+"_update":s&&n("#"+this._id+"EditForm").children().find(".e-field-validation-error").length==0?this.model.editSettings.showConfirmDialog?this._confirmDialog.find(".e-content").html(this.localizedLabels.BatchSaveConfirm).end().ejDialog("open"):this.batchSave():f.endEdit();break;case e+"_cancel":s?n("#"+e+"ConfirmDialog").ejDialog("isOpened")===!0?this._triggerConfirm():f.cancelEditCell():f.cancelEdit();break;case e+"_search":u.type=="click"&&(u.target.nodeName=="A"||u.target.nodeName=="SPAN")&&c.ejGrid("search",r);break;case e+"_printGrid":this.print();break;case e+"_excelExport":f._exportTo(f.model.exportToExcelAction,"excelExporting",f.model.allowMultipleExporting);break;case e+"_wordExport":f._exportTo(f.model.exportToWordAction,"wordExporting",f.model.allowMultipleExporting);break;case e+"_pdfExport":f._exportTo(f.model.exportToPdfAction,"pdfExporting",f.model.allowMultipleExporting);break;case e+"_responsiveFilter":n("#"+f._id+"responsiveFilter").css("display","block");setTimeout(function(){f.element.css("display","none");0});break;case e+"_responsiveSorting":for(this._sortColumns=[],this._removeSortCol=[],h=0;h<this.model.sortSettings.sortedColumns.length;h++)this._sortColumns.push({field:this.model.sortSettings.sortedColumns[h].field,direction:this.model.sortSettings.sortedColumns[h].direction});if(t.isNullOrUndefined(n("#"+this._id+"responsiveSort")[0])){o=n("#"+this._id+"responsiveFilter").clone().css("display","block");o.insertAfter(this.element);o.attr("id",this._id+"responsiveSort");f._setSortingButton();var v=t.buildTag("div.btnContainer","",{width:"100%",bottom:"0px",position:"absolute"}),y=t.buildTag("input.e-resposnsiveFilterBtnLeft e-flat e-btnsub","OK",{width:"45.6%"}),p=t.buildTag("input.e-resposnsiveFilterBtnRight e-flat e-btncan","Cancel",{width:"46%"}),b=t.buildTag("div.e-resFIlterRigthIcon"),k=t.buildTag("span.e-icon e-responsiveClose e-resIcon");o.find(".e-resFilterleftIcon").remove();o.find(".e-labelRes").text("Sorting");o.find(".e-resFilterDialogHeaderDiv").append(b.append(k));o.find(".e-resFilterDialogHeaderDiv").find(".e-resFIlterRigthIcon").click(function(){n("#"+f._id+"responsiveSort").css("display","none");f.element.css("display","block")});a=t.buildTag("div.e-resFilterleftIcon","",{"margin-top":"3%"});w=t.buildTag("span.e-icon e-resIcon e-responsiveSortClear");a.click(function(){o.find(".e-responsivefilterColDiv").find(".e-button").remove();f._setSortingButton(!0);for(var n=0;n<f._sortColumns.length;n++)f._removeSortCol.indexOf(f._sortColumns[n].field)==-1&&f._removeSortCol.push(f._sortColumns[n].field);f._sortColumns=[];f._removeSortCol=[]});o.find(".e-resFilterDialogHeaderDiv").prepend(a.append(w));o.css("height",n(window).height());o.append(v);v.append(y).append(p);y.ejButton({text:"OK",type:"button",click:n.proxy(this._resSortOperation,this)});p.ejButton({text:"Cancel",type:"button",click:function(){n("#"+f._id+"responsiveSort").css("display","none");f.element.css("display","block");f._sortColumns=[];o.find(".e-responsivefilterColDiv").find(".e-button").remove();f._setSortingButton()}})}else n("#"+this._id+"responsiveSort").find(".e-responsivefilterColDiv").find(".e-button").remove(),this._setSortingButton();n("#"+this._id+"responsiveSort").css("display","block");n("#"+this._id+"responsiveSort").find(".e-responsivefilterColDiv").find(".e-filternone").remove();n("#"+this._id+"responsiveSort").css({position:"relative"});setTimeout(function(){f.element.css("display","none");0})}return!1},_resSortOperation:function(){for(var i=[],t=0;t<this.model.sortSettings.sortedColumns.length;t++)i.push(this.model.sortSettings.sortedColumns[t].field);for(t=0;t<i.length;t++)this.removeSortedColumns(i[t]);for(t=0;t<this._sortColumns.length;t++)this.model.allowMultiSorting&&(this.multiSortRequest=!0),this.sortColumn(this._sortColumns[t].field,this._sortColumns[t].direction);n("#"+this._id+"responsiveSort").css("display","none");this.element.css("display","block")},_setSortingButton:function(i){var u=n("#"+this._id+"responsiveSort"),r=this;this._sortCols=[];t.isNullOrUndefined(u.find(".e-responsivefilterColDiv").find(".e-button")[0])&&u.find(".e-responsivefilterColDiv").each(function(u,f){var l=t.buildTag("div","",{float:"right","margin-right":"2%","margin-top":"-1%"}),o=n(f).attr("data-ej-mappingname"),h=t.buildTag("button#"+r._id+o+".e-sortingBtn e-flat",""),e,c,s;if(n(f).append(l.append(h)),e="None",c="",i)h.ejButton({text:e,type:"button",height:28,width:120,id:o,showRoundedCorner:!0,click:n.proxy(r._resSortButClick,r)});else{for(s=0;s<r.model.sortSettings.sortedColumns.length;s++)r.model.sortSettings.sortedColumns[s].field==o&&(e=r.model.sortSettings.sortedColumns[s].direction=="ascending"?"Ascending":"Descending",c=e=="Ascending"?"e-resIcon e-respponsiveSortingAsc":"e-resIcon e-respponsiveSortingDesc");c!=""?h.ejButton({text:e,type:"button",height:28,width:120,cssClass:"e-resSortIconBtn",id:o,prefixIcon:c,imagePosition:"imageright",contentType:"textandimage",showRoundedCorner:!0,click:n.proxy(r._resSortButClick,r)}):h.ejButton({text:e,type:"button",height:28,cssClass:"e-resSortIconBtn",width:120,id:o,showRoundedCorner:!0,click:n.proxy(r._resSortButClick,r)})}})},_sortOperation:function(t,i){var r,u,f;for(this._removeSortCol.indexOf(t)!=-1&&(this._sortColumns.splice(this._removeSortCol.indexOf(t),0),this._removeSortCol.splice(this._removeSortCol.indexOf(t),0)),r=0;r<this._sortColumns.length;r++)if(this._sortColumns[r].field==t)break;this.model.allowMultiSorting?(this.multiSortRequest=!0,r!=-1&&(this._sortColumns.splice(r,1),this._removeSortCol.indexOf(t)==-1&&this._removeSortCol.push(t))):(n("#"+this._id+"responsiveFilter").find(".e-responsivefilterColDiv").find(".e-button").removeClass("e-disable"),u=n("#"+this._id+"responsiveFilter").find(".e-responsivefilterColDiv").not(".e-responsivefilterColDiv[data-ej-mappingname='"+t+"']"),f=u.find(".e-button").addClass("e-disable"),f.text("None"),this._sortColumns.length>0&&(this._removeSortCol.push(this._sortColumns[0].field),this._sortColumns=[]));this._sortColumns.push({field:t,direction:i})},_resSortButClick:function(t){var f="",e="",u=t.model.id,i=n("#"+this._id+t.model.id).ejButton("instance"),r;if(t.model.text=="None")f="Ascending",e="e-resIcon e-respponsiveSortingAsc",this._sortOperation(u,"ascending");else if(t.model.text=="Ascending")f="Descending",e="e-resIcon e-respponsiveSortingDesc",this._sortOperation(u,"descending");else{for(i.model.text="None",i.model.prefixIcon="",i.type="button",i.model.contentType="text",i._render(),r=0;r<this._sortColumns.length;r++)if(this._sortColumns[r].field==u)break;this._removeSortCol.push(u);this._sortColumns.splice(r,1);n("#"+this._id+"responsiveFilter").find(".e-responsivefilterColDiv").find(".e-button").removeClass("e-disable");return}i.model.text=f;i.model.prefixIcon="e-resIcon "+e;i.model.imagePosition="imageright";i.model.contentType="textandimage";i._render()},renderDiaglogButton:function(n,i){var r,o,f,e,u;return this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate"?r="EditExternalForm_":this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?(r="InlineEditForm_",o=t.buildTag("div","","",{id:this._id+"_inlineFormTitle","class":"e-inlineform-titlebar"}),o.appendTo(i)):r="EditDialog_",f=t.buildTag("input.e-save e-button e-btnsub e-flat","",{"margin-left":"30px"},{type:"button",id:r+this._id+"_Save"}),f.ejButton({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,text:this.localizedLabels.SaveButton,width:"100"}),e=t.buildTag("input.e-cancel e-button e-btncan e-flat","",{"margin-left":"19px","margin-right":"13px"},{type:"button",id:r+this._id+"_Cancel"}),e.ejButton({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,text:this.localizedLabels.CancelButton,width:"100"}),u=this.model.editSettings.editMode!="dialog"&&this.model.editSettings.editMode!="dialogtemplate"?t.buildTag("div","","",{"class":"e-editform-btn"}):t.buildTag("div"),u.append(f),u.append(e),n.appendTo(i),this.model.editSettings.editMode!="dialog"&&this.model.editSettings.editMode!="dialogtemplate"?u.appendTo(i):n.append(u),i},_externalFormPosition:function(){var t=n(this.element).offset(),r=n(this.element).width(),u=n(this.element).height(),i=n("#"+this._id+"_externalEdit");switch(this.model.editSettings.formPosition){case"topright":n(i).find(".e-form-toggle-icon").removeClass("e-bottomleft").addClass("e-topright");n(i).css({left:t.left+r+1+"px",top:t.top+"px",position:"absolute",width:"290px"});n("#"+this._id+"_eFormContent").height("auto");break;case"bottomleft":n(i).find(".e-form-toggle-icon").removeClass("e-topright").addClass("e-bottomleft");n(i).css({left:t.left+"px",top:t.top+u+1+"px"});n("#"+this._id+"_eFormContent").width("100%")}},_setoffsetWidth:function(){var u,r=this.model.scrollSettings.frozenColumns>0?this.element.find(".gridform"):n("#"+this._id+"EditForm"),i;if(this._gridRecordsCount!=0||this.model.groupSettings.groupedColumns.length!=0||this.model.scrollSettings.frozenColumns!=0||this.model.scrollSettings.frozenRows!=0||this.model.editSettings.editMode=="batch"||r.find(".e-checkbox").length>0&&this._dataSource()instanceof t.DataManager)for(u=this.model.editSettings.editMode=="batch"?r.closest("td"):this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"||this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate"?r.find(".e-rowcell").not(".e-unboundcell,.e-templatecell"):r.find("tr").find(".e-rowcell").not(".e-unboundcell,.e-templatecell"),i=0;i<u.length;i++)this._tdsOffsetWidth[i]=u.get(i).offsetWidth},_bulkChangesAcquired:function(){return this.batchChanges.added.length>0||this.batchChanges.changed.length||this.batchChanges.deleted.length?!0:!1},_renderDialog:function(){return t.buildTag("div.e-dialog e-dialog-content e-shadow e-widget-content","",{display:"none"},{id:this._id+"_dialogEdit"})},getCurrentEditCellData:function(){var r,i,f,u,e,o;if(this.model.isEdit&&n("#"+this._id+"EditForm").length){r=n("#"+this._id+this._bulkEditCellDetails.fieldName.replace(/[^a-z0-9\s_]/gi,""));f=this.model.columns[this._bulkEditCellDetails.columnIndex];switch(this._bulkEditCellDetails.cellEditType){case t.Grid.EditingType.String:case t.Grid.EditingType.Numeric:i=r.val();break;case t.Grid.EditingType.Dropdown:i=this._bulkEditCellDetails.isForeignKey?{value:r.ejDropDownList("getSelectedValue"),text:r.ejDropDownList("getValue")}:r.ejDropDownList("getSelectedValue");this._bulkEditCellDetails.isForeignKey&&f.originalType=="number"&&i.value!=""&&(i.value=JSON.parse(i.value));break;case t.Grid.EditingType.Boolean:i=r.is(":checked");break;case t.Grid.EditingType.DatePicker:e=n.trim(r.val());o=r.ejDatePicker("instance");o._setDateValue(e);i=e==""?e:o.model.value;break;case t.Grid.EditingType.DateTimePicker:i=n.trim(r.val())==""?n.trim(r.val()):r.ejDateTimePicker("model.value");break;case"edittemplate":u=f.editTemplate.read;typeof u=="string"&&(u=t.util.getObject(u,window));i=u(r)}return typeof i=="string"&&i.length&&f.type=="number"&&(i=t.globalize.parseFloat(i,this.model.locale)),i}return null},cancelEditCell:function(){if(this.model.isEdit){var r=this.getRows()[this._bulkEditCellDetails.rowIndex],u={},i;t.createObject(this._bulkEditCellDetails.fieldName,this._bulkEditCellDetails.cellValue,u);i=n(r).hasClass("e-insertedrow")?n(r).find(".e-rowcell").get(this._bulkEditCellDetails.columnIndex+this.model.groupSettings.groupedColumns.length):n(r).find(".e-rowcell").get(this._bulkEditCellDetails.columnIndex);n(i).removeClass("e-validError");n(i).hasClass("e-updatedtd")&&n(i).addClass("e-gupdatenotify");n(i).removeClass("e-editedbatchcell").empty().html(n(n.templates[this._id+"_JSONTemplate"].render(u)).find(".e-rowcell").get(this._bulkEditCellDetails.columnIndex).innerHTML);this.model.isEdit=!1;this.element.focus()}},saveCell:function(i){var a,v,b,y,e,h,k,o;if(this.model.isEdit){if(!this.editFormValidate())return!0;var p=n("#"+this._id+"EditForm"),d=p.closest("tr"),g=p.closest("td"),f,s,r={},u=this.model.columns[this._bulkEditCellDetails.columnIndex],w=n("#"+this._id+this._bulkEditCellDetails.fieldName.replace(/[^a-z0-9\s_]/gi,"")),l,c;if(r={columnName:u.field,value:this.getCurrentEditCellData(),rowData:this._bulkEditCellDetails.rowData,previousValue:this._bulkEditCellDetails.cellValue,columnObject:u,cell:g,isForeignKey:this._bulkEditCellDetails.isForeignKey},!i&&this._trigger("cellSave",r)){this._focusElements(r.cell);this._bulkEditCellDetails.cancelSave=!0;return}if(this.model.allowTextWrap&&r.cell.addClass("e-nowrap"),(this._bulkEditCellDetails.cellEditType=="datetimepicker"||this._bulkEditCellDetails.cellEditType=="dropdownedit"||this._bulkEditCellDetails.cellEditType=="datepicker")&&w[w.data("ejWidgets")[0]]("destroy"),t.isNullOrUndefined(u.format)||(u.type!="date"&&u.type!="datetime"||t.isNullOrUndefined(r.value)||(r.isForeignKey?r.value.text=r.value.text.length>0?new Date(r.value.text):r.value.text:r.value=r.value.length>0?new Date(r.value):r.value),s=this.formatting(u.format,r.isForeignKey?!isNaN(parseFloat(r.value.text))&&isFinite(r.value.text)?parseFloat(r.value.text):r.value.text:r.value,this.model.locale),r.cell.empty().html(s)),t.createObject(this._bulkEditCellDetails.fieldName,r.isForeignKey?r.value.value:r.value,r.rowData),t.isNullOrUndefined(u.format)&&(s=r.isForeignKey?r.value.text:r.value),t.isNullOrUndefined(u.template)||(a=t.copyObject({},r.rowData),t.createObject(this._bulkEditCellDetails.fieldName,r.isForeignKey?r.value.value:r.value,a),s=n.templates(u.template).render(a)),this._bulkEditCellDetails.cellEditType=="edittemplate"?(r.value instanceof Array&&(s=r.value.join()),r.cell.empty().html(s)):r.columnObject.type=="boolean"||r.columnObject.editType=="booleanedit"?(v={},t.createObject(r.columnObject.field,r.value,v),b=this.model.detailsTemplate!=null||this.model.childGrid!=null?this._bulkEditCellDetails.columnIndex+1:this._bulkEditCellDetails.columnIndex,r.cell.empty().html(n(n.templates[this._id+"_JSONTemplate"].render(v))[0].cells[b].innerHTML)):r.columnObject.editType!="datepicker"&&r.columnObject.editType!="datetimepicker"||t.isNullOrUndefined(u.format)?r.columnObject.disableHtmlEncode?r.cell.text(s).html():r.cell.empty().html(s):r.cell.empty().html(s),r.cell.removeClass("e-validError"),r.cell.hasClass("e-updatedtd")&&r.cell.addClass("e-gupdatenotify"),r.previousValue=t.isNullOrUndefined(r.previousValue)?"":u.type=="date"||u.type=="datetime"?new Date(r.previousValue):r.previousValue,f=r.isForeignKey?r.value.value:r.value,y=!1,o=this.getIndexByRow(r.cell.parent()),this.model.editSettings.rowPosition=="bottom"?(h=this.getBatchChanges().added.length?o:this.model.groupSettings.groupedColumns?o:r.cell.parent().index(),e=this.getBatchChanges().added.length&&r.cell.parent().hasClass("e-insertedrow")&&this._currentJsonData.length==this._bulkEditCellDetails.rowIndex?this._currentJsonData[0]:this._currentJsonData[h]):(h=this.getBatchChanges().added.length?r.cell.parent().hasClass("e-insertedrow")?o:o-this.getBatchChanges().added.length:this.model.groupSettings.groupedColumns?o:r.cell.parent().index(),e=!this.getBatchChanges().added.length&&this._currentJsonData.length==this._bulkEditCellDetails.rowIndex?this._currentJsonData[this._bulkEditCellDetails.rowIndex-1]:this._currentJsonData[h]),y=this._currentJsonData.length>0?this._bulkEditCellDetails.type!="date"&&this._bulkEditCellDetails.type!="datetime"||t.isNullOrUndefined(this._bulkEditCellDetails.format)?t.isNullOrUndefined(t.getObject(r.columnName,e))?r.cell.parent().hasClass("e-insertedrow")?!0:t.isNullOrUndefined(e[this._bulkEditCellDetails.fieldName])&&f==""?!(r.previousValue==f):r.previousValue!=e[this._bulkEditCellDetails.fieldName]:(this._bulkEditCellDetails.cellEditType=="datepicker"||this._bulkEditCellDetails.cellEditType=="datetimepicker"||this._bulkEditCellDetails.cellEditType=="dropdownedit")&&f instanceof Date&&r.previousValue instanceof Date?f.getTime()!==t.getObject(r.columnName,e).getTime():typeof f=="number"?f!==parseFloat(t.getObject(r.columnName,e)):typeof f=="boolean"?f!=t.getObject(r.columnName,e):f!==t.getObject(r.columnName,e).toString():r.value instanceof Date?this.formatting(this._bulkEditCellDetails.format,f)!=this.formatting(this._bulkEditCellDetails.format,t.getObject(r.columnName,e)):t.isNullOrUndefined(e[this._bulkEditCellDetails.fieldName])&&this._bulkEditCellDetails._data[h][this._bulkEditCellDetails.fieldName]==r.value?!1:!0:!0,this.model.isEdit=!1,y)r.cell.addClass("e-updatedtd e-icon e-gupdatenotify"),this._enableSaveCancel(),l=t.getObject(this._bulkEditCellDetails.fieldName,r.rowData),c=typeof l=="string"&&l.length?r.isForeignKey?r.value.value.toString():r.value.toString():r.isForeignKey?isNaN(parseInt(r.value.value))?r.value.value:parseInt(r.value.value):r.value,typeof r.value!="string"||c.length||(c=null),t.createObject(this._bulkEditCellDetails.fieldName,c,r.rowData),n.inArray(r.rowData,this.batchChanges.changed)==-1&&n.inArray(r.rowData,this.batchChanges.added)==-1&&this.batchChanges.changed.push(r.rowData),this.isejObservableArray&&(k=r.cell.closest("tr").hasClass("e-insertedrow")?"insert":"update",this._refreshViewModel(r,k));else if(r.cell.removeClass("e-updatedtd e-icon e-gupdatenotify"),this._enableSaveCancel(),this.batchChanges.changed.length>0&&!r.cell.hasClass("e-editedbatchcell e-updatedtd e-icon e-gupdatenotify")&&!r.cell.parent().children().hasClass("e-updatedtd"))for(o=0;o<this.batchChanges.changed.length;o++)r.rowData[this._primaryKeys[0]]==this.batchChanges.changed[o][this._primaryKeys[0]]&&this.batchChanges.changed.splice(o,1);d.removeClass("e-editedrow").removeClass("e-batchrow");r.cell.removeClass("e-editedbatchcell")}},_refreshViewModel:function(r,u){var s,e,f;for(s=this._dataSource()instanceof t.DataManager?this._dataSource():t.DataManager(this._dataSource()),e=new t.Query,f=0;f<this._primaryKeys.length;f++)e=e.where(this._primaryKeys[f],t.FilterOperators.equal,this._primaryKeys.length?t.getObject(this._primaryKeys[f],r.rowData):null);var c=s.executeLocal(e),o=this._dataSource(i,!0),h=n.inArray(c[0],this._dataSource());this.model.editSettings.showConfirmDialog=!1;switch(u){case"update":o(r.rowData,h,u);break;case"remove":o(r.rowData,h,u);break;case"insert":o(r.rowData,0,u)}},_enableSaveCancel:function(){if(this.model.toolbarSettings.showToolbar){var n=this.getContentTable().find(".e-updatedtd.e-icon.e-gupdatenotify").length>0||this._isBatchDeleteApplied?"enableItemByID":"disableItemByID",t=this.element.find("#"+this._id+"_toolbarItems");t.ejToolbar(n,this._id+"_update");t.ejToolbar(n,this._id+"_cancel")}},setCellText:function(r,u,f){var y=typeof u=="string",ut=this._excludeDetailRows(),s,ft=this.model.groupSettings.groupedColumns.length!=0,c=this.model.scrollSettings.allowVirtualScrolling,e=this[y?"getColumnByField":"getColumnByIndex"](u),p=t.getObject(["currentViewData",ft?".records":""].join(""),this.model),l={},et=c?this._dataManager:new t.DataManager(p),a=this._primaryKeys[0],d=y||t.getObject(r+"."+a,c?this._dataManager.dataSource.json:p),ot=f,g=!1,v,nt,w,b,k,st,h,o,tt,it,rt;t.createObject(e.field,f,l);y&&(d=r,r=et.executeLocal((new t.Query).select(a)).indexOf(r),u=this.getColumnIndexByField(e.field));c&&(v=this.model.pageSettings.pageSize,b=r%v,nt=(r+v-b)/v,w=(nt-1)*v,k=n.inArray(w,this.virtualLoadedPages)!=-1,k&&(s=this.getContentTable().find("tr[name="+w+"]")[b].cells[u]));st=this._excludeDetailRows()[r];h=this;t.isNullOrUndefined(e)||e.isPrimaryKey||e.allowEditing==!1||(t.isNullOrUndefined(e.validationRules)||(o=t.buildTag("form","",{},{id:this._id+"EditForm"}),tt=t.buildTag("input","",{},{id:this._id+e.field,value:f,name:e.field}),o.addClass("gridform"),o.append(tt),this.element.append(o),o.validate({errorPlacement:function(t){return h._alertDialog||h._renderAlertDialog(),n("#"+h._id+"AlertDialog_wrapper").css("min-height",""),h._alertDialog.find(".e-content").text(t.text()),h._alertDialog.ejDialog("open"),h.element.find(o).remove(),g=!0,!0}}),this.setValidationToField(e.field,e.validationRules)),t.isNullOrUndefined(e.format)||(it=this.formatting(e.format,e.foreignKeyValue?!isNaN(parseFloat(f))&&isFinite(f)?parseFloat(f):f:f,this.model.locale),ot=it),t.isNullOrUndefined(e.validationRules)||(n(o).validate().form(),this.element.find(o).remove()),g||(rt=r==-1||u==-1||c&&!k||r>(c?this._dataSource():p).length||u>this.model.columns.length,rt||(s=this.model.scrollSettings.frozenColumns?this._frozenCell(r,u)[0]:s||this._excludeDetailCells(ut[r])[u],f=e.format===i?f:this.formatting(e.format,f,this.model.locale),t.isNullOrUndefined(e.foreignKeyField)||t.isNullOrUndefined(e.foreignKeyValue)||(f=this._getForeignKeyData(l)[e.foreignKeyField][e.foreignKeyValue]),e.disableHtmlEncode?n(s).text(f):s.innerHTML=f,this._trigger("queryCellInfo",{cell:s,text:s.innerHTML,column:e,data:l})),a&&(t.createObject(a,d,l),this._dataManager.update(a,l))))},_excludeDetailCells:function(i){return t.isNullOrUndefined(this.model.detailsTemplate||this.model.childGrid||this.model.showSummary)?n(i.cells):n(i.cells).not(".e-detailrowexpand, .e-detailrowcollapse")},setCellValue:function(r,u,f){var s,p,w;if(n("#"+this._id+"EditForm").length>0&&n("#"+this._id+"EditForm").attr("id","EditForm1"),this.model.editSettings.editMode=="batch"&&!this.model.scrollSettings.allowVirtualScrolling&&!this.model.scrollSettings.frozenColumns){var a=this.getDataByIndex(r),l=this._excludeDetailRows()[r],v=this.getColumnIndexByField(u),h=this,c=f,y=!1,e=this.getColumnByField(u),o;if(o=n(l).hasClass("e-insertedrow")?n(l.cells).not(".e-detailrowcollapse, .e-detailrowexpand")[v+this.model.groupSettings.groupedColumns.length]:n(l.cells).not(".e-detailrowcollapse, .e-detailrowexpand")[v],!t.isNullOrUndefined(e)&&!e.isPrimaryKey&&e.allowEditing!=!1){if(t.isNullOrUndefined(e.validationRules)||(s=t.buildTag("form","",{},{id:this._id+"EditForm"}),p=t.buildTag("input","",{},{id:this._id+e.field,value:f,name:e.field}),s.append(p),this.element.append(s),s.validate({errorPlacement:function(t){return h._alertDialog||h._renderAlertDialog(),n("#"+h._id+"AlertDialog_wrapper").css("min-height",""),h._alertDialog.find(".e-content").text(t.text()),h._alertDialog.ejDialog("open"),h.element.find(s).remove(),y=!0,!0}}),this.setValidationToField(e.field,e.validationRules)),e.foreignKeyValue&&(c=this._foreignKeyBinding(v,f,this._id),c==i)){this._alertDialog||this._renderAlertDialog();n("#"+this._id+"AlertDialog_wrapper").css("min-height","");this._alertDialog.find(".e-content").text(this.localizedLabels.ForeignKeyAlert);this._alertDialog.ejDialog("open");t.isNullOrUndefined(e.validationRules)||this.element.find(s).remove();return}t.isNullOrUndefined(e.format)||(w=this.formatting(e.format,e.foreignKeyValue?!isNaN(parseFloat(f))&&isFinite(f)?parseFloat(f):f:f,this.model.locale),c=w);t.isNullOrUndefined(e.validationRules)||(n(s).validate().form(),this.element.find(s).remove());n("#EditForm1").attr("id",this._id+"EditForm");y||o.innerHTML==c||(n(o).has("form").length>0&&(this.model.isEdit=!1),n(o).hasClass("e-boolrowcell")?n(o).find("input").attr("checked",c):o.innerHTML=c,n(o).addClass("e-updatedtd e-icon e-gupdatenotify"),n(o).removeClass("e-validError e-editedbatchcell"),t.createObject(u,f,a),n(l).hasClass("e-insertedrow")||n.inArray(a,this.batchChanges.changed)==-1&&this.batchChanges.changed.push(a),this._enableSaveCancel())}}},setDefaultData:function(i){var e,h,o,u,f,c;if(t.isNullOrUndefined(i)){for(e=[],h=this.model.columns,o=0;o<this.model.columns.length;o++)e.push(this.model.columns[o].field);for(t.isNullOrUndefined(this._bulkEditCellDetails._data)&&(this._bulkEditCellDetails._data=[]),i={},u=function(n,r){t.createObject(n,r,i)},f=0;f<e.length;f++){var s=f,r=e[f],l=h[f].type,a=t.getObject(r,this._bulkEditCellDetails._data[0]),v=t.isNullOrUndefined(this.model.parentDetails)?null:this.model.parentDetails.parentKeyField;if(r===v&&(this.model.columns[s].defaultValue=this.model.parentDetails.parentKeyFieldValue),t.isNullOrUndefined(this.model.columns[s].defaultValue))switch(l){case"number":u(r,0);break;case"string":u(r,null);break;case"boolean":u(r,!1);break;case"object":n.isArray(a)?u(r,[]):u(r,null);case"datetime":case"date":u(r,null)}else u(r,this.model.columns[s].defaultValue)}t.isNullOrUndefined(this.model.queryString)||(c=this.model.foreignKeyField||this.model.queryString,i[c]=this.model.parentDetails.parentRowData[this.model.queryString])}this._bulkEditCellDetails.defaultData=i},_bulkDelete:function(i){if(this.model.editSettings.allowDeleting){if(t.isNullOrUndefined(i)&&(i=this._selectedRow()),i==-1){alert(this.localizedLabels.DeleteOperationAlert);return}var e,r,u,f={};if(this.multiDeleteMode&&this.selectedRowsIndexes.length>1?(u=[],r=this.getSelectedRows(),Array.prototype.push.apply(u,this.getSelectedRecords()),Array.prototype.push.apply(this.batchChanges.deleted,this.getSelectedRecords())):(e=this.getRows()[i],r=n(e),u=this.getDataByIndex(i)),f={primaryKey:this._primaryKeys,rowIndex:i,rowData:u,row:r},this._trigger("beforeBatchDelete",f))return;this.isejObservableArray&&this._refreshViewModel(f,"remove");this.model.isEdit&&this.cancelEditCell();r.hasClass("e-insertedrow")?(r.remove(),i=n.inArray(e,this._bulkEditCellDetails.insertedTrCollection),i!=-1&&(this._bulkEditCellDetails.insertedTrCollection.splice(i,1),this.batchChanges.added.splice(i,1))):(r.hide(),(f.rowIndex==0||r.hasClass("e-firstrow"))&&(r.hasClass("e-firstrow")&&this.getContentTable().find("tr").removeClass("e-firstrow"),this.getContentTable().find("tr:visible").first().addClass("e-firstrow")),n.isArray(u)||this.batchChanges.deleted.push(u));this._gridRows=this.model.detailsTemplate!=null||this.model.childGrid!=null?this._gridRows:this.getContentTable().find("td.e-rowcell").closest("tr").toArray();this.model.allowScrolling&&this._refreshScroller(f);this._isBatchDeleteApplied=!0;this._enableSaveCancel();this._selectedRow(-1);f={primaryKey:this._primaryKeys,rowIndex:i,rowData:u};this._trigger("batchDelete",f)}},_bulkAddRow:function(i){var h=n("#"+this._id+"EditForm"),r,u,f,e,o,s;if(h.length&&!this.editFormValidate())return!0;if(this.model.editSettings.allowAdding){if(this._isAddNew=!0,r={},e=this.getRows(),t.isNullOrUndefined(i)||(this._bulkEditCellDetails.defaultData=i),t.isNullOrUndefined(this._bulkEditCellDetails.defaultData)&&this.setDefaultData(),r={defaultData:n.extend(!0,{},this._bulkEditCellDetails.defaultData),primaryKey:this._primaryKeys},this._trigger("beforeBatchAdd",r))return;for(u=n(n.render[this._id+"_JSONTemplate"](r.defaultData)).addClass("e-insertedrow"),e!=null&&n(e[0]).hasClass("e-alt_row")&&u.removeClass("e-alt_row"),this.model.editSettings.rowPosition=="top"?this.getContentTable().first().find("tbody").first().prepend(u):this.model.editSettings.rowPosition=="bottom"&&this.getContentTable().first().find("tbody").first().append(u),this._gridRecordsCount===0&&this.getContentTable().find("tbody .emptyrecord").first().remove(),this._gridRows=this.getContentTable().find("td.e-rowcell").closest("tr").toArray(),o=0;o<this.model.groupSettings.groupedColumns.length;o++)u.prepend(t.buildTag("td.e-indentcell"));this._bulkEditCellDetails.insertedTrCollection.push(u.get(0));this.batchChanges.added.push(r.defaultData);s=this._gridRows.length-1;this.model.editSettings.rowPosition=="bottom"?(f=this._findNextEditableCell(0),this.selectRows(s),this.editCell(s,this.model.columns[f].field)):(f=this._findNextEditableCell(0),this.selectRows(0),this.editCell(0,this.model.columns[f].field));this.model.allowScrolling&&this._refreshScroller(r);u.find(".e-rowcell").addClass("e-updatedtd e-icon e-gupdatenotify");this._enableSaveCancel();r={defaultData:r.defaultData};n.extend(r,{columnObject:this.model.columns[f],columnIndex:f,row:u,primaryKey:this._primaryKeys,cell:n(u[0].cells[f])});this._trigger("batchAdd",r);this._trigger("refresh",r)}},getDataByIndex:function(t){var i=n(this._excludeDetailRows()[t]),r;return i.hasClass("e-insertedrow")?(r=n.inArray(i[0],this._bulkEditCellDetails.insertedTrCollection),this.batchChanges.added[r]):this._bulkEditCellDetails._data[this.model.editSettings.rowPosition=="top"?t-this._bulkEditCellDetails.insertedTrCollection.length:t]},refreshBatchEditChanges:function(){this._bulkEditCellDetails={cellValue:null,rowIndex:-1,_data:null,columnIndex:-1,fieldName:null,cellEditType:"",cancelSave:!1,defaultData:null,insertedTrCollection:[],rowData:null,isForeignKey:!1};this.batchChanges={added:[],deleted:[],changed:[]}},refreshBatchEditMode:function(){(this.model.editSettings.editMode=="batch"||this._enableCheckSelect)&&(this.refreshBatchEditChanges(),this._bulkEditCellDetails._data=n.extend(!0,[],this.getCurrentViewData()))},batchCancel:function(){this.cancelEdit()},batchSave:function(){var n={},i=this,t=this.model.editSettings.rowPosition=="top"||this._gridRows==null?0:this._gridRows.length-1;if(this._batchCellValidation(t),!this.saveCell()){if(n.batchChanges=this.getBatchChanges(),this._trigger("beforeBatchSave",n))return;n={};n.requestType="batchsave";this._isAddNew=!1;this._sendBulkReuqest(this.getBatchChanges(),n)}},_sendBulkReuqest:function(n,i){var r=this._dataManager.saveChanges(n,this._primaryKeys[0],this.model.query._fromTable,this.model.query),u=this;this._isBatchDeleteApplied=!1;this._dataManager instanceof t.DataManager&&!this._dataManager.dataSource.offline?(r.done(function(){u._processBindings(i)}),r.fail(function(n){var t={error:n.error};u._trigger("actionFailure",t)})):this._processBindings(i)},getBatchChanges:function(){return this.batchChanges},editCell:function(r,u){var c;if(!this.element.ejWaitingPopup("model.showOnInit")&&this.model.editSettings.allowEditing&&n.inArray(u,this._disabledEditableColumns)==-1){if(c=n("#"+this._id+"EditForm"),this.model.isEdit&&this.saveCell(),n.isFunction(n.validator)&&c.length&&c.validate().errorList.length)return;var o=n(this._excludeDetailRows()[r]),s=this.getColumnIndexByField(u),a=o.find(".e-rowcell").eq(s),e=this.model.columns[s],h=this.getDataByIndex(r),f={validationRules:t.isNullOrUndefined(e.validationRules)?{}:n.extend(!0,{},e.validationRules),columnName:e.field,value:t.getObject(t.isNullOrUndefined(u)?"":u,h),rowData:h,row:o,primaryKey:this._primaryKeys,columnObject:e,cell:a,isForeignKey:!t.isNullOrUndefined(e.foreignKeyValue)&&this.model.editSettings.editMode=="batch"?!0:!1},l=!0;if(this.model.allowTextWrap&&this.element.find(".e-rowcell").removeClass("e-nowrap"),this.model.allowScrolling&&this._refreshScroller(f),this._batchEditRowData=h,this._trigger("cellEdit",f))return;o.hasClass("e-insertedrow")&&(f.requestType="add");(n.inArray(u,this._primaryKeys)!=-1||f.columnObject.allowEditing===!1||(f.columnObject.template||f.columnObject.type=="checkbox")&&(f.columnObject.allowEditing==!1||!f.columnObject.field)||f.columnObject.commands)&&(n.extend(this._bulkEditCellDetails,{cellValue:f.value,rowIndex:r,fieldName:u,rowData:f.rowData,columnIndex:s,isForeignKey:t.isNullOrUndefined(f.columnObject.foreignKeyValue)?!1:!0}),l=!1);o.hasClass("e-insertedrow")&&f.columnObject.isPrimaryKey&&(l=!0);l&&(n.extend(this._bulkEditCellDetails,{rowIndex:r,cellValue:f.value,columnIndex:s,format:e.format==i?null:e.format,type:e.type,fieldName:u,cellEditType:f.columnObject.editType,rowData:h,isForeignKey:t.isNullOrUndefined(f.columnObject.foreignKeyValue)?!1:!0}),this._renderBulkEditObject(f,a),o.addClass("e-editedrow").addClass("e-batchrow"),f.cell.addClass("e-editedbatchcell"),f.columnObject.editType=="booleanedit"&&f.cell.addClass("e-boolrowcell"))}},_findNextEditableCell:function(n){for(var i=this.model.columns.length,t=n;t<i;t++)if(!this.model.columns[t].template&&!this.model.columns[t].commands&&this.model.columns[t].visible)return t;return-1},_findNextCell:function(i,r,u){var e,f=[],o,s=this.getRows();return this.model.columns[i].template&&(this.model.columns[i].__isTemplate=!0),this.model.columns[i].commands&&(this.model.columns[i].__isCommand=!0),o=t.isNullOrUndefined(u)||u.keyCode!=39&&u.keyCode!=37?t.Predicate("visible","equal",!0).and("__isTemplate","notequal",!0).and("__isCommand","notequal",!0).and("allowEditing","notequal",!1).and("isPrimaryKey","notequal",!0):t.Predicate("visible","equal",!0),e=r=="right"?this.model.columns.slice(i):this.model.columns.slice(0,i+1).reverse(),f=t.DataManager(e).executeLocal(t.Query().where(o)),f.length!=0||r=="left"&&this._bulkEditCellDetails.rowIndex==0||r=="right"&&this._bulkEditCellDetails.rowIndex+1==this.getRows().length||(e=r=="right"?this.model.columns.slice(0,i):this.model.columns.slice(i).reverse(),f=t.DataManager(e).executeLocal(t.Query().where(o)),this._bulkEditCellDetails.rowIndex=f.length&&r=="right"?this._bulkEditCellDetails.rowIndex+1:this._bulkEditCellDetails.rowIndex-1),f.length?n.inArray(f[0],this.model.columns):-1},_moveCurrentCell:function(i,r){var u,e=this._bulkEditCellDetails.rowIndex,o=n("#"+this._id+"EditForm"),f,s;if(this._bulkEditCellDetails.rowIndex==-1&&this._bulkEditCellDetails.columnIndex==-1)return!0;switch(i){case"right":if(this._bulkEditCellDetails.rowIndex==this.getRows().length-1&&this._bulkEditCellDetails.columnIndex==this.model.columns.length-1||!this.element.is(document.activeElement)&&!this.getContent().is(document.activeElement)&&o.length==0)return!0;this._bulkEditCellDetails.columnIndex==this.model.columns.length-1?(u=0,this._bulkEditCellDetails.rowIndex=this._bulkEditCellDetails.rowIndex+1):u=this._bulkEditCellDetails.columnIndex+1;(t.isNullOrUndefined(this.model.columns[u].template)||!t.isNullOrUndefined(this.model.columns[u].field))&&t.isNullOrUndefined(this.model.columns[u].commands)&&this.model.columns[u].visible!==!1&&this.model.columns[u].allowEditing!==!1||(u=this._findNextCell(u,i,r));this._bulkEditCellDetails.rowIndex!=e&&this.selectRows(this._bulkEditCellDetails.rowIndex);u!=-1&&this.editCell(this._bulkEditCellDetails.rowIndex,this.model.columns[u].field);break;case"left":if(this._bulkEditCellDetails.rowIndex==0&&this._bulkEditCellDetails.columnIndex==0||!this.element.is(document.activeElement)&&o.length==0)return!0;this._bulkEditCellDetails.columnIndex==0?(u=this.model.columns.length-1,this._bulkEditCellDetails.rowIndex=this._bulkEditCellDetails.rowIndex-1,this.selectRows(this._bulkEditCellDetails.rowIndex)):u=this._bulkEditCellDetails.columnIndex-1;(t.isNullOrUndefined(this.model.columns[u].template)||!t.isNullOrUndefined(this.model.columns[u].field))&&t.isNullOrUndefined(this.model.columns[u].commands)&&this.model.columns[u].visible!==!1&&this.model.columns[u].allowEditing!==!1||(u=this._findNextCell(u,i,r));this._bulkEditCellDetails.rowIndex!=e&&this.selectRows(this._bulkEditCellDetails.rowIndex);u!=-1&&this.editCell(this._bulkEditCellDetails.rowIndex,this.model.columns[u].field);break;case"up":if(this._bulkEditCellDetails.rowIndex==0)return;u=this._bulkEditCellDetails.columnIndex;this._enableCheckSelect||this.selectRows(this._bulkEditCellDetails.rowIndex-1);this.editCell(this._bulkEditCellDetails.rowIndex-1,this.model.columns[this._bulkEditCellDetails.columnIndex].field);break;case"down":if(f=this._bulkEditCellDetails.columnIndex!=this._copyBulkEditCellDetails.columnIndex?this._copyBulkEditCellDetails:this._bulkEditCellDetails,f.rowIndex==this.getRows().length-1){this.endEdit();return}u=f.columnIndex;this._enableCheckSelect||this.selectRows(f.rowIndex+1);f.columnIndex!=-1&&(this.editCell(f.rowIndex+1,this.model.columns[f.columnIndex].field),this.selectCells([[f.rowIndex,f.columnIndex]]))}return s=!n(this.getRows()[this._bulkEditCellDetails.rowIndex]).hasClass("e-insertedrow"),u!=-1&&(this.model.columns[u].commands||this.model.columns[u].isPrimaryKey&&s&&!t.isNullOrUndefined(r)&&r.keyCode==9||this.model.columns[u].template&&this.model.columns[u].field=="")&&this.element.focus(),!1},_renderBulkEditObject:function(i,r){var o=t.buildTag("form","",{},{id:this._id+"EditForm"}),c=this._bulkEditTemplate,l=this._id+i.columnObject.field,u,s,e={},h,f;t.createObject(i.columnObject.field,i.value,e);h={requestType:i.requestType,cell:i.cell,columnName:i.columnName,rowData:i.rowData,row:i.row};r.empty();r.parent().is(":last-child")||(r.addClass("e-validError"),r.removeClass("e-gupdatenotify"));s=c.find("#"+i.columnObject.field.replace(/[^a-z0-9\s_]/gi,t.pvt.consts.complexPropertyMerge)+"_BulkEdit").html();u=n(n.templates(s).render(e));u.get(0).tagName=="SELECT"&&(f=t.getObject(i.columnObject.field,e),u.val(t.isNullOrUndefined(f)?"":f.toString()),u.val()==null&&u.val(u.find("option").first().val()),u.data("ej-value",f));o.append(u);r.append(o);this._setoffsetWidth();this._refreshEditForm(h);n.isFunction(n.validator)&&!n.isEmptyObject(i.validationRules)&&(this.initValidator(),this.setValidationToField(i.columnObject.field,i.validationRules));this.model.isEdit=!0},_triggerConfirm:function(n){if(n!==i&&n.model.text==this._getDeprecatedLocalizedLabel("OKButton"))this._confirmDialog.find(".e-content").text()==this.localizedLabels.BatchSaveConfirm?this.batchSave():this._confirmDialog.find(".e-content").text()==this.localizedLabels.ConfirmDelete?this.model.editSettings.editMode=="batch"?this._bulkDelete():this.multiDeleteMode?this._multiRowDelete():t.isNullOrUndefined(this._cDeleteData)?this.deleteRow():(this.deleteRow(this._cDeleteData),this._cDeleteData=null):this._confirmDialog.find(".e-content").text()==this.localizedLabels.CancelEdit?this.cancelEdit():(this._confirmedValue=!0,this._processBindings(this._requestArgs)),this._isBatchDeleteApplied=!1,this.clearSelection();else{if(this._confirmDialog.find(".e-content").text()!=this.localizedLabels.BatchSaveConfirm&&this._confirmDialog.find(".e-content").text()!=this.localizedLabels.ConfirmDelete&&this._confirmDialog.find(".e-content").text()!=this.localizedLabels.CancelEdit)switch(this._requestArgs.requestType){case"grouping":this.model.groupSettings.groupedColumns.pop();break;case"ungrouping":this.model.groupSettings.groupedColumns.push(this._requestArgs.columnName);break;case"sorting":this._cSortedDirection=this._cSortedColumn=null;break;case"filtering":this.model.filterSettings.filteredColumns.reverse().splice(0,this._requestArgs.currentFilterObject);this.model.filterSettings.filteredColumns.reverse();break;case"paging":this._currentPage(this._requestArgs.previousPage);this.getPager().ejPager("model.currentPage",this._requestArgs.previousPage)}this._confirmedValue=!1}this._requestArgs=null;this._confirmDialog.ejDialog("close")},_batchCellValidation:function(n,i){var f=this.getRowByIndex(n),r,u;if(this.model.editSettings.editMode=="batch"&&this.model.isEdit&&f.hasClass("e-insertedrow"))for(r=0;r<this._validatedColumns.length;r++){if(u=this.getColumnIndexByField(this._validatedColumns[r]),!this.editFormValidate()||n!=u&&!t.isNullOrUndefined(i)&&i.closest("tr").hasClass("e-insertedrow"))return!0;this.editCell(n,this.model.columns[u].field)}},_saveCellHandler:function(t){var i=n(t.target),r;t.stopPropagation();r=this.model.editSettings.rowPosition=="top"||this._gridRows==null?0:this._gridRows.length-1;i.closest(".e-popup").length==0&&i.closest(".e-rowcell").find("#"+this._id+"EditForm").length==0&&(n(this.getRows()).hasClass("e-insertedrow")&&this._batchCellValidation(r,i),this.saveCell())},initValidator:function(){for(var r=this,i=this.model.scrollSettings.frozenColumns>0||this.model.editSettings.showAddNewRow?this.element.find(".gridform"):n("#"+this._id+"EditForm"),t=0;t<i.length;t++)i.eq(t).validate({ignore:".e-hide",errorClass:"e-field-validation-error",errorElement:"div",wrapper:"div",errorPlacement:function(n,t){r._renderValidator(n,t)}})},_renderValidator:function(i,r){var y,d,p,w,b,tt,it,rt;if(r.is(":hidden")&&(r=r.siblings("input:visible")),r.length){var f=r.closest(".e-rowcell"),e=n(i).addClass("e-error"),l=t.buildTag("div.e-errortail e-toparrow"),v=this.model.isResponsive||this.model.allowScrolling,u=t.isNullOrUndefined(this.getContent().data("ejScroller"))?null:this.getScrollObject(),k=0;f=f.length?f:f=r.closest("td");f.find(".e-error").remove();r.parent().hasClass("e-in-wrap")?e.insertAfter(r.closest(".e-widget")):e.insertAfter(r);y=this.model.scrollSettings.frozenRows>0&&this._currentTrIndex>=this.model.scrollSettings.frozenRows?!0:!1;d=y?"append":"prepend";e[d](l);v&&!t.isNullOrUndefined(u)&&(u._hScrollbar||u._vScrollbar)&&(f.addClass("e-validError"),k=u._hScrollbar?u._hScrollbar.element[0].offsetTop:0);var o=f[0].offsetTop+f[0].offsetHeight+i[0].offsetHeight,a=!1,g=u&&u._hScrollbar?u._hScrollbar.model.height:0;if((u&&u.isHScroll()&&o>k||o>this.getContent()[0].offsetTop+this.getContent().find(".e-content").height())&&(a=!0),v&&!t.isNullOrUndefined(u)&&(u._hScrollbar||u._vScrollbar)||(p=i[0].getBoundingClientRect(),w=p?p.width:i.width(),w<f.width()?i.width(w):i.width(f.width()),r.closest(".e-validError").removeClass("e-validError")),this.model.enableRTL?this.model.editSettings.editMode!="dialog"&&e.offset({top:r.offset().top+r.height()}):this.model.editSettings.editMode!="dialog"&&e.offset({left:r.offset().left,top:r.offset().top+r.height()}),this.model.scrollSettings.frozenRows<=0&&n.inArray(this.model.editSettings.editMode,["externalform","externalformtemplate","dialog","dialogtemplate"])==-1){var nt=this.getContent(),h=nt.find(".e-content"),c=h.height(),s=nt[0].offsetTop;if(a&&u!=null&&u._vScrollbar&&this.model.scrollSettings.frozenColumns){var et=u._vScrollbar.model.value-(o-(s+h[0].scrollHeight)),ut=s+h[0].scrollHeight,ft=s+c;(!this.model.scrollSettings.frozenColumns&&o>ut||this.model.scrollSettings.frozenColumns&&o>ft)&&(u._vScrollbar.model.maximum+=o-(s+c),u._vScrollbar.refresh(!0));this.model.scrollSettings.frozenColumns&&(b=this.getContent().find(".e-movablecontent"),b.height(b[0].scrollHeight));u.scrollY(r.offset().top-s+h[0].scrollTop)}else a&&v&&u!=null&&(u.isVScroll()?u.isVScroll()&&(u.refresh(),this._showHideScroller(),u._vScroll&&(it=u._vScrollbar.model.value+(o-(s+c+g-g)),u.scrollY(it))):(tt=o-(s+c),h.height(c+tt)))}else y&&(a?(rt=e.css("top"),l.addClass("e-bottomarrow"),e.css({bottom:rt,top:"auto"})):l.prependTo(l.parent()));e.show("slow")}},setValidation:function(){for(var n=0;n<this.model.columns.length;n++)t.isNullOrUndefined(this.model.columns[n].validationRules)||this.setValidationToField(this.model.columns[n].field,this.model.columns[n].validationRules)},setValidationToField:function(i,r){var f=i,u,s=this.getColumnByField(i),e,h,o;t.isNullOrUndefined(i)||(f=f.replace(/[^a-z0-9\s_]/gi,""));e=this.model.editSettings.editMode=="batch"?this.element.find("#"+this._id+"EditForm"):this.model.editSettings.showAddNewRow?n(this.getRows()).hasClass("e-editedrow")?this.element.find(".e-editedrow .gridform"):this.element.find(".e-addedrow .gridform"):this.element.find(".gridform");u=/^[a-zA-Z0-9- ]*$/.test(i)?e.find("[name="+f+"]"):e.find("#"+this._id+f);t.isNullOrUndefined(u.attr("id"))||u.attr("id").indexOf("hidden")==-1||(u=e.find("#"+this._id+f));u.length==0&&(u=e.find("#"+f));r.regex&&(r[i+"regex"]=r.regex,delete r.regex,n.validator.addMethod(f+"regex",function(n,t,i){var r=i instanceof RegExp?i:new RegExp(i);return r.test(n)},t.getObject("messages.regex",r)||s.headerText+" should match the given pattern"));u.attr("name")||u.attr("name",i);u.rules("add",r);h=n("#"+this._id+"EditForm").validate();h.settings.messages[i]=h.settings.messages[i]||{};t.isNullOrUndefined(r.required)||(o=t.isNullOrUndefined(r.messages&&r.messages.required)?n.validator.messages.required:r.messages.required,o.indexOf("This field")==0&&(o=o.replace("This field",s.headerText)),h.settings.messages[i].required=o,u.hasClass("e-datepicker e-js")&&(t.isNullOrUndefined(s.editParams)||t.isNullOrUndefined(s.editParams.watermarkText))&&u.ejDatePicker({watermarkText:""}))},_renderConfirmDialog:function(){var r=t.buildTag("div.e-content",this.localizedLabels.BatchSaveConfirm),i=t.buildTag("span.e-buttons",'<input type="button" class="e-flat e-btnsub" id='+this._id+'ConfirmDialogOK value="'+this._getDeprecatedLocalizedLabel("OKButton")+"\" /> <input type='button' class='e-flat e-btncan' id="+this._id+"ConfirmDialogCancel value='"+this.localizedLabels.CancelButton+"' />");this._confirmDialog=t.buildTag("div#"+this._id+"ConfirmDialog",{float:"left"},{overflow:"hidden"});this._confirmDialog.append(r).append(i);this.element.append(this._confirmDialog);i.find("input").ejButton({cssClass:this.model.cssClass,showRoundedCorner:!0,size:"mini",click:n.proxy(this._triggerConfirm,this)});this._renderFDialog(this._id+"ConfirmDialog");this._confirmDialog.ejDialog({showOnInit:!1,width:"auto",minWidth:0,minHeight:0,enableModal:!0})},_unboundClickHandler:function(i){var r=n(i.target).closest("button"),e,o,u,s,h,f,c,l;if((!r.hasClass("e-button")||!(r.hasClass("e-disable")||r.prop("disabled")))&&r.closest(".e-grid").attr("id")===this._id&&(e=0,o={},!n(i.target).hasClass("e-unboundcelldiv"))){if(u=r.hasClass("e-savebutton")?this.getIndexByRow(n(".e-editedrow")):this.getIndexByRow(r.closest("tr")),this.model.isEdit&&(!this._isLocalData||this._isRemoteSaveAdaptor)&&r.hasClass("e-editbutton")){this._unboundRow=r.closest("tr");return}if(s=this._currentJsonData[u],h=n(r).ejButton("instance"),(this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlinetemplate")&&(e=n("#"+this._id).find(".e-editedrow").length),!this.model.allowSelection||this._enableCheckSelect||this.model.isEdit||this.selectRows(this.getIndexByRow(r.closest("tr"))-e),r.hasClass("e-cancelbutton")&&(this.model.isEdit=!1),n.isFunction(n.fn.ejDatePicker)&&n("#"+this._id+"EditForm").find(".e-datepicker.e-js").ejDatePicker("hide"),r.hasClass("e-editbutton")&&this.model.editSettings.editMode!="batch")this.model.isEdit&&this.cancelEdit(),f=this.getRowByIndex(u),this.startEdit(f);else if(r.hasClass("e-deletebutton")){if(f=this.getRowByIndex(u),this.model.editSettings.showDeleteConfirmDialog&&!this._isUnboundColumn){this._toolbarOperation(this._id+"_delete");return}this.deleteRow(f)}else r.hasClass("e-savebutton")?(this.endEdit(),s=this._currentJsonData[u]):r.hasClass("e-cancelbutton")&&this.cancelEdit();o={rowIndex:u,data:s,buttonModel:h.model,commandType:r.val()};t.raiseWebFormsServerEvents&&(c={model:this.model,originalEventType:"commandButtonClick"},l=o,t.isNullOrUndefined(this.model.serverEvents)||n.inArray("commandButtonClick",this.model.serverEvents)==-1||t.raiseWebFormsServerEvents("commandButtonClick",c,l))}},addRecord:function(n,i){var u,r;this.model.editSettings.allowAdding&&this.element.find(".e-gridcontent .gridform").length==0&&(n?((this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate")&&(u=t.buildTag("tr.e-addedrow"),this.getContentTable().find("tbody").first().prepend(u)),r={data:n},r.action="add",r.selectedRow=this._selectedRow(),this._cAddedRecord=n,r.requestType=t.Grid.Actions.Save,this._updateAction(r),r.selectedRow!=-1&&this.selectRows(r.selectedRow+1),this._isUnboundColumn&&this._refreshUnboundTemplate(this.getContentTable()),i||(this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate")&&this.model.allowPaging&&this.model.pageSettings.pageSize<this.model.currentViewData.length&&this.model.groupSettings.groupedColumns.length==0&&!this.model.editSettings.showAddNewRow&&this.getContentTable().get(0).lastChild.removeChild(this.getContentTable().get(0).lastChild.lastChild)):this._startAdd())},updateRecord:function(n,t){this._updateDeleteRecord(n,t,"update")},_updateDeleteRecord:function(i,r,u){var d=t.DataManager(this._currentJsonData),h=[],o,e,a,s,y,c,l,k,v,f;if(t.isNullOrUndefined(i)||(h=d.executeLocal(t.Query().where(i,t.FilterOperators.equal,t.getObject(i,r)))),h.length){if(o=n.inArray(h[0],this._currentJsonData),s={data:r,rowData:r,requestType:t.Grid.Actions.Save,previousData:h[0],rowIndex:o},y=this._getForeignKeyData(s.data),t.isNullOrUndefined(y)||(s.foreignKeyData=y),n(document.activeElement).closest("td.e-checkcell")&&(s.checkboxTarget=document.activeElement),this._trigger("actionBegin",s),o!=-1){if(e=this.getRowByIndex(o),u=="update"){if(t.copyObject(h[0],r),this.model.scrollSettings.frozenColumns){c=n(n.render[this._id+"_JSONFrozenTemplate"](h))[0];l=n(n.render[this._id+"_JSONTemplate"](h))[0];e.hasClass("e-alt_row")?e.find("td").hasClass("e-lastrowcell")?n(c).find("td").addClass("e-lastrowcell")&&n(c).addClass("e-alt_row"):n(c).addClass("e-alt_row"):n(c).removeClass("e-alt_row");e.hasClass("e-alt_row")?e.find("td").hasClass("e-lastrowcell")?n(l).find("td").addClass("e-lastrowcell")&&n(l).addClass("e-alt_row"):n(l).addClass("e-alt_row"):n(l).removeClass("e-alt_row");e[0].replaceWith(c);e[1].replaceWith(l);e[0].replaceWith(c);e[1].replaceWith(l);var p=this.getContentTable().get(0).rows,w=this.getContentTable().get(1).rows,b=0;this.model.scrollSettings.frozenRows&&n(p[this.model.scrollSettings.frozenRows-1].cells).add(w[this.model.scrollSettings.frozenRows-1].cells).addClass("e-frozeny").parent().addClass("e-frozenrow");var g=p[o].getClientRects()[0].height,nt=w[o].getClientRects()[0].height,b=t.max([g,nt]);n(p[o]).height(b);n(w[o]).height(b)}else a=n(n.render[this._id+"_JSONTemplate"](h)),e.hasClass("e-alt_row")?e.find("td").hasClass("e-lastrowcell")?a.find("td").addClass("e-lastrowcell")&&a.addClass("e-alt_row"):a.addClass("e-alt_row"):a.removeClass("e-alt_row"),e.replaceWith(a),this.model.scrollSettings.frozenRows&&(k=this.getRows(),n(k[this.model.scrollSettings.frozenRows-1].cells).addClass("e-frozeny").parent().addClass("e-frozenrow"));this._isUnboundColumn&&this._refreshUnboundTemplate(this.getContentTable());this.model.editSettings.editMode=="batch"?this.batchChanges.changed.push(h[0]):(v=this._dataManager[u](i,r),f=this,v&&n.isFunction(v.promise)?(v.done(function(){f.model.editSettings.editMode!="batch"&&(f.model.sortSettings.sortedColumns.length||f.model.summaryRows.length>0||f.model.groupSettings.groupedColumns.length||!t.isNullOrUndefined(f._searchCount)||f.filterColumnCollection.length)?f._processBindings(s):(f.model.scrollSettings.frozenColumns?(f._rowEventTrigger(c,r),f._rowEventTrigger(l,r)):f._rowEventTrigger(a,r),f._trigger("actionComplete",s))}),v.fail(function(){f._trigger("actionFailure",s)})):f.model.editSettings.editMode!="batch"&&(f.model.sortSettings.sortedColumns.length||f.model.summaryRows.length>0||f.model.groupSettings.groupedColumns.length||!t.isNullOrUndefined(f._searchCount)||f.filterColumnCollection.length)?f._processBindings(s):(f.model.scrollSettings.frozenColumns?(f._rowEventTrigger(c,r),f._rowEventTrigger(l,r)):f._rowEventTrigger(a,r),f._trigger("actionComplete",s)));this._isMapSelection&&(this._selectionByGrid=!0,this.multiSelectCtrlRequest=!0,r[this._selectionMapColumn]?this.selectRows(o):this.clearSelection(o),this._selectionByGrid=!1)}else n.inArray(o,this.selectedRowsIndexes)==-1&&this.selectedRowsIndexes.push(o),this.deleteRow(e);this.model.editSettings.editMode=="batch"&&(this.batchSave(),this._confirmedValue=!0)}}else this.model.editSettings.editMode=="batch"?(this.batchChanges[u=="update"?"changed":"deleted"].push(r),this.batchSave(),this._confirmedValue=!0):this._dataManager[u](i,r)},deleteRecord:function(n,t){this._updateDeleteRecord(n,t,"remove")}}}(jQuery,Syncfusion),function(n,t){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.sort={_addSortElementToColumn:function(i,r){var a=t.DataManager(this.model.columns).executeLocal(t.Query().where("field","equal",i)),s,c,h,l;if(c=a.length>1&&!t.isNullOrUndefined(this._$curSElementTarget)?this.getColumnByHeaderText(this._$curSElementTarget.text()):this.getColumnByField(i),!t.isNullOrUndefined(c)){var v=n.inArray(c,this.model.columns),y=this.getsortColumnByField(i),p=n.inArray(y,this.model.sortSettings.sortedColumns),u=this.getHeaderTable().find("thead tr:not('.e-stackedHeaderRow')").find(".e-headercell").not(".e-detailheadercell").eq(v),f=u.find(".e-headercelldiv"),e=u.find(".e-filterset"),o=u.find(".e-gridgroupbutton");if(e.length&&o.length?this.model.enableRTL?f.addClass("e-headercelldivsortgroupfilter"):(u.addClass("e-headercellsortgroupfilter"),e.addClass("e-sortfiltergroupicon"),o.addClass("e-togglesortgroupfilter")):e.length?this.model.enableRTL?f.addClass("e-headercellsortfilter"):(u.addClass("e-headercellsortfilter"),e.addClass("e-sortfiltericon")):o.length?(this.model.enableRTL?f.addClass("e-headercellsortfilter"):(u.addClass("e-headercellsortfilter"),o.addClass("e-sortgroupicon")),this.model.enableRTL&&!e.length&&o.addClass("e-rtltoggle")):u.addClass("e-headercellsort"),r=t.isNullOrUndefined(r)?"ascending":r.toLowerCase(),u.find(".e-ascending,.e-descending").remove(),this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length!=0&&this.element.find(".e-groupdroparea").find("div[data-ej-mappingname='"+i+"']").find(".e-ascending,.e-descending").not(".e-ungroupbutton").remove(),s=r!="descending"?"e-rarrowup-2x":"e-rarrowdown-2x",h=1,this.model.allowSorting&&this.model.allowMultiSorting&&this.model.sortSettings.sortedColumns.length>1){for(l=1;l<=p;l++)h=h+1;f.css("text-align")=="right"?(f.prepend(this._createSortNumber(h,f).addClass("e-sortnumber")),u.append(this._createSortElement().addClass("e-"+(r||"ascending")+" "+s))):(f.prepend(this._createSortNumber(h,f).addClass("e-sortnumber")),u.append(this._createSortElement().addClass("e-"+(r||"ascending")+" "+s)))}else u.append(this._createSortElement().addClass("e-"+(r||"ascending")+" "+s));this.model.enableRTL?e.length&&o.length?u.find(".e-ascending,.e-descending").addClass("e-rtlsortfiltertoggle"):e.length||o.length?u.find(".e-ascending,.e-descending").addClass("e-rtlgrouporfilter"):u.find(".e-ascending,.e-descending").addClass("e-rtlsortadjust"):this.model.enableRTL||e.length||o.length||u.find(".e-ascending,.e-descending").addClass("e-sortadjust");this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length!=0&&this.element.find(".e-groupdroparea").find("div[data-ej-mappingname='"+i+"']").append(this._createSortElement().addClass("e-"+(r||"ascending")+" "+s));f.parent().attr("aria-sort",r)}},_removeSortElementFromColumn:function(t){var r=this.getColumnByField(t),u=n.inArray(r,this.model.columns),i=this.getHeaderTable().find("thead").find(".e-headercell").not(".e-detailheadercell").eq(u).find(".e-headercelldiv");i.find(".e-ascending,.e-descending").remove();i.parent().prop("aria-sort",!1)},_sortCompleteAction:function(i){var e,o,r=this.getHeaderTable().find(".e-columnheader"),s,h,u,f;for(o=this.getHeaderTable().find(".e-columnheader").find(".e-headercelldiv").find(".e-ascending,.e-descending,.e-number").parent().attr("data-ej-mappingname"),r.find(".e-headercell").find(".e-ascending,.e-descending,.e-number").remove(),s=r.find(".e-filterset"),h=r.find(".e-gridgroupbutton"),s.length||h.length?(r.find(".e-sortfiltericon").removeClass("e-sortfiltericon"),r.find(".e-headercellsortfilter").removeClass("e-headercellsortfilter"),r.find(".e-sortgroupicon").removeClass("e-sortgroupicon"),r.find(".e-headercellsortgroupfilter").removeClass("e-headercellsortgroupfilter"),r.find(".e-headercelldivsortgroupfilter").removeClass("e-headercelldivsortgroupfilter"),r.find(".e-sortfiltergroupicon").removeClass("e-sortfiltergroupicon"),r.find(".e-togglesortgroupfilter").removeClass("e-togglesortgroupfilter")):r.find(".e-headercellsort").removeClass("e-headercellsort"),n(this.getHeaderTable().find(".e-columnheader").find(".e-headercell:not(.e-stackedHeaderCell,.e-detailheadercell,.e-hide)")[this.getColumnIndexByField(o)]).removeAttr("aria-sort"),this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length!=0&&this.element.find(".e-groupdroparea").find("div[data-ej-mappingname='"+i.columnName+"']").find(".e-ascending,.e-descending,.e-number").not(".e-ungroupbutton").remove(),this.getHeaderTable().find("[aria-sort]").prop("aria-sort",!1),u=0;u<this.model.sortSettings.sortedColumns.length;u++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[u].field,this.model.sortSettings.sortedColumns[u].direction);this.model.groupSettings.groupedColumns.length&&this._$curSElementTarget!=null&&(f=this._checkEinGroupDrop(n.trim(this._$curSElementTarget.attr("data-ej-mappingname"))),t.isNullOrUndefined(f)||(e=(t.isNullOrUndefined(i.columnSortDirection)||i.columnSortDirection==""?this.getsortColumnByField(this._$curSElementTarget.attr("data-ej-mappingname")).direction.toLowerCase():i.columnSortDirection)=="ascending"?"e-rarrowup-2x":"e-rarrowdown-2x",f.find(".e-ascending,.e-descending").removeClass().addClass("e-icon e-"+(t.isNullOrUndefined(i.columnSortDirection)||i.columnSortDirection==""?this.getsortColumnByField(this._$curSElementTarget.attr("data-ej-mappingname")).direction.toLowerCase():i.columnSortDirection)+" "+e)));this.multiSortRequest=!1;(!this.model.allowScrolling||!this.initialRender||this.model.scrollSettings.frozenRows>0||this.model.scrollSettings.frozenColumns>0)&&!this.model.allowResizeToFit&&this.setWidthToColumns()},removeSortedColumns:function(t){if(n.isArray(t))for(var i=0;i<t.length;i++)this._removeSortedColumnFromCollection(t[i]);else this._removeSortedColumnFromCollection(t);this.multiSortRequest=!0;this.sortColumn(null,null)},_removeSortedColumnFromCollection:function(n){for(var t=0;t<this.model.sortSettings.sortedColumns.length;t++)if(this.model.sortSettings.sortedColumns[t].field==n){this.model.sortSettings.sortedColumns.splice(t,1);break}},clearSorting:function(){var t=this;this.model.sortSettings.sortedColumns=n.grep(this.model.sortSettings.sortedColumns,function(i){return n.inArray(i.field,t.model.groupSettings.groupedColumns)!=-1?!0:!1});this._$prevSElementTarget=null;this._$curSElementTarget=null;this.refreshContent()},sortColumn:function(i,r){var u,f,e;this.model.allowSorting&&n.inArray(i,this._disabledSortableColumns)==-1&&(i==null||i.length!=0)&&(u={},this.multiSortRequest||(f=this,this.model.sortSettings.sortedColumns=n.grep(this.model.sortSettings.sortedColumns,function(t){return n.inArray(t.field,f.model.groupSettings.groupedColumns)!=-1?!0:!1})),u.requestType=t.Grid.Actions.Sorting,this._cSortedColumn=u.columnName=i,this._cSortedDirection=u.columnSortDirection=t.isNullOrUndefined(r)?t.sortOrder.Ascending:r.toLowerCase(),this._cSortedColumn!==null&&(this._removeSortedColumnFromCollection(i),this.model.sortSettings.sortedColumns.push({field:this._cSortedColumn,direction:this._cSortedDirection})),e=this._processBindings(u),e&&(this._cSortedDirection=this._cSortedColumn=null),this._primaryKeyValues=[])},_createSortElement:function(){return t.buildTag("span.e-icon","&#160;")},_renderMultiTouchDialog:function(){var n,r,i;this._customPop=t.buildTag("div.e-gridpopup","",{display:"none"});n=t.buildTag("div.e-content");r=t.buildTag("div.e-downtail e-tail");this.model.allowMultiSorting&&(i=t.buildTag("span.e-sortdirect e-icon"),n.append(i));this.model.selectionType=="multiple"&&(i=t.buildTag("span.e-rowselect e-icon"),n.append(i));this._customPop.append(n);this._customPop.append(r);this.element.append(this._customPop)}}}(jQuery,Syncfusion),function($,ej,undefined){ej.gridFeatures=ej.gridFeatures||{};ej.gridFeatures.filter={getFilterBar:function(){return this._gridFilterBar},setGridFilterBar:function(n){this._gridFilterBar=n},filterColumn:function(n,t,i,r,u,f){var e,v,s,h,w,ut,l,o,b,ft,p,d,it,g,y,nt;if(this.model.allowFiltering)for(e=typeof n=="object"?this.getColumnByField(n[0].field):this.getColumnByField(n),(ej.isNullOrUndefined(e)||ej.isNullOrUndefined(e.filterBarTemplate)||e.type!="boolean"||i!="true")&&i!="false"||(i=JSON.parse(i)),e&&ej.isNullOrUndefined(e.format)?e.type=="date"?v=ej.preferredCulture().calendar.patterns.d:e.type=="datetime"&&(v=ej.preferredCulture().calendar.patterns.f):e&&(v=e.format.replace("{0:","").replace("}","")),!ej.isNullOrUndefined(e)&&!ej.isNullOrUndefined(e.filterBarTemplate)&&(e.type=="date"||e.type=="datetime")&&i.length>0&&(i=ej.parseDate(i,v,this.model.locale)),s=[],typeof n=="object"?s=n:s.push({field:n,operator:t,value:i,predicate:r,matchcase:u,actualFilterValue:f}),h=0;h<s.length;h++){var n=s[h].field,t=s[h].operator,i=s[h].value,r=s[h].predicate,u=ej.isNullOrUndefined(s[h].matchcase)?!1:s[h].matchcase,f=s[h].actualFilterValue,c={};for(c.requestType=ej.Grid.Actions.Filtering,c.currentFilterObject=[],this._$curFieldName=n,$.isArray(t)||(t=$.makeArray(t)),$.isArray(i)||(i=$.makeArray(i)),$.isArray(r)||(r=$.makeArray(r)),w=!1,ut=this._filterCollection,this._currentFilterColumn=!ej.isNullOrUndefined(e)&&!ej.isNullOrUndefined(e.foreignKeyValue)&&this._$curFilterValue!=e.foreignKeyValue&&ej.isNullOrUndefined(e.filterBarTemplate)?this._currentFilterColumn:this.getColumnByField(n),l=0;l<t.length;l++){if(o={field:n,operator:t[l],value:i[l],matchcase:u,predicate:r[l],actualFilterValue:ej.getObject("value",f),actualOperator:ej.getObject("operator",f)},b=ej.getObject("ejpredicate",f),b&&(o=b),this._$colType!=null&&this.model.filterSettings.filterType!="filterbar"||ej.isNullOrUndefined(this._currentFilterColumn)||(this._$colType=this._currentFilterColumn.type),this.model.filterSettings.filteredColumns.length==0&&o.value!=="")(this._$colType=="date"||this._$colType=="datetime")&&this.model.filterSettings.filterType!=="excel"&&(t=="equal"||t=="notequal")&&typeof o.value!="string"?this._setDateFilters(o):this.model.filterSettings.filteredColumns.push(o);else{if(ft=this,!w){var et=ej.DataManager(this.model.filterSettings.filteredColumns),ot=(new ej.Query).where("field",ej.FilterOperators.equal,o.field),k=[];for((!ej.isNullOrUndefined(e.filterType)&&e.filterType!="excel"||ej.isNullOrUndefined(e.filterType)&&this.model.filterSettings.filterType!="excel"||o.value=="")&&(k=et.executeLocal(ot)),p=0;p<k.length;p++)d=$.inArray(k[p],this.model.filterSettings.filteredColumns),d!=-1&&this.model.filterSettings.filteredColumns.splice(d,1)}o.value!==""&&((this._$colType=="date"||this._$colType=="datetime")&&this.model.filterSettings.filterType!=="excel"&&(t=="equal"||t=="notequal")&&typeof o.value!="string"?this._setDateFilters(o):this.model.filterSettings.filteredColumns.push(o))}w=!0;c.currentFilterObject.push(o)}if(c.filterCollection=this.model.filterSettings.filteredColumns,c.currentFilteringColumn=n,it=this._processBindings(c),it&&(this.model.filterSettings.filteredColumns.reverse().splice(0,t.length),this.model.filterSettings.filteredColumns.reverse()),this.model.filterSettings.filterType=="filterbar"){g=null;y=ej.data.operatorSymbols;for(nt in y)if(y[nt]==t[0]){g=nt;break}var tt=this._currentFilterColumn,st=!ej.isNullOrUndefined(tt)&&ej.isNullOrUndefined(tt.foreignKeyValue)?n:n+"_"+tt.foreignKeyValue,a=this.getHeaderTable().find("#"+st.replace(/[^a-z0-9|s\_]/gi,"")+"_filterBarcell"),rt=/[<=|>=|<|>]+/,ht=!ej.isNullOrUndefined(y[a.val().match(rt)])&&y[a.val().match(rt)][0]==g;a.val()!=""&&(a.val()==i&&ht||this._fltrBarcell)||(i[0]instanceof Date?this._setFilterbarValues(a,ej.format(i[0],v,this.model.locale),t[0]):this._setFilterbarValues(a,i[0],t[0]),this._currentFilterbarValue=i,this.filterStatusMsg="",this._showFilterMsg())}ej.isNullOrUndefined(e)||ej.isNullOrUndefined(e.filterBarTemplate)||(this.filterStatusMsg="",this._currentFilterbarValue=c.currentFilterObject[0].value,this._oldFilterColumn!=e&&this.filterColumnCollection.length>0&&$.inArray(e,this.filterColumnCollection)==-1&&this.filterColumnCollection.push(e),this._oldFilterColumn=this._currentFilterColumn=e,this._showFilterMsg());this._fltrBarcell=!1}},search:function(n){var t={};$("#"+this._id+"_search").find("input").val()!=n;$("#"+this._id+"_search").find("input").val(n);t.requestType=ej.Grid.Actions.Search;t.keyValue=n;this.model.searchSettings.fields=this.model.searchSettings.fields.length!=0?this.model.searchSettings.fields:this.getColumnFieldNames();(n!=""||this.model.searchSettings.key!="")&&(this.model.searchSettings.key=n.toLowerCase()==this.localizedLabels.True.toLowerCase()?"true":n.toLowerCase()==this.localizedLabels.False.toLowerCase()?"false":n,this._processBindings(t));this._primaryKeyValues=[]},_filterBarHandler:function(n){var f=n.keyCode,i=$(n.target),u,r,t;if(i.closest(".e-grid").attr("id")===this._id&&(this.model.filterSettings.filterBarMode=="immediate"||f==13)&&f!=9){for(i=$(n.target),this.filterStatusMsg="",u=i.prop("id").replace("_filterBarcell",""),t=0;t<this.model.columns.length;t++)if(ej.isNullOrUndefined(this.model.columns[t].foreignKeyValue)||u.indexOf("_"+this.model.columns[t].foreignKeyValue)==-1){if(this.model.columns[t].field.replace(/[^a-z0-9|s\_]/gi,"")==u){r=this.model.columns[t];break}}else{r=this.model.columns[t];break}if(r==null)return;if(this._currentFilterColumn=r,this._$curFieldName=r.field,this._$curFilterValue=r.foreignKeyValue,this._currentFilterColumn!=this._oldFilterColumn&&(this.filterValueOldLength=0),this._currentFilterbarValue=i.val().toLowerCase()==this.localizedLabels.True.toLowerCase()?"true":i.val().toLowerCase()==this.localizedLabels.False.toLowerCase()?"false":i.val(),this.filterValueCurrentLength=this._currentFilterbarValue.length,(this.filterValueCurrentLength==0&&this.filterValueOldLength==0||this._currentFilterbarValue==this.OldfilterValue)&&this._currentFilterColumn==this._oldFilterColumn&&!this.model.scrollSettings.enableVirtualization){this._showFilterMsg();return}if(this._skipFilterProcess=this._checkForSkipInput(),this._skipFilterProcess)if(this._currentFilterColumn.type=="string")this.filterStatusMsg="Invalid Filter Data",this._showFilterMsg();else{this._skipFilterProcess=!1;this.model.scrollSettings.enableVirtualization||this._showFilterMsg();return}else this._processFilter(n)}},_renderResponsiveFilter:function(){for(var i,r,n=ej.buildTag("div#"+this._id+"responsiveFilter.e-resFilterDiv","",{width:"100%",padding:"0px"}),e=$(window).height()+1,c=e*(8/100),v=this.element.height()>e?$(window).width()+16.5:$(window).width(),o=ej.buildTag("div.columnDiv","",{width:"100%"}),t=0;t<this.model.columns.length;t++)i=ej.buildTag("div.e-responsivefilterColDiv","",{width:"100%"},{"data-ej-mappingname":this.model.columns[t].field}),r=ej.buildTag("span",this.model.columns[t].headerText,{"margin-left":"4%"}),i.append(r),o.append(i);n.append(o);this.element.append(n);var u=this,y=this.element.outerWidth(),f=ej.buildTag("div.e-resFilterDialogHeaderDiv","",{height:c}),r=ej.buildTag("div.e-labelRes","<span>Filter<\/span>"),s=ej.buildTag("div.e-resFilterleftIcon","",{"margin-top":"3%"}),l=ej.buildTag("span.e-icon e-responsiveFilterClear e-resIcon","",{"font-size":"23px"}),h=ej.buildTag("div.e-resFIlterRigthIcon","",{float:"right","margin-top":"3%"},{closeDialogue:"responsiveFilter",gridEle:!0}),a=ej.buildTag("span.e-icon e-responisveClose e-resIcon","",{"font-size":"23px"},{closeDialogue:"responsiveFilter",gridEle:!0});h.click(function(){$("#"+u._id+"responsiveFilter").css("display","none");u.element.css("display","block")});s.click(function(){$("#"+u._id+"responsiveFilter").find(".e-responsivefilterColDiv").find(".e-filternone").click()});f.append(s.append(l));f.append(r).append(h.append(a));n.prepend(f);n.insertAfter(this.element);n.css("display","none");this._on($("#"+this._id+"responsiveFilter"),"click",".e-responsivefilterColDiv",$.proxy(this._mouseClickHandler,this))},_closeDivIcon:function(n){var i=$(n.target),t;ej.isNullOrUndefined(i.attr("closeDialogue"))||(t=$("#"+i.attr("closeDialogue")),ej.isNullOrUndefined(t.data("ejDialog"))?t.css("display","none"):t.ejDialog("close"));ej.isNullOrUndefined(i.attr("gridEle"))||this.element.css("display","block");ej.isNullOrUndefined(i.attr("openDialogue"))||(this.model.enableResponsiveRow||i.attr("closeDialogue").indexOf("Custom")!=-1?(t=$("#"+i.attr("openDialogue")),ej.isNullOrUndefined(t.data("ejDialog"))?t.css("display","block"):t.ejDialog("open")):this.element.css("display","block"))},_setResponsiveFilterIcon:function(){var t=$("#"+this._id+"responsiveFilter").find(".columnDiv"),i=this,n;for(t.find(".e-filtericon").remove(),n=0;n<this.model.filterSettings.filteredColumns.length;n++){var r=this.model.filterSettings.filteredColumns[n],u=t.find(".e-responsivefilterColDiv[data-ej-mappingname="+r.field+"]"),f=ej.buildTag("div.e-filtericon e-icon e-resIcon e-filterset e-filternone e-filterreset","",{float:"right",height:"22px",width:"21px","font-size":"20px","margin-right":"3%","margin-top":"2%"}),e=ej.buildTag("span.e-filtericon e-icon e-resIcon e-filterset e-filternone","",{},{colType:r.type});u.find(".e-filternone").remove();u.append(f);e.click(function(n){var t=n.target;i._$colType=t.attr("colType");i._fltrClrHandler();t.remove()})}},_renderExcelFilter:function(){var n=this.model.filterSettings.filteredColumns.length!=0?this.model.filterSettings.filteredColumns[0].field:null,t={instance:this,showSortOptions:this.model.allowSorting,allowFormatFiltering:this.model.filterSettings.allowFormatFiltering,allowCaseSensitive:this.model.filterSettings.enableCaseSensitivity,allowAccent:this.model.filterSettings.ignoreAccent,maxFilterLimit:this.model.filterSettings.maxFilterChoices,interDeterminateState:this.model.filterSettings.enableInterDeterminateState,enableComplexBlankFilter:this.model.filterSettings.enableComplexBlankFilter,blankValue:this.model.filterSettings.blankValue,filterHandler:ej.proxy(this._filterHandler,this),initFilterCol:n,actionBegin:"actionBegin",actionComplete:"actionComplete"};this._excelFilter=new ej.excelFilter(t);$.extend(this._excelFilter,this.model.filterSettings)},_filterHandler:function(n){var r={},o,s,h,u,f,i,t,e,c;if(r.requestType=n.action=="sorting"?n.action:"filtering",s=this.model.filterSettings.filteredColumns,n.action=="filtering"){for(o=ej.DataManager(this.model.filterSettings.filteredColumns),h=(new ej.Query).where("field",ej.FilterOperators.equal,n.fieldName),u=o.executeLocal(h),t=0;t<u.length;t++)f=$.inArray(u[t],this.model.filterSettings.filteredColumns),f!=-1&&this.model.filterSettings.filteredColumns.splice(f,1);ej.merge(this.model.filterSettings.filteredColumns,n.filterCollection);n.currentFilterCollection=n.filterCollection}else{if(n.action=="clearfiltering"){for(i=n.filterDetails,delete this._excelFilter._predicates[0][n.fieldName],this.filterColumn(i.field,i.operator,i.value,i.predicate),t=0;t<this.filterColumnCollection.length;t++)this.filterColumnCollection[t].field==i.field&&this.filterColumnCollection.splice(t,1);return}if(n.action=="sorting"){e=n.sortDetails;ej.gridFeatures.sort&&this.sortColumn(e.field,e.direction);this._excelFilter.closeXFDialog();return}}r.currentFilteringColumn=n.fieldName;r.filterCollection=n.filterCollection;r.predicated=n.ejpredicate;c=this._processBindings(r);c&&(this.model.filterSettings.filteredColumns=s)},_renderFiltering:function(){var c=this.getHeaderTable(),v,u,r=ej.buildTag("tr.e-filterbar"),y,l=[],t,n,o,s,i,a,h;for((this.model.detailsTemplate||this.model.childGrid)&&r.append(ej.buildTag("th.e-filterbarcell e-mastercell")),n=0;n<this.model.columns.length;n++){var f=ej.buildTag("th.e-filterbarcell"),e=ej.buildTag("div.e-filterdiv"),p=ej.buildTag("span.e-cancel e-icon e-hide"),o=ej.isNullOrUndefined(this.model.columns[n].field)?this.model.columns[n].field:this.model.columns[n].field.replace(/[^a-z0-9|s_]/gi,""),s=ej.isNullOrUndefined(this.model.columns[n].foreignKeyValue)?o+"_filterBarcell":o+"_"+this.model.columns[n].foreignKeyValue+"_filterBarcell";if(ej.isNullOrUndefined(this.model.columns[n].priority)||$(f).addClass("e-table-priority-"+this.model.columns[n].priority),this.model.columns[n].allowFiltering==!1||ej.isNullOrUndefined(this.model.columns[n].filterBarTemplate)||ej.isNullOrUndefined(this.model.columns[n].field)?(e.addClass("e-fltrinputdiv"),o=this.model.columns[n].field,s=ej.isNullOrUndefined(this.model.columns[n].foreignKeyValue)?o+"_filterBarcell":o+"_"+this.model.columns[n].foreignKeyValue+"_filterBarcell",t=ej.buildTag("input.e-ejinputtext e-filtertext","",{},{title:this.model.columns[n].headerText+this.localizedLabels.FilterbarTitle,type:"search",id:s.replace(/[^a-z0-9|s\_]/gi,"")})):(f.addClass("e-fltrtemp"),e.addClass("e-fltrtempdiv"),ej.isNullOrUndefined(this.model.columns[n].filterBarTemplate.create)?t=ej.buildTag("input e-filtertext","",{},{title:this.model.columns[n].headerText+this.localizedLabels.FilterbarTitle,id:s,"class":"e-filterUi_input e-filtertext e-fltrTemp"}):(v={columnIndex:n,column:this.model.columns[n]},u=this.model.columns[n].filterBarTemplate.create,typeof u=="string"&&(u=ej.util.getObject(u,window)),t=u(v),t=$(t).attr({title:this.model.columns[n].headerText+this.localizedLabels.FilterbarTitle,id:s,"class":"e-filterUi_input e-filtertext e-fltrTemp"}))),this.model.filterSettings.filteredColumns.length>0&&this.model.filterSettings.filterType=="filterbar"&&$.inArray(this.model.columns[n].field,l)==-1)for(i=0;i<this.model.filterSettings.filteredColumns.length;i++)this.getColumnIndexByField(this.model.filterSettings.filteredColumns[i].field)==n&&(this._setFilterbarValues(t,this.model.filterSettings.filteredColumns[i].value,this.model.filterSettings.filteredColumns[i].operator),$.inArray(this.model.filterSettings.filteredColumns[i].field,l)==-1&&l.push(this.model.filterSettings.filteredColumns[i].field));(this.model.columns[n].allowFiltering===!1||this.model.columns[n].field==""||ej.isNullOrUndefined(this.model.columns[n].field))&&(t.attr("disabled",!0).addClass("e-disable"),this._disabledFilterableColumns.push(this.model.columns[n].headerText));this.model.columns[n].visible===!1&&f.addClass("e-hide");ej.isNullOrUndefined(this.model.columns[n].cssClass)||f.addClass(this.model.columns[n].cssClass);this.model.columns[n].allowFiltering==!1||ej.isNullOrUndefined(this.model.columns[n].filterBarTemplate)?e.append(t).append(p):e.append(t);r.append(f.append(e));n==this.model.scrollSettings.frozenColumns-1&&(y=r.clone(),c.find("thead").first().append(y),r.empty())}if(c.find("thead").last().append(r),ej.browserInfo().name=="msie"&&ej.browserInfo().version<10)for(a=c.find("thead").find(".e-ejinputtext.e-filtertext"),h=0;h<a.length;h++)ej.ieClearRemover(a[h]);this.setGridFilterBar(r)},_renderFilterBarTemplate:function(){for(var u,t,i,r,f=!1,n=0;n<this.model.columns.length;n++)if(this.model.columns[n].allowFiltering!=!1&&!ej.isNullOrUndefined(this.model.columns[n].filterBarTemplate)&&!ej.isNullOrUndefined(this.model.columns[n].field)){if(i=this.model.columns[n].filterBarTemplate.read,typeof i=="string"&&(i=ej.util.getObject(i,window)),t=this.model.columns[n].foreignKeyField?{element:this.getHeaderTable().find(".e-filterbar").find(".e-fltrtemp").find("#"+this.model.columns[n].field.replace(/[^a-z0-9|s_]/gi,"")+"_"+this.model.columns[n].foreignKeyValue.replace(/[^a-z0-9|s_]/gi,"")+"_filterBarcell"),columnIndex:n,column:this.model.columns[n]}:{element:this.getHeaderTable().find(".e-filterbar").find(".e-fltrtemp").find("#"+this.model.columns[n].field.replace(/[^a-z0-9|s_]/gi,"")+"_filterBarcell"),columnIndex:n,column:this.model.columns[n]},typeof t.column.filterBarTemplate.read=="string"&&(t.column.filterBarTemplate.read=i),r=this.model.columns[n].filterBarTemplate.write,typeof r=="string"&&(r=ej.util.getObject(r,window)),this.model.filterSettings.filteredColumns.length>0)for(u=0;u<this.model.filterSettings.filteredColumns.length;u++)this.model.columns[n].field==this.model.filterSettings.filteredColumns[u].field&&(t.modelVal=this.model.filterSettings.filteredColumns[u].value);r.call(this,t);f=!0}f&&(this.model.filterSettings.filterBarMode=ej.Grid.FilterBarMode.OnEnter)},_closeFilterDlg:function(){ej.isNullOrUndefined($("#"+this._id+"_"+this._$colType+"Dlg").data("ejDialog"))?$("#"+this._id+"_"+this._$colType+"Dlg").css("display","none"):$("#"+this._id+"_"+this._$colType+"Dlg").ejDialog("close");this._$fDlgIsOpen=!1;this._$menuDlgIsOpen=!1},_filterBarClose:function(n){var t=$(n.target),i;t.closest(".e-grid").attr("id")===this._id&&(n.type=="click"&&t.hasClass("e-cancel")&&(i=t.prev(),i.focus().val(""),i.trigger("keyup"),n.stopPropagation()),n.type=="focusin"&&t.hasClass("e-filtertext")&&(t=$(n.target).next(),this.getFilterBar().find(".e-cancel").addClass("e-hide"),t.removeClass("e-hide")))},_processFilter:function(n){this._alreadyFilterProcessed?(this._stopTimer(),this._startTimer(n)):(this._alreadyFilterProcessed=!0,this._startTimer(n))},_startTimer:function(n){var t=this,i=n.keyCode==13?0:t.model.filterSettings.immediateModeDelay;this._timer=window.setTimeout(function(){t._onTimerTick()},i)},_stopTimer:function(){this._timer!=null&&window.clearTimeout(this._timer)},_onTimerTick:function(){var n,t,i;this.OldfilterValue=this._currentFilterbarValue;this._oldFilterColumn=this._currentFilterColumn;this.filterValueOldLength=this.filterValueCurrentLength;this._findPredicate();var r=this._currentFilterColumn.type=="string"?!1:!0,u=$.extend([],this.model.filterSettings.filteredColumns);for(n=0;n<u.length;n++)this.getHeaderContent().find(".e-filterbar #"+u[n].field.replace(/[^a-z0-9|s\_.]/gi,"")+"_filterBarcell").val()==""&&($.inArray(this.model.filterSettings.filteredColumns[n],this.filterColumnCollection)!=-1&&this.filterColumnCollection.splice(n,1),this.model.filterSettings.filteredColumns.splice(n,1));if(this._currentFilterColumn.type=="date"||this._currentFilterColumn.type=="datetime")for(t=0;t<this.model.filterSettings.filteredColumns.length;t++)this.model.filterSettings.filteredColumns[t].isComplex&&(i=this.model.filterSettings.filteredColumns[t].predicates,this.model.filterSettings.filteredColumns.length==1?this.model.filterSettings.filteredColumns=i:(this.model.filterSettings.filteredColumns[t]=i[0],this.model.filterSettings.filteredColumns.push(i[1])));this._skipFilterProcess?this.filterStatusMsg="Invalid Filter Data":this._currentFilterColumn.foreignKeyValue&&this._currentFilterColumn.dataSource&&this._currentFilterbarValue!=""?this._fltrForeignKeyValue(this._operator,this._currentFilterbarValue,r,this._currentFilterColumn.dataSource,this._currentFilterColumn.foreignKeyField,this._currentFilterColumn.foreignKeyValue,this._currentFilterColumn.type):ej.isNullOrUndefined(this._currentFilterColumn.filterBarTemplate)&&(this._fltrBarcell=!0,this.filterColumn(this._currentFilterColumn.field,this._operator,this._currentFilterbarValue,this._predicate,r));!this.model.scrollSettings.enableVirtualization&&ej.isNullOrUndefined(this._currentFilterColumn.filterBarTemplate)&&this._showFilterMsg();this._stopTimer()},_findPredicate:function(){var u=this._currentFilterbarValue.replace(/ && /i," and ").replace(" || "," or "),t=u.split(" "),n;if(this._predicate="and",t.length!=0)if($.isFunction(ej.Predicate[t[1]])){this._skipFilterProcess=!1;this._predicate=t[1];var i=u.split(" "+t[1]+" "),f=[],r=[];for(n=0;n<i.length;n++)this._validateFilterValue(i[n]),f.push(this._operator),this._currentFilterColumn.type=="number"?r.push(this._currentFilterbarValue):this._currentFilterColumn.type=="string"&&r.push(i[n]);this._currentFilterbarValue=r;this._operator=f}else this._validateFilterValue($.trim(this._currentFilterbarValue));else this._validateFilterValue($.trim(this._currentFilterbarValue))},_validateFilterValue:function(n){var r,t,i,u;switch(this._currentFilterColumn.type){case"number":for(this._operator=ej.FilterOperators.equal,r=[">","<","=","!"],t=0;t<n.length;t++)if(jQuery.inArray(n[t],r)!=-1)break;t!=n.length?(this._getOperator(n.substring(t)),t!=0&&(this._currentFilterbarValue=n.substring(0,t))):ej.isNullOrUndefined(this._currentFilterColumn.filterOperator)||(this._operator=this._currentFilterColumn.filterOperator);this._currentFilterbarValue=this._currentFilterbarValue!=""&&n.length>=1?ej.parseFloat(this._currentFilterbarValue,this.model.locale):n.length>1?ej.parseFloat(n,this.model.locale):n;break;case"date":case"datetime":this._operator=ej.FilterOperators.equal;this._getOperator(n);i=ej.isNullOrUndefined(this._currentFilterColumn.format)?this._currentFilterColumn.type=="date"?ej.preferredCulture().calendar.patterns.d:ej.preferredCulture().calendar.patterns.f:this._currentFilterColumn.format.replace("{0:","").replace("}","");this._currentFilterbarValue!=""&&(u=ej.parseDate(this._currentFilterbarValue,i,this.model.locale),ej.isNullOrUndefined(u)?this.filterStatusMsg="Invalid Filter Data":this._currentFilterbarValue=ej.parseDate(this._currentFilterbarValue,i,this.model.locale));break;case"string":n.charAt(0)=="*"?(this._currentFilterbarValue=this._currentFilterbarValue.slice(1),this._operator=ej.FilterOperators.startsWith):n.charAt(n.length-1)=="%"?(this._currentFilterbarValue=this._currentFilterbarValue.slice(0,-1),this._operator=ej.FilterOperators.startsWith):n.charAt(0)=="%"?(this._currentFilterbarValue=this._currentFilterbarValue.slice(1),this._operator=ej.FilterOperators.endsWith):this._operator=ej.isNullOrUndefined(this._currentFilterColumn.filterOperator)?ej.FilterOperators.startsWith:this._currentFilterColumn.filterOperator;break;case"boolean":case"checkbox":this._currentFilterbarValue.toLowerCase()=="true"||this._currentFilterbarValue=="1"?this._currentFilterbarValue=!0:(this._currentFilterbarValue.toLowerCase()=="false"||this._currentFilterbarValue=="0")&&(this._currentFilterbarValue=!1);this._operator=ej.FilterOperators.equal;break;default:this._operator=ej.FilterOperators.equal}},_getOperator:function(n){n.charAt(0)=="="&&(this._operator=ej.FilterOperators.equal,this._currentFilterbarValue=n.substring(1));(ej.data.operatorSymbols[n.charAt(0)]!==undefined||ej.data.operatorSymbols[n.slice(0,2)]!==undefined)&&(this._operator=ej.data.operatorSymbols[n.charAt(0)],this._currentFilterbarValue=n.substring(1),this._operator===undefined&&(this._operator=ej.data.operatorSymbols[n.slice(0,2)],this._currentFilterbarValue=n.substring(2)));(this._operator==ej.FilterOperators.lessThan||this._operator==ej.FilterOperators.greaterThan)&&this._currentFilterbarValue.charAt(0)=="="&&(this._operator=this._operator+"orequal",this._currentFilterbarValue=this._currentFilterbarValue.substring(1))},_checkForSkipInput:function(){var t=!1,r=this,i,n;if(this._currentFilterColumn.type=="number"&&(ej.data.operatorSymbols[this._currentFilterbarValue]!==undefined||$.inArray(this._currentFilterbarValue,["="," ","!"])!=-1)&&(t=!0),this._currentFilterColumn.type=="string")for(i=[">","<","=","!"],n=0;n<this._currentFilterbarValue.length;n++)$.inArray(this._currentFilterbarValue[n],i)!=-1&&(t=!0);return t},_setFilterbarValues:function(n,t,i){i=="greaterthan"?n.val(">"+t):i=="greaterthanorequal"?n.val(">="+t):i=="lessthan"?n.val("<"+t):i=="lessthanorequal"?n.val("<="+t):i=="notequal"?n.val("!="+t):n.val(t)},_showFilterMsg:function(){var n=!ej.isNullOrUndefined(this._currentFilterColumn)&&$.inArray(this._currentFilterColumn,this.filterColumnCollection),t,f,i,r,u;if(this._currentFilterbarValue!==""&&n==-1&&this.filterColumnCollection.push(this._currentFilterColumn),this._currentFilterbarValue===""&&n!=-1&&this.filterColumnCollection.splice(n,1),(!this._skipFilterProcess||this.filterColumnCollection.length>0)&&this.filterStatusMsg!="Invalid Filter Data")for(n=0;n<this.filterColumnCollection.length;n++)ej.isNullOrUndefined(this.filterColumnCollection[n])||(i=this.filterColumnCollection[n].headerText,this.filterColumnCollection[n].disableHtmlEncode&&(i=this._htmlEscape(i)),this.filterColumnCollection[n].field.indexOf(".")!=-1?(f=this.filterColumnCollection[n].field.replace(/[^a-z0-9|s\_]/gi,""),t=$("#"+f+"_filterBarcell").val()):(r=ej.isNullOrUndefined(this.filterColumnCollection[n].foreignKeyValue)?this.filterColumnCollection[n].field.replace(/[^a-z0-9|s\_.]/gi,"")+"_filterBarcell":this.filterColumnCollection[n].field.replace(/[^a-z0-9|s\_.]/gi,"")+"_"+this.filterColumnCollection[n].foreignKeyValue+"_filterBarcell",u=this._currentFilterColumn||this.getColumnByField(this.filterColumnCollection[n].field),t=u.type=="boolean"&&!ej.isNullOrUndefined(u.filterBarTemplate)&&this.element.find("#"+r).hasClass("e-checkbox e-js")?this.element.find("#"+r).parent().attr("aria-checked"):this.element.find("#"+r).val()),t!=""&&(n>0&&this.filterStatusMsg!=""&&(this.filterStatusMsg+=" && "),this.filterStatusMsg+=i+": "+t));this.model.allowPaging?this.getPager().ejPager("model.externalMessage",this.filterStatusMsg):this.model.scrollSettings.enableVirtualization||(this.model.scrollSettings.allowVirtualScrolling?(this.$pagerStatusBarDiv.find(".e-pagerfiltermsg")[0].innerHTML=this.filterStatusMsg,this.$pagerStatusBarDiv.find(".e-pagerfiltermsg").css("display","block")):this.$pagerStatusBarDiv.find("div")[0].innerHTML=this.filterStatusMsg,this.filterStatusMsg.length?this.$pagerStatusBarDiv.css("display","block"):this.model.scrollSettings.allowVirtualScrolling?this.$pagerStatusBarDiv.find(".e-pagerfiltermsg").hide():this.$pagerStatusBarDiv.hide());this.filterStatusMsg=="Invalid Filter Data"&&(n=$.inArray(this._currentFilterColumn,this.filterColumnCollection),this.filterColumnCollection.splice(n,1));this.filterStatusMsg=""},_renderFilterDialogs:function(){var n,t,i,r,u,f;$.each(this.model.columns,ej.proxy(function(e,o){o.type!="string"||n&&ej.isNullOrUndefined(o.filterType)?o.type!="guid"||f&&ej.isNullOrUndefined(o.filterType)?o.type!="number"||t&&ej.isNullOrUndefined(o.filterType)?o.type!="date"||r&&ej.isNullOrUndefined(o.filterType)?o.type!="datetime"||u&&ej.isNullOrUndefined(o.filterType)?o.type!="boolean"||i&&ej.isNullOrUndefined(o.filterType)||(ej.isNullOrUndefined(o.filterType)&&(i=!0),this._renderFilters(o)):(ej.isNullOrUndefined(o.filterType)&&(u=!0),this._renderFilters(o)):(ej.isNullOrUndefined(o.filterType)&&(r=!0),this._renderFilters(o)):(ej.isNullOrUndefined(o.filterType)&&(t=!0),this._renderFilters(o)):(ej.isNullOrUndefined(o.filterType)&&(f=!0),this._renderFilters(o)):(ej.isNullOrUndefined(o.filterType)&&(n=!0),this._renderFilters(o))},this))},_renderFilters:function(col){this._isExcelFilter&&col.filterType!="menu"||col.filterType=="excel"?(ej.isNullOrUndefined(this._excelFilter)&&(this._renderExcelFilter(),this._excelFilterRendered=!0),this._excelFilter.renderDialog(col.type)):eval(this["_render"+col.type.substring(0,1).toUpperCase()+col.type.substring(1)+"Dialog"](col))},_renderStringDialog:function(){var n=this._id+"_stringDlg",t;$("#"+n).length>0||(t=ej.buildTag("div#"+n+".e-dlgcontainer e-filterDialog"),t.appendTo("body"),this._renderDlgContent(t,"string"),this.model.isResponsive&&this._mediaStatus||this._renderFDialog(n))},_renderBooleanDialog:function(){var n=this._id+"_booleanDlg",t;$("#"+n).length>0||(t=ej.buildTag("div#"+n+".e-dlgcontainer e-filterDialog"),t.appendTo("body"),this._renderDlgContent(t,"boolean"),this.model.isResponsive&&this._mediaStatus||(this._renderFDialog(n),this.model.filterSettings.showPredicate?$("#"+n).ejDialog({minHeight:136,width:"100%"}):$("#"+n).ejDialog({minHeight:90,width:"100%"})))},_renderGuidDialog:function(){var n=this._id+"_guidDlg",t;$("#"+n).length>0||(t=ej.buildTag("div#"+n+".e-dlgcontainer e-filterDialog"),t.appendTo("body"),this._renderDlgContent(t,"guid"),this.model.isResponsive&&this._mediaStatus||this._renderFDialog(n))},_renderNumberDialog:function(){var n=this._id+"_numberDlg",t;$("#"+n).length>0||(t=ej.buildTag("div#"+n+".e-dlgcontainer e-filterDialog"),t.appendTo("body"),this._renderDlgContent(t,"number"),this.model.isResponsive&&this._mediaStatus||this._renderFDialog(n))},_renderDateDialog:function(n){var t=this._id+"_dateDlg",i;$("#"+t).length>0||(i=ej.buildTag("div#"+t+".e-dlgcontainer e-filterDialog"),i.appendTo("body"),this._renderDlgContent(i,"date",n),this.model.isResponsive&&this._mediaStatus||this._renderFDialog(t))},_renderDatetimeDialog:function(n){var t=this._id+"_datetimeDlg",i;$("#"+t).length>0||(i=ej.buildTag("div#"+t+".e-dlgcontainer e-filterDialog"),i.appendTo("body"),this._renderDlgContent(i,"datetime",n),this.model.isResponsive&&this._mediaStatus||this._renderFDialog(t))},_renderFDialog:function(n){$("#"+n).ejDialog({showOnInit:!1,enableRTL:this.model.enableRTL,cssClass:this.model.cssClass,showHeader:!1,width:260,enableResize:!1,allowKeyboardNavigation:!1,content:"#"+this._id})},_closeFDialog:function(){(this._isExcelFilter||this._excelFilterRendered)&&this._excelFilter.closeXFDialog();this._$menuDlgIsOpen&&this._closeFilterDlg()},_renderDlgContent:function(n,t,i){var tt,y,e,o,it;n.addClass("e-grid");var s=ej.buildTag("div.e-predicate"),l=ej.buildTag("div.e-operator"),u=ej.buildTag("div.e-value"),f=ej.buildTag("div.e-value1"),rt=this.localizedLabels.StringMenuOptions,a=this.localizedLabels.NumberMenuOptions,p=ej.buildTag("input#"+this._id+t+"_ddinput",{},{},{type:"text"}),w=ej.buildTag("div#"+this._id+t+"_dropdown"),v=ej.buildTag("ul"),b=ej.buildTag("input",{},{},{type:"radio",name:this._id+"_predicate"+t,value:"or"}),k=ej.buildTag("input",{},{},{type:"radio",name:this._id+"_predicate"+t,value:"and",checked:"checked"}),h;s.append(k).append(ej.buildTag("span.e-caption").html(this.localizedLabels.PredicateAnd)).append(b).append(ej.buildTag("span.e-caption").html(this.localizedLabels.PredicateOr));this.model.filterSettings.showPredicate||s.hide();t=="string"&&(h=ej.buildTag("input",{},{},{type:"checkbox"}),s.append(h).append(ej.buildTag("span.e-caption").html(this.localizedLabels.MatchCase)),$.each(rt,function(n,t){v.append(ej.buildTag("li",{},{},{value:t.value}).html(t.text))}));(t=="number"||t=="date"||t=="datetime"||t=="guid")&&(t=="guid"&&(a=a.slice(4,6)),$.each(a,function(n,t){v.append(ej.buildTag("li",{},{},{value:t.value}).html(t.text))}));t!="boolean"&&(w.append(v),l.append(p),l.append(w));var r=ej.buildTag("input",{},{},{type:"text"}),c=ej.buildTag("input",{},{},{type:"text"}),d=ej.buildTag("input",{},{},{type:"checkbox"}),ut=this.model.enableResponsiveRow?"OKButton":"Filter",ft=this.model.enableResponsiveRow?"CancelButton":"Clear",g=ej.buildTag("input.e-filter e-flat e-btnsub",{},{},{type:"button",value:this.localizedLabels[ut]}),nt=ej.buildTag("input.e-clear e-flat e-btncan",{},{},{type:"button",value:this.localizedLabels[ft]});u.append(ej.buildTag("span.e-caption").html(this.localizedLabels.FilterMenuCaption));f.append(ej.buildTag("span.e-caption").html(this.localizedLabels.FilterMenuToCaption));n.append(s);t=="boolean"?(u.find("span.e-caption").css("top","1px"),u.append(d)):(u.append(ej.buildTag("br")).append(r),n.append(l));n.append(u);f.append(ej.buildTag("br")).append(c);n.append(f);f.addClass("e-hide");n.append(ej.buildTag("div.e-dlgBtns").append(g).append(nt));tt=[u,f];t!="boolean"&&p.ejDropDownList({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,targetID:this._id+t+"_dropdown",width:"100%",height:"26px",selectedItemIndex:0,select:ej.proxy(this._openfset,this,tt)});b.ejRadioButton({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL});k.ejRadioButton({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,checked:!0});h&&h.ejCheckBox({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL});n.css("display","none");this._createButton("filter",g);this._createButton("clear",nt);y={cssClass:this.model.cssClass,locale:this.model.locale,enableRTL:this.model.enableRTL,showSpinButton:!1,height:"26px",decimalPlaces:2,width:"100%",watermarkText:this.localizedLabels.NumericTextBoxWaterMark};t=="number"?(r.ejNumericTextbox(y),c.ejNumericTextbox(y)):t=="guid"?r.css({height:"26px",width:"100%"}):t=="date"||t=="datetime"?(e=t=="date"?"Date":"DateTime",r.attr("id",this._id+"_dp"+e),c.attr("id",this._id+"_dpTo"+e),o={cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,enableStrictMode:!0,width:"100%",locale:this.model.locale},t=="date"&&(o.watermarkText=this.localizedLabels.DatePickerWaterMark),ej.isNullOrUndefined(i.format)||(it=t=="date"?"dateFormat":"dateTimeFormat",o[it]=i.format.replace(/{0:|}/g,function(){return""})),r["ej"+e+"Picker"](o),c["ej"+e+"Picker"](o)):t=="boolean"?d.ejCheckBox({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL}):t=="string"&&(r.attr("id",this._id+"_acString"),r.ejAutocomplete({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,dataSource:this._dataSource(),width:"100%",height:26,enableDistinct:!0,focusIn:function(){var n=this.element.closest(".e-dialog").find(".e-dropdownlist"),t=this.element.closest(".e-dialog").find(".e-checkbox").prop("checked");this.model.filterType=n.ejDropDownList("model.value");this.model.caseSensitiveSearch=t},open:function(){var n=!this.element.closest(".e-dialog").ejDialog("isOpened");this.suggestionList.css({visibility:n?"hidden":"visible"})}}))},_createButton:function(n,t){var i=n=="filter"?ej.proxy(this._fltrBtnHandler,this):ej.proxy(this._fltrClrHandler,this);t.ejButton({cssClass:this.model.cssClass,enableRTL:this.model.enableRTL,click:i})},_getIdField:function(){var n;return $.each(this.model.columns,function(t,i){if(i.key)return n=i.field,!1}),n},_openfset:function(n,t){var r="5%",i="10px";t.value=="Between"?(n[0].find(".e-caption").eq(0).html(this.localizedLabels.FilterMenuFromCaption),n[1].removeClass("e-hide"),$(n[1]).css({"padding-top":i}),this.model.isResponsive&&this._mediaStatus&&(r=i="0px")):(n[1].addClass("e-hide"),n[0].find(".e-caption").eq(0).html(this.localizedLabels.FilterMenuCaption));$(".e-responsiveLabelDiv").css({"margin-top":r});$(".e-operator").css({"padding-top":i})},_filterCompleteAction:function(){var i,t;if(this.model.allowPaging&&this._refreshGridPager(),this.model.scrollSettings.allowVirtualScrolling&&(i=this._refreshVirtualPagerInfo(),this._showPagerInformation(i)),this.model.filterSettings.filterType=="menu"||this._isExcelFilter){this._closeFDialog();var u=this.getColumnByField(this._$curFieldName),f=$.inArray(u,this.model.columns),r=this,n=!1;$.each(this.model.filterSettings.filteredColumns,function(t,i){return i.field==r._$curFieldName?(n=!0,!1):i.isComplex==!0&&i.predicates[0].field==r._$curFieldName?(n=!0,!1):void 0});t=this.getHeaderTable().find("thead").find(".e-headercell").not(".e-detailheadercell,.e-stackedHeaderCell").eq(f).find(".e-filtericon");n?t.addClass("e-filteredicon e-filternone"):t.removeClass("e-filteredicon e-filternone")}},_refreshFilterIcon:function(){var r,n,u,t,i,f;if(this.model.filterSettings.filteredColumns.length)for(r=ej.distinct(this.model.filterSettings.filteredColumns,"field",!0),n=this.getHeaderTable().find("thead").find(".e-headercell").not(".e-detailheadercell"),this.model.showStackedHeader&&(n=n.not(".e-stackedHeaderCell")),this.model.allowReordering&&n.find(".e-filtericon").removeClass("e-filteredicon e-filternone"),i=0,f=r.length;i<f;i++)t=r[i],u=this.getColumnIndexByField(t.isComplex===!0?t.predicates[0].field:t.field),n.eq(u).find(".e-filtericon").addClass("e-filteredicon e-filternone")},_setFilterFieldValues:function(n){var i="",t=this,r="",f=-1,e,u;$.each(this.model.filterSettings.filteredColumns,function(n,i){i.field==t._$curFieldName&&(f=n)});f==-1&&this._$colType!="boolean"&&(this._$colType=="string"&&$(".e-predicate input.e-js[type='checkbox']").ejCheckBox({checked:!1}),$(".e-predicate input[name ="+this._id+"_predicate"+this._$colType+"]:first").ejRadioButton({checked:!0}),$("#"+this._id+this._$colType+"_ddinput").ejDropDownList({selectedItemIndex:0,change:function(){this.element.closest(".e-dialog").find(".e-autocomplete").val(i)}}));e=$(this.model.filterSettings.filteredColumns).map(function(){return this.field}).get();(this._$curFieldName!=this._$prevFieldName||$.inArray(this._$curFieldName,e)!=-1)&&(u=0,$.each(this.model.filterSettings.filteredColumns,function(n,f){if(f.field==t._$curFieldName){for(var h=t._$colType=="number"||t._$colType=="date"||t._$colType=="datetime"?"Number":"String",s=t.localizedLabels[h+"MenuOptions"],o=ej.isNullOrUndefined(f.actualOperator)?f.operator:f.actualOperator,e=0;e<s.length;e++)if(s[e].value.toLowerCase()==o)break;if(t._$colType=="string"&&$(".e-predicate input.e-js[type='checkbox']").ejCheckBox({checked:f.matchcase}),$("input[value="+f.predicate+"]").ejRadioButton({checked:!0}),$("#"+t._id+t._$colType+"_ddinput").ejDropDownList({selectedItemIndex:e}),t.model.isResponsive&&t._mediaStatus&&o=="between"&&($(".e-responsiveLabelDiv").css({"margin-top":"0%"}),$(".e-operator").css({"padding-top":"0px"})),o=="between"&&u<=1)return u?r=f.value:i=f.value,u++,!0;i=f.actualFilterValue!=null?f.actualFilterValue:f.value}}));this._$colType=="boolean"?i&&i!=""?$(n).find(".e-value input:checkbox.e-js").ejCheckBox({checked:!0}):$(n).find(".e-value input:checkbox.e-js").ejCheckBox({checked:!1}):this._$colType=="date"||this._$colType=="datetime"?($(n).find(".e-value .e-datepicker")[this._$colType=="date"?"ejDatePicker":"ejDateTimePicker"]("model.value",i),$(n).find(".e-value1 .e-datepicker")[this._$colType=="date"?"ejDatePicker":"ejDateTimePicker"]("model.value",r)):this._$colType=="number"?($(n).find(".e-value .e-numerictextbox").ejNumericTextbox("model.value",i),$(n).find(".e-value1 .e-numerictextbox").ejNumericTextbox("model.value",r)):$(n).find(".e-value input").val(i);$(n).find(".e-value1 input1").val(r)},_fltrBtnHandler:function(){var f,o,s,h;this.model.isResponsive&&this._mediaStatus&&this._responsiveFilterClose();var a=this._id+"_"+this._$colType+"Dlg",t=$("#"+a),i=t.find(".e-value input.e-js"),r,c,l=t.find(".e-value1 input.e-js"),n=i.val(),u=undefined,e=l.val();this._$colType=="number"&&(i=i.filter(".e-numerictextbox"),n=parseFloat(i.ejNumericTextbox("getValue")),u=!0);this._$colType=="string"&&(u=t.find(".e-predicate input[type='checkbox']").is(":checked"));(this._$colType=="date"||this._$colType=="datetime")&&(n=ej.parseDate(n,this._$colFormat,this.model.locale),u=!0);this._$colType=="boolean"?(n=i.ejCheckBox("model.checked")!=null?i.ejCheckBox("model.checked"):!1,r="equal"):r=$("#"+this._id+this._$colType+"_ddinput").ejDropDownList("getSelectedValue").toLowerCase();c=t.find(".e-predicate input[type='radio']:checked");this._$colForeignKeyValue&&this._$colDropdownData?this._fltrForeignKeyValue(r,n,u,this._$colDropdownData,this._$colForeignKeyField,this._$colForeignKeyValue,this._$colType,c):this._$colType!="boolean"&&$("#"+this._id+this._$colType+"_ddinput").ejDropDownList("getSelectedValue").toLowerCase()=="between"&&((this._$colType=="datetime"||this._$colType=="date")&&(e=ej.parseDate(e,this._$colFormat,this.model.locale)),this._$colType=="number"&&(e=parseFloat(l.ejNumericTextbox("getValue"))),n=[n,e],r=["greaterthanorequal","lessthanorequal"],f={},f.operator="between");o=[];s=t.find(".e-predicate input[type='radio']:checked").attr("value");ej.isNullOrUndefined(f)||f.operator!="between"?o.push(s):o.push(s,"and");this._$colForeignKeyValue&&this._$colDropdownData||this.filterColumn(this._$curFieldName,r,n,o,u,f);this.model.isResponsive&&(t.css("display","none"),this._setResponsiveFilterIcon(),this.element.css("display","block"),!this.model.allowScrolling||this.model.enableResponsiveRow&&this.model.minWidth||(h={},h.requestType="refresh",this._refreshScroller(h)))},_fltrClrHandler:function(){this.clearFiltering(this._$curFieldName)},_fltrForeignKeyValue:function(n,t,i,r,u,f,e,o){var v,y;ej.isNullOrUndefined(i)&&(i=!0);var w=[],a,c,d=o?o.css("display")=="none":!0,b=o?o.attr("value"):"and",l,p=r,h,s={mapFieldName:f,fieldName:u,operator:n,value:t,predicate:o,matchcase:i},k={requestType:ej.Grid.Actions.Filtering,action:"fetchingForeignKeyField",currentFilteringColumn:u,currentFilterObject:s};this._trigger("actionBegin",k);r instanceof ej.DataManager||(p=new ej.DataManager(r));e=="date"?(v=new Date(t.setDate(t.getDate()-1)),y=new Date(t.setDate(t.getDate()+2)),a=n=="equal"||n=="notequal"?n=="equal"?(new ej.Query).where(ej.Predicate(s.mapFieldName,">",v,!s.matchcase).and(s.mapFieldName,"<",y,!s.matchcase)).select(s.fieldName):(new ej.Query).where(ej.Predicate(s.mapFieldName,"<=",v,!s.matchcase).or(s.mapFieldName,">=",y,!s.matchcase)).select(s.fieldName):(new ej.Query).where(s.mapFieldName,s.operator,s.value,!s.matchcase).select(s.fieldName)):a=(new ej.Query).where(s.mapFieldName,s.operator,s.value,!s.matchcase).select(s.fieldName);c={actualFilterValue:s.value,actualOperator:s.operator,ejpredicate:undefined,predicate:b};p.executeQuery(a).done(ej.proxy(function(n){var t,o;h=n.result;var a=$.isPlainObject(h[0]),r=[],e=!1,f=this._$curFieldName;for(h=a?ej.distinct(h,u,!1):h,l=new ej.Predicate(f,"equal",h[0],i),t=1,o=h.length;t<o;t++)r.push(new ej.Predicate(f,"equal",h[t],i)),e=!0;e&&(r.unshift(l),l=ej.Predicate.or(r));$.extend(c,{ejpredicate:$.extend(l,{field:f},c)});this.filterColumn(s.fieldName,s.operator,s.value,w,s.matchcase,c)},this))},_setDateFilters:function(n,t){var u,f,s,o,e,r,i;if(t||ej.isNullOrUndefined(this.getColumnByField(n.field).format)?(u=new Date(n.value.setSeconds(n.value.getSeconds()-1)),f=new Date(n.value.setSeconds(n.value.getSeconds()+2))):(e=this.getColumnByField(n.field).format,e.indexOf("s")!=-1?(u=new Date(n.value.setSeconds(n.value.getSeconds()-1)),f=new Date(n.value.setSeconds(n.value.getSeconds()+2))):e.indexOf("m")!=-1?(u=new Date(n.value.setMinutes(n.value.getMinutes()-1)),f=new Date(n.value.setMinutes(n.value.getMinutes()+2))):e.indexOf("h")!=-1?(u=new Date(n.value.setHours(n.value.getHours()-1)),f=new Date(n.value.setHours(n.value.getHours()+2))):(u=new Date(n.value.setSeconds(n.value.getSeconds()-1)),f=new Date(n.value.setDate(n.value.getDate()+1)))),r=$.extend({},n),i=$.extend({},n),r.value=u,i.value=f,n.operator=="equal"?(r.operator="greaterthan",r.predicate="and",i.operator="lessthan",i.predicate="and"):(r.operator="lessthanorequal",r.predicate="or",i.operator="greaterthanorequal",i.predicate="or"),s=ej.Predicate(r.field,r.operator,r.value,!1),o=s[i.predicate](ej.Predicate(i.field,i.operator,i.value,!1)),n.value=new Date(n.value.setSeconds(i.value.getSeconds()-1)),t)return o;this.model.filterSettings.filteredColumns.push($.extend(o,{field:n.field,operator:n.operator,value:n.value}))}}}(jQuery,Syncfusion),function(n,t,i){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.group={_renderGroupDropArea:function(){var i,n;return t.isNullOrUndefined(this.model.groupSettings.enableDropAreaAnimation)||(this.model.groupSettings.enableDropAreaAutoSizing=this.model.groupSettings.enableDropAreaAnimation),i=this.model.groupSettings.enableDropAreaAutoSizing?"":this.localizedLabels.GroupDropArea,this.model.groupSettings.showDropArea?(n=t.buildTag("div.e-groupdroparea",i),n.addClass("e-default"),this.model.groupSettings.enableDropAreaAutoSizing&&n.append(t.buildTag("div.e-animatebutton e-icon").addClass(this.model.groupSettings.enableDropAreaAutoSizing?"e-animatebuttondown e-gdownarrow":"e-animatebuttonup e-guparrow")),n):void 0},_getColGroup:function(t){var r=this.getRsc("helpers",t),f,e,u;return f=r.model.groupSettings.groupedColumns.length==1?this.data.items.level===i?0:this.data.items.level-1:this.data.items.level===i?r.model.groupSettings.groupedColumns.length:this.data.items.level-1,e=n(document.createElement("div")),r._isCaptionSummary?u=r._getCaptionColGroup(f):(u=r._getMetaColGroup(),f!=r.model.groupSettings.groupedColumns.length&&r.model.groupSettings.groupedColumns.length>1&&u.prepend(r._getIndentCol())),e.html(u),e.html()},_colSpanAdjust:function(r,u,f){var e,h,c,l,a,y,v,o,k,d,s,g;if(t.isNullOrUndefined(r)?(e=this,h=f):(e=this.getRsc("helpers",r),h=this),e.model.groupSettings.groupedColumns.length==1?(c=h.data.items.level===i?1:h.data.items.level-1,u=="groupcaption"&&(e._currentJsonData=e._currentJsonData.concat(h.data.items))):(c=h.data.items.level===i?e.model.groupSettings.groupedColumns.length:h.data.items.level-1,u=="groupcaption"&&h.data.items.level===i&&(e._currentJsonData=e._currentJsonData.concat(h.data.items))),e._isGrouping=!0,l=e.model.groupSettings.showGroupedColumn?0:e.model.groupSettings.groupedColumns.length,a=0,n.each(e._hiddenColumnsField,function(t,i){var r=n.inArray(i,e.model.groupSettings.groupedColumns);r!=-1&&(a=a+1,e.model.groupSettings.showGroupedColumn&&(l=l+1))}),y=[],n.map(e.model.columns,function(n){y.push(n.headerText)}),v=e._isDuplicate(y),o=v?e.model.columns.length+e.model.groupSettings.groupedColumns.length-c-e._hiddenColumnsField.length-l+a:e.model.columns.length+e.model.groupSettings.groupedColumns.length-c-e._hiddenColumns.length-l+a,o=e.model.detailsTemplate!=null||e.model.childGrid!=null?o+1:o,e._isCaptionSummary&&u=="groupcaption"){var p=[],nt=0,tt=e._captionSummary(),w=0,b=[];for(n.each(tt[0].summaryColumns,function(t,i){n.inArray(i.displayColumn,e._hiddenColumnsField)!=-1&&nt++;b.push(e.getColumnIndexByField(i.displayColumn));p.push(e.getColumnIndexByField(i.displayColumn)+e.model.groupSettings.groupedColumns.length-c)}),k=t.min(b),d=v?e._hiddenColumnsField:e._hiddenColumns,s=0;s<d.length;s++)g=v?t.isNullOrUndefined(e.getColumnByField(e._hiddenColumnsField[s]))?e.getColumnIndexByHeaderText(e._hiddenColumnsField[s],t.isNullOrUndefined(e.getColumnByField(e._hiddenColumnsField[s]))):e.getColumnIndexByField(e._hiddenColumnsField[s]):t.isNullOrUndefined(e.getColumnByHeaderText(e._hiddenColumns[s]))?e.getColumnIndexByHeaderText(e._hiddenColumns[s],t.isNullOrUndefined(e.getColumnByHeaderText(e._hiddenColumns[s]))):e.getColumnIndexByHeaderText(e._hiddenColumns[s]),k>g&&w++;p.length>0&&(o=t.min(p));o=o-w;o=e.model.detailsTemplate!=null||e.model.childGrid!=null?o+1:o}return o},_captionEncode:function(n){var t=this.getRsc("helpers",n),i=t.getColumnByField(this.data.field);return i.disableHtmlEncode},_captionFormat:function(i){var r=this.getRsc("helpers",i),o,u=n.extend({},this.data),e=t.isNullOrUndefined(r.model.groupSettings.captionFormat)?r.localizedLabels.GroupCaptionFormat:r.model.groupSettings.captionFormat,f=r.getColumnByField(u.field);return o=f.foreignKeyValue&&f.dataSource?r._foreignKeyBinding(r.getColumnIndexByField(u.field),u.key,r._id):u.key,t.isNullOrUndefined(f.format)||f.format.indexOf("{0:")!=-1||(u[u.field]=u.key,r.data=u),u.key=f.format?r.formatting(f.format,o,r.model.locale):o,u.headerText=f.headerText,r._groupContextIndex=r._groupContextIndex+1,e.startsWith("#")||e.startsWith(".")||typeof e=="object"?r._renderEjTemplate(e,u,r._groupContextIndex,null,t.isNullOrUndefined(r.model.ngTemplateId)?null:r.model.ngTemplateId+"gridgroupcaptiontemplate"):n.render[r._id+"_CaptionTemplate"](u)},_getCaptionColGroup:function(n){var t=this.getHeaderTable().find("colgroup").clone(),u=t.find("col"),i=u.length-this.model.columns.length,r;if((this.model.detailsTemplate!=null||this.model.childGrid!=null)&&(i=i-1),t.find("col:lt("+i+")").remove(),n>0&&n!=this.model.groupSettings.groupedColumns.length)if(this.model.groupSettings.groupedColumns.length>2&&n!=this.model.groupSettings.groupedColumns.length-1)for(r=0;r<this.model.groupSettings.groupedColumns.length-n;r++)t.prepend(this._getIndentCol());else t.prepend(this._getIndentCol());return t},_groupSummaryRow:function(i,r,u,f){var e=this.getRsc("helpers",u),f=!t.isNullOrUndefined(f),a,s,v,y,o,h,c;if(e.model.showSummary){if(e.getFooterTable()==null&&e._renderGridFooter(),e._createSummaryRows(e.getFooterTable(),i.records==null?i:i.records,r,i,f),e._isCaptionSummary&&!f&&(s=[],v=e._captionSummary(),n.each(v[0].summaryColumns,function(n,t){s.push(e.getColumnIndexByField(t.displayColumn))}),s.length>0&&(a=t.min(s)),y=e.model.columns.length,e.getFooterTable().find("tbody td").slice(-(y-a)).removeClass("e-summaryrow").addClass("e-groupcaptionsummary")),!e.model.groupSettings.showGroupedColumn){var p=e.model.groupSettings.groupedColumns,l=0,w=e.getFooterTable().children("tbody").find("tr");for(o=0;o<e.model.summaryRows.length;o++){for(h=0;h<e.model.summaryRows[o].summaryColumns.length;h++)for(c=0;c<p.length;c++)p[c]==e.model.summaryRows[o].summaryColumns[h].displayColumn&&(l++,e.model.summaryRows[o].summaryColumns.length==l&&n(w[o]).addClass("e-hide"));l=0}}return f?e.getFooterTable().find("tbody").html():e.getFooterTable().find("tbody").find("tr").html()}},addGroupingTemplate:function(){var l=document.createElement("tbody"),i=this,r={},f,u,o,e;r["_"+i._id+"ColSpanAdjust"]=this._colSpanAdjust;r["_"+i._id+"Colgroup"]=this._getColGroup;t.isNullOrUndefined(this.model.groupSettings.captionFormat)?n.templates(i._id+"_CaptionTemplate",this.localizedLabels.GroupCaptionFormat):n.templates(i._id+"_CaptionTemplate",this.model.groupSettings.captionFormat);r["_"+i._id+"CaptionFormat"]=this._captionFormat;r["_"+i._id+"GroupSummaryRow"]=this._groupSummaryRow;r["_"+i._id+"CaptionEncode"]=this._captionEncode;r[i._id+"Object"]=this;n.views.helpers(r);f=" ~_"+i._id+"CaptionFormat('"+i._id+"Object')";u="<td class='e-recordplusexpand' data-ej-mappingname='{{:field}}' data-ej-mappingvalue='{{:key}}'><div class='e-icon e-gdiagonalnext'><\/div><\/td><td class='e-groupcaption' colspan='{{:~_"+i._id+"ColSpanAdjust('"+i._id+"Object','groupcaption') }}'>{{if ~_"+i._id+"CaptionEncode('"+i._id+"Object')}}{{html:"+f+"}}{{else}}{{:"+f+"}}{{/if}}<\/td>";this._isCaptionSummary&&this.model.showSummary&&(u=u+"{{:~_"+i._id+"GroupSummaryRow(items, aggregates,'"+i._id+"Object')}}");o="<tr class='e-groupcaptionrow'>"+u+"<\/tr>";e=t.buildTag("tbody");e.html("{{if items.GROUPGUID}}{{for items tmpl='"+i._id+"_GroupingTemplate'/}}{{else}}{{for items tmpl='"+i._id+"_JSONTemplate'/}}{{/if}}");var s="<table class='e-table {{if items.GROUPGUID}}{{else}}e-recordtable{{/if}}'>{{:~_"+i._id+"Colgroup('"+i._id+"Object')}}"+e.html()+"{{:~_"+i._id+"GroupSummaryRow(items, aggregates,'"+i._id+"Object', '"+i._id+"showGroupCaption')}}<\/table>",h="<td class='e-tabletd' colspan='{{:~_"+i._id+"ColSpanAdjust('"+i._id+"Object','table')}}'>"+s+"<\/td>",c="<tr><td class='e-indentcell'><\/td>"+h+"<\/tr>";n.templates(i._id+"_GroupingTemplate",o+c)},addSummaryTemplate:function(){var i=this;n.each(i.model.summaryRows,function(r,u){n.each(u.summaryColumns,function(r,u){t.isNullOrUndefined(u.template)||n.templates(i._id+"_summaryTemplate"+u.template,u.template)})})},_getGroupTopLeftCell:function(){var n=t.buildTag("th.e-grouptopleftcell");return n.append(t.buildTag("div.e-headercelldiv e-emptyCell","&#160;")),n},_getEmptyFilterBarCell:function(){return t.buildTag("th.e-filterbarcell e-grouptopleftcell")},_groupingAction:function(n){var i=this.getHeaderTable().find("thead").find(".e-columnheader:not(.e-stackedHeaderRow)").find(".e-grouptopleftcell"),u=this.getHeaderTable().find("colgroup").find("col"),r=i.length,t;for(r&&(this.getHeaderTable().find("colgroup").replaceWith(this._getMetaColGroup()),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&this.getHeaderTable().find("colgroup").prepend(this._getIndentCol()),i.remove(),this.getHeaderTable().find("thead").find(".e-filterbar").find(".e-filterbarcell:lt("+r+")").remove()),(!this.model.allowResizeToFit||n)&&this.setWidthToColumns(),t=0;t<this.model.groupSettings.groupedColumns.length;t++)this.getHeaderTable().find("colgroup").prepend(this._getIndentCol()),this.getHeaderTable().find("thead").find(".e-columnheader").prepend(this._getGroupTopLeftCell()),this.getHeaderTable().find("thead").find(".e-filterbar").prepend(this._getEmptyFilterBarCell());this.getHeaderTable().find(".e-columnheader").find("th.e-grouptopleftcell").last().addClass("e-lastgrouptopleftcell")},groupColumn:function(i){var r,u,f;if((this._$fDlgIsOpen&&this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this.model.filterSettings.filterType=="excel")&&this._closeFDialog(),this.model.allowGrouping&&n.inArray(i,this._disabledGroupableColumns)==-1)&&!t.isNullOrUndefined(this.getColumnByField(i))&&n.inArray(i,this.model.groupSettings.groupedColumns)==-1){for(this.model.groupSettings.groupedColumns.push(i),r=0;r<this.model.sortSettings.sortedColumns.length;r++)if(this.model.sortSettings.sortedColumns[r].field==i)break;this.model.sortSettings.sortedColumns.length==r&&this.model.sortSettings.sortedColumns.push({field:i,direction:t.sortOrder.Ascending});u={};u.columnName=i;u.requestType=t.Grid.Actions.Grouping;f=this._processBindings(u);f&&(n.inArray(i,this._scolumns)!=-1||this._gridSort==i||this.model.sortSettings.sortedColumns.pop(),this.model.groupSettings.groupedColumns.pop());this._primaryKeyValues=[]}},ungroupColumn:function(i){var f,o,e,u,r,s,h;if(this._$fDlgIsOpen&&this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this.model.filterSettings.filterType=="excel")&&this._closeFDialog(),this.model.allowGrouping||this.model.groupSettings.groupedColumns.length!=0){if(n.inArray(i,this.model.groupSettings.groupedColumns)!=-1)this.model.groupSettings.groupedColumns.splice(n.inArray(i,this.model.groupSettings.groupedColumns),1);else return null;for(this.model.groupSettings.groupedColumns.length==0&&(this._LastColumnUnGroup=!0),f=this.getColumnByField(i),this.model.groupSettings.showGroupedColumn||f.visible||(o=this._hiddenColumnsField.indexOf(i),e=this.getColumnByField(i).headerText,this._hiddenColumnsField.splice(o,1),this._hiddenColumns.splice(this._hiddenColumns.indexOf(e),1),this._visibleColumns.push(e),this._visibleColumnsField.push(i),f.visible=!0),u={},r=0;r<this.model.sortSettings.sortedColumns.length;r++)if(this.model.sortSettings.sortedColumns[r].field==i){if(this._scolumns.indexOf(i)!=-1&&this.model.allowSorting&&this.model.allowMultiSorting||this._gridSort==i)if(this.model.allowSorting&&this.model.allowMultiSorting){s=n.inArray(i,this._scolumns);this._scolumns.splice(s,1);break}else{this._gridSort=null;break}else this.model.sortSettings.sortedColumns.splice(r,1);break}u.columnName=i;u.requestType=t.Grid.Actions.Ungrouping;this._isUngrouping=!0;h=this._processBindings(u);h&&this.model.groupSettings.groupedColumns.push(i);this._primaryKeyValues=[]}},collapseGroupDropArea:function(){var r=this.element.find(".e-groupdroparea").first(),i=this;this.model.groupSettings.groupedColumns.length==0&&this.model.groupSettings.enableDropAreaAutoSizing&&r.animate({height:"10px"},200,function(){i.model!=null&&i.model.groupSettings.groupedColumns.length==0&&(n(this).html("").append(t.buildTag("div.e-animatebutton e-animatebuttondown e-icon e-gdownarrow")),n(this).dequeue().css("height","auto"))})},expandGroupDropArea:function(){var n=this.element.find(".e-groupdroparea").first(),i=this;this.model.groupSettings.groupedColumns.length==0&&i.model.groupSettings.enableDropAreaAutoSizing&&n.animate({height:"30px"},150,function(){i.model.groupSettings.groupedColumns.length==0&&n.html(i.localizedLabels.GroupDropArea).append(t.buildTag("div.e-animatebutton e-animatebuttonup e-icon e-guparrow"));n.dequeue().css("height","30px")})},_enableGroupingEvents:function(){this.model.allowGrouping&&this._on(this.element,n.isFunction(n.fn.tap)&&this.model.enableTouch?"tap":"click",".e-groupdroparea",this._groupHeaderCellClick)},_recalculateIndentWidth:function(){var f=this,s=!t.isIOSWebView()&&this.getBrowserDetails(),r=this.getHeaderTable().find(".e-lastgrouptopleftcell").width(),i=r,h=r/30,o,e,u,c;h>=1&&(i=30/h);this.getHeaderTable().find("colgroup").find("col").slice(0,this.model.groupSettings.groupedColumns.length).css("width",i+"px");e=this.getContentTable().find("table").filter(":not(.e-recordtable)");r=this.getHeaderTable().find(".e-lastgrouptopleftcell").width();r>30||this._isCaptionSummary&&(r>=30||r>i)?(this._isCaptionSummary?(u=this.model.isEdit?e.parent(":not(.gridform)").children("colgroup"):e.children("colgroup"),n.each(u,function(t,r){var u=n(r).find("col").length-f.model.columns.length;(f.model.detailsTemplate!=null||f.model.childGrid!=null)&&u>0&&(u=u-1);n(r).find("col").slice(0,u).css("width",i+"px")})):this.model.isEdit?(u=e.parent(".gridform").find("colgroup"),this._setEditColGroup(u,f,i)):e.children("colgroup").find("col:first-child").css("width",r+"px"),o=this.getContentTable().find("colgroup").first().find("col").slice(0,this.model.groupSettings.groupedColumns.length),s&&s.browser!="msie"?o.css("width",i+"px"):this._isCaptionSummary?o.css("width",i+"px"):o.first().css("width",r/this.element.width()*100+"%")):(this.getContentTable().find("colgroup").first().find("col").slice(0,this.model.groupSettings.groupedColumns.length).css("width",i+"px"),this.model.isEdit&&(u=this.getContentTable().find(".gridform table").find("colgroup"),this._setEditColGroup(u,f,i)),this.getContentTable().find("table").filter(":not(.e-recordtable)").parent(":not(.gridform)").children("colgroup").find("col:first-child").css("width",r+"px"));this.model.showSummary&&(c=this.getContentTable().find("table").filter(".e-groupsummary").find(".e-summary"),c.css("width",i+"px"))},_setEditColGroup:function(t,i,r){n.each(t,function(t,u){var f=n(u).find("col").length-i.model.columns.length;(i.model.detailsTemplate!=null||i.model.childGrid!=null)&&f>0&&(f=f-1);n(u).find("col").slice(0,f).css("width",r+"px")})},getFieldNameByHeaderText:function(n){return t.isNullOrUndefined(this._fieldColumnNames[n])?null:this._fieldColumnNames[n]},getHeaderTextByFieldName:function(n){return t.isNullOrUndefined(this._headerColumnNames[n])?null:this._headerColumnNames[n]},expandAll:function(){var i=this.element.find(".e-recordpluscollapse"),r=this._excludeDetailRows().find(".e-detailrowcollapse"),t;if(i.length!=0)for(t=0;t<i.length;t++)this.expandCollapse(n(i[t]));if(r.length!=0)for(t=0;t<r.length;t++)this.expandCollapse(n(r[t]))},collapseAll:function(){var i=this.element.find(".e-recordplusexpand"),r=this.element.find(".e-detailrowexpand"),t;if(i.length!=0)for(t=0;t<i.length;t++)this.expandCollapse(n(i[t]));if(r.length!=0)for(t=0;t<r.length;t++)this.expandCollapse(n(r[t]))},_group:function(i){var u,s,f,e,o,h,r,c;if(this.model.groupSettings.groupedColumns.length&&this.model.currentViewData){if(this._currentJsonData=[],this._groupContextIndex=-1,this._summaryContextIndex=-1,u=document.createElement("div"),!this.model.groupSettings.showGroupedColumn){if(this.initialRender||t.isNullOrUndefined(i.columnName)||i.requestType!="grouping")for(r=0;r<this.model.groupSettings.groupedColumns.length;r++)n.inArray(this.model.groupSettings.groupedColumns[r],this._hiddenColumnsField)==-1&&(this._hiddenColumnsField.push(this.model.groupSettings.groupedColumns[r]),this._hiddenColumns.push(this.getColumnByField(this.model.groupSettings.groupedColumns[r]).headerText),this.getColumnByField(this.model.groupSettings.groupedColumns[r]).visible=!1);else s=this.getColumnByField(i.columnName),n.inArray(i.columnName,this._hiddenColumnsField)==-1&&(f=this.getColumnByField(i.columnName).headerText,this._hiddenColumnsField.push(i.columnName),this._hiddenColumns.push(f),this._visibleColumns.splice(this._visibleColumns.indexOf(f),1),this._visibleColumnsField.splice(this._visibleColumnsField.indexOf(i.columnName),1),s.visible=!1);this._hideHeaderColumn(this.model.groupSettings.groupedColumns,!0);this.getContentTable().children("colgroup").replaceWith(this.getHeaderTable().find("colgroup").clone())}for(this._isReorder=i.requestType=="reorder"?!0:!1,e=this.getContentTable().children("colgroup").find("col"),o=e.length-this.model.columns.length,(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&o--,e.length>this.model.columns.length&&this.getContentTable().children("colgroup").find("col:lt("+o+")").remove(),this.initialRender||(this.addInitTemplate(),this.addGroupingTemplate()),this.getContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup()),h=this.model.detailsTemplate!=null||this.model.childGrid!=null?this.model.groupSettings.groupedColumns.length+1:this.model.groupSettings.groupedColumns.length,r=0;r<h;r++)this.getContentTable().children("colgroup").prepend(this._getIndentCol());this.model.currentViewData.length?(c=this.getContentTable().children("tbody"),c.empty(),u.innerHTML=["<table><tbody>",n.render[this._id+"_GroupingTemplate"](this.model.currentViewData,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/tbody><\/table>"].join(""),this.getContentTable().get(0).replaceChild(u.firstChild.firstChild,this.getContentTable().get(0).lastChild),this._hideCaptionSummaryColumn()):this.model.isEdit&&this.cancelEdit();this._groupingAction();this._gridRows=this.getContentTable().find(".e-recordtable").find("tbody").find("tr.e-row,tr.e-alt_row").not(".e-gridSummaryRows");this._eventBindings()}},_ungroup:function(){var i,r,u,n;if(this._isGrouping=!1,t.isNullOrUndefined(this.model.detailsTemplate)||(this._detailsOuterWidth=null),i=this.element.children(".e-gridheader"),r=i.find(".e-filterbar").find("th").find("input"),i.find("div").first().empty().append(this._renderGridHeader().find("table")),this.setGridHeaderContent(i),this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar")for(this._renderFiltering(),this._renderFilterBarTemplate(),u=this.element.children(".e-gridheader").find(".e-filterbar").find("th").find("input"),n=0;n<r.length;n++)u.eq(n).val(r.eq(n).val());this.model.groupSettings.showGroupedColumn||this._hideHeaderColumn(this.model.groupSettings.groupedColumns,!0);this.addInitTemplate();this.addGroupingTemplate();this._initiateTemplateRendering();this.element.find(".e-gridcontent").children("div").first().empty().append(this._renderGridContent().find("table").first());this.setGridContent(this.element.find(".e-gridcontent"));this._gridRows=this.model.groupSettings.groupedColumns.length!=0?this.getContentTable().find(".e-recordtable").find("tbody").find("tr").toArray():this.getContentTable().get(0).rows;this.element.find(".e-groupdroparea").first().hasClass("e-allowDrop")&&this.element.find(".e-groupdroparea").first().removeClass("e-allowDrop")},_groupHeaderCellClick:function(t){var i=n(t.target),r;i.hasClass("e-groupdroparea")||(i.hasClass("e-ungroupbutton")?(r=i.parent().attr("data-ej-mappingname"),this.ungroupColumn(r)):i.hasClass("e-togglegroupbutton")?(r=i.parent().attr("data-ej-mappingname"),i.hasClass("e-toggleungroup")&&this.ungroupColumn(r)):i.hasClass("e-animatebutton")?n(t.target).hasClass("e-animatebuttondown")?this.expandGroupDropArea():this.collapseGroupDropArea():(i.addClass("e-headercelldiv"),this._mouseClickHandler(t),i.removeClass("e-headercelldiv")))},_captionSummary:function(i){for(var f=null,u=this.model.summaryRows,e=u.length,o,s,r=0;r<e;r++)if(u[r].showCaptionSummary==!0){f=n(u[r]);break}return i&&(o=u.slice(0,r),s=u.slice(r+1,e),t.merge(f=o,s)),f},_dropAreaHover:function(t){var i=n(t.target),r=this;return t.type=="mouseenter"?(this._dragActive?i.hasClass("e-groupdroparea")&&i.addClass("e-hover"):i.removeClass("e-hover"),(n(t.target).is(".e-icon.e-ascending, .e-descending")||i.closest(".e-groupheadercell").length)&&(i=n(t.target).closest(".e-groupheadercell")),i.hasClass("e-groupheadercell")&&this.model.groupSettings.showUngroupButton&&i.find(".e-ungroupbutton").show(150)):t.type=="mouseleave"&&(i.hasClass("e-groupdroparea")&&(i.find(".e-ungroupbutton").hide(150),i.removeClass("e-hover")),(n(t.target).is(".e-icon.e-ascending, .e-descending")||i.closest(".e-groupheadercell").length)&&(i=n(t.target).closest(".e-groupheadercell")),i.hasClass("e-groupheadercell")&&this.model.groupSettings.showUngroupButton&&i.find(".e-ungroupbutton").hide(150)),!1},_groupingCompleteAction:function(n){var r=this.element.children(".e-groupdroparea"),i;if((this.model.groupSettings.groupedColumns.length&&r.find(".e-grid-icon").length==0||t.Grid.Actions.Refresh==n.requestType)&&r.empty(),this.initialRender||t.Grid.Actions.Refresh==n.requestType){for(i=0;i<this.model.groupSettings.groupedColumns.length;i++)this._addColumnToGroupDrop(this.model.groupSettings.groupedColumns[i]);this._refreshGridPager()}else this._addColumnToGroupDrop(n.columnName);for(this.getHeaderTable().find(".e-columnheader").find(".e-headercelldiv").find(".e-number").remove(),this.getHeaderTable().find(".e-columnheader").find(".e-ascending,.e-descending").remove(),i=0;i<this.model.sortSettings.sortedColumns.length;i++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[i].field,this.model.sortSettings.sortedColumns[i].direction);!this.initialRender&&t.gridFeatures.dragAndDrop&&this._groupHeaderCelldrag();this.model.allowScrolling&&this.getContentTable().parent().scrollLeft(this.getHeaderTable().parent().scrollLeft()-1);this.element.children(".e-cloneproperties").remove();t.gridFeatures.filter&&["menu","excel"].indexOf(this.model.filterSettings.filterType)&&this._refreshFilterIcon()},_ungroupingCompleteAction:function(n){var r=this.element.children(".e-groupdroparea"),i;for(n.requestType!=t.Grid.Actions.Refresh&&this._removeColumnFromDrop(n.columnName),this.getHeaderTable().find(".e-columnheader").find(".e-headercelldiv").find(".e-number").remove(),this.getHeaderTable().find(".e-columnheader").find(".e-ascending,.e-descending").remove(),i=0;i<this.model.sortSettings.sortedColumns.length;i++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[i].field,this.model.sortSettings.sortedColumns[i].direction);this.model.groupSettings.groupedColumns.length==0&&(r.html(this.model.groupSettings.enableDropAreaAutoSizing?"":this.localizedLabels.GroupDropArea),this.model.groupSettings.enableDropAreaAutoSizing&&r.append(t.buildTag("div.e-animatebutton e-icon").addClass(this.model.groupSettings.enableDropAreaAutoSizing?"e-animatebuttondown e-gdownarrow":"e-animatebuttonup e-guparrow")),r.css("height","auto"));t.gridFeatures.dragAndDrop&&this._headerCellgDragDrop();this.model.allowReordering&&t.gridFeatures.dragAndDrop&&this._headerCellreorderDragDrop();this.model.allowScrolling&&this.getContentTable().parent().scrollLeft(this.getHeaderTable().parent().scrollLeft()-1);this.element.children(".e-cloneproperties").remove();t.gridFeatures.filter&&["menu","excel"].indexOf(this.model.filterSettings.filterType)&&this._refreshFilterIcon()},_getToggleButton:function(){return t.buildTag("span.e-togglegroupbutton e-icon e-gridgroupbutton","&#160;")},_checkEinHeader:function(t){for(var u,r=this.element.children(".e-gridheader").find("thead").find(".e-columnheader").find(".e-headercell"),i=0;i<r.length;i++){if(n.trim(r.eq(i).find("div").attr("data-ej-mappingname"))==t)return r.eq(i);if(this.model.allowSorting&&this.model.allowMultiSorting&&(u=n(r.eq(i)).clone(),u.find(".e-number").remove(),n.trim(u.find("div").attr("data-ej-mappingname"))==t))return u}return null},_checkEinGroupDrop:function(t){for(var r=this.element.children(".e-groupdroparea").find(".e-grid-icon"),i=0;i<r.length;i++)if(n.trim(r.eq(i).find("div").attr("data-ej-mappingname"))==t)return r.eq(i);return null},_addColumnToGroupDrop:function(i){var r=t.buildTag("div.e-grid-icon e-groupheadercell"),h=this.element.find(".e-groupdroparea").first(),u=t.buildTag("div",{},{},{"data-ej-mappingname":i}),c="e-rarrowup-2x",f=this.getColumnByField(i),e,o;f.disableHtmlEncode?r.append(u.text(f.headerText)):f.headerTemplateID?r.append(u.html(n(f.headerTemplateID).html())):r.append(u.html(f.headerText));e=this._checkEinHeader(i);this.model.groupSettings.showToggleButton&&(u.append(this._getToggleButton().addClass("e-toggleungroup")),e.find(".e-togglegroupbutton").remove().end().append(this._getToggleButton().addClass("e-toggleungroup")));o="ascending";e.find(".e-ascending,.e-descending").length&&(o=e.find(".e-ascending,.e-descending").hasClass("e-ascending")?"ascending":"descending",c=o=="ascending"?"e-rarrowup-2x":"e-rarrowdown-2x");u.append(this._createSortElement().addClass("e-"+o+" "+c));this.model.groupSettings.showUngroupButton&&u.append(t.buildTag("span.e-ungroupbutton e-icon e-cancel"," ",{},{title:this.localizedLabels.UnGroup}));h.append(r).css("height","auto");var l=r.offset().left,s=r.clone().css("position","absolute"),a=this;r.css("visibility","hidden");h.append(s).dequeue();s.css({left:l+150}).animate({left:l},150,function(){r.css("visibility","visible");s.remove()})},_removeColumnFromDrop:function(t){for(var f=this.getHeaderTextByFieldName(t),e=this,u=this.element.children(".e-groupdroparea"),r=u.css("height","30px").find(".e-grid-icon"),i=0;i<r.length;i++)n.trim(r.eq(i).find("div").attr("data-ej-mappingname"))==t&&(this.model.groupSettings.groupedColumns.length==0?this.collapseGroupDropArea():r.eq(i).remove())},_setAggreatedCollection:function(n){if((!(this._dataSource()instanceof t.DataManager)||this._dataManager.dataSource.url==i||this._isRemoteSaveAdaptor||this._dataManager.dataSource.offline)&&!this.model.enableLoadOnDemand){var r;r=this._dataManager.executeLocal(n).result;this._aggregatedCollection=r}},_setAggregates:function(n,i){var r,e,k=new t.Query,l,a,s,u,h,y,v,o,p,c,w,f,b;for(n=n||this.model.currentViewData,i=i||this._aggregatedCollection,l=n.length,l!=0&&(s=t.Predicate("field","equal",n[0].field),u=t.Predicate("key","equal",n[0].key),n[0].key instanceof Date&&(h={value:n[0].key,operator:"equal",field:"key"},u=this._setDateFilters(h,!0)),e=s.and(u)),r=1;r<l;r++)s=t.Predicate("field","equal",n[r].field),u=t.Predicate("key","equal",n[r].key),n[r].key instanceof Date&&(h={value:n[r].key,operator:"equal",field:"key"},u=this._setDateFilters(h,!0)),e=e.or(s.and(u));if(i=e?new t.DataManager(i).executeLocal(k.where(e)):i,t.isNullOrUndefined(i)||(a=i.length),n.length>0)for(r=0;r<a;r++)if((!(r>0)||!(r<a-1))&&(n[r].count=i[r].count,n[r].items.GROUPGUID&&this._setAggregates(n[r].items,i[r].items),this.model.showSummary))for(y=n[r].aggregates=[],v=this.model.summaryRows,c=0,w=v.length;c<w;c++)for(o=v[c].summaryColumns,f=0,b=o.length;f<b;f++)p=i[r].items.level?i[r].items.records:i[r].items,y[o[f].dataMember+" - "+o[f].summaryType]=this.getSummaryValues(o[f],p)}}}(jQuery,Syncfusion),function(n,t){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.dragAndDrop={_headerCellgDragDrop:function(){var i=this,r;this.dragHeaderElement();r=this.element.children("div.e-groupdroparea");r.ejDroppable({accept:r,drop:function(r,u){if(!t.isNullOrUndefined(u.helper)&&u.helper.is(":visible")){var f=i.getColumnByField(n.trim(n(u.draggable[0]).find("div").attr("data-ej-mappingname")));(u.helper.remove(),i._disabledGroupableColumns.length&&n.inArray(f.field,i._disabledGroupableColumns)!=-1)||(t.isNullOrUndefined(f)||t.isNullOrUndefined(f.field)||f.field==""||i.groupColumn(f.field),i.model.allowGrouping&&i.collapseGroupDropArea())}}})},_headerCellreorderDragDrop:function(){var i=this,r;this.dragHeaderElement();r=this.element.find(".e-headercell").not(".e-detailheadercell,.e-stackedHeaderCell");r.ejDroppable({accept:r,drop:function(r,u){var y,h,l,f,e,c,a,p,w,o,s,v;!t.isNullOrUndefined(u.helper)&&u.helper.is(":visible")&&n(u.draggable[0]).closest(".e-grid").attr("id")==i._id&&((u.draggable.attr("aria-sort")=="ascending"||u.draggable.attr("aria-sort")=="descending")&&(y=i.getColumnByField(n.trim(n(u.draggable[0]).find("div").attr("data-ej-mappingname"))),i.model.allowSorting&&i.model.allowMultiSorting?i._scolumns.push(y.field):i._gridSort=y.field),a=u.draggable.index(),r.dropTarget.hasClass("e-headercelldiv")?c=r.dropTarget.parent().index():(r.dropTarget.parent().hasClass("e-headercell")||r.dropTarget.hasClass("e-headercell"))&&(c=r.dropTarget.index()),(n(r.dropTarget).hasClass("e-number")||n(r.dropTarget).hasClass("e-icon")||r.dropTarget.closest(".e-headercelldiv"))&&(c=r.dropTarget.closest(".e-headercell").index()),i.model.scrollSettings.frozenColumns>0?(f=u.draggable.closest(".e-frozenheaderdiv").length>0?a:a+i.model.scrollSettings.frozenColumns,e=r.dropTarget.closest(".e-frozenheaderdiv").length>0?c:c+i.model.scrollSettings.frozenColumns):(f=a,e=c),i.model.allowGrouping&&i.model.groupSettings.groupedColumns.length>0&&(f=f-i.model.groupSettings.groupedColumns.length,e=e-i.model.groupSettings.groupedColumns.length),(i.model.detailsTemplate!=null||i.model.childGrid!=null)&&(f=f-1,e=e-1),h=i.getColumnByIndex(f),l=i.getColumnByIndex(e),p=!t.isNullOrUndefined(h)&&!t.isNullOrUndefined(h.field)&&h.field!=""?h.field:null,w=!t.isNullOrUndefined(l.field)&&l.field!=""?l.field:null,u.helper.remove(),o=n(r.dropTarget).clone(),o.find(".e-number").remove(),t.isNullOrUndefined(p)||t.isNullOrUndefined(w)?i.reorderColumns(f,e):(n(r.dropTarget).hasClass("e-droppable")?(o=o.children(".e-headercelldiv"),s=n(r.dropTarget).children(".e-headercelldiv")):(o=n(r.dropTarget).siblings(".e-headercelldiv"),s=n(r.dropTarget),n(s).hasClass("e-filtericon")&&(s=o=n(s).siblings(".e-headercelldiv"))),v=i.model.allowSorting&&i.model.allowMultiSorting?r.dropTarget.hasClass("e-number")||r.dropTarget.hasClass("e-icon")?i.getColumnByField(n.trim(o.attr("data-ej-mappingname"))):i.getColumnByField(n.trim(s.attr("data-ej-mappingname"))):r.dropTarget.hasClass("e-icon")&&!r.dropTarget.hasClass("e-filtericon")?i.getColumnByField(n.trim(o.attr("data-ej-mappingname"))):i.getColumnByField(n.trim(s.attr("data-ej-mappingname"))),t.isNullOrUndefined(v)&&r.dropTarget.closest(".e-headercelldiv")&&(v=i.getColumnByField(n.trim(s.closest(".e-headercelldiv").attr("data-ej-mappingname")))),i.reorderColumns(h.field,v.field)),i.model.allowGrouping&&i.collapseGroupDropArea())}})},dragHeaderElement:function(){var i=this,f=this.element.children("div.e-gridheader").find("th.e-headercell").not(".e-detailheadercell,.e-stackedHeaderCell"),u=t.buildTag("div.e-cloneproperties","",{height:"20px","z-index":2}),r;f.ejDraggable({cursorAt:{top:0,left:0},helper:function(t){var f,s,e,o;return i.element.find(".e-dragclone").length>0&&i.element.find(".e-dragclone").remove(),f=n(t.element).hasClass("e-headercell")?n(t.element):n(t.element).closest("th"),s=f.find(".e-headercelldiv"),e=n(t.element).index(),i.model.allowGrouping&&i.model.groupSettings.groupedColumns.length>0?e=e-i.model.groupSettings.groupedColumns.length:(i.model.detailsTemplate!=null||i.model.childGrid!=null)&&(e=e-1),r=i.getColumnByIndex(e),i._$curSElementTarget=s,i.model.allowSorting&&i.model.allowMultiSorting?(o=n(f).clone(),o.find(".e-number").remove(),u.text(o.text()).clone().width(f.outerWidth()+2).height(f.height()+2).css({"font-size":parseInt((f.height()+3)/2)}).addClass("e-dragclone").appendTo(i.element)):u.text(f.text()).clone().width(f.outerWidth()+2).height(f.height()+2).css({"font-size":parseInt((f.height()+3)/2)}).addClass("e-dragclone").appendTo(i.element)},dragStart:function(t){var e=t.target,s=n(e),h={target:e,draggableType:"headercell",column:r},u,f,o=!1;return(i.model.groupSettings.showToggleButton&&r&&r.allowGrouping&&(u=n.inArray(r.field,i.model.groupSettings.groupedColumns),f=n(t.element).find(".e-togglegroupbutton").hasClass("e-togglegroup"),(u!=-1&&f||u==-1&&!f)&&(o=!0)),i._resizer!=null&&i._resizer._expand||o||s.eq(0).hasClass("e-filtericon")||r&&r.allowGrouping==!1&&r.allowReordering==!1)?(n(".e-dragclone").remove(),!1):(i._dragActive=!0,i.model.allowGrouping&&i.expandGroupDropArea(),i._trigger("columnDragStart",h)?!1:void 0)},drag:function(t){var u=n(t.target),e={target:u,draggableType:"headercell",column:r},f;if(i._trigger("columnDrag",e))return!1;u.closest(".e-grid").attr("id")===i._id&&(i.getHeaderTable().find(".e-headercell").removeClass("e-reorderindicate"),!i.model.allowReordering||!(u.hasClass("e-headercelldiv")||u.hasClass("e-headercell"))||u.hasClass("e-detailheadercell")||u.hasClass("e-stackedHeaderCell")||u.parent().hasClass("e-grouptopleftcell")||(document.body.style.cursor="",u.addClass("e-allowDrop"),i.getHeaderTable().find(".e-reorderindicate").removeClass("e-reorderindicate"),u.hasClass("e-headercell")?u.addClass("e-reorderindicate"):u.parent().addClass("e-reorderindicate")),i.model.allowScrolling&&(f=t.event.type=="touchmove"?t.event.originalEvent.touches[0].pageX:t.event.pageX,i._dragAutoScrollX(f,t)),u.hasClass("e-groupdroparea")||u.closest(".e-groupdroparea").length?(document.body.style.cursor="default",u.addClass("e-allowDrop")):u.hasClass("e-headercelldiv")||u.hasClass("e-headercell")?document.body.style.cursor="pointer":u.hasClass("e-rowcell")&&(document.body.style.cursor="not-allowed"))},dragStop:function(t){if(!t.element.dropped){var u=n(t.target),f={target:u,draggableType:"headercell",column:r};i._trigger("columnDrop",f);i.element.find(".e-groupdroparea").removeClass("e-hover");i.getHeaderTable().find(".e-columnheader").find(".e-headercellactive").removeClass("e-headercellactive").removeClass("e-active");n(t.target).closest(".e-groupdroparea").length||n(t.target).closest(".e-columnheader").length&&i.model.allowReordering&&!n(t.target).hasClass("e-stackedHeaderCell")||n(".e-dragclone").remove();(n(t.target).hasClass("e-rowcell")||n(t.target).hasClass("e-stackedHeaderCell"))&&i.collapseGroupDropArea();i._dragActive=!1;i.getHeaderTable().find(".e-reorderindicate").removeClass("e-reorderindicate");document.body.style.cursor="";n(i._Indicator).css("display","none")}}})},_groupHeaderCelldrag:function(){var f=t.buildTag("div.e-cloneproperties e-grid","",{height:"20px","z-index":2}),i,r,u;i=this;r=this.element.children(".e-groupdroparea").find(".e-groupheadercell");r.ejDraggable({cursorAt:{top:0,left:0},helper:function(t){var r=n(t.sender.target).closest(".e-grid-icon");return f.text(n(t.sender.target).closest(".e-groupheadercell").text()).clone().width(r.width()+2).height(r.height()+2).addClass("e-dragclone").appendTo(i.element)},dragStart:function(n){var r=n.target,t;return n.model.cursorAt={top:0,left:0},t={target:r,draggableType:"groupheadercell"},i._trigger("columnDragStart",t)?!1:void 0},drag:function(t){n(".Sibling").remove();var r=n(t.target),u={target:r,draggableType:"groupheadercell"};if(i._trigger("columnDrag",u))return!1;r.closest("div.e-gridcontent").length?(document.body.style.cursor="",r.addClass("e-allowDrop")):document.body.style.cursor=n(t.target).closest(".e-columnheader").length>0?"pointer":"not-allowed"},dragStop:function(t){if(n(t.element).data("targetInstance",i),!t.element.dropped){var r=n(t.target),u={target:r,draggableType:"groupheadercell"};n(t.target).closest(".e-rowcell").length||n(t.target).closest(".e-groupcaption").length||n(t.target).closest(".e-columnheader").length||n(".e-dragclone").remove();document.body.style.cursor=""}}});u=this.element.children(".e-gridcontent, .e-gridheader");u.ejDroppable({accept:i.element.children("div.e-groupdroparea").find(".e-groupheadercell"),drop:function(i,r){var u,f;!t.isNullOrUndefined(r.helper)&&r.helper.is(":visible")&&r.draggable.hasClass("e-groupheadercell")&&(u=n(r.draggable[0]).find("div").attr("data-ej-mappingname"),r.helper.remove(),t.isNullOrUndefined(u)||(f=n(r.draggable).data("targetInstance"),f.ungroupColumn(u)))}})},_rowsDragAndDrop:function(){this.dragRowElement();var r=this.getContent(),i=this;r.ejDroppable({accept:r,drop:function(r,u){var v=n(r.dropTarget).closest("tr"),f,l,s,e,w,y,h,c,o,a;if(!u.helper.find("tr.e-srcgridinfo").length||(i._draggedGridID=u.helper.find("tr.e-srcgridinfo").children("td").text(),f=i._draggedGridID!=i._id?n("#"+i._draggedGridID).ejGrid("instance"):i,f._id!=i._id&&f.model.rowDropSettings.dropTargetID!="#"+i._id))return!1;if(s=f.selectedRowsIndexes.length>0?f.getSelectedRecords():n(f._currentJsonData[f._dragIndex]),t.isNullOrUndefined(f._dragIndex)||(f._dragIndex=null),e=l=i.getIndexByRow(v),w=0,e==-1&&(e=l=0,i.getRows().length!=0&&(e=i.getRows().length)),y=i._currentPage()||1,e=e+y*i.model.pageSettings.pageSize-i.model.pageSettings.pageSize,h={sourceID:f._id,destinationID:i._id,destinationRowIndex:e},o={target:v,targetIndex:e,draggedRecords:s,dropDetails:h},i._trigger("beforeRowDrop",o)){n(".e-dragclone").remove();return}if(c=i._dataSource()instanceof t.DataManager?i._dataSource().dataSource:i._dataSource(),t.isNullOrUndefined(i.model.rowDropSettings.dropMapper)||(t.isNullOrUndefined(c.headers)&&(c.headers=[]),c.headers.push({rowDropDetails:JSON.stringify(h)})),i._id!=f._id){var b=i._dataManager,k=i._dataSource().adaptor,p=f.getBatchChanges();f.model.rowDropSettings.dragBehavior=="move"&&(p.deleted=s);o={dropDetails:h,records:s,requestType:t.Grid.Actions.Refresh,targetIndex:e,action:"rowDragged"};i._processDropRequest(f,p,"drag",o);a=i.getBatchChanges();a.added=s;o.action="rowDropped";i._processDropRequest(i,a,"drop",o)}else i._draggedGridID==i._id&&(i.reorderRows(f.selectedRowsIndexes,l),n(".e-dragclone").remove())}})},_dragAutoScrollX:function(n){var u=n-this.element.offset().left,f=this.element.width()-this.model.scrollSettings.scrollerSize,i=this.getScrollObject(),r=this;i&&i._hScrollbar&&(u<5?this._dragLeftInterval=setInterval(function(){if(r._dragLeftInterval){var n=i.scrollLeft(),u=t.sum(r.columnsWidthCollection)/r.model.columns.length;n>i._hScrollbar.model.minimum?n>u?i.scrollX(i.scrollLeft()-u,!0):i.scrollX(i._hScrollbar.model.minimum,!0):r._dragLeftInterval&&(r._dragLeftInterval=clearInterval(r._dragLeftInterval))}},500):u>f-5?this._dragRightInterval=setInterval(function(){if(r._dragRightInterval){var n=i.scrollLeft(),u=t.sum(r.columnsWidthCollection)/r.model.columns.length;Math.round(n)<i._hScrollbar.model.maximum?i.scrollX(i.scrollLeft()+u,!0):r._dragRightInterval&&(r._dragRightInterval=clearInterval(r._dragRightInterval))}},500):(this._dragLeftInterval&&(this._dragLeftInterval=clearInterval(this._dragLeftInterval)),this._dragRightInterval&&(this._dragRightInterval=clearInterval(this._dragRightInterval))))},_dragAutoScroll:function(n,t){var i=n.getContent().data("ejScroller"),r=n.getContent()[0].getBoundingClientRect();r||(r=n.getContent().offset());i&&i._vScrollbar&&(r.top>=t.event.clientY?n._dragUpInterval=setInterval(function(){if(n._dragUpInterval){var t=-n.getRowHeight(),r=i.scrollTop();r!=0?i.scrollY(i.scrollTop()+t,!0):n._dragUpInterval&&(n._dragUpInterval=clearInterval(n._dragUpInterval))}},500):r.top+n.getContent().height()<=t.event.clientY?n._dragDownInterval=setInterval(function(){if(n._dragDownInterval){var t=n.getRowHeight(),r=i.scrollTop();Math.round(r)<=i._vScrollbar.model.maximum?i.scrollY(i.scrollTop()+t,!0):n._dragDownInterval&&(n._dragDownInterval=clearInterval(n._dragDownInterval))}},500):(n._dragUpInterval&&(n._dragUpInterval=clearInterval(n._dragUpInterval)),n._dragDownInterval&&(n._dragDownInterval=clearInterval(n._dragDownInterval))))},dragRowElement:function(){var i=this,r=n(this.getRows());r.ejDraggable({cursorAt:{top:-8,left:-8},helper:function(r){var u,f,e,o,h,s;return(this.clone=!0,u=n(r.element).closest("tr"),i._selectDrag||!u.length||n.inArray(i.getIndexByRow(u),i.selectedRowsIndexes)==-1&&i.model.selectionType!="single")?!1:(f=t.buildTag("div.e-cloneproperties e-draganddrop e-grid e-js","",{height:"auto","z-index":2,position:"absolute",width:i.element.width()}),f.append(t.buildTag("table","",{width:i.element.width()})),o=n(i.getRows()).clone().removeClass(),h=0,e=i.model.selectionType!="single"&&i.selectedRowsIndexes.length>0?n.map(o,function(t,r){if(n.inArray(r,i.selectedRowsIndexes)!=-1)return t;n(e).find("td").removeClass("e-selectionbackground e-active");u.find("td.e-selectionbackground").length||f.css("display","none")}):u.clone(),s=t.buildTag("tr.e-srcgridinfo e-grid","",{display:"none",height:"auto"}).append("<td>"+i._id+"<\/td>"),e.push(s[0]),f.find("table").append(e),f.addClass("e-dragclone").appendTo(n("body")))},dragStart:function(t){var u=n(t.target).closest("tr"),f,e,r,o;return i._selectDrag||n.inArray(i.getIndexByRow(u),i.selectedRowsIndexes)==-1&&i.model.selectionType!="single"?!1:(f=t.target,e=i.selectedRowsIndexes.length>0?i.getRowByIndex(i.selectedRowsIndexes[0],i.selectedRowsIndexes[i.selectedRowsIndexes.length]):u,i.model.selectionType!="single"&&i.selectedRowsIndexes.length>0?r=i.getSelectedRecords():(i._dragIndex=i.getIndexByRow(u),r=i._currentJsonData[i._dragIndex]),o={target:e,currentTarget:f,draggableType:"rows",data:r,draggedRecords:r},i._trigger("rowDragStart",o)?(n(".e-dragclone").remove(),!1):void 0)},drag:function(t){var r=n(t.target),f=r.closest(".e-grid"),u;t.event.type=="touchmove"&&f.length&&(f.find(".e-row.e-hover,.e-alt_row.e-hover").removeClass("e-hover"),r.closest(".e-rowcell").parent().addClass("e-hover"));var o=i.selectedRowsIndexes.length>0?i.getRowByIndex(i.selectedRowsIndexes[0],i.selectedRowsIndexes[i.selectedRowsIndexes.length]):i.getRowByIndex(i._dragIndex),e=i.selectedRowsIndexes.length>0?i.getSelectedRecords():i._currentJsonData[i._dragIndex],s={target:o,currentTarget:r,draggableType:"rows",data:e,draggedRecords:e};if(i._dragAutoScroll(i,t),i._trigger("rowDrag",s))return n(".e-dragclone").remove(),!1;document.body.style.cursor="not-allowed";u=n(i.model.rowDropSettings.dropTargetID);(r.closest(i.model.rowDropSettings.dropTargetID).length||r.closest("#"+i._id).length)&&(r.closest(".e-grid").length&&(r.closest(".e-rowcell").length||r.closest(".emptyrecord").length)?r.closest("table").addClass("e-allowRowDrop"):u.hasClass("e-grid")||u.addClass("e-allowRowDrop"))},dragStop:function(r){var e=n(r.target),o=e.closest(".e-grid"),s,f,u,h;return r.event.type=="touchend"&&o.length&&o.find(".e-row.e-hover,.e-alt_row.e-hover").removeClass("e-hover"),!r.element.dropped&&(i._dragUpInterval&&(i._dragUpInterval=clearInterval(i._dragUpInterval)),i._dragDownInterval&&(i._dragDownInterval=clearInterval(i._dragDownInterval)),s=i.selectedRowsIndexes.length>0?i.getRowByIndex(i.selectedRowsIndexes[0],i.selectedRowsIndexes[i.selectedRowsIndexes.length]):i.getRowByIndex(i._dragIndex),f=i.selectedRowsIndexes.length>0?i.getSelectedRecords():i._currentJsonData[i._dragIndex],document.body.style.cursor="",u=n(i.model.rowDropSettings.dropTargetID),u.hasClass("e-grid")?u.find(".e-gridcontent").find("table").removeClass("e-allowRowDrop"):u.removeClass("e-allowRowDrop"),i.getContent().find("table").removeClass("e-allowRowDrop"),h={rows:s,target:e,draggableType:"rows",data:f,droppedRecords:f},t.isNullOrUndefined(this._checkTargetElement(r.event))&&n(".e-dragclone").remove(),i._trigger("rowDrop",h))?!1:void 0}})},_processDropRequest:function(r,u,f,e){var o,s;if(e.action=="rowDragged"&&n(".e-dragclone").remove(),o=r._dataManager.dataSource.batchUrl,r._dataManager.dataSource.batchUrl=r.model.rowDropSettings[f+"Mapper"],r._isRemoteSaveAdaptor&&r._dataManager.dataSource.batchUrl==null)if(f=="drop")for(i=0;i<u.added.length;i++)t.JsonAdaptor.prototype.insert(r._dataManager,u.added[i]);else for(i=0;i<u.deleted.length;i++)t.JsonAdaptor.prototype.remove(r._dataManager,r._primaryKeys[0],u.deleted[i]);s=r._dataManager.saveChanges(u,r._primaryKeys[0],r.model.query._fromTable);n.isFunction(s.promise)&&r._dataManager.dataSource.batchUrl!=null?(n("#"+r._id).data("ejWaitingPopup").show(),s.done(function(){r._isLocalData&&f=="drop"&&(e.dropDetails.sourceID==e.dropDetails.destinationID?r._moveDroppedRowIndex(e.targetIndex,e.records,e.draggedRowIndexes):r._moveDroppedRowIndex(e.targetIndex,e.records));f=="drop"&&(r._dataSource()instanceof t.DataManager?r._dataSource().dataSource.headers.pop():r._dataSource().headers.pop());r._dataManager.dataSource.batchUrl=o;r.refreshBatchEditChanges();n("#"+r._id).data("ejWaitingPopup").hide();r._processBindings(e)}),s.fail(function(t){r._dataManager.dataSource.batchUrl=o;n("#"+r._id).data("ejWaitingPopup").hide();e.error=t&&t.error?t.error:t;r._trigger("actionFailure",e)})):(r.refreshBatchEditChanges(),r._dataManager.dataSource.batchUrl=o,f=="drop"&&r._moveDroppedRowIndex(e.targetIndex,e.records),e.dropDetails.sourceID==e.dropDetails.destinationID&&f=="drag"||r._processBindings(e))},reorderRows:function(n,i){var r,u,f;if(!this.model.sortSettings.sortedColumns.length)if(r=this.getSelectedRecords(),this.selectedRowsIndexes=[],u={requestType:t.Grid.Actions.Refresh,action:"rowReordering",draggedRowIndexes:n,targetIndex:i,dropDetails:{sourceID:this._id,destinationID:this._id,DestinationRowIndex:i},records:r},t.isNullOrUndefined(this.model.rowDropSettings.dropMapper)){if(this._trigger("actionBegin",u))return!1;this._moveDroppedRowIndex(i,r,n);this._trigger("actionComplete",u)}else f=this.getBatchChanges(),f.changed=r,this._processDropRequest(this,f,"drop",u)},_moveDroppedRowIndex:function(i,r,u){var a,o,h,p,f;if(t.isNullOrUndefined(u)){if(i>-1)for(h=this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json:this._dataSource(),p=i+this._currentPage()*this.model.pageSettings.pageSize-this.model.pageSettings.pageSize,f=0;f<r.length;f++)h.splice(i++,0,h.splice(h.length-r.length+f,1)[0])}else{var u=u.sort(function(n,t){return n-t}),c=i,s,e,l=0,v=this.model.currentViewData.slice(),y=this.getRowByIndex(i);for(i+=this._currentPage()*this.model.pageSettings.pageSize-this.model.pageSettings.pageSize,f=0;f<u.length;f++)h=v[u[f]],e=u[f]-l,s=0,a=this._excludeDetailRows(),o=n(a[e]),c>e&&l++,this.model.allowPaging&&(s=this._currentPage()*this.model.pageSettings.pageSize-this.model.pageSettings.pageSize),e=s+e,this.selectedRowsIndexes.push(c-l),f==u.length-1&&(this.model.selectedRowIndex=this.selectedRowsIndexes[0]),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&o.next().hasClass("e-detailrow")&&(o=o.add(o.next()[0])),y.before(o),c<u[f]-l?c++:i--,this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json.splice(i+f,0,this._dataSource().dataSource.json.splice(e,1)[0]):this._dataSource().splice(i+f,0,this._dataSource().splice(e,1)[0]),this.model.currentViewData.splice(i+f-s,0,this.model.currentViewData.splice(e-s,1)[0])}}}}(jQuery,Syncfusion),function(n,t,i){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.selection={selectRows:function(r,u,f){var h,a,ti,c,v,yt,ri,wt,ui,y,fi,ei,oi,ot,st,dt,ht,ct,si,et,nt,hi,l,tt,rt,w,g,p,gt,lt,b,it,at,ni,ci,o,e;if(!this._allowrowSelection)return!1;if(this._traverseRow!=r&&n(".e-traverse").removeClass("e-traverse"),this._traverseRow=null,h=[],this.initialRender&&(this.model.currentIndex=r),this.model.scrollSettings.enableVirtualization&&(n.isArray(r)?this.model.currentIndex=r[0]:u&&(this.model.currentIndex=r>u?u:r)),a=null,this.model.allowScrolling&&!t.isNullOrUndefined(this.getContent().data("ejScroller"))&&(a=this.getScrollObject()),!this.multiSelectCtrlRequest&&this.model.scrollSettings.allowVirtualScrolling&&(this._virtuaOtherPage?this._virtualScrollingSelection=!0:(a!=null&&a.model.keyConfigs.down==""&&f||this.clearSelection(),this._virtualScrollingSelection=!1)),n.isArray(r)&&(h=r,r=h[0],this._virtaulSel=[],this.model.scrollSettings.allowVirtualScrolling&&!this.model.scrollSettings.enableVirtualization)){if(this._virtualScrollingSelection=!0,this._virtualSelectedRows=h,ti=parseInt(r/this.model.pageSettings.pageSize)*this.model.pageSettings.pageSize,rt=(parseInt(r/this.model.pageSettings.pageSize)+1)*this.model.pageSettings.pageSize,this._virtaulSel.push(r),h.length>0)for(this._virtualSelRecords=[],e=0;e<h.length;e++)this._virtualSelRecords.push(this.model.currentViewData[h[e]]);for(this._virtuaOtherPage||(this._virtaulUnSel=[]),e=1;e<h.length;e++)ti<h[e]&&h[e]<rt?this._virtaulSel.push(h[e]):this._virtaulUnSel.push(h[e])}if(y=n(this.getRows()),this.model.allowScrolling&&!this.multiSelectShiftRequest&&this.model.scrollSettings.frozenColumns==0&&this.model.scrollSettings.frozenRows==0&&(v=y.eq(r)[0],!t.isNullOrUndefined(v)&&this.model.groupSettings.groupedColumns.length==0&&!t.isNullOrUndefined(this.getContent().data("ejScroller")))){var vt=a.scrollTop(),ii=vt+a.content()[0].clientHeight,k=v.offsetTop+v.offsetHeight,ut=v.offsetTop,li=f?parseInt(n(this._gridRows[r]).attr("name"),32):Math.ceil((r+1)/this._virtualRowCount);if(this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(k+=(t.min(this._currentLoadedIndexes)-1)*this._virtualRowCount*this._vRowHeight,ut=this.model.currentIndex*this._vRowHeight+r+v.offsetHeight),yt=k-this._vRowHeight<=vt&&k<ii&&(r||vt),(!t.isNullOrUndefined(v)&&ii<k||yt)&&(yt&&(ut=k-v.offsetHeight),a.model.keyConfigs.down==""&&(ut=this.model.selectedRowIndex<r?a.model.scrollTop+v.offsetHeight:a.model.scrollTop-v.offsetHeight),ri=this._currentLoadedIndexes,this.model.scrollSettings.enableVirtualization&&n.inArray(li,this._currentLoadedIndexes)==-1||a.scrollY(ut,!0),a.model.keyConfigs.down==""&&JSON.stringify(this._currentLoadedIndexes)!=JSON.stringify(ri)))return}var o={},ft,pt=this._currentPage()-1,d=this.model.pageSettings.pageSize;this.model.scrollSettings.enableVirtualization||(w=this.getRowByIndex(r).attr("name"),g=t.isNullOrUndefined(w)?r:parseInt(w)/d+1);t.isNullOrUndefined(r)||(this.model.editSettings.editMode=="batch"&&n(y[r]).hasClass("e-insertedrow")?(wt=this.batchChanges.added.reverse(),this.model.editSettings.rowPosition=="bottom"?r>=this.model.currentViewData.length&&(et=r-this.model.currentViewData.length,ui=wt.slice(0),c=ui.reverse()[et]):c=wt[r],this.batchChanges.added.reverse()):c=this.model.editSettings.editMode=="batch"?this.model.editSettings.rowPosition=="bottom"?this._currentJsonData[r]:this._currentJsonData[r-this.batchChanges.added.length]:this._currentJsonData[t.isNullOrUndefined(r)?u:r]);var s=r,bt=this._previousIndex,kt=this.getRowByIndex(this._previousIndex);if(o={rowIndex:s,row:y.eq(r),data:c,selectedData:c,target:f,prevRow:kt,prevRowIndex:bt},this.model.scrollSettings.allowVirtualScrolling){if(this.initialRender||(this._virtualDataRefresh=!0),o=this._getVirtualRows(r,f,"selectRows",h),o==!1||t.isNullOrUndefined(o))return;this.model.scrollSettings.enableVirtualization?this._enableCheckSelect&&t.isNullOrUndefined(f)&&o.row.length&&(s=r=o.row.index()):s=r=o.rowIndex;c=o.data;bt=o.prevRowIndex;kt=o.prevRow}if(f&&f.hasClass("e-checkselectall")&&(o.data=this._isLocalData?this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json:this._dataSource():this.model.currentViewData),this._trigger("rowSelecting",o)){this._enableCheckSelect&&!t.isNullOrUndefined(f)&&(o.target.parent(".e-checkcelldiv").length||f.hasClass("e-checkselectall"))&&f.prop("checked",this.model.enableTouch);return}if(f&&f.hasClass("e-checkselectall")&&this._isLocalData&&this._isMapSelection)return this._headerCheckUpdateAll(!f[0].checked);if(y=n(this.getRows()),this._isMapSelection&&!this._selectionByGrid&&t.isNullOrUndefined(u)&&!this.initialRender&&!h.length){this.model.scrollSettings.frozenColumns?(fi=this.model.columns.indexOf(t.DataManager(this.model.columns).executeLocal((new t.Query).where("type","equal","checkbox"))[0]),y=n(this.getContent).find(fi>=this.model.scrollSettings.frozenColumns?".e-movablecontent":".e-frozencontentdiv").find("tr"),c[this._selectionMapColumn]=!y.eq(r).find(n(".e-checkcelldiv input")).prop("checked")):c[this._selectionMapColumn]=!o.row.find(".e-checkcelldiv input").prop("checked");this.updateRecord(this._primaryKeys[0],c,"update");return}if((this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&this.model.isEdit&&this.model.enableAutoSaveOnSelectionChange&&(!(this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal")||this.getContentTable().find(".e-editedrow").length!=0)){if(this.endEdit())return;(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&n("#"+this._id+"_externalEdit").css("display","none")}if(this.checkSelectedRowsIndexes[pt]!=i||this._isMapSelection||(this.checkSelectedRowsIndexes[pt]=[]),h.length>0){for(e=0;e<h.length;e++)this.selectedRowsIndexes.indexOf(h[e])==-1&&this.selectedRowsIndexes.push(h[e]),this._selectedMultipleRows(this.selectedRowsIndexes),this._isMapSelection&&!this._selectionByGrid&&(b=this._currentJsonData[h[e]],b[this._selectionMapColumn]=!0,this.batchChanges.changed.push(b));if(!this.model.scrollSettings.enableVirtualization)for(ei=this._virtaulSel[0]-r,e=0;e<this._virtaulSel.length;e++)this._virtaulSel[e]-=ei;for(l=this.getRowByIndex(this.model.scrollSettings.allowVirtualScrolling?this._virtaulSel:h),e=0;e<l.length;e++)t.isNullOrUndefined(l[e])&&l.splice(e,1);if(n(l).attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active"),this._enableCheckSelect&&!this._isMapSelection&&n(l).find(".e-checkcelldiv input").prop("checked","checked"),Array.prototype.push.apply(this.model.selectedRecords,this.getSelectedRecords()),this._isMapSelection&&!this._selectionByGrid&&!this.initialRender){this.batchSave();return}}else if(t.isNullOrUndefined(u)||t.isNullOrUndefined(r)){r=t.isNullOrUndefined(r)?u:r;s=r;switch(this.model.selectionType){case t.Grid.SelectionType.Multiple:if(this.multiSelectCtrlRequest){this.model.selectedRecords=[];oi=s;this.model.scrollSettings.enableVirtualization&&this._enableCheckSelect&&(oi=o.rowIndex);ot=n.inArray(s,this.selectedRowsIndexes);ot!=-1&&!this._isMapSelection&&this.clearSelection(s,f)&&this.selectedRowsIndexes.splice(ot,0);ot==-1&&(this.selectedRowsIndexes.push(s),this._selectedMultipleRows(this.selectedRowsIndexes),st=this.getRowByIndex(r),this.model.scrollSettings.enableVirtualization&&this._virtualSelectedRowIndex.push(o.rowIndex),this.model.scrollSettings.enableVirtualization&&this._enableCheckSelect&&(dt=parseInt(st.attr("name"),32),ht=dt%(this.model.pageSettings.pageSize/this._virtualRowCount),ht==0&&(ht=this.model.pageSettings.pageSize/this._virtualRowCount),ct=Math.ceil(dt*this._virtualRowCount/this.model.pageSettings.pageSize)-1,si=o.rowIndex%this._virtualRowCount+(ht*this._virtualRowCount-this._virtualRowCount),this.checkSelectedRowsIndexes[ct]!=i||this._isMapSelection||(this.checkSelectedRowsIndexes[ct]=[]),this.checkSelectedRowsIndexes[ct].push(si)),st.attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active"),this.model.scrollSettings.enableVirtualization?(this._virtualSelectedRecords[s]=this._getSelectedViewData(r,f).data,this._virtualCheckSelectedRecords[o.rowIndex]=this._getSelectedViewData(r,f).data):this._virtualSelectAction(g,r,d),(this._enableCheckSelect&&f&&!f.parent().hasClass("e-checkcelldiv")||t.isNullOrUndefined(f)&&this._enableCheckSelect)&&st.find(".e-checkcelldiv input").prop("checked","checked"));Array.prototype.push.apply(this.model.selectedRecords,this.getSelectedRecords());break}case t.Grid.SelectionType.Single:this.clearSelection();this.clearColumnSelection();this.selectedRowsIndexes=[];this.model.selectedRecords=[];this._virtualSelectedRecords={};this._virtualCheckSelectedRecords={};this.selectedRowsIndexes.push(s);this._selectedMultipleRows(this.selectedRowsIndexes);this.model.scrollSettings.enableVirtualization&&r>this.getRows().length?(et=r%this._virtualRowCount,n(this._virtualLoadedRows[this._currentVirtualIndex][et]).attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active")):this.getRowByIndex(r).attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active");this.model.scrollSettings.enableVirtualization&&this._virtualSelectedRowIndex.push(o.rowIndex);this.model.scrollSettings.enableVirtualization?(this._virtualSelectedRecords[s]=c,this._virtualCheckSelectedRecords[o.rowIndex]=c):this._virtualSelectAction(g,r,d);Array.prototype.push.apply(this.model.selectedRecords,this.getSelectedRecords());this._enableCheckSelect&&this.getRowByIndex(r).find(".e-checkcelldiv [type=checkbox]").prop("checked",!0)}}else if(this.model.selectionType==t.Grid.SelectionType.Multiple&&(this._isMapSelection||this.clearSelection(i,f),this.clearColumnSelection(),this.selectedRowsIndexes=[],this.model.selectedRecords=[],this._virtualSelectedRecords={},this._virtualCheckSelectedRecords={},this._selectedMultipleRows([]),nt=u,this._virtualUnSel=[],this._virtualUnSelIndexes=[],this._isMapSelection||!(f&&f.hasClass("e-checkselectall")&&f[0].checked)&&!this._isCheckboxUnchecked||this._isCheckboxChecked)){for(this.model.scrollSettings.enableVirtualization&&f&&!f.hasClass("e-checkselectall")&&(p=this._getSelectedViewData(u,f).viewIndex,hi=u%this._virtualRowCount,nt=p*this._virtualRowCount-(this._virtualRowCount-hi),s!=this._prevSelIndex&&(s=this._prevSelIndex)),ft=s-nt<0,this.model.scrollSettings.enableVirtualization||(l=ft?this.getRowByIndex(r,u+1):this.getRowByIndex(u,r+1)),this.model.scrollSettings.frozenColumns&&(l=n(l[0]).add(l[1])),tt=[],e=ft?s:nt,rt=ft?nt:s;e<=rt;e++)this.model.scrollSettings.allowVirtualScrolling&&(this.model.scrollSettings.enableVirtualization?(p=this._getSelectedViewData(e).viewIndex,n.inArray(p,this._currentLoadedIndexes)!=-1?(gt=this._currentLoadedIndexes.indexOf(p),lt=e%this._virtualRowCount+gt*this._virtualRowCount,lt==0&&gt*this._virtualRowCount,tt.push(lt)):(this._virtualUnSel.push(e),n.inArray(p,this._virtualUnSelIndexes)==-1&&this._virtualUnSelIndexes.push(p))):(w=this.getRowByIndex(e).attr("name"),g=t.isNullOrUndefined(w)?r:parseInt(w)/d+1,this._virtualSelectedRecords[lt]=this._getSelectedViewData(e).data,this._virtualSelectAction(g,e,d))),this.model.scrollSettings.enableVirtualization&&this._enableCheckSelect&&!this.getRowByIndex(e).length||(this.selectedRowsIndexes.push(e),this._virtualSelectedRowIndex.push(e)),this._selectedMultipleRows(this.selectedRowsIndexes),this._isMapSelection&&!this._selectionByGrid&&(b=this._currentJsonData[e],b[this._selectionMapColumn]=!f[0].checked,this.batchChanges.changed.push(b));if(this.model.scrollSettings.enableVirtualization&&this._enableCheckSelect&&(it=this.model.query.clone(),at=null,this._virtualCheckSelectedRecords={},it.queries=it.queries.filter(function(n){return n.fn!="onPage"}),this._isLocalData&&(at=(this._dataSource()instanceof t.DataManager)?this._dataSource().executeLocal(it).result:t.DataManager(this._dataSource()).executeLocal(it).result),t.copyObject(!0,this._virtualCheckSelectedRecords,t.isNullOrUndefined(at)?this._currentJsonData:at)),this._isMapSelection){this.batchSave();return}this.model.scrollSettings.enableVirtualization&&(l=this.getRowByIndex(tt[0],tt[tt.length-1]+1));n(l).attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active");Array.prototype.push.apply(this.model.selectedRecords,this.getSelectedRecords());this._enableCheckSelect&&n(l).find(".e-checkcelldiv input").prop("checked","checked");this.multiSelectShiftRequest&&f.prop("checked",!1);this._isCheckboxChecked=!1;this._isCheckboxUnchecked=!1}if(this._enableCheckSelect&&(this.model.scrollSettings.enableVirtualization||(this.checkSelectedRowsIndexes[pt]=this.selectedRowsIndexes),this._selectAllCheck||(this.selectedRowsIndexes.length==this._currentJsonData.length||this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&[].concat.apply([],this.checkSelectedRowsIndexes).length>=this._gridRecordsCount?this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").prop("checked","checked"):this._selectionByGrid&&this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").prop("checked",!1))),this._selectedRow()!==s&&n(this.getRowByIndex(s)).attr("aria-selected")=="true"&&this._selectedRow(s),f&&f.hasClass("e-checkselectall")&&!this._isMapSelection){var ai=this,vi=this._dataSource()instanceof t.DataManager&&this.model.scrollSettings.allowVirtualScrolling&&this.model.allowScrolling&&!this.model.scrollSettings.enableVirtualization?Math.ceil(this._gridRecordsCount/this.model.pageSettings.pageSize):this.model.pageSettings.totalPages,yi=this.model.enableTouch?!f.is(":checked"):f.is(":checked");this.checkSelectedRowsIndexes=yi?n.map(Array(vi),function(){return Array(n.map(Array(ai.model.pageSettings.pageSize),function(n,t){return t}))}):[];ni=[].concat.apply([],this.checkSelectedRowsIndexes).length;!f.is(":checked")&&ni>this._gridRecordsCount&&this.checkSelectedRowsIndexes[this.checkSelectedRowsIndexes.length-1].splice(this._gridRecordsCount-ni)}for(c=this._virtualScrollingSelection?this._virtualSelRecords:c,ci=this.model.scrollSettings.enableVirtualization?s:this._selectedRow(),o={rowIndex:ci,row:this.getRowByIndex(this._selectedRow()),data:c,selectedData:c,target:f,prevRow:kt,prevRowIndex:bt},this._previousIndex=this.selectedRowsIndexes.length?r:this._previousIndex,this.model.scrollSettings.enableVirtualization&&(this._prevSelIndex=s,this._prevSelRow=this.getRowByIndex(r)),e=0;e<this.checkSelectedRowsIndexes.length;e++)t.isNullOrUndefined(this.checkSelectedRowsIndexes[e])&&(this.checkSelectedRowsIndexes[e]=[]);this.model._checkSelectedRowsIndexes=this.checkSelectedRowsIndexes;f&&f.hasClass("e-checkselectall")&&(o.data=this._isLocalData?this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json:this._dataSource():this.model.currentViewData);n(this.getRowByIndex(r)).is('[data-role="row"]')&&n(this.getRowByIndex(s)).attr("aria-selected")=="true"&&this._trigger("rowSelected",o)},_getVirtualRows:function(i,r,u,f){var p=i,k=this._previousIndex,d=this.getRowByIndex(this._previousIndex),w,c,v={},ut=n(this.getRows()),g=!1,nt,y,e,o,b;if(this.model.scrollSettings.enableVirtualization){var ft=this._virtualRowCount,a=r?parseInt(n(this._gridRows[i]).attr("name"),32):Math.ceil((i+1)/ft),et=a>1?this._virtualRowCount:0;if(this.initialRender||a!=this._currentVirtualIndex&&!r){if(this._isThumbScroll=!0,t.isNullOrUndefined(this._virtualLoadedRecords[a])&&!this._isLocalData&&(this._dynamicSelectedRowIndex=i,g=!0),n.inArray(a,this._currentLoadedIndexes)==-1&&u!="clearSelection"&&this._refreshVirtualView(a,u,i),g)return!1;i=i!=0?i%this._virtualRowCount+et:i}else if(!(i>this._virtualRowCount*3)&&(t.isNullOrUndefined(r)||n(r).parent().hasClass("e-headercelldiv")||t.isNullOrUndefined(r[0])||r[0].checked)){var tt=n(this._gridRows[i]).attr("name"),l=parseInt(tt,32),ot=n(this._gridRows[i]).prevAll("tr[name="+tt+"]").length;p=(l-1)*this._virtualRowCount+ot}else y=this._getSelectedViewData(i,r).viewIndex,nt=i%this._virtualRowCount,p=y*this._virtualRowCount-(this._virtualRowCount-nt);if(f.length)for(o=0;o<f.length;o++)y=this._getSelectedViewData(f[o]).viewIndex,n.inArray(y,this._currentLoadedIndexes)!=-1&&this._virtaulSel.push(f[o]),this._virtualSelectedRecords[f[o]]||(this._virtualSelectedRecords[f[o]]=this._getSelectedViewData(f[o]).data,this._virtualCheckSelectedRecords[f[o]]=this._getSelectedViewData(f[o]).data);c=this._getSelectedViewData(i,r,a).data;k=this._prevSelIndex;d=this._prevSelRow}else{var s=this.model.pageSettings.pageSize,it=this.getRowByIndex(i).attr("name"),rt=t.isNullOrUndefined(it)?i:parseInt(it)/s+1,l=i%s,h=parseInt(i/s),b=h*s;if(!t.isNullOrUndefined(h)&&h>0&&n.inArray(b,this.virtualLoadedPages)==-1&&t.isNullOrUndefined(r)&&!(this._requestType=="save"||this._requestType=="cancel"))if(l--,this._virIndex=!0,this._virtualTrIndex=l,this.gotoPage(h+1),e=this,this._dataSource()instanceof t.DataManager){if(this._queryPromise.done(function(n){var t;e._virtuaOtherPage=!0;e._virtualdata=e._currentJsonData;e._pageTo=h;e._virtualScrollingSelection&&(e._virtualSelRecords=n.virtualSelectRecords);var u=parseInt(i/e.model.pageSettings.pageSize)*e.model.pageSettings.pageSize,o=(parseInt(i/e.model.pageSettings.pageSize)+1)*e.model.pageSettings.pageSize,r=[];for(r.push(i),t=1;t<f.length;t++)u<f[t]&&f[t]<o&&r.push(f[t]);return e.selectRows(r),!1}),e._virtualScrollingSelection)return}else{if(e._virtualdata=e._currentJsonData,f.length>0)for(e._virtualSelRecords=[],o=0;o<f.length;o++)e._virtualSelRecords.push(this.model.dataSource[f[o]]);e._pageTo=h}this._virtuaOtherPage&&(this._virtuaOtherPage=!1);w=t.isNullOrUndefined(t.getObject(rt,this._virtualLoadedRecords))?this.model.previousViewData:this._virtualLoadedRecords[rt];c=t.isNullOrUndefined(w)?this._currentJsonData[l]:w[l];c=this._virtualScrollingSelection?this._virtualSelRecords:c;b=this._pageTo*s;!t.isNullOrUndefined(this._virtualdata)&&this._virtualdata.length>0?(i=n(document.getElementsByName(b)[l]).index(),c=this._virtualdata[l],this._virtualdata=[]):n(document.getElementsByName(h*s)).length>0&&!t.isNullOrUndefined(this._pageTo)&&(i=n(document.getElementsByName(h*s)[i%s]).index())}return v={rowIndex:this.model.scrollSettings.enableVirtualization?p:(this._requestType=="save"||this._requestType=="cancel")?i%s:i,row:ut.eq(i),data:c,selectedData:c},u=="selectRows"&&(v.prevRow=d,v.prevRowIndex=k),v},_selectingMultipleRows:function(n){this._modelMultiSelectedIndexes=n;this.clearSelection();this.multiSelectCtrlRequest=!0;for(var t=0;t<n.length;t++)this.selectRows(n[t]);this.multiSelectCtrlRequest=!1;this._modelMultiSelectedIndexes=[]},_virtualSelectAction:function(n,i,r){this.model.scrollSettings.allowVirtualScrolling&&!t.isNullOrUndefined(i)&&(t.isNullOrUndefined(this._virtualLoadedRecords[n])?(this._virtualSelectedRecords[i]=this._currentJsonData[i%r],this._virtualCheckSelectedRecords[(n-1)*r+i]=this._currentJsonData[i%r]):(this._virtualSelectedRecords[i]=this._virtualLoadedRecords[n][i%r],this._virtualCheckSelectedRecords[(n-1)*r+i]=this._virtualLoadedRecords[n][i%r]))},_getSelectedViewData:function(t,i,r){var o=t%this._virtualRowCount,u,f={},e;return u=i?parseInt(n(i).closest("tr").attr("name"),32):r?r:t>1?Math.ceil((t+1)/this._virtualRowCount):1,f.viewIndex=u,this._virtualLoadedRecords[u]&&(f.data=this._virtualLoadedRecords[u][o]),e=t%this._virtualRowCount,f.rowIndex=u*this._virtualRowCount-(this._virtualRowCount-e),f},selectCells:function(r){var y,tt,it,nt,p,e,k,h,c,l,u,v,f,ut,g,d;if(!this._allowcellSelection)return!1;if(this._lastSelectedCellIndex=r,y=null,nt=this._excludeDetailRows(),y=this.model.scrollSettings.frozenColumns?this._frozenCell(r[0][0],r[0][1][0]):nt.eq(r[0][0]).find(".e-rowcell:eq("+r[0][1]+")"),t.isNullOrUndefined(this._previousRowCellIndex)||this._previousRowCellIndex.length==0||(this.model.scrollSettings.enableVirtualization?(tt=this._prevRowCell,it=this._preVirRowCellIndex):(tt=n(this.getRowByIndex(this._previousRowCellIndex[0][0]).find(".e-rowcell:eq("+this._previousRowCellIndex[0][1]+")")),it=this._previousRowCellIndex)),p=this._currentJsonData[r[0][0]],e=r[0][0],this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(k=this._getSelectedViewData(r[0][0],y),p=k.data,e=k.rowIndex),d={currentCell:y,cellIndex:r[0][1],data:p,selectedData:p,previousRowCellIndex:it,previousRowCell:tt},this.model.selectionType=="multiple"&&(d.isCtrlPressed=this.multiSelectCtrlRequest,d.isShiftPressed=this.multiSelectShiftRequest),!this._trigger("cellSelecting",d)){switch(this.model.selectionType){case t.Grid.SelectionType.Multiple:if(this.multiSelectCtrlRequest){g=n.inArray(e,this._rowIndexesColl);g!=-1?this.selectedRowCellIndexes[g].cellIndex.push(parseInt(r[0][1].toString())):(n.inArray(e,this._rowIndexesColl)==-1&&this._rowIndexesColl.push(e),this.selectedRowCellIndexes.push({rowIndex:e,cellIndex:r[0][1]}));y.addClass("e-cellselectionbackground e-activecell");break}else if(this._selectDrag||this.multiSelectShiftRequest&&this._previousRowCellIndex!=i){this.clearCellSelection();this.clearColumnSelection();this.selectedRowCellIndexes=[];var w=this._previousRowCellIndex[0][0],s=parseInt(this._previousRowCellIndex[0][1]),a=r[0][0],o=parseInt(r[0][1]);if(this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(w=this._preVirRowCellIndex[0][0],a=this._getSelectedViewData(a,this.getRowByIndex(a).find(".e-rowcell")).rowIndex),h=[],this.model.selectionSettings.cellSelectionMode=="box"){var et=this.model.scrollSettings.frozenColumns?this.getRows()[0].length-1:this.getRows().length-1,rt=s<o?s:o,ft=rt==o?s:o,b=[],h=[];for(u=rt;u<=ft;u++){if(c=w,l=a,c<l)for(f=c;f<=l;f++)n.inArray(f,b)==-1&&b.push(f),this._selectMultipleCells(f,u,o,s);else for(f=l;f<=c;f++)n.inArray(f,b)==-1&&b.push(f),this._selectMultipleCells(f,u,o,s);h.push(u)}for(u=0;u<b.length;u++)this.selectedRowCellIndexes.push({rowIndex:b[u],cellIndex:h});this._rowIndexesColl=t.distinct(b)}else if(a>w)for(u=w;u<=a;u++){for(h=[],c=u==w?s:0,l=u==a?o:this.model.columns.length-1,f=c;f<=l;f++)h.push(f),this._selectMultipleCells(u,f,o,s);this.selectedRowCellIndexes.push({rowIndex:u,cellIndex:h});this._rowIndexesColl.push(u)}else for(u=w;u>=a;u--){if(h=[],c=u==w?s:this.model.columns.length-1,l=u==a?o:0,c>l)for(f=c;f>=l;f--)h.push(f),this._selectMultipleCells(u,f,o,s);else for(f=l;f>=c;f--)h.push(f),this._selectMultipleCells(u,f,o,s);this.selectedRowCellIndexes.push({rowIndex:u,cellIndex:h});this._rowIndexesColl.push(u)}break}else{for(this.clearCellSelection(),this._virtualRowCellSelIndex=[],u=0;u<r.length;u++)if(r[u][1].length>1)for(v=nt.eq(r[u][0]).find(".e-rowcell"),this.model.scrollSettings.frozenColumns&&(v=n(nt[0]).eq(r[u][0]).find(".e-rowcell").add(n(nt[1]).eq(r[u][0]).find(".e-rowcell"))),f=0;f<v.length;f++)ut=this.model.detailsTemplate!=null||this.model.childGrid!=null?v[f].cellIndex-1:f,n.inArray(ut,r[u][1])!=-1&&(n(v[f]).addClass("e-cellselectionbackground e-activecell"),g=n.inArray(r[u][0],this._rowIndexesColl),g!=-1?this.selectedRowCellIndexes[g].cellIndex.push(v[f].cellIndex):(e=r[u][0],this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(k=this._getSelectedViewData(e,v),p=k.data,e=k.rowIndex),this.selectedRowCellIndexes.push({rowIndex:e,cellIndex:[v[f].cellIndex]}),this._rowIndexesColl.push(r[u][0])));else this.model.scrollSettings.frozenColumns?this._frozenCell(r[u][0],r[u][1][0]).addClass("e-cellselectionbackground e-activecell"):n(this.getRowByIndex(r[u][0]).find(".e-rowcell:eq("+r[u][1]+")")).addClass("e-cellselectionbackground e-activecell"),this.selectedRowCellIndexes.push({rowIndex:e,cellIndex:r[u][1]}),this._rowIndexesColl.push(e);break}case t.Grid.SelectionType.Single:this.clearCellSelection();this.clearColumnSelection();this.selectedRowCellIndexes=[];this._virtualRowCellSelIndex=[];n.inArray(e,this._rowIndexesColl)==-1&&this._rowIndexesColl.push(e);this.selectedRowCellIndexes.push({rowIndex:e,cellIndex:r[0][1]});this.model.scrollSettings.frozenColumns?this._frozenCell(r[0][0],r[0][1][0]).addClass("e-cellselectionbackground e-activecell"):n(this.getRowByIndex(r[0][0]).find(".e-rowcell:eq("+r[0][1]+")")).addClass("e-cellselectionbackground e-activecell")}d={currentCell:y,cellIndex:r[0][1],data:p,selectedData:p,selectedRowCellIndex:this.selectedRowCellIndexes,previousRowCellIndex:it,previousRowCell:tt};this._selectDrag||this.multiSelectShiftRequest&&!t.isNullOrUndefined(this._previousRowCellIndex)||(this._previousRowCellIndex=r,this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(this._preVirRowCellIndex=n.extend(!0,[],r),this._preVirRowCellIndex[0][0]=e),this._prevRowCell=y);t.isNullOrUndefined(r[0][1][0])?n.extend(this._bulkEditCellDetails,{rowIndex:r[0][0],columnIndex:r[0][1]}):n.extend(this._bulkEditCellDetails,{rowIndex:r[0][0],columnIndex:r[0][1][0]});this._trigger("cellSelected",d)}},_selectMultipleCells:function(t,i){var r,u,f;this.model.scrollSettings.frozenColumns?this._frozenCell(t,i).addClass("e-cellselectionbackground e-activecell"):this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization?(r=this._getSelectedViewData(t).viewIndex,n.inArray(r,this._currentLoadedIndexes)!=-1&&(u=this._currentLoadedIndexes.indexOf(r),f=t%this._virtualRowCount+u*this._virtualRowCount,n(this.getRowByIndex(f).find(".e-rowcell:eq("+i+")")).addClass("e-cellselectionbackground e-activecell"),n.inArray(t,this._virtualRowCellSelIndex)==-1&&n.inArray(t,this._rowIndexesColl)!=-1&&t!=this._preVirRowCellIndex[0][0]&&this._virtualRowCellSelIndex.push(t))):n(this.getRowByIndex(t).find(".e-rowcell:eq("+i+")")).addClass("e-cellselectionbackground e-activecell")},selectColumns:function(r,u){var s,v,c,l,f,h,o;if(!this._allowcolumnSelection)return!1;this._allowcolumnSelection=!0;var e=this.getRows(),a=this.getHeaderTable().find(".e-columnheader").last().find("th.e-headercell").not(".e-detailheadercell")[this._previousColumnIndex],o={columnIndex:r==i?u:r,headerCell:n(this.getHeaderTable().find(".e-columnheader").last().find("th.e-headercell").not(".e-detailheadercell")[r]),column:this.model.columns[r],previousColumnIndex:this._previousColumnIndex,prevColumnHeaderCell:a},y=this._previousColumnIndex;if(this._previousColumnIndex=(o.isShiftPressed=this.multiSelectShiftRequest)==!0?r==i?u:r:u,this.model.selectionType=="multiple"&&(o.isCtrlPressed=this.multiSelectCtrlRequest,o.isShiftPressed=this.multiSelectShiftRequest),!this._trigger("columnSelecting",o)){if(t.isNullOrUndefined(u)||t.isNullOrUndefined(r)){r=t.isNullOrUndefined(r)?u:r;switch(this.model.selectionType){case t.Grid.SelectionType.Multiple:if(this.multiSelectCtrlRequest){if(s=n.inArray(r,this.selectedColumnIndexes),s!=-1&&this.clearColumnSelection(r)&&this.selectedColumnIndexes.splice(s,0),s==-1){if(this.selectedColumnIndexes.push(r),this._previousColumnIndex=this.selectedColumnIndexes.length?r:i,this.model.scrollSettings.frozenColumns)this._frozenColumnSelection(e,r);else for(f=0;f<e.length;f++)n(this._excludeDetailCells(e[f])[r]).addClass("e-columnselection");n(this.getHeaderTable().find("th.e-headercell:not(.e-stackedHeaderCell,.e-detailheadercell)")[r]).addClass("e-columnselection")}break}case t.Grid.SelectionType.Single:if(this.clearSelection(),this.clearCellSelection(),this.clearColumnSelection(),this.selectedColumnIndexes=[],this.selectedColumnIndexes.push(r),this._previousColumnIndex=this.selectedColumnIndexes.length?r:i,this.model.scrollSettings.frozenColumns)this._frozenColumnSelection(e,r);else for(f=0;f<e.length;f++)n(this._excludeDetailCells(e[f])[r]).addClass("e-columnselection");n(this.getHeaderTable().find("th.e-headercell:not(.e-stackedHeaderCell,.e-detailheadercell)")[r]).addClass("e-columnselection")}}else if(this.model.selectionType==t.Grid.SelectionType.Multiple)if(this.clearColumnSelection(),this.selectedColumnIndexes=[],v=0,(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&(v=1),c=r>u?u:r,l=r>u?r+1:u+1,this.model.scrollSettings.frozenColumns)this._frozenColumnSelection(e,c,l);else for(f=c;f<l;f++){for(h=0;h<e.length;h++)n(this._excludeDetailCells(e[h])[f]).addClass("e-columnselection");n(this.getHeaderTable().find("th.e-headercell:not(.e-stackedHeaderCell,.e-detailheadercell)")[f]).addClass("e-columnselection");this.selectedColumnIndexes.push(f)}o={columnIndex:r==i?u:r,headerCell:n(this.getHeaderTable().find(".e-columnheader").last().find("th").not(".e-detailheadercell")[r]),column:this.model.columns[r],selectedColumnIndex:this.selectedColumnIndexes,previousColumnIndex:y,prevColumnHeaderCell:a};this._trigger("columnSelected",o)}},clearSelection:function(r,u){var y=r,ut=n(this.getRows()),f={},o=n(this.getRows()),r,h,p,d,c,l,w,u,g,a,nt,tt,e,it,ft,rt,s,b,v,k;if(this._selectedRow()>=-1){if(o=this.model.scrollSettings.frozenColumns||!t.isNullOrUndefined(this.model.detailsTemplate||this.model.childGrid)?this._excludeDetailRows():n(this.element.find("tr[aria-selected='true']")),h=o.find("td").hasClass("e-selectionbackground e-active"),h){if(p=n(this.getContent().find("tr[aria-selected='true']")),this.model.scrollSettings.allowVirtualScrolling)t.isNullOrUndefined(r)?(w=this.selectedRowsIndexes[0],u=this.getSelectedRecords().length&&this._enableCheckSelect&&this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization?this.element.find(".e-headercheckcelldiv .e-checkselectall"):p[0]):w=r,g=this.selectedRowsIndexes,f=this._getVirtualRows(w,u,"clearSelection",g);else{for(t.isNullOrUndefined(r)||(this.model.editSettings.editMode=="batch"&&n(o[r]).hasClass("e-insertedrow")?(d=this.batchChanges.added.reverse(),e=d[r],this.batchChanges.added.reverse()):e=this.model.editSettings.editMode=="batch"?this._currentJsonData[r-this.batchChanges.added.length]:this._currentJsonData[r]),c=[],l=0;l<this.selectedRowsIndexes.length;l++)c.push(this._currentJsonData[this.selectedRowsIndexes[l]]);f={rowIndex:r==i?this.selectedRowsIndexes:r,row:r==i?p:ut.eq(r),data:r==i?c:e,selectedData:r==i?c:e}}if(n(u)&&n(u).hasClass("e-checkselectall")&&(f.data=this._isLocalData?this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json:this._dataSource():this._currentJsonData),this._trigger("rowDeselecting",f))return}if(t.isNullOrUndefined(r)){if(it=o,this.model.scrollSettings.enableVirtualization)for(rt in this._virtualLoadedRows)n.merge(it,this._virtualLoadedRows[rt]);o.removeAttr("aria-selected").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").removeClass("e-selectionbackground").removeClass("e-active");this._clearVirtualSelection||(this.selectedRowsIndexes=[],this.model.selectedRecords=[],this._virtualSelectedRowIndex=[],this._selectedMultipleRows().length&&this._selectedMultipleRows([]));this._selectionByGrid||this.initialRender&&this._isMapSelection||(o.find(".e-checkcelldiv [type=checkbox]").prop("checked",!1),ft=null,this._isMapSelection&&h&&this._trigger("rowDeselected",f),Array.prototype.push.apply(this.model.selectedRecords,this.getSelectedRecords()))}else this.getRowByIndex(r).removeAttr("aria-selected").find(".e-selectionbackground").removeClass("e-selectionbackground").removeClass("e-active"),a=this.getRowByIndex(r),this.model.scrollSettings.enableVirtualization&&this.multiSelectCtrlRequest&&!this._enableCheckSelect&&(nt=parseInt(a.attr("name"),32)*this._virtualRowCount,tt=this._virtualRowCount-a.index()%this._virtualRowCount,r=nt-tt),r=n.inArray(r,this.selectedRowsIndexes),r!=-1&&(this.selectedRowsIndexes.splice(r,1),this._selectedMultipleRows(this.selectedRowsIndexes),this.model.selectedRecords.splice(r,1)),r!=-1&&this.model.scrollSettings.enableVirtualization&&this._virtualSelectedRowIndex.splice(r,1),this._enableCheckSelect&&!u&&a.find(".e-checkcelldiv [type=checkbox]").prop("checked",!1),this._isMapSelection&&(this._selectionByGrid||t.isNullOrUndefined(r)||r==-1||(e=this._currentJsonData[y],e[this._selectionMapColumn]=!1,this.updateRecord(this._primaryKeys[0],e,"update")),this._trigger("rowDeselected",f),Array.prototype.push.apply(this.model.selectedRecords,this.getSelectedRecords()));this._enableCheckSelect&&(!this._selectAllCheck&&(this.selectedRowsIndexes.length!=this._currentJsonData.length||this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&[].concat.apply([],this.checkSelectedRowsIndexes).length>=this._gridRecordsCount)&&this.getHeaderTable().find(".e-headercheckcelldiv .e-checkselectall").prop("checked",!1),s=this._currentPage()-1,this.model.scrollSettings.enableVirtualization&&f.row&&(b=parseInt(f.row.attr("name"),32),v=b%(this.model.pageSettings.pageSize/this._virtualRowCount),v==0&&(v=this.model.pageSettings.pageSize/this._virtualRowCount),s=Math.ceil(b*this._virtualRowCount/this.model.pageSettings.pageSize)-1,y=f.rowIndex%this._virtualRowCount+(v*this._virtualRowCount-this._virtualRowCount)),k=n.inArray(y,this.checkSelectedRowsIndexes[s]),k!=-1&&this.checkSelectedRowsIndexes[s].splice(k,1),this.selectedRowsIndexes.length||this._isMapSelection||u||(this.checkSelectedRowsIndexes[s]=[],o.find(".e-checkcelldiv [type=checkbox]").prop("checked",!1)));this.selectedRowsIndexes.length||this._selectedRow(-1)}return this.model._checkSelectedRowsIndexes=this.checkSelectedRowsIndexes,n(u)&&n(u).hasClass("e-checkselectall")&&(f.data=this._isLocalData?this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json:this._dataSource():this._currentJsonData),h&&!this._isMapSelection&&this._trigger("rowDeselected",f)?!0:void 0},_excludeDetailRows:function(){return t.isNullOrUndefined(this.model.detailsTemplate||this.model.childGrid||this.model.showSummary)||this.model.scrollSettings.frozenColumns?this.model.scrollSettings.frozenColumns>0&&this.getRows()!=null&&this.getRows().length>1?n(this.getRows()[0]).not(".e-detailrow,.e-gridSummaryRows").add(n(this.getRows()[1]).not(".e-detailrow,.e-gridSummaryRows")):n(this.getRows()):n(this.getRows()).not(".e-detailrow,.e-gridSummaryRows")},clearCellSelection:function(r,u){var e,l,a,h,o,s,f;if(this._allowcellSelection){if(e=t.isNullOrUndefined(r)&&t.isNullOrUndefined(this.model.detailsTemplate||this.model.childGrid)?n(this.element.find(".e-cellselectionbackground")).parent():this._excludeDetailRows(),h=e.find("td").hasClass("e-cellselectionbackground e-activecell"),h){l=this.model.scrollSettings.frozenColumns&&!t.isNullOrUndefined(r)?this._frozenCell(r,u):this.getContent().find(".e-cellselectionbackground");var c=[],y=[u],v=[];for(o=0;o<this.selectedRowCellIndexes.length;o++)for(c.push(this._currentJsonData[this.selectedRowCellIndexes[o].rowIndex]),f=0;f<this.selectedRowCellIndexes[o].cellIndex.length;f++)v.push(this.selectedRowCellIndexes[o].cellIndex[f]);if(s={currentCell:(r||u)==i?l:e.eq(r).find(".e-rowcell").eq(u),cellIndex:(r||u)==i?v:y,data:(r||u)==i?c:this._currentJsonData[r],selectedData:(r||u)==i?c:this._currentJsonData[r]},this.model.selectionType=="multiple"&&(s.isCtrlPressed=this.multiSelectCtrlRequest,s.isShiftPressed=this.multiSelectShiftRequest),this._trigger("cellDeselecting",s))return!0}if(t.isNullOrUndefined(r))this.model.scrollSettings.frozenColumns&&(e=n(e[0]).add(e[1])),e.find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").removeClass("e-cellselectionbackground").removeClass("e-activecell"),this.selectedRowCellIndexes=[],this._rowIndexesColl=[];else{for(f=0;f<this.selectedRowCellIndexes.length;f++)if(this.selectedRowCellIndexes[f].rowIndex==r){a=n.inArray(u,this.selectedRowCellIndexes[f].cellIndex);this.model.scrollSettings.frozenColumns?this._frozenCell(r,u).removeClass("e-cellselectionbackground").removeClass("e-activecell"):e.eq(r).find(".e-rowcell").eq(u).removeClass("e-cellselectionbackground").removeClass("e-activecell");break}f!=this.selectedRowCellIndexes.length&&(this.selectedRowCellIndexes[f].cellIndex.splice(a,1),this.selectedRowCellIndexes[f].cellIndex.length==0&&(this.selectedRowCellIndexes.splice(f,1),this._rowIndexesColl.splice(n.inArray(r,this._rowIndexesColl),1)))}}if(h&&this._trigger("cellDeselected",s))return!0},clearColumnSelection:function(r){var s,h,e,c,l,u,o;if(this._allowcolumnSelection){var f=n(this._excludeDetailRows()),v=n(this.getHeaderTable().find("th.e-headercell:not(.e-stackedHeaderCell)")),a=v.hasClass("e-columnselection");if(a){for(s=[],h=[],u=0;u<this.selectedColumnIndexes.length;u++)s.push(this.model.columns[this.selectedColumnIndexes[u]]),h.push(n(this.getHeaderTable().find(".e-columnheader").last().find("th.e-headercell").not(".e-detailheadercell")[this.selectedColumnIndexes[u]]));if(e={columnIndex:r==i?this.selectedColumnIndexes:r,headerCell:r==i?h:n(this.getHeaderTable().find(".e-columnheader").last().find("th.e-headercell").not(".e-detailheadercell")[r]),column:r==i?s:this.model.columns[r]},this.model.selectionType=="multiple"&&(e.isCtrlPressed=this.multiSelectCtrlRequest,e.isShiftPressed=this.multiSelectShiftRequest),this._trigger("columnDeselecting",e))return}if(t.isNullOrUndefined(r))f.find(".e-rowcell").removeClass("e-columnselection"),n(this.getHeaderTable().find("th.e-headercell:not(.e-stackedHeaderCell)")).removeClass("e-columnselection"),this.selectedColumnIndexes=[];else{if(c=0,(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&(++r,c=1),this.model.scrollSettings.frozenColumns)for(l=r,r>=this.model.scrollSettings.frozenColumns?(l=r-this.model.scrollSettings.frozenColumns,f=n(this.getContent).find(".e-movablecontent").find("tr")):f=n(this.getContent).find(".e-frozencontentdiv").find("tr"),u=0;u<f.length;u++)n(f[u].cells[l]).removeClass("e-columnselection");else for(o=0;o<f.length;o++)n(f[o].cells[r]).removeClass("e-columnselection");n(this.getHeaderTable().find("th.e-headercell:not(.e-stackedHeaderCell)")[r]).removeClass("e-columnselection");this.selectedColumnIndexes.splice(0,r-c)}}if(a&&this._trigger("columnDeselected",e))return!0},getSelectedRows:function(){for(var i=n(),t=0;t<this.selectedRowsIndexes.length;t++)this.model.scrollSettings.frozenColumns>0?(i.push(this.getRowByIndex(this.selectedRowsIndexes[t])[0]),i.push(this.getRowByIndex(this.selectedRowsIndexes[t])[1])):i.push(this.getRowByIndex(this.selectedRowsIndexes[t])[0]);return i},getSelectedRecords:function(){var u=[],h=this.getRows(),e,f,o,r,i,s;if(this._virtualScrollingSelection)return this._virtualSelRecords;if(e=!1,this.model.scrollSettings.allowVirtualScrolling&&this._enableCheckSelect)for(i=0;i<this.checkSelectedRowsIndexes.length;i++){if(!t.isNullOrUndefined(this.checkSelectedRowsIndexes[i]))for(f=0;f<this.checkSelectedRowsIndexes[i].length;f++){if(this._currentJsonData.length<=f&&!this._isLocalData){e=!0;break}o=i*this.model.pageSettings.pageSize+this.checkSelectedRowsIndexes[i][f];u.push(this._virtualCheckSelectedRecords[o])}if(e)break}else for(r=this.model.scrollSettings.enableVirtualization?this._virtualSelectedRowIndex:this.selectedRowsIndexes,i=0;i<r.length;i++)r[i]!=-1&&(this.model.editSettings.editMode=="batch"&&n(h[r[i]]).hasClass("e-insertedrow")?(s=this.batchChanges.added.reverse(),u.push(s[r[i]]),this.batchChanges.added.reverse()):this.model.scrollSettings.allowVirtualScrolling&&!this._enableCheckSelect?u.push(this._virtualSelectedRecords[r[i]]):this.model.editSettings.editMode=="batch"?u.push(this._currentJsonData[r[i]-this.batchChanges.added.length]):u.push(this._currentJsonData[r[i]]));return u},_setCurrentRow:function(n){var i,r;(n==t.Grid.Actions.Refresh||n==t.Grid.Actions.Ungrouping||n==t.Grid.Actions.Grouping||n==t.Grid.Actions.Filtering||n==t.Grid.Actions.Sorting||n==t.Grid.Actions.Paging||n==t.Grid.Actions.Search||(n==t.Grid.Actions.Delete||n==t.Grid.Actions.Cancel)&&this.model.currentViewData!=null&&this.model.currentViewData.length==0)&&(this._selectedRow(-1),this._selectedMultipleRows([]),this._virtualDataRefresh&&n!=t.Grid.Actions.Refresh||(this.selectedRowsIndexes=[]));!this._isMapSelection&&this._currentJsonData.length&&n==t.Grid.Actions.Delete&&this._selectedRow()>=this._currentJsonData.length&&(i=this._currentJsonData.length-1,this._selectedRow(i),this._selectedMultipleRows([i]),this._virtualDataRefresh&&n!=t.Grid.Actions.Refresh||(this.selectedRowsIndexes=i));this._isMapSelection||n!=t.Grid.Actions.Delete&&(n!=t.Grid.Actions.Save||this._isMapSelection)||this.model.selectedRowIndex==-1||(r=this.getRowByIndex(this.model.selectedRowIndex),this.selectRows(this.model.selectedRowIndex,null,r));(n==t.Grid.Actions.Save||n==t.Grid.Actions.Cancel)&&this.element.focus()},_renderMultiTouchDialog:function(){var n,r,i;this._customPop=t.buildTag("div.e-gridpopup","",{display:"none"});n=t.buildTag("div.e-content");r=t.buildTag("div.e-downtail e-tail");this.model.allowMultiSorting&&(i=t.buildTag("span.e-sortdirect e-icon"),n.append(i));this.model.selectionType==t.Grid.SelectionType.Multiple&&(i=t.buildTag("span.e-rowselect e-icon"),n.append(i));this._customPop.append(n);this._customPop.append(r);this.element.append(this._customPop)}}}(jQuery,Syncfusion),function(n,t,i){t.gridFeatures=t.gridFeatures||{};t.widget("ejGrid","ej.Grid",{_rootCSS:"e-grid",element:null,validTags:["div"],model:null,_requiresID:!0,keyConfigs:{focus:"e",insertRecord:"45",deleteRecord:"46",editRecord:"113",saveRequest:"13",cancelRequest:"27",nextPage:"34",previousPage:"33",lastPage:"ctrl+alt+34",firstPage:"ctrl+alt+33",nextPager:"alt+34",previousPager:"alt+33",firstCellSelection:"36",lastCellSelection:"35",firstRowSelection:"ctrl+36",lastRowSelection:"ctrl+35",rowUpSelection:"ctrl+shift+38",rowDownSelection:"ctrl+shift+40",randomSelection:"ctrl+shift+83",upArrow:"38",downArrow:"40",rightArrow:"39",leftArrow:"37",moveCellRight:"9",moveCellLeft:"shift+9",selectedGroupExpand:"alt+40",totalGroupExpand:"ctrl+40",selectedGroupCollapse:"alt+38",totalGroupCollapse:"ctrl+38",multiSelectionByUpArrow:"shift+38",multiSelectionByDownArrow:"shift+40",multiSelectionByRightArrow:"shift+39",multiSelectionByLeftArrow:"shift+37"},_ignoreOnPersist:["actionBegin","actionComplete","actionFailure","batchAdd","batchDelete","beforeBatchSave","beforeBatchAdd","beforeBatchDelete","beginEdit","cellEdit","cellSave","cellSelecting","cellSelected","cellDeselecting","cellDeselected","columnDrag","columnDragStart","columnDrop","columnSelecting","columnSelected","columnDeselecting","columnDeselected","create","dataBound","destroy","detailsCollapse","detailsExpand","endAdd","endDelete","endEdit","recordClick","recordDoubleClick","load","resized","resizeEnd","resizeStart","rightClick","rowSelected","rowSelecting","rowDeselected","rowDeselecting","rowDrag","rowDragStart","rowDrop","templateRefresh","beforePrint","beforeRowDrop","query","isEdit","toolbarClick","queryCellInfo","mergeCellInfo","mergeHeaderCellInfo","currentViewData","enableAltRow","enableRTL","contextClick","contextOpen","rowDataBound","rowTemplate","detailsDataBound","detailsTemplate","childGrid","summaryRows","toolbarSettings","editSettings","allowMultiSorting","enableAutoSaveOnSelectionChange","locale","allowCellMerging","allowTextWrap","textWrapSettings","cssClass","dataSource","groupSettings.enableDropAreaAutoSizing","enableRowHover","showSummary","allowGrouping","enableHeaderHover","allowKeyboardNavigation","scrollSettings.frozenRows","scrollSettings.frozenColumns","enableTouch","contextMenuSettings.enableContextMenu","exportToExcelAction","exportToWordAction","exportToPdfAction"],ignoreOnExport:["isEdit","toolbarClick","query","queryCellInfo","selectionType","currentViewData","rowDataBound","rowTemplate","detailsDataBound","editSettings","pageSettings","enableAutoSaveOnSelectionChange","localization","allowScrolling","cssClass","dataSource","groupSettings.enableDropAreaAnimation","enableRowHover","allowSummary","enableHeaderHover","allowKeyboardNavigation","currentIndex"],ignoreOnToolbarServerClick:[],observables:["dataSource","selectedRowIndex","pageSettings.currentPage","selectedRowIndices"],_tags:[{tag:"columns",attr:["allowEditing","allowFiltering","allowTextWrap","filterType","allowGrouping","allowResizing","allowSorting","cssClass","customAttributes","dataSource","defaultValue","disableHtmlEncode","editTemplate","editType","foreignKeyField","foreignKeyValue","headerTemplateID","headerText","isFrozen","isIdentity","isPrimaryKey","filterBarTemplate","filterOperator","textAlign","templateID","textAlign","headerTextAlign","tooltip","clipMode","validationRules.minlength","validationRules.maxlength","validationRules.range","validationRules.number","validationRules.required","editParams.decimalPlaces",[{tag:"commands",attr:["type","buttonOptions"]}]],content:"template"},{tag:"summaryRows",attr:["showCaptionSummary","showTotalSummary",[{tag:"summaryColumns",attr:["customSummaryValue","dataMember","displayColumn","summaryType","template"]}]]},{tag:"stackedHeaderRows",attr:[[{tag:"stackedHeaderColumns",attr:["headerText","column"]}]]},{tag:"filterSettings.filteredColumns",attr:[]},{tag:"sortSettings.sortedColumns",attr:[]}],_dataSource:t.util.valueFunction("dataSource"),_selectedRow:t.util.valueFunction("selectedRowIndex"),_selectedMultipleRows:t.util.valueFunction("selectedRowIndices"),_currentPage:t.util.valueFunction("pageSettings.currentPage"),defaults:{allowPaging:!1,showColumnChooser:!1,gridLines:"both",allowSorting:!1,showStackedHeader:!1,selectedRecords:[],stackedHeaderRows:[],allowFiltering:!1,allowMultipleExporting:!1,allowSelection:!0,allowGrouping:!1,showSummary:!1,allowResizing:!1,allowResizeToFit:!1,allowTextWrap:!1,allowCellMerging:!1,enableRowHover:!0,enablePersistence:!1,enableFocusout:!1,selectedRowIndex:-1,selectedRowIndices:[],allowSearching:!1,enableToolbarItems:!1,enableHeaderHover:!1,allowReordering:!1,allowKeyboardNavigation:!0,allowRowDragAndDrop:!1,enableTouch:!0,enableLoadOnDemand:!1,columnLayout:"auto",selectionType:"single",dataSource:null,cssClass:"",allowScrolling:!1,locale:"en-US",enableAutoSaveOnSelectionChange:!0,allowMultiSorting:!1,exportToExcelAction:"ExportToExcel",exportToWordAction:"ExportToWord",exportToPdfAction:"ExportToPdf",_groupingCollapsed:[],_isHeightResponsive:!1,_checkSelectedRowsIndexes:[],editSettings:{allowEditing:!1,showAddNewRow:!1,allowAdding:!1,showAddNewRow:!1,allowDeleting:!1,editMode:"normal",rowPosition:"top",dialogEditorTemplateID:null,allowEditOnDblClick:!0,externalFormTemplateID:null,inlineFormTemplateID:null,formPosition:"bottomleft",titleColumn:null,showConfirmDialog:!0,showDeleteConfirmDialog:!1},selectionSettings:{selectionMode:["row"],enableToggle:!1,allowDragSelection:!1,cellSelectionMode:"flow"},resizeSettings:{resizeMode:"normal"},pageSettings:{pageSize:12,pageCount:8,currentPage:1,totalPages:null,enableTemplates:!1,showDefaults:!1,template:null,pageSizeList:[],totalRecordsCount:null,enableQueryString:!1,printMode:"allpages"},groupSettings:{showDropArea:!0,showToggleButton:!1,showGroupedColumn:!0,showUngroupButton:!0,enableDropAreaAutoSizing:!0,captionFormat:null,groupedColumns:[]},contextMenuSettings:{enableContextMenu:!1,contextMenuItems:["Add Record","Edit Record","Delete Record","Sort In Ascending Order","Sort In Descending Order","Next Page","Last Page","Previous Page","First Page","Save","Cancel","Grouping","Ungrouping"],customContextMenuItems:[],subContextMenu:[],disableDefaultItems:!1},filterSettings:{filterType:"filterbar",filterBarMode:"immediate",showFilterBarStatus:!0,statusBarWidth:450,showPredicate:!1,filteredColumns:[],enableInterDeterminateState:!0,maxFilterChoices:1e3,enableCaseSensitivity:!1,immediateModeDelay:1500,enableComplexBlankFilter:!0,blankValue:"",ignoreAccent:!1},searchSettings:{fields:[],key:"",operator:"contains",ignoreCase:!0},sortSettings:{sortedColumns:[]},toolbarSettings:{showToolbar:!1,toolbarItems:[],customToolbarItems:[]},minWidth:0,currentIndex:0,rowDropSettings:{dragBehavior:"move",dropMapper:null,dragMapper:null,dropTargetID:null},scrollSettings:{width:"auto",height:0,enableTouchScroll:!0,allowVirtualScrolling:!1,virtualScrollMode:"normal",frozenRows:0,frozenColumns:0,buttonSize:18,autoHide:!1,scrollerSize:18,scrollOneStepBy:57,enableVirtualization:!1},textWrapSettings:{wrapMode:"both"},summaryRows:[],enableRTL:!1,enableAltRow:!0,currentViewData:[],detailsTemplate:null,childGrid:null,keySettings:null,rowTemplate:null,detailsDataBound:null,rowDataBound:null,queryCellInfo:null,mergeCellInfo:null,mergeHeaderCellInfo:null,create:null,actionBegin:null,actionComplete:null,actionFailure:null,beginEdit:null,endEdit:null,endAdd:null,endDelete:null,beforeBatchAdd:null,beforeBatchSave:null,beforeBatchDelete:null,beforePrint:null,batchAdd:null,batchDelete:null,cellSave:null,cellEdit:null,resizeStart:null,resizeEnd:null,resized:null,load:null,destroy:null,rowSelecting:null,rowSelected:null,rowHover:null,rowDeselecting:null,rowDeselected:null,cellSelecting:null,cellSelected:null,cellDeselecting:null,cellDeselected:null,columnSelecting:null,columnSelected:null,columnDeselecting:null,columnDeselected:null,columnDragStart:null,columnDrag:null,columnDrop:null,rowDrag:null,rowDragStart:null,rowDrop:null,beforeRowDrop:null,dataBound:null,recordClick:null,recordDoubleClick:null,templateRefresh:null,rightClick:null,detailsCollapse:null,detailsExpand:null,toolbarClick:null,contextOpen:null,contextClick:null,columns:[],query:null,isEdit:!1,isResponsive:!1,enableResponsiveRow:!1,virtualLoading:null},dataTypes:{dataSource:"data",query:"data",columns:"array",childGrid:"parent",gridLines:"enum",summaryRows:"array",stackedHeaderRows:"array",toolbarSettings:{toolbarItems:"array",customToolbarItems:"array"},contextMenuSettings:{contextMenuItems:"array",customContextMenuItems:"array",subContextMenu:"array"},selectionSettings:{cellSelectionMode:"enum",selectionMode:"array",selectedRecords:"array"},sortSettings:{sortedColumns:"array"},filterSettings:{filteredColumns:"array",filterType:"enum",filterBarMode:"enum"},groupSettings:{groupedColumns:"array"},pageSettings:{pageSizeList:"array"},editSettings:{editMode:"enum",formPosition:"enum",rowPosition:"enum"},rowDropSettings:{dragBehavior:"enum"},searchSettings:{fields:"array"},textWrapSettings:{wrapMode:"enum"}},_columns:function(){var n=this.element.find(".e-gridheader");n.find("div").first().empty().append(this._renderGridHeader().find("table"));this._headerCellgDragDrop();this.refreshContent(!0);this._trigger("refresh")},_summaryRows:function(n,i,r){var u,e,f;(i=="showTotalSummary"||i=="showCaptionSummary")&&(u=n.summaryRows,e=r.toLowerCase()=="true"||r.toLowerCase()=="false"?t.parseJSON(r):!1,this.option("summaryRows")[u][i]=e);this.element.find(".e-gridfooter").remove();f=this._renderGridFooter();t.isNullOrUndefined(f)||f.insertAfter(this.getContent());(i=="showCaptionSummary"||i=="title")&&(this._isCaptionSummary=this.option("summaryRows")[u].showCaptionSummary,this.model.showSummary=this._isCaptionSummary,this.model.groupSettings.groupedColumns.length!=0&&this._refreshCaptionSummary())},_summaryRows_summaryColumns:function(n,i,r){(i=="displayColumn"||i=="dataMember")&&t.isNullOrUndefined(this.getColumnByField(r))||(this._createSummaryRows(this.getFooterTable()),this.element.find(".e-groupcaptionsummary").length!=0&&this._refreshCaptionSummary())},_stackedHeaderRows_stackedHeaderColumns:function(){this._refreshStackedHeader()},_sortSettings_sortedColumns:function(n,t,i){var u,f,r=this.model.sortSettings.sortedColumns[n["sortSettings.sortedColumns"]];t=="field"?(u=this.getColumnByField(i)!=null?i:null,f=r.direction=="ascending"||r.direction=="descending"?r.direction:null):t=="direction"&&(u=this.getColumnByField(r.field)!=null?r.field:null,f=i=="ascending"||i=="descending"?i:null);u!=null&&f!=null&&this.sortColumn(u,f)},_filterSettings_filteredColumns:function(n,i,r){var f,e,o,s,h,u=this.model.filterSettings.filteredColumns[n["filterSettings.filteredColumns"]];switch(i){case"field":f=this.getColumnByField(r)!=null?r:null;e=this._map(t.FilterOperators,u.operator);h=u.value;s=u.predicate=="and"||u.predicate=="or"?u.predicate:null;o=u.matchcase;break;case"matchcase":f=this.getColumnByField(u.field)!=null?u.field:null;e=this._map(t.FilterOperators,u.operator);h=u.value;s=u.predicate=="and"||u.predicate=="or"?u.predicate:null;o=r.toLowerCase()=="true"||r.toLowerCase()=="false"?t.parseJSON(r):!1;break;case"operator":f=this.getColumnByField(u.field)!=null?u.field:null;e=this._map(t.FilterOperators,r);h=u.value;s=u.predicate=="and"||u.predicate=="or"?u.predicate:null;o=u.matchcase;break;case"predicate":f=this.getColumnByField(u.field)!=null?u.field:null;e=this._map(t.FilterOperators,u.operator);h=u.value;s=r=="and"||r=="or"?r:null;o=u.matchcase;break;case"value":f=this.getColumnByField(u.field)!=null?u.field:null;e=this._map(t.FilterOperators,u.operator);h=r;s=u.predicate=="and"||u.predicate=="or"?u.predicate:null;o=u.matchcase}f!=null&&e!=null&&h!=null&&s!=null&&o!=null&&this.filterColumn(f,e,h,s,o)},_map:function(t,i){var r=n.map(t,function(n){if(n===i)return n});return r.length!=0?r[0]:null},_refreshCaptionSummary:function(){var t=document.createElement("div");t.innerHTML=["<table>",n.render[this._id+"_GroupingTemplate"](this.model.currentViewData,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join("");this.getContentTable().get(0).replaceChild(t.firstChild.firstChild,this.getContentTable().get(0).lastChild);this.refreshContent()},getContentTable:function(){return this._gridContentTable},setGridContentTable:function(n){this._gridContentTable=n},getContent:function(){return this._gridContent},setGridContent:function(n){this._gridContent=n},getHeaderContent:function(){return this._gridHeaderContent},setGridHeaderContent:function(n){this._gridHeaderContent=n},getHeaderTable:function(){return this._gridHeaderTable},setGridHeaderTable:function(n){this._gridHeaderTable=n},getRows:function(){return this._gridRows},getFilteredRecords:function(){return this._filteredRecords},getRowByIndex:function(i,r){var e;try{var f=this.getRows(),o=this._excludeDetailRows(),u=n();if(n.isArray(i)){for(e=0;e<i.length;e++)this.model.scrollSettings.frozenColumns>0?(u.push(f[0][i[e]]),u.push(f[1][i[e]])):u.push(f[i[e]]);return u}return t.isNullOrUndefined(r)?this.model.scrollSettings.frozenColumns>0?(u.push(f[0][i]),u.push(f[1][i]),u):n(o.not(".e-virtualrow")[i]):this.model.scrollSettings.frozenColumns>0?(u.push(n(f[0]).slice(i,r)),u.push(n(f[1]).slice(i,r)),u):n(o.not(".e-virtualrow").slice(i,r))}catch(s){return n()}},getColumnIndexByField:function(n){for(var t=0,i=this.model.columns,r=i.length;t<r;t++)if(i[t].field===n)return t;return-1},getColumnIndexByHeaderText:function(n,i){for(var r=0;r<this.model.columns.length;r++)if(this.model.columns[r].headerText==n)if(i){if(t.isNullOrUndefined(this.model.columns[r].field)||this.model.columns[r].field=="")break}else break;return r},getIndexByRow:function(t){var r=this.getRows(),u=this._excludeDetailRows(),i;return this.model.scrollSettings.frozenColumns>0?(i=n(r[0]).index(t),i==-1&&(i=n(r[1]).index(t)),i):u.not(".e-virtualrow").index(t)},getPrimaryKeyFieldNames:function(){if(this._primaryKeys.length!=0)return this._primaryKeys;for(var n=0,t=this.model.columns,i=t.length;n<i;n++)t[n].isPrimaryKey&&this._primaryKeys.push(t[n].field);return this._primaryKeys},getVisibleColumnNames:function(){return this._visibleColumns},getHiddenColumnNames:function(){return this._hiddenColumns},getColumnByField:function(n){for(var t=0;t<this.model.columns.length;t++)if(this.model.columns[t].field==n)break;return t==this.model.columns.length?null:this.model.columns[t]},getsortColumnByField:function(n){for(var t=0;t<this.model.sortSettings.sortedColumns.length;t++)if(this.model.sortSettings.sortedColumns[t].field==n)break;return t==this.model.sortSettings.sortedColumns.length?null:this.model.sortSettings.sortedColumns[t]},getColumnByHeaderText:function(n,i){for(var r=0;r<this.model.columns.length;r++)if(this.model.columns[r].headerText==n)if(i){if(t.isNullOrUndefined(this.model.columns[r].field)||this.model.columns[r].field=="")break}else break;return r==this.model.columns.length?null:this.model.columns[r]},getCurrentViewData:function(){return this._currentJsonData},getColumnFieldNames:function(){for(var t=[],n=0;n<this.model.columns.length;n++)this.model.columns[n].field&&t.push(this.model.columns[n].field);return t},getBrowserDetails:function(){var t=navigator.userAgent.match(/(firefox|chrome|opera|msie|safari)\s?\/?(\d+(.\d+)*)/i);return!!navigator.userAgent.match(/Trident\/7\./)||!!navigator.userAgent.match(/Edge/)?{browser:"msie",version:n.uaMatch(navigator.userAgent).version}:{browser:t[1].toLowerCase(),version:t[2]}},_initPrivateProperties:function(){this._groupContextIndex=-1;this._dynamicSelectedRowIndex=null;this._summaryContextIndex=-1;this._showInColumnchooserCol=[];this._currentVirtualRowIndex=0;this._isCheckboxChecked=!1;this._isCheckboxUnchecked=!1;this._click=0;this._gridPhoneMode=320;this._columntemplaterefresh=!1;this._enterKey=!1;this._tabKey=!1;this._gridHeaderTable=null;this._gridWidth=this.element.width();this._id=this.element.attr("id");this._gridRows=[];this._fltrBarcell=!1;this._unboundRow=null;this._gridContentTable=null;this._gridContent=null;this._remoteSummaryData=null;this._gridSort=null;this._gridHeaderContent=null;this._gridFooterContent=null;this._gridFooterTable=null;this._gridRecordsCount=this._dataSource()!==null?this.model.pageSettings.totalRecordsCount==null?this._dataSource().length:this.model.pageSettings.totalRecordsCount:0;this._links=null;this._gridPager=null;this._cSortedColumn=null;this._cSortedDirection=null;this._$curSElementTarget=null;this._gridFilterBar=null;this._$curFieldName=null;this._$curFilterValue=null;this._$prevFieldName=null;this._editedData={};this._isEditChangesApplied=!1;this._mediaStatus=!1;this._$fDlgIsOpen=!1;this._$menuDlgIsOpen=!1;this._$colType=null;this._$colFormat=null;this._$prevColType=null;this._$prevSElementTarget=null;this._currentFilterColumn=null;this._filteredRecordsCount=null;this._filteredRecords=[];this._validatedColumns=[];this.filterColumnCollection=[];this._previousFilterCount=null;this._excelFilter=null;this._isExcelFilter=this.model.filterSettings.filterType=="excel";this._$fkColumn=!1;this._fkParentTblData=[];this._primaryKeys=[];this._identityKeys=[];this._primaryKeyValues=[];this._modifiedRecords=[];this._addedRecords=[];this._tdsOffsetWidth=[];this._deletedRecords=[];this._disabledToolItems=n();this._validationRules={};this._groupedColumns=[];this._LastColumnUnGroup=!1;this._scolumns=[];this._currentJsonData=[];this._groupingColumnIndex=0;this._dataManager=this._dataSource()instanceof t.DataManager?this._dataSource():this._dataSource()!=null?t.DataManager(this._dataSource()):null;this._dataManager!=null&&this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&this.model.pageSettings.totalRecordsCount!=null&&this._dataManager.dataSource.json!=null&&this._dataManager.dataSource.json.splice(this.model.pageSettings.totalRecordsCount);this._isRemoteSaveAdaptor=this._dataSource()instanceof t.DataManager&&this._dataSource().adaptor instanceof t.remoteSaveAdaptor;this._isLocalData=!0;this._disabledResizingColumns=[];this._disabledSortableColumns=[];this._disabledGroupableColumns=[];this._disabledFilterableColumns=[];this._disabledEditableColumns=[];this._hiddenColumns=[];this._visibleColumns=[];this._visibleColumnsField=[];this._hiddenColumnsField=[];this._ccVisibleColumns=[];this._ccHiddenColumns=[];this._sortedColumns=[];this.multiSortRequest=!1;this.multiSelectCtrlRequest=!1;this.multiSelectShiftRequest=!1;this._enableSelectMultiTouch=!1;this._enableSortMultiTouch=!1;this._templateRefresh=!1;this.initialRender=!1;this._selectDrag=!1;this._isAddNew=!1;this._fieldColumnNames={};this._headerColumnNames={};this._virtualLoadedRecords={};this._virtualLoadedRows={};this._virtualPageRecords={};this._virtualSelectedRowIndex=[];this._virtaulSel=[];this._singleView=!1;this._dragIndex=null;this._dragUpInterval=null;this._dragDownInterval=null;this._queryCellView=[];this._currentPageViews=[];this._virtualLoadedPages=[];this._currentLoadedIndexes=[];this._prevLoadedIndexes=[];this._prevVirtualSort=[];this._prevVirtualFilter=[];this._prevVirtualIndex=0;this._currentVirtualIndex=1;this._virtualRowCount=0;this._virtualSelectedRecords={};this._virtualCheckSelectedRecords={};this._selectionByGrid=!1;this._enableCheckSelect=!1;this.checkSelectedRowsIndexes=[];this._isMapSelection=!1;this._selectionMapColumn=null;this._selectAllCheck=!1;this.selectedRowsIndexes=[];this.OldfilterValue=null;this._isReorder=!1;this._searchString="";this._searchCount=null;this.columnsWidthCollection=[];this._Indicator=null;this._lastSelectedCellIndex=[];this._resizer=null;this._bulkEditCellDetails={cellValue:null,rowIndex:-1,columnIndex:-1,fieldName:null,_data:null,cellEditType:"",cancelSave:!1,defaultData:null,insertedTrCollection:[],rowData:null};this._copyBulkEditCellDetails={cellValue:null,rowIndex:-1,columnIndex:-1,fieldName:null,_data:null,cellEditType:"",cancelSave:!1,defaultData:null,insertedTrCollection:[],rowData:null};this.batchChanges={added:[],deleted:[],changed:[]};this._bulkEditTemplate=n();this._confirmDialog=null;this._confirmedValue=!1;this._lastRow=!1;this._isVirtualRecordsLoaded=!1;this._scrollValue=0;this._currentTopFrozenRow=this.model.scrollSettings.frozenRows;this._rowHeightCollection=[];this._scrollObject=null;this._customPop=null;this.selectedRowCellIndexes=[];this._rowIndexesColl=[];this.selectedColumnIndexes=[];this._allowrowSelection=this._allowcellSelection=this._allowcolumnSelection=!1;this.commonQuery=this.model.query.clone();t.gridFeatures.group&&(this._rowCol=this._captionSummary(),this._isCaptionSummary=(this._rowCol!=null&&this._rowCol.length)>0?!0:!1);this.phoneMode=this.model.isResponsive&&document.documentElement.clientWidth<360?!0:!1;this.model.selectionSettings.selectionMode.length>0&&this.model.allowSelection&&this._initSelection();this._mediaQuery=!1;this._columnChooserList=null;this._$headerCols=null;this._$contentCols=null;this._detailsOuterWidth=null;this._editForm=null;this._cloneQuery=null;this.localizedLabels=this._getLocalizedLabels();this._searchBar=null;this._relationalColumns=[];this._dropDownManager={};this._isUngrouping=!1;this._columnChooser=!1;this._showHideColumns=!1;this._vCurrentTrIndex=null;this._lastVirtualPage=null;this._currentVIndex=null;(!this.model.enablePersistence||t.isNullOrUndefined(this._isHeightResponsive))&&(this._isHeightResponsive=!1);this._resize=!1;this._initHeight=0;this._initDataProcessed=!1;this._menuColTypes=[];this._excelColTypes=[];this._previousTr=null;this._isResized=!1},_init:function(){var r,n,u;this._trigger("load");!t.isNullOrUndefined(this.model.query)&&this.model.query instanceof t.Query||(this.model.query=t.Query());t.isNullOrUndefined(this.model.parentDetails)||(r=this.model.queryString,n=this.model.foreignKeyField,this.model.query=this.model.query.clone(),u=this.model.parentDetails.parentKeyFieldValue===i?"undefined":this.model.parentDetails.parentKeyFieldValue,this.model.query.where(t.isNullOrUndefined(n)?r:n,"equal",u,!0));this._initPrivateProperties();t.gridFeatures.common&&this._initScrolling();this.model.enableResponsiveRow&&this.element.addClass("e-responsive");this._checkForeignKeyBinding();this._checkDataBinding()},_initComplexColumn:function(n,i,r){var e=r||i,u,o,f;for(u in n)typeof n[u]!="object"||t.isNullOrUndefined(n[u])?(o=e.concat(".").concat(u),f=n[u],this.model.columns.push({field:o,type:f!=null?f.getDay?f.getHours()>0||f.getMinutes()>0||f.getSeconds()>0||f.getMilliseconds()>0?"datetime":"date":typeof f:null})):(e=e.concat(".").concat(u),this._initComplexColumn(n[u],u,e))},_initColumns:function(r){var e,o,u,f,s;if(this.model.groupSettings.groupedColumns.length)while(r.items!=i&&r.items[0]instanceof Object)r=r.items[0];if(this.model.columns.length==0&&r){for(e in r)r.hasOwnProperty(e)&&(typeof r[e]!="object"||r[e]instanceof Date||r[e]==null)?(o=r[e],this.model.columns.push({field:e,type:o!=null?o.getDay?o.getHours()>0||o.getMinutes()>0||o.getSeconds()>0||o.getMilliseconds()>0?"datetime":"date":typeof o:null})):typeof r[e]=="object"&&this._initComplexColumn(r[e],e);this.model.columns.length&&this._renderAfterColumnInitialize()}else for(u=0;u<this.model.columns.length;u++)this.model.columns[u].field=t.isNullOrUndefined(this.model.columns[u].field)?"":this.model.columns[u].field,t.isNullOrUndefined(this.model.columns[u].validationRules)||this._validatedColumns.push(this.model.columns[u].field),t.isNullOrUndefined(this.model.columns[u].type)?(f=t.isNullOrUndefined(this.model.columns[u].field)?null:t.getObject(this.model.columns[u].field,r),s=this.model.columns[u].dataSource,!!s&&this.model.columns[u].foreignKeyValue&&(this.model.columns[u].originalType=f!=null?f.getDay?f.getHours()>0||f.getMinutes()>0||f.getSeconds()>0||f.getMilliseconds()>0?"datetime":"date":typeof f:null,f=(s instanceof t.DataManager)?t.getObject("0."+this.model.columns[u].foreignKeyValue,this.model.columns[u].foreignKeyData):t.getObject("0."+this.model.columns[u].foreignKeyValue,s)),this.model.columns[u].type=f!=null?f.getDay?f.getHours()>0||f.getMinutes()>0||f.getSeconds()>0||f.getMilliseconds()>0?"datetime":"date":typeof f:null):this.model.columns[u].type=="date"&&this.model.columns[u].format==i&&this._isReorder!=!0&&this.initialRender&&!this._showHideColumns?n.extend(this.model.columns[u],{format:"{0:"+t.preferredCulture(this.model.locale).calendars.standard.patterns.d+"}"}):this.model.columns[u].type=="datetime"&&this.model.columns[u].format==i&&this._isReorder!=!0&&this.initialRender&&!this._showHideColumns&&n.extend(this.model.columns[u],{format:"{0:"+t.preferredCulture(this.model.locale).calendars.standard.patterns.d+" "+t.preferredCulture(this.model.locale).calendars.standard.patterns.t+"}"})},_initSelection:function(){for(var t=this.model.selectionSettings.selectionMode,n=0;n<t.length;n++)this["_allow"+t[n]+"Selection"]=!0},_checkDataBinding:function(){var s,u,e,f,r,h,o;if(!this.model.columns.length&&((this._dataSource()==null||!this._dataSource().length)&&!(this._dataSource()instanceof t.DataManager)||this._dataSource()instanceof t.DataManager&&this._dataManager.dataSource.url==i&&!this._dataSource().dataSource.json.length)){this._renderAlertDialog();this._alertDialog.find(".e-content").text(this.localizedLabels.EmptyDataSource);this._alertDialog.ejDialog("open");return}if(this._initialRenderings(),this.model.editSettings.allowDeleting&&this.model.selectionType=="multiple"&&(this.multiDeleteMode=!0),this.initialRender=!0,this.model.enableRTL&&this.element.addClass("e-rtl"),this.model.allowFiltering&&this._isExcelFilter&&this._renderExcelFilter(),this.model.cssClass!=null&&this.element.addClass(this.model.cssClass),this.model.allowGrouping&&this.element.append(this._renderGroupDropArea()),(this.model.toolbarSettings.showToolbar||(this.model.allowSorting||this.model.allowFiltering)&&this.model.enableResponsiveRow)&&(this.element.append(this._renderToolBar()),t.browserInfo().name=="msie"&&t.browserInfo().version<10&&n.inArray("search",this.model.toolbarSettings.toolbarItems)!=-1&&(s=this.element.find(".e-toolbar.e-toolbarspan .e-gridsearchbar"),t.ieClearRemover(s[0]))),u=this.model.columns,u&&u.length){if(e=this.model.query._expands,typeof u[0]=="string")for(r=0;r<u.length;r++)u[r]={field:u[r]};for(r=0;r<u.length;r++)u[r].field&&u[r].field.indexOf(".")!==-1&&this._getExpands(u[r].field,e);this.model.query.expand(e);this.commonQuery.expand(e);this._renderAfterColumnInitialize()}if(this.model.allowPaging&&(this.model.isResponsive&&(this.model.pageSettings.isResponsive=!0),this.element.append(this._renderGridPager()),this.model.pageSettings.isResponsive&&n(this.element.find(".e-pager")).ejPager("instance")._reSizeHandler(),this.model.filterSettings.filterType=="filterbar"&&this.model.filterSettings.filteredColumns.length)){for(f=this.model.filterSettings.filteredColumns,r=0;r<f.length;r++)h=n.inArray(this.getColumnByField(f[r].field),this.filterColumnCollection),f[r].field!==""&&h==-1&&this.filterColumnCollection.push(this.getColumnByField(f[r].field));this.filterStatusMsg="";this._showFilterMsg()}this.model.contextMenuSettings.enableContextMenu&&this.element.append(this._renderContext());n.isFunction(n.fn.ejWaitingPopup)&&(this.element.ejWaitingPopup({showOnInit:!1}),n("#"+this._id+"_WaitingPopup").addClass("e-gridwaitingpopup"));this.model.scrollSettings.allowVirtualScrolling&&(this._loadedJsonData=[],this._prevPage=1);this._dataSource()instanceof t.DataManager?(this.element.ejWaitingPopup("show"),this._dataSource().ready!=i?(o=this,this._dataSource().ready.done(function(n){o._initDataSource();o.model.dataSource=t.DataManager(n.result)})):(this.element.ejWaitingPopup("show"),this._initDataSource())):(this._ensureDataSource(),this._trigger("actionBegin"),this._setForeignKeyData(),this._relationalColumns.length==0&&this._initGridRender())},_renderColumnChooser:function(){var f=t.buildTag("button .e-ccButton",this.localizedLabels.Columns,{float:this.model.enableRTL?"left":"right"}).attr("type","button"),o,a,p,r,s,h,c,v,u,e,l,y;this.element.prepend(f);f.ejButton({prefixIcon:"e-icon e-down-arrow",imagePosition:"imageright",contentType:"textandimage",type:"button",click:n.proxy(this._ccClickHandler,this),width:90});o=f.outerHeight();f.css("margin-top",0-o);a=parseInt(this.element.css("margin-top"),10);this.element.css("margin-top",a+o);p=t.buildTag("div");r=t.buildTag("div .e-grid e-columnChooser","",{},{id:this._id+"ccDiv"});n("#"+this._id+"ccDiv").data("ejDialog")!=i&&(n("#"+this._id+"ccDiv").ejDialog("destroy"),n("#"+this._id+"ccDiv").remove());s=t.buildTag("div.e-searchbox e-fields").append(t.buildTag("input#"+this._id+"_ccSearchBox.e-ejinputtext e-filtertext",{},{},{type:"text"}));h=t.buildTag("span .e-searchfind e-icon");s.append(h);c=t.buildTag("div","",{height:"228px"},{id:this._id+"liScrollerDiv"});this._renderColumnChooserData(!1);c.append(this._columnChooserList);r.append(s);r.append(c);v=t.buildTag("div .e-columnChooserSplitter","",{"border-bottom":"0px"});r.append(v);this.model.enableRTL?(u=t.buildTag("div .e-ccBtndiv","",{float:"left","margin-top":"7px","margin-right":"-13px"}),e=t.buildTag("button .e-ccformbtn e-btncan e-flat",this.localizedLabels.Cancel,{"margin-right":"7px","margin-left":"9px"}),n(h).addClass("e-rtl")):(u=t.buildTag("div .e-ccBtndiv","",{float:"right","margin-top":"7px"}),e=t.buildTag("button .e-ccformbtn e-btncan e-flat",this.localizedLabels.Cancel,{"margin-right":"7px","margin-left":"6px"}));l=t.buildTag("button .e-ccformbtn e-btnsub e-flat",this.localizedLabels.Done);u.append(l);u.append(e);r.append(u);l.ejButton({click:n.proxy(this._addButtonCC,this),showRoundedCorner:!0,width:66});e.ejButton({click:n.proxy(this._cancelButtonHandler,this),showRoundedCorner:!0,width:66});r.insertBefore(this.element);r.ejDialog({width:"auto",beforeClose:n.proxy(this._columnChooserBeforeClose,this),showOnInit:!1,allowKeyboardNavigation:!1,enableResize:!1,enableRTL:this.model.enableRTL,cssClass:this.model.cssClass,showHeader:!1,width:260});t.browserInfo().name=="msie"&&t.browserInfo().version<10&&(y=n(".e-columnChooser").find("input#"+this._id+"_ccSearchBox")[0],t.ieClearRemover(y))},_renderColumnChooserData:function(i){var b=this.model.columns.length==this.getVisibleColumnNames().length,e,h,f,u,c,y,p,w,v;for(this._ccCheckBoxList=[],e=t.buildTag("div","",{"margin-left":"0px",width:"250px"}),h=0,f=-1;f<this.model.columns.length;f++)if(u=f==-1,u||this.model.columns[f].showInColumnChooser){var r=this.model.columns[f],o=u?this.localizedLabels.SelectAll:t.isNullOrUndefined(r.headerText)||r.headerText==""?r.field==""?null:r.field:r.headerText,k=r&&r.disableHtmlEncode?this._htmlEscape(o):o;if(!t.isNullOrUndefined(o)||u){var l=t.buildTag("div","",{},{"class":"e-columnChooserListDiv"}),s=u?this._id+"selectAll":this._id+o.replace(/\s|\.|[^a-zA-Z0-9]|&nbsp/g,"_"),a=e.find("#"+s).length;a&&h++;c=t.buildTag("input","",{},{id:a?s+h+"":s,value:o,type:"checkbox","ej-field":u?"":r.field,"ej-headertext":u?"":r.headerText,"class":u?"e-selectall":""});y=t.buildTag("label",k,{"font-size":"13px"},{"for":a?s+h+"":s});l.append(c);l.append(y);e.append(l);p=!u&&!t.isNullOrUndefined(r.visible)?r.visible:!0;c.ejCheckBox({checked:u?b:p,change:n.proxy(this._columnChooserCheckChange,this)});u||t.isNullOrUndefined(r.visible)||c[r.visible?"attr":"removeAttr"]("checked",!0)}}else t.isNullOrUndefined(this.model.columns[f].showInColumnChooser)||(w=t.dataUtil.distinct(this._showInColumnchooserCol,"field"),v=w.indexOf(this.model.columns[f].field),v==-1?this._showInColumnchooserCol.push(this.model.columns[f]):this._showInColumnchooserCol[v]=this.model.columns[f]);i?(this._columnChooserList.empty().append(e.children()),n("#"+this._id+"liScrollerDiv").is(":visible")&&n("#"+this._id+"liScrollerDiv").ejScroller("refresh")):this._columnChooserList=e;this._ccCheckBoxList=this._columnChooserList.find("input:checkbox.e-js").not(".e-selectall")},_checkFinder:function(){var t=n(this),i=t.closest(".e-columnChooserListDiv");if(t.hasClass("e-checkbox")&&!i.hasClass("e-hide")&&t.prop("checked"))return!0},_displayFinder:function(){return!n(this).closest(".e-columnChooserListDiv").hasClass("e-hide")},_columnChooserCheckChange:function(t){var e;if(!t.isInteraction){t.isChecked&&n("#"+this._id+"ccDiv").find("button.e-ccformbtn.e-btnsub").removeClass("e-disable");return}var i=t.isChecked,r=this._ccCheckBoxList.filter(this._displayFinder),u=this._ccCheckBoxList.filter(this._checkFinder),o=r.length,f=u.length;t.model.id==this._id+"selectAll"?i?r.not(":checked").ejCheckBox({checked:i}):u.ejCheckBox({checked:i}):(this._columnChooserList.find("input.e-selectall").ejCheckBox("model.checked",o==f),i=f!=0,this.element[i?"attr":"removeAttr"]("checked",!0));e=(i||this._showInColumnchooserCol.length)?"removeClass":"addClass";n("#"+this._id+"ccDiv").find("button.e-ccformbtn.e-btnsub")[e]("e-disable")},_columnChooserBeforeClose:function(){n(".e-columnChoosertail").remove();n(".e-columnChoosertailAlt").remove();n("#"+this._id+"ccDiv").find("button.e-ccformbtn.e-btnsub").removeClass("e-disable");n("#"+this._id+"_ccSearchBox").val("");var t={};t.target={};t.target.value="";this._columnChooserSearch(t)},_columnChooserSearch:function(i){var u,f,c,r,o,l,v;i.type=="click"&&(i.target.value="",n("#"+this._id+"_ccSearchBox").val(""));u=i.target.value;f=n("#"+this._id+"_ccSearchBox").next("span");u!=""?(f.removeClass("e-searchfind"),f.addClass("e-cancel")):(f.removeClass("e-cancel"),f.addClass("e-searchfind"));n(".e-cancel").on("click",n.proxy(this._columnChooserSearch,this));var s=this.model.columns,e=[],h=[],a=[],p=this,w=function(t){var i=p.model.groupSettings;return!i.showGroupedColumn&&n.inArray(t,i.groupedColumns)>-1};for(u!=""&&(s=t.DataManager(this.model.columns).executeLocal(t.Query().where("headerText",t.FilterOperators.startsWith,u,!0)),a=t.DataManager(this.model.columns).executeLocal(t.Query().where("field",t.FilterOperators.startsWith,u,!0)),a.forEach(function(t){t.headerText==""&&n.inArray(t,s)==-1&&s.push(t)})),s.forEach(function(n){if(n.showInColumnChooser&&!w(n.field)){var i=t.isNullOrUndefined(n.headerText)||n.headerText==""?n.field==""?null:n.field:n.headerText;e.push(i)}}),t.isNullOrUndefined(n("#nomatches")[0])||n("#nomatches").remove(),c=this._columnChooserList.find(".e-columnChooserListDiv"),r=0;r<this.model.columns.length;r++)this.model.columns[r].showInColumnChooser&&!t.isNullOrUndefined(this.model.columns[r].headerText)&&(this.model.columns[r].headerText!=""?h.push(this.model.columns[r].headerText):this.model.columns[r].field!=""&&h.push(this.model.columns[r].field));for(o=0;o<h.length;o++)l=h[o],v=e.indexOf(l),t.isNullOrUndefined(l)||c.eq(o+1)[v==-1?"addClass":"removeClass"]("e-hide");e.length==0&&this._emptyColumnChooserData();var b=this._ccCheckBoxList.filter(this._displayFinder).length,y=this._ccCheckBoxList.filter(this._checkFinder).length,k=y==b;e.length&&c.eq(0).find("input.e-js").ejCheckBox({checked:k});c.eq(0)[e.length==0?"addClass":"removeClass"]("e-hide");n("#"+this._id+"ccDiv").find("button.e-ccformbtn.e-btnsub")[y?"removeClass":"addClass"]("e-disable");n("#"+this._id+"liScrollerDiv").ejScroller("refresh")},_addButtonCC:function(){var i,r,t,u;for(this._visibleColumns=[],this._hiddenColumns=[],this._visibleColumnsField=[],this._hiddenColumnsField=[],this._columnChooserClick=!0,i={},i.requestType="columnchooser",this._columnChooser=!0,r=this._columnChooserList.find("input:checkbox.e-js").not(".e-selectall"),t=0,u=r.length;t<u;t++){var o=n(r[t]),s=o.attr("ej-headertext"),f=o.attr("ej-field");this._id+"selectAll"!=o.attr("id")&&(this[r[t].checked?"_visibleColumns":"_hiddenColumns"].push(s),this[r[t].checked?"_visibleColumnsField":"_hiddenColumnsField"].push(f!=""?f:s))}for(t=0,u=this._showInColumnchooserCol.length;t<u;t++){var e=this._showInColumnchooserCol[t],h=e.headerText,f=e.field;this[e.visible?"_visibleColumns":"_hiddenColumns"].push(h);this[e.visible?"_visibleColumnsField":"_hiddenColumnsField"].push(f!=""?f:h)}var a=this._visibleColumns,v=this._hiddenColumns,c,l;c=n.merge(n.merge([],a),v);l=this._isDuplicate(c);this._trigger("actionBegin",i);l?(this.showColumns(this._visibleColumnsField),this.hideColumns(this._hiddenColumnsField)):(this.showColumns(this._visibleColumns),this.hideColumns(this._hiddenColumns));n("#"+this._id+"ccDiv").ejDialog("close");n(".e-columnChoosertail").remove();this.refreshScrollerEvent();i={requestType:"columnchooser",removedcolumns:[],addedcolumns:[],visiblecolumns:this.getVisibleColumnNames(),hiddencolumns:this.getHiddenColumnNames()};this._ccColumnUpdate(i.addedcolumns,this.getVisibleColumnNames(),this._ccVisibleColumns);this._ccColumnUpdate(i.removedcolumns,this.getHiddenColumnNames(),this._ccHiddenColumns);this._trigger("actionComplete",i);this._columnChooser=!1},_ccColumnUpdate:function(t,i,r){for(var u=0;u<i.length;u++)n.inArray(i[u],r)==-1&&t.push(i[u])},_isDuplicate:function(n){for(var t,i={},r=0;r<n.length;r++)t=n[r],i[t]=i[t]>=1?i[t]+1:1;for(t in i)if(i[t]>1)return!0;return!1},_cancelButtonHandler:function(){n("#"+this._id+"ccDiv").ejDialog("close");n(".e-columnChoosertailAlt").remove();n(".e-columnChoosertail").remove()},_ccClickHandler:function(){var f=230,i,r=this.element.find(".e-ccButton"),u;if(i=r.offset().left+r.width(),u=n("#"+this._id+"ccDiv").data("ejDialog"),u&&u.isOpened())u.close(),n(".e-columnChoosertail").remove(),n(".e-columnChoosertailAlt").remove();else{n("#"+this._id+"ccDiv").ejDialog({width:"230px",height:"310px",position:{X:this.model.enableRTL?i-f+143:i-f,Y:r.offset().top+35}}).ejDialog("open");var e=parseInt(n("#"+this._id+"ccDiv_wrapper").css("z-index")),o=t.buildTag("div #"+this._id+"_ccTail .e-columnChoosertail","",{display:"block",position:"absolute",left:this.model.enableRTL?i-78:i-29,top:r.offset().top+15}),s=t.buildTag("div #"+this._id+"_ccTailAlt .e-columnChoosertailAlt","",{display:"block","z-index":e+2,position:"absolute",left:this.model.enableRTL?i-78:i-29,top:r.offset().top+16});o.insertBefore(n("#"+this._id+"ccDiv_wrapper"));s.insertBefore(n("#"+this._id+"ccDiv_wrapper"))}this._refreshColumnChooserList();this._ccVisibleColumns=this.getVisibleColumnNames();this._ccHiddenColumns=this.getHiddenColumnNames();n("#"+this._id+"liScrollerDiv").ejScroller({height:"228",width:"228",buttonSize:0});n("#"+this._id+"liScrollerDiv").ejScroller("refresh");t.isIOSWebView()||this.getBrowserDetails().browser!="chrome"||n(".e-columnChooser .e-hscrollbar").attr("style","height: 10px !important;");n(".e-ejinputtext").on("keyup",n.proxy(this._columnChooserSearch,this))},_refreshColumnChooserList:function(){for(var c,l,a,r=this._columnChooserList.find("input:checkbox.e-js").not(".e-selectall"),s=this._isDuplicate(n.merge(n.merge([],this._visibleColumns),this._hiddenColumns)),u=0,v=r.length;u<v;u++){var f=n(r[u]),e=f.attr("ej-headertext"),h=f.attr("ej-field"),o=i,y=r.filter('[ej-headertext="'+e+'"]').length;this.model.allowGrouping&&!this.model.groupSettings.showGroupedColumn&&n.inArray(n(r[u]).attr("ej-field"),this.model.groupSettings.groupedColumns)!=-1?(n(r[u]).parents(".e-columnChooserListDiv").addClass("e-hide"),r[u].checked=!1,this._columnChooserList.find(".e-columnChooserListDiv").eq(0).hasClass("e-hide")&&this.model.columns.length>this.model.groupSettings.groupedColumns.length&&this._columnChooserList.find(".e-columnChooserListDiv").eq(0).removeClass("e-hide")):(n(r[u]).parents(".e-columnChooserListDiv").removeClass("e-hide"),r[u].checked=!0);c=s?h==""?e:h:e;o=this[s?"_hiddenColumnsField":"_hiddenColumns"].indexOf(c)!=-1;f.prop("checked",!o);f.ejCheckBox("model.checked",!o)}l=r.filter(this._displayFinder).length==r.filter(this._checkFinder).length&&r.filter(this._displayFinder).length?!0:!1;this._columnChooserList.find("input:checkbox.e-selectall").ejCheckBox({checked:l});this.model.groupSettings.showGroupedColumn||(t.isNullOrUndefined(n("#nomatches")[0])||n("#nomatches").remove(),this.model.columns.length==this.model.groupSettings.groupedColumns.length&&(this._columnChooserList.find(".e-columnChooserListDiv").eq(0).addClass("e-hide"),this._emptyColumnChooserData()),a=r.filter(this._displayFinder).length>0?!0:!1,n("#"+this._id+"ccDiv").find("button.e-ccformbtn.e-btnsub").ejButton({enabled:a}))},_emptyColumnChooserData:function(){var i=t.buildTag("div#nomatches","",{"padding-left":"13px"}),r=n("#"+this._id+"ccDiv").find("#"+this._id+"liScrollerDiv"),u=t.buildTag("span",this.localizedLabels.NoResult);i.append(u);n(r).append(i)},_initDataSource:function(){var i,n;this._isLocalData=!(this._dataSource()instanceof t.DataManager)||this._dataSource().dataSource.offline||this._isRemoteSaveAdaptor||this._dataSource().adaptor instanceof t.ForeignKeyAdaptor;this._dataSource().adaptor instanceof t.SqlDataSourceAdaptor&&(this._isLocalData=!1);this._ensureDataSource();this._trigger("actionBegin");i=this._dataSource().executeQuery(this.model.query);n=this;this._dataManager.dataSource.table!=null&&this._dataManager.dataSource.table.css("display","none");this.element.is(":visible")||this.element.ejWaitingPopup("hide");i.done(t.proxy(function(n){this._initDataProcessed||(this._initDataProcess(n),this._initDataProcessed=!0)},this));n=this;i.fail(function(i){if(!t.isNullOrUndefined(n.element)){n.element.ejWaitingPopup("hide");n.model.currentViewData=[];n._gridRecordsCount=0;n._renderGridContent().insertAfter(n.element.children(".e-gridheader"));var r={error:i.error};n._trigger("actionFailure",r)}})},_initDataProcess:function(i,r){var f,u,e;if(!t.isNullOrUndefined(this.element)){if(this._relationalColumns.length==0&&this.element.ejWaitingPopup("hide"),!this.model.columns.length&&!i.count){f=i.count%this.model.pageSettings.pageSize==0?i.count/this.model.pageSettings.pageSize:parseInt(i.count/this.model.pageSettings.pageSize,10)+1;this._currentPage()>f&&this._currentPage(f);this._renderAlertDialog();this._alertDialog.find(".e-content").text(this.localizedLabels.EmptyDataSource);this._alertDialog.ejDialog("open");this.element.ejWaitingPopup("hide");return}if(t.isNullOrUndefined(i.aggregates)||(this._remoteSummaryData=i.aggregates),this.model.scrollSettings.enableVirtualization||(this.model.currentViewData=i.result),this._$fkColumn&&this.model.filterSettings.filteredColumns.length>0&&this.model.filterSettings.filterType=="excel"&&(this._fkParentTblData=i.result),this._gridRecordsCount=this.model.enablePersistence||this.model.pageSettings.totalRecordsCount==null||this.model.filterSettings.filteredColumns.length!=0?i.count==0&&i.result.length?i.result.length:i.count:this.model.pageSettings.totalRecordsCount,this.model.filterSettings.filteredColumns.length>0&&(this._filteredRecordsCount=i.count),this.getPager()!=null&&(this.model.pageSettings.totalRecordsCount=this._gridRecordsCount),this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization)if(this._refreshVirtualViewDetails(),this._isInitNextPage||this._remoteRefresh?(this._setInitialCurrentIndexRecords(i.result,this._currentPage()),this._isInitNextPage=this._remoteRefresh=!1):this._setVirtualLoadedRecords(i.result,this._currentPage()),this._isThumbScroll&&!this._checkCurrentVirtualView(this._virtualLoadedRecords,this._currentVirtualIndex)&&this._checkPrevNextViews(this._currentPage()),this.initialRender)for(this.model.currentViewData=[],u=0;u<this._currentLoadedIndexes.length;u++)e=this._currentLoadedIndexes[u],n.merge(this.model.currentViewData,this._virtualLoadedRecords[e]||[]);else this.model.currentViewData=i.result;this.model.groupSettings.groupedColumns.length&&this._setAggregates();this._setForeignKeyData(r);this._relationalColumns.length==0&&this._initGridRender()}},_initialRenderings:function(){var r,i;if(this.model.groupSettings.groupedColumns.length){for(r=[],i=0;i<this.model.sortSettings.sortedColumns.length;i++)t.isNullOrUndefined(this.model.sortSettings.sortedColumns[i].direction)&&(this.model.sortSettings.sortedColumns[i].direction=t.sortOrder.Ascending),r.push(this.model.sortSettings.sortedColumns[i].field);if(this.model.allowGrouping)for(i=0;i<this.model.groupSettings.groupedColumns.length;i++)n.inArray(this.model.groupSettings.groupedColumns[i],r)==-1&&this.model.sortSettings.sortedColumns.push({field:this.model.groupSettings.groupedColumns[i],direction:t.sortOrder.Ascending})}},_getExpands:function(n,t){var r=n.split("."),i="",u,f;for(r.splice(r.length-1,1),u=0;u<r.length;u++,i=""){for(f=0;f<u;f++)i+=r[f]+"/";i=i+r[u];t.indexOf(i)===-1&&t.push(i)}},_renderAfterColumnInitialize:function(){this.element.append(this._renderGridHeader());this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&(this._renderFiltering(),this._renderFilterBarTemplate());this.model.gridLines!="both"&&this._showHeaderGridLines();this.model.allowPaging&&this.element.append(this.element.find(".e-pager").first())},_ensureDataSource:function(r){var f,k,ut,ft,d,l,a,s,v,e,c,et,ct,y,ot,lt,o,g,w,p,u,b,tt,at,vt,st,ht,it,h,yt,nt,pt,rt,wt;if(this._dataSource()==null&&!(this._dataSource()instanceof t.DataManager)){if(t.isNullOrUndefined(r)||r.requestType!="add")return;this.dataSource([])}if(this.model.query.requiresCount(),f=this.model.query,k=f.clone(),this._isLocalData&&(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(!t.isNullOrUndefined(this._cModifiedData)||!t.isNullOrUndefined(this._cAddedRecord))){if(t.isNullOrUndefined(this._cAddedRecord)){for(c=0;c<this._primaryKeys.length;c++)f=f.where(this._primaryKeys[c],t.FilterOperators.equal,this._primaryKeyValues[c]);ut=this._dataManager.executeLocal(f);this._dataSource()instanceof t.DataManager?t.copyObject(this._dataSource().dataSource.json[n.inArray(ut.result[0],this._dataSource().dataSource.json)],this._cModifiedData):t.copyObject(this._dataSource()[n.inArray(ut.result[0],this._dataSource())],this._cModifiedData);this._cModifiedData=null}else ft=this._cAddedRecord,this._cAddedRecord=null,this._dataSource()instanceof t.DataManager?this._dataSource().dataSource.json.unshift(ft):this._dataSource(i,!0).splice(0,0,ft);f.queries=k.queries;this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal"||(this.model.isEdit=!1)}if(r&&this.model.editSettings.allowDeleting&&r.requestType=="delete"&&(this._excludeDetailRows().length==1||this.multiDeleteMode=="multiple"&&this.selectedRowsIndexes.length==this._excludeDetailRows().length)&&this.model.pageSettings.currentPage!=1&&this._currentPage(this.model.pageSettings.totalPages-1),r&&this.model.editSettings.allowDeleting&&r.requestType=="delete"&&!t.isNullOrUndefined(this._cDeleteData)&&this._isLocalData&&(this._dataSource()instanceof t.DataManager?(c=n.inArray(this._cDeleteData[0],this._dataSource().dataSource.json),this._dataSource().dataSource.json.splice(c,1)):(c=n.inArray(this._cDeleteData[0],this._dataSource()),this._dataSource(i,!0).splice(c,1))),this.model.scrollSettings.allowVirtualScrolling&&r&&(r.requestType=="save"||r.requestType=="cancel"||r.requestType=="delete"||r.action=="showColumn"||r.action=="hideColumn")&&(r.action!="showColumn"&&r.action!="hideColumn"&&(this._virtualDataRefresh=!0),this._refreshVirtualViewData()),this.model.sortSettings.sortedColumns.length){for(d=[],l=this.model.sortSettings.sortedColumns,u=l.length-1;u>=0;u--)if(this.model.groupSettings.groupedColumns.indexOf(l[u].field)==-1){if(f.sortBy(l[u].field,l[u].direction),this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&n.inArray(l[u],this._prevVirtualSort)==-1){for(o=0;o<this._prevVirtualSort.length;o++)l[u].field==this._prevVirtualSort[o].field&&this._prevVirtualSort.splice(o,1);this._needVPaging=this._currentVirtualIndex*this._virtualRowCount%this.model.pageSettings.pageSize<=this._virtualRowCount;this._prevVirtualSort.push(l[u]);this._virtualDataRefresh=!0;this._refreshVirtualViewData()}}else d.push({field:l[u].field,direction:l[u].direction});for(this.model.scrollSettings.virtualScrollMode!="continuous"||t.isNullOrUndefined(r)||r.requestType!="sorting"||this._currentPage(1),o=0;o<d.length;o++)f.sortBy(d[o].field,d[o].direction)}if(this.model.allowSearching&&this.model.searchSettings.key.length&&(a=this.model.searchSettings,a.fields=a.fields.length!=0?a.fields:this.getColumnFieldNames(),f.search(a.key,a.fields,a.operator||"contains",a.ignoreCase),this.initialRender||r.requestType!="searching"||this._currentPage(1)),this._isLocalData&&this.model.allowSearching&&(this._filteredRecords=this.model.searchSettings.key.length!=0?this._dataManager.executeLocal(f).result:[]),this.model.allowFiltering&&this.model.filterSettings.filteredColumns.length){for(v=this.model.filterSettings.filteredColumns[0],e=this.model.filterSettings.filteredColumns,u=0;u<e.length;u++)c=n.inArray(this.getColumnByField(e[u].field),this.filterColumnCollection),e[u].field!==""&&c==-1&&this.filterColumnCollection.push(this.getColumnByField(e[u].field));if(!(this._isExcelFilter||this._excelFilterRendered)||v instanceof t.Predicate)for(v instanceof t.Predicate?(s=v,this._excelFilterRendered&&(lt=t.distinct(e,"field",!1),this._excelFilter._predicates[0]=this._excelFilter._predicates[0]||{},this._excelFilter._predicates[0][lt[0]]=s)):s=t.Predicate(v.field,v.operator,v.value,!v.matchcase),u=1;u<e.length;u++)e[u]instanceof t.Predicate?s=s[e[u].predicate||"and"](e[u]):!this._isLocalData&&e.length>2&&u>1&&e[u].predicate=="or"?s.predicates.push(t.Predicate(e[u].field,e[u].operator,e[u].value,e[u].ignoreCase||!e[u].matchcase)):s=s[e[u].predicate||"and"](e[u].field,e[u].operator,e[u].value,!e[u].matchcase);else{this._excelFilter.getPredicate(e,null,!0);et=this._excelFilter._predicates[0];for(ct in et)y=et[ct],ot=y.from!=i,ot?f.skip(y.from=="top"?0:this._gridRecordsCount-y.take).take(y.take):s=s!=i?s.and(y):y}if(s&&f.where(s),this._isLocalData?(g=this._dataManager.executeLocal(f),this._filteredRecordsCount=ot?g.result.length:g.count,w=this._filteredRecordsCount%this.model.pageSettings.pageSize==0?this._filteredRecordsCount/this.model.pageSettings.pageSize:parseInt(this._filteredRecordsCount/this.model.pageSettings.pageSize,10)+1,this._currentPage()>w&&this._currentPage(w),this._filteredRecords=this._dataManager.executeLocal(f).result,this._$fkColumn&&this.model.filterSettings.filteredColumns.length>0&&this.model.filterSettings.filterType=="excel"&&(this._fkParentTblData=this._filteredRecords)):t.isNullOrUndefined(r)||r.requestType!=t.Grid.Actions.Filtering||this._currentPage(1),this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization)for(u=0;u<e.length;u++){for(o=0;o<this._prevVirtualFilter.length;o++)e[u]==this._prevVirtualFilter[o]&&r.requestType==t.Grid.Actions.Filtering&&this._prevVirtualFilter.splice(o,1);n.inArray(e[u],this._prevVirtualFilter)==-1&&(this._prevVirtualFilter.push(e[u]),this._gridRecordsCount=this._filteredRecordsCount,this._refreshViewPageDetails(),this._refreshVirtualViewData(),this._refreshVirtualViewDetails())}}if(this._isLocalData&&this.model.allowFiltering&&this.model.filterSettings.filteredColumns.length==0&&(!t.isNullOrUndefined(this._filteredRecordsCount)||this._filteredRecordsCount>0)&&(this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(this._refreshViewPageDetails(),this._refreshVirtualViewDetails(!0)),this._filteredRecordsCount=null,this._filteredRecords=[]),this.model.summaryRows.length&&this._setSummaryAggregate(f),this.model.allowPaging||this.model.scrollSettings.allowVirtualScrolling&&this.model.allowScrolling&&!this.model.scrollSettings.enableVirtualization){if(this._isLocalData&&(g=this._dataManager.executeLocal(f),this._recordsCount=g.count,w=this._recordsCount%this.model.pageSettings.pageSize==0?this._recordsCount/this.model.pageSettings.pageSize:parseInt(this._recordsCount/this.model.pageSettings.pageSize,10)+1,this._currentPage()>w&&this._currentPage(w)),this._currentPage()==0&&(this._prevPageNo==0||this._prevPageNo==null?this._currentPage(1):this._currentPage(this._prevPageNo)),!this._isLocalData&&!this.initialRender&&!t.isNullOrUndefined(r)&&r.requestType=="refresh"&&k.queries.length)for(u=0;u<k.queries.length;u++)k.queries[u].fn=="onWhere"&&this._currentPage(1);f.page(this._currentPage(),this.model.pageSettings.pageSize)}if(this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&(this._needPaging=!0,this.initialRender&&this.model.currentIndex>1&&(this.model.currentIndex<=this._getVirtualTotalRecord()||!this._isLocalData)&&(this.model.scrollSettings.virtualScrollMode=="continuous"&&(this.model.currentIndex=1),this._currentVirtualIndex=Math.ceil(this.model.currentIndex/this._virtualRowCount),this._isThumbScroll=!0,this._currentPage(Math.ceil(this.model.currentIndex/this.model.pageSettings.pageSize)),this._virtualLoadedPages.push(this._currentPage())),this._virtualDataRefresh&&(this._isThumbScroll=!0,this._refreshVirtualViewData(!0),this._gridRecordsCount=this._dataSource()!==null?this.model.pageSettings.totalRecordsCount==null?this._dataSource().length:this.model.pageSettings.totalRecordsCount:0,this._currentPage(Math.ceil(this._currentVirtualIndex*this._virtualRowCount/this.model.pageSettings.pageSize)),this._virtualLoadedPages.push(this._currentPage())),this.model.virtualLoading!=null&&(this._gridRecordsCount=this.model.pageSettings.totalRecordsCount),this.model.filterSettings.filteredColumns==0&&this._prevVirtualFilter.length&&(this._refreshVirtualViewData(),this._prevVirtualFilter=[]),this._isLocalData&&this.initialRender&&this._refreshVirtualViewDetails(),this.model.scrollSettings.allowVirtualScrolling&&this.model.scrollSettings.enableVirtualization&&this.model.allowSearching&&!t.isNullOrUndefined(r)&&r.requestType=="searching"&&(this._refreshVirtualViewData(),this._refreshVirtualViewDetails()),this._getVirtualLoadedRecords(f)),this.model.allowGrouping){for(p=f.clone(),this.model.allowPaging&&this.model.groupSettings.groupedColumns.length&&(p.queries=p.queries.slice(0,p.queries.length-1)),u=0;u<this.model.groupSettings.groupedColumns.length;u++)b=this.model.groupSettings.groupedColumns[u],tt=this.getColumnByField(b),t.isNullOrUndefined(tt)||t.isNullOrUndefined(tt.enableGroupByFormat)||!tt.enableGroupByFormat?(f.group(b),p.group(b)):(f.group(b,t.proxy(this._formatGroupColumn,this)),p.group(b,t.proxy(this._formatGroupColumn,this)));this.model.groupSettings.groupedColumns.length&&this._setAggreatedCollection(p)}if(r!=i&&r.requestType=="add"&&this._isLocalData&&this.model.groupSettings.groupedColumns.length==0&&this.model.scrollSettings.frozenColumns==0&&this.model.scrollSettings.frozenRows==0&&((this._dataSource()instanceof t.DataManager)?this._dataSource().dataSource.json.unshift(r.data):this._dataSource().unshift(r.data)),t.isNullOrUndefined(r)||r.action!="add"||t.isNullOrUndefined(this.model.parentDetails)||(at=this.getColumnByField(this.model.parentDetails.parentKeyField),vt=n.inArray(at,this.model.columns),vt==-1&&(st={},st[this.model.parentDetails.parentKeyField]=this.model.parentDetails.parentKeyFieldValue,n.extend(!0,this.model.currentViewData[0],st))),this._cloneQuery=f.clone(),this._isLocalData){if(ht=this._dataManager.dataSource.json,it=this._dataSource().dataSource,!t.isNullOrUndefined(it)&&this._dataSource()instanceof t.DataManager&&(this._dataManager.dataSource.json=ht!=it.json?it.json:ht),h=this._dataManager.executeLocal(f),!this.model.scrollSettings.enableVirtualization||this._virtualDataRefresh)if(!t.isNullOrUndefined(r)&&r.requestType=="beginedit")this.model.currentViewData=h.result;else if(this.model.scrollSettings.allowVirtualScrolling&&this.model.pageSettings.currentPage==this.model.pageSettings.totalPages-1&&(this._prevPageRendered=!0),this.model.scrollSettings.allowVirtualScrolling&&!this._prevPageRendered&&h.result.length!=this.model.pageSettings.pageSize&&this.model.pageSettings.totalPages==this.model.pageSettings.currentPage)yt=t.pvt.filterQueries(f.queries,"onPage"),f.queries.splice(n.inArray(yt[0],f.queries),1),f.page(this._currentPage()-1,this.model.pageSettings.pageSize),nt=this._dataManager.executeLocal(f),nt.result.splice(0,h.result.length),this._previousPageRecords=n.extend(!0,[],nt.result),this._previousPageLength=h.result.length,this._currentPageData=h.result,t.merge(nt.result,h.result),this.model.currentViewData=this._lastVirtualPage=nt.result,this._lastPageRendered=!0;else if(this._lastPageRendered&&this.model.pageSettings.currentPage==this.model.pageSettings.totalPages-1&&!this.model.scrollSettings.enableVirtualization){for(pt=this.model.pageSettings.pageSize-this._previousPageLength,rt=0;rt<pt;rt++)wt=this.getRows()[this.getRows().length-(this.model.pageSettings.pageSize-rt)],wt.remove();this._tempPageRendered=!0;this.model.currentViewData=h.result}else this.model.currentViewData=h.result;this._gridRecordsCount=h.count;this._remoteSummaryData=h.aggregates;this._searchCount=this._searchString.length?h.count:null;!this.model.groupSettings.groupedColumns.length||this._dataSource()instanceof t.DataManager&&this.initialRender||this._setAggregates()}},_formatGroupColumn:function(n,i){var f=this.getColumnByField(i),r,u;return r=f.format,u=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),r=u.exec(r)[2],t.format(n,r,this.model.locale)},_refreshViewPageDetails:function(){this._currentPage(1);this.model.currentIndex=0;this._currentVirtualIndex=1;this.getContent().ejScroller("model.scrollTop",0)},_refreshVirtualViewDetails:function(n){var i=this._dataSource();n&&(this._gridRecordsCount=i!==null?i instanceof t.DataManager?i.dataSource.json.length:i.length:this.model.pageSettings.totalRecordsCount);this._totalVirtualViews=Math.ceil(this._getVirtualTotalRecord()/this._virtualRowCount);this._maxViews=Math.ceil(this.model.pageSettings.pageSize/this._virtualRowCount);this.model.pageSettings.totalPages=Math.ceil(this._gridRecordsCount/this.model.pageSettings.pageSize);this.model.pageSettings.totalRecordsCount=this._gridRecordsCount;this._lastViewData=this._virtualRowCount-(this._totalVirtualViews*this._virtualRowCount-this._getVirtualTotalRecord())},_getVirtualLoadedRecords:function(t){var i=this._currentPage(),r,u,f;if(this._needPaging&&(this._isLastVirtualpage=r=this._isThumbScroll&&i==this.model.pageSettings.totalPages&&!this._virtualPageRecords[i],(this.initialRender||this._virtualDataRefresh)&&(r=!0),this.model.virtualLoading&&this._isLocalData&&(this.model.currentIndex!=0||i!=1)&&this.model.currentIndex<this.model.pageSettings.totalRecordsCount?this._getVirtualOnLoadingData(i,!r):this._setVirtualPaging(t,i,!r),!this.initialRender&&this._isThumbScroll&&this._virtualPageRecords[i]&&!this._virtualDataRefresh&&this._checkPrevNextViews(i,t)),this._needPaging=!1,this._setVirtualLoadedIndexes(this._currentVirtualIndex),this.initialRender&&this._isLocalData)for(this.model.currentViewData=[],u=0;u<this._currentLoadedIndexes.length;u++)f=this._currentLoadedIndexes[u],this._virtualLoadedRecords[f]&&n.merge(this.model.currentViewData,this._virtualLoadedRecords[f])},_setVirtualPaging:function(i,r,u){var e=t.pvt.filterQueries(i.queries,"onPage"),f;e.length&&i.queries.splice(n.inArray(e[0],i.queries),1);(!u||this._needVPaging)&&this.model.currentIndex>this._virtualRowCount?this._initCurrentIndex(i,r):i.page(r,this.model.pageSettings.pageSize);this._needVPaging=!1;this._isLocalData&&!this._virtualPageRecords[r]&&(f=this._dataManager.executeLocal(i),this.initialRender||(this.model.currentViewData=f.result),this.model.searchSettings.key.length>0&&(this._gridRecordsCount=f.result.length,this.model.pageSettings.totalPages=Math.ceil(this._gridRecordsCount/this.model.pageSettings.pageSize)),f.result.length?(this._setVirtualLoadedRecords(f.result,r),n.inArray(r,this._virtualLoadedPages)==-1&&this._virtualLoadedPages.push(r)):this.initialRender||this.getContent().find(".e-virtualtop, .e-virtualbottom").remove())},_checkPrevNextViews:function(){var n=this._currentVirtualIndex,u=this._virtualLoadedRecords[n-1],f=this._virtualLoadedRecords[n+1],r=this._maxViews==3?1:2,t,i;n!=1&&n!=this._totalVirtualViews&&(u&&u.length==this._virtualRowCount?f&&f.length==this._virtualRowCount||this._totalVirtualViews==n-1||(i=n-r,this._currentVirtualIndex=this._virtualLoadedRecords[n]?i:i-1,t=this._scrollValue-r*this._virtualRowCount*this._vRowHeight):(i=n+r,this._currentVirtualIndex=this._virtualLoadedRecords[n]?i:i+1,t=this._scrollValue+r*this._virtualRowCount*this._vRowHeight),t&&(this._scrollValue=t,this._setVirtualLoadedIndexes(this._currentVirtualIndex),this.model.currentIndex=t==0?t:Math.floor(t/this._vRowHeight)))},_initCurrentIndex:function(i,r){var e=r*this.model.pageSettings.pageSize,c=this._currentVirtualIndex*this._virtualRowCount+this._virtualRowCount,l=this._currentVirtualIndex*this._virtualRowCount-this._virtualRowCount*2,v=c>e||l<e-this.model.pageSettings.pageSize,f,o,u,h,a,s;v||this._isLastVirtualpage?(c>e?(f=(r-1)*this.model.pageSettings.pageSize,o=this.model.pageSettings.pageSize*2,this._isInitNextPage=!0):(l<e-this.model.pageSettings.pageSize||this._isLastVirtualpage)&&(f=(r-2)*this.model.pageSettings.pageSize,o=this.model.pageSettings.pageSize*2,this._isInitNextPage=!1,this._remoteRefresh=!0),this.model.virtualLoading&&this._isLocalData?(u={},u.endIndex=f+o,u.endIndex=u.endIndex>this._getVirtualTotalRecord()?this._getVirtualTotalRecord():u.endIndex,u.startIndex=f,u.currentPage=this._currentPage(),u.result=null,this._trigger("virtualLoading",u),s=u.result,this._setInitialCurrentIndexRecords(s,r)):(h=t.pvt.filterQueries(i.queries,"onSkip"),h.length&&i.queries.splice(n.inArray(h[0],i.queries),1),i.skip(f).take(o),this._isLocalData&&(a=this._dataManager.executeLocal(i),s=this.model.currentViewData=a.result,this._isLastVirtualpage=!1,this._setInitialCurrentIndexRecords(s,r)))):(this._needVPaging=!1,this.model.virtualLoading&&this._isLocalData&&(this.model.currentIndex!=0||r!=1)?this._getVirtualOnLoadingData(r,!0):this._setVirtualPaging(i,r,!0))},_setInitialCurrentIndexRecords:function(n,t){for(var i=0;i<2;i++){var r=i*this.model.pageSettings.pageSize,f=r+this.model.pageSettings.pageSize,e=n.slice(r,f),u;u=this._isInitNextPage||t==1&&this.model.pageSettings.totalPages==1?i==0?t:t+1:i==0?t-1:t;this._setVirtualLoadedRecords(e,u)}},_getVirtualOnLoadingData:function(n,t){var r,u;n>0&&(this.model.currentIndex>this._virtualRowCount&&(!t||this._needVPaging)&&this.model.currentIndex<this.model.pageSettings.totalRecordsCount?this._initCurrentIndex(i,n):(r={},r.endIndex=n*this.model.pageSettings.pageSize>this._gridRecordsCount?this._gridRecordsCount:n*this.model.pageSettings.pageSize,r.startIndex=n*this.model.pageSettings.pageSize-this.model.pageSettings.pageSize,r.currentPage=this._currentPage(),r.result=null,this._trigger("virtualLoading",r),u=r.result,this._setVirtualLoadedRecords(u,n)))},_setVirtualLoadedRecords:function(t,i){var u=this._virtualRowCount,h=this.model.pageSettings.pageSize,v=h/u,o,y=Math.ceil(i*h/u),p=i==this.model.pageSettings.totalPages,l,e,f,s,r,w,c,a,b;for(this._virtualPageRecords[i]||(this._virtualPageRecords[i]=t),p&&(l=this._getVirtualTotalRecord()%h,y=(!this._virtualLoadedRecords[this._totalVirtualViews]||this._virtualLoadedRecords[this._totalVirtualViews].length!=this._lastViewData)&&l<this._lastViewData&&l!=0?this._totalVirtualViews+1:this._totalVirtualViews,this._getVirtualTotalRecord()<u&&(this._singleView=!0)),e=0;e<v;e++)r=Math.ceil((i-1)*v+(e+1)),(r<=this._totalVirtualViews||p)&&r<=y&&(this._virtualLoadedRecords[r-1]&&this._virtualLoadedRecords[r-1].length!=u?(w=this._virtualLoadedRecords[r-1].length+e*u,f=u-w+e*u,n.merge(this._virtualLoadedRecords[r-1],t.slice(0,f)),o=s=f+u,r<=this._totalVirtualViews&&(this._virtualLoadedRecords[r]=t.slice(f,o))):r==1||this._virtualLoadedRecords[r-1]?(f=o?o:e*u%h,o=s=f+u):(c=s=(r-1)*u%h,c!=0&&(this._virtualLoadedRecords[r-1]=t.slice(0,c)),f=c,s=o=c+u),!this._singleView&&this._virtualLoadedRecords[r]&&this._virtualLoadedRecords[r].length!=u?(a=t.slice(f,s),a.length+this._virtualLoadedRecords[r].length<=u&&(b=n.merge(a,this._virtualLoadedRecords[r]),this._virtualLoadedRecords[r]=b)):!this._virtualLoadedRecords[r]&&r<=this._totalVirtualViews&&(this._virtualLoadedRecords[r]=t.slice(f,s)));n.inArray(i,this._virtualLoadedPages)==-1&&this._virtualLoadedPages.push(i)},_setVirtualLoadedIndexes:function(n){var i,t;for(this._prevLoadedIndexes=this._currentLoadedIndexes,this._currentLoadedIndexes=[],i=n==this._totalVirtualViews?n:n+1,n!=1&&(n=n-1),t=n;t<=i;t++)this._currentLoadedIndexes.push(t)},_getVirtualTotalRecord:function(){return this.model.filterSettings.filteredColumns.length==0?this._searchCount==null?this._gridRecordsCount:this._searchCount:this._filteredRecordsCount},_initGridRender:function(){var i,h,u,c,f,v,l,r;if(this.addInitTemplate(),this.model.scrollSettings.frozenColumns>0&&this.addFrozenTemplate(),this.model.allowGrouping&&this.addGroupingTemplate(),this.model.showSummary&&this.addSummaryTemplate(),(this.model.allowResizing||this.model.allowResizeToFit)&&(this._resizer=new t.gridFeatures.gridResize(this)),this.model.keySettings&&n.extend(this.model.keyConfigs,this.model.keySettings),this._initHeight=this.model.scrollSettings.height,this.model.scrollSettings.height=="100%"&&(this._isHeightResponsive=this.model._isHeightResponsive=!0),this.render(),this._setTextWrap(),this.model.columnLayout=="fixed"){var a=this.model.scrollSettings.frozenColumns>0?this.getHeaderTable().eq(0).width()+this.getHeaderTable().eq(1).width():this.getHeaderTable().width(),e=this.getHeaderContent().width()>a?"addClass":"removeClass",o=this.getHeaderTable(),s=this.getContentTable();this.model.scrollSettings.frozenColumns>0&&(o=this.getVisibleColumnNames().length<=this.model.scrollSettings.frozenColumns?this.getHeaderTable().eq(1):this.getHeaderTable().eq(0),s=this.getVisibleColumnNames().length<=this.model.scrollSettings.frozenColumns?this.getContentTable().eq(1):this.getContentTable().eq(0));o[e]("e-tableLastCell");s[e]("e-tableLastCell")}if(this.model.allowGrouping&&this.model.groupSettings.showDropArea&&t.gridFeatures.dragAndDrop&&this._headerCellgDragDrop(),this.model.allowReordering&&t.gridFeatures.dragAndDrop&&(this._headerCellreorderDragDrop(),this._initIndicators()),this._wireEvents(),this.model.allowGrouping&&!t.isNullOrUndefined(this.model.serverProperties))for(this.model._groupingCollapsed=this.model.serverProperties._groupingCollapsed,i=0;i<this.model._groupingCollapsed.length;i++)h=this.getContent().find(".e-recordplusexpand"),u=h.filter("td[data-ej-mappingname='"+this.model._groupingCollapsed[i].key+"'    ][data-ej-mappingvalue='"+this.model._groupingCollapsed[i].value+"']"),u.length>1&&!t.isNullOrUndefined(this.model._groupingCollapsed[i].parent)&&(c=this.model._groupingCollapsed[i].parent,u=u.filter(function(){return n(this).parents(".e-tabletd").parent("tr").prev("tr").find(".e-recordplusexpand[data-ej-mappingvalue="+c+"]").length})),this.expandCollapse(u);this.initialRender=!1;this.model.width&&!this.model.allowScrolling&&this.element.width(this.model.width);(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&this._processEditing();this.model.mergeHeaderCellInfo!=null&&(f={columnHeaders:this.getHeaderContent().find(".e-columnheader"),model:this.model},v=this,this._headerCellMerge(f),this._trigger("mergeHeaderCellInfo",f));this._trigger("dataBound",{});this._trigger("refresh");this.model.parentDetails&&(l=this.model.parentDetails.parentID,r=n("#"+l).data("ejGrid"),r.model.allowScrolling&&r._refreshScroller({requestType:"refresh"}));this.element.closest("tr").hasClass("e-detailrow")&&!this.model.parentDetails&&(r=this.element.closest("tr.e-detailrow").closest(".e-grid").data("ejGrid"),r.model.allowScrolling&&r.getScrollObject().refresh());this.model.allowFiltering&&this.model.filterSettings.filterType=="menu"&&this._renderFilterDialogs();this.model.enableResponsiveRow&&(this.model.allowSorting||this.model.allowFiltering)&&this._renderResponsiveFilter();this.model.allowScrolling&&(this._vRowHeight=Math.floor(this.getRowHeight()));this.model.allowGrouping&&this.model.showSummary&&this.model.currentViewData&&(this._refreshGroupSummary(),!t.isNullOrUndefined(this.model.currentViewData)&&this.model.currentViewData.length&&this._refreshGridFooterColGroup());this._isMapSelection&&this._mappingSelection();this.model.showColumnChooser&&this._renderColumnChooser();this._enableCheckSelect&&(this.model.currentViewData!=null&&this.model.currentViewData.length==0?this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").hide():this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").show())},calculatePageSizeByParentHeight:function(n){var i,r,u;if(this.model.allowPaging&&(this.model.allowTextWrap&&this.model.textWrapSettings.wrapMode=="header"||!this.model.allowTextWrap))if(typeof n=="string"&&n.indexOf("%")!=-1&&(n=parseInt(n)/100*this.element.height()),r=this._getNoncontentHeight()+this.getRowHeight(),parseInt(n)>r&&(u=parseInt(n)-this._getNoncontentHeight(),i=parseInt(u/this.getRowHeight())),t.isNullOrUndefined(i))throw"The parent height of grid must be more than 150";else return i},_setTextWrap:function(){if(this.model.allowTextWrap==!0){switch(this.model.textWrapSettings.wrapMode){case"content":this.element.find(".e-columnheader").removeClass("e-wrap");this.element.removeClass("e-wrap");this.getContent().addClass("e-wrap");break;case"header":this.element.removeClass("e-wrap");this.getContent().removeClass("e-wrap");this.element.find(".e-columnheader").addClass("e-wrap");break;default:this.getContent().removeClass("e-wrap");this.element.find(".e-columnheader").removeClass("e-wrap");this.element.addClass("e-wrap")}if(this.model.scrollSettings.frozenColumns>0&&this.model.textWrapSettings.wrapMode!="content"){var n=this.getHeaderContent().find(".e-frozenheaderdiv").find(".e-columnheader").last().find("th"),t=this.getHeaderContent().find(".e-movableheader").find(".e-columnheader").last().find("th");n.height()>t.height()?t.height(n.height()):n.height(t.height())}}else this.getContent().removeClass("e-wrap").find(".e-rowcell").removeClass("e-nwrap"),this.element.find(".e-columnheader").removeClass("e-wrap").find(".e-headercelldiv").removeClass("e-nwrap"),this.element.removeClass("e-wrap")},_getMetaColGroup:function(){for(var r,u=t.buildTag("colgroup"),i=0;i<this.model.columns.length;i++)r=n(document.createElement("col")),this.model.columns[i].visible===!1&&r.css("display","none"),this.model.rowTemplate==null||t.isNullOrUndefined(this.model.columns[i].cssClass)||r.addClass(this.model.columns[i].cssClass),this.model.allowGrouping&&!this.model.groupSettings.showGroupedColumn&&n.inArray(this.model.columns[i].field,this.model.groupSettings.groupedColumns)!=-1&&r.css("display","none"),u.append(r);return u},_alternateRow:function(){return this.getIndex()%2==0?"e-row":"e-alt_row"},addInitTemplate:function(){var k=!t.isNullOrUndefined(this.getHeaderTable())&&this.getHeaderTable().find(".e-headercelldiv:not(.e-emptyCell)"),v={},d=!0,y=document.createElement("tbody"),p=n(y),g,nt=null,b,a,tt,r,f,st,s,it,ut,l,ft,e,et,ot;if(this.model.rowTemplate==null){var w=document.createElement("tr"),o=n(w),u=this.model.columns,r;for(this._gridRecordsCount&&!this._virtualDataRefresh?(b=this.model.editSettings.showAddNewRow&&!this.initialRender?this.model.currentViewData[1]:this.model.currentViewData[0],t.isNullOrUndefined(b)||this._initColumns(b)):this._isLocalData&&(this._dataSource()!=null&&this._dataSource().length||this._dataManager&&this._dataManager.dataSource.json.length)&&this._initColumns(this._dataSource()[0]!=i?this._dataSource()[0]:this._dataManager.dataSource.json[0]),a={_gridFormatting:this.formatting,getComplexData:t.getObject},n.views.helpers(a),e={},e._foreignKey=this._foreignKeyBinding,n.views.helpers(e),(this.model.childGrid||this.model.detailsTemplate)&&(tt=t.buildTag("td.e-detailrowcollapse","<div class='e-icon e-gnextforward'><\/div>"),o.append(tt)),r=0;r<this.model.columns.length;r++){if(f=t.buildTag("td.e-rowcell"),t.isNullOrUndefined(u[r].tooltip)&&u[r].clipMode!=t.Grid.ClipMode.EllipsisWithTooltip||f.addClass("e-gridtooltip"),(u[r].clipMode==t.Grid.ClipMode.Ellipsis||u[r].clipMode==t.Grid.ClipMode.EllipsisWithTooltip)&&f.addClass("e-gridellipsis"),this.model.isResponsive&&f.attr("data-cell",this._decode(this.model.columns[r].headerText)),u[r].visible==!1?f.addClass("e-hide"):(d&&(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&f.addClass("e-detailrowvisible"),d=!1),f.hasClass("e-hide")||this.model.groupSettings.showGroupedColumn||f.addClass("{{for ~groupedColumns}} {{if #data == '"+this.model.columns[r].field+"'}}e-hide{{/if}}{{/for}}"),t.isNullOrUndefined(u[r].templateID||u[r].template)){for(var h=(u[r].field||"").split("."),rt=h.length-1,c="";rt;)c+="(",rt--;ut=u[r].type||u[r].editType;switch(ut){case"boolean":case"booleanedit":t.isNullOrUndefined(u[r].displayAsCheckbox)&&(u[r].displayAsCheckbox=!0);u[r].displayAsCheckbox?(l="",l=this.model.editSettings.editMode=="batch"&&(t.isNullOrUndefined(u[r].allowEditing)||u[r].allowEditing)?l:"disabled='disabled'",ft="{{if ~getComplexData('"+this.model.columns[r].field+"', #data)}} <input type ='checkbox' "+l+" checked='checked'><\/input>{{else}} <input type ='checkbox' "+l+"><\/input> {{/if}}",f.addClass("e-boolrowcell").html(ft)):f.html("{{if ~getComplexData('"+this.model.columns[r].field+"', #data)}}"+this.localizedLabels.True+"{{else}}"+this.localizedLabels.False+"{{/if}}");break;case"checkbox":this._enableCheckSelect=!0;this.model.selectionType="multiple";this.model.editSettings.allowDeleting&&(this.multiDeleteMode=!0);this.model.selectionSettings.enableToggle=!0;this._isMapSelection=!t.isNullOrUndefined(u[r].field)&&u[r].field!="";this._selectionMapColumn=u[r].field;u[r].textAlign="center";this._isMapSelection||(this.model.columns[r].allowGrouping=this.model.columns[r].allowFiltering=this.model.columns[r].allowSorting=!1);f.addClass("e-checkcell").html("<div class = 'e-checkcelldiv'>{{if #data['"+h.join("']['")+"']}} <input type ='checkbox' checked='checked'><\/input>{{else}} <input type ='checkbox'><\/input> {{/if}}<\/div>");this.model.columns[r].editType=t.Grid.EditingType.Boolean;this.model.scrollSettings.frozenColumns>0&&f.addClass("e-frozenunbound");this.model.enableAutoSaveOnSelectionChange=!1;break;default:u[r].disableHtmlEncode?f.html("{{html:"+c+"#data['"+h.join("'] || {})['")+"']}}"):f.html("{{:"+c+"#data['"+h.join("'] || {})['")+"']}}")}u[r].format==i||u[r].foreignKeyValue||f.html("{{:~_gridFormatting('"+u[r].format+"',"+c+"#data['"+h.join("'] || {})['")+"'],'"+this.model.locale+"')}}");u[r].foreignKeyValue&&u[r].dataSource&&f.html("{{:~_foreignKey("+r+","+c+"#data['"+h.join("'] || {})['")+"'],'"+this._id+"')}}");u[r].commands&&(e={},e["_"+this._id+"UnboundTemplate"]=this._unboundTemplateRendering,n.views.helpers(e),(t.isNullOrUndefined(u[r].field)||u[r].field=="")&&(this.model.columns[r].allowGrouping=this.model.columns[r].allowFiltering=this.model.columns[r].allowSorting=!1),t.isNullOrUndefined(u[r].headerText)||n("#"+this._id+u[r].headerText.replace(/[^a-z0-9|s_]/gi,"")+r+"_UnboundTemplate").remove(),g=this._createUnboundElement(u[r],r),t.isNullOrUndefined(u[r].headerText)||f.addClass("e-unboundcell").addClass("e-"+u[r].headerText.replace(/[^a-z0-9|s_]/gi,"")+r).html("{{:~_"+this._id+"UnboundTemplate('"+g.id+"')}}"),this.model.scrollSettings.frozenColumns>0&&f.addClass("e-frozenunbound"),this._isUnboundColumn=!0)}else e={},s=u[r].headerText,e["_"+this._id+"ColumnTemplating"]=t.proxy(this._gridTemplate,null,this,st),n.views.helpers(e),t.isNullOrUndefined(s)||t.isNullOrUndefined(s.match(/[^0-9\s\w]/g))||(s=s.replace(/[^0-9\s\w]/g,"_")),n("#"+this._id+s+r+"_Template").remove(),it=this._createTemplateElement(u[r]),(u[r].field==""||t.isNullOrUndefined(u[r].field))&&(this.model.columns[r].allowGrouping=this.model.columns[r].allowFiltering=this.model.columns[r].allowSorting=!1),u[r].template!=!1&&f.addClass("e-templatecell").html("{{:~_"+this._id+"ColumnTemplating('"+it.id+"','"+r+"')}}");u[r].textAlign==i&&(u[r].textAlign="left");u[r].isPrimaryKey===!0&&(this._primaryKeys.push(n.trim(u[r].field)),this._primaryKeys=t.isNullOrUndefined(n.uniqueSort)?n.unique(this._primaryKeys.sort()):n.uniqueSort(this._primaryKeys.sort()));this.phoneMode&&this.model.enableResponsiveRow||u[r].textAlign==i||(f.css("text-align",u[r].textAlign),n(k[r]).css("text-align",u[r].textAlign));this.phoneMode||t.isNullOrUndefined(u[r].headerTextAlign)||n(k[r]).css("text-align",u[r].headerTextAlign);t.isNullOrUndefined(u[r].cssClass)||f.addClass(u[r].cssClass);this.model.allowTextWrap&&this.model.textWrapSettings.wrapMode!="header"&&u[r].allowTextWrap==!1&&f.addClass("e-nwrap");t.isNullOrUndefined(u[r].priority)||f.addClass("e-table-priority-"+u[r].priority);t.isNullOrUndefined(u[r].customAttributes)||f.attr(u[r].customAttributes);f.attr("data-role","gridcell");o.append(f);this.model.enableAltRow?(a["_"+this._id+"AlternateRow"]=this._alternateRow,n.views.helpers(a),o.addClass("{{:~_"+this._id+"AlternateRow()}}")):o.addClass("e-row");o.attr("data-role","row");this.model.scrollSettings.frozenColumns>0&&this.model.scrollSettings.frozenColumns==r+1&&(y.appendChild(w),v[this._id+"_JSONFrozenTemplate"]=p.html(),o.empty(),p.empty())}y.appendChild(w)}else e={},et=this._createRowTemplateElement(this.model.rowTemplate),e["_"+this._id+"rowTemplating"]=t.proxy(this._gridRowTemplate,null,this),ot=!t.isNullOrUndefined(this.model.ngTemplateId)&&(this.model.rowTemplate.startsWith("#")||this.model.rowTemplate.startsWith(".")||typeof this.model.rowTemplate=="object")?this.model.ngTemplateId+"gridrowtemplate":null,nt="{{:~_"+this._id+"rowTemplating('"+et.id+"','"+ot+"')}}",n.views.helpers(e);v[this._id+"_JSONTemplate"]=this.model.rowTemplate!=null?nt:p.html();n.templates(v)},_gridRowTemplate:function(n,t,i){return n._renderEjTemplate("#"+t,this.data,this.index,null,i)},_createRowTemplateElement:function(i){var u=i,f=/^#([\w-]*)/.exec(u),o=o||n("body"),r,e={name:"SCRIPT",type:"text/x-template",text:u,id:(this._id+"RowTemplate").replace(/(\\|[^0-9A-z-_])/g,"")};return r=f&&f[1]?document.getElementById(f[1]):/^<script/i.test(u)?n(u).get(0):t.buildTag(e.name).get(0),r.id=r.id||e.id,r.type=r.type||e.type,t.isNullOrUndefined(f)&&n(r).text(e.text),o.append(r),r},render:function(){if(this.model.showSummary=this.model.summaryRows.length>0||this.model.showSummary,this._renderGridContent().insertAfter(this.element.children(".e-gridheader")),this.model.allowResizeToFit&&this.setWidthToColumns(),this.model.allowGrouping&&t.gridFeatures.dragAndDrop&&this._groupHeaderCelldrag(),this.model.showSummary&&this._currentJsonData.length){var n=this._renderGridFooter();t.isNullOrUndefined(n)||n.insertAfter(this.getContent());this._hideCaptionSummaryColumn()}this._initialEndRendering()},_createStackedRow:function(r,u){for(var p,et,ot,f,w,b,k,e,o,ht,v,y=t.buildTag("tr.e-columnheader e-stackedHeaderRow"),a=[],g=[],nt=[],tt=[],s=0;s<this.model.columns.length;s++)if(p=this.model.columns[s],p.visible!=!1){if(this.model.allowGrouping&&!this.model.groupSettings.showGroupedColumn&&this.model.groupSettings.groupedColumns.length>0&&n.inArray(p.field,this.model.groupSettings.groupedColumns)!=-1)continue;var it="",rt="",ut="",ft="",c=r.stackedHeaderColumns;for(o=0;o<c.length;o++)et=n.isArray(c[o].column)?c[o].column:n.map(c[o].column.split(","),n.trim),ot="e-row"+n.inArray(r,this.model.stackedHeaderRows)+"-column"+o,n.inArray(p.field,et)!=-1&&(it=c[o].headerText,rt=c[o].cssClass,ut=c[o].textAlign,ft=c[o].tooltip?" e-gridtooltip "+ot:"");a.push(it);g.push(rt);nt.push(ut);tt.push(ft)}for(f=[],e=0;e<a.length;e++){for(w=1,b=e+1;b<a.length;b++)if(a[e]==a[b])w++;else break;f.push({sapnCount:w,headerText:a[e],cssClass:g[e],txtAlign:nt[e],tooltip:tt[e]});e+=w-1}if(y=t.buildTag("tr.e-columnheader e-stackedHeaderRow"),k=this.model.scrollSettings.frozenColumns,this.model.allowScrolling&&k>0){var d=[],l=0,h=0,st=0;for(e=0;e<this.model.columns.length;e++)o=this.model.columns[e],e<k&&o.visible==!1&&st++;for(l=k-st;l>0;)ht=f[h].sapnCount,f[h].sapnCount<l?(d.push(f[h]),u?h++:f.splice(h,1)):f[h].sapnCount>l?(f[h].sapnCount=f[h].sapnCount-l,u&&d.push({sapnCount:l,headerText:f[h].headerText})):(d.push(f[h]),u||f.splice(h,1)),l-=ht;u&&(f=d)}for((this.model.detailsTemplate||this.model.childGrid)&&y.append(t.buildTag("th.e-headercell e-detailheadercell","<div><\/div>")),s=0;s<f.length;s++)v=t.buildTag("th.e-headercell e-stackedHeaderCell e-default"+f[s].tooltip,f[s].headerText,{},{colspan:f[s].sapnCount}),v.css("textAlign",f[s].txtAlign),y.append(v),f[s].cssClass!=i&&v.addClass(f[s].cssClass),(this.model.allowResizing||this.model.allowReordering||this.model.allowResizeToFit)&&v.addClass("e-resizer");return y},_renderGridHeaderInternalDesign:function(r,u){var k=t.buildTag("table.e-table","",{},{"data-role":"grid"}),v=t.buildTag("thead"),d=t.buildTag("tbody.e-hide"),y=t.buildTag("tr.e-columnheader"),p=n(document.createElement("colgroup")),w=n(document.createElement("tr")),g,f,c,a,l,tt,s,h,b;if((this.model.childGrid||this.model.detailsTemplate)&&(y.append(t.buildTag("th.e-headercell e-detailheadercell","<div><\/div>")),w.append(document.createElement("td")),p.append(this._getIndentCol())),this.model.showStackedHeader)for(s=0;s<this.model.stackedHeaderRows.length;s++)g=this._createStackedRow(this.model.stackedHeaderRows[s],u),v.append(g);for(f=0;f<r.length;f++){var e=t.buildTag("th.e-headercell e-default","",{},{"data-role":"columnheader"}),nt=document.createElement("td"),o=t.buildTag("div.e-headercelldiv",r[f].headerText===i&&r[f].type!="checkbox"?r[f].headerText=r[f].field:r[f].headerText,{},{"data-ej-mappingname":r[f].field});if(r[f].disableHtmlEncode&&o.text(r[f].headerText),t.isNullOrUndefined(r[f].headerTooltip)||o.addClass("e-gridheadertooltip"),t.isNullOrUndefined(r[f].tooltip)||o.addClass("e-gridtooltip"),(r[f].clipMode==t.Grid.ClipMode.Ellipsis||r[f].clipMode==t.Grid.ClipMode.EllipsisWithTooltip)&&o.addClass("e-gridellipsis"),(this.model.allowResizing||this.model.allowReordering||this.model.allowResizeToFit)&&e.addClass("e-resizer"),e.append(o),this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this.model.filterSettings.filterType=="excel")&&(r[f].allowFiltering==i||r[f].allowFiltering===!0)&&(!t.isNullOrUndefined(r[f].field)||r[f].field=="")&&r[f].type!="checkbox"){if(c="e-filterset",!this.initialRender&&this.model.filterSettings.filteredColumns)for(a=0;a<this.model.filterSettings.filteredColumns.length;a++)this.model.filterSettings.filteredColumns[a].field==r[f].field&&(c="e-filterset e-filteredicon e-filternone");e.append(t.buildTag("div.e-filtericon e-icon "+c));this.model.allowGrouping&&this.model.groupSettings.showToggleButton&&n.inArray(r[f].field,this._disabledGroupableColumns)==-1&&!t.isNullOrUndefined(r[f].field)&&r[f].field!=""?(e.addClass("e-headercellgroupfilter"),e.find(".e-filtericon").addClass("e-groupfiltericon")):e.addClass("e-headercellfilter");t.browserInfo().name=="msie"&&t.browserInfo().version=="8.0"&&this.model.enableRTL&&n(o).css("padding","0 0 0 2em")}l=document.createElement("col");r[f].priority&&n(nt).addClass("e-table-priority-"+r[f].priority);w.append(nt);y.append(e);p.append(l);r[f].visible===!1?(tt=r.filter(function(n){return n.headerText==r[f].headerText}).length>1,e.addClass("e-hide")&&n(l).css("display","none"),(n.inArray(r[f].headerText,this._hiddenColumns)==-1||tt)&&n.inArray(r[f].field,this._hiddenColumnsField)==-1&&(this._hiddenColumns.push(r[f].headerText)&&r[f].field!=(""||i)?this._hiddenColumnsField.push(r[f].field):this._hiddenColumnsField.push(r[f].headerText)),n.inArray(r[f].field,this._visibleColumnsField)!=-1&&this._visibleColumnsField.splice(n.inArray(r[f].field,this._visibleColumnsField),1)&&this._visibleColumns.splice(n.inArray(r[f].headerText,this._visibleColumns),1)):(this._visibleColumns.push(r[f].headerText)&&r[f].field!=(""||i)?this._visibleColumnsField.push(r[f].field):this._visibleColumnsField.push(r[f].headerText),r[f].visible=!0,n.inArray(r[f].field==""?r[f].headerText:r[f].field,this._hiddenColumnsField)!=-1&&this._hiddenColumnsField.splice(n.inArray(r[f].field==""?r[f].headerText:r[f].field,this._hiddenColumnsField),1)&&this._hiddenColumns.splice(n.inArray(r[f].headerText,this._hiddenColumns),1));this.model.showColumnChooser&&r[f].showInColumnChooser!==!1&&(r[f].showInColumnChooser=!0);this.model.allowResizing&&r[f].allowResizing!==!1&&(r[f].allowResizing=!0);t.isNullOrUndefined(r[f].headerTextAlign)?r[f].textAlign!=i?o.css("text-align",r[f].textAlign):this.model.enableRTL&&o.css("text-align",r[f].textAlign="right"):o.css("text-align",r[f].headerTextAlign);r[f].allowResizing===!1&&this._disabledResizingColumns.push(r[f].field);r[f].allowSorting===!1&&this._disabledSortableColumns.push(r[f].field);r[f].allowGrouping===!1&&this._disabledGroupableColumns.push(r[f].field);r[f].allowEditing===!1&&this._disabledEditableColumns.push(r[f].field);t.isNullOrUndefined(r[f].cssClass)||(e.addClass(r[f].cssClass),n(l).addClass(r[f].cssClass));this.model.allowTextWrap&&this.model.textWrapSettings.wrapMode!="content"&&r[f].allowTextWrap==!1&&o.addClass("e-nwrap");t.isNullOrUndefined(r[f].headerTemplateID)||(o.html(n(r[f].headerTemplateID).hide().html()).parent().addClass("e-headertemplate"),s=n.inArray(r[f].field,this._disabledGroupableColumns),s==-1&&t.isNullOrUndefined(r[f].field)&&this._disabledGroupableColumns.push(r[f].field));t.getObject("type",r[f])=="checkbox"&&t.isNullOrUndefined(r[f].headerText)&&(o.addClass("e-headercheckcelldiv"),o.html("<input type = 'checkbox' class = 'e-checkselectall'><\/input>"),t.isNullOrUndefined(r[f].field)||o.attr("data-ej-mappingname",r[f].field));this.model.allowGrouping&&this.model.groupSettings.showToggleButton&&n.inArray(r[f].field,this._disabledGroupableColumns)==-1&&!t.isNullOrUndefined(r[f].field)&&r[f].field!=""&&(n.inArray(r[f].field,this.model.groupSettings.groupedColumns)!=-1?e.append(this._getToggleButton().addClass("e-toggleungroup")):e.append(this._getToggleButton().addClass("e-togglegroup")),c||e.addClass("e-headercellgroup"),this.model.enableRTL&&(c?o.addClass("e-headercelldivgroup"):e.find(".e-gridgroupbutton").addClass("e-rtltoggle")));e.attr("title",this._decode(r[f].headerText));r[f].priority&&(e.attr("data-priority",r[f].priority).addClass("e-table-priority-"+r[f].priority),n(l).addClass("e-table-priority-"+r[f].priority));this.initialRender&&(h=f,b=this.model.scrollSettings.frozenColumns,h=u?h:b>0?h+b:h,this._columnsPixelConvert(r[f],h));r[f].width==i&&this.model.commonWidth!==i&&(this.columnsWidthCollection[f+this.model.scrollSettings.frozenColumns]=this.model.commonWidth);this._fieldColumnNames[r[f].headerText]=r[f].field;this._headerColumnNames[r[f].field]=r[f].headerText}return v.append(y),d.append(w),k.append(p).append(v).append(d),k},_columnsPixelConvert:function(i,r){for(var o,e,s=this.model.scrollSettings.width>0?this.model.scrollSettings.width:this.element.width(),f=t.isNullOrUndefined(i)?this.model.columns:n.makeArray(i),u=0;u<f.length;u++)e=r||u,typeof f[u].width=="string"&&f[u].width.indexOf("%")!=-1&&(this.model.allowScrolling||this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length)?(o=!t.isNullOrUndefined(this.getContent())&&!t.isNullOrUndefined(this.getContent().data("ejScroller"))&&this.getScrollObject().isVScroll()?this.model.scrollSettings.buttonSize:0,this.columnsWidthCollection[e]=parseInt(f[u].width)/100*(s-o)):this.columnsWidthCollection[e]=f[u].width},_renderGridHeader:function(){var n=t.buildTag("div.e-gridheader"),r,u,i=t.buildTag("div");return this.model.allowScrolling&&i.addClass("e-headercontent"),this.setGridHeaderContent(n),this.initialRender&&(this.columnsWidthCollection=[],this._hiddenColumns=[],this._hiddenColumnsField=[]),this._visibleColumns=[],this._visibleColumnsField=[],this._resetDisabledCollections(),this._fieldColumnNames={},this._headerColumnNames={},this.model.scrollSettings.frozenColumns>0?(r=t.buildTag("div.e-frozenheaderdiv",this._renderGridHeaderInternalDesign(this.model.columns.slice(0,this.model.scrollSettings.frozenColumns),!0)),u=t.buildTag("div.e-movableheader",t.buildTag("div.e-movableheaderdiv",this._renderGridHeaderInternalDesign(this.model.columns.slice(this.model.scrollSettings.frozenColumns),!1))),i.append(r).append(u)):i.append(this._renderGridHeaderInternalDesign(this.model.columns)),n.html(i),this.model.isResponsive&&n.addClass("e-textover"),this.setGridHeaderTable(this.getHeaderContent().find(".e-table")),n},_renderGridContent:function(){var o=t.buildTag("div.e-gridcontent"),h=t.buildTag("div"),e=t.buildTag("table.e-table",""),c=n(document.createElement("tbody")),r,u,l,f,s,i,a;if(e.append(this.getHeaderTable().find("colgroup").clone()).append(c),h.html(e),o.html(h),this.setGridContentTable(e),this.setGridContent(o),e.attr("data-role","grid"),r={},this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length){if(this.initialRender&&(r.columnName=this.model.groupSettings.groupedColumns[this.model.groupSettings.groupedColumns.length-1],!this.model.groupSettings.showGroupedColumn))for(i=0;i<this.model.groupSettings.groupedColumns.length;i++)u=this.model.groupSettings.groupedColumns[i],n.inArray(u,this._hiddenColumnsField)==-1&&(this._hiddenColumnsField.push(u),this._hiddenColumns.push(this.getColumnByField(u).headerText),this._visibleColumns.splice(this._visibleColumns.indexOf(this.getColumnByField(u).headerText),1),this._visibleColumnsField.splice(this._visibleColumnsField.indexOf(u),1),this.getColumnByField(u).visible=!1);r.requestType=t.Grid.Actions.Grouping}else r.requestType=t.Grid.Actions.Refresh;if(this._dataSource()==null||this._dataSource().length==0||this.model.currentViewData.length==0?(l=t.buildTag("td.emptyrecord",this.localizedLabels.EmptyRecord,{},{colSpan:this.model.columns.length-this._hiddenColumns.length}),c.append(n(document.createElement("tr")).append(l)),this.setWidthToColumns(),(this.initialRender||this.model.groupSettings.groupedColumns.length)&&this.sendDataRenderingRequest(r)):this.sendDataRenderingRequest(r),this._isCaptionSummary&&r.requestType=="grouping"&&this.model.groupSettings.groupedColumns.length>1)for(f=this.getContentTable().find(".e-table").not(".e-recordtable").children("colgroup"),s=n(this.getContentTable().find(".e-recordtable")[0]).children("colgroup").find("col"),i=0;i<f.length;i++)a=n(f[i]).find("col").length,n(f[i]).find("col:gt("+(a-s.length-1)+")").remove(),n(f[i]).append(s.clone());return o},print:function(){var r={};r.requestType="print";this._printselectrows=this.getContentTable().find('tr[aria-selected="true"]');this._trigger("actionBegin",r);var u=window.open("","print","height=452,width=1024,tabbar=no"),f=t.buildTag("div#"+this._id),i=n.extend(!0,{},this.model);i.toolbarSettings.showToolbar=i.allowPaging=i.allowScrolling=i.showColumnChooser=i.enablePersistence=!1;i.editSettings={};i.query.queries=[];i._isPrinting=!0;this.model.allowPaging&&this.model.pageSettings.printMode=="currentpage"?(i.query.queries=[{fn:"onPage",e:{pageIndex:this._currentPage(),pageSize:this.model.pageSettings.pageSize}}],i.dataBound=function(){this._printProcess(u)}):i.dataBound=function(){this._printProcess(u)};f.ejGrid(i)},_printProcess:function(n){var i=this.element,r={requestType:"print",element:i,selectedRows:this._printselectrows};this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&i.find(".e-filterbar").remove();i.show();this._trigger("beforePrint",r);t.isNullOrUndefined(r.element)||(i=r.element);t.print(i,n);this._trigger("actionComplete",r)},"export":function(i,r,u,f){var o=n.extend(!0,{},this.model),h=this,p={action:i,method:"post","data-ajax":"false"},e=t.buildTag("form","",null,p),s=[],c,w,l,a,v,y;return u&&!t.isOnWebForms?(c=n("div.e-grid"),f&&f.length>0&&(c=n.map(f,function(n){return document.getElementById(n)})),n.each(c,function(i,r){var u=n(r).data("ejGrid"),f,o,c;s.push({id:u._id,locale:u.model.locale});t.isNullOrUndefined(u)||(f=n.extend(!0,{},u.model),f=h._getExportModel(f),u.ignoreOnExport&&(o={name:"GridModel",type:"hidden",value:u.stringify(f)},c=t.buildTag("input","",null,o),e.append(c)))}),n("body").append(e),e.submit()):(this._locale=this.model.locale,o=this._getExportModel(o),w=this,t.raiseWebFormsServerEvents?(l={model:o,originalEventType:r},a={model:this.stringify(o)},t.raiseWebFormsServerEvents(r,l,a),setTimeout(function(){t.isOnWebForms=!0},1e3)):(v={name:"GridModel",type:"hidden",value:this.stringify(o)},y=t.buildTag("input","",null,v),e.append(y),e.append(this),n("body").append(e),e.submit())),setTimeout(function(){var i,r;if(s.length)for(i=0;i<s.length;i++)r=n("#"+s[i].id).data("ejGrid"),r.model.locale=s[i].locale;t.isNullOrUndefined(h._locale)||(h.model.locale=h._locale)},0),e.remove(),!0},_getExportModel:function(i){var e={},h,c,l,o,u,r;n.extend(e,t.Grid.Locale["en-US"],t.Grid.Locale[i.locale]);var f=e.GroupCaptionFormat,s=f.indexOf("{{if"),a=f.indexOf(" {{else}}"),v=f.slice(s,a).replace("{{if count == 1 }}","");for(s>=0&&(f=f.slice(0,s)),h={EmptyRecord:e.EmptyRecord,GroupCaptionFormat:f,GroupText:v,True:e.True,False:e.False},t.isNullOrUndefined(this.model)||(this.model.locale=i.locale.concat(JSON.stringify(h))),i.locale=i.locale.concat(JSON.stringify(h)),r=0;r<i.columns.length;r++)t.isNullOrUndefined(i.columns[r].template)||(n.isFunction(i.columns[r].template)?(c=i.columns[r].template(),i.columns[r].template=escape(c)):i.columns[r].template.indexOf("#")!=-1?(l=n.templates(i.columns[r].template).markup,i.columns[r].template=escape(n.trim(l))):i.columns[r].template=escape(i.columns[r].template));for(t.isNullOrUndefined(i.detailsTemplate)||(i.detailsTemplate=escape(n.trim(n.templates(i.detailsTemplate).markup))),r=0;r<i.filterSettings.filteredColumns.length;r++)i.filterSettings.filteredColumns[r].operator=="equal"?i.filterSettings.filteredColumns[r].operator="equals":i.filterSettings.filteredColumns[r].operator=="notequal"&&(i.filterSettings.filteredColumns[r].operator="notequals");if(i.showStackedHeader)for(i.stackedHeaderRow=i.stackedHeaderRows,r=0;r<i.stackedHeaderRow.length;r++)for(i.stackedHeaderRow[r].stackedHeaderColumn=i.stackedHeaderRow[r].stackedHeaderColumns,o=i.stackedHeaderRow[r].stackedHeaderColumn,u=0;u<o.length;u++)i.stackedHeaderRow[r].stackedHeaderColumn[u].column=n.isArray(o[u].column)?o[u].column:o[u].column.split(",");if(this.ignoreOnExport)for(r=0;r<this.ignoreOnExport.length;r++)delete i[this.ignoreOnExport[r]];return i},sendDataRenderingRequest:function(i){var v,ut,ft,k,et,ot,it,f,l,e,a,d,st,c,y,o,g,ht,p,rt,ct,nt,lt;if(this._templateRefresh&&(this.refreshTemplate(),this._templateRefresh=!1),this.setFormat(),this.model.scrollSettings.enableVirtualization||(this._previousColumnIndex=null,this._previousRowCellIndex=null,this._previousIndex=null),i.requestType=="add"||i.requestType=="grouping"||this.model.currentViewData!=null&&this.model.currentViewData.length)switch(i.requestType){case t.Grid.Actions.Refresh:case t.Grid.Actions.Paging:case t.Grid.Actions.Sorting:case t.Grid.Actions.Filtering:case t.Grid.Actions.Save:case t.Grid.Actions.Cancel:case t.Grid.Actions.Delete:case t.Grid.Actions.Search:case t.Grid.Actions.Reorder:case t.Grid.Actions.BatchSave:if(v=this.model.groupSettings.groupedColumns,this.model.allowGrouping&&i.requestType==t.Grid.Actions.Refresh&&v.length==0&&this.element.find(".e-grouptopleftcell").length>0&&(ut=this.element.children(".e-gridheader"),ut.find("div").first().empty().append(this._renderGridHeader().find("table"))),(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&n("#"+this._id+"_externalEdit").css("display","none"),this.model.allowPaging&&(this.model.filterSettings.filteredColumns.length?this.getPager().ejPager({totalRecordsCount:this._searchCount==null?this._filteredRecordsCount:this._searchCount,currentPage:this._currentPage()}):this.getPager().ejPager({totalRecordsCount:this._searchCount==null?this._gridRecordsCount:this._searchCount,currentPage:this._currentPage()}),this._refreshGridPager()),this.model.allowGrouping||(v=[]),v.length==0){var u=document.createElement("div"),w,h=-1,tt=!1;if(this.phoneMode||this.getContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup()),(this.model.childGrid!=null||this.model.detailsTemplate!=null)&&this.getContentTable().find("colgroup").first().prepend(this._getIndentCol()),ft=this._currentPage(),(this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"||this.model.editSettings.editMode=="normal")&&(i.requestType=="cancel"||i.requestType=="save")&&(this._editFormHeight=this.element.find(".gridform").closest("tr").height()),this.model.scrollSettings.frozenColumns>0)u.innerHTML=this._renderByFrozenDesign();else{i.data&&(w=document.createElement("div"),w.innerHTML=["<table><tbody>",n.render[this._id+"_JSONTemplate"](i.data),"<\/tbody><\/table>"].join(""),this._dataSource()instanceof t.DataManager&&i.requestType==t.Grid.Actions.Save&&(h=this._getDataIndex(this.model.currentViewData,i.data),tt=this._dataSource().adaptor instanceof t.remoteSaveAdaptor));k=null;k=!this.model.scrollSettings.allowVirtualScrolling||this.model.scrollSettings.enableVirtualization||t.isNullOrUndefined(this._currentVIndex)||i.requestType!="save"&&i.requestType!="cancel"&&i.requestType!="delete"?this.model.currentViewData:t.isNullOrUndefined(this._lastVirtualPage)?t.isNullOrUndefined(this._virtualLoadedRecords[this._currentVIndex])?this._virtualLoadedRecords[this._currentVIndex+1]:this._virtualLoadedRecords[this._currentVIndex]:this._lastVirtualPage;this.model.rowTemplate!=null?i.action=="hideColumn"||i.action=="showColumn"?u=this.getContent().find("div:first")[0]:u.innerHTML=["<table><tbody>",n.render[this._id+"_JSONTemplate"](k),"<\/tbody><\/table>"].join(""):u.innerHTML=["<table><tbody>",n.render[this._id+"_JSONTemplate"](k),"<\/tbody><\/table>"].join("");var b=this.getContentTable().get(0),r=b.lastChild,at=this.getContentTable().first().find("tbody").first(),s;if(i.requestType!="save"&&i.requestType!="cancel"||this.model.editSettings.editMode=="batch"||this.model.scrollSettings.allowVirtualScrolling)i.requestType!="delete"||this.model.scrollSettings.allowVirtualScrolling?this.getContentTable().get(0).replaceChild(this.model.rowTemplate!=null?u.firstChild.lastChild:u.firstChild.firstChild,this.getContentTable().get(0).lastChild):(this._isUnboundColumn&&(p=this.element.find(".e-editedrow"),f=this.getContentTable().find(".e-editedrow").get(0),e=p.length?u.firstChild.firstChild.firstChild:w.firstChild.firstChild.lastChild,p.length!=0&&(this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")?n(f).replaceWith(n(e)):this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?(f=p.prev("tr").get(0),p.remove()):f=p.get(0)),this.model.allowPaging&&this.model.pageSettings.pageSize<=this.model.currentViewData.length&&this.getContentTable()[0].rows.length!=this.model.currentViewData.length&&(this.getContentTable().find("tr").length&&this._excludeDetailRows().length?this.multiDeleteMode?(rt=u.firstChild.firstChild.rows.length,ct=n(u.firstChild.firstChild.rows).slice(rt-this.selectedRowsIndexes.length,rt),n(r).append(ct)):r.appendChild(u.firstChild.firstChild.lastChild):n(r).prepend(u.firstChild.firstChild.rows)),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&(nt=this.getContentTable().find(".e-detailrow:visible"),n.each(nt,function(n){nt.eq(n).closest("tr").prev().children(".e-detailrowexpand").length==0&&nt.eq(n).remove()})),this._gridRows=b.rows,this.model.enableAltRow&&this._refreshAltRow());else{if(s=this.model.editSettings.editMode.indexOf("inlineform")!=-1?t.isNullOrUndefined(i.selectedRow)?this._selectedRow():i.selectedRow:this.getContentTable().find(".e-"+i.action+"edrow").index(),et=this._currentTrIndex,s==-1&&(s=et),this.model.detailsTemplate!=null||this.model.childGrid!=null)for(ot=this.model.editSettings.editMode=="inlineform"?n(n(r.childNodes).not(".e-detailrow")[s]):n(r.childNodes[s]),it=n(r.childNodes).not(".e-detailrow"),c=0;c<it.length;c++)ot.is(it[c])&&(s=c);if(this.model.editSettings.editMode=="normal"||this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"){if(i.action=="add"&&!this.getContentTable().find(".e-addedrow").length)break;f=this.getContentTable().find(".e-addedrow").get(0);l=this.getContentTable().find(".e-editedrow");e=l.length||i.requestType=="cancel"?u.firstChild.firstChild.firstChild:w.firstChild.firstChild.lastChild;l.length||i.requestType=="save"&&this._isMapSelection&&!t.isNullOrUndefined(i.checkboxTarget)&&this.model.sortSettings.sortedColumns.length>0?(e=u.firstChild.firstChild.childNodes[s],this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate"?(f=l.prev("tr").get(0),l.remove()):f=l.get(0),a=n(e),o=n(f),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&o.next("tr.e-detailrow:visible").length&&(y=a.find(".e-detailrowcollapse"),y.removeClass("e-detailrowcollapse").addClass("e-detailrowexpand").find("div").removeClass("e-gnextforward").addClass("e-gdiagonalnext")),i.requestType=="cancel"?(this.model.editSettings.showAddNewRow&&this.getContentTable().find(".e-addedrow").addClass("e-showaddrow"),o.replaceWith(a)):!t.isNullOrUndefined(this._filteredRecordsCount)&&this._filteredRecordsCount<this._previousFilterCount?(this.model.detailsTemplate!=null&&o.next("tr.e-detailrow").length&&r.removeChild(o.next("tr.e-detailrow").get(0)),o.remove(),this.model.allowPaging&&this.model.pageSettings.pageSize<=this.model.currentViewData.length&&v.length==0&&r.appendChild(u.firstChild.firstChild.lastChild)):this.model.sortSettings.sortedColumns.length&&i.requestType=="save"&&this._currentJsonData.length>0||!t.isNullOrUndefined(this._searchCount)?this.getContentTable().get(0).replaceChild(this.model.rowTemplate!=null?u.firstChild.lastChild:u.firstChild.firstChild,this.getContentTable().get(0).lastChild):t.isNullOrUndefined(this.model.currentViewData[s])||this._primaryKeys.length&&t.getObject(this._primaryKeys[0],this.model.currentViewData[s])!=t.getObject(this._primaryKeys[0],i.data)?n(r).replaceWith(n(u).find("tbody")):r.replaceChild(e,f),this.model.editSettings.showAddNewRow&&(this.model.editSettings.rowPosition=="top"?n(r.firstChild).remove():n(r.lastChild).remove())):(a=n(e),o=n(f),i.action=="add"&&i.requestType=="save"&&this.model.editSettings.showAddNewRow&&this.model.allowPaging&&this.model.pageSettings.pageSize<=this._currentJsonData.length&&(this.model.editSettings.rowPosition=="bottom"?n(r.lastChild).previousSibling.remove():n(r.lastChild).remove()),i.requestType=="cancel"||this._dataSource()instanceof t.DataManager||this._currentPage()!=1||i.requestType=="save"&&!t.isNullOrUndefined(this._filteredRecordsCount)&&this._filteredRecordsCount==this._previousFilterCount?(t.isNullOrUndefined(f)||(o.remove(),this._dataSource()instanceof t.DataManager&&h!=-1?h==0?r.insertBefore(e,r.children[h]):a.insertAfter(r.children[h-1]):this._dataSource()instanceof t.DataManager&&!tt||this._currentPage()==1||i.requestType!="save"||n(r).prepend(n(u.firstChild.firstChild.firstChild)),this.model.allowPaging&&this.model.pageSettings.pageSize<=this.model.currentViewData.length&&v.length==0&&(this._dataSource()instanceof t.DataManager&&h==-1&&!tt&&i.requestType!="save"||i.requestType!="save"&&!(this._dataSource()instanceof t.DataManager))&&i.requestType=="cancel"&&!this.model.editSettings.showAddNewRow&&b.lastChild.appendChild(u.firstChild.firstChild.lastChild)),i.requestType!="cancel"||this._selectedRow()==-1||this._enableCheckSelect||this.clearSelection()):this.model.currentViewData.length==1?(n(r).empty(),r.appendChild(e)):this.model.sortSettings.sortedColumns.length&&i.requestType=="save"&&this._currentJsonData.length>0||!t.isNullOrUndefined(this._searchCount)&&this.element.find(".gridform").length>0?this.getContentTable().get(0).replaceChild(this.model.rowTemplate!=null?u.firstChild.lastChild:u.firstChild.firstChild,this.getContentTable().get(0).lastChild):this.model.editSettings.rowPosition=="bottom"&&this.element.find(".gridform").length>0?(at.prepend(f),r.replaceChild(e,f)):t.isNullOrUndefined(f)||r.replaceChild(e,f))}else if(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"||this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")if(l=this.element.find(".e-editedrow"),f=this.element.find(".e-addedrow").get(0),i.requestType!="cancel"&&(l.length||t.isNullOrUndefined(this._filteredRecordsCount)||this._filteredRecordsCount!=this._previousFilterCount))if(l.length){if(e=u.firstChild.firstChild.childNodes[s],f=this._excludeDetailRows(r.childNodes)[s],this.model.allowCellMerging!=null&&(o=n(f),n(f.childNodes).hasClass("e-merged")))for(d=o.children(".e-merged").index(),st=f.children[d].colSpan,c=0;c<st;c++)e.childNodes[d+c].className+=" e-merged e-hide",e.childNodes[d].colSpan=c+1;this.model.detailsTemplate!=null&&(f=n(r.childNodes).not(".e-detailrow").eq(s).get(0));(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&o.next("tr.e-detailrow:visible").length&&(y=n(e).find(".e-detailrowcollapse"),y.removeClass("e-detailrowcollapse").addClass("e-detailrowexpand").find("div").removeClass("e-gnextforward").addClass("e-gdiagonalnext"));!t.isNullOrUndefined(this._filteredRecordsCount)&&this._filteredRecordsCount<this._previousFilterCount?(o=n(f),this.model.detailsTemplate!=null&&o.next("tr.e-detailrow").length&&r.removeChild(o.next("tr.e-detailrow").get(0)),o.remove(),this.model.allowPaging&&this.model.pageSettings.pageSize<=this.model.currentViewData.length&&r.appendChild(u.firstChild.firstChild.lastChild)):this.model.sortSettings.sortedColumns.length&&i.requestType=="save"&&this._currentJsonData.length>0||!t.isNullOrUndefined(this._searchCount)?this.getContentTable().get(0).replaceChild(this.model.rowTemplate!=null?u.firstChild.lastChild:u.firstChild.firstChild,this.getContentTable().get(0).lastChild):t.isNullOrUndefined(this.model.currentViewData[s])||this._primaryKeys.length&&t.getObject(this._primaryKeys[0],this.model.currentViewData[s])!=t.getObject(this._primaryKeys[0],i.data)?n(r).replaceWith(n(u).find("tbody")):r.replaceChild(e,f)}else this.model.currentViewData.length==1&&this.getContentTable().find("td.e-rowcell").length==0?(e=u.firstChild.firstChild.firstChild,n(r).empty(),r.appendChild(e)):(g=l.length||i.requestType=="cancel"?u.firstChild.firstChild.firstChild:w.firstChild.firstChild.lastChild,this._dataSource()instanceof t.DataManager?h==-1||t.isNullOrUndefined(f)||(h==0?r.insertBefore(g,r.children[h]):n(g).insertAfter(r.children[h-1]),ht=this._isAddNew&&h?this.model.currentViewData.length-1:this.model.currentViewData.length+1,this.model.allowPaging&&(this.model.pageSettings.pageSize<ht||h==this.model.pageSettings.pageSize)&&r.removeChild(r.lastChild)):(this.model.sortSettings.sortedColumns.length&&i.requestType=="save"&&this._currentJsonData.length>0||!t.isNullOrUndefined(this._searchCount)?this.getContentTable().get(0).replaceChild(this.model.rowTemplate!=null?u.firstChild.lastChild:u.firstChild.firstChild,this.getContentTable().get(0).lastChild):this._currentPage()==1?this.getContentTable().find("tbody").first().prepend(n(g)):this.getContentTable().find("tbody").first().prepend(n(u.firstChild.firstChild.firstChild)),this.model.allowPaging&&this.model.pageSettings.pageSize<=this.model.currentViewData.length&&r.removeChild(r.lastChild)),this.model.detailsTemplate!=null&&n(b.lastChild.lastChild).children(".e-detailrowexpand").length&&r.removeChild(r.lastChild));else e=u.firstChild.firstChild.childNodes[s],f=this._excludeDetailRows(r.childNodes)[s],a=n(e),o=n(f),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&o.next(".e-detailrow:visible").length&&(y=a.find(".e-detailrowcollapse"),y.removeClass("e-detailrowcollapse").addClass("e-detailrowexpand").find("div").removeClass("e-gnextforward").addClass("e-gdiagonalnext")),o.replaceWith(a),(i.requestType!="cancel"||this._isAddNew)&&!this._enableCheckSelect&&this.clearSelection(),this.model.allowPaging&&this._refreshGridPager();this._gridRows=this.model.editSettings.showAddNewRow?this.getContentTable().first().find(".e-rowcell").closest("tr.e-row, tr.e-alt_row").toArray():b.rows;this.model.enableAltRow&&this._refreshAltRow()}}this._currentJsonData=this.model.currentViewData;this._gridRows=this.model.editSettings.showAddNewRow?this.getContentTable().first().find(".e-rowcell").closest("tr.e-row, tr.e-alt_row").toArray():this.getContentTable().get(0).rows;this.model.scrollSettings.frozenColumns>0&&(this._gridRows=[this._gridRows,this.getContentTable().get(1).rows]);lt={};(i.requestType=="sorting"||i.requestType=="filtering"||i.requestType=="save"||i.requestType=="cancel"||i.requestType=="delete"||i.action=="showColumn"||i.action=="hideColumn")&&this.model.scrollSettings.allowVirtualScrolling&&(i.requestType=="filtering"&&(this.getContent().first().ejScroller("refresh").ejScroller("isVScroll")?this.element.find(".gridheader").addClass("e-scrollcss"):this.element.find(".gridheader").removeClass("e-scrollcss"),lt=this._refreshVirtualPagerInfo()),this.model.scrollSettings.enableVirtualization?this._refreshVirtualView(this._currentVirtualIndex):this._refreshVirtualContent(ft),i.requestType=="filtering"&&this.getContent().first().ejScroller("refresh"));i.requestType=="refresh"&&(this._singleView||this._getVirtualTotalRecord()<this._virtualRowCount)&&this._addLastRow();this.model.scrollSettings.enableVirtualization||this._eventBindings();break}case t.Grid.Actions.Grouping:this._group(i);this._refreshStackedHeader();break;case t.Grid.Actions.BeginEdit:this._edit(i);break;case t.Grid.Actions.Add:this._add(i);break;case t.Grid.Actions.Ungrouping:this._ungroup(i);break;case t.Grid.Actions.VirtualScroll:this._isVirtualRecordsLoaded||(this.model.scrollSettings.enableVirtualization?this._replacingVirtualContent():this._replacingContent())}else i.requestType=="reorder"&&this.model.groupSettings.groupedColumns.length>0?this._group(i):((t.isNullOrUndefined(this.model.currentViewData)||this.model.currentViewData.length==0)&&!this.phoneMode&&(i.requestType=="refresh"&&this.model.scrollSettings.frozenColumns==0&&(this.getContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup()),(this.model.childGrid!=null||this.model.detailsTemplate!=null)&&this.getContentTable().find("colgroup").first().prepend(this._getIndentCol())),(i.requestType=="filtering"||i.requestType=="cancel"||i.requestType=="refresh")&&this.model.scrollSettings.frozenColumns>0&&this._removeFrozenTemplate()),this._newungroup(i));(t.isNullOrUndefined(this.model.currentViewData)||this.model.currentViewData.length==0)&&(this._currentJsonData=[]);this._showGridLines();this._completeAction(i)},_removeFrozenTemplate:function(){this.getContent().find("div").eq(0).empty();var i=t.buildTag("table.e-table"),r=n(document.createElement("tbody"));i.append(this.getHeaderTable().find("colgroup").clone()).append(r);this.getContent().find("div").eq(0).html(i);this.setGridContentTable(i)},_showGridLines:function(){var n=this.model.gridLines;n!="both"&&this.getContent().addClass(n!="none"?"e-"+n+"lines":"e-hidelines")},_showHeaderGridLines:function(){var n=this.model.gridLines;n!="both"&&this.getHeaderContent().addClass(n!="none"?"e-"+n+"lines":"e-hidelines")},_newungroup:function(n){n.requestType=="ungrouping"?this._ungroup(n):this.getContentTable().find("tbody").empty().first().append(this._getEmptyTbody())},setFormat:function(){for(var f,r,u,i=[],n=0;n<this.model.columns.length;n++)this.model.columns[n].type=="date"&&i.push(this.model.columns[n]);if(i.length>0&&!t.isNullOrUndefined(this.model.currentViewData))for(n=0,f=this.model.currentViewData.length;n<f;n++)for(r=0;r<i.length;r++)u=t.getObject(i[r].field,this.model.currentViewData[n]),/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/.test(u)&&t.createObject(i[r].field,new Date(u),this.model.currentViewData[n])},_completeAction:function(i){var h,r,e,s,y,c,p,l,o,w,a,v,u,f,b;if(this.model.editSettings.editMode.indexOf("dialog")!=-1&&(i.requestType=="save"||i.requestType=="cancel")&&n("#"+this._id+"_dialogEdit").data("ejDialog")&&n("#"+this._id+"_dialogEdit").ejDialog("close"),this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal"||(this.model.isEdit=!1),this._confirmedValue=!1,t.Grid.Actions.Grouping==i.requestType&&t.isNullOrUndefined(i.columnName)||i.requestType=="refresh"&&this._LastColumnUnGroup){this._LastColumnUnGroup=!1;return}if(i.columnSortDirection!="ascending"&&i.columnSortDirection!="descending"||t.isNullOrUndefined(i.columnName)||(h=this.getColumnByField(i.columnName),this.model.allowSorting&&this.model.allowMultiSorting?this._scolumns.push(h.field):this._gridSort=h.field),i.requestType=="beginedit"||i.requestType=="add"||!(!this.model.allowScrolling||!this.initialRender||this.model.scrollSettings.frozenRows>0||this.model.scrollSettings.frozenColumns>0)||this.model.allowResizeToFit&&this.initialRender||this.setWidthToColumns(),(i.requestType=="save"||i.requestType=="cancel"||i.requestType=="delete")&&(this._isAddNew=!1,this.model.isResponsive&&this.model.minWidth&&(this._refreshScroller(i),this.windowonresize())),t.Grid.Actions.Add==i.requestType||i.requestType=="beginedit")for(r=0;r<this.model.columns.length;r++)e=this.element.find(".gridform").first().find(".e-field[name='"+this.model.columns[r].field+"']"),this.model.columns[r].allowEditing&&e.hasClass("e-disable")?(this._disabledEditableColumns.indexOf(this.model.columns[r].field)!=-1&&this._disabledEditableColumns.splice(this._disabledEditableColumns.indexOf(this.model.columns[r].field),1),e.prop("disabled",!1).removeClass("e-disable")):this.model.columns[r].allowEditing!==!1||e.hasClass("e-disable")||n.inArray(this.model.columns[r].field,this._primaryKeys)!=-1||n.inArray(this.model.columns[r].field,this._disabledEditableColumns)!=-1||(this._disabledEditableColumns.push(this.model.columns[r].field),e.addClass("e-disable").prop("disabled",!0));this.initialRender||!(t.Grid.Actions.UnGrouping==i.requestType||this.model.groupSettings.groupedColumns.length>0)||i.requestType=="beginedit"||i.requestType=="add"||this._recalculateIndentWidth();t.Grid.Actions.Paging==i.requestType||t.Grid.Actions.BatchSave==i.requestType?this._refreshGridPager():t.Grid.Actions.Sorting==i.requestType&&this.model.allowSorting||t.Grid.Actions.Refresh==i.requestType||t.Grid.Actions.Cancel==i.requestType?(t.gridFeatures.sort&&this.getHeaderTable()!==null&&this._sortCompleteAction(i),this.model.allowPaging&&(s=n.extend({},this.getPager().ejPager("option")),this._currentPage(s.currentPage),delete s.currentPage,y=this.model.pageSettings.template,n.extend(this.model.pageSettings,s),this.model.pageSettings.template=y,delete this.model.pageSettings.masterObject,this._refreshGridPager()),!this.initialRender&&(this.model.scrollSettings.frozenRows>0||this.model.scrollSettings.frozenColumns>0)&&this._refreshScroller(i)):t.Grid.Actions.Delete==i.requestType||t.Grid.Actions.Save==i.requestType||t.Grid.Actions.Search==i.requestType?(this._editEventTrigger(i),!this.initialRender&&(this.model.scrollSettings.frozenRows>0||this.model.scrollSettings.frozenColumns>0)&&this._refreshScroller(i),this.model.allowPaging&&this._refreshPagerTotalRecordsCount()):t.Grid.Actions.Filtering==i.requestType?this._filterCompleteAction():t.Grid.Actions.BeginEdit==i.requestType||t.Grid.Actions.Add==i.requestType?this._editCompleteAction(i):(t.Grid.Actions.Grouping==i.requestType||t.Grid.Actions.Ungrouping==i.requestType)&&this["_"+i.requestType+"CompleteAction"](i);(this.model.toolbarSettings.showToolbar||this._mediaStatus&&(this.model.allowSorting||this.model.allowFiltering)&&this.model.enableResponsiveRow)&&this.refreshToolbar();!this.initialRender&&this.model.showSummary&&this.model.summaryRows.length>0&&(this.model.currentViewData.length?(this.element.children(".e-gridfooter").length||(c=this._renderGridFooter(),t.isNullOrUndefined(c)||c.insertAfter(this.getContent())),i.requestType=="beginedit"||i.requestType=="add"||(this._createSummaryRows(this.getFooterTable()),this._refreshGridFooterColGroup())):this.element.children(".e-gridfooter").remove());!this.initialRender&&t.gridFeatures.selection&&(this.getContent().find("td.e-selectionbackground").length||this._setCurrentRow(i.requestType),i.requestType=="cancel"&&this.model.selectedRowIndex!=-1&&n(this.getRowByIndex(this.model.selectedRowIndex)).attr("aria-selected","true").find(".e-rowcell, .e-detailrowcollapse, .e-detailrowexpand").addClass("e-selectionbackground e-active"),i.requestType!="virtualscroll"&&this.clearColumnSelection()&&n(this.getHeaderTable().find("th.e-headercell")).removeClass("e-columnselection"));this.refreshBatchEditMode();this.model.scrollSettings.enableVirtualization&&this.model.showColumnChooser&&!this.initialRender&&i.requestType=="refresh"&&(this._virtualLoadedRows={});!this.initialRender&&(this.model.allowScrolling||this.model.isResponsive)&&(this._checkScrollActions(i.requestType)||(this.model.editSettings.editMode.indexOf("inline")!=-1||this.model.editSettings.editMode.indexOf("normal")!=-1)&&i.requestType=="beginedit")||this.model.scrollSettings.virtualScrollMode=="continuous"&&i.requestType=="virtualscroll"?this.model.isResponsive&&this.model.minWidth?(this._refreshScroller(i),this.windowonresize()):this._refreshScroller(i):!this.model.scrollSettings.frozenColumns&&this.model.allowScrolling&&this.element.width()!=0&&this.refreshScrollerEvent();this.initialRender||!this.model.parentDetails||this.model.allowScrolling||(p=this.model.parentDetails.parentID,l=n("#"+p).data("ejGrid"),l.model.allowScrolling&&l._refreshScroller("refresh"));this.model.scrollSettings.virtualScrollMode=="normal"&&i.requestType=="virtualscroll"&&this.getContent().find("div:first").scrollLeft(this.getScrollObject().scrollLeft());this._customPop!=null&&i.requestType!="sorting"&&this._customPop.hide();this.initialRender||this.model.scrollSettings.enableVirtualization||this._addLastRow();this.model.allowGrouping&&this.model.showSummary&&this._refreshGroupSummary();t.Grid.Actions.Refresh==i.requestType&&!this.initialRender&&this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length>0&&this._groupingCompleteAction(i);t.Grid.Actions.Refresh==i.requestType&&!this.initialRender&&this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length<1&&this._ungroupingCompleteAction(i);this.model.allowGrouping&&(o=this.element.children(".e-groupdroparea"),o.length>0&&o.removeClass("e-default").removeClass("e-active"),this.model.groupSettings.groupedColumns.length>0?o.addClass("e-active"):o.addClass("e-default"));this.model.textWrapSettings&&this._setTextWrap();i.requestType==t.Grid.Actions.Reorder&&this.model.showColumnChooser&&(w=n("#"+this._id+"ccDiv").data("ejDialog"),w.isOpened()&&n("#"+this._id+"_ccTail").first().remove(),a=0,t.isNullOrUndefined(this.element.find(".e-ccButton").outerHeight())||(a+=this.element.find(".e-ccButton").outerHeight()),this.element.find(".e-ccButton").first().remove(),n("#"+this._id+"ccDiv_wrapper").remove(),this.element.css("margin-top",parseInt(this.element.css("margin-top"),10)-a),this._renderColumnChooser());t.isNullOrUndefined(this._dynamicSelectedRowIndex)||(this.selectRows(this._dynamicSelectedRowIndex),this._dynamicSelectedRowIndex=null);this.initialRender&&i.requestType=="grouping"&&(i={requestType:"refresh"});(this._isUngrouping||this._columnChooser)&&i.requestType=="refresh"||(this._trigger("actionComplete",i),this._isUngrouping=!1,this._columnChooser=!1);(!this._isUngrouping&&!this.initialRender||this._showHideColumns||this._columntemplaterefresh)&&this._trigger("refresh");this.model.editSettings.showAddNewRow&&this.model.editSettings.editMode=="normal"&&(this.initialRender||this.getContentTable().find("tr.e-addedrow").length!=0||this.element.find(".e-gridcontent").find("tr").length==0||this._startAdd(),i.requestType=="searching"&&this.element.find(".e-gridtoolbar").find("li#"+this._id+"_search input").focus());(t.Grid.Actions.BeginEdit==i.requestType||t.Grid.Actions.Add==i.requestType)&&n.isFunction(n.validator)&&this.setValidation();this.initialRender||(this.model._groupingCollapsed=[]);this._updateDataSource&&this._gridRecordsCount&&(v=this.model.editSettings.showAddNewRow?this.model.currentViewData[1]:this.model.currentViewData[0],t.isNullOrUndefined(v)||(this._initColumns(v),this.model.allowFiltering&&this._renderFilterDialogs(),this._updateDataSource=!1));this.model.columnLayout!="fixed"||this.model.isEdit||this.setWidthToColumns();this.model.allowRowDragAndDrop&&this._rowsDragAndDrop();!this.initialRender&&this._enableCheckSelect&&(u=this.checkSelectedRowsIndexes[this._currentPage()-1],f=this.getHeaderTable().find(".e-headercheckcelldiv .e-checkselectall"),this._selectAllCheck||this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&[].concat.apply([],this.checkSelectedRowsIndexes).length>=this._gridRecordsCount||f.prop("checked",!1),!this._isMapSelection&&u&&u.length>this._gridRows.length&&!this.model.scrollSettings.enableVirtualization&&u.splice(this._gridRows.length,u.length-this._gridRows.length),this._isMapSelection?this._mappingSelection():i.requestType!="paging"&&i.requestType!="save"&&i.requestType!="cancel"&&i.requestType!="virtualscroll"?this.checkSelectedRowsIndexes=[]:u&&u.length&&!this.model.scrollSettings.enableVirtualization&&!this.model.scrollSettings.allowVirtualScrolling&&this.selectRows(u),this.model.currentViewData!=null&&this.model.currentViewData.length==0?this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").hide():this.getHeaderTable().find(".e-headercelldiv .e-checkselectall").show(),this._selectAllCheck&&(b=f.prop("checked")^this.selectedRowsIndexes.length==this.model.currentViewData.length,f[0].checked=b?f[0].checked:!f[0].checked))},_getDataIndex:function(n,t){for(var i,u,f=0,r=0,e=n.length;r<e;r++){for(i=0,u=this._primaryKeys.length;i<u;i++)if(this._checkPrimaryValue(n[r][this._primaryKeys[i]],t[this._primaryKeys[i]],this._primaryKeys[i]))break;else{i==u-1&&(f=1);continue}if(f)return r}return-1},_checkPrimaryValue:function(n,i,r){var u=this.getColumnByField(r),f=t.isNullOrUndefined(u.foreignKeyField)?u.type:u.originalType;return f=="string"&&(n=n.trim()),n!=i?!0:!1},_eventBindings:function(){var a=this.model.scrollSettings.frozenColumns>0?this._gridRows[0].length:this._gridRows.length,e=0,h,c=this.model.pageSettings.pageSize,i,r,u,o,f,s,l;if(t.gridFeatures.common&&this._refreshUnboundTemplate(this.getContentTable()),this._gridRecordsCount!=0&&(this.model.queryCellInfo!=null||this.model.rowDataBound!=null||this.model.mergeCellInfo!=null||this.model.templateRefresh!=null))for(i=0;i<a;i++){if(r=null,e=i,this.model.scrollSettings.allowVirtualScrolling&&i<c)if(this.model.scrollSettings.enableVirtualization){if(r=n(this._gridRows).eq(i),u=parseInt(n(r).attr("name"),32),n.inArray(u,this._queryCellView)!=-1)continue;this._virtualLoadedRecords[u]&&(o=this._virtualLoadedRecords[u][i%this._virtualRowCount]);e=u*this._virtualRowCount+i%this._virtualRowCount}else{for(f=0;f<this._cloneQuery.queries.length;f++)h=this._cloneQuery.queries[f].fn=="onPage"&&this._cloneQuery.queries[f].e.pageIndex-1;s=c*h;s!=0&&(r=this.getContentTable().find("tr[name="+s+"]").eq(i),e=r.index())}else this.model.scrollSettings.enableVirtualization&&(r=n(this._gridRows).eq(i));if(r=r||this.getRowByIndex(e),r.hasClass("e-virtualrow")||t.isNullOrUndefined(this._currentJsonData[i]||o))break;l=this.model.scrollSettings.enableVirtualization&&!t.isNullOrUndefined(o)?o:this._currentJsonData[i];this._rowEventTrigger(r,l)}},_rowEventTrigger:function(i,r){var u={row:i,data:r,rowData:r},s,e,f,o;if(this._trigger("rowDataBound",u),s=i.cells,e=n(i).find(".e-rowcell"),this.model.queryCellInfo!=null||this.model.mergeCellInfo!=null||this.model.templateRefresh!=null)for(f=0;f<e.length;f++)u={cell:e[f],data:r,rowData:r,text:e[f].innerHTML},o=this._getForeignKeyData(u.data),n(e[f]).hasClass("e-rowcell")&&(u.column=this.model.columns[f]),t.isNullOrUndefined(o)||(u.foreignKeyData=o),this.model.allowCellMerging==!0&&(this._cellMerging(u),this._trigger("mergeCellInfo",u)),this._trigger("queryCellInfo",u),n(e[f]).hasClass("e-templatecell")&&(u={cell:e[f],column:this.model.columns[f],data:r,rowData:r,rowIndex:n(i).index()},this._trigger("templateRefresh",u))},setWidthToColumns:function(){var e=this.getContentTable().children("colgroup").find("col"),h=this.getHeaderTable().children("colgroup").find("col"),c=0,u=[],it,v=[],vt,w=this.element.width(),rt=0,b=0,f=0,ft=!t.isIOSWebView()&&this.getBrowserDetails(),yt,pt,k,l,g,ut,wt,ht,a,y,nt,ct,o,kt,dt,gt,et,ot,lt,tt,ri,s,r,at,st;if(this.model.groupSettings.groupedColumns.length&&!this.model.allowScrolling&&this.model.groupSettings.showGroupedColumn&&ft&&ft.browser=="msie"&&parseInt(ft.version,10)>8&&e.first().css("width",3e3/w+"%"),t.isNullOrUndefined(this.model.detailsTemplate)||(yt=this.model.groupSettings.groupedColumns.length,pt=this.model.groupSettings.groupedColumns.length!=0?1:0,e.eq(pt).css("width",this._detailsOuterWidth),h.eq(yt).css("width",this._detailsOuterWidth)),this._detailColsRefresh(),e=this._$headerCols,h=this._$contentCols,this.model.allowResizeToFit)for(k=0,l=0,g=0;g<this.model.columns.length;g++)this.model.columns[g].visible&&(this.model.columns[g].width!=i?k=k+parseInt(this.model.columns[g].width):l=l+1);for(r=0;r<h.length;r++){if(this.model.allowResizeToFit&&this.model.columns[r].width===i){vt=this.model.groupSettings.groupedColumns.length?r+this.model.groupSettings.groupedColumns.length:r;var p=this._resizer._getContentWidth(r),a=this.getHeaderTable().find(".e-headercelldiv").eq(vt),d=this._resizer._getHeaderContentWidth(a);this.model.editSettings.editMode=="normal"&&(this.model.isEdit||this._isAddNew)?f=ft.browser=="firefox"?parseInt(e[r].style.width,10):e.eq(r).width():l>0&&(it=f=this.model.columns[r].visible?parseInt(this.element.width()-k)/l:0);f<p&&f<d&&l>0?(f=p>d?p:d,f+=parseInt(a.css("padding-left"),10)+parseInt(a.css("padding-right"),10),k+=f,l-=1,this.columnsWidthCollection[r]=f,b+=this.model.columns[r].visible?f:0,c+=f-it):l>0&&(p>=0&&this.model.columns[r].visible||this._dataSource()==null||this._dataSource().length==0||this.model.currentViewData.length==0)&&(ut=p>d?p:d,this._dataSource()==null||this._dataSource().length==0||this.model.currentViewData.length==0?ut>f&&(f=ut+(parseInt(a.css("padding-left"),10)+parseInt(a.css("padding-right"),10))):(ut>f||this.element.width()/l<k-f&&!this.model.allowTextWrap)&&(f=ut+(parseInt(a.css("padding-left"),10)+parseInt(a.css("padding-right"),10))),this.model.columns[r].visible&&(k+=f,l-=1),it<p||it<d?c+=f-it:u.push({index:r,contentWidth:p,headerWidth:d}),this.columnsWidthCollection[r]=f,b+=this.model.columns[r].visible?f:0)}else typeof this.model.columns[r].width=="string"&&this.model.columns[r].width.indexOf("%")!=-1?this._columnsPixelConvert(this.model.columns[r],r):wt=parseInt(this.model.columns[r].width,10),b+=this.model.columns[r].visible?wt:0;this.model.columns[r].priority&&h.eq(r).addClass("e-table-priority-"+this.model.columns[r].priority);t.isNullOrUndefined(this.columnsWidthCollection[r])?this.model.allowScrolling&&v.push(this.model.columns[r]):(e.eq(r).width(this.columnsWidthCollection[r]),h.eq(r).width(this.columnsWidthCollection[r]))}for(ht=u.length,r=0;r<ht;r++)a=this.getHeaderTable().find(".e-headercelldiv").eq(u[r].index),y=parseInt(a.css("padding-left"),10)+parseInt(a.css("padding-right"),10),c=c/ht,this.columnsWidthCollection[u[r].index]>c?this.columnsWidthCollection[u[r].index]-c>u[r].headerWidth&&this.columnsWidthCollection[u[r].index]-c>u[r].contentWidth?(e.eq(u[r].index).width(this.columnsWidthCollection[u[r].index]-c),h.eq(u[r].index).width(this.columnsWidthCollection[u[r].index]-c)):u[r].headerWidth>u[r].contentWidth?(e.eq(u[r].index).width(u[r].headerWidth+y),h.eq(u[r].index).width(u[r].headerWidth+y)):(e.eq(u[r].index).width(u[r].contentWidth+y),h.eq(u[r].index).width(u[r].contentWidth+y)):u[r].headerWidth>u[r].contentWidth?(e.eq(u[r].index).width(u[r].headerWidth+y),h.eq(u[r].index).width(u[r].headerWidth+y)):(e.eq(u[r].index).width(u[r].contentWidth+y),h.eq(u[r].index).width(u[r].contentWidth+y)),this.columnsWidthCollection[u[r].index]>c&&(this.columnsWidthCollection[u[r].index]=this.columnsWidthCollection[u[r].index]-c);var bt=v.filter(function(n){return!n.visible}).length,ui=this.getHeaderTable().find("thead").find(".e-headercell").not(".e-detailheadercell,.e-stackedHeaderCell"),fi=t.sum(this.columnsWidthCollection);for(r=0;r<v.length;r++)v[r].visible&&(nt=!t.isNullOrUndefined(v[r].field)&&v[r].field!=""?this.getColumnIndexByField(v[r].field):this.getColumnIndexByHeaderText(v[r].headerText),ct=ui.eq(nt)[0],t.isNullOrUndefined(this.model.commonWidth)?(kt=typeof this.model.scrollSettings.width=="string"?this.element.width():this.model.scrollSettings.width||this.model.width,dt=(kt-fi)/(v.length-bt),o=this.model.scrollSettings.frozenColumns?dt:ct.getBoundingClientRect().width):o=this.model.commonWidth,t.isNullOrUndefined(o)&&(o=ct.offsetWidth),parseInt(o)<15&&(o=(w/this.model.columns.length).toFixed(2),gt=(w/(this.model.scrollSettings.buttonSize||18)/100).toFixed(2),o=o-gt),e.eq(nt).css("width",o+"px"),h.eq(nt).css("width",o+"px"),this.model.columns[nt].width=o,this.columnsWidthCollection[nt]=parseFloat(o));if(bt||(this._undefinedColsCollection=null),this.model.columnLayout=="fixed"){this.model.scrollSettings&&this.model.scrollSettings.frozenColumns==0&&(this.getHeaderTable().width(b),this.getContentTable().width(b),t.isNullOrUndefined(this.getFooterTable())||this.getFooterTable().width(b));var ei=this.model.scrollSettings.frozenColumns>0?this.getHeaderTable().eq(0).width()+this.getHeaderTable().eq(1).width():this.getHeaderTable().width(),ni=this.getHeaderContent().width()>ei?"addClass":"removeClass",ti=this.getHeaderTable(),ii=this.getContentTable();this.model.scrollSettings.frozenColumns>0&&(ti=this.getVisibleColumnNames().length<=this.model.scrollSettings.frozenColumns?this.getHeaderTable().eq(1):this.getHeaderTable().eq(0),ii=this.getVisibleColumnNames().length<=this.model.scrollSettings.frozenColumns?this.getContentTable().eq(1):this.getContentTable().eq(0));ti[ni]("e-tableLastCell");ii[ni]("e-tableLastCell")}if(!this.model.allowScrolling&&this.model.allowResizeToFit&&t.isNullOrUndefined(this.model._isPrinting)&&!this.model.isResponsive&&b>w&&(this.model.allowScrolling=!0,this.model.scrollSettings.width=w,this.getHeaderTable().parent().addClass("e-headercontent"),this._renderScroller()),this.model.isEdit&&(tt=e.clone(),this.model.editSettings.showAddNewRow&&(et=this.getContentTable().find(".e-editedrow")),ot=this.model.scrollSettings.frozenColumns>0?this.getContent().find(".gridform").find("colgroup"):!t.isNullOrUndefined(et)&&et.length==1?et.find("colgroup"):n("#"+this._id+"EditForm").find("colgroup"),this.model.scrollSettings.frozenColumns>0&&ot.first().empty().append(tt.splice(0,this.model.scrollSettings.frozenColumns)),ot.last().empty().append(tt),(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&ot.prepend(this._getIndentCol())),this.model.groupSettings.groupedColumns.length)for(lt=this.getContentTable().find(".e-recordtable").children("colgroup"),r=0;r<lt.length;r++)tt=e.clone(),ri=this._detailsOuterWidth!=null?this._detailsOuterWidth:"30px",(this.model.detailsTemplate!=null||this.model.childGrid!=null)&&tt.splice(0,0,n(this._getIndentCol()).width(ri)[0]),lt.eq(r).empty().append(tt);if(this.model.scrollSettings.frozenColumns>0){for(s=0,r=0;r<this.model.columns.length;r++)s+=this.model.columns[r].visible?parseFloat(this.columnsWidthCollection[r],10):0,this.model.scrollSettings.frozenColumns-1==r&&(rt=Math.ceil(s));this.element.width(this.model.scrollSettings.width||this.model.width);at=this.element.find(".e-gridcontent").children().first().width();at>s?s=at+(this.getContentTable().height()<this.model.scrollSettings.height&&(t.isNullOrUndefined(this.getContent().data("ejScroller"))?!1:this.getScrollObject()._vScroll)?this.model.scrollSettings.buttonSize:0):s+=this.getContentTable().height()>this.model.scrollSettings.height?this.model.scrollSettings.buttonSize:0;s<this.element.width()&&(s="100%");st=typeof s=="string"&&s.indexOf("%")!=-1?s:s-rt;this.getContent().find(".e-frozencontentdiv").outerWidth(rt).end().find(".e-movablecontentdiv").outerWidth(st);this.getHeaderContent().find(".e-frozenheaderdiv").outerWidth(rt).end().find(".e-movableheaderdiv").outerWidth(st);this.getFooterContent()&&this.getFooterContent().find(".e-frozenfooterdiv").outerWidth(rt).end().find(".e-movablefooterdiv").outerWidth(st)}!this.initialRender&&this.model.allowResizeToFit&&this.model.allowScrolling&&this.model.scrollSettings.enableVirtualization&&(w=this.getHeaderTable().width()>this.getContentTable().width()?this.getHeaderTable().width():this.getContentTable().width(),t.isNullOrUndefined(this.getFooterTable())||this.getFooterTable().width(w))},_initialEndRendering:function(){var r,i,u;if(this.model.allowRowDragAndDrop&&this._rowsDragAndDrop(),(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?this.element.append(this._renderDialog()):(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&this.element.append(this._renderExternalForm())),(this.model.editSettings.editMode=="batch"||this.model.editSettings.showDeleteConfirmDialog)&&this._renderConfirmDialog(),(this.model.scrollSettings.frozenColumns>0||this.model.scrollSettings.frozenRows>0)&&n("#"+this._id+"AlertDialog").length==0&&this._renderAlertDialog(),(this.model.allowMultiSorting||this.model.selectionType=="multiple")&&this._renderMultiTouchDialog(),this.model.scrollSettings.frozenColumns>0&&!this.model.allowScrolling){this.getContent().remove();this.getHeaderTable().eq(1).remove();this._alertDialog.find(".e-content").text(this.localizedLabels.FrozenColumnsScrollAlert);this._alertDialog.ejDialog("open");return}if(this.model.scrollSettings.allowVirtualScrolling&&!this.model.scrollSettings.enableVirtualization&&this._createPagerStatusBar(),this._getRowHeights(),this.element.width()!=0&&this.element.is(":visible")&&this.model.allowScrolling)this._renderScroller(),this.model.scrollSettings.frozenRows>0||this.model.scrollSettings.frozenColumns>0||(this.setWidthToColumns(),r=t.isNullOrUndefined(this.getContent().data("ejScroller"))?null:this.getScrollObject(),r!=null&&r.refresh(),this._isHscrollcss(),this.refreshScrollerEvent(),this._scrollFooterColgroup(!0));else if((this.model.allowScrolling||this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length)&&(this.element.width()<=0||!this.element.is(":visible"))){i=this;u=setInterval(function(){if(!t.isNullOrUndefined(i.element)&&i.element.width()>0&&!t.isNullOrUndefined(i.element.width())&&i.element.is(":visible")){if(i.model.allowScrolling&&(i._renderScroller(),!(i.model.scrollSettings.frozenRows>0||i.model.scrollSettings.frozenColumns>0))){i.setWidthToColumns();var n=t.isNullOrUndefined(i.getContent().data("ejScroller"))?null:i.getScrollObject();n!=null&&n.refresh();i._isHscrollcss();i._addLastRow();i.refreshScrollerEvent()}i.model.allowGrouping&&i.model.groupSettings.groupedColumns.length&&i.getHeaderTable().find(".e-grouptopleftcell").width()<=0&&i.getHeaderTable().find(".e-grouptopleftcell").css("width",i.getHeaderTable().find("colgroup col").eq(0).width());i._endRendering();clearInterval(u)}},100);return}this._endRendering()},_scrollFooterColgroup:function(n){t.isNullOrUndefined(n)&&(this.model.scrollSettings.frozenColumns>0&&!this.getFooterTable().find("colgroup").length&&(this.getFooterTable().eq(0).append(this.getHeaderTable().eq(0).find("colgroup").clone()),this.getFooterTable().eq(1).append(this.getHeaderTable().eq(1).find("colgroup").clone())),this.getFooterTable().find("colgroup").length?this.getFooterTable().find("colgroup").first().replaceWith(this.getHeaderTable().find("colgroup").clone()):this.getFooterTable().append(this.getHeaderTable().find("colgroup").clone()));var i=t.isNullOrUndefined(this.getContent().data("ejScroller"))?null:this.getScrollObject();i&&i.isVScroll()&&!t.isNullOrUndefined(this.getFooterContent())&&(this.getFooterContent().find("colgroup").append("<col style='width : "+this.model.scrollSettings.scrollerSize+"px'><\/col>"),this.getFooterContent().find("tr.e-gridSummaryRows td.e-scrollindent").length||this.getFooterContent().find("tr.e-gridSummaryRows").append("<td class='e-scrollindent'><\/td>"))},_endRendering:function(){var n,r,u,i,f;t.isNullOrUndefined(this.model.serverProperties)||(n=this.model.serverProperties._checkSelectedRowsIndexes,this.checkSelectedRowsIndexes=n&&n.length?n:this.checkSelectedRowsIndexes);!t.isNullOrUndefined(this.getContent().data("ejScroller"))&&this.model.allowScrolling&&(r=this.getScrollObject());u=this.model.enableRTL?"e-summaryscroll e-rtl":"e-summaryscroll";this.model.allowScrolling&&this.model.showSummary&&(r._vScroll&&this.element.find(".e-summaryrow.e-scroller").addClass(u),this.getFooterTable()&&this._scrollFooterColgroup());this._addMedia();this.model.allowScrolling&&this.model.allowTextWrap&&!this.model.scrollSettings.allowVirtualScrolling&&this.getContent().first().ejScroller("refresh");this.model.scrollSettings.allowVirtualScrolling&&(this._currentPage(1),this._currentPage()!=1||this.model.scrollSettings.enableVirtualization||(this._virtualLoadedRecords[this._currentPage()]=this._currentJsonData),this.model.scrollSettings.enableVirtualization?this._refreshVirtualView():this._refreshVirtualContent(this._currentPage()),this.getContent().first().ejScroller("refresh"),this.getContent().ejScroller("isVScroll")?this.element.find(".e-gridheader").addClass("e-scrollcss"):this.element.find(".e-gridheader").removeClass("e-scrollcss"),this._isHscrollcss());this.model.allowSelection==!0&&this.model.selectionType=="multiple"&&this._selectedMultipleRows().length>0&&this._selectingMultipleRows(this._selectedMultipleRows());(this._selectedRow()!=-1||this._selectedMultipleRows().length==1)&&(i=this._selectedMultipleRows(),f=i.length?i:this._selectedRow(),this.selectRows(f));!this.model.allowFiltering||this.model.filterSettings.filterType!="filterbar"||this.model.allowPaging||this.model.scrollSettings.allowVirtualScrolling||this._createPagerStatusBar();t.gridFeatures.common&&this.rowHeightRefresh();t.gridFeatures.filter&&["menu","excel"].indexOf(this.model.filterSettings.filterType)!=-1&&this._refreshFilterIcon();this.model.allowGrouping&&this.model.groupSettings.groupedColumns.length!=0&&this._recalculateIndentWidth();this.initialRender&&(!this.model.scrollSettings.enableVirtualization||this._gridRows.length<this._virtualRowCount)&&this._addLastRow()},_addLastRow:function(){var r=this.getContentTable().find("tr:last").find("td"),u=0,i;if(this.model.allowScrolling&&!this.model.scrollSettings.allowVirtualScrolling&&!t.isNullOrUndefined(this.model.dataSource)&&!t.isNullOrUndefined(this.getRows())){for(i=0;i<this.getRows().length;i++)u+=n(this.getRows()[i]).height();u<this.getContent().height()-1&&r.addClass("e-lastrowcell")}this.model.scrollSettings.allowVirtualScrolling&&this.getContentTable().height()<this.getContent().height()&&r.addClass("e-lastrowcell")},_addMedia:function(){if(!this.model.enablePersistence&&typeof this.model.scrollSettings.width!="string"&&this.model.scrollSettings.width>0?this._responsiveScrollWidth=this._originalScrollWidth=this.model.scrollSettings.width:this._originalScrollWidth=this.element.width(),typeof this.model.scrollSettings.height!="string"&&this.model.scrollSettings.height>0&&(this._responsiveScrollHiehgt=this.model.scrollSettings.height),this.model.minWidth&&this.model.isResponsive){this._$onresize=n.proxy(this.windowonresize,this);n(window).on("resize",this._$onresize);if(n.isFunction(window.matchMedia)){var t=window.matchMedia("(max-width: 768px)");this._mediaStatus=t.matches}this.windowonresize()}},_getNoncontentHeight:function(){var n=0;return t.isNullOrUndefined(this.getHeaderContent().outerHeight())||(n+=this.getHeaderContent().outerHeight()),this.model.toolbarSettings.showToolbar&&!t.isNullOrUndefined(this.element.find(".e-gridtoolbar").outerHeight())&&(n+=this.element.find(".e-gridtoolbar").outerHeight()),this.model.allowPaging&&!t.isNullOrUndefined(this.element.find(".e-pager").outerHeight())&&(n+=this.element.find(".e-pager").outerHeight()),this.model.showColumnChooser&&!t.isNullOrUndefined(this.element.find(".e-ccButton").outerHeight())&&(n+=this.element.find(".e-ccButton").outerHeight()),this.model.allowGrouping&&this.model.groupSettings.showDropArea&&!t.isNullOrUndefined(this.element.find(".e-groupdroparea").outerHeight())&&(n+=this.element.find(".e-groupdroparea").outerHeight()),this.model.showSummary&&!t.isNullOrUndefined(this.element.find(".e-gridsummary").outerHeight())&&(n+=this.element.find(".e-gridsummary").outerHeight()),n},setDimension:function(n,t){var i=n-this._getNoncontentHeight();this.model.scrollSettings.height=i;this.model.scrollSettings.width=t;this._renderScroller()},_getVisibleColumnsWidth:function(){for(var t=0,n=0;n<this.columnsWidthCollection.length;n++)this.model.columns[n].visible&&(t+=this.columnsWidthCollection[n]);return t},setPhoneModeMaxWidth:function(n){this._gridPhoneMode=n},_mediaQueryUpdate:function(i,r,u,f){var s,o,h,e;if(window.innerWidth<=this._gridPhoneMode&&this.model.enableResponsiveRow){s=this.getContentTable()[0].style;s.removeAttribute?s.removeAttribute("min-width"):s.removeProperty("min-width");o=this.getContent().data("ejScroller");o&&this.getContent().ejScroller("destroy");return}o=t.isNullOrUndefined(this.getContent().data("ejScroller"))?null:this.getScrollObject();i?(this.model.scrollSettings.width=t.isNullOrUndefined(this._responsiveScrollWidth)?u:Math.min(this._responsiveScrollWidth,u),e=Math.min(f,r)-this._getNoncontentHeight(),e=t.isNullOrUndefined(this._responsiveScrollHiehgt)?e:Math.min(this._responsiveScrollHiehgt,e),(this.element.parent().is("body")&&n(document).height()>e||e>this.element.parent().height())&&this.model.scrollSettings.height!="auto"&&(e-=parseInt(this.element.parent().css("margin-bottom")+1)),e=this.model.scrollSettings.height!="auto"?e:this.model.scrollSettings.height,(this.model.minWidth>u||this.getContentTable().width()>u)&&r>f&&(e=e!="auto"?e+this.model.scrollSettings.buttonSize:e),t.isNullOrUndefined(this.getRows())&&(e="100%"),this.model.scrollSettings.height=this._isHeightResponsive?e:this._initHeight?this._initHeight:this.getContentTable()[0].scrollHeight,this.element.find(".e-gridheader").first().find("div").first().addClass("e-headercontent")):(this.model.scrollSettings.width="100%",t.isNullOrUndefined(this._responsiveScrollWidth)||(this.model.scrollSettings.width=Math.min(this._responsiveScrollWidth,u)),h=Math.min(f,r),e=h-this._getNoncontentHeight(),t.isNullOrUndefined(this._responsiveScrollHiehgt)||(e=Math.min(this._responsiveScrollHiehgt,e)),(this.element.parent().is("body")&&n(document).height()>e||e>this.element.parent().height())&&this.model.scrollSettings.height!="auto"&&(e-=parseInt(this.element.parent().css("margin-bottom"))),e=this.model.scrollSettings.height!="auto"?e:this.model.scrollSettings.height,(!t.isNullOrUndefined(this._responsiveScrollWidth)&&this.model.scrollSettings.width==this._responsiveScrollWidth&&(this.model.minWidth>this._responsiveScrollWidth||this._getVisibleColumnsWidth()>this._responsiveScrollWidth)||t.isNullOrUndefined(this._responsiveScrollWidth)&&(this.getRowHeight()==e||this._isHeightResponsive)&&this.getContentTable().width()>u)&&(e=e!="auto"?e+this.model.scrollSettings.buttonSize:e),t.isNullOrUndefined(this.getRows())&&(e="100%"),this.getContent().height()>=e&&!this._resize&&!this.initialRender&&typeof this.model.scrollSettings.width=="string"&&(this.model.scrollSettings.width=u),this.model.scrollSettings.height=this._isHeightResponsive?e:this._initHeight?this._initHeight:this.getContentTable()[0].scrollHeight,this.element.find(".e-gridheader").first().find("div").first().addClass("e-headercontent"));o!=null&&o.refresh(o.isHScroll()&&o.isVScroll());this._renderScroller();this._resize=!1},windowonresize:function(i){var r,f,e,u,h;if(!this.element.is(":visible")){r=this;r._isVisible=!0;f=setInterval(function(){!t.isNullOrUndefined(r.element)&&r.element.is(":visible")&&r._isVisible?(r.windowonresize(),r._isVisible=!1,clearInterval(f)):t.isNullOrUndefined(r.element)||clearInterval(f)},100);return}i&&i.type=="resize"&&(this._resize=!0);this.model.scrollSettings.width=this._responsiveScrollWidth;this.element.css("width","100%");this.getContentTable().width("100%");this.getHeaderTable().width("100%");t.isNullOrUndefined(this.getFooterTable())||this.getFooterTable().width("100%");this.getContentTable().css("minWidth",this.model.minWidth);this._isHeightResponsive&&(this.getContent().height("100%"),this.getContent().find(".e-content").height("100%"));this.getHeaderTable().css("min-width",this.model.minWidth);e=this.element.width();u=n(window).height()-this.element.offset().top;u<this.element.offset().top&&(u=n(document).height()-this.element.offset().top);var l=t.isNullOrUndefined(this.getRows())?1:this.getRows().length,c=this.element.parent().is(n("body"))||this.element.parent().height()==n("body").height()||["","auto"].indexOf(this.element.parent()[0].style.height)!=-1,o=this.getContentTable()[0].scrollHeight+this._getNoncontentHeight(),s=c?u:this.element.parent().height();o+=parseInt(this.element.parent().css("margin-top"));h=this.model.minWidth>e||s<=o;this._mediaQueryUpdate(h,s,e,o)},_removeMedia:function(){n(window).off("resize",this._$onresize);this.getContentTable().css("min-width","");this.getHeaderTable().css("min-width","");this.getContentTable().css("width","");this.model.scrollSettings.width="auto";this.getContent().data("ejScroller")&&this.getContent().ejScroller("destroy")},_getRowHeights:function(){var n=this.getRows(),r=[],u=[],t;if(n!==null)if(this._rowHeightCollection=[],n[1]!==i&&n[1].length&&(this.model.scrollSettings.frozenColumns>0&&n[0]!==i||n[0]!==i&&typeof n[0].item!="undefined"&&typeof n[0].length=="number"&&typeof n[1].item!="undefined"&&typeof n[1].length=="number"))for(r=n[0],u=n[1],t=0;t<r.length;t++)this._rowHeightCollection[t]=r[t].offsetTop>=u[t].offsetTop?r[t].offsetTop:u[t].offsetTop;else for(t=0;t<n.length;t++)this._rowHeightCollection[t]=n[t].offsetTop;return this._rowHeightCollection},_getEmptyTbody:function(){var i=t.buildTag("td.emptyrecord",this.localizedLabels.EmptyRecord,{},{colSpan:this.model.columns.length-this._hiddenColumns.length});return n(document.createElement("tr")).append(i)},_getIndentCol:function(){return t.buildTag("col","",{width:"30px"})},_createSortElement:function(){return t.buildTag("span.e-icon","&nbsp;")},_createSortNumber:function(n,i){return i.css("text-align")=="right"?t.buildTag("span.e-number",n,{color:"white","font-size":"9px","text-align":"center",float:"left"}):t.buildTag("span.e-number",n,{color:"white","font-size":"9px","text-align":"center",float:"right"})},_onFocusIn:function(){var n=this;setTimeout(function(){n.element.removeClass("e-activefocusout")},0)},_onFocusOut:function(){var n=this;setTimeout(function(){n.element.addClass("e-activefocusout")},0)},_wireEvents:function(){this._on(this.element,n.isFunction(n.fn.tap)&&this.model.enableTouch?"tap":"click",this._clickHandler);this._on(this.element,n.isFunction(n.fn.tap)&&this.model.enableTouch?"tap":"click",".e-gridheader",this._mouseClickHandler);this.model.enableFocusout&&(this._on(this.element,"focusout",this._onFocusOut),this._on(this.element,"focusin",this._onFocusIn));t.gridFeatures.common&&(this._on(this.element,n.isFunction(n.fn.doubletap)&&this.model.enableTouch?"doubletap":"dblclick",".e-gridcontent > div:first",this._recorddblClickHandler),this.model.rightClick&&this._on(this.element,"contextmenu",this._rightClickHandler),this._on(this.element,n.isFunction(n.fn.tap)&&this.model.enableTouch?"tap":"click",".e-gridcontent",this._recordClick),this._enableRowHover(),this.model.enableTouch?this._on(this.element,"swipeleft swiperight",".e-gridcontent div > .e-table",n.proxy(this._touchGrid,this)):this.element.addClass("e-touch"),this._on(this.element,"mousedown",".e-gridheader",this._headerMouseDown),(this.model.allowRowDragAndDrop||this.model.selectionSettings.allowDragSelection)&&this.model.selectionType=="multiple"&&this._on(this.element,"touchstart mousedown",".e-gridcontent",this._contentMouseDown),this._on(this.element,"mouseover mouseleave",".e-gridheader:first",this._headerHover),this._on(this.element,t.eventType.mouseMove,".e-gridheader:first",this._headerHover),this.model.allowResizeToFit&&this._on(this.element,"dblclick",".e-gridheader",this._headerdblClickHandler),this.model.allowResizing&&(this._on(this.element,t.eventType.mouseMove,".e-gridheader:first",this._mouseMove),this._on(this.element,"mouseup",this._mouseUp)),this.model.allowKeyboardNavigation&&(this.element[0].tabIndex=this.element[0].tabIndex==-1?0:this.element[0].tabIndex,this.element[0].accessKey=!t.isNullOrUndefined(this.element[0].accessKey)&&this.element[0].accessKey!=""?this.element[0].accessKey:"e",this._on(this.element,"keyup",this._keyDownHandler)));t.gridFeatures.edit&&this._enableEditingEvents();this.model.allowGrouping&&(this._enableGroupingEvents(),this._on(this.element,"mouseenter mouseleave",".e-groupdroparea,.e-groupheadercell",this._dropAreaHover));this._enableFilterEvents()},_enableFilterEvents:function(){if((this.model.allowMultiSorting||this.model.selectionType=="multiple"||this.model.allowFiltering)&&this._on(n(document),"mousedown",this._docClickHandler),this.model.allowFiltering){var t=this;this._off(this.element,"keyup",".e-filterbar input")._on(this.element,"keyup",".e-filterbar input",this._filterBarHandler);this._on(this.element,"focus click",".e-filterbar",this._filterBarClose)}},_docClickHandler:function(i){var r=!t.isIOSWebView()&&this.getBrowserDetails(),u=n(i.target);this._customPop!=null&&this.element.find(i.target).length==0&&this._customPop.hide();this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this.model.filterSettings.filterType=="excel"?this._$colType&&(n(i.target).find(".e-grid.e-dlgcontainer").length>1||n(i.target).find(".e-excelfilter").length>1)&&(r&&r.browser=="msie"?i.target.tagName!="BODY"&&(this.isExcelFilter?this._excelFilter.closeXFDialog(i):this._closeFilterDlg()):this._isExcelFilter?this._excelFilter.closeXFDialog(i):this._closeFilterDlg()):u.hasClass("e-filtertext")||u.hasClass("e-cancel")||this.getFilterBar().find(".e-cancel").addClass("e-hide"))},_mouseClickHandler:function(r){var g=n(r.target),u,pt=this.commonQuery.clone(),s,ft,et,ot,c,st,o,f,h,wt,ht,ii,d,ct,bt,it,kt,p,tt,l,rt,dt,lt,oi,at,yt;if((g.closest(".e-grid").length==0||g.closest(".e-grid").attr("id")===this._id)&&this.getHeaderTable().find(".e-columnheader").not(".e-stackedHeaderRow").css("cursor")!="col-resize")if(u=n(r.target).is(".e-ascending, .e-descending")?n(r.target.parentNode):g.hasClass("e-groupheadercell")?g.children("div"):n(r.target),this._$fDlgIsOpen&&this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this._isExcelFilter)&&(n.fx.off=!0,this._closeFDialog(),n.fx.off=!1),this.getHeaderTable().find(".e-columnheader").find(".e-headercellactive").removeClass("e-headercellactive").removeClass("e-active"),u.hasClass("e-headercelldiv")||u.hasClass("e-headercell")&&n.inArray("column",this.model.selectionSettings.selectionMode)==-1||!u.hasClass("e-togglegroupbutton")&&u.closest(".e-headercelldiv").length&&n.inArray(u[0].tagName,["SELECT","INPUT","TEXTAREA"])==-1||u.closest(".e-groupheadercell").length&&n(r.target).is(".e-ascending, .e-descending")){if(!this.model.allowSorting||t.gridFeatures.sort===i)return;var ni=u.hasClass("e-headercelldiv")||u.closest(".e-groupheadercell").length?u:u.hasClass("e-headercell")?u.find(".e-headercelldiv"):u.closest(".e-headercelldiv"),c=ni.attr("data-ej-mappingname"),ft=t.sortOrder.Ascending;this._$prevSElementTarget=this._$curSElementTarget;this._$curSElementTarget=u;ft=u.parent().find("span").hasClass("e-ascending")?t.sortOrder.Descending:t.sortOrder.Ascending;r.pointerType=="touch"&&this._customPop!=null&&!this._customPop.is(":visible")&&this._customPop.find(".e-sortdirect").hasClass("e-spanclicked")&&this._customPop.show();r.pointerType=="touch"&&this._customPop!=null&&(this._customPop.find(".e-rowselect").is(":visible")||!this._customPop.find(".e-sortdirect").hasClass("e-spanclicked"))&&this.model.allowMultiSorting&&(et=u.offset(),this._customPop.removeAttr("style"),this._customPop.offset({left:et.left,top:et.top-this.getHeaderTable().find(".e-columnheader").height()}).find(".e-sortdirect").show().end().find(".e-rowselect").hide().end().show());this.model.allowMultiSorting&&(r.ctrlKey||this._enableSortMultiTouch)&&(this.multiSortRequest=!0);r.shiftKey&&n.inArray(c,this.model.groupSettings.groupedColumns)==-1&&(this._removeSortedColumnFromCollection(c),this.multiSortRequest=!0,c=null,this.sortColumn(c,ft));t.isNullOrUndefined(c)||this.sortColumn(c,ft)}else if(u.hasClass("e-togglegroupbutton")&&this.model.allowGrouping)ot=u.parent().children(".e-headercelldiv").attr("data-ej-mappingname"),u.hasClass("e-togglegroup")&&this.groupColumn(ot),u.hasClass("e-toggleungroup")&&this.ungroupColumn(ot);else if((u.hasClass("e-filtericon")||u.hasClass("e-filteredicon")||u.hasClass("e-responsivefilterColDiv")||u.parent().hasClass("e-responsivefilterColDiv"))&&(c=u.parent().find(".e-headercelldiv").attr("data-ej-mappingname")||u.attr("data-ej-mappingname")||n(u.parent()).attr("data-ej-mappingname"),this._$prevFieldName=this._$curFieldName,s=this.getColumnByField(c),st={True:this.localizedLabels.True,False:this.localizedLabels.False},this.model.allowFiltering)){if(o=this,this.model.filterSettings.filterType=="excel"&&s.filterType=="menu"&&n.inArray(s.type,this._menuColTypes)==-1?(this._renderFilters(s),this._menuColTypes.push(s.type)):(this.model.filterSettings.filterType=="menu"&&s.filterType=="excel"||this.model.filterSettings.filterType=="excel"&&s.filterType!="menu")&&n.inArray(s.type,this._excelColTypes)==-1&&(this._renderFilters(s),this._excelColTypes.push(s.type)),n.each(this.model.columns,function(n,t){t.field==c&&(o._$colType=t.type,o._$curFieldName=t.field,o._$colFormat=t.format,o._$filterType=t.filterType,o._$colForeignKeyField=t.foreignKeyField?t.foreignKeyField:t.field,o._$colForeignKeyValue=t.foreignKeyValue,o._$colDropdownData=t.dataSource)}),(this.model.filterSettings.filterType=="menu"&&this._$filterType!="excel"||this.model.filterSettings.filterType=="excel"&&this._$filterType=="menu")&&(f="#"+this._id+"_"+this._$colType+"Dlg",this._$menuDlgIsOpen=!0,this._$colType=="string"?this._$colForeignKeyValue&&this._$colDropdownData?n("#"+this._id+"_acString").ejAutocomplete({fields:{text:o._$colForeignKeyValue,key:o._$colForeignKeyField},dataSource:o._$colDropdownData}):n("#"+this._id+"_acString").ejAutocomplete({fields:{text:o._$curFieldName,key:this._getIdField()},dataSource:this._dataSource()}):this._$colType=="date"?this._$colFormat!=i?(this._$colFormat=this._$colFormat.replace("{0:","").replace("}",""),n(f).find(".e-datewidget .e-datepicker.e-js").ejDatePicker({dateFormat:this._$colFormat.replace("{0:","").replace("}","")})):n(f).find(".e-datewidget .e-datepicker.e-js").ejDatePicker({dateFormat:t.preferredCulture(this.model.locale).calendars.standard.patterns.d}):this._$colType=="datetime"&&(this._$colFormat!=i&&(this._$colFormat=this._$colFormat.replace("{0:","").replace("}",""),n(f).find(".e-datetimewidget input").ejDateTimePicker({dateFormat:this._$colFormat.replace("{0:","").replace("}","")})),this._setFilterFieldValues(f))),this._mediaStatus=document.documentElement.clientWidth<=768,this.model.isResponsive&&this._mediaStatus){var e=this,a=t.buildTag("div.e-resFilterDialogHeaderDiv"),ti=t.buildTag("div.e-labelRes","<span>Filter<\/span>");n("#"+this._id+"_"+this._$colType+"Dlg").find(".e-filterMenuBtn").length>0&&n("#"+this._id+"_"+this._$colType+"Dlg").find(".e-filterMenuBtn").remove();var nt=t.buildTag("div.e-filterMenuBtn"),k=t.buildTag("input.e-resposnsiveFilterBtnLeft e-flat e-btnsub"),w=t.buildTag("input.e-resposnsiveFilterBtnRight e-flat e-btncan");if(a.append(ti),a.css("width","100%"),h=n(f).css("padding-left","0px"),u.parent().hasClass("e-responsivefilterColDiv")&&u.hasClass("e-filternone"))o._fltrClrHandler(),u.remove(),n("#"+this._id+"responsiveFilter").css("display","block");else if(this.element.css("display","none"),setTimeout(function(){n("#"+this._id+"responsiveFilter").css("display","none");0}),this._isExcelFilter||this._$filterType=="excel"){if(this._excelDlg=f="#"+this._id+this._$colType+"_excelDlg",t.isNullOrUndefined(h.find(".e-resFilterDialogHeaderDiv")[0])){k.ejButton({text:"OK",type:"button",click:function(){e._responsiveFilterClose();e._excelFilter._openedFltr=n(e._excelDlg);e._excelFilter._fltrBtnHandler();e._setResponsiveFilterIcon()}});w.ejButton({text:"Cancel",type:"button",click:function(){n(f).css("display","none");o.element.css("display","block")}});n(f).children().not(".e-searchcontainer").remove();n(f).css("top","").css("left","");var ri=this._excelFilter,d=t.buildTag("div.e-resFilterleftIcon","",{},{closeDialogue:f.slice(1),openDialogue:"responsiveFilter"}),ct=t.buildTag("span.e-icon e-resIcon e-responisveBack","",{},{closeDialogue:f.slice(1),openDialogue:"responsiveFilter"});d.click(function(t){n.proxy(e._closeDivIcon(t),this)});a.append(d.append(ct));p=t.buildTag("div.e-resFIlterRigthIcon","",{},{closeDialogue:f.slice(1),gridEle:!0});tt=t.buildTag("span.e-icon e-resIcon e-responisveCustomFilter","",{},{closeDialogue:f.slice(1),gridEle:!0});p.click(function(t){n.proxy(e._closeDivIcon(t),this)});o._$colType!="boolean"&&a.append(p.append(tt));n(f).css("padding","0px");l=n(f).css("height",n(window).height()-2);l.css("width",n(window).width()-2);lt=l.find(".e-searchcontainer .e-searchbox").css("margin-top","10px");lt.children().css("margin-top","10px");var ui=l.find(".e-checkboxlist"),fi=n(window).width()*(97/100),ei=n(window).height()*(65/100);n(l.find(".e-searchcontainer")).addClass("e-resSearch");rt=l.find(".e-resSearch .e-btncontainer").remove();rt.find("input:first").css("width","45.6%");rt.find("input:first").addClass("e-resposnsiveFilterBtnLeft");rt.find("input:last").addClass("e-resposnsiveFilterBtnRight");l.find(".e-excelLabel").remove();dt=t.buildTag("div.e-excelLabel","Order Id",{"font-weight":"bold","margin-top":"10px"});lt=l.find(".e-searchcontainer");dt.insertAfter(l.find(".e-searchcontainer .e-searchbox"));l.prepend(a);n(f).append(nt.append(k).append(w));ui.ejScroller({height:ei,width:fi}).ejScroller("refresh")}this._excelFilter.openXFDialog({field:c,enableResponsiveRow:!0,displayName:s.headerText,dataSource:this._dataSource(),query:pt,position:{X:y,Y:b},dimension:{height:n(window).height(),width:n(window).width()},cssClass:"resFilter",type:this._$colType,format:this._$colFormat,localizedStrings:st});n(f).insertAfter(this.element);t.isNullOrUndefined(n(f).parents(".e-grid")[0])||n(f).remove();p.click(function(){var y,p,i,u,b,h,d,c,g,l,tt,it,r,rt,ut,a,v,s;n(e._excelDlg).css("display","none");y=n(window).height()-5;p=n(window).width();ri._openCustomFilter("equal");i=f=n("#"+e._id+e._$colType+"_CustomFDlg").addClass("e-responsviesExcelFilter");t.isNullOrUndefined(i.find(".e-resFilterDialogHeaderDiv")[0])&&(u=t.buildTag("div.e-resFilterDialogHeaderDiv"),b=t.buildTag("div.e-labelRes","<span>Custom Filter<\/span>"),u.append(b),h=t.buildTag("div.e-resFilterleftIcon","",{},{closeDialogue:e._id+e._$colType+"_CustomFDlg",openDialogue:e._excelDlg.slice(1)}),d=t.buildTag("span.e-icon e-resIcon e-responisveBack","",{},{closeDialogue:e._id+e._$colType+"_CustomFDlg",openDialogue:e._excelDlg.slice(1)}),h.click(function(){i.css("display","none");e.model.enableResponsiveRow?n("#"+this._id+"responsiveFilter").css("display","block"):e.element.css("display","block")}),u.append(h.append(d)),c=t.buildTag("div.e-resFIlterRigthIcon","",{},{closeDialogue:e._id+e._$colType+"_CustomFDlg",gridEle:!0}),g=t.buildTag("span.e-icon e-resIcon e-responisveClose","",{},{closeDialogue:e._id+e._$colType+"_CustomFDlg",gridEle:!0}),u.append(c.append(g)),c.click(function(){i.css("display","none");e.element.css("display","block")}),i.prepend(u),i.insertAfter(e.element),i.find(".e-dlgfields").css("width","100%"),l=i.find(".e-dlgfields:first").css("width","92%").css("margin-left","6%"),l.css("margin-top","4%"),tt=i.find(".e-dlgfields").find(".e-fieldset legend").text(),it=t.buildTag("div.e-responsiveLabelDiv",tt,{"margin-left":"6%"}),it.insertAfter(l),r=i.find(".e-dlgfields").find(".e-fieldset").find("table").css("width","61%"),i.find(".e-dlgfields").find(".e-fieldset").replaceWith(r),rt=r.parent("div").addClass("e-responsiveExcelFilterFieldDiv"),ut=r.find(".e-dropdownlist"),r.find(".e-dropdownlist").each(function(t,i){var u=n(i).ejDropDownList("model.dataSource"),r=n(window).width()*(40/100);n(i).ejDropDownList("destroy").ejDropDownList({width:r,popupWidth:r+"px",dataSource:u})}),r.find(".e-autocomplete").each(function(t,i){var r=n(i).ejAutocomplete("model.dataSource"),u=n(window).width()*(40/100);n(i).ejAutocomplete("destroy").ejAutocomplete({width:u,dataSource:r.dataSource,fields:r.fields})}),r.find(".e-datepicker").each(function(t,i){var u=n(i).ejDatePicker("model.dataSource"),r=n(window).width()*(40/100);n(i).ejDatePicker("destroy");n("#"+n(i).attr("id")).ejDatePicker({width:r})}),a=k.clone(),v=w.clone(),a.ejButton({text:"OK",type:"button",click:function(){e._excelFilter._openedFltr=i;e._excelFilter._fltrBtnHandler();i.hasClass("e-dlgcustom")&&i.css("display","none");e._setResponsiveFilterIcon();e.element.css("display","block")}}),v.ejButton({text:"Cancel",type:"button",click:function(){i.ejDialog("close");o.element.css("display","block")}}),i.append(nt.clone().append(a).append(v)),s=i.find(".e-dlgfields .e-btncontainer").remove(),s.find("input:first").addClass("e-resposnsiveFilterBtnLeft"),s.find("input:first").css("width","45.6%"),s.find("input:last").addClass("e-resposnsiveFilterBtnRight"));e.element.css("display","none");i.ejDialog({enableModal:!1,height:y,width:p,position:{X:0,Y:0},enableResize:!1,showHeader:!1}).ejDialog("open")});oi=t.buildTag("div")}else wt=this.model.enableResponsiveRow?"OK":"Filter",ht=this.model.enableResponsiveRow?"Cancel":"Clear",k.ejButton({text:wt,type:"button",click:n.proxy(this._fltrBtnHandler,this)}),w.ejButton({text:ht,type:"button",click:function(){ht=="Clear"&&(o.element.css("display","block"),o._fltrClrHandler());n(f).css("display","none");w.hasClass("e-resposnsiveFilterBtnRight")&&o.element.css("display","block")}}),u.parent().hasClass("e-responsivefilterColDiv")&&u.hasClass("e-filternone")?(o._fltrClrHandler(),u.remove()):(h.addClass("e-resMenuFltr"),h.css("height",n(window).height()-1).css("width",n(window).width()-2),h.find(".e-operator").addClass("e-resFilterOperator"),h.find(".e-value").addClass("e-resFilterOperator"),h.find(".e-value1").addClass("e-resFilterOperator"),ii=h.find(".e-dlgBtns").remove().addClass("e-filterMenuBtn"),h.append(nt),nt.append(k).append(w),t.isNullOrUndefined(n("#"+this._id+"_"+this._$colType+"Dlg").find(".e-resFilterDialogHeaderDiv")[0])&&(h.insertAfter(this.element),d=t.buildTag("div.e-resFilterleftIcon","",{},{closeDialogue:f.slice(1),openDialogue:"responsiveFilter"}),ct=t.buildTag("span.e-icon e-resIcon e-responisveBack","",{},{closeDialogue:f.slice(1),openDialogue:"responsiveFilter"}),d.click(function(){h.css("display","none");e.model.enableResponsiveRow?n("#"+e._id+"responsiveFilter").css("display","block"):e.element.css("display","block")}),a.append(d.append(ct)),p=t.buildTag("div.e-resFIlterRigthIcon","",{},{closeDialogue:f.slice(1),gridEle:!0}),tt=t.buildTag("span.e-icon e-resIcon e-responisveClose","",{},{closeDialogue:f.slice(1),gridEle:!0}),p.click(function(){h.css("display","none");e.element.css("display","block")}),bt=n(h.find(".e-value").find("input:last")),o._$colType=="string"&&(it=n(h.find(".e-value").find("input:last")).ejAutocomplete("model"),bt.ejAutocomplete("destroy").ejAutocomplete({enableDistinct:!0,dataSource:it.dataSource,fields:it.fields,width:it.width,focusIn:function(){var n=this.element.closest(".e-filterDialog").find(".e-dropdownlist");this.model.filterType=n.val()}})),a.append(p.append(tt)),h.prepend(a)),h.find(".e-responsiveLabelDiv").remove(),kt=t.buildTag("div.e-responsiveLabelDiv","",{"margin-left":"5%","font-size":"17px","margin-top":"5%"}).append(t.buildTag("span",this.getHeaderTextByFieldName(c),{"font-weight":"bold"})),kt.insertAfter(h.find(".e-resFilterDialogHeaderDiv")),this.model.enableResponsiveRow&&(n("#"+this._id+"_"+this._$colType+"Dlg").css({width:"100%",position:"relative"}),n("#"+this._id+"responsiveFilter").css("display","none")),h.fadeIn(100,function(){}))}else{at="#"+this._id+this._$colType+"_excelDlg";n(at).hasClass("resFilter")&&(n(at).remove(),this._renderFilters(s));n(f).hasClass("e-resMenuFltr")&&(n(f).remove(),this._renderFilterDialogs(),f="#"+this._id+"_"+this._$colType+"Dlg");n(f).ejDialog({position:{X:"",Y:""}});var vi=n(document).width(),v=document.documentElement.clientWidth<800?200:250,si=n("#"+this._id).width(),gt=u.offset(),vt=u.offsetParent(),ut=vt.offset(),ut={top:ut.top+jQuery.css(vt[0],"borderTopWidth",!0),left:ut.left+jQuery.css(vt[0],"borderLeftWidth",!0)},y=gt.left-ut.left-jQuery.css(u[0],"marginLeft",!0)+(this.model.enableRTL?-6:18),b=gt.top-ut.top-jQuery.css(u[0],"marginTop",!0)+2;u.closest(".e-headercell").css("position")=="relative"&&(y=u.offset().left+15,b=u.offset().top+20);yt="e-filterdialoglarge";v=this._isExcelFilter&&s.filterType!="menu"&&!t.isNullOrUndefined(this._excelFilter._dialogContainer)?this._excelFilter._dialogContainer.width():v;var hi=this.element.offset().left+this.element.width()-u.offset().left,ci=v-hi,li=u.offset().left-this.element.offset().left,ai=v-li;u.offset().left+18+v>si&&ci>ai&&(y=y-v-(this.model.enableRTL?14:10));v==200&&(yt="");t.isNullOrUndefined(this._$colType)||(this.model.filterSettings.filterType=="menu"&&this._$filterType!="excel"||this.model.filterSettings.filterType=="excel"&&this._$filterType=="menu"?(y=y-n("#"+this._id).offset().left,b=b-n("#"+this._id).offset().top,n(f).ejDialog({position:{X:y,Y:b},width:v,cssClass:yt}).ejDialog("open")):this._excelFilter.openXFDialog({field:c,displayName:s.headerText,dataSource:this._dataSource(),query:pt,position:{X:y,Y:b},type:this._$colType,format:s.format,foreignKey:s.foreignKeyField,foreignKeyType:s.originalType,foreignKeyValue:s.foreignKeyValue,foreignDataSource:s.dataSource,localizedStrings:st}))}this._setFilterFieldValues(f);this._$colType=="number"&&s.serverType!=i?n(f).find(".e-numerictextbox.e-js").ejNumericTextbox({width:"100%",decimalPlaces:0}):this._$colType=="number"&&n(f).find(".e-numerictextbox.e-js").ejNumericTextbox({width:"100%",groupSeparator:""});this._$prevColType=this._$colType;this._$fDlgIsOpen=!0}},_responsiveFilterClose:function(){this.element.css("display","block");n("#"+this._id+"responsiveFilter").css("display","block")},_clickHandler:function(i){var r=n(i.target),o=n("[id$='ccDiv'].e-grid.e-columnChooser"),h,b=n("#"+this._id+"EditForm"),c,u,f,l,e,a,k,s,d,g,v,y,p,nt,tt,w,it;if(n(i.target).hasClass("e-checkselectall")&&!this.model.enableTouch&&(i.target.checked?this._isCheckboxChecked=!0:this._isCheckboxUnchecked=!0),o.length)for(l=!0,e=0;e<o.length;e++)(r.parents(".e-ccButton").length||r.hasClass("e-ccButton"))&&(l=n(i.target).closest(".e-grid").attr("id")+"ccDiv"!=o[e].id),a=n("#"+o[e].id).ejDialog("instance"),a.isOpened()&&l&&(a.close(),n(".e-columnChoosertail").remove(),n(".e-columnChoosertailAlt").remove());if((!r.hasClass("e-button")||!(r.hasClass("e-disable")||r.prop("disabled")))&&r.closest(".e-grid").attr("id")===this._id){if(r.closest("#"+this._id+"EditForm").length){r.closest(".e-unboundcelldiv").length&&this._unboundClickHandler(i);return}if(r.hasClass("e-rowcell")||r.closest("td").is(".e-rowcell")||r.hasClass("e-headercell")&&i.clientY-r.offset().top<r.height()/4||r.parents(".e-headercheckcelldiv").length){if(this._bulkEditCellDetails.cancelSave){this._bulkEditCellDetails.cancelSave=!1;return}if(this.model.editSettings.editMode=="batch"&&n.isFunction(n.validator)&&b.length&&b.validate().errorList.length>0)return;c=r.closest("tr").hasClass("e-insertedrow")?this.model.groupSettings.groupedColumns.length:0;k=r.closest(".e-rowcell").index()!=-1?r.closest(".e-rowcell").index():r.closest(".e-headercell").index()-this.model.groupSettings.groupedColumns.length;u=r.hasClass("e-rowcell")?r.index()-c:k-c;u=this.model.detailsTemplate!=null||this.model.childGrid!=null?u-1:u;this.model.scrollSettings.frozenColumns&&(r.closest(".e-movableheaderdiv").length||r.closest(".e-movablecontentdiv").length)&&(u=u+this.model.scrollSettings.frozenColumns);f=this.getIndexByRow(r.closest("tr"));this._bulkEditCellDetails.columnIndex=u;this._bulkEditCellDetails.rowIndex=f;this.model.allowSelection&&t.gridFeatures.selection&&(s=this._enableCheckSelect&&r.parent(".e-checkcelldiv").length?!0:!1,r.hasClass("e-checkselectall")&&(this._selectAllCheck=!0,d=this.model.scrollSettings.frozenColumns>0?this._gridRows[0].length:this._gridRows.length,g=this.model.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling?this._gridRecordsCount:this.model.allowPaging?this.model.groupSettings.groupedColumns.length>0?this._currentJsonData.length:this.model.currentViewData.length:d,this.selectRows(0,g-1,r)),this.model.selectionType=="multiple"&&((i.ctrlKey||this._enableSelectMultiTouch)&&(this.multiSelectCtrlRequest=!0),i.shiftKey&&(this.multiSelectShiftRequest=!0,this._allowcellSelection&&f>-1&&this.selectCells([[f,[u]]]),this._allowrowSelection&&f>-1&&(!this._enableCheckSelect||s)&&this.selectRows(this._previousIndex,this.getIndexByRow(r.closest("tr")),r),this._selectedRow(this.getIndexByRow(r.closest("tr"))),this._allowcolumnSelection&&r.hasClass("e-headercell")&&!r.hasClass("e-stackedHeaderCell")&&i.clientY-r.offset().top<r.height()/4&&this.selectColumns(this._previousColumnIndex,u)),i.pointerType=="touch"&&this._customPop!=null&&!this._customPop.is(":visible")&&this._customPop.find(".e-rowselect").hasClass("e-spanclicked")&&this.model.selectionSettings.selectionMode=="row"&&this._customPop.show(),i.pointerType=="touch"&&this._customPop!=null&&(this._customPop.find(".e-sortdirect").is(":visible")||!this._customPop.find(".e-rowselect").hasClass("e-spanclicked"))&&this.model.selectionType=="multiple"&&(this.model.selectionSettings.selectionMode.indexOf("cell")!=-1||this.model.selectionSettings.selectionMode.indexOf("row")!=-1)&&(this._customPop.removeAttr("style"),v=r.offset(),this._customPop.offset({top:0,left:0}).offset({left:v.left,top:v.top-this.getRowHeight()-r.height()}).find(".e-sortdirect").hide().end().find(".e-rowselect").show().end().show())),this.multiSelectShiftRequest||(this._allowcellSelection&&f>-1&&(y=this._checkCellSelectionByRow(f,u),(this.model.selectionSettings.enableToggle&&this.selectedRowCellIndexes.length==1&&this.selectedRowCellIndexes[0].cellIndex.length==1||i.ctrlKey&&this.model.selectionType=="multiple")&&y!=-1&&this.selectedRowCellIndexes.length>0&&this.selectedRowCellIndexes[0].cellIndex.length>0?this.clearCellSelection(y.rowIndex,u):this.selectCells([[f,[u]]])),this._allowrowSelection&&f>-1&&(p=this.getIndexByRow(r.closest("tr")),this._enableCheckSelect&&(this.multiSelectCtrlRequest=!0),this.model.scrollSettings.enableVirtualization&&(nt=f%this._virtualRowCount,tt=parseInt(n(r).closest("tr").attr("name"),32),p=tt*this._virtualRowCount-(this._virtualRowCount-nt)),(this.model.editSettings.editMode=="inlineform"||this.model.editSettings.editMode=="inlineformtemplate")&&!this._enableCheckSelect&&!s&&this.getIndexByRow(r.closest("tr"))>n(".e-editedrow").index()?(it=n("#"+this._id).find(".e-editedrow").length,w=this.getIndexByRow(r.closest("tr"))-it):w=this.getIndexByRow(r.closest("tr")),(!this._enableCheckSelect||s)&&(this.model.selectionSettings.enableToggle&&!this._enableCheckSelect&&this.getSelectedRecords().length==1&&n.inArray(this.getIndexByRow(r.closest("tr")),this.selectedRowsIndexes)!=-1?this.clearSelection(p):this.selectRows(w,null,r)),!this._enableCheckSelect||i.ctrlKey||this._enableSelectMultiTouch||(this.multiSelectCtrlRequest=!1)),this._allowcolumnSelection&&r.hasClass("e-headercell")&&!r.hasClass("e-stackedHeaderCell")&&i.clientY-r.offset().top<r.height()/4&&(this.model.selectionSettings.enableToggle&&this.selectedColumnIndexes.length==1&&n.inArray(u,this.selectedColumnIndexes)!=-1?this.clearColumnSelection(u):this.selectColumns(u)),this.multiSelectCtrlRequest=!1),this.multiSelectShiftRequest=!1);h=this._bulkEditCellDetails.columnIndex>=0?this.model.columns[this._bulkEditCellDetails.columnIndex].field:null;r.closest(".e-rowcell").length&&!t.isNullOrUndefined(h)&&(this._tabKey=!1,this._enterKey=!1,this.model.editSettings.allowEditing&&this.model.editSettings.editMode==t.Grid.EditMode.Batch&&this.editCell(n.inArray(r.closest("tr").get(0),this._excludeDetailRows()),h))}(r.hasClass("e-rowselect")||r.hasClass("e-sortdirect"))&&(r.hasClass("e-spanclicked")?(r.removeClass("e-spanclicked"),r.hasClass("e-rowselect")&&(this._enableSelectMultiTouch=!1),r.hasClass("e-sortdirect")&&(this._enableSortMultiTouch=!1),this._customPop.hide()):(r.addClass("e-spanclicked"),r.hasClass("e-rowselect")&&(this._enableSelectMultiTouch=!0),r.hasClass("e-sortdirect")&&(this._enableSortMultiTouch=!0)));this._selectAllCheck=!1;t.gridFeatures.common&&this.expandCollapse(r);r.is(".e-filtericon")&&r.closest(".e-detailrow").length!=0&&i.preventDefault();this._$fDlgIsOpen&&this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"||this._isExcelFilter)&&!r.is(".e-filtericon")&&r.closest(".e-dlgcontainer").length!=1&&this._closeFDialog();this.model.allowSearching&&this._searchBar!=null&&(r.is(this._searchBar.find(".e-cancel"))?this._searchBar.find("input").val(""):i.target.id==this._id+"_searchbar"?this._searchBar.find(".e-cancel").removeClass("e-hide"):this._searchBar.find(".e-cancel").hasClass("e-hide")||this._searchBar.find(".e-cancel").addClass("e-hide"));r.closest(".e-unboundcelldiv").length&&this._unboundClickHandler(i)}},_checkCellSelectionByRow:function(t,i){for(var r=0;r<this.selectedRowCellIndexes.length;r++)if(this.selectedRowCellIndexes[r].rowIndex==t)break;return r!=this.selectedRowCellIndexes.length&&n.inArray(i,this.selectedRowCellIndexes[r].cellIndex)!=-1?this.selectedRowCellIndexes[r]:-1},_persistState:function(n){this.model.enablePersistence&&this._isHeightResponsive&&(n._isHeightResponsive=this._isHeightResponsive)},_restoreState:function(n){this.model.enablePersistence&&n._isHeightResponsive&&(this._isHeightResponsive=n._isHeightResponsive)},_destroy:function(){var s,l,e,h,u,o,i,c,f;if(this.element.off(),this.element.find(".e-gridheader").find(".e-headercontent,.e-movableheader").add(this.element.find(".e-gridcontent").find(".e-content,.e-movablecontent")).off("scroll"),s=n("#"+this._id+"EditForm"),s.length){for(l=s.find(".e-field"),h=0;h<l.length;h++)e=n(l[h]),e.hasClass("e-datetimepicker e-js")?e.ejDateTimePicker("destroy"):e.hasClass("e-datepicker e-js")?e.ejDatePicker("destroy"):e.hasClass("e-dropdownlist")&&e.ejDropDownList("destroy");s.remove()}this._confirmDialog&&this._confirmDialog.ejDialog("destroy");this.element.find(".e-dropdownlist").ejDropDownList("model.dataSource",[]);this.model.showColumnChooser&&(n("#"+this._id+"ccDiv").ejDialog("destroy"),n("#"+this._id+"ccDiv").remove(),n("#"+this._id+"_ccTail").remove(),n("#"+this._id+"_ccTailAlt").remove());this.model.allowFiltering&&this.model.filterSettings.filterType=="excel"&&this._excelFilter.resetExcelFilter();this.model.allowReordering&&n(".e-columndropindicator").remove();this.model.allowFiltering&&this.model.filterSettings.filterType=="menu"&&(u=this,n.each(this.model.columns,function(t,i){o=i.type;n("#"+u._id+o+"_ddinput_popup_wrapper").remove();o=="string"?n("#"+u._id+"_stringDlg").find(".e-autocomplete").ejAutocomplete("destroy"):o=="date"?n("#"+u._id+"_dateDlg").find(".e-datepicker.e-js").ejDatePicker("destroy"):o=="datetime"?n("#"+u._id+"_datetimeDlg").find(".e-datetimepicker.e-js").ejDateTimePicker("destroy"):o=="number"&&n("#"+u._id+"_numberDlg").find(".e-numerictextbox.e-js").ejNumericTextbox("destroy")}));var u=this,a=this.model,r=a.columns;for(i=0;i<r.length;i++)t.isNullOrUndefined(r[i].filterBarTemplate)||(c=t.isNullOrUndefined(r[i].foreignKeyValue)?n("#"+r[i].field.split(".").join("")+"_filterBarcell"):n("#"+r[i].field.split(".").join("")+"_"+r[i].foreignKeyValue+"_filterBarcell"),c.data("ejWidgets")&&n(c).data(n(c).data("ejWidgets")[0]).destroy()),f=r[i].headerText,t.isNullOrUndefined(f)||t.isNullOrUndefined(f.match(/(\\|[^0-9A-z-_])/g))||(f=f.replace(/(\\|[^0-9A-z-_])/g,"")),this._isUnboundColumn&&r[i].commands&&r[i].commands.length>0&&n("#"+u._id+f+[i]+"_UnboundTemplate").remove(),t.isNullOrUndefined(r[i].template)||n("#"+u._id+f+n.inArray(r[i],u.model.columns)+"_Template").length>0&&n("#"+u._id+f+n.inArray(r[i],u.model.columns)+"_Template").remove();n("#"+this._id+"_toolbarItems_Main").remove();this.element.find(".e-gridcontent .e-scrollbar").length>0&&this.element.find(".e-gridcontent").ejScroller("destroy");this._$onresize&&n(window).off("resize",this._$onresize);this.element.empty().removeClass("e-grid "+this.model.cssClass);this.element.ejWaitingPopup("destroy");this.model.contextMenuSettings.enableContextMenu&&(n("#"+this._id+"_Context").ejMenu("destroy"),n("#"+this._id+"_Context").remove())},_getDeprecatedLocalizedLabel:function(n){if(["OkButton","OKButton"].indexOf(n)!=-1)return this.localizedLabels.OkButton||this.localizedLabels.OKButton},_getLocalizedLabels:function(){return t.getLocalizedConstants(this.sfType,this.model.locale)}});t.gridFeatures.common&&n.extend(t.Grid.prototype,t.gridFeatures.common);t.gridFeatures.edit&&n.extend(t.Grid.prototype,t.gridFeatures.edit);t.gridFeatures.filter&&n.extend(t.Grid.prototype,t.gridFeatures.filter);t.gridFeatures.group&&n.extend(t.Grid.prototype,t.gridFeatures.group);t.gridFeatures.selection&&n.extend(t.Grid.prototype,t.gridFeatures.selection);t.gridFeatures.sort&&n.extend(t.Grid.prototype,t.gridFeatures.sort);t.gridFeatures.dragAndDrop&&n.extend(t.Grid.prototype,t.gridFeatures.dragAndDrop);t.Grid.Locale=t.Grid.Locale||{};t.Grid.Locale["default"]=t.Grid.Locale["en-US"]={EmptyRecord:"No records to display",GroupDropArea:"Drag a column header here to group its column",DeleteOperationAlert:"No records selected for delete operation",EditOperationAlert:"No records selected for edit operation",SaveButton:"Save",OKButton:"OK",CancelButton:"Cancel",EditFormTitle:"Details of ",AddFormTitle:"Add New Record",GroupCaptionFormat:"{{:headerText}}: {{:key}} - {{:count}} {{if count == 1 }} item {{else}} items {{/if}} ",BatchSaveConfirm:"Are you sure you want to save changes?",BatchSaveLostChanges:"Unsaved changes will be lost. Are you sure you want to continue?",ConfirmDelete:"Are you sure you want to Delete Record?",CancelEdit:"Are you sure you want to Cancel the changes?",PagerInfo:"{0} of {1} pages ({2} items)",FrozenColumnsViewAlert:"Frozen columns should be in grid view area",FrozenColumnsScrollAlert:"Enable allowScrolling while using frozen Columns",FrozenNotSupportedException:"Frozen Columns and Rows are not supported for Grouping, Row Template, Detail Template, Hierarchy Grid and Batch Editing",Add:"Add",Edit:"Edit",Delete:"Delete",Update:"Update",Cancel:"Cancel",Done:"Done",Columns:"Columns",SelectAll:"(Select All)",PrintGrid:"Print",ExcelExport:"Excel Export",WordExport:"Word Export",PdfExport:"PDF Export",StringMenuOptions:[{text:"StartsWith",value:"StartsWith"},{text:"EndsWith",value:"EndsWith"},{text:"Contains",value:"Contains"},{text:"Equal",value:"Equal"},{text:"NotEqual",value:"NotEqual"}],NumberMenuOptions:[{text:"LessThan",value:"LessThan"},{text:"GreaterThan",value:"GreaterThan"},{text:"LessThanOrEqual",value:"LessThanOrEqual"},{text:"GreaterThanOrEqual",value:"GreaterThanOrEqual"},{text:"Equal",value:"Equal"},{text:"NotEqual",value:"NotEqual"},{text:"Between",value:"Between"}],PredicateAnd:"AND",PredicateOr:"OR",Filter:"Filter",FilterMenuFromCaption:"From",FilterMenuToCaption:"To",FilterMenuCaption:"Filter Value",FilterbarTitle:"'s filter bar cell",MatchCase:"Match Case",Clear:"Clear",ResponsiveFilter:"Filter",ResponsiveSorting:"Sort",Search:"Search",DatePickerWaterMark:"Select date",NumericTextBoxWaterMark:"Enter value",EmptyDataSource:"DataSource must not be empty at initial load since columns are generated from dataSource in AutoGenerate Column Grid",ForeignKeyAlert:"The updated value should be a valid foreign key value",True:"true",False:"false",UnGroup:"Click here to ungroup",AddRecord:"Add Record",EditRecord:"Edit Record",DeleteRecord:"Delete Record",Save:"Save",Grouping:"Group",Ungrouping:"Ungroup",SortInAscendingOrder:"Sort In Ascending Order",SortInDescendingOrder:"Sort In Descending Order",NextPage:"Next Page",PreviousPage:"Previous Page",FirstPage:"First Page",LastPage:"Last Page",EmptyRowValidationMessage:"Atleast one field must be updated",NoResult:"No Matches Found"};t.Grid.Actions={Paging:"paging",Sorting:"sorting",Filtering:"filtering",BeginEdit:"beginedit",Save:"save",Add:"add",Delete:"delete",Cancel:"cancel",Grouping:"grouping",Ungrouping:"ungrouping",Refresh:"refresh",Reorder:"reorder",Search:"searching",BatchSave:"batchsave",VirtualScroll:"virtualscroll"};t.Grid.SummaryType={Average:"average",Minimum:"minimum",Maximum:"maximum",Count:"count",Sum:"sum",TrueCount:"truecount",FalseCount:"falsecount",Custom:"custom"};t.Grid.EditMode={Normal:"normal",Dialog:"dialog",DialogTemplate:"dialogtemplate",Batch:"batch",ExternalForm:"externalform",ExternalFormTemplate:"externalformtemplate",InlineForm:"inlineform",InlineTemplateForm:"inlineformtemplate"};t.Grid.PrintMode={AllPages:"allpages",CurrentPage:"currentpage"};t.Grid.ResizeMode={NextColumn:"nextcolumn",Control:"control",Normal:"normal"};t.Grid.Rowposition={Top:"top",Bottom:"bottom"};t.Grid.FormPosition={BottomLeft:"bottomleft",TopRight:"topright"};t.Grid.ClipMode={Ellipsis:"ellipsis",Clip:"clip",EllipsisWithTooltip:"ellipsiswithtooltip"};t.Grid.DragBehavior={Move:"move",Copy:"copy"};t.Grid.CellSelectionMode={Flow:"flow",Box:"box"};t.Grid.EditingType={String:"stringedit",Boolean:"booleanedit",Numeric:"numericedit",Dropdown:"dropdownedit",DatePicker:"datepicker",DateTimePicker:"datetimepicker",EditTemplate:"edittemplate"};t.Grid.UnboundType={Edit:"edit",Save:"save",Delete:"delete",Cancel:"cancel"};t.Grid.ToolBarItems={Add:"add",Edit:"edit",Delete:"delete",Update:"update",Cancel:"cancel",Search:"search",PrintGrid:"printGrid",ExcelExport:"excelExport",WordExport:"wordExport",PdfExport:"pdfExport"};t.Grid.FilterType={Menu:"menu",FilterBar:"filterbar",Excel:"excel"};t.Grid.FilterBarMode={Immediate:"immediate",OnEnter:"onenter"};t.Grid.SelectionType={Single:"single",Multiple:"multiple"};t.Grid.ColumnLayout={Auto:"auto",Fixed:"fixed"};t.Grid.GridLines={Both:"both",None:"none",Horizontal:"horizontal",Vertical:"vertical"};t.Grid.VirtualScrollMode={Normal:"normal",Continuous:"continuous"};t.Grid.SelectionMode={Row:"row",Cell:"cell",Column:"column"};t.Grid.WrapMode={Both:"both",Content:"content",Header:"header"};t.Grid.exportAll=function(n,i){t.Grid.prototype["export"](n,null,!0,i)};t.SqlDataSourceAdaptor=(new t.UrlAdaptor).extend({init:function(){this.initialRender=!0},processQuery:function(n,i,r){var h=t.UrlAdaptor.prototype.processQuery(n,i,r),u=t.parseJSON(h.data),e={},f,o,s,c;if(u.param)for(f=0;f<u.param.length;f++)o=u.param[f],s=Object.keys(o)[0],e[s]=o[s];return e.value=u,c=JSON.stringify({type:"SqlData",args:u}),this.initialRender==!1&&setTimeout(function(){__doPostBack("",c)},0),this.initialRender=!1,{data:JSON.stringify(e),result:n.dataSource.json,ejPvtData:h.ejPvtData,count:n.dataSource.json.length}},processResponse:function(n,r,u,f,e){var h=n.ejPvtData||{},l=n.groupDs,v,a,s,o,w;if(f&&f.getResponseHeader("Content-Type")&&f.getResponseHeader("Content-Type").indexOf("xml")!=-1&&n.nodeType==9)return u._requiresCount?{result:[],count:0}:[];if(v=JSON.parse(n.data),v&&v.action==="batch"&&n.added)return e.added=n.added,e;if(h&&h.aggregates&&h.aggregates.length){var c=h.aggregates,s={},y,p={};for(("count"in n)&&(s.count=n.count),n.result&&(s.result=n.result),n.aggregate&&(n=n.aggregate),o=0;o<c.length;o++)y=t.aggregates[c[o].type],y&&(p[c[o].field+" - "+c[o].type]=y(n,c[o].field));s.aggregates=p;n=s}if(h&&h.groups&&h.groups.length){for(a=h.groups,s={},("count"in n)&&(s.count=n.count),n.aggregates&&(s.aggregates=n.aggregates),n.result&&(n=n.result),o=0;o<a.length;o++)w=null,t.isNullOrUndefined(l)||(l=t.group(l,a[o])),n=t.group(n,a[o],h.aggregates,w,l);return s.count!=i?s.result=n:s=n,s}return n}})}(jQuery,Syncfusion),function(n,t){t.gridFeatures=t.gridFeatures||{};t.gridFeatures.gridResize=function(t){this.$headerTable=t.getHeaderTable();this.gridInstance=t;this._colMinWidth=15;this._$visualElement=n();this._currentCell=-1;this._allowStart=!1;this._oldWidth=null;this._orgX=null;this._orgY=null;this._extra=null;this._expand=!1;this._target=null;this._cellIndex=-1};t.gridFeatures.gridResize.prototype={_mouseHover:function(t){var r,h,o,c,s;if(!this._$visualElement.is(":visible")&&(this._allowStart=!1,n(t.target).is(".e-headercelldiv")&&(t.target=t.target.parentNode),r=n(t.target),n(t.target).hasClass("e-filtericon")&&(n(t.target).css("cursor")=="col-resize"||n(t.target).closest("tr").css("cursor")=="col-resize")&&(n(t.target).css("cursor","pointer"),n(t.target).closest("tr").css("cursor","pointer")),r.hasClass("e-headercell"))){var f=t.target,u=f.getBoundingClientRect(),i=0,e=0;(t.type="mousemove")?(i=t.clientX,e=t.clientY):(t.type="touchmove")?(i=evt.originalEvent.changedTouches[0].clientX,e=evt.originalEvent.changedTouches[0].clientY):(t.type="MSPointerMove")&&(i=t.originalEvent.clientX,e=t.originalEvent.clientY);h=this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns?this.gridInstance.getHeaderContent().width()+this.gridInstance.element.children(".e-gridheader").find(".e-columnheader").offset().left:this.gridInstance.getHeaderTable().width()+this.gridInstance.element.children(".e-gridheader").find(".e-columnheader").offset().left;(i>=u.left+document.documentElement.scrollLeft+f.offsetWidth-5||i<=u.left+3)&&i<h&&i>=u.left&&e<=u.top+document.documentElement.scrollTop+t.target.offsetHeight?(o=i>u.left+3?n(t.target).find(".e-headercelldiv"):n(t.target).prevAll("th:visible:first").find(".e-headercelldiv"),c=window.pageXOffset||document.documentElement.scrollTop||document.body.scrollTop,s=this.gridInstance.element.find(".e-headercell").not(".e-detailheadercell").offset().left+10-c,(this.gridInstance.model.enableRTL&&i<=s||!this.gridInstance.model.enableRTL&&i>=s)&&((this.gridInstance.model.showStackedHeader||o.length)&&n.inArray(n(o).attr("data-ej-mappingname"),this.gridInstance._disabledResizingColumns)==-1?(this.gridInstance.model.showStackedHeader&&n(r.parents("thead")).find("tr").addClass("e-resizedragicon"),this.gridInstance.model.showStackedHeader||r.parent().addClass("e-resizedragicon"),this._currentCell=n(t.target).hasClass("e-stackedHeaderCell")?this.gridInstance.getHeaderContent().find(".e-headercell:visible").index(f):this.gridInstance.getHeaderContent().find(".e-headercell:visible").not(".e-stackedHeaderCell,.e-detailheadercell").index(f),this.gridInstance.model.enableRTL&&(this._currentCell=this._currentCell-1),this._allowStart=!0):(r.parent().css("cursor","pointer"),this._currentCell=-1))):(this.gridInstance.element.find(".e-columnheader").removeClass("e-resizedragicon"),this._currentCell=-1)}},_start:function(t,i){var s=this.gridInstance.getHeaderTable().find(".e-columnheader"),h,e,r,c,o,u,f;if(e=n(this._target).hasClass("e-stackedHeaderCell")?s.find(".e-headercell").not(".e-hide"):s.find(".e-headercell").not(".e-stackedHeaderCell,.e-hide"),this._currentCell!=-1&&this._currentCell<e.length&&(r=e[this._currentCell]),typeof r!="undefined")if(c=r.getBoundingClientRect(),h=this._tableY=c.top+parseInt(navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollTop:document.documentElement.scrollTop),this._allowStart){if(o=this._$visualElement=n(document.createElement("div")),u=this.gridInstance.element.find(".e-gridcontent").first().height()+this.gridInstance.element.find(".e-gridheader").height(),this.gridInstance.model.showStackedHeader&&this.gridInstance.model.stackedHeaderRows.length>0){var l=this.gridInstance.getHeaderTable().find("tr.e-columnheader"),v=l.length,a=n(this._target).parent("tr")[0].rowIndex;for(f=0;f<a;f++)u=u-n(l[f]).height()}o.addClass("e-reSizeColbg").appendTo(this.gridInstance.element).attr("unselectable","on").css("visibility","hidden");this.gridInstance._resizeTimeOut=setTimeout(function(){o.css({visibility:"visible",height:u+"px",cursor:"col-resize",left:t,top:h,position:"fixed"})},100);this._oldWidth=r.offsetWidth;this._orgX=t;this._orgY=i;this._extra=t-this._orgX;this._expand=!0}else this._currentCell=-1},_mouseMove:function(n){if(this._expand){var t=0,i=0;n.type=="mousemove"?(t=n.clientX,i=n.clientY):n.type=="MSPointerMove"?(t=n.originalEvent.clientX,i=n.originalEvent.clientY):n.type=="touchmove"&&(t=n.originalEvent.changedTouches[0].clientX,i=n.originalEvent.changedTouches[0].clientY);t==0&&i==0&&navigator.userAgent.indexOf("WebKit")!=-1&&(t=n.pageX,i=n.pageY);t+=document.documentElement.scrollLeft;n.preventDefault();this._moveVisual(t)}else this._mouseHover(n)},_touchStart:function(t){var f,o,c,s,l,h,a;if(!this._$visualElement.is(":visible")){if(this._allowStart=!1,n(t.target).is(".e-headercelldiv")&&(t.target=t.target.parentNode),f=n(t.target),f.hasClass("e-headercell")){var u=t.target,r=u.getBoundingClientRect(),i=0,e=0;t.type=="touchstart"&&(i=t.originalEvent.changedTouches[0].clientX,e=t.originalEvent.changedTouches[0].clientY);o=this.gridInstance.element.children(".e-gridheader");c=this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns?this.gridInstance.getHeaderContent().width()+o.find(".e-columnheader").offset().left:this.gridInstance.getHeaderTable().width()+o.find(".e-columnheader").offset().left;(i>=r.left+document.documentElement.scrollLeft+u.offsetWidth-10||i<=r.left+8)&&i<c&&i>=r.left&&e<=r.top+document.documentElement.scrollTop+t.target.offsetHeight?(s=i>r.left+8?n(t.target).find(".e-headercelldiv"):n(t.target).prevAll("th:visible:first").find(".e-headercelldiv"),l=window.pageXOffset||document.documentElement.scrollTop||document.body.scrollTop,h=this.gridInstance.element.find(".e-headercell").not(".e-detailheadercell").offset().left+10-l,(this.gridInstance.model.enableRTL&&i<=h||!this.gridInstance.model.enableRTL&&i>=h)&&((this.gridInstance.model.showStackedHeader||s.length)&&n.inArray(n(s).attr("data-ej-mappingname"),this.gridInstance._disabledResizingColumns)==-1?(this._currentCell=n(t.target).hasClass("e-stackedHeaderCell")?this.gridInstance.getHeaderContent().find(".e-headercell:visible").index(u):this.gridInstance.getHeaderContent().find(".e-headercell:visible").not(".e-stackedHeaderCell,.e-detailheadercell").index(u),this.gridInstance.model.enableRTL&&(this._currentCell=this._currentCell-1),this._allowStart=!0):this._currentCell=-1)):this._currentCell=-1}if(this._allowStart){if(this._target=f,this.gridInstance.pluginName=="ejGrid"&&this.gridInstance.model.allowResizing){if(this._triggerResizeEvents("resizeStart",i))return}else if(this.gridInstance.pluginName=="ejTreeGrid"&&this.gridInstance.model.allowColumnResize&&this.gridInstance._triggerColumnResize("columnResizeStart",i,t))return;return a=this,i+=document.documentElement.scrollLeft,t.button!=2&&this._start(i,e),!1}return!0}},_getCellIndex:function(t){var o=n(t._target),i=t._target,f=i.getBoundingClientRect(),e=navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollLeft:document.documentElement.scrollLeft,r,u;return this._orgX<f.left+5+e&&(i=n(i).prevAll(":visible:first")[0]),r=i.cellIndex,u=r,t.gridInstance.model.groupSettings.groupedColumns.length&&(u=r-t.gridInstance.model.groupSettings.groupedColumns.length),u},_reSize:function(i){var ii=this,o,k,rt,v,d,vt,s,ut,y,ft,g,p,ot,st,tt,r,at;if(this._initialTableWidth=this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns?this.gridInstance.getHeaderTable().first().parent().width()+this.gridInstance.getHeaderTable().last().parent().width():this.gridInstance.getHeaderTable().parent().width(),this.gridInstance.model.enableRTL&&(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)?this._currentCell=this._currentCell-1:this.gridInstance.model.enableRTL||this._getResizableCell(),k=this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns>0?this.gridInstance.getHeaderTable().find("thead"):n(this._target).parents("thead"),this._currentCell!=-1&&this._expand){this._expand=!1;var gt=n(this._target).hasClass("e-stackedHeaderCell")?k.find(".e-headercell:not(.e-detailheadercell)").filter(":visible"):k.find(".e-headercell:not(.e-detailheadercell,.e-stackedHeaderCell)").filter(":visible"),it=gt[this._currentCell],a=it.offsetWidth,u=i-this._orgX;if(this.gridInstance.model.enableRTL&&(u=-u),parseInt(u)+parseInt(a)>this._colMinWidth){if(u!=0&&k.css("cursor","default"),t.getObject("resizeSettings.resizeMode",this.gridInstance.model)=="nextcolumn"&&(rt=this.gridInstance.getHeaderTable().find("colgroup").find("col"),t.isNullOrUndefined(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)||(this.gridInstance._detailColsRefresh(),rt=this.gridInstance._$headerCols),v=rt.filter(this._diaplayFinder).eq(!this.gridInstance.model.allowGrouping||!t.isNullOrUndefined(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)?this._currentCell:this._currentCell+this.gridInstance.model.groupSettings.groupedColumns.length),d=parseInt(v[0].style.width)),this._resizeColumnUsingDiff(a,u),o=this.gridInstance.element.find(".e-gridcontent").first(),vt=o.find("div").hasClass("e-content"),s=!t.isIOSWebView()&&this.gridInstance.getBrowserDetails(),s&&s.browser=="msie"&&this.gridInstance.model.allowScrolling&&(ut=this.gridInstance.getContentTable().width(),y=this.gridInstance._calculateWidth(),this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns>0?this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterTable().last().width(y-this.gridInstance.getFooterContent().find(".e-frozenfootertdiv").width()):y>ut&&this.gridInstance.model.showSummary&&this.gridInstance.getFooterTable().width(y),parseInt(s.version,10)>8&&this.gridInstance.model.groupSettings&&this.gridInstance.model.groupSettings.groupedColumns.length&&(y>ut?this.gridInstance.getContentTable().children("colgroup").find("col").first().css("width",2e3/o.find("table").first().width()+"%"):(this.gridInstance.getContentTable().css("width","100%"),this.gridInstance._groupingAction(!0),this.gridInstance.getContentTable().children("colgroup").find("col").first().css("width",(this.gridInstance.getHeaderTable().find("colgroup").find("col").first().width()/o.find("table").first().width()*100).toFixed(2)+"%"))),this.gridInstance.getHeaderTable().parent().scrollLeft(o.find(".e-content").scrollLeft()-1)),this.gridInstance._colgroupRefresh(),this.gridInstance.model.allowTextWrap&&(this.gridInstance._isResized=!0,this.gridInstance.rowHeightRefresh()),this.gridInstance.model.groupSettings.groupedColumns.length&&!this.gridInstance.model.isEdit&&this.gridInstance._recalculateIndentWidth(),t.getObject("resizeSettings.resizeMode",this.gridInstance.model)!="normal")if(t.getObject("resizeSettings.resizeMode",this.gridInstance.model)=="nextcolumn"){ft=this.gridInstance.getHeaderTable().find("colgroup").find("col");g=this.gridInstance.getContentTable().find("colgroup").find("col");t.isNullOrUndefined(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)||(this.gridInstance._detailColsRefresh(),ft=this.gridInstance._$headerCols,g=this.gridInstance._$contentCols);var f=this._currentCell+1,yt=ft.filter(this._diaplayFinder).eq(!this.gridInstance.model.allowGrouping||!t.isNullOrUndefined(this.gridInstance.model.detailsTemplate)?f:f+this.gridInstance.model.groupSettings.groupedColumns.length),e=parseInt(yt[0].style.width)+(d-parseInt(v[0].style.width)),et;if(e<this._colMinWidth&&(e=this._colMinWidth),yt.width(e),this.gridInstance.model.groupSettings&&this.gridInstance.model.groupSettings.groupedColumns.length){var pt=this.gridInstance.getContentTable().find(".e-recordtable"),nt=pt.find("colgroup"),wt=this.gridInstance.getVisibleColumnNames().length;for(this.gridInstance.getContentTable().find(".e-detailrow").length&&(nt=nt.not(pt.find(".e-detailrow").find("colgroup")).get()),r=0;r<nt.length;r++)p=n(nt[r]).find("col").filter(this._diaplayFinder),p.length>wt&&p.splice(0,p.length-wt),n(p[f]).width(e)}if(this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns){if(f>=0&&f<this.gridInstance.model.scrollSettings.frozenColumns&&this._getFrozenResizeWidth()+u>this.gridInstance.element.find(".e-headercontent").first().width())return;et=g.filter(this._diaplayFinder).eq(f)}else et=g.filter(this._diaplayFinder).eq(!this.gridInstance.model.allowGrouping||!t.isNullOrUndefined(this.gridInstance.model.detailsTemplate)?f:f+this.gridInstance.model.groupSettings.groupedColumns.length);if(et.width(e),this.gridInstance._findColumnsWidth(),this.gridInstance.model.scrollSettings.frozenColumns>0&&n(it).is(":last-child")&&this.gridInstance.pluginName=="ejGrid"){var h=v.width()-d,c=this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width()+h,w=this.gridInstance.getHeaderContent().find(".e-movableheaderdiv").width()-h,l=parseInt(this.gridInstance.getHeaderContent().find(".e-movableheader")[0].style["margin-left"])+h;this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(c);this.gridInstance.getContent().find(".e-frozencontentdiv").width(c);this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterContent().find(".e-frozenfooterdiv").width(c);this.gridInstance.getHeaderContent().find(".e-movableheaderdiv").width(w);this.gridInstance.getContent().find(".e-movablecontentdiv").width(w);this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterContent().find(".e-movablefooterdiv").width(w);this.gridInstance.getHeaderContent().find(".e-movableheader").css("margin-left",l);this.gridInstance.getContent().find(".e-movablecontent").css("margin-left",l);this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterContent().find(".e-movablefooter").css("margin-left",l)}if(this.gridInstance.model.scrollSettings.frozenColumns>0&&n(it).is(":last-child")&&this.gridInstance.pluginName=="ejTreeGrid"){var h=v.width()-d,c=this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width()+h,w=this.gridInstance.getHeaderContent().find(".e-movableheaderdiv").width()-h,l=parseInt(this.gridInstance.getHeaderContent().find(".e-movableheader")[0].style["margin-left"])+h;this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(c);this.gridInstance.getHeaderContent().find(".e-movableheader").css("margin-left",l);this.gridInstance.getHeaderContent().find(".e-movableheaderdiv").width(w);this.gridInstance.getContent().find(".e-frozencontainer").width(c).next().css("margin-left",l+"px");this.gridInstance.getContent().find(".e-movablecontent").width(w);this.gridInstance.model.showTotalSummary&&(this.gridInstance._$totalSummaryRowContainer.find(".e-frozenfooterdiv").width(c),this.gridInstance._$totalSummaryRowContainer.find(".e-movablefooter").css("margin-left",l+"px"));this.gridInstance._renderScroller(!0)}this.gridInstance.model.scrollSettings.frozenColumns>0&&n(this._target).parent("tr").parents("div:first").hasClass("e-frozenheaderdiv")&&this.gridInstance.pluginName=="ejGrid"&&(this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(this._newWidth),this.gridInstance.getContent().find(".e-frozencontentdiv").width(this._newWidth),this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterContent().find(".e-frozenfooterdiv").width(this._newWidth))}else this.gridInstance.model.scrollSettings.frozenColumns||(ot=this.gridInstance.getHeaderTable().width(),this.gridInstance.pluginName=="ejTreeGrid"||this.gridInstance.model.allowScrolling||this.gridInstance.model.isResponsive?this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterTable())&&this.gridInstance.getFooterTable().css("width",ot+parseInt(u)):n("#"+this.gridInstance._id).css("width",ot+parseInt(u)),this.gridInstance.model.scrollSettings.width+=parseInt(u),this.gridInstance.getContent().width()>this.gridInstance.getContentTable().width()?(this.gridInstance.getContentTable().addClass("e-tableLastCell"),this.gridInstance.getHeaderTable().addClass("e-tableLastCell")):(this.gridInstance.getContentTable().removeClass("e-tableLastCell"),this.gridInstance.getHeaderTable().removeClass("e-tableLastCell")));if(s.browser=="msie"||!s||!this.gridInstance.model.allowScrolling||this.gridInstance.model.scrollSettings.frozenColumns!=0||(this.gridInstance.model.columnLayout!="fixed"&&(this.gridInstance.getHeaderTable().width("100%"),this.gridInstance.getContentTable().width("100%")),this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterTable())&&this.gridInstance.getFooterTable().width("100%"),st=this.gridInstance._calculateWidth(),(st<=this.gridInstance.getContentTable().width()||this.gridInstance.getHeaderTable().width()>this.gridInstance.getContentTable().width())&&this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterTable())&&this.gridInstance.getFooterTable().width(st)),this.gridInstance.model.allowResizing&&this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor")=="default"){var bt=this._currentCell,ht=n(this._target),kt=[],dt=[],e=a+u,ct={};if(this.gridInstance.model.showStackedHeader&&ht.hasClass("e-stackedHeaderCell")){var ni=ht.parent(".e-stackedHeaderRow").index(),ti=ht.text(),lt=this.gridInstance.model.stackedHeaderRows[ni].stackedHeaderColumns,b;for(r=0;r<lt.length;r++)lt[r].headerText==ti&&(b=lt[r].column);for(tt=b|[],t.isNullOrUndefined(b)||b instanceof Array||(tt=b.split(",")),r=0;r<tt.length;r++)at=this.gridInstance.getColumnIndexByField(tt[r]),kt.push(at),dt.push(this.gridInstance.model.columns[at]);ct={columnIndex:kt,column:dt,oldWidth:a,newWidth:e}}else ct={columnIndex:bt,column:this.gridInstance.model.columns[bt],oldWidth:a,newWidth:e};this.gridInstance._trigger("resized",ct)}this.gridInstance.model.allowScrolling&&(this.gridInstance.getScrollObject().refresh(this.gridInstance.model.scrollSettings.frozenColumns>0),this.gridInstance.model.isResponsive&&this.gridInstance.model.minWidth&&this.gridInstance.windowonresize(),!vt&&o.find("div").hasClass("e-content")&&this.gridInstance.refreshScrollerEvent(),this.gridInstance._isHscrollcss())}}this._target=null;this._$visualElement.remove();this._expand=!1;this._currentCell=-1;this._allowStart=!1},_getFrozenResizeWidth:function(){for(var t=this.gridInstance.getHeaderTable().find("colgroup").find("col").slice(0,this.gridInstance.model.scrollSettings?this.gridInstance.model.scrollSettings.frozenColumns:0),i=0,n=0;n<t.length;n++)t.eq(n).css("display")!="none"&&(i+=parseInt(t[n].style.width.replace("px","")));return i},_diaplayFinder:function(){return n(this).css("display")!="none"},_resizeColumnUsingDiff:function(i,r){var lt=this,v,g,r,h,y,a,p,o,w,b,nt,ct,tt,ft,f,c,it,et,ot,st,k,rt,u;this._currntCe=this._currentCell;this._widthchanges(i,r);var e=this._newWidth,l=this._extra,ht=this._$headerCols,ut=this._$ContentCols,d,s=this._$headerCol,at=this._$frozenCols,a;if((this.gridInstance.pluginName!="ejTreeGrid"||!(r>0)||t.isNullOrUndefined(this.gridInstance._currentCell)||this.gridInstance.model.columns[this.gridInstance._currentCell].isFrozen!=!0||(u=this.gridInstance._frozenWidth(),!(u>this.gridInstance._gridWidth-68)))&&e>0&&r!=0){if(e<this._colMinWidth&&(e=this._colMinWidth),t.getObject("resizeSettings.resizeMode",this.gridInstance.model)=="nextcolumn"&&(v=s.next(),g=this.gridInstance.model.scrollSettings.frozenColumns&&this._currentCell==this.gridInstance.model.scrollSettings.frozenColumns-1?!0:!1,g&&(v=ht.eq(this.gridInstance.model.scrollSettings.frozenColumns)),(g||!s.is(":last-child"))&&v.width()+(s.width()-e)<=this._colMinWidth&&(e=s.width()+(v.width()-this._colMinWidth))),r=e-i,this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns){if(this._currentCell>=0&&this._currentCell<this.gridInstance.model.scrollSettings.frozenColumns&&this._getFrozenResizeWidth()+r>this.gridInstance.element.find(".e-headercontent").first().width())return;d=ut.filter(this._diaplayFinder).eq(this._currentCell)}else d=ut.filter(this._diaplayFinder).eq(!this.gridInstance.model.allowGrouping||!t.isNullOrUndefined(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)?this._currentCell:this._currentCell+this.gridInstance.model.groupSettings.groupedColumns.length);if(n(this._target).parent("tr").hasClass("e-stackedHeaderRow")?this._resizeStackedHeaderColumn(n(this._target).parent("tr"),l,this._currntCe):s.outerWidth(e),this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterTable()))if(this._$footerCols=this.gridInstance.getFooterTable().find("colgroup").find("col"),h=this.gridInstance.model.columns.length,this._$footerCols.length>h&&this._$footerCols.splice(0,this._$footerCols.length-h),y=this._$footerCols,a=y.filter(this._diaplayFinder).eq(this._currentCell),n(this._target).parent("tr").hasClass("e-stackedHeaderRow"))for(f=0;f<this._changedcell.length;f++)a=y.filter(this._diaplayFinder).eq(f),u=parseInt(l)+parseInt(y[f].style.width),u<this._colMinWidth&&(u=this._colMinWidth),a.outerWidth(u);else a.outerWidth(e);if(n(this._target).parent("tr").hasClass("e-stackedHeaderRow")){if(this.gridInstance.model.groupSettings.groupedColumns.length)for(p=this.gridInstance.getContentTable().find(".e-recordtable"),o=p.find("colgroup"),f=0;f<this._changedcell.length;f++)for(w=this._changedcell[f],b=0;b<o.length;b++)nt=n(o[b]).children().filter(this._diaplayFinder),u=parseInt(l)+parseInt(nt[w].style.width),u<this._colMinWidth&&(u=this._colMinWidth),n(nt[w]).width(u);for(ct=this.gridInstance.getContentTable().find("colgroup").find("col").filter(this._diaplayFinder).length,f=0;f<this._changedcell.length;f++)tt=this.gridInstance.getContentTable().find("colgroup").find("col").filter(this._diaplayFinder)[this._changedcell[f]],u=parseInt(l)+parseInt(tt.style.width),u<this._colMinWidth&&(u=this._colMinWidth),n(tt).outerWidth(u),this.gridInstance.model.isEdit&&this.gridInstance.model.allowGrouping&&this.gridInstance.model.groupSettings.groupedColumns.length==0&&(ft=this.gridInstance.getContentTable().find(".gridform").find("colgroup col").filter(this._diaplayFinder)[this._changedcell[f]],n(ft).outerWidth(u))}else{if(this.gridInstance.model.groupSettings&&this.gridInstance.model.groupSettings.groupedColumns.length){var p=this.gridInstance.getContentTable().find(".e-recordtable"),o=p.find("colgroup"),w=this._currentCell,h=this.gridInstance.getVisibleColumnNames().length;for(this.gridInstance.getContentTable().find(".e-detailrow").length&&(o=o.not(p.find(".e-detailrow").find("colgroup")).get()),f=0;f<o.length;f++)c=n(o[f]).find("col").filter(this._diaplayFinder),c.length>h&&c.splice(0,c.length-h),n(c[w]).width(e)}d.outerWidth(e);this.gridInstance.model.isEdit&&(it=this.gridInstance.getContentTable().find(".e-editedrow,.e-addedrow"),et=it.find("table").find("colgroup col"),ot=it.hasClass("e-addedrow")&&this.gridInstance.model.groupSettings.groupedColumns.length?this._currentCell+this.gridInstance.model.groupSettings.groupedColumns.length-1:this._currentCell,st=et.filter(this._diaplayFinder).eq(ot),st.outerWidth(e))}if(this.gridInstance._findColumnsWidth(),this.gridInstance.model.scrollSettings&&this.gridInstance.model.scrollSettings.frozenColumns&&t.getObject("resizeSettings.resizeMode",this.gridInstance.model)!="nextcolumn"&&this.gridInstance.pluginName=="ejGrid"){for(k=this.gridInstance.getContentTable().find("colgroup").find("col").slice(0,this.gridInstance.model.scrollSettings.frozenColumns),u=0,f=0;f<k.length;f++)u+=k[f].style.display=="none"?0:parseInt(k[f].style.width.replace("px",""));this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(u);rt=this.gridInstance.model.enableRTL?"margin-right":"margin-left";this.gridInstance.getContent().find(".e-frozencontentdiv").width(u).next().css(rt,u+"px");this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(u).next().css(rt,u+"px");this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterContent().find(".e-frozenfooterdiv").width(u)}this.gridInstance.pluginName=="ejTreeGrid"&&(!t.isNullOrUndefined(this.gridInstance._currentCell)&&this.gridInstance.model.columns[this.gridInstance._currentCell].isFrozen==!0&&t.getObject("resizeSettings.resizeMode",this.gridInstance.model)!="nextcolumn"||!this.gridInstance._isFrozenStackedResize&&this.gridInstance._isStackedResize&&this.gridInstance._frozenColumnsLength>0)&&(u=this.gridInstance._frozenWidth(),this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(u),this.gridInstance.getContent().find(".e-frozencontainer").width(u).next().css("margin-left",u+"px"),this.gridInstance.getHeaderContent().find(".e-frozenheaderdiv").width(u).next().css("margin-left",u+"px"),this.gridInstance.model.showTotalSummary&&(this.gridInstance._$totalSummaryRowContainer.find(".e-frozenfooterdiv").width(u),this.gridInstance._$totalSummaryRowContainer.find(".e-movablefooter").css("margin-left",u+"px")),this.gridInstance._findColumnsWidth(),this.gridInstance._renderScroller(!0));this.gridInstance.getHeaderTable().find(".e-columnheader").hasClass("e-resizedragicon")||this.gridInstance.getHeaderTable().find(".e-columnheader").css("cursor","default")}},_resizeStackedHeaderColumn:function(t,i,r){var v,y,f,c,o;this._changedcell=[];var p=this.gridInstance.getHeaderContent().find(".e-headercell").not(".e-detailheadercell"),u=0,e=0,s=p[r],l=n(s).attr("colspan"),w=i/l,a=n(s).parent("tr"),b=a.next(),h=s.cellIndex;for(this.gridInstance.model.groupSettings.showGroupedColumn&&(e=this.gridInstance.model.groupSettings.groupedColumns.length,u+=e);h>e;)h--,v=n(a).children("th").not(".e-detailheadercell")[h],u+=parseInt(n(v).attr("colspan"));for(this._currentCell=u,y=u+parseInt(l),f=u;f<y;f++)c=this.gridInstance.getHeaderTable().find("col").filter(this._diaplayFinder)[f],this._changedcell.push(f-e),o=parseInt(i)+parseInt(c.style.width),o<this._colMinWidth&&(o=this._colMinWidth),n(c).outerWidth(o)},_triggerResizeEvents:function(i,r){var k=this.gridInstance.getHeaderTable().find(".e-columnheader"),d=k.find(".e-headercell").filter(":visible"),s=this._cellIndex,v,f=n(this._target),y=[],p=[],h,e,l,u,b,tt,a,o;if(i=="resizeStart"&&(this._orgX=r,s=this._cellIndex=this._getCellIndex(this,r)),this.gridInstance.model.enableRTL&&(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)?v=this._currentCell-1:(this.gridInstance.model.enableRTL||this._getResizableCell(),v=this._currentCell),h=d[v],e=h.offsetWidth,this.gridInstance.model.showStackedHeader&&f.hasClass("e-stackedHeaderCell")){var g=f.parent(".e-stackedHeaderRow").index(),nt=f.text(),w=this.gridInstance.model.stackedHeaderRows[g].stackedHeaderColumns,c;for(u=0;u<w.length;u++)w[u].headerText==nt&&(c=w[u].column);for(l=c|[],t.isNullOrUndefined(c)||c instanceof Array||(l=c.split(",")),u=0;u<l.length;u++)b=this.gridInstance.getColumnIndexByField(l[u]),y.push(b),p.push(this.gridInstance.model.columns[b])}return i=="resizeStart"?(o={},o=this.gridInstance.model.showStackedHeader&&f.hasClass("e-stackedHeaderCell")?{columnIndex:y,column:p,target:f,oldWidth:e}:{columnIndex:s,column:this.gridInstance.model.columns[s],target:n(h),oldWidth:e},this.gridInstance._trigger("resizeStart",o)):(tt=k.find(".e-headercell").not(".e-detailheadercell").filter(":visible"),a=r-this._orgX,this._widthchanges(e,a),this.gridInstance._colgroupRefresh(),o={},o=this.gridInstance.model.showStackedHeader&&f.hasClass("e-stackedHeaderCell")?{columnIndex:y,column:p,target:n(h),oldWidth:e,newWidth:this._newWidth,extra:a}:{columnIndex:s,column:this.gridInstance.model.columns[s],target:n(h),oldWidth:e,newWidth:this._newWidth,extra:a},this.gridInstance._trigger("resizeEnd",o))},_widthchanges:function(i,r){var u=this._$headerCols=this.gridInstance.getHeaderTable().find("colgroup").find("col"),s=this._$ContentCols=this.gridInstance.getContentTable().find("colgroup").find("col");t.isNullOrUndefined(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)||(this.gridInstance._detailColsRefresh(),u=this._$headerCols=this.gridInstance._$headerCols,s=this._$ContentCols=this.gridInstance._$contentCols);var h=this._$headerCol=u.filter(this._diaplayFinder).eq(!this.gridInstance.model.allowGrouping||!t.isNullOrUndefined(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)?this._currentCell:this._currentCell+this.gridInstance.model.groupSettings.groupedColumns.length),l=this._$frozenCols=u.slice(0,this.gridInstance.model.scrollSettings?this.gridInstance.model.scrollSettings.frozenColumns:0),f=h[0].style.width,e=f.indexOf("%")!=-1,o=!f||e?n(this._target).outerWidth():f,c=e?1:i/parseInt(o);this._extra=r/c;this._newWidth=parseInt(r)+parseInt(o)},_mouseUp:function(n){var i,r;if(this.gridInstance._resizeTimeOut&&(clearTimeout(this.gridInstance._resizeTimeOut),this.gridInstance._resizeTimeOut=0),this._expand){if(i=n.clientX,r=n.clientY,navigator.userAgent.indexOf("WebKit")!=-1&&(i=n.pageX,r=n.pageY),n.type=="touchend"&&(i=n.originalEvent.changedTouches[0].clientX,r=n.originalEvent.changedTouches[0].clientY),this.gridInstance.model.allowResizing&&(this.gridInstance.getHeaderTable().find(".e-columnheader").hasClass("e-resizedragicon")||n.type=="touchend")&&this._triggerResizeEvents("resizeEnd",i)){this.gridInstance.element.find(".e-reSizeColbg").remove();return}if(i+=document.documentElement.scrollLeft,this._reSize(i,r),!t.isNullOrUndefined(this._currntCe)&&this._currntCe>=0){var u=t.DataManager(this.gridInstance.model.columns).executeLocal((new t.Query).where("visible","equal",!0)),e=u[this._currntCe],f=this.gridInstance.model.columns.indexOf(e);u.length!=this.gridInstance.model.columns.length?this.gridInstance.model.columns[f].width=this.gridInstance.columnsWidthCollection[f]:this.gridInstance.model.columns[this._currntCe].width=this.gridInstance.columnsWidthCollection[this._currntCe]}}},_getResizableCell:function(){var r,u=this.gridInstance.model.scrollSettings.frozenColumns,f,o,s,h,i,t,e,c;if(r=n(this._target).hasClass("e-stackedHeaderCell")?this.gridInstance.getHeaderTable().find(".e-columnheader"):this.gridInstance.getHeaderTable().find(".e-columnheader").not(".e-stackedHeaderRow"),i=r.find(".e-headercell").not(".e-hide,.e-detailheadercell"),f=navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollLeft:document.documentElement.scrollLeft,u&&this._currentCell!=-1&&this._currentCell==u-1&&(o=i[this._currentCell].getBoundingClientRect().left+f+5,s=o>this._orgX?!0:!1),!u||this._currentCell!=u-1||s)for(h=n(this._target).closest(".e-columnheader").index(),r=n(this._target).hasClass("e-stackedHeaderCell")?r[h]:r,i=n(r).find(".e-headercell").not(".e-hide,.e-detailheadercell"),t=0;t<i.length;t++){if(e=i[t].getBoundingClientRect(),c=e.left+f+5,c>this._orgX&&i[t].offsetHeight+e.top>=this._orgY){this._currentCell=t-1;return}if(t==i.length-1||this.gridInstance.model.showStackedHeader&&n(this._target).get(0)===i[t]){this._currentCell=t;return}}},_moveVisual:function(n){var t=this.gridInstance.getHeaderContent().find("div").first()[0].getBoundingClientRect();t.left+document.documentElement.scrollLeft+t.width<n||n<t.left+document.documentElement.scrollLeft?this._$visualElement.remove():this._currentCell!=-1&&this._$visualElement.css({left:n,top:this._tableY})},_mouseDown:function(t){var i,r,u;return this._allowStart&&n(t.target).closest("tr").hasClass("e-resizedragicon")?(this._target=t.target,i=t.clientX,r=t.clientY,navigator.userAgent.indexOf("WebKit")!=-1&&(i=t.pageX,r=t.pageY-(window.pageYOffset||document.body.scrollTop||0)),this.gridInstance.model.allowResizing&&this.gridInstance.getHeaderTable().find(".e-columnheader").hasClass("e-resizedragicon")&&(n(t.target).is(".e-headercelldiv")&&(t.target=t.target.parentNode),this._target=t.target,this._triggerResizeEvents("resizeStart",i)))?void 0:(u=this,i+=document.documentElement.scrollLeft,t.button!=2&&this._start(i,r),!1):!0},_columnResizeToFit:function(i){var pt=this.gridInstance.getHeaderTable().find(".e-columnheader").filter(function(){return n(this).css("cursor")=="col-resize"}),at,tt,e,h,b,v,et,vt,yt,ot,ht,k,st,ct,r;if(this.gridInstance.model.allowResizeToFit&&pt.length){n(i.target).is(".e-headercelldiv")&&(i.target=i.target.parentNode);var y=n(i.target),c,f=0,o=0;if(c=y.hasClass("e-stackedHeaderCell")?this.gridInstance.getHeaderContent().find(".e-headercell").not(".e-detailheadercell"):this.gridInstance.getHeaderContent().find(".e-headercell").not(".e-stackedHeaderCell,.e-detailheadercell"),this._target=y,y.hasClass("e-headercell")){var d=i.target,p=n.inArray(d,c),w=p;this._orgX=i.pageX;this.gridInstance.model.enableRTL?this._currentCell=p:this._getResizableCell();p!=this._currentCell&&(p=w=this._currentCell,d=i.target.previousSibling);var l=c.filter(":visible")[w],s=[],a=[],g=[];if(o=this.gridInstance.model.groupSettings.groupedColumns.length,t.isNullOrUndefined(this.gridInstance.model.detailsTemplate)&&t.isNullOrUndefined(this.gridInstance.model.childGrid)||(o+=1),n(d).parent("tr").hasClass("e-stackedHeaderRow")){for(var wt=n(l).attr("colspan"),lt=n(l).parent("tr"),nt=l.cellIndex,bt=lt.next();nt>o;)nt--,at=n(lt).children("th")[nt],f+=parseInt(n(at).attr("colspan"));tt=f+parseInt(wt)}else f=w,tt=w+1;var u=0,it=0,rt=0,ut=[],ft=[];if(f!=-1)for(e=c.slice(0,f+1).filter(".e-hide").length,h={columnIndex:f+e,column:this.gridInstance.model.columns[f+e],target:y,oldWidth:v},this.gridInstance._trigger("resizeStart",h),r=f;r<tt;r++){if(e=c.slice(0,r+1).filter(".e-hide").length,rt=this._getContentWidth(r+e),b=this.gridInstance.getHeaderTable().find(".e-headercell:not(.e-hide, .e-stackedHeaderCell)").children(".e-headercelldiv").eq(r),it=this._getHeaderContentWidth(b),u=it>rt?it:rt,u+=parseInt((b.css("padding-left"),10)+(b.css("padding-right"),10)),v=this.gridInstance.getHeaderTable().find("col").filter(this._diaplayFinder).eq(r+o).width(),u=v>u?u:this._colMinWidth<u?u:this._colMinWidth,et=this.gridInstance.getHeaderTable().find("col").filter(this._diaplayFinder),(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)&&et.splice(0,1),et.eq(r+o).width(u),this.gridInstance.model.groupSettings.groupedColumns.length&&(vt=this.gridInstance.getContentTable().find(".e-recordtable").find("colgroup"),yt=this,n.each(vt,function(t,i){n(i).find("col").filter(yt._diaplayFinder).eq(r).width(u)})),ot=this.gridInstance.getContentTable().find("col").filter(this._diaplayFinder),(this.gridInstance.model.detailsTemplate||this.gridInstance.model.childGrid)&&ot.splice(0,1),ot.eq(r+o).width(u),this.gridInstance.model.isEdit)for(st=this.gridInstance.getContentTable().find(".e-editedrow").find("col"),ht=this.gridInstance.element.find(".gridform"),k=0;k<ht.length;k++)st=n(ht[k]).find("col"),st.eq(r+o).width(u);ut.push(this.gridInstance.model.columns[r+e]);ft.push(Math.abs(u-v));s.push(r+e);a.push(u);g.push(v);(this.gridInstance.model.scrollSettings.frozenColumns>0||this.gridInstance.model.groupSettings.groupedColumns.length&&this.gridInstance.model.isEdit)&&(ct=r+e,this.gridInstance.columnsWidthCollection[ct]=u,this.gridInstance.setWidthToColumns(),this.gridInstance.model.scrollSettings.frozenColumns<=ct+1&&(this.gridInstance.getHeaderContent().find(".e-movableheader").css("margin-left",u),this.gridInstance.getContent().find(".e-movablecontent").css("margin-left",u),this.gridInstance.model.showSummary&&!t.isNullOrUndefined(this.gridInstance.getFooterContent())&&this.gridInstance.getFooterContent().find(".e-movablefooter").css("margin-left",u)))}for(this.gridInstance._colgroupRefresh(),this.gridInstance._recalculateIndentWidth(),h={columnIndex:s,column:ut,target:l,oldWidth:g,newWidth:a,extra:ft},this.gridInstance._trigger("resizeEnd",h),r=0;r<s.length;r++)this.gridInstance.columnsWidthCollection[s[r]]=a[r],this.gridInstance.model.columns[s[r]].width=a[r];h={columnIndex:s,column:ut,target:l,oldWidth:g,newWidth:a,extra:ft};this.gridInstance._trigger("resized",h);this.gridInstance.model.summaryRows.length>0&&this.gridInstance._summaryColRrefresh();this.gridInstance._findColumnsWidth()}}},_getContentWidth:function(i){var e=0,u=t.buildTag("span",{},{}),r=this.gridInstance,o,f;return t.isNullOrUndefined(r._gridRows)||(f=r._gridRows,r.model.scrollSettings.frozenColumns&&r.model.currentViewData.length&&i>=r.model.scrollSettings.frozenColumns&&(f=f[1],i=i-r.model.scrollSettings.frozenColumns),n.each(f,function(t,f){if(n(f).is(".e-row,.e-alt_row")&&!n(f).is(".e-editedrow")){var s=n(f).find("td.e-rowcell").eq(i),h=n(s).html();r.model.columns[i].commands?u.html(n(h).children()):s.hasClass("e-validError")?u.html(n(h).attr("value")):u.html(h);n(s).html(u);o=s.find("span:first").width()>0?s.find("span:first").width()+parseFloat(s.css("padding-left"))+parseFloat(s.css("padding-right")):s.find("span:first").width();o>e&&(e=o);n(s).html(h)}})),r._refreshUnboundTemplate(this.gridInstance.getContentTable()),e},_getHeaderContentWidth:function(n){var i=0,u=t.buildTag("span",{},{}),e=this.gridInstance.getBrowserDetails().browser=="msie",f,r;return e&&u.css("position","absolute"),f=n.html(),u.html(f),n.html(u),i=n.find("span:first").width()+parseFloat(n.css("padding-left"))+parseFloat(n.css("padding-right")),e&&(i+=2),this.gridInstance.model.allowFiltering&&(this.gridInstance.model.filterSettings.filterType=="menu"||this.gridInstance.model.filterSettings.filterType=="excel")&&(r=n.parent().find(".e-filtericon"),i=i+r.width()+10,r.length&&(i+=parseFloat(r.css("margin-left")))),n.html(f),i}}}(jQuery,Syncfusion)});
