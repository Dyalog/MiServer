/*!
*  filename: ej.diagram.min.js
*  version : 17.4.0.39
*  Copyright Syncfusion Inc. 2001 - 2019. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","jsrender","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./../web/ej.menu.min"],n):n()})(function(){var LoadingPriority,RoutingPriority,SegmentOrientation,ObstacleSideType,PortDirection,Orientation,ScanDirection,RoutingSolution,Directions;(function($,ej,undefined){"use strict";ej.widget("ejDiagram","ej.datavisualization.Diagram",{element:null,model:null,_requiresID:!0,validTags:["div"],defaults:{width:"",height:"",nodes:[],connectors:[],labelRenderingMode:"html",defaultSettings:{connector:null,node:null,group:null},nodeTemplate:null,connectorTemplate:null,dataSourceSettings:{dataSource:null,query:null,tableName:null,id:"",parent:"",nodes:null,connectors:null,root:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[],connectionDataSource:{dataSource:null,id:"",sourceNode:"",targetNode:"",sourcePointX:"",sourcePointY:"",targetPointX:"",targetPointY:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[]}},serializationSettings:{preventDefaultValues:!1},rulerSettings:{showRulers:!1,horizontalRuler:{interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25},verticalRuler:{interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25}},snapSettings:{horizontalGridLines:{linesInterval:null,snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},verticalGridLines:{linesInterval:null,snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},snapConstraints:15,enableSnapToObject:!0,snapAngle:5,snapObjectDistance:5},scrollSettings:{horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,minZoom:.25,maxZoom:30,zoomFactor:.2,padding:{left:0,right:0,top:0,bottom:0}},pageSettings:{pageWidth:null,pageHeight:null,multiplePage:!1,pageBorderWidth:0,pageBackgroundColor:"#ffffff",pageBorderColor:"#565656",pageMargin:24,showPageBreak:!1,pageOrientation:"portrait",scrollLimit:"diagram",scrollableArea:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},autoScrollBorder:{left:15,top:15,right:15,bottom:15},boundaryConstraints:"infinity"},locale:"en-US",contextMenu:{items:[],showCustomMenuItemsOnly:!1},enableContextMenu:!0,enableAutoScroll:!0,tooltip:{templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5}},showTooltip:!0,layout:{avoidSegmentOverlapping:!1,bounds:null,type:"none",horizontalAlignment:"center",verticalAlignment:"top",orientation:"toptobottom",horizontalSpacing:30,verticalSpacing:30,margin:{left:0,right:0,top:0,bottom:0},marginX:0,marginY:0,fixedNode:"",getLayoutInfo:null,getConnectorSegments:null,root:"",springLength:100,springFactor:.442,maxIteration:1e3},drawingTools:{},backgroundImage:{source:"",scale:"meet",alignment:"xmidymid"},backgroundColor:"transparent",bridgeDirection:"top",version:"13.1",constraints:502,tool:null,drawType:{},selectedItems:{offsetX:0,offsetY:0,width:0,height:0,rotateAngle:0,children:[],constraints:30,userHandles:[],tooltip:{templateId:"",alignment:{horizontal:"center",vertical:"bottom"},margin:{top:10}},getConstraints:null},commandManager:{commands:{}},historyManager:{push:null,pop:null,canPop:null,canLog:null,undo:null,redo:null,startGroupAction:null,closeGroupAction:null,stackLimit:null,undoStack:[],redoStack:[]},layers:[],connectorType:"straightLine",editorFocusChange:null,nodeCollectionChange:null,templateNodeRendering:null,historyChange:null,autoScrollChange:null,itemClick:null,connectorCollectionChange:null,selectionChange:null,mouseLeave:null,mouseEnter:null,mouseOver:null,click:null,doubleClick:null,dragEnter:null,dragOver:null,dragLeave:null,drop:null,drag:null,textChange:null,sizeChange:null,connectionChange:null,rotationChange:null,contextMenuClick:null,contextMenuBeforeOpen:null,contextMenuClose:null,connectorSourceChange:null,connectorTargetChange:null,scrollChange:null,segmentChange:null,propertyChange:null,groupChange:null,create:null,destroy:null},observables:["nodes","connectors","locale","enableContextMenu","backgroundColor","backgroundImage","enableAutoScroll","showTooltip","bridgeDirection","tool","pageSettings.pageHeight","pageSettings.pageWidth","pageSettings.multiplePage","pageSettings.pageBorderWidth","pageSettings.pageBackgroundColor","pageSettings.pageBorderColor","pageSettings.pageMargin","pageSettings.showPageBreak","pageSettings.pageOrientation","pageSettings.scrollLimit","snapSettings.enableSnapToObject","snapSettings.snapAngle","snapSettings.snapObjectDistance","snapSettings.snapConstraints","dataSourceSettings.id","dataSourceSettings.parent","dataSourceSettings.root","dataSourceSettings.dataSource","dataSourceSettings.tableName","dataSourceSettings.query","layout.type","layout.orientation","layout.horizontalSpacing","layout.avoidSegmentOverlapping ","layout.verticalSpacing","layout.marginX","layout.marginY","layout.fixedNode","selectedItems.offsetX","selectedItems.offsetY","selectedItems.width","selectedItems.height","selectedItems.rotateAngle","scrollSettings.horizontalOffset","scrollSettings.verticalOffset","scrollSettings.zoomFactor","tooltip.templateId","tooltip.relativeMode","tooltip.alignment.horizontal","tooltip.alignment.vertical","contextMenu.items","contextMenu.showCustomMenuItemsOnly"],nodes:ej.util.valueFunction("nodes"),connectors:ej.util.valueFunction("connectors"),locale:ej.util.valueFunction("locale"),enableContextMenu:ej.util.valueFunction("enableContextMenu"),enableAutoScroll:ej.util.valueFunction("enableAutoScroll"),showTooltip:ej.util.valueFunction("showTooltip"),bridgeDirection:ej.util.valueFunction("bridgeDirection"),tool:ej.util.valueFunction("tool"),_backgroundColor:ej.util.valueFunction("backgroundColor"),_backgroundImage:ej.util.valueFunction("backgroundImage"),_pageHeight:ej.util.valueFunction("pageSettings.pageHeight"),_pageWidth:ej.util.valueFunction("pageSettings.pageWidth"),_multiplePage:ej.util.valueFunction("pageSettings.multiplePage"),_pageBorderWidth:ej.util.valueFunction("pageSettings.pageBorderWidth"),_pageBackgroundColor:ej.util.valueFunction("pageSettings.pageBackgroundColor"),_pageBorderColor:ej.util.valueFunction("pageSettings.pageBorderColor"),_pageMargin:ej.util.valueFunction("pageSettings.pageMargin"),_showPageBreak:ej.util.valueFunction("pageSettings.showPageBreak"),_pageOrientation:ej.util.valueFunction("pageSettings.pageOrientation"),_scrollLimit:ej.util.valueFunction("pageSettings.scrollLimit"),_enableSnapToObject:ej.util.valueFunction("snapSettings.enableSnapToObject"),_snapConstraints:ej.util.valueFunction("snapSettings.snapConstraints"),_snapAngle:ej.util.valueFunction("snapSettings.snapAngle"),_snapObjectDistance:ej.util.valueFunction("snapSettings.snapObjectDistance"),_selectorOffsetX:ej.util.valueFunction("selectedItems.offsetX"),_selectorOffsetY:ej.util.valueFunction("selectedItems.offsetY"),_selectorWidth:ej.util.valueFunction("selectedItems.width"),_selectorHeight:ej.util.valueFunction("selectedItems.height"),_selectorRotateAngle:ej.util.valueFunction("selectedItems.rotateAngle"),_horizontalOffset:ej.util.valueFunction("scrollSettings.horizontalOffset"),_verticalOffset:ej.util.valueFunction("scrollSettings.verticalOffset"),zoomFactor:ej.util.valueFunction("scrollSettings.zoomFactor"),_layoutType:ej.util.valueFunction("layout.type"),_layoutOrientation:ej.util.valueFunction("layout.orientation"),_horizontalSpacing:ej.util.valueFunction("layout.horizontalSpacing"),_avoidSegmentOverlapping:ej.util.valueFunction("layout.avoidSegmentOverlapping "),_verticalSpacing:ej.util.valueFunction("layout.verticalSpacing"),_layoutMarginX:ej.util.valueFunction("layout.marginX"),_layoutMarginY:ej.util.valueFunction("layout.marginY"),_fixedNode:ej.util.valueFunction("layout.fixedNode"),_dataSourceUniqueId:ej.util.valueFunction("dataSourceSettings.id"),_dataSourceParentId:ej.util.valueFunction("dataSourceSettings.parent"),_dataSource:ej.util.valueFunction("dataSourceSettings.dataSource"),_dataSourceTableName:ej.util.valueFunction("dataSourceSettings.tableName"),_dataSourceQueryString:ej.util.valueFunction("dataSourceSettings.query"),_dataSourceRoot:ej.util.valueFunction("dataSourceSettings.root"),_tooltipTemplateId:ej.util.valueFunction("tooltip.templateId"),_horizontalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.horizontal"),_verticalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.vertical"),_tooltipMode:ej.util.valueFunction("tooltip.relativeMode"),_showCustomContextMenuItems:ej.util.valueFunction("contextMenu.showCustomMenuItemsOnly"),_contextMenuItems:ej.util.valueFunction("contextMenu.items"),dataTypes:{nodes:"data",connectors:"data",contextMenu:{items:"array"},dataSourceSettings:{dataSource:"data"},defaultSettings:{connector:{segments:"data",labels:"data"},node:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"},group:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"}},snapSettings:{horizontalGridLines:{linesInterval:"data",snapInterval:"data"},verticalGridLines:{linesInterval:"data",snapInterval:"data"}},selectedItems:{children:"data",userHandles:"data"}},_doubleClickEvent:!1,_nodes:[],_connectors:[],_canvas:null,_svg:null,_toolToActivate:null,_inAction:!1,_isPinching:!1,_isEditing:!1,_nodeToHit:null,_enableAPIMethods:!0,_currentCursor:null,_pasteIndex:null,_page:null,_view:null,_currentLabel:null,_zOrder:0,_clipboardData:null,_currZoom:1,_UndoRedo:!1,_mouseEventTriggered:!1,_selectedItem:"",_historyList:{currentEntry:{next:null,previous:null},canUndo:!1,canRedo:!1},_historyCount:0,_lastbefore:null,_defaultContextMenuItems:[{name:"cut",text:"Cut"},{name:"copy",text:"Copy"},{name:"paste",text:"Paste"},{name:"undo",text:"Undo"},{name:"redo",text:"Redo"},{name:"selectAll",text:"Select All"},{name:"grouping",text:"Grouping",subItems:[{name:"group",text:"Group"},{name:"ungroup",text:"Ungroup"}]},{name:"order",text:"Order",subItems:[{name:"bringToFront",text:"Bring To Front"},{name:"moveForward",text:"Move Forward"},{name:"sendToBack",text:"Send To Back"},{name:"sendBackward",text:"Send Backward"}]}],_hScrollOffset:0,_vScrollOffset:0,_hScrollbar:null,_vScrollbar:null,_scrollPixel:30,_previousSelectedItems:[],_eventCause:{},_crudDeleteNodes:[],_isMobile:!1,_labelHashTable:{},activeTool:null,selectionList:[],tools:null,nameTable:{},boundaryTable:{},_init:function(){var i,r,u,n,f,t;this.boundaryTable={};this.nameTable={};this.selectionList=[];this._isInit=!0;this.nameTable={};this.boundaryTable={};i=window.SVGSVGElement?!0:!1;i&&(this.model.version==="NewVersion"&&(this.model.version=ej.version),this.model.height||(this.model.height="18px"),ej.widget.unobtrusive!==undefined&&(this.model.snapSettings.horizontalGridLines&&this.model.snapSettings.horizontalGridLines.linesInterval&&typeof this.model.snapSettings.horizontalGridLines.linesInterval=="string"&&(this.model.snapSettings.horizontalGridLines.linesInterval=JSON.parse(this.model.snapSettings.horizontalGridLines.linesInterval)),this.model.snapSettings.verticalGridLines&&this.model.snapSettings.verticalGridLines.linesInterval&&typeof this.model.snapSettings.verticalGridLines.linesInterval=="string"&&(this.model.snapSettings.verticalGridLines.linesInterval=JSON.parse(this.model.snapSettings.verticalGridLines.linesInterval)),this.model.defaultSettings.connector&&(r=ej.datavisualization.Diagram.Connector({}),this.model.defaultSettings.connector=this._equivalentPropMap(r,this.model.defaultSettings.connector)),this.model.defaultSettings.node&&(u=ej.datavisualization.Diagram.Node({}),this.model.defaultSettings.node=this._equivalentPropMap(u,this.model.defaultSettings.node))),this.model.snapSettings.horizontalGridLines&&this.model.snapSettings.horizontalGridLines.linesInterval==null&&(this.model.snapSettings.horizontalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75]),this.model.snapSettings.verticalGridLines&&this.model.snapSettings.verticalGridLines.linesInterval==null&&(this.model.snapSettings.verticalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75]),n=this,n.model.dataSourceSettings.crudAction.read&&(f=$.ajax({type:"GET",url:n.model.dataSourceSettings.crudAction.read,async:!1,success:function(t){n.model.dataSourceSettings.dataSource=t},error:function(){}}),this._isWebAPI=!0),n.model.dataSourceSettings.connectionDataSource.crudAction.read&&(f=$.ajax({type:"GET",url:n.model.dataSourceSettings.connectionDataSource.crudAction.read,async:!1,success:function(t){n.model.dataSourceSettings.connectionDataSource.dataSource=t},error:function(){}}),this._isWebAPI=!0),this.model.backgroundImage&&(typeof this.model.backgroundImage=="string"&&(t=this.model.backgroundImage),typeof this.model.backgroundImage=="function"&&(t=this.model.backgroundImage()),t&&(this.model.backgroundImage=ej.datavisualization.Diagram.BackgroundImage({source:t}))),this._layoutMarginX()&&(this.model.layout.margin.left=this.model.layout.margin.right=this._layoutMarginX()),this._layoutMarginY()&&(this.model.layout.margin.top=this.model.layout.margin.bottom=this._layoutMarginY()),this._cloneGlobalVariables(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this),this._initDefaults(),this._initViews(),this._initLineRouting(),this._initData(),this._initCanvas(),this._initDiagramTool(),this._initVisualGuide(),this._wireEvents(),this._initHandles(),this._initContextMenu(),this._drawingTool=!1,this._isDropped=!1,this._initCommands(),this._initHistoryManager(),this.model.zoomFactor&&this.model.zoomFactor!==.2&&(this.model.scrollSettings.zoomFactor=this.model.zoomFactor),this._updateScrollSettings(this.model.scrollSettings),delete this._viewPort,this._cloneModel=$.extend(!0,{},this.model));delete this._isInit},_initLineRouting:function(){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&(this.lineRouting=new LineRouting,this.lineRouting.firstLoad=!0,this.lineRouting.Init(this.model),this.lineRouting.SetLineRoutingSettings())},_resetConnectorPoints:function(n,t){var h,r,e,f,o,s,i,u;if(n._undoSegments||n._redoSegments)u=n._undoSegments?n._undoSegments:n._redoSegments,this.updateConnector(n.name,{segments:u});else if(n._points&&n._points.size()>0){for(i=t.nameTable[n.name],this._isUndo||this.activeTool.name!="move"&&this.activeTool.name!=="resize"&&this.activateTool.name!=="rotatetool"||(this.tools[this.activeTool.name].undoObject.connectors[i.name]={name:i.name,segments:i.segments}),i.segments=[],i.sourcePoint=n._points.get(0),i.targetPoint=n._points.get(n._points.size()-1),i._sourcePortLocation=$.extend(!0,{},n._points.get(0)),i._targetPortLocation=$.extend(!0,{},n._points.get(n._points.size()-1)),h=[],u=[],r=0;r<n._points.size()-1;r++){if(e=n._points.get(r),f=n._points.get(r+1),e.x==f.x&&e.y==f.y){if(n._points.RemoveAt(r+1),r+1==n._points.size())break;f=n._points.get(r+1)}o=Point.findLength(e,f);s=ej.datavisualization.Diagram.Util._getBezierDirection(e,f);u.push({length:o,direction:s,type:"orthogonal"})}this.updateConnector(i.name,{segments:u});this._isUndo||this.activeTool.name!="move"&&this.activeTool.name!=="resize"&&this.activateTool.name!=="rotate"||(this.tools[this.activeTool.name]._redoConnectors[i.name]={name:i.name,segments:i.segments});delete i._sourcePortLocation;delete i._targetPortLocation}else i=t.nameTable[n.name],i.segments=[],u=[{type:"orthogonal"}],this.updateConnector(i.name,{segments:u})},_equivalentPropMap:function(n,t){var u={},r;for(var i in n)r=i.toLowerCase(),ej.isPlainObject(t[r])||ej.isPlainObject(t[i])?u[i]=this._equivalentPropMap(n[i],t[r]?t[r]:t[i]):(t[r]||t[i])&&(u[i]=t[r]?t[r]:t[i]);return u},getDiagramBounds:function(){var n=this._getDigramBounds();return n.width=n.width>this.model.scrollSettings.viewPortWidth?n.width+(n.x>0?n.x:0):this.model.scrollSettings.viewPortWidth,n.height=n.height>this.model.scrollSettings.viewPortHeight?n.height+(n.y>0?n.y:0):this.model.scrollSettings.viewPortHeight,n.x=n.x>0?0:n.x,n.y=n.y>0?0:n.y,n},getDiagramContent:function(n){var t={},o,s,h,r,e,a,f;t={top:isNaN(t.top)?0:t.top,bottom:isNaN(t.bottom)?0:t.bottom,left:isNaN(t.left)?0:t.left,right:isNaN(t.right)?0:t.right};var i=this._currZoom,v=this._hScrollOffset,y=this._vScrollOffset,c,l,p=0,w=0,b=this.model.width,k=this.model.height,u=this.getDiagramBounds();for(this._hScrollbar&&this._hScrollbar._scrollData&&(p=this._hScrollbar.model.minimum/i),this._vScrollbar&&this._vScrollbar._scrollData&&(w=this._vScrollbar.model.minimum/i),this._preventZoomEvent=!0,this._currZoom!==1&&(f=new ej.datavisualization.Diagram.Zoom,f.zoomFactor=1/i-1,this.zoomTo(f)),o={},u.x!==this._hScrollOffset/i&&(o.horizontalOffset=u.x),u.y!==this._vScrollOffset/i&&(o.verticalOffset=u.y),Object.keys(o).length>0&&this.update({scrollSettings:o}),$("#"+this.element[0].id).ejDiagram({width:u.width+"px",height:u.height+"px"}),c=this._hScrollbar.element[0].style.visibility,this._hScrollbar.element[0].style.visibility="hidden",l=this._vScrollbar.element[0].style.visibility,this._vScrollbar.element[0].style.visibility="hidden",s=this.model.snapSettings.snapConstraints&ej.datavisualization.Diagram.SnapConstraints.ShowLines,s&&$("#"+this.element[0].id).ejDiagram({snapSettings:{snapConstraints:this.model.snapSettings.snapConstraints&~ej.datavisualization.Diagram.SnapConstraints.ShowLines}}),this._clearSelection(!0),n=n||document.styleSheets,h="",r=0;r<n.length;r++)(n[r].href||typeof n[r]=="string")&&(h+='<link href="'+(n[r].href||n[r])+'" rel="stylesheet" />');return e=$(this.element).html(),a="margin-left:"+t.left+"px;margin-top:"+t.top+"px;margin-right:"+t.right+"px;margin-bottom:"+t.bottom+"px;",e=h+"<body style='margin:0px;padding:0px'><div style=\""+a+'">'+e+"<\/div><\/body>",e=e.replace(/ transform: t/g," -webkit-transform: t"),$("#"+this.element[0].id).ejDiagram({width:b,height:k}),i&&(f=new ej.datavisualization.Diagram.Zoom,f.zoomFactor=i/this._currZoom-1,this.zoomTo(f)),this.update({scrollSettings:{horizontalOffset:v,verticalOffset:y}}),delete this._preventZoomEvent,this._hScrollbar&&(this._hScrollbar.element[0].style.visibility=c),this._vScrollbar&&(this._vScrollbar.element[0].style.visibility=l),s&&$("#"+this.element[0].id).ejDiagram({snapSettings:{snapConstraints:this.model.snapSettings.snapConstraints|ej.datavisualization.Diagram.SnapConstraints.ShowLines}}),e},refresh:function(){var t,n;if(this._updateTableNodes(),this._updateGroupChildren(this.model),this._isSwimlaneExist){for(t=this.connectors(),n=0;n<t.length;n++)t[n].zOrder=-1;delete this._isSwimlaneExist}this._updateScrollOffset(0,0);this._destroy();this.element.addClass("e-datavisualization-diagram");this._currZoom=1;this._hScrollbar=null;this._vScrollbar=null;this._view=null;this._svg=null;this._page=null;this._pageBackgroundLayer=null;this._diagramLayer=null;this._htmlLayer=null;this.clearHistory();this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this);this.model.dataSourceSettings&&this.model.dataSourceSettings.dataSource&&(this.nodes([]),this.connectors([]),this._nodes=[],this._connectors=[]);this._init()},_initCommands:function(n){var u=ej.datavisualization.Diagram.KeyModifiers,i=ej.datavisualization.Diagram.Keys,r,f,t,e;if(n)r=this.model.commandManager.commands;else{n=this.model.commandManager.commands;r={copy:{gesture:{key:i.C,keyModifiers:u.Control},_isDefault:!0},paste:{gesture:{key:i.V,keyModifiers:u.Control},_isDefault:!0},cut:{gesture:{key:i.X,keyModifiers:u.Control},_isDefault:!0},"delete":{gesture:{key:i.Delete},_isDefault:!0},undo:{gesture:{key:i.Z,keyModifiers:u.Control},_isDefault:!0},redo:{gesture:{key:i.Y,keyModifiers:u.Control},_isDefault:!0},selectAll:{gesture:{key:i.A,keyModifiers:u.Control},_isDefault:!0},nudgeUp:{parameter:"up",gesture:{key:i.Up},_isDefault:!0},nudgeRight:{parameter:"right",gesture:{key:i.Right},_isDefault:!0},nudgeDown:{parameter:"down",gesture:{key:i.Down},_isDefault:!0},nudgeLeft:{parameter:"left",gesture:{key:i.Left},_isDefault:!0},startEdit:{gesture:{key:113},_isDefault:!0},endEdit:{gesture:{key:i.Escape},_isDefault:!0},focusToNextItem:{gesture:{key:i.Tab},_isDefault:!0},focusToPreviousItem:{gesture:{key:i.Tab,keyModifiers:u.Control},_isDefault:!0},selectFocusedItem:{gesture:{key:i.Enter},_isDefault:!0}};for(f in r)this._initCommandValues(f,r[f])}for(t in n)r[t]?n[t]?(n[t]&&r[t].gesture&&n[t].gesture&&(this._isLoad||r[t]._isDefault&&delete r[t]._isDefault,n[t].gesture=ej.datavisualization.Diagram.Gesture($.extend({},!0,r[t].gesture,n[t].gesture)),this._tempCommandManager&&this._tempCommandManager.commands&&this._tempCommandManager.commands[t]._isDefault&&this._initCommandValues(t,n[t])),$.extend(r[t],!0,n[t])):r[t]=null:n[t]&&(e=ej.datavisualization.Diagram.Command(n[t]),r[t]=e);this.model.commandManager.commands=r},_initCommandValues:function(n,t){switch(n){case"copy":t.execute=$.proxy(this.copy,this);t.canExecute=$.proxy(this._canExecute,this);break;case"paste":t.execute=$.proxy(this._commandPaste,this);t.canExecute=$.proxy(this._canExecute,this);break;case"cut":t.execute=$.proxy(this.cut,this);t.canExecute=$.proxy(this._canExecute,this);break;case"delete":t.execute=$.proxy(this.remove,this);t.canExecute=$.proxy(this._canExecute,this);break;case"undo":t.execute=$.proxy(this.undo,this);t.canExecute=$.proxy(this._canExecute,this);break;case"redo":t.execute=$.proxy(this.redo,this);t.canExecute=$.proxy(this._canExecute,this);break;case"selectAll":t.execute=$.proxy(this._selectCommand,this);t.canExecute=$.proxy(this._canExecute,this);break;case"nudgeUp":case"nudgeRight":case"nudgeDown":case"nudgeLeft":t.execute=$.proxy(this._nudgeCommand,this);t.canExecute=$.proxy(this._canExecute,this);break;case"startEdit":t.execute=$.proxy(this._startEditCommand,this);t.canExecute=$.proxy(this._canExecute,this);break;case"endEdit":t.execute=$.proxy(this._endEdit,this);t.canExecute=$.proxy(this._canExecute,this);break;case"focusToNextItem":case"focusToPreviousItem":t.execute=$.proxy(this._focusToItem,this);t.canExecute=$.proxy(this._canExecute,this);break;case"selectFocusedItem":t.execute=$.proxy(this._selectFocusedItem,this);t.canExecute=$.proxy(this._canExecute,this)}},_initViews:function(n){n||(this._views=[],this._views.push(this._id));this._views[this._id]={type:"mainview",context:ej.datavisualization.Diagram.SvgContext,style:"position:relative; height:"+this.model.height+"; width:"+this.model.width+";"}},_initDefaults:function(){this.tool()||(ej.isMobile()?(this.tool(ej.datavisualization.Diagram.Tool.ZoomPan),this._isMobile=!0):this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect));this._initTools()},_initCanvas:function(n){this._renderCanvas(n)},_initVisualGuide:function(){this.model.tooltip&&(this.model.tooltip=ej.datavisualization.Diagram.Tooltip(this.model.tooltip));this.model.selectedItems&&(this.model.selectorConstraints&&(this.model.selectedItems.constraints=this.model.selectorConstraints),this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Util.canEnableTooltip(this)&&this.showTooltip()?this.model.selectedItems.tooltip?ej.datavisualization.Diagram.Tooltip(this.model.selectedItems.tooltip):ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null,this.model.selectedItems.tooltip&&this.model.tooltipTemplateId&&(this.model.selectedItems.tooltip.templateId=this.model.selectedItems.tooltip.templateId||this.model.tooltipTemplateId))},_initTools:function(){this.tools={select:new ej.datavisualization.Diagram.SelectTool(this),move:new ej.datavisualization.Diagram.MoveTool(this),resize:new ej.datavisualization.Diagram.ResizeTool(this),rotate:new ej.datavisualization.Diagram.RotateTool(this),endPoint:new ej.datavisualization.Diagram.ConnectionEditTool(this),panTool:new ej.datavisualization.Diagram.PanTool(this),portTool:new ej.datavisualization.Diagram.PortTool(this),straightLine:new ej.datavisualization.Diagram.StraightLineTool(this),orthogonalLine:new ej.datavisualization.Diagram.OrthogonalLineTool(this),bezierLine:new ej.datavisualization.Diagram.BezierLineTool(this),phase:new ej.datavisualization.Diagram.PhaseTool(this),shapeTool:new ej.datavisualization.Diagram.ShapeTool(this),text:new ej.datavisualization.Diagram.TextTool(this),labelMove:new ej.datavisualization.Diagram.LabelMoveTool(this),labelResize:new ej.datavisualization.Diagram.LabelResizeTool(this),labelRotate:new ej.datavisualization.Diagram.LabelRotateTool(this)};this._toolToActivate="select";this.activeTool=this.tools[this._toolToActivate];this._registerDrawingTools()},_initDiagramTool:function(){var n=this.tool(),t;n&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!1)):n&ej.datavisualization.Diagram.Tool.DrawOnce?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!0)):n&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):n&ej.datavisualization.Diagram.Tool.MultipleSelect&&(this.activateTool("select"),this.activeTool.singleAction=!1)},_initHandles:function(){var t=this.model.selectedItems.userHandles,n;if(t)for(n=0;n<t.length;n++)t[n]=ej.datavisualization.Diagram.UserHandle(t[n]),t[n].tool&&(t[n].tool.diagram=this,this.tools[t[n].name]=t[n].tool)},_initHistoryManager:function(){this.model.historyManager.push=$.proxy(this.addHistoryEntry,this);this.model.historyManager.pop=$.proxy(this.removeHistoryEntry,this);this.model.historyManager.canPop=$.proxy(this.canRemoveHistoryEntry,this);this.model.historyManager.startGroupAction=$.proxy(this._startGroupAction,this);this.model.historyManager.closeGroupAction=$.proxy(this._closeGroupAction,this)},_cloneGlobalVariables:function(){this._historyList=$.extend(!0,{},this._historyList)},_setNodesConnectors:function(n,t){var r=[],u=!1,f=!1,e=n.nodes?typeof n.nodes=="function"?n.nodes().length:n.nodes.length:0,o=n.connectors?n.connectors&&typeof n.connectors=="function"?n.connectors().length:n.connectors.length:0,i;if(n.nodes&&e!=this._nodes.length){for(i=0;i<this.nodes().length;i++)this._removeElementFromCollection(this.nameTable[this.nodes()[i].name]);this._isPreventModelChange=!0;this.nodes(typeof n.nodes=="function"?n.nodes():n.nodes);this._isPreventModelChange=!1;this._initNodeCollection(t);u=!0}if(n.connectors&&o!=this._connectors.length){for(i=0;i<this.connectors().length;i++)this._removeElementFromCollection(this.nameTable[this.connectors()[i].name]);this._isPreventModelChange=!0;this.connectors(typeof n.connectors=="function"?n.connectors():n.connectors);this._isPreventModelChange=!1;this._initConnectorCollection();f=!0}return r=this.nodes(),r=r.length>0?this.nodes().concat(this.connectors()):this.connectors(),(r.length>0||n.nodes.length==0||n.connectors.length==0)&&this._resetObjectCollection(r,t,u,f),!0},_removeElementFromCollection:function(n){if(n){if(n.children)for(var t=0;t<n.children.length;t++)this._removeElementFromCollection(this.nameTable[this._getChild(n.children[t])]);n.segments?this._removeEdges(n):(this._disConnect(n,{}),n.inEdges=n.outEdges=[]);ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n);ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,n);this._removeElement(n);delete this.nameTable[n.name]}},_updateCloneModel:function(n){n&&(this._cloneModel[n]=typeof this.model[n]=="string"?this.model[n]:$.extend(!0,{},this.model[n]))},_compareModelProperty:function(n,t,i){if(n&&this._cloneModel[n]!==this.model[n]){var r={};r[n]=this.model[n];this._comparePropertyValues(this._cloneModel,n,r,t,i);this._updateCloneModel(n)}},_setModel:function(n){var v=!1,i,u,t,h,c,l,y,p,f,e,r;for(t in n){switch(t){case"height":case"width":this._svgParentDimention=null;n.dataSourceSettings&&(this._layoutUpdate=!0);this._initViews(!0);this._initCanvas(!0);delete this._layoutUpdate;break;case"nodes":case"connectors":h=!1;window.angular&&t==="nodes"&&n.nodes&&n.nodes()&&this.nodes()&&n.nodes()===this.nodes()&&(h=!0);h||(v||this._isPreventModelChange||this._isRefreshTriggered&&typeof this.model.nodes=="function"||(this._initLineRouting(),v=this._setNodesConnectors(n,this._isLoad),this._trigger("refresh"),this._iiii=1),delete this._isRefreshTriggered);break;case"enableContextMenu":this.model.enableContextMenu=n[t];this._initContextMenu(this._isLoad);break;case"contextMenu":this.model.contextMenu=$.extend({},this.model.contextMenu,n[t]);this._initContextMenu(this._isLoad);break;case"rulerSettings":this._updateRulerSettings(n[t]);break;case"snapSettings":u=n[t];u&&Object.keys(u).length>0&&(this._updateSnapSettings(n[t]),ej.datavisualization.Diagram.SvgContext._renderGrid(this._canvas,this._svg,this._page,this));break;case"selectorConstraints":this._setSelectorConstraints(n[t]);break;case"constraints":if(this.model.constraints=n[t],this._hasSelection()&&!ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._clearSelection(),c=this._getConnectors(),c.length>0)for(r=0;r<c.length;r++)ej.datavisualization.Diagram.Util.updateBridging(this.model.connectors[r],this),ej.datavisualization.Diagram.DiagramContext.update(this.model.connectors[r],this);break;case"drawingTools":this.model.drawingTools=n[t];this._registerDrawingTools();break;case"backgroundImage":this.model.backgroundImage=this.model.backgroundImage&&typeof this.model.backgroundImage=="string"?ej.datavisualization.Diagram.BackgroundImage({source:this.model.backgroundImage}):$.extend(!0,{},this.model.backgroundImage,n[t]);ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"backgroundColor":this.model.backgroundColor=n[t];ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"enableAutoScroll":this.enableAutoScroll(n[t]);break;case"autoScrollMargin":this.model.autoScrollMargin=n[t];break;case"layout":this._isLoad||(n[t].marginX&&(this.model.layout.margin.left=this.model.layout.margin.right=Number(typeof n[t].marginX=="function"?this._layoutMarginX():n[t].marginX)),n[t].marginY&&(this.model.layout.margin.top=this.model.layout.margin.bottom=Number(typeof n[t].marginY=="function"?this._layoutMarginY():n[t].marginY)),this.model.layout=$.extend(!0,{},this.model.layout,n[t]),this._setLayout(n[t]));break;case"selectedItems":this.updateSelector(n[t]);break;case"pageSettings":this.updatePageSettings(n[t]);break;case"scrollSettings":this._updateScrollSettings(n[t]);break;case"locale":this.locale(n[t]);l=document.getElementById(this.element[0].id+"_contextMenu");l.parentNode.removeChild(l);this.model.contextMenu&&this.model.contextMenu.items&&this.model.contextMenu.items.length>0&&(this.model.contextMenu.items=[]);this._renderContextMenu();break;case"nodeTemplate":this._isLoad||n.dataSourceSettings||n.nodes||(this._clearElementCollection(),this._initData(),i=this,this._views.forEach(function(n){var t=i._views[n],r=i._setNodeZOrder(t);i._renderDiagramObjects(r,t)}),this.layout());break;case"bridgeDirection":case"tool":this.update(n);break;case"connectorTemplate":this._updateConnectors();break;case"commandManager":y=n[t]&&n[t].commands?n[t].commands:undefined;this._initCommands(y);break;case"historyManager":this.model.historyManager=$.extend(!0,this.model.historyManager,{},n[t]);var o=this.model.historyManager.stackLimit,s=this.model.historyManager.redoStack.length,a=this.model.historyManager.undoStack.length;s>0&&(s>o?(f=s-o,this.model.historyManager.redoStack.splice(0,f),this.model.historyManager.undoStack=[]):(p=o-s,f=a-p,this.model.historyManager.undoStack.splice(0,f)));a>0&&(f=a-o,f>0&&this.model.historyManager.undoStack.splice(0,f));this._initHistoryManager();break;case"showTooltip":this.model.showTooltip=n[t];this.model.selectedItems.tooltip=this.showTooltip()?ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null;break;case"toolTipTemplateId":this.model.selectedItems.tooltip||(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip({margin:{top:10}}));this.model.selectedItems.tooltip.templateId=n[t];break;case"tooltip":this.model.tooltip=n[t]===null?null:ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.tooltip,{},n[t]));break;case"dataSourceSettings":if(!this._isLoad&&(u=n[t],u&&Object.keys(u).length>0&&u.dataSource&&(this.clear(),$.extend(this.model.dataSourceSettings,n[t]),this._initLineRouting(),this._initData(),i=this,this._views.forEach(function(n){var t=i._views[n],r=i._setNodeZOrder(t);i._renderDiagramObjects(r,t)}),this.layout(),e=i.connectors(),e.length>1&&ej.datavisualization.Diagram.Util.canRouteDiagram(this))))for(i.lineRouting.GenerateVisibilityGraph(i,e.length),r=0;r<e.length;r++)i._routeEdge(e[r])}t==="nodes"||t==="connectors"||t==="selectorConstraints"||t==="selectedItems"||t==="bridgeDirection"||t==="tool"||t==="dataSourceSettings"||this._compareModelProperty(t)}},_resetObjectCollection:function(n,t,i,r){var f,u,o,e;if(i&&($(this.element).find(".ej-d-node").remove(),$(this.element).find(".ej-d-group").remove(),$(this.element).find(".ej-d-seperator").remove()),r)for(f=$(this.element).find(".ej-d-connector"),u=f.length-1;u>=0;u--)o=this.nameTable[f[u].id],o&&o.parent==""&&$(f[u]).remove();this._hasSelection()&&this._clearSelection();e=this;this._views.forEach(function(n){var t=e._views[n],i=e._setNodeZOrder(t);e._renderDiagramObjects(i,t)})},_getConnectors:function(){var t=[],i,n;for(i in this.nameTable)n=this.nameTable[i],(n._type==="connector"||n.segments)&&t.push(n);return t},_generateNodes:function(n){for(var u,t,i=[],r=0;r<n.length;r++)u=n[r],t=this._makeNode(u),t!=null&&t.name&&!this._findNodeByName(i,t.name)&&i.push(t);return i},_generateConnectors:function(n){for(var u,t,i=[],r=0;r<n.length;r++)u=n[r],t=this._makeLine(u),t&&t.name&&!this._findNodeByName(i,t.name)&&i.push(t);return i},_findNodeByName:function(n,t){for(var i=0;i<n.length;i++)if(n[i].name===t)return!0;return!1},_makeNode:function(n){var t=this.model.dataSourceSettings,r={},u=n[t.id],i;if(u){if(r.name=u,t.customFields&&t.customFields.length>0)for(i=0;i<t.customFields.length;i++)r[t.customFields[i]]=n[t.customFields[i]];return r}return null},_makeLine:function(n){var t=this.model.dataSourceSettings.connectionDataSource,i={},r;if(i.name=n[t.id]?n[t.id]:"connector_"+ej.datavisualization.Diagram.Util.randomId(),i.sourceNode=n[t.sourceNode],i.targetNode=n[t.targetNode],n[t.sourcePointX]&&n[t.sourcePointY]&&(i.sourcePoint={x:Number(n[t.sourcePointX]),y:Number(n[t.sourcePointY])}),n[t.targetPointX]&&n[t.targetPointY]&&(i.targetPoint={x:Number(n[t.targetPointX]),y:Number(n[t.targetPointY])}),t.customFields&&t.customFields.length>0)for(r=0;r<t.customFields.length;r++)i[t.customFields[r]]=n[t.customFields[r]];return i},insertData:function(n){var u,r,f,t,i;if(n)t=this._parameterMap(n),u=n.type==="connector"?this.model.dataSourceSettings.connectionDataSource.crudAction.create:this.model.dataSourceSettings.crudAction.create,t&&this._raiseAjaxPost(JSON.stringify({data:[t]}),u);else{if(r=this._getNewNodes(),r.nodes){for(t=[],i=0;i<r.nodes.length;i++)t.push(this._parameterMap(r.nodes[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.crudAction.create)}if(r.connectors){for(t=[],i=0;i<r.connectors.length;i++)t.push(this._parameterMap(r.connectors[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.connectionDataSource.crudAction.create)}}},updateData:function(n){var u,r,f,t,i;if(n)t=this._parameterMap(n),u=n.type==="connector"?this.model.dataSourceSettings.connectionDataSource.crudAction.update:this.model.dataSourceSettings.crudAction.update,t&&this._raiseAjaxPost(JSON.stringify({data:[t]}),u);else{if(r=this._getUpdatedNodes(),r.nodes){for(t=[],i=0;i<r.nodes.length;i++)t.push(this._parameterMap(r.nodes[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.crudAction.update)}if(r.connectors){for(t=[],i=0;i<r.connectors.length;i++)t.push(this._parameterMap(r.connectors[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.connectionDataSource.crudAction.update)}}},removeData:function(n){var u,r,f,t,i;if(n)t=this._parameterMap(n),u=n.type==="connector"?this.model.dataSourceSettings.connectionDataSource.crudAction.destroy:this.model.dataSourceSettings.crudAction.destroy,t&&this._raiseAjaxPost(JSON.stringify({data:[t]}),u);else{if(r=this._getDeletedNodes(),r.nodes){for(t=[],i=0;i<r.nodes.length;i++)t.push(this._parameterMap(r.nodes[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.crudAction.destroy)}if(r.connectors){for(t=[],i=0;i<r.connectors.length;i++)t.push(this._parameterMap(r.connectors[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.connectionDataSource.crudAction.destroy)}}},_parameterMap:function(n){var i={},t,r;if(n.type==="connector"){if(t=this.model.dataSourceSettings.connectionDataSource,t.id&&(i[t.id]=n.name),t.sourcePointX&&t.sourcePointY&&(i[t.sourcePointX]=n.sourcePoint.X,i[t.sourcePointY]=n.sourcePoint.Y),t.targetPointX&&t.targetPointY&&(i[t.targetPointX]=n.targetPoint.X,i[t.targetPointY]=n.targetPoint.Y),t.sourceNode&&(i[t.sourceNode]=n.sourceNode),t.targetNode&&(i[t.targetNode]=n.targetNode),t.customFields&&t.customFields.length>0)for(r=0;r<t.customFields.length;r++)i[t.customFields[r]]=n[t.customFields[r]]}else if(t=this.model.dataSourceSettings,t.id&&(i[t.id]=n.name),t.width&&(i[t.width]=n.width),t.height&&(i[t.height]=n.height),t.offsetX&&(i[t.offsetX]=n.offsetX),t.offsetY&&(i[t.offsetY]=n.offsetY),t.customFields&&t.customFields.length>0)for(r=0;r<t.customFields.length;r++)i[t.customFields[r]]=n[t.customFields[r]];return i},_raiseAjaxPost:function(n,t){var i=this,r=$.ajax({contentType:"application/json",type:"POST",url:t,data:this._isWebAPI?JSON.stringify(JSON.parse(n).data):JSON.stringify(JSON.parse(n)),dataType:"json",error:function(n){n.status===404&&console.log("Method not found")}})},_initData:function(){var dataSourceSettings,dataSource,nodes,connectors,dataSourceApplied,tempNodes,tempconnectors,i,collapsedNodes;if(this.model.dataSourceSettings&&(dataSourceSettings={},this.model.dataSourceSettings.dataSource&&this.model.dataSourceSettings.connectionDataSource.dataSource?(dataSourceSettings.dataSource=this.model.dataSourceSettings.dataSource,dataSourceSettings.isBinding=!0,dataSourceSettings.nodes=this._generateNodes(this.model.dataSourceSettings.dataSource),dataSourceSettings.connectors=this._generateConnectors(this.model.dataSourceSettings.connectionDataSource.dataSource)):this.model.dataSourceSettings.dataSource&&(dataSourceSettings.id=this._dataSourceUniqueId(),dataSourceSettings.parent=this._dataSourceParentId(),dataSourceSettings.root=this._dataSourceRoot(),dataSourceSettings.dataSource=this._dataSource(),dataSourceSettings.tableName=this._dataSourceTableName(),dataSourceSettings.query=this._dataSourceQueryString()),dataSource=dataSourceSettings.dataSource||this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors),dataSource){if(nodes=[],connectors=[],dataSourceSettings&&dataSourceSettings.isBinding)dataSourceSettings.nodes&&dataSourceSettings.nodes.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.nodes,nodes,"nodes"),dataSourceSettings.connectors&&dataSourceSettings.connectors.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.connectors,connectors,"connectors");else if(this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors){if(this.model.dataSourceSettings.nodes){if(dataSource=this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.dataSource,dataSource)if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(this.model.dataSourceSettings.nodes,this.model.dataSourceSettings.nodeBinding),queryPromise=dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,nodes,"nodes")})}else this._applyTemplate(this.model.dataSourceSettings,dataSource,nodes,"nodes");this.model.dataSourceSettings.connectors&&(dataSource=this.model.dataSourceSettings.connectors||this.model.dataSourceSettings.dataSource,dataSource&&(dataSource instanceof ej.DataManager?($.ajaxSetup({async:!1}),query=this._findQuery(this.model.dataSourceSettings.connectors,this.model.dataSourceSettings.connectorBinding),queryPromise=dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,connectors,"connectors")})):this._applyTemplate(this.model.dataSourceSettings,dataSource,connectors,"connectors")))}}else dataSource instanceof ej.DataManager?(this._initDataSource(dataSourceSettings,nodes,connectors),dataSourceSettings.parent&&(dataSourceApplied=!0)):typeof dataSource!="string"&&dataSource.length&&(this._applyDataSource(dataSourceSettings,dataSource,nodes,connectors),this.model.dataSourceSettings.parent&&(dataSourceApplied=!0));for(tempNodes=[],tempconnectors=[],this.nodes().length>0&&(tempNodes=this.nodes()),this.connectors().length>0&&(tempconnectors=this.connectors()),this.nodes(nodes),this.connectors(connectors),i=0;i<tempNodes.length;i++)this.nodes().push(tempNodes[i]),this._nodes=$.extend(!0,[],this.nodes());for(i=0;i<tempconnectors.length;i++)this.connectors().push(tempconnectors[i]),this._connectors=$.extend(!0,[],this.connectors())}collapsedNodes=this._initNodeCollection(!1,dataSourceApplied);this._initConnectorCollection(dataSourceApplied);collapsedNodes.length>0&&this._collapseNodes(collapsedNodes);this._cloneModel=$.extend(!0,{},this.model)},_getSetTool:function(){var n;return this.model.setTool&&(typeof this.model.setTool=="string"&&(n=ej.util.getObject(this.model.setTool,window)),$.isFunction(this.model.setTool)&&(n=this.model.setTool)),n},_getNodeTemplate:function(){var n;return this.model.nodeTemplate&&(typeof this.model.nodeTemplate=="string"&&(n=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(n=this.model.nodeTemplate)),n},_getConnectorTemplate:function(){var n;return this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(n=this.model.connectorTemplate)),n},_initNodeCollection:function(n,t){var f=[],r=this.nodes(),u,i;for((!this.model.dataSourceSettings.dataSource||this._isLoad)&&(u=this._getNodeTemplate()),this._isNodeInitializing=!0,i=0;i<r.length;i++)r[i].container&&!$.isEmptyObject(r[i].container)||r[i].isSwimlane||r[i].type==="swimlane"?(i=this._convertGroupChild(r[i],r),r[i]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,r[i])):typeof r[i].shape!="object"&&(r[i]=ej.datavisualization.Diagram.NodeType(r[i],this)),r[i].name==""&&(r[i].name="node_"+ej.datavisualization.Diagram.Util.randomId()),r[i].type==="swimlane"||r[i].isSwimlane?this.nameTable[r[i].name]=ej.datavisualization.Diagram.Group(r[i]):r[i]._type==="group"||r[i].children&&r[i].children.length>0?(r[i].type=="bpmn"&&r[i].container?r[i]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,r[i]):(i=this._convertGroupChild(r[i],r),r[i]=this._getNewGroup(r[i])),r[i]._type="group",this.nameTable[r[i].name]=r[i],this._initGroupNode(r[i]),n||r[i].type==="bpmn"||this._udpateChildRotateAngle(r[i])):t?r[i].shape&&typeof r[i].shape=="object"&&ej.datavisualization.Diagram.Util._updateShapeProperties(r[i]):(r[i]=this._getNewNode(r[i]),this.nameTable[r[i].name]=r[i]),!t&&u&&(u(this,r[i]),typeof r[i].shape!="object"&&(r[i]=ej.datavisualization.Diagram.NodeType(r[i],this)),(r[i]._type==="group"||r[i].children&&r[i].children.length>0)&&(r[i]=r[i].type=="bpmn"&&r[i].container?ej.datavisualization.Diagram.ContainerHelper._initContainer(this,r[i]):this._getNewGroup(r[i]),this._initGroupNode(r[i]))),r[i]._type==="node"&&r[i].labels.length&&(r[i].width==0||r[i].height==0)&&this._getNodeDimension(r[i]),this.nameTable[r[i].name]=r[i],this._updateQuad(r[i]),r[i].isExpanded||f.push(r[i]),this._setBounds(r[i]);if(delete this._isNodeInitializing,this._nodes=$.extend(!1,[],r),ej.datavisualization.Diagram.Util.canRouteDiagram(this))for(this.lineRouting.GenerateVisibilityGraph(this,r.length),i=0;i<this._nodes.length;i++)this._resetValues(this._nodes[i]);return f},_convertGroupChild:function(n,t){var r,i;if(n.children&&n.children.length>0)for(r=0;r<n.children.length;r++)i=n.children[r],i&&typeof i=="string"&&(i=this.nameTable[i],n.children[r]=i,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i,!1),i.type==="group"&&(r=this._convertGroupChild(i,n.children)),i.type==="connector"?ej.datavisualization.Diagram.Util.removeItem(this.connectors(),i):ej.datavisualization.Diagram.Util.removeItem(this.nodes(),i));return t.indexOf(n)},_checkFromSwimlane:function(n){if(n){if(n.isSwimlane||n.isLane||n.isLaneStack||n.isPhaseStack||n.isPhase||n.type=="phase")return!0;if(n.parent){var t=this.nameTable[n.parent];if(t)return this._checkFromSwimlane(t)}}return!1},_setBounds:function(n){!this._selectedSymbol&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&(n.segments||this._checkFromSwimlane(n)||(this.nodes().length!=1||this.lineRouting.router||this.lineRouting.router.graph||this.lineRouting.GenerateVisibilityGraph(this,this.nodes().length==1),this.lineRouting.RemoveNode(n),this._isInit||(this._setObstacle(),this.lineRouting.AddNode(n))))},_setObstacle:function(){this.lineRouting.IsDirt=!0},_initConnectorCollection:function(n){for(var i=this.connectors(),t,u=this._getConnectorTemplate(),r=0,f=i.length;r<f;r++)t=n?i[r]:this._getNewConnector(i[r]),this.nameTable[t.name]=t,n||(this.model.layout&&this._layoutType()===ej.datavisualization.Diagram.LayoutTypes.None||this._isLoad)&&this._dock(t,this.nameTable),this._updateEdges(t),u&&!n&&u(this,t),i[r]=t,this.model.layout&&this._layoutType()===ej.datavisualization.Diagram.LayoutTypes.None&&(this._isUndo=!0,this._routeEdge(i[r]),this._isUndo=!1);this._connectors=$.extend(!0,[],i)},_initDataSource:function(dataSourceSettings,nodes,connectors){var dataSource=dataSourceSettings.dataSource,diagram=this,mapper,query,queryPromise;dataSource.dataSource.json&&dataSource.dataSource.json.length>0?diagram._applyDataSource(dataSourceSettings,dataSource.dataSource.json,nodes,connectors):dataSource.dataSource.table||(mapper=dataSourceSettings,dataSource instanceof ej.DataManager&&($.ajaxSetup({async:!1}),query=this._findQuery(mapper,dataSourceSettings.nodeBinding),queryPromise=dataSourceSettings.dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyDataSource(dataSourceSettings,n.result,nodes,connectors)})))},_findQuery:function(n,t){var u=[],e=ej.Query(),h=n.query||this.model.dataSourceSettings.query,c,o,r,i,s,f;if(ej.isNullOrUndefined(h)){c=n.dataSource||this.model.dataSourceSettings.dataSource;o=n.tableName||this.model.dataSourceSettings.tableName;for(r in n)r==="tableName"||r==="dataSource"||r==="designTemplate"||r.match("Binding")||n[r]&&u.push(n[r]);for(i in t)if(i==="labels")for(s=t[i],f=0;f<s.length;f++)s[f].text&&u.push(s[f].text);else i=="shape"||i=="line"?t[i][type]&&r.push(t[i][type]):t[i]&&u.push(t[i]);u.length>0&&e.select(u);c.dataSource.url.match(o+"$")||ej.isNullOrUndefined(o)||e.from(o)}else e=h;return e},_updateMultipleRootNodes:function(n,t,i){var r=n[i.parent],u,f;if(r&&r.length>0)for(f=0;f<r.length;f++)u=r[f],t[u]?t[u].items.push(n):t[u]={items:[n]};return t},_applyDataSource:function(n,t,i,r){for(var u=[],v,s,c,p,l,e,f,o,a,y,w,h=0;h<t.length;h++)f=t[h],Array.isArray(f[n.parent])?u=this._updateMultipleRootNodes(f,u,n,t):u[f[n.parent]]?u[f[n.parent]].items.push(f):u[f[n.parent]]={items:[f]},n.root===f[n.id]&&(v={items:[f]});if(o=[],n.parent)if(v)o.push(v);else for(e in u)(e||e===0)&&e!="undefined"&&e!='""'&&e!="null"||o.push(u[e]);else o.push(u[undefined]);for(this.model.nodeTemplate&&(y=this._getNodeTemplate()),this.model.connectorTemplate&&(w=this._getConnectorTemplate()),s=0;s<o.length;s++)for(c=0;c<o[s].items.length;c++)p=o[s].items[c],l=this._applyNodeTemplate(n,p,y),i.push(l),n.parent&&(a=u[l[n.id]],a&&a.items&&this._renderChildNodes(n,a,l.name,i,r,u,y,w))},_getNewNodes:function(){var t=[],i=[],r,n;for(r in this.nameTable)n=this.nameTable[r],n&&n.type==="connector"&&n._status==="new"?(n._status="",i.push(n)):n&&n._status==="new"&&(n._status="",t.push(n));return{nodes:t,connectors:i}},_getUpdatedNodes:function(){var t=[],i=[],r,n;for(r in this.nameTable)n=this.nameTable[r],n&&n.type==="connector"&&n._status==="update"?(n._status="",i.push(n)):n&&n._status==="update"&&(n._status="",t.push(n));return{nodes:t,connectors:i}},_getDeletedNodes:function(){for(var n,i=[],r=[],t=0;t<this._crudDeleteNodes.length;t++)n=this._crudDeleteNodes[t],n&&n.type==="connector"?r.push(n):n&&i.push(n);return this._crudDeleteNodes=[],{nodes:i,connectors:r}},_isContainsSameConnector:function(n,t,i){var r,u;if(t&&i)for(r=0;r<n.length;r++)if(u=n[r],u&&u.sourceNode===t&&u.targetNode===i)return!0;return!1},_renderChildNodes:function(n,t,i,r,u,f,e,o){for(var c,s,l,a,h=0;h<t.items.length;h++)c=t.items[h],s=this._applyNodeTemplate(n,c,e),a=!1,this._collectionContains(s.name,r)?a=!0:r.push(s),this._isContainsSameConnector(u,i,s.name)||u.push(this._applyConnectorTemplate(n,null,i,s.name,o)),a||(l=f[c[n.id]],l&&this._renderChildNodes(n,l,s.name,r,u,f,e,o))},_applyTemplate:function(n,t,i,r){var f,u,e,o,s;if(this.model.nodeTemplate&&(f=this._getNodeTemplate()),this.model.connectorTemplate&&(s=this._getConnectorTemplate()),r=="nodes")for(u=0;u<t.length;u++)e=this._applyNodeTemplate(n,t[u],f),i.push(e);if(r=="connectors")for(u=0;u<t.length;u++)o=this._applyConnectorTemplate(n,t[u],t[u].sourceNode,t[u].targetNode,s),i.push(o)},_applyNodeTemplate:function(n,t,i){var r=t;return r.name!==""&&r.name||(r.name=ej.datavisualization.Diagram.Util.randomId()),r=r.type!="group"?this._getNewNode(r):this._getNewGroup(r),i&&i(this,r),r._type==="group"&&this._initGroupNode(r),r},_applyConnectorTemplate:function(n,t,i,r,u){var f={};return f.name=t&&t.name?t.name:ej.datavisualization.Diagram.Util.randomId(),f.sourceNode=i,f.targetNode=r,f=this._getNewConnector(f),u&&u(this,f),f},_collapseNodes:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._collapseChildren(i)},_getNewNode:function(n){return n.shape&&typeof n.shape=="object"&&ej.datavisualization.Diagram.Util._updateShapeProperties(n),ej.datavisualization.Diagram.Node($.extend(!0,{},this.model.defaultSettings.node,n))},_getNewGroup:function(n){var t=null,i=0,r;if(n.type=="bpmn"&&(n=ej.datavisualization.Diagram.Util._updateBpmnChild(ej.datavisualization.Diagram.Node(n),this)),n.children&&n.children.length>0)for(r=0;r<n.children.length;r++)t=this.nameTable[this._getChild(n.children[r])],t&&(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t),t.segments?(i=this.connectors().indexOf(t),delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewConnector(t),i>=0&&(this.connectors()[i]=this.nameTable[t.name]),this._dock(this.nameTable[t.name],this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(this.nameTable[t.name],this)):t._type==="node"?(i=this.nodes().indexOf(t),delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewNode(t),i>=0&&(this.nodes()[i]=this.nameTable[t.name])):t._type==="group"&&(i=this.nodes().indexOf(t),delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewGroup(t),i>=0&&(this.nodes()[i]=this.nameTable[t.name])));return ej.datavisualization.Diagram.Group($.extend(!1,{},this.model.defaultSettings.group,n))},_isEmptyDiagramObject:function(n){if($.isEmptyObject(n))return!0;for(var t in n)if(typeof n[t]=="object")return this._isEmptyDiagramObject(n[t]);return!1},_getNewConnector:function(n){var t=$.extend(!0,{},this.model.defaultSettings.connector,n),r,u,i;return this.model.layout&&this.model.layout.type=="organizationalchart"&&(t=$.extend(!0,{},{segments:[{type:"orthogonal"}]},t)),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(t.defaultType=this.model.defaultSettings.connector.segments[0].type),t.shape&&!this._isEmptyDiagramObject(t.shape)&&(t.shape.type=="umlactivity"&&(t=ej.datavisualization.Diagram.UMLConnectorShape(t),t.sourceNode&&(r=this.nameTable[t.sourceNode]),t.targetNode&&(u=this.nameTable[t.targetNode]),i=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(u,r,t,this),t.targetNode=i?i.name:null),t.shape.type=="umlclassifier"?(t=ej.datavisualization.Diagram.UMLConnectorShape(t),t.sourceNode&&(r=this.nameTable[t.sourceNode]),t.targetNode&&(u=this.nameTable[t.targetNode]),i=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(u,r,t,this),t.targetNode=i?i.name:null):(t.shape=$.extend(!0,{},ej.datavisualization.Diagram.ConnectorShapeDefaults,t.shape),t.shape.flow=="sequence"&&(t.shape.sequence=="normal"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},t)),t.shape.sequence=="conditional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},t),t.sourceDecorator={shape:"diamond",fillColor:"white",width:20,height:10}),t.shape.sequence=="default"&&(t=$.extend(!0,{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},t))),t.shape.flow=="association"&&(t.shape.association=="directional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},t)),t.shape.association=="nondirectional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"none"}},t)),t.shape.association=="bidirectional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},t),t.sourceDecorator={shape:"openarrow",width:5,height:10})),t.shape.flow=="message"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],sourceDecorator:{shape:"circle",fillColor:"white"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"},t)))),ej.datavisualization.Diagram.Util._initConnectionEnds(t,this),ej.datavisualization.Diagram.Connector(t)},_setOverview:function(n,t){var i,r,u;n?(this._overview=n,this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._views[n._id]||(this._views.push(n._id),this._views[n._id]={context:ej.datavisualization.Diagram.SvgContext,type:"overview"},n._renderDocument(this._views[n._id]),i=this._views[n._id],r=this._setNodeZOrder(i),this._renderDiagramObjects(r,i,null,!0),n._updateOverview(i)),delete this._viewPort):(n=$("#"+t).ejOverview("instance"),n._removeDocument(this._views[t]),this._views[t]=undefined,u=this._views.indexOf(t),this._views.splice(u,1))},_updateScrollOffset:function(n,t,i){this._hScrollOffset=Number(n);this._vScrollOffset=Number(t);this._verticalOffset(Number(t));this._horizontalOffset(Number(n));this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);ej.datavisualization.Diagram.ScrollUtil._transform(this,n,t,i);var r=this;this._views.forEach(function(i){var f=r._views[i],u;f.type=="overview"&&(u=$("#"+i).ejOverview("instance"),u&&u._scrollOverviewRect(n,t,r._currZoom))});this.model.scrollSettings.viewPortHeight=this._viewPort.height;this.model.scrollSettings.viewPortWidth=this._viewPort.width;this.model.scrollSettings.currentZoom=this._currZoom},_getChild:function(n){return ej.datavisualization.Diagram.Util.getChild(n)},_getChildren:function(n){var i,r,t;if(n){for(i=[],r=0;r<n.length;r++)t=n[r],t&&(typeof t=="object"?i.push(t.name):i.push(t));return i}},_initGroupNode:function(n,t){for(var o,f,e,i=null,r,u=0;n.children&&u<n.children.length;u++)r=t?$.extend(!0,{},t[this._getChild(n.children[u])]):n.children[u],i=typeof r=="string"?this.nameTable[r]:r,i&&(i._type||i.type!="umlclassifier"||(i._type="group"),i.container&&(i._type="group",i.labels=i.labels||[]),r&&typeof r=="object"&&(typeof i.shape!="object"&&n.type!="bpmn"&&(i=ej.datavisualization.Diagram.NodeType(i,this)),i._type=="group"||i.children||i.segments||i.type=="connector"?i.segments||i.type=="connector"?(i=this._getNewConnector(i),i.name==""&&(i.name=ej.datavisualization.Diagram.Util.randomId())):(i=this._getNewGroup(i),i.name==""&&(i.name=ej.datavisualization.Diagram.Util.randomId()),this._initGroupNode(i)):(n.type!="bpmn"&&n.type!="umlclassifier"&&(o=!1,n.parent&&(f=this.getNode(n.parent),f&&(f.subProcess&&f.subProcess.events.length>0||f.task&&f.task.events.length>0)&&(o=!0)),o||(i=this._getNewNode(i))),i.name==""&&(i.name=ej.datavisualization.Diagram.Util.randomId()),i._type=="node"&&i.labels.length&&(i.width==0||i.height==0)&&this._getNodeDimension(i)),n.children[u]=i,i.parent=n.name,this.nameTable[i.name]=i,i.segments&&this._dock(i,this.nameTable)),this._updateQuad(this.nameTable[this._getChild(n.children[u])]));this._isLoad||ej.datavisualization.Diagram.Util._updateGroupBounds(n,this);n._type==="group"?this._updateFlipOffset(n,n.flip,this._isLoad&&this.model.serializationSettings.preventDefaultValues?!0:!1):n.parent&&(e=this.findNode(n.parent),e&&(e.subProcess&&e.subProcess.events.length>0||e.task&&e.task.events.length>0)&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this))},_udpateChildRotateAngle:function(n){var f,t,i,r,u,e;if(n.rotateAngle)for(i=ej.Matrix.identity(),ej.Matrix.rotate(i,n.rotateAngle,n.offsetX,n.offsetY),r=0;r<n.children.length;r++)t=this.nameTable[this._getChild(n.children[r])],t.rotateAngle=t.rotateAngle?t.rotateAngle+n.rotateAngle:n.rotateAngle,t.rotateAngle%=360,t.rotateAngle<0&&(t.rotateAngle+=360),t.segments?(t.sourceNode||this._setEndPoint(t,ej.Matrix.transform(i,t.sourcePoint),!1),t.targetNode||this._setEndPoint(t,ej.Matrix.transform(i,t.targetPoint),!0)):(t.type=="group"&&this._udpateChildRotateAngle(t),u=t.offsetX,f=t.offsetY,e=ej.Matrix.transform(i,ej.datavisualization.Diagram.Point(u,f)),this._translate(t,e.x-u,e.y-f,this.nameTable),this._updateAssociatedConnectorEnds(t,this.nameTable))},_getNodeDimension:function(n){var f=n._width,e=n._height,o=n.width?n.width:n.maxWidth?n.maxWidth:n.minWidth,i=document.createElement("span"),s=0,h=0,t,r,u,c;if(n.labels.length){for(ej.datavisualization.Diagram.Util.attr(i,{id:n.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(i),r=0;r<n.labels.length;r++)t=n.labels[r],t.bold&&(i.style.fontWeight="bold"),t.italic&&(i.style.fontStyle="italic"),i.style.textDecoration=t.textDecoration,i.style.fontFamily=t.fontFamily,i.style.fontSize=t.fontSize+"px",i.style.color=t.fontColor,i.style.backgroundColor=t.fillColor,i.style.borderColor=t.borderColor,i.style.borderWidth=t.borderWidth+"px",i.textContent=t.text,t.wrapping=="nowrap"?(i.style.whiteSpace="nowrap",i.style.wordWrap="normal"):(t.wrapping=="wrap"&&(i.style.wordBreak="break-all"),i.style.wordWrap="break-word",i.style.whiteSpace="pre"),n.maxWidth&&(i.style.maxWidth=o-(t.margin.left+t.margin.right)-t.fontSize+"px"),n.minWidth&&(i.style.minWidth=o-(t.margin.left+t.margin.right)-t.fontSize+"px"),s+=i.offsetWidth+t.margin.left+t.margin.right+5,h+=i.offsetHeight+t.margin.top+t.margin.bottom;u=n.name.match("_attribute")?"attribute":n.name.match("_method")?"method":n.name.match("_member")?"member":"header";n._width=Math.max(n.minWidth||0,s||0);n.maxWidth&&(n._width=Math.min(n.maxWidth,n._width));n._height=Math.max(n.minHeight||0,h||0);n.maxHeight&&(n._height=Math.min(n.maxHeight,n._height));n.width||n.labels[0].horizontalAlignment!="left"||u=="attribute"||u=="method"||u=="member"||(n.offsetX+=(n._width-f)/2);n.width||n.labels[0].horizontalAlignment!="right"||(n.offsetX-=(n._width-f)/2);n.height||n.labels[0].verticalAlignment!="top"||(n.offsetY+=(n._height-e)/2);n.height||n.labels[0].verticalAlignment!="bottom"||(n.offsetY-=(n._height-e)/2);n.parent&&(c=this.nameTable[n.parent]);this.element[0].removeChild(i)}},_getMinMaxSize:function(n,t,i,r,u){var s=null,h=null,l,f,e,c,a,o;return t>=n.minWidth&&t<=n.maxWidth?s=t:n.horizontalAlign!="stretch"||!n.parent||r||u?u?(f=this.nameTable[n.parent],f&&(e=ej.datavisualization.Diagram.Util.bounds(f),o=this._getMinMaxSize(f,e.width,e.height),s=o.width?o.width:t)):s=t<n.minWidth&&n.minWidth!=0?n.minWidth:t>n.maxWidth&&n.maxWidth!=0&&!n.isSwimlane?n.maxWidth:t:(f=this.nameTable[n.parent],f&&(e=ej.datavisualization.Diagram.Util.bounds(f),e.width==0&&e.height==0&&(e.width=t,e.height=i),o=this._getMinMaxSize(f,e.width,e.height),f.isSwimlane&&f.orientation=="vertical"&&(l=this.nameTable[this._getChild(f.children[0])],l&&(o.height-=l.height)),o.width-=f.paddingLeft+f.paddingRight+f.marginLeft+f.marginRight,o.height-=f.paddingTop+f.paddingBottom+f.marginTop+f.marginBottom,s=o.width?o.width:t)),i>=n.minHeight&&i<=n.maxHeight?h=i:(f=this.nameTable[n.parent],n.verticalAlign!="stretch"||!n.parent||r||n.isLane?h=i<n.minHeight&&n.minHeight!=0?n.minHeight:i>n.maxHeight&&n.maxHeight!=0?n.maxHeight:i:(e=ej.datavisualization.Diagram.Util.bounds(f),e.width==0&&e.height==0&&(c=null,a=!1,e.width=n.minWidth,e.height=n.minHeight,(n.minWidth==0||n.minHeight==0)&&(e.width=t,e.height=i,c=!1,a=!0),a||(c=!0)),o=this._getMinMaxSize(f,e.width,e.height),o.width-=f.paddingLeft+f.paddingRight+f.marginLeft+f.marginRight,o.height-=f.paddingTop+f.paddingBottom+f.marginTop+f.marginBottom,c&&(o.height-=n.marginTop),h=o.height?o.height:i)),{width:s,height:h}},_updateConnectorBridging:function(n){var r=[],i,t;for(this.boundaryTable[n.name]=ej.datavisualization.Diagram.Util.bounds(n),n._intersects&&n._intersects.length&&(r=n._intersects),i=0;i<r.length;i++)t=this.nameTable[r[i]],t&&t.visible&&t.segments&&t!=n&&ej.datavisualization.Diagram.Util.canBridge(t,this)&&(ej.datavisualization.Diagram.Util.updateBridging(t,this,[n]),this._disableSegmentChange||ej.datavisualization.Diagram.DiagramContext._refreshOnlySegments(t,this))},_drawToolShape:function(n,t){n=="image"||n=="native"||n=="html"||n==="text"||n==="basic"||n==="flow"||n==="arrow"||n==="bpmn"||this.activeTool._isPolyline()?this.activateTool("shapeTool",t):n=="straightLine"?this.activateTool("straightLine",t):n=="orthogonalLine"?this.activateTool("orthogonalLine",t):n=="bezierLine"&&this.activateTool("bezierLine",t)},_destroy:function(){if(this.element.empty().removeClass("e-datavisualization-diagram"),this.enableContextMenu()){var n=$("#"+this.element[0].id+"_contextMenu").data("ejMenu");n.destroy()}$("#"+this.element[0].id+"_contextMenu").remove()},_updateRuler:function(n,t){var i={};n.interval&&(i.interval=n.interval);n.segmentWidth&&(i.segmentWidth=n.segmentWidth);n.tickAlignment&&(i.tickAlignment=n.tickAlignment);n.markerColor&&(i.markerColor=n.markerColor);n.thickness&&(i.thickness=n.thickness);n.arrangeTick&&(i.arrangeTick=n.arrangeTick);$.isEmptyObject(i)||$("#"+t[0].id).ejRuler(i)},_updateRulerSettings:function(n){this.updateViewPort();(n.showRulers!=undefined||n.horizontalRuler&&n.horizontalRuler.thickness||n.verticalRuler&&n.verticalRuler.thickness)&&(this._svgParentDimention=null,this._initViews(!0),this._initCanvas(!0));n.horizontalRuler&&this._updateRuler(n.horizontalRuler,this._hRuler);n.verticalRuler&&this._updateRuler(n.verticalRuler,this._vRuler);ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this);ej.datavisualization.Diagram.ScrollUtil._updateRuler(this,this._hScrollOffset,this._vScrollOffset)},_updateScrollSettings:function(n){var u=this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Limited?!0:!1,r=this.model.pageSettings.scrollableArea,f=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),e,t,i,o;(n.horizontalOffset!==undefined||n.verticalOffset!==undefined)&&(e={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:f},n.horizontalOffset!==undefined&&(t=Number(typeof n.horizontalOffset=="function"?n.horizontalOffset():n.horizontalOffset),(!u||t>=r.x&&t<=r.x+r.width)&&(this._scrollLimit()=="diagram"&&(t=Math.max(this._hScrollbar.model.minimum,t),t=Math.min(this._hScrollbar.model.maximum,t)),this._updateScrollOffset(t,this._verticalOffset()))),n.verticalOffset!==undefined&&(i=Number(typeof n.verticalOffset=="function"?n.verticalOffset():n.verticalOffset),(!u||i>=r.y&&i<=r.y+r.height)&&(this._scrollLimit()=="diagram"&&(i=Math.max(this._vScrollbar.model.minimum,i),i=Math.min(this._vScrollbar.model.maximum,i)),this._updateScrollOffset(this._horizontalOffset(),i))),o={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:f},this._raiseEvent("scrollChange",{newValues:o,oldValues:e}));n.zoomFactor&&this.zoomFactor(typeof n.zoomFactor=="function"?n.zoomFactor():n.zoomFactor);n.padding&&($.extend(this.model.scrollSettings.padding,n.padding),this._updateScrollOffset(this._horizontalOffset(),this._verticalOffset()))},updatePageSettings:function(n){if(n){var t=$.extend(!0,{},this.model.pageSettings);n.pageHeight&&this._pageHeight(Number(typeof n.pageHeight=="function"?n.pageHeight():n.pageHeight));n.pageWidth&&this._pageWidth(Number(typeof n.pageWidth=="function"?n.pageWidth():n.pageWidth));(typeof n.multiplePage=="function"||typeof n.multiplePage=="boolean")&&this._multiplePage(typeof n.multiplePage=="function"?n.multiplePage():n.multiplePage);(typeof n.showPageBreak=="function"||typeof n.showPageBreak=="boolean")&&this._showPageBreak(typeof n.showPageBreak=="function"?n.showPageBreak():n.showPageBreak);(n.pageBorderColor||n.pageBorderColor==="")&&this._pageOrientation(typeof n.pageOrientation=="function"?n.pageOrientation():n.pageOrientation);(n.pageBorderWidth||n.pageBorderWidth===0)&&this._pageBorderWidth(Number(typeof n.pageBorderWidth=="function"?n.pageBorderWidth():n.pageBorderWidth));(n.pageMargin||n.pageMargin===0)&&this._pageMargin(Number(typeof n.pageMargin=="function"?n.pageMargin():n.pageMargin));(n.pageBackgroundColor||n.pageBackgroundColor==="")&&this._pageBackgroundColor(typeof n.pageBackgroundColor=="function"?n.pageBackgroundColor():n.pageBackgroundColor);n.scrollLimit&&this._scrollLimit(typeof n.scrollLimit=="function"?n.scrollLimit():n.scrollLimit);n.scrollableArea&&(this.model.pageSettings.scrollableArea=n.scrollableArea);(n.pageBorderColor||n.pageBorderColor==="")&&this._pageBorderColor(typeof n.pageBorderColor=="function"?n.pageBorderColor():n.pageBorderColor);this._compareModelProperty("pageSettings");this._isUndo||this.addHistoryEntry({type:"pagesettingschanged",undoObject:t,category:"internal",redoObject:$.extend(!0,{},this.model.pageSettings)});ej.datavisualization.Diagram.PageUtil._updatePageSize(this);ej.datavisualization.Diagram.SvgContext._updateBackground(this._hScrollOffset,this._vScrollOffset,this._currZoom,this);ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this)}},_updateSnapSettings:function(n){n&&(n.horizontalGridLines&&n.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=n.horizontalGridLines.linesInterval),n.verticalGridLines&&n.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=n.verticalGridLines.linesInterval),n.snapAngle&&this._snapAngle(Number(typeof n.snapAngle=="function"?n.snapAngle():n.snapAngle)),n.snapObjectDistance&&this._snapObjectDistance(Number(typeof n.snapObjectDistance=="function"?n.snapObjectDistance():n.snapObjectDistance)))},_cloneObject:function(n){var t,i;if((this.getObjectType(n)==="node"||this.getObjectType(n)==="connector")&&n.type!="bpmn")return $.extend(!0,{},n);if(this.getObjectType(n)!=="group"&&n.type!=="bpmn"||n.isSwimlane){if(this.getObjectType(n)==="group"&&n.isSwimlane)return this.getNode(n)}else{for(t=$.extend(!0,{},n),i=0;t.children&&t.children.length>0&&i<t.children.length;i++)t.children[i]=this._cloneObject(this.nameTable[this._getChild(t.children[i])]),t.children[i].parent=t.name;return t}},_cloneSelectionList:function(){for(var n,i,r=[],t=0&&this.selectionList&&this.selectionList.length>0;t<this.selectionList.length;t++)if(this.getObjectType(this.selectionList[t])==="pseudoGroup")for(n=this.selectionList[0],i=0;n.children&&n.children.length>0&&i<n.children.length;i++)r.push(this._cloneObject(this.nameTable[this._getChild(n.children[i])]));else r.push(this._cloneObject(this.selectionList[t]));return r},getNode:function(n,t){if(n)return this._getNode(n,t)},addPhase:function(n,t){this._addPhase(n,t)},stopEvents:function(n){this.activeTool.inAction&&!n.originalEvent.target&&n.target&&(n.originalEvent.target=n.target,this._mouseup(n))},_updateSwimlanePhase:function(n,t){var i,r;n&&t&&(t.label&&(i=this.nameTable[n.name],i&&(this._comparePropertyValues(n,"label",t),t.label=$.extend(!0,{},t.label),t.label.rotateAngle=t.orientation==="vertical"?270:0,t.label.name=i.labels[0].name,t.label.mode=ej.datavisualization.Diagram.LabelEditMode.View,n.label=t.label,this.updateLabel(i.name,i.labels[0],n.label))),(t.lineColor||t.lineDashArray||t.lineWidth)&&(r={},t.lineColor&&(this._comparePropertyValues(n,"lineColor",t),n.lineColor=t.lineColor,r.stroke=t.lineColor),t.lineDashArray&&(this._comparePropertyValues(n,"lineDashArray",t),n.lineDashArray=t.lineDashArray,r["stroke-dasharray"]=t.lineDashArray),t.lineWidth&&(this._comparePropertyValues(n,"lineWidth",t),n.lineWidth=t.lineWidth,r["stroke-width"]=t.lineWidth),ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(n,r,this)),t.fillColor&&(this._comparePropertyValues(n,"fillColor",t),n.fillColor=t.fillColor,ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(n,this)))},_updateNodeVisibility:function(n,t){var u,r,i,f;if(n){if(n.type==="group")for(i=0;i<n.children.length;i++)u=this.nameTable[this._getChild(n.children[i])],u&&this._updateNodeVisibility(u,t);if(n.isSwimlane&&(r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,n),r))for(i=0;i<r.length;i++)f=this.nameTable[this._getChild(r[i])],f.visible=t.visible,ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(f,t,this);n.visible=t.visible}},_compareInnerProperties:function(n,t){var r=!0,i;if(n&&t)for(i in t)if(typeof n[i]=="object"){if(r=this._compareInnerProperties(n[i],t[i]),!r)return!1}else if(n[i]!==t[i])return!1;return!0},_comparePropertyValues:function(n,t,i,r,u){var e,c;if(n){var f=null,s=n,h=i,o=t.split("."),l=o.length;if(l>1)for(e=0;l>e;)if(s=s[o[e]],h=h[o[e]],e++,s&&h)e==l-1&&s[o[e]]!=h[o[e]]&&(f={element:n,cause:u?u:r?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:o[0],oldValue:s,newValue:h},this._raisePropertyChange(f));else break;else f={cause:u?u:r?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:t,oldValue:n[t],newValue:i[t]},t==="labels"||t==="ports"||t==="segments"||(typeof n[t]!="object"||this._compareInnerProperties(n[t],i[t]))&&n[t]&&(typeof n[t]=="object"||n[t]==i[t])?t==="segments"?n[t]!=i[t]&&(f.element=n):(t==="labels"||t==="ports")&&n[t].length>0&&(c=t==="ports"?this._findPort(n,i.name):this._findLabel(n,i.name),this._compareInnerProperties(c,i)||(f.element=c,f.oldValue=c,f.newValue=i)):f.element=n,f.element&&this._raisePropertyChange(f)}},updateNode:function(n,t){var r,b,k,d,c,o,s,g,l,a,i,v;if(n){var i=this._findNode(n),y=ej.Matrix.identity(),nt,f,e,h,p=!1,u=ej.datavisualization.Diagram.NodeConstraints,w=i&&(i.isSwimlane||i.isLane||i.isPhase||i.type==="phase");(w||!w)&&(this._needUpdate=!1,r=null,i&&((i.isSwimlane||i.isLane)&&t.header&&(b=t.header,delete t.header,this.model.historyManager.startGroupAction(),p=!0),this._isUndo||this._isSizingCommand||this._recordPropertiesChanged(i,t,"node"),t.pivot!=undefined&&(nt=ej.datavisualization.Diagram.Util.bounds(i,!0),ej.Matrix.rotate(y,i.rotateAngle,i.offsetX,i.offsetY),t.pivot.x!==undefined&&(this._comparePropertyValues(i,"pivot.x",t),k=t.pivot.x-i.pivot.x,i.pivot.x=t.pivot.x,i.offsetX+=k*(i.width||i._width||0)),t.pivot.y!==undefined&&(this._comparePropertyValues(i,"pivot.y",t),d=t.pivot.y-i.pivot.y,i.pivot.y=t.pivot.y,i.offsetY+=d*(i.height||i._height||0)),h=ej.Matrix.transform(y,{x:i.offsetX,y:i.offsetY}),i.offsetX=h.x,i.offsetY=h.y),t.offsetX!=undefined&&(f=t.offsetX-i.offsetX,this._outOfBoundsOnNudge(i,f,0)&&(r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetX",oldValue:i.offsetX,newValue:i.offsetX+f},this._raisePropertyChange(r),this._translate(i,f,0,this.nameTable),i.marginLeft!=0&&(i.marginLeft+=f))),t.offsetY!=undefined&&(e=t.offsetY-i.offsetY,this._outOfBoundsOnNudge(i,0,e)&&(r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetY",oldValue:i.offsetY,newValue:i.offsetY+e},this._raisePropertyChange(r),this._translate(i,0,e,this.nameTable),i.marginTop!=0&&(i.marginTop+=e))),t.rotateAngle!=undefined&&(this._comparePropertyValues(i,"rotateAngle",t),this._rotate(i,t.rotateAngle-i.rotateAngle,this.nameTable)),i.isSwimlane||i.isLane?this._updateSwimlaneSize(i,t):(c=this.tools.resize,t.width!=undefined&&(i.width=i.width?i.width:1,r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"width",oldValue:i.width,newValue:t.width},this._raisePropertyChange(r),o=!1,s=i.isLane?!0:!1,c._outOfBoundsDrag(i,t.width/i.width,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY))&&(this.scale(i,t.width/i.width,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable,o,s),i.type==="bpmn"&&i._type==="group"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i,this))),t.height!=undefined&&(i.height=i.height?i.height:1,r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"height",oldValue:i.height,newValue:t.height},this._raisePropertyChange(r),o=!1,s=i.isLane?!0:!1,c._outOfBoundsDrag(i,1,t.height/i.height,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY))&&(this.scale(i,1,t.height/i.height,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable,o,s),i.type==="bpmn"&&i._type==="group"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i,this)))),t.connectorPadding!=undefined&&(this._comparePropertyValues(i,"connectorPadding",t),i.connectorPadding=t.connectorPadding,this.scale(i,1,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.visible!=undefined&&(this._comparePropertyValues(i,"visible",t),this._updateNodeVisibility(i,t),t.visible||this._clearSelection()),t.constraints!=undefined&&(this._comparePropertyValues(i,"constraints",t),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&((i._type!="group"||i.type==="bpmn")&&(i.constraints&u.Shadow||t.constraints&u.Shadow)&&(!(i.constraints&u.Shadow)&&t.constraints&u.Shadow?(i.constraints=t.constraints,i.type==="bpmn"&&i.children&&i.shape!="group"?(ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(i,this),ej.datavisualization.Diagram.DiagramContext.renderShadow(this.nameTable[this._getChild(i.children[0])],this)):ej.datavisualization.Diagram.DiagramContext.renderShadow(i,this)):i.constraints&u.Shadow&&!(t.constraints&u.Shadow)&&(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.removeShadow(i,this))),i.constraints=t.constraints,this.selectionList[0]&&this.selectionList[0].name===i.name&&(ej.datavisualization.Diagram.Util.canSelect(this.selectionList[0])?(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,undefined,this),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,this.selectionList[0].type==="pseudoGroup",this._currZoom,this._adornerLayer,this)):this._clearSelection(!0)))),t.fillColor!=undefined&&(this._comparePropertyValues(i,"fillColor",t),i.fillColor=t.fillColor),t.cssClass!=undefined&&(this._comparePropertyValues(i,"cssClass",t),i.cssClass=t.cssClass),t.opacity!=undefined&&(this._comparePropertyValues(i,"opacity",t),i.opacity=t.opacity),t.borderColor!=undefined&&(this._comparePropertyValues(i,"borderColor",t),i.borderColor=t.borderColor),t.borderWidth!=undefined&&(this._comparePropertyValues(i,"borderWidth",t),i.borderWidth=t.borderWidth),t.borderDashArray!=undefined&&(this._comparePropertyValues(i,"borderDashArray",t),i.borderDashArray=t.borderDashArray),t.shadow!=undefined&&(this._comparePropertyValues(i,"shadow",t),i.type==="bpmn"&&i.children&&i.shape!="group"?(i.children[0].shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,i.children[0].shadow,{},t.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(i.children[0],this)):(i.shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,i.shadow,{},t.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(i,this))),t.gradient!==undefined&&(this._comparePropertyValues(i,"gradient",t),i.gradient=t.gradient===null?t.gradient:t.gradient&&t.gradient.type==="radial"?ej.datavisualization.Diagram.RadialGradient(t.gradient):ej.datavisualization.Diagram.LinearGradient(t.gradient)),t.borderGradient!==undefined&&(this._comparePropertyValues(i,"borderGradient",t),i.borderGradient=t.borderGradient===null?t.borderGradient:t.borderGradient&&t.borderGradient.type==="radial"?ej.datavisualization.Diagram.RadialGradient(t.borderGradient):ej.datavisualization.Diagram.LinearGradient(t.borderGradient)),t.isExpanded!==undefined&&(this._comparePropertyValues(i,"isExpanded",t),i._updateExpander=!0,t.isExpanded?(i.isExpanded=!0,this._expandChildren(i)):(i.isExpanded=!1,this._collapseChildren(i)),this._selectionContains(i)&&(g=!0,this._clearSelection(!0)),this.layout(),g&&this._addSelection(i,!0)),t.tooltip!==undefined&&(this._comparePropertyValues(i,"tooltip",t),i.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,i.tooltip,{},t.tooltip))),t.excludeFromLayout!=undefined&&(this._comparePropertyValues(i,"excludeFromLayout",t),i.excludeFromLayout=t.excludeFromLayout,this.layout()),t.flip!=undefined&&(i.flip=t.flip,i._type==="group"&&this._updateFlipOffset(i,t.flip),this._updateAssociatedConnectorEnds(i,this.nameTable)),t.addInfo!=undefined&&(this._comparePropertyValues(i,"addInfo",t),i.addInfo=t.addInfo),t.maxWidth!=undefined&&(this._comparePropertyValues(i,"maxWidth",t),i.maxWidth=t.maxWidth),t.maxHeight!=undefined&&(this._comparePropertyValues(i,"maxHeight",t),i.maxHeight=t.maxHeight),i=this._findNode(n),t.shape&&typeof t.shape=="object"&&(this._comparePropertyValues(i,"shape",t),ej.datavisualization.Diagram.Util._updateShapeProperties(t),i.type=="html"&&(l=document.getElementById(i.name+"_parentdiv"),l.parentNode.removeChild(l)),ej.datavisualization.Diagram.DiagramContext.setNodeShape(i,this)),(this.getObjectType(i)=="node"||i.type=="bpmn")&&(i=this._updateShape(i,t)),i&&i.type!="phase"&&(ej.datavisualization.Diagram.DiagramContext.update(i,this),i.type=="bpmn"?ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(i,this):ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)));n&&(t&&t.pathData&&(a=i._absolutePath),i=this._findNode(n),a&&(i._absolutePath=a,i._absoluteBounds=null),i&&i._type==="node"&&t&&t.type==="group"&&t.children&&t.children.length>0&&(v=!1,this._svg.document.getElementById(i.name)&&(v=!0),this.remove(i),i.borderColor="transparent",i.borderDashArray="",i.borderWidth=1,i.fillColor="#1BA0E2",i.labels=[],i.fillColor="",i.type=t.type,i.children=t.children,i=ej.datavisualization.Diagram.Group(i),this._initGroupNode(i),v&&(ej.datavisualization.Diagram.Util._updateGroupBounds(i,this),this.add(i))));i&&(i.isLane||i.isSwimlane||i.type==="phase"||i.isPhase)&&(this._needUpdate=!0,t.header=b,i.isLane?this._updateLane(i,t):i.isSwimlane?(this._needUpdate=!1,this._updateSwimlane(i,t,!0)):(i.type==="phase"||i.phase)&&(this._needUpdate=!1,t.offset&&this._updatePhase({name:i.name,offset:t.offset}),this._updateSwimlanePhase(i,t)));p&&this.model.historyManager.closeGroupAction()}},_updateFlipOffset:function(n,t,i){var f,u,r;if(n&&n.children&&!n.isSwimlane&&!n.lane&&n.type!=="bpmn")for(f=this._getChildren(n.children),i&&t&&t!=="none"&&t!=="both"&&(n._flipRotateAngle=!0),n._flipRotateAngle&&(n.rotateAngle=360-n.rotateAngle,delete n._flipRotateAngle),t&&t!=="none"&&t!=="both"&&(n.rotateAngle=360-n.rotateAngle,n._flipRotateAngle=!0),u=0;u<f.length;u++)r=this.nameTable[this._getChild(f[u])],r._flip=t,i&&t&&t!=="none"&&t!=="both"&&(r._flipRotateAngle=!0),r._flipRotateAngle&&(r.rotateAngle=360-r.rotateAngle,delete r._flipRotateAngle),t&&t!=="none"&&t!=="both"&&(r.rotateAngle=360-r.rotateAngle,r._flipRotateAngle=!0),r._type!=="Group"?(i&&(t===ej.datavisualization.Diagram.FlipDirection.Horizontal||t===ej.datavisualization.Diagram.FlipDirection.Both)&&(r._flipOffsetX=!0),i&&(t===ej.datavisualization.Diagram.FlipDirection.Vertical||t===ej.datavisualization.Diagram.FlipDirection.Both)&&(r._flipOffsetY=!0),r._flipOffsetX&&(r.offsetX=n.offsetX-r.offsetX+n.offsetX,delete r._flipOffsetX),r._flipOffsetY&&(r.offsetY=n.offsetY-r.offsetY+n.offsetY,delete r._flipOffsetY),(t===ej.datavisualization.Diagram.FlipDirection.Horizontal||t===ej.datavisualization.Diagram.FlipDirection.Both)&&(r._flipOffsetX=!0),(t===ej.datavisualization.Diagram.FlipDirection.Vertical||t===ej.datavisualization.Diagram.FlipDirection.Both)&&(r._flipOffsetY=!0),r._flipOffsetX&&(r.offsetX=n.offsetX-r.offsetX+n.offsetX),r._flipOffsetY&&(r.offsetY=n.offsetY-r.offsetY+n.offsetY),t===ej.datavisualization.Diagram.FlipDirection.None&&delete r._flip):this._updateFlipOffset(r,t),this._updateAssociatedConnectorEnds(r,this.nameTable)},_updateSwimlaneSize:function(n,t){var o,f,e,r,i,u;if(n)if(t.height&&(this._comparePropertyValues(n,"height",t),o=t.height-n.height,this._comparePropertyValues(n,"offsetY",{offsetY:n.offsetY+o/2})),t.width&&(this._comparePropertyValues(n,"width",t),o=t.width-n.width,this._comparePropertyValues(n,"offsetX",{offsetX:n.offsetX+o/2})),n.isSwimlane&&(t.height||t.width)){if(r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,n),r.length>0&&(f=this.nameTable[this._getChild(r[r.length-1])],f)){if(n.orientation==="vertical"){if(t.width&&t.width>n.width&&(f.minWidth=f.width+t.width-n.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,f,!0)),t.height)for(i=0;i<r.length;i++)u=this.nameTable[this._getChild(r[i])],t.height>=n.height&&(u.minHeight=t.height)}else{if(t.width)for(i=0;i<r.length;i++)u=this.nameTable[this._getChild(r[i])],t.width>=n.width&&(u.minWidth=t.width);t.height&&t.height>n.height&&(f.minHeight=f.height+t.height-n.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,f,!0))}ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this);ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0);ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,n)}}else if(n.isLane&&(t.height||t.width)){if(e=this.nameTable[n.parent.split("laneStack")[0]],r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,e),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),e&&e.orientation==="vertical"){if(t.width&&(t.minWidth=t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0)),t.height)for(i=0;i<r.length;i++)u=this.nameTable[this._getChild(r[i])],t.height>=u.height&&(u.minHeight=t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,u,!0))}else{if(t.width)for(i=0;i<r.length;i++)u=this.nameTable[this._getChild(r[i])],t.width>=u.width&&(u.minWidth=t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,u,!0));t.height&&(t.minHeight=t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0))}ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,e,!0);ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,e)}},_updateShape:function(n,t){var i=!1,u,r,e,f,o;return t.type&&(this._comparePropertyValues(n,"type",t),n.type=n._shape=t.type,i=!0),t.shape&&(this._comparePropertyValues(n,"shape",t),n.shape=n._shape=t.shape,i=!0),n.type!="bpmn"?(t.cornerRadius!=undefined&&(this._comparePropertyValues(n,"cornerRadius",t),n.cornerRadius=t.cornerRadius,i=!0),t.pathData&&(this._comparePropertyValues(n,"pathData",t),n.pathData=t.pathData,i=!0),t.templateId!==undefined&&(n.templateId=t.templateId,i=!0),t.html!==undefined&&(this._comparePropertyValues(n,"html",t),n.html=t.html,i=!0),t.contentId!==undefined&&(this._comparePropertyValues(n,"contentId",t),n.contentId=t.contentId,i=!0),t.source&&(this._comparePropertyValues(n,"source",t),n.source=t.source,i=!0),t.textBlock&&(this._comparePropertyValues(n,"textBlock",t),n.textBlock=t.textBlock,i=!0),t.points&&(this._comparePropertyValues(n,"points",t),n.points=t.points,i=!0),i&&(n.children&&delete n.children,n=ej.datavisualization.Diagram.NodeType(n,this),u=document.getElementById(n.name+"_parentdiv"),u&&u.parentNode.removeChild(u),ej.datavisualization.Diagram.DiagramContext.setNodeShape(n,this),this._clearSelection(!0),this._addSelection(n,!0))):(r=$.extend(!0,{},this.nameTable[n.name]),t.event&&(this._comparePropertyValues(n,"event",t),r.event=t.event,i=!0),t.trigger&&(this._comparePropertyValues(n,"trigger",t),r.trigger=t.trigger,i=!0),t.gateway&&(this._comparePropertyValues(n,"gateway",t),r.gateway=t.gateway,i=!0),t.data&&(this._comparePropertyValues(n,"data",t),r.data=$.extend(r.data,t.data),i=!0),t.activity&&(this._comparePropertyValues(n,"activity",t),r.activity=t.activity,i=!0),t.task!==undefined&&(this._comparePropertyValues(n,"task",t),r.task=$.extend(r.task,t.task),i=!0),t.annotation!==undefined&&(this._comparePropertyValues(n,"annotation",t),r.annotation=$.extend(r.annotation,t.annotation),i=!0),t.subProcess!==undefined&&(this._comparePropertyValues(n,"subProcess",t),r.subProcess=$.extend(r.subProcess,t.subProcess),i=!0),t.direction&&(this._comparePropertyValues(n,"direction",t),r.direction=t.direction,i=!0),i&&(e=this._svg.getElementById(n.name).nextSibling,this._removeElement(n),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[n.name]),this._nodes=$.extend(!0,[],this.nodes()),n=ej.datavisualization.Diagram.NodeType(r,this),n=n.type=="bpmn"&&n.container?ej.datavisualization.Diagram.ContainerHelper._initContainer(this,n):this._getNewGroup(n),this._initGroupNode(n),this.nameTable[n.name]=n,this.nodes().push(n),n.parent&&(f=this.nameTable[n.parent],f&&(o=this._getChildIndexFromParent(f,n.name),f.children[o]=n)),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(n),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this),e&&this._svg.getElementById(n.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(e.id)),this._clearSelection(!0),this._addSelection(n,!0))),n},_getChildIndexFromParent:function(n,t){for(var i,r=0;r<n.children.length;r++)if(i=n.children[r],i=typeof i=="object"?i.name:i,i===t)return r;return null},_updateObject:function(n){var r,i,t,u;if(n)if(n.type=="pseudoGroup")for(i=this._getChildren(n.children),t=0,u=i.length;t<u;t++)r=this.nameTable[this._getChild(i[t])],ej.datavisualization.Diagram.DiagramContext.update(r,this);else n.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[n.parent],this),ej.datavisualization.Diagram.DiagramContext.update(n,this)},_udatePhaseSize:function(n,t){var i=this.nameTable[this._getChild(n.children[1])],s,o,h,f,u,r,e;if(n.orientation==="vertical"){if(i.minWidth!=t.phaseSize){if(i.width=i.maxWidth,i.minWidth=t.phaseSize,s=i.maxWidth-t.phaseSize,o=t.phaseSize/i.maxWidth,i.maxWidth=t.phaseSize,this.scale(i,o,.0001,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=this.nameTable[this._getChild(i.children[u])],r&&this.scale(r,o,.0001,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);e=this.nameTable[this._getChild(n.children[2])];e.marginLeft-=s}}else if(n.orientation==="horizontal"&&i.minHeight!=t.phaseSize){if(i.height=i.maxHeight,i.minHeight=t.phaseSize,h=i.maxHeight-t.phaseSize,f=t.phaseSize/i.maxHeight,f=f===Infinity?0:f,i.maxHeight=t.phaseSize,this.scale(i,.0001,f,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=this.nameTable[this._getChild(i.children[u])],r&&this.scale(r,.0001,f,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);e=this.nameTable[this._getChild(n.children[2])];e.marginTop-=h}},_updateLane:function(n,t){var u,i,f,r;n&&t&&(t.header&&(this._comparePropertyValues(this.getNode(n.name),"header",t),n.children&&n.children.length>0&&(u=this._getChild(n.children[0]),u&&(i=this.nameTable[u]),i&&(this.updateLabel(i.name,i.labels[0],t.header),t.header.fillColor&&t.header.fillColor!=i.fillColor&&this.updateNode(i.name,{fillColor:t.header.fillColor})))),t.fillColor&&t.fillColor!=n.fillColor&&(this._comparePropertyValues(n,"fillColor",t),this.updateNode(n.name,{fillColor:t.fillColor})),(t.minHeight&&t.minHeight!=n.minHeight||t.minWidth&&t.minWidth!=n.minWidth)&&(t.minHeight&&(this._comparePropertyValues(n,"minHeight",t),n.minHeight=t.minHeight),t.minWidth&&(this._comparePropertyValues(n,"minWidth",t),n.minWidth=t.minWidth),f=this.nameTable[n.parent],f&&(r=this.nameTable[f.parent],r&&ej.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(this,r)),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,r),ej.datavisualization.Diagram.SvgContext.updateSelector(r,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)),t.constraints&&t.constraints!=n.constraints&&(this._comparePropertyValues(n,"constraints",t),n.constraints=t.constraints))},_updateLastPhase:function(n,t,i){var r,u,e,f;n.isSwimlane&&n.phases&&n.phases.length==1&&(r=0,u=this.nameTable[this._getChild(n.phases[0])],n.orientation==="horizontal"?(u.offset=n.minWidth-r,this.updateNode(this.nameTable["phaseStack"+this._getChild(n.phases[0])].name,{width:n.minWidth-r}),i&&(f=ej.datavisualization.Diagram.Util.bounds(n),this.updateNode(this.nameTable["phaseStack"+this._getChild(n.phases[0])].name,{offsetX:f.x+n.width/2}))):n.orientation==="vertical"&&(u.offset=n.minHeight-r,e=u.offset-r,e=e-(t.header?t.header.height:50),this.updateNode(this.nameTable["phaseStack"+this._getChild(n.phases[0])].name,{height:e}),i&&(f=ej.datavisualization.Diagram.Util.bounds(n),this.updateNode(this.nameTable["phaseStack"+this._getChild(n.phases[0])].name,{offsetY:(t.header?t.header.height:50)/2+f.y+n.height/2}))))},_updateSwimlane:function(n,t,i){var s,e,r,h,c,f,p,v,u,o;t.header&&n.children&&n.children.length>0&&(s=this._getChild(n.children[0]),s&&(e=this.nameTable[s]),e&&(this._comparePropertyValues(this.getNode(n.name),"header",t),this.updateLabel(e.name,e.labels[0],t.header),t.header.fillColor&&t.header.fillColor!=e.fillColor&&this.updateNode(e.name,{fillColor:t.header.fillColor})));for(r in t)n[r]&&t[r]!==n[r]&&(r==="offsetX"?(this._comparePropertyValues(this.getNode(n.name),"offsetX",t),h=t.offsetX-n.offsetX,this._outOfBoundsOnNudge(n,h,0)&&this._translate(n,h,0,this.nameTable)):r==="offsetY"?(this._comparePropertyValues(this.getNode(n.name),"offsetY",t),c=t.offsetY-n.offsetY,this._outOfBoundsOnNudge(n,0,c)&&this._translate(n,0,c,this.nameTable)):r!=="minWidth"&&r!=="minHeight"&&r!=="maxwidth"&&r!=="maxHeight"&&r!="width"&&r!="height"&&r!="phaseSize"&&(n[r]=t[r]));if(t.phases&&t.phases.length>0)for(u=0;u<t.phases.length;u++)f=this.nameTable[this._getChild(t.phases[u])],f&&this._updateSwimlanePhase(f,t.phases[u],!0);if(i&&(t.phaseSize||t.phaseSize===0)&&t.phaseSize!==n.phaseSize){this._comparePropertyValues(this.getNode(n.name),"phaseSize",t);t.phaseSize!=n.phaseSize&&(p=!0);var l=this.nameTable[n.name+"phaseStack"],y=this.nameTable[n.name+"laneStack"],f,a=t.phaseSize-n.phaseSize;for(u=0;u<l.children.length;u++)f=this.nameTable[this._getChild(l.children[u])],f&&(t.phaseSize=t.phaseSize===0?.0001:t.phaseSize,n.orientation==="horizontal"?f.height=t.phaseSize:f.width=t.phaseSize);n.phaseSize+=a;n.orientation==="horizontal"?y.marginTop+=a:y.marginLeft+=a;ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,l,null,n)}if(t.lanes&&t.lanes.length>0)for(u=0;u<t.lanes.length;u++)v=this.nameTable[this._getChild(t.lanes[u])],v&&this._updateLane(v,t.lanes[u]);i||(t&&t.phaseSize&&(o=!1),t.minHeight&&t.minHeight!=n.minHeight&&(this._comparePropertyValues(this.getNode(n.name),"minHeight",t),n.minHeight=t.minHeight,o=!0),t.minWidth&&t.minWidth!=n.minWidth&&(this._comparePropertyValues(this.getNode(n.name),"minWidth",t),n.minWidth=t.minWidth,o=!0),t.maxHeight&&t.maxHeight!=n.maxHeight&&(this._comparePropertyValues(this.getNode(n.name),"maxHeight",t),n.minHeight=t.maxHeight,o=!0),t.maxWidth&&t.maxWidth!=n.maxWidth&&(this._comparePropertyValues(this.getNode(n.name),"maxWidth",t),n.minWidth=t.maxWidth,o=!0),o&&!this._isUndo&&this._updateLastPhase(n,t),(t.phaseSize||t.phaseSize===0)&&t.phaseSize!=n.phaseSize&&(this._comparePropertyValues(this.getNode(n.name),"phaseSize",t),this._udatePhaseSize(n,t),t.phaseSize===0&&(n.phaseSize=0)));ej.datavisualization.Diagram.DiagramContext.update(n,this);this.selectionList[0]&&this.selectionList[0].name===n.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},updateConnector:function(n,t){var i,o,r,s,h,f;if(n&&(i=this._findConnector(n),i)){if(this._isUndo||ej.datavisualization.Diagram.Util.canRouteDiagram(this)||this._recordPropertiesChanged(i,t,"connector"),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&t.constraints!==undefined&&(this._comparePropertyValues(i,"constraints",t),i.constraints=t.constraints,!ej.datavisualization.Diagram.Util.canSelect(i)&&ej.datavisualization.Diagram.Util.enableLayerOption(i,"lock",this)&&this._clearSelection(!0)),t.lineColor&&(this._comparePropertyValues(i,"lineColor",t),i.lineColor=t.lineColor),(t.cssClass||t.cssClass==="")&&(this._comparePropertyValues(i,"cssClass",t),i.cssClass=t.cssClass),(t.lineWidth||t.lineWidth===0)&&(this._comparePropertyValues(i,"lineWidth",t),i.lineWidth=t.lineWidth),t.lineDashArray!==undefined&&(this._comparePropertyValues(i,"lineDashArray",t),i.lineDashArray=t.lineDashArray),i.shape&&i.shape.type=="umlclassifier"&&t.shape&&t.shape.multiplicity!=undefined)for(i.shape.multiplicity=t.shape.multiplicity,i.shape.multiplicity=ej.datavisualization.Diagram.UMLConnectorMultiplicity(i.shape.multiplicity),o=ej.datavisualization.Diagram.ClassifierHelper.umlConnectorMultiplicity(i),r=0;r<i.labels.length;r++)i.labels[r].name==i.name+"_sourcelabel"?i.labels[r].text=o[0].text:i.labels[r].name==i.name+"_targetlabel"&&(i.labels[r].text=o[1].text);if(t.opacity!==undefined&&(this._comparePropertyValues(i,"opacity",t),i.opacity=t.opacity),t.cornerRadius!==undefined&&(this._comparePropertyValues(i,"cornerRadius",t),i.cornerRadius=t.cornerRadius),t.lineHitPadding!==undefined&&(this._comparePropertyValues(i,"lineHitPadding",t),i.lineHitPadding=t.lineHitPadding),t.sourcePadding!=undefined&&(this._comparePropertyValues(i,"sourcePadding",t),i.sourcePadding=t.sourcePadding,this._dock(i,this.nameTable)),t.targetPadding!=undefined&&(this._comparePropertyValues(i,"targetPadding",t),i.targetPadding=t.targetPadding,this._dock(i,this.nameTable)),t.visible!=undefined&&(this._comparePropertyValues(i,"visible",t),i.visible=t.visible,t.visible||this._clearSelection()),t.flip!==undefined&&(i.flip=t.flip,ej.datavisualization.Diagram.Util.flipConnector(i,i.flip)),t.bridgeSpace!=undefined&&(this._comparePropertyValues(i,"bridgeSpace",t),i.bridgeSpace=t.bridgeSpace),t.tooltip!==undefined&&(this._comparePropertyValues(i,"tooltip",t),i.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,i.tooltip,{},t.tooltip))),t.segments&&(this._comparePropertyValues(i,"segments",t),t.segments.length>1?(s=$.extend(!0,[],t.segments),i.segments=s):i.segments=t.segments,ej.datavisualization.Diagram.Util._initConnectionEnds(i,this),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments.length&&(h=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initializeSegments(i,h),this._dock(i,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(i,this),i==this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSegments(this._adornerSvg),ej.datavisualization.Diagram.SvgContext.addSegments(this._adornerSvg,this.selectionList[0],this._currZoom))),t.targetDecorator&&(this._comparePropertyValues(i,"targetDecorator",t),f=i.targetDecorator?$.extend(!0,{},i.targetDecorator,t.targetDecorator):ej.datavisualization.Diagram.Decorator(t.targetDecorator),i.targetDecorator=f),t.sourceDecorator&&(this._comparePropertyValues(i,"sourceDecorator",t),f=i.sourceDecorator?$.extend(!0,{},i.sourceDecorator,t.sourceDecorator):ej.datavisualization.Diagram.Decorator(t.sourceDecorator),i.sourceDecorator=f),(t.sourceDecorator||t.targetDecorator)&&(ej.datavisualization.Diagram.DiagramContext.clearDecorators(i,this),ej.datavisualization.Diagram.DiagramContext.renderDecorators(i,this)),t.hasOwnProperty("sourceNode")||t.hasOwnProperty("targetNode")||t.hasOwnProperty("targetPort")||t.hasOwnProperty("sourcePort")||t.hasOwnProperty("targetPoint")||t.hasOwnProperty("sourcePoint")){if(t.sourceNode!==undefined){this._comparePropertyValues(i,"sourceNode",t);var u=this.nameTable[i.sourceNode],c=this.nameTable[t.sourceNode],l=this.nameTable[i.targetNode],e=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(c,l,i,this);t.sourceNode=e?e.name:null;u&&u.outEdges.indexOf(i.name)!=-1&&ej.datavisualization.Diagram.Util.removeItem(u.outEdges,i.name);i.sourceNode=t.sourceNode}if(t.targetNode!==undefined){this._comparePropertyValues(i,"targetNode",t);var c=this.nameTable[i.sourceNode],l=this.nameTable[t.targetNode],u=this.nameTable[i.targetNode],e=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(l,c,i,this);t.targetNode=e?e.name:null;u&&u.inEdges.indexOf(i.name)!=-1&&ej.datavisualization.Diagram.Util.removeItem(u.inEdges,i.name);i.targetNode=t.targetNode}t.targetPort!==undefined&&(this._comparePropertyValues(i,"targetPort",t),i.targetPort=t.targetPort);t.sourcePort!==undefined&&(this._comparePropertyValues(i,"sourcePort",t),i.sourcePort=t.sourcePort);t.targetPoint!==undefined&&(this._comparePropertyValues(i,"targetPoint",t),ej.datavisualization.Diagram.Util._setLineEndPoint(i,t.targetPoint,!0));t.sourcePoint!==undefined&&(this._comparePropertyValues(i,"sourcePoint",t),ej.datavisualization.Diagram.Util._setLineEndPoint(i,t.sourcePoint,!1));this._updateEdges(i);this._dock(i,this.nameTable)}ej.datavisualization.Diagram.Util.updateBridging(i,this);this._svg&&(this._updateConnectorBridging(i),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateConnectorStyle(i,this));this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},_updateDrawType:function(n){var u,i=!1,r,o=n.tool,t,s;if(o&ej.datavisualization.Diagram.Tool.ContinuesDraw?i=!1:o&ej.datavisualization.Diagram.Tool.DrawOnce&&(i=!0),t=n.drawType?n.drawType:this.model.drawType,t)if(t.type!=="connector"||this.activeTool._isPolyline()){if(t.type==="text")this.activateTool("text",i);else if(t.type||t.shape){u=t.shape?t.shape:t.type;t.type=="basic"?r=ej.datavisualization.Diagram.BasicShapes:t.type=="flow"?r=ej.datavisualization.Diagram.FlowShapes:t.type=="arrow"?r=ej.datavisualization.Diagram.ArrowShapes:t.type=="bpmn"&&(r=ej.datavisualization.Diagram.BPMNShapes);for(s in r)if(r[s]==t.shape){u=t.type;break}u&&this._drawToolShape(u,i)}}else{var f=this.model.defaultSettings.connector,h=f&&f.segments&&f.segments.length?f.segments[0].type:"",e=t.segments&&t.segments.length&&t.segments[0].type?t.segments[0].type:h;e==="bezier"||this.model.connectorType==="bezierLine"?this.activateTool("bezierLine",i):e==="orthogonal"||this.model.connectorType==="orthogonalLine"?this.activateTool("orthogonalLine",i):(e==="straight"||this.model.connectorType==="straightLine")&&this.activateTool("straightLine",i)}},update:function(n){var t,u,r,f,i;if(n.scrollSettings&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Unknown,this._setModel({scrollSettings:n.scrollSettings})),n.backgroundColor&&this._setModel({backgroundColor:n.backgroundColor}),n.tool&&(this.activeTool._showAllPorts(!0),t=n.tool,this.tool(t),this._compareModelProperty("tool"),t&ej.datavisualization.Diagram.Tool.ContinuesDraw||t&ej.datavisualization.Diagram.Tool.DrawOnce?this._updateDrawType(n):t&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):t&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select",!1)),n.bridgeDirection)for(this.bridgeDirection(typeof n.bridgeDirection=="function"?n.bridgeDirection():n.bridgeDirection),this._compareModelProperty("bridgeDirection"),u=this.connectors(),r=0,f=u.length;r<f;r++)i=u[r],i&&ej.datavisualization.Diagram.Util.canBridge(i,this)&&(ej.datavisualization.Diagram.Util.updateBridging(i,this),ej.datavisualization.Diagram.DiagramContext.update(i,this));n.rulerSettings&&this._setModel({scrollSettings:n.scrollSettings})},bringToCenter:function(n){var t=this._currZoom,r=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),i={x:n.x*t,y:n.y*t,width:n.width*t,height:n.height*t},u=i.x+i.width/2-r.width/2,f=i.y+i.height/2-r.height/2;ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-u,this._vScrollOffset-f,null,!1)},bringIntoView:function(n){var r=0,u=0,t=this._currZoom,o;n.right=n.right?n.right:n.x+n.width;n.bottom=n.bottom?n.bottom:n.y+n.height;var f=this._hScrollOffset,e=this._vScrollOffset,i=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);n={x:n.x*t,y:n.y*t,width:n.width*t,height:n.height*t,right:n.right*t,bottom:n.bottom*t};o={x:this._hScrollOffset,y:this._vScrollOffset,width:i.width,height:i.height};ej.datavisualization.Diagram.Geometry.containsRect(o,n)||(n.right>-f+i.width&&(r=n.right-i.width),n.x<-f&&(r=n.x),n.bottom>-e+i.height&&(u=n.bottom-i.height),n.y<-e&&(u=n.y),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-r,this._vScrollOffset-u,null,!1))},getBridgeSegment:function(n,t,i,r,u){return"A "+r/2+" "+r/2+"  "+i+" , 1 "+u+" "+t.x+","+t.y},fitToPage:function(n,t,i,r){var u,o,e={},f,h=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),l,v,a,s,c,y;if(i=i||{},i={top:isNaN(i.top)?25:i.top,bottom:isNaN(i.bottom)?25:i.bottom,left:isNaN(i.left)?25:i.left,right:isNaN(i.right)?25:i.right},t=t?t:"pageSettings",t=="pageSettings"&&this.model.pageSettings.pageWidth&&this.model.pageSettings.pageHeight||this.nodes().length>0||this.connectors().length>0){n=n?n:"page";t!="custom"&&(f=this._getDigramBounds(t),f.x-=this.model.scrollSettings.padding.left,f.y-=this.model.scrollSettings.padding.top,f.width+=this.model.scrollSettings.padding.left+this.model.scrollSettings.padding.right,f.height+=this.model.scrollSettings.padding.top+this.model.scrollSettings.padding.bottom);l=f.width;v=f.height;e.x=(h.width-(i.left+i.right))/l;e.y=(h.height-(i.top+i.bottom))/v;r||this._vScrollbar&&this._vScrollbar._scrollData||this._hScrollbar&&this._hScrollbar._scrollData||(e.x=Math.min(1,e.x),e.y=Math.min(1,e.y));a=this._hScrollOffset;s=this._vScrollOffset;switch(n){case"width":u=e.x;o=u/this._getCurrentZoom();c=(h.width-(t!="content"?f.width:l)*u)/2-f.x*u;a+=c+(i.left-i.right)/2*u;s-=this._vScrollOffset*o;s=t!="custom"?s:s+this._vScrollOffset*o;break;case"height":u=e.y;o=u/this._getCurrentZoom();c=(h.width-(t!="content"?f.width:l)*u)/2-f.x*u;y=(h.height-(t!="content"?f.height:v)*u)/2-f.y*u;a+=c+(i.left-i.right)/2*u;s+=y+(i.top-i.bottom)/2*u;break;case"page":u=Math.min(e.x,e.y);o=u/this._getCurrentZoom();c=(h.width-(t!="content"?f.width:l)*u)/2-f.x*u;y=(h.height-(t!="content"?f.height:v)*u)/2-f.y*u;a+=c+(i.left-i.right)/2*u;s+=y+(i.top-i.bottom)/2*u}ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,o,a,s,new ej.datavisualization.Diagram.Point(0,0),!0)}else o=1/this._getCurrentZoom(),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,o,this._hScrollOffset,this._vScrollOffset,new ej.datavisualization.Diagram.Point(0,0),!0)},_convertImagesToBuffer:function(n){for(var i,t,f=[],r=0;r<n.length;r++){i=n[r];i=i.replace(/^data:[a-z]*;,/,"");var o=i.split(","),u=atob(o[1]),e=new ArrayBuffer(u.length),s=new Uint8Array(e);for(t=0;t<u.length;t++)s[t]=u.charCodeAt(t);f.push(e)}return f},_downloadImage:function(n,t,i,r){var u=ej.browserInfo(),h,e,o,f,c,s;if(u.name==="msie"&&parseFloat(u.version)<10||u.name=="webkit")return h=u.name=="webkit"?"Safari":"IE-9",alert("Downloading option is not supported in "+h+", Please use the returned data"),r;for(e=0;e<n.length;e++)o=new Blob([n[e]],{type:"application/octet-stream"}),u.name==="msie"||u.name==="edge"?window.navigator.msSaveOrOpenBlob(o,t+"."+i):(f=document.createElement("a"),c=URL.createObjectURL(o),f.href=c,f.setAttribute("download",t+"."+i),document.createEvent?(s=document.createEvent("MouseEvents"),s.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(s)):f.fireEvent&&f.fireEvent("onclick"))},exportImage:function(n,t){var e,i,r,f,o,u;t=ej.datavisualization.Diagram.ExportSettings(t);e=t&&t.region?t.region:"content";i=t.margin||{};i={top:isNaN(i.top)?25:i.top,bottom:isNaN(i.bottom)?25:i.bottom,left:isNaN(i.left)?25:i.left,right:isNaN(i.right)?25:i.right};r=this._getDigramBounds(e);t.bounds&&(r={x:isNaN(t.bounds.x)?r.x:t.bounds.x,y:isNaN(t.bounds.y)?r.y:t.bounds.y,width:t.bounds.width||r.width,height:t.bounds.height||r.height});f=document.createElement("img");o={src:n};ej.datavisualization.Diagram.Util.attr(f,o);u=this;f.onload=function(){var f=new ej.datavisualization.Diagram.Canvas({width:r.width+(i.left+i.right),height:r.height+(i.top+i.bottom)}),e=f.document.getContext("2d"),h,c,o,a,s,v,l,y;if(e.fillStyle=u._pageBackgroundColor(),e.fillRect(0,0,r.width+(i.left+i.right),r.height+(i.top+i.bottom)),e.drawImage(this,r.x,r.y,r.width,r.height,i.left,i.top,r.width,r.height),n=f.document.toDataURL(),t.printOptions){u._raisePrintAction(n,t.printOptions);return}e.restore();h=t.fileName||"diagram";c=t.format||"jpg";t.multiplePage?(t.pageHeight=t.pageHeight?t.pageHeight:u.model.pageSettings.pageHeight,t.pageWidth=t.pageWidth?t.pageWidth:u.model.pageSettings.pageWidth,t.pageHeight=t.pageHeight?t.pageHeight:f.width,t.pageWidth=t.pageWidth?t.pageWidth:f.height,t.pageOrientation=u.model.pageSettings.pageOrientation||t.pageOrientation,i=t.margin||{},o=!1,t.pageOrientation==ej.datavisualization.Diagram.PageOrientations.Landscape?t.pageHeight>t.pageWidth&&(o=!0):t.pageWidth>t.pageHeight&&(o=!0),o&&(a=t.pageWidth,t.pageWidth=t.pageHeight,t.pageHeight=a),t.margin={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right},s=document.createElement("img"),v={id:u.element[0].id+"_printImage",src:n},ej.datavisualization.Diagram.Util.attr(s,v),s.onload=function(){var n=u._getMultipleImage(s,t,!0),i=u._convertImagesToBuffer(n);u._downloadImage(i,h,c,n)}):(l=[n],y=u._convertImagesToBuffer(l),u._downloadImage(y,h,c,l))}},exportDiagram:function(n){var f,g,r,u,i,v,e,y,p,o,w,b,k,s,d,h,tt,c,it,l,rt,ut,ft;n=ej.datavisualization.Diagram.ExportSettings(n);u=[];n||(n={});var nt=n&&n.region?n.region:"content",a=n&&n.mode?n.mode:"download",t=n.margin||{};if(t={top:isNaN(t.top)?25:t.top,bottom:isNaN(t.bottom)?25:t.bottom,left:isNaN(t.left)?25:t.left,right:isNaN(t.right)?25:t.right},i=this._getDigramBounds(nt),n.bounds&&(g=!0,i={x:isNaN(n.bounds.x)?i.x:n.bounds.x,y:isNaN(n.bounds.y)?i.y:n.bounds.y,width:n.bounds.width||i.width,height:n.bounds.height||i.height}),!n.bounds)for(v=this.nodes(),e=0;e<v.length;e++)for(y=v[e],p=y.labels,o=0;o<p.length;o++)w=p[o],w.visible&&(b=ej.datavisualization.Diagram.Util.getLabelbounds(this,y,w)),b&&(i=this._union(b,i));if(i.x-=t.left,i.y-=t.top,i.width+=t.left+t.right,i.height+=t.top+t.bottom,k=n.fileName||"diagram",n.format!="svg"){if(this._setScaleValueforCanvas(n,i),s=this._diagramAsCanvas({bounds:i,margin:t,region:nt,scaleX:n._scaleX,scaleY:n._scaleY},g),f=n.format||"jpg",d=r=s.toDataURL(),a=="data")return r;ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10||(n.multiplePage?(n.pageHeight=n.pageHeight?n.pageHeight:this.model.pageSettings.pageHeight,n.pageWidth=n.pageWidth?n.pageWidth:this.model.pageSettings.pageWidth,n.pageHeight=n.pageHeight?n.pageHeight:s.width,n.pageWidth=n.pageWidth?n.pageWidth:s.height,n.pageOrientation=this.model.pageSettings.pageOrientation||n.pageOrientation,t=n.margin||{},h=!1,n.pageOrientation==ej.datavisualization.Diagram.PageOrientations.Landscape?n.pageHeight>n.pageWidth&&(h=!0):n.pageWidth>n.pageHeight&&(h=!0),h&&(tt=n.pageWidth,n.pageWidth=n.pageHeight,n.pageHeight=tt),n.margin={top:isNaN(t.top)?0:t.top,bottom:isNaN(t.bottom)?0:t.bottom,left:isNaN(t.left)?0:t.left,right:isNaN(t.right)?0:t.right},c=document.createElement("img"),it={id:this.element[0].id+"_printImage",src:d},ej.datavisualization.Diagram.Util.attr(c,it),l=this,c.onload=function(){var t=l._getMultipleImage(c,n,!0);u=l._convertImagesToBuffer(t);l._downloadImage(u,k,f,r)}):(rt=[d],u=this._convertImagesToBuffer(rt)))}else{if(f=n.format||"svg",ut=r=this._diagramAsSvg({bounds:i,margin:t}),a=="data")return r;ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10||(ft=(new XMLSerializer).serializeToString(ut),u.push(ft))}a=="download"&&this._downloadImage(u,k,f,r)},_diagramAsSvg:function(n){var i=new ej.datavisualization.Diagram.Svg({id:"diagram_svg",width:n.bounds.width,height:n.bounds.height}),t,o,r,f,h,s,u,c;document.body.appendChild(i.document);t=this._svg.document.getElementById(this._canvas.id+"_pageBackground");t=$(t).find("#pageback")[0];t=t.cloneNode(!0);var e=this._getDigramBounds(),l=e.x,a=e.y,v=e.width,y=e.height;for(i.appendChild(t),t.setAttribute("transform","translate("+-n.bounds.x+", "+-n.bounds.y+")"),t.setAttribute("x",l),t.setAttribute("y",a),t.setAttribute("width",v),t.setAttribute("height",y),t=this._svg.document.getElementById(this._canvas.id+"_diagramLayer"),t=t.cloneNode(!0),i.appendChild(t),t.setAttribute("transform","translate("+-n.bounds.x+", "+-n.bounds.y+")"),o=this.nodes(),u=0;u<o.length;u++)if(r=o[u],r._type=="group"?ej.datavisualization.Diagram.SvgContext._renderLabelGroup(r,i,this):ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(r,i,this),r.annotation&&r._annotation&&r._annotation.length)for(f=0;f<r._annotation.length;f++)diagram.nameTable[r._annotation[f]]&&(h=diagram.nameTable[r._annotation[f]],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(h,i,this));for(s=this.connectors(),u=0;u<s.length;u++)c=s[u],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(c,i,this);return document.body.removeChild(i.document),i.appendChild(this._svg.document.getElementById(this._canvas.id+"patterndefinition").cloneNode(!0)),i.document},_setScaleValueforCanvas:function(n,t){n._scaleX=1;n._scaleY=1;n.pageHeight=n.pageHeight?n.pageHeight:this.model.pageSettings.pageHeight;n.pageWidth=n.pageWidth?n.pageWidth:this.model.pageSettings.pageWidth;var i=n.pageHeight?n.pageHeight:t.height,r=n.pageWidth?n.pageWidth:t.width;(n.stretch==="fill"||n.stretch==="uniform"||n.stretch==="uniformtofill")&&(n._scaleX=r/t.width,n._scaleY=i/t.height,n.stretch==="uniform"?n._scaleX=n._scaleY=Math.min(n._scaleX,n._scaleY):n.stretch==="uniformtofill"&&(n._scaleX=n._scaleY=Math.max(n._scaleX,n._scaleY)),t.width=r,t.height=i);t.x*=n._scaleX;t.y*=n._scaleY},_diagramAsCanvas:function(n){var h,u,t,s=n.margin,e=t=n.bounds,nt=this._pageBackgroundColor(),o=new ej.datavisualization.Diagram.Canvas({id:"mycanvas",width:e.width,height:e.height}),i,r,f,a,w,b,v;if(o._diagram=this,o._scaleX=n.scaleX,o._scaleY=n.scaleY,i=o.document.getContext("2d"),i.fillStyle=this._backgroundColor(),i.translate(-e.x,-e.y),i.fillRect(e.x,e.y,e.width,e.height),r=this._backgroundImage(),r&&r.source){f=new Image;f.src=r.source;var k=t.width/f.width,d=t.height/f.height,c=t.x,l=t.y,y=t.width,p=t.height,g=ej.datavisualization.Diagram.CanvasContext._isImageExportable(r);r.scale!="none"&&r.alignment!="none"?(a=r.scale=="meet"?Math.min(k,d):Math.max(k,d),y=a*f.width,p=a*f.height,r.alignment.indexOf("xmid")>-1?c+=(t.width-y)/2:r.alignment.indexOf("xmax")>-1&&(c=c+t.width-y),r.alignment.indexOf("ymid")>-1?l+=(t.height-p)/2:r.alignment.indexOf("ymax")>-1&&(l=l+t.height-p),(this._backgroundColor()=="none"||this._backgroundColor()=="transparent")&&(i.fillStyle="white",i.fillRect(t.x*n.scaleX,t.y*n.scaleY,t.width*n.scaleX,t.height*n.scaleY)),g&&i.drawImage(f,c,l,a*f.width,a*f.height)):g&&i.drawImage(f,c,l,t.width,t.height)}else i.fillStyle=nt,i.fillRect(t.x*n.scaleX-s.left,t.y*n.scaleY-s.top,t.width*n.scaleX+s.left+s.right,n.scaleY*t.height+s.top+s.bottom);for(w=this._pageBorderColor(),b=this._pageBorderWidth(),b&&(i.strokeStyle=w=="none"?"transparent":w,i.lineWidth=b,i.strokeRect(t.x*n.scaleX,t.y*n.scaleY,t.width*n.scaleX,t.height*n.scaleY)),h=this.nodes().concat(this.connectors()),h=this._sortByZIndex(h,!0),this._sortByGroupChildrenZIndex(!0),v=0;v<h.length;v++)u=h[v],ej.datavisualization.Diagram.Util.enableLayerOption(u,"print",this)&&(u.segments?ej.datavisualization.Diagram.CanvasContext.renderConnector(u,o):u._type!=="group"||u.parent?u._type!=="node"||u.isPhase||u.parent||ej.datavisualization.Diagram.CanvasContext.renderNode(u,o,this):ej.datavisualization.Diagram.CanvasContext.renderGroup(u,o,this));return o.document},_renderCanvasPhase:function(n,t){var h=0,e=0,y=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,n),o,c,l,p,s,r,a,v,f;if(y)for(c=0;c<y.length;c++){if(o=this.nameTable[this._getChild(y[c])],l=this.nameTable[n.name],l){p=this._getChildren(l.children);p.length>1&&(s=this.nameTable[p[0]]);var u=ej.datavisualization.Diagram.Util.bounds(l),i=[],w,b=u.top+50,k=u.left+50;if(o.orientation=="vertical")for(i.push({x:0,y:0}),i.push({x:u.width,y:0}),w=ej.datavisualization.Diagram.SvgContext._convertToSVGPoints(i),h=u.x,e=u.y+o.offset,s&&(e+=s.height),r=0,a=i.length;r<a;++r)f=ej.datavisualization.Diagram.Geometry.translate(i[r],h,e),i[r]=f;else for(i.push({x:0,y:s.height?s.height:0}),i.push({x:0,y:u.height}),h=u.x+o.offset,e=u.y,r=0,a=i.length;r<a;++r)f=ej.datavisualization.Diagram.Geometry.translate(i[r],h,e),i[r]=f}for(v=0;v<i.length;v++)f=i[v],f.x*=t._scaleX,f.y*=t._scaleY;ej.datavisualization.Diagram.CanvasContext.renderPhases(o,t,i)}},_getPrintCanvasStyle:function(n,t){var i=0,r=0,u;return n&&(i=n.width,r=n.height),t&&((t.pageHeight||t.pageWidth)&&(r=t.pageHeight?t.pageHeight:r,i=t.pageWidth?t.pageWidth:i),t.pageOrientation&&(t.pageOrientation==="landscape"&&r>i?u=i:t.pageOrientation==="portrait"&&i>r&&(u=i),u&&(i=r,r=u))),{height:r,width:i}},_getMultipleImage:function(n,t,i){var ft=[],l=document.createElement("div"),r=this._getPrintCanvasStyle(n,t),a,v,d=t.margin,u=d.left,f=d.top,y=d.right,p=d.bottom,k=0,g=0,e,o,w,b,ut;if(a=r.width+k,v=r.height+g,e=0,o=0,t&&t.multiplePage){if(l.style.height="auto",l.style.width="auto",w=n.height,b=n.width,n){var nt=0,rt=0,c,s,h,tt=0,it=0;do{do tt=r.width,it=r.height,e+r.width>=b&&(tt=b-e),o+r.height>=w&&(it=w-o),h=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint"+nt+""+rt,width:r.width,height:r.height}),s=h.document.getContext("2d"),s.drawImage(n,k+e+u,g+o+f,tt-y-u,it-p-f,0+u,0+f,tt-y-u,it-p-f),e+r.width>=b&&(e-=e-b),c=h.document.toDataURL(),s.restore(),e+=a,i?ft.push(c):this._printImage(l,c,nt+""+rt),nt++;while(e<b);rt++;nt=k=e=0;o+r.height>=w&&(o-=o-w);o+=v}while(o<w)}}else if(!t||t.region!=="content"||t.pageWidth||t.pageHeight){var k=0,g=0,r=this._getPrintCanvasStyle(n,t),a,v;a=r.width;v=r.height;h=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint0",width:n.width,height:n.height});s=h.document.getContext("2d");ut=Math.min(n.width/a,n.height/v);a=n.width*ut;v=n.height*ut;s.drawImage(n,k+u,g+f,n.width-(y+u),n.height-(f+p),0+u,0+f,a-(y+u),v-(f+p));c=h.document.toDataURL();s.restore();this._printImage(l,c,0)}else h=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint10",width:n.width,height:n.height}),s=h.document.getContext("2d"),s.drawImage(n,k+u,g+f,n.width-(y+u),n.height-(f+p),0+u,0+f,n.width-(y+u),n.height-(f+p)),c=h.document.toDataURL(),s.restore(),this._printImage(l,c,0);return i?ft:l},_printImage:function(n,t,i){var f,r,u;f=document.createElement("img");r=document.createElement("div");u={"class":"e-diagram-print-page"};ej.datavisualization.Diagram.Util.attr(r,u);u={id:this.element[0].id+"_multiplePrint_img"+i,style:"float:left",src:t};ej.datavisualization.Diagram.Util.attr(f,u);r.appendChild(f);n.appendChild(r)},printImage:function(n,t){t=t||{};var i=t.margin||{};i={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right};t=ej.datavisualization.Diagram.PrintSettings(t);this.exportImage(n,{printOptions:t,region:t.region,margin:i})},_raisePrintAction:function(n,t){var i=document.createElement("img"),u={id:this.element[0].id+"_printImage",src:n},r;ej.datavisualization.Diagram.Util.attr(i,u);r=this;i.onload=function(){var u=r._getMultipleImage(i,t),n=window.open("");n!=null&&(n.opener=null,n.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page {page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}  <\/style><title><\/title><\/head>"),n.document.write('<BODY onload="setTimeout(function(){window.print();}, 100)">'),n.document.write("<center>"+u.innerHTML+"<\/center>"),n.document.close())}},print:function(n){n=ej.datavisualization.Diagram.PrintSettings(n);var t=this.exportDiagram({mode:"data",region:n.region,margin:{top:10,bottom:10,left:10,right:10},stretch:n.stretch});this._raisePrintAction(t,n)},save:function(){var i=this.model.drawingTools,r=this.model.selectedItems.userHandles,n,t;for(this.model.drawingTools=null,this.model.selectedItems.userHandles=[],this.nameTable.multipleSelection&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable.multipleSelection),this._nodes=$.extend(!0,[],this.nodes())),this._updateTableNodes(),n=jQuery.extend(!0,{},this.model),t=0;t<n.nodes.length;t++)this._resetValues(n.nodes[t]);for(t=0;t<n.connectors.length;t++)this._resetValues(n.connectors[t]);return delete n.historyManager,ej.version&&(n.version=ej.version),this._updateGroupChildren(n),this.model.drawingTools=i,this.model.selectedItems.userHandles=r,this._checkForNullValues(n),this.model.serializationSettings.preventDefaultValues&&(n=this._optimizeJson(n)),n},_updateDefaults:function(n){var i,t;this.defaultTabels||(this.defaultTabels={},this.defaultTabels.defaults=$.extend(!0,{},this.defaults),this.defaultTabels.defaults.snapSettings.verticalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],this.defaultTabels.defaults.snapSettings.horizontalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],this.defaultTabels.defaults.tooltip=this.defaultTabels.defaults.selectedItems.tooltip=ej.datavisualization.Diagram.TooltipDefaults);n&&n.type&&(this.defaultTabels[n.type]||(n.type==="group"&&n.isSwimlane?(i=ej.datavisualization.Diagram.SwimLane({}),i.phases=[ej.datavisualization.Diagram.Phase({label:{text:"Phase"}})],i.lanes=[ej.datavisualization.Diagram.Lane({})],this.defaultTabels.Swimlane=i):n.type==="group"?this.defaultTabels[n.type]=$.extend(!1,ej.datavisualization.Diagram.Group(this.model.defaultSettings.group?this.model.defaultSettings.group:{type:n.type})):n.type==="connector"?this.defaultTabels[n.type]=ej.datavisualization.Diagram.ConnectorDefaults:n.type==="textBlock"?this.defaultTabels[n.type]=ej.datavisualization.Diagram.TextBlockDefaults:n.type==="labels"||n.type==="label"?this.defaultTabels[n.type]=ej.datavisualization.Diagram.LabelDefaults:n.type==="ports"?this.defaultTabels[n.type]=ej.datavisualization.Diagram.PortDefaults:n.type==="basic"||n.type==="flow"||n.type==="arrow"||n.type==="bpmn"||n.type==="text"||n.type==="image"||n.type==="native"||n.type==="html"||n.type==="node"?(t=ej.datavisualization.Diagram.Node($.extend(!1,{type:n.type},ej.datavisualization.Diagram.NodeBase({type:n.type}),ej.datavisualization.Diagram.NodeType({type:n.type,shape:n.shape},this))),t.container&&(t.container=ej.datavisualization.Diagram.Container(t.container)),this.defaultTabels[n.type]=t):(n.type==="umlclassifier"||n.type==="umlactivity")&&(t=ej.datavisualization.Diagram.Node($.extend(!1,{type:n.type},ej.datavisualization.Diagram.NodeBase({type:n.type}),ej.datavisualization.Diagram.NodeType({type:n.type,shape:n.shape,classifier:n.classifier,"class":n["class"],"interface":n.interface,enumeration:n.enumeration},this))),this.defaultTabels[n.type]=t)))},_optimizeJson:function(n){var t=n;return this._updateDefaults(),this._compareObject(n,this.defaultTabels.defaults)},_updateHistoryManager:function(n){for(var t in n)(n[t]!=="push"||n[t]!=="stackLimit"||n[t]!=="pop")&&delete n[t];return n},_compareObject:function(n,t){var i,r,e,u,f,h,a,o,c,s,l;if(n&&t)for(i in n)if(r=n[i],r===null||r==="")delete n[i];else if(n.hasOwnProperty(i))if(i.charAt(0)==="_"||n.type==="bpmn"&&i==="container")delete n[i];else if(e=t[i]===undefined?this.defaultTabels[i]:t[i],r!==undefined&&e!==undefined&&((i==="collapseIcon"||i==="expandIcon"||i==="layout")&&(r.shape===e.shape&&delete n[i].shape,r.type===e.type&&delete n[i].type),i!=="isSwimlane"&&i!=="classifier"&&i!=="type"&&i!=="shape"&&r===e&&delete n[i]),r!==null&&typeof r=="object"){if(r!==null&&r instanceof Array)if(r.length===0)delete n[i];else for(u in r)if(typeof r[u]=="object"){if(i==="labels"||i==="label"||i==="textBlock"||i==="ports"){if(this._updateDefaults({type:i}),f=this.defaultTabels[i],n&&n.type==="bpmn"&&i==="labels"&&(f=$.extend(!0,{},f),f.offset={x:.5,y:1}),i==="label"&&(f=this.defaultTabels.labels),(i==="labels"||i==="ports")&&this.model.defaultSettings){h=this.model.defaultSettings;for(a in h)if(o=h[a],o&&o[i])for(c in o[i][u])this.defaultTabels[i][c]=o[i][c]}}else i==="children"?(this._updateDefaults({type:r[u].type}),f=this.defaultTabels[r[u].type]):(this._updateDefaults(r[u]),f=this.defaultTabels[r[u].type]);r[u].isSwimlane?f=this.defaultTabels.Swimlane:r[u].type!=="umlclassifier"&&(r[u].type!=="bpmn"||r[u].container)||delete n[i][u].children;n[i][u]=this._compareObject(r[u],f===undefined?e:f)}else n[i]=this._compareObject(r,e);else if(i!=="class"&&i!=="interface"&&i!=="enumeration"){if(i==="commandManager"||i==="contextMenu")if(i!=="contextMenu"||this.model.enableContextMenu){if(i==="commandManager"){s=r.commands;for(l in s)s[l]._isDefault&&delete s[l];$.isEmptyObject(r.commands)&&delete n[i].commands}}else delete n[i];n[i]=i==="historyManager"?this._updateHistoryManager(r):this._compareObject(r,e)}($.isEmptyObject(r)||r.length===0)&&delete n[i]}return n},_checkForNullValues:function(n){this._checkTargetNull(n.pageSettings)},_checkTargetNull:function(n){for(var t in n)n[t]==null||n[t]==Infinity?n[t]=0:typeof n[t]=="object"&&n[t]&&this._checkTargetNull(n[t])},_updateGroupChildren:function(n){var u=[],e=[],f,i=typeof n.nodes=="function"?n.nodes():n.nodes,r,t;if(i&&i.length>0)for(t=0;t<i.length;t++)i[t].parent!==""||i[t].isSwimlane?i[t].isSwimlane&&(f=this._getNode(i[t].name),this._isSwimlaneExist=!0,f&&u.push(jQuery.extend(!0,{},f))):(this._updateChildren(i[t]),u.push(jQuery.extend(!0,{},i[t])));if(r=typeof n.connectors=="function"?n.connectors():n.connectors,r&&r.length>0)for(t=0;t<r.length;t++)e.push(r[t]);n.connectors=e;n.nodes=u},_updateChildren:function(n){var u=[],i,r,t;if(n&&n.children&&n.children.length>0){for(t=0;t<n.children.length;t++)r=this._getChild(n.children[t]),r&&(i=this.nameTable[r]),i&&u.push(jQuery.extend(!0,{},i));n.children=u}},_containsNode:function(n){var t,i;for(n=this._getChild(n),t=null,i=0;i<this.nodes().length;i++)if(t=this.nodes()[i],t&&t.name===n)return!0;return null},_updateTableNodes:function(){var n=0,t,i;for(n;n<this.nodes().length;n++)t=this.nameTable[this.nodes()[n].name],t&&(this.nodes()[n]=t,t._type==="group"&&this._updateTableGroup(t));for(n;n<this.connectors().length;n++)i=this.nameTable[this.connectors()[n].name],i&&(this.connectors()[n]=i)},_updateTableGroup:function(n){for(var i=n.children,t=0;t<n.children.length;t++)n.children[t]=this.nameTable[this._getChild(n.children[t])],n.children[t]&&n.children[t]._type==="group"&&this._updateTableGroup(n.children[t])},upgrade:function(n){var r,t,u,f,i,o,e;if(n){if(r=Number(n.version),isNaN(r)&&n.version&&(r=n.version.split("."),n.version=r=Number(r[0]+"."+r[1])),n.version)if(r<14.2){if(n.nodes&&r<14.1)for(t=0;t<n.nodes.length;t++)u=n.nodes[t],this.setConstraints(u),u&&(u.type==="native"||u.type==="image"||u.type==="html")&&(u.scale="stretch");if(n.connectors)for(f=0;f<n.connectors.length;f++){if(i=n.connectors[f],r<14.1&&(i.constraints|=ej.datavisualization.Diagram.ConnectorConstraints.PointerEvents,i.labels&&i.labels.length>0))for(e=0;e<i.labels.length;e++)o=i.labels[e],o.relativeMode=ej.datavisualization.Diagram.LabelRelativeMode.SegmentBounds;r<14.2&&i&&i.segments&&i.segments.length===1&&i.segments[0].type==="orthogonal"&&(i.segments[0].length=13)}}else n.version=="13.1";else if(this.commonAPIChanges(n),n.nodes)for(t=0;t<n.nodes.length;t++)n.nodes[t].inEdges||(n.nodes[t].inEdges=[],n.nodes[t].outEdges=[]),n.nodes[t].constraints=ej.datavisualization.Diagram.NodeConstraints.Default;n.version<15.4&&(n.scrollSettings?(n.scrollSettings.minZoom=.25,n.scrollSettings.maxZoom=30):n.scrollSettings={horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,zoomFactor:.2,minZoom:.25,maxZoom:30,padding:{left:0,right:0,top:0,bottom:0}});n.version=ej.version}},setConstraints:function(n){var r,u,i,f,t;if(n&&n.type=="group"&&!n.isSwimlane)for(n.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,r=0;r<n.children.length;r++)t=n.children[r],t.type=="group"?this.setConstraints(t):t.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents;else if(n&&n.type=="group"&&n.isSwimlane){for(n.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,u=0;u<n.lanes.length;u++)if(i=n.lanes[u],i.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,i.children)for(f=0;f<i.children.length;f++)t=i.children[f],t.type=="group"?this.setConstraints(t):t.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents}else n.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents},commonAPIChanges:function(n){var t,i;if(n.defaultSettings={node:n.nodeDefaults,connectors:n.connectorDefaults},n.connectors)for(t=0;t<n.connectors.length;t++)n.connectors[t].constraints=ej.datavisualization.Diagram.ConnectorConstraints.Default,n.connectors[t].line&&(n.connectors[t].line.type=="straight"?(i=[{type:"straight",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint}],this.commonSourceTargetChanges(n.connectors[t])):n.connectors[t].line.type=="orthogonal"?(i=[{type:"orthogonal",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint}],this.commonSourceTargetChanges(n.connectors[t])):n.connectors[t].line.type=="bezier"&&(i=[{type:"bezier",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint,point1:n.connectors[t].line.point1,point2:n.connectors[t].line.point2}],this.commonSourceTargetChanges(n.connectors[t])),n.connectors[t].sourcePoint=n.connectors[t].line.startPoint,n.connectors[t].targetPoint=n.connectors[t].line.endPoint,n.connectors[t].segments=i)},commonSourceTargetChanges:function(n){n.sourceNodeName&&(n.sourceNode=n.sourceNodeName);n.sourceNodePort&&(n.sourcePort=n.sourceNodePort);n.targetNodeName&&(n.targetNode=n.targetNodeName);n.targetPortName&&(n.targetPort=n.targetPortName)},load:function(n){var e,i,t,r,f,u;if(n&&n.version==="NewVersion"&&(n.version=ej.version),this._isLoad=!0,this._isOptimize=!0,this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this),this.clear(),this._zOrder=0,this.enableContextMenu()&&(!this.model.serializationSettings.preventDefaultValues||n.contextMenu)&&(e=$("#"+this.element[0].id+"_contextMenu").data("ejMenu"),e.destroy(),$("#"+this.element[0].id+"_contextMenu").remove()),n&&n.nodes&&n.nodes.length>0)for(t=n.nodes.length-1;t>=0;t--)i=n.nodes[t],i&&(i.type==="connector"||i.segments)&&(n.connectors.push(i),n.nodes.splice(t,1)),i._shape&&(this._isOptimize=!1);if(n&&n.connectors&&n.connectors.length>0)for(t=n.connectors.length-1;t>=0;t--)r=n.connectors[t],f=!1,r.targetNode&&(this._isExist(n,r.targetNode)||(f=!0,n.connectors.splice(t,1))),r.sourceNode&&(this._isExist(n,r.sourceNode)||f||n.connectors.splice(t,1));n.selectedItems&&(n.selectedItems.userHandles=this.model.selectedItems.userHandles?this.model.selectedItems.userHandles:[]);this.upgrade(n);u={nodes:n.nodes?n.nodes:[],connectors:n.connectors?n.connectors:[],commandManager:n.commandManager?n.commandManager:{},contextMenu:n.contextMenu?n.contextMenu:{},snapSettings:n.snapSettings?n.snapSettings:{},historyManager:n.historyManager?n.historyManager:this._initHistoryManager(),backgroundImage:n.backgroundImage?n.backgroundImage:ej.datavisualization.Diagram.BackgroundImage({source:""}),enableAutoScroll:n.enableAutoScroll?n.enableAutoScroll:!0,autoScrollMargin:n.autoScrollMargin?n.autoScrollMargin:20,layout:n.layout?n.layout:{},pageSettings:n.pageSettings?n.pageSettings:{},click:n.click?n.click:null,connectionChange:n.connectionChange?n.connectionChange:null,defaultSettings:n.defaultSettings?n.defaultSettings:{node:null,connector:null},dataSourceSettings:n.dataSourceSettings?n.dataSourceSettings:{},doubleClick:n.doubleClick?n.doubleClick:null,enableContextMenu:n.enableContextMenu===undefined?!0:n.enableContextMenu,tooltip:n.tooltip?n.tooltip:null,height:n.height?n.height:null,mouseEnter:n.mouseEnter?n.mouseEnter:null,mouseOver:n.mouseOver?n.mouseOver:null,mouseLeave:n.mouseLeave?n.mouseLeave:null,nodeTemplate:n.nodeTemplate?n.nodeTemplate:null,rotationChange:n.rotationChange?n.rotationChange:null,selectedItems:n.selectedItems?n.selectedItems:this.model.selectedItems,width:n.width?n.width:null,constraints:n.constraints,phases:n.phases?n.phases:[],scrollSettings:n.scrollSettings,rulerSettings:n.rulerSettings?n.rulerSettings:this.rulerSettings,serializationSettings:n.serializationSettings?n.serializationSettings:this.serializationSettings};this._tempCommandManager=n.commandManager;n.showTooltip!==undefined&&(u.showTooltip=n.showTooltip);n.tooltipTemplateId!==undefined&&(u.tooltipTemplateId=n.tooltipTemplateId);$("#"+this._id).ejDiagram(u);this._isLoad=!1;delete this._isOptimize;delete this._tempCommandManager},_isExist:function(n,t){for(var r,e,u,i=!1,f=0;n.nodes&&f<n.nodes.length;f++)if(!i&&(r=n.nodes[f],r))if(r.isSwimlane){if(r.lanes)for(e=r.lanes,u=0;u<e.length;u++)if(i=this._checkNodeExist(e[u],t),i)break}else if(i=this._checkNodeExist(r,t),i)break;return i},_checkNodeExist:function(n,t){var i,f,e,u,r;if(n.children){for(i=0;i<n.children.length;i++)if(f=n.children[i],e=this._checkNodeExist(f,t),e)return!0}else if(this.model.serializationSettings.preventDefaultValues&&n&&(n.subProcess&&n.subProcess.events.length>0||n.task&&n.task.events.length>0))for(u=n.subProcess.events.length>0?n.subProcess.events:n.task.events,r=0;r<u.length;r++)if(u[r].name===t)return!0;return n.name===t?!0:!1},layout:function(){this._isLayoutExecute=!0;this._setLayout();delete this._isLayoutExecute},_setLayout:function(){this._doLayout();ej.datavisualization.Diagram.PageUtil._updatePageSize(this);this._clearSelection()},addSelection:function(n,t){var r,i;n&&!this._selectionContains(n)&&(this.model.selectedItems.children.length>0&&!t?(i=this.nameTable.multipleSelection,i||(i=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this.nodes().push(i),this.nameTable[i.name]=i),this.model.selectedItems.children.length>1?i.children=this.selectionList[0].children:i.children.push(this.selectionList[0].name),i.children.push(n.name),ej.datavisualization.Diagram.Util._updateGroupBounds(i,this,null,!0),r=i):r=n,this._hasSelection()&&this._clearSelection(!0),i&&this.nameTable.multipleSelection===undefined&&t===!1&&(this.nodes().push(i),this.nameTable[i.name]=i),this._addSelection(r))},clearSelection:function(){this._clearSelection()},removeSelection:function(n){var n,t;(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&n&&(n=this.nameTable[n.name],this.selectionList[0]==n||this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children.length==1?this._clearSelection():this.selectionList[0].type=="pseudoGroup"&&this._collectionContains(n.name,this.selectionList[0].children)&&(t=this.selectionList[0].children.indexOf(n.name),t!=-1?ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,n.name):ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,n),ej.datavisualization.Diagram.Util.removeItem(this.model.selectedItems.children,n),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),this._updateSelectionHandle()))},updateSelectedObject:function(n,t){var i=this.nameTable[n];i&&ej.datavisualization.Diagram.Util.enableLayerOption(i,"lock",this)&&(ej.datavisualization.Diagram.Util.canSelect(i)||i._isHeader)&&(this.activeTool.selectedObject=i);t&&t.isSwimlane&&(this.activeTool.selectedObject=t)},updateSelection:function(n){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&this._updateSelectionHandle(n)},activateTool:function(n,t){this.tools[n]&&(this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this._toolToActivate=n,this.activeTool=this.tools[this._toolToActivate],this.activeTool.singleAction=!0,(t===!1||n==="panTool")&&(this.activeTool.singleAction=!1));this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(this._currentCursor="pointer",this.activeTool.startPoint=ej.datavisualization.Diagram.Point(0,0),this.activeTool._isMouseDown=!1);this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&(this.activeTool.singleAction?this.tool(this.tool()|ej.datavisualization.Diagram.Tool.DrawOnce):this.tool(this.tool()|ej.datavisualization.Diagram.Tool.ContinuesDraw),this.activeTool._showAllPorts());this._drawingTool=!0},deactivateTool:function(){this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0);this.tool()&ej.datavisualization.Diagram.Tool.DrawOnce&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.DrawOnce);this.tool()&ej.datavisualization.Diagram.Tool.ContinuesDraw&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.ContinuesDraw);this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._mousedown=!1,this._currentCursor="pointer"):(this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate],this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect));this.activeTool._removeHighLighter();ej.datavisualization.Diagram.SvgContext._removePortHighlighter(this._adornerSvg,this._adornerLayer)},updateLabel:function(n,t,i){var r,u;if(n&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(r=this._findNode(n),r||(r=this._findConnector(n)),i&&t&&!i.name||t.name==i.name||r&&r._isHeader&&t.name===i.name+"_label")){if(r){i.templateId&&t.templateId&&t.templateId!=i.templateId&&ej.datavisualization.Diagram.DiagramContext.setLabelTemplate(r,t,this);this._isUndo||this._recordPropertiesChanged(r,i,"label",t);r.type!=="text"&&(t=this._findLabel(r,t.name));i.name=t.name;this._comparePropertyValues(r,"labels",i);for(u in i)t.hasOwnProperty(u)&&(t[u]=typeof i[u]=="object"?$.extend(!0,{},t[u],i[u]):i[u]);i.wrapText!==undefined&&(t.wrapping=i.wrapText?"wrapwithoverflow":"nowrap");r.segments||r.type!=="text"?(ej.datavisualization.Diagram.DiagramContext.updateLabelStyle(r,t,this),ej.datavisualization.Diagram.DiagramContext.updateLabel(r,t,this)):r.type==="text"&&ej.datavisualization.Diagram.DiagramContext.updateTextBlock(r,t,this);this._updateQuad(r)}i.mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&this.startLabelEdit(r,t)}return t},startLabelEdit:function(n,t){var r,i,u;if(n){for(r=0;r<this.selectionList.length;r++)if(i=this.selectionList[r],i!==n&&typeof i.labels.length!="undefined")for(u=0;u<i.labels.length;u++)i.labels[u].mode=ej.datavisualization.Diagram.LabelEditMode.View;t||n.type!=="text"||(t=n.textBlock);this._setLabelEditing(t)?this._startEdit(n):this._endEdit()}},_setSelectorConstraints:function(n){this.model.selectedItems.constraints=n;this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,n,undefined,this),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,this.selectionList[0].type=="pseudoGroup",this._currZoom,this._adornerLayer,this))},_raiseGroupChangeEvent:function(n,t,i,r){var u={};return u.element=n?n:null,u.oldParent=t?t:null,u.newParent=i?i:null,u.cause=r?r:null,t!=i&&this._raiseEvent("groupChange",u),u},group:function(){var t,n,i,f,r,u,e;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"){for(t=[],n=0;n<this.selectionList[0].children.length;n++)t.push(this.nameTable[this._getChild(this.selectionList[0].children[n])]);for(this._sortByZIndex(t,!0),f=ej.datavisualization.Diagram.Util.randomId(),r=new ej.datavisualization.Diagram.Group({name:f,rotateAngle:this.selectionList[0].rotateAngle}),this._clearSelection(!0),n=0;n<t.length;n++)this._isUndo=!0,r.children.push(t[n]),t[n].parent&&(u=this.nameTable[t[n].parent],u&&ej.datavisualization.Diagram.Util.removeChildFromGroup(u.children,t[n])),t[n].parent=f,ej.datavisualization.Diagram.Util.removeItem(this.selectionList,t[n].name),t[n].segments?(ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[t[n].name]),this._connectors=$.extend(!0,[],this.connectors())):(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[t[n].name]),this._nodes=$.extend(!0,[],this.nodes())),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t[n].name],t[n]),t[n].type=="html"?(i=document.getElementById(t[n].name+"_parentdiv"),i.parentNode.removeChild(i)):t[n]._type==="group"&&this._checkForHtmlNode(t[n]),i=this._svg.document.getElementById(t[n].name),i&&i.parentNode.removeChild(i),this._removeElement(t[n]),this._raiseGroupChangeEvent(t[n],u,r,"group");ej.datavisualization.Diagram.Util.clear(this.selectionList);r=this._getNewGroup(r);this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Unknown;this._isGroupNode=!0;this.add(r);e={type:"groupchanged",object:r,actionType:"group",category:"internal"};this.addHistoryEntry(e);this._isUndo=!1;delete this._isGroupNode}},_checkForHtmlNode:function(n){for(var t,r,u=this._getChildren(n.children),i=0;i<u.length;i++)t=this.nameTable[u[i]],t&&(t._type==="group"?this._checkForHtmlNode(t):t.type=="html"&&(r=document.getElementById(t.name+"_parentdiv"),r.parentNode.removeChild(r)))},_removeChildren:function(n,t){for(var i,u=this._getChildren(n.children),r=0;r<u.length;r++)i=this.nameTable[u[r]],i&&(n.isLane||i.inEdges.length>0||i.outEdges.length>0?(this._disConnect(i,t),this._removeConnector(i,t)):i.segments?(this._removeEdges(i),i.sourceNode=i.sourcePort=i.targetNode=i.targetPort=null):this._disConnect(i,t,!0),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),i),this._nodes=$.extend(!0,[],this.nodes()),i._type==="group"?(this._removeChildren(i,t),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]):(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]),this._removeElement(i))},ungroup:function(){var f,r,i,u,n,e,o,t,s;if(this.selectionList[0]&&this.selectionList[0]._type==="group"&&this.selectionList[0].canUngroup&&!(this.selectionList[0].isSwimlane||this.selectionList[0].isLane)){for(this._isUndo=!0,f=this.selectionList[0].children,u=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],i=this.selectionList[0],$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),this._removeElement(this.selectionList[0]),this._checkForHtmlNode(this.selectionList[0]),this._clearSelection(),ej.datavisualization.Diagram.Util.clear(this.selectionList),r=0;r<f.length;r++)t=this.nameTable[this._getChild(f[r])],t.parent&&(o=this.nameTable[t.parent]),$(u).children("#"+t.name)[0]&&u.removeChild($(u).children("#"+t.name)[0]),t&&(t.parent&&(t.parent=null),t.segments?(n=t,n.parent="",this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.connectors().indexOf(n)===-1&&(this.connectors().push(n),this._connectors=$.extend(!0,[],this.connectors()))):(n=t,n.parent="",n._type==="group"?(this._updateChildrenEdges(n),(n.isLane||n.isSwimlane)&&(n.width=0,n.height=0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):ej.datavisualization.Diagram.DiagramContext.renderNode(n,this),this.nodes().indexOf(n)===-1&&(this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()))),t.parent&&(e=this.nameTable[t.parent]),this._raiseGroupChangeEvent(t,o,e,"unGroup"));ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(i.name));ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i);ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i);s={type:"groupchanged",object:i,actionType:"ungroup",category:"internal"};this.addHistoryEntry(s);this._isUndo=!1}},nudge:function(n,t){t=t?t:1;var u={up:{x:0,y:-t},down:{x:0,y:t},left:{x:-t,y:0},right:{x:t,y:0}},r=u[n],i;n==="up"?i="down":n==="down"?i="up":n==="left"?i="right":n==="right"&&(i="left");r&&this.selectionList[0]&&!this.selectionList[0].isLane&&!this.selectionList[0].isPhase&&(this._isUndo||this.addHistoryEntry({type:"nudge",object:this.selectionList[0],undoDirection:i,redoDirection:n,values:t,category:"internal"}),this._nudge(this.selectionList[0],r.x,r.y,n))},selectAll:function(){var t,u,n,f,r=null,i;for(this._clearSelection(!0),t=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u=this.nodes(),n=0,f=u.length;n<f;n++)ej.datavisualization.Diagram.Util.canSelect(u[n])&&ej.datavisualization.Diagram.Util.enableLayerOption(u[n],"lock",this)&&(r=this.nameTable[u[n].name],r&&r.parent==""&&r.type!="pseudoGroup"&&r.visible&&t.children.push(r.name));for(i=this.connectors(),n=0,f=i.length;n<f;n++)ej.datavisualization.Diagram.Util.canSelect(i[n])&&ej.datavisualization.Diagram.Util.enableLayerOption(i[n],"lock",this)&&i[n].parent==""&&i[n].visible&&t.children.push(i[n].name);ej.datavisualization.Diagram.Util._updateGroupBounds(t,this);t.children.length>1?(this.nodes().push(t),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[t.name]=t,this._addSelection(t)):t.children.length===1&&this._addSelection(this.nameTable[t.children[0]])},align:function(n){var t,r,i,e,o,u;if(this.selectionList[0]&&(this.selectionList[0].type==="group"||this.selectionList[0].type=="pseudoGroup")&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var s=this.nameTable[this.selectionList[0].name].children,c=[],f,h=this._findCornerNodes();if(n==="left"?f=h.left:n==="right"?f=h.right:n==="top"?f=h.top:n==="bottom"&&(f=h.bottom),f?t=ej.datavisualization.Diagram.Util.bounds(f):(n==="center"||n==="middle")&&(t=ej.datavisualization.Diagram.Util.bounds(this.selectionList[0])),t){for(this._associatedConnectorsUpdate=!0,e=0,o=0,r=0;r<s.length;r++)u=this.nameTable[this._getChild(s[r])],i=ej.datavisualization.Diagram.Util.bounds(u),n==="left"?e=-(i.x-t.x):n==="right"?e=-(i.x+i.width-(t.x+t.width)):n==="top"?o=-(i.y-t.y):n==="bottom"?o=-(i.y+i.height-(t.y+t.height)):n==="center"?e=-(i.x+i.width/2-(t.x+t.width/2)):n==="middle"&&(o=-(i.y+i.height/2-(t.y+t.height/2))),this._moveNode(e,o,u),this._updateContainerOnNudge(u),c.push({object:u,delta:{x:e,y:o}});for(delete this._associatedConnectorsUpdate,r=0;r<s.length;r++)u=this.nameTable[this._getChild(s[r])],u.segments||this._updateAssociateConnector(u);ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}this.addHistoryEntry({type:"alignCommand",values:c,category:"internal",object:this.selectionList[0]})}},_updateAssociateConnector:function(n){var r,t,i;if(n.children&&(t=n.children,t))for(i=0;i<t.length;i++)r=this.nameTable[this._getChild(t[i])],r&&this._updateAssociateConnector(r);ej.datavisualization.Diagram.SvgContext._updateAssociatedConnector(n,this._svg,this)},sameSize:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,f=this.nameTable[this._getChild(this.selectionList[0].children[0])],r=ej.datavisualization.Diagram.Util.bounds(f),u=[];for(this._isSizingCommand=!0,t=0;t<i.length;t++)n=this.nameTable[this._getChild(i[t])],n.segments||(u.push({object:n,values:{width:n.width||n._width||0,height:n.height||n._height||0}}),this.updateNode(n.name,{width:r.width,height:r.height}));delete this._isSizingCommand;this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:u});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameHeight:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this._getChild(this.selectionList[0].children[0])],r=[],f=ej.datavisualization.Diagram.Util.bounds(u);for(this._isSizingCommand=!0,t=0;t<i.length;t++)n=this.nameTable[this._getChild(i[t])],n.segments||(r.push({object:n,values:{width:n.width||n._width||0,height:n.height||n._height||0}}),this.updateNode(n.name,{height:f.height}));delete this._isSizingCommand;this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:r});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameWidth:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this._getChild(this.selectionList[0].children[0])],f=ej.datavisualization.Diagram.Util.bounds(u),r=[];for(this._isSizingCommand=!0,t=0;t<i.length;t++)n=this.nameTable[this._getChild(i[t])],n.segments||(r.push({object:n,values:{width:n.width||n._width||0,height:n.height||n._height||0}}),this.updateNode(n.name,{width:f.width}));delete this._isSizingCommand;this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:r});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},spaceDown:function(){var t,o,s,r,n,e,i,u,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByYvalue(this.selectionList[0].children),o=t.length,s=[],t&&o>2)){var c=this._findCornerNodes(),l=c.top,h=0,r=null,n=null;for(i=0;i<t.length;i++)r=null,n=null,r=this.nameTable[this._getChild(t[i])],n=this.nameTable[this._getChild(t[Number(i)+1])],r&&n&&(u=ej.datavisualization.Diagram.Util.bounds(r),f=ej.datavisualization.Diagram.Util.bounds(n),h+=f.y-(u.y+u.height));for(e=h/(o-1),i=0;i<t.length;i++)r=this.nameTable[this._getChild(t[i])],n=this.nameTable[this._getChild(t[Number(i)+1])],r&&n&&(u=ej.datavisualization.Diagram.Util.bounds(r),f=ej.datavisualization.Diagram.Util.bounds(n),this._comparePropertyOnAlign(n,0,u.bottom-f.top+e),this._translate(n,0,u.bottom-f.top+e,this.nameTable),s.push({object:n,delta:{x:0,y:u.bottom-f.top+e}}),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this));this.addHistoryEntry({type:"spacingCommand",values:s,category:"internal",object:this.selectionList[0]})}},spaceAcross:function(){var t,o,s,r,n,e,l,i,u,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByXvalue(this.selectionList[0].children),o=t.length,s=[],t&&o>2)){var c=this._findCornerNodes(),a=c.left,h=0,r=null,n=null;for(i=0;i<t.length;i++)r=null,n=null,r=this.nameTable[this._getChild(t[i])],n=this.nameTable[this._getChild(t[Number(i)+1])],r&&n&&(u=ej.datavisualization.Diagram.Util.bounds(r),f=ej.datavisualization.Diagram.Util.bounds(n),h+=f.x-(u.x+u.width));for(e=h/(o-1),l=0,i=0;i<t.length;i++)r=this.nameTable[this._getChild(t[i])],n=this.nameTable[this._getChild(t[Number(i)+1])],r&&n&&(u=ej.datavisualization.Diagram.Util.bounds(r),f=ej.datavisualization.Diagram.Util.bounds(n),this._comparePropertyOnAlign(n,u.right-f.left+e,0),this._translate(n,u.right-f.left+e,0,this.nameTable),s.push({object:n,delta:{x:u.right-f.left+e,y:0}}),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this));this.addHistoryEntry({type:"spacingCommand",values:s,category:"internal",object:this.selectionList[0]})}},sendBackward:function(){var t,i,n,r,f,u;if(this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n,"sendBackward"),this._sortByZIndex(t),r=0;r<t.length;r++)if(n.zOrder>t[r].zOrder){i=t[r];break}f=n.zOrder;i&&(u=i.zOrder,this._comparePropertyValues(n,"zOrder",{zOrder:u},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(f,u,n,i),this.addHistoryEntry({type:"zOrder",command:"back",start:u,end:f,nearestNode:i,object:n,category:"internal"}))}},_sendElementsToBack:function(n,t,i,r){for(var f,s,e=t;e<n;e++)i.parent!=""?(f=this._findObjectByIndex(e,!0),f&&(f.zOrder+=1)):(f=this._findObjectByIndex(e),f&&(f.zOrder+=1));this._deleteZorderProcess();i.parent!=""?i.parent&&(s=this.nameTable[i.parent],this._findChildren(s,i.name).zOrder=t):this._findObjectByName(i.name).zOrder=t;var o=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],h=$(o).find("#"+i.name+"_label")[0],c=$(o).find("#"+i.name+"_parentdiv")[0],u=$(o).find("#"+r.name+"_parentdiv")[0];u||(u=$(o).find("#"+r.name)[0]);u&&c&&u.parentNode.insertBefore(c,u);u&&h&&u.parentNode.insertBefore(h,u);this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(r.name));this._updateSelectionHandle()},_deleteZorderProcess:function(){for(var t,i=this.nodes(),n=0;n<i.length;n++)i[n]._isProcessed&&delete i[n]._isProcessed;for(t=this.connectors(),n=0;n<t.length;n++)t[n]._isProcessed&&delete t[n]._isProcessed},_bringElementsToFront:function(n,t,i,r){for(var f,c,e=t;e>n;e--)i.parent!=""?(f=this._findObjectByIndex(e,!0),f&&(f.zOrder-=1)):(f=this._findObjectByIndex(e),f&&(f.zOrder-=1));this._deleteZorderProcess();i.parent?(c=this.nameTable[i.parent],this._findChildren(c,i.name).zOrder=t):this._findObjectByName(i.name).zOrder=t;var o=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],l=$(o).find("#"+i.name+"_label")[0],h=$(o).find("#"+r.name+"_label")[0],u=$(o).find("#"+i.name+"_parentdiv")[0],s=$(o).find("#"+r.name+"_parentdiv")[0];s||(s=$(o).find("#"+r.name)[0]);h&&u&&h.parentNode.insertBefore(u,h.nextSibling);u&&l&&u.parentNode.insertBefore(l,u.nextSibling);s&&u&&s.parentNode.insertBefore(u,s.nextSibling);this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(r.name).nextSibling);this._updateSelectionHandle()},moveForward:function(){var t,i,n,r,f,u;if(this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n,"moveForward"),this._sortByZIndex(t),r=t.length-1;r>=0;r--)if(n.zOrder<t[r].zOrder){i=t[r];break}f=n.zOrder;i&&(u=i.zOrder,this._comparePropertyValues(n,"zOrder",{zOrder:u},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(f,u,n,i),this.addHistoryEntry({type:"zOrder",command:"front",start:u,end:f,nearestNode:i,object:n,category:"internal"}))}},sendToBack:function(){var n=this.selectionList[0],u,t;if(n&&n.type!="pseudoGroup"){var o=this._findOverlapNode(n,"sendToBack"),i=this._sortByZIndex(o),f=n.zOrder,r=n.zOrder,e;for(t=0;t<i.length;t++)i[t].zOrder<r&&(t==0&&(e=i[t]),r=i[t].zOrder,u=i[t]);u&&(this._comparePropertyValues(n,"zOrder",{zOrder:r},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(f,r,n,u),this.addHistoryEntry({type:"zOrder",command:"back",start:r,end:f,nearestNode:e,object:n,category:"internal"}))}},bringToFront:function(){var n=this.selectionList[0],u,t;if(n&&n.type!="pseudoGroup"){var e=this._findOverlapNode(n,"bringToFront"),i=this._sortByZIndex(e),f=n.zOrder,r=n.zOrder;for(t=0;t<i.length;t++)i[t].zOrder>r&&(r=i[t].zOrder,u=i[t]);u&&(this._comparePropertyValues(n,"zOrder",{zOrder:r},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(f,r,n,u),this.addHistoryEntry({type:"zOrder",command:"front",start:r,end:f,nearestNode:i[t-1],object:n,category:"internal"}))}},_getChildFromCollection:function(n,t){if(n&&n.length>0&&t)for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i]},_updateNameTable:function(n){var i,t;if(n.children&&n.children.length>0)for(i=0;i<n.children.length;i++)t=typeof n.children[i]=="object"?n.children[i]:null,t&&(this.nameTable[t.name]=t,t.children&&t.children.length>0&&this._updateNameTable(t))},_recordPageSettingsChanged:function(n){var t=n.redoObject;n.isUndo&&(t=n.undoObject);t&&this.updatePageSettings(t)},_recordMultiRotationChanged:function(n){ej.datavisualization.Diagram.canvasHelper._undoMultiRotateNode(this,n)},_recordMultiPinPointChanged:function(n){ej.datavisualization.Diagram.canvasHelper._undoMultiDragNode(this,n)},_recordMultiSizeChanged:function(n){ej.datavisualization.Diagram.canvasHelper._undoMultiResizeNode(this,n)},undo:function(){var n;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&ej.datavisualization.Diagram.Util.canUndo(this)){if(this._getHistoryList(),this._isUndo=!0,n=this.getUndoEntry(),n&&(n.type=="closeGroup"?this._groupUndo=!0:n.type=="startGroup"?this._groupUndo=!1:this._undo(n),this._groupUndo)){for(n=this.getUndoEntry();n&&n.type!="startGroup";){if(this._undo(n),!this._groupUndo)break;n=this.getUndoEntry()}delete this._groupUndo}this._isUndo=!1}},redo:function(){this._isUndo=!0;var n=this.getRedoEntry();if(n&&(n.type=="startGroup"?this._groupRedo=!0:this._redo(n),this._groupRedo)){for(n=this.getRedoEntry();n&&n.type!="closeGroup";)this._isUndo=!0,this._redo(n),n=this.getRedoEntry();delete this._groupRedo}this._isUndo=!1},_ComparehistoryChangeEvent:function(n,t){var i,r={source:[],changes:[]},o,u,f,h,s,e;switch(t.type){case"positionchanged":case"rotationchanged":case"sizechanged":r=this._getPseudoGroupElements(n,t);break;case"endpointchanged":this._UndoRedo?(o=this._historyChangeEvent(t.undoObject,t.redoObject,t),i={type:t.type,oldValues:o.changes?o.changes.oldValues:o.oldValues,newValues:o.changes?o.changes.newValues:o.newValues,cancel:!1},r.source.push(t.undoObject)):(o=this._historyChangeEvent(t.redoObject,t.undoObject,t),i={type:t.type,oldValues:o.changes?o.changes.oldValues:o.oldValues,newValues:o.changes?o.changes.newValues:o.newValues,cancel:!1},r.source.push(t.redoObject));r.changes.push(i);break;case"collectionchanged":t.changeType=="remove"&&(i={type:t.type,addedItems:[],deletedItems:[n]});t.changeType=="insert"&&(i={type:t.type,addedItems:[n],deletedItems:[]});r.changes.push(i);r.source.push(n);break;case"labelchanged":i=this._UndoRedo?{type:t.type,newValues:{text:t.previousLabelValue},oldValues:{text:t.updatedLabelValue}}:{type:t.type,newValues:{text:t.updatedLabelValue},oldValues:{text:t.previousLabelValue}};r.changes.push(i);r.source.push(t.shape);break;case"labelcollectionchanged":i={type:t.type,source:t.shape,addedItems:[t.label],deletedItems:[]};r.changes.push(i);r.source.push(t.shape);case"groupchanged":i=t.actionType=="group"?{type:t.type,source:t.object,addedItems:[t.object],deletedItems:[]}:{type:t.type,source:t.object,addedItems:[],deletedItems:[t.object]};r.changes.push(i);r.source.push(t.object);break;case"phasepositionchanged":this._UndoRedo?(i={type:t.type,newValues:{offset:t.undoObject.offset},oldValues:{offset:t.redoObject.offset}},r.source.push(t.undoObject)):(i={type:t.type,newValues:{offset:t.redoObject.offset},oldValues:{offset:t.undoObject.offset}},r.source.push(t.redoObject));r.changes.push(i);break;case"phasecollectionchanged":i=t.isAdded?{type:t.type,addedItems:[t.phase],deletedItems:[]}:{type:t.type,addedItems:[],deletedItems:[t.phase]};r.source.push(t.phase);r.changes.push(i);break;case"propertiesChanged":i=this._propertyChangeEventValues(t);r.source.push(i.source);r.changes.push(i.changes);break;case"portscollectionchanged":t.changeType=="insert"&&(i={type:t.type,addedItems:[t.collection],deletedItems:[]});t.changeType=="remove"&&(i={type:t.type,addedItems:[],deletedItems:[t.collection]});r.source.push(t.object);r.changes.push(i);break;case"nudge":u={};f={};t.object._type!=="label"?this._UndoRedo?(t.undoDirection=="left"&&(u.offsetX=t.object.offsetX-t.values,f.offsetX=t.object.offsetX),t.undoDirection=="right"&&(u.offsetX=t.object.offsetX+t.values,f.offsetX=t.object.offsetX),t.undoDirection=="up"&&(u.offsetY=t.object.offsetY-t.values,f.offsetY=t.object.offsetY),t.undoDirection=="down"&&(u.offsetY=t.object.offsetY+t.values,f.offsetY=t.object.offsetY),i={type:t.type,newValues:u,oldValues:f}):(t.redoDirection=="left"&&(u.offsetX=t.object.offsetX-t.values,f.offsetX=t.object.offsetX),t.redoDirection=="right"&&(u.offsetX=t.object.offsetX+t.values,f.offsetX=t.object.offsetX),t.redoDirection=="up"&&(u.offsetY=t.object.offsetY-t.values,f.offsetY=t.object.offsetY),t.redoDirection=="down"&&(u.offsetY=t.object.offsetY+t.values,f.offsetY=t.object.offsetY),i={type:t.type,newValues:u,oldValues:f}):i=this._labelNudge(t);r.source.push(t.object);r.changes.push(i);break;case"spacingCommand":case"alignCommand":var u={},f={},c=[],l=[];for(s=0;s<t.values.length;s++)e=t.values[s],e.object.segments?(h=$.extend(!0,{},e.object),f={sourcePoint:h.sourcePoint,targetPoint:h.targetPoint},l.push(f),ej.datavisualization.Diagram.Util._translateLine(h,e.delta.x,e.delta.y),u={sourcePoint:h.sourcePoint,targetPoint:h.targetPoint},c.push(u)):(u={offsetX:e.object.offsetX-e.delta.x,offsetY:e.object.offsetY-e.delta.y},c.push(u),f={offsetX:e.object.offsetX,offsetY:e.object.offsetY},l.push(f));i={type:t.type,newValues:c,oldValues:l};r.source.push(t.object);r.changes.push(i);break;case"sizeCommand":var u={},f={},c=[],l=[];for(s=0;s<t.values.length;s++)e=t.values[s],u={width:e.values.width,height:e.values.height},c.push(u),f={width:e.object.width,height:e.object.height},l.push(f);i={type:t.type,newValues:c,oldValues:l};r.source.push(t.object);r.changes.push(i);break;case"zOrder":i={type:t.type,source:t.object,newValues:{zOrder:t.end},oldValues:{zOrder:t.object.zOrder}};r.source.push(t.object);r.changes.push(i)}return r},_labelNudge:function(n){var i=this.findNode(n.object._parent),r={},u={},t=this._UndoRedo?n.undoDirection:n.redoDirection;return t=="left"||t=="right"?(r.offsetX=t=="left"?n.object.offset.x-n.values/i.width:n.object.offset.x+n.values/i.width,u.offsetX=n.object.offset.x):(t=="up"||t=="down")&&(r.offsetY=t=="up"?n.object.offset.y-n.values/i.height:n.object.offset.y+n.values/i.height,u.offsetY=n.object.offset.y),{type:n.type,newValues:r,oldValues:u}},_getPseudoGroupElements:function(n,t){var e,r,u,i,s=this._UndoRedo||!this._isUndo?t.undoObject.node:t.redoObject.node,f,o;if(u={source:[],changes:[]},n&&n.type=="pseudoGroup")for(f=this._getChildren(n.children),r=0;r<f.length;r++)e=this.nameTable[this._getChild(f[r])],o=this._UndoRedo||!this._isUndo?t.undoObject.childTable[f[r]]:t.redoObject.childTable[f[r]],i=this._isUndo?this._historyChangeEvent(o,e,t):this._historyChangeEvent(e,o,t),i.source&&u.source.push(i.source),i.changes&&u.changes.push(i.changes);else i=this._isUndo?this._historyChangeEvent(s,n,t):this._historyChangeEvent(n,s,t),i.source&&u.source.push(i.source),i.changes&&u.changes.push(i.changes);return u},_propertyChangeEventValues:function(n){var e,o=[],r=n.updateValues?n.updateValues:n.values,i,u,f,t;i=n.elementType=="label"?n.label:n.elementType=="port"?n.port:n.object;u={};f={};for(t in r)i[t]!=r[t]&&(u[t]=i[t],f[t]=r[t]);return e={type:n.type,newValues:f,oldValues:u,deletedItems:[],addedItems:[]},o.push(e),{changes:o,source:i}},_historyChangeEvent:function(n,t,i){var r={type:i.type,deletedItems:[],addedItems:[],oldValues:{},newValues:{}},u,f;return n.offsetX!=t.offsetX&&(r.oldValues.offsetX=t.offsetX,r.newValues.offsetX=n.offsetX),n.offsetY!=t.offsetY&&(r.oldValues.offsetY=t.offsetY,r.newValues.offsetY=n.offsetY),n.width!=t.width&&(r.oldValues.width=t.width,r.newValues.width=n.width),n.height!=t.height&&(r.oldValues.height=t.height,r.newValues.height=n.height),n.rotateAngle!=t.rotateAngle&&(r.oldValues.rotateAngle=t.rotateAngle,r.newValues.rotateAngle=n.rotateAngle),(n.sourcePoint||t.sourcePoint)&&(u=n.sourcePoint||{},f=t.sourcePoint||{},(u.x!=f.x||u.y!=f.y)&&(r.oldValues.sourcePoint=t.sourcePoint,r.newValues.sourcePoint=n.sourcePoint)),(n.targetPoint||t.targetPoint)&&(u=n.targetPoint||{},f=t.targetPoint||{},(u.x!=f.x||u.y!=f.y)&&(r.oldValues.targetPoint=t.targetPoint,r.newValues.targetPoint=n.targetPoint)),{changes:r,source:t}},_undo:function(n){var f=[],t,s,e,i,h,c,l,a,r,v,u,o;if(this._UndoRedo=!0,n)if(n.category=="internal"){if(t=n.object||(n.undoObject?n.undoObject.node||n.undoObject:undefined)||n.shape,!t&&n.phase&&(t=n.phase),t&&n.undoObject&&n.undoObject.node&&(t=this.nameTable[t.name]||t),!t){this.undo();return}if(this.model.historyManager.undoStack.length>0&&(s=this.model.historyManager.undoStack.splice(0,1),this.model.historyManager.redoStack.splice(0,0,s[0])),f=this._ComparehistoryChangeEvent(t,n),f.cause=ej.datavisualization.Diagram.HistoryChangeCause.Undo,this._raiseEvent("historyChange",f),t&&t.parent&&(e=typeof t.parent=="object"?t.parent.name:t.parent),e&&!t.isLane&&!this.nameTable[e]){this._isUndo=!1;this.undo();return}switch(n.type){case"pagesettingschanged":h={isUndo:!0,undoObject:n.undoObject,redoObject:n.redoObject};this._recordPageSettingsChanged(h);break;case"positionchanged":n.swimlaneMultiSelection?(n.undo=!0,this._recordMultiPinPointChanged(n)):(i={object:n.undoObject,isMultipleNode:n.isMultipleNode},this._recordPinPointChanged(i));this._undoredoUpdateRouting(n.undoObject.connectors);break;case"rotationchanged":n.swimlaneMultiSelection?(n.undo=!0,this._recordMultiRotationChanged(n)):(i={object:n.undoObject,isMultipleNode:n.isMultipleNode},this._recordRotationChanged(i));this._undoredoUpdateRouting(n.undoObject.connectors);break;case"sizechanged":n.undo=!0;n.swimlaneMultiSelection?this._recordMultiSizeChanged(n):(i={object:n.undoObject,isMultipleNode:n.isMultipleNode},this._recordSizeChanged(i,n));this._undoredoUpdateRouting(n.undoObject.connectors);break;case"endpointchanged":i={undoObject:n.undoObject,redoObject:n.redoObject,removePortType:n.removePortType,removedPort:n.removedPort,isMultipleNode:n.isMultipleNode,_isUndo:!0};this._recordEndPointChanged(i);break;case"collectionchanged":if(n.changeType=="insert"&&!this.nameTable[n.object.name]&&n.object._type!=="pseudoGroup"){if(this._groupUndo)return;this._isUndo=!1;this.undo()}i={changeType:n.changeType,childTable:n.childTable,edgeTable:n.edgeTable,isUndo:!0,sourcePorts:n.sourcePorts,targetPorts:n.targetPorts,index:n.index};i.object=jQuery.extend(!0,{},n.object);c=this._recordCollectionChanged(i,n);c&&(n.sourcePorts=i.sourcePorts,n.targetPorts=i.targetPorts,n.edgeTable=i.edgeTable,n.childTable=i.childTable);break;case"labelchanged":i={object:n.shape,label:n.previousLabelValue,index:n.index?n.index:0};this._recordLabelChanged(i);break;case"labelpositionchanged":n.undo=!0;this._recordLabelPositionChanged(n);break;case"labelsizechanged":n.undo=!0;this._recordLabelPositionChanged(n);break;case"labelrotationchanged":n.undo=!0;this._recordLabelPositionChanged(n);break;case"labelcollectionchanged":n.isUndo=!0;this.labelcollectionchanged(n);break;case"groupchanged":i={object:n.object,isUndo:!0,actionType:n.actionType};this._recordGroupChanged(i);break;case"phasepositionchanged":n.undo=!0;this._recordPhasesizeChanged(n);break;case"phasecollectionchanged":n=$.extend(!0,{},{phase:n.phase,group:n.group,isAdded:n.isAdded,phaseObject:n.phaseObject,islastPhase:n.islastPhase});n.undo=!0;this._recordPhaseCollectionChanged(n);break;case"propertiesChanged":r=this.nameTable[n.object.name];r&&(l=this._getModifiedProperties(r,n.values,n[n.elementType]),n.elementType=="node"?this.updateNode(r.name,n.values):n.elementType=="connector"?this.updateConnector(r.name,n.values):n.elementType=="label"?n.label=this.updateLabel(r.name,n.label,n.values):n.elementType=="port"&&this.updatePort(r.name,n.port,n.values),n.values=l);break;case"portpositionchanged":n.undo=!0;this._recordPortPositionChanged(n);break;case"portscollectionchanged":n.isUndo=!0;this._recordPortsCollectionChanged(n);break;case"nudge":this._recordNudgingChanges(t,n);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(n);break;case"sizeCommand":this._recordSizeCommandChanges(n);break;case"swapLane":n=jQuery.extend(!0,{},{undoObject:n.undoObject,redoObject:n.redoObject,moveIndex:n.moveIndex,insertIndex:n.currentIndex});n.undo=!0;ej.datavisualization.Diagram.canvasHelper._undoSwap(this,n);break;case"zOrder":a=n.start;r=this.nameTable[n.object.name];this._comparePropertyValues(r,"zOrder",{zOrder:n.end});n.command=="back"?(this._bringElementsToFront(n.start,n.end,n.object,n.nearestNode),n.command="front"):(this._sendElementsToBack(n.start,n.end,n.object,n.nearestNode),n.command="back");n.nearestNode=this._findObjectByIndex(a);v=n.start;n.start=n.end;n.end=v;this._deleteZorderProcess()}n.activeLabel?(this._clearSelection(!0),this._addSelection(n.activeLabel,!0)):this.selectionList.length&&t&&this.selectionList[0].name!=t.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[t.name],!0))}else this.model.historyManager.undo&&(u=this.model.historyManager.undo,typeof u=="string"&&(u=ej.util.getObject(u,window)),$.isFunction(u)&&(o=u(n.data),o&&(n.data=o)))},_undoredoUpdateRouting:function(n){var i,t,r;if(ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&n)for(i=Object.keys(n),t=0;t<i.length;t++)r=this.nameTable[i[t]],r._undoSegments=n[i[t]].segments,this._resetConnectorPoints(r,null),delete r._undoSegments},_redo:function(n){var f=[],t,s,e,h,i,c,l,r,a,u,o;if(this._UndoRedo=!1,n)if(n.category=="internal"){if(t=n.object||(n.undoObject?n.undoObject.node||n.undoObject:undefined)||n.shape,!t&&n.phase&&(t=n.phase),t&&n.undoObject&&n.undoObject.node&&(t=this.nameTable[t.name]||t),!t){this.redo();return}if(this.model.historyManager.redoStack.length>0&&(s=this.model.historyManager.redoStack.splice(0,1),this.model.historyManager.undoStack.splice(0,0,s[0])),f=this._ComparehistoryChangeEvent(t,n),f.cause=ej.datavisualization.Diagram.HistoryChangeCause.Redo,this._raiseEvent("historyChange",f),t&&t.parent&&(e=typeof t.parent=="object"?t.parent.name:t.parent),e&&!this.nameTable[e]){this._isUndo=!1;this.redo();return}switch(n.type){case"pagesettingschanged":h={isUndo:!1,undoObject:n.undoObject,redoObject:n.redoObject};this._recordPageSettingsChanged(h);break;case"positionchanged":n.swimlaneMultiSelection?(n.undo=!1,this._recordMultiPinPointChanged(n)):(i={object:n.redoObject,isMultipleNode:n.isMultipleNode},this._recordPinPointChanged(i));this._undoredoUpdateRouting(n.redoObject.connectors);break;case"rotationchanged":n.swimlaneMultiSelection?(n.undo=!1,this._recordMultiRotationChanged(n)):(i={object:n.redoObject,isMultipleNode:n.isMultipleNode},this._recordRotationChanged(i));this._undoredoUpdateRouting(n.redoObject.connectors);break;case"sizechanged":n.undo=!1;n.swimlaneMultiSelection?this._recordMultiSizeChanged(n):(i={object:n.redoObject,isMultipleNode:n.isMultipleNode},this._recordSizeChanged(i));this._undoredoUpdateRouting(n.redoObject.connectors);break;case"endpointchanged":i={undoObject:n.undoObject,redoObject:n.redoObject,removePortType:n.removePortType,removedPort:n.removedPort,isMultipleNode:n.isMultipleNode,_isUndo:!1};this._recordEndPointChanged(i);break;case"collectionchanged":i={changeType:n.changeType,childTable:n.childTable,edgeTable:n.edgeTable,isUndo:!1,sourcePorts:n.sourcePorts,targetPorts:n.targetPorts,index:n.index};i.object=jQuery.extend(!0,{},n.object);this._recordCollectionChanged(i,n.object);break;case"labelchanged":i={object:n.shape,label:n.updatedLabelValue,index:n.index?n.index:0};this._recordLabelChanged(i);break;case"labelpositionchanged":n.undo=!1;this._recordLabelPositionChanged(n);break;case"labelsizechanged":n.undo=!1;this._recordLabelPositionChanged(n);break;case"labelrotationchanged":n.undo=!1;this._recordLabelPositionChanged(n);break;case"labelcollectionchanged":n.isUndo=!1;this.labelcollectionchanged(n);break;case"groupchanged":i={object:n.object,actionType:n.actionType,isUndo:!1};this._recordGroupChanged(i);break;case"phasepositionchanged":n.undo=!1;this._recordPhasesizeChanged(n);break;case"phasecollectionchanged":n=$.extend(!0,{},{phase:n.phase,group:n.group,phaseObject:n.phaseObject,islastPhase:n.islastPhase,isAdded:n.isAdded});n.undo=!1;this._recordPhaseCollectionChanged(n);break;case"propertiesChanged":r=this.nameTable[n.object.name];r&&(c=this._getModifiedProperties(r,n.values,n[n.elementType]),n.elementType=="node"?this.updateNode(r.name,n.values):n.elementType=="connector"?this.updateConnector(r.name,n.values):n.elementType=="label"?n.label=this.updateLabel(r.name,n.label,n.values):n.elementType=="port"&&this.updatePort(r.name,n.port,n.values),n.values=c);break;case"portpositionchanged":n.undo=!1;this._recordPortPositionChanged(n);break;case"portscollectionchanged":n.isUndo=!1;this._recordPortsCollectionChanged(n);break;case"nudge":this._recordNudgingChanges(t,n,!0);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(n);break;case"sizeCommand":this._recordSizeCommandChanges(n);break;case"swapLane":n=jQuery.extend(!0,{},{undoObject:n.undoObject,redoObject:n.redoObject,moveIndex:n.moveIndex,insertIndex:n.currentIndex});n.undo=!1;ej.datavisualization.Diagram.canvasHelper._undoSwap(this,n);break;case"zOrder":l=n.start;r=this.nameTable[n.object.name];this._comparePropertyValues(r,"zOrder",{zOrder:n.end});n.command=="back"?(this._bringElementsToFront(n.start,n.end,n.object,n.nearestNode),n.command="front"):(this._sendElementsToBack(n.start,n.end,n.object,n.nearestNode),n.command="back");n.nearestNode=this._findObjectByIndex(l);a=n.start;n.start=n.end;n.end=a;this._deleteZorderProcess()}n.activeLabel?(this._clearSelection(!0),this._addSelection(n.activeLabel,!0)):this.selectionList.length&&t&&this.selectionList[0].name!=t.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[t.name],!0))}else this.model.historyManager.redo&&(u=this.model.historyManager.redo,typeof u=="string"&&(u=ej.util.getObject(u,window)),$.isFunction(u)&&(o=u(n.data),o&&(n.data=o)))},_startGroupAction:function(){this.addHistoryEntry({type:"startGroup",category:"internal"})},_closeGroupAction:function(){this.addHistoryEntry({type:"closeGroup",category:"internal"})},addHistoryEntry:function(n){var i,r,t,e,f,u;if(!this._preventHistoryEntry&&!this.model.historyManager.suspend){if(this.model.historyManager.canLog&&(i=this.model.historyManager.canLog,typeof i=="string"&&(i=ej.util.getObject(i,window)),$.isFunction(i)&&(f=this.getNode(n.object||n.undoObject&&n.undoObject.node||n.shape),r=this._ComparehistoryChangeEvent(f,n),u={changes:r.changes.length?r.changes[0]:null,source:r.source.length?this.getNode(r.source[0]):null},i(u)==!1)))return;n.category!="internal"&&(n={data:n});this._historyList.canUndo&&this._historyList.currentEntry&&(this._historyList.currentEntry.data||this._historyList.currentEntry.category=="internal")&&(t=this._historyList.currentEntry,t.next?t.previous&&(e=t.next,e.previous=null,t.next=n,n.previous=t):(t.next=n,n.previous=t));this._historyList.currentEntry=n;this.model.historyManager.stackLimit&&(this._historyList.currentEntry&&this._historyList.currentEntry.previous&&!this._lastbefore?this._lastbefore=n:this._historyList.currentEntry.previous||(this._lastbefore=null,this._historyCount=0),this._historyCount<this.model.historyManager.stackLimit?this._historyCount++:this._lastbefore&&(this._lastbefore.previous&&delete this._lastbefore.previous,this._lastbefore.next&&(this._lastbefore=this._lastbefore.next)));f=n.object||(n.redoObject?n.redoObject.node||n.redoObject:undefined)||n.shape;u=this._ComparehistoryChangeEvent(f,n);u.cause=ej.datavisualization.Diagram.HistoryChangeCause.CustomAction;this._getHistoryList();this._raiseEvent("historyChange",u);this._historyList.canUndo=!0;this._historyList.canRedo=!1}},removeHistoryEntry:function(n){var r,t,i,u,f;if(this._historyList.currentEntry!=null){if(r=this._historyList.currentEntry,r)if(r==n)t=r.previous,i=r.next,this._historyList.currentEntry=i||t;else{for(u=r.next;u;)if(u==n){t=u.previous;i=u.next;break}else u=u.next;for(f=r.previous;f;)if(f==n){t=f.previous;i=f.next;break}else f=f.previous}t&&i?(t.next=i,i.previous=t):t?t.next=null:i&&(i.previous=null)}},canRemoveHistoryEntry:function(n){return n.category!="internal"},clearHistory:function(){var n=this._historyList;n.currentEntry=null;n.canUndo=!1;n.canRedo=!1;this.model.historyManager.undoStack=[];this.model.historyManager.redoStack=[]},_getHistroyObject:function(n,t){t&&t.type!=="startGroup"&&t.type!=="closeGroup"&&n.push({redoObject:t.redoObject?t.redoObject:null,undoObject:t.undoObject?t.undoObject:null,type:t.type?t.type:null,isMultipleNode:t.isMultipleNode?t.isMultipleNode:null,category:t.category?t.category:""})},_getHistoryList:function(){var t=[],i=[],n=this._historyList.currentEntry,r,u;for(n=this._historyList.currentEntry,this._historyList.canUndo||this.model.historyManager.undoStack.length===0?this._getHistroyObject(t,n):this._getHistroyObject(i,n);n&&n.previous;)r=n.previous,this._getHistroyObject(t,r),n=n.previous;for(n=this._historyList.currentEntry;n&&n.next;)u=n.next,this._getHistroyObject(i,u),n=n.next;this.model.historyManager.undoStack=t;this.model.historyManager.redoStack=i},getUndoEntry:function(){var i=null,t,n=this._historyList;return n.canUndo&&(i=n.currentEntry,t=n.currentEntry.previous,t?(n.currentEntry=t,n.canRedo||(n.canRedo=!0)):(n.canRedo=!0,n.canUndo=!1)),i},getRedoEntry:function(){var i=null,t,n=this._historyList;return n.canRedo&&(t=n.currentEntry.previous||n.canUndo?n.currentEntry.next:n.currentEntry,t&&(n.currentEntry=t,n.canUndo||(n.canUndo=!0),t.next||(n.canRedo=!1,n.canUndo=!0)),i=n.currentEntry),i},cut:function(){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=0,this._setClipboard(),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,this._delete(),delete this._multipleAction)},insertLabel:function(n,t,i){var r,u,f,e;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(r=this.nameTable[n],r&&t&&(u=this.getObjectType(r)=="node"?this.model.defaultSettings.node:this.model.defaultSettings.connector,u=u?u:{},u&&u.labels&&r.labels&&u.labels[i!==undefined?i:r.labels.length]&&(t=$.extend(!0,{},u.labels[i!==undefined?i:r.labels.length],t)),u.labels=u.labels?u.labels:[],t=ej.datavisualization.Diagram.Label(t),t._parent=n,f=u.labels,f.splice(),this._collectionContains(t,r.labels)||r.labels.splice(i,0,t),e={element:r,index:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:f,newValue:r.labels},this._raisePropertyChange(e),ej.datavisualization.Diagram.DiagramContext.addLabel(r,t,this,i),this._isUndo||this.addHistoryEntry({type:"labelcollectionchanged",shape:r,label:t,isUndo:!0,category:"internal",index:i})))},addLabel:function(n,t){var i,u,r,f;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=this.nameTable[n],i&&t&&(r=this.getObjectType(i)=="node"?this.model.defaultSettings.node:this.model.defaultSettings.connector,r&&r.labels&&i.labels&&r.labels[i.labels.length]&&(t=$.extend(!0,{},r.labels[i.labels.length],t)),t=ej.datavisualization.Diagram.Label(t),t._parent=n,u=i.labels,i.labels.push(t),f={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:u,newValue:i.labels},this._raisePropertyChange(f),ej.datavisualization.Diagram.DiagramContext.addLabel(i,t,this),this.addHistoryEntry({type:"labelcollectionchanged",shape:i,label:t,isUndo:!0,category:"internal"})))},removeLabels:function(n,t){var f=[],i,u,r;if(t&&t.length>0){if(i=this.nameTable[n],i&&i.labels&&i.labels.length>0)for(u=t.length-1;u>=0;u--)for(r=i.labels.length-1;r>=0;r--)i.labels[r].name===t[u].name&&(ej.datavisualization.Diagram.SvgContext.deleteLabel(i,i.labels[r],this),f.push({index:r,label:$.extend(!0,{},i.labels[r])}),i.labels.splice(r,1));this._isUndo||this.addHistoryEntry({type:"labelcollectionchanged",shape:i,labels:f,isLabelRemove:!0,isUndo:!0,category:"internal"})}},_initLayer:function(){for(var t=this.model.layers,i,n=0;n<t.length;n++)t[n]=ej.datavisualization.Diagram.Layers(t[n]),i=t[n],(!i.visible||i.lock)&&(i.active=!1),this._updateLayer(t[n])},_updateLayer:function(n){for(var r=n.objects,i,t=0;t<r.length;t++)i=r[t],this._isUpdate(this.nameTable[i],n)&&this.updateNode(i,{})},_findLayer:function(n){for(var i=this.model.layers,r,t=0;t<i.length;t++)i[t].name===n&&(r=i[t]);return r},_checkGroupChild:function(n){for(var i,u,t,e,r=this._getChildren(n.children),f=0;r&&f<r.length;f++)if(i=this.nameTable[r[f]],u=this.model.layers,i.length>0){for(t=0;t<u.length;t++)e=u[t].objects.indexOf(i.name),e>-1&&(this.model.layers[t].objects.splice(e,1),this._updateLayer(u[t]));i.children&&this._checkGroupChild(i)}},addLayers:function(n){for(var t,u,i,f,r=0;r<n.length;r++)if(f=this.model.layers,n[r]=ej.datavisualization.Diagram.Layers(n[r]),t=n[r],(!t.visible||t.lock)&&(t.active=!1),!this._findLayer(t.name)&&(this.model.layers.push(t),t.objects&&t.objects.length))for(u=0;t&&u<t.objects.length;u++)i=this.nameTable[t.objects[u]],i&&(i.type==="group"&&this._checkGroupChild(i),!i||i.isLane||i.isPhase||this._isUpdate(i,t)&&(this.updateNode(i.name,{}),this._clearSelection(!0)))},addNodeToLayer:function(n,t){var r,u,i;if(r=this._findLayer(n),r)for(u=r.objects,i=0;i<t.length;i++)u.indexOf(t[i])<0&&(u.push(t[i]),this.updateNode(t[i],{}))},_isUpdate:function(n,t){var i=ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[n],"visible",this),r=ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[n],"lock",this);return t.visible!==i||t.lock!==r?!0:!1},removeNodeToLayer:function(n,t){var r,u,i,f;if(r=this._findLayer(n),r)for(u=r.objects,i=0;i<t.length;i++)f=u.indexOf(t[i].name),f>0&&(u.splice(f,1),this.updateNode(t[i],{}))},removeLayers:function(n){for(var r,i,u,t=0;t<n.length;t++)r=this.model.layers,i=this._findLayer(n[t].name),u=r.indexOf(i),this.model.layers.splice(u),this._updateLayer(i)},updateLayer:function(n,t){var i=this._findLayer(n),r=!1;t.visible!==undefined&&(i.visible!==t.visible&&(r=!0),i.visible=t.visible);t.lock!==undefined&&(i.lock!==t.lock&&(r=!0),i.lock=t.lock);t.print!==undefined&&(i.print=t.print);t.active!==undefined&&(i.active=t.active);t.snap!==undefined&&(i.snap!==t.snap&&(r=!0),i.snap=t.snap);t.objects!==undefined&&this._updateNodeToLayer(i.objects,t.objects);(!t.visible||t.lock)&&(i.active=!1);r&&this._updateLayer(i);this._clearSelection(!0)},_updateNodeToLayer:function(n,t){for(var r,u,f,i=0;i<t.length;i++)n.objects.indexOf(t[i])>-1&&r.push(t[i]);if(r.length>0)for(i=0;i<t.length;i++)u=t[i],r.indexOf(u)<0&&this.addNodeToLayer(n.name,u);else{for(f=ej.datavisualization.Diagram.Layers(),i=0;i<n.objects.length;i++)this.updateLayer(n.objects[i],f);n.objects=t;this._updateLayer(n)}},_isParent:function(n,t){var i;if(n){if(t.indexOf(n.parent)>-1||t.indexOf(n.name)>-1)return!0;if(n.parent&&this.nameTable[n.parent].parent)return this._isParent(this.nameTable[this.nameTable[n.parent].parent],t)}},_updatePortConnection:function(n,t,i){for(var r,u=0;u<t.length;u++)r=this.nameTable[t[u]],r&&(r.sourcePort===i.name?(i._removeFromSourcePort=!0,i._removeLine=r.name,r.sourcePort=null):r.targetPort===i.name&&(i._removeFromTargetPort=!0,i._removeLine=r.name,r.targetPort=null),(i._removeFromSourcePort||i._removeFromTargetPort)&&(this._dock(r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this)))},removePorts:function(n,t){var f=[],i,u,r;if(t&&t.length>0){if(i=this.nameTable[n],i&&i.ports&&i.ports.length>0)for(u=t.length-1;u>=0;u--)for(r=i.ports.length-1;r>=0;r--)i.ports[r].name===t[u].name&&(ej.datavisualization.Diagram.SvgContext.deletePort(i,i.ports[r],this),this._updatePortConnection(i,i.inEdges,i.ports[r]),this._updatePortConnection(i,i.outEdges,i.ports[r]),f.push($.extend(!0,{},i.ports[r])),i.ports.splice(r,1)[0]);this._isUndo||this.addHistoryEntry({type:"portscollectionchanged",object:i,collection:f,changeType:"remove",isUndo:!0,category:"internal"})}},_insertPort:function(n,t,i){var r,u;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(r=this.nameTable[n],r&&t&&(t=ej.datavisualization.Diagram.Port(t),this._collectionContains(t,r.ports)||(r.ports.splice(i,0,t),ej.datavisualization.Diagram.DiagramContext.renderPort(r,t,this,i))),u=[t],this.addHistoryEntry({type:"portscollectionchanged",object:r,collection:u.slice(),changeType:"insert",isUndo:!0,category:"internal"}))},addPorts:function(n,t){var i,u,r;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(i=this.nameTable[n],i&&t)){for(u=0;u<t.length;u++)r=ej.datavisualization.Diagram.Port(t[u]),r.parent=i.name,i.ports.push(r),this._raisePropertyChange({element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"ports",oldValue:null,newValue:r}),ej.datavisualization.Diagram.DiagramContext.renderPort(i,r,this);this.addHistoryEntry({type:"portscollectionchanged",object:i,collection:i.ports,changeType:"insert",isUndo:!0,category:"internal"})}},updatePort:function(n,t,i){var r,u;if(n&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))){if(r=this._findNode(n),i&&t&&(!i.name||t.name==i.name)&&r){t=this._findPort(r,t.name);this._isUndo||this._recordPropertiesChanged(r,i,"port",t);i.name=t.name;this._comparePropertyValues(r,"ports",i);for(u in i)t.hasOwnProperty(u)&&(t[u]=typeof i[u]=="object"?$.extend(!0,{},t[u],i[u]):i[u]);ej.datavisualization.Diagram.DiagramContext.updatePort(r,t,this)}i.offset&&(this._updateAssociatedConnectorEnds(r,this.nameTable),ej.datavisualization.Diagram.SvgContext._updateAssociatedConnector(r,this._svg,this))}},copy:function(){return(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=1,this.selectionList&&this.selectionList.length>0&&this._setClipboard()),this._cloneSelectionList()},paste:function(n,t){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&((n||this._clipboardData)&&(this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard),this._pasteMultipleLane(),this._paste(n,t!==undefined?t:!0))},_pasteMultipleLane:function(){var s,t,e=[],o=[],i,n,r=[],u,f;if(this._clipboardData&&(u=this._clipboardData,u=$.extend(!0,{},this._clipboardData),f=u.node,f._type=="pseudoGroup")){for(n=0;n<f.children.length;n++)s=f.children[n],t=u.childTable[s],t&&(t.isLane?(t._laneIndex=this._getRemoveIndex(t),this._collectionContains(t.parent,o)||o.push(t.parent),e[n]=t):r.push(t.name));if(e.length>0){if(i=this._sameParent(e,o,this._clipboardData.childTable),r.length>0)for(n=0;n<r.length;n++)this._collectionContains(r[n],i.children)||i.children.push(r[n]);i&&i.children&&(this._clipboardData.node.children=i.children)}}},_sameParent:function(n,t,i){var e,h,f,o,v,l,s=[],y,r=[],u,c,a;if(a=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),n.length>1&&t.length>0){for(n=this._sortByLaneIndex(n),e=0;e<t.length;e++){for(l=ej.datavisualization.Diagram.Util.randomId(),s=[],h=0;h<n.length;h++)o=n[h],o&&o.isLane&&o.parent===t[e]&&(v=this.getNode(o),y=this._cloneLaneObj(v,l,i),s.push(y));if(c=this.nameTable[t[e]],c&&c.parent&&(u=this.nameTable[c.parent],u.isSwimlane))for(r=u.children[1].children.slice(),f=0;f<r.length;f++)r[f]=$.extend(!0,{},r[f]),r[f].name+=l;s&&r&&s.length>0&&r.length>0&&(u={type:"swimlane",offsetX:u.offsetX+10,offsetY:u.offsetY+10,orientation:u.orientation,lanes:s,phases:r},a.children.push(u))}return a}},_commandPaste:function(){this.paste()},_getNodesfrombounds:function(n,t){for(var e=!1,c,i,s=[],l=this.nodes(),r,h,u,f=0,o=l.length;f<o;f++)r=this.nameTable[l[f].name],t&&r&&(e=t.name===r.name?!0:!1),r&&r.visible&&!e&&(i=ej.datavisualization.Diagram.Util.bounds(r),i=ej.datavisualization.Diagram.Geometry.rect([i.topLeft,i.topRight,i.bottomRight,i.bottomLeft]),ej.datavisualization.Diagram.Util.canSelect(r)&&ej.datavisualization.Diagram.Util.enableLayerOption(r,"lock",this)&&(c=this.getObjectType(r),ej.datavisualization.Diagram.Geometry.containsRect(n,i)?r.parent===""&&s.push(r):c==="group"&&this.activeTool&&this.activeTool.inAction&&this.activeTool._checkGroupChildren(s,r,n)));for(h=this.connectors(),f=0,o=h.length;f<o;f++)u=this.nameTable[h[f].name],t&&u&&(e=t.name===u.name?!0:!1),u&&u.visible&&!e&&(i=ej.datavisualization.Diagram.Util.bounds(u),i=ej.datavisualization.Diagram.Geometry.rect([i.topLeft,i.topRight,i.bottomRight,i.bottomLeft]),ej.datavisualization.Diagram.Util.canSelect(u)&&ej.datavisualization.Diagram.Util.enableLayerOption(h,"lock",this)&&ej.datavisualization.Diagram.Geometry.containsRect(n,i)&&u.parent===""&&s.push(u));return s},_setClipboard:function(){var y,r,u,t,h,c,l,o,s;if(this.selectionList.length>0){var i,n=this.selectionList[0],f={},a=[],e,v;if(n._type==="group"||n.type==="pseudoGroup"){for(t=this._getChildren(n.children),r=0;r<t.length;r++)for(u=r+1;u<t.length;u++)h=this.nameTable[this._getChild(t[r])],c=this.nameTable[this._getChild(t[u])],c&&h&&c.zOrder<h.zOrder&&(y=t[r],t[r]=t[u],t[u]=y);for(l=[],o=n.children.length-1;o>=0;o--)s=this.nameTable[this._getChild(n.children[o])],s.type==="connector"&&(n.children.splice(n.children.indexOf(s.name),1),l.push(s.name));n.children=n.children.concat(l);f=this._getChildTable(n,f)}f[n.name]=n;e=ej.datavisualization.Diagram.Util.bounds(n);v={x:e.x,y:e.y,width:e.width,height:e.height};a=this._getNodesfrombounds(v,n);i=$.extend(!0,{},{childTable:f,node:n,collection:a});i.node.segments&&(i.node.targetNode=null,i.node.targetPort=null,i.node.sourceNode=null,i.node.sourcePort=null);i.addInfo=this._updateClipBoardConnectors(n,f);this._clipboardData=i}},_updateClipBoardConnectors:function(n,t){var i,u=[],r;if(n&&n.type==="pseudoGroup"&&n.children.length>0)for(r=0;r<n.children.length;r++)i=this.nameTable[this._getChild(n.children[r])],i&&(i.isSwimlane||i.isLane)&&this._updateSwimlaneGroupConnectors(n,i,t,u);else this._updateSwimlaneGroupConnectors(null,n,t,u);return u},_updateEdgesToClipboard:function(n,t,i,r,u,f){var s,h,e,o;i.parent&&n&&(s=this.nameTable[n.sourceNode],h=this.nameTable[n.targetNode],s&&h&&(e=this.nameTable[s.parent],o=this.nameTable[h.parent],(e&&e.isLane&&o&&o.isLane||e&&o&&(e.type=="group"||o.type=="group"))&&(!this._collectionContains(n.name,f?i.outEdges:i.inEdges)||this._collectionContains(n.name,u)||this._collectionContains(n.name,t?t:[])||u.push(this.nameTable[this._getChild(n)]))))},_updateSwimlaneConnectors:function(n,t,i,r){if(t){for(var f,u=0;u<t.inEdges.length>0;u++)f=this.nameTable[this._getChild(t.inEdges[u])],this._updateEdgesToClipboard(f,n,t,i,r);for(u=0;u<t.outEdges.length>0;u++)f=this.nameTable[this._getChild(t.outEdges[u])],this._updateEdgesToClipboard(f,n,t,i,r,!0)}},_updateSwimlaneGroupConnectors:function(n,t,i,r){var u=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,t),s,e,f,o,h;for(!u&&n&&t.isLane&&(u=[t.name]),e=0;u&&e<u.length;e++)if(f=this.nameTable[this._getChild(u[e])],f&&f.children&&f.children.length>0)for(s=f.children,o=0;o<s.length;o++)h=this.nameTable[this._getChild(s[o])],h&&this._updateSwimlaneGroupChildConnectors(n&&n.children?n.children:null,h,i,r)},_updateSwimlaneGroupChildConnectors:function(n,t,i,r){var u=0,e,f;if(this._updateSwimlaneConnectors(n&&n.children?n.children:null,t,i,r),f=t.children,f)for(u=0;u<f.length;u++)e=this.nameTable[this._getChild(f[u])],e&&this._updateSwimlaneGroupChildConnectors(n,e,i,r)},_getChildTable:function(n,t){var u,f,o,e,i,s,h,r;if(f=this._getChildren(n.children),f)for(e=0;e<f.length;e++)if(o=f[e],u=this.nameTable[o],u&&(u.parent===n.name||n.type=="pseudoGroup")){if(i=t[u.name]=$.extend(!0,{},u),(i._type==="group"||i.type==="pseudoGroup")&&(t=this._getChildTable(i,t)),i.inEdges&&i.inEdges.length>0)for(s in i.inEdges)r=this.nameTable[i.inEdges[s]],r&&(t[r.name]&&delete t[r.name],t[r.name]=r);if(i.outEdges&&i.outEdges.length>0)for(h in i.outEdges)r=this.nameTable[i.outEdges[h]],r&&(t[r.name]&&delete t[r.name],t[r.name]=r)}return t},isSameParent:function(n){var t;if(n.length>1){for(t=1;t<n.length;t++)if(n[t]!==n[0])return!1;return!0}},_sortByLaneIndex:function(n){return n.sort(function(n,t){return n._laneIndex>t._laneIndex?1:t._laneIndex>n._laneIndex?-1:0})},_paste:function(n,t){var f,c,i,a,k,s,h,r,o,p,v,d,g,nt,w,rt,ut,l,y,b,tt,e,ft,it,u;if(n){var h="",c=[],s=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"});for(t&&(h=ej.datavisualization.Diagram.Util.randomId()),u=0;u<n.length;u++)n[u].name+=h,n[u].outEdges&&(n[u].outEdges=[]),n[u].inEdges&&(n[u].inEdges=[]),n.length>1&&s.children.push(n[u].name),n[u].type!="connector"?(n[u].type!=="group"&&n[u].type!=="bpmn"||n[u].isSwimlane||(this._clonePasteGroup(n[u],h,n),this.add($.extend({},n[u]))),n[u].isSwimlane?(this._clonePasteSwimlaneObj(n[u],h,n),it=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,n[u],f),this._outOfBoundsOnNudge(it,diagram._pasteIndex*10,this._pasteIndex*10)&&this.add(it)):this.add($.extend({},n[u]))):c.push(n[u]);for(u=0;u<c.length;u++)c[u].sourceNode&&this.nameTable[c[u].sourceNode+h]?c[u].sourceNode+=h:(c[u].sourceNode="",c[u].sourcePort=""),c[u].targetNode&&this.nameTable[c[u].targetNode+h]?c[u].targetNode+=h:(c[u].targetNode="",c[u].targetPort=""),n.length>1&&s.children.push(c[u].name),this.add($.extend({},c[u]));n.length>1&&(this.nodes().push(s),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[s.name]=s,this._clearSelection(!0),ej.datavisualization.Diagram.Util._updateGroupBounds(s,this),this.addSelection(s,!0))}else if(this._clipboardData&&(f=this._clipboardData,c=[],f=$.extend(!0,{},this._clipboardData),i=f.node,a=!1,i.zOrder=-1,this.tools.move._outOfBoundsDrag(i,this._pasteIndex*10,this._pasteIndex*10)&&i&&i.type!="phase")){if(i.container)i.isSwimlane?(this.model.historyManager.startGroupAction(),a=!0,i=this._pasteSwimlaneObj(i,f),f.childTable=this._getChildTable(i,f.childTable)):(i.isLane?(i=this._cloneLaneObj(i,ej.datavisualization.Diagram.Util.randomId(),f.childTable),i.orientation==="vertical"&&(i.height=i.height),b=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(i,this,this._clipboardData,!0),b&&(this._pasteObj=!0,this.add(b),this._pasteObj=!1),i=b):!i.container||i.isLane||i.isSwimlane||(i=this._cloneContainer(i,ej.datavisualization.Diagram.Util.randomId(),f.childTable),this._preserveConnection(f.childTable,i),this.add(i),i=this.nameTable[i.name]),o=this._pasteIndex*10,this._translate(i,o,o,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(i,this)),this._selectionContains(i)&&(this._clearSelection(!0),this._addSelection(i));else if(i.type=="pseudoGroup"){for(k=i.children,s=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this._isUndo=!0,this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,u=0;u<k.length;u++)h=k[u],r=typeof h=="object"?h:f.childTable[h],r.zOrder=-1,r._annotation&&delete r._annotation,r&&(r.isSwimlane||r.type==="swimlane")?(a=!0,r=this._pasteSwimlaneObj(r,f),r&&this._isUndo&&(o=this._pasteIndex*10,this._translate(r,o,o,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this)),r||(this.add(h),r=this.nameTable[h.name],this._clipboardData.childTable=this._getChildTable(r,f.childTable),this._clipboardData.node.children[u]=r,this._clipboardData.childTable[r.name]=r,p=!0),r&&s.children.push(r.name),i=s):r&&r.isLane?(v=this._pasteSwimlane(r,f,!0,this._pasteIndex*10),v&&s.children.push(v.name),o=this._pasteIndex*10,this._translate(v,o,o,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(v,this)):r&&(h=h+ej.datavisualization.Diagram.Util.randomId(),delete f.childTable[r.name],p&&(this._clipboardData.childTable[r.name]=r),r.name=h,r.parent="",f.childTable[r.name]=r,this._preserveConnection(f.childTable,r),d=!0,r.segments&&(g=!0,nt=!0,f.childTable[r._oldSourceNode]&&!this.nameTable[r.sourceNode]&&(g=!1,r.sourceNode=null),f.childTable[r._oldTargetNode]&&!this.nameTable[r.targetNode]&&(nt=!1,r.targetNode=null),g||nt||(d=!1)),d&&(s.children.push(h),r._type==="group"&&r.type!="bpmn"?this._pasteChildren(f.childTable,r):r.children=[],o=this._pasteIndex*10,this._translate(r,o,o,this.nameTable),!r.segments||r.segments.length!=1||r.segments[0].type!="orthogonal"||r.sourceNode||r.targetNode||(l=r.segments[0].points),y=!1,y=this.add(r),l&&y&&(r=this.nameTable[r.name],r.segments[0].points=l,ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom))));a&&this.model.historyManager.startGroupAction();delete this._multipleAction;this._clearSelection();s&&s.children.length>0&&(this.nodes().push(s),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[s.name]=s,ej.datavisualization.Diagram.Util._updateGroupBounds(s,this),this._addSelection(s),w={},w=this._getChildTable(this.selectionList[0],w),rt={type:"collectionchanged",object:this._updatePsedoGroupChildren(this.selectionList[0]),childTable:jQuery.extend(!0,{},w),changeType:"insert",category:"internal"},this.addHistoryEntry(rt),this._isUndo=!1)}else i.type=="bpmn"?(ut=ej.datavisualization.Diagram.Util.randomId(),i.parent="",i.name=i.name+ut,i.inEdges=[],i.outEdges=[],i.children=[],i._annotation&&delete i._annotation,o=this._pasteIndex*10,this._translate(i,o,o,this.nameTable),this.add(i)):(i.name=i.name+ej.datavisualization.Diagram.Util.randomId(),i.parent="",i._type==="group"?this._pasteChildren(f.childTable,i):i.segments||i.segments||(i.inEdges=[],i.outEdges=[]),o=this._pasteIndex*10,this._translate(i,o,o,this.nameTable),!i.segments||i.segments.length!=1||i.segments[0].type!="orthogonal"||i.sourceNode||i.targetNode||(l=i.segments[0].points),y=this.add(i),y&&l&&(i=this.nameTable[i.name],i.segments[0].points=l,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom)),this._updateSelectionHandle());if(f.addInfo.length){for(tt in f.addInfo)e=f.addInfo[tt],e.isSwimlane?(f.childTable[e.name]=e,f.childTable=this._getChildTable(e,f.childTable),e=this._pasteSwimlaneObj(e,f),f.childTable[e.name]=e,f.childTable=this._getChildTable(e,f.childTable)):(f.childTable[e.name]&&e!==f.childTable[e.name]&&(e=$.extend(!0,{},f.childTable[e.name])),ft=e.name+ej.datavisualization.Diagram.Util.randomId(),e.name=ft,e.parent="",e._oldSourceNode&&e._oldTargetNode&&(f.childTable[e.name]=e,this._preserveConnection(f.childTable,e),o=this._pasteIndex*10,this._translate(e,o,o,this.nameTable),this.add(e),p&&(c[tt]=e),this._selectionContains(e)&&this._clearSelection(!0)));p&&(this._clipboardData.addInfo=c);this._selectionContains(i)||this._addSelection(i)}a&&this.model.historyManager.closeGroupAction();this._pasteIndex++}},_cloneContainer:function(n,t,i){var u,f,r;for(n.name=n.name+t,u=0;u<n.children.length;u++)f=i?i:this.nameTable,r=f[this._getChild(n.children[u])],r.name+=t,r.parent=n.name,r.children&&r.children.length>0&&(r=this._cloneContainer(r,t,i)),n.children[u]=r;return ej.datavisualization.Diagram.bpmnHelper.updateProcessCollection(n,this),n},_clonePasteGroup:function(n,t,i){for(var f,u,r=0;r<n.children.length;r++)if(n.children[r].name+=t,n.children[r].parent=n.name,n.children[r].segments)n.children[r].sourceNode&&(n.children[r].sourceNode+=t),n.children[r].targetNode&&(n.children[r].targetNode+=t);else{for(u=0;u<n.children[r].inEdges.length;u++)f=n.children[r].inEdges[u],this._collectionContains(f,n.children)||i&&this._collectionContains(f,i)?f+=t:n.children[r].inEdges.splice(u,1);for(u=0;u<n.children[r].outEdges.length;u++)f=n.children[r].outEdges[u],this._collectionContains(f,n.children)||i&&this._collectionContains(f,i)?f+=t:n.children[r].outEdges.splice(u,1)}},_clonePasteSwimlaneObj:function(n,t,i){var s,h,e,u,f,c,r,o;if(n.lanes&&n.lanes.length>0)for(r=0;r<n.lanes.length;r++)if(n.lanes[r]&&(n.lanes[r].name+=t,n.lanes[r].children&&n.lanes[r].children.length>0)){for(s=n.lanes[r].children,h=[],e=0;e<s.length;e++){for(u=jQuery.extend(!0,{},s[e]),u.name+=t,u.parent=n.lanes[r].name,f=0;f<u.inEdges.length;f++)this._collectionContains(u.inEdges[f],i)?(u.inEdges[f]+=t,n.lanes[r].children[e]=u):u.inEdges.splice(f,1);for(f=0;f<u.outEdges.length;f++)this._collectionContains(u.outEdges[f],i)?(u.outEdges[f]+=t,n.lanes[r].children[e]=u):u.outEdges.splice(f,1);h.push(u)}n.lanes[r].children=h}if(n.phases&&n.phases.length>0){for(c=[],r=0;r<n.phases.length;r++)n.phases[r]&&(o=jQuery.extend(!0,{},n.phases[r]),o.name+=t,o.parent="",c.push(o));n.phases=c}},_cloneLaneObj:function(n,t,i){var n=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneLaneObj(this,n,t,i);return n},_cloneSwimlaneObj:function(n,t,i){n=$.extend(!0,{},n);var n=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneSwimlaneObj(this,n,t,i);return n},_pasteSwimlaneObj:function(n,t){return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlaneObj(this,n,t)},_pasteSwimlane:function(n,t,i,r){if(n&&n.isSwimlane)return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlane(this,n,t,i,r)},_cloneNode:function(n,t,i,r){var f=!1,e=null,n,u;if(n){if(n=typeof n=="string"?n:n.name,n=jQuery.extend(!0,{},t.childTable[n]),n.isPhaseStack&&(n.name=n.name.split("phaseStack")[0]+i+"phaseStack",f=!0,e=n.name),n.children&&n.children.length>0)for(u=0;u<n.children.length;u++)this._cloneNode(n.children[u],t,i,e),n.children[u]&&(typeof n.children[u]=="string"?n.children[u]+=i:n.children[u].name+=i);r?n.parent=typeof r=="string"?r:r.name:n.parent!=""&&(n.parent+=i);f||(n.name+=i);this._preserveConnection(t.childTable,n);this.nameTable[n.name]=n}},_cloneSwimlane:function(n,t,i){var f=n.name,u,r;if(n.name+=i,n.children&&n.children.length>0)for(r=0;r<n.children.length;r++)this._cloneNode(n.children[r],t,i,n),typeof n.children[r]=="string"?n.children[r]+=i:n.children[r]=n.children[r].isPhaseStack?f+i+"phaseStack":n.children[r].name+i;if(n.phases&&n.phases.length>0)for(r=0;r<n.phases.length;r++)u=jQuery.extend(!0,{},this.nameTable[this._getChild(n.phases[r])]),u.name+=i,u.parent+=i,this.nameTable[u.name]=u,n.phases[r]=u.name;this.nameTable[n.name]=n},_pasteChild:function(n,t,i,r){var u=n.name+ej.datavisualization.Diagram.Util.randomId();delete t[n.name];n.name=u;t[n.name]=n;this._preserveConnection(t,n);n.parent=i.name;r.push(u);n._type==="group"&&this._pasteChildren(t,n);this.add(n)},_pasteChildren:function(n,t){for(var r,e,f=[],u=t.children,i=0;i<u.length;i++)e=this._getChild(u[i]),r=n[e],r.zOrder=-1,r&&this._pasteChild(r,n,t,f);for(t.children=[],i=0;i<f.length;i++)t.children.push(this.nameTable[f[i]]);this._preserveConnection(n,t)},_preserveConnections:function(n,t){for(var i,u=this._getChildren(t.children),r=0;r<u.length;r++)i=n[u[r]],i&&(this._preserveConnection(n,i),i._type==="group"&&this._preserveConnections(n,t))},_preserveConnection:function(n,t){var r,i,f,u;if(t.segments)t.targetNode&&(u=n[t.targetNode],u&&u.inEdges.push(t.name)),t.sourceNode&&(u=n[t.sourceNode],u&&u.outEdges.push(t.name));else{if(f=t.inEdges.length,f>0){for(r=0;r<f;r++)i=n[t.inEdges[r]],i&&(i._oldTargetNode=i.targetNode,i.targetNode=t.name);t.inEdges=[]}if(f=t.outEdges.length,f>0){for(r=0;r<t.outEdges.length;r++)i=n[t.outEdges[r]],i&&(i._oldSourceNode=i.sourceNode,i.sourceNode=t.name);t.outEdges=[]}}},_expandChildren:function(n){for(var i,t,r=0;r<n.outEdges.length;r++)i=this.nameTable[n.outEdges[r]],t=this.nameTable[i.targetNode],t.excludeFromLayout||(i.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateQuad(i),t.isExpanded&&this._expandChildren(t),t.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(t,this),this._updateQuad(t))},_collapseChildren:function(n){for(var i,t,r=0;r<n.outEdges.length;r++)i=this.nameTable[n.outEdges[r]],t=this.nameTable[i.targetNode],t.excludeFromLayout||(i.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),this._checkParentNodeVisible(t,i)&&(t.isExpanded&&this._collapseChildren(t),t.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(t,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t)))},_checkParentNodeVisible:function(n,t){var i,r;if(n.inEdges.length>=1){for(i=0;i<n.inEdges.length;i++)if(r=this._findNode(n.inEdges[i]),r.name!=t.name&&r.visible)return!1;return!0}},zoomTo:function(n){n||(n=new ej.datavisualization.Diagram.Zoom);n.zoomCommand&ej.datavisualization.Diagram.ZoomCommand.ZoomIn?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+n.zoomFactor,0,0,n.focusPoint,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+n.zoomFactor),0,0,n.focusPoint,!0)},remove:function(n){n&&this.nameTable[n.name]&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))?this._delete(n):this._delete()},clear:function(){if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this)){this._clearSelection();var n=this;for(this._views.forEach(function(t){var i=n._views[t];$(i.diagramLayer).empty();$(n._expander).empty();$(n._adornerLayer.children).empty();$(i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0]).empty()});this.nodes().length>0;)this.nodes().pop();while(this.connectors().length>0)this.connectors().pop();this._nodes=[];this._connectors=[];this.nameTable={};this.selectionList=[];this.clearHistory();this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this);this._updateScrollOffset(0,0)}},_clearElementCollection:function(){$(this.element).find(".ej-d-node").remove();$(this.element).find(".ej-d-group").remove();$(this.element).find(".ej-d-seperator").remove();var n=this.model.dataSourceSettings.dataSource;if(typeof n!="string"&&n.length){for($(this.element).find(".ej-d-connector").remove();this.nodes().length>0;)this.nodes().pop();while(this.connectors().length>0)this.connectors().pop();this._nodes=[];this._connectors=[];this.nameTable={};this.selectionList=[];this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this)}},_updateChildOnGroup:function(n){var i=null,t;return n&&n.parent&&(i=this._svg.document.getElementById(n.parent),t=this.nameTable[n.parent],t&&(t.container?ej.datavisualization.Diagram.ContainerHelper._add(this,n):(n=this.nameTable[this._getChild(n)],n!=null&&t.children.push(n),n._type=="group"&&this._initGroupNode(n),ej.datavisualization.Diagram.Util._refreshParentGroup(n,this)))),i},_raiseChildrenPropertyChange:function(n,t){var i,e,o,c,a;if(n&&n.parent){var r=this._findNode(n.parent),s,h,f=[],u=[];if(r){if(r.isLaneStack)i=this._getNode(r.parent),u=i.lanes,u=u.slice(),t?i.lanes.push(n):(e=ej.datavisualization.Diagram.canvasHelper._getLaneIndex(i,n),i.lanes.splice(e,1)),f=i.lanes,s=i,h="lanes";else if(r.isPhaseStack)i=this._getNode(r.parent),u=i.phases,u=u.slice(),t?i.phases.push(n):(e=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,n.name),i.phases.splice(e,1)),f=i.phases,s=i,h="phases";else{var r=this._getNode(n.parent),l=[],e=-1;for(o=0;o<r.children.length;o++)c=this._getNode(r.children[o]),c&&(c.name===n.name&&(e=o),l.push(c));u=l.slice();f=l.slice();t?f.push(n):f.splice(e,1);s=r;h="children"}a={element:s,cause:this._isDragg||this.activeTool.inAction?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:h,oldValue:u,newValue:f};this._raisePropertyChange(a)}}},addLane:function(n,t){var i,r;this._isLaneApi=!0;n.isLane&&(n=this._dynamicLane(n,this),t||n.parent?(i=this._updateDynamicLane(this,n,t),i&&i.isSwimlane?(r=this.nameTable[this._getChild(i.children[2])],n=ej.datavisualization.Diagram.canvasHelper._updateDropLaneProperties(this,n,i),t||t===0?r.children.splice(t,0,n):r.children.push(n),n.parent=r.name,this._swimlaneObject=!0):n=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(n,this),this.add(n),r&&i&&(ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,i),this._clearSelection(!0),this._addSelection(i)),delete this._swimlaneObject):(n=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(n,this),this.add(n)));delete this._isLaneApi},_dynamicLane:function(n,t){var i=ej.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(n,t.nameTable),r=i.orientation;return i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,t.nameTable),i.minHeight=n.height,i.minWidth=n.width,i.parent=n.parent,i.orientation=r,n.orientation&&(i.orientation=n.orientation),i.isLane&&(i=ej.datavisualization.Diagram.ContainerHelper._initContainer(t,i)),i},_updateDynamicLane:function(n,t){var i,r;if(t.parent)r=n.nameTable[t.parent];else for(i=0;i<this.selectionList.length;i++)r=this.selectionList[i];return r},_resetValues:function(n){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(n)&&n&&(n._points&&delete n._points,n._sourceNodeInfo&&delete n._sourceNodeInfo,n._targetNodeInfo&&delete n._targetNodeInfo,n._obstacle&&delete n._obstacle,n._outerBounds&&delete n._outerBounds,n._sourcePointInfo&&delete n._sourcePointInfo,n._sourcePortInfo&&delete n._sourcePortInfo,n._targetPointInfo&&delete n._targetPointInfo,n._targetPortInfo&&delete n._targetPortInfo)},_add:function(n,t,i,r){var y,p,h,d,o,e,w,u,g,c,b,l,k,s,a,f,nt,v,tt;if(this._resetValues(n),!n.length>0&&(n=ej.datavisualization.Diagram.NodeType(n,this),this.model.nodeTemplate&&n._type==="node"?y=this._getNodeTemplate():p=this._getConnectorTemplate(),y&&y(this,n),p&&p(this,n)),n.pivot||(n.pivot={x:.5,y:.5}),!n||!(n.segments||n.sourcePoint||n.targetPoint||n.sourceNode||n.targetNode)||n.segments&&n.segments[0]&&n.segments[0].points||(h=$.extend(!0,{},n),h=this._getNewConnector(h)),h&&this._outOfBoundsOnNudge(h,0,0)||!h&&this._outOfBoundsOnNudge(n,0,0)){if(d=this._eventCause,this._raiseChildrenPropertyChange(n,!0),this._eventCause=d,o=!1,(n.isSwimlane||n.type==="swimlane")&&!this._pasteObj&&this._isNewNode&&(n=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,n)),n.length>0)for(f=0;f<n.length;f++)this.add(n[f]);else if(n.addInfo&&(n.addInfo.height&&(n.height=n.addInfo.height),n.addInfo.width&&(n.width=n.addInfo.width)),e=n.type=="connector"?"connector":"node",u={changeType:"insert",element:this.getNode(n)},n.isLane?this._isDragg||!this._selectedSymbol?(s=this._isUndo?ej.datavisualization.Diagram.GroupChangeCause.HistoryChange:ej.datavisualization.Diagram.GroupChangeCause.Drop,this._isLaneApi&&(s=ej.datavisualization.Diagram.GroupChangeCause.Unknown),w=this.getNode(n),u={changeType:"insert",element:w,state:"changing"},this._eventCause.nodeCollectionChange=s,g=u,u=this._raiseEvent(e+"CollectionChange",u),u||(u=g),u.cancel||(this._updateLane(n,u.element),this._raiseGroupChangeEvent(w,null,this.getNode(n.parent),s))):this._updateLane(n,u.element):n.isSwimlane?(u=this._raiseCollectionChangeEvent(n,e),this._updateSwimlane(n,u.element,!0)):n.container&&!$.isEmptyObject(n.container)&&(n=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,n)),n.isLane||n.isSwimlane){if(!u.cancel&&(o=n.isLane&&(this._selectedSymbol&&this._selectedSymbol.isLane||this._swimlaneObject||this._isUndo)?!0:this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[n.name]=n,o)){if(n._type==="group"&&t){if(this._paletteItemClick&&(n.offsetX=n.minWidth/2+50,n.offsetY=n.minHeight/2+50),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this),n.phases&&n.phases.length>0)for(a=null,f=0,nt=n.phases.length;f<nt;f++)a=this.nameTable[this._getChild(n.phases[f])],a.type=="phase"&&ej.datavisualization.Diagram.SvgContext.renderphase(a,this._svg,this._diagramLayer,this);this._clearSelection(!0);this._addSelection(n)}this._updateQuad(n)}}else if(n.type!="connector"){if(s=this._eventCause[e+"CollectionChange"],s||(this._eventCause[e+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),n._type==="group"||n.children&&n.children.length>0?(this._convertGroupChild(n,[]),n=ej.datavisualization.Diagram.Group(n),this.nameTable[n.name]=n,u=this._raiseCollectionChangeEvent(n,e),n._type="group",n.type=="bpmn"&&(n=ej.datavisualization.Diagram.Util._updateBpmnChild(n,this)),this._initGroupNode(n),this._isGroupNode||n.type==="bpmn"||this._udpateChildRotateAngle(n)):n.isPhase||(n=this._getNewNode(n),this.nameTable[n.name]=n,u=this._raiseCollectionChangeEvent(n,e),this._getNodeDimension(n)),!u.cancel&&(n._status="new",o=n.parent?!0:this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[n.name]=n,o)){if(this._containerOverNode&&(ej.datavisualization.Diagram.canvasHelper._addNodeToContainer(this,n,this._containerOverNode),delete this._containerOverNode),n._type==="group"||n.children&&n.children.length>0?(this._updateParent(n),n.offsetX==0&&n.offsetY==0&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this,!0),this._updateChildrenEdges(n),c=null,c=this._updateChildOnGroup(n),t&&!n.parent&&(delete this._isNodeInitializing,ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this))):t&&(c=null,c=this._updateChildOnGroup(n),(n.parent===""||n.isPhase||this._isInsert)&&ej.datavisualization.Diagram.DiagramContext.renderNode(n,this,c),this._selectedSymbol&&n.textBlock&&(b=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],b&&(l=$(b).find("#"+n.name+"label")[0],l&&l.childNodes&&l.childNodes.length>0&&(l.childNodes[0].style.display="none")))),this._updateQuad(n),this.nameTable[n.name]=n,n._type==="group"||n.children&&n.children.length>0)for(f=0;f<n.children.length;f++)k=n.children[f],this.nameTable[k.name]=k;t&&!r&&(this._clearSelection(!0),this._addSelection(n))}this._addNodeToGraph(n)}else n=this._getNewConnector(n),this.nameTable[n.name]=n,s=this._eventCause[e+"CollectionChange"],s||(this._eventCause[e+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),u=this._raiseCollectionChangeEvent(n,e),u.cancel||(o=n.parent?!0:this.connectors().push(n),n._status="new",o&&(this._updateEdges(n),this._dock(n,this.nameTable),this._routeEdge(n),ej.datavisualization.Diagram.Util.updateBridging(n,this),this._updateConnectorBridging(n),n.parent||t&&ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.nameTable[n.name]=n,this._updateQuad(n),this._updateChildOnGroup(n),t&&!r&&(this._clearSelection(!0),this._addSelection(n))));this._setZorder(n);!this._isUndo&&(!this._selectedSymbol||this._endEditing)&&o&&(v={},this.selectionList&&this.selectionList.length>0&&(v=this._getChildTable(this.selectionList[0],v)),i&&(!i||i.entryHistory)||n.isPhase||(tt={type:"collectionchanged",object:jQuery.extend(!0,{},n),childTable:jQuery.extend(!0,{},v),changeType:"insert",category:"internal"},this.addHistoryEntry(tt)));this._trigger("refresh");this._isRefreshTriggered=!0;!o||n.isPhase||n.isLane||this._selectedSymbol&&!this._endEditing||(u.state="changed",this._raiseEvent(e+"CollectionChange",u))}return delete this._isNewNode,o},_raiseCollectionChangeEvent:function(n,t){var i={changeType:"insert",element:this.getNode(n),state:"changing"};return n.isPhase||this._selectedSymbol&&!this._endEditing||(this._raiseEvent(t+"CollectionChange",i),n._absolutePath=null),i},add:function(n,t){var i,r;if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))return this._isNodeInitializing=!0,this._isNewNode=!0,i=ej.datavisualization.Diagram.Util.enableLayerOption({},"active",this),i&&(i=ej.datavisualization.Diagram.Layers(i),i.objects.indexOf(n.name)<0&&i.objects.push(n.name)),r=this._add(n,!0,t),delete this._isNodeInitializing,r},updateUserHandles:function(n){n=this.nameTable[n.name];ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,n,this._adornerSvg,!1,!1,this._currZoom,this)},scrollToNode:function(n){var u,f,s=this._vScrollbar&&this._vScrollbar._scrollData?this._vScrollbar._scrollData.buttonSize:0,h=this._hScrollbar&&this._hScrollbar._scrollData?this._hScrollbar._scrollData.buttonSize:0,i=this._currZoom,r=this.element[0].getBoundingClientRect(),t=ej.datavisualization.Diagram.Util.bounds(n),e,o;u=(t.x+t.width/2)*i;f=(t.y+t.height/2)*i;e=this._hScrollOffset;o=this._vScrollOffset;r.width+this._hScrollOffset<u+t.width/2*i&&(e=u+(t.width/2+s)*i-r.width);r.height+this._vScrollOffset<f+t.height/2*i&&(o=f+(t.height/2+h)*i-r.height);this._updateScrollOffset(e,o)},findNode:function(n){return this._findNode(n)},getObjectType:function(n){return ej.datavisualization.Diagram.Util.getObjectType(n)},_registerDrawingTools:function(){var t,n;for(t in this.model.drawingTools)n=this.model.drawingTools[t],n.diagram=this,this.tools[n.name]=n},_sortByXvalue:function(n){for(var f,i,r,u,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[this._getChild(n[t])],o=this.nameTable[this._getChild(n[i])],r=ej.datavisualization.Diagram.Util.bounds(e),u=ej.datavisualization.Diagram.Util.bounds(o),(r.x>u.x||r.right>u.right)&&(f=n[t],n[t]=n[i],n[i]=f);return n},_sortByYvalue:function(n){for(var f,i,r,u,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[this._getChild(n[t])],o=this.nameTable[this._getChild(n[i])],r=ej.datavisualization.Diagram.Util.bounds(e),u=ej.datavisualization.Diagram.Util.bounds(o),(r.y>u.y||r.bottom>u.bottom)&&(f=n[t],n[t]=n[i],n[i]=f);return n},_sortByZIndex:function(n,t){var u,i,r;if(t)for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder>n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);else for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder<n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);return n},_updateBPMNIndex:function(n,t){var s,r,u,o,i,f,e;if(n.type==="bpmn"&&n.parent&&(o=this.nameTable[n.parent],o&&o.isLane))for(i=o.children,r=0;r<i.length;r++)for(u=r+1;u<i.length;u++)f=this.nameTable[this._getChild(i[r])],e=this.nameTable[this._getChild(i[u])],!(t?f.zOrder>e.zOrder:f.zOrder<e.zOrder)||f.isPhase||e.isPhase||f.isLane||e.isLane||(s=i[r],i[r]=i[u],i[u]=s)},_sortByGroupChildrenZIndex:function(n){for(var s=this.nodes(),h,i,u,r,t,f,e,o=0;o<s.length;o++)if(r=s[o],this._updateBPMNIndex(r,n),r._type==="group"&&r.type!=="bpmn"&&!r.isSwimlane){for(t=this._getChildren(r.children),i=0;i<t.length;i++)for(u=i+1;u<t.length;u++)f=this.nameTable[this._getChild(t[i])],e=this.nameTable[this._getChild(t[u])],!(n?f.zOrder>e.zOrder:f.zOrder<e.zOrder)||f.isPhase||e.isPhase||f.isLane||e.isLane||(h=t[i],t[i]=t[u],t[u]=h);r.children=t}},_findCornerNodes:function(){var i,r,u,f,e,n,s=this.selectionList[0].children,o=this.nameTable[this._getChild(this.selectionList[0].children[0])],t,h,c,l,a;if(i=o,r=o,u=o,f=o,s.length>1)for(e=0;e<s.length;e++)t=this.nameTable[this._getChild(s[e])],n=ej.datavisualization.Diagram.Util.bounds(t),h=ej.datavisualization.Diagram.Util.bounds(r),n.x+n.width>h.x+h.width&&(r=t),c=ej.datavisualization.Diagram.Util.bounds(f),n.y+n.height>c.y+c.height&&(f=t),l=ej.datavisualization.Diagram.Util.bounds(i),n.x<l.x&&(i=t),a=ej.datavisualization.Diagram.Util.bounds(u),n.y<a.y&&(u=t);return{left:i,right:r,top:u,bottom:f}},_comparePropertyOnAlign:function(n,t,i,r){n&&(n.segments?(this._comparePropertyValues(n,"sourcePoint",{sourcePoint:{x:n.sourcePoint.x+t,y:n.sourcePoint.y+i}},r),this._comparePropertyValues(n,"targetPoint",{targetPoint:{x:n.targetPoint.x+t,y:n.targetPoint.y+i}},r)):(n.offsetX!=n.offsetX+t&&this._comparePropertyValues(n,"offsetX",{offsetX:n.offsetX+t},null,r),n.offsetY!=n.offsetY+i&&this._comparePropertyValues(n,"offsetY",{offsetX:n.offsetY+i},null,r)))},_moveNode:function(n,t,i){this._comparePropertyOnAlign(i,n,t,ej.datavisualization.Diagram.ActionType.Align);this._translate(i,n,t,this.nameTable);this._updateNodeMargin(i);ej.datavisualization.Diagram.DiagramContext.update(i,this)},_updateContainerOnNudge:function(n){var t=this.nameTable[n.parent];t&&t.container&&(ej.datavisualization.Diagram.canvasHelper._updateNodeMargin(this,n,t),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,t,!0))},_outOfBoundsOnNudge:function(n,t,i){var r=this.nameTable[this._getChild(n.parent)],u,e,h,a;if(r&&r.isLane&&r.parent){if(u=this.nameTable[this._getChild(r.parent)],u&&u.isLaneStack&&u.parent&&(e=this.nameTable[this._getChild(u.parent)],e&&this.model.pageSettings.boundaryConstraints!="infinity")){var c=ej.datavisualization.Diagram.Util.bounds(r),l=ej.datavisualization.Diagram.Util.bounds(n),f=ej.datavisualization.Diagram.Util.bounds(e),o=f.right,s=f.bottom;if(l.bottom+i+20>=c.bottom&&(s+=i),l.right+t+20>=c.right&&(o+=t),h=this.activeTool._getPageBounds(),i>0&&f.bottom!=s&&s>h.height||t>0&&f.right!=o&&o>h.width)return!1}}else return a=this.tools.move,a._outOfBoundsDrag(n,t,i);return!0},_anyFromSwimlane:function(n){if(n.parent){var t=this.nameTable[n.parent];return t&&t.container&&t.isLane?this._getSwimlane(t):this._anyFromSwimlane(t)}return null},_nudge:function(n,t,i,r,u,f){var l,h,a,e,o,s;if(!n||!n.segments||!n.sourceNode||!n.targetNode){var v,y=this.nameTable[n.parent],c;if(n._type!=="label"){if(this._outOfBoundsOnNudge(n,t,i)){if(!u)if(n.segments)c={element:n,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:r,propertyName:"sourcePoint",oldValue:{sourcePoint:n.sourcePoint},newValue:{sourcePoint:{x:n.sourcePoint.x+t,y:n.sourcePoint.y+i}}},this._raisePropertyChange(c),c={element:n,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:r,propertyName:"targetPoint",oldValue:{targetPoint:n.targetPoint},newValue:{targetPoint:{x:n.targetPoint.x+t,y:n.targetPoint.y+i}}},this._raisePropertyChange(c);else{var p=r==="right"||r==="left"?n.offsetX:n.offsetY,w=r==="right"||r==="left"?n.offsetX+t:n.offsetY+i,b=r==="right"||r==="left"?"offsetX":"offsetY";c={element:n,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:r,propertyName:b,oldValue:p,newValue:w};this._raisePropertyChange(c)}if(e=this.nameTable[n.parent],e&&e.isLane&&(l=this._moveOnLane(n,e,t,i)),!0&&(!l||l.proceedY)||(i=0),!0&&(!l||l.proceedX)||(t=0),n.type=="pseudoGroup"){for(h=this._removeContainerConnector(this._getChildren(n.children)),h=this._sortByYvalue(h),h=this._sortByXvalue(h),a=h.length-1;a>=0;a--)if(v=this.nameTable[this._getChild(h[a])],v&&!this._nudge(v,t,i,r,!0,a===0))break;ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(this,v);delete this._disableSwimlaneUptate;ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}else this._translate(n,t,i,this.nameTable,undefined,undefined,!0),f||n.parent&&(e=this.nameTable[n.parent],o=this._anyFromSwimlane(n),o&&o.isSwimlane&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0)),this._updateContainerOnNudge(n);if(this._updateNodeMargin(n),n.parent){if(e=this.nameTable[n.parent],e&&e.container&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,e.container.type==="canvas"&&ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,e),delete this._disablePhaseUpdate,!u,o=this._anyFromSwimlane(n),o&&(ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,o),!u,this._updateSwimlanes||(this._updateSwimlanes=[]),this._collectionContains(o.name,this._updateSwimlanes)||this._updateSwimlanes.push(o.name),u||(delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(o,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,o,!0)))),f&&this._updateSwimlanes){for(delete this._disableSwimlaneUptate,s=0;s<this._updateSwimlanes.length;s++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[s]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[s]]);delete this._updateSwimlanes}}else if(f&&this._updateSwimlanes){for(s=0;s<this._updateSwimlanes.length;s++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[s]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[s]]);delete this._updateSwimlanes}else n.type!="pseudoGroup"&&ej.datavisualization.Diagram.DiagramContext.update(n,this);return this._updateSelectionHandle(!0),!0}return!1}return y=this.findNode(n._parent),this.translateLabel(y,n,t,i),ej.datavisualization.Diagram.DiagramContext.update(n,this),this._updateSelectionHandle(!0),!0}},_removeContainerConnector:function(n){var r=[],t,i;if(n&&n.length>0)for(t=0;t<n.length;t++)i=this.nameTable[this._getChild(n[t])],i&&!i.segments?r.push(n[t]):!i.segments||i.sourceNode||i.targetNode||r.push(n[t]);return r},_moveOnLane:function(n,t,i,r){var h=!1,o=0,c=!1,s=0,u,f,e;return i=i?i:0,r=r?r:0,t.children&&t.children.length>0&&(u=this.nameTable[this._getChild(t.children[0])],u&&u.name.indexOf("_Headerr")!=-1&&(t.orientation==="horizontal"?o=u.width:t.orientation==="vertical"&&(s=u.height))),n&&t?(f=ej.datavisualization.Diagram.Util.bounds(n),e=ej.datavisualization.Diagram.Util.bounds(t),f.y+r>=e.y+t.paddingTop+s&&(h=!0),f.x+i>=e.x+t.paddingLeft+o&&(c=!0),{proceedY:h,proceedX:c,x:e.x+t.paddingLeft+o-f.x+i,y:e.y+t.paddingTop+s-f.y+r}):void 0},_selectCommand:function(n){this._isEditing&&(this._endEdit(),document.getElementById(this._id).focus());n.keyDownEventArgs.preventDefault();this.selectAll()},_nudgeCommand:function(n){!this._currentState&&this.selectionList[0]&&(this._currentState={x:this.selectionList[0].offsetX,y:this.selectionList[0].offsetY});this.nudge(n.parameter,n.keyDownEventArgs.shiftKey?5:1);n.keyDownEventArgs.preventDefault()},_startEditCommand:function(){var n,t,i;this.selectionList.length>0&&(n=this.selectionList[0],n.type=="pseudoGroup"||(n.type==="text"&&this._setLabelEditing(n.textBlock)&&this._startEdit(n),n.isSwimlane?(t=this.nameTable[n.name+"_header_swimlane"],t&&this._startEdit(t)):n.isLane?n.children&&n.children.length>0&&(t=this.nameTable[this._getChild(n.children[0])],t&&this._startEdit(t)):n.type&&n.type==="phase"?(i=this.nameTable["phaseStack"+n.name],i&&this._startEdit(i)):n.labels.length>0&&this._setLabelEditing(n.labels[0])&&this._startEdit(n)))},_findObjectByName:function(n){var t=null;return this._findNode(n)&&(t=this._findNode(n)),this._findConnector(n)&&(t=this._findConnector(n)),t},_findObjectByIndex:function(n,t){var e,u=null,i,r,f,o;if(t){if(o=this.nameTable[this.selectionList[0].parent],o)for(e=this._getChildren(o.children),f=0;f<e.length;f++)i=this.nameTable[e[f]],i.zOrder===n&&(u=e[f])}else{for(r=0;r<this.nodes().length;r++)i=this.nodes()[r],i.zOrder!==n||i._isProcessed||(u=i,i._isProcessed=!0);for(r=0;r<this.connectors().length;r++)i=this.connectors()[r],i.zOrder!==n||i._isProcessed||(u=i,i._isProcessed=!0)}return typeof u=="string"?this.nameTable[u]:u},_findOverlapNode:function(n,t){var r=[],i,u,h=[],f,c,o,s,e;if(n.parent){if(f=ej.datavisualization.Diagram.Util.bounds(n),c=this.nameTable[n.parent],c)for(s=this._getChildren(c.children),i=0;i<s.length;i++)s[i]!==n.name&&(o=this.nameTable[s[i]],e=ej.datavisualization.Diagram.Util.bounds(o),o&&this._intersect(f,e)&&h.push(o))}else{for(i=0;i<this.nodes().length;i++)r.push(this.nameTable[this._getChild(this.nodes()[i])]);for(i=0;i<this.connectors().length;i++)r.push(this.nameTable[this._getChild(this.connectors()[i])]);if(t==="sendToBack"||t==="bringToFront")return r;if(f=ej.datavisualization.Diagram.Util.bounds(n),n)for(u=0;u<r.length;u++)e=ej.datavisualization.Diagram.Util.bounds(r[u]),n.name===r[u].name||n.children&&this._collectionContains(r[u].name,n.children)||this._intersect(f,e)&&h.push(r[u])}return h},_intersect:function(n,t){return n.x<=t.x+t.width&&t.x<=n.x+n.width&&n.y<=t.y+t.height&&t.y<=n.y+n.height},_focusToItem:function(n){var u=this.nodes(),f=this.connectors(),i=0,r=[],t,e=this;if(u.length||f.length){this._diagramElements||(r=this.nodes().concat(this.connectors()),r=this._sortByZIndex(r,!0),r=r.map(function(n){return n.name}),this._diagramElements=r);i=this._focusedElement||this.selectionList.length||!this._diagramElements.length?this._focusedElement?this._diagramElements.indexOf(this._focusedElement):this.selectionList[0].type!="pseudoGroup"?this._diagramElements.indexOf(this.selectionList[0].name):Math.min.apply(Math,this.selectionList[0].children.map(function(n){return e._diagramElements.indexOf(n.name||n)})):n.keyDownEventArgs.shiftKey?0:this._diagramElements.length-1;do(i=n.keyDownEventArgs.shiftKey?i!=0?--i:this._diagramElements.length-1:i!=this._diagramElements.length-1?++i:0,this.nameTable[this._diagramElements[i]].type!="pseudoGroup")&&(this._focusedElement=this._diagramElements[i]);while(!ej.datavisualization.Diagram.Util.canSelect(this.nameTable[this._focusedElement])&&ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[this._focusedElement],"lock",this));t=ej.datavisualization.Diagram.Util.bounds(this.nameTable[this._focusedElement]);t={x:t.x-8,y:t.y-8,width:t.width+16,height:t.height+16};this.bringIntoView({x:t.x-25,y:t.y-25,width:t.width+50,height:t.height+50});ej.datavisualization.Diagram.SvgContext._drawNavigationHighlighter(t,this._adornerSvg,this._adornerLayer,this._currZoom);n.keyDownEventArgs.preventDefault()}},_selectFocusedItem:function(n){ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer);var t=this.nameTable[this._focusedElement];this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Keydown;t&&this.addSelection(t,!0);this._diagramElements=null;this._focusedElement=null;n.keyDownEventArgs.preventDefault()},_createDefaultTooltip:function(){var n=document.createElement("div"),t={id:this.element[0].id+"_DefaulttooltipDiv","class":"e-diagram-tooltip-default",style:"padding-top:3px; height: 24px;pointer-events:none;"},i;return ej.datavisualization.Diagram.Util.attr(n,t),this._tooltipLayer.appendChild(n),this.model.tooltipTemplateId||(i=document.createElement("span"),t={"class":"e-diagram-tooltipLabel-default",id:"e-diagram-tooltipLabel-default"},ej.datavisualization.Diagram.Util.attr(i,t),n.appendChild(i)),n},_createMouseOverTooltip:function(){var n=document.createElement("div"),t={id:this.element[0].id+"_mouseovertooltipDiv","class":"e-diagram-tooltip-mouseover",style:"pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(n,t),this._tooltipLayer.appendChild(n),n},_renderTooltip:function(n,t){var u,f,r,s,e,h,c,o,l,i;n.parent&&this.nameTable[n.parent]&&this.nameTable[n.parent].container&&(u=this._currZoom,f=ej.datavisualization.Diagram.Util.bounds(this.activeTool.helper,!0),n={x:f.x*u,y:f.y*u,width:f.width*u,height:f.height*u,rotateAngle:this.activeTool.helper.rotateAngle,offsetX:this.activeTool.helper.offsetX,offsetY:this.activeTool.helper.offsetY,type:"SwimlaneHelper"});this.model.selectedItems.tooltip&&(r=document.getElementById(this.element[0].id+"_DefaulttooltipDiv"),r||(r=this._createDefaultTooltip()),o=this._currZoom,this.model.selectedItems.tooltip.templateId?$.templates&&this.model.selectedItems.tooltip&&(n.segments||(i=this._getTooltipPosition(n,this.model.selectedItems.tooltip),i.x=-this._hScrollOffset+i.x*o,i.y=-this._vScrollOffset+i.y*o,r.style.top=i.y+"px",r.style.left=i.x+"px",r.style.transform="translate("+i.tx+" ,"+i.ty+")",s=$.templates("#"+this.model.selectedItems.tooltip.templateId),h=s.render(n),$(r).html(h))):(t&&(r.style.width="150px"),c=150,l=r.childNodes[0],this.activeTool instanceof ej.datavisualization.Diagram.MoveTool?n.segments||(e=n.type!=="SwimlaneHelper"?"X : "+Math.round(n.offsetX-n.width*n.pivot.x)+"px  Y : "+Math.round(n.offsetY-n.height*n.pivot.y)+"px":"X : "+Math.round(n.x)+"px  Y : "+Math.round(n.y)+"px"):this.activeTool instanceof ej.datavisualization.Diagram.ResizeTool?e="W : "+Math.round(n.width)+"px  H : "+Math.round(n.height)+"px":this.activeTool instanceof ej.datavisualization.Diagram.RotateTool&&(t&&(r.style.width="50px"),c=50,e=Math.round(n.rotateAngle)+"°"),e?(i=this._getTooltipPosition(n,this.model.selectedItems.tooltip),i.x=-this._hScrollOffset+i.x*o,i.y=-this._vScrollOffset+i.y*o,r.style.top=i.y+"px",r.style.left=i.x+"px",r.style.transform="translate("+i.tx+" ,"+i.ty+")",l.textContent=e):this._removeTooltip()))},_removeTooltip:function(){var n=document.getElementById(this.element[0].id+"_DefaulttooltipDiv");n&&n.parentNode.removeChild(n)},_removeMouseOverTooltip:function(){var n=document.getElementById(this.element[0].id+"_mouseovertooltipDiv");n&&n.parentNode.removeChild(n)},_renderCanvas:function(n){this._browserInfo=ej.browserInfo();this._canvas=document.getElementById(this.element[0].id+"_canvas");this._canvas||(this._canvas=document.createElement("div"),this.element.append(this._canvas));this._canvas.setAttribute("id",this.element[0].id+"_canvas");(this._canvas.getAttribute("class")===null||this._canvas.getAttribute("class")==="")&&this._canvas.setAttribute("class","drawing");$(this._canvas).css({position:"relative",height:this.model.height,width:this.model.width});this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this._views[this._id].canvas=this._canvas;this.element[0].setAttribute("tabindex","0");this._renderDiagram(n);ej.datavisualization.Diagram.Util.canFloatElements(this)&&this._setItemDraggable(this._canvas)},_getDigramBounds:function(n){var t,i,u,f,r;return t=this._spatialSearch.pageLeft||0,i=this._spatialSearch.pageTop||0,u=this._spatialSearch.pageRight-this._spatialSearch.pageLeft||0,f=this._spatialSearch.pageBottom-this._spatialSearch.pageTop||0,n!="content"&&(this.model.pageSettings&&this._multiplePage()?(t=this._spatialSearch.pageLeft,i=this._spatialSearch.pageTop,this._pageWidth()&&(t=Math.floor(t/this._pageWidth())*this._pageWidth(),u=Math.ceil(this._spatialSearch.pageRight/this._pageWidth())*this._pageWidth()-t),this._pageHeight()&&(i=Math.floor(i/this._pageHeight())*this._pageHeight(),f=Math.ceil(this._spatialSearch.pageBottom/this._pageHeight())*this._pageHeight()-i),this._spatialSearch.pageRight===null&&this._pageWidth()!==0&&(u=this._pageWidth()),this._spatialSearch.pageBottom===null&&this._pageHeight()!==0&&(f=this._pageHeight())):(this._pageWidth()&&(t=0,u=this._pageWidth()),this._pageHeight()&&(i=0,f=this._pageHeight()))),r=new ej.datavisualization.Diagram.Rectangle,r.x=t,r.y=i,r.width=u,r.height=f,r},_initContextMenu:function(n){this.enableContextMenu()?this._renderContextMenu(n):$("#"+this.element[0].id+"_contextMenu").remove()},_renderContextMenuItem:function(n){var r=document.createElement("li"),o=document.createElement("a"),s=ej.datavisualization.Diagram.Locale[this.locale()],t,u,f,e,i,h;if(s||(s=ej.datavisualization.Diagram.Locale["en-US"]),o.innerText=s[n.name]||n.text,r.setAttribute("id",this.element[0].id+"_contextMenu_"+n.name),t=document.createElement("span"),t.setAttribute("id",n.name+"_image"),u="display:table-cell; vertical-align:middle; text-align:center;",n.imageUrl&&(u=u+"background-image: url("+n.imageUrl+");width:25px;height:25px"),t.setAttribute("style",u),f="sf-d-menuitem "+n.name,n.cssClass&&(f=f+" "+n.cssClass),t.setAttribute("class",f),o.appendChild(t),n.subItems&&n.subItems.length>0){for(e=document.createElement("ul"),i=0,i;i<n.subItems.length;i++)h=this._renderContextMenuItem(n.subItems[i],e),h.setAttribute("style","display:block;"),e.appendChild(h);r.appendChild(e)}return r.appendChild(o),r},_renderContextMenu:function(){var f=$.extend(!0,[],this.model.contextMenu.items),r,e,u,n,t,s,i,o;if(!this.model.contextMenu.showCustomMenuItemsOnly){for(r=[],n=0;n<this._defaultContextMenuItems.length;n++)if(e=!1,this.model.contextMenu.items.length)for(u=0;u<this.model.contextMenu.items.length;u++){if(this.model.contextMenu.items[u].name===this._defaultContextMenuItems[n].name){e=!0;break}u!==this.model.contextMenu.items.length-1||e||r.push(this._defaultContextMenuItems[n])}else r.push(this._defaultContextMenuItems[n]);for(n=0;n<r.length;n++)f.push(r[n])}for(n=0,i=document.createElement("ul"),i.setAttribute("id",this.element[0].id+"_contextMenu"),n=0;n<f.length;n++)t=f[n],t.templateId?(o=this._renderEjTemplate("#"+t.templateId,t),o&&(i.innerHTML=o)):t&&t.name&&(s=this._renderContextMenuItem(t,i),i.appendChild(s));this._canvas.appendChild(i);$("#"+this.element[0].id+"_contextMenu").ejMenu({menuType:ej.MenuType.ContextMenu,contextMenuTarget:"#"+this.element[0].id+"_canvas",click:$.proxy(this._onMenuItemClick,this),beforeOpen:$.proxy(this._onContextMenuOpen,this),mouseover:$.proxy(this._onMenuItemMouseOver,this),mouseout:$.proxy(this._onMenuItemMouseOut,this),close:$.proxy(this._onContextMenuClose,this)});$("#"+this.element[0].id+"_contextMenu")[0].style.display="none"},_onContextMenuClose:function(n){if(this.model.contextMenuClose){var t={diagram:this,contextMenu:n};this._trigger("contextMenuClose",t)}else this.element[0].focus()},_onContextMenuOpen:function(n){var t,i,r,u;if(n.events&&!n.events.originalEvent&&(n.events.originalEvent=n.events),this.activeTool.mouseup&&(this.activeTool.name=="textTool"?(this._endEdit(),this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()):this.activeTool.mouseup(n.events,!0)),this._disableDefaultContextMenu)return delete this._disableDefaultContextMenu,!1;t=this.element[0].id;i=this._findNodeUnderMouse(n);i===null&&n.target&&$(n.target).attr("class")==="segmentEnd"&&this.selectionList[0]&&(i=this.selectionList[0]);r=!1;$(n.target).parents(".e-scrollbar").length&&this.enableContextMenu()&&(n.cancel=!0,$("#"+this.element[0].id+"_contextMenu").ejMenu("instance").hideContextMenu());this.selectionList[0]&&(this.selectionList[0].type==="pseudoGroup"||this.selectionList[0]._type==="group")&&(r=!0);i||!(this.selectionList.length>0)||r||this.activeTool&&this.activeTool.name=="textTool"||this._clearSelection();this.enableContextMenu()&&($("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display=this.selectionList.length?"block":"none"),$("#"+t+"_contextMenu_copy")[0]&&($("#"+t+"_contextMenu_copy")[0].style.display=this.selectionList.length?"block":"none"),$("#"+t+"_contextMenu_paste")[0]&&($("#"+t+"_contextMenu_paste")[0].style.display=this._clipboardData?"block":"none"),$("#"+t+"_contextMenu_undo")[0]&&($("#"+t+"_contextMenu_undo")[0].style.display=this._historyList&&this._historyList.canUndo?"block":"none"),$("#"+t+"_contextMenu_redo")[0]&&($("#"+t+"_contextMenu_redo")[0].style.display=this._historyList&&this._historyList.canRedo?"block":"none"),$("#"+t+"_contextMenu_selectAll")[0]&&($("#"+t+"_contextMenu_selectAll")[0].style.display=this.nodes().length+this.connectors().length?"block":"none"),$("#"+t+"_contextMenu_grouping")[0]&&($("#"+t+"_contextMenu_grouping")[0].style.display=this.selectionList[0]&&(this.selectionList[0].type=="group"||this.selectionList[0].type=="pseudoGroup")?"block":"none"),$("#"+t+"_contextMenu_order")[0]&&($("#"+t+"_contextMenu_order")[0].style.display=this.selectionList.length?"block":"none"));u={diagram:this,contextMenu:n,contextmenu:n};u.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this;this._trigger("contextMenuBeforeOpen",u);this.enableContextMenu()&&($("#"+t+"_contextMenu")[0].style.display="block",$("#"+t+"_contextMenu")[0].clientHeight<=2&&(n.cancel=!0),$("#"+t+"_contextMenu")[0].style.display="none")},_onMenuItemClick:function(n){var t=n.events.ID.replace(this._id+"_contextMenu_","");if(n.canExecute=!0,n.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this,this._trigger("contextMenuClick",n),n.canExecute)switch(t){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"selectAll":this.selectAll();break;case"group":this.group();break;case"ungroup":this.ungroup();break;case"bringToFront":this.bringToFront();break;case"sendToBack":this.sendToBack();break;case"moveForward":this.moveForward();break;case"sendBackward":this.sendBackward()}},_onMenuItemMouseOver:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).addClass("hover")},_onMenuItemMouseOut:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).removeClass("hover")},_renderDiagram:function(n){var t=this;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);this._layoutUpdate||this._doLayout();this._views.forEach(function(i){var r=t._views[i],u;r.type=="mainview"&&r.context==ej.datavisualization.Diagram.SvgContext&&(r.context._renderDocument(r,t,n),t._createScrollbar(t._canvas,t),ej.datavisualization.Diagram.ScrollUtil._initScrollbar(t),ej.datavisualization.Diagram.PageUtil._updatePageSize(t));n||(u=t._setNodeZOrder(r),t._renderDiagramObjects(u,r))});$(this._svg.document).pinchDiagram(this._view,this)},_createScrollbar:function(n,t){var r=document.createElement("div"),i;r.setAttribute("id",n.id+"_hScrollbar");document.getElementById(n.id+"_hScrollbar")||t._svgParent.appendChild(r);i=document.createElement("div");i.setAttribute("id",n.id+"_vScrollbar");document.getElementById(n.id+"_vScrollbar")||t._svgParent.appendChild(i)},_disableScrollbar:function(){this._isMobile&&($("#"+this._hScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}),$("#"+this._vScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}))},_doLayout:function(){var n,t;if(this.model.layout&&this._layoutType()!==ej.datavisualization.Diagram.LayoutTypes.None&&!this._isLoad&&(this._updateEdgeCollection(),ej.datavisualization.Diagram.Layout.doLayout(this),ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&(n=this.nodes(),n.length>1)))for(this.lineRouting.GenerateVisibilityGraph(this,n.length),t=0;t<n.length;t++)this._updateAllEdges(n[t])},_updateNodes:function(){for(var t=this.nodes(),n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateConnectors:function(){for(var t=this.connectors(),n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateEdgeCollection:function(){for(var n=0;n<this.connectors().length;n++)this._updateEdges(this.connectors()[n])},updateViewPort:function(){this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);ej.datavisualization.Diagram.DiagramContext.updateViewPort(this);this.model.scrollSettings.viewPortHeight=this._viewPort.height;this.model.scrollSettings.viewPortWidth=this._viewPort.width;var n=this;this._views.forEach(function(t){var r=n._views[t],i;r.type=="overview"&&(i=$("#"+t).ejOverview("instance"),i&&i._scrollOverviewRect(n._hScrollOffset,n._vScrollOffset,n._currZoom))});ej.datavisualization.Diagram.ScrollUtil._updateRuler(this,n._hScrollOffset,n._vScrollOffset)},_containsSameIndex:function(){return!1},_setZorder:function(n){var r,t,i;if(n&&n.zOrder){if(n.zOrder==-1)if(this._containsSameIndex(this._zOrder)){do this._zOrder++;while(this._containsSameIndex(this._zOrder));n.zOrder=this._zOrder}else n.zOrder=this._zOrder,this._zOrder++;if(n._type==="group")for(r=n.children,i=0;i<r.length;i++)t=this.nameTable[this._getChild(r[i])],t&&t.zOrder&&t.zOrder===-1&&this._setZorder(t)}},_union:function(n,t){var i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),u=Math.max(n.x+n.width,t.x+t.width),f=Math.max(n.y+n.height,t.y+t.height);return new ej.datavisualization.Diagram.Rectangle(i,r,u-i,f-r)},_getSeperetor:function(n){return this.nameTable[n]},_updateNextPhase:function(n,t,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._updateNextPhase(this,n,t,i)},_getOuterNodes:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getOuterNodes(this,n,t,i)},_getInnerNodes:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getInnerNodes(this,n,t,i)},_moveOuterNodes:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOuterNodes(this,n,t,i)},_moveOnPhaseChange:function(n,t,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOnPhaseChange(this,n,t,i)},_getPhaseDifferece:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseDifferece(this,n,t,i)},_updatePhaseOffset:function(n){var t=this.nameTable[n.name],o,i,e=this.nameTable[t.parent],f=this._getChildren(e.children),u=f.indexOf(t.name),r;f&&f.length>0&&u>-1&&n.offset!=undefined&&(o=this.nameTable[f[u]],i=n.offset-t.offset,r=this.nameTable[e.parent],i=this._getPhaseDifferece(r,u,i),this._moveOuterNodes(r,i,u),u===0?t.orientation==="horizontal"?(t.width+=i,t.offset=t.width,this._comparePropertyValues(r,"offsetX",{offsetX:r.offsetX+i/2},this.activeTool.inAction)):(t.height+=i,t.offset=t.height,this._comparePropertyValues(r,"offsetY",{offsetY:r.offsetY+i/2},this.activeTool.inAction)):t.orientation==="horizontal"?(t.width+=i,t.offset+=i,this._comparePropertyValues(r,"offsetX",{offsetX:r.offsetX+i/2},this.activeTool.inAction)):(t.height+=i,t.offset+=i,this._comparePropertyValues(r,"offsetY",{offsetY:r.offsetY+i/2},this.activeTool.inAction)),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._moveOnPhaseChange(t,i,u),this._updateNextPhase(r,i,u),delete this._disablePhaseUpdate,delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,r))},_updatePhase:function(n){var t=this.nameTable[n.name];t&&(t.offset!=undefined&&n.offset!=undefined&&n.offset!=t.offset&&(this._comparePropertyValues(t,"offset",{offset:n.offset},this.activeTool.inAction),this._updatePhaseOffset(n),this._hasSelection()&&this._clearSelection(!0)),this._updateSwimlanePhase(t,n))},_setNodeZOrder:function(){for(var o=null,n=this.nodes(),i,f,t,r,u,s,h,n=n.concat(this.connectors()),e=0;e<n.length;e++)n[e].parent===""&&this._setZorder(n[e]);for(i=0;i<n.length;i++){for(f=i+1;f<n.length;f++)n[i].zOrder>n[f].zOrder&&n[i].parent===""&&n[f].parent===""&&(o=n[i],n[i]=n[f],n[f]=o);if(n[i]._type==="group"&&(t=n[i].children,!n[i].isSwimlane))for(r=0;r<t.length;r++)for(u=r+1;u<t.length;u++)s=typeof t[r]=="object"?t[r]:this.nameTable[t[r]],h=typeof t[u]=="object"?t[u]:this.nameTable[t[u]],!(s.zOrder>h.zOrder)||s.isPhase||h.isPhase||s.isLane||h.isLane||(o=t[r],t[r]=t[u],t[u]=o)}return n},_renderDiagramObjects:function(n,t,i,r){var o=[],s=[],h,f,e,u;for(this._initLayer(),u=0,h=n.length;u<h;++u)this.getObjectType(n[u])==="node"||this.getObjectType(n[u])==="group"?(f=this.nameTable[n[u].name],f&&this._outOfBoundsOnNudge(f,0,0)?(this._isLoad&&(this._disableSegmentChange=!0),ej.datavisualization.Diagram.DiagramContext._renderNodeObject(f,t,i,r,this),this._isLoad&&delete this._disableSegmentChange,this._updateQuad(f)):o.push(u)):(e=this.nameTable[n[u].name]||n[u],e&&this._outOfBoundsOnNudge(e,0,0)?(ej.datavisualization.Diagram.DiagramContext._renderConnectorObject(e,t,this),this._updateQuad(e)):s.push(u));if(o.length>0||s.length>0){if(o.length>0){for(u=o.length-1;u>=0;u--)this._removeFromNameTable(this.nodes()[u]),this.nodes().splice(u,1);this._nodes=$.extend(!0,[],this.nodes())}if(s.length>0){for(u=s.length-1;u>=0;u--)this._removeFromNameTable(this.connectors()[u]),this.connectors().splice(u,1);this._connectors=$.extend(!0,[],this.connectors())}}},_removeFromNameTable:function(n){var t,i;if(n&&n._type==="group")for(t=0;t<n.children.length;t++)i=n.children[t],i._type==="group"?this._removeChildrenFromNameTable(i):delete this.nameTable[this._getChild(i)];delete this.nameTable[this._getChild(n)]},_unWireEvents:function(){var n=$(this._canvas);this._off(n,ej.eventType.mouseDown,this._mousedown);this._off(n,ej.eventType.mouseMove,this._mousemove);this._off(n,ej.eventType.mouseUp,this._mouseup);this._off(n,ej.eventType.mouseLeave,this._documentmouseup);this._off(n,"doubletap",this._doubleclick);this._off(this.element,"keydown",this._keydown);this._off(this.element,"keyup",this._keyup);this._off(n,"pinchin",this._pinchin);this._off(n,"pinchout",this._pinchout);this._off(this.element,"touchstart",this._handleTouchStart);ej.browserInfo().name==="mozilla"?this._off(this.element,"DOMMouseScroll",this._handleMouseWheel):this._off(this.element,"mousewheel",this._handleMouseWheel);this._off($(document),"mouseup",this._documentmouseup);window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._off($(window),"resize",this.updateViewPort)},_wireEvents:function(){var t=$(this._canvas),n;this._on(t,ej.eventType.mouseDown,this._mousedown);this._on(t,ej.eventType.mouseMove,this._mousemove);this._on(t,ej.eventType.mouseUp,this._mouseup);this._on(t,ej.eventType.mouseLeave,this._documentmouseup);this._on(t,"doubletap",this._doubleclick);this._on(this.element,"keydown",this._keydown);this._on(this.element,"keyup",this._keyup);this._on(this.element,"contextmenu",this._preventDefaultContextMenu);this._on(t,"pinchin",this._pinchin);this._on(t,"pinchout",this._pinchout);this._on(this.element,"touchstart",this._handleTouchStart);ej.browserInfo().name==="mozilla"?this._on(this.element,"DOMMouseScroll",this._handleMouseWheel):this._on(this.element,"mousewheel",this._handleMouseWheel);this._on($(document),"mouseup",this._documentmouseup);window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._on($(window),"resize",this.updateViewPort);n=this;$(t).ejDroppable({over:function(t){n._isDropOver=!0;var i=!1;t.originalEvent&&t.originalEvent.changedTouches?i=!0:t&&t.changedTouches&&(i=!0);i||n.activeTool.inAction===!1&&n._selectedSymbol&&(n._viewPort||(n._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(n,!0)),n._addSymbolToDiagram(t),n._isSvgDropover=!0)},out:function(){delete n._isDropOver},drop:function(t,i){n._svgdrop(t,i);n._isDropped=!0}})},_preventDefaultContextMenu:function(n){if(this._disableDefaultContextMenu)return n.preventDefault(),n.stopPropagation(),delete this._disableDefaultContextMenu,!1},_mousePosition:function(n,t){var u=this._isTouchEvent(n),o=this._scrollLeft!==undefined?this._scrollLeft:this._canvas.scrollLeft,s=this._scrollTop!==undefined?this._scrollTop:this._canvas.scrollTop,f=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),i=u.clientX+o-f.left,r=s+u.clientY-f.top,e=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);return t||(i=(i+this._hScrollOffset-e.left)/this._currZoom,r=(r+this._vScrollOffset-e.top)/this._currZoom),new ej.datavisualization.Diagram.Point(Math.round(i*100)/100,Math.round(r*100)/100)},_contextmenu:function(n){n.preventDefault();n.stopPropagation()},_pinchin:function(n){this._getTouchEvent(n);n.preventDefault()},_pinchout:function(n){this._getTouchEvent(n);n.preventDefault()},_handleTouchStart:function(n){this._getTouchEvent(n);var t=this._isForeignObject(n.originalEvent.target);t||n.preventDefault()},_getTouchEvent:function(n){this._isTouchedEvent=n.type=="touchmove"||n.type=="touchstart"||n.type=="touchend"?!0:!1},_getvalues:function(n){var f=$(n.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),t,u=n.target.id.split("_"),i,r;return t=this.findNode(u[0]),i=this._mousePosition(n),r=this._findPortAtPoint(i,t),{source:r,action:ej.datavisualization.Diagram.ActiveTool}},_mousedown:function(n){var r,u,t,f,i;this._isDiagramMouseDown=!0;this._getTouchEvent(n);this._isPinching=!1;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);this._diagramElements=null;ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer);this._invoke(n)&&(this._scrollLeft=this._canvas.scrollLeft,this._scrollTop=this._canvas.scrollTop,this._controlBBox=this._canvas.getBoundingClientRect(),r=this._mousePosition(n),u=this._isForeignObject(n.originalEvent.target),(u||this._isHyperLink(n))&&!this._isForeignEvent(n)||n.preventDefault(),this.model.contextMenu&&$("#"+this.element[0].id+"_contextMenu").css("display")!=="none"&&(n.cancel=!0),this._isEditing&&(this._endEdit(),this.activeTool.name==="textTool"&&this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()),(n.which===1||n.which===3||n.which===0&&n.originalEvent.changedTouches)&&(this._removeMouseOverTooltip(),n.which===0&&n.originalEvent.changedTouches&&(t=null,f=this._isUserHandle(n),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction&&(f||(t=this._findNodeUnderMouse(n),this._raiseMouseEvents(t,r)),!t&&this.selectionList[0]&&(t=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(n,t))),(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.shiftKey&&(t=this._findNodeUnderMouse(n),!t&&this.selectionList[0]&&(t=this.selectionList[0]),this._checkToolToActivate(n,t)),this._toolToActivate==="panTool"?this.activeTool=this.tools[this._toolToActivate]:(this._toolToActivate==="move"&&(t=this._findNodeUnderMouse(n),t&&t.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(t)&&(this._toolToActivate="select",this._currentCursor="default",this._updateCursor())),i=this.tools[this._toolToActivate]||this.activeTool,this.activateTool(this._toolToActivate,i?i.singleAction:null)),this.activeTool.mousedown&&this.activeTool.mousedown(n),this.activeTool._findNodeUnderMouse&&(this._focusedElement=this.activeTool._findNodeUnderMouse(n,!0))))},_getParentNode:function(n){var t,i=this.findNode(n);return i.parent&&(t=this.findNode(i.parent),t.parent&&this._getParentNode(t.name)),t.name},_getDiagramElements:function(n){return n&&(n.isSwimlane||n.isLane)&&(n=this.getNode(n)),n},_mousemove:function(n){var c,i,u,e,r,o,l,f,t,s,h;if(this._getTouchEvent(n),this._mouseEventTriggered=!0,this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0)),n.type=="touchmove"&&n.originalEvent.touches.length>1)this._isPinching=!0;else if(this._isPinching=!1,r=null,c=this._isUserHandle(n),this.activeTool.inAction===!1&&this._selectedSymbol)this._previousData=null,this._addSymbolToDiagram(n);else{if(this.activeTool.inAction&&this.activeTool.name==="move"&&this.selectionList[0]&&(i=this._findNodeUnderMouse(n),this.nameTable[this._previousData]&&(!i||this._previousData!=(i._isHeader?i.parent:i.name))&&(this.nameTable[this._previousData].parent&&(u=this._getParentNode(this.nameTable[this._previousData].name)),e={element:this._getDiagramElements(this.selectionList[0]),target:this._getDiagramElements(this.nameTable[this._previousData]),targetType:this.getObjectType(this.nameTable[this._previousData]),actualObject:this.findNode(u)?u:null},this._raiseEvent("dragLeave",e),this._previousData=null),i&&this._previousData&&this.nameTable[this._previousData]!==(i._isHeader?this.nameTable[i.parent]:i)&&(this._previousData=i._isHeader?i.parent:i.name,this.nameTable[this._previousData].parent&&(u=this._getParentNode(this.nameTable[this._previousData].name)),e={element:this._getDiagramElements(this.selectionList[0]),target:this._getDiagramElements(this.nameTable[this._previousData]),targetType:this.getObjectType(this.nameTable[this._previousData]),actualObject:this.findNode(u)?u:null},this._raiseEvent("dragEnter",e))),r=ej.datavisualization.Diagram.Util.isClassifier(n)?ej.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(n,this):this._findNodeUnderMouse(n),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction?(c||r&&(this._nodeUnderMouse&&this._nodeUnderMouse!=r&&!this._nodeUnderMouse.segments&&this.activeTool._showPort(this._nodeUnderMouse,!0),r.segments||this.activeTool._showPort(r)),!r&&this.selectionList[0]&&(r=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(n,r),n.which==1&&n.buttons==1&&(this._focusedElement=this.activeTool._findNodeUnderMouse(n,!0))):(o=!0,this._activatedFromPort&&!this.activeTool.inAction&&(f=null,this._nodeUnderMouse&&!this._nodeUnderMouse.segments&&(l=this._mousePosition(n),f=this._findPortAtPoint(l,this._nodeUnderMouse)),f&&(!f||f.constraints&ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag)||(ej.datavisualization.Diagram.SvgContext._removePortHighlighter(this._adornerSvg,this._adornerLayer),this.deactivateTool(),o=!1,delete this._activatedFromPort)),o&&(this.activeTool.inAction||(this._toolToActivate=this.activeTool.name,this._currentCursor=this.activeTool.cursor),t=ej.datavisualization.Diagram.Util.isClassifier(n)?ej.datavisualization.Diagram.ClassifierHelper.getDropableElementUnderMouse(n,this):this._findNodeUnderMouse(n),r)),this._updateCursor(),t=t||this._findNodeUnderMouse(n),this.activeTool.mousemove&&this.activeTool.mousemove(n),this._raiseMouseEvents(t,n),s=!1,this.activeTool.inAction){do if(t&&!ej.datavisualization.Diagram.Util.canAllowDrop(t))if(t.parent)t=this.nameTable[t.parent];else if(t.segments){s=!0;break}else if(t.container)break;else t=null;else break;while(t);this._nodeUnderMouse&&this._nodeUnderMouse.segments&&this._nodeUnderMouse!=t&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg);t&&t!=this._focusedElement&&t!=this.nodeUnderMouse&&(s||ej.datavisualization.Diagram.Util.canAllowDrop(t))?(h=this.getObjectType(t),this._focusedElement&&(this._focusedElement.isLane||this._focusedElement.isSwimlane||this._focusedElement.isPhase)&&h=="node"&&h=="connector"?this._nodeUnderMouse=null:this._nodeUnderMouse&&(this._nodeUnderMouse.isLane||this._nodeUnderMouse.isSwimlane||this._nodeUnderMouse.isPhase)&&t.segments||(this._nodeUnderMouse=t)):t&&t.container||(this._nodeUnderMouse=null)}else this._focusedElement||(this._nodeUnderMouse=t);this._initiateAutoScroll(n)}},_mouseup:function(n){var e,r,f,o,l,t,s,i,u,h,c;this._getTouchEvent(n);!this._isPinching&&n.originalEvent&&n.originalEvent.target&&this._invoke(n)&&(e=this._isForeignObject(n.originalEvent.target),!e&&this._isHyperLink(n)&&n.preventDefault(),this.activeTool instanceof ej.datavisualization.Diagram.PanTool?(document.onmousemove=null,document.onmouseup=null,(!ej.datavisualization.Diagram.Util.isPageEditable(this)||this.activeTool instanceof ej.datavisualization.Diagram.PanTool)&&!this.activeTool.inAction&&(t=this.activeTool._findNodeUnderMouse(n),t&&this._raiseEvent("itemClick",{actualObject:t,selectedObject:t,model:this.model,cancel:!1,event:n}),r=this._mousePosition(n.originalEvent),this._raiseEvent("click",{element:t,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(n),offsetX:r.x,offsetY:r.y,event:n}),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(document.onmousemove=null,document.onmouseup=null))):n.target.id!==this._id+"_canvas_svg"||!this.activeTool.name!="panTool"&&this.activeTool.inAction||(r=this._mousePosition(n.originalEvent),this._raiseEvent("click",{element:this,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(n),offsetX:r.x,offsetY:r.y,event:n})),n.target&&!this._isAnimating&&(f=$(n.target).parents(".ej-d-icon-template"),f&&f.length&&(o=f[0],o.id.endsWith("_expander")&&(l=o.id.replace("_expander",""),t=this.nameTable[l],t&&(s=this.getObjectType(t),(s=="node"||s=="group")&&(this.clearSelection(),ej.datavisualization.Diagram.LayoutUtil.expandSubTree(this,t,t.name,!0,ej.datavisualization.Diagram.Util.canSelect(t))))))),!this._selectedSymbol||this._selectedSymbol.isLane||this._isNodeEnters?this._selectedSymbol&&this._isNodeEnters&&(i=this.findNode(this.selectionList[0].name),this.edgeTable?delete this.edgeTable:(u={},u=this._getChildTable(this.selectionList[0],u),this._selectedSymbol.type=="pseudoGroup"?h={type:"collectionchanged",object:this._updatePsedoGroupChildren(this._selectedSymbol),childTable:jQuery.extend(!0,{},u),changeType:"insert",category:"internal"}:this._selectedSymbol.isPhase||(h={type:"collectionchanged",object:jQuery.extend(!0,{},this._selectedSymbol),childTable:jQuery.extend(!0,{},u),changeType:"insert",category:"internal"}),this.addHistoryEntry(h),this._isDragg=!0),this._clearSelection(!0),this._selectedSymbol=null,delete this._isNodeEnters,i.type=="pseudoGroup"&&(this.nodes().push(i),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[i.name]=i,ej.datavisualization.Diagram.Util._updateGroupBounds(i,this)),this._addSelection(i)):(this._findLabelEditing=!0,this._dropSymbol(null,n),delete this._findLabelEditing,this._isDragg=!0),ej.browserInfo().name==="msie"&&this._doubleClickEvent&&(this.activeTool._isMouseDown=!0),this.activeTool.mouseup?(this.activeTool.inAction||(this._isSelectMode=!0),this.activeTool.mouseup(n),delete this._isSelectMode):this._isInternalTool(this.activeTool)||(this._isUserHandle(n)&&(c=this.activeTool.cursor),this.deactivateTool()),this.activeTool instanceof ej.datavisualization.Diagram.TextTool||!document.activeElement||document.activeElement.id===this.element[0].id||this._isEditing||e||n.which===3&&this.enableContextMenu()||this._isDiagramMouseDown&&this.element[0].focus(),this._currentCursor=c?c:this.activeTool.cursor,this.activeTool.name==="move"&&this._focusedElement&&!ej.datavisualization.Diagram.Util.canSelect(this._focusedElement)&&ej.datavisualization.Diagram.Util.enableLayerOption(this._focusedElement,"lock",this)?(this._currentCursor="default",this._updateCursor()):this._updateCursor());this._isSvgDropover&&($("#"+this.element[0].id+"_canvas").ejDroppable("instance")._mouseOver=!1);delete this._isSvgDropover;this._focusedElement=null;this._nodeUnderMouse=this._findNodeUnderMouse(n);delete this._scrollLeft;delete this._scrollTop;delete this._controlBBox;this._mouseEventTriggered=!1;this._isDragg=!1;delete this._viewPort;delete this._isDropOver;this._timeStamp=n.timeStamp;delete this._isDiagramMouseDown},_doubleclick:function(n){var u,e,f,t,i,r;if(this._getTouchEvent(n),this._doubleClickEvent=!this._doubleClickEvent,t=this._nodeUnderMouse||this,u={element:this.getNode(t),cancel:!1,actualObject:this.getNode(this.activeTool.actualObject)},this._isEditing||this._raiseEvent("doubleClick",u),e=this.activeTool._drawingPolygon,this.activeTool.name!="panTool"&&(this._nodeUnderMouse&&this.activeTool._doubleClick(this._nodeUnderMouse),ej.datavisualization.Diagram.Util.isClassifier(n)&&(f=ej.datavisualization.Diagram.ClassifierHelper.getEditableElementUnderMouse(n,this)),ej.datavisualization.Diagram.Util.isPageEditable(this)&&!this.activeTool.inAction&&(this.selectionList.length>0||f||this.activeTool.selectedObject)&&!u.cancel&&!e)){if(t=this.activeTool.selectedObject?this.activeTool.selectedObject:this.selectionList[0]?this.selectionList[0]:f,t.type=="umlclassifier")for(i=0;i<t.children.length;i++)t.children[i]=typeof t.children[i]=="string"?this.nameTable[t.children[i]]:t.children[i],i!=t.children.length-t.children.length&&i==t.children.length-1&&(t.children[i].labels[0].text="\n---\n"+t.children[i].labels[0].text),i!=t.children.length-t.children.length&&i==t.children.length-2&&(t.children[i].labels[0].text="\n---\n"+t.children[i].labels[0].text),t.labels[0].text+=t.children[i].labels[0].text;this._isEditing||t.type=="pseudoGroup"||u.cancel||(this.activeTool._findLabelUnderMouse(n,!1,this._mousePosition(n.originalEvent),!0),t.labels&&t.labels.length>0&&(r=this.activeTool.getLabelUnderMouse(),r||(r=t.labels[0])),!this._isEditing&&t.type==="text"&&this._setLabelEditing(t.textBlock)?(this.scrollToNode(t),this._startEdit(t)):this._isEditing||this.selectionList.length!==1||this.selectionList[0]._type!=="label"||t.name!==this.selectionList[0].name?this._isEditing||t.isLaneStack||t.isLane||t.isSwimlane||!(t.labels&&(t.labels.length===0||typeof t.labels.length=="undefined")||t.labels&&t.labels.length>0&&this._setLabelEditing(r))?t.isLane&&t.labels&&t.labels.length>0&&this._setLabelEditing(r)?t.labels&&t.labels.length>0?(this.scrollToNode(t),this._startEdit(t)):this.activeTool.selectedObject=null:t.isLane&&(this.activeTool.selectedObject=null):(this.scrollToNode(t),this._startEdit(t)):(this.scrollToNode(this.nameTable[t._parent]),this._startEdit(this.nameTable[t._parent])))}this.activeTool._isMouseDown=!1},_documentmouseup:function(n){var i,t;this._getTouchEvent(n);i=this._selectedSymbol;this._removeMouseOverTooltip();this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0));!this.activeTool||!this.activeTool.inAction||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||this.activeTool instanceof ej.datavisualization.Diagram.ShapeTool&&this.activeTool._drawingPolygon||(this._selectedSymbol&&n.type!="mouseleave"&&(this._findLabelEditing=!0,this._dropSymbol(null,n),delete this._findLabelEditing,this._isDragg=!0),this.activeTool.mouseup(n,!0));this.activeTool._removeRulerMarkers();i&&(n.keyCode!=27&&n.keyCode!=46&&(t=document.getElementsByClassName("e-paletteItem dragClone")[0],t!=null&&(t.style.display="block"),this._selectedSymbol=i),this._raiseEvent("dragLeave",{element:this.selectionList[0],target:this,targetType:"diagram"}),this._mouseEventTriggered&&this._delete(this.selectionList[0]));this._isNodeEnters&&(delete this._isNodeEnters,this._selectedSymbol=null,t=document.getElementsByClassName("dragClone")[0],t!=null&&(t.style.display="block"));delete this._viewPort;delete this._isDropOver;this._mouseEventTriggered=!1;this._isDragg=!1},_invoke:function(n){if(n.originalEvent.target){var t=n.originalEvent.target.className;if(t&&typeof t=="string"&&(t=="edit"||t=="editBox"||t.indexOf("e-hhandle")>-1||t.indexOf("e-hhandlespace")>-1||t.indexOf("e-vhandle")>-1||t.indexOf("e-vhandlespace")>-1))return!1}return!0},_handleMouseWheel:function(n){var r,t,u,i,h,f,e,o,c,l,s;this._isForeignEvent(n,!0)||(n.originalEvent.preventDefault&&n.originalEvent.preventDefault(),r=new ej.datavisualization.Diagram.Point(0,0),this._isEditing&&this._endEdit(),(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)?(r=this._mousePosition(n.originalEvent),n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+Number(this.zoomFactor()),0,0,r,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+Number(this.zoomFactor())),0,0,r,!0)):(t=0,u={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?(h=this._vScrollbar.model.minimum,f=this._scrollLimit()==="limited"&&this._vScrollOffset-this._scrollPixel>=this.model.pageSettings.scrollableArea.y*this._currZoom,this._vScrollOffset-this._scrollPixel>=h||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||f?(e=!1,this._scrollLimit()!=="diagram"?e=!0:this._vScrollbar&&this._vScrollbar._scrollData&&(o=this._vScrollbar.element[0],o&&(o.style.visibility==="visible"||o.style.visibility==="")&&(e=!0)),e&&(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset-this._scrollPixel),i=!0,t=-this._scrollPixel)):(this._updateScrollOffset(this._hScrollOffset,h),i=!0,t=0)):(c=this._vScrollbar.model.maximum,l=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),f=this._scrollLimit()==="limited"&&(this.model.pageSettings.scrollableArea.y+this.model.pageSettings.scrollableArea.height)*this._currZoom>=this._vScrollOffset+this._scrollPixel+l.height,c>=this._vScrollOffset+this._scrollPixel||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||f?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset+this._scrollPixel),i=!0,t=this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,c),i=!0,t=0)),i&&(s={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},(u.horizontalOffset!=s.horizontalOffset||u.verticalOffset!=s.verticalOffset)&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Pan,this._raiseEvent("scrollChange",{newValues:s,oldValues:u}))),this._updateEditBox(0,t)))},_setActiveTool:function(n){var u=this._mousePosition(n),t,i,r;this.activeTool.inAction||!this._isUserHandleActive(this.activeTool.name)&&this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length||(this._isInternalTool(this.activeTool)||this.activeTool.singleAction)&&(i=!1,this.selectionList[0]&&(t=this.selectionList[0],i=this._checkToolToActivate(n,t)),i||(t=this._findNodeUnderMouse(n),this._isUserHandle(n)?(r=$(n.target).parents("g").first().context.id.split("_")[0],this._checkToolToActivate(n,t),this.activeTool=this.tools[this._toolToActivate]):(this._checkToolToActivate(n,t),this._raiseMouseEvents(t),this._isUserHandleActive(this.activateTool.name)&&!this._drawingTool&&(this.activeTool=this.tools[this._toolToActivate]))))},_beginAutoScroll:function(n,t,i){var s=i?i:100,f=this,e=0,o=0,r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),h=this._hScrollbar.model.maximum+r.width,c=this._vScrollbar.model.maximum+r.height,u=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);if(this._canAutoScroll){switch(n){case"right":(this._hScrollOffset+r.width+10-u.left<h||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(e=10);break;case"left":(this._hScrollOffset-10>this._hScrollbar.model.minimum-u.left||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(e=-10);break;case"bottom":(this._vScrollOffset+r.height+10-u.top<c||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(o=10);break;case"top":(this._vScrollOffset-10>this._vScrollbar.model.minimum-u.top||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(o=-10)}f._clearTimeOutValue=window.setTimeout(function(i){var r=this,i={delay:s};f._raiseEvent("autoScrollChange",i);f._updateScrollBar(e,o,n,t,i.delay)},s)}},_updateScrollBar:function(n,t,i,r,u){if(this._clearTimeOutValue&&window.clearTimeout(this._clearTimeOutValue),n===0&&t===0)this._canAutoScroll=!1;else if(this.activeTool.inAction){var f=this._hScrollOffset+n*this._currZoom,e=this._vScrollOffset+t*this._currZoom,o=this._updateSelectionOnScroll(n,t);o?(this._updateScrollOffset(f,e),this._beginAutoScroll(i,r,u)):this._canAutoScroll=!1}},_updateSelectionOnScroll:function(n,t){var i=this.activeTool,r,f,e,u;if(i.name==="select")i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._updateHelper();else if(i.name==="orthogonalLine"||i.name==="straightLine")i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._targetPossibleConnection=i._currentPossibleConnection,i._targetPort=i._possibleConnectionPort,i._updateHelper();else if(this.selectionList.length>0){if(r=this.selectionList[0],r.isLane||(i.currentPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t)),i.name==="move")if(!r.isLane&&i._outOfBoundsDrag(r,n,t))i._canMoveLabel?this._translateLabel(r,i.activeLabel,n,t):this._translate(r,n,t,this.nameTable);else return!1;else i.name==="resize"?(ej.datavisualization.Diagram.SnapUtil._removeGuidelines(this),i._updateSize(r,i.previousPoint,i.currentPoint)):i.name==="endPoint"&&(i.selectedSegment&&i._endPoint=="segmentEnd"?(f=i.currentPoint.x-i.previousPoint.x,e=i.currentPoint.y-i.previousPoint.y,i._updateAdjacentSegments(f,e)):(u=i._updatePoints(r),u.cancel||(i._disconnect(r),i._updateConnection(r,u.updateSelection))));i.previousPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x,i.currentPoint.y);i._canMoveLabel||r.type=="phase"||(ej.datavisualization.Diagram.DiagramContext.update(r,this),this._updateSelectionHandle(!0),this._renderTooltip(r))}return!0},_isUserHandle:function(n){return n.target.parentNode.className.animVal==="userHandle"?!0:!1},_isUserHandleActive:function(n){var i=!1,t,r;if(this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0)for(t=0,r=this.model.selectedItems.userHandles.length,t;t<r;t++)if(this.model.selectedItems.userHandles[t].name===n){i=!0;break}else i=!0;return i},_getEventDetail:function(n){return ej.browserInfo().name==="msie"?this._timeStamp?n.timeStamp-this._timeStamp>=300?1:2:1:n.originalEvent.detail},_raiseMouseEvents:function(n,t){var i,r;this._isEditing||(this.nameTable[this._lastNodeUnderMouse]&&(!n||this._lastNodeUnderMouse!=(n._isHeader?n.parent:n.name))&&(i=document.getElementById(this.element[0].id+"_mouseovertooltipDiv"),i&&i.parentNode.removeChild(i),this.activeTool.inAction||(this._raiseEvent("mouseLeave",{element:this.getNode(this.nameTable[this._lastNodeUnderMouse])}),this._lastNodeUnderMouse=null),this._nodeUnderMouse==null||this._nodeUnderMouse.segments||this.activeTool instanceof ej.datavisualization.Diagram.LineTool||this.activeTool._showPort&&this.activeTool._showPort(this._nodeUnderMouse,!0)),n&&!this.activeTool.inAction&&(this._lastNodeUnderMouse&&this._lastNodeUnderMouse==(n._isHeader?n.parent:n.name)||(this._lastNodeUnderMouse=n._isHeader?n.parent:n.name,this._raiseEvent("mouseEnter",{element:this.getNode(this._lastNodeUnderMouse)}))),n&&(r={element:this.getNode(n)},this._raiseEvent("mouseOver",r),r.element&&!this.activeTool.inAction?this._renderMouseOverTooltip(n,t):this._removeMouseOverTooltip()))},_renderMouseOverTooltip:function(n,t){var v,i,w,h,c,l,y,p,a,nt,f,b,k,tt;if(ej.datavisualization.Diagram.Util.canShowTooltip(n,this)&&(v=this.getObjectType(n),w=v=="node"||v=="group"?ej.datavisualization.Diagram.NodeConstraints:ej.datavisualization.Diagram.ConnectorConstraints,n.constraints&w.InheritTooltip?(i=this.model.tooltip,h=!0):i=n.tooltip,i&&(!h||this._tooltipTemplateId()))){a=this._getTooltipPosition(n,i,t,h);c=a.x;l=a.y;y=a.tx;p=a.ty;c=-this._hScrollOffset+c*this._currZoom;l=-this._vScrollOffset+l*this._currZoom;nt="left:"+c+"px; top:"+l+"px; display: block; position: absolute; pointer-events: none; transform:translate("+y+","+p+")";f=document.getElementById(this.element[0].id+"_mouseovertooltipDiv");f||(f=this._createMouseOverTooltip());f.style.left=c+"px";f.style.top=l+"px";f.style.transform="translate("+y+" ,"+p+")";f.style.display="block";f.style.position="absolute";$.templates&&(b=h?this._tooltipTemplateId():i.templateId,k=$.templates("#"+b).render(n));$(f).html(k);tt=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);f.style.marginLeft=f.style.marginTop="0px";var u=this.element[0].getBoundingClientRect(),r=f.getBoundingClientRect(),d=this.model.scrollSettings.currentZoom,g=ej.datavisualization.Diagram.Util.bounds(n,this.activeTool.name=="rotatetool"?!0:!1);if(u.left>r.left||u.right<r.right){if((h?this._tooltipMode():i.relativeMode)=="mouse"||i.alignment.horizontal=="center")var s=u.left>r.left?"left":"right",o=s=="right"?r.right-u.right:u.left-r.left,e=s=="right"?-o-i.margin.right:i.margin.left+o;else(i.alignment.horizontal=="left"||i.alignment.horizontal=="right")&&i.alignment.vertical=="center"?(e=g.width*d+r.width+i.margin.left+i.margin.right,e=i.alignment.horizontal=="left"?e*1:e*-1):(s=i.alignment.horizontal,s=="center"&&(s=u.left>r.left?"left":"right"),o=s=="right"?r.right-u.right:u.left-r.left,e=s=="right"?-o-i.margin.right:i.margin.left+o);f.style.marginLeft=e+"px"}(u.bottom<r.bottom||u.top>r.top)&&((h?this._tooltipMode():i.relativeMode)=="mouse"||i.alignment.vertical=="center"?(s=u.top>r.top?"top":"bottom",o=s=="top"?r.top-u.top:r.bottom-u.bottom,e=s=="top"?i.margin.top-o:-(o+i.margin.bottom)):i.alignment.horizontal=="center"&&(i.alignment.vertical=="bottom"||i.alignment.vertical=="top")?(e=g.height*d+r.height+(i.margin.bottom+i.margin.top),e=i.alignment.vertical=="bottom"?e*-1:e*1):(o=i.alignment.vertical=="top"?u.top-r.top:u.bottom-r.bottom,e=i.alignment.vertical=="top"?i.margin.top+o:o-i.margin.bottom),f.style.marginTop=e+"px")}},_getTooltipPosition:function(n,t,i,r){var e=ej.datavisualization.Diagram.Util.bounds(n,!1),u,f,o,s,h;if((r?this._tooltipMode():t.relativeMode)=="object"){switch(r?this._horizontalTooltipAlignment():t.alignment.horizontal){case"left":u=e.x;u-=t.margin.left;o="-100%";break;case"right":u=e.right;u+=t.margin.right;o="0%";break;case"center":u=e.center.x;o="-50%"}switch(r?this._verticalTooltipAlignment():t.alignment.vertical){case"top":f=e.y;f-=t.margin.top;s="-100%";break;case"bottom":f=e.bottom;f+=t.margin.bottom;s="0%";break;case"center":f=e.center.y;s="-50%"}}else i&&(h=this._mousePosition(i),u=h.x+t.margin.left,f=h.y+t.margin.top);return{x:u,y:f,tx:o,ty:s}},_isHandle:function(n){var t=$(n.target).parent("g.handle");return t.length>0?!0:!1},_findNodeUnderMouse:function(n){var t=null,r,u;if(n.target){var i=$(n.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],f=n.target.className,u=n.target.id.split("_");if(u[u.length-1]=="lblbg")return;i&&(r=typeof i.className=="object"?i.className.baseVal:i.className,r&&(r==="ej-d-node"||r==="ej-d-group"||ej.datavisualization.Diagram.Util.isClassifier(n))?(t=this._findNode(i.id),t||(t=this._findNode(i.id.split("_label")[0])),t||(t=this._findNode(i.id.split("_parentdiv")[0])),t&&t._isInternalShape&&t.parent&&this.nameTable[t.parent]&&this.nameTable[t.parent].type=="bpmn"&&(t=this.nameTable[t.parent])):r==="ej-d-connector"&&(t=this._findConnector(i.id),t||(t=this._findConnector(i.id.split("_label")[0]))));!t&&n.target&&n.target.parentNode&&(u=n.target.parentNode.id.split("_ej_ports"),t=this.findNode(u[0]))}return t},_findConnectableNodeUnderMouse:function(n){var t=null,r,e,o,f,v,i,s,h,p;if(n&&n.type==="touchmove"){var c=this._mousePosition(n),l=ej.datavisualization.Diagram.Rectangle(c.x,c.y,0,0),a=ej.datavisualization.Diagram.SpatialUtil.findQuads(this._spatialSearch,l);for(r=0;r<a.length;r++)if(e=a[r],e.objects.length>0)for(o=0;o<e.objects.length;o++)if(f=e.objects[o],v=ej.datavisualization.Diagram.Util.bounds(f),ej.datavisualization.Diagram.Geometry.intersectsRect(l,v)&&!f.segments&&f.visible)return f}else{for(var w,y=$(n.target).parents(".ej-d-node,.ej-d-group"),u=y[0],r=1;u;)w=u.getAttribute("class"),t=this._findNode(u.getAttribute("id")),t||(t=this._findNode(u.getAttribute("id").split("_parentdiv")[0])),t&&(ej.datavisualization.Diagram.Util.canConnect(t)||!t.parent)?u=null:(u=y[r],r++);t&&(t.type=="umlclassifier"&&(i=this.activeTool.selectedObject),i&&i.sourceNode&&(s=this.nameTable[i.sourceNode]),i&&i.targetNode&&(h=this.nameTable[i.targetNode]),s&&(t=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(t,s,i,this)),h&&(t=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(t,h,i,this)));!t&&n.target&&n.target.parentNode&&(p=n.target.parentNode.id.split("_ej_ports"),t=this.findNode(p[0]))}return t},_isForeignEvent:function(n,t){if(n.originalEvent&&n.originalEvent.target)if(t){if(n.originalEvent.target.localName==="input"&&(n.originalEvent.target.type==="text"||n.originalEvent.target.type==="password")||n.originalEvent.target.localName==="textarea"&&!(this._isEditing&&n.originalEvent.target.id===this.element[0].id+"_editBox"))return!0}else if(n.originalEvent.target.localName==="img")return!0},_isForeignObject:function(n){var t=n;if(t)while(t.parentNode!=null){if(t.tagName==="foreignObject"||typeof t.className=="string"&&t.className.split(" ").indexOf("foreignObject")!==-1)return t;t=t.parentNode}return null},_altKeyPressed:function(n){return n&ej.datavisualization.Diagram.KeyModifiers.Alt},_ctrlKeyPressed:function(n){return n&ej.datavisualization.Diagram.KeyModifiers.Control},_shiftKeyPressed:function(n){return n&ej.datavisualization.Diagram.KeyModifiers.Shift},_keydown:function(n){var i,t,r,u;this._isKeyDown=!0;this._removeMouseOverTooltip();var o=n.keyCode?n.keyCode:n.which,f=navigator.platform.match("Mac")?n.metaKey:n.ctrlKey,e=n.key;if(!this._isForeignEvent(n,!0)){for(i in this.model.commandManager.commands)t=this.model.commandManager.commands[i],t&&t.gesture&&(t.gesture.keyModifiers||t.gesture.key)&&(!t.gesture.key||o==t.gesture.key||e==t.gesture.key||navigator.platform.match("Mac")&&e==="Backspace"&&i==="delete")&&(!t.gesture.keyModifiers||(f||n.altKey||n.shiftKey)&&(!this._altKeyPressed(t.gesture.keyModifiers)||n.altKey)&&(!this._shiftKeyPressed(t.gesture.keyModifiers)||n.shiftKey)&&(!this._ctrlKeyPressed(t.gesture.keyModifiers)||f))&&(this._currentCommand=i,this._currentCommand!=="focusToNextItem"&&this._currentCommand!=="focusToPreviousItem"&&this._currentCommand!=="selectFocusedItem"&&(this._diagramElements=null,this._focusedElement=null,ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer)),t.execute&&t.canExecute&&(r=t.canExecute,typeof t.canExecute=="string"&&(r=ej.util.getObject(t.canExecute,window)),$.isFunction(r)&&r({model:this.model})&&(u=t.execute,typeof t.execute=="string"&&(u=ej.util.getObject(t.execute,window)),$.isFunction(u)&&u({keyDownEventArgs:n,parameter:t.parameter,model:this.model}))));this.activeTool.keydown&&this.activeTool.keydown(n)}this._isKeyDown=!1},_keyup:function(n){var t=n.keyCode?n.keyCode:n.which;this._isEditing||t!==37&&t!==38&&t!==39&&t!==40||(this._currentState,delete this._currentState,n.preventDefault(),this.activeTool.inAction=!1,this._updateSelectionHandle())},_registerHistoryEvents:function(){this.historyManager.addEventHandler("collectionchanged",$.proxy(this._recordCollectionChanged,this));this.historyManager.addEventHandler("positionchanged",$.proxy(this._recordPinPointChanged,this));this.historyManager.addEventHandler("sizechanged",$.proxy(this._recordResizeChanged,this));this.historyManager.addEventHandler("rotationchanged",$.proxy(this._recordRotationChanged,this));this.historyManager.addEventHandler("endpointchanged",$.proxy(this._recordEndPointChanged,this));this.historyManager.addEventHandler("labelchanged",$.proxy(this._recordLabelChanged,this));this.historyManager.addEventHandler("groupingchanged",$.proxy(this._recordGroupChanged,this))},_svgdrop:function(n,t){var f,o,w,s,e,r,b,h,c;if(this._selectedSymbol&&ej.datavisualization.Diagram.Util.isPageEditable(this)){f={};o=n.originalEvent;o.preventDefault?o.preventDefault():o.returnValue=!1;var l=this._currZoom,a=$("#"+this.element[0].id).offset(),u=this._isTouchEvent(n);u.pageX||n.pageX||(n.originalEvent&&n.originalEvent.changedTouches?u=n.originalEvent.changedTouches[0]:n&&n.changedTouches&&(u=n.changedTouches[0]));var v=(u?u.pageX:n.pageX)+this._hScrollOffset-a.left,y=(u?u.pageY:n.pageY)+this._vScrollOffset-a.top,i=$.extend(!0,{},this._selectedSymbol),p=t.helper[0].getAttribute("paletteId"),k=$("#"+p).ejSymbolPalette("instance");if(p){if(this._selectedSymbol=null,i.name+=ej.datavisualization.Diagram.Util.randomId(),!i.isPhase&&i.segments)i.segments&&ej.datavisualization.Diagram.Util._translateLine(i,v,y),i=this.getNode(i);else if(!i.isPhase){if(w=$.extend(!0,{},k.nameTable),i.offsetX=v/l,i.offsetY=y/l,i._type==="group"){for(s=this._getChildren(i.children),e=0;e<s.length;e++)r=$.extend(!0,{},w[s[e]]),r.parent=i.name,r.name=i.name+r.name,s[e]=r.name,this.nameTable[r.name]=r,this.nodes().push(r),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(this.nameTable[r.name]);i.height=i.width=0;this._updateChildBounds(i,this.nameTable)}i._type==="group"?i=this._getNewGroup(i):i.segments?i=this._getNewConnector(i):i.isPhase||i.type==="phase"||(i=this._getNewNode(i))}i&&i.isLane&&(this._cloneGroupNode(i,ej.datavisualization.Diagram.Util.randomId()),i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,this.nameTable),i=this._initLaneContaier(i));f={element:i,cancel:!1};this._raiseDropEvent(f);i&&i.isLane&&(b=i.children[0],h=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(i,this,null,null,b),h&&h.isSwimlane&&(i=h));i.isPhase||(f.cancel||this.add(i),i=this.selectionList[0],this.scrollToNode(i),i.labels.length>0&&i.labels[0].mode==="edit"?(this._isEditing=!0,this.startLabelEdit(i,i.labels[0])):this.element[0].focus())}}else c=null,c=this._findNodeUnderMouse(n),f={element:t.helper,e:n,draggable:t.draggable,targetNode:c},this._raiseDropEvent(f)},_isTouchEvent:function(n){return n.type=="touchmove"||n.type=="touchstart"||n.type=="touchend"?n.originalEvent?n.originalEvent.changedTouches[0]:n.changedTouches[0]:n},_raiseDropEvent:function(n){n.source=this._symbolPalette?this._symbolPalette:null;n.objectType=n.source?ej.datavisualization.Diagram.ObjectTypes.Palette:ej.datavisualization.Diagram.ObjectTypes.Diagram;this._raiseEvent("drop",n);this._symbolPalette=null},_recordCollectionChanged:function(n,t){var s,o,y,r,e,c,h,f,u,l,a,i,v,p;if(this._isUndo=!0,this._isInsert=!0,s=n.changeType,n.isUndo&&(s=n.changeType=="insert"?"remove":"insert"),this._clearSelection(s=="insert"?!1:!0),s=="insert")if(n.object.container||n.object._isMultipleLaneDelete){l=[];for(i in n.childTable)u=n.childTable[i],this.nameTable[i]=u;if(r=n.object,r.isSwimlane)this.nameTable[r.name]=r,r.width=0,r.height=0,this._swimlanePaste=!0,this._multipleAction=!0,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._pasteSwimlaneObj(r),delete this._swimlanePaste,this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(r),delete this._multipleAction,this._clearSelection(!0);else if(r._type=="pseudoGroup"||r.isLane)if(r._type=="pseudoGroup"){for(i=0;i<r.children.length;i++)u=r.children[i],l[i]=n.childTable[u.name],u.isLane&&this.nameTable[u.name]&&delete this.nameTable[u.name];for(a=this._sortByLaneIndex(l),i=0;i<a.length;i++)u=a[i],u.isLane?this._recordCollectionChangedAddLane(u,u._laneIndex):(this.add(u,n),this._clearSelection(!0))}else this._recordCollectionChangedAddLane(n.object,n.index);else this.add(r),this._addConnector(r,n)}else if(n.object.type!="pseudoGroup"){if(!n.object.segments){if(o=null,n.object.inEdges&&n.object.inEdges.length>0)for(i=0;i<n.object.inEdges.length;i++)this.nameTable[n.object.inEdges[i]]&&(this.nameTable[n.object.inEdges[i]].targetNode=n.object.name),n.targetPorts&&(o=n.targetPorts[n.object.inEdges[i]]),o&&this.nameTable[n.object.inEdges[i]]&&(this.nameTable[n.object.inEdges[i]].targetPort=o);if(n.object.outEdges&&n.object.outEdges.length>0)for(i=0;i<n.object.outEdges.length;i++)this.nameTable[n.object.outEdges[i]]&&(this.nameTable[n.object.outEdges[i]].sourceNode=n.object.name),n.sourcePorts&&(o=n.sourcePorts[n.object.outEdges[i]]),o&&this.nameTable[n.object.outEdges[i]]&&(this.nameTable[n.object.outEdges[i]].sourcePort=o)}n.object._type==="group"&&this._addChildren(n.object,n.childTable);n.object.isSwimlane&&(n.object=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(n.object,this));this.add(n.object,n);n.object.parent&&(y=this.nameTable[n.object.parent]);n.object._type==="group"?(this._addConnector(n.object,n),this._addGroupConnector(n.object,n)):this._addConnector(n.object,n)}else{for(delete this.nameTable.multipleSelection,h=[],f=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"}),i=0;i<n.object.children.length;i++)u=typeof n.object.children[i]=="object"?n.object.children[i]:n.childTable[n.object.children[i]],u&&(c=this.getObjectType(u),c!=="group"||u.isSwimlane||this._addChildren(u,n.childTable),u.isSwimlane?(this._swimlanePaste=!0,this._isUndo=!0,u=this._pasteSwimlaneObj(u,n),delete this._swimlanePaste):c!="connector"?this.add(u,n):h.push(u),u&&f.children.push(u.name));for(i=0;i<h.length;i++)this.add(h[i],n);for(this._addGroupConnector(n.object,n),i=0;i<f.children.length;i++)if(r=this.nameTable[this._getChild(f.children[i])],r&&!r.segments){if(r.inEdges.length>0)for(e=0;e<r.inEdges.length;e++)this._isUndo?n.childTable[r.inEdges[e]].targetNode=r.name:this.nameTable[r.inEdges[e]].targetNode=r.name;if(r.outEdges.length>0)for(e=0;e<r.outEdges.length;e++)this._isUndo?n.childTable[r.outEdges[e]].sourceNode=r.name:this.nameTable[r.outEdges[e]].sourceNode=r.name}this._clearSelection();this.nodes().push(f);this._nodes=$.extend(!0,[],this.nodes());f.offsetX=n.object.offsetX;f.offsetY=n.object.offsetY;f.height=n.object.height;f.width=n.object.width;f.rotateAngle=n.object.rotateAngle;this.nameTable[f.name]=f;this.addSelection(f,!0)}else if(s=="remove")if(n.object.type=="pseudoGroup"||n.object.isLane)if(n.object.isLane)v=n.object,n.index||n.index==0||(p=null,n.object.isLane&&t&&(t.index=this._getRemoveIndex(n.object,!0))),this._remove(v);else for(i=0;i<n.object.children.length;i++)this._remove(this.nameTable[this._getChild(n.object.children[i])]);else return this._removeAdjacentConnections(n.object,n),n.object.isSwimlane||n.object.annotation?this._remove(this.nameTable[n.object.name]):this._remove(n.object),!0;this._groupUndo||(this._isUndo=!1);this._isInsert=!1;this.tools.move._isLane=!1},_recordCollectionChangedAddLane:function(n,t){var r,i;n&&n.isLane&&n.parent&&(n&&n.parent&&(i=this.nameTable[n.parent]),i&&i&&(r=this.nameTable[i.parent]),r&&(this.activeTool.selectedObject=n,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,ej.datavisualization.Diagram.canvasHelper._addNewLane(this,n,r,!0,t),this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(n),this._clearSelection(!0)))},_addAssiciatedChildConnectors:function(n){var i=this._getChildren(n.children),r,u,t;if(i&&i.length>0)for(r=0,u=i.length;r<u;r++)t=this.nameTable[i[r]],t&&(this._addConnector(t),t.type==="group"&&this._addAssiciatedChildConnectors(t))},_updateRecordPinPoint:function(n,t,i){var r,o,u,s,h,c,l,e,v,a,f;if(n.type=="pseudoGroup"){for(h=n,c=this._getChildren(n.children),o=0;o<c.length;o++)u=this.nameTable[c[o]],s=t[c[o]],s&&(u.segments?(l=t[u.name],u.sourcePoint=l.sourcePoint,u.targetPoint=l.targetPoint,u.segments=jQuery.extend(!0,u.segments,l.segments)):(this._propertyChangeValues(u,s),this._translate(u,s.offsetX-u.offsetX,s.offsetY-u.offsetY,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(u,this));this.selectionList[0]&&this.selectionList[0].name===h.name&&(this.selectionList[0].offsetX=h.offsetX,this.selectionList[0].offsetY=h.offsetY);ej.datavisualization.Diagram.SvgContext.updateSelector(h,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}else n.segments?i?(r=t[n.name],n.sourcePoint=r.sourcePoint,n.targetPoint=r.targetPoint,n.segments=$.extend(!0,[],r.segments),ej.datavisualization.Diagram.DiagramContext.update(n,this)):(this._clearSelection(!0),r=this._findConnector(n.name),n.targetNode&&(e=this.nameTable[n.targetNode],ej.datavisualization.Diagram.Util.removeItem(e.inEdges,n)),n.sourceNode&&(e=this.nameTable[n.sourceNode],ej.datavisualization.Diagram.Util.removeItem(e.outEdges,n)),n.targetNode&&(e=this.nameTable[n.targetNode],e.inEdges.push(n.name)),n.sourceNode&&(e=this.nameTable[n.sourceNode],e.outEdges.push(n.name)),this._propertyChangeConnectorValues(r,n),r.targetNode=n.targetNode,r.sourceNode=n.sourceNode,r.targetPort=n.targetPort,r.sourcePort=n.sourcePort,r.sourcePoint=n.sourcePoint,r.targetPoint=n.targetPoint,r.segments=$.extend(!0,[],n.segments),ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints),this.addSelection(n,!0)):i?(r=t[n.name],this._translate(n,r.offsetX-n.offsetX,r.offsetY-n.offsetY,t),ej.datavisualization.Diagram.DiagramContext.update(r,this)):(r=this._findNode(n.name),this._clearSelection(!0),this._propertyChangeValues(r,n),n.parent&&(f=this.nameTable[n.parent]),f||(f=this.nameTable[r.parent],v=!0),f&&f.container?(this._raiseGroupChangeEvent(n,r.parent?this.nameTable[r.parent]:null,this.nameTable[n.parent],ej.datavisualization.Diagram.GroupChangeCause.HistoryChange),ej.datavisualization.Diagram.canvasHelper._undoDragNode(this,this.nameTable[n.name],n),v&&(a=this.nameTable[f.parent.split("laneStack")[0]],a&&ej.datavisualization.Diagram.DiagramContext.update(a,this))):(this._translate(r,n.offsetX-r.offsetX,n.offsetY-r.offsetY,this.nameTable),n.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[r.parent],this),r.parent&&(f=this.nameTable[r.parent],f&&r.parent&&n.parent==""&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(f.children,r.name),this._delete(r),(n.type==="group"||n.type==="bpmn")&&this._initGroupNode(n,t),this.add(n))),n.parent&&(f=this.nameTable[n.parent],n.parent&&r.parent==""&&(this._delete(r),n=$.extend(!0,{},n),(n.type==="group"||n.type==="bpmn")&&this._initGroupNode(n,t),this.add(n)))),ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,r),this.addSelection(r,!0))},_propertyChangeValues:function(n,t){var r=n.offsetX===t.offsetX?"":"offsetX",u=n.offsetY===t.offsetY?"":"offsetY",i;r==="offsetX"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:n.offsetX,newValue:t.offsetX},this._raisePropertyChange(i));u==="offsetY"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:u,oldValue:n.offsetY,newValue:t.offsetY},this._raisePropertyChange(i))},_propertyChangeResizeValues:function(n,t){var r=t.width===n.width?"":"width",u=t.height===n.height?"":"height",i;r==="width"&&(i={element:n,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:n.width,newValue:t.width},this._raisePropertyChange(i));u==="height"&&(i={element:n,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:u,oldValue:n.height,newValue:t.height},this._raisePropertyChange(i))},_propertyChangeConnectorValues:function(n,t){var r=n.sourcePoint.x===t.sourcePoint.x||n.sourcePoint.y===t.sourcePoint.y?"":"sourcePoint",u=n.targetPoint.x===t.targetPoint.x||n.targetPoint.y===t.targetPoint.y?"":"targetPoint",i;r==="sourcePoint"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:n.sourcePoint,newValue:t.sourcePoint},this._raisePropertyChange(i));u==="targetPoint"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:u,oldValue:n.targetPoint,newValue:t.targetPoint},this._raisePropertyChange(i))},_renderNodeOnLane:function(n,t){var i,u,r=this;r._views.forEach(function(f){var e;i=r._views[f];u=i.svg||i._canvas;t=i.svg.getElementById(n.parent);i.type=="overview"&&(e=!0);n._type==="group"?i.context.renderGroup(n,u,t||i.diagramLayer,r.nameTable,r,null,!0):r.getObjectType(n)==="node"&&i.context.renderNode(n,u,t||i.diagramLayer)})},_updateUndoObject:function(n,t){var i,u,r;t.parent&&(r=this.nameTable[t.parent]);r&&this._collectionContains(t.name,r.children)?(ej.datavisualization.Diagram.Util.removeChildFromGroup(r.children,t.name),n.parent&&(i=this.nameTable[n.parent]),i&&i.children&&!this._collectionContains(t.name,i.children)&&(i.children.push(n.name),this.nameTable[n.name].parent=i.name,i.isLane&&(u=this.tools.move,u._updateMargin(t,i)))):n.parent&&(r=this.nameTable[n.parent])},_collectionContains:function(n,t){for(var i=0;i<t.length;i++)if(typeof t[i]=="string"&&t[i]===n||t[i].name===n)return!0},_recordPinPointChanged:function(n){var t=n.object.node,i=n.object.childTable;(t||t.isSwimlane)&&this._updateRecordPinPoint(t,i)},_updateRecordRotation:function(n,t){var f,r,u,e,s,h,o,i;if(n.type=="pseudoGroup"){for(this._clearSelection(!0),this.nameTable[n.name]=n,i=this.nameTable[n.name],e=n.children,f=0;f<e.length;f++)r=this.nameTable[this._getChild(e[f])],u=t[e[f]],r&&(r.segments?(s=t[r.name],r.sourcePoint=s.sourcePoint,r.targetPoint=s.targetPoint):u&&(this._translate(r,u.offsetX-r.offsetX,u.offsetY-r.offsetY,this.nameTable),this._comparePropertyValues(r,"rotateAngle",{rotateAngle:u.rotateAngle}),this._rotate(r,u.rotateAngle-r.rotateAngle,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(r,this));i&&(h=n.rotateAngle-i.rotateAngle,i.rotateAngle+=h,this.selectionList[0]&&(this.selectionList[0].rotateAngle=i.rotateAngle));this.nameTable[n.name]=n;this.addSelection(n,!0)}else o=null,n.parent&&(o=this.nameTable[n.parent]),o&&o.container?(i=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoRotateNode(this,i,n)):n&&(this._clearSelection(!0),i=this._findNode(n.name),this._comparePropertyValues(i,"rotateAngle",{rotateAngle:n.rotateAngle}),this._rotate(i,n.rotateAngle-i.rotateAngle,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(i,this),this.addSelection(i,!0))},_recordSizeChanged:function(n,t){var i=n.object.node,r=n.object.childTable;this._updateRecordSize(i,r,t)},_updateRecordSize:function(n,t,i){var r,o,e,h,c,u,s,f;if(this._clearSelection(!0),n._type!=="group"&&n.type!=="pseudoGroup"||n.isLane||n.isSwimlane||n.type==="bpmn")n.isLane||n.isSwimlane?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeLane(this,n,i)):n.type=="bpmn"&&n.container?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,r,n)):(f=null,n.parent&&(f=this.nameTable[n.parent]),f&&f.container?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,r,n)):n.segments||(r=this._findNode(n.name),this._propertyChangeResizeValues(r,n),this._translate(r,n.offsetX-r.offsetX,n.offsetY-r.offsetY,this.nameTable),this.scale(r,n.width/r.width,n.height/r.height,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r,!0)));else{for(n.type=="pseudoGroup"&&(this.nameTable[n.name]=n),r=this._findNode(n.name),h=this._getChildren(r.children),c=this._getChildren(n.children),o=0;h&&o<h.length;o++)u=this.nameTable[c[o]],e=t[c[o]],e&&(u.segments?(s=t[u.name],u.sourcePoint=s.sourcePoint,u.targetPoint=s.targetPoint,u.segments=$.extend(!0,[],s.segments)):(this._propertyChangeResizeValues(u,e),this._translate(u,e.offsetX-u.offsetX,e.offsetY-u.offsetY,this.nameTable),this.scale(u,e.width/u.width,e.height/u.height,ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY),this.nameTable)));f=null;n.parent&&(f=this.nameTable[n.parent]);f&&f.container?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,r,n)):(r.offsetX=n.offsetX,r.offsetY=n.offsetY,r.width=n.width,r.height=n.height,this.activeTool.name=="resize"&&this.activeTool.inAction&&this.selectionList[0].type!="pseudoGroup"&&this.selectionList[0].type!="group"||this._updateAssociatedConnectorEnds(r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r,!0))}},_recordRotationChanged:function(n){var t=n.object.node,i=n.object.childTable;this._updateRecordRotation(t,i)},_recordEndPointChanged:function(n){var t,i,r,u,f,o,e;this.clearSelection(!0);n._isUndo?(t=i=n.undoObject,r=n.redoObject):(t=i=n.redoObject,r=n.undoObject);t=t.parent?this._findChildren(this.nameTable[t.parent],t.name):this._findConnector(t.name);r.targetNode&&(u=this.nameTable[r.targetNode],ej.datavisualization.Diagram.Util.removeItem(u.inEdges,r.name));r.sourceNode&&(u=this.nameTable[r.sourceNode],ej.datavisualization.Diagram.Util.removeItem(u.outEdges,r.name));i.targetNode&&(u=this.nameTable[i.targetNode],u.inEdges.push(i.name));i.sourceNode&&(u=this.nameTable[i.sourceNode],u.outEdges.push(i.name));this._propertyChangeConnectorValues(t,i);this._comparePropertyValues(t,"targetNode",{targetNode:i.targetNode});t.targetNode=i.targetNode;this._comparePropertyValues(t,"sourceNode",{sourceNode:i.sourceNode});t.sourceNode=i.sourceNode;this._comparePropertyValues(t,"targetPort",{targetPort:i.targetPort});(n.removePortType=="targetpoint"||n.removePortType=="sourcepoint")&&(f=null,f=n.removePortType=="targetpoint"?this._findNode(n.undoObject.targetNode):this._findNode(n.undoObject.sourceNode),o=this._findPort(f,n.removedPort.name),f._ports&&(this._UndoRedo?f._ports.push(n.removedPort):(e=f._ports.indexOf(n.removedPort),f._ports.splice(e,1))));t.targetPort=i.targetPort;this._comparePropertyValues(t,"sourcePort",{sourcePort:i.sourcePort});t.sourcePort=i.sourcePort;this._comparePropertyValues(t,"sourcePoint",{sourcePoint:i.sourcePoint});t.sourcePoint=i.sourcePoint;this._comparePropertyValues(t,"targetPoint",{targetPoint:i.targetPoint});t.targetPoint=i.targetPoint;t.segments=$.extend(!0,[],i.segments);this._updateEdges(t);this._dock(t,this.nameTable);ej.datavisualization.Diagram.Util._updateConnectorSegments(t,t.sourcePort,t.targetPort,this);ej.datavisualization.Diagram.DiagramContext._refreshSegments(t,this);ej.datavisualization.Diagram.Util.updateBridging(t,this);ej.datavisualization.Diagram.DiagramContext.update(t,this);this._updateConnectorBridging(t);this._addSelection(t,this._selectionContains(t)?!0:!1);this.selectionList[0]&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom);ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},_recordLabelPositionChanged:function(n){var r=n.activeLabel,i,t;r&&(i=n.redoObject?n.redoObject.node:null,n.undo&&(i=n.undoObject?n.undoObject.node:null),i&&(t=this._findLabel(i,r.name),this.updateLabel(i.name,r,{margin:t.margin,offset:t.offset,segmentOffset:t.segmentOffset,width:t.width,height:t.height,rotateAngle:t.rotateAngle})))},_recordPortPositionChanged:function(n){var i=n.activePort,t,r;i&&(t=n.redoObject?n.redoObject.node:null,n.undo&&(t=n.undoObject?n.undoObject.node:null),t&&(r=this._findPort(t,i.name),this.updatePort(t.name,i,{offset:r.offset})))},_recordLabelChanged:function(n){var t=this.nameTable[n.object.name];this._comparePropertyValues(t.labels[n.index?n.index:0],"text",{text:n.label});n.object.type==="text"?(t.textBlock.text=n.label,ej.datavisualization.Diagram.DiagramContext.updateTextBlock(t,t.textBlock,this)):t.type=="umlclassifier"?(this._clearSelection(!0),n.label=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(n.label,t,this),t=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(t,this),t.labels[n.index].text="",ej.datavisualization.Diagram.DiagramContext.update(t,this),this.addSelection(t,!0)):t.shape&&t.shape.type=="umlclassifier"?(t=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(t,n.label,t.labels[n.index]),ej.datavisualization.Diagram.DiagramContext.update(t,this)):t.labels[n.index]?(t.labels[n.index].text=n.label,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,t.labels[n.index],this)):(t.labels[n.index]=ej.datavisualization.Diagram.Label({text:n.label,_parent:t.name}),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(t,t.labels[n.index],null,this))},labelcollectionchanged:function(n){var t=this.nameTable[n.shape.name],e=t.labels,r,f,u,i;if(e.slice(0),n.isLabelRemove){if(n.labels&&n.labels.length>0)for(r=n.labels.slice(),i=0;i<r.length;i++)f=r[i].index,u=r[i].label,f!=undefined&&u&&(n.isUndo?this.insertLabel(t.name,u,f):this.removeLabels(t.name,[u]))}else n.isUndo?this.removeLabels(t.name,[n.label]):this.addLabel(t.name,n.label),this._raisePropertyChange({element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:e,newValue:t.labels})},_recordGroupChanged:function(n){var e=n.actionType,o,u,i,f,s,h,r,c,t;if(n.isUndo&&(n.actionType==="group"&&(e="ungroup"),n.actionType==="ungroup"&&(e="group")),this._clearSelection(e=="group"?!0:!1),o=this._getChildren(n.object.children),e==="group"){for(u=new ej.datavisualization.Diagram.Group(n.object),u.children=[],i=0;i<o.length;i++)t=this.nameTable[o[i]],u.children.push(t),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),t),t.parent&&(s=this.nameTable[t.parent]),t.parent=u.name,r=this._svg.document.getElementById(o[i]),r&&r.parentNode.removeChild(r),t.parent&&(h=this.nameTable[t.parent]),this._raiseGroupChangeEvent(t,s,h,"group");this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange;this.add(u);this._addSelection(u)}else{for(f=n.object,r=this._svg.document.getElementById(f.name),r&&r.parentNode.removeChild(r),c=this._getChildren(f.children),i=0;i<c.length;i++)t=this.nameTable[c[i]],t.parent&&(s=this.nameTable[t.parent]),t.parent="",this._isUndo=!0,t.segments||(t._type=="group"?ej.datavisualization.Diagram.DiagramContext.renderGroup(t,this):ej.datavisualization.Diagram.DiagramContext.renderNode(t,this),this.nodes().indexOf(t)===-1&&(this.nodes().push(t),this._nodes=$.extend(!0,[],this.nodes()))),t.segments&&(ej.datavisualization.Diagram.DiagramContext.renderConnector(t,this),this.connectors().indexOf(t)===-1&&(this.connectors().push(t),this._connectors=$.extend(!0,[],this.connectors()))),this._isUndo=!1,this._nodes=$.extend(!0,[],this.nodes()),t.parent&&(h=this.nameTable[t.parent]),this._raiseGroupChangeEvent(t,s,h,"ungroup");this._removeElement(f);ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(f.name));this._nodes=$.extend(!0,[],this.nodes())}},_recordNudgingChanges:function(n,t,i){var r,u;this._isUndo=!0;r=t.undoDirection;i&&(r=t.redoDirection);this._clearSelection(!0);n.type==="pseudoGroup"&&(u=ej.datavisualization.Diagram.Group(n),delete this.nameTable[u.name],this.nameTable[u.name]=n);this._addSelection(n._type=="label"?n:this.nameTable[n.name],!0);this.nudge(r,t.values);this._isUndo=!1},_recordPropertiesChanged:function(n,t,i,r){var u=this._getModifiedProperties(i=="port"||i=="label"?r:n,t),f;u&&Object.keys(u).length&&(i=="connector"&&((t.sourcePoint||t.sourceNode)&&(u.sourcePoint=n.sourcePoint,u.sourceNode=n.sourceNode,u.sourcePort=n.sourcePort),(t.targetPoint||t.targetNode)&&(u.targetNode=n.targetNode,u.targetPort=n.targetPort,u.targetPoint=n.targetPoint)),f={type:"propertiesChanged",values:u,category:"internal",object:n,elementType:i,updateValues:t},f[i]=r,this.addHistoryEntry(f))},_recordAlignCommandChanges:function(n){var i,t,f,r,u;if(n&&n.values.length){for(this._associatedConnectorsUpdate=!0,i=0;i<n.values.length;i++)t=n.values[i],t.object&&t.delta&&(f={x:-t.delta.x,y:-t.delta.y},r=this.nameTable[this._getChild(t.object)],this._comparePropertyOnAlign(r,-t.delta.x,-t.delta.y),this._translate(r,-t.delta.x,-t.delta.y,this.nameTable),this._updateContainerOnNudge(r),t.delta=f,this._updateObject(r));for(delete this._associatedConnectorsUpdate,i=0;i<n.values.length;i++)u=this.nameTable[this._getChild(n.values[i].object)],u.segments||this._updateAssociateConnector(u);this.nameTable[n.object.name]||(this.nameTable[n.object.name]=n.object);ej.datavisualization.Diagram.Util._updateGroupBounds(n.object,this);this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(n.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(n.object,!0)}},_recordPhaseCollectionChanged:function(n){n.undo?n.isAdded?n.phase&&this._removePhase(n.phase.name):n.phase&&this._addPhase(n.group,n.phase,n):n.isAdded?n.phase&&this._addPhase(n.group,n.phase,n):n.phase&&this._removePhase(n.phase.name);this._clearSelection(!0)},_recordSizeCommandChanges:function(n){var r,t,u,i;if(n&&n.values.length){for(r=0;r<n.values.length;r++)t=n.values[r],t.object&&t.values&&(u={width:t.object.width||t.object._width||0,height:t.object.height||t.object._height||0},i=this.nameTable[this._getChild(t.object)],this._comparePropertyValues(i,"height",{height:t.values.height}),this._comparePropertyValues(i,"width",{width:t.values.width}),this.scale(i,t.values.width/(i.width||i._width||0),t.values.height/(i.height||i.height||0),{x:i.offsetX,y:i.offsetY},this.nameTable),t.values=u,this._updateObject(i));this.nameTable[n.object.name]||n.object.type!="pseudoGroup"||(this.nameTable[n.object.name]=n.object);ej.datavisualization.Diagram.Util._updateGroupBounds(n.object,this);this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(n.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(n.object,!0)}},_getModifiedProperties:function(n,t,i){var u,r;if(i=i||n,t&&Object.keys(t).length&&i){u={};for(r in t)(t[r]!=i[r]||typeof i[r]=="object")&&(u[r]=i[r]&&i[r]instanceof Array?i[r]:i[r]&&typeof i[r]=="object"?$.extend(!0,{},i[r]):i[r]);return u}},_addCollectionChangeToHistory:function(n){var t,i;n.parent==""&&(t={},this.selectionList&&this.selectionList.length>0&&(t=this._getChildTable(this.selectionList[0],t)),i={type:"collectionchanged",object:jQuery.extend(!0,{},n),childTable:jQuery.extend(!0,{},t),changeType:"insert",category:"internal"},this.addHistoryEntry(i))},_recordPhasesizeChanged:function(n){var t=$.extend(!0,{},n.undoObject),i=$.extend(!0,{},n.redoObject);n.undo?this._updatePhase({name:t.name,offset:t.offset}):this._updatePhase({name:i.name,offset:i.offset})},_recordPortsCollectionChanged:function(n){var o=n.changeType,i,u,s,f,t,e,r;if(n.isUndo&&(o=n.changeType=="insert"?"remove":"insert"),i=this.nameTable[n.object.name],o=="remove")for(t=0;t<n.collection.length;t++)for(this._updatePortConnection(i,i.inEdges,n.collection[t]),this._updatePortConnection(i,i.outEdges,n.collection[t]),ej.datavisualization.Diagram.Util.removeItem(i.ports,n.collection[t]),u=0;u<this._views.length;u++)s=this._views[u],f=this._views[s].svg.document.getElementById(i.name+"_"+n.collection[t].name),f&&f.parentNode.removeChild(f);else for(t=0;t<n.collection.length;t++)i.ports.push(n.collection[t]),ej.datavisualization.Diagram.DiagramContext.renderPort(i,n.collection[t],this),n.collection[t]._removeLine&&(e=n.collection[t]._removeLine,e&&(r=this.nameTable[e],r&&(n.collection[t]._removeFromSourcePort||n.collection[t]._removeFromTargetPort)&&(n.collection[t]._removeFromSourcePort&&(r.sourcePort=n.collection[t].name),n.collection[t]._removeFromTargetPort&&(r.targetPort=n.collection[t].name),this._dock(r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this))))},_initLaneContaier:function(n){return n.isLane&&(n=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,n)),n},_addSymbolToDiagram:function(n){var u,h,c,e,l;if(ej.datavisualization.Diagram.Util.isPageEditable(this)){var r=this._currZoom,a=$("#"+this.element[0].id).offset(),f=this._isTouchEvent(n);f.pageX||n.pageX||(n.originalEvent&&n.originalEvent.changedTouches?f=n.originalEvent.changedTouches[0]:n&&n.changedTouches&&(f=n.changedTouches[0]));var o=(f?f.pageX:n.pageX)+this._hScrollOffset-a.left,s=(f?f.pageY:n.pageY)+this._vScrollOffset-a.top,i=$.extend(!0,{},this._selectedSymbol),t;if(this._selectedSymbol&&(t=i,this._isNodeEnters?t.isSwimlane&&(this.nameTable[t.name]=t,t=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t,{childTable:this.childTable,object:t}),this._addAssiciatedChildConnectors(t)):(t&&t.type!="pseudoGroup"&&(i.name+=ej.datavisualization.Diagram.Util.randomId()),i.segments?ej.datavisualization.Diagram.Util._translateLine(i,o/r,s/r):(this._cloneGroupNode(i,ej.datavisualization.Diagram.Util.randomId()),i._type==="group"?i.type=="bpmn"?i.offsetX!==0||i.offsetY!==0?(i.offsetX=o/r,i.offsetY=s/r):(u=ej.datavisualization.Diagram.Util._getChildrenBounds(i,this),ej.datavisualization.Diagram.Util._translate(i,o/r-u.x-u.height/2,s/r-u.y-u.width/2,this.nameTable,null,this)):(u=ej.datavisualization.Diagram.Util._getChildrenBounds(i,this),ej.datavisualization.Diagram.Util._translate(i,o/r-u.x-u.height/2,s/r-u.y-u.width/2,this.nameTable,null,this)):(i.offsetX=o/r,i.offsetY=s/r),i.isLane&&(h=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,this.nameTable),h.isLane=i.isLane,h.orientation=i.orientation,t=h),i.type=="bpmn"&&delete t.children)),t&&(c={element:t,target:this,targetType:"diagram"},this._raiseEvent("dragEnter",c),!c.cancel))){if(this._isEditing&&(this._endEditing=!0,this._endEdit(),delete this._endEditing),t&&!this._isNodeEnters&&(t=this._initLaneContaier(t)),t.type!="pseudoGroup")t.isLane&&(this.nameTable[this._getChild(t.children[0])]._isHeader=!0),this.add(t);else{for(e=0;e<t.children.length;e++)this.add(t.children[e]),t.children[e]=t.children[e].name;for(l in this.edgeTable)this.nameTable[l]||this.add(this.edgeTable[l]);this._hasSelection()&&this._clearSelection(!0);this.nodes().push(t);this._nodes=$.extend(!0,[],this.nodes());this.nameTable[t.name]=t;ej.datavisualization.Diagram.Util._updateGroupBounds(t,this);this.addSelection(t,!0)}this._focusedElement=t;t.isLane&&ej.datavisualization.Diagram.SvgContext._hideNode(t,this._svg);this.element[0].focus();this._toolToActivate="move";document.getElementsByClassName("e-paletteItem dragClone")[0]&&$(".e-paletteItem.dragClone").css("display","none");this.activateTool("move",!1);this._symbolDrop=!0;this.activeTool.mousedown(n);this.activeTool.mousemove(n)}}delete this._symbolDrop},_removeSymbolFromDiagram:function(){if(this._selectedSymbol){var n=document.getElementsByClassName("e-paletteItem dragClone")[0];n!=null&&(n.style.display="block");this._remove(this.selectionList[0]);this._selectedSymbol=null}},_updateGroupChild:function(n){for(var i=n.children,t=0;t<n.children.length;t++)n.children[t]=this.nameTable[this._getChild(n.children[t])],n.children[t]&&n.children[t]._type==="group"&&this._updateGroupChild(n.children[t])},_dropSymbol:function(n,t){var u,i,e,f,r,o;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(u=n||this.selectionList[0]||this.activeTool.selectedObject,i={element:this.getNode(u)},this._nodeUnderMouse&&(i.target=this._nodeUnderMouse),e=!1,i.target||(i.target=this.model),u&&u._type==="group"&&this._updateGroupChild(u),this._remove(u),this.nameTable[i.element.name]=i.element,this._selectedSymbol=null,f=n||i.element,r=this.activeTool._getMouseOverElement(t),this.activeTool._outOfBoundsDrag(f)&&ej.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this,this.activeTool.selectedObject,r)?(this._raiseDropEvent(i),i.cancel||(this._isInsert=!0,this._containerOverNode=null,r&&r.container&&ej.datavisualization.Diagram.Util.canAllowDrop(r)&&!r.isSwimlane&&ej.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.activeTool.selectedObject,r)&&this.getObjectType(f)!=="connector"&&(f.parent=r.name,this._containerOverNode=r),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Drop,e=this.add(f),delete this._containerOverNode,this.activeTool.selectedObject=this.selectionList[0],this._isInsert=!1),e?(o=this.nameTable[i.element.name],this._updateDroppedSymbol(o)):this.activeTool.selectedObject=null):(this.activeTool.selectedObject=null,delete this.nameTable[i.element.name],this._clearSelection(!0)),ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||(this._clearSelection(!0),this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan&&this.activateTool("panTool")))},_updateDroppedSymbol:function(n){n&&this.selectionList.length>0&&(this.scrollToNode(n),n.labels.length>0&&n.labels[0].mode==="edit"&&!n.labels[0].readOnly?n.isPhase||n.isSwimlane||n.isLane||n.type!=="umlclassifier"&&(this._isEditing=!0,this.startLabelEdit(n,n.labels[0])):this.element[0].focus(),this._nodeUnderMouse&&this._nodeUnderMouse.segments&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg))},_initiateAutoScroll:function(n){if(this.activeTool.inAction&&this.enableAutoScroll()&&!(this.activeTool instanceof ej.datavisualization.Diagram.RotateTool)){var u=this._viewPort,t=this._mousePosition(n,!0),i=this.model.pageSettings.autoScrollBorder,r=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);t.x+i.right-r.left>=u.width-18?(this._beginAutoScroll("right",n),this._canAutoScroll=!0):t.x<=i.left+r.left?(this._beginAutoScroll("left",n),this._canAutoScroll=!0):t.y+i.bottom+r.top>=u.height-18?(this._beginAutoScroll("bottom",n),this._canAutoScroll=!0):t.y<=i.top+r.top?(this._beginAutoScroll("top",n),this._canAutoScroll=!0):this._canAutoScroll=!1}},_updatePoints:function(n,t,i,r){var u=new ej.datavisualization.Diagram.Point(i.x-t.x,i.y-t.y);ej.datavisualization.Diagram.Geometry.isEmptyPoint(u)||n._updateEndPoint(u.x,u.y,r)},_cloneGroupNode:function(n,t,i){var r=null,u,e=n.children=this._getChildren(n.children),f;if(n._type==="group")for(f=0;f<e.length;f++)i?r=i[e[f]]:this._paletteTable&&(r=this._paletteTable[e[f]]),r&&(r=$.extend(!0,{},r),r._type==="group"&&this._cloneGroupNode(r,t),u=$.extend(!0,{},r),u.name+=t,u.parent=n.name,e[f]=u.name,this.nameTable[u.name]=u)},_addGroupConnector:function(n,t){var r,u,e,i,o,s,f;if(!n.segments)for(s=this._getChildren(n.children),e=0;e<s.length;e++)if(f=this.nameTable[s[e]],f){if(f.inEdges&&f.inEdges.length>0)for(r=f.inEdges,i=0,o=r.length;i<o;i++)u=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],u&&!this.nameTable[u.name]&&this.add(u);if(f.outEdges&&f.outEdges.length>0)for(r=f.outEdges,i=0,o=r.length;i<o;i++)u=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],u&&!this.nameTable[u.name]&&this.add(u)}},_addConnector:function(n,t){var r,u,i,f;if(!n.segments){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=0,f=r.length;i<f;i++)u=t?t.edgeTable[r[i]]:this.nameTable[r[i]],u.zOrder=-1,this.add(u);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,f=r.length;i<f;i++)u=t?t.edgeTable[r[i]]:this.nameTable[r[i]],u.zOrder=-1,this.add(u)}},_addChildren:function(n,t){for(var r,u=this._getChildren(n.children),i=0;i<u.length;i++)r=t[u[i]],r._type==="group"&&this._addChildren(r,t),this.nameTable[u[i]]=r,n.children[i]=r},_updateLabels:function(n,t){n.labels=t;for(var i=0;i<n.labels.length;i++)ej.datavisualization.Diagram.DiagramContext.updateLabel(n,n.labels[i],this)},_getNode:function(n,t){var i;return(i=t?typeof n=="object"?t[n.name]:t[n]:typeof n=="object"?this.nameTable[n.name]:this.nameTable[n],i||typeof n!="object"?i&&typeof n=="string"&&(i=t?t[n]:this.nameTable[n]):i=n,i)?i.isLane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"lane"):i.isPhase||i.type==="phase"?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"phase"):i.isSwimlane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"swimlane",t):i._type==="node"||i._type==="group"||i._type==="pseudoGroup"||this.getObjectType(i)=="node"?i:i:null},_updateEdges:function(n){var t;ej.datavisualization.Diagram.Util.isTargetConnected(n)&&(t=this.nameTable[n.targetNode],t&&t.inEdges.indexOf(n.name)==-1&&t.inEdges.push(n.name));ej.datavisualization.Diagram.Util.isSourceConnected(n)&&(t=this.nameTable[n.sourceNode],t&&t.outEdges.indexOf(n.name)==-1&&t.outEdges.push(n.name))},_updateChildrenEdges:function(n){for(var t,r=this._getChildren(n.children),i=0;i<r.length;i++)t=r[i],t.segments?(this._updateEdges(t),this._dock(t,this.nameTable)):t._type==="group"&&this._updateChildrenEdges(t)},_updateParent:function(n){for(var u,t,r=this._getChildren(n.children),i=0;i<r.length;i++)u=this.nodes().indexOf(this.nameTable[r[i]]),t=this.nameTable[r[i]],t=t.type!="bpmn"&&t.type!="connector"?this._getNewNode(t):t,t&&t._type==="group"?this._updateParent(t):t&&(t.parent=n.name,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],this.nameTable[t.name]),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,this.nameTable[t.name]),this.nameTable[t.name]=t,u!=-1&&(this.nodes()[u]=t)),this._updateQuad(this.nameTable[t.name])},_findPortAtPoint:function(n,t){var o,i,f,r,u,s,h,l,c,e,a;if(t)for(l=ej.datavisualization.Diagram.Util.bounds(t,!0),o=t.ports,e=0,a=o.length;e<a;++e)if((i=o[e],r=ej.datavisualization.Diagram.Size(i.size,i.size),u=ej.datavisualization.Diagram.Util._getPortPosition(i,l),c=ej.Matrix.identity(),ej.Matrix.rotate(c,t.rotateAngle,t.offsetX,t.offsetY),u=ej.Matrix.transform(c,u),s=u.x-i.size/2,h=u.y-i.size/2,f=ej.datavisualization.Diagram.Rectangle(s,h,r.width,r.height),ej.datavisualization.Diagram.Geometry.containsPoint(f,n))||this.portHighlight&&(f=ej.datavisualization.Diagram.Rectangle(s-1,h-1,r.width+1,r.height+1),ej.datavisualization.Diagram.Geometry.containsPoint(f,n)))return ej.datavisualization.Diagram.Util.canConnect(i,!0)?i:null;return null},_findLabelAtPoint:function(n,t){var e,r=null,y,u,i,p,w,c,l,a,f,s,o,k=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],v=[],h,b;if(t&&this.model.labelRenderingMode!==ej.datavisualization.Diagram.LabelRenderingMode.Svg&&(f=ej.datavisualization.Diagram.Util.bounds(t,!0),e=t.labels,e&&e.length>0))for(r=e[0],h=0,b=e.length;h<b;h++)if(r=e[h],s=$(k).find("#"+t.name+"_"+r.name)[0],c=s?s.offsetWidth:0,l=s?s.offsetHeight:0,c||(c=f.width),l||(l=r.fontSize),u=ej.datavisualization.Diagram.Size(c,l),i=ej.datavisualization.Diagram.Util._getLabelPosition(r,f),i.x=f.x+i.x,i.y=f.y+i.y,o=ej.Matrix.identity(),t.segments?ej.Matrix.rotate(o,0,f.x+f.width/2,f.y+f.height/2):ej.Matrix.rotate(o,-t.rotateAngle,t.offsetX,t.offsetY),a=ej.Matrix.transform(o,n),o=ej.Matrix.identity(),ej.Matrix.rotate(o,-r.rotateAngle,i.x,i.y),a=ej.Matrix.transform(o,a),r.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Top?i.y+=u.height/2:r.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Bottom&&(i.y-=u.height/2),r.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Left?i.x+=u.width/2:r.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Right&&(i.x-=u.width/2),p=i.x-u.width/2,w=i.y-u.height/2,y=ej.datavisualization.Diagram.Rectangle(p,w,u.width,u.height),ej.datavisualization.Diagram.Geometry.containsPoint(y,a)&&v.push(r),h==e.length-1)return v.length?v[v.length-1]:null;return r},_getCurrentZoom:function(){return this._currZoom},_findNode:function(n){return this.nameTable[n]},_findPort:function(n,t){for(var r=n.ports,i=0,u=r.length;i<u;i++)if(r[i].name===t)return r[i];return null},_findLabel:function(n,t){for(var r=n.labels,i=0,u=r.length;i<u;i++)if(r[i].name===t)return r[i];return null},_findLabelRotateAngle:function(n){var i=this.findNode(n._parent),t=0;return i&&(t=i.segments?n.rotateAngle:n.rotateAngle+i.rotateAngle,t>360&&(t%=360)),t},_findConnector:function(n){return this.nameTable[n]},_findChildren:function(n,t){for(var i,r,f=this._getChildren(n.children),u=0;u<f.length;u++)if(i=this.nameTable[f[u]],i){if(t==i.name)return i;if(i._type==="group"&&(r=this._findChildren(i,t),r))return r}return null},_removeLaneParent:function(n){var t,u=[],v,o,r=[],s=[],l,f,h=0,y=!1,a=[],c,e,i;if(n.isLane&&n.parent){if(o=this.nameTable[n.parent],o.children&&o.children.length===1&&o&&o.parent&&(i=this.nameTable[o.parent],i))return{remove:!0,node:i}}else if(n._type=="pseudoGroup"){for(t=0;t<n.children.length;t++)r[t]=this.nameTable[n.children[t]],r[t]&&r[t].isLane&&r[t].parent?(u[t]=r[t].parent,y=!0):a.push(r[t]);if(this.isSameParent(u)&&u.length==n.children.length){if(v=this.nameTable[u[0]],v.children.length==u.length&&(i=this.nameTable[v.parent],i&&i.isSwimlane))return{remove:!0,node:i}}else if(y){for(e=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),s=u.filter(function(n,t,i){return i.indexOf(n)==t}),t=0;t<s.length;t++){for(h=0,l=0;l<u.length;l++)s[t]==u[l]&&h++;if(c=this.nameTable[s[t]],h&&c&&c.children&&c.children.length==h)i=this.nameTable[c.parent],i&&i.isSwimlane&&e.children.push(i);else if(h)for(f=0;f<n.children.length;f++)r=this.nameTable[n.children[f]],r.parent==s[t]&&e.children.push(r)}if(a.length>0)for(f=0;f<a.length;f++)e.children.push(a[f]);if(e&&e.children.length>1)return ej.datavisualization.Diagram.Util._updateGroupBounds(e,this),{remove:!0,node:e}}}return{remove:!1}},_delete:function(n){var s=!1,r,v,f,u,i,t,o,h,c=!1,e,l,a;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(n=n||this.selectionList[0],n)){if(!n.isPhase&&(n.type&&n.type!="phase"||n.segments||n._type=="node"||n._type=="pseudoGroup")||this._dropPhase){if(o=this._removeLaneParent(n),o.remove&&(n=o.node),i=n,i.type=="pseudoGroup")for(t=0;t<i.children.length;t++)v=typeof i.children[t]=="object"?i.children[t].name:i.children[t],r=this.findNode(v),r&&r.parent&&r.isLane&&(r._laneIndex=this._getRemoveIndex(r),c=!0);if(i.type=="pseudoGroup"&&c){for(f=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u=this._getChildren(i.children),this._multipleAction=!0,t=u.length-1;t>=0;t--)r=this.nameTable[u[t]],r.isLane&&r.parent?(o=this._removeLaneParent(r),h=o.remove?o.node:r):h=r,h&&f.children.push(h);for(c&&(f._isMultipleLaneDelete=!0),f&&f.children.length>0&&(ej.datavisualization.Diagram.Util._updateGroupBounds(f,this),this._selectedSymbol||this._removeAdjacentConnections(f)),u=f.children,t=u.length-1;t>=0;t--)r=typeof u[t]=="object"?u[t]:this.nameTable[u[t]],this._isUndo=!1,s=this._remove(r),this._isUndo=!0;delete this._multipleAction;this._isUndo=!1}else if(i._type=="pseudoGroup"){for(t=0;t<n.children.length;t++)n.children[t]=typeof n.children[t]=="object"?n.children[t].name:n.children[t];for(this._selectedSymbol||this._removeAdjacentConnections(n),u=this._getChildren(i.children),this._multipleAction=!0,t=u.length-1;t>=0;t--)this._remove(this.nameTable[u[t]])&&(s=!0),this._isUndo=!0;delete this._multipleAction;this._isUndo=!1}else this._selectedSymbol||this._removeAdjacentConnections(n),this._nodeUnderMouse===i&&(this._nodeUnderMouse=null),s=this._remove(i),i.container&&i.parent&&(e=this.nameTable[i.parent],e&&e.container&&e.container.type=="stack"&&(this._getChild(e.children[0])?(l=this._getSwimlane(i),l&&this._updateChildAdjacentConnectors(l,!0),ej.datavisualization.Diagram.DiagramContext.update(e,this)):(a=this.nameTable[e.parent],a&&this._remove(a))));s&&this._clearSelection()}else n.type&&n.type=="phase"&&(this._removePhase(n.name),this._clearSelection());this._removeNodeFromGraph(n)}},_canUpdateOnGraph:function(n){return n.parent?!1:!0},_addNodeToGraph:function(n){n.type!=="pseudoGroup"&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(n)&&this._canUpdateOnGraph(n)&&this._setBounds(n)},_updateNodeFromGraph:function(n){n.type!=="pseudoGroup"&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(n)&&this._canUpdateOnGraph(n)&&this._setBounds(n)},_routeEdge:function(n){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(n)&&(this.activeTool.inAction||this.lineRouting.routeEdge(n,this))},_updateAllEdges:function(n){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(n)&&this.lineRouting&&(this.lineRouting.updateAllQuadObjects(this._spatialSearch.parentQuad),this.lineRouting.RerouteConnectors(this,n))},_removeNodeFromGraph:function(n){n.type!=="pseudoGroup"&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(n)&&this._canUpdateOnGraph(n)&&this.lineRouting.RemoveNode(n)},_removeAdjacentConnections:function(n,t){var u={},f={},e,o,i,s,r,h,t;if(u=this._getChildTable(n,u),f=this._getEdgeTable(n,f),!this._isUndo||t){if(e={},o={},!n.segments){if(n.outEdges&&n.outEdges.length>0)for(s=n.outEdges.length,r=0;r<s;r++)i=this.nameTable[n.outEdges[r]],i&&i.sourcePort&&(e[i.name]=i.sourcePort);if(n.inEdges&&n.inEdges.length>0)for(s=n.inEdges.length,r=0;r<s;r++)i=this.nameTable[n.inEdges[r]],i&&i.targetPort&&(o[i.name]=i.targetPort)}this._isUndo?(t.targetPorts=o,t.sourcePorts=e,t.edgeTable=f,t.childTable=u):(h=null,n.isLane&&(h=this._getRemoveIndex(n)),t={type:"collectionchanged",object:this._updatePsedoGroupChildren(n),index:h,childTable:jQuery.extend(!0,{},u),edgeTable:jQuery.extend(!0,{},f),sourcePorts:e,targetPorts:o,changeType:"remove",category:"internal"},n.isPhase||ej.datavisualization.Diagram.Util.canDelete(n)&&this.addHistoryEntry(t))}},_updatePsedoGroupChildren:function(n){var r=jQuery.extend(!0,{},n),t,i;if(n&&n.type=="pseudoGroup")for(i=0;i<r.children.length;i++)t=this.nameTable[this._getChild(r.children[i])],t&&(t.isSwimlane||t.isLane&&n._isMultipleLaneDelete)&&(r.children[i]=this.getNode(t));return r},_getRemoveIndex:function(n){var t,r,i;if(n.parent&&(t=this.nameTable[n.parent],t&&t.children&&t.children.length>0))for(i=0;i<t.children.length;i++)if(r=this._getChild(t.children[i]),r===this._getChild(n))return Number(i);return 0},_getSwimlaneHeader:function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.nameTable[this._getChild(n.children[0])]),t},_addPhase:function(n,t,i){var r=this.nameTable[n],h=!1,f,o,e,a,u,l;if(r&&r.isSwimlane&&t&&(r&&r.orientation&&t.offset&&(r.orientation=="horizontal"?(f=r.offsetX-r.width/2,e=this._getFirstLane(r),e&&(f+=e.width),h=t.offset>r.width||r.offsetX-r.width/2+t.offset<f?!0:!1):r.orientation=="vertical"&&(f=r.offsetY-r.height/2,o=this._getSwimlaneHeader(r),o&&(f+=o.height),e=this._getFirstLane(r),e&&(f+=e.height),h=t.offset>r.height||r.offsetY-r.height/2+t.offset<f?!0:!1)),t.offset&&!h)){if(i&&i.islastPhase&&(a=i.phase,r.orientation==="horizontal"?r.width>t.offset&&(t.width+=r.width-t.offset,t.offset=r.width):r.height-o.height>t.offset&&(t.height+=r.height-o.height-t.offset,t.offset=r.height-o.height)),u=ej.datavisualization.Diagram.Phase(t),u.orientation=r.orientation,u.label=ej.datavisualization.Diagram.Label(t.label?t.label:{text:"Phase"}),u.parent=r.name,this.nameTable[u.name]&&(ej.datavisualization.Diagram.Util.removeItem(this.model.phases,this.nameTable[u.name]),delete this.nameTable[u.name]),i&&i.islastPhase){var s=this._getInsertIndex(u)+1,c=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,r),v=$.extend(!0,{},i.phaseObject.prevPhase);this._updateInsertPhase(u,v.name,r,s,i);ej.datavisualization.Diagram.SvgContext.renderphase(u,this._svg,this._diagramLayer,this,r);ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this);ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(r.children[1])],!0);ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,u)}else{var s=this._getInsertIndex(u)+1,c=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,r),v=$.extend(!0,{},this.nameTable[this._getChild(c[s-1])]);this._updateInsertPhase(u,c[s],r,s);ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this);ej.datavisualization.Diagram.SvgContext.renderphase(u,this._svg,this._diagramLayer,this,r);ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(r.children[1])],!0);ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,u)}this._isUndo||(l={type:"phasecollectionchanged",phase:u,category:"internal",group:r.name,isAdded:!0},this.addHistoryEntry(l))}this._clearSelection(!0)},_removePhase:function(n){var t=this.nameTable[n],s=!1,h=null,f,r,c,i,u,o,e,l;t&&(this._raiseChildrenPropertyChange(t),f=this.nameTable[t.parent.split("phaseStack")[0]],r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,f),f&&r&&r.length>1&&(e=this,c=r.indexOf(t.name),this._views.forEach(function(t){var r=e._views[t],i=r.svg.getElementById(n+"_phase_g");i&&i.parentNode.removeChild(i)}),i=ej.datavisualization.Diagram.SwimLaneContainerHelper._getNextPhase(this,t),c===r.length-1&&(i=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPrevPhase(this,t),h=$.extend(!0,{},{prevPhase:i,currPhase:t}),i.offset=t.offset,s=!0),f.orientation==="horizontal"?i.width+=t.width:i.height+=t.height,u=this.nameTable[n],ej.datavisualization.Diagram.Util.removeItem(this.nodes(),u),this._nodes=$.extend(!0,[],this.nodes()),o=this.nameTable[u.parent],delete this.nameTable[n],ej.datavisualization.Diagram.SvgContext._updatephase(i,this),ej.datavisualization.Diagram.Util.removeItem(r,t.name),ej.datavisualization.Diagram.Util.removeItem(o.children,u),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,o,!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,t),e=this,this._views.forEach(function(t){var r=e._views[t],f=r.svg.getElementById(n);f&&f.parentNode.removeChild(f);var o=r.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=$(o).find("#"+u.name+"_label")[0],i=r.svg.getElementById(u.name);i&&i.parentNode&&i.parentNode.removeChild(i);s&&o.removeChild(s)}),this._isUndo||(l={type:"phasecollectionchanged",phase:t,group:f.name,category:"internal",phaseObject:h,islastPhase:s,isAdded:!1},this.addHistoryEntry(l))))},_getEdgeTable:function(n,t){var u,e,o,i,r,h,f,s;if(!n.segments){if(n._type==="group"||n._type==="pseudoGroup")for(h=this._getChildren(n.children),o=0;o<h.length;o++){if(f=this.nameTable[h[o]],f&&f.inEdges&&f.inEdges.length>0)for(u=f.inEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r));if(f&&f.outEdges&&f.outEdges.length>0)for(u=f.outEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r))}if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r));if(n.outEdges&&n.outEdges.length>0)for(u=n.outEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r))}return t},_remove:function(n,t,i){var l=!1,h,t,u,a,v,s,o,f,e,r,y,c;if(this._raiseChildrenPropertyChange(n),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&n&&(ej.datavisualization.Diagram.Util.canDelete(n)||i)&&(h=n.segments?"connector":"node",t=t?ej.datavisualization.Diagram.dependentconnector.dependent:ej.datavisualization.Diagram.dependentconnector.independent,u={changeType:"remove",element:this.getNode(n),cancel:!1,dependent:t,state:"changing"},n.segments||(u.adjustDependent=!0,u.deleteDependent=!0),a=this._eventCause[h+"CollectionChange"],a||(this._isKeyDown||this._isUndo)&&(this._eventCause[h+"CollectionChange"]=this._isUndo&&!this._multipleAction?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Keydown),n.isPhase||this._selectedSymbol||this._raiseEvent(h+"CollectionChange",u),!u.cancel)){if(l=!0,v=n.name,n.type=="group"&&n.type!="pseudoGroup")for(s=this._getChildren(n.children),o=0;o<s.length;o++)if(f=this.nameTable[s[o]],f&&!ej.datavisualization.Diagram.Util.canDelete(f))return;if(n.isSwimlane&&ej.datavisualization.Diagram.SvgContext._removephases(n,this),n.type=="bpmn")for(s=this._getChildren(n.children),o=0;s&&o<s.length;o++)if(f=this.nameTable[s[o]],f&&f.annotation&&f._annotation)for(e=0;e<f._annotation.length;e++)this.nameTable[f._annotation[e]]&&this._remove(this.nameTable[f._annotation[e]],t,!0);if(n.segments)this._removeEdges(n),n.sourceNode=n.sourcePort=n.targetNode=n.targetPort=null,this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[n.name]),ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[n.name]),this._connectors=$.extend(!0,[],this.connectors());else{if(n.annotation&&n._annotation)for(e=0;e<n._annotation.length;e++)this.nameTable[n._annotation[e]]&&this._remove(this.nameTable[n._annotation[e]]);this._disConnect(n,u);this._removeConnector(n,u);this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[n.name]);ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[n.name]);this._nodes=$.extend(!0,[],this.nodes());this._removeNodeFromGraph(n)}h=this.getObjectType(n);ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n);ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,n,!1);n.parent&&(r=this.nameTable[n.parent],r&&(r.type=="group"||r.type=="bpmn"||r.type=="umlclassifier")&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(r.children,n.name),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),y=$.extend(!0,{},r),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r,!0),r.parent&&ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,this.nameTable[r.parent]),ej.datavisualization.Diagram.Util._refreshParentGroup(n,this),ej.datavisualization.Diagram.canvasHelper._updateAddRemoveNodeConnectors(this,r,y),ej.datavisualization.Diagram.canvasHelper._updateAddRemoveLaneConnectors(this,n),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[r.parent]),this._updateQuad(r)));delete this.nameTable[v];n.segments&&this._updateConnectorBridging(n);c=this._svg.getElementById(n.name);n._type=="group"&&n.type!="pseudoGroup"&&this._removeChildren(n,u);this._removeElement(n);c&&c.parentNode&&c.parentNode.removeChild(c);ej.datavisualization.Diagram.SvgContext._removeContainerHelper(this.activeTool.selectedObject,this._adornerSvg,this._adornerLayer);this._clearSelection(this._selectedSymbol||this._dropPhase?!0:!1)}return!l||n.isPhase||this._selectedSymbol||(u.state="changed",n.type==="connector"?this._raiseEvent("connectorCollectionChange",u):this._raiseEvent("nodeCollectionChange",u)),l},_removeConnector:function(n,t){var r,i,u;if(!n.segments){if(t.deleteDependent&&!t.adjustDependent){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0)}if(t.deleteDependent&&t.adjustDependent)if(n.inEdges&&n.inEdges.length>0&&n.outEdges&&n.outEdges.length>0){for(r=n.outEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);for(r=n.inEdges,i=r.length-1;i>=0;i--)this.nameTable[r[i]]&&this._updateConnection(this.nameTable[r[i]],!0)}else if(n.inEdges&&n.inEdges.length==0&&n.outEdges.length>0)for(r=n.outEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);else if(n.outEdges&&n.outEdges.length==0&&n.inEdges.length>0)for(r=n.inEdges,i=r.length-1;i>=0;i--)this.nameTable[r[i]]&&this._updateConnection(this.nameTable[r[i]],!0);else if((n.inEdges&&n.inEdges.length==1||n.inEdges.length>1)&&n.outEdges.length==1)for(r=n.outEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0);else if(!(n.inEdges&&n.inEdges.length>1&&n.outEdges.length>1))for(r=n.inEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0)}},_updateConnection:function(n,t){n&&ej.datavisualization.Diagram.Util.canDelete(n)&&(this._remove(n,t),this.updateConnector(n.name))},_removeElement:function(n){for(var i,t=0;t<this._views.length;t++)i=this._views[t],this._views[i].context.removeChild(n,this._views[i])},_disConnect:function(n,t,i){var u,f,s,c,h,l,r,o,e,v,a;if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,r=0,e=u.length;r<e;r++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[u[r]])&&(a=!0);if(n.outEdges&&n.outEdges.length>0)for(f=n.outEdges,r=0,e=f.length;r<e;r++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[f[r]])&&(a=!0);if(t.deleteDependent&&t.adjustDependent&&!i&&a){if(n.inEdges&&n.inEdges.length>0&&n.outEdges.length>0)if(u=n.inEdges,f=n.outEdges,(n.inEdges.length>1||n.inEdges.length==1)&&n.outEdges.length==1){for(r=0,e=u.length;r<e;r++)this.nameTable[u[r]]&&this.nameTable[f[0]]&&this.nameTable[u[r]].targetNode==this.nameTable[f[0]].sourceNode&&(h=this.nameTable[this.nameTable[f[0]].targetNode],h&&(l=$.extend(!0,{},h),this.nameTable[u[r]].sourceNode!=this.nameTable[f[0]].targetNode&&(this.nameTable[u[r]].targetNode=this.nameTable[f[0]].targetNode,this.nameTable[u[r]].targetPort=this.nameTable[f[0]].targetPort,h.inEdges.push(this.nameTable[u[r]].name))),ej.datavisualization.Diagram.Util.dock(this.nameTable[u[r]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[u[r]],this));this.nameTable[f[0]]&&(this.nameTable[f[0]].sourceNode=null,this.nameTable[f[0]].sourcePort=null)}else if(!(n.inEdges.length>1&&n.outEdges.length>1))for(r=0,e=u.length;r<e;r++)if(n.outEdges.length>0&&this.nameTable[u[r]]){for(c=this.nameTable[this.nameTable[u[r]].sourceNode],l=$.extend(!0,{},c),o=0,v=f.length;o<v;o++)this.nameTable[u[r]].targetNode==this.nameTable[f[o]].sourceNode&&(this.nameTable[f[o]].sourceNode=this.nameTable[u[r]].sourceNode,this.nameTable[f[o]].sourcePort=this.nameTable[u[r]].sourcePort,c.outEdges[l.outEdges.length+o]=this.nameTable[f[o]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[f[o]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[f[o]],this));this.nameTable[u[r]].targetNode=null;this.nameTable[u[r]].targetPort=null}return}if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,r=0,e=u.length;r<e;r++)s=this.nameTable[u[r]],s&&(s.targetNode=null,s.targetPort=null);if(n.outEdges&&n.outEdges.length>0)for(f=n.outEdges,r=0,e=f.length;r<e;r++)s=this.nameTable[f[r]],s&&(s.sourceNode=null,s.sourcePort=null)},_removeEdges:function(n){n.targetNode&&this.nameTable[n.targetNode]&&this.nameTable[n.targetNode].inEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.targetNode].inEdges,n.name);n.sourceNode&&this.nameTable[n.sourceNode]&&this.nameTable[n.sourceNode].outEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.sourceNode].outEdges,n.name)},_selectionContains:function(n){if(this._hasSelection()&&n)for(var t=0;t<this.selectionList.length;t++)if(n.name===this.selectionList[t].name)return!0;return!1},_getPhaseIndex:function(n){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,n)},_getPhaseBounds:function(n){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseBounds(this,n)},_addSelection:function(n,t){var s,o,u,c,a,i,l,h;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||n&&n._type==="pseudoGroup"||this._selectedSymbol||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&n&&ej.datavisualization.Diagram.Util.enableLayerOption(n,"lock",this)&&(ej.datavisualization.Diagram.Util.canSelect(n)||n.type=="phase")&&!this._selectionContains(n)){var f=[],r=[],e=[];if(this._previousSelectedItems&&(r=this._previousSelectedItems),n.type=="pseudoGroup")for(s=this._getChildren(n.children),o=0;o<s.length;o++)u=this.nameTable[s[o]],r.indexOf(u)==-1?f.push(u):ej.datavisualization.Diagram.Util.removeItem(r,u),e.push(u);else f.push(n),e.push(n);c=this._eventCause.selectionChange;c||(this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Unknown);a=this.getNode(n);i={changeType:"insert",element:this.getNode(n),state:"changing",selectedItems:e,oldItems:r,newItems:f,cancel:!1};this._selectedSymbol&&!this._endEditing||t||(this._raiseEvent("selectionChange",i),this._previousSelectedItems=i.newItems);i.cancel?n&&n.type=="pseudoGroup"&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),n),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[n.name]):(this.selectionList.push(n),this._updateSelectorObject(n),n.isPhase&&(l=this._getPhaseBounds(n)),ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,l,this),this.model.selectedItems.userHandles!=null&&this.model.selectedItems.userHandles.length>0&&(h=!1,n.type=="pseudoGroup"&&(h=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,n,this._adornerSvg,h,this._currZoom,this._adornerLayer,this)),this._selectedSymbol&&!this._endEditing||t||(i={changeType:"insert",element:this.getNode(n),state:"changed",cause:i.cause,selectedItems:e,oldItems:r,newItems:f,cancel:!1},this._raiseEvent("selectionChange",i)))}},_getInsertIndex:function(n){var f=-1,u,i,e=this.nameTable[n.parent],t=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,e),r;if(t&&t.length>0&&this.nameTable[this._getChild(t[0])])for(u=this.nameTable[this._getChild(t[0])].offset,r=0;r<t.length;r++)i=this.nameTable[this._getChild(t[r])],i&&i.offset<=n.offset&&i.offset>=u&&(u=i.offset,f=r);return f},_updateInsertPhase:function(n,t,i,r,u){var c=this.nameTable[t],o=this.nameTable[this._getChild(i.children[1])],e,f,s,l,h,a;o&&o.children&&o.children.length>0&&(e=this.nameTable[t],f=ej.datavisualization.Diagram.Node(n),i.isSwimlane&&i.orientation&&i.orientation=="vertical"?(u?(s=n.height,e.height=u.phaseObject.prevPhase.height,e.offset=u.phaseObject.prevPhase.offset):(s=e.height,e.height=c.offset-n.offset,l=s-e.height,f.height=l),f.parent=o.name,f.name=n.name,f.width=e.width,f.isPhase=!0):(u?(h=n.width,e.width=u.phaseObject.prevPhase.width,e.offset=u.phaseObject.prevPhase.offset):(h=e.width,e.width=c.offset-n.offset,a=h-e.width,f.width=a),f.parent=o.name,f.name=n.name,f.height=e.height,f.isPhase=!0),f.x=0,f.y=0,this._isUndo&&f.labels.length!==0||(f.labels=[n.label?n.label:ej.datavisualization.Diagram.Label()]),f.labels[0].rotateAngle=n.orientation=="horizontal"?0:270,f.constraints=ej.datavisualization.Diagram.NodeConstraints.Default&~(ej.datavisualization.Diagram.NodeConstraints.Select|ej.datavisualization.Diagram.NodeConstraints.Connect),f.isPhase=!0,f._type="node",this.add(f,{entryHistory:!0}),o.children.pop(f),o.children.splice(r,0,f))},_getFirstLane:function(n){var t,i,r;return(n.children[2]&&(t=this.nameTable[this._getChild(n.children[2])]),t&&t.children&&t.children.length>0&&(i=this.nameTable[this._getChild(t.children[0])],i&&i.children&&i.children.length>0&&(r=this.nameTable[this._getChild(i.children[0])],r)))?r:null},updateSelector:function(n){if(this._selectedItem!=""){var t={};n.offsetX&&(t.offsetX=Number(typeof n.offsetX=="function"?n.offsetX():n.offsetX));n.offsetY&&(t.offsetY=Number(typeof n.offsetY=="function"?n.offsetY():n.offsetY));n.width&&(t.width=Number(typeof n.width=="function"?n.width():n.width));n.height&&(t.height=Number(typeof n.height=="function"?n.height():n.height));n.rotateAngle&&(t.rotateAngle=Number(typeof n.rotateAngle=="function"?n.rotateAngle():n.rotateAngle));this.updateNode(this._selectedItem,t)}n.userHandles&&(this.model.selectedItems.userHandles=n.userHandles,this._initHandles(),this.selectionList[0]&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,this.selectionList[0].type=="pseudoGroup",!1,this._currZoom,this));n.tooltip&&(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.selectedItems.tooltip,{},n.tooltip)))},_updateSelectorObject:function(n){var i,t;if(n.segments||(this._selectorOffsetX(n.offsetX),this._selectorOffsetY(n.offsetY),this._selectorWidth(n.width),this._selectorHeight(n.height),this._selectorRotateAngle(n.rotateAngle),this._selectedItem=n.name),n.type=="pseudoGroup")for(i=0;i<n.children.length;i++)t=n.children[i],typeof t=="object"?this.model.selectedItems.children.indexOf(t)<0&&this.model.selectedItems.children.push(t):typeof t=="string"&&this.model.selectedItems.children.indexOf(this.nameTable[this._getChild(t)])<0&&this.model.selectedItems.children.push(this.nameTable[this._getChild(t)]);else this.model.selectedItems.children.indexOf(n)<0&&this.model.selectedItems.children.push(n)},_clearSelectorObject:function(){this._selectorOffsetX(0);this._selectorOffsetY(0);this._selectorWidth(0);this._selectorHeight(0);this._selectorRotateAngle(0);this._selectedItem="";this.model.selectedItems.children=[]},_raiseEvent:function(n,t){if(this.model[n])return t.elementType=this.getObjectType(t.element),((n==="nodeCollectionChange"||n==="connectorCollectionChange"||n==="selectionChange")&&t.state==="changing"||n==="scrollChange")&&(t.cause=this._eventCause[n]?this._eventCause[n]:"unknown"),this._multipleAction||(this._eventCause={}),t.diagramId=this.element[0].id,this._trigger(n,t)},_clearSelection:function(n){if(this._hasSelection()){this._isEditing&&this.selectionList.length>0&&!this._isDragg&&this._endEdit();var t={changeType:"remove",state:"changing",element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1};this._selectedSymbol||n||(this._raiseEvent("selectionChange",t),this._previousSelectedItems=[]);t.cancel||(this._clearSelectorObject(),this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.selectionList[0]),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[this.selectionList[0].name]),ej.datavisualization.Diagram.Util.clear(this.selectionList),ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),this._selectedSymbol||n||(t={changeType:"remove",state:"changed",cause:t.cause,element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1},this._raiseEvent("selectionChange",t)))}},_updateSelectionHandle:function(n){var t,i,u,r;this.selectionList.length>0&&(t=this.selectionList[0]._type=="label"?this.selectionList[0]:this.nameTable[this.selectionList[0].name],i=this.model.selectedItems.constraints,n&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&(i=i&~ej.datavisualization.Diagram.SelectorConstraints.UserHandles),this.selectionList[0]._type!=="label"&&this._updateSelectorObject(t),u=ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,i,this.activeTool._resizeDirection,n),u||this.model.selectedItems.userHandles!=null&&this.model.selectedItems.userHandles.length>0&&(r=!1,t.type=="pseudoGroup"&&(r=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,t,this._adornerSvg,r,n,this._currZoom,this)))},_hasSelection:function(){return this.selectionList.length>0},_canActivateLabelTool:function(n,t){var i,f,e,r,o,s,u;if(t){if(i=this._findLabelAtPoint(this._mousePosition(n),t),i==null&&(f="",r=n.target,this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg&&(o=$(n.target).parents(".ej-d-label"),o[0]&&(r=o[0])),r&&(f=r.getAttribute("class"),f=="ej-d-label")))for(s=r.id.split("_"),u=0;u<t.labels.length;u++)e=t.labels[u].name.split("_"),s[s.length-1]==e[e.length-1]&&(i=t.labels[u]);if(i)return ej.datavisualization.Diagram.Util.canMoveLabel(t)?1:ej.datavisualization.Diagram.Util.canSelect(i)||ej.datavisualization.Diagram.Util.canMove(i)||ej.datavisualization.Diagram.Util.canResize(i)||ej.datavisualization.Diagram.Util.canRotate(i)}return!1},_checkToolToActivate:function(n,t){var i=!1,s=!1,r,h,u,f,o,e,c,l;return r=ej.datavisualization.Diagram.Util._getPseudoGroupConstraints(this,t,this.selectionList[0]),t?((t.segments&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.shiftKey||(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.altKey)&&(this._toolToActivate="endPoint",this._currentCursor="move",i=!0),i||(n.target&&n.target.getAttribute("class")!="ej-d-port"&&this._selectionContains(t)?(t.segments?i=this._canActivateEndPointTool(n,t):((!r||r&ej.datavisualization.Diagram.NodeConstraints.Resize)&&(i=this._canActivateResizeTool(n,t)),i||(!r||r&ej.datavisualization.Diagram.NodeConstraints.Rotate)&&(i=this._canActivateRotateTool(n,t))),i||(i=this._canActivateUserHandle(n,t)),i||(!r||r&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(t&&t.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(t)?(this._toolToActivate="select",this._currentCursor="default"):n&&n.target&&this._canActivateLabelTool(n,t)&&(n.target.getAttribute("class")==="ej-d-label"||n.target.parentNode.getAttribute("class")==="ej-d-label"||this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg)?s=!0:i=this._canActivateMoveTool(n,t)),i||(i=this._canActivatephaseTool(n))):(n&&n.target&&n.target.classList&&n.target.classList.contains("ej-d-port")&&(h=this._mousePosition(n),u=this._findPortAtPoint(h,t),u&&(f=this._getvalues(n),o=this._getSetTool(),o&&o(f,u),(o&&f.action==="draw"||f.action!="drag"&&u.constraints&ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag&&ej.datavisualization.Diagram.PortConstraints.Connect&&(u.visibility&ej.datavisualization.Diagram.PortVisibility.Visible||u.visibility&ej.datavisualization.Diagram.PortVisibility.Hover))&&(this._currentCursor="crosshair",e=this.model.drawType,c=e.segments&&e.segments.length&&e.segments[0].type?e.segments[0].type:"orthogonal",c==="orthogonal"?this.activateTool("orthogonalLine",!0):this.activateTool("straightLine",!0),this._activatedFromPort=!0,i=!0))),n&&this._canActivateLabelTool(n,t)&&n.target&&(n.target.getAttribute("class")==="ej-d-label"||n.target.parentNode.getAttribute("class")==="ej-d-label"||this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg)?s=!0:(!r||r&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(i=this._canActivateMoveTool(n,t))))):i=this._canActivatephaseTool(n),u&&f.action==="drag"&&(this._currentCursor="pointer",this._toolToActivate="portTool"),s&&(this._currentCursor="pointer",this._toolToActivate="labelMove",i=!0),i||(this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&(l=this._findNodeUnderMouse(n),l&&(this._toolToActivate="select",this._currentCursor="default",i=!0)),i||(this._toolToActivate="panTool",this._currentCursor="pointer")):(this._toolToActivate="select",this._currentCursor="default")),this._toolToActivate!="rotate"&&this._toolToActivate!="labelRotate"&&this._adornerSvg.document.removeAttribute("class"),i},_canActivatephaseTool:function(n){if($(n.target).parents(".ej-d-seperator").first()[0]){var r=$(n.target).parents("g").first()[0].id,t=this._getSeperetor(r.split("_phase_g")[0]),i=this.nameTable[t.parent.split("phaseStack")[0]];if(i&&ej.datavisualization.Diagram.Util.canResize(i))return this._currentCursor=t?t.orientation=="horizontal"?"e-resize":"n-resize":"default",this._toolToActivate="phase",!0}},_canActivateUserHandle:function(n){if(this._isUserHandle(n)&&n.target){var t=n.target.id.split("_")[0];return this._toolToActivate=t,this._currentCursor=this.tools[this._toolToActivate].cursor,!0}return!1},_canActivateEndPointTool:function(n,t){if(t){var i=n.target.getAttribute("class");if(i&&(i==="targetEndPoint"&&ej.datavisualization.Diagram.Util.canDragTargetEnd(t)||i==="sourceEndPoint"&&ej.datavisualization.Diagram.Util.canDragSourceEnd(t)||(i.match("bezierpoint")||i=="segmentEnd")&&ej.datavisualization.Diagram.Util.canDragSegmentThumbs(t)))return this._toolToActivate="endPoint",this._currentCursor="move",!0}return!1},_canActivateResizeTool:function(n,t){var i=n.target.getAttribute("class"),r;return ej.datavisualization.Diagram.Util.canResize(t,i)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Resizer&&(i==="nw-resize"||i==="n-resize"||i==="ne-resize"||i==="w-resize"||i==="e-resize"||i==="sw-resize"||i==="s-resize"||i==="se-resize")?(t._type!=="label"?(this._toolToActivate="resize",r=t.rotateAngle):(this._toolToActivate="labelResize",r=this._findLabelRotateAngle(t)),r>=0&&r<25||r>=160&&r<=205||r>=340&&r<=360?this._currentCursor=i:r>=25&&r<=70||r>=205&&r<=250?this._currentCursor=i==="n-resize"||i==="s-resize"?"ne-resize":i==="nw-resize"||i==="se-resize"?"n-resize":i==="e-resize"||i==="w-resize"?"nw-resize":"e-resize":r>=70&&r<=115||r>=250&&r<=295?this._currentCursor=i==="n-resize"||i==="s-resize"?"e-resize":i==="nw-resize"||i==="se-resize"?"ne-resize":i==="e-resize"||i==="w-resize"?"n-resize":"nw-resize":(r>=115&&r<=155||r>=295&&r<=340)&&(this._currentCursor=i==="n-resize"||i==="s-resize"?"nw-resize":i==="nw-resize"||i==="se-resize"?"e-resize":i==="e-resize"||i==="w-resize"?"ne-resize":"n-resize"),!0):!1},_canActivateMoveTool:function(n,t){var r,u,e,f,i;return(n.target&&(r=n.target.className),u=r&&ej.datavisualization.Diagram.Util.isClassifier(n)?ej.datavisualization.Diagram.ClassifierHelper.getMovableElementUnderMouse(n,this):r&&r.animVal==="ej-d-multiselector"&&t&&t.type=="pseudoGroup"&&ej.datavisualization.Diagram.Util.canDragHelper(this)?this.selectionList[0]:this._findNodeUnderMouse(n),u&&u.name===t.name&&(e=!0,t.parent&&(e=this.selectionList.length>0&&this._selectionContains(t)?!0:!1),f=!1,t.parent&&(i=this.nameTable[t.parent],i&&((i.isSwimlane||i.isLane)&&ej.datavisualization.Diagram.Util.canMove(i)||i.isPhaseStack)&&(f=!0)),ej.datavisualization.Diagram.Util.canMove(t)||f))?(this._toolToActivate="move",this._currentCursor=this._isHyperLink(n)?"pointer":this.selectionList.length>0&&(this._selectionContains(t)||this.selectionList[0].children&&this._findChildren(this.selectionList[0],t.name))?"move":"default",!0):!1},_isLabelTemplate:function(n){var f,i,r,t,u;if(n&&(f=$(n.target).parents(".ej-label-template"),i=f[0],i)){if(r=i.parentNode.id.split("_"),r[r.length-1]=="lblbg")return!0;for(t=n.target.parentNode,u=t.getAttribute("class");t;){if(u==="ej-label-template")return!0;t=t.parentNode;u=t.getAttribute("class")}}},_isHyperLink:function(n){var t=n.target,i=t.getAttribute("class");return(!i||!i=="ej-d-label")&&t.parentNode&&$(t.parentNode).hasClass("ej-d-label")&&(t=t.parentNode,$(t.parentNode).hasClass("ej-d-anchor"))?!0:!1},_canActivateRotateTool:function(n,t){if(ej.datavisualization.Diagram.Util.canRotate(t)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Rotator){var i=n.target.getAttribute("class");if(i==="rotateHandle")return this._toolToActivate=t._type!=="label"?"rotate":"labelRotate",ej.browserInfo().name==="msie"?(this._currentcursor="default",this._adornerSvg.document.setAttribute("class","svg-rotate-ie"),this._currentCursor=""):(this._adornerSvg.document.setAttribute("class","svg-rotate"),this._currentCursor=""),!0}return!1},_canActivatePivotTool:function(n){var t=n.target.getAttribute("class");return t==="pivot"?(this._toolToActivate="pivot",this._currentCursor="default",!0):!1},_updateCursor:function(){this._isInit||(this.element[0].style.cursor=this._currentCursor,this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0].style.cursor=this._currentCursor)},_getResizeCursor:function(n){var t="default";switch(n){case"topleft":t="nw-resize";break;case"topcenter":t="n-resize";break;case"topright":t="ne-resize";break;case"middleleft":t="w-resize";break;case"middleright":t="e-resize";break;case"bottomleft":t="sw-resize";break;case"bottomcenter":t="s-resize";break;case"bottomright":t="se-resize"}return t},_startEdit:function(n){var i,f,e,r,s,t,u,v=ej.Matrix.identity(),l=n.width?n.width:n._width,a=n.height?n.height:n._height,y,w,b,o,c,p,h;ej.Matrix.rotate(v,n.rotateAngle,l/2,a/2);n.type==="text"?(r=this._svg.getElementById(n.name+"_shape")!==null?this._svg.getElementById(n.name+"_shape").getBBox():{x:n.offsetX-l*n.pivot.x,y:n.offsetY-a*n.pivot.y,width:l,height:a},i=n.textBlock,i&&!i.readOnly&&(s=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(r.x-i.fontSize,r.y-i.fontSize,r.width+i.fontSize/2,r.height+i.fontSize/2),u=this._currZoom,h=ej.Matrix.transform(v,ej.datavisualization.Diagram.Util._getLabelPosition(i,s)),f=n.offsetX-l*n.pivot.x+h.x,e=n.offsetY-a*n.pivot.y+h.y,i.horizontalAlignment=="left"?f+=r.width/2:i.horizontalAlignment=="right"&&(f-=r.width/2),i.verticalAlignment=="top"?e+=r.height/2:i.verticalAlignment=="bottom"&&(e-=r.height/2),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),t.width=r.width==0?50:s.width*u,t.x=f*u-t.width/2*u-this._hScrollOffset,t.height=i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.width=50,t.height=i.fontSize,t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0)):(n.labels.length>0?(i=this.activeTool.getLabelUnderMouse(),i||(i=n.labels[0])):(this._newLabelCreated=!0,y=this._findNode(n.name),i=new ej.datavisualization.Diagram.Label({name:"label"+ej.datavisualization.Diagram.Util.randomId()}),i._parent=n.name,n.labels.push(i),w=y!==n?y:null,ej.datavisualization.Diagram.DiagramContext.addNodeLabel(n,i,w,this),this.activeTool.name==="textTool"&&(this.activateTool.activeLabel=i)),i&&!i.readOnly&&i.hyperlink===""&&i.templateId===""&&(this.model.labelRenderingMode!=="svg"?(b=this._htmlLayer?this._htmlLayer:this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],o=$(b).find("#"+n.name+"_"+i.name)[0]):o=this._svg.document.getElementById(n.name+"_"+i.name),o?(s=ej.datavisualization.Diagram.Util.bounds(n),this.model.labelRenderingMode!=="svg"?(t=new ej.datavisualization.Diagram.Rectangle(o.offsetLeft,o.offsetTop,o.offsetWidth,o.offsetHeight),r=t):(r=o.getBBox(),t=new ej.datavisualization.Diagram.Rectangle(0,0,r.width,r.height)),u=this.model.labelRenderingMode!="svg"?this._currZoom:1,c=ej.datavisualization.Diagram.Util._getLabelPosition(i,s),n.segments||i.relativeMode=="segmentpath"?(t=o.getBoundingClientRect(),t={x:t.left,y:t.top,width:t.width,height:t.height},p=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),f=(t.x+t.width/2-p.left+this._hScrollOffset)/u,e=(t.y+t.height/2-p.top+this._vScrollOffset)/u):(i.horizontalAlignment=="left"?c.x+=r.width/2:i.horizontalAlignment=="right"&&(c.x-=r.width/2),i.verticalAlignment=="top"?c.y+=r.height/2:i.verticalAlignment=="bottom"&&(c.y-=r.height/2),h=ej.Matrix.transform(v,c),f=n.offsetX-l*n.pivot.x+h.x,e=n.offsetY-a*n.pivot.y+h.y),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),n.segments?(t.width=r.width<50?50:s.width,t.x=f*u-t.width/2-this._hScrollOffset):(t.width=r.width<50?50:s.width,t.x=f*u-t.width/2-this._hScrollOffset),t.height=n.type=="umlclassifier"?n.height:i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0):this.activeTool.selectedObject=null))},_hideShowSVGLabels:function(n,t,i){if(this._svg&&t){var r;r=t.type==="text"?this._svg.document.getElementById(t.name+"_shape_lblbg"):this._svg.document.getElementById(t.name+"_"+n.name);r&&r.setAttribute("visibility",i&&(n.visible||t.visible)?"visible":"hidden");r=this._svg.document.getElementById(t.name+"_"+n.name+"_lblbg");r&&r.setAttribute("visibility",i&&n.visible?"visible":"hidden")}},_createEditBox:function(n,t,i,r,u,f){var c,a,l,s,h,e,o;this._svg&&(this.model.labelRenderingMode==ej.datavisualization.Diagram.LabelRenderingMode.Svg?this._hideShowSVGLabels(n,f):(c=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],c&&(a=f.type==="text"?$(c).find("#"+f.name+"_shape_lblbg")[0]:$(c).find("#"+f.name+"_"+n.name+"_lblbg")[0],a&&(a.style.display="none"))),l=ej.datavisualization.Diagram.Util.bounds(f),s=document.createElement("div"),n.horizontalAlignment=="stretch"&&n.textOverflow&&n.rotateAngle==0&&f.isSwimlane?i=i-n.fontSize:n.horizontalAlignment=="stretch"&&!f.isSwimlane&&f._isHeader&&n.textOverflow&&n.rotateAngle!=0&&(t=-t-n.fontSize-r/4),h={id:this.element[0].id+"_editBoxDiv","class":"edit",style:"top:"+i+"px;left:"+t+"px;width:"+r+"px;font-family:"+n.fontFamily+";font-size:"+n.fontSize+"px;min-width: 50px;min-height:"+n.fontSize+"px;"},ej.datavisualization.Diagram.Util.canZoomTextEditor(this)&&(h.style+="transform: scale("+this._currZoom+");"),ej.datavisualization.Diagram.Util.attr(s,h),e=document.createElement("textarea"),o=n.fontColor?n.fontColor.toLowerCase():"black",o=o!="white"&&o!="ffffff"&&o!="rgb(255,255,255)"?o:"black",h={id:this.element[0].id+"_editBox","class":"editBox",style:"font-size:"+n.fontSize+"px;font-family:"+n.fontFamily+";min-height:"+n.fontSize+"px; height: "+u+"px; line-height: normal; color:"+o+";font-weight:"+(n.bold?"bold":"normal")+";font-style:"+(n.italic?"italic":"normal")+";text-decoration:"+n.textDecoration,nodeWidth:l.width,nodeHeight:l.height,fontSize:n.fontSize,nodeOffsetX:f.offsetX,nodeOffsetY:f.offsetY,containerName:f.name},ej.datavisualization.Diagram.Util.attr(e,h),e.value=n.text,s.appendChild(e),$(this._canvas).append(s),n.text!==""&&this._updateEditor(null,s,e,l.width,n.fontSize,n,f),this._on($(e),"focusout",this._editboxfocusout),this._on($(e),"keyup",this._editBoxKeyUp),this._on($(e),"input",this._editBoxTextChange),this._on($(e),"focusin",this._editboxfocusin),e.focus())},_editBoxKeyUp:function(n){this._updateLabelPosition(n)},_editBoxTextChange:function(n){this._updateLabelPosition(n)},_updateEditBox:function(n,t){var i=document.getElementById(this.element[0].id+"_editBoxDiv");i&&(i.style.left=i.offsetLeft-n+"px",i.style.top=i.offsetTop-t+"px")},_editboxfocusout:function(){this._endEditing=!0;this._endEdit();delete this._endEditing},_editboxfocusin:function(n){n.target.select();this._raiseEvent("editorFocusChange",n)},_updateLabelPosition:function(n){var t=50,o=this._currZoom,r=this._boundingBox,e=Number(n.target.getAttribute("fontSize")),f=Number(n.target.getAttribute("nodeWidth")),s=r.x+r.width/2,l=r.y+r.height/2,i=this._textLength(n),u,h,c;i.width===0?(u=r.width<t?t:r.width,n.target.parentNode.style.width=u+"px",n.target.parentNode.style.left=s-u/2-e/4+"px"):(u=i.width<=f*o?i.width<t?t:i.width:i.width>=f*o?i.width>t?i.width:t:f<t?t:f*o,n.target.parentNode.style.width=u+"px",n.target.parentNode.style.left=s-u/2+"px");i.height===0?(n.target.style.height=e+"px",n.target.parentNode.style.top=l-e/2+"px"):this._selectedItem&&(h=this.nameTable[this._selectedItem],h.type==="text"&&(c=this._currentLabel));this._updateEditor(n,n.target.parentNode,n.target,f,e,c)},_updateEditor:function(n,t,i,r,u,f,e){var y,p,o,s=this._textLength(n,f),h=this.model.labelRenderingMode!="svg"||e&&e.type==="text"?this._currZoom:1,nt=50,k=this._boundingBox.x,tt=this._boundingBox.y,d=this._boundingBox.width,g=this._boundingBox.height,ut=i.value,ft=ut.split("\n"),c,w,b,l,v;e||(e=this.activeTool.selectedObject);e&&e.parent&&(c=this.nameTable[e.parent]);this._nodeUnderMouse&&(this.old=this._nodeUnderMouse,w=this._nodeUnderMouse.name.match("_attribute")?"attribute":this._nodeUnderMouse.name.match("_method")?"method":this._nodeUnderMouse.name.match("_member")?"member":this._nodeUnderMouse.name.match("_header_classifier")?"header":"null");this.old&&(w=this.old.name.match("_attribute")?"attribute":this.old.name.match("_method")?"method":this.old.name.match("_member")?"member":this.old.name.match("_header_classifier")?"header":"null");b=w&&w!="null"?s.width>r?s.width:r:r<s.width?r:s.width;this._browserInfo.name==="mozilla"&&(b+=2);l=b<nt?nt:b;t.style.width=l+"px";y=n?(l-d)/2:(l-d*h)/2;t.style.left=c&&c.isLane&&f&&f.horizontalAlignment=="stretch"&&f.textOverflow&&f.rotateAngle!=0?k-y-u-d/4+"px":k-y-u/4+"px";ft.length>1||s.width!=r?(e&&e.type!="umlclassifier"&&(i.style.height="0"),o=this._browserInfo.name==="mozilla"?i.scrollHeight-5:i.scrollHeight-4):o=u;var it=$(i).offset(),rt=$(this._canvas).offset(),a=$(this._canvas).height();a||(a=this._getCanvasHeight(this._canvas,a));it.top-rt.top+Number(o)>a&&(o=o-(it.top-rt.top+Number(o)-a),o=this._browserInfo.name==="mozilla"?o-7:o-6);i.style.height=o+"px";v=0;n?(p=(o-g)/2,v=tt-p*h):(p=c&&c.isSwimlane&&f&&f.horizontalAlignment=="stretch"&&f.textOverflow&&f.rotateAngle==0?(o-g*h)/2+f.fontSize:(o-g*h)/2,v=tt-p-3*h);t.style.top=v+"px";this._boundingBox=new ej.datavisualization.Diagram.Rectangle(k-y,v,l,o)},_getCanvasHeight:function(n,t){for(var r=t,i=n;r<=0;)i=i.parentNode,i&&(r=$(i).height());return r},_textLength:function(n,t){var i=document.createElement("div"),r=document.getElementById(this.element[0].id+"_editBox"),u={id:this.element[0].id+"_editBoxHiddenDiv",style:"position : absolute; width : auto; height : auto;font-size:"+r.style.fontSize+"px;font-family:"+r.style.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"},f;return t&&(u.style="position : absolute; width : auto; height : auto;font-weight:"+(t.bold?"bold":"normal")+";font-style:"+(t.italic?"italic":"normal")+";text-decoration:"+t.textDecoration+";font-size:"+t.fontSize+"px;font-family:"+t.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"),ej.datavisualization.Diagram.Util.attr(i,u),n?i.appendChild(document.createTextNode(n.target.value)):i.appendChild(document.createTextNode(r.value)),document.body.appendChild(i),f=i.getBoundingClientRect(),document.body.removeChild(i),f},_endEdit:function(n){var k,e,w,b,r=document.getElementById(this.element[0].id+"_editBox"),t,o,c,i,u,d,g,l,f,s,h,a,v,y,p;if(r){if(t=this._findNode(r.getAttribute("containerName")),this.activeTool.name==="textTool")t=this.activeTool.selectedObject;else if(!t)for(o=0;o<this.selectionList.length;o++)c=this.selectionList[o],typeof c.labels.length!="undefined"&&c.labels.length>0&&c.labels[0].mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&(t=this.selectionList[o]);t&&(this._isEditing=!1,t.type=="text"?i=t.textBlock:(i=this.activeTool.getLabelUnderMouse(),i||(i=t.labels[0])),t.type=="umlclassifier"&&(r.value=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(r.value,t,this)),i&&(u=i.text),t._type!="node"||t.width&&t.height||!this.nameTable[t.name]||(w=t._width,b=t._height,t.labels[0].text=r.value,this._getNodeDimension(t)),t.type=="umlclassifier"&&(t=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(t,this)),n&&(d=n.keyDownEventArgs.keyCode===27?"ESC":String.fromCharCode(n.keyDownEventArgs.keyCode)),r.value!=u&&(k=this._raiseEvent("textChange",{element:this.getNode(t),label:i,value:r.value,keyCode:d})),k?(t._width&&w&&(t._width=w),t._height&&b&&(t._height=b),t&&t.type==="text"?ej.datavisualization.Diagram.DiagramContext.update(t,this):(i=this.activeTool.activeLabel?this.activeTool.activeLabel:t.labels.length>0?t.labels[0]:null,i!=undefined&&(i.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,i,this))),this.activeTool&&(this.activeTool.activeLabel=null,this.activeTool.selectedObject=null)):(t&&t.type!==undefined&&t.type==="text"?(g=u,t.textBlock.text=r.value,t.textBlock.mode=ej.datavisualization.Diagram.LabelEditMode.View,this._findNode(t.name)?(ej.datavisualization.Diagram.DiagramContext.update(t,this),e={type:"labelchanged",shape:t,previousLabelValue:g,updatedLabelValue:r.value,category:"internal"},this.addHistoryEntry(e)):(r.value!==""&&(l=Number(r.style.height.substring(0,r.style.height.length-2)),t.height<l&&(t.offsetY=t.offsetY-t.height/2+l/2,t.height=l),this.selectionList.length>0&&this._clearSelection(!0),this.tools.move._outOfBoundsDrag(t)&&(this.add(t),f=this.nameTable[t.parent],f&&f.isLane&&(s=this._moveOnLane(t,f),s.proceedX||this.updateNode(t.name,{offsetX:t.offsetX+s.x}),s.proceedY||this.updateNode(t.name,{offsetY:t.offsetY+s.y}),this._updateNodeMargin(t),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,f),f.isLane&&(h=this._getSwimlane(f),h&&(this._updateChildAdjacentConnectors(h,!0),delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,h),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,h)))))),this.activeTool.selectedObject=null)):t==undefined||t.type=="pseudoGroup"||(i!=undefined?(this._comparePropertyValues(i,"text",{text:r.value}),u=u?u:i.text,u!=r.value&&(this._newLabelCreated?(i.text=r.value,e={type:"labelcollectionchanged",shape:t,label:i,isUndo:!0,category:"internal"}):e={type:"labelchanged",shape:t,previousLabelValue:i.text,updatedLabelValue:r.value,index:t.labels.indexOf(i),category:"internal"},this.addHistoryEntry(e)),i.text=r.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,i,this),t.isPhase&&(t.name.split("phaseStack")[1]&&(a=this.nameTable[t.name.split("phaseStack")[1]]),a&&a.label&&(a.label.text=r.value)),this.activeTool.selectedObject=null):t.labels.length==0&&(i=ej.datavisualization.Diagram.Label(),i.text=r.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,i._parent=t.name,t.labels.push(i),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(t,i,null,this)),this.activeTool.activeLabel&&(this.activeTool.activeLabel=null)),t.shape&&t.shape.type=="umlclassifier"&&(t=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(t,r.value,i)),t._type!="node"||t.width&&t.height||!this.nameTable[t.name]||(ej.datavisualization.Diagram.DiagramContext.update(t,this),t.parent&&ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[t.parent],this)),t.type=="umlclassifier"&&(t.labels[0].text="",ej.datavisualization.Diagram.DiagramContext.update(t,this)),t.shape&&t.shape.type=="umlclassifier"&&ej.datavisualization.Diagram.DiagramContext.update(t,this)));this._off($(r),"focusout",this._editboxfocusout);this._off($(r),"keyup",this._editBoxKeyUp);this._off($(r),"input",this._editBoxTextChange);v=$("#"+this.element[0].id+"_editBoxDiv")[0];v&&v.parentNode.removeChild(v);this._svg&&(this.model.labelRenderingMode==ej.datavisualization.Diagram.LabelRenderingMode.Svg?this._hideShowSVGLabels(i,t,!0):(y=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],y&&(t.type==="text"?p=$(y).find("#"+t.name+"_shape_lblbg")[0]:i&&(p=$(y).find("#"+t.name+"_"+i.name+"_lblbg")[0]),p&&(p.style.display="block"))),t&&this._updateQuad(t))}n&&n.keyDownEventArgs&&n.keyDownEventArgs.keyCode===27&&this.element[0].focus();delete this._newLabelCreated},_getSwimlane:function(n){var i,t;return n=typeof n=="string"?this.nameTable[n]:n,t=this.nameTable[n.parent],t&&(i=this.nameTable[t.parent]),i},_setLabelEditing:function(n){var t;if(n)return n.readOnly?(n.mode=ej.datavisualization.Diagram.LabelEditMode.View,t=!1):(this._currentLabel&&(this._currentLabel.mode=ej.datavisualization.Diagram.LabelEditMode.View),n.mode=ej.datavisualization.Diagram.LabelEditMode.Edit,this._currentLabel=n,t=!0),t},_isInternalTool:function(n){return n instanceof ej.datavisualization.Diagram.SelectTool||n instanceof ej.datavisualization.Diagram.ConnectionEditTool||n instanceof ej.datavisualization.Diagram.MoveTool||n instanceof ej.datavisualization.Diagram.ResizeTool||n instanceof ej.datavisualization.Diagram.LabelMoveTool||n instanceof ej.datavisualization.Diagram.LabelResizeTool||n instanceof ej.datavisualization.Diagram.LabelRotateTool||n instanceof ej.datavisualization.Diagram.PhaseTool||n instanceof ej.datavisualization.Diagram.RotateTool||n instanceof ej.datavisualization.Diagram.PanTool&&this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?!0:!1},_updateNodeMargin:function(n){var t,s,h,r,u,c,o;if(n.parent!=""&&(t=this.nameTable[n.parent],t&&t.container&&t.container.type=="canvas")){var f=ej.datavisualization.Diagram.Util.bounds(t),e=ej.datavisualization.Diagram.Util.bounds(n),i=ej.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);n.marginLeft=i.x-(f.x+t.paddingLeft);s=f.x+t.width-(i.x+i.width)-t.paddingRight;n.marginRight=s<0?0:s;n.marginTop=i.y-(f.y+t.paddingTop);h=f.y+t.height-(i.y+i.height)-t.paddingBottom;n.marginBottom=h<0?0:h;t.isLane&&(r=0,u=0,t.orientation==="horizontal"?(r=50,u=0):(r=0,u=50),n.marginLeft=n.marginLeft>=r?n.marginLeft:r,n.marginTop=n.marginTop>=u?n.marginTop:u)}if((n.type=="pseudoGroup"||n.name=="multipleSelection")&&n.children.length>0)for(o=0;o<n.children.length;o++)c=this.nameTable[this._getChild(n.children[o])],c&&this._updateNodeMargin(c)},_raisePropertyChange:function(n){n&&(this._isSizingCommand?n.cause=ej.datavisualization.Diagram.ActionType.Size:this._isUndo?n.cause=ej.datavisualization.Diagram.ActionType.HistoryChange:this._isTouchedEvent&&(n.cause=ej.datavisualization.Diagram.ActionType.Touch),this._raiseEvent("propertyChange",n))},_updateAdjacentEdges:function(n,t){var i,r;if(n.inEdges&&n.inEdges.length>0)for(i=0,r=n.inEdges.length;i<r;i++)t[n.inEdges[i]]=this.nameTable[n.inEdges[i]];if(n.outEdges&&n.outEdges.length>0)for(i=0,r=n.outEdges.length;i<r;i++)t[n.outEdges[i]]=this.nameTable[n.outEdges[i]]},_translate:function(n,t,i,r,u,f){var h,f,s,o,e;if(t||i)if(n.segments)ej.datavisualization.Diagram.Util._translateLine(n,t,i,n),this._dock(n,r),ej.datavisualization.Diagram.Util.updateBridging(n,this),this._updateConnectorBridging(n);else{if(f||(h=!0),f=f||{},this._updateAdjacentEdges(n,f),n.offsetX+=t,n.offsetY+=i,this._parentNode||this.activeTool.name=="phase"||(this._parentNode=n),(n._type==="group"||n.type==="pseudoGroup")&&!u){for(s=this._getChildren(n.children),o=0;o<s.length;o++)e=r[this._getChild(s[o])],e&&(this._translate(e,t,i,r,undefined,f),e.parent&&e.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(r[e.parent],this));n.type!="group"&&n.container&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this);this._isUndo||this._updateNodeFromGraph(n)}if(n!=this.activeTool.helper&&(this.nameTable[n.name]&&this._updateQuad(n),ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(n,t,i,null,this),this._isUndo||this._updateNodeFromGraph(n)),this._parentNode==n&&delete this._parentNode,h&&!this._preventDocking&&n!=this.activeTool.helper&&!this._disableSegmentChange)for(o in f)e=this.nameTable[o],e&&((n.isSwimlane||(n.type=="pseudoGroup"||n.type=="group")&&!this._containsChild(n,e))&&ej.datavisualization.Diagram.Util._translateLine(e,t,i,e),this._dock(e,this.nameTable),this._isLayoutRoute&&this._routeEdge(e),e.annotation&&ej.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(e,this))}else return!1},_containsChild:function(n,t){var i,r,f,u;if(n.children&&n.children.length>0)for(i=this._getChildren(n.children),r=0;r<i.length;r++){if(f=this._collectionContains(t.name,i),f)return!0;u=this._getChild(i[r]);u&&u.children&&this._containsChild(u,t)}},_translatePort:function(n,t,i,r){t.offset.x=t.offset.x+i/n.width;t.offset.y=t.offset.y+r/n.height;ej.datavisualization.Diagram.DiagramContext.updatePort(n,t,this);var u=this._adornerSvg;this._updateAssociatedConnectorEnds(n,this.nameTable,!0)},_translateLabel:function(n,t,i,r){var u=!1,f;n&&n.segments&&t.relativeMode==="segmentpath"&&ej.datavisualization.Diagram.Util.isAllowDragLimit(n)&&(u=!0);u||(f=$.extend(!0,{},t),t.margin.left+=i,t.margin.top+=r,t.margin.right-=i,t.margin.bottom-=r,t.horizontalAlignment=="center"&&(t.margin.right=0),t.verticalAlignment=="center"&&(t.margin.bottom=0),ej.datavisualization.Diagram.DiagramContext.updateLabel(n,t,this),this._comparePropertyValues(n,"labels",f))},translateLabel:function(n,t,i,r){var f,u;n&&(n.segments&&t.relativeMode==="segmentpath"&&!ej.datavisualization.Diagram.Util.isAllowDragLimit(n)?(f=$.extend(!0,{},t),t.margin.left+=i,t.margin.top+=r,t.margin.right-=i,t.margin.bottom-=r,t.horizontalAlignment=="center"&&(t.margin.right=0),t.verticalAlignment=="center"&&(t.margin.bottom=0),ej.datavisualization.Diagram.DiagramContext.updateLabel(n,t,this),this._comparePropertyValues(n,"labels",f)):(u=ej.datavisualization.Diagram.Util.bounds(n),t.offset.x+=i/u.width,t.offset.y+=r/u.height,ej.datavisualization.Diagram.DiagramContext.updateLabel(n,t,this)))},_rotate:function(n,t,i){var u,e,o,s,r,f,h;if(!n.segments&&t){if(n.rotateAngle+=t,n.rotateAngle%=360,n.rotateAngle<0&&(n.rotateAngle+=360),n._type==="group"||n.type==="pseudoGroup"){for(u=ej.Matrix.identity(),ej.Matrix.rotate(u,t,n.offsetX,n.offsetY),s=this._getChildren(n.children),f=0;f<s.length;f++)r=i[s[f]],r&&(r.segments?(r.sourceNode||this._setEndPoint(r,ej.Matrix.transform(u,r.sourcePoint),!1),r.targetNode||this._setEndPoint(r,ej.Matrix.transform(u,r.targetPoint),!0)):(this._rotate(r,t,i),e=r.offsetX,o=r.offsetY,h=ej.Matrix.transform(u,ej.datavisualization.Diagram.Point(e,o)),this._translate(r,h.x-e,h.y-o,i),this._updateAssociatedConnectorEnds(r,i)),r.parent&&r.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i[r.parent],this));ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}n.parent&&this._updateParentBounds(n.parent);n!=this.activeTool.helper&&this._updateQuad(n);this._updateAssociatedConnectorEnds(n,i)}},_raiseOffsetPropertyChange:function(n,t,i,r){n&&!n.segments?(t=t?t:0,i=i?i:0,t!=n.offsetX&&this._comparePropertyValues(n,"offsetX",{offsetX:t},r),i!=n.offsetY&&this._comparePropertyValues(n,"offsetY",{offsetY:i},r)):(t=t?t:0,i=i?i:0,this._comparePropertyValues(n,"sourcePoint",{sourcePoint:{x:n.sourcePoint.x+t,y:n.sourcePoint.y+i}},r),this._comparePropertyValues(n,"targetPoint",{targetPoint:{x:n.targetPoint.x+t,y:n.targetPoint.y+i}},r))},_raiseSizePropertyChange:function(n,t,i,r){if(n&&i&&t){var u=n.height*i,f=n.width*t;u!=n.height&&(this._comparePropertyValues(n,"height",{height:u},r),this._comparePropertyValues(n,"offsetY",{offsetY:n.offsetY+(u-n.height)},r));f!=n.width&&(this._comparePropertyValues(n,"width",{width:f},r),this._comparePropertyValues(n,"offsetX",{offsetX:n.offsetX+(f-n.width)/2},r))}},scale:function(n,t,i,r,u,f,e){var d,w,y,h,o,p,v,g,nt,s,b,k;if(t&&t!=1||i&&i!=1||n.isPhase)if(n.container)switch(n.container.type){case"canvas":v={};s=ej.Matrix.identity();ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);a=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));l=n.width*t;c=n.height*i;e&&(n.minHeight=c,n.minWidth=l);v.width=l;v.height=c;v&&v.width>1&&(g=n.offsetX-n.width/2,n.width!=v.width&&(n._scaled=!0),n.width=v.width,n.offsetX=n._isBpmn?a.x:g+n.width/2);v&&v.height>1&&(nt=n.offsetY-n.height/2,n.height!=v.height&&(n._scaled=!0),n.height=v.height,n.offsetY=n._isBpmn?a.y:nt+n.height/2);break;case"stack":s=ej.Matrix.identity();ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);a=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));b=0;k=0;t!=0&&(b=n.marginLeft,k=n.marginRight);l=n.width*t-(b+k);c=n.height*i-(n.marginTop+n.marginBottom);v={height:n.height,width:n.width};this._resizeStack&&(n.width=l,n.height=c,n.offsetX=a.x,n.offsetY=a.y)}else if(s=ej.Matrix.identity(),n.segments){for(ej.Matrix.scale(s,t,i,r.x,r.y),h=0;h<n.segments.length;h++){for(o=n.segments[h],p=0;p<o.points.length;p++)o.points[p]=ej.Matrix.transform(s,o.points[p]),h!=0||p!=0||n.sourceNode||(o._startPoint=o.points[0],o._endPoint=o.points[o.points.length-1],ej.datavisualization.Diagram.Util._setLineEndPoint(n,ej.Matrix.transform(s,n.sourcePoint),!1)),h!=n.segments.length-1||p!=o.points.length-1||n.targetNode||(o._startPoint=o.points[0],o._endPoint=o.points[o.points.length-1],n.targetPoint=o._endPoint);o._startPoint=o.points[0];o._endPoint=o.points[o.points.length-1];o.type=="orthogonal"?o.length||o.length===0?o.length=o._length=ej.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint):ej.datavisualization.Diagram.Util._addOrthogonalPoints(o,n.segments[h-1],n.segments[h+1],n.sourcePoint,n.targetPoint):(o.point&&(o.point=o._endPoint),o._point=o._endPoint)}(n.sourceNode||n.targetNode)&&this._dock(n,u)}else{if(n._type!=="group"&&n.type!=="pseudoGroup"||this._scalePseudoGroup){ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);var a=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),l=n.width*t,c=n.height*i;if(n.maxWidth!=0&&(l=Math.min(n.maxWidth,l)),n.minWidth!=0&&(l=Math.max(n.minWidth,l)),n.maxHeight!=0&&(c=Math.min(n.maxHeight,c)),n.minHeight!=0&&(c=Math.max(n.minHeight,c)),l>0&&(l!=n.width&&(n._scaled=!0),l!=n.maxWidth&&l!=n.minWidth))for(n.width=l,n.offsetX=a.x,h=0;h<n.labels.length;h++)n.labels[h].width=n.labels[h].width*t;if(c>0&&(c!=n.height&&(n._scaled=!0),c!=n.maxHeight&&c!=n.minHeight))for(n.height=c,n.offsetY=a.y,h=0;h<n.labels.length;h++)n.labels[h].height=n.labels[h].height*i}else if(n.type!="bpmn"||n.width*t>=1&&n.height*i>=1){for(d={x:n.offsetX,y:n.offsetY},w=this._getChildren(n.children),h=0;h<w.length;h++)y=u[w[h]],y&&(n.type!="bpmn"||ej.datavisualization.Diagram.Util.canResize(y))&&(this.scale(y,t,i,r,u),y.parent&&y.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(u[y.parent],this));if(n.type=="bpmn"&&ej.datavisualization.Diagram.Util._updateBPMNProperties(n,this,u,!0),n.children.length<=0){ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);var a=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),l=n.width?n.width*t:n._width*t,c=n.height?n.height*i:n._height*i;l>1&&(n.width?(l!=n.width&&(n._scaled=!0),n.width=l,n.offsetX=a.x):(l!=n._width&&(n._scaled=!0),n.maxWidth=n.parent&&u[n.parent].width!=n.maxWidth?u[n.parent].width:l,n.offsetX=a.x-(n._width*t-n._width)/2));c>1&&(n.height?(c!=n.height&&(n._scaled=!0),n.height=c,n.offsetY=a.y):(c!=n._height&&(n._scaled=!0),n.maxHeight=n.parent&&u[n.parent].height>c?u[n.parent].height:c,n.offsetY=a.y-(n._height*i-n._height)/2))}n.type==="pseudoGroup"?(this._scalePseudoGroup=!0,this.scale(n,t,i,r,u),delete this._scalePseudoGroup):ej.datavisualization.Diagram.Util._updateGroupBounds(n,this);n!=this.activeTool.helper&&ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(n,1/t,1/i,d,this)}n.parent&&this._updateParentBounds(n.parent);ej.datavisualization.Diagram.Util._updateBPMNProperties(n,this,u,!0);this.activeTool.name=="resize"&&this.activeTool.inAction&&this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&this.selectionList[0].type!="group"||this._updateAssociatedConnectorEnds(n,u);n!=this.activeTool.helper&&this._updateQuad(n)}},_updateParentBounds:function(n){n=this.nameTable[this._getChild(n)];n&&n.type!="bpmn"&&!n.container&&(ej.datavisualization.Diagram.Util._updateGroupBounds(n,this),ej.datavisualization.Diagram.DiagramContext.update(n,this),n.parent&&this._updateParentBounds(n.parent))},_dock:function(n,t,i){if(!this._preventDocking&&!this._disableSegmentChange&&(!this._layoutInAction||!this._isAnimating)){var r=n.segments.length,u=n.segments[0].points.length,f=n.segments[n.segments.length-1].points.length;this._preventSegmentAdjusting&&(n._preventSegmentAdjusting=!0);ej.datavisualization.Diagram.Util.dock(n,t,this);delete n._preventSegmentAdjusting;r!=n.segments.length&&this._svg&&(ej.datavisualization.Diagram.Util._updateConnectorSegments(n,n.sourcePort,n.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(n,this));this.selectionList[0]==n&&(i||u!=n.segments[0].points.length||f!=n.segments[n.segments.length-1].points.length)&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom);this._updateQuad(n)}},_updateChildAdjacentConnectors:function(n,t){var u=this._getChildTable(n,{}),r,i;for(r in u)i=this.nameTable[r],i&&i.segments&&n.children.indexOf(r)==-1&&(t||(i._staticLength=!0),this._dock(i,this.nameTable),delete i._staticLength,ej.datavisualization.Diagram.DiagramContext.update(i,this))},_setEndPoint:function(n,t,i){ej.datavisualization.Diagram.Util._setLineEndPoint(n,t,i);this._updateQuad(n)},_updateAssociatedConnectorEnds:function(n,t,i){var u,e,r,h,f,s,o;if(!n.segments&&(n.inEdges.length||n.outEdges.length)){for(h=this._isNodeToNodeConnection(n),f=n,n.type=="bpmn"&&n._type=="group"&&(f=typeof n.children[0]=="object"?n.children[0]:this.nameTable[n.children[0]]),h&&(s=ej.datavisualization.Diagram.Util._findSegmentPoints(f)),o={},this._parentNode&&(o=this._getChildTable(this._parentNode,{})),u=0,e=n.inEdges.length;u<e;u++)r=t[n.inEdges[u]],!r||this._parentNode&&o[r.sourceNode]||(r.targetPadding?delete f._segmentPoints:f._segmentPoints=s,this._dock(r,t),i&&ej.datavisualization.Diagram.DiagramContext.update(r,this));for(u=0,e=n.outEdges.length;u<e;u++)r=t[n.outEdges[u]],!r||this._parentNode&&o[r.targetNode]||(r.sourcePadding?delete f._segmentPoints:f._segmentPoints=s,this._dock(r,t),i&&ej.datavisualization.Diagram.DiagramContext.update(r,this));delete f._segmentPoints}},_isNodeToNodeConnection:function(n){var t,i;if(n.inEdges.length)for(t=0,i=n.inEdges.length;t<i;t++)if(this.nameTable[n.inEdges[t]]&&!this.nameTable[n.inEdges[t]].targetPort&&(n.type!="bpmn"||this.nameTable[n.inEdges[t]].segments[0].type!="orthogonal"))return!0;if(n.outEdges.length)for(t=0,i=n.outEdges.length;t<i;t++)if(this.nameTable[n.outEdges[t]]&&!this.nameTable[n.outEdges[t]].sourcePort&&(n.type!="bpmn"||this.nameTable[n.outEdges[t]].segments[this.nameTable[n.outEdges[t]].segments.length-1].type!="orthogonal"))return!0},_updateChildBounds:function(n,t){var r,u,i,f,e,o,s;n.width==0&&n.height==0?(r=n.offsetX,u=n.offsetY,ej.datavisualization.Diagram.Util._updateGroupBounds(n,this),this._translate(n,r-n.offsetX,u-n.offsetY,t)):(r=n.offsetX,u=n.offsetY,i=ej.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.offsetX=i.x+i.width*n.pivot.x,n.offsetY=i.y+i.height*n.pivot.y,f=r-n.offsetX,e=r-n.offsetY,this._translate(n,f,e,t),o=n.width/i.width,s=n.height/i.height,this.scale(n,o,s,n.pivot,t),this._translate(n,r-n.offsetX,u-n.offsetY,t))},_isLastChildOfParent:function(n){var i=this.nameTable[n.parent],r,t;if(i.children)for(t=0;t<i.children.length;t++)if(r=this.nameTable[this._getChild(i.children[t])],r&&r.name==n.name&&t==i.children.length-1)return!0;return!1},_updateQuad:function(n){var u,t,i,r;this._spatialSearch&&this.nameTable[n.name]&&(u=this.getObjectType(n),t=!1,(n.isPhase||n.isLane||n._isHeader||n.isLaneStack||n.isPhaseStack||n._isInternalShape||n.type=="pseudoGroup")&&(t=!0),n.parent&&this.nameTable[n.parent]&&(i=this.nameTable[n.parent],(i.isPhaseStack||i.isSwimlane)&&(t=!0),i.type!="bpmn"&&this._isLastChildOfParent(n)&&this._updateQuad(i)),this._selectedSymbol!=null&&this._selectedSymbol.isLane&&n.isLane&&!n.parent&&(t=!1),this._disableUpdateQuad&&(t=!0),t||n._connectorType||(this._spatialSearch._isRouting=ej.datavisualization.Diagram.Util.canRouteDiagram(this),this._spatialSearch._isRouting&&(r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),this._spatialSearch._viewPortWidth=r.width||1e3,this._spatialSearch._viewPortHeight=r.height||1e3),ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n),this._spatialSearch._isRouting&&(delete this._spatialSearch._isRouting,delete this._spatialSearch._viewPortWidth,delete this._spatialSearch._viewPortHeight)))},_sliceDockLines:function(n){var i=$.extend({},n),t=null;for(var r in i)t=this.nameTable[this._getChild(i[r])],t&&t.segments&&(t.sourceNode||t.targetNode)&&n.pop(t.name)},_canExecute:function(){return this._isEditing&&(this._currentCommand=="delete"||this._currentCommand=="cut"||this._currentCommand=="focusToPreviousItem"||this._currentCommand=="undo"||this._currentCommand=="redo"||this._currentCommand=="focusToNextItem"||this._currentCommand=="selectFocusedItem"||this._currentCommand=="selectAll"||this._currentCommand=="copy"||this._currentCommand=="paste"||this._currentCommand.match("nudge"))?!1:this._currentCommand=="endEdit"&&!this._isEditing?!1:!0},_setItemDraggable:function(n){var t=this,i=!1;this._canDragGlobally=!0;$(n).ejDraggable({clone:!0,helper:function(){var u,n,f,i,r;return this._selectedSymbol=null,this._isDragged=!1,u=t._renderItemContainer("diagram_clone",document.body),u.document.setAttribute("drag","true"),t.activeTool&&t.activeTool.selectedObject&&!t.activeTool.helper&&(n=$.extend(!0,{},t.activeTool.selectedObject),t._updateChildren(n),t.edgeTable={},t.edgeTable=t._getEdgeTable(n,t.edgeTable),this._updateSelectedItem(n,n.isSwimlane),this._selectedSymbol=n,this._isDragged=!1,this._targetId=t._id,f=ej.datavisualization.Diagram.Util.bounds(n),this.cursorAt={top:105,left:105},i=ej.datavisualization.Diagram.NodeType({offsetX:n.offsetX,offsetY:n.offsetY,width:100,height:100,shape:"path",opacity:.5,pathData:"M49.955,50.7915L1.74601,99L98.164,99zM1,1.83699L1,98.332L49.2477,50.0843zM99,1.74699L50.662,50.0845L99,98.422zM1.57701,1L49.9548,49.3773L98.332,1zM0,0L100,0L100,100L0,100z "},t),i=t._getNewNode(i),ej.datavisualization.Diagram.SvgContext.renderNode(i,u,null,!0,t)),r=document.getElementById("diagram_clone_paletteItem"),$(r).addClass("dragClone"),$(r).css("display","none"),$(r)},drag:function(n){var l=$(n.target).parents(".e-datavisualization-diagram"),s,e,h,t,f,r;if(l.length){if(t=$("#"+l.attr("id")).ejDiagram("instance"),(this.model._isDragged||this.model._targetId!=t._id)&&this.model._selectedSymbol){this.model._isDragged||this.model._targetId==t._id?this.model._targetId!=t._id&&(t.edgeTable&&delete t.edgeTable,i=!1):(s=$("#"+this.model._targetId).ejDiagram("instance"),s._delete(s.nameTable[this.model._selectedSymbol.name]),i=!1,f=s._historyList.currentEntry,r=f.previous,f.object=r.undoObject.node,r.undoObject.childTable&&(f.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(f.edgeTable=r.undoObject.edgeTable),s.removeHistoryEntry(r));this.model._isDragged=!0;t._selectedSymbol=this.model._selectedSymbol;t._isNodeEnters=!0;var u=t._selectedSymbol,o=t._currZoom,a=$("#"+t.element[0].id).offset(),c=t._isTouchEvent(n.event),v=((c?c.pageX:n.event.pageX)+t._hScrollOffset-a.left)/o,y=((c?c.pageY:n.event.pageY)+t._vScrollOffset-a.top)/o;if(u.segments?this.model._translate(u,v-(u.sourcePoint.x+u.targetPoint.x)/2*o,y-(u.sourcePoint.y+u.targetPoint.y)/2*o):this.model._translate(u,v-u.offsetX/o,y-u.offsetY/o),this.model._isDragged&&t.edgeTable&&t.nameTable[u.name]&&!i&&u.type!="pseudoGroup"){for(e in t.edgeTable)t.nameTable[e]?(h=t.nameTable[e],h.sourceNode=t.edgeTable[e].sourceNode,h.sourcePort=t.edgeTable[e].sourcePort,h.targetNode=t.edgeTable[e].targetNode,h.targetPort=t.edgeTable[e].targetPort):t.add(t.edgeTable[e]);t._clearSelection(!0);t._addSelection(t.nameTable[u.name],!0);i=!0}}this.helper.css("display","none")}else this.model._selectedSymbol&&(t=$("#"+this.model._targetId).ejDiagram("instance"),t._delete(t.nameTable[this.model._selectedSymbol.name]),i=!1,this.model._isDragged||(f=t._historyList.currentEntry,r=f.previous,f.object=r.undoObject.node,r.undoObject.childTable&&(f.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(f.edgeTable=r.undoObject.edgeTable),t.removeHistoryEntry(r)),this.helper.css("display","block"),this.model._isDragged=!0);$("html,body").css("cursor","no-drop")},dragStop:function(n){var u=$(n.target).parents(".e-datavisualization-diagram"),i,r,t;u&&(i=$("#"+u.attr("id")).ejDiagram("instance"),this.model._isDragged&&this.model._targetId==i._id&&(r=i._historyList.currentEntry,t=r.previous,r.undoObject.node=t.object,t.childTable&&(r.undoObject.childTable=t.childTable),t.edgeTable&&(r.undoObject.edgeTable=t.edgeTable),i.removeHistoryEntry(t)),i._selectedSymbol=null,delete i._isNodeEnters);$(this.helper).remove();$("html,body").css("cursor","default")},_translate:function(n,t,i){if(n.segments)ej.datavisualization.Diagram.Util._translateLine(n,t,i,n);else if(n.offsetX+=t,n.offsetY+=i,n.type=="pseudoGroup"||n.type=="group")for(var r=0;r<n.children.length;r++)this._translate(n.children[r],t,i)},_updateSelectedItem:function(n,i){var r,u;if(n.type=="pseudoGroup"||n.type=="group")for(r=0;r<n.children.length;r++)typeof n.children[r]=="string"&&(n.children[r]=t.nameTable[t._getChild(n.children[r])]),this._updateSelectedItem(n.children[r],i);if(!i)if(n.segments)n.sourceNode=n.targetNode=n.sourcePort=n.targetPort="";else{for(r=0;r<n.inEdges.length;r++)u=t.findNode(n.inEdges[r]),t.model.selectedItems.children.indexOf(u)==-1&&n.inEdges.splice(r,1);for(r=0;r<n.outEdges.length;r++)u=t.findNode(n.outEdges[r]),t.model.selectedItems.children.indexOf(u)==-1&&n.outEdges.splice(r,1)}}})},_renderItemContainer:function(n,t){var r=document.createElement("div"),i={width:100,height:100},u={id:n+"_paletteItem",draggable:"true",height:i.height+"px",width:i.width+"px",style:"padding: 4; height:"+(i.height+1)+"px;width:"+(i.width+1)+"px;-ms-touch-action: none;touch-action: none;"};return ej.datavisualization.Diagram.Util.attr(r,u),t.appendChild(r),this._setItemDraggable(r),this._renderAnchor(r,n,i)},_renderAnchor:function(n,t,i){var r=document.createElement("div"),u={id:t+"_anchor",height:i.height+"px","class":"e-anchor"};return ej.datavisualization.Diagram.Util.attr(r,u),n.appendChild(r),this._renderSvg(r,t,i)},_renderSvg:function(n,t,i){var r=document.createElement("div"),u={id:t+"_svgWrapper","class":"e-svg-container",style:"width:"+i.width+"px;height:"+i.height+"px;"},f;return ej.datavisualization.Diagram.Util.attr(r,u),u={id:t+"_svg",width:i.width,height:i.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},f=new ej.datavisualization.Diagram.Svg(u),r.appendChild(f.document),n.appendChild(r),f}});ej.datavisualization.Diagram.Locale={};ej.datavisualization.Diagram.Locale["default"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"};ej.datavisualization.Diagram.Locale["en-US"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"};$.fn.pinchDiagram=function(n,t){var i=[],f=function(n){var u=n.touches,t,f,e,r,o,s;if(u.length>=2)for(t=0;t<u.length;t++){for(f=u[t],e=!1,r=0;r<i.length;r++)if(o=i[r],f.identifier===o.identifier){e=!0;break}e||(s=$.extend({},f),i.push(s))}n.preventDefault()},r=function(n,t){var i=t.pageX-n.pageX,r=t.pageY-n.pageY;return Math.sqrt(i*i+r*r)},e=function(n){for(var e,t,u,o,f=n.changedTouches,r=0;r<f.length;r++)for(e=f[r],t=0;t<i.length;t++)u=i[t],u.identifier===e.identifier&&(o=i.indexOf(u),i.splice(o,1));n.preventDefault()},u=function(n,t){n.pageX=t.pageX;n.pageY=t.pageY},o=function(n){var f,e,l;if(n.preventDefault(),f=n.touches,f.length>=2){var o=f[0],s=f[1],h=i[0],c=i[1];e=r(o,s)/r(h,c);l=t._mousePosition(n,!1);ej.datavisualization.Diagram.ZoomUtil.zoomPan(t,e,0,0,l,!0,!0);u(h,o);u(c,s)}};this[0].addEventListener("touchstart",f,!1);this[0].addEventListener("touchend",e,!1);this[0].addEventListener("touchmove",o,!1)}})(jQuery,Syncfusion),function(n,t){"use strict";t.MatrixTypes={Identity:0,Translation:1,Scaling:2,Unknown:4};t.MatrixDefaults={m11:1,m12:0,m21:0,m22:1,offsetX:0,offsetY:0,type:t.MatrixTypes.Identity};t.Matrix={identity:function(){return n.extend(!0,{},t.MatrixDefaults)},multiply:function(n,i){var u=n.type,f=i.type,e,r,o,s;if(f!=t.MatrixTypes.Identity){if(u==t.MatrixTypes.Identity){n.m11=i.m11;n.m12=i.m12;n.m21=i.m21;n.m22=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=i.type;return}if(f==t.MatrixTypes.Translation){n.offsetX+=i.offsetX;n.offsetY+=i.offsetY;u!=t.MatrixTypes.Unknown&&(n.type|=t.MatrixTypes.Translation);return}if(u!=t.MatrixTypes.Translation){e=u<<4|f;switch(e){case 34:n.m11*=i.m11;n.m22*=i.m22;return;case 35:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling;return;case 36:break;default:switch(e){case 50:n.m11*=i.m11;n.m22*=i.m22;n.offsetX*=i.m11;n.offsetY*=i.m22;return;case 51:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.m11*n.offsetX+i.offsetX;n.offsetY=i.m22*n.offsetY+i.offsetY;return;case 52:break;default:switch(e){case 66:case 67:case 68:break;default:return}}}r=this.identity();this._setMatrix(r,n.m11*i.m11+n.m12*i.m21,n.m11*i.m12+n.m12*i.m22,n.m21*i.m11+n.m22*i.m21,n.m21*i.m12+n.m22*i.m22,n.offsetX*i.m11+n.offsetY*i.m21+i.offsetX,n.offsetX*i.m12+n.offsetY*i.m22+i.offsetY);r.m21||r.m12?r.type=t.MatrixTypes.Unknown:((r.m11&&r.m11!=1||r.m22&&r.m22!=1)&&(r.type=t.MatrixTypes.Scaling),(r.offsetX||r.offsetY)&&(r.type|=t.MatrixTypes.Translation),(r.type&(t.MatrixTypes.Translation|t.MatrixTypes.Scaling))==t.MatrixTypes.Identity&&(r.type=t.MatrixTypes.Identity));n.m11=r.m11;n.m12=r.m12;n.m21=r.m21;n.m22=r.m22;n.offsetX=r.offsetX;n.offsetY=r.offsetY;n.type=r.type;return}if(o=n.offsetX,s=n.offsetY,n.m11=i.m11,n.m12=i.m12,n.m21=i.m21,n.m22=i.m22,n.offsetX=i.offsetX,n.offsetY=i.offsetY,n.type=i.type,n.offsetX=o*i.m11+s*i.m21+i.offsetX,n.offsetY=o*i.m12+s*i.m22+i.offsetY,f==t.MatrixTypes.Unknown){n.type=t.MatrixTypes.Unknown;return}n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling}},transform:function(n,t){var i=this._multiplyPoint(n,t.x,t.y);return{x:Math.round(i.x*100)/100,y:Math.round(i.y*100)/100}},rotate:function(n,t,i,r){t%=360;this.multiply(n,this._createRotationRadians(t*.017453292519943295,i?i:0,r?r:0))},scale:function(n,t,i,r,u){this.multiply(n,this._createScaling(t,i,r?r:0,u?u:0))},translate:function(n,i,r){if(n.type&t.MatrixTypes.Identity){this._setMatrix(n,1,0,0,1,i,r,t.MatrixTypes.Translation);return}if(n.type&t.MatrixTypes.Unknown){n.offsetX+=i;n.offsetY+=r;return}n.offsetX+=i;n.offsetY+=r;n.type|=t.MatrixTypes.Translation},_createScaling:function(n,i,r,u){var f=this.identity();return this._setMatrix(f,n,0,0,i,r-n*r,u-i*u,(r||u)?t.MatrixTypes.Scaling|t.MatrixTypes.Translation:t.MatrixTypes.Scaling),f},_createRotationRadians:function(n,i,r){var e=this.identity(),u=Math.sin(n),f=Math.cos(n),o=i*(1-f)+r*u,s=r*(1-f)-i*u;return this._setMatrix(e,f,u,-u,f,o,s,t.MatrixTypes.Unknown),e},_multiplyPoint:function(n,i,r){switch(n.type){case t.MatrixTypes.Identity:break;case t.MatrixTypes.Translation:i+=n.offsetX;r+=n.offsetY;break;case t.MatrixTypes.Scaling:i*=n.m11;r*=n.m22;break;case t.MatrixTypes.Translation|t.MatrixTypes.Scaling:i*=n.m11;i+=n.offsetX;r*=n.m22;r+=n.offsetY;break;default:var u=r*n.m21+n.offsetX,f=i*n.m12+n.offsetY;i*=n.m11;i+=u;r*=n.m22;r+=f}return{x:i,y:r}},_setMatrix:function(n,i,r,u,f,e,o,s){n.m11=i;n.m12=r;n.m21=u;n.m22=f;n.offsetX=e;n.offsetY=o;n.type=s||t.MatrixTypes.Identity}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.HitTesting={_getResizeHandleCenter:function(n,i,r){var f,u;r||(r=1);f=this.bounds(n);u=t.datavisualization.Diagram.Point(0,0);switch(i){case"topleft":u=f.topLeft;break;case"topcenter":u=f.top;break;case"topright":u=f.topRight;break;case"middleleft":u=f.left;break;case"middleright":u=f.right;break;case"bottomleft":u=f.bottomLeft;break;case"bottomcenter":u=f.bottom;break;case"bottomright":u=f.bottomRight;break;case"pivot":u=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY);break;case"rotate":var o=20/r,s=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY-n.height*n.pivot.y-10-o),e=t.Matrix.identity();t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY);u=t.Matrix.transform(e,s)}return u},findResizeHandleAtPoint:function(n,i){var e=null,u,o,f,r,s;if(n)for(f=["topleft","topcenter","topright","middleleft","middleright","bottomleft","bottomcenter","bottomright"],r=0,s=f.length;r<s;r++)if(u=this._getResizeHandleCenter(n,f[r]),u!==t.datavisualization.Diagram.Point(0,0)&&(o=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),o)){e=f[r];break}return e},findRotationHandleAtPoint:function(n,i,r){var u=this._getResizeHandleCenter(n,"rotate",r),f=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),10);return f?!0:!1},findPivotHandleAtPoint:function(n,i){var r=this._getResizeHandleCenter(n,"pivot"),u=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(r.x,r.y),7);return u?!0:!1},findEndPointHandleAtPoint:function(n,i){var f=null,r,e,u,o;return n&&(e=n.line.points,u=e[e.length-1],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="targetEndPoint"),r||(u=e[0],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="sourceEndPoint")),r||n.line.type!=="bezier"||(u=n.line._point1,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="bezierpoint1"),r||(o=n.line._point2,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),r&&(f="bezierpoint2")))),f}};t.datavisualization.Diagram.LayoutUtil={expandSubTree:function(n,i,r,u,f,e,o){var s,c,h,l;n._isAnimating||(s=n.model.scrollSettings.currentZoom,c=i.offsetX*s-n.model.scrollSettings.viewPortWidth/2-n.model.scrollSettings.horizontalOffset,(i.offsetY*s<n.model.scrollSettings.verticalOffset||i.offsetY*s>n.model.scrollSettings.verticalOffset+n.model.scrollSettings.viewPortHeight-3*i.height*s)&&n.update({scrollSettings:{verticalOffset:i.offsetY-n.model.scrollSettings.viewPortHeight/2}}),h=0,c!=0&&e?(n._preventScrollerUpdate=!0,l=setInterval(function(){h<4&&n.update({scrollSettings:{horizontalOffset:n.model.scrollSettings.horizontalOffset+c/4}});h++;h==5&&(clearInterval(l),delete n._preventScrollerUpdate,(o!==!1||!i.isExpanded)&&i.outEdges.length?t.datavisualization.Diagram.LayoutUtil.expand(n,i,r,u,f):t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n))},25)):(delete n._preventScrollerUpdate,(o!==!1||!i.isExpanded)&&i.outEdges.length?this.expand(n,i,r,u,f):t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n)))},_updateVisiblity:function(n,i,r){for(var u,f,e=0;e<i.outEdges.length;e++)u=i.outEdges[e],u=n.findNode(u),f=n.findNode(u.targetNode),u.opacity=f.opacity=r/100,t.datavisualization.Diagram.DiagramContext.updateNodeStyle(f,n),t.datavisualization.Diagram.DiagramContext.updateConnectorStyle(u,n),f.isExpanded&&f.outEdges.length&&this._updateVisiblity(n,f,r)},expand:function(i,r,u,f,e){var v,s,h,o,y,c,l,a,p;if(u===undefined&&(u=r.name),v=i.model.layout.fixedNode,i.model.layout.fixedNode=u,s=i.selectionList[0]?i.selectionList[0].name:"",s&&i._clearSelection(!0),f){if(!i._isAnimating){if(r._updateExpander=!0,i._updateEdgeCollection(),r.isExpanded?(i._collapseChildren(r),r.isExpanded=!1):(i._expandChildren(r),r.isExpanded=!0),i._isAnimating=!0,h=t.datavisualization.Diagram.Layout.doLayout(i,!1),o=0,h.length)n(".ej-d-connector").attr("opacity",0),n(".ej-d-icon-template").attr("opacity",0),i._layoutInAction=!0,y=setInterval(function(){var r,c,f;if(o++,o<5)for(r=0;r<h.length;r++)c=i.nameTable[h[r].object],i._disableSegmentChange=!0,i.updateNode(c.name,{offsetX:c.offsetX+h[r].diff/4,offsetY:c.offsetY+h[r].diffy/4}),i._disableSegmentChange=!1;if(o==5){if(clearInterval(y),delete i._layoutInAction,f=i._internalLayout,f)for(o=0;o<f._firstLevelNodes.length;o++)t.datavisualization.Diagram.HierarchicalLayout._updateConnectors(f,f._firstLevelNodes[o],1);delete i._internalLayout;n(".ej-d-connector").attr("opacity",1);n(".ej-d-icon-template").attr("opacity",1);(s||e)&&i._addSelection(i.findNode(s||u),!e);i._isAnimating=!1;delete i._preventScrollerUpdate;t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(i)}},50);else{if(c=i._internalLayout,c)for(o=0;o<c._firstLevelNodes.length;o++)t.datavisualization.Diagram.HierarchicalLayout._updateConnectors(c,c._firstLevelNodes[o],1);(s||e)&&i._addSelection(i.findNode(s||u),!e);i._isAnimating=!1;delete i._internalLayout}l=0;a=this;r.isExpanded&&(a._updateVisiblity(i,r,0),p=setInterval(function(){r.isExpanded&&(l<=100&&a._updateVisiblity(i,r,l),l==120&&clearInterval(p),l+=5)},25));t.datavisualization.Diagram.PageUtil._updatePageSize(i)}}else i.layout();i.model.layout.fixedNode=v}};t.datavisualization.Diagram.Util={convertPathToArray:function(n){var u=[],e=this.parsePathData(n),f,i,r,t;if(e.length>0)for(f=0;f<e.length;f++){i=e[f];r=i[0];switch(r.toLowerCase()){case"m":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x:i[t],y:i[t+1]}),t=t+1,r==="m"?r="l":r==="M"&&(r="L");break;case"l":case"t":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x:i[t],y:i[t+1]}),t=t+1;break;case"h":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x:i[t]});break;case"v":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,y:i[t]});break;case"z":u.push({pathSegTypeAsLetter:r});break;case"c":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x1:i[t],y1:i[t+1],x2:i[t+2],y2:i[t+3],x:i[t+4],y:i[t+5]}),t=t+5;break;case"s":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x2:i[t],y2:i[t+1],x:i[t+2],y:i[t+3]}),t=t+3;break;case"q":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x1:i[t],y1:i[t+1],x:i[t+2],y:i[t+3]}),t=t+3;break;case"a":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,r1:i[t],r2:i[t+1],angle:i[t+2],largeArcFlag:this.parseArcFlag(i[t+3]),sweepFlag:this.parseArcFlag(i[t+4]),x:i[t+5],y:i[t+6]}),t=t+6}}return u},_getImageAlignment:function(n){if(n)switch(n.toLowerCase()){case"xminymin":return"xMinYMin";case"xminymid":return"xMinYMid";case"xminymax":return"xMinYMax";case"xmidymin":return"xMidYMin";case"xmidymid":return"xMidYMid";case"xmidymax":return"xMidYMax";case"xmaxymin":return"xMaxYMin";case"xmaxymid":return"xMaxYMid";case"xmaxymax":return"xMaxYMax";case"none":return"none"}return"none"},parseArcFlag:function(n){var t;return n==="0"||n===0?t=!1:(n==="1"||n===1)&&(t=!0),t},parsePathData:function(n){var f=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,i,t,r=[],u,e;for(f.lastIndex=0,u=!1;i=f.exec(n);)i[1]==="e"?(e="",u=!0):i[1]?(i[1].toLowerCase()==="zm"?(t&&r.push(t),r.push(["Z"]),t=[i[1].substring(1,2)]):(t&&r.push(t),t=[i[1]]),u=!1):(t||(t=[]),u||t.push(Number(i[2])),u=!1);return t&&r.push(t),r},pathSegArrayAsString:function(n){for(var i,r="",t=0;t<n.length;t++)i=n[t],r+=t===0?this.pathToString(i):" "+this.pathToString(i);return r},canEnablePointerEvents:function(n,i){var r=n,u;if(i)while(r){if(u=r.segments?r.constraints&t.datavisualization.Diagram.ConnectorConstraints.PointerEvents:r.constraints&t.datavisualization.Diagram.NodeConstraints.PointerEvents,!u)return u;r=typeof r.parent=="string"?i.nameTable[r.parent]:r}return!0},isClassifier:function(t){var i=typeof t.target.className=="string"?t.target.className:t.target.className.baseVal;return n(t.target).hasClass("ej-d-classifier")||i.indexOf("ej-d-classifier")>-1?!0:!1},pathToString:function(n){var t;switch(n.pathSegTypeAsLetter){case"Z":case"z":t=n.pathSegTypeAsLetter;break;case"M":case"m":case"L":case"l":t=n.pathSegTypeAsLetter+" "+n.x+" "+n.y;break;case"C":case"c":t=n.pathSegTypeAsLetter+" "+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;break;case"Q":case"q":t=n.pathSegTypeAsLetter+" "+n.x1+" "+n.y1+" "+n.x+" "+n.y;break;case"A":case"a":t=n.pathSegTypeAsLetter+" "+n.r1+" "+n.r2+" "+n.angle+" "+(n.largeArcFlag?"1":"0")+" "+(n.sweepFlag?"1":"0")+" "+n.x+" "+n.y;break;case"H":case"h":t=n.pathSegTypeAsLetter+" "+n.x;break;case"V":case"v":t=n.pathSegTypeAsLetter+" "+n.y;break;case"S":case"s":t=n.pathSegTypeAsLetter+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;break;case"T":case"t":t=n.pathSegTypeAsLetter+" "+n.x+" "+n.y}return t},findPortByName:function(n,t){var r,i,u;if(n){if(n.ports)for(i=0,u=n.ports.length;i<u;i++)if(r=n.ports[i],r.name===t)return r;if(n._ports)for(i=0,u=n._ports.length;i<u;i++)if(r=n._ports[i],r.name===t)return r}return null},attr:function(n,t){for(var i in t)n.setAttribute(i.toString(),t[i])},removeChildFromGroup:function(n,t){var r=n.indexOf(t),i;if(r<0)for(i=0;i<n.length;i++)if(typeof n[i]=="object"&&typeof t=="string"&&n[i].name===t){r=i;break}r>=0&&n.splice(r,1)},removeFromCollection:function(n,t,i){var i,r,u;if(n)for(i=n.nameTable[n._getChild(i)],r=0;r<t.length;r++)u=n.nameTable[n._getChild(t[r])],u.name===i.name&&t.splice(r,1)},removeItem:function(n,t){var i=n.indexOf(t);i>=0&&n.splice(i,1)},clear:function(n){while(n.length>0)n.pop()},getChild:function(n){if(n)return typeof n=="object"?n.name:n},randomId:function(){for(var n,i="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",r="",u=0;u<4;u++)n=t.getRandomValue(0,i.length-1),r+=i.substring(n,n+1);return r},htmlEncode:function(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},canMove:function(n){if(this.canSelect(n))return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Drag:n._type=="label"?n.constraints&t.datavisualization.Diagram.LabelConstraints.Draggable:n.constraints&t.datavisualization.Diagram.NodeConstraints.Drag},canRouteDiagram:function(n){return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Routing},canRouteConnector:function(n,i){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Routing?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Routing:n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritRouting?i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Routing:void 0},canMoveLabel:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLabel:n.constraints&t.datavisualization.Diagram.NodeConstraints.DragLabel},canRotate:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Rotate:n._type=="label"?n.constraints&t.datavisualization.Diagram.LabelConstraints.Rotatable:n.constraints&t.datavisualization.Diagram.NodeConstraints.Rotate},canShowTooltip:function(n,i){var r;return(r=n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritTooltip:n.constraints&t.datavisualization.Diagram.NodeConstraints.InheritTooltip,r)?i.model.tooltip:n.tooltip},canSelect:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Select:n._type=="label"?n.constraints&t.datavisualization.Diagram.LabelConstraints.Selectable:n.constraints&t.datavisualization.Diagram.NodeConstraints.Select},enableLayerOption:function(n,t,i){var f=0,o=0,r=i.model.layers,e,u,s;if(r&&r.length===0)return!0;for(u=0;r&&u<r.length;u++)t==="active"&&r[u][t]?(f++,s=r[u]):(n&&r[u].objects&&r[u].objects.indexOf(n.name)>-1||i._isParent(n,r[u].objects))&&(f++,e=r[u][t],r[u][t]&&o++);return t==="active"?f===1?s:!1:f===1?t!=="lock"?e:!e:f>1&&o>0?!0:!0},canBridge:function(n,i){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging:n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritBridging?i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Bridging:void 0},canBridgeObstacle:function(n){if(n.constraints&t.datavisualization.Diagram.ConnectorConstraints.BridgeObstacle)return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.BridgeObstacle},canCrispEdges:function(n,i){if(n.segments){if(n.constraints&t.datavisualization.Diagram.ConnectorConstraints.CrispEdges)return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.CrispEdges;if(i&&n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritCrispEdges)return i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.CrispEdges}else{if(n.constraints&t.datavisualization.Diagram.NodeConstraints.CrispEdges)return n.constraints&t.datavisualization.Diagram.NodeConstraints.CrispEdges;if(i&&n.constraints&t.datavisualization.Diagram.NodeConstraints.InheritCrispEdges)return i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.CrispEdges}},canAllowPan:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan},canAllowDrop:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.AllowDrop:n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowDrop},isAllowDragLimit:function(n){if(n.segments)return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLimit},canDelete:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Delete:n.constraints&t.datavisualization.Diagram.NodeConstraints.Delete},isPageEditable:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.UserInteraction},canFloatElements:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.FloatElements},canEnableAPIMethods:function(n){if(n&&n._enableAPIMethods)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.APIUpdate},canDoMultipleSelection:function(n){if(n&&this.isPageEditable(n))return n.tool()&t.datavisualization.Diagram.Tool.MultipleSelect},canDoSingleSelection:function(n){if(n&&this.isPageEditable(n))return n.tool()&t.datavisualization.Diagram.Tool.SingleSelect},canMoveOutofBoundary:function(n){return n.model.pageSettings.boundaryConstraints!="infinity"?!0:!1},_getPseudoGroupConstraints:function(i,r,u){var f,e,o,h,s;if(u&&u.type==="pseudoGroup")if((u.children.indexOf(r.name)>=0||r.name===u.name)&&i.model.selectedItems.getConstraints&&(e=i.model.selectedItems.getConstraints,typeof e=="string"&&(e=t.util.getObject(e,window))),e&&n.isFunction(e))f=e();else if(u.children)for(f=t.datavisualization.Diagram.NodeConstraints.Default,o=0;o<u.children.length;o++)h=i.nameTable[i._getChild(u.children[o])],h&&(s=h.constraints,s&t.datavisualization.Diagram.NodeConstraints.Resize||(f=f&~t.datavisualization.Diagram.NodeConstraints.Resize),s&t.datavisualization.Diagram.NodeConstraints.Rotate||(f=f&~t.datavisualization.Diagram.NodeConstraints.Rotate),s&t.datavisualization.Diagram.NodeConstraints.Drag||(f=f&~t.datavisualization.Diagram.NodeConstraints.Drag));return f},canPanning:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY},canZooming:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Zoomable},canUndo:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Undoable},canZoomTextEditor:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.ZoomTextEditor},canMultiSelectOnLane:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.MultiSelect},canMultiSelectOnNode:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.PointerEvents},canEnableTooltip:function(n){return n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.Tooltip?!0:!1},canDragHelper:function(n){return n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.DragOnEmptySpace?!0:!1},canShowResizeThumbs:function(n){return n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.AutoHideThumbs},canDrawStackHighlighter:function(n,i,r){var o,u,f,e;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)&&n&&i&&r&&(o=n.nameTable[r.parent],o&&o.isLaneStack&&(u=n.nameTable[o.parent],u&&u.isSwimlane)))if(f=this.bounds(u),e=n.activeTool._getPageBounds(),u.orientation==="horizontal"){if(i.height+f.bottom>=e.height||i.width-u.width+f.right>e.width)return n.activeTool.updateCursor("not-allowed"),n._notAllow=!0,!1}else if(i.width+f.right>=e.width||i.height-u.height+f.bottom>e.height)return n.activeTool.updateCursor("not-allowed"),n._notAllow=!0,!1;return!0},canDragSourceEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd},canDragTargetEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragTargetEnd},canDragSegmentThumbs:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSegmentThumb},isTargetConnected:function(n){return n.targetNode?!0:!1},isSourceConnected:function(n){return n.sourceNode?!0:!1},bounds:function(n,i){var r={},o,s,h,c,u,e,f;if(n)if(n.segments)for(o=0;o<n.segments.length;o++)s=n.segments[o],o==0?s.points&&(r=t.datavisualization.Diagram.Geometry.rect(s.points)):r=t.datavisualization.Diagram.Geometry.union(r,t.datavisualization.Diagram.Geometry.rect(s.points)),r.width==0&&(r.width=n.lineWidth,r.x-=n.lineWidth/2),r.height==0&&(r.height=n.lineWidth,r.y-=n.lineWidth/2);else n._type=="node"||n._type==="group"||n.type=="umlclassifier"||n._type=="pseudoGroup"?(h=n.width?n.width:n._width||0,c=n.height?n.height:n._height||0,r={x:n.offsetX-h*n.pivot.x,y:n.offsetY-c*n.pivot.y,width:h,height:c}):r=n;else r=t.datavisualization.Diagram.Rectangle();return r?(u={},r.x=Math.round(r.x*100)/100,r.y=Math.round(r.y*100)/100,r.width=Math.round(r.width*100)/100,r.height=Math.round(r.height*100)/100,u.width=r.width,u.height=r.height,u.x=u.left=r.x,u.right=r.x+r.width,u.y=u.top=r.y,u.bottom=r.y+r.height,u.center={x:r.x+r.width/2,y:r.y+r.height/2},u.topLeft={x:r.x,y:r.y},u.topCenter={x:r.x+r.width/2,y:r.y},u.topRight={x:r.x+r.width,y:r.y},u.middleLeft={x:r.x,y:r.y+r.height/2},u.middleRight={x:r.x+r.width,y:r.y+r.height/2},u.bottomLeft={x:r.x,y:r.y+r.height},u.bottomCenter={x:r.x+r.width/2,y:r.y+r.height},u.bottomRight={x:r.x+r.width,y:r.y+r.height},n&&n.rotateAngle&&!i&&(e=t.Matrix.identity(),t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY),u.topLeft=t.Matrix.transform(e,u.topLeft),u.topCenter=t.Matrix.transform(e,u.topCenter),u.topRight=t.Matrix.transform(e,u.topRight),u.middleLeft=t.Matrix.transform(e,u.middleLeft),u.middleRight=t.Matrix.transform(e,u.middleRight),u.bottomLeft=t.Matrix.transform(e,u.bottomLeft),u.bottomCenter=t.Matrix.transform(e,u.bottomCenter),u.bottomRight=t.Matrix.transform(e,u.bottomRight),f=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),u.x=u.left=f.x,u.y=u.top=f.y,u.right=f.x+f.width,u.bottom=f.y+f.height,u.center=t.datavisualization.Diagram.Point(f.x+f.width/2,f.y+f.height/2)),u.points=[u.topLeft,u.topRight,u.bottomRight,u.bottomLeft],u):r},_swapBounds:function(n,i){var n,i,u,r;return i=i,n.rotateAngle?(n.rotateAngle<45||(n.rotateAngle<=135?(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.middleLeft,i.middleLeft=i.bottomCenter,i.bottomCenter=i.middleRight,i.middleRight=r,r=i.topLeft,i.topLeft=i.bottomLeft,i.bottomLeft=i.bottomRight,i.bottomRight=i.topRight,i.topRight=r):n.rotateAngle<=225?(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.bottomCenter,i.bottomCenter=r,r=i.middleLeft,i.middleLeft=i.middleRight,i.middleRight=r,r=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=r,r=i.bottomRight,i.bottomRight=i.topRight,i.topRight=r):n.rotateAngle<=315&&(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.middleRight,i.middleRight=i.bottomCenter,i.bottomCenter=i.middleLeft,i.middleLeft=r,r=i.topRight,i.topRight=i.bottomRight,i.bottomRight=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=r)),i.points=[i.topLeft,i.topRight,i.bottomRight,i.bottomLeft],i):void 0},canResize:function(n,i){if(n._type!=="label")if(i)switch(i){case"n-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth;case"s-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth;case"e-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast;case"w-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest;case"se-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast;case"ne-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast;case"sw-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest;case"nw-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest}else return n.constraints&t.datavisualization.Diagram.NodeConstraints.Resize;else return n.constraints&t.datavisualization.Diagram.LabelConstraints.Resizable},canConnect:function(n,i){var r=null;return n&&(i?r=n.constraints&t.datavisualization.Diagram.PortConstraints.Connect:n.segments||(r=n.constraints&t.datavisualization.Diagram.NodeConstraints.Connect)),r},_initializeSegments:function(n,i){var u,f,r;if(n.segments&&n.segments.length<=1){n.segments.length||n.segments.push(t.datavisualization.Diagram.Segment({type:i||"straight"}));u=n.segments[0];switch(u.type){case"straight":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:u.type||"straight"}):u._point=n.targetPoint;break;case"orthogonal":u.length&&u.direction?(t.datavisualization.Diagram.Util._addOrthogonalPoints(u,null,null,n.sourcePoint,n.targetPoint),(u._endPoint.x!=n.targetPoint.x||u._endPoint.y!=n.targetPoint.y)&&n.segments.push({type:u.type||"straight"})):(u._length=u.length||20,u._direction=u.direction||"auto");break;case"bezier":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:u.type||"straight"}):u._point=n.targetPoint}}var e=n.sourcePoint,o=null,h=null,s;for(f=0;f<n.segments.length;f++){if(r=n.segments[f],r._startPoint=e,h=n.segments[f+1],r=n.segments[f]=t.datavisualization.Diagram.Segment(n.segments[f]),r.type=="orthogonal"){if(r._direction=r.direction||"auto",r._length=r.length||20,s=t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[f],o,h,n.sourcePoint,n.targetPoint,s),e=n.segments[f]._endPoint,!r.length||!r.direction)break}else if(r.type=="straight"){if(r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),r._point=r._endPoint=n.segments[f].point||n.targetPoint,s=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),e=n.segments[f]._endPoint,!r.point)break}else if(r.type=="bezier"){if(r._point=r._endPoint=n.segments[f].point||n.targetPoint,r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),s=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),t.datavisualization.Diagram.Util._updateBezierPoints(r),e=n.segments[f]._endPoint,!r.point)break}else{r=t.datavisualization.Diagram.Segment({type:"orthogonal"});r._direction="auto";r._length=20;r._startPoint=e;r._endPoint=n.targetPoint;n.segments.push(r);t.datavisualization.Diagram.Util._addOrthogonalPoints(r,o,null,n.sourcePoint,n.targetPoint,s);break}o=n.segments[f]}(e.x!=n.targetPoint.x||e.y!=n.targetPoint.y)&&(r=t.datavisualization.Diagram.Segment({type:(o?o.type:i)||"straight"}),r._startPoint=e,r._endPoint=n.targetPoint,r.type=="orthogonal"?t.datavisualization.Diagram.Util._addOrthogonalPoints(r,o,null,n.sourcePoint,n.targetPoint,s):(r._point=n.targetPoint,r.points.push(e),r.points.push(n.targetPoint),r.type=="bezier"&&this._updateBezierPoints(r)),n.segments.push(r))},_getDockableBPMNNode:function(n,t,i,r){var u=r?t.segments[t.segments.length-1]:t.segments[0];if(n&&n.type=="bpmn"){if(u.type=="orthogonal")return n;n._type=="group"&&(n=typeof n.children[0]=="object"?n.children[0]:i[n.children[0]])}return n},dock:function(n,t,i){var r,o=null,u,s=null,h=n._srcDecoratorSize,c=n._tarDecoratorSize,f,e;n.sourcePadding&&(n._srcDecoratorSize+=n.sourcePadding);n.targetPadding&&(n._tarDecoratorSize+=n.targetPadding);r=t[n.targetNode];r&&(o=n._targetPortLocation||this.findPortByName(r,n.targetPort));u=t[n.sourceNode];u&&(s=n._sourcePortLocation||this.findPortByName(u,n.sourcePort));f=this.isSourceConnected(n);e=this.isTargetConnected(n);s?s.connectorPadding&&(n._srcDecoratorSize+=s.connectorPadding):(u=this._getDockableBPMNNode(u,n,t,!1),u&&u.connectorPadding&&(n._srcDecoratorSize+=u.connectorPadding));o?o.connectorPadding&&(n._tarDecoratorSize+=o.connectorPadding):(r=this._getDockableBPMNNode(r,n,t,!0),r&&r.connectorPadding&&(n._tarDecoratorSize+=r.connectorPadding));e&&f&&o&&s?this._dockPortToPort(n,r,o,u,s):e&&o?f?n.segments.length==1?(this._dockNode(n,u,null,e,f),this._dockPortToNode(n,r,o,u,s,!0)):(this._dockNode(n,u,null,e,f),this._updateIntermediateSegments(n),this._dockPortToPoint(n,r,o,!0),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,r,o,!0),this._updatePreviousSegment(n)):f&&s?e?n.segments.length==1?(this._dockNode(n,r,null,e,f),this._dockPortToNode(n,u,s,r,o,!1)):(this._dockPortToPoint(n,u,s,!1),this._updateIntermediateSegments(n),this._dockNode(n,r,null,e,f),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,u,s,!1),this._updateIntermediateSegments(n)):e&&f?r&&u&&this._dockNode(n,r,u,e,f,i):e?this._dockNode(n,r,null,e,f):f&&this._dockNode(n,u,null,e,f);this._adjustEndPoint(n,u,s,r,o);n._srcDecoratorSize=h;n._tarDecoratorSize=c},_dockPortToPort:function(n,i,r,u,f){var o,s,h;if(n.segments.length==1){i&&(s=this.bounds(i,!0));u&&(h=this.bounds(u,!0));var e,c=n.segments[0],w=n.segments[n.segments.length-1],v=n.segments[0];if(v.type!=="orthogonal")r&&(o=this._getPortPosition(r,s,undefined,i),i.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(e,o)),this._setLineEndPoint(n,o,!0)),f&&(o=this._getPortPosition(f,h,undefined,u),u.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY),o=t.Matrix.transform(e,o)),this._setLineEndPoint(n,o,!1)),v.type==="bezier"&&this._updateBezierPoints(v,i,r,s,u,f,h);else{var l=n._targetPortLocation||this._getPortPosition(r,s,undefined,i),a=n._sourcePortLocation||this._getPortPosition(f,h,undefined,u),y=this._swapDirection(i.rotateAngle,this._getDirection(s,l)),p=this._swapDirection(u.rotateAngle,this._getDirection(h,a));u.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY),a=t.Matrix.transform(e,a));i.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY),l=t.Matrix.transform(e,l));this._constructSegements(n,c,s,l,y,h,a,p);this._setLineEndPoint(n,c.points[0],!1);this._setLineEndPoint(n,c.points[c.points.length-1],!0)}}else this._dockPortToPoint(n,u,f,!1),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,r,!0),this._updatePreviousSegment(n)},_dockPortToNode:function(n,i,r,u,f,e){var p=n.segments[0],w=n.segments[n.segments.length-1],h,l,c,b,a,o,y,s,v;i&&(h=this.bounds(i,!0));u&&(l=this.bounds(u,!0));b=e?w:p;b.type!=="orthogonal"?(a=this._getPortPosition(r,h,undefined,i),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),a=t.Matrix.transform(c,a),this._setLineEndPoint(n,a,e)):(o=(e?n._targetPortLocation:n._sourcePortLocation)||this._getPortPosition(r,h,undefined,i),y=this._swapDirection(i.rotateAngle,this._getDirection(h,o)),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(c,o),s=e?n.sourcePoint:n.targetPoint,v=u?this._getDirection(l,s):"top",v&&(h=this.bounds(i),l=u?this.bounds(u):{left:s.x,right:s.x,top:s.y,bottom:s.y},e?(this._setLineEndPoint(n,o,!0),this._constructSegements(n,w,h,o,y,l,s,v)):(this._setLineEndPoint(n,o,!1),this._constructSegements(n,p,l,s,v,h,o,y))))},_dockPortToPoint:function(n,i,r,u){var s=n.segments[0],h=n.segments[n.segments.length-1],a=u?h:s,o,v,y;if(a.type!=="orthogonal")this._dockPortToNode(n,i,r,null,null,u);else{var e=this.bounds(i,!0),f=(u?n._targetPortLocation:n._sourcePortLocation)||this._getPortPosition(r,e,undefined,i),c=this._swapDirection(i.rotateAngle,this._getDirection(e,f)),l=t.Matrix.identity();t.Matrix.rotate(l,i.rotateAngle,i.offsetX,i.offsetY);f=t.Matrix.transform(l,f);o=u?h._startPoint:s._endPoint;v=this.bounds(t.datavisualization.Diagram.Rectangle(o.x,o.y,0,0));e=this.bounds(i);y="top";u?(this._setLineEndPoint(n,f,!0),this._pointsFromNodeToPoint(n,h,c,e,i.rotateAngle,f,o,!0)):(this._setLineEndPoint(n,f,!1),this._pointsFromNodeToPoint(n,s,c,e,i.rotateAngle,f,o,!1))}},_containsminSpaceBetweenNode:function(n,t,i){var r;if(n&&n.minSpaceBetweenNode&&t&&i&&n.minSpaceBetweenNode&&n.minSpaceBetweenNode.length>0)for(r=0;r<n.minSpaceBetweenNode;r++)if(n.minSpaceBetweenNode[r]===t.name||n.minSpaceBetweenNode[r]===i.name)return!0;return!1},_dockNode:function(n,t,i,r,u,f){var v,y,c=n._srcDecoratorSize+n._tarDecoratorSize,o,e,s,h,l,a,p;c=this._containsminSpaceBetweenNode(f,i,t)?0:c;n.segments.length==1?v=y=n.segments[0]:(v=n.segments[0],y=n.segments[n.segments.length-1]);r&&u&&!n.targetPort&&!n.sourcePort?n.segments.length==1?n.segments[0].type=="orthogonal"?(o=this.bounds(i),e=this.bounds(t),this._swapBounds(i,o),this._swapBounds(t,e),o.y-c>=e.bottom?(s=o.topCenter,l="top",h=e.bottomCenter,a="bottom"):o.bottom+c<=e.y&&(h=e.topCenter,a="top",s=o.bottomCenter,l="bottom"),o.bottom+c>e.y&&o.y<e.bottom+c&&(o.right+c<e.x||e.right>=o.x-c&&o.x>e.x?(s=o.middleRight,l="right",h=e.middleLeft,a="left"):e.right+c<o.x||o.right>=e.x-c&&o.x<e.x?(s=o.middleLeft,l="left",h=e.middleRight,a="right"):o.x<=e.x?(s=o.middleLeft,l="left",h=e.middleLeft,a="left"):o.x<=e.right?(s=o.middleRight,l="right",h=e.middleRight,a="right"):(s=o.middleLeft,l="left",h=e.middleRight,a="right")),p=this._findEndPoint(l,s,i)||o.center,s=this._findIntersection(i,o,n,s,p,!1)||s,p=this._findEndPoint(a,h,t)||e.center,h=this._findIntersection(t,e,n,h,p,!0)||h,this._setLineEndPoint(n,s,!1),this._setLineEndPoint(n,h,!0),n.segments[0].type=="orthogonal"&&(this._constructSegements(n,n.segments[0],e,n.targetPoint,a,o,n.sourcePoint,l),n.segments[0]._direction=l)):(t&&(e=this.bounds(t),this._swapBounds(t,e),i&&(o=this.bounds(i),this._swapBounds(i,o),this._setLineEndPoint(n,o.center,!1),this._setLineEndPoint(n,e.center,!0),this._dockBounds(n,i,o,!1)),this._setLineEndPoint(n,e.center,!0),this._dockBounds(n,t,e,!0)),n.segments[0].type=="bezier"&&this._updateBezierPoints(n.segments[0])):(this._dock(n,v,i,null,!1),this._updateIntermediateSegments(n),n.segments.length==1?(this._dock(n,v,i,t,!1),this._dock(n,y,t,i,!0)):(this._dock(n,y,t,null,!0),this._updatePreviousSegment(n))):r&&!n.targetPort?(this._dock(n,y,t,i,!0),this._updatePreviousSegment(n)):u&&!n.sourcePort&&(this._dock(n,v,t,i,!1),this._updateIntermediateSegments(n))},_adjustEndPoint:function(n,t,i,r,u){var h,c,l,f,a;if(n.sourcePadding||n.targetPadding||i&&i.connectorPadding||u&&u.connectorPadding){var e=0,o=r?this.bounds(r):null,s=t?this.bounds(t):null;t&&(f=n.segments[0],h=f.type!=="orthogonal"?f.type!=="bezier"?f._endPoint:f._point1:f.points[1],i&&(e=n.sourcePadding+i.connectorPadding),c=this._adjustPoint(f._startPoint,h,!0,e),this._setLineEndPoint(n,c,!1),f.type=="bezier"&&this._updateBezierPoints(f,r,u,o,t,i,s));r&&(f=n.segments[n.segments.length-1],l=f.type!=="orthogonal"?f.type!=="bezier"?f._startPoint:f._point2:f.points[f.points.length-2],u&&(e=n.targetPadding+u.connectorPadding),a=this._adjustPoint(l,f._endPoint,!1,e),this._setLineEndPoint(n,a,!0),f.type=="bezier"&&this._updateBezierPoints(f,r,u,o,t,i,s))}},_findEndPoint:function(n,t,i){var r;switch(n){case"top":r={x:t.x,y:t.y+Math.max(i.width,i.height)};break;case"bottom":r={x:t.x,y:t.y-Math.max(i.width,i.height)};break;case"left":r={y:t.y,x:t.x+Math.max(i.width,i.height)};break;case"right":r={y:t.y,x:t.x-Math.max(i.width,i.height)}}return r},_dock:function(n,i,r,u,f){var o,a,c,s,h,v,e,l,y;if(r)if(a=r,c=f?i._startPoint:i._endPoint,o=this.bounds(r),this._swapBounds(r,o),f)if(i.type=="orthogonal")if(e=n.segments[n.segments.length-2],e&&e.type=="orthogonal")if(i.points.length>2&&t.datavisualization.Diagram.Geometry.containsPoint(o,i.points[i.points.length-2])){if(l=!1,e.direction=="top"||e.direction=="bottom"){if(e._endPoint.x>=o.left&&e._endPoint.x<=o.right){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.y-o.middleLeft.y);e.length==0?l=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="top"?"bottom":"top"),n.targetPoint=e._endPoint.x>o.right?o.middleRight:o.middleLeft)}else{if(e._endPoint.y>=o.top&&e._endPoint.y<=o.bottom){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.x-o.topCenter.x);e.length==0?l=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="left"?"right":"left"),n.targetPoint=e._endPoint.y>o.bottom?o.bottomCenter:o.topCenter)}if(l){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=this._findIntersection(r,o,n,n.targetPoint,o.center,f)||n.targetPoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._startPoint)){if(y=e.direction=="left"||e.direction=="right"?a.width/2:a.height/2,e._length=e.length-=y+30,e.length==0){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=e.direction=="left"||e.direction=="right"?e.direction=="right"?o.middleLeft:o.middleRight:e.direction=="bottom"?o.topCenter:o.bottomCenter;n.targetPoint=this._findIntersection(r,o,n,n.targetPoint,o.center,f)||n.targetPoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else this._dockNodeToPoint(n,c,r,f);else this._dockNodeToPoint(n,c,r,f);else this._dockNodeToPoint(n,c,r,f);else if(i.type=="orthogonal"&&n.segments[1]&&n.segments[1].type=="orthogonal")if(n.segments[0]._isInternal&&t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._insertSegmentAtSourceEnd(n,i,o,r,f);else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._removeFirstSegment(n,i,o,r,f);else{switch(i.direction){case"left":h="left";s=o.middleLeft;break;case"right":h="right";s=o.middleRight;break;case"top":h="top";s=o.topCenter;break;case"bottom":h="bottom";s=o.bottomCenter}i.points=[];v=this._findEndPoint(h,s,r)||o.center;s=this._findIntersection(r,o,n,s,v,f)||s;i.points.push(s);i.points.push(i._endPoint);this._setLineEndPoint(n,s,f)}else this._dockNodeToPoint(n,i._endPoint,r,f)},_removeLastSegment:function(n,t,i,r,u,f){n.segments.splice(n.segments.length-1,1);i.length=i._length=null;i.direction=null;i._direction=t._direction;this._dock(n,i,r,u,f)},_insertSegmentAtSourceEnd:function(n,t,i,r,u){var f=n.segments[1],e=n.segments[2],s,o;n.segments[0].direction=="left"||n.segments[0].direction=="right"?(s="horizontal",n.sourcePoint=f.direction=="top"?i.topCenter:i.bottomCenter,f&&(f.length||f.length===0)&&(f._length=f.length=Math.max(Math.abs(n.sourcePoint.y-f._endPoint.y),25)),e&&(e.length||e.length===0)&&(e.length=e._length=Math.abs(i.topCenter.x-e._endPoint.x))):(s="vertical",n.sourcePoint=f.direction=="left"?i.middleLeft:i.middleRight,f&&(f.length||f.length===0)&&(f._length=f.length=Math.max(Math.abs(n.sourcePoint.x-f._endPoint.x),25)),e&&(e.length||e.length===0)&&(e.length=e._length=Math.abs(i.middleRight.y-e._endPoint.y)));n.segments[3]&&(n.segments[3].length||n.segments[3].length==0)&&(o=f.direction=="bottom"||f.direction=="right"?f.length:-f.length,n.segments[3].length=n.segments[3]._length=s=="vertical"?Math.abs(n.sourcePoint.x+o-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+o-n.segments[3]._endPoint.y),n.segments[3].length<0&&(o=f.direction=="bottom"||f.direction=="right"?f.length:-f.length,n.segments[3].length=n.segments[3]._length=s=="vertical"?Math.abs(n.sourcePoint.x+o-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+o-n.segments[3]._endPoint.y)));n.segments.splice(0,1);n.sourcePoint=this._findIntersection(r,i,n,n.sourcePoint,i.center,u)||n.sourcePoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,u)},_removeFirstSegment:function(n,i,r,u,f){var h,c,e=n.segments[1].direction||this._getBezierDirection(n.segments[1].points[0],n.segments[1].points[1]),o,l,s,a;e=="left"||e=="right"?(o=i._endPoint.y-r.middleRight.y,n.segments[0].direction=n.segments[0]._direction=o>=0?"bottom":"top",n.segments[0].length=n.segments[0]._length=Math.abs(o),l=e=="right"?n.segments[1]._endPoint.x-r.right:r.left-n.segments[1]._endPoint.x,n.sourcePoint=e=="left"?r.middleLeft:r.middleRight,h=Math.abs(n.sourcePoint.x-n.segments[0]._startPoint.x),c=Math.abs(n.sourcePoint.y-n.segments[0]._endPoint.y)):((n.segments[0].length||n.segments[0].length==0)&&(o=i._endPoint.x-r.bottomCenter.x,n.segments[0].direction=n.segments[0]._direction=o>=0?"right":"left",n.segments[0].length=n.segments[0]._length=Math.abs(o)),l=e=="bottom"?n.segments[1]._endPoint.y-r.bottom:r.top-n.segments[1]._endPoint.y,n.sourcePoint=e=="top"?r.topCenter:r.bottomCenter,h=Math.abs(n.sourcePoint.y-n.segments[0]._startPoint.y),c=Math.abs(n.sourcePoint.x-n.segments[0]._endPoint.x));n.segments[1]&&(n.segments[1].length||n.segments[1].length===0)&&(n.segments[1]._length=n.segments[1].length=l-25,n.segments[1]._length<0&&(n.segments.splice(0,2),(n.segments[0].length||n.segments[0].length===0)&&(n.segments[0].length=n.segments[0]._length=h),s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:c,direction:e})));s||(s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:25,direction:e}));a=[s];s._isInternal=!0;n.segments=a.concat(n.segments);n.sourcePoint=this._findIntersection(u,r,n,n.sourcePoint,r.center,f)||n.sourcePoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,f)},_dockNodeToPoint:function(n,t,i,r){var l,u,a,f,o,e,s,v,y,k,h;if(l=r?n.segments[n.segments.length-1]:n.segments[0],l.type!="orthogonal")u=this.bounds(i),this._swapBounds(i,u),this._setLineEndPoint(n,u.center,r),this._dockBounds(n,i,u,r);else{if(u=this.bounds(i),this._swapBounds(i,u),s=t,n.segments.length>1){var c=n.segments[n.segments.length-2],d=Math.abs(s.x-u.left),p=Math.abs(s.x-u.right),w=Math.abs(s.y-u.top),b=Math.abs(s.y-u.bottom);c&&r&&(v=c.direction=="left"||c.direction=="right",y=c.direction=="top"||c.direction=="bottom");l=r?n.segments[n.segments.length-1]:n.segments[0];l.points.length!=2&&c||l.type!="orthogonal"||(v=y=!1);u.bottom<s.y&&!v?(o="bottom",e="top",f=u.bottomCenter):u.y>s.y&&!v?(o="top",e="bottom",f=u.topCenter):u.right<s.x&&!y?(o="right",e="left",f=u.middleRight):u.x>s.x&&!y?(o="left",e="right",f=u.middleLeft):(h=d,f=u.middleLeft,o="left",e="right",h>=p&&p!=0&&(f=u.middleRight,o="right",e="left",h=p),h>w&&w!=0&&(f=u.topCenter,o="top",e="bottom",h=w),h>b&&b!=0&&(f=u.bottomCenter,o="bottom",e="top",h=b))}else{f=u.center;o=this._getBezierDirection(t,f);switch(o){case"left":e="right";break;case"right":e="left";break;case"top":e="bottom";break;case"bottom":e="top"}}f&&(r||n.segments.length==1?(a=n.segments[n.segments.length-1],a.type=="orthogonal"&&(a._direction=r?o:e)):a=n.segments[0],k=this._findEndPoint(o,f,i)||u.center,f=this._findIntersection(i,u,n,f,k,r)||f,r?n.targetPoint=f:n.sourcePoint=f,n.segments.length!=1&&this._addOrthogonalPoints(a,r?n.segments[n.segments.length-2]:null,r?null:n.segments[1],n.sourcePoint,n.targetPoint),this._setLineEndPoint(n,f,r))}},_getDockSegment:function(n,i,r,u,f,e){var o=this._getEdges(r,u),e="",s,h,c=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint);return(h=f?t.datavisualization.Diagram.LineSegment(i.points[i.points.length-2],i.points[i.points.length-1]):c>5?t.datavisualization.Diagram.LineSegment(i._startPoint,i._endPoint):t.datavisualization.Diagram.LineSegment(i._startPoint,n.segments[1]?n.segments[1]._endPoint:n.targetPoint),t.datavisualization.Diagram.Geometry.intersectSegment(h,o.left)?(s=o.left,e="left"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.top)?(s=o.top,e="top"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.right)?(s=o.right,e="right"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.bottom)&&(s=o.bottom,e="bottom"),e=this._swapDirection(r,e),s)?{dockPoint:t.datavisualization.Diagram.Geometry.midPoint(s),direction:e}:null},_dockBounds:function(n,t,i,r){var u,f,e,o;u=r?n.segments[n.segments.length-1]:n.segments[0];f=u._startPoint;e=u._endPoint||u.point;u.type=="bezier"&&(u.point1||u.point2)&&(r?f=u._point2:e=u._point1);o=this._findIntersection(t,i,n,f,e,r);o&&(this._setLineEndPoint(n,o,r),u.type==="bezier"&&this._updateBezierPoints(u))},_findIntersection:function(n,i,r,u,f,e){var o,v,l=e?r.segments[r.segments.length-1]:r.segments[0],s=n.connectorPadding,y,w,b,c,h,k,d,a,g,p,nt;if(s+=e?r.targetPadding:r.sourcePadding,l.type=="orthogonal"&&(u={x:u.x,y:u.y},u.x==f.x&&(u.y<f.y?u.y-=s+5:u.y+=s+5),u.y==f.y&&(u.x<f.x?u.x-=s+5:u.x+=s+5)),w=e||l.type=="orthogonal"?u:f,l.type!="orthogonal"&&(e?(y=t.datavisualization.Diagram.Geometry.findAngle(u,f),f=t.datavisualization.Diagram.Geometry.transform({x:f.x,y:f.y},y,Math.max(n.width/2,n.height/2))):(y=t.datavisualization.Diagram.Geometry.findAngle(f,u),u=t.datavisualization.Diagram.Geometry.transform({x:u.x,y:u.y},y,Math.max(n.width/2,n.height/2)))),n._shape==="ellipse")return p=t.datavisualization.Diagram.LineSegment(u,f),this._getEllipseIntersectCoords(n,p,r,w,e);if(n._shape!=="polygon"||n.type=="bpmn"&&l.type=="orthogonal")!n.pathData||n._shape!=="path"||n.type=="bpmn"&&l.type=="orthogonal"?((n.connectorPadding||r.sourcePadding||r.targetPadding)&&(g=t.datavisualization.Diagram.Rectangle(i.x-s,i.y-s,n.width+2*s,n.height+2*s),i=this.bounds(g)),o=i.points,o[o.length]=o[0],v=i.points.length):(n._segmentPoints||(a=this._findSegmentPoints(n,r,e)),o=a||n._segmentPoints,n.pathData.split("m").length-1+(n.pathData.split("M").length-1)==1&&(o[o.length]=o[0]),v=o.length);else{for(o=[],o=n._segmentPoints?n._segmentPoints:this._findSegmentPoints(n,r,e),n.rotateAngle&&(b=t.Matrix.identity(),t.Matrix.rotate(b,n.rotateAngle,n.offsetX,n.offsetY)),v=o.length,a=[],c=0;c<v;c++)h=t.datavisualization.Diagram.Point(o[c].x+(n.offsetX-n.width*n.pivot.x),o[c].y+(n.offsetY-n.height*n.pivot.y)),n.rotateAngle!=0&&(h=t.Matrix.transform(b,h)),(n.connectorPadding||r.sourcePadding||r.targetPadding)&&(k=n.offsetX==h.x?0:n.offsetX<h.x?1:-1,d=n.offsetY==h.y?0:n.offsetY<h.y?1:-1,h=s?t.datavisualization.Diagram.Geometry.translate(h,k*s,d*s):h),a[c]=h;o=a}return p=t.datavisualization.Diagram.LineSegment(u,f),nt=this._getIntersectionPoints(p,o,!0,w),nt},_getIntersectionPoints:function(n,i,r,u){var e,l=i.length,h=t.datavisualization.Diagram.LineSegment(i[0],i[1]),o=t.datavisualization.Diagram.Geometry.intersectSegment(n,h),f,s,c;if(o){if(!r)return o;f=t.datavisualization.Diagram.Geometry.distance(o,u)}if(isNaN(f)||f>0)for(e=1;e<l-1;e++)if(h=t.datavisualization.Diagram.LineSegment(i[e],i[e+1]),s=t.datavisualization.Diagram.Geometry.intersectSegment(n,h),s){if(!r)return s;if(c=t.datavisualization.Diagram.Geometry.distance(s,u),(isNaN(f)||f>c)&&(f=c,o=s),f>=0&&f<=1)break}return o},_findSegmentPoints:function(n,i,r){var e=[],o,f,y,u,l,a,p,v,h,c,w,s;if(n._shape=="path"){for(o=document.createElementNS("http://www.w3.org/2000/svg","svg"),o.setAttribute("xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(o),f=document.createElementNS("http://www.w3.org/2000/svg","path"),f.setAttributeNS(null,"d",n._absolutePath||n.pathData),o.appendChild(f),y=!n._absoluteBounds||n._scaled||n._absolutePath?f.getBBox():n._absoluteBounds,u=n.connectorPadding,i&&(u+=r?i.targetPadding:i.sourcePadding),u||!n._absolutePath||n._scaled?(l=t.datavisualization.Diagram.Geometry.updatePath(-u,-u,n.width+2*u,n.height+2*u,n._absolutePath||n.pathData,null,y,u?null:n),f.setAttributeNS(null,"d",l),(!n._scaled||u)&&n._absolutePath||(n._absolutePath=l,n._scaled=!1)):f.setAttributeNS(null,"d",n._absolutePath),a=t.Matrix.identity(),t.Matrix.rotate(a,n.rotateAngle,n.offsetX,n.offsetY),p=f.getTotalLength(),h=0;h<=p;h+=10)v=f.getPointAtLength(h),c={x:n.offsetX-n.width*n.pivot.x+v.x,y:n.offsetY-n.height*n.pivot.y+v.y},n.rotateAngle!=0&&(c=t.Matrix.transform(a,c)),e.push(c);document.body.removeChild(o)}else if(n._shape=="polygon"){for(w=n.points.length,s=0;s<w;s++)e[s]=n.points[s];t.datavisualization.Diagram.Geometry.updatePolygonPoints(n,e);e[e.length]=e[0]}else return null;return e},_getEdges:function(n,i){var u=i.points,r={},e=n%360,f;return r.left=t.datavisualization.Diagram.LineSegment(u[3],u[0]),r.top=t.datavisualization.Diagram.LineSegment(u[0],u[1]),r.right=t.datavisualization.Diagram.LineSegment(u[1],u[2]),r.bottom=t.datavisualization.Diagram.LineSegment(u[2],u[3]),e<0&&(e+=360),e>315||e<45||(e<135?(f=r.top,r.top=r.left,r.left=r.bottom,r.bottom=r.right,r.right=f):e<225?(f=r.top,r.top=r.bottom,r.bottom=f,f=r.left,r.left=r.right,r.right=f):(f=r.bottom,r.bottom=r.left,r.left=r.top,r.top=r.right,r.right=f)),r},_pointsFromNodeToPoint:function(n,t,i,r,u,f,e,o){var s=o?n._tarDecoratorSize:n._srcDecoratorSize,h=[],a,c,l;h.push(f);a=f.y==e.y&&(i=="left"&&e.x<f.x||i=="right"&&e.x>f.x)||f.x==e.x&&(i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y);a||(i=="top"||i=="bottom"?i=="top"&&e.y<f.y&&e.y>f.y-s||i=="bottom"&&e.y>f.y&&e.y<f.y+s?(c=i=="top"?r.top-s:r.bottom+s,h.push({x:f.x,y:c}),h.push({x:f.x+(e.x-f.x)/2,y:c}),h.push({x:f.x+(e.x-f.x)/2,y:e.y})):Math.abs(f.x-e.x)>s&&(i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y)?h.push({x:f.x,y:e.y}):i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y?Math.abs(f.x-e.x)<=s&&t.points.length>2?(c=i=="top"?r.top-s:r.bottom+s,h.push({x:f.x,y:c}),h.push({x:e.x,y:c})):e.x=f.x:Math.abs(f.x-e.x)<=s||(e.x<r.left||e.x>r.right)&&e.y!=f.y?(c=i=="top"?r.top-s:r.bottom+s,h.push({x:f.x,y:c}),h.push({x:e.x,y:c})):(c=i=="top"?r.top-s:r.bottom+s,l=e.x<f.x?r.left-s:r.right+s,h.push({x:f.x,y:c}),h.push({x:l,y:c}),h.push({x:l,y:e.y})):i=="left"&&e.x<f.x&&e.x>f.x-s||i=="right"&&e.x>f.x&&e.x<f.x+s?(l=i=="left"?r.left-s:r.right+s,h.push({x:l,y:f.y}),h.push({x:l,y:f.y+(e.y-f.y)/2}),h.push({x:e.x,y:f.y+(e.y-f.y)/2})):Math.abs(f.y-e.y)>s&&(i=="left"&&e.x<f.x||i=="right"&&e.x>f.x)?h.push({x:e.x,y:f.y}):i=="left"&&e.x<f.x||i=="right"&&e.x>f.x?Math.abs(f.y-e.y)<=s&&t.points.length>2?(l=i=="left"?r.left-s:r.right+s,h.push({x:l,y:f.y}),h.push({x:l,y:e.y})):e.y=f.y:Math.abs(f.y-e.y)<=s||(e.y<r.top||e.y>r.bottom)&&e.x!=f.x?(l=i=="left"?r.left-s:r.right+s,h.push({x:l,y:f.y}),h.push({x:l,y:e.y})):(c=e.y<f.y?r.top-s:r.bottom+s,l=i=="left"?r.left-s:r.right+s,h.push({x:l,y:f.y}),h.push({x:l,y:c}),h.push({x:e.x,y:c})));h.push(e);o&&h.reverse();t._startPoint=h[0];t._endPoint=h[h.length-1];t.points=h;t.direction&&(t.direction=="left"||t.direction=="right"?(t.length=t._length=Math.abs(t._startPoint.x-t._endPoint.x),t._direction=t._startPoint.x<t._endPoint.x?t.direction="right":t.direction="left"):(t.length=t._length=Math.abs(t._startPoint.y-t._endPoint.y),t._direction=t._startPoint.y<t._endPoint.y?t.direction="bottom":t.direction="top"))},_constructSegements:function(n,t,i,r,u,f,e,o){var s,l,h,c;for(o==="right"&&(u==="left"?s=this._rightToLeft(n,t,i,r,f,e,!1):u==="right"?s=this._rightToRight(n,i,r,f,e):u==="top"?s=this._rightToTop(n,i,r,f,e,!1):u==="bottom"&&(s=this._rightToBottom(n,i,r,f,e,!1))),o==="left"&&(u==="right"&&(s=this._rightToLeft(n,t,f,e,i,r,!0),l=!0),u==="left"&&(s=this._leftToLeft(n,i,r,f,e)),u==="top"&&(s=this._leftToTop(n,i,r,f,e,!1)),u==="bottom"&&(s=this._leftToBottom(n,i,r,f,e,!1))),o==="top"&&(u==="left"&&(s=this._leftToTop(n,f,e,i,r,!0),l=!0),u==="right"&&(s=this._rightToTop(n,f,e,i,r,!0),l=!0),u==="top"&&(s=this._topToTop(n,i,r,f,e)),u==="bottom"&&(s=this._topToBottom(n,t,i,r,f,e,!1))),o==="bottom"&&(u==="left"&&(s=this._leftToBottom(n,f,e,i,r,!0),l=!0),u==="right"&&(s=this._rightToBottom(n,f,e,i,r,!0),l=!0),u==="top"&&(s=this._topToBottom(n,t,f,e,i,r,!0),l=!0),u==="bottom"&&(s=this._bottomToBottom(n,i,r,f,e))),l&&s.reverse(),h=s[s.length-1],c=s[s.length-2];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(s.length-1,1),h=s[s.length-1],c=s[s.length-2];for(h=s[0],c=s[1];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(0,1),h=s[0],c=s[1];t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s},_updateIntermediateSegments:function(n){var u=n.segments[0]._endPoint,r=n.segments[0],f=r.points.length,i;n.segments[1]&&(i=n.segments[1],i._startPoint=u,i.type=="orthogonal"&&(i.length||i.length===0)?(i.direction=="left"||i.direction=="right"?(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="top"?n.segments[2].length+=i._startPoint.y-i._endPoint.y:n.segments[2].length-=i._startPoint.y-i._endPoint.y,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=n.segments[2]._direction=="bottom"?"top":"bottom"),n.segments[2]._length=n.segments[2].length),i._endPoint.y=i._startPoint.y):(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="left"?n.segments[2].length+=i._startPoint.x-i._endPoint.x:n.segments[2].length-=i._startPoint.x-i._endPoint.x,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=n.segments[2]._direction=="right"?"left":"right"),n.segments[2]._length=n.segments[2].length),i._endPoint.x=i._startPoint.x),n.sourcePort&&r.points.length>2&&(i.direction=="left"||i.direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.y=i._startPoint.y)):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.x=i._startPoint.x))),(i.length||i.length===0)&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i.points[1])),i.length>0&&(i.direction=i._direction=this._getBezierDirection(i._startPoint,i._endPoint)||i._direction),this._addOrthogonalPoints(i,r,n.segments[2],n.sourcePoint,n.targetPoint),n.segments[2]&&this._addOrthogonalPoints(n.segments[2],n.segments[1],n.segments[3],n.sourcePoint,n.targetPoint)):i.type=="orthogonal"&&i.length===null?(n.sourcePort&&r.points.length>2&&(i._direction=="left"||i._direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1]):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1])),i._startPoint=i.points[0]=n.segments[0]._endPoint,this._addOrthogonalPoints(n.segments[1],n.segments[0],null,n.sourcePoint,n.targetPoint)):(i._startPoint=i.points[0]=n.segments[0]._endPoint,i.type=="bezier"&&this._updateBezierPoints(i)))},_updatePreviousSegment:function(n){var i=n.segments[n.segments.length-2],r=n.segments[n.segments.length-1],u,f,e;i&&(i.type=="orthogonal"&&r.points.length>2&&(u=!1,f=i.points.length==2?i.direction:t.datavisualization.Diagram.Util._getBezierDirection(i.points[i.points.length-2],i.points[i.points.length-1]),f=="left"||f=="right"?r.points[0].y==r.points[1].y&&(u=!0,e=r.points[1].x-r.points[0].x,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0]):r.points[0].x==r.points[1].x&&(u=!0,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0])),i._endPoint=r._startPoint,i.points[i.points.length-1]=r._startPoint,i.type=="orthogonal"&&u?(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length>0&&(i._direction=i.direction=this._getBezierDirection(i._startPoint,i._endPoint)),(n.segments.length>2||!n.sourcePort)&&this._addOrthogonalPoints(i,n.segments[n.segments.length-3],r,n.sourcePoint,n.targetPoint)):i.point=r._startPoint)},_initConnectionEnds:function(n,i){var u,r,f,o,e;if(n.segments&&n.segments[0]&&n.segments[0].type=="orthogonal"&&n.segments[0].length){if(n.sourceNode&&(f=i.nameTable[n.sourceNode],f))if(r=t.datavisualization.Diagram.Util.bounds(f,!0),n.sourcePort)u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.sourceNode],n.sourcePort),n.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(u,r,undefined,f);else{e=n.segments[0];switch(e.direction){case"left":n.sourcePoint=r.middleLeft;break;case"right":n.sourcePoint=r.middleRight;break;case"top":n.sourcePoint=r.topCenter;break;case"bottom":n.sourcePoint=r.bottomCenter}}if(n.targetNode&&(o=i.nameTable[n.targetNode],o))if(r=t.datavisualization.Diagram.Util.bounds(o,!0),n.targetPort)u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.targetNode],n.targetPort),n.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(u,r,undefined,o);else{e=n.segments[0];switch(e.direction){case"left":n.targetPoint=r.middleLeft;break;case"right":n.targetPoint=r.middleRight;break;case"top":n.targetPoint=r.topCenter;break;case"bottom":n.targetPoint=r.bottomCenter}}}else n.sourceNode&&(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[n.sourceNode],!0),n.sourcePort?(u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.sourceNode],n.sourcePort),n.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(u,r,undefined,i.nameTable[n.sourceNode])):n.sourcePoint=r.center),n.targetNode&&(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[n.targetNode],!0),n.targetPort?(u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.targetNode],n.targetPort),n.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(u,r,undefined,i.nameTable[n.targetNode])):n.targetPoint=r.center)},_swapDirection:function(n,t){var u,i=n%360,r;return i<0&&(i+=360),i>315||i<45?u=t:i<135?(r={left:"top",top:"right",right:"bottom",bottom:"left"},u=r[t]):i<225?(r={left:"right",top:"bottom",right:"left",bottom:"top"},u=r[t]):(r={left:"bottom",top:"left",right:"top",bottom:"right"},u=r[t]),u},_getEllipseIntersectCoords:function(n,i,r,u,f){var a=[],o=n.connectorPadding,w,s,c,e,h,l;r&&(o+=f?r.targetPadding:r.sourcePadding);o||(o=0);var v=n.width/2,y=n.height/2,p=t.Matrix.identity();for(t.Matrix.rotate(p,n.rotateAngle,n.offsetX,n.offsetY),w="M "+(n.offsetX-n.width*n.pivot.x-o)+", "+n.offsetY+" A "+v+" "+y+" 0 0 1 "+(n.offsetX+n.width*(1-n.pivot.x)+o)+", "+n.offsetY+" A "+v+" "+y+" 0 0 1 "+(n.offsetX-n.width*n.pivot.x-o)+", "+n.offsetY+"z",s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttributeNS(null,"d",w),c=s.getTotalLength(),e=[],h=0;h<c;h=h+3)l=s.getPointAtLength(h),n.rotateAngle!=0&&(l=t.Matrix.transform(p,l)),e[e.length]=l;return e[e.length-1]!=s.getPointAtLength(c)&&(e[e.length]=s.getPointAtLength(c)),a=e,this._getIntersectionPoints(i,a,!0,u)},_rightToLeft:function(n,i,r,u,f,e,o){var c=[],h,s,a,l,v;return c.push(e),a=n._srcDecoratorSize,l=n._tarDecoratorSize,o&&(l=n._srcDecoratorSize,a=n._tarDecoratorSize),f.width==0&&(a=0),r.width==0&&(l=0),v=a+l,u.x>e.x?e.y!=u.y&&(e.x>r.left?(h=f.right+a,s=e.y,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y>f.top?u.y:r.bottom+l,c.push(t.datavisualization.Diagram.Point(h,s)),u.y<=f.top&&(h=r.right+l,c.push(t.datavisualization.Diagram.Point(h,s)),s=r.top-l,c.push(t.datavisualization.Diagram.Point(h,s)),h=r.left-l,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y,c.push(t.datavisualization.Diagram.Point(h,s)))):(h=i.direction||i.length==undefined?r.left-f.right>0?f.right+(r.left-f.right)/2:f.right+a:f.right+i.length,s=e.y,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y,c.push(t.datavisualization.Diagram.Point(h,s)))):(Math.abs(r.top-f.bottom)<v||Math.abs(r.bottom-f.top)<v?e.x>r.right?(h=e.x+a,s=e.y):(h=r.right+l,s=e.y):(h=f.right+a,s=e.y),c.push(t.datavisualization.Diagram.Point(h,s)),r.top-f.bottom>=v?(s=r.top-l,c.push(t.datavisualization.Diagram.Point(h,s))):e.y>u.y?(s=f.top-r.bottom<v?r.left>f.right?r.bottom+(f.top-r.bottom)/2:Math.min(r.top-l,f.top-a):r.bottom+l,c.push(t.datavisualization.Diagram.Point(h,s))):(s=r.left>f.right?r.bottom+(f.top-r.bottom)/2:Math.max(r.bottom+l,f.bottom+a),c.push(t.datavisualization.Diagram.Point(h,s))),h=r.left-l,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y,c.push(t.datavisualization.Diagram.Point(h,s))),c.push(u),c},_rightToRight:function(n,i,r,u,f){var s=[],e,o,c,h;return s.push(f),o=f.y,c=n._srcDecoratorSize,h=n._tarDecoratorSize,u.width==0&&(c=0),i.width==0&&(h=0),i.right>=u.left?f.y>=i.top-h&&f.y<=i.bottom+h?(e=f.x+c,s.push(t.datavisualization.Diagram.Point(e,o)),f.y>=i.center.y?(o=f.x>i.left?f.y>r.y?i.bottom+h:i.top-h:i.top-h,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o))):(o=i.bottom+h,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o)))):i.right<u.right?(e=u.right+c,s.push(t.datavisualization.Diagram.Point(e,o))):(e=r.x+h,s.push(t.datavisualization.Diagram.Point(e,o))):(e=f.x+c,s.push(t.datavisualization.Diagram.Point(e,o)),r.y>=u.top-c&&r.y<=u.bottom+c&&(r.y<=u.center.y?(o=u.top-c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o))):(o=u.bottom+c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o))))),s.push(t.datavisualization.Diagram.Point(e,r.y)),s.push(r),s},_rightToTop:function(n,i,r,u,f,e){var h=[],c,o,s,l,a;return h.push(f),o=f.y,s=n._srcDecoratorSize,l=n._tarDecoratorSize,e&&(l=n._srcDecoratorSize,s=n._tarDecoratorSize),u.width==0&&(s=0),i.width==0&&(l=0),a=s+l,r.x>=f.x+s?f.y+s>=r.y&&i.height!==0&&(c=i.left<=u.right?i.right+l:i.left-u.right>a?u.right+s:u.right+(i.left-u.right)/2,h.push(t.datavisualization.Diagram.Point(c,o)),o=i.top-l,h.push(t.datavisualization.Diagram.Point(c,o))):u.bottom+s>i.top-l?(c=f.x+s<=i.right?i.right+l:u.right+s,h.push(t.datavisualization.Diagram.Point(c,o)),o=u.top>=i.top?i.height!==0?i.top-l:r.y:u.top>=i.top-l?i.top-l-s:u.top-s,h.push(t.datavisualization.Diagram.Point(c,o))):(c=f.x+s,h.push(t.datavisualization.Diagram.Point(c,o)),i.top-u.bottom<a&&i.height!==0?u.left-i.right>=a?(o=u.bottom+s,h.push(t.datavisualization.Diagram.Point(c,o)),c=u.left-s,h.push(t.datavisualization.Diagram.Point(c,o)),o=i.top-l,h.push(t.datavisualization.Diagram.Point(c,o))):(o=i.top-(i.top-u.bottom)/2,h.push(t.datavisualization.Diagram.Point(c,o))):(o=i.height!==0?i.top-l:r.y,h.push(t.datavisualization.Diagram.Point(c,o)))),h.push(t.datavisualization.Diagram.Point(r.x,o)),h.push(r),h},_rightToBottom:function(n,i,r,u,f,e){var h=[],s,o,c,l,a;return h.push(f),o=f.y,c=n._srcDecoratorSize,l=n._tarDecoratorSize,e&&(l=n._srcDecoratorSize,c=n._tarDecoratorSize),u.width==0&&(c=0),i.width==0&&(l=0),a=c+l,r.x>=f.x?f.y<=i.bottom+l?i.left>u.right+c?(s=f.x+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=i.bottom+l,h.push(t.datavisualization.Diagram.Point(s,o))):(s=i.right+l,h.push(t.datavisualization.Diagram.Point(s,o)),o=i.bottom+l,h.push(t.datavisualization.Diagram.Point(s,o))):u.right+c>r.x?(s=f.x+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=u.top-i.bottom>a?i.bottom+l:i.bottom+(u.top-i.bottom)/2,h.push(t.datavisualization.Diagram.Point(s,o))):o=f.y:f.y<=i.bottom?(s=u.right+c>i.right?u.right+c:i.right+l,h.push(t.datavisualization.Diagram.Point(s,o)),o=i.bottom+l,o<=u.bottom+c&&(o=u.bottom+c),h.push(t.datavisualization.Diagram.Point(s,o))):i.bottom+l<u.top-c?(s=u.right+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=u.top-i.bottom<a?i.bottom+(u.top-i.bottom)/2:i.bottom+l,h.push(t.datavisualization.Diagram.Point(s,o))):(s=u.right+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=u.bottom+c,h.push(t.datavisualization.Diagram.Point(s,o))),h.push(t.datavisualization.Diagram.Point(r.x,o)),h.push(r),h},_leftToLeft:function(n,i,r,u,f){var s=[],e,o,c,h,l;return s.push(f),o=f.y,c=n._srcDecoratorSize,h=n._tarDecoratorSize,u.width==0&&(c=0),i.width==0&&(h=0),l=c+h,r.x-h>=f.x-c?(e=u.left-c,s.push(t.datavisualization.Diagram.Point(e,o)),f.y>r.y?r.y+h>=u.top?(o=u.top-c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.left-u.right>l?i.left-h:u.right+(i.left-u.right)/2,s.push(t.datavisualization.Diagram.Point(e,o))):(o=r.y,s.push(t.datavisualization.Diagram.Point(e,o)),e=r.x):u.bottom+c<r.y?(o=r.y,s.push(t.datavisualization.Diagram.Point(e,o)),e=r.x):(o=u.bottom+c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.left-u.right>l?i.left-h:u.right+(i.left-u.right)/2,s.push(t.datavisualization.Diagram.Point(e,o)))):(r.y>f.y?f.y>i.top-h&&(e=u.left-i.right<l?i.right+(u.left-i.right)/2:u.left-c,s.push(t.datavisualization.Diagram.Point(e,o)),o=i.top-h,s.push(t.datavisualization.Diagram.Point(e,o))):i.bottom+h>=f.y&&(e=u.left-i.right<l?i.right+(u.left-i.right)/2:u.left-c,s.push(t.datavisualization.Diagram.Point(e,o)),o=i.bottom+h,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.left-h,s.push(t.datavisualization.Diagram.Point(e,o))),e=i.left-h,s.push(t.datavisualization.Diagram.Point(e,o))),s.push(t.datavisualization.Diagram.Point(e,r.y)),s.push(r),s},_leftToTop:function(n,i,r,u,f,e){var h=[],l,c,o,s;return h.push(f),c=f.y,o=n._srcDecoratorSize,s=n._tarDecoratorSize,e&&(s=n._srcDecoratorSize,o=n._tarDecoratorSize),u.width==0&&(o=0),i.width==0&&(s=0),f.x<=r.x?(l=f.y>r.y&&i.left<=u.left?i.left-s:u.left-o,h.push(t.datavisualization.Diagram.Point(l,c)),c=u.bottom<=i.top?u.bottom+o<i.top-s?i.height!==0?i.top-s:r.y:r.x<u.right?u.bottom+(i.top-u.bottom)/2:u.top-o:u.top-o>=i.top-s?i.height!==0?i.top-s:r.y:u.top-o,h.push(t.datavisualization.Diagram.Point(l,c))):r.y<=f.y+o&&(l=u.left-o>i.right+s?u.left-o:i.right+s>=u.left-o?i.left-s:i.right+(u.left-i.right)/2,h.push(t.datavisualization.Diagram.Point(l,c)),c=i.top-s,h.push(t.datavisualization.Diagram.Point(l,c))),h.push(t.datavisualization.Diagram.Point(r.x,c)),h.push(r),h},_leftToBottom:function(n,i,r,u,f,e){var c=[],l,o,s,h,a;return c.push(f),o=f.y,s=n._srcDecoratorSize,h=n._tarDecoratorSize,e&&(h=n._srcDecoratorSize,s=n._tarDecoratorSize),u.width==0&&(s=0),i.width==0&&(h=0),a=s+h,f.x-s<=r.x?(l=i.left<=f.x&&f.y<=i.top?i.left-h:u.left-s,c.push(t.datavisualization.Diagram.Point(l,o)),i.bottom+h<u.top-s?(o=u.top-i.bottom<a?i.bottom+(u.top-i.bottom)/2:i.bottom+h,c.push(t.datavisualization.Diagram.Point(l,o))):(o=i.bottom<u.bottom?u.bottom+s:i.bottom+h,c.push(t.datavisualization.Diagram.Point(l,o)))):f.y-s>r.y||(l=i.right>=u.left?i.left-h:u.left-i.right<a?u.left-(u.left-i.right)/2:u.left-s,c.push(t.datavisualization.Diagram.Point(l,o)),o=i.bottom+h,c.push(t.datavisualization.Diagram.Point(l,o))),c.push(t.datavisualization.Diagram.Point(r.x,o)),c.push(r),c},_topToTop:function(n,i,r,u,f){var s=[],o,e,c,h,l;return s.push(f),o=f.x,c=n._srcDecoratorSize,h=n._tarDecoratorSize,u.width==0&&(c=0),i.width==0&&(h=0),l=c+h,r.x>=f.x?r.y-h>=f.y-c?(e=u.top-c,s.push(t.datavisualization.Diagram.Point(o,e)),r.x<=u.right&&(o=u.right+c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.height!==0?i.top-u.bottom>l?i.top-h:u.bottom+(i.top-u.bottom)/2:r.y,s.push(t.datavisualization.Diagram.Point(o,e)))):i.left<=f.x?(e=u.top-i.bottom>l?u.top-c:i.bottom+(u.top-i.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.left-h,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.top-h,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.height!==0?i.top-h:r.y,s.push(t.datavisualization.Diagram.Point(o,e))):r.y-h>=f.y-c?(e=u.top-c,s.push(t.datavisualization.Diagram.Point(o,e)),r.x>=u.left&&(o=u.left-c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.height!==0?i.top-u.bottom>l?i.top-h:u.bottom+(i.top-u.bottom)/2:r.y,s.push(t.datavisualization.Diagram.Point(o,e)))):i.right>=f.x?(e=u.top-i.bottom>l?u.top-c:i.bottom+(u.top-i.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.right+h,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.top-h,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.height!==0?i.top-h:r.y,s.push(t.datavisualization.Diagram.Point(o,e))),o=r.x,s.push(t.datavisualization.Diagram.Point(o,e)),s.push(r),s},_topToBottom:function(n,i,r,u,f,e,o){var h=[],c,s,l,a,v;return h.push(e),c=e.x,l=n._srcDecoratorSize,a=n._tarDecoratorSize,o&&(a=n._srcDecoratorSize,l=n._tarDecoratorSize),f.width==0&&(l=0),r.width==0&&(a=0),v=l+a,u.x>e.x?(f.top>=r.bottom?f.top-r.bottom>0?(s=i.length==undefined||i.direction?f.top-r.bottom>0?r.bottom+(f.top-r.bottom)/2:r.bottom+a:r.bottom+i.length,h.push(t.datavisualization.Diagram.Point(c,s))):(s=f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=r.left-f.right>=v?f.right+l:f.right+(r.left-f.right)/2,h.push(t.datavisualization.Diagram.Point(c,s)),s=r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))):(s=r.top<f.top?r.left>=f.right+l?f.top-l:r.top-a:f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=r.left>=f.right+l?f.right+l:r.right+a,h.push(t.datavisualization.Diagram.Point(c,s)),s=r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))),h.push(t.datavisualization.Diagram.Point(u.x,s))):u.x<e.x&&(f.top>=r.bottom?f.top-r.bottom>0?(s=i.length==undefined||i.direction?f.top-r.bottom>0?r.bottom+(f.top-r.bottom)/2:r.bottom+a:r.bottom+i.length,h.push(t.datavisualization.Diagram.Point(c,s))):(s=f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=f.left-r.right>=v?f.left-l:r.right+(f.left-r.right)/2,h.push(t.datavisualization.Diagram.Point(c,s)),s=r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))):(s=f.left-l>=r.right+a?f.top-l:f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=f.left>=r.right+a||f.right+l<r.right+a?r.right+a:f.right+l,h.push(t.datavisualization.Diagram.Point(c,s)),s=f.left>=r.right+a?r.bottom+a:r.bottom<=f.bottom?f.bottom+l:r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))),h.push(t.datavisualization.Diagram.Point(u.x,s))),h.push(u),h},_bottomToBottom:function(n,i,r,u,f){var s=[],o,e,h,c,l;return s.push(f),o=f.x,h=n._srcDecoratorSize,c=n._tarDecoratorSize,u.width==0&&(h=0),i.width==0&&(c=0),l=h+c,r.x>=f.x?u.bottom+h>=i.bottom+h?(e=u.bottom+h,s.push(t.datavisualization.Diagram.Point(o,e)),r.x<u.right&&(o=u.right+h,s.push(t.datavisualization.Diagram.Point(o,e)),e=u.top-h>=i.bottom+c?u.top-i.bottom>=l?i.bottom+c:i.bottom+(u.top-i.bottom)/2:i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e)))):f.x>i.left?(e=i.bottom-u.bottom>=l?u.bottom+h:u.bottom+(i.bottom-u.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.left-c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))):u.bottom+h>=i.bottom+h?(e=u.bottom+h,s.push(t.datavisualization.Diagram.Point(o,e)),r.x>u.left&&(o=u.left-h,s.push(t.datavisualization.Diagram.Point(o,e)),e=u.top-h>=i.bottom+c?u.top-i.bottom>=l?i.bottom+c:i.bottom+(u.top-i.bottom)/2:i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e)))):f.x<i.right?(e=i.bottom-u.bottom>=l?u.bottom+h:u.bottom+(i.bottom-u.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.right+c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))),s.push(t.datavisualization.Diagram.Point(r.x,e)),s.push(r),s},_addOrthogonalPoints:function(n,i,r,u,f,e){var v=[],o=i?i._endPoint:u,p,w,s,l,y;v.push(o);n._direction||(n._direction=this._getOrthoDirection(o,f,i));n._direction!=="auto"||i||r||(n._direction=this._getBezierDirection(o,f));var h=!e&&e!=0?this._directionToAngle(n._direction||this._getBezierDirection(o,f)):e,l=n._direction;if(l=="left"||l=="right"||l=="top"||l=="bottom")h={right:0,left:180,top:270,bottom:90,auto:90}[l];else switch(l){case"straight":h=0;break;case"clockWise90":h+=90;break;case"opposite":h+=180;break;case"antiClockWise90":h+=270}if((n.length||n.length==0)&&n.direction)s=t.datavisualization.Diagram.Geometry.transform(o,h||0,n._length),s.x=Math.round(s.x*100)/100,s.y=Math.round(s.y*100)/100,v.push(s),n._endPoint=s,r&&(r._startPoint=n._endPoint,r.points&&(r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r)));else{if(o.x!=f.x&&o.y!=f.y||i&&i._startPoint.x==f.x){var b=20,a=f.x-(s?s.x:o.x),c=f.y-(s?s.y:o.y);a=Math.abs(a)<=.0001?0:a;c=Math.abs(c)<=.0001?0:c;switch(h){case 0:if(f.x<o.x)break;w=Math.abs(o.x-f.x)<30;break;case 180:if(f.x>o.x)break;w=Math.abs(o.x-f.x)<30;break;case 90:if(f.y<o.y)break;w=Math.abs(o.y-f.y)<30;break;case 270:if(f.y>o.y)break;w=Math.abs(o.y-f.y)<30}i?p=i&&i._startPoint.x==f.x?3:a==0||c==0?2:3:(w?(b=h==90||h==270?Math.abs(o.y-f.y):Math.abs(o.x-f.x),p=2,b<10&&(b+=20,p=3)):p=3,(p!=2||Math.abs(c)>1&&Math.abs(a)>1)&&(s=t.datavisualization.Diagram.Geometry.transform(o,h,b)));p==3&&(l=n._direction=="auto"?i?i._direction=="left"||i.direction=="right"?"left":"top":"bottom":n._direction,l=="left"||l=="right"||c==0?(c=c>0?c:-c,y=t.datavisualization.Diagram.Geometry.transform(s||o,90,f.y-(s?s.y:o.y))):(a=a>0?a:-a,y=t.datavisualization.Diagram.Geometry.transform(s||o,0,f.x-(s?s.x:o.x))));s&&(s.x=Math.round(s.x*100)/100,s.y=Math.round(s.y*100)/100,v.push(s));y&&(y.x=Math.round(y.x*100)/100,y.y=Math.round(y.y*100)/100,v.push(y))}n._direction=this._getBezierDirection(v[v.length-1],f);v.push(f);n._endPoint=f;r&&(r._startPoint=n._endPoint,r.points||(r.points=[]),r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r))}return n.points=v,h},_getOrthoDirection:function(n,t,i){if(i){var r=t;return Math.abs(r.x-n.x)>Math.abs(r.y-n.y)&&i&&(i._direction=="left"||i._direction=="right")?n.x<r.x?"right":"left":n.y<r.y?"bottom":"top"}return n.y<t.y?"bottom":n.y>t.y?"top":n.x<t.x?"right":n.x>t.x?"left":void 0},_directionToAngle:function(n){return{right:0,left:180,top:270,bottom:90,auto:90}[n]},_resetOrthogonalPoints:function(n){var t=[],i;t.push(n.sourcePoint);t.push(n.targetPoint);n.points=[];n.sourcePoint=t[0];n.points.push(t[0]);i=this._constructOrthogonalPoints(t[0],t[1]);n.points.push(i[0]);n.points.push(i[1]);n.targetPoint=t[1];n.points.push(t[1])},_updateBezierPoints:function(n,i,r,u,f,e,o){var c,v={right:0,left:180,top:270,bottom:90},s,h,l,a;(n.vector1||n.vector2)&&(n.vector1&&(n._point1=t.datavisualization.Diagram.Geometry.transform(n._startPoint,n.vector1.angle,n.vector1.distance)),n.vector2&&(n._point2=t.datavisualization.Diagram.Geometry.transform(n._endPoint,n.vector2.angle,n.vector2.distance)));(n.point1!=null||n.vector1)&&(n.point2!=null||n.vector2)||(s=n._endPoint,h=n._startPoint,e?(c=o,h=this._getPortPosition(e,c),f.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,f.rotateAngle,f.offsetX,f.offsetY),h=t.Matrix.transform(a,h)),l=this._getDirection(c,h,!0)):l=this._getBezierDirection(h,s),n.vector1||(n._point1=n.point1||this._getBezierAdjPoint(v[l],n._startPoint,n._endPoint)),r?(c=u,s=this._getPortPosition(r,c),i.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,i.rotateAngle,i.offsetX,i.offsetY),s=t.Matrix.transform(a,s)),l=this._getDirection(c,s,!0)):l=this._getBezierDirection(s,h),n.vector2||(n._point2=n.point2||this._getBezierAdjPoint(v[l],n._endPoint,n._startPoint)))},_getBezierDirection:function(n,t){return Math.abs(t.x-n.x)>Math.abs(t.y-n.y)?n.x<t.x?"right":"left":n.y<t.y?"bottom":"top"},_findDocAngle:function(n,t){var r={x:t.x,y:n.y},e=this.findLength(n,r),u=this.findLength(r,t),f=this.findLength(t,n),i=Math.asin(u/f);return i=isNaN(i)?0:i,i=i*180/Math.PI,n.x<t.x?n.y<t.y||(i=360-i):i=n.y<t.y?180-i:180+i,i},_getDirection:function(n,i,r){var e=n.center,h,f,o,c,s,u,a,l;return r?(a=n.points,l=r?45:180/(2+2/(n.height/n.width)),h=l,f=180-l,o=f+2*l,c=360-l,u=t.datavisualization.Diagram.Geometry.findAngle(i,e),s=u>h&&u<f?"top":u>f&&u<o?"right":u>o&&u<c?"bottom":"left"):(u=this._findDocAngle(e,i),h=this._findDocAngle(e,n.bottomRight),f=this._findDocAngle(e,n.bottomLeft),o=this._findDocAngle(e,n.topLeft),c=this._findDocAngle(e,n.topRight),u>o&&u<c?s="top":u>=h&&u<f?s="bottom":u>=f&&u<=o?s="left":(u>=c||u<h)&&(s="right")),s},_getBezierAdjPoint:function(n,i,r){var u=60,f=t.datavisualization.Diagram.Point(0,0),e=n>45&&n<135?"Bottom":n>135&&n<225?"Left":n>225&&n<315?"Top":"Right";switch(e){case"Right":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x+u,i.y);break;case"Bottom":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y+u);break;case"Left":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x-u,i.y);break;case"Top":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y-u)}return f},_setLineEndPoint:function(n,t,i){var o=n,u,r,e,f;t.x=Math.round(t.x*100)/100;t.y=Math.round(t.y*100)/100;i?(u=n.segments[n.segments.length-1],o.targetPoint=t,u.type!="orthogonal"&&(u.point&&(u.point=t),u._point=t),u.points[u.points.length-1]=t,u._endPoint=t):(o.sourcePoint=t,r=n.segments[0],r.points[0]=t,r._startPoint=t,r.type!="orthogonal"||n.sourcePort||n._staticLength||(r.length||r.length===0)&&r.direction&&r.points.length==2&&(r._direction=="left"||r._direction=="right"?(r._endPoint.y=r._startPoint.y,e=Math.abs(r._startPoint.x-r._endPoint.x)):(r._endPoint.x=r._startPoint.x,e=Math.abs(r._startPoint.y-r._endPoint.y)),n.segments[0]._length=e,n.segments[0].length=n.segments[0]._length,n.segments[0].direction=n.segments[0]._direction));f=i?n.segments[n.segments.length-1]:n.segments[0];f.type!=="orthogonal"||(i||n.sourcePort)&&(!i||n.targetPort)||n.sourceNode&&n.targetNode&&!(n.segments.length>1)?f.type==="bezier"&&this._updateBezierPoints(f):(f.points=[],this._addOrthogonalPoints(f,i?n.segments[n.segments.length-2]:null,i?null:n.segments[1],n.sourcePoint,n.targetPoint))},_setBezierPoint:function(n,i,r){r==="bezierpoint1"?n.vector1?(n.vector1={distance:t.datavisualization.Diagram.Geometry.distance(n._startPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._startPoint,i)},n._point1=i):n.point1=n._point1=i:n.vector2?(n.vector2={distance:t.datavisualization.Diagram.Geometry.distance(n._endPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._endPoint,i)},n._point2=i):n.point2=n._point2=i},_setPoints:function(n,t){n.sourcePoint=n.points[0]=t[0];n.targetPoint=n.points[n.points.length-1]=t[t.length-1];n.points=t;n.type==="bezier"&&(n.point1=t[2]||n.point1,n.point2=t[3]||n.point2,n.point1||(n._point1=n.point1),n.point2||(n._point2=n.point2),this._updateBezierPoints(n))},_updateConnectorSegments:function(n,i,r,u){for(var o,s=n.sourcePoint,f=0;f<n.segments.length;f++){var e=n.segments[f],h=n.segments[f-1],c=n.segments[f+1];e._startPoint=h?h._endPoint:s;f==0&&i||f==n.segments.length-1&&r||(e.type=="orthogonal"?o=t.datavisualization.Diagram.Util._addOrthogonalPoints(e,h,c,n.sourcePoint,n.targetPoint,o):(o=t.datavisualization.Diagram.Geometry.findAngle(s,e._endPoint),e.type=="bezier"&&this._updateBezierPoints(e)));s=e._endPoint}u&&u._dock(n,u.nameTable)},_translateLine:function(n,i,r){for(var u,f,e=0;e<n.segments.length;e++){for(u=n.segments[e],f=0;f<u.points.length;f++)f==0?(u._startPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==0&&(n.sourcePoint=u._startPoint)):f==u.points.length-1?(u._endPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==n.segments.length-1&&(n.targetPoint=u._endPoint)):u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r);u.type===t.datavisualization.Diagram.Segments.Bezier?(u._point1=t.datavisualization.Diagram.Geometry.translate(u._point1,i,r),u._point2=t.datavisualization.Diagram.Geometry.translate(u._point2,i,r),u.point1&&(u.point1=u._point1),u.point2&&(u.point2=u._point2),u.point&&(u.point=u._endPoint),u._point=u._endPoint):u.type=="straight"&&(u.point&&(u.point=u._endPoint),u._point=u._endPoint)}},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},_getIconPosition:function(n,i,r){var o,s,f,e,u,h,c;if(n)return o=n.margin.left-n.margin.right,s=n.margin.top-n.margin.bottom,f=n.offset.x,e=n.offset.y,r?(u=t.datavisualization.Diagram.Point(i.width*f+o,i.height*e+s),(u.x>i.width||u.y>i.height)&&(u=t.datavisualization.Diagram.Point(i.width*f,i.height*e)),u):(h=i.center.x-i.width/2+i.width*f+o,c=i.center.y-i.height/2+i.height*e+s,t.datavisualization.Diagram.Point(h,c))},_rBounds:function(n,i){var r={},u,e,f;return(n?(r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height,r.rotateAngle=i):r=t.datavisualization.Diagram.Rectangle(),r)?(u={},r.x=Math.round(r.x*100)/100,r.y=Math.round(r.y*100)/100,r.width=Math.round(r.width*100)/100,r.height=Math.round(r.height*100)/100,u.width=r.width,u.height=r.height,u.x=u.left=r.x,u.right=r.x+r.width,u.y=u.top=r.y,u.bottom=r.y+r.height,u.center={x:r.x+r.width/2,y:r.y+r.height/2},u.topLeft={x:r.x,y:r.y},u.topCenter={x:r.x+r.width/2,y:r.y},u.topRight={x:r.x+r.width,y:r.y},u.middleLeft={x:r.x,y:r.y+r.height/2},u.middleRight={x:r.x+r.width,y:r.y+r.height/2},u.bottomLeft={x:r.x,y:r.y+r.height},u.bottomCenter={x:r.x+r.width/2,y:r.y+r.height},u.bottomRight={x:r.x+r.width,y:r.y+r.height},r&&r.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,r.rotateAngle,r.x+r.width/2,r.y+r.height/2),u.topLeft=t.Matrix.transform(e,u.topLeft),u.topCenter=t.Matrix.transform(e,u.topCenter),u.topRight=t.Matrix.transform(e,u.topRight),u.middleLeft=t.Matrix.transform(e,u.middleLeft),u.middleRight=t.Matrix.transform(e,u.middleRight),u.bottomLeft=t.Matrix.transform(e,u.bottomLeft),u.bottomCenter=t.Matrix.transform(e,u.bottomCenter),u.bottomRight=t.Matrix.transform(e,u.bottomRight),f=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),u.x=u.left=f.x,u.y=u.top=f.y,u.right=f.x+f.width,u.bottom=f.y+f.height,u.center=t.datavisualization.Diagram.Point(f.x+f.width/2,f.y+f.height/2),u.width=-u.topLeft.x+u.right,u.height=-u.topRight.y+u.bottom),u.points=[u.topLeft,u.topRight,u.bottomRight,u.bottomLeft],u):r},_getLabelPosition:function(n,i,r,u,f,e){var c,h,o,s;return e&&(c=e.getBBox(),h=this._rBounds(c,n.rotateAngle)),o=i.width*(r?r.x:n.offset.x),s=i.height*(r?r.y:n.offset.y),n.horizontalAlignment=="left"?o+=n.margin.left:n.horizontalAlignment=="right"?o-=n.margin.right:o+=n.margin.left-n.margin.right+(f?-((h?h.width:i.width)/2):0),n.verticalAlignment=="top"?s+=n.margin.top:n.verticalAlignment=="bottom"?s-=n.margin.bottom:s+=n.margin.top-n.margin.bottom+(u?n.fontSize/2:0),t.datavisualization.Diagram.Point(o,s)},_getPortPosition:function(n,i,r,u){var f,c,l;if(n){var s=(n.margin.left?n.margin.left:0)+(n.margin.right?n.margin.right:0),h=(n.margin.top?n.margin.top:0)+(n.margin.bottom?n.margin.bottom:0),e=n.offset.x,o=n.offset.y;return u&&(f=u.flip!=="none"?u.flip:u._flip,f&&f!==t.datavisualization.Diagram.FlipDirection.None&&(f===t.datavisualization.Diagram.FlipDirection.Horizontal?e=1-n.offset.x:f===t.datavisualization.Diagram.FlipDirection.Vertical?o=1-n.offset.y:f===t.datavisualization.Diagram.FlipDirection.Both&&(e=1-n.offset.x,o=1-n.offset.y))),r?t.datavisualization.Diagram.Point(i.width*n.offset.x+s,i.height*n.offset.y+h):(c=i.center.x-i.width/2+i.width*e+s,l=i.center.y-i.height/2+i.height*o+h,t.datavisualization.Diagram.Point(c,l))}},flipConnector:function(n,i){var r,u;i&&i!==t.datavisualization.Diagram.FlipDirection.None&&(n.sourceNode||n.targetNode||(i==t.datavisualization.Diagram.FlipDirection.Horizontal?(r={x:n.targetPoint.x,y:n.sourcePoint.y},u={x:n.sourcePoint.x,y:n.targetPoint.y}):i==t.datavisualization.Diagram.FlipDirection.Vertical?(r={x:n.sourcePoint.x,y:n.targetPoint.y},u={x:n.targetPoint.x,y:n.sourcePoint.y}):i==t.datavisualization.Diagram.FlipDirection.Both&&(r=n.targetPoint,u=n.sourcePoint),r&&u&&(this._setLineEndPoint(n,r,!1),this._setLineEndPoint(n,u,!0))))},_translate:function(n,i,r,u,f,e){var h,o,s;if(n.segments)t.datavisualization.Diagram.Util._translateLine(n,i,r,n);else if(n.offsetX+=i,n.offsetY+=r,n._type==="group"&&!f){for(h=e._getChildren(n.children),s=0;s<h.length;s++)o=u[h[s]],this._translate(o,i,r,u,null,e),o.parent&&o.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(u[o.parent],e);n._type!="group"&&n.container&&t.datavisualization.Diagram.Util._updateGroupBounds(n,e)}},scale:function(n,i,r,u,f,e,o,s,h){var nt,b,v,c,w,a,d,g,l;if(n.container)switch(n.container.type){case"canvas":a={};l=t.Matrix.identity();t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));y=n.width*i;p=n.height*r;o&&(n.minHeight=p,n.minWidth=y);s!=!0?a=h._getMinMaxSize(n,y,p):(a.width=y,a.height=p);a&&a.width>1&&(d=n.offsetX-n.width/2,n.width=a.width,n.offsetX=d+n.width/2);a&&a.height>1&&(g=n.offsetY-n.height/2,n.height=a.height,n.offsetY=g+n.height/2);break;case"stack":l=t.Matrix.identity();t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));y=n.width*i-(n.marginLeft+n.marginRight);p=n.height*r-(n.marginTop+n.marginBottom);a=h._getMinMaxSize(n,y,p);a.width>1&&(d=n.offsetX-n.width/2,n.width=a.width-n.marginLeft,n.offsetX=d+n.width/2+n.marginLeft);a.height>1&&(g=n.offsetY-n.height/2,n.height=a.height-n.marginTop,n.offsetY=g+n.height/2+n.marginTop);t.datavisualization.Diagram.SvgContext._alignOnStack(n,h)}else if(l=t.Matrix.identity(),n.segments)for(t.Matrix.scale(l,i,r,u.x,u.y),v=0;v<n.segments.length;v++){for(c=n.segments[v],w=0;w<c.points.length;w++)c.points[w]=t.Matrix.transform(l,c.points[w]),v!=0||w!=0||n.sourceNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(n,t.Matrix.transform(l,n.sourcePoint),!1)),v!=n.segments.length-1||w!=c.points.length-1||n.targetNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],n.targetPoint=c._endPoint);c._startPoint=c.points[0];c._endPoint=c.points[c.points.length-1];c.type=="orthogonal"?c.length||c.length===0?c.length=c._length=t.datavisualization.Diagram.Geometry.distance(c._startPoint,c._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(c,n.segments[v-1],n.segments[v+1],n.sourcePoint,n.targetPoint):(c.point&&(c.point=c._endPoint),c._point=c._endPoint)}else if(n._type==="group"){for(nt=h._getChildren(n.children),v=0;v<nt.length;v++)b=f[nt[v]],b&&(this.scale(b,i,r,u,f,undefined,undefined,undefined,h),b.parent&&b.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(f[b.parent],h));t.datavisualization.Diagram.Util._updateGroupBounds(n,h)}else{t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);var k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),y=n.width*i,p=n.height*r;y>1&&(n.width=y,n.offsetX=k.x);p>1&&(n.height=p,n.offsetY=k.y)}},_getIntersectingElement:function(n,i){for(var u,f,r,h,o=t.datavisualization.Diagram.SpatialUtil.findQuads(n._spatialSearch,i),s=[],e=0;e<o.length;e++)if(u=o[e],u.objects.length>0)for(f=0;f<u.objects.length;f++)r=u.objects[f],r.visible&&(h=t.datavisualization.Diagram.Util.bounds(r),t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&(r=n._sortByZIndex(r,!0),s.push(r)));return s},_getIntersectingNodeElement:function(n,i){for(var u,f,r,h,o=t.datavisualization.Diagram.SpatialUtil.findQuads(n._spatialSearch,i),s=[],e=0;e<o.length;e++)if(u=o[e],u.objects.length>0)for(f=0;f<u.objects.length;f++)r=u.objects[f],r.visible&&(h=t.datavisualization.Diagram.Util.bounds(r),t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&(r=n._sortByZIndex(r,!0),r.segments||s.push(r)));return s},_updateChildBounds:function(n,i){var u,f,e,o,r,s,h;e=n.width;o=n.height;u=n.offsetX;f=n.offsetY;r=t.datavisualization.Diagram.Util._getChildrenBounds(n,i);n.offsetX=r.x+r.width/2;n.offsetY=r.y+r.height/2;n.height=r.height;n.width=r.width;s=e/n.width;h=o/n.height;this.scale(n,s,h,n.pivot,i.nameTable,null,null,null,i);this._translate(n,u-n.offsetX,f-n.offsetY,i.nameTable,null,i)},_updateGroupBounds:function(n,i,r,u){var h,c,o,a,v,e,s;if(n&&!n.container&&n&&(n.type==="pseudoGroup"||n.children&&n.children.length>0)){h=n.width;c=n.height;o=n.offsetX;a=n.offsetY;u&&this._updateRotateAngle(n,i.nameTable);var f=this._getChildrenBounds(n,i,r),y=f.x+f.width*n.pivot.x,p=f.y+f.height*n.pivot.y,l={x:y,y:p};if(n.rotateAngle&&(!i._isNodeInitializing||i._isGroupNode)&&(v=t.Matrix.identity(),t.Matrix.rotate(v,n.rotateAngle),l=t.Matrix.transform(v,l)),f&&(n.offsetX=l.x,n.offsetY=l.y,n.width=f.width,n.height=f.height),r){if(e=null,n.children&&n.children.length>0)for(s=0;s<n.children.length;s++)i._getChild(n.children[s])&&(e=i.nameTable[i._getChild(n.children[s])]),e&&(e._type==="group"||e.children&&e.children.length>0)&&this._updateGroupBounds(e,i,r);h&&h!=n.width&&i.scale(n,h/n.width,1,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),i.nameTable,undefined,undefined,undefined,i);c&&c!=n.height&&i.scale(n,1,c/n.height,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),i.nameTable,undefined,undefined,undefined,i);o&&o!=n.offsetX&&i._translate(n,o-n.offsetX,1,i.nameTable,undefined);o&&a!=n.offsetY&&i._translate(n,1,a-n.offsetY,i.nameTable,undefined)}}},_getChildrenBounds:function(n,i,r){var f=i._getChildren(n.children),e,o=t.datavisualization.Diagram.Rectangle(),u,s,h;for(f.length>0&&(u=i.nameTable[f[0]],u&&(o=this._rotateChildBounds(u,n,i))),s=0,h=f.length;s<h;s++)u=i.nameTable[f[s]],u&&(i.selectedItem||!u._isInternalShape)&&(u._type==="group"?(this._updateGroupBounds(u,i,r),e=this._rotateChildBounds(u,n,i)):e=this._rotateChildBounds(u,n,i)),e&&(o=t.datavisualization.Diagram.Geometry.union(o,e));return o},_updateRotateAngle:function(n,t){var i,r;if(n.offsetX==0&&n.offsetY==0&&n.width==0&&n.height==0)for(i=0;i<n.children.length;i++)if(r=t[n.children[i]],r&&!r.segments&&!n.rotateAngle){n.rotateAngle=r.rotateAngle;return}},_rotateChildBounds:function(n,i,r){var f,u;if(n.segments||(i.rotateAngle||n.rotateAngle)&&(!r._isNodeInitializing||r._isGroupNode)){f=this.bounds(n);u=t.Matrix.identity();t.Matrix.rotate(u,-i.rotateAngle);var e=t.Matrix.transform(u,f.topLeft),o=t.Matrix.transform(u,f.topRight),s=t.Matrix.transform(u,f.bottomLeft),h=t.Matrix.transform(u,f.bottomRight),c=Math.min(e.x,o.x,s.x,h.x),l=Math.min(e.y,o.y,s.y,h.y);return{x:c,width:Math.max(e.x,o.x,s.x,h.x)-c,y:l,height:Math.max(e.y,o.y,s.y,h.y)-l}}return{x:n.offsetX-(n.width||n._width)*n.pivot.x,y:n.offsetY-(n.height||n._height)*n.pivot.y,width:n.width||n._width,height:n.height||n._height}},_emptyBridging:function(n,i){var u,r,f,o,e;if(n&&n.length>0&&i)for(u=0;u<n.length;u++)if(r=i.nameTable[i._getChild(n[u])],r){for(f=0;f<r.segments.length;f++)for(o=r.segments[f]._bridges,e=0;e<o.length;e++)o.splice(e,1);t.datavisualization.Diagram.DiagramContext.update(r,i)}},updateBridging:function(i,r,u){var at,vt,e=[],p,bt,ft,et,ot,c,ii,st,w,b,ri,ui,ct,dt,ei,tt,gt,ni,oi,h,nt,y,v,o,si,d,ut,a,ti,s,k,g,hi,ci;if(u&&u.length){if(i.segments.length>0)for(h=0;h<i.segments.length;h++)for(y=i.segments[h]._bridges,p=0;p<y.length;p++)y[p]._target==u[0].name?y.splice(p,1):this.findLength(y[p].startPoint,y[p].endPoint)>u[0].bridgeSpace&&(r.nameTable[y[p]._target]&&u.push(r.nameTable[y[p]._target]),y.splice(p,1))}else if(i.segments.length>0)for(h=0;h<i.segments.length;h++)i.segments[h]._bridges=[];if(u||this._emptyBridging(i._intersects,r),i._intersects=[],r.pluginName!=="ejSymbolPalette"&&t.datavisualization.Diagram.Util.canBridge(i,r)){var yt=this.getPoints(i),l=i.bridgeSpace,pt=r.bridgeDirection(),wt=-1;if(at=u&&r.boundaryTable[i.name]?r.boundaryTable[i.name]:t.datavisualization.Diagram.Util.bounds(i),r.boundaryTable[i.name]=at,u&&u.length>0)for(ft=[],v=0;v<u.length;v++)bt=r.nameTable[r._getChild(u[v])],bt&&ft.push(bt);if(et=ft?ft:r._getConnectors(),et.length>0)for(ot=0;ot<et.length;ot++)if(c=et[ot],t.datavisualization.Diagram.Util.canBridgeObstacle(c,r)&&i&&i.segments&&i.segments.length>0&&i.segments[0].type!="bezier"&&c&&c.segments&&c.segments.length>0&&c.segments[0].type!="bezier"&&c.segments&&c.visible&&i.name!==c.name&&(vt=r.boundaryTable[c.name]?r.boundaryTable[c.name]:t.datavisualization.Diagram.Util.bounds(c),r.boundaryTable[c.name]=vt,t.datavisualization.Diagram.Geometry.intersectsRect(at,vt)&&(ii=this.getPoints(c),st=this.interSect(yt,ii,!1,r,!0),i._intersects.push(c.name),st.length>0)))for(v=0;v<st.length;v++){var kt=0,f=0,it=0,rt=0,ht=this.getLengthAtFractionPoint(i,st[v]);if((it=ht.lengthAtFractionPt,kt=ht.fullLength,f=ht.segmentIndex,rt=ht.pointIndex,!(f<0))&&i.segments[0])if(ri=(it-l/2)/kt,w=this.getPointAtLength(it-l/2,yt),ri=(it+l/2)/kt,b=this.getPointAtLength(it+l/2,yt),t.datavisualization.Diagram.Geometry.isEmptyPoint(b)&&(b=w),ui=f===0?i.sourcePoint:i.segments[f-1]._endPoint,k=i.segments[f].type==="straight"?i.segments[f]._point:i.segments[f].points[rt],ct=this._findAngle(ui,k),e.length>f&&e[f]!=null){dt=f===0?i.sourcePoint:i.segments[f-1]._endPoint;var li=Math.abs(this.findLength(dt,b)),fi=0,lt=-1;for(wt=-1,s=0;s<e[f].bridges.length;s++)if(wt++,ei=e[f].bridges[s],fi=Math.abs(this.findLength(dt,ei.endPoint)),li<fi){lt=wt;break}lt>=0?(tt=this.createSegment(w,b,ct,pt,rt,i,r),tt._target=c.name,e[f].bridges.splice(lt,0,tt),e[f].bridges.join(),e[f].bridgeStartPoint.splice(lt,0,w),e[f].bridgeStartPoint.join(),e[f].segmentIndex=f):(tt=this.createSegment(w,b,ct,pt,rt,i,r),tt._target=c.name,e[f].bridges.push(tt),e[f].bridgeStartPoint.push(w),e[f].segmentIndex=f)}else isNaN(w.x)||isNaN(w.y)||t.datavisualization.Diagram.Geometry.isEmptyPoint(b)||(gt=this.createSegment(w,b,ct,pt,rt,i,r),gt._target=c.name,ni=[],oi=[],ni.push(w),oi.push(b),e.length<f+1,e[f]=n.extend(!0,{},t.datavisualization.Diagram.BridgeSegments,{}),e[f].bridges.push(gt),e[f].bridgeStartPoint=ni,e[f].segmentIndex=f)}if(u&&u.length&&i.segments.length>0)for(h=0;h<i.segments.length;h++)nt=i.segments[h],y=i.segments[h]._bridges,e[h]||(e[h]=n.extend(!1,{},t.datavisualization.Diagram.BridgeSegments),e[h].segmentIndex=h),e[h].bridges=e[h].bridges.concat(y).sort(function(n,t){return nt._startPoint.x!=nt._endPoint.x?nt._startPoint.x<nt._endPoint.x?n.startPoint.x-t.startPoint.x:t.startPoint.x-n.startPoint.x:nt._startPoint.y<nt._endPoint.y?n.startPoint.y-t.startPoint.y:t.startPoint.y-n.startPoint.y}),e[h].bridgeStartPoint=e[h].bridges.map(function(n){return n.startPoint}),i.segments[h]._bridges=[];if(e.length!=0)for(v=0;v<e.length;v++)if(o=e[v],o){for(s=1;s<o.bridges.length;s++)this.findLength(o.bridges[s].endPoint,o.bridges[s-1].endPoint)<l&&(o.bridges[s-1].endPoint=o.bridges[s].endPoint,a=o.bridges[s-1],si=r.getBridgeSegment(a.startPoint,a.endPoint,a.angle,l,a.sweep),o.bridges[s-1].path=si,u&&u.length&&o.bridges[s-1]._target==u[0].name&&(o.bridges[s-1]._target=o.bridges[s]._target),o.bridges.splice(s,1),o.bridgeStartPoint.splice(s,1),s--);for(d=i.sourcePoint,ut=0;ut<o.bridges.length;ut++){for(a=o.bridges[ut],ti=!0,s=0;u&&s<u.length;s++)a._target==u[s].name&&(ti=!1);ti?(i.segments[o.segmentIndex]._bridges.push(a),d=a.endPoint):(i.segments[o.segmentIndex].type==="straight"?k=i.segments[o.segmentIndex]._endPoint:i.segments[o.segmentIndex].type==="orthogonal"&&(k=i.segments[o.segmentIndex].points[a.segmentPointIndex]),f!=0&&(d=i.segments[o.segmentIndex]._endPoint),g=[],g.push(t.datavisualization.Diagram.Point(k.x-l,k.y-l)),g.push(t.datavisualization.Diagram.Point(k.x+l,k.y+l)),hi=t.datavisualization.Diagram.Geometry.rect(g),g=[],g.push(t.datavisualization.Diagram.Point(d.x-l,d.y-l)),g.push(t.datavisualization.Diagram.Point(d.x+l,d.y+l)),ci=t.datavisualization.Diagram.Geometry.rect(g),t.datavisualization.Diagram.Geometry.containsPoint(hi,o.bridgeStartPoint[ut])||t.datavisualization.Diagram.Geometry.containsPoint(ci,a.endPoint)||(i.segments[o.segmentIndex]._bridges.push(a),d=a.endPoint))}}}},createSegment:function(i,r,u,f,e,o,s){var l,c,h=n.extend(!1,{},t.datavisualization.Diagram.PathSegment);return c=this.sweepDirection(u,f,o,s),l=s.getBridgeSegment(i,r,u,o.bridgeSpace,c),h.path=l,h.startPoint=i,h.endPoint=r,h.angle=u,h.segmentPointIndex=e,h.sweep=c,h},sweepDirection:function(n,t){var r=Math.abs(n),i;return t==="top"||t==="bottom"?(i=1,r>=0&&r<=90&&(i=0)):(t==="right"||t==="left")&&(i=1,n<0&&n>=-180&&(i=0)),(t==="right"||t==="bottom")&&(i=i===0?1:0),i},getPointAtLength:function(n,i){for(var u,o,f=0,r=null,s=t.datavisualization.Diagram.Point(0,0),e=0;e<i.length;e++){if(u=i[e],r)if(o=this.findLength(r,u),f+o>n){var h=n-f,c=this.findAngle(r,u),l=h*Math.cos(c*Math.PI/180),a=h*Math.sin(c*Math.PI/180);s=t.datavisualization.Diagram.Point(r.x+l,r.y+a);break}else f+=o;else{r=u;continue}r=u}return s},getLengthAtFractionPoint:function(n,t){var c=100,o=0,l=-1,a=0,v=0,y=-1,f,e,s,w,i,r,h;if(n.segments===null)return 0;var b=n.segments,u=n.sourcePoint,p=u;for(f=0;f<n.segments.length;f++){for(e=[],s=n.segments[f],i=0;i<s.points.length;i++)w=s.points[i],e.push(w);for(i=0;i<e.length;i++)r=e[i],h=this.getSlope(r,u,t,n),h<c&&(c=h,v=o+this.findLength(t,p),l=a,y=i),o+=this.findLength(r,u),u=r,p=r;a++}return{lengthAtFractionPt:v,fullLength:o,segmentIndex:l,pointIndex:y}},getSlope:function(n,t,i,r){var e=3,o=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y),u=(i.y-n.y)/(t.y-n.y),f=(i.x-n.x)/(t.x-n.x);return!isFinite(u)||!isFinite(f)||isNaN(u)||isNaN(f)?n.x===t.x?n.y===t.y?1e4:n.y>i.y&&i.y>t.y||n.y<i.y&&i.y<t.y?Math.abs(n.x-i.x):1e4:n.y==t.y?n.x>i.x&&i.x>t.x||n.x<i.x&&i.x<t.x?Math.abs(n.y-i.y):1e4:1e4:r.segments.length>0?n.x>=i.x&&i.x>=t.x||n.x<=i.x&&i.x<=t.x||o<e?n.y>=i.y&&i.y>=t.y||n.y<=i.y&&i.y<=t.y||s<e?Math.abs(u-f):1e4:1e4:1e4},getPoints:function(n){var r=[],t,i,u;if(n.segments.length>0)for(t=0;t<n.segments.length;t++)if(i=n.segments[t],i.type==="straight"||i.type==="bezier")t===0&&r.push(n.sourcePoint),i._point&&r.push(i._point);else if(i.type==="orthogonal")for(u=0;u<n.segments[t].points.length;u++)r.push(n.segments[t].points[u]);return r},interSect:function(n,t,i,r,u){var s,h,f,e,o;for(i&&t.length>=2&&(t.splice(0,1),t.splice(0,1)),s=[],h=r.bridgeDirection(),f=0;f<n.length-1;f++){if(e=this.interSect1(n[f],n[f+1],t,r,u,h),e.length>0)for(o=0;o<e.length;o++)s.push(e[o]);i&&t.length>=1&&t.splice(0,1)}return s},checkforHorizontalLine:function(n){var t=Math.abs(n);return t>90?180-t:t},interSect1:function(n,i,r,u,f,e){for(var c,s,h,l=[],o=0;o<r.length-1;o++)c=this.interSect2(n,i,r[o],r[o+1]),t.datavisualization.Diagram.Geometry.isEmptyPoint(c)||(s=this._findAngle(n,i),h=this._findAngle(r[o],r[o+1]),s=this.checkforHorizontalLine(s),h=this.checkforHorizontalLine(h),e==="left"||e==="right"?s>h&&l.push(c):(e==="top"||e==="bottom")&&s<h&&l.push(c),(s===h&&f||u._autoConnectEndPoint)&&l.push(c));return l},interSect2:function(n,i,r,u){var e=t.datavisualization.Diagram.LineUtil(n.x,n.y,i.x,i.y),o=t.datavisualization.Diagram.LineUtil(r.x,r.y,u.x,u.y),f=this.interSect3(e,o);return f.enabled?f.intersectPt:t.datavisualization.Diagram.Point(0,0)},interSect3:function(n,i){var f=t.datavisualization.Diagram.Point(0,0),r=n,u=i,o=(u.y2-u.y1)*(r.x2-r.x1)-(u.x2-u.x1)*(r.y2-r.y1),h=(u.x2-u.x1)*(r.y1-u.y1)-(u.y2-u.y1)*(r.x1-u.x1),c=(r.x2-r.x1)*(r.y1-u.y1)-(r.y2-r.y1)*(r.x1-u.x1),e,s;return o==0?{enabled:!1,intersectPt:f}:(e=h/o,s=c/o,e>=0&&e<=1&&s>=0&&s<=1)?(f.x=r.x1+e*(r.x2-r.x1),f.y=r.y1+e*(r.y2-r.y1),{enabled:!0,intersectPt:f}):{enabled:!1,intersectPt:f}},findLength:function(n,t){try{return Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y))}catch(i){throw i;}},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},findAngle:function(n,i){if(t.datavisualization.Diagram.Geometry.isEqualPoint(n,i))return 0;var u=t.datavisualization.Diagram.Point(i.x,n.y),o=this.findLength(n,u),f=this.findLength(u,i),e=this.findLength(i,n),r=Math.asin(f/e);return r=r*180/Math.PI,n.x<i.x?n.y<i.y||(r=360-r):r=n.y<i.y?180-r:180+r,r},_mapPalettePhase:function(n){var i,r;return n.orientation&&n.orientation=="horizontal"?(i={x:0,y:0},r={x:40,y:0}):(i={x:0,y:0},r={x:0,y:40}),t.datavisualization.Diagram.Connector({name:n?n.name:t.datavisualization.Diagram.Util.randomId(),segments:[{type:"straight"}],sourcePoint:{x:i.x,y:i.y},targetPoint:{x:r.x,y:r.y},lineWidth:n.lineWidth?n.lineWidth:1,lineDashArray:n.lineDashArray?n.lineDashArray:null,lineColor:n.lineColor?n.lineColor:"#606060",targetDecorator:{shape:"none"},isPhase:!0,orientation:n.orientation?n.orientation:"horizontal",labels:n.label?[n.label]:[],paletteItem:n.paletteItem?n.paletteItem:null})},_updateShapeProperties:function(n){n._type="node";n.shape.type||(n.shape.type="rectangle");switch(n.shape.type){case"rectangle":n.type="basic";n._shape=n.shape.type;n.shape.cornerRadius&&(n.cornerRadius=n.shape.cornerRadius);break;case"ellipse":n.type="basic";n._shape=n.shape.type;break;case"path":n.type="basic";n._shape=n.shape.type;n.pathData=n.shape.pathData;break;case"polygon":n.type="basic";n._shape=n.shape.type;n.points=n.shape.points;break;case"image":n.type="image";n._shape=n.shape.type;n.source=n.shape.src;break;case"native":n.type="native";n._shape=n.shape.type;n.templateId=n.shape.templateId;break;case"text":n.type="text";n._shape=n.shape.type;n.textBlock=n.shape.textBlock;break;case"html":n.type="html";n._shape=n.shape.type;n.templateId=n.shape.templateId}},_refreshParentGroup:function(n,i){var r=i.nameTable[n.parent],f,u;r&&(this._updateGroupBounds(r,i),f=r.parent?document.getElementById(r.parent):i._diagramLayer,t.datavisualization.Diagram.DiagramContext.renderGroup(r,i),u=i._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Unknown,i._raiseGroupChangeEvent(n,undefined,r,u))},intersectsWith:function(n,t){var i=t;return n.x<i.x&&i.x<n.x+n.width&&n.y<i.y&&i.y<n.y+n.height},_findOffsetOnConnector:function(n,i,r,u){for(var e,a,k,l,y=0,o=[],f=0;f<n.segments.length;f++)for(o[f]=[],e=0;e<n.segments[f].points.length-1;e++)y+=t.datavisualization.Diagram.Geometry.distance(n.segments[f].points[e],n.segments[f].points[e+1]),o[f][e]=y;var p=n.sourceNode&&i.offset==0&&u.nameTable[n.sourceNode]||n.targetNode&&i.offset==1&&u.nameTable[n.targetNode],s=p?this.bounds(p):null,r=i.segmentOffset||0,v,c,b,h,w=y*r;for(f=0;f<o.length;f++)for(e=0;e<o[f].length;e++){if(o[f][e]>=w){if(c=n.segments[f],b=t.datavisualization.Diagram.Geometry.findAngle(c.points[e],n.segments[f].points[e+1]),h=t.datavisualization.Diagram.Geometry.transform(c.points[e],b,w-(v||0)),p){if(this.intersectsWith(s,h)&&!t.datavisualization.Diagram.Geometry.containsRect(s,this.bounds(n))){k=i.offset==0?this._getBezierDirection(c.points[e],n.segments[f].points[e+1]):this._getBezierDirection(c.points[e+1],n.segments[f].points[e]);a=i.offset==0?c.points[e+1]:c.points[e];l=!1;switch(k){case"top":s.y>a.y?h.y=s.top:l=!0;break;case"bottom":s.bottom<a.y?h.y=s.bottom:l=!0;break;case"right":s.right<a.x?h.x=s.right:l=!0;break;case"left":s.left>a.x?h.x=s.left:l=!0}if(l){w=i.offset==1?v||0:o[f][e];v=i.offset==0?o[f][e]:o[f][e-2]||(o[f-1]&&o[f-1].length>1?o[f-1][o[f-1].length-1]:o[f-2]&&o[f-2][o[f-2].length-1])||0;i.offset==0?f=f:e?e-=2:f-=2;continue}}return{segment:f,point:e,offset:{x:h.x,y:h.y}}}return{segment:f,point:e,offset:{x:h.x,y:h.y}}}v=o[f][e]}},_alignLabelOnSegments:function(n,i,r,u){var b=u.angle%360,y,c,f,e,p,w,o;u.angle%=360;var s=45,l=135,h=225,v=315,a;(i.segmentOffset==0&&n.sourceNode||i.segmentOffset==1&&n.targetNode)&&(y=i.segmentOffset==0&&n.sourceNode?r.nameTable[n.sourceNode]:r.nameTable[n.targetNode],y&&(a=this.bounds(y)),a&&(c=180/(2+2/(a.height/a.width)),s=c,l=180-c,h=l+2*c,v=360-c));switch(i.alignment){case"before":u.angle>=s&&u.angle<=l?(f="right",e=i.segmentOffset==.5?"center":"top"):u.angle>=h&&u.angle<=v?(f="left",e=i.segmentOffset==.5?"center":"bottom"):u.angle>s&&u.angle<h?(e="top",f=i.segmentOffset==.5?"center":"right"):(e="bottom",f=i.segmentOffset==.5?"center":"left");break;case"after":u.angle>=s&&u.angle<=l?(f="left",e=i.segmentOffset==.5?"center":"top"):u.angle>=h&&u.angle<=v?(f="right",e=i.segmentOffset==.5?"center":"bottom"):u.angle>s&&u.angle<h?(e="bottom",f=i.segmentOffset==.5?"center":"right"):(e="top",f=i.segmentOffset==.5?"center":"left");break;case"center":f="center";e="center"}if(i.boundaryConstraints&&(i.segmentOffset==0||i.segmentOffset==1)){n.segments.length>1&&(o=n.segments[n.segments.length-1]);p=o?o.points.length:n.segments[0].points.length;n.labels[0].name==i.name?w=t.datavisualization.Diagram.Util._getBezierDirection(n.segments[0].points[0],n.segments[0].points[1]):(o=o?o:n.segments[0],w=t.datavisualization.Diagram.Util._getBezierDirection(o.points[p-2],o.points[p-1]));switch(w){case"left":f=i.segmentOffset==0?"right":"left";break;case"right":f=i.segmentOffset==0?"left":"right";break;case"bottom":e=i.segmentOffset==0?"top":"bottom";break;case"top":e=i.segmentOffset==0?"bottom":"top"}}return{hAlign:f,vAlign:e}},getObjectType:function(n){return n?n.segments?"connector":n.type=="bpmn"&&n.container?"group":n._type==="node"||n.type=="bpmn"||n.type=="basic"||n.type=="flow"||n.type=="arrow"?"node":n.type==="text"||n.type==="image"||n.type==="native"||n.type==="html"?"node":n._type!="group"&&n.type=="pseudoGroup"?"pseudoGroup":n._type==="group"||n.isLane||n.isSwimlane?"group":n.isSwimlane?"swimlane":null:null},_canBeTarget:function(n,t){return t&&n.activeTool.helper&&n.activeTool.helper._name&&n.activeTool.helper._name===t.name?!1:!0},getLabelbounds:function(i,r,u){var e,l,o,f,c;if(u)if(i.model.labelRenderingMode==="svg"){if(i._svg&&(e=i._svg.document.getElementById(r.name+"_"+u.name),o=i._svg.document.getBoundingClientRect(),e))return f=e.getBoundingClientRect(),l={x:f.left,y:f.top,width:f.width,height:f.height},c=i.tools.labelMove.getCenterOfLabel(u,u.segmentOffset,l),{x:f.left-o.left,y:f.top-o.top,width:f.right-f.left,height:f.bottom-f.top,centerX:c.x,centerY:c.y}}else if(i._svg){var a=i._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],o=a.getBoundingClientRect(),s=o.left,h=o.top;if(e=n(a).find("#"+r.name+"_"+u.name)[0],e){var f=e.getBoundingClientRect(),v=(f.left-s)/i.model.scrollSettings.currentZoom+(s+i.model.scrollSettings.horizontalOffset),y=(f.top-h)/i.model.scrollSettings.currentZoom+(h+i.model.scrollSettings.verticalOffset),p=f.width/i.model.scrollSettings.currentZoom,w=f.height/i.model.scrollSettings.currentZoom;return s+=i.model.scrollSettings.horizontalOffset,h+=i.model.scrollSettings.verticalOffset,t.datavisualization.Diagram.Rectangle(v-s,y-h,p,w)}}},_updateBpmnChild:function(n,i){switch(n.shape){case"event":n=t.datavisualization.Diagram.DefautShapes._getBPMNEventShape(n,i);break;case"gateway":n=t.datavisualization.Diagram.DefautShapes._getBPMNGatewayShape(n,i);break;case"dataobject":n=t.datavisualization.Diagram.DefautShapes._getBPMNDataShape(n,i);break;case"activity":n=t.datavisualization.Diagram.DefautShapes._getBPMNActivityShape(n,i);break;case"group":n=t.datavisualization.Diagram.DefautShapes._getBPMNGroupShape(n,i)}return t.datavisualization.Diagram.DefautShapes.initBPMNAnnotationShape(n,i)},_getUndoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._undoObject=n.extend(!0,{},{node:i,childTable:r})},_getRedoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._redoObject=n.extend(!0,{},{node:i,childTable:r})},_collectionContains:function(n,t){for(var i=0;i<t.length;i++)if(typeof t[i]=="string"&&t[i]===n||t[i].name===n)return!0},_updateActivityChildOffset:function(n,t,i){if(n.children&&n.children.length>0)for(var r=0;r<n.children.length;r++)n.children[r].offsetX=t.x,n.children[r].offsetY=t.y,this._updateActivityChildOffset(n.children[r],t,i)},_updateBPMNProperties:function(n,i,r,u){var b,p,w,s,o,f,e,c;switch(n.shape){case"activity":var l=t.datavisualization.Diagram.Util.bounds(n,!0),v=n.offsetX,y=n.offsetY,h=i._getChildren(n.children);for(s=0;s<h.length;s++)(o=typeof h[s]=="object"?h[s]:r[h[s]],u&&s==0&&(l=t.datavisualization.Diagram.Util.bounds(o,!0),v=o.offsetX,y=o.offsetY),s==0&&(o.pathData=o._absolutePath=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(n,12),n.subProcess.type=="transaction"&&(b={x:3,y:3,width:n.width-3,height:n.height-3},o.pathData=o._absolutePath+=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(b,12)),delete o._absoluteBounds),u&&t.datavisualization.Diagram.Util.canResize(o))||(f=o.addInfo,f&&f.offset&&(e=t.datavisualization.Diagram.Point(l.x+l.width*f.offset.x,l.y+l.height*f.offset.y),f.margin=t.datavisualization.Diagram.Margin(f.margin?f.margin:{}),f.hAlign&&(e.x+=f.margin.left-f.margin.right,e.x=f.hAlign=="left"?e.x+f.margin.right:f.hAlign=="right"?e.x-f.margin.left:e.x),f.vAlign&&(e.y+=f.margin.top-f.margin.bottom,e.y=f.vAlign=="top"?e.y+f.margin.bottom:f.vAlign=="bottom"?e.y-f.margin.top:e.y),n.rotateAngle&&(c=t.Matrix.identity(),t.Matrix.rotate(c,n.rotateAngle,v,y),e=t.Matrix.transform(c,e)),o.offsetX=e.x,o.offsetY=e.y,this._updateActivityChildOffset(o,e,i)));break;case"group":n.pathData=n._absolutePath=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(n,15);n._scaled=!1;break;case"annotation":for(s=0;s<n.outEdges.length;s++)if(w=i.nameTable[n.outEdges[s]],w._isAnnotationLine){p=w;break}p&&t.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(p,n,null,null,i);break;case"dataobject":var l=t.datavisualization.Diagram.Util.bounds(n,!0),v=n.offsetX,y=n.offsetY,h=i._getChildren(n.children),a=n.pivot||{x:.5,y:.5},k=n.offsetX?n.offsetX-n.width*a.x:n.width*a.x,d=n.offsetY?n.offsetY-n.height*a.y:n.height*a.y;for(s=0;s<h.length;s++)(o=typeof h[s]=="object"?h[s]:r[h[s]],u&&t.datavisualization.Diagram.Util.canResize(o))||(f=o.addInfo,f.margin=t.datavisualization.Diagram.Margin(f.margin?f.margin:{}),f.offset&&(e=t.datavisualization.Diagram.Point({}),e.x=k+f.offset.x*n.width+f.margin.left-f.margin.right,e.y=d+f.offset.y*n.height+f.margin.top-f.margin.bottom,n.rotateAngle&&(c=t.Matrix.identity(),t.Matrix.rotate(c,n.rotateAngle,v,y),e=t.Matrix.transform(c,e)),o.offsetX=e.x,o.offsetY=e.y))}},indexOf:function(n,t){if(n!=null&&t!=null)for(var i=0;i<n.length;i++)if(n[i]==t)return i;return-1}};t.datavisualization.Diagram.BridgeSegments={bridges:[],bridgeStartPoint:[],segmentIndex:-1};t.datavisualization.Diagram.PathSegment={path:"",startPoint:{x:0,y:0},endPoint:{x:0,y:0},angle:0,segmentPointIndex:-1,sweep:1};t.datavisualization.Diagram.LineUtil=function(n,t,i,r){return{x1:Number(n)||0,y1:Number(t)||0,x2:Number(i)||0,y2:Number(r)||0}};t.datavisualization.Diagram.Geometry={checkPointOnCircle:function(n,t,i){var r=Math.pow(i,2),u=Math.pow(n.x-t.x,2),f=Math.pow(n.y-t.y,2);return u+f<=r?!0:!1},rect:function(n){var c=t.datavisualization.Diagram.Rectangle(),e,i,r,h;if(arguments.length===1){var o=Number.MAX_VALUE,s=Number.MAX_VALUE,l=-Number.MAX_VALUE,a=-Number.MAX_VALUE,v=n.length,u,f;for(e=0;e<v;e++)u=n[e].x,f=n[e].y,u<o&&(o=u),u>l&&(l=u),f<s&&(s=f),f>a&&(a=f);c=t.datavisualization.Diagram.Rectangle(o,s,l-o,a-s)}else arguments.length===2&&(i=t.datavisualization.Diagram.Point(arguments[0]),r=t.datavisualization.Diagram.Point(arguments[1]),i.x>r.x&&(h=i.x,i.x=r.x,r.x=h),i.y>r.y&&(h=i.y,i.y=r.y,r.y=h),c=t.datavisualization.Diagram.Rectangle(i.x,i.y,r.x-i.x,r.y-i.y));return c},union:function(n,i){var r=Math.min(n.x,i.x),u=Math.min(n.y,i.y),f=Math.max(n.x+n.width,i.x+i.width),e=Math.max(n.y+n.height,i.y+i.height);return t.datavisualization.Diagram.Rectangle(r,u,f-r,e-u)},distance:function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},translate:function(n,i,r){return t.datavisualization.Diagram.Point(n.x+i,n.y+r)},intersectsRect:function(n,t){return t.x<n.x+n.width&&n.x<t.x+t.width&&t.y<n.y+n.height&&n.y<t.y+t.height},findAngle:function(n,t){var i=Math.atan2(t.y-n.y,t.x-n.x);return i=180*i/Math.PI,i%=360,i<0&&(i+=360),i},intersectSegment:function(n,i){var a=n.point1.x,v=n.point1.y,y=n.point2.x,p=n.point2.y,w=i.point1.x,b=i.point1.y,k=i.point2.x,d=i.point2.y,e,o,s,h,c,l,rt,ut,g,nt,tt,it,r,f,u;return(e=p-v,s=a-y,c=y*v-a*p,tt=e*w+s*b+c,it=e*k+s*d+c,tt!==0&&it!==0&&this.sameSign(tt,it))?null:(o=d-b,h=w-k,l=k*b-w*d,g=o*a+h*v+l,nt=o*y+h*p+l,g!==0&&nt!==0&&this.sameSign(g,nt))?null:(r=e*h-o*s,r===0)?null:(f=r<0?-r/2:r/2,f=0,u=s*l-h*c,rt=u<0?(u-f)/r:(u+f)/r,u=o*c-e*l,ut=u<0?(u-f)/r:(u+f)/r,t.datavisualization.Diagram.Point(rt,ut))},updatePath:function(n,i,r,u,f,e,o,s){var h,c;e&&e.pathBounds?(c=!0,h=o||e.pathBounds(f)):(c=s&&!s._absolutePath?!0:!1,h=o);s&&(s._absoluteBounds=h);var l=0,a=0,v=!1;return(n.toString()!==h.x||i.toString()!==h.y)&&(l=n-Number(h.x),a=i-Number(h.y)),(r!==h.width||u!==h.height)&&(l=r/Number(h.width?h.width:1),a=u/Number(h.height?h.height:1),v=!0),t.datavisualization.Diagram.Geometry.processPathData(f,l,a,v,h.x,h.y,n,i,c,e)},processPathData:function(n,i,r,u,f,e,o,s,h,c){var rt=document.createElementNS("http://www.w3.org/2000/svg","path"),ut,ft,p,w,b,k,d,v,nt,y,tt,it;rt.setAttribute("d",n);h&&(c=c||new t.datavisualization.Diagram.Svg({}),n=c.absolutePath(rt).getAttribute("d"),rt.setAttribute("d",n));d=t.datavisualization.Diagram.Util.convertPathToArray(n);for(var l=0,a=0,g=0,et=d.length;g<et;++g){v=d[g];nt=v.pathSegTypeAsLetter;"x1"in v&&(p=v.x1);"x2"in v&&(b=v.x2);"y1"in v&&(w=v.y1);"y2"in v&&(k=v.y2);"x"in v&&(l=v.x);"y"in v&&(a=v.y);u?(l!=undefined&&(l=t.datavisualization.Diagram.Geometry.scalePathData(l,i,f,o),l=Number(l.toFixed(2))),a!=undefined&&(a=t.datavisualization.Diagram.Geometry.scalePathData(a,r,e,s),a=Number(a.toFixed(2))),p!=undefined&&(p=t.datavisualization.Diagram.Geometry.scalePathData(p,i,f,o),p=Number(p.toFixed(2))),w!=undefined&&(w=t.datavisualization.Diagram.Geometry.scalePathData(w,r,e,s),w=Number(w.toFixed(2))),b!=undefined&&(b=t.datavisualization.Diagram.Geometry.scalePathData(b,i,f,o),b=Number(b.toFixed(2))),k!=undefined&&(k=t.datavisualization.Diagram.Geometry.scalePathData(k,r,e,s),k=Number(k.toFixed(2)))):(l!=undefined&&(l=l+i),a!=undefined&&(a=a+r),p!=undefined&&(p=p+i),w!=undefined&&(w=w+r),b!=undefined&&(b=b+i),k!=undefined&&(k=k+r));switch(nt){case"M":y={pathSegTypeAsLetter:"M",x:l,y:a};break;case"L":y={pathSegTypeAsLetter:"L",x:l,y:a};break;case"H":y={pathSegTypeAsLetter:"H",x:l};break;case"V":y={pathSegTypeAsLetter:"V",y:a};break;case"C":y={pathSegTypeAsLetter:"C",x:l,y:a,x1:p,y1:w,x2:b,y2:k};break;case"S":y={pathSegTypeAsLetter:"S",x:l,y:a,x2:b,y2:k};break;case"Q":y={pathSegTypeAsLetter:"Q",x:l,y:a,x1:p,y1:w};break;case"T":y={pathSegTypeAsLetter:"T",x:l,y:a};break;case"A":tt=v.r1;it=v.r2;u&&(tt=tt*i,it=it*r);y={pathSegTypeAsLetter:"A",x:l,y:a,r1:tt,r2:it,angle:v.angle,largeArcFlag:v.largeArcFlag,sweepFlag:v.sweepFlag};break;case"z":case"Z":l=ut;a=ft;y=d[g]}y&&(d[g]=y);(nt==="M"||nt==="m")&&(ut=l,ft=a)}return t.datavisualization.Diagram.Util.pathSegArrayAsString(d)},scalePathData:function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},updatePolygonPoints:function(n,i){var f,r,e,u;if(n.points)for(i||(i=n.points),t.datavisualization.Diagram.Geometry.scalePoints(i,n),f=t.datavisualization.Diagram.Geometry.rect(n.points),r=0,e=n.points.length;r<e;++r)u=t.datavisualization.Diagram.Geometry.translate(i[r],-f.x,-f.y),u=t.datavisualization.Diagram.Geometry.translate(u,0,0),i[r]=u},scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(i.points),f,e,r,o;if(u.width>0&&u.height>0)for(f=i.width/u.width,e=i.height/u.height,r=0,o=i.points.length;r<o;++r)n[r].x=n[r].x*f,n[r].y=n[r].y*e},sameSign:function(n,t){return n*t>=0},containsPoint:function(n,t){return n.x<=t.x&&t.x<=n.x+n.width&&n.y<=t.y&&t.y<=n.y+n.height},containsRect:function(n,t){return n.x<=t.x&&t.x+t.width<=n.x+n.width&&n.y<=t.y&&t.y+t.height<=n.y+n.height},inflate:function(n,t,i){n.x-=t;n.y-=i;n.width+=2*t;n.height+=2*i},isEmptyRect:function(n){return n.x===0&&n.y===0&&n.width===0&&n.height===0},isEmptyPoint:function(n){return n.x===0&&n.y===0},isEqualPoint:function(n,t){return n&&t&&n.x===t.x&&n.y===t.y},isEmptySize:function(n){return n.width===0&&n.height===0},length:function(n){return t.datavisualization.Diagram.Geometry.distance(n.point1,n.point2)},midPoint:function(n){return t.datavisualization.Diagram.Point((n.point1.x+n.point2.x)/2,(n.point1.y+n.point2.y)/2)},transform:function(n,t,i){var r={};return r.x=Math.round((n.x+i*Math.cos(t*Math.PI/180))*100)/100,r.y=Math.round((n.y+i*Math.sin(t*Math.PI/180))*100)/100,r}};t.datavisualization.Diagram.LineSegment=function(n,t){return{point1:n,point2:t}};t.datavisualization.Diagram.Point=function(n,t){return{x:Number(n)||0,y:Number(t)||0}};t.datavisualization.Diagram.Size=function(n,t){return{width:Number(n)||0,height:Number(t)||0}};t.datavisualization.Diagram.Rectangle=function(n,t,i,r){return{x:Number(n)||0,y:Number(t)||0,width:Number(i)||0,height:Number(r)||0}};t.datavisualization.Diagram.ImageAlignment={None:"none",XMinYMin:"xminymin",XMinYMid:"xminymid",XMinYMax:"xminymax",XMidYMin:"xmidymin",XMidYMid:"xmidymid",XMidYMax:"xmidymax",XMaxYMin:"xmaxymin",XMaxYMid:"xmaxymid",XMaxYMax:"xmaxymax"};t.datavisualization.Diagram.ActiveTool={None:"none",Drag:"drag",Draw:"draw"};t.datavisualization.Diagram.ScaleConstraints={None:"none",Stretch:"stretch",Meet:"meet",Slice:"slice"};t.datavisualization.Diagram.KeyModifiers={None:0,Control:1,Meta:1,Alt:2,Shift:4};t.datavisualization.Diagram.Keys={None:"",Number0:0,Number1:1,Number2:2,Number3:3,Number4:4,Number5:5,Number6:6,Number7:7,Number8:8,Number9:9,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Left:37,Up:38,Right:39,Down:40,Escape:27,Delete:46,Tab:9,Enter:13};t.datavisualization.Diagram.LabelRenderingMode={Html:"html",Svg:"svg"};t.datavisualization.Diagram.TemplateType={Html:"html",Svg:"svg"};t.datavisualization.Diagram.DecoratorShapes={None:"none",Arrow:"arrow",OpenArrow:"openarrow",Circle:"circle",Diamond:"diamond",Path:"path"};t.datavisualization.Diagram.ConnectorType={StraightLine:"straightLine",OrthogonalLine:"orthogonalLine",Polyline:"polyline"};t.datavisualization.Diagram.ActionType={Unknown:"unknown",Nudge:"nudge",Touch:"touch",Mouse:"mouse",Order:"order",Align:"align",Size:"size",HistoryChange:"historyChange"};t.datavisualization.Diagram.dependentconnector={dependent:1,independent:2};t.datavisualization.Diagram.ContainerType={Canvas:"canvas",Stack:"stack"};t.datavisualization.Diagram.IconShapes={Minus:"minus",Plus:"plus",ArrowUp:"arrowup",ArrowDown:"arrowdown",Template:"template",Path:"path",Image:"image",None:"none"};t.datavisualization.Diagram.PortShapes={X:"x",Circle:"circle",Square:"square",Path:"path"};t.datavisualization.Diagram.TickAlignment={LeftOrTop:"leftortop",RightOrBottom:"rightorbottom"};t.datavisualization.Diagram.PortVisibility={Visible:1,Hidden:2,Hover:4,Connect:8,Default:8};t.datavisualization.Diagram.TextAlign={Left:"left",Center:"center",Right:"right",Justify:"justify"};t.datavisualization.Diagram.HorizontalAlignment={Left:"left",Center:"center",Right:"right",Stretch:"stretch"};t.datavisualization.Diagram.Alignment={Before:"before",After:"after",Center:"center"};t.datavisualization.Diagram.LabelRelativeMode={SegmentBounds:"segmentbounds",SegmentPath:"segmentpath"};t.datavisualization.Diagram.LabelEditMode={Edit:"edit",View:"view"};t.datavisualization.Diagram.RelativeMode={Object:"object",Mouse:"mouse"};t.datavisualization.Diagram.TextWrapping={NoWrap:"nowrap",Wrap:"wrap",WrapWithOverflow:"wrapwithoverflow"};t.datavisualization.Diagram.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom",Stretch:"stretch"};t.datavisualization.Diagram.TextDecorations={Underline:"underline",Overline:"overline",LineThrough:"line-through",None:"none"};t.datavisualization.Diagram.PaletteConstraints={HeaderVisibility:2,Visible:4,Expandable:8,Default:14};t.datavisualization.Diagram.NodeConstraints={None:1,Select:2,Delete:4,Drag:8,Rotate:16,Connect:32,ResizeNorthEast:64,ResizeEast:128,ResizeSouthEast:256,ResizeSouth:512,ResizeSouthWest:1024,ResizeWest:2048,ResizeNorthWest:4096,ResizeNorth:8192,Resize:16320,Shadow:16384,DragLabel:32768,AllowPan:65536,AspectRatio:131072,AllowDrop:262144,InheritTooltip:524288,MultiSelect:1048576,PointerEvents:2097152,PointerVisibility:2097152,CrispEdges:4194304,InheritCrispEdges:8388608,Interaction:16347,Default:11026430};t.datavisualization.Diagram.LabelConstraints={None:1,Selectable:2,Draggable:4,Resizable:8,Rotatable:16,All:30};t.datavisualization.Diagram.HistoryChangeCause={Undo:"undo",Redo:"redo",CustomAction:"customAction"};t.datavisualization.Diagram.CollectionChangeCause={ClipBoard:"clipBoard",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"};t.datavisualization.Diagram.GroupChangeCause={Group:"group",Ungroup:"ungroup",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"};t.datavisualization.Diagram.SelectionChangeCause={Keydown:"keydown",RubberBand:"rubberBand",Mouse:"mouse",Touch:"touch",Unknown:"unknown"};t.datavisualization.Diagram.ScrollChangeCause={Zoom:"zoom",Pan:"pan",Unknown:"unknown"};t.datavisualization.Diagram.ConnectorConstraints={None:1,Select:2,Delete:4,Drag:8,DragSourceEnd:16,DragTargetEnd:32,DragSegmentThumb:64,Bridging:128,DragLabel:256,InheritBridging:512,AllowDrop:1024,InheritTooltip:2048,PointerEvents:4096,PointerVisibility:4096,CrispEdges:8192,InheritCrispEdges:16384,DragLimit:32768,BridgeObstacle:65536,Routing:131072,InheritRouting:262144,Interaction:122,Default:350846};t.datavisualization.Diagram.PortConstraints={None:1,Connect:2,ConnectOnDrag:4};t.datavisualization.Diagram.SelectorConstraints={None:1,Rotator:2,Resizer:4,UserHandles:8,Tooltip:16,DragOnEmptySpace:32,AutoHideThumbs:64,All:30};t.datavisualization.Diagram.UserHandlePositions={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",MiddleLeft:"middleleft",MiddleRight:"middleright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"};t.datavisualization.Diagram.SnapConstraints={None:0,SnapToHorizontalLines:1,SnapToVerticalLines:2,SnapToLines:3,ShowHorizontalLines:4,ShowVerticalLines:8,ShowLines:12,All:15};t.datavisualization.Diagram.PageOrientations={Landscape:"landscape",Portrait:"portrait"};t.datavisualization.Diagram.ScrollLimit={Infinity:"infinity",Diagram:"diagram",Limited:"limited"};t.datavisualization.Diagram.BoundaryConstraints={Infinity:"infinity",Diagram:"diagram",Page:"page"};t.datavisualization.Diagram.LayoutOrientations={TopToBottom:"toptobottom",BottomToTop:"bottomtotop",LeftToRight:"lefttoright",RightToLeft:"righttoleft"};t.datavisualization.Diagram.ObjectTypes={Diagram:"diagram",Palette:"palette",Lane:"lane",Group:"group"};t.datavisualization.Diagram.PaletteDefaults={name:"",expanded:!1,subControlId:null,items:[],constraints:t.datavisualization.Diagram.PaletteConstraints.Default};t.datavisualization.Diagram.Palette=function(i){return i.items=i.items?i.items.slice():[],n.extend(!1,{},t.datavisualization.Diagram.PaletteDefaults,i)};t.datavisualization.Diagram.Shapes={Image:"image",Text:"text",Html:"html",Native:"native",Basic:"basic",Flow:"flow",Arrow:"arrow",BPMN:"bpmn"};t.datavisualization.Diagram.ClipBoardChangeType={All:"all",None:"none",Specific:"specific"};t.datavisualization.Diagram.OverflowType={Clip:"clip",Ellipsis:"ellipsis"};t.datavisualization.Diagram.ShapeDefaults={shape:"",source:"",pathData:"",textBlock:null,points:[],templateId:null,scale:"meet",contentAlignment:"xmidymid"};t.datavisualization.Diagram.Shape=function(i){return i&&(i.points=i.points?i.points.slice():[],i.type==="html"&&typeof i.html=="string"&&(i.html=t.datavisualization.Diagram.Util.htmlEncode(i.html)),i.type==="text"&&(i.textBlock=t.datavisualization.Diagram.TextBlock(i.textBlock?i.textBlock:{}),i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i.borderWidth=i.borderWidth?i.borderWidth:0),(i.type=="image"||i.type=="native"||i.type==="text"||i.type==="html")&&(i._shape=i.type),i._type||(i._type=i.type?i.type:"node"),i._shape||(i._shape=i.shape?i.shape:"rectangle"),i.points=i.points?i.points.slice():[]),n.extend(!1,{},t.datavisualization.Diagram.ShapeDefaults,i)};t.datavisualization.Diagram.Segments={Straight:"straight",Orthogonal:"orthogonal",Bezier:"bezier"};t.datavisualization.Diagram.SegmentDefaults={type:t.datavisualization.Diagram.Segments.Straight,point:null,point1:null,point2:null,vector1:null,vector2:null,_point1:t.datavisualization.Diagram.Point(),_point2:t.datavisualization.Diagram.Point(),length:null,_length:null,_bridges:[],direction:null,_direction:null};t.datavisualization.Diagram.Segment=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.SegmentDefaults,i),u;return r._bridges=r._bridges?r._bridges.slice():[],u=[],r.points=u,r.type=="orthogonal"?(r._length=r.length,r._direction=r.direction):(r.type=="bezier"&&(r._point1=r.point1,r._point2=r.point2),r.point&&(r._point=r.point)),r};t.datavisualization.Diagram.DragLimitDefaults={top:10,left:10,right:10,bottom:10};t.datavisualization.Diagram.DragLimit=function(i){return n.extend(!0,{},t.datavisualization.Diagram.DragLimitDefaults,i)};t.datavisualization.Diagram.MarginDefaults={top:0,left:0,right:0,bottom:0};t.datavisualization.Diagram.Margin=function(i){return i=i||{},n.extend(!1,{},t.datavisualization.Diagram.MarginDefaults,i)};t.datavisualization.Diagram.PaddingDefaults={top:0,left:0,right:0,bottom:0};t.datavisualization.Diagram.Padding=function(i){return i=i||{},n.extend(!1,{},t.datavisualization.Diagram.PaddingDefaults,i)};t.datavisualization.Diagram.EndPointHitPaddingDefaults={top:0,left:0,right:0,bottom:0};t.datavisualization.Diagram.EndPointHitPadding=function(n){return n=n||{},n.top=n.top||0,n.left=n.left||0,n.right=n.right||0,n.bottom=n.bottom||0,n};t.datavisualization.Diagram.GestureDefaults={key:t.datavisualization.Diagram.Keys.None,keyModifiers:t.datavisualization.Diagram.KeyModifiers.None};t.datavisualization.Diagram.Gesture=function(i){return n.extend(!0,{},t.datavisualization.Diagram.GestureDefaults,i)};t.datavisualization.Diagram.CommandDefaults={gesture:t.datavisualization.Diagram.Gesture(),execute:null,canExecute:null,parameter:null};t.datavisualization.Diagram.Command=function(i){return i.gesture&&(i.gesture=t.datavisualization.Diagram.Gesture(i.gesture)),i.canExecute||(i.canExecute=function(){return!0}),i.execute||(i.execute=function(){}),n.extend(!0,{},t.datavisualization.Diagram.CommandDefaults,i)};t.datavisualization.Diagram.TooltipDefaults={templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5},offset:null,delay:0};t.datavisualization.Diagram.Tooltip=function(i){return i.margin=i.margin||{},i.margin.top=i.margin.top!==undefined?i.margin.top:5,i.margin.left=i.margin.left!==undefined?i.margin.left:5,i.margin.right=i.margin.right!==undefined?i.margin.right:5,i.margin.bottom=i.margin.bottom!==undefined?i.margin.bottom:5,i.margin=t.datavisualization.Diagram.Margin(i.margin),i.alignment=i.alignment||{},i.alignment&&(i.alignment.horizontal=i.alignment.horizontal?i.alignment.horizontal:"center",i.alignment.vertical=i.alignment.vertical?i.alignment.vertical:"bottom"),n.extend(!1,{},t.datavisualization.Diagram.TooltipDefaults,i)};t.datavisualization.Diagram.BackgroundImageDefaults={source:"",alignment:"xmidymid",scale:"meet"};t.datavisualization.Diagram.BackgroundImage=function(i){return n.extend(!1,{},t.datavisualization.Diagram.BackgroundImageDefaults,i)};t.datavisualization.Diagram.Path=function(){this._path=""};t.datavisualization.Diagram.Path.prototype={moveTo:function(n,t){return this._path+="M"+n+","+t,this},lineTo:function(n,t){return this._path+="L"+n+","+t,this},cubicBezierTo:function(n,t){return this._path+=t?"S":"C",this._addPoints(n),this},quadraticBezierTo:function(n,t){return this._path+=t?"T":"Q",this._addPoints(n),this},ellipticalArcTo:function(n,t,i,r,u,f,e){return this._path+="A"+n+","+t+" "+i+" "+r+","+u+" "+f+","+e,this},close:function(){return this._path+="Z",this},toString:function(){return this._path},_addPoints:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._path+=i.x+", "+i.y,t!==n.length-1&&(this._path+=" ")}};t.datavisualization.Diagram.DecoratorDefaults={shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",borderWidth:1,fillColor:"black",pathData:"",cssClass:""};t.datavisualization.Diagram.Decorator=function(i){return n.extend(!1,{},t.datavisualization.Diagram.DecoratorDefaults,i)};t.datavisualization.Diagram.TextBlockDefaults={readOnly:!1,bold:!1,italic:!1,text:"",textDecoration:t.datavisualization.Diagram.TextDecorations.None,fontSize:12,fontFamily:"Arial",fontColor:"black",boundaryConstraints:!0,segmentOffset:.5,offset:t.datavisualization.Diagram.Point(.5,.5),textAlign:t.datavisualization.Diagram.TextAlign.Center,alignment:t.datavisualization.Diagram.Alignment.Center,relativeMode:t.datavisualization.Diagram.LabelRelativeMode.SegmentPath,horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,wrapping:t.datavisualization.Diagram.TextWrapping.WrapWithOverflow,margin:t.datavisualization.Diagram.Margin(),padding:t.datavisualization.Diagram.Padding(),textOverflow:!1,overflowType:t.datavisualization.Diagram.OverflowType.Ellipsis,mode:t.datavisualization.Diagram.LabelEditMode.Edit,width:50,rotateAngle:0,opacity:1,templateId:"",templateType:"html"};t.datavisualization.Diagram.TextBlock=function(i){return i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(i.offset.x!==undefined?i.offset.x:.5,i.offset.y!==undefined?i.offset.y:.5),i.margin=t.datavisualization.Diagram.Margin(i.margin),i.wrapText!==undefined&&(i.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),n.extend(!1,{},t.datavisualization.Diagram.TextBlockDefaults,i)};t.datavisualization.Diagram.LabelDefaults=n.extend(!1,{},t.datavisualization.Diagram.TextBlockDefaults,{name:"",visible:!0,borderColor:"transparent",borderWidth:0,fillColor:"transparent",cssClass:"",hyperlink:"",dragLimit:t.datavisualization.Diagram.DragLimit(),height:0,constraints:t.datavisualization.Diagram.LabelConstraints.None,_type:"label"});t.datavisualization.Diagram.Label=function(i){i.offset=i.offset||{};i.offset=t.datavisualization.Diagram.Point(i.offset.x!==undefined?i.offset.x:.5,i.offset.y!==undefined?i.offset.y:.5);i.dragLimit=t.datavisualization.Diagram.DragLimit(i.dragLimit);i.margin=t.datavisualization.Diagram.Margin(i.margin);i.padding=t.datavisualization.Diagram.Margin(i.padding);var r=n.extend(!1,{},t.datavisualization.Diagram.LabelDefaults,i);return r.name||(r.name="label_"+t.datavisualization.Diagram.Util.randomId()),r};t.datavisualization.Diagram.serializationSettingsDefaults={preventDefaultValues:!1};t.datavisualization.Diagram.serializationSettings=function(i){return n.extend(!1,{},t.datavisualization.Diagram.serializationSettingsDefaults,i)};t.datavisualization.Diagram.ExportSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",stretch:"none"};t.datavisualization.Diagram.ExportSettings=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ExportSettingsDefaults,i)};t.datavisualization.Diagram.LayersDefaults={name:"",visible:!0,print:!0,active:!1,lock:!1,snap:!1,objects:[]};t.datavisualization.Diagram.Layers=function(i){return n.extend(!1,{},t.datavisualization.Diagram.LayersDefaults,i)};t.datavisualization.Diagram.PrintSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",margin:{left:0,top:0,right:0,bottom:0},region:"pageSettings"};t.datavisualization.Diagram.PrintSettings=function(i){return i=i||{},i.margin=t.datavisualization.Diagram.Margin(i.margin),n.extend(!1,{},t.datavisualization.Diagram.PrintSettingsDefaults,i)};t.datavisualization.Diagram.FlipDirection={Horizontal:"horizontal",Vertical:"vertical",Both:"both",None:"none"};t.datavisualization.Diagram.IconDefaults={shape:t.datavisualization.Diagram.IconShapes.None,width:15,height:15,offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,margin:t.datavisualization.Diagram.Margin(),horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,cornerRadius:0,fillColor:"white",source:"",pathData:"",templateId:""};t.datavisualization.Diagram.expandIcon=function(i){return i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(i.offset.x!==undefined?i.offset.x:.5,i.offset.y!==undefined?i.offset.y:1),i.margin=t.datavisualization.Diagram.Margin(i.margin),n.extend(!1,{},t.datavisualization.Diagram.IconDefaults,i)};t.datavisualization.Diagram.collapseIcon=function(i){return i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(i.offset.x!==undefined?i.offset.x:.5,i.offset.y!==undefined?i.offset.y:1),i.margin=t.datavisualization.Diagram.Margin(i.margin),n.extend(!1,{},t.datavisualization.Diagram.IconDefaults,i)};t.datavisualization.Diagram.PortDefaults={name:"",visibility:t.datavisualization.Diagram.PortVisibility.Default,constraints:t.datavisualization.Diagram.PortConstraints.Connect,size:8,offset:t.datavisualization.Diagram.Point(0,0),borderColor:"#1a1a1a",borderWidth:1,fillColor:"white",shape:t.datavisualization.Diagram.PortShapes.Square,pathData:"",connectorPadding:0,cssClass:"",margin:t.datavisualization.Diagram.Margin(),parent:""};t.datavisualization.Diagram.ShadowDefaults={distance:5,angle:45,opacity:.7};t.datavisualization.Diagram.Shadow=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ShadowDefaults,i)};t.datavisualization.Diagram.Port=function(i){i.offset=i.offset||{};i.offset=t.datavisualization.Diagram.Point(i.offset.x?i.offset.x:0,i.offset.y?i.offset.y:0);i.margin=t.datavisualization.Diagram.Margin(i.margin);var r=n.extend(!1,{},t.datavisualization.Diagram.PortDefaults,i);return r.name||(r.name="port_"+t.datavisualization.Diagram.Util.randomId()),r};t.datavisualization.Diagram.StopDefaults={color:"",offset:0,opacity:1};t.datavisualization.Diagram.Stop=function(i){return n.extend(!1,{},t.datavisualization.Diagram.StopDefaults,i)};t.datavisualization.Diagram.LinearGradientDefaults={type:"linear",x1:0,x2:0,y1:0,y2:0,stops:[]};t.datavisualization.Diagram.LinearGradient=function(i){i.stops=i.stops?i.stops.slice():[];for(var r=0;i.stops&&r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!1,{},t.datavisualization.Diagram.LinearGradientDefaults,i)};t.datavisualization.Diagram.RadialGradientDefaults={type:"radial",cx:0,cy:0,fx:0,fy:0,r:50,stops:[]};t.datavisualization.Diagram.RadialGradient=function(i){i.stops=i.stops?i.stops.slice():[];for(var r=0;r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!1,{},t.datavisualization.Diagram.RadialGradientDefaults,i)};t.datavisualization.Diagram.NodeBaseDefaults={name:"",width:0,height:0,offsetX:0,offsetY:0,visible:!0,zOrder:-1,excludeFromLayout:!1,constraints:t.datavisualization.Diagram.NodeConstraints.Default,parent:"",labels:[],expandIcon:{shape:t.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:t.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},collapseIcon:{shape:t.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:t.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},ports:[],inEdges:[],outEdges:[],rotateAngle:0,pivot:t.datavisualization.Diagram.Point(.5,.5),addInfo:{},marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,connectorPadding:0,cornerRadius:0,paletteItem:null};t.datavisualization.Diagram.NodeBase=function(i){var r;if(i.labels=i.labels?i.labels.slice():[],i.ports=i.ports?i.ports.slice():[],i.inEdges=i.inEdges?i.inEdges.slice():[],i.outEdges=i.outEdges?i.outEdges.slice():[],i.expandIcon&&(i.expandIcon=t.datavisualization.Diagram.expandIcon(i.expandIcon?i.expandIcon:{})),i.collapseIcon&&(i.collapseIcon=t.datavisualization.Diagram.collapseIcon(i.collapseIcon?i.collapseIcon:{})),i.labels)for(r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]),t.datavisualization.Diagram.Util.canMoveLabel(i)&&(i.labels[r].constraints=t.datavisualization.Diagram.LabelConstraints.All&~t.datavisualization.Diagram.LabelConstraints.Selectable),i.labels[r]._parent=i.name;if(i.ports)for(r=0;r<i.ports.length;r++)i.ports[r].parent=i.name,i.ports[r]=t.datavisualization.Diagram.Port(i.ports[r]);return i.paletteItem=t.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),n.extend(!1,{},t.datavisualization.Diagram.NodeBaseDefaults,i)};t.datavisualization.Diagram.NodeDefaults={fillColor:"white",borderColor:"black",borderWidth:1,borderDashArray:"",opacity:1,gradient:null,borderGradient:null,type:t.datavisualization.Diagram.Shapes.Basic,flip:t.datavisualization.Diagram.FlipDirection.None,isExpanded:!0,shadow:t.datavisualization.Diagram.Shadow(),cssClass:""};t.datavisualization.Diagram.Node=function(i){return i=i||{},i.pivot=i.pivot||{},i.pivot=t.datavisualization.Diagram.Point(i.pivot.x!==undefined?i.pivot.x:.5,i.pivot.y!==undefined?i.pivot.y:.5),i.container&&n.isEmptyObject(i.container)&&(i.container=null),(i.linearGradient||i.radialGradient)&&(i.gradient=i.linearGradient||i.radialGradient),i.gradient&&(i.gradient.type==="linear"?i.gradient=t.datavisualization.Diagram.LinearGradient(i.gradient):i.gradient.type==="radial"&&(i.gradient=t.datavisualization.Diagram.RadialGradient(i.gradient))),i.borderGradient&&(i.borderGradient.type==="linear"?i.borderGradient=t.datavisualization.Diagram.LinearGradient(i.borderGradient):i.borderGradient.type==="radial"&&(i.borderGradient=t.datavisualization.Diagram.RadialGradient(i.borderGradient))),i.shadow&&(i.shadow=t.datavisualization.Diagram.Shadow(i.shadow)),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i&&!i.name&&(i.name="node_"+t.datavisualization.Diagram.Util.randomId()),i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.width||i._width||(i._width=i.minWidth?i.minWidth:i.maxWidth),i.height||i._height||(i._height=i.minHeight?i.minHeight:i.maxHeight),i._hidePorts&&(i.ports=[]),n.extend(!1,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.NodeBase(i),t.datavisualization.Diagram.Shape(i))};t.datavisualization.Diagram.ConnectorDefaults={name:"",visible:!0,lineDashArray:"",targetDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},shape:undefined,segments:[t.datavisualization.Diagram.Segment({type:"straight"})],sourcePoint:t.datavisualization.Diagram.Point(),targetPoint:t.datavisualization.Diagram.Point(),lineColor:"black",lineWidth:1,flip:t.datavisualization.Diagram.FlipDirection.None,constraints:t.datavisualization.Diagram.ConnectorConstraints.Default,opacity:1,parent:"",labels:[],zOrder:-1,lineHitPadding:10,addInfo:{},targetNode:null,targetPort:null,sourceNode:null,sourcePort:null,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,cornerRadius:0,bridgeSpace:10,sourcePadding:0,targetPadding:0,type:"connector",cssClass:"",_endPointHitPadding:t.datavisualization.Diagram.EndPointHitPadding()};t.datavisualization.Diagram.Connector=function(i){if(i=i||{},i.labels=i.labels?i.labels.slice():[],i.segments=i.segments?i.segments.slice():[],i._endPointHitPadding=t.datavisualization.Diagram.EndPointHitPadding(i.endPointHitPadding),i.sourcePoint=i.sourcePoint||{},i.sourcePoint=t.datavisualization.Diagram.Point(i.sourcePoint.x!==undefined?i.sourcePoint.x:.5,i.sourcePoint.y!==undefined?i.sourcePoint.y:.5),i.targetPoint=i.targetPoint||{},i.targetPoint=t.datavisualization.Diagram.Point(i.targetPoint.x!==undefined?i.targetPoint.x:.5,i.targetPoint.y!==undefined?i.targetPoint.y:.5),i.name=i.name?i.name:t.datavisualization.Diagram.Util.randomId(),i.targetDecorator=t.datavisualization.Diagram.Decorator(i.targetDecorator||{}),i.sourceDecorator=t.datavisualization.Diagram.Decorator(i.sourceDecorator&&!n.isEmptyObject(i.sourceDecorator)?i.sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.None}),i.segments=i.segments||[t.datavisualization.Diagram.Segment({type:"straight"})],i._srcDecoratorSize=Math.max(parseInt(i.sourceDecorator.height),parseInt(i.sourceDecorator.width))+5*i.sourceDecorator.borderWidth,i._tarDecoratorSize=Math.max(parseInt(i.targetDecorator.height),parseInt(i.targetDecorator.width))+5*i.targetDecorator.borderWidth,i._inlineDecorators=[],i.segments&&(i.sourcePoint=i.sourcePoint||t.datavisualization.Diagram.Point(),i.targetPoint=i.targetPoint||t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initializeSegments(i,i.defaultType),t.datavisualization.Diagram.Util.flipConnector(i,i.flip)),i.labels)for(var r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]),t.datavisualization.Diagram.Util.canMoveLabel(i)&&(i.labels[r].constraints=t.datavisualization.Diagram.LabelConstraints.All&~t.datavisualization.Diagram.LabelConstraints.Selectable),i.labels[r]._parent=i.name;return i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.paletteItem=t.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),n.extend(!1,{},t.datavisualization.Diagram.ConnectorDefaults,i)};t.datavisualization.Diagram.ContainerDefaults={type:t.datavisualization.Diagram.ContainerType.Canvas,orientation:"vertical"};t.datavisualization.Diagram.Container=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ContainerDefaults,i)};t.datavisualization.Diagram.GroupDefaults={children:[],canUngroup:!0,allowDrop:!0,container:null,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,type:"group"};t.datavisualization.Diagram.Group=function(i){return i=i?i:{},i.children=i.children?i.children.slice():[],i.type=="bpmn"&&(i=t.datavisualization.Diagram.Node(i)),i.minWidth=i.minWidth?i.minWidth:100,i.minHeight=i.minHeight?i.minHeight:100,i.maxWidth=i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,i.maxHeight=i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,i.container=i.container?t.datavisualization.Diagram.Container(i.container):null,i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i=i||{},i.container&&n.isEmptyObject(i.container)&&(i.container=null),i&&!i.name&&(i.name="group_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.type==="pseudoGroup"&&(i.minWidth=0,i.minHeight=0,i.maxHeight=0,i.maxWidth=0),i._type||i.type=="umlclassifier"||(i._type=i.type?i.type:"group"),n.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.GroupDefaults,t.datavisualization.Diagram.NodeBase(i))};t.datavisualization.Diagram.ZoomCommand={ZoomIn:1,ZoomOut:2};t.datavisualization.Diagram.Zoom=function(i){return n.extend(!0,{},{zoomFactor:.2,focusPoint:null,zoomCommand:t.datavisualization.Diagram.ZoomCommand.ZoomIn},i)};t.datavisualization.Diagram.DragState={Starting:"starting",Dragging:"dragging",Completed:"completed"};t.datavisualization.Diagram.ResizeState={Starting:"starting",Resizing:"resizing",Completed:"completed"};t.datavisualization.Diagram.DiagramConstraints={None:1,UserInteraction:2,APIUpdate:4,PageEditable:6,Bridging:8,Zoomable:16,PannableX:32,PannableY:64,Pannable:96,Undoable:128,Resizable:256,ZoomTextEditor:512,FloatElements:1024,CrispEdges:2048,Routing:4096,Default:502};t.datavisualization.Diagram.BridgeDirection={Top:"top",Bottom:"bottom",Left:"left",Right:"right"};t.datavisualization.Diagram.Tool={None:1,SingleSelect:2,MultipleSelect:4,ZoomPan:8,DrawOnce:16,ContinuesDraw:32};t.datavisualization.Diagram.Region={Content:"content",PageSettings:"pageSettings"};t.datavisualization.Diagram.FileFormats={JPG:"jpg",PNG:"png",BMP:"bmp",SVG:"svg"};t.datavisualization.Diagram.ExportModes={Download:"download",Data:"data"};t.datavisualization.Diagram.FitMode={Page:"page",Width:"width",Height:"height"};t.datavisualization.Diagram.Stretch={None:"none",Fill:"fill",Uniform:"uniform",UniformToFill:"uniformtofill"};t.datavisualization.Diagram.shapeType={Image:"image",Path:"path",Native:"native"};t.datavisualization.Diagram.UserHandleDefaults={name:"",pathData:"",templateId:"",source:"",shape:t.datavisualization.Diagram.shapeType.Path,borderColor:"",backgroundColor:"#2382c3",position:"",offset:t.datavisualization.Diagram.Point(.5,1),margin:{left:0,right:0,top:0,bottom:-25},horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,pathColor:"white",tool:"",size:20,visible:!0,enableMultiSelection:!1};t.datavisualization.Diagram.UserHandle=function(i){return n.extend(!0,{},t.datavisualization.Diagram.UserHandleDefaults,i)};t.datavisualization.Diagram.SwimLaneDefaults={header:n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,{text:"Title",borderColor:"black",fillColor:"#C7D4DF",horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Stretch,width:50,height:50}),fillColor:"transparent",orientation:"vertical",type:"group",isSwimlane:!0,offsetX:100,offsetY:100,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,height:100,width:100,lanes:[],phases:[],phaseSize:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~(t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),addInfo:{},cssClass:""};t.datavisualization.Diagram.SwimLane=function(i){return i=i||{},i.lanes=i.lanes?i.lanes.slice():[],i.phases=i.phases?i.phases.slice():[],i&&!i.name&&(i.name="swimlane_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.header||(i.header={}),i.header.height=i.header.height!=undefined?i.header.height:50,i.header.width=i.header.width!=undefined?i.header.width:50,n.extend(!0,{},t.datavisualization.Diagram.SwimLaneDefaults,i)};t.datavisualization.Diagram.LaneDefaults={header:n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,{text:"Function",borderColor:"black",fillColor:"#C7D4DF",horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Stretch,width:50,height:50}),name:"",children:[],isLane:!0,orientation:"horizontal",fillColor:"#f5f5f5",labels:[],addInfo:{},minHeight:100,minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:""};t.datavisualization.Diagram.Lane=function(i){return i=i||{},i.labels=i.labels?i.labels.slice():[],i.children=i.children?i.children.slice():[],i&&!i.name&&(i.name="lane_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),n.extend(!0,{},t.datavisualization.Diagram.LaneDefaults,i)};t.datavisualization.Diagram.PhaseDefaults={name:"",type:"phase",offset:100,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",parent:"",fillColor:"white",orientation:"horizontal",label:{text:"Phase"}};t.datavisualization.Diagram.Phase=function(i){return i.label&&(i.label=t.datavisualization.Diagram.Label(i.label),i._UndoRedo||i._isUndo||(i.label.text=i.label.text?i.label.text:"Phase")),n.extend(!0,{},t.datavisualization.Diagram.PhaseDefaults,i)};t.datavisualization.Diagram.PaletteItemDefaults={width:undefined,height:undefined,enableScale:!0,previewHeight:undefined,previewWidth:undefined,wrapping:t.datavisualization.Diagram.TextWrapping.NoWrap,label:null,margin:t.datavisualization.Diagram.Margin({left:4,right:4,top:4,bottom:4})};t.datavisualization.Diagram.PaletteItem=function(i){return i.margin=i.margin||{},i.margin.left=i.margin.left!==undefined?i.margin.left:4,i.margin.right=i.margin.right!==undefined?i.margin.right:4,i.margin.top=i.margin.top!==undefined?i.margin.top:4,i.margin.bottom=i.margin.bottom!==undefined?i.margin.bottom:4,i.margin=t.datavisualization.Diagram.Margin(i.margin),n.extend(!1,{},t.datavisualization.Diagram.PaletteItemDefaults,i)};t.datavisualization.Diagram.SwimLaneHelper={_initSwimLane:function(i,r,u){var f=null,b=null,i=t.datavisualization.Diagram.SwimLane(i),k,s,e,a,v,o;i.orientation=i.orientation?i.orientation:"vertical";k=this._initphases(i,r);b=this._initLanes(i,r,u);s=[];e=null;i.header||(i.header={text:"",height:0,fillColor:"white"});i.orientation==="horizontal"?a=i.header.height:v=i.header.width;i.header&&(e=t.datavisualization.Diagram.Node({_type:"node",_isHeader:!0,name:i.name+"_header_swimlane",labels:[i.header],height:a?a:50,width:v?v:50,fillColor:i.header.fillColor?i.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name}));e&&(r.nodes().push(e),r._nodes=n.extend(!0,[],r.nodes()),r.nameTable[e.name]=e,s.push(e.name));o=null;o=i.phaseSize==0?.001:i.phaseSize?i.phaseSize:20;var tt=this._initPhaseStack(i,r,s,o),g=null,nt=null;i.orientation=="vertical"?nt="stretch":g="stretch";var y,d=0,p=0,w=0;i.orientation=="horizontal"?(y="vertical",p=(i.header?i.header.height:50)+o,w=0):(y="horizontal",p=i.header?i.header.height:50,d=i.phaseSize?i.phaseSize:o,w=(i.header?i.header.height:50)+o);var h=t.datavisualization.Diagram.Group({name:i.name+"_stack",children:b,parent:i.name,container:{type:t.datavisualization.Diagram.ContainerType.Stack,orientation:y},horizontalAlign:"stretch",verticalAlign:"stretch",marginTop:p,width:10,height:10,marginLeft:d,minHeight:w,constraints:t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect)}),c=0,l=0;return i.orientation=="horizontal"?(c=i.width,l=100):i.orientation=="vertical"&&(c=100,l=i.height-e.height),r.nodes().push(h),r._nodes=n.extend(!0,[],r.nodes()),r.nameTable[h.name]=h,s.push(h.name),f=t.datavisualization.Diagram.Group({name:i.name?i.name:"",type:"group",addInfo:i.addInfo?i.addInfo:{},parent:"",offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,children:s,zOrder:i.zOrder||i.zOrder===0?i.zOrder:-1,fillColor:"transparent",labels:[{mode:t.datavisualization.Diagram.LabelEditMode.View}],container:{type:t.datavisualization.Diagram.ContainerType.Canvas},minHeight:l?l:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:c?c:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,constraints:i.constraints?i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.AllowDrop^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest,phaseSize:o,cssClass:i.cssClass}),f.isSwimlane=!0,f.phases=k,f.orientation=i.orientation,f.constraints=f.orientation=="horizontal"?f.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast:f.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeSouth^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast,f},_initPhaseStack:function(i,r,u,f){var c="horizontal",y="left",p="top",l,h,v,e,o;c&&(i.orientation=="horizontal"?(c="horizontal",y="stretch",l=!0):(c="vertical",p="stretch",l=!1));var s=t.datavisualization.Diagram.Group({name:i.name+"phaseStack",container:{type:"stack",orientation:c},type:"group",parent:i.name,offsetX:0,offsetY:0,minHeight:f,maxHeight:f,minWidth:f,maxWidth:f,marginTop:i.header?i.header.height:50,isPhaseStack:!0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),a=0;for(i.phaseSize&&(i.phaseSize=i.phaseSize<1?20:i.phaseSize),e=0;e<i.phases.length;e++)l?(h=i.phaseSize?i.phaseSize:20,v=i.phases[e].offset-a):(h=i.phases[e].offset-a,e==0&&(h=h-(i.header?i.header.height:50)),v=i.phaseSize?i.phaseSize:20,i.phases[e].label&&(i.phases[e].label.rotateAngle=270)),o=t.datavisualization.Diagram.Node({parent:i.name+"phaseStack",_isHeader:!0,name:"phaseStack"+i.phases[e].name,height:h,width:v,labels:[i.phases[e].label],constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),o.labels[0].name="phaseStack"+i.phases[e].name+"label",o.labels[0].mode=t.datavisualization.Diagram.LabelEditMode.View,o.isPhase=!0,a=i.phases[e].offset,r.nameTable[o.name]=o,s.children.push(o.name),r.nodes().push(o),r._nodes=n.extend(!0,[],r.nodes());r.nodes().push(s);r._nodes=n.extend(!0,[],r.nodes());u.push(s);r.nameTable[s.name]=s},_setDefaultLaneProperties:function(n){n.lanes=n.lanes?n.lanes:[];n.lanes.push(t.datavisualization.Diagram.Lane({}))},_initLanes:function(i,r,u){var o=[],e=null,f;if(i.lanes&&i.lanes.length!==0||this._setDefaultLaneProperties(i),i.lanes)for(f=0;f<i.lanes.length;f++)jQuery.isEmptyObject(i.lanes[f])&&(i.lanes[f]=t.datavisualization.Diagram.Lane()),i.lanes[f]._laneHeader=i.lanes[f]._laneHeader?i.lanes[f]._laneHeader:i.lanes[f].header,e=this._initLane(i.lanes[f],i,r,u),o.push(e.name),r.nodes().push(e),r._nodes=n.extend(!0,[],r.nodes()),r.nameTable[e.name]=e;return o},_initLane:function(i,r,u,f){var c=null,l=null,y,e,s,v,o,a,h;if(r.orientation=="horizontal"?c="stretch":l="stretch",y=!1,e=t.datavisualization.Diagram.Group({name:i.name,addInfo:i.addInfo?i.addInfo:{},type:"group",isLane:!0,parent:r.name+"_stack",offsetX:0,offsetY:0,borderColor:i.borderColor?i.borderColor:"black",orientation:r.orientation?r.orientation:"horizontal",fillColor:i.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:c?c:"left",verticalAlign:l?l:"top",minHeight:i.height?i.height:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:i.width?i.width:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:i.constraints?i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass}),i.labels&&i.labels.length>0){for(s=0;s<i.labels.length;s++)i.labels[s]=t.datavisualization.Diagram.Label(i.labels[s]);e.labels=i.labels}for(f||(v=i._laneHeader?i._laneHeader:null,o=this._iniLaneHeader(i,e.name,r,u,v),o&&(u.nodes().push(o),u._nodes=n.extend(!0,[],u.nodes()),u.nameTable[o.name]=o,e.children.push(o.name))),a=this._initChildren(i,e.name,u),h=0;h<a.length;h++)e.children.push(a[h]);return e},_iniLaneHeader:function(n,i,r,u,f){var e=null;return n.header&&(e=t.datavisualization.Diagram.Node({_isHeader:!0,name:i+"_Headerr_",type:"node",labels:[r.header],height:f.height?f.height:50,width:f.width?f.width:50,fillColor:n.header.fillColor?n.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20,parent:i}),r.orientation&&r.orientation=="horizontal"?(e.verticalAlign="stretch",e.height=1,e.width=f.width?f.width:50):r.orientation&&r.orientation=="vertical"&&(e.horizontalAlign="stretch",e.labels[0].rotateAngle=0,e.height=f.width?f.width:50,e.width=1)),e},_initChildren:function(t,i,r){var o=[],u=null,f,e;if(t.children)for(f=0;f<t.children.length;f++)u=typeof t.children[f]=="object"?t.type&&t.type==="bpmn"?t.children[f]:this._initChild(t.children[f],i,r):r.nameTable[r._getChild(t.children[f])],u&&(u.segments?(r.connectors().push(u),r._connectors=n.extend(!0,[],r.connectors())):(u.children&&(e=this._initChildren(u,u.name,r)),e&&(u.children=e),r.nodes().push(u),r._nodes=n.extend(!0,[],r.nodes())),o.push(u.name),r.nameTable[u.name]=u);return o},_initChild:function(n,i,r){var u=null;return u=n&&n.children&&n.children.length>0?r._getNewGroup(t.datavisualization.Diagram.NodeType(n,r)):r._getNewNode(t.datavisualization.Diagram.NodeType(n,r)),u.parent=i,u},_swapPhaseSize:function(n){if(n.phases.length>0)for(var i=n.phases,t,u,r=0;r<i.length;r++)for(t=0;t<i.length-r-1;t++)i[t].offset>i[t+1].offset&&(u=i[t],i[t]=i[t+1],i[t+1]=u)},_setSwimlaneSize:function(n){var t,i;if(n.phases.length>0)for(i in n.phases)t=n.phases[i],n.orientation==="horizontal"?t.offset>n.width&&(n.width=t.offset):t.offset>n.height&&(n.height=t.offset)},_setLastPhaseSize:function(n){if(n.phases.length>0){var t=n.phases[n.phases.length-1];t.offset=n.orientation==="horizontal"?n.width:n.height}},_NeedDefaultPhase:function(n){return n.phases.length>0?!1:!0},_checkForDefPhase:function(n){return n.phases.length>0?!1:!0},_initphases:function(n,i){var e=[],r=null,o=0,f=0,s,u;if(n.orientation==="vertical"?(f=n.height,o=270):f=n.width,s=t.datavisualization.Diagram.Phase({name:n.name+"defPhase",offset:f,label:n._lastPhase?n._lastPhase.labels[0]:{text:"Phase",rotateAngle:o}}),this._NeedDefaultPhase(n)?n.phases.push(s):(this._swapPhaseSize(n),this._setSwimlaneSize(n),this._setLastPhaseSize(n)),n.phases&&n.phases.length>0)for(u=0;u<n.phases.length;u++)r=t.datavisualization.Diagram.Phase(n.phases[u]),r.parent=n.name,r.orientation=n.orientation,i.nameTable[r.name]=r,e.push(r.name);return e},_createSwimlane:function(n,i,r,u,f){var l=[],a=r?r.childTable:i.nameTable,o=500,s=500,h=null,p=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default,e,c,v,y;return n.children[0]?(e=u?n.children[0]:a[i._getChild(n.children[0])],e||(e=f),typeof e=="string"&&(e=a[e]),h={text:"Title",width:50,fillColor:e.fillColor?e.fillColor:n.fillColor,height:50}):h={text:"Title",width:50,fillColor:"white",height:50},n.orientation||n.container&&(n.orientation=n.container.orientation),c=0,n.orientation=="horizontal"&&i._selectedSymbol?(o=n.height?n.height:100,s=n.width?n.width:650,c=o):(o=n.height?n.height:650,s=n.width?n.width:100,c=n.height+h.height),n.children.length>1&&(n.children.splice(0,1),l=n.children),v={name:n.name+t.datavisualization.Diagram.Util.randomId(),header:h,fillColor:"white",isSwimlane:!0,minWidth:s,minHeight:o,height:c+1,width:s+1,maxHeight:o+Number.POSITIVE_INFINITY,maxWidth:s+Number.POSITIVE_INFINITY,offsetX:n.offsetX,offsetY:n.offsetY,orientation:n.orientation?n.orientation:"horizontal",addInfo:n.addInfo?n.addInfo:null,paletteItem:n.paletteItem?n.paletteItem:null,lanes:[{name:n.name,addInfo:n.addInfo?n.addInfo:{},constraints:p,header:{text:e.labels[0].text||e.labels[0].text===""?e.labels[0].text:"HEADER",fontSize:e.labels[0].fontSize?e.labels[0].fontSize:11,width:e.width?e.width:50,height:e.height?e.height:50,fillColor:e.fillColor,bold:e.labels[0].bold?!0:!1,italic:e.labels[0].italic?!0:!1,fontFamily:e.labels[0].fontFamily?e.labels[0].fontFamily:"Arial",fontColor:e.labels[0].fontColor?e.labels[0].fontColor:"black"},fillColor:n.fillColor?n.fillColor:"white",height:o,width:s,minHeight:o,minWidth:s,children:l?l:[],_laneHeader:n._laneHeader?n._laneHeader:null},]},y=t.datavisualization.Diagram.ContainerHelper._initContainer(i,v),y},_createDiagramLane:function(n){var i=n._lane?n._lane:null,r=n.orientation,f=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default,u={children:[{name:n.name+"_Headerr_",height:i.header?i.header.height:50,width:i.header?i.header.width:50,fillColor:i.header?i.header.fillColor:50,labels:i.header?[i.header]:[],horizontalAlign:r==="vertical"?"stretch":"left",verticalAlign:r==="vertical"?"top":"stretch"}],container:{type:"canvas"},name:n.name?n.name:t.datavisualization.Diagram.Util.randomId(),minHeight:i.minHeight?i.minHeight:100,minWidth:i.minWidth?i.minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,borderColor:"black",constraints:f|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass?i.cssClass:"",addInfo:i.addInfo?i.addInfo:null,paletteItem:n.paletteItem?n.paletteItem:null,fillColor:i.fillColor?i.fillColor:"white",isLane:!0,offsetX:n.offsetX?n.offsetX:100,offsetY:n.offsetY?n.offsetY:100,orientation:r?r:"horizontal"};return u.children[0].labels[0].rotateAngle=r==="horizontal"?270:0,u},_createPaletteLane:function(n,i){var r=0,u=0,f=0,e=0,l=0,a="left",c=0,v,y,h,s,o;return n=t.datavisualization.Diagram.Lane(n),v=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default,!n.paletteItem||n.paletteItem.enableScale||n.paletteItem.width||n.orientation==="horizontal"&&(c+=2),n.orientation=="horizontal"?(r=n.height?n.height:50,u=25,f=14+c,e=r/2+1,l=270,a="left"):n.orientation=="vertical"&&(r=25,u=n.width?n.width:50,f=u/2,e=15,a="left"),y=n.header.text?n.header.text:"",h=t.datavisualization.Diagram.Node({name:n.name+"_"+y,_type:"node",labels:[{text:n.header.text?n.header.text:"Function",fontSize:n.header.fontSize?n.header.fontSize:11,offset:{x:.5,y:.5},width:100,rotateAngle:l}],height:r,width:u,fillColor:n.header.fillColor?n.header.fillColor:"white",parent:n.name,offsetX:f,offsetY:e,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Connect}),i[h.name]=h,n.orientation=="horizontal"?(r=n.height,u=n.width-25,f=25+u/2+c,e=r/2+1):n.orientation=="vertical"&&(r=n.height-25,u=n.width,f=u/2,e=25+r/2),s=t.datavisualization.Diagram.Node({name:n.name+"content",_type:"node",height:r,width:u,fillColor:n.fillColor?n.fillColor:"white",parent:n.name,offsetX:f,offsetY:e}),s._laneHeader=n.header,i[s.name]=s,o=t.datavisualization.Diagram.Group({name:n.name+"_group",addInfo:n.addInfo?n.addInfo:{},height:n.height,width:n.width,header:n.header?n.header:null,offsetX:n.offsetX,offsetY:n.offsetY,children:[h.name,s.name,],paletteItem:n.paletteItem?n.paletteItem:null}),o._lane=n,o.constraints=v,o.isLane=!0,o.orientation=n.orientation,o},_mapObject:function(n,t,i,r){var u;switch(i){case"lane":u=this._mapLane(n,t);break;case"phase":u=this._mapPhase(n,t);break;case"swimlane":u=this._mapSwimlane(n,t,r)}return u},_mapLane:function(n,i,r){var u=t.datavisualization.Diagram.Lane();return this._mapLaneHeader(n,i,u,r),this._mapChildren(n,i,u,r),u.name=i.name,u.labels=i.labels,u.fillColor=i.fillColor,u.orientation=i.orientation,u.maxHeight=i.maxHeight,u.maxWidth=i.maxWidth,u.minHeight=i.height>i.minHeight?i.height:i.minHeight,u.minWidth=i.width>i.minWidth?i.width:i.minWidth,u.constraints=i.constraints,u.addInfo=i.addInfo?i.addInfo:{},i.orientation==="horizontal"?(u.height=i.height,u.width=null):(u.height=null,u.width=i.width),u},_mapLaneHeader:function(n,t,i,r){var u;t.children[0]&&(u=n.nameTable[n._getChild(t.children[0])]);!u&&r&&(u=r[n._getChild(t.children[0])]);u&&(u.labels&&u.labels[0]&&(u.name&&(i.header.name=u.name),i.header.text=u.labels[0].text,i.header.fontColor=u.labels[0].fontColor,i.header.fontSize=u.labels[0].fontSize,i.header.fontFamily=u.labels[0].fontFamily,i.header.bold=u.labels[0].bold,i.header.italic=u.labels[0].italic,i.header.textDecoration=u.labels[0].textDecoration,i.header.rotateAngle=u.labels[0].rotateAngle,i.header.textOverflow=u.labels[0].textOverflow,i.header.overflowType=u.labels[0].overflowType,u.labels[0].name&&(i.header._labelName=u.labels[0].name)),i.header.fillColor=u.fillColor,t.orientation==="vertical"?(i.header.height=u.height,i.header.width=null):(i.header.height=null,i.header.width=u.width))},_mapChildren:function(n,t,i,r){var u,f;if(t.children&&t.children.length>=2)for(f=1;f<t.children.length;f++)n._getChild(t.children[f])&&(u=n.nameTable[n._getChild(t.children[f])]),r&&!u&&(u=r[n._getChild(t.children[f])]),u&&(u.marginRight=0,u.marginBottom=0,i.children.push(u))},_mapSwimlane:function(n,i,r){var u=t.datavisualization.Diagram.SwimLane();return this._mapSwimlaneHeader(n,i,u,r),this._mapLanes(n,i,u,r),this._mapPhases(n,i,u,r),u.name=i.name,u.orientation=i.orientation,u.offsetX=i.offsetX,u.offsetY=i.offsetY,u.maxHeight=i.maxHeight,u.maxWidth=i.maxWidth,u.minHeight=i.minHeight,u.minWidth=i.minWidth,u.minWidth=u.orientation==="horizontal"?i.width&&i.minWidth&&i.width>i.minWidth?i.width:i.minWidth:i.minWidth,u.phaseSize=i.phaseSize,u.constraints=i.constraints,u.zOrder=i.zOrder,u.addInfo=i.addInfo?i.addInfo:{},u.height=i.height,u.width=i.width,u},_mapSwimlaneHeader:function(n,t,i,r){if(t.children[0])var u=n.nameTable[n._getChild(t.children[0])];!u&&r&&(u=r[n._getChild(t.children[0])]);u&&(u.labels&&u.labels[0]&&(i.header.text=u.labels[0].text,i.header.fontColor=u.labels[0].fontColor,i.header.fontSize=u.labels[0].fontSize,i.header.fontFamily=u.labels[0].fontFamily,i.header.bold=u.labels[0].bold,i.header.italic=u.labels[0].italic,i.header.textDecoration=u.labels[0].textDecoration,i.header.textOverflow=u.labels[0].textOverflow,i.header.overflowType=u.labels[0].overflowType),i.header.fillColor=u.fillColor,i.header.height=u.height,i.header.width=u.width)},_mapLanes:function(n,t,i,r){var u,e,o,f;if(t.children[2]&&n._getChild(t.children[2])&&(u=r?r[n._getChild(t.children[2])]:n.nameTable[n._getChild(t.children[2])]),u&&u.children&&u.children.length>0)for(f=0;f<u.children.length;f++)n._getChild(u.children[f])&&(e=r?r[n._getChild(u.children[f])]:n.nameTable[n._getChild(u.children[f])]),e&&(o=this._mapLane(n,e,r),o&&i.lanes.push(o))},_mapPhases:function(n,i,r,u){var f=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i,u),s,e,h,o,c;if(f&&f.length>0){for(s=f.length,e=u?u:n.nameTable,f[f.length-1]&&e[f[f.length-1]]&&(h=e[f[f.length-1]],h.name.split("defPhase").length>1||h.offset==i.width||s++),o=0;o<s;o++)c=this._mapPhase(n,e[n._getChild(f[o])],u),c&&r.phases.push(c);e["phaseStack"+f[f.length-1]]&&(r._lastPhase=this._mapPhase(n,e["phaseStack"+f[f.length-1]],u))}},_mapPhase:function(n,t,i){var r;return t&&(r=i?i[t.name]:n.nameTable[t.name]),r?r:null},_getSwimLaneNode:function(n,t,i,r){if(n.isSwimlane)if(i){if(r.nameTable[r._getChild(n.children[2])].container.orientation==t.orientation)return n}else if(r.nameTable[r._getChild(n.children[2])].container.orientation!=t.orientation)return n;if(n.parent){var u=r.nameTable[n.parent];if(u)return this._getSwimLaneNode(u,t,undefined,r)}return null}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.BasicShapes={Rectangle:"rectangle",Ellipse:"ellipse",Path:"path",Polygon:"polygon",Triangle:"triangle",Plus:"plus",Star:"star",Pentagon:"pentagon",Heptagon:"heptagon",Octagon:"octagon",Trapezoid:"trapezoid",Decagon:"decagon",RightTriangle:"righttriangle",Cylinder:"cylinder"};t.datavisualization.Diagram.FlowShapes={Process:"process",Decision:"decision",Document:"document",PreDefinedProcess:"predefinedprocess",Terminator:"terminator",PaperTap:"papertap",DirectData:"directdata",SequentialData:"sequentialdata",Sort:"sort",MultiDocument:"multidocument",Collate:"collate",SummingJunction:"summingjunction",Or:"or",InternalStorage:"internalstorage",Extract:"extract",ManualOperation:"manualoperation",Merge:"merge",OffPageReference:"offpagereference",SequentialAccessStorage:"sequentialaccessstorage",Annotation1:"annotation1",Annotation2:"annotation2",Data:"data",Card:"card"};t.datavisualization.Diagram.ArrowShapes={None:"none",CircularArrow:"circulararrow",CurvedRightArrow:"curvedrightarrow",CurvedUpArrow:"curveduparrow",CurvedLeftArrow:"curvedleftarrow",CurvedDownArrow:"curveddownarrow",JumpingRightArrow:"jumpingrightarrow",JumpingLeftArrow:"jumpingleftarrow"};t.datavisualization.Diagram.BPMNShapes={Event:"event",Gateway:"gateway",Message:"message",DataObject:"dataobject",DataSource:"datasource",Activity:"activity",Group:"group"};t.datavisualization.Diagram.BPMNEvents={Start:"start",Intermediate:"intermediate",End:"end",NonInterruptingStart:"noninterruptingstart",NonInterruptingIntermediate:"noninterruptingintermediate",ThrowingIntermediate:"throwingintermediate"};t.datavisualization.Diagram.BPMNTriggers={None:"none",Message:"message",Timer:"timer",Escalation:"escalation",Link:"link",Error:"error",Compensation:"compensation",Signal:"signal",Multiple:"multiple",Parallel:"parallel",Cancel:"cancel",Conditional:"conditional",Terminate:"terminate"};t.datavisualization.Diagram.BPMNGateways={None:"none",Exclusive:"exclusive",Inclusive:"inclusive",Parallel:"parallel",Complex:"complex",EventBased:"eventbased",ExclusiveEventBased:"exclusiveeventbased",ParallelEventBased:"paralleleventbased"};t.datavisualization.Diagram.BPMNDataObjects={None:"none",Input:"input",Output:"output"};t.datavisualization.Diagram.BPMNActivity={None:"none",Task:"task",SubProcess:"subprocess"};t.datavisualization.Diagram.BPMNLoops={None:"none",Standard:"standard",ParallelMultiInstance:"parallelmultiinstance",SequenceMultiInstance:"sequencemultiinstance"};t.datavisualization.Diagram.BPMNTasks={None:"none",Service:"service",Receive:"receive",Send:"send",InstantiatingReceive:"instantiatingreceive",Manual:"manual",BusinessRule:"businessrule",User:"user",Script:"script",Parallel:"parallel"};t.datavisualization.Diagram.BPMNSubProcessTypes={None:"none",Transaction:"transaction",Event:"event"};t.datavisualization.Diagram.BPMNBoundary={Default:"default",Call:"call",Event:"event"};t.datavisualization.Diagram.BPMNAnnotationDirections={Top:"top",Left:"left",Right:"right",Bottom:"bottom"};t.datavisualization.Diagram.BPMNFlows={Sequence:"sequence",Association:"association",Message:"message"};t.datavisualization.Diagram.BPMNSequenceFlows={Normal:"normal",Conditional:"conditional",Default:"default"};t.datavisualization.Diagram.BPMNMessageFlows={Default:"default",InitiatingMessage:"initiatingmessage",NonInitiatingMessage:"noninitiatingmessage"};t.datavisualization.Diagram.ClassifierShapes={Package:"package",Class:"class",Interface:"interface",Enumeration:"enumeration",CollapsedPackage:"collapsedpackage",Inheritance:"inheritance",Association:"association",Aggregation:"aggregation",Composition:"composition",Realization:"realization",DirectedAssociation:"directedassociation",Dependency:"dependency"};t.datavisualization.Diagram.AssociationFlows={Default:"default",Directional:"directional",BiDirectional:"bidirectional"};t.datavisualization.Diagram.UMLActivityShapes={Action:"action",Decision:"decision",MergeNode:"mergenode",InitialNode:"initialnode",FinalNode:"finalnode",ForkNode:"forknode",JoinNode:"joinnode",TimeEvent:"timeevent",AcceptingEvent:"acceptingevent",SendSignal:"sendsignal",ReceiveSignal:"receivesignal",StructuredNode:"structurednode",Note:"note"};t.datavisualization.Diagram.UMLActivityFlow={Object:"object",Control:"control",Exception:"exception"};t.datavisualization.Diagram.BPMNEventDefaults={event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.None,name:null,offset:t.datavisualization.Diagram.Point(),ports:[],labels:[]};t.datavisualization.Diagram.BPMNGatewayDefaults={gateway:t.datavisualization.Diagram.BPMNGateways.None};t.datavisualization.Diagram.BPMNDataObject=function(i){return n.extend(!1,{},{type:t.datavisualization.Diagram.BPMNDataObjects.None,collection:!1},i)};t.datavisualization.Diagram.BPMNDataObjectDefaults={data:t.datavisualization.Diagram.BPMNDataObject()};t.datavisualization.Diagram.BPMNTaskDefaults={loop:t.datavisualization.Diagram.BPMNLoops.None,type:t.datavisualization.Diagram.BPMNTasks.None,call:!1,compensation:!1,events:[]};t.datavisualization.Diagram.BPMNTask=function(i){return i&&(i.events=i.events?i.events.slice():[]),n.extend(!1,{},t.datavisualization.Diagram.BPMNTaskDefaults,i)};t.datavisualization.Diagram.BPMNSubProcessDefaults={type:t.datavisualization.Diagram.BPMNSubProcessTypes.None,event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.Message,boundary:t.datavisualization.Diagram.BPMNBoundary.Default,loop:t.datavisualization.Diagram.BPMNLoops.None,adhoc:!1,compensation:!1,collapsed:!0,events:[],processes:[]};t.datavisualization.Diagram.BPMNSubProcess=function(i){return i=i||{},i.events=i.events?i.events.slice():[],i.processes=i.processes?i.processes.slice():[],n.extend(!1,{},t.datavisualization.Diagram.BPMNSubProcessDefaults,i)};t.datavisualization.Diagram.BPMNActivityDefaults={activity:t.datavisualization.Diagram.BPMNActivity.Task,task:t.datavisualization.Diagram.BPMNTask(),subProcess:t.datavisualization.Diagram.BPMNSubProcess()};t.datavisualization.Diagram.BPMNTextAnnotationDefaults={annotation:{width:20,height:20,angle:0,length:0,text:"",direction:t.datavisualization.Diagram.BPMNAnnotationDirections.Left}};t.datavisualization.Diagram.ConnectorShapeDefaults={type:"bpmn",flow:t.datavisualization.Diagram.BPMNFlows.Sequence,sequence:t.datavisualization.Diagram.BPMNSequenceFlows.Normal,association:t.datavisualization.Diagram.AssociationFlows.Default,message:t.datavisualization.Diagram.BPMNMessageFlows.Default};t.datavisualization.Diagram.Multiplicity={OneToOne:"onetoone",OneToMany:"onetomany",ManyToOne:"manytoone",ManyToMany:"manytomany"};t.datavisualization.Diagram.ClassifierMultiplicityDefault={type:t.datavisualization.Diagram.Multiplicity.OneToOne,source:{optional:!0,lowerBounds:null,upperBounds:null},target:{optional:!0,lowerBounds:null,upperBounds:null}};t.datavisualization.Diagram.UMLActivityFlowDefaults={type:"umlactivity",activityFlow:t.datavisualization.Diagram.UMLActivityFlow.Control};t.datavisualization.Diagram.AssociationDefaults={type:"classifier",association:t.datavisualization.Diagram.AssociationFlows.BiDirectional,multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault};t.datavisualization.Diagram.AggregationDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault};t.datavisualization.Diagram.CompositionDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault};t.datavisualization.Diagram.DependencyDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault};t.datavisualization.Diagram.RealizationDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault};t.datavisualization.Diagram.InheritanceDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault};t.datavisualization.Diagram.ScopeValueDefaults={Public:"public",Protected:"",Private:"",Package:""};t.datavisualization.Diagram.ClassMemberDefaults={name:"",value:""};t.datavisualization.Diagram.ClassAttributeDefaults={name:"",type:"",scope:t.datavisualization.Diagram.ScopeValueDefaults.Public};t.datavisualization.Diagram.ClassMethodsArgumentsDefault={name:"",type:""};t.datavisualization.Diagram.ClassMethodsDefaults={name:"",type:"",arguments:t.datavisualization.Diagram.ClassMethodsArgumentsDefault,scope:t.datavisualization.Diagram.ScopeValueDefaults.Public};t.datavisualization.Diagram.ClassmethodArguments=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ClassMethodsArgumentsDefault,i)};t.datavisualization.Diagram.ClassMethod=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ClassMethodsDefaults,i)};t.datavisualization.Diagram.ClassMember=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ClassMemberDefaults,i)};t.datavisualization.Diagram.ClassAttribute=function(i){return n.extend(!1,{},t.datavisualization.Diagram.ClassAttributeDefaults,i)};t.datavisualization.Diagram.ClassifierClass=function(i){return i.attributes=i.attributes?i.attributes.slice():[],i.methods=i.methods?i.methods.slice():[],n.extend(!1,{},t.datavisualization.Diagram.ClassDefaults,i)};t.datavisualization.Diagram.ClassifierInterface=function(i){return i.attributes=i.attributes?i.attributes.slice():[],i.methods=i.methods?i.methods.slice():[],n.extend(!1,{},t.datavisualization.Diagram.InterfaceDefaults,i)};t.datavisualization.Diagram.ClassifierEnumeration=function(i){return i.members=i.members?i.members.slice():[],n.extend(!1,{},t.datavisualization.Diagram.EnumerationDefaults,i)};t.datavisualization.Diagram.UMLConnector=function(i){return n.extend(!1,{},t.datavisualization.Diagram.UMLConnectorDefaults,i)};t.datavisualization.Diagram.UMLConnectorAssociation=function(i){return n.extend(!1,{},t.datavisualization.Diagram.AssociationDefaults,i)};t.datavisualization.Diagram.UMLConnectorAggregation=function(i){return n.extend(!1,{},t.datavisualization.Diagram.AggregationDefaults,i)};t.datavisualization.Diagram.UMLConnectorComposition=function(i){return n.extend(!1,{},t.datavisualization.Diagram.CompositionDefaults,i)};t.datavisualization.Diagram.UMLConnectorDependency=function(i){return n.extend(!1,{},t.datavisualization.Diagram.DependencyDefaults,i)};t.datavisualization.Diagram.UMLConnectorRealization=function(i){return n.extend(!1,{},t.datavisualization.Diagram.RealizationDefaults,i)};t.datavisualization.Diagram.UMLConnectorInheritance=function(i){return n.extend(!1,{},t.datavisualization.Diagram.InheritanceDefaults,i)};t.datavisualization.Diagram.UMLConnectorMultiplicity=function(i){return i.source&&(i.source.optional=i.source.optional?i.source.optional:!0,i.source.lowerBounds=i.source.lowerBounds?i.source.lowerBounds:null,i.source.upperBounds=i.source.upperBounds?i.source.upperBounds:null),i.target&&(i.target.optional=i.target.optional?i.target.optional:!0,i.target.lowerBounds=i.target.lowerBounds?i.target.lowerBounds:null,i.target.upperBounds=i.target.upperBounds?i.target.upperBounds:null),n.extend(!1,{},t.datavisualization.Diagram.ClassifierMultiplicityDefault,i)};t.datavisualization.Diagram.UMLActivityFlow=function(i){return n.extend(!1,{},t.datavisualization.Diagram.UMLActivityFlowDefaults,i)};t.datavisualization.Diagram.ClassDefaults={name:" ",attributes:[t.datavisualization.Diagram.ClassAttribute()],methods:[t.datavisualization.Diagram.ClassMethod()]};t.datavisualization.Diagram.InterfaceDefaults={name:" ",attributes:[t.datavisualization.Diagram.ClassAttribute()],methods:[t.datavisualization.Diagram.ClassMethod()]};t.datavisualization.Diagram.EnumerationDefaults={name:" ",members:[t.datavisualization.Diagram.ClassMember()]};t.datavisualization.Diagram.NodeType=function(i,r){if(!i._isInternalShape){var u=r.model.defaultSettings&&r.model.defaultSettings.node&&r.model.defaultSettings.node.type?r.model.defaultSettings.node.type:"",f=!i.isPhase&&r.model.defaultSettings&&r.model.defaultSettings.node?r.model.defaultSettings.node:{};i.type||i.children||i.isLane||i.isSwimlane||i.isPhase||i.isPhaseStack||(i.type=i.segments||i.sourceNode||i.sourcePort||i.sourcePoint||i.targetNode||i.targetPort||i.targetPoint?"connector":u?u:"basic");(i.isSwimlane||i.type=="swimlane")&&(i._type="group");(i.type=="basic"||i.type=="flow"||i.type=="arrow"||i.type=="bpmn"||i.type=="image"||i.type=="native"||i.type==="html"||i.type==="text"||i.type=="umlactivity")&&(r._isLoad&&(!r._isLoad||i._type)||(i._type="node"),i=n.extend(!0,{},f,i));(!r._isLoad||r.model.nodeTemplate||r._isOptimize)&&(i.type=="basic"?i=t.datavisualization.Diagram.BasicShape(i):i.type=="flow"?i=t.datavisualization.Diagram.FlowShape(i):i.type=="arrow"?i=t.datavisualization.Diagram.ArrowShape(i):i.type=="bpmn"?i=t.datavisualization.Diagram.BPMNShape(i):i.type=="umlclassifier"?i=t.datavisualization.Diagram.ClassifierShape(i,r):i.type=="umlactivity"&&(i=t.datavisualization.Diagram.UMLActivityShape(i,r)))}return i};t.datavisualization.Diagram.BasicShape=function(n){n._shape="path";n.shape||(n.shape="rectangle");switch(n.shape){case"rectangle":n._shape="rectangle";break;case"ellipse":n._shape="ellipse";break;case"path":n._shape="path";break;case"polygon":n._shape="polygon";break;case"triangle":n.pathData="M81.1582,85.8677L111.1582,33.9067L141.1582,85.8677L81.1582,85.8677z";break;case"plus":n.pathData="M696.6084,158.2656L674.8074,158.2656L674.8074,136.4656L658.4084,136.4656L658.4084,158.2656L636.6084,158.2656L636.6084,174.6646L658.4084,174.6646L658.4084,196.4656L674.8074,196.4656L674.8074,174.6646L696.6084,174.6646L696.6084,158.2656z";break;case"star":n.pathData="M540.3643,137.9336L546.7973,159.7016L570.3633,159.7296L550.7723,171.9366L558.9053,194.9966L540.3643,179.4996L521.8223,194.9966L529.9553,171.9366L510.3633,159.7296L533.9313,159.7016L540.3643,137.9336z";break;case"pentagon":n.pathData="M370.9702,194.9961L359.5112,159.7291L389.5112,137.9341L419.5112,159.7291L408.0522,194.9961L370.9702,194.9961z";break;case"heptagon":n.pathData="M223.7783,195.7134L207.1303,174.8364L213.0713,148.8034L237.1303,137.2174L261.1883,148.8034L267.1303,174.8364L250.4813,195.7134L223.7783,195.7134z";break;case"octagon":n.pathData="M98.7319,196.4653L81.1579,178.8923L81.1579,154.0393L98.7319,136.4653L123.5849,136.4653L141.1579,154.0393L141.1579,178.8923L123.5849,196.4653L98.7319,196.4653z";break;case"trapezoid":n.pathData="M127.2842,291.4492L95.0322,291.4492L81.1582,256.3152L141.1582,256.3152L127.2842,291.4492z";break;case"decagon":n.pathData="M657.3379,302.4141L642.3369,291.5161L636.6089,273.8821L642.3369,256.2481L657.3379,245.3511L675.8789,245.3511L690.8789,256.2481L696.6089,273.8821L690.8789,291.5161L675.8789,302.4141L657.3379,302.4141z";break;case"righttriangle":n.pathData="M836.293,292.9238L776.293,292.9238L776.293,254.8408L836.293,292.9238z";break;case"cylinder":n.pathData="M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016"}return n};t.datavisualization.Diagram.FlowShape=function(n){n._shape="path";n.shape||(n.shape="process");var i=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default;n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(i=i|t.datavisualization.Diagram.NodeConstraints.AspectRatio);switch(n.shape){case"process":n.pathData="M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z";break;case"decision":n.pathData="M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z";break;case"document":n.pathData="M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z";break;case"predefinedprocess":n.pathData="M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.333333333333334,0 L 8.333333333333334,50 M 41.66666666666667,0 L 41.66666666666667,50";break;case"terminator":n.pathData="M 269.711,29.3333C 269.711,44.061 257.772,56 243.044,56L 158.058,56C 143.33,56 131.391,44.061 131.391,29.3333L 131.391,29.3333C 131.391,14.6057 143.33,2.66669 158.058,2.66669L 243.044,2.66669C 257.772,2.66669 269.711,14.6057 269.711,29.3333 Z";break;case"papertap":n.pathData="M0.000976562,17.2042 L0.000976562,47.1654 C0.000976562,47.1654 14.403,53.5455 25.001,47.1654 C35.599,40.7852 44.403,43.5087 50.001,47.1654 L50.001,17.2042 M50.001,32.7987 L50.001,2.84052 C50.001,2.84052 35.599,-3.54271 25.001,2.84052 C14.403,9.22376 5.599,6.49418 0.000976562,2.84052 L0.000976562,32.7987";break;case"directdata":n.pathData="M 1477 613 L 1619 613 C 1627 613 1634 636 1634 665 C 1634 694 1627 717 1619 717 L 1477 717 C 1469 717 1461 694 1461 665 C 1461 636 1469 613 1477 613 ZM 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717M 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717";break;case"sequentialdata":n.pathData="M0.00297546,24.999 C0.00297546,11.1922 10.433,0.00216177 23.295,0.00216177 C36.159,0.00216177 46.585,11.1922 46.585,24.999 C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.00297546,38.8057 0.00297546,24.999 z M23.294,49.999 L50.002,49.999";break;case"sort":n.pathData="M50.001,24.9971 L25.001,49.9971 L0.000976562,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971";break;case"multidocument":n.pathData="M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.1437 C48.027,35.7653 49.025,36.6042 50.003,37.3695 L50.003,0.0021928 L6.26497,0.0021928 L6.26497,4.74451 M43.6826,47.1132 L43.6826,10.7652 L0.00257874,10.7652 L0.00257874,47.1132 C0.00257874,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.7926,43.3935 43.6826,47.1132 z";break;case"collate":n.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"summingjunction":n.constraints=i;n.pathData="M7.3252,42.6768 L42.6772,7.32477 M42.6768,42.6768 L7.3248,7.32477 M0.000976562,25.001 C0.000976562,11.193 11.197,0.000976562 25.001,0.000976562 C38.809,0.000976562 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.001 0.000976562,38.809 0.000976562,25.001 z";break;case"or":n.pathData="M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z";break;case"internalstorage":n.pathData="M 0 3.8194444444444446A 2.5,3.8194444444444446 0 0,1 2.5,0L 47.5 0A 2.5,3.8194444444444446 0 0,1 50,3.8194444444444446L 50 45.833333333333336A 2.5,3.8194444444444446 0 0,1 47.5,49.65277777777778L 2.5 49.65277777777778A 2.5,3.8194444444444446 0 0,1 0,45.833333333333336L 0 3.8194444444444446ZM 0 11.458333333333334L 50 11.458333333333334M 12.5 0L 12.5 49.65277777777778";break;case"extract":n._shape="polygon";n.constraints=i;n.points=[{x:0,y:35},{x:30,y:0},{x:60,y:35}];break;case"manualoperation":n._shape="polygon";n.points=[{x:46.4,y:28.8},{x:14.8,y:28.8},{x:0,y:0},{x:60,y:0}];break;case"merge":n._shape="polygon";n.constraints=i;n.points=[{x:60,y:0},{x:30,y:35},{x:0,y:0}];break;case"offpagereference":n._shape="polygon";n.points=[{x:60,y:33.3},{x:30.1,y:39},{x:0,y:33.3},{x:0,y:0},{x:60,y:0}];break;case"sequentialaccessstorage":n.constraints=i;n.pathData="M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9 C 55.5 48 60 39.5 60 30 Z";break;case"annotation1":n.pathData="M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865";break;case"annotation2":n.pathData="M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029";break;case"card":n._shape="polygon";n.points=[{x:275,y:60},{x:400,y:60},{x:400,y:110},{x:260,y:110},{x:260,y:75}];break;case"data":n.pathData="M 10 0 L 40 0 L 30 40 L 0 40 Z "}return n};t.datavisualization.Diagram.ArrowShape=function(n){n._shape="path";n.shape||(n.shape="circulararrow");switch(n.shape){case"circulararrow":n.pathData="M433.4624,503.8848C429.4244,493.2388,419.1354,485.6678,407.0734,485.6678C391.4884,485.6678,378.8544,498.3018,378.8544,513.8868L384.4984,513.8868C384.4984,501.4178,394.6054,491.3108,407.0734,491.3108C415.9494,491.3108,423.6264,496.4338,427.3144,503.8848L422.9114,503.8848L426.8974,508.8848L430.8824,513.8868L434.8684,508.8848L438.8544,503.8848L433.4624,503.8848z";break;case"curvedrightarrow":n.pathData="M0.83006144,28.226993 C2.4030598,37.092016 9.5750604,44.49601 19.365042,48.044014 L19.365042,43.129004 25.376032,47.706001 31.386044,52.282999 25.376032,56.858988 19.365042,61.436991 19.365042,55.399027 C8.24608,51.372995 0.50004381,42.368995 0.50004357,31.905003 0.50004381,30.65601 0.6160717,29.429996 0.83006144,28.226993 z M31.402985,0.5 L31.402985,7.4419994 C15.834992,7.4419994 2.9619988,16.497999 0.81800008,28.275999 0.61199981,27.139999 0.49999988,25.981999 0.5,24.803999 0.49999988,11.379999 14.334993,0.5 31.402985,0.5 z";break;case"curveduparrow":n.pathData="M52.283021,0.51798058 L56.859025,6.5279841 61.436024,12.537989 55.399022,12.537989 C51.373021,23.656996 42.369015,31.403002 31.905011,31.403002 30.65601,31.403002 29.430011,31.288002 28.22701,31.073002 37.092015,29.500999 44.496018,22.328995 48.044018,12.537989 L43.129018,12.537989 47.706021,6.5279841 z M0.5,0.5 L7.4420163,0.5 C7.4420163,16.067989 16.497985,28.940971 28.276,31.083977 27.140013,31.290977 25.981993,31.402 24.804015,31.402 11.380005,31.402 0.5,17.567989 0.5,0.5 z";break;case"curvedleftarrow":n.pathData="M31.073116,28.227982 C31.287107,29.429977 31.403074,30.65599 31.403074,31.905989 31.403074,42.368966 23.657099,51.372959 12.538074,55.399935 L12.538074,61.436979 6.5270846,56.85898 0.51707193,52.282993 6.5270846,47.706976 12.538074,43.129983 12.538074,48.044958 C22.328056,44.496956 29.500118,37.091961 31.073116,28.227982 z M0.5,0.5 C17.568025,0.5 31.403045,11.380997 31.403045,24.803993 31.403045,25.981992 31.291046,27.139992 31.085045,28.276992 28.941042,16.497995 16.068023,7.442997 0.5,7.442997 z";break;case"curveddownarrow":n.pathData="M24.804015,0.50000453 C25.981993,0.50000453 27.140013,0.61301103 28.276,0.8180277 16.498045,2.9630154 7.4420161,15.836023 7.4420156,31.404005 L0.5,31.404005 C0.5,14.336024 11.380004,0.50000453 24.804015,0.50000453 z M31.90502,0.5 C42.369025,0.49999976 51.37303,8.2460016 55.399031,19.365004 L61.436034,19.365004 56.859034,25.377005 52.28303,31.387007 47.70603,25.377005 43.129027,19.365004 48.044028,19.365004 C44.496027,9.5760015 37.092024,2.4040001 28.227019,0.82999995 29.43002,0.61699978 30.65602,0.49999976 31.90502,0.5 z";break;case"jumpingrightarrow":n.pathData="M571.7207,727.7451L563.4507,716.8841L572.3297,716.8841C565.9217,699.1961,552.5427,686.2371,536.5277,683.3951C538.6997,683.0091,540.9157,682.8001,543.1717,682.8001C562.0777,682.8001,578.3457,696.7961,585.6187,716.8841L596.5277,716.8841L588.2577,727.7451L579.9907,738.6041L571.7207,727.7451z";break;case"jumpingleftarrow":n.pathData="M688.4209,727.7441L696.6889,716.8851L687.8119,716.8851C694.2179,699.1971,707.5989,686.2381,723.6119,683.3941C721.4409,683.0101,719.2259,682.8011,716.9679,682.8011C698.0639,682.8011,681.7959,696.7951,674.5209,716.8851L663.6119,716.8851L671.8839,727.7441L680.1509,738.6031L688.4209,727.7441z"}return n};t.datavisualization.Diagram.UMLConnectorShape=function(i){var u,r;i.shape.relationship||(i.shape.relationship="association");switch(i.shape.relationship){case"association":i.shape=t.datavisualization.Diagram.UMLConnectorAssociation(i.shape);break;case"aggregation":i.shape=t.datavisualization.Diagram.UMLConnectorAggregation(i.shape);break;case"composition":i.shape=t.datavisualization.Diagram.UMLConnectorComposition(i.shape);break;case"realization":i.shape=t.datavisualization.Diagram.UMLConnectorRealization(i.shape);break;case"dependency":i.shape=t.datavisualization.Diagram.UMLConnectorDependency(i.shape);break;case"inheritance":i.shape=t.datavisualization.Diagram.UMLConnectorInheritance(i.shape)}if(i.shape.type=="umlactivity")if(i.shape=t.datavisualization.Diagram.UMLActivityFlow(i.shape),i.shape.activityFlow=="object"){if(i=n.extend(!0,i,{lineDashArray:"8 4",targetDecorator:{shape:"openarrow"},lineWidth:2}),i.labels)for(r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]),i.labels[r].text="["+i.labels[r].text+"]"}else i.shape.activityFlow=="control"?i=n.extend(!0,i,{sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow"},lineWidth:2}):i.shape.activityFlow=="exception"&&(i=n.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow"}}));else if(i.shape.multiplicity)if(u=[],u=t.datavisualization.Diagram.ClassifierHelper.umlConnectorMultiplicity(i),i.labels)for(r=0;r<u.length;r++)i.labels.push(u[r]);else i=n.extend(!1,{},{labels:u},i);return i.shape.type=="umlclassifier"&&(i.shape.relationship=="association"&&(i.shape.association=="bidirectional"?i=n.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"none"},lineWidth:2}):i.shape.association=="directional"&&(i=n.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow"},lineWidth:2}))),i.shape.relationship=="inheritance"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),i.shape.relationship=="composition"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"black"},targetDecorator:{shape:"none"},lineWidth:2})),i.shape.relationship=="aggregation"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"white"},targetDecorator:{shape:"none"},lineWidth:2})),i.shape.relationship=="dependency"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),i.shape.relationship=="realization"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2}))),i};t.datavisualization.Diagram.BPMNShape=function(t){t.shape||(t.shape="event");(t.shape!="sequentialflow"||t.shape!="associationflow"||t.shape!="messageflow")&&(t.labels&&t.labels.length||(t.labels=[{}]),t.labels.length&&t.labels[0].offset||(t.labels[0]=n.extend(!1,{},t.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}})));switch(t.shape){case"event":case"gateway":case"dataobject":case"activity":t._type="group";t._isBpmn=!0;t.children==undefined&&(t.children=[]);t.shape=="activity"&&t.activity=="subprocess"&&t.subProcess&&t.subProcess.collapsed==!1&&(t=n.extend(!0,{container:{type:"canvas"},paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10},t));break;case"message":t=n.extend(!0,t,{_shape:"path",pathData:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z"});break;case"datasource":t=n.extend(!0,t,{_shape:"path",pathData:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2 S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8"});break;case"group":t=n.extend(!0,t,{_type:"group",_isBpmn:!0,minWidth:t.width,minHeight:t.height,cornerRadius:10,container:{type:"canvas"},paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10,borderDashArray:"2 2 6 2"})}return t};t.datavisualization.Diagram.ClassifierShape=function(i,r){var u,f;i.classifier||(i.classifier="class");i.labels||(i.labels=[{}]);i.fillColor||(i.fillColor="transparent");i.borderColor||(i.borderColor="transparent");i.borderWidth||(i.borderWidth=1);i.opacity||(i.opacity=1);switch(i.classifier){case"class":for(i["class"]=t.datavisualization.Diagram.ClassifierClass(i["class"]),u=0;u<i["class"].attributes.length;u++)i["class"].attributes[u]=t.datavisualization.Diagram.ClassAttribute(i["class"].attributes[u]);for(f=0;f<i["class"].methods.length;f++)i["class"].methods[f]=t.datavisualization.Diagram.ClassMethod(i["class"].methods[f]);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,r);break;case"interface":for(i["interface"]=t.datavisualization.Diagram.ClassifierInterface(i["interface"]),u=0;u<i["interface"].attributes.length;u++)i["interface"].attributes[u]=t.datavisualization.Diagram.ClassAttribute(i["interface"].attributes[u]);for(f=0;f<i["interface"].methods.length;f++)i["interface"].methods[f]=t.datavisualization.Diagram.ClassMethod(i["interface"].methods[f]);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,r);break;case"enumeration":i.enumeration=t.datavisualization.Diagram.ClassifierEnumeration(i.enumeration);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,r);break;case"member":i.labels[0]=n.extend(!1,{},{name:i.name+"_member",horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5},text:"Member"},i.labels[0]);i=n.extend(!1,{},{borderColor:"transparent",fillColor:"transparent",_shape:"rectangle",horizontalAlign:"stretch",verticalAlign:"bottom",_isClassMember:!0},i)}return i};t.datavisualization.Diagram.UMLActivityShape=function(n){n.type="umlactivity";n.shape||(n.shape="action");n._shape="path";switch(n.shape){case"action":n.pathData="M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z";break;case"decision":n.pathData="M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z";break;case"mergenode":n.pathData="M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z";break;case"initialnode":n.pathData="M10,19.5c-5.238,0-9.5-4.262-9.5-9.5S4.762,0.5,10,0.5s9.5,4.262,9.5,9.5S15.238,19.5,10,19.5z";break;case"finalnode":n.borderColor="transparent";n._type="group";var i=[],r=0,u=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize);for(i.push({name:n.name+"_activity_final_1",width:n.width,height:n.height,offsetX:n.offsetX,offsetY:n.offsetY,constraints:u|t.datavisualization.Diagram.NodeConstraints.Resize,type:"node",shape:"path",pathData:"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001"}),i.push({name:n.name+"_activity_final_2",width:n.width/2,height:n.height/2,fillColor:"black",offsetX:n.offsetX,offsetY:n.offsetY,constraints:u|t.datavisualization.Diagram.NodeConstraints.Resize,type:"node",shape:"path",pathData:"M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50"}),r=0;r<i.length;r++)i[r]=t.datavisualization.Diagram.Node(i[r]);n.elementType="group";n.children=i;break;case"forknode":n.width=n.width?n.width:40;n.height=5;n.fillColor="black";n.pathData="m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z";n.labels=[{readOnly:!0}];break;case"joinnode":n.width=n.width?n.width:40;n.height=5;n.fillColor="black";n.pathData="m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z";n.labels=[{readOnly:!0}];break;case"timeevent":n.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"acceptingevent":n.pathData="M17.8336 32.164 L29.64 24 L17.32 16 L48.1664 16 L48.5 32 Z";break;case"sendsignal":n.pathData="M48.164 31.8336 L56 23.832 L47.836 16 L16.168 16 L16.1668 31.8336 Z";break;case"receivesignal":n.pathData="M48.1664 31.8336 L39.836 24 L47.836 16 L16.168 16 L16.168 31.836 Z";break;case"structurednode":n._shape="rectangle";n.borderDashArray="2 3";n.labels&&n.labels.length>0&&(n.labels=[{text:"<<"+n.labels[0].text+">>",wrapText:"nowrap",fillColor:"white"}]);break;case"note":n.pathData="M20 12 L4 12 L4 22 L22 22 L22 14 L20 14 L20 12 L22 14 Z"}return n};t.datavisualization.Diagram.DefautShapes={_getBPMNEventShape:function(i,r){var f=[],u,o,s;for(i.children==undefined&&(i.children=[]),i._type="group",i.canUngroup=!1,i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(i.offset.x?i.offset.x:null,i.offset.y?i.offset.y:null),i=n.extend(!1,{},t.datavisualization.Diagram.BPMNEventDefaults,i),u=0;u<i.children.length;u++)r.nameTable[i.children[u].name||i.children[u]]&&(f.push(r.nameTable[i.children[u].name||i.children[u]]),f[u].rotateAngle=i.rotateAngle);var e=i.pivot||{x:.5,y:.5},h=i.offsetX?i.offsetX-i.width*e.x+i.width/2:i.width*e.x+i.width/2,c=i.offsetY?i.offsetY-i.height*e.y+i.height/2:i.height*e.y+i.height/2;if(!f.length)for(o=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:h,offsetY:c,ports:[],rotateAngle:i.rotateAngle,constraints:o,_isDisabled:!0,_isInternalShape:!0},f.push({name:i.name+"_0",width:i.width,height:i.height}),f.push({name:i.name+"_1",width:i.width*.85,height:i.height*.85}),f.push({name:i.name+"_2",width:i.width*.5,height:i.height*.5}),u=0;u<f.length;u++)f[u]=t.datavisualization.Diagram.Node(n.extend(!1,{},s,f[u]));return i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNEventShape(i,f,i.event,i.trigger),i},_getBPMNGatewayShape:function(i,r){var u=[],f,e,s;for(i.children==undefined&&(i.children=[]),i._type="group",i.canUngroup=!1,i=n.extend(!1,{},t.datavisualization.Diagram.BPMNGatewayDefaults,i),f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&(u.push(r.nameTable[i.children[f].name||i.children[f]]),u[f].rotateAngle=i.rotateAngle);var o=i.pivot||{x:.5,y:.5},h=i.offsetX?i.offsetX-i.width*o.x+i.width/2:i.width*o.x+i.width/2,c=i.offsetY?i.offsetY-i.height*o.y+i.height/2:i.height*o.y+i.height/2;if(!u.length)for(e=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:h,offsetY:c,ports:[],rotateAngle:i.rotateAngle,constraints:e,_isDisabled:!0,_isInternalShape:!0},u.push({name:i.name+"_0",width:i.width,height:i.height,pathData:"M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z"}),u.push({name:i.name+"_1",width:i.width*.45,height:i.height*.45}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!1,{},s,u[f]));u&&u[0]&&(e=u[0].constraints?u[0].constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=e|t.datavisualization.Diagram.NodeConstraints.Shadow));i.children=u;i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default;n.extend(!0,u,[{fillColor:i.fillColor,constraints:e,shadow:i.shadow,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,fillColor:"black",visible:!0}]);u[1].fillColor=i.borderColor;u[1].borderColor=i.borderColor;switch(i.gateway){case"none":u[1].visible=!1;break;case"exclusive":u[1].pathData="M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039 l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z";break;case"inclusive":u[1].pathData="M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z";break;case"parallel":u[1].pathData="M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z";break;case"complex":u[1].pathData="M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z";break;case"eventbased":u[1].fillColor="white";u[1].pathData="M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z";break;case"exclusiveeventbased":u[1].fillColor="white";u[1].pathData="M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z";break;case"paralleleventbased":u[1].fillColor="white";u[1].pathData="M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"}return i},_getClassShape:function(i,r){var f=[],k,l,y="",p="",w="",b="",v,a,o,c,e,h,u,s;if(i.children){for(u=0;u<i.children.length;u++)r.nameTable[i.children[u].name||i.children[u]]&&f.push(r.nameTable[i.children[u].name||i.children[u]]);if(f.length<=0&&i.children.length>0)for(s=0;s<i.children.length;s++)f.push(i.children[s])}else{if(v=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast|t.datavisualization.Diagram.NodeConstraints.Drag),a={width:i.width,offsetX:i.offsetX,parent:i.name,ports:[],fillColor:"transparent",borderColor:i.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0},i.fillColor&&(a.fillColor=i.fillColor),i.borderColor&&(a.borderColor=i.borderColor),i.borderWidth&&(a.borderWidth=i.borderWidth),i.labels)for(u=0;u<i.labels.length;u++)a.labels[u]=n.extend(!1,{},a.labels[u],i.labels[u]);switch(i.classifier){case"class":f.push({ports:[],name:i.name+"_header_classifier",minHeight:30,labels:[{name:"title",offset:{x:.5,y:.65},text:i["class"].name,bold:!0,fontSize:14},{name:"class",offset:{x:.5,y:.25},text:"<<Class>>"}],constraints:v});break;case"interface":f.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:"title",offset:{x:.5,y:.65},text:i["interface"].name,bold:!0,fontSize:14},{name:"interface",offset:{x:.5,y:.25},text:"<<Interface>>"}],constraints:v});break;case"enumeration":f.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:i.name+"Label1",offset:{x:.5,y:.65},text:i.enumeration.name,bold:!0,fontSize:14},{name:i.name+"enumeration",offset:{x:.5,y:.25},text:"<<Enumeration>>"}],constraints:v})}if(o=i["class"]?i["class"]:i["interface"],o&&o.attributes&&o.attributes.length){for(u=0;u<o.attributes.length;u++)o.attributes[u]=t.datavisualization.Diagram.ClassAttribute(o.attributes[u]),i.Interface&&(o.attributes[u].scope=t.datavisualization.Diagram.ScopeValueDefaults.Public),o.attributes[u].scope&&o.attributes[u].scope=="public"&&(h="+"),o.attributes[u].scope&&o.attributes[u].scope=="private"&&(h="-"),o.attributes[u].scope&&o.attributes[u].scope=="protected"&&(h="#"),o.attributes[u].scope&&o.attributes[u].scope=="package"&&(h="~"),o.attributes[u].name!=""&&(y+=h?h+" "+o.attributes[u].name+" : "+o.attributes[u].type:o.attributes[u].name+": "+o.attributes[u].type),u!=o.attributes.length-1&&(y+="\n");y&&f.push({name:i.name+"_attribute_classifier",labels:[{text:y,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:v})}if(c=i.enumeration,c&&c.members&&c.members.length){for(u=0;u<c.members.length;u++)c.members[u]=t.datavisualization.Diagram.ClassMember(c.members[u]),c.members[u].name!=""&&(w+=c.members[u].name),u!=c.members.length-1&&(w+="\n");w&&f.push({name:i.name+"_member_classifier",labels:[{text:w,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:v})}if(e=i["class"]?i["class"]:i["interface"],e&&e.methods&&e.methods.length){for(u=0;u<e.methods.length;u++){if(e.methods[u]=t.datavisualization.Diagram.ClassMethod(e.methods[u]),e.methods[u].scope&&e.methods[u].scope=="public"&&(h="+"),e.methods[u].scope&&e.methods[u].scope=="private"&&(h="-"),e.methods[u].scope&&e.methods[u].scope=="protected"&&(h="#"),e.methods[u].scope&&e.methods[u].scope=="package"&&(h="~"),e.methods[u].arguments)for(s=0;s<e.methods[u].arguments.length;s++)b+=e.methods[u].arguments[s].type?e.methods[u].arguments[s].name+":"+e.methods[u].arguments[s].type:e.methods[u].arguments[s].name,s!=e.methods[u].arguments.length-1&&(b+=",");e.methods[u].name!=""&&(p+=h?h+" "+e.methods[u].name+"("+b+") : "+e.methods[u].type:e.methods[u].name+"("+b+") :"+e.methods[u].type);u!=e.methods.length-1&&(p+="\n")}p&&f.push({name:i.name+"_method_classifier",labels:[{text:p,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:v})}for(u=0;u<f.length;u++)for(f[u]=t.datavisualization.Diagram.Node(n.extend(!1,{},a,f[u])),s=0;s<f[u].labels.length;s++)f[u].labels[s]=n.extend(!1,{},f[u].labels[s],a.labels[0]);for(i.children=f,i._type="group",i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints=i.constraints&~(t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast),u=0;u<f.length;u++)f.length==1&&(i["class"]&&(delete i["class"].attributes,delete i["class"].methods),i["interface"]&&(delete i["interface"].attributes,delete i["interface"].methods),i.enumeration&&delete i.enumeration.members),f.length==2&&(i.children[u]=typeof i.children[u]=="string"?r.nameTable[i.children[u]]:i.children[u],i["class"]&&(i.children[u].name.match("attribute")&&delete i["class"].methods,i.children[u].name.match("method")&&delete i["class"].attributes),i["interface"]&&(i.children[u].name.match("attribute")&&delete i["interface"].methods,i.children[u].name.match("method")&&delete i["interface"].attributes))}for(i._height=0,u=0;u<f.length;u++)r._getNodeDimension(f[u],f[u].labels[0]),k=f[u].height?f[u].height:f[u]._height,f[u].offsetY=i._height+k/2,i._height+=k;for(l=f[0]._width,f[1]&&(l=f[0]._width>f[1]._width?f[0]._width:f[1]._width),f[2]&&(l=f[2]._width>l?f[2]._width:l),f[0].width=l,f[1]&&(f[1].width=l),f[2]&&(f[2].width=l),i._width=l,i.width=i._width,i.height=i._height,u=0;u<f.length;u++)f[u].offsetY+=i.offsetY-i.height/2;return i},_updateClassNode:function(n,i){var h;if(n.name.match("_header"))i.type=="class"?i.className=n.labels[0].text:i.type=="interface"?i.interfaceName=n.labels[0].text:i.enumerationName=n.labels[0].text;else{for(var o=n.name.match("_attribute")?"attribute":n.name.match("_method")?"method":"member",s=n.labels[0],e=s.text.split("\n"),u=[],r,f=0;f<e.length;f++){h=i.Class?i.Class:i.Interface;switch(o){case"attribute":r=e[f].split(/:[ ]*/g);u.push(t.datavisualization.Diagram.ClassMember({name:r[0],type:r[1]}));break;case"method":r=e[f].replace(")","").replace("(",":").split(/:[ ]*/g);u.push(t.datavisualization.Diagram.ClassMember({name:r[0],returnType:r[1],parameter:r[2]}));break;case"member":u.push(t.datavisualization.Diagram.ClassMember({name:e[f]}))}}o=="attribute"?i.attributes=u:o=="method"?i.methods=u:i.members=u}},_getBPMNDataShape:function(i,r){var u=[],f,o,h,s,c,e,l;for(i.children==undefined&&(i.children=[]),i._type="group",o=i.pivot||{x:.5,y:.5},i.canUngroup=!1,i.data=t.datavisualization.Diagram.BPMNDataObject(i.data),i=n.extend(!1,{},t.datavisualization.Diagram.BPMNDataObjectDefaults,i),h=i.offsetX?i.offsetX-i.width*o.x:i.width*o.x,s=i.offsetY?i.offsetY-i.height*o.y:i.height*o.y,f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&(u.push(r.nameTable[i.children[f].name||i.children[f]]),u[f].rotateAngle=i.rotateAngle);if(c=i.offsetX?i.offsetX-i.width*o.x+i.width/2:i.width*o.x+i.width/2,!u.length)for(e=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),l={parent:i.name,type:"node",shape:"path",offsetX:c,ports:[],rotateAngle:i.rotateAngle,constraints:e,_isDisabled:!0,_isInternalShape:!0},u.push({name:i.name+"_0",width:i.width,height:i.height,offsetY:s+i.height/2,addInfo:{offset:{x:.5,y:.5}},constraints:e,shape:"polygon",points:[{x:29.904,y:5},{x:7.853,y:5},{x:7.853,y:45},{x:42.147,y:45},{x:42.147,y:17.242},{x:29.932,y:5},{x:29.932,y:17.242},{x:42.147,y:17.242}]}),u.push({name:i.name+"_1",width:7.5,height:15,offsetY:85+s,addInfo:{offset:{x:.5,y:1},margin:{bottom:15}},constraints:e&~t.datavisualization.Diagram.NodeConstraints.Resize,fillColor:"black",pathData:"M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z "}),u.push({name:i.name+"_2",width:25,height:20,offsetX:h+15,offsetY:s+15,addInfo:{offset:{x:0,y:0},margin:{left:17.5,top:15}},constraints:e&~t.datavisualization.Diagram.NodeConstraints.Resize,borderColor:"black",fillColor:"white",pathData:"M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z"}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!1,{},l,u[f]));i.children=u;i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default;i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=e|t.datavisualization.Diagram.NodeConstraints.Shadow);n.extend(!0,u,[{fillColor:i.fillColor,constraints:e,shadow:i.shadow,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,visible:i.data.collection},{opacity:i.opacity,visible:!0}]);switch(i.data.type){case"none":u[2].visible=!1;break;case"input":u[2].fillColor="white";break;case"output":u[2].fillColor="black"}return i},_getBPMNActivityShape:function(i,r){var f=[],h={},u,o,c,e,s;for(i.children==undefined&&(i.children=[]),i._type="group",i.canUngroup=!1,i.task=t.datavisualization.Diagram.BPMNTask(i.task),i.subProcess=t.datavisualization.Diagram.BPMNSubProcess(i.subProcess),i=n.extend(!1,{},t.datavisualization.Diagram.BPMNActivityDefaults,i),u=0;u<i.children.length;u++)r.nameTable[i.children[u].name||i.children[u]]&&(f.push(r.nameTable[i.children[u].name||i.children[u]]),f[u].rotateAngle=i.rotateAngle);if(!f.length){for(o=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),c={parent:i.name,type:"node",shape:"path",ports:[],labels:[],constraints:o,rotateAngle:i.rotateAngle,_isDisabled:!0,_isInternalShape:!0},f.push({name:i.name+"_activity",width:i.width,height:i.height,addInfo:{offset:{x:.5,y:.5}},constraints:o|t.datavisualization.Diagram.NodeConstraints.Resize}),f.push({name:i.name+"_taskType",width:14,height:14,borderColor:"black",addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:14,top:14}},pathData:"M10 0L40 0L30 40L0 40Z"}),f.push({name:i.name+"_loop",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),f.push({name:i.name+"_compensation",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),f.push({name:i.name+"_expanded",width:12,height:12,constraints:o,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),f.push({name:i.name+"_adhoc",width:12,height:8,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),f.push({name:i.name+"_event_1",width:24,height:24,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),f.push({name:i.name+"_event_2",width:20.4,height:20.4,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),f.push({name:i.name+"_event_3",width:12,height:12,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),u=0;u<f.length;u++)f[u]=t.datavisualization.Diagram.Node(n.extend(!0,{},c,f[u]));if(i.activity=="subprocess"&&!i.subProcess.collapsed&&i.subProcess.processes&&i.subProcess.processes.length)for(e=0,s=i.subProcess.processes;e<i.subProcess.processes.length;e++)s[e]=t.datavisualization.Diagram.Node(t.datavisualization.Diagram.NodeType(s[e],r)),f.push(s[e])}for(i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNActivityShape(i,f),u=0;u<i.children.length;u++)h[i.children[u].name]=i.children[u];return t.datavisualization.Diagram.Util._updateBPMNProperties(i,r,h),i},_getBPMNGroupShape:function(n,i){var u=[],r=0,f;for(n.children==undefined&&(n.children=[]),r=0;r<n.children.length;r++)i.nameTable[n.children[r].name||n.children[r]]&&u.push(i.nameTable[n.children[r].name||n.children[r]]);if(!u.length)for(r=0;r<n.children.length;r++)f=t.datavisualization.Diagram.Node(t.datavisualization.Diagram.NodeType(n.children[r],i)),f.type=="bpmn"&&u.push(f);return n.ports=[],n.children=u,n.constraints=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default,n.constraints=n.constraints&~t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.AllowDrop,n},_updateBPMNEventShape:function(i,r,u,f){var e,o,s;r&&r[0]&&(e=r[0].constraints?r[0].constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=e|t.datavisualization.Diagram.NodeConstraints.Shadow));o="M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001";s=[{pathData:o,fillColor:i.fillColor,constraints:e,shadow:i.shadow,borderWidth:i.borderWidth,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:o,fillColor:i.fillColor,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:o,fillColor:"white",borderColor:i.borderColor,opacity:i.opacity,height:r[0].height*.5,visible:!0}];n.extend(!0,r,s);switch(u){case"start":r[1].visible=!1;break;case"noninterruptingstart":r[0].borderDashArray="2 3";r[1].visible=!1;break;case"intermediate":r[0].fillColor="white";r[0].gradient=null;break;case"noninterruptingintermediate":r[0].fillColor="white";r[0].gradient=null;r[0].borderDashArray="2 3";r[1].borderDashArray="2 3";break;case"throwingintermediate":case"end":r[0].fillColor=u!="end"?"white":i.borderColor;r[0].gradient=null;r[2].fillColor="black";r[2].borderColor=i.fillColor}switch(f){case t.datavisualization.Diagram.BPMNTriggers.None:r[2].visible=!1;break;case t.datavisualization.Diagram.BPMNTriggers.Message:r[2].pathData="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0";r[2].height=3*r[2].width/4;break;case t.datavisualization.Diagram.BPMNTriggers.Timer:r[2].pathData="M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681 L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617 M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z";break;case t.datavisualization.Diagram.BPMNTriggers.Error:r[2].pathData="M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Escalation:r[2].pathData="M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Cancel:r[2].pathData="M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Compensation:r[2].pathData="M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Conditional:r[2].pathData="M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85";break;case t.datavisualization.Diagram.BPMNTriggers.Link:r[2].pathData="M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Signal:r[2].pathData="M 50 50 H 0 L 25.0025 0 L 50 50 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Terminate:r[2].pathData="M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50";break;case t.datavisualization.Diagram.BPMNTriggers.Multiple:r[2].pathData="M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Parallel:r[2].pathData="M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"}return r},_updateBPMNActivityShape:function(i,r){var v,y,u,f,s,h,p,o,w,k;r&&r[0]&&(h=r[0].constraints?r[0].constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(h=h|t.datavisualization.Diagram.NodeConstraints.Shadow));var d=[{fillColor:i.fillColor,borderWidth:i.borderWidth,constraints:h,shadow:i.shadow,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,pathData:this._updateRoundedRectanglePath(i,12)},{fillColor:"white",borderColor:"black",width:14,height:14,opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1}],c=[],l=9,o=0;n.extend(!0,r,d);i.activity=="subprocess"&&!i.subProcess.collapsed&&r.length>l&&i.subProcess.processes.length&&(c=r.splice(r.length-i.subProcess.processes.length,i.subProcess.processes.length));v=i.activity=="task"?i.task.loop:i.subProcess.loop;y=i.activity=="task"?i.task.compensation:i.subProcess.compensation;switch(v){case"none":r[2].visible=!1;break;case"standard":r[2].pathData="M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314 c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685 c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z";break;case"parallelmultiinstance":r[2].pathData="M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ";break;case"sequencemultiinstance":r[2].pathData="M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5 L 55.375,82.5 L 40.375,82.5 Z"}if(y?r[3].pathData="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z":r[3].visible=!1,u=i.activity==t.datavisualization.Diagram.BPMNActivity.Task?i.task.events:i.subProcess.events,u&&u.length){for(f=0;f<u.length;f++){if(s=r.slice(l+f*3,l+3+f*3),!s.length||s.length<3){for(h=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),p={parent:i.name,type:"group",constraints:h,rotateAngle:i.rotateAngle,_isInternalShape:!0,opacity:i.opacity,addInfo:{offset:u[f].offset},borderColor:"transparent",labels:[{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}]},u[f].offset=u[f].offset||{},u[f].fillColor="transparent",u[f].offset=t.datavisualization.Diagram.Point(u[f].offset.x?u[f].offset.x:null,u[f].offset.y?u[f].offset.y:null),u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{name:i.name+"_"+t.datavisualization.Diagram.Util.randomId()},t.datavisualization.Diagram.BPMNEventDefaults,p,u[f])),u[f].ports=u[f].ports.length>0?u[f].ports:i.ports,s=[{width:24,height:24},{width:20.4,height:20.4},{width:12,height:12}],o=0;o<s.length;o++)w={parent:u[f].name,type:"node",shape:"path",rotateAngle:u[f].rotateAngle,constraints:h,_isInternalShape:!0,opacity:i.opacity,addInfo:{offset:u[f].offset}},s[o]=t.datavisualization.Diagram.Node(n.extend(!0,{name:u[f].name+"_"+t.datavisualization.Diagram.Util.randomId()},w,s[o]));u[f].children=s}this._updateBPMNEventShape(i,s,u[f].event,u[f].trigger)}r=r.concat(u)}else r.splice(l,r.length-1);if(i.activity==t.datavisualization.Diagram.BPMNActivity.Task){r[1].visible=!0;delete r[1]._isService;switch(i.task.type){case"none":r[1].visible=!1;break;case"service":r[1].pathData="M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.89 0.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535 -1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z";r[1]._isService=!0;break;case"receive":r[1].pathData="M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z";r[1].height=12;break;case"send":r[1].pathData="M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z";r[1].height=12;r[1].fillColor="black";r[1].borderColor="white";break;case"instantiatingreceive":r[1].pathData="M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785 c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z";r[1].width=20;r[1].height=20;break;case"manual":r[1].pathData="M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281 c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143 c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008 h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403 c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752 c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557 h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167 c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151 c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082 c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753 h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629 L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176 c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322";r[1].width=20;break;case"businessrule":r[1].pathData="M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322 v -4.923 h 12.667 v 4.923 H 19.177 Z";break;case"user":r[1].pathData="M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61 -3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 Z M 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452 C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626 -0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.784 1.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571 c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855 C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.003 0.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153 -0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81";break;case"script":r[1].pathData="M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13 c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734 c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709 -1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"}i.task.call&&(r[0].borderWidth=4);i.task.compensation&&i.task.loop!="none"&&(r[2].addInfo.margin.left-=r[2].width/2+2,r[3].addInfo.margin.left+=r[3].width/2+2)}else if(i.activity==t.datavisualization.Diagram.BPMNActivity.SubProcess){var b=0,a=0,e=2;if(i.subProcess.collapsed)r[4].constraints=r[4].constraints|t.datavisualization.Diagram.NodeConstraints.PointerEvents,r[4].visible=!0,r[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z";else{for(r[4].constraints=r[4].constraints|t.datavisualization.Diagram.NodeConstraints.PointerEvents,r[4].visible=!0,r[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z",r[0]=n.extend(!0,r[0],{marginLeft:-i.paddingLeft,marginRight:-i.paddingRight,marginTop:-i.paddingTop,marginBottom:-i.paddingBottom,minWidth:i.width,minHeight:i.height}),i.constraints=i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop,i.minWidth=i.width,i.minHeight=i.height;o<c.length;)c[o].type!="bpmn"&&c.splice(o,1),o++;r=r.concat(c)}switch(i.subProcess.boundary){case"default":r[0].borderWidth=i.borderWidth;r[0].borderDashArray="1 0";break;case"call":r[0].borderWidth=i.borderWidth<4?4:i.borderWidth;r[0].borderDashArray="1 0";break;case"event":r[0].borderWidth=i.borderWidth;r[0].borderDashArray="2 2"}i.subProcess.adhoc?(r[5].visible=!0,r[5].pathData="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z"):i.subProcess.type=="event"?(r[0].borderWidth=i.borderWidth,r[0].borderDashArray="2 2",this._updateBPMNEventShape(i,r.slice(6,9),i.subProcess.event,i.subProcess.trigger)):i.subProcess.type=="transaction"&&(k={x:3,y:3,width:i.width-3,height:i.height-3},r[0].pathData+=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(k,12));do r[e].visible&&(r[e].addInfo.margin.left=a+r[e].width/2,a+=r[e].width+2),e++;while(e<6);a-=2;e=2;b=a/2;do r[e].visible&&(r[e].addInfo.margin.left-=b),e++;while(e<6)}return r},_updateRoundedRectanglePath:function(n,t){for(var u="",i=0,r=[{x:n.x||0,y:n.y||0},{x:n.x||0,y:n.height},{x:n.width,y:n.height},{x:n.width,y:n.y||0}],f=[{x:t,y:t},{x:t,y:-t},{x:-t,y:-t},{x:-t,y:t}],i=0;i<r.length;i++)u+=u?"L":"M",u+=r[i].x+(i%2==0?f[i].x:0)+","+(r[i].y+(i%2!=0?f[i].y:0)),u+="C"+r[i].x+","+r[i].y+" "+r[i].x+","+r[i].y,u+=" "+(r[i].x+(i%2!=0?f[i].x:0))+","+(r[i].y+(i%2==0?f[i].y:0));return u+="L"+(r[0].x+f[0].x)+","+r[0].y,u+"Z"},initBPMNAnnotationShape:function(i,r){var u=[],c=0,o,v,f,e;if(i._annotation&&i._annotation.length)while(c<i._annotation.length)if(o=r.nameTable[i._annotation[c++]],o&&o.name.split("annotation_")[0]!=i.name)i._annotation.splice(--c,1);else if(o)u.push(o);else break;if(i.annotation&&i.annotation.text){if(i=n.extend(!1,{},t.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),!u.length){var s=t.datavisualization.Diagram.PortVisibility.Hidden,h=t.datavisualization.Diagram.PortConstraints.None,y=[{offset:{x:0,y:.5},name:"left",visibility:s,constraints:h},{offset:{x:.5,y:0},name:"top",visibility:s,constraints:h},{offset:{x:1,y:.5},name:"right",visibility:s,constraints:h},{offset:{x:.5,y:1},name:"bottom",visibility:s,constraints:h}],l=i.name+"annotation_"+t.datavisualization.Diagram.Util.randomId(),a=i.name+"annotation_"+t.datavisualization.Diagram.Util.randomId(),p=t.datavisualization.Diagram.NodeConstraints.Default&~t.datavisualization.Diagram.NodeConstraints.Connect,w=t.datavisualization.Diagram.ConnectorConstraints.Default&~(t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd|t.datavisualization.Diagram.ConnectorConstraints.Drag);i._annotation&&i._annotation.length?(l=typeof i._annotation[0]=="string"?i._annotation[0]:i._annotation[0].name,a=typeof i._annotation[1]=="string"?i._annotation[1]:i._annotation[1].name):i._annotation=[];u.push({name:l,labels:[{text:i.annotation.text}],annotation:i.annotation,type:"bpmn",shape:"annotation",_type:"node",_shape:"path",ports:y,constraints:p,width:i.annotation.width,height:i.annotation.height,_preventStretch:!0});u.push({name:a,labels:[{readOnly:!0}],type:"connector",segments:[{type:"straight"}],targetDecorator:{shape:"none"},sourceNode:u[0].name,targetNode:i.name,constraints:w,annotation:i.annotation,_isAnnotationLine:!0})}u[0].offsetX=i.offsetX+i.annotation.length*Math.cos(-i.annotation.angle*(Math.PI/180));u[0].offsetY=i.offsetY+i.annotation.length*Math.sin(-i.annotation.angle*(Math.PI/180));v=[{fillColor:"transparent",borderColor:i.borderColor,rotateAngle:i.rotateAngle,opacity:i.opacity,ports:[]},{lineColor:i.borderColor,opacity:i.opacity}];n.extend(!0,u,v);f=r.nameTable[u[0].name];e=r.nameTable[u[1].name];f||(f=r._getNewNode(u[0]),r.nameTable[f.name]=f,i._annotation.splice(0,1,f.name));e||(e=r._getNewConnector(u[1]),r.nameTable[e.name]=e,i._annotation.splice(1,1,e.name));this.updateBPMNAnnotationShape(e,f,null,i,r)}return i},renderBPMNAnnotationShape:function(n,i){var u,r,f,e;if(n._annotation&&n._annotation.length)for(u=0;u<n._annotation.length;u++)r=typeof n._annotation[u]=="string"?i.nameTable[n._annotation[u]]:n._annotation[u],r&&(i.nameTable[r.name]=r,f=i.getObjectType(r),f=="node"?t.datavisualization.Diagram.DiagramContext.renderNode(r,i):f=="connector"&&(e=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateEdges(r),i._dock(r,i.nameTable),t.datavisualization.Diagram.DiagramContext.renderConnector(r,i),i._disableSegmentChange=e))},updateBPMNAnnotationShape:function(i,r,u,f,e){var a,l,v;if(e.getObjectType(i)=="connector"&&i._isAnnotationLine){u&&e.nameTable[u]&&(a=e.nameTable[u],n.extend(!0,a,t.datavisualization.Diagram.BPMNTextAnnotationDefaults),delete a._annotation);f||(f=e.nameTable[i.targetNode]);var o=t.datavisualization.Diagram.Util.bounds(r),s=20,h=20,c;c=f?t.datavisualization.Diagram.Util.bounds(f):{x:i.targetPoint.x,y:i.targetPoint.y,width:i.lineWidth,height:i.lineWidth};l="";o.x<=c.x+c.width&&o.x+o.width>=c.x&&(o.y+o.height<c.y&&(l="bottom"),o.y>c.y+c.height&&(l="top"));l||(o.x>c.x+c.width&&(l="left"),o.x+o.width<c.x&&(l="right"));l||i.annotation.direction||(l="left");i.annotation.direction=l;r.labels[0].horizontalAlignment=r.labels[0].verticalAlignment=r.labels[0].textAlign="center";switch(i.annotation.direction){case"left":h=o.height;r.pathData="M"+s+","+h+" L0,"+h+" L0,0 L"+s+",0";r.labels[0].horizontalAlignment="left";r.labels[0].textAlign="left";r.labels[0].offset=t.datavisualization.Diagram.Point(.05,.5);break;case"right":h=o.height;s=o.width-20;r.pathData="M"+s+","+h+" L"+(s+20)+","+h+" L"+(s+20)+",0 L"+s+",0";r.labels[0].horizontalAlignment="right";r.labels[0].textAlign="right";r.labels[0].offset=t.datavisualization.Diagram.Point(.95,.5);break;case"top":s=o.width;r.pathData="M"+s+","+h+" L"+s+",0 L0,0 L0,"+h;r.labels[0].verticalAlignment="top";r.labels[0].offset=t.datavisualization.Diagram.Point(.5,0);break;case"bottom":h=o.height-20;s=o.width;r.pathData="M"+s+","+h+" L"+s+","+(h+20)+" L0,"+(h+20)+" L0,"+h;r.labels[0].verticalAlignment="bottom";r.labels[0].offset=t.datavisualization.Diagram.Point(.5,1)}e.nameTable[i.name]&&(v=e._disableSegmentChange,e._disableSegmentChange=!1,i.annotation.direction=i.sourcePort=l,e._updateEdges(i),e._dock(i,e.nameTable),e._disableSegmentChange=v);t.datavisualization.Diagram.DiagramContext.update(r,e)}},translateBPMNAnnotationShape:function(i,r,u,f,e){var h,c,p,w,v,y,b,k;if(i.annotation&&i.shape!="annotation"){if(h=[],i.annotation&&i.annotation.text&&(i=n.extend(!1,{},t.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),i._annotation&&i._annotation.length)){for(c=0;c<i._annotation.length;c++)e.nameTable[i._annotation[c]]&&h.push(e.nameTable[i._annotation[c]]);if(h.length){if(p=r,w=u,f){var p=0,w=0,l=t.Matrix.identity();i.rotateAngle?(t.Matrix.rotate(l,-i.rotateAngle,f.x,f.y),t.Matrix.scale(l,r,u,f.x,f.y),t.Matrix.rotate(l,i.rotateAngle,f.x,f.y)):t.Matrix.scale(l,r,u,f.x,f.y);var o=t.datavisualization.Diagram.Util.bounds(i),d=i.offsetX-f.x,g=i.offsetY-f.y,nt={bottom:{x:i.offsetX,y:o.y},left:{x:o.x+o.width,y:i.offsetY},top:{x:i.offsetX,y:o.y+o.height},right:{x:o.x,y:i.offsetY}},s=nt[h[0].annotation.direction],a=t.Matrix.transform(l,{x:s.x-d,y:s.y-g});a.x!=s.x&&(p=s.x-a.x);a.y!=s.y&&(w=s.y-a.y)}e._translate(h[0],p,w,e.nameTable)}}}else if(i.annotation&&i.shape=="annotation"){for(y=0;y<i.outEdges.length;y++)if(b=e.nameTable[i.outEdges[y]],b._isAnnotationLine){v=b;break}v&&(k=i.targetNode?e.nameTable[i.targetNode]:null,this.updateBPMNAnnotationShape(v,e.nameTable[v.sourceNode],null,k,e))}},updateAnnotationProperties:function(i,r){r.getObjectType(i)=="node"&&(i=r.nameTable[i.outEdges[0]]);var f=r.nameTable[i.targetNode],u=r.nameTable[i.sourceNode];f&&u?(i.annotation.angle=t.datavisualization.Diagram.Util._findAngle({x:u.offsetX,y:u.offsetY},{x:f.offsetX,y:f.offsetY})*-1,i.annotation.length=t.datavisualization.Diagram.Util.findLength({x:f.offsetX,y:f.offsetY},{x:u.offsetX,y:u.offsetY}),u.annotation=f.annotation=n.extend(!1,{},i.annotation),f._annotation=[i.sourceNode,i.name],r.nodes().indexOf(u)>-1&&(t.datavisualization.Diagram.Util.removeItem(r.nodes(),u),t.datavisualization.Diagram.Util.removeItem(r.connectors(),i),r._nodes=n.extend(!0,[],r.nodes()))):u&&(i.annotation.angle=t.datavisualization.Diagram.Util._findAngle({x:u.offsetX,y:u.offsetY},i.targetPoint)*-1,i.annotation.length=t.datavisualization.Diagram.Util.findLength(i.targetPoint,{x:u.offsetX,y:u.offsetY}),u.annotation=n.extend(!1,{},i.annotation),r.nodes().push(u),r.connectors().push(i),r._nodes=n.extend(!0,[],r.nodes()))},updateInlineDecoratorsShape:function(n,i){var r,f,u,e;return n.shape&&n.shape.type=="bpmn"&&n.shape.flow=="message"&&(n._inlineDecorators.length&&(f=n._inlineDecorators.filter(function(t){if(t.name==n.name+"_"+n.shape.message)return t}),f.length&&(r=f[0])),n._inlineDecorators=[],(n.shape.message=="initiatingmessage"||n.shape.message=="noninitiatingmessage")&&(u=t.datavisualization.Diagram.Util._findOffsetOnConnector(n,{segmentOffset:.5},.5,i),e=n.shape.message=="noninitiatingmessage"?"lightgrey":"white",r?(r.offsetX=u.offset.x,r.offsetY=u.offset.y,r.fillColor=e):r=t.datavisualization.Diagram.Node({name:n.name+"_"+n.shape.message,width:25,height:15,offsetX:u.offset.x,offsetY:u.offset.y,fillColor:e,shape:"path",pathData:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",constraints:t.datavisualization.Diagram.NodeConstraints.Delete}),n._inlineDecorators.push(r))),n}};t.datavisualization.Diagram.bpmnHelper={resetNodeMargin:function(n,i,r){var e={marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom},u,o,f;if(t.datavisualization.Diagram.canvasHelper._updateNodeMargin(r,n,i),i&&i._type=="group")for(u=0;u<i.children.length;u++){o=typeof i.children[u]=="string"?r.nameTable[i.children[u]]:i.children[u];for(f in e)e[f]==0&&(o[f]=0)}},updateCanvas:function(n,i){var r,u;i._isUndo||t.datavisualization.Diagram.canvasHelper._updateNodeMargin(i,n,i.nameTable[n.parent]);n.container&&n.container.type==="canvas"&&(t.datavisualization.Diagram.canvasHelper._setSize(i,n,!0),this.updateProcessCollection(n,i),n.parent&&i.nameTable[n.parent]?(r=i.nameTable[n.parent],this.resetNodeMargin(n,r,i),this.updateCanvas(r,i)):t.datavisualization.Diagram.canvasHelper._updateNodeMargin(i,n,i.nameTable[n.parent]),i.nameTable[n.name]&&(u=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateAssociatedConnectorEnds(n,i.nameTable),t.datavisualization.Diagram.DiagramContext.update(n,i),i._disableSegmentChange=u))},updateProcessCollection:function(n,i){var r,f;if(n.shape=="activity"&&n.activity=="subprocess"){for(var u=n.subProcess.processes,r=0,e=i._getChildren(n.children);u&&u.length&&r<u.length;)e.indexOf(u[r].name)==-1?t.datavisualization.Diagram.Util.removeItem(u,u[r]):u[r]=i.nameTable[u[r++].name];for(r=0;r<n.children.length;r++)f=typeof n.children[r]=="string"?i.nameTable[n.children[r]]:n.children[r],f._isInternalShape||u.indexOf(f)!=-1||u.push(f)}},isBPMNContainerChild:function(n,t){if(n&&n.parent){var i=t.nameTable[n.parent];return i&&i.type=="bpmn"&&i.shape!="group"&&i.container&&i.activity!=="subprocess"?!0:!1}},canMoveOutofBounds:function(n,i,r,u){var e,o,f;return n.getObjectType(i)=="connector"&&(i.sourceNode||i.targetNode)&&(e=n.nameTable[i.sourceNode||i.targetNode],e&&this.isBPMNContainerChild(e,n))?(o=n.nameTable[e.parent],f=t.datavisualization.Diagram.Util.bounds(o),f=t.datavisualization.Diagram.Geometry.rect([f.topLeft,f.topRight,f.bottomRight,f.bottomLeft]),r>=f.x+f.width||r<=f.x||u>=f.y+f.height||u<=f.y?!1:!0):!0},canAllowConnection:function(n,t,i){var r=null;if(t&&i&&i.type=="bpmn"){if(i.parent&&(r=n.nameTable[i.parent]),r&&r.type=="bpmn"&&r.shape!="group"&&t.parent!=i.parent)return r;if(n._containsChild(i,t)||n._containsChild(t,i))return null}return i},canAllowDropOnContainer:function(n,t){return t.type!="bpmn"||n.type=="bpmn"&&n.shape!="annotation"?!0:!1}}}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function n(n){return this.xmlns="http://www.w3.org/2000/svg",this.document=document.createElementNS(this.xmlns,"svg"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return n.prototype.element=function(n,i){var r;return n&&n.id&&(r=this.document.getElementById(n.id)),r||(r=document.createElementNS(this.xmlns,i)),n&&t.datavisualization.Diagram.Util.attr(r,n),r},n.prototype.g=function(n){return this.element(n,"g")},n.prototype.defs=function(n){return this.element(n,"defs")},n.prototype.image=function(n){return this.element(n,"image")},n.prototype.path=function(n){return this.element(n,"path")},n.prototype.text=function(n){return this.element(n,"text")},n.prototype.textPath=function(n){return this.element(n,"textPath")},n.prototype.tspan=function(n){return this.element(n,"tspan")},n.prototype.rect=function(n){return this.element(n,"rect")},n.prototype.ellipse=function(n){return this.element(n,"ellipse")},n.prototype.circle=function(n){return this.element(n,"circle")},n.prototype.title=function(n){return this.element(n,"title")},n.prototype.line=function(n){return this.element(n,"line")},n.prototype.polyline=function(n){return this.element(n,"polyline")},n.prototype.polygon=function(n){return this.element(n,"polygon")},n.prototype.foreignObject=function(n){return this.element(n,"foreignObject")},n.prototype.linearGradient=function(n){return this.element(n,"linearGradient")},n.prototype.radialGradient=function(n){return this.element(n,"radialGradient")},n.prototype.stop=function(n){return this.element(n,"stop")},n.prototype.pattern=function(n){return this.element(n,"pattern")},n.prototype.appendChild=function(n){this.document.appendChild(n)},n.prototype.removeChild=function(n,t){t?t.removeChild(n):this.document.removeChild(n)},n.prototype.getElementById=function(n){return this.document.getElementById(n)},n.prototype.getElementsByClassName=function(n){return this.document.getElementsByClassName(n)},n.prototype.getElementsByTagName=function(n){return this.document.getElementsByTagName(n)},n.prototype.pathBounds=function(n){var f={d:n},r=this.path(f),i=new t.datavisualization.Diagram.Svg({id:"TempSvg"}),u;return document.body.appendChild(i.document),i.document.appendChild(r),u=r.getBBox(),document.body.removeChild(i.document),u},n.prototype.textBounds=function(n,t,i){var u=null,r;return n&&t?(r=this.text(t),r.appendChild(document.createTextNode(n)),this.document.appendChild(r),u=r.getBBox(),this.document.removeChild(r)):i&&(this.document.appendChild(i),u=i.getBBox(),this.document.removeChild(i)),u},n.prototype.absolutePath=function(n){for(var i,s,f,v,y,h,c,l,a,e=t.datavisualization.Diagram.Util.convertPathToArray(n.getAttribute("d")),r=0,u=0,o=0,p=e.length;o<p;++o){if(i=e[o],s=i.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(s))"x"in i&&(r=i.x),"y"in i&&(u=i.y);else{"x1"in i&&(h=r+i.x1);"x2"in i&&(l=r+i.x2);"y1"in i&&(c=u+i.y1);"y2"in i&&(a=u+i.y2);"x"in i&&(r+=i.x);"y"in i&&(u+=i.y);switch(s){case"m":f={pathSegTypeAsLetter:"M",x:r,y:u};break;case"l":f={pathSegTypeAsLetter:"L",x:r,y:u};break;case"h":f={pathSegTypeAsLetter:"H",x:r};break;case"v":f={pathSegTypeAsLetter:"V",y:u};break;case"c":f={pathSegTypeAsLetter:"C",x:r,y:u,x1:h,y1:c,x2:l,y2:a};break;case"s":f={pathSegTypeAsLetter:"S",x:r,y:u,x2:l,y2:a};break;case"q":f={pathSegTypeAsLetter:"Q",x:r,y:u,x1:h,y1:c};break;case"t":f={pathSegTypeAsLetter:"T",x:r,y:u};break;case"a":f={pathSegTypeAsLetter:"A",x:r,y:u,r1:i.r1,r2:i.r2,angle:i.angle,largeArcFlag:i.largeArcFlag,sweepFlag:i.sweepFlag};break;case"z":case"Z":r=v;u=y;f=e[o]}f&&(e[o]=f)}(s==="M"||s==="m")&&(v=r,y=u)}return n.setAttribute("d",t.datavisualization.Diagram.Util.pathSegArrayAsString(e)),n},n}();t.datavisualization.Diagram.Svg=i;t.datavisualization.Diagram.SvgContext={_renderDocument:function(i,r,u){var f,s,e,o;window.SVGSVGElement&&(f=n("#"+i.canvas.id+"_svgParent")[0],f||(f=document.createElement("div")),s=t.datavisualization.Diagram.ScrollUtil._getRulerSize(r),e={id:i.canvas.id+"_svgParent",style:"height:auto;width:auto;position:absolute;overflow:hidden;left:"+s.left+"px;top:"+s.top+"px;bottom:0px;"},t.datavisualization.Diagram.Util.attr(f,e),i.canvas.appendChild(f),r._svgParent=f,e={id:i.canvas.id+"_svg",version:"1.1",style:"position:absolute;","class":"mainview_svg",role:"img"},t.isMobile()&&(e.style="position: inherit"),o=u?r._svg:new t.datavisualization.Diagram.Svg(e),i.svg=o,r&&(this._renderRulers(r,i.canvas,i.svg,u),r._svg=o,u||document.getElementById(o.document.id)||r._svgParent.appendChild(o.document),r._view=this._renderView(i.canvas,i.svg,u),r._page=this._renderPage(i.canvas,i.svg,r._view,u),this._renderBackground(r,i.canvas,i.svg,r._page,r.model,u),r._pageBackgroundLayer=this._renderBackgroundLayer(i.canvas,i.svg,r._page,u),this._renderGrid(i.canvas,i.svg,r._page,r),r._diagramLayer=i.diagramLayer=this._renderDiagramLayer(i.canvas,i.svg,r._page),r._htmlLayer=this._renderHtmlLayer(i.canvas,u,r),this._renderAdornerLayer(r,i.canvas,u,i)))},_renderRulers:function(n,t,i,r){if(n.model.rulerSettings.showRulers)this._renderOverLappingElement(n,t,i,r),this._renderRuler(n,t,i,!1,r),this._renderRuler(n,t,i,!0,r);else{var u;u=document.getElementById(t.id+"_hRuler");u&&u.parentNode.removeChild(u);u=document.getElementById(t.id+"_vRuler");u&&u.parentNode.removeChild(u);u=document.getElementById(t.id+"_overlap-Ruler");u&&u.parentNode.removeChild(u)}},_renderOverLappingElement:function(n,i){var r=document.getElementById(i.id+"_overlap-Ruler"),u,f;r||(r=document.createElement("div"),u=t.datavisualization.Diagram.ScrollUtil._getRulerSize(n),r.setAttribute("id",i.id+"_overlap-Ruler"),f="height: "+u.top+"px;width:"+u.left+"px;position:absolute;left:0;top:0",r.setAttribute("style",f),r.setAttribute("class","sf-diagram_overlap"));i.insertBefore(r,i.firstChild)},_updateRulerSpace:function(n,t,i){var r=document.getElementById(n._canvas.id+(i?"_hRuler":"_vRuler")),u=i?n._hRulerInstance:n._vRulerInstance;r&&n&&t&&(i?(r.style.width=t.width+n._hRulerInstance.model.segmentWidth*2+"px",r.style.height=u.model.thickness+"px",r=document.getElementById(n._canvas.id+"_overlap-Ruler"),r&&(r.style.height=u.model.thickness+"px")):(r.style.height=t.height+n._vRulerInstance.model.segmentWidth*2+"px",r.style.width=u.model.thickness+"px",r=document.getElementById(n._canvas.id+"_overlap-Ruler"),r&&(r.style.width=u.model.thickness+"px")))},_renderRuler:function(i,r,u,f){var e=document.getElementById(r.id+(f?"_hRuler":"_vRuler")),s=t.datavisualization.Diagram.ScrollUtil._getRulerSize(i),h=t.datavisualization.Diagram.ScrollUtil._getRulerGeometry(i),a,o,c,l;e||(e=document.createElement("div"),a=f?"height: "+s.top+"px;width:"+h.width+"px;margin-left:"+s.left+"px;":"height:"+h.height+"px;width: "+s.left+"px;float:left;top:"+s.top+"px;",e.setAttribute("id",r.id+(f?"_hRuler":"_vRuler")),e.setAttribute("style",a),e.setAttribute("class",f?"sf-diagram_hRuler":"sf-diagram_hRuler"));r.insertBefore(e,r.firstChild);o=f?i.model.rulerSettings.horizontalRuler:i.model.rulerSettings.verticalRuler;o=n.extend(!0,{},o);o.length=(f?h.width:h.height)+o.segmentWidth;o.orientation=f?"horizontal":"vertical";c=n("#"+e.id).ejRuler(o);l=n("#"+e.id).ejRuler("instance");f?(i._hRuler=c,i._hRulerInstance=l):(i._vRuler=c,i._vRulerInstance=l)},_renderView:function(n,t,i){var r=t.document.getElementById(n.id+"_view"),u;return r||(u={id:n.id+"_view"},r=t.g(u)),i||t.appendChild(r),r},_renderHtmlLayer:function(n,i,r){var u=document.getElementById(n.id+"_htmlLayer"),e,f;return u||(u=document.createElement("div")),e={id:n.id+"_htmlLayer","class":"htmlLayer"},t.datavisualization.Diagram.Util.attr(u,e),f=u,u.style.pointerEvents="none",i||r._svgParent.appendChild(f),f},_renderAdornerLayer:function(n,i,r,u){var f=document.getElementById(i.id+"_adorner"),e;f||(f=document.createElement("div"));e={id:i.id+"_adorner","class":"adornerLayer_parent_div",style:"position:absolute;left:0px;top:0px"};t.datavisualization.Diagram.Util.attr(f,e);n._adornerLayer=this._renderAdornerSvg(n,i,f,r,u);n._tooltipLayer=this._renderTooltipLayer(i,f,r);r||n._svgParent.appendChild(f)},_renderTooltipLayer:function(n,i,r){var u=document.getElementById(n.id+"_tooltip"),e,f;return u||(u=document.createElement("div")),e={id:n.id+"_tooltip","class":"diagram_tooltip"},t.datavisualization.Diagram.Util.attr(u,e),f=u,u.style.pointerEvents="none",r||i.appendChild(f),f},_renderPage:function(n,t,i,r){var u=t.document.getElementById(n.id+"_page"),f;return u||(f={id:n.id+"_page","class":"page"},u=t.g(f)),r||i.appendChild(u),u},_renderDiagramLayer:function(n,t,i){var r=t.document.getElementById(n.id+"_diagramLayer"),u;return r||(u={id:n.id+"_diagramLayer","class":"DiagramLayer"},r=t.g(u),i.appendChild(r)),r},_renderAdornerSvg:function(n,i,r,u,f){var e,h,s,c,o;if(window.SVGSVGElement)return o={id:i.id+"_svg_adorner",version:"1.1",style:"position:absolute",fill:"none","pointer-events":"none"},e=u?n._adornerSvg:new t.datavisualization.Diagram.Svg(o),u||document.getElementById(e.document.id)||r.appendChild(e.document),h=e.document.getElementById(i.id+"_expander"),h||(o={id:i.id+"_expander","class":"ExpanderLayer","pointer-events":"all"},h=e.g(o),e.document.appendChild(h)),f._expander=n._expander=h,s=e.document.getElementById(i.id+"_adornerLayer"),s||(o={id:i.id+"_adornerLayer","class":"AdornerLayer","pointer-events":"none"},s=e.g(o),e.document.appendChild(s)),c=e.document.getElementById(i.id+"_portLayer"),c||(o={id:i.id+"_portLayer","class":"portLayer","pointer-events":"none"},c=e.g(o),s.appendChild(c)),n._adornerSvg=e,s},_renderBackgroundLayer:function(n,t,i,r){var u=t.document.getElementById(n.id+"_pageBackground"),f;return u||(f={id:n.id+"_pageBackground","class":"PageBackgroundLayer",style:"pointer-events:none;"},u=t.g(f)),r||i.appendChild(u),u},_renderBackground:function(n,i,r,u){var c,l,s;r.document.style.msTouchAction="none";r.document.style.display="block";r.document.style.backgroundColor="white";var h={id:i.id+"_backgroundLayer"},f=r.g(h),e=n._getDigramBounds();if(n._backgroundImage()){var o=n._backgroundImage(),a=t.datavisualization.Diagram.Util._getImageAlignment(o.alignment),v="none "+a!="none"&&o.scale!="none"?a+" "+o.scale:"none";h={id:i.id+"_backgroundImage",x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:v,"pointer-events":"none"};c=r.image(h);c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o.source);r.getElementById(i.id+"_backgroundImage")||f.appendChild(c)}l=n._backgroundColor();s=r.rect({id:i.id+"_backgroundColor",width:"100%",height:"100%",fill:l,"pointer-events":"none"});l?r.getElementById(i.id+"_backgroundColor")||f.appendChild(s):r.getElementById(s.id)&&f.removeChild(r.getElementById(s.id));r.getElementById(f.id)||u.appendChild(f)},_renderGrid:function(n,i,r,u){var h=u._svg.document.getElementById(n.id+"patterndefinition"),o,c,l,a,e,f,v,s;if(h||(h=i.defs({id:n.id+"patterndefinition"}),i.appendChild(h)),u._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines||u._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines){var s=document.getElementById(n.id+"_grid"),v=document.getElementById(n.id+"pattern_gridline"),f=document.getElementById(n.id+"pattern_grid");f&&f.parentNode&&f.parentNode.removeChild(f);c={id:n.id+"_grid","pointer-events":"none"};o=i.g(c);l=0;u.model.snapSettings.horizontalGridLines.linesInterval&&u.model.snapSettings.horizontalGridLines.linesInterval.forEach(function(n){l+=n});a=0;u.model.snapSettings.verticalGridLines.linesInterval&&u.model.snapSettings.verticalGridLines.linesInterval.forEach(function(n){a+=n});e=this._scaleSnapInterval(u.model,u._currZoom);c={id:n.id+"pattern_grid",x:0,y:0,width:a*e,height:l*e,patternUnits:"userSpaceOnUse"};f=i.pattern(c);e=this._scaleSnapInterval(u.model,e);this._renderHorizontalGridlines(e,f,a,u,i);this._renderVerticalGridlines(e,f,l,u,i);h.appendChild(f);v=i.rect({id:n.id+"pattern_gridline",x:u._hScrollOffset,y:u._vScrollOffset,width:"100%",height:"100%",fill:"url(#"+n.id+"pattern_grid)"});o.appendChild(v);s||(u._diagramLayer?r.insertBefore(o,u._diagramLayer):r.appendChild(o))}else o=document.getElementById(n.id+"_grid"),o&&(s=document.getElementById(n.id+"pattern_gridline"),s&&s.parentNode&&s.parentNode.removeChild(s))},_updateBackground:function(n,i,r,u){var s={x:n,y:i},o=document.getElementById(u._id+"_canvas_backgroundColor"),e,f;o&&t.datavisualization.Diagram.Util.attr(o,s);e=document.getElementById(u._id+"_canvas_backgroundImage");f=u._getDigramBounds();e&&t.datavisualization.Diagram.Util.attr(e,{transform:"scale("+r+")",x:f.x,y:f.y,width:f.width,height:f.height})},_updateGrid:function(n,i,r,u){var l=document.getElementById(u._canvas.id+"pattern_gridline"),f,e,o,s,a,c,h;if(l){if(e=document.getElementById(u._canvas.id+"pattern_grid"),o=0,u.model.snapSettings.horizontalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.horizontalGridLines.linesInterval.length;f++)o+=u.model.snapSettings.horizontalGridLines.linesInterval[f];if(s=0,u.model.snapSettings.verticalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.verticalGridLines.linesInterval.length;f++)s+=u.model.snapSettings.verticalGridLines.linesInterval[f];h={x:n,y:i};t.datavisualization.Diagram.Util.attr(l,h);r=this._scaleSnapInterval(u.model,r);a=u._svg;c=a.defs({id:u._canvas.id+"patterndefinition"});e&&c.removeChild(e);h={id:u._canvas.id+"pattern_grid",x:0,y:0,width:s*r,height:o*r,patternUnits:"userSpaceOnUse"};e=u._svg.pattern(h);this._renderHorizontalGridlines(r,e,s,u,u._svg);this._renderVerticalGridlines(r,e,o,u,u._svg);c.appendChild(e)}},_scaleSnapInterval:function(n,t){if(t>=2)while(t>=2)t/=2;else if(t<=.5)while(t<=.5)t*=2;var i;if(t!==1){for(n.snapSettings.horizontalGridLines._snapinterval=[],i=0;i<n.snapSettings.horizontalGridLines.snapInterval.length;i++)n.snapSettings.horizontalGridLines._snapinterval[i]=n.snapSettings.horizontalGridLines.snapInterval[i]*t;for(n.snapSettings.verticalGridLines._snapinterval=[],i=0;i<n.snapSettings.verticalGridLines.snapInterval.length;i++)n.snapSettings.verticalGridLines._snapinterval[i]=n.snapSettings.verticalGridLines.snapInterval[i]*t}return t},_updateRulerSegment:function(t,i,r,u,f,e){if(u.model.rulerSettings.showRulers){for(var y=u.model.snapSettings,l=n("#"+(e?u._hRuler[0].id:u._vRuler[0].id)).ejRuler("instance"),b=n("#"+(e?u._vRuler[0].id:u._hRuler[0].id)).ejRuler("instance"),a=l._updateSegmentWidth(u._currZoom),p=b._updateSegmentWidth(u._currZoom),k=a/l.model.interval,w=0,v,o,s,c=e?y.verticalGridLines:y.horizontalGridLines,h=0;h<l.model.interval;h++)o=h==0?1.25:.25,s=Number(w+o/2),v=e?f.path({d:"M "+s+" 0 L "+s+" "+p+" Z",stroke:c.lineColor,"stroke-width":o,"stroke-dasharray":c.lineDashArray}):f.path({d:"M 0 "+s+" L "+p+" "+s+" Z",stroke:c.lineColor,"stroke-width":o,"stroke-dasharray":c.lineDashArray}),w+=k+o/2,v&&i.appendChild(v);e?i.setAttribute("width",a):i.setAttribute("height",a)}},_checkForDefaultGridlines:function(n){var i=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],t;if(n){if(n.length>0&&i.length>0&&n.length!=i.length)return!1;for(t=0;t<i.length;t++)if(i[t]!=n[t])return!1}return!0},_renderHorizontalGridlines:function(n,i,r,u,f){var v=u.model,o=v.snapSettings,h,c,l,e,s,a;if(u._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines)if(u.model.rulerSettings.showRulers&&this._checkForDefaultGridlines(u.model.snapSettings.horizontalGridLines.linesInterval))this._updateRulerSegment(n,i,r,u,f);else for(h=0,l=0,e=0;e<o.horizontalGridLines.linesInterval.length;e=e+2)s=o.horizontalGridLines.linesInterval[e],c=Number(h+s/2),a=f.path({d:"M 0 "+c*n+" L "+r*n+" "+c*n+" Z",stroke:o.horizontalGridLines.lineColor,"stroke-width":s,"stroke-dasharray":o.horizontalGridLines.lineDashArray}),h+=o.horizontalGridLines.linesInterval[e+1]+s,i.appendChild(a),l++},_renderVerticalGridlines:function(n,i,r,u,f){var l=u.model,o=l.snapSettings,h,c,a,e,s,v;if(o.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines)if(u.model.rulerSettings.showRulers&&this._checkForDefaultGridlines(u.model.snapSettings.verticalGridLines.linesInterval))this._updateRulerSegment(n,i,r,u,f,!0);else for(h=0,a=0,e=0;e<o.verticalGridLines.linesInterval.length;e=e+2)s=l.snapSettings.verticalGridLines.linesInterval[e],c=Number(h+s/2),v=f.path({d:"M "+c*n+" 0 L "+c*n+" "+r*n+" Z",stroke:o.verticalGridLines.lineColor,"stroke-width":s,"stroke-dasharray":o.verticalGridLines.lineDashArray}),h+=o.verticalGridLines.linesInterval[e+1]+s,i.appendChild(v),a++},transformView:function(n,i,r){var e=t.datavisualization.Diagram.ScrollUtil._getRulerSize(n),f=n._view,u={transform:"translate("+i+","+r+")"};t.datavisualization.Diagram.Util.attr(f,u);t.datavisualization.Diagram.Util.attr(n._adornerLayer,u);t.datavisualization.Diagram.Util.attr(n._expander,{transform:"translate("+i+","+r+"),scale("+n.model.scrollSettings.currentZoom+")"});n._htmlLayer&&(n._htmlLayer.style.left=i+"px",n._htmlLayer.style.top=r+"px",n._htmlLayer.style.position="absolute")},scaleContent:function(n,i){var h=n._diagramLayer,e,o,u,f,r,s;for(t.datavisualization.Diagram.Util.attr(h,{transform:"scale("+i+")"}),e=typeof n.model.scrollSettings.horizontalOffset=="function"?n.model.scrollSettings.horizontalOffset():n.model.scrollSettings.horizontalOffset,o=typeof n.model.scrollSettings.verticalOffset=="function"?n.model.scrollSettings.verticalOffset():n.model.scrollSettings.verticalOffset,t.datavisualization.Diagram.Util.attr(n._expander,{transform:"translate("+-e+","+-o+"),scale("+i+")"}),n._htmlLayer&&(n._htmlLayer.style.webkitTransform="scale("+i+")",n._htmlLayer.style.MozTransform="scale("+i+")",n._htmlLayer.style.OTransform="scale("+i+")",n._htmlLayer.style.msTransform="scale("+i+")",n._htmlLayer.style.transform="scale("+i+")"),n.selectionList.length>0&&this.updateSelector(n.selectionList[0],n._adornerSvg,i,n,n.model.selectedItems.constraints),n.selectionList[0]&&n.model.selectedItems.userHandles&&n.model.selectedItems.userHandles.length>0&&(u=!1,n.selectionList[0].type=="pseudoGroup"&&(u=!0),n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&t.datavisualization.Diagram.SvgContext.updateUserHandles(n.model.selectedItems.userHandles,n.selectionList[0],n._adornerSvg,u,!1,i,n)),f=n.nodes(),r=0,s=f.length;r<s;++r)this._updatePortScale(f[r],n)},_updatePortScale:function(n,t){var i,r,u;if(n=t.nameTable[t._getChild(n)],this._updatePorts(n,t._adornerSvg,t),n.type!="pseudoGroup"&&(i=n.children,i&&i.length>0))for(r=0,u=i.length;r<u;++r)this._updatePortScale(i[r],t)},setSize:function(i,r,u){if(t.datavisualization.Diagram.Util.attr(i._svg.document,{width:r+"px",height:u+"px"}),!i._svgParentDimention||i._svgParentDimention.width!==r||i._svgParentDimention.height!==u){var f=t.datavisualization.Diagram.ScrollUtil._getRulerSize(i);i._svgParentDimention={};i._svgParentDimention.width=i.element.width()-f.left;i._svgParentDimention.height=i.element.height()-f.top}n(i._svgParent).css("width",i._svgParentDimention.width+"px").css("height",i._svgParentDimention.height+"px");t.datavisualization.Diagram.Util.attr(i._adornerSvg.document,{width:r+"px",height:u+"px"})},renderNode:function(n,i,r,u,f,e){var o,w=n.width?n.width:n._width||0,b=n.height?n.height:n._height||0,k=n.name,l=0,a=0,h=0,c=0,v=0,d=n.visible&&t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",f)?"visible":"hidden",s,y,p;return u||(h=n.offsetX-w*n.pivot.x,c=n.offsetY-b*n.pivot.y,l=n.offsetX,a=n.offsetY,v=n.rotateAngle),t.datavisualization.Diagram.Util.canCrispEdges(n,f)&&(h=Math.floor(h)+.5,c=Math.floor(c)+.5),s={id:k,"class":"ej-d-node",transform:"rotate("+v+","+l+","+a+"),translate("+h+","+c+")",visibility:d},t.datavisualization.Diagram.Util.canEnablePointerEvents(n,f)||(s.style="pointer-events:none"),n._isClassifier&&(s["class"]+=" ej-d-classifier"),o=i.g(s),r?r.appendChild(o):i.appendChild(o),y=n.flip!=="none"?n.flip:n._flip,y&&y!==t.datavisualization.Diagram.FlipDirection.None&&(p=this.renderflipElement(n,f),p&&(s.transform="rotate("+v+","+l+","+a+")"+p),i.g(s)),n._isDisabled&&t.datavisualization.Diagram.Util.attr(o,{style:"pointer-events:none;"}),this._renderNode(n,i,o,f,u,e),n&&n.annotation&&t.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(n,f),n._isClassifier&&delete n._isClassifier,o},renderflipElement:function(n,i){var r=null,e=n.offsetX+n.width*n.pivot.x,o=n.offsetY+n.height*n.pivot.y,s=n.offsetX-n.width*n.pivot.x,h=n.offsetY-n.height*n.pivot.y,u=n.flip!=="none"?n.flip:n._flip,f;return n.parent&&(f=i.nameTable[n.parent]),f&&f.flip===n.flip||(u==t.datavisualization.Diagram.FlipDirection.Horizontal?r="translate("+e+","+h+") scale(-1,1)":u==t.datavisualization.Diagram.FlipDirection.Vertical?r="translate("+s+","+o+") scale(1,-1)":u==t.datavisualization.Diagram.FlipDirection.Both&&(r="translate("+e+","+o+") scale(-1,-1)")),r},_renderNode:function(n,t,i,r,u,f){this._renderShape(n,t,i,r);this._renderLabels(n,t,r,u);this._renderPorts(n,r._adornerSvg&&!f?r._adornerSvg:t,r,f);n.outEdges.length>0&&this._renderIcons(n,r)},_renderShadow:function(n,i){var u,f,r,e,o,s;n.segments||(u=i.document.getElementById(n.name),n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=n.fillColor,n.type==="image"||n.type==="text"||n.type==="html"?r=i.document.getElementById(n.name+"_backRect"):n.type!="text"&&n.type!="image"&&(r=i.document.getElementById(n.name+"_shape")),r&&(e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),o={id:n.name+"_shadow",width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:f!="none"||f!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:n.shadow.opacity,"stroke-dasharray":""},n.type==="native"||n.type==="html"?u.insertBefore(i.rect(o),r):(s=r.cloneNode(!0),u.insertBefore(s,r),t.datavisualization.Diagram.Util.attr(s,o)))))},_updateShadow:function(n,i){var f=i.document.getElementById(n.name),r=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),u={id:n.name+"_shadow",transform:"translate("+r.x+","+r.y+")",opacity:n.shadow.opacity};i.g(u)},_deleteLabel:function(n,t,i,r,u){var o,f,s,e,t;if(i.model.labelRenderingMode==="html"){if(o=u.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=this._findChild(o.childNodes,n),f)for(s=f.childNodes.length,e=0;e<s;e++)f.childNodes[e].id==n.name+"_"+t.name+"_lblbg"&&f.childNodes[e].parentNode.removeChild(f.childNodes[e])}else t=r.document.getElementById(n.name+"_"+t.name),t&&t.parentNode.removeChild(t)},_deletePort:function(n,t,i,r){if(n){var t=r.document.getElementById(n.name+"_"+t.name);t&&t.parentNode.removeChild(t)}},_removeShadow:function(n,t){if(n.type!="text"){var i,r,u=n.name;n.type==="bpmn"&&n.children&&n.shape!="group"&&(u=n.children[0].name);i=t.document.getElementById(u);r=t.document.getElementById(u+"_shadow");i&&r&&i.removeChild(r)}},_renderphase:function(n,i,r,u,f){var o,p,s,v,y;o=i.g({id:n.name+"_phase_g","class":"ej-d-seperator"});n.parent?r.appendChild(o):i.appendChild(o);var w="visible",c=0,l=0;if(f){p=u._getChildren(f.children);p.length>1&&(s=u.nameTable[p[0]]);var e=t.datavisualization.Diagram.Util.bounds(f),h=[],a,b=e.top+50,k=e.left+50;n.orientation=="vertical"?(h.push({x:0,y:0}),h.push({x:e.width,y:0}),a=this._convertToSVGPoints(h),c=e.x,l=e.y+n.offset+s.height,s&&(b+=s.height),l<e.bottom&&l>b||(w="hidden")):(h.push({x:0,y:s.height?s.height:0}),h.push({x:0,y:e.height}),a=this._convertToSVGPoints(h),c=e.x+n.offset,l=e.y,c<e.right&&c>k||(w="hidden"));v={id:n.name+"_phase",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,points:a};y=i.polyline(v);o.appendChild(y);v={id:n.name+"_phase_hitTest","class":"hitTest","stroke-width":10,points:a,stroke:"transparent"};y=i.polyline(v);o.appendChild(y);o.setAttribute("transform","translate("+c+","+l+")")}},renderphase:function(n,t,i,r,u){var f,e;r._views.forEach(function(t){f=r._views[t];e=f.svg||f._canvas;i&&(i=e.document.getElementById(i.id));f.context._renderphase(n,e,i||f.diagramLayer,r,u)})},_renderGroupBackground:function(n,i,r,u){var c,f,y,l;if(n.fillColor!="none"){var e=n.offsetX-n.width*n.pivot.x,o=n.offsetY-n.height*n.pivot.y,s=n.fillColor,a=n.borderColor;(n.type=="bpmn"&&n.shape!="group"||n.classifier&&n.classifier=="package")&&(s="transparent",a="transparent");t.datavisualization.Diagram.Util.canCrispEdges(n,u)&&(e=Math.floor(e)+.5,o=Math.floor(o)+.5);var p=n.rotateAngle,v=new t.datavisualization.Diagram.Point(e+n.width*n.pivot.x,o+n.height*n.pivot.y),h={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:Math.round(n.width<0?0:n.width),height:Math.round(n.height<0?0:n.height),fill:s,stroke:a,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+p+","+v.x+","+v.y+"),translate("+e+","+o+")"};(n.type=="umlclassifier"||n._isClassifier)&&(h["class"]="ej-d-group ej-d-classifier");n.gradient&&n.type!="bpmn"&&(h.fill=this._renderGradient(n.name,n.gradient,r));this._addCssClass(n,h);c=r.rect(h);i.appendChild(c);n.type==="bpmn"&&n.shape==="group"&&n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),n.shape==="group"&&n.children.length===0&&(f.x=n.offsetX-n.width*n.pivot.x+f.x,f.y=n.offsetY-n.height*n.pivot.y+f.y),y={id:n.name+"_shadow",width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:s!="none"||s!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity,"stroke-dasharray":""},l=c.cloneNode(!0),i.insertBefore(l,c),t.datavisualization.Diagram.Util.attr(l,y))}},renderGroup:function(i,r,u,f,e,o,s){var c,d=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",e)?"visible":"hidden",w={id:i.name,"class":"ej-d-group",visibility:d},l,y,k,h,a,v,b,u,p;if(t.datavisualization.Diagram.Util.canEnablePointerEvents(i,e)||(w.style="pointer-events:none"),(i.type=="umlclassifier"||i._isClassifier)&&(w["class"]+=" ej-d-classifier"),c=r.g(w),u?u.appendChild(c):r.appendChild(c),i.parent==""&&i.container&&(o&&(i.height=0,i.width=0),s||e._updateChildAdjacentConnectors(i)),this._renderGroupBackground(i,c,r,e),i.isSwimlane&&(e._disableSwimlaneUptate=!0),l=i.children,l&&l.length>0)for(y=0,k=l.length;y<k;y++)h=f[t.datavisualization.Diagram.Util.getChild(l[y])],h&&(h._type==="group"?(i.type=="umlclassifier"&&(h._isClassifier=!0),this.renderGroup(h,r,c,f,e,o,s),t.datavisualization.Diagram.Util._updateGroupBounds(h,e,!0),t.datavisualization.Diagram.DiagramContext.update(h,e)):h.segments?(t.datavisualization.Diagram.Util.updateBridging(h,e),this.renderConnector(h,r,c,e)):(i.type=="umlclassifier"&&(h._isClassifier=!0),this.renderNode(h,r,c,undefined,e,s),h._isService&&(a=n.extend(!0,{},h),a.name=h.name+"service",a.offsetX=h.offsetX+7,a.offsetY=h.offsetY+5,this.renderNode(a,r,c,undefined,e,s))));return this._renderLabels(i,r,e),this._renderPorts(i,e._adornerSvg&&!s?e._adornerSvg:r,e,s),i.isSwimlane&&delete e._disableSwimlaneUptate,i&&i.annotation&&t.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(i,e),i&&i.isSwimlane&&(p=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,i),e._views.forEach(function(n){var t,r;for(v=e._views[n],b=v.svg||v._canvas,u&&(u=b.document.getElementById(u.id)),t=0;p&&t<p.length;t++)r=e.nameTable[e._getChild(p[t])],r&&v.context._renderphase(r,b,u||v.diagramLayer,e,i)})),i._isClassifier&&delete i._isClassifier,c},_renderGradient:function(n,t,i){var u,r;return t.type==="linear"?(r=this._renderLinearGradient(i.id+"_"+n,t,i),u="url(#"+r+")"):t.type==="radial"&&(r=this._renderRadialGradient(i.id+"_"+n,t,i),u="url(#"+r+")"),u},_checkGradientTag:function(n,t,i){if(t.getElementById(n+"_gradient")){var r=t.getElementById(n+"_gradient");(i&&r.localName==="radialGradient"||!i&&r.localName==="linearGradient")&&r.parentNode.removeChild(r)}},_renderLinearGradient:function(n,t,i){var u=i.document.getElementById(i.document.parentNode.parentNode.id+"patterndefinition")||i.document.getElementById(n+"patterndefinition"),f,r;return u?(this._checkGradientTag(n,i,!0),f={id:n+"_gradient",x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"},r=i.linearGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderRadialGradient:function(t,i,r){var f=r.document.getElementById(n(r.document).parents()[1].id+"patterndefinition")||r.document.getElementById(t+"patterndefinition"),e,u;return f?(this._checkGradientTag(t,r,!1),e={id:t+"_gradient",cx:i.cx+"%",cy:i.cy+"%",fx:i.fx+"%",fy:i.fy+"%",r:i.r+"%"},u=r.radialGradient(e),this._renderStops(i,r,u),f.appendChild(u),u.id):null},_renderStops:function(n,t,i){var f,r,u,e;if(t.getElementById(i.getAttribute("id"))===i)while(i.firstChild)i.removeChild(i.firstChild);for(f=n.stops,u=0,e=f.length;u<e;u++)r=f[u],i.appendChild(t.stop({offset:r.offset+"%","stop-color":r.color,"stop-opacity":r.opacity}))},_renderShape:function(n,t,i,r){var u=n._shape?n._shape:n.type;switch(u){case"rectangle":this._renderRect(n,t,i);break;case"ellipse":this._renderEllipse(n,t,i);break;case"image":this._renderImage(n,t,i);break;case"path":this._renderPath(n,t,i);break;case"polygon":this._renderPolygon(n,t,i);break;case"text":this._renderTextElement(n,t,i,r);break;case"html":this._renderHtmlElement(n,t,i,r);break;case"native":this._rendercontent(n,t,i,r)}},_renderHTMLTemplate:function(t,i){if(t.templateId&&n.templates)return i._renderEjTemplate("#"+t.templateId,t)},_renderSvgTemplate:function(n,t,i,r){var e=document.createElement("div"),s,f,o,u;e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+r+"<\/g><\/svg>";document.body.appendChild(e);s=document.getElementById("tempNative");f=s.cloneNode(!0);f.id=n.name+"_shape";i.appendChild(f);o={id:n.name+"_shape",fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray};this._addCssClass(n,o);n.gradient&&(o.fill=this._renderGradient(n.name,n.gradient,t));t.g(o);u=this._scaleNodeContent(n,s);u&&f.setAttribute("transform","translate("+u.x+","+u.y+"),scale("+u.sx+","+u.sy+")");f.setAttribute("id",n.name+"_shape");e.parentNode.removeChild(e)},_scaleNodeContent:function(n,t){var u,f,i,r;if(n.scale!="none"){t&&(i=n.type=="html"?t.getBoundingClientRect():t.getBBox());n.type=="html"&&(i.x=i.left,i.y=i.top);u=n.width?n.width:n._width;f=n.height?n.height:n._height;t||(i={x:n.offsetX-n.width*n.pivot.x,y:n.offsetY-n.height*n.pivot.y,width:u,height:f});var e=i.width?u/i.width:1,o=i.height?f/i.height:1,s=i.x*e*-1,h=i.y*o*-1;return n.scale!="stretch"&&n.contentAlignment!="none"?(r=n.scale=="meet"?Math.min(e,o):Math.max(e,o),n.contentAlignment.indexOf("xmid")>-1?s=u/2-i.width*r/2:n.contentAlignment.indexOf("xmax")>-1&&(s=i.x+u-i.width*r),n.contentAlignment.indexOf("ymid")>-1?h=i.y+f/2-i.height*r/2:n.contentAlignment.indexOf("ymax")>-1&&(h=i.y+f-i.height*r),{x:s,y:h,sx:r,sy:r}):{x:s,y:h,sx:e,sy:o}}return null},_rendercontent:function(i,r,u,f){var s,h,c;if(i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){var e=i.fillColor,o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},i.shadow.angle,i.shadow.distance),l={id:i.name+"_shadow",width:i.width,height:i.height,stroke:i.borderColor!="none"||i.borderColor!="transparent"?"lightgrey":"none",fill:e!="none"||e!="transparent"?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:i.shadow.opacity};u.appendChild(r.rect(l))}!i.segments&&i.templateId&&n.templates&&(s=i.width,h=i.height,i._type!=="node"||i.height||i.width||(i.width=i._width,i.height=i._height),c=f._renderEjTemplate("#"+i.templateId,i),i.width=s,i.height=h,this._renderSvgTemplate(i,r,u,c))},_fill:function(n,t){var i;return n.gradient&&(i=this._renderGradient(n.name,n.gradient,t)),i||(i=n.fillColor),i},_fillBorder:function(n,t){var i;return n.borderGradient&&(i=this._renderGradient(n.name,n.borderGradient,t)),i||(i=n.borderColor),i},_addCssClass:function(n,t){return n.cssClass&&t&&(t["class"]=t["class"]?t["class"]+" "+n.cssClass:n.cssClass),n._cssClass=n.cssClass,t},_updateCssClass:function(n,t){if((n._cssClass!=""||n._cssClass===""&&n.cssClass!=="")&&n._cssClass!==undefined&&n.cssClass!=n._cssClass){var i=t["class"];return i&&(t["class"]=i.replace(n._cssClass,"").trim()),this._addCssClass(n,t)}return t},_renderRect:function(n,i,r){var u=this._fill(n,i),h=this._fillBorder(n,i),c=n.width?n.width:n._width,l=n.height?n.height:n._height,f={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,role:"presentation",width:c,height:l,fill:u,stroke:h,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},o,e,s;n._isClassifier&&(o="ej-d-node ej-d-classifier");f["class"]=o;this._addCssClass(n,f);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",rx:n.cornerRadius,ry:n.cornerRadius,width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:n.shadow.opacity},r.appendChild(i.rect(s)));r.appendChild(i.rect(f))},_renderEllipse:function(n,i,r){var e=n.width?n.width:n._width,o=n.height?n.height:n._height,u=this._fill(n,i),c=this._fillBorder(n,i),s={id:n.name+"_shape",rx:e/2,ry:o/2,role:"presentation",cx:e/2,cy:o/2,fill:u,stroke:c,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,h;this._addCssClass(n,s);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),h={id:n.name+"_shadow",rx:n.width/2,ry:n.height/2,cx:n.width/2,cy:n.height/2,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.ellipse(h)));r.appendChild(i.ellipse(s))},_renderImage:function(n,i,r){var l=n.fillColor,a=this._renderBackgroundRect(n,i,r),o=n.width?n.width:n._width,s=n.height?n.height:n._height,h=t.datavisualization.Diagram.Util._getImageAlignment(n.contentAlignment),c=n.scale=="none"?"meet":n.scale,f={id:n.name+"_shape",opacity:n.opacity,preserveAspectRatio:c!="stretch"&&h!="none"?h+" "+c:"none",width:o,height:s,role:"img"},u=new Image,e;u.src=n.source;n.scale=="none"&&(f.width=u.width||o,f.height=u.height||s);e=i.image(f);e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u.src);r.appendChild(e)},_renderPolygon:function(n,i,r){var u=this._fill(n,i),h=this._fillBorder(n,i),f,e,o,s;t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);f=this._convertToSVGPoints(n.points);e={id:n.name+"_shape",fill:u,stroke:h,role:"presentation","stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,points:f};this._addCssClass(n,e);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",points:f,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:n.shadow.opacity},r.appendChild(i.polygon(s)));r.appendChild(i.polygon(e))},_renderPath:function(n,i,r){var e=this._fill(n,i),h=this._fillBorder(n,i),c=n.width?n.width:n._width,l=n.height?n.height:n._height,u,f,o,s;n._absolutePath=n._preventStretch||n._polyline?u=n.pathData:u=t.datavisualization.Diagram.Geometry.updatePath(0,0,c,l,n.pathData,i,null,n);f={id:n.name+"_shape",d:u,opacity:n.opacity,role:"presentation","stroke-dasharray":n.borderDashArray,stroke:h,"stroke-width":n.borderWidth,fill:e};n._isClassifier&&(f["class"]="ej-d-node ej-d-classifier");this._addCssClass(n,f);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",width:n.width,height:n.height,d:u,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:e!="none"||e!="transparent"?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:n.shadow.opacity},r.appendChild(i.path(s)));r.appendChild(i.path(f))},_renderHtmlElement:function(i,r,u,f){var d=this._renderBackgroundRect(i,r,u),c,o,h,l,y,s,p,w,e;if(!i.segments&&i.templateId){e=r.document.parentNode.getElementsByClassName("htmlLayer")[0];c=n(e).children("#"+i.name+"_parentdiv")[0];c&&e.removeChild(c);var a=i.width?i.width:i._width,v=i.height?i.height:i._height,b=i.offsetX-a*i.pivot.x,k=i.offsetY-v*i.pivot.y,o=r.document.getElementById(i.name+"_html");o||(o=document.createElement("div"));h="width:"+a+"px;height:"+v+"px;padding:1px; left:"+b+"px; top:"+k+"px;position:absolute;";h+="display: block; border:0px; pointer-events: all; opacity:"+i.opacity+";";h+="transform:rotate("+i.rotateAngle+"deg)";l={id:i.name+"_html","class":"foreignObject",style:h};this._addCssClass(i,l);t.datavisualization.Diagram.Util.attr(o,l);!i.segments&&i.templateId&&(y=this._renderHTMLTemplate(i,f),o.innerHTML=y);s=document.createElement("div");p={id:i.name+"_parentdiv","class":"ej-d-node"};t.datavisualization.Diagram.Util.attr(s,p);s.appendChild(o);w=i.visible?"visible":"hidden";s.style.visibility=w;e=r.document.parentNode.getElementsByClassName("htmlLayer")[0];e?e.appendChild(s):r.document.parentNode.appendChild(o)}},_initializeGuidelines:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderSideAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderCenterAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderSpacingLines:function(n,t,i,r,u){var e,o,f,s;i&&(f=r.g({}),n.x==t.x?(e="M"+(n.x*u-5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u+5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u+5)+" "+(t.y*u-5)+"z",f.appendChild(r.line({x1:n.x*u-8,x2:n.x*u+8,y1:n.y*u-1,y2:n.y*u-1,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u-8,x2:t.x*u+8,y1:t.y*u+1,y2:t.y*u+1,stroke:"#07EDE1","stroke-width":1}))):(e="M"+(n.x*u+5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u-5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u-5)+" "+(t.y*u+5)+"z",f.appendChild(r.line({x1:n.x*u-1,x2:n.x*u-1,y1:n.y*u-8,y2:n.y*u+8,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u+1,x2:t.x*u+1,y1:t.y*u-8,y2:t.y*u+8,stroke:"#07EDE1","stroke-width":1}))),f.appendChild(r.path({d:e,fill:"#07EDE1"})),s=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":.6,fill:"#07EDE1"}),f.appendChild(s),f.appendChild(r.path({d:o,fill:"#07EDE1"})),i.appendChild(f))},_removeGuidelines:function(n,t){t!=null&&n.removeChild(t)},update:function(n,t){t&&!t._isInit&&n._status!=="new"&&(n._status="update");var i=t._svg;n._type==="group"?this.updateGroup(n,i,t):n.segments?this.updateConnector(n,i,t):this.updateNode(n,i,t)},_updateGoupBackground:function(n,i,r){var u=n.offsetX-n.width*n.pivot.x,f=n.offsetY-n.height*n.pivot.y,y=n.rotateAngle,c=new t.datavisualization.Diagram.Point(u+n.width*n.pivot.x,f+n.height*n.pivot.y),l=n.fillColor,a=n.borderColor,p=t.datavisualization.Diagram.NodeConstraints,e,s,h,v,o;(n.type=="bpmn"&&n.shape!="group"||n.classifier&&n.classifier=="package")&&(l="transparent",a="transparent");t.datavisualization.Diagram.Util.canCrispEdges(n,r)&&(u=Math.floor(u)+.5,f=Math.floor(f)+.5);e={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:Math.round(n.width<0?0:n.width),height:Math.round(n.height<0?0:n.height),fill:l,stroke:a,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+y+","+c.x+","+c.y+"),translate("+u+","+f+")"};n.shape==="group"&&n.constraints&p.Shadow&&(s=i.document.getElementById(n.name+"_shadow"),h=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),u=n.offsetX-n.width*n.pivot.x+h.x,f=n.offsetY-n.height*n.pivot.y+h.y,v={id:n.name+"_shadow",width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",transform:"translate("+u+","+f+")",opacity:n.shadow.opacity,"stroke-dasharray":""},s&&t.datavisualization.Diagram.Util.attr(s,v));n.gradient&&n.type!="bpmn"&&(e.fill=this._renderGradient(n.name,n.gradient,i));o=i.getElementById(n.name+"_shape");o&&(e["class"]=o.getAttribute("class"),this._updateCssClass(n,e),t.datavisualization.Diagram.Util.attr(o,e))},updateGroup:function(i,r,u,f,e){var y=u._getChildren(i.children),p=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",u)?"visible":"hidden",l="display:block;",a,w,o,s,h,c,v;for(i.visible||(l="display:none;"),t.datavisualization.Diagram.Util.canEnablePointerEvents(i,u)||(l="pointer-events:none"),r.g({id:i.name,visibility:p,style:l}),a=0,w=y.length;a<w;a++)o=u.nameTable[y[a]],o&&(o._type==="group"?this.updateGroup(o,r,u,f,e):o.segments?(t.datavisualization.Diagram.Util.updateBridging(o,u),this.updateConnector(o,r,u,e)):(this.updateNode(o,r,u,f,e),o._isService&&(s=n.extend(!0,{},o),s.name=o.name+"service",s.offsetX=o.offsetX+7,s.offsetY=o.offsetY+5,this.updateNode(s,r,u,f,e))));if(r.g({id:i.name,visibility:p,style:l}),this._updateGoupBackground(i,r,u),this._updateAssociatedConnector(i,r,u),this._updateLabels(i,r,u,e),this._updatePorts(i,u._adornerSvg&&!e?u._adornerSvg:r,u,e),i.isSwimlane&&(h=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(u,i),c=null,h&&h.length>0))for(v=0;v<h.length;v++)c=u.nameTable[u._getChild(h[v])],c&&this._updatephase(c,u,i),this._updatePhaseStyle(c,{},u)},_removephases:function(n,i){var r,u,f;if(n.isSwimlane&&(r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(i,n),r))for(u=r.length;u>=0;u--)f=i.nameTable[i._getChild(r[u])],this._removePhase(i,f)},_removePhase:function(n,t){t&&n._views.forEach(function(i){var u=n._views[i],f=u.svg||u._canvas,r=f.document.getElementById(t.name+"_phase_g");r&&r.parentNode.removeChild(r)})},_updatePhaseStyle:function(n,i,r){if(n&&i){var u=n.visible&&t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",r)?"visible":"hidden";r._svg.g({id:n.name+"_phase_g",visibility:u});i.id=n.name+"_phase";r._svg.g(i)}},_updatephase:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context._updatephase1(n,t,u,i)})},_updatephase1:function(i,r,u,f){var l,o;if(u=u?u:r._svg,f){var s=0,h=0,a=null,c=[],v,e=t.datavisualization.Diagram.Util.bounds(f),y=r._getChildren(f.children);y.length>1&&(l=r.nameTable[y[0]]);var p=e.top+50,w=e.left+50;i.orientation=="vertical"?(s=e.x,h=e.y+l.height+i.offset,l&&(p+=l.height),h-.1<=e.bottom&&h-.1>=p&&(a="translate("+s+","+h+")"),c.push({x:0,y:0}),c.push({x:e.width,y:0}),v=this._convertToSVGPoints(c)):(s=e.x+i.offset,h=e.y,s-.1<=e.right&&s-.1>w&&(a="translate("+s+","+h+")"),l&&(c.push({x:0,y:l.height}),c.push({x:0,y:e.height})),v=this._convertToSVGPoints(c));o={points:v,id:i.name+"_phase"};u.polyline(o);o={points:v,id:i.name+"_phase_hitTest"};u.polyline(o);a&&(o={id:i.name+"_phase_g",transform:a});i.label&&r.model.labelRenderingMode!=t.datavisualization.Diagram.LabelRenderingMode.Svg&&this._updatePhaseLabel(i,i.label,r);u.g(o);u.getElementById(o.id)&&n("#"+o.id).insertAfter(n("#"+o.id)[0].parentNode.lastChild)}},_updatePhaseLabel:function(n,i,r){var f=r._svg,e=r._getPhaseBounds(n),u=f.getElementById(n.name+"_"+i.name);if(u){if(u.setAttribute("fill",i.fontColor),!i.text)return;u.textContent=i.text;e=t.datavisualization.Diagram.Util.bounds(n);this._wrapText(n,e,u,i,f);this._alignTextOnPhase(n,e,u,i,f)}},updateLabelStyle:function(i,r,u,f){var o,s,e;r.templateId?f&&f.model.labelRenderingMode!==t.datavisualization.Diagram.LabelRenderingMode.Svg&&(s=u.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(s).find("#"+i.name+"_"+r.name)[0],i&&e&&r&&(e.style.opacity=r.opacity,e.style.visibility=r.visible?"":"hidden")):f&&f.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg?(o={id:i.name+"_"+r.name+"_lblbg",fill:i._isHeader?"transparent":r.fillColor,stroke:i._isHeader?"transparent":r.borderColor,"stroke-width":r.borderWidth,"pointer-events":"none",visibility:r.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",f)?"visible":"hidden","fill-opacity":r.opacity,"stroke-opacity":r.opacity},u.rect(o),o={id:i.name+"_"+r.name,"class":"ej-d-label","font-family":r.fontFamily,"font-size":r.fontSize,fill:r.fontColor,"text-decoration":r.textDecoration,"font-weight":r.bold?"bold":"normal","font-style":r.italic?"italic":"normal",visibility:r.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",f)?"visible":"hidden","fill-opacity":r.opacity,"stroke-opacity":r.opacity},e=u.text(o),o["class"]=e.getAttribute("class"),this._updateCssClass(r,o),t.datavisualization.Diagram.Util.attr(e,o)):(s=u.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(s).find("#"+i.name+"_"+r.name)[0],i&&e&&r&&!r.templateId&&(e.style.fontWeight=r.bold?"bold":"",e.style.fontStyle=r.italic?"italic":"",e.style.visibility=r.visible?"":"hidden",e.style.opacity=r.opacity,e.style.textDecoration=r.textDecoration,e.style.fontFamily=r.fontFamily,e.style.fontSize=r.fontSize+"px",e.style.color=r.fontColor,e.style.backgroundColor=r.fillColor,e.style.borderColor=r.borderColor,e.style.borderWidth=r.borderWidth+"px",e.style.borderStyle="solid",i._isHeader&&(e.style.borderWidth="0px",e.style.backgroundColor="transparent"),o=this._updateCssClass(r,{"class":e.className}),o&&(e.className=o["class"])))},updatePort:function(n,i,r,u){var f=r.getElementById(n.name+"_"+i.name),e;f&&(f&&f.parentNode&&f.parentNode.removeChild(f),e=r.getElementById(n.name+"_ej_ports"),f=t.datavisualization.Diagram.SvgContext._renderPort(n,i,u._adornerSvg,u),e.appendChild(f))},_updateNodeStyle:function(i,r){var u,o,s,f,e;i&&r&&(u={},u.opacity=i.opacity,u.fill=i.fillColor,u.stroke=i.borderColor,u["stroke-width"]=i.borderWidth,u["stroke-dasharray"]=i.borderDashArray,i.gradient&&(u.fill=this._renderGradient(i.name,i.gradient,r)),i.borderGradient&&(u.stroke=this._renderGradient(i.name,i.borderGradient,r)),i._type=="node"&&(o=i.type=="text"||i.type=="html"?"_backRect":"_shape",i.type=="html"&&(s=r.document.parentNode.getElementsByClassName("htmlLayer")[0],f=n(s).children("#"+i.name+"_parentdiv")[0].childNodes[0],f&&(f.style.opacity=i.opacity)),f=r.getElementById(i.name+o),f&&(u["class"]=f.getAttribute("class"),this._updateCssClass(i,u),t.datavisualization.Diagram.Util.attr(f,u)),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=r.document.getElementById(i.name+"_shadow"),e&&t.datavisualization.Diagram.Util.attr(e,{fill:i.fillColor!="none"||i.fillColor!="transparent"?"lightgrey":"none"}))))},_updateConnectorStyle:function(n,i){var r,u;n&&i&&(r={},r.opacity=n.opacity,r.stroke=n.lineColor,r["stroke-width"]=n.lineWidth,r["stroke-dasharray"]=n.lineDashArray,u=i.getElementById(n.name+"_segments"),u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n,r),t.datavisualization.Diagram.Util.attr(u,r)))},updateTargetDecoratorStyle:function(n,i){var r,u;i&&(r={},r.stroke=n.targetDecorator.borderColor,r.fill=n.targetDecorator.fillColor,u=i.getElementById(n.name+"_targetDecorator"),u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n.targetDecorator,r),t.datavisualization.Diagram.Util.attr(u,r)))},updateSourceDecoratorStyle:function(n,i){var r,u;i&&(r={},r.stroke=n.sourceDecorator.borderColor,r.fill=n.sourceDecorator.fillColor,u=i.getElementById(n.name+"_sourceDecorator"),u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n.sourceDecorator,r),t.datavisualization.Diagram.Util.attr(u,r)))},updateNode:function(n,t,i,r,u){if(t){if(i&&!i._isInit&&n._status!=="new"&&(n._status="update"),this._updateLabels(n,t,i,u),this._updateNode(n,t,i),n.outEdges.length&&this._updateIcons(n,t,i),n._scaled=!1,this._updatePorts(n,i._adornerSvg&&!u?i._adornerSvg:t,i,u),i._layoutInAction)return;this._updateAssociatedConnector(n,t,i)}},updateTextBlock:function(i,r,u,f){if(f&&f.model.labelRenderingMode!==t.datavisualization.Diagram.LabelRenderingMode.Svg){var o=u.document.parentNode.getElementsByClassName("htmlLayer")[0],s=n(o).children("#"+i.name+"_label")[0],h=n(s).children("#"+i.name+"_shape_lblbg")[0],e=h.childNodes[0];i&&e&&r&&(e.style.fontWeight=r.bold?"bold":"",e.style.fontStyle=r.italic?"italic":"",e.style.textDecoration=r.textDecoration,e.style.fontFamily=r.fontFamily,e.style.fontSize=r.fontSize+"px",e.style.color=r.fontColor)}this._updateTextElement(i,u,f)},_updateAssociatedConnector:function(n,i,r){var u,f;if(!r._associatedConnectorsUpdate){if(n.inEdges&&n.inEdges.length>0)for(u=0,f=n.inEdges.length;u<f;u++)r.nameTable[n.inEdges[u]]&&(r.nameTable[n.inEdges[u]]&&t.datavisualization.Diagram.Util.canBridge(r.nameTable[n.inEdges[u]],r)&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.inEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.inEdges[u]])),r._disableSegmentChange||t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.inEdges[u]],r));if(n.outEdges&&n.outEdges.length>0)for(u=0,f=n.outEdges.length;u<f;u++)r.nameTable[n.outEdges[u]]&&(r.nameTable[n.outEdges[u]]&&t.datavisualization.Diagram.Util.canBridge(r.nameTable[n.outEdges[u]],r)&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.outEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.outEdges[u]])),r._disableSegmentChange||t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.outEdges[u]],r))}},_updateNode:function(i,r,u){var e=i.width?i.width:i._width,o=i.height?i.height:i._height,l=i.offsetX-e*i.pivot.x,a=i.offsetY-o*i.pivot.y,y=i.rotateAngle,c=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),d=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",u)?"visible":"hidden",v,p,w,s,h,f;t.datavisualization.Diagram.Util.canCrispEdges(i,u)&&(l=Math.floor(l)+.5,a=Math.floor(a)+.5);f={id:i.name,transform:"rotate("+y+","+c.x+","+c.y+"),translate("+l+","+a+")",visibility:d};f.style=t.datavisualization.Diagram.Util.canEnablePointerEvents(i,u)?"":"pointer-events:none";v=i.flip!=="none"?i.flip:i._flip;v&&v!==t.datavisualization.Diagram.FlipDirection.None&&(p=this.renderflipElement(i,u),p&&(f.transform="rotate("+y+","+c.x+","+c.y+")"+this.renderflipElement(i,u)));r.g(f);w=i._shape?i._shape:i.type;switch(w){case"rectangle":r.rect({id:i.name+"_shape",width:e<0?0:e,height:o<0?0:o});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"ellipse":r.ellipse({id:i.name+"_shape",rx:e/2,ry:o/2,cx:e/2,cy:o/2});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.ellipse({id:i.name+"_shadow",rx:i.width/2,ry:i.height/2,cx:i.width/2,cy:i.height/2});break;case"image":this._updateBackgroundRect(i,r);var b=t.datavisualization.Diagram.Util._getImageAlignment(i.contentAlignment),k=i.scale=="none"?"meet":i.scale,f={id:i.name+"_shape",preserveAspectRatio:k!="stretch"&&b!="none"?b+" "+k:"none"};i.scale!="none"&&(f.width=e,f.height=o);r.image(f);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"path":i._preventStretch?s=i._absolutePath=i.pathData:i._scaled||!i._absolutePath?(s=t.datavisualization.Diagram.Geometry.updatePath(0,0,e,o,i.pathData,r,i._absoluteBounds),i._absolutePath=s,i._scaled=!1):s=i._absolutePath;r.path({id:i.name+"_shape",d:s});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.path({id:i.name+"_shadow",d:s});break;case"polygon":this._updatePolygon(i,r);break;case"text":this._updateTextElement(i,r,u);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"html":this._updateHtmlElement(i,r,u);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"native":h=this._scaleNodeContent(i,n("#"+i.name+"_shape")[0]);f={id:i.name+"_shape"};i.width&&(f.width=i.width);i.height&&(f.height=i.height);h&&(f.transform="translate("+h.x+","+h.y+"),scale("+h.sx+","+h.sy+")");r.g(f);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height})}},_updateHtmlElement:function(i,r,u){this._updateBackgroundRect(i,r);var o=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",u)?"visible":"hidden",s=i.width?i.width:i._width,h=i.height?i.height:i._height,c=i.offsetX-s*i.pivot.x,l=i.offsetY-h*i.pivot.y,f,a=r.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(a).children("#"+i.name+"_parentdiv");e&&(f=n(e).children("#"+i.name+"_html")[0],f&&(f.style.left=c+"px",f.style.top=l+"px",f.style.webkitTransform="rotate("+i.rotateAngle+"deg)",f.style.MozTransform="rotate("+i.rotateAngle+"deg)",f.style.OTransform="rotate("+i.rotateAngle+"deg)",f.style.msTransform="rotate("+i.rotateAngle+"deg)",f.style.transform="rotate("+i.rotateAngle+"deg)",f.style.opacity=i.opacity,f.style.visibility=o));f&&(f.style.width=i.width.toString()+"px",f.style.height=i.height.toString()+"px")},_updatePolygon:function(n,i){t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);i.polygon({id:n.name+"_shape",points:this._convertToSVGPoints(n.points)});n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&i.polygon({id:n.name+"_shadow",points:this._convertToSVGPoints(n.points)})},_convertToSVGPoints:function(n){for(var i="",t=0,r=n.length;t<r;t++)i+=n[t].x+","+n[t].y+" ";return i.trim()},_renderTextElement:function(i,r,u,f){var o,c,l,s,a,e,p;if(f.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){this._renderBackgroundRect(i,r,u);var h=i.textBlock,w=r.getElementById(i.name),b={id:i.name+"_shape_lblbg","class":"ej-d-label","font-family":h.fontFamily,"font-size":h.fontSize,fill:h.fontColor,"text-decoration":h.textDecoration,"font-weight":h.bold?"bold":"normal","font-style":h.italic?"italic":"normal"},o=r.text(b);w.appendChild(o);this._renderLabelSpanElement(o,i,h,r,f,!1)}else if(o=i.textBlock,o){c=r.document.parentNode.getElementsByClassName("htmlLayer")[0];this._renderBackgroundRect(i,r,u);l=document.createElement("div");s=document.createElement("span");t.datavisualization.Diagram.Util.attr(s,{id:i.name+"_label_lblbg","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal; alignment-baseline:middle"});o.bold&&(s.style.fontWeight="bold");o.italic&&(s.style.fontStyle="italic");s.style.textDecoration=o.textDecoration;s.style.fontFamily=o.fontFamily;s.style.fontSize=o.fontSize+"px";s.style.color=o.fontColor;s.textContent=o.text;a="display: inline-block; position: absolute; width: inherit; height: inherit; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(l,{id:i.name+"_shape_lblbg",style:a});l.appendChild(s);e=n(c).children("#"+i.name+"_label")[0];e&&c.removeChild(e);e=document.createElement("div");var v=i.width?i.width:i._width,y=i.height?i.height:i._height,k=i.offsetX-v*i.pivot.x,d=i.offsetY-y*i.pivot.y,a="width:"+v+"px; height:"+y+"px; left:"+k+"px; top:"+d+"px; display: block; position: absolute; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(e,{id:i.name+"_label","class":"ej-d-node",style:a});e.style.webkitTransform="rotate("+i.rotateAngle+"deg) ";e.style.MozTransform="rotate("+i.rotateAngle+"deg) ";e.style.OTransform="rotate("+i.rotateAngle+"deg) ";e.style.msTransform="rotate("+i.rotateAngle+"deg)";e.style.transform="rotate("+i.rotateAngle+"deg) ";e.appendChild(l);c&&c.appendChild(e);p=t.datavisualization.Diagram.Util.bounds(i);this._alignTextOnLabel(i,p,s,l,i.textBlock)}},_updateTextElement:function(i,r,u){var s,o,c;if(u.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){this._updateBackgroundRect(i,r);var e=i.textBlock,b=r.getElementById(i.name),p={id:i.name+"_shape_lblbg","class":"ej-d-label","font-family":e.fontFamily,"font-size":e.fontSize,fill:e.fontColor,"text-decoration":e.textDecoration,"font-weight":e.bold?"bold":"normal","font-style":e.italic?"italic":"normal"},k=r.text(p);this._updateLabelSpanElement(i,e,r,u,!1)}else if(this._updateBackgroundRect(i,r),s=r.document.parentNode.getElementsByClassName("htmlLayer")[0],s){var f=this._findChild(s.childNodes,i),w=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",u)?"visible":"hidden",h=t.datavisualization.Diagram.Util.bounds(i),l,a,v,y;f&&(l=h.width,a=h.height,v=i.offsetX-i.width*i.pivot.x,y=i.offsetY-i.height*i.pivot.y,f.style.width=l+"px",f.style.height=a+"px",f.style.left=v+"px",f.style.top=y+"px",f.style.visibility=w,f.style.webkitTransform="rotate("+i.rotateAngle+"deg)",f.style.MozTransform="rotate("+i.rotateAngle+"deg)",f.style.OTransform="rotate("+i.rotateAngle+"deg)",f.style.msTransform="rotate("+i.rotateAngle+"deg)",f.style.transform="rotate("+i.rotateAngle+"deg)");o=n(f).children("#"+i.name+"_shape_lblbg")[0];o&&(c=o.childNodes[0],c.textContent=i.textBlock.text,this._alignTextOnLabel(i,h,c,o,i.textBlock,u))}},_renderBackgroundRect:function(n,i,r){var u=this._fill(n,i),s=this._fillBorder(n,i),e={id:n.name+"_backRect","class":"backrect",x:0,y:0,width:n.width,height:n.height,fill:u,stroke:s,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,o;this._addCssClass(n,e);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),o={id:n.name+"_shadow","class":"backrect",width:n.width,height:n.height,stroke:"lightgrey",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.rect(o)));r.appendChild(i.rect(e))},_updateBackgroundRect:function(n,t){var i=this._fill(n,t),r=this._fillBorder(n,t),u={id:n.name+"_backRect",x:0,y:0,width:n.width,height:n.height,fill:i,stroke:r,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,"class":n.cssClass};t.rect(u)},_hideNode:function(n,t){var i={id:n.name,style:"pointer-events:none;"};t.rect(i)},_showNode:function(n,t){var i={id:n.name,style:"pointer-events:auto;"};t.rect(i)},_removePhasehelper:function(n){n._adornerSvg.getElementById("phase_helper")&&n._adornerSvg.removeChild(n._adornerSvg.getElementById("phase_helper"),n._adornerLayer)},_updatePhaseHelper:function(n,t,i){if(t){var f=n._adornerSvg,r=n._currZoom,u;i.width=i.width<0?1:i.width;i.height=i.height<0?1:i.height;u={id:"phase_helper","class":"helper","pointer-events":"none",width:i.width*r,height:i.height*r};n._adornerSvg.rect(u)}},_phasehelper:function(n,t,i){if(t){var u=n._adornerSvg,r=n._currZoom,f=i.x+i.width/2,e=i.y+i.height/2,o=u.rect({id:"phase_helper","class":"helper","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:i.width*r,height:i.height*r,fill:"transparent",stroke:"green",transform:"translate("+(f-i.width/2)*r+","+(e-i.height/2)*r+"),rotate(0,"+i.width/2*r+","+i.height/2*r+")"});n._adornerLayer.appendChild(o)}},_drawContainerHelper:function(n){var i=n.activeTool.helper,c=n._adornerSvg,u=n._currZoom,r,f,e,o,s,h;i&&(r=t.datavisualization.Diagram.Util.bounds(i,!0));f=r.height;e=r.width;o=i.pivot?{x:r.width*i.pivot.x,y:r.height*i.pivot.y}:{x:e/2,y:f/2};s=i.rotateAngle?i.rotateAngle:0;h=c.rect({id:"helper","class":"helper","stroke-width":1,"stroke-dasharray":"3,3","pointer-events":"none",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+r.x*u+","+r.y*u+"),rotate("+s+","+o.x*u+","+o.y*u+")"});n._adornerLayer.appendChild(h)},_updateContainerHelper:function(n){var s,i=n.activeTool.helper,u=n._currZoom,r,f,e,o,h;i&&(r=t.datavisualization.Diagram.Util.bounds(i,!0));f=r.height;e=r.width;o=i.pivot?{x:r.width*i.pivot.x,y:r.height*i.pivot.y}:{x:e/2,y:f/2};n._raiseOffsetPropertyChange(i,r.center.x,r.center.y,!0);n._raiseSizePropertyChange(i,r.width/i.width,r.height/i.height,!0);h=i.rotateAngle?i.rotateAngle:0;s={id:"helper","class":"helper",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+r.x*u+","+r.y*u+"),rotate("+h+","+o.x*u+","+o.y*u+")"};n._adornerSvg.rect(s)},_removeContainerHelper:function(n,t,i){t.getElementById("helper")&&t.removeChild(t.getElementById("helper"),i)},setNodeShape:function(t,i,r,u){var f,e;r?(e=i.getElementById(r.name),f=n(e).find("#"+t.name)[0]):f=i.getElementById(t.name);f&&(n(f).empty(),this._renderNode(t,i,f,u))},setLine:function(t,i,r,u){var f,e;r?(e=i.getElementById(r.name),f=n(e).find("#"+t.name)[0]):f=i.getElementById(t.name);n(f).empty();this.renderConnector(t,i,f,u)},addNodeLabel:function(n,t,i,r,u){this._renderLabels(n,i,u)},renderConnector:function(n,i,r,u){var f,o,h=n.visible&&t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",u)?"visible":"hidden",s,e;if(o=t.datavisualization.Diagram.Util.canCrispEdges(n,u)?{id:n.name,"class":"ej-d-connector",visibility:h,opacity:n.opacity,transform:"translate("+.5+","+.5+")"}:{id:n.name,"class":"ej-d-connector",visibility:h,opacity:n.opacity},t.datavisualization.Diagram.Util.canEnablePointerEvents(n,u)||(o.style="pointer-events:none"),f=i.g(o),r?r.id!==f.id&&r.appendChild(f):i.appendChild(f),s=i.g({id:n.name+"segments"}),this._renderSegments(n,i,s,u),f.appendChild(s),this._renderLabels(n,i,u),this._renderDecorators(n,i,f,u),n.shape)for(t.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(n,u),e=0;e<n._inlineDecorators.length;e++)this.renderNode(n._inlineDecorators[e],i,f,undefined,u);return f},_renderSegments:function(n,i,r,u){var h=n.visible&&(u&&u._browserInfo?u._browserInfo.name:t.browserInfo().name)==="msie"?"collapse":"hidden",o=this._findPath(n,u),f={id:n.name+"_hitTest","class":"hitTest","stroke-width":n.lineHitPadding,d:o,stroke:"transparent",visibility:"hidden"},e,s;f["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,u)?n.visible?"stroke":"none":"none";e=i.path(f);r.appendChild(e);f={id:n.name+"_segments",d:o,fill:"none",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,opacity:n.opacity};this._addCssClass(n,f);e=i.path(f);r.appendChild(e);n.shape&&n.shape.type=="umlactivity"&&n.shape.activityFlow=="exception"&&(f={id:n.name+"_Activityflow","class":"umlactivityflow",fill:"none",stroke:n.lineColor,"pointer-events":"none","stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,opacity:n.opacity,d:n._temppath},s=i.path(f),this._addCssClass(n,f),r.appendChild(s))},_findPath:function(n,i){for(var r,k,nt,u,y,c,g,b,w,f,l,tt,a,v,e,s=0;s<n.segments.length;s++){if(r=n.segments[s],r._bridges.length>0)for(k=0;k<r._bridges.length;k++)nt=r._bridges[k],nt._rendered=!1;if(u=r.points,n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&s==0){y={x:r.points[0].x,y:r.points[0].y};c=t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]);c=Math.min(30,c/2);var p=t.datavisualization.Diagram.Geometry.findAngle(r.points[0],r.points[1]),d=t.datavisualization.Diagram.Geometry.transform({x:y.x,y:y.y},p,c),o=t.datavisualization.Diagram.Geometry.transform({x:d.x,y:d.y},p+45,-12),h=t.datavisualization.Diagram.Geometry.transform({x:o.x,y:o.y},p+45,24);g=t.datavisualization.Diagram.Util.canCrispEdges(n,i)?"M"+Math.floor(o.x)+" "+Math.floor(o.y)+" L"+Math.floor(h.x)+" "+Math.floor(h.y):"M"+o.x+" "+o.y+" L"+h.x+" "+h.y}if(n.shape&&n.shape.type=="umlactivity"&&n.shape.activityFlow=="exception"&&s==0){y={x:r.points[0].x,y:r.points[0].y};c=t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]);c=Math.max(30,c/2);var p=t.datavisualization.Diagram.Geometry.findAngle(r.points[0],r.points[1]),d=t.datavisualization.Diagram.Geometry.transform({x:y.x,y:y.y},p,c),o=t.datavisualization.Diagram.Geometry.transform({x:d.x,y:d.y},p+145,9),h=t.datavisualization.Diagram.Geometry.transform({x:o.x,y:o.y},p+225,14);g=t.datavisualization.Diagram.Util.canCrispEdges(n,i)?"M"+Math.floor(o.x)+" "+Math.floor(o.y)+" L"+Math.floor(h.x)+" "+Math.floor(h.y):"M"+h.x+" "+o.y+"L"+h.x+" "+h.y+" L"+o.x+" "+o.y+" L"+o.x+" "+h.y}if(s==0&&(i&&n.sourceNode&&(b=i._findNode(n.sourceNode)),u=this._clipDecorators(n,r,!0,b),r.type=="bezier"&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u[0]=t.datavisualization.Diagram.Util._adjustPoint(u[0],r._point1,!0,n.lineWidth)),e=t.datavisualization.Diagram.Util.canCrispEdges(n,i)?"M"+Math.floor(u[0].x)+" "+Math.floor(u[0].y):"M"+u[0].x+" "+u[0].y),s==n.segments.length-1&&(i&&n.targetNode&&(b=i._findNode(n.targetNode)),u=this._clipDecorators(n,r,!1,b)),r.type!="bezier")if(n.cornerRadius>0)for(f=0;f<u.length-1;f++)w=t.datavisualization.Diagram.Geometry.distance(u[f],u[f+1]),w>0&&(v=s<n.segments.length-1||f<u.length-2?w<n.cornerRadius*2?t.datavisualization.Diagram.Util._adjustPoint(u[f],u[f+1],!1,w/2):t.datavisualization.Diagram.Util._adjustPoint(u[f],u[f+1],!1,n.cornerRadius):u[f+1],(s>0||f>0)&&(w<n.cornerRadius*2?(a=t.datavisualization.Diagram.Util._adjustPoint(u[f],u[f+1],!0,w/2),(s<n.segments.length-1||f<u.length-2)&&(v=null)):a=t.datavisualization.Diagram.Util._adjustPoint(u[f],u[f+1],!0,n.cornerRadius)),a&&(e+=t.datavisualization.Diagram.Util.canCrispEdges(n,i)?" Q"+Math.floor(u[f].x)+" "+Math.floor(u[f].y)+" "+Math.floor(a.x)+" "+Math.floor(a.y):" Q"+u[f].x+" "+u[f].y+" "+a.x+" "+a.y),v&&(r._bridges.length>0&&(e=this._updateBridging(r,e,f),r.type==="orthogonal"&&(e=this._updateBridging(r,e,f+1))),e+=t.datavisualization.Diagram.Util.canCrispEdges(n,i)?" L"+Math.floor(v.x)+" "+Math.floor(v.y):" L"+v.x+" "+v.y));else for(f=0;f<u.length;f++)f>0&&(e=this._updateBridging(r,e,f)+(t.datavisualization.Diagram.Util.canCrispEdges(n,i)?" L"+Math.floor(u[f].x)+" "+Math.floor(u[f].y):" L"+u[f].x+" "+u[f].y));else l=r._endPoint,n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(l=t.datavisualization.Diagram.Util._adjustPoint(r._endPoint,r._point2,!0,n.lineWidth)),n.targetNode&&i&&(tt=i._findNode(n.targetNode),b.borderColor!="none"&&(l=t.datavisualization.Diagram.Util._adjustPoint(l,r._point2,!0,tt.borderWidth/2))),e+=t.datavisualization.Diagram.Util.canCrispEdges(n,i)?" C"+Math.floor(r._point1.x)+" "+Math.floor(r._point1.y)+" "+Math.floor(r._point2.x)+" "+Math.floor(r._point2.y)+" "+Math.floor(l.x)+" "+Math.floor(l.y):" C"+r._point1.x+" "+r._point1.y+" "+r._point2.x+" "+r._point2.y+" "+l.x+" "+l.y}return n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&(e+=g),n.shape&&n.shape.activityFlow=="exception"&&n.shape.type=="umlactivity"&&(e=e,n._temppath=g),e},_updateBridging:function(n,t,i){var f=t,u,r;if(n._bridges.length>0)if(n.type==="straight")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path);else if(n.type==="orthogonal")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r.segmentPointIndex!==i||r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path,r._rendered=!0);return f},_refreshSegments:function(n,t,i){this._updateConnector(n,t,i);this._updateDecorators(n,t,i)},_refreshOnlySegments:function(n,t,i){var u=this._findPath(n,i),r=t.document.getElementById(n.name+"_segments");r&&(r.setAttribute("d",u),r=t.document.getElementById(n.name+"_hitTest"),r.setAttribute("d",u))},_clipDecorators:function(n,i,r,u){var f=[],o,c,s,l,h,e;if(!r&&n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(e=0;e<i.points.length;e++)f[e]=i.points[e];o=f[f.length-1];c=f[f.length-2];s=t.datavisualization.Diagram.Geometry.distance(o,c);s=s==0?1:s;l=n.lineWidth;h=t.datavisualization.Diagram.Point();h.x=o.x+l*(c.x-o.x)/s;h.y=o.y+l*(c.y-o.y)/s;u&&u.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,c,!0,u.borderWidth/2));f[f.length-1]=h}else if(r&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(e=0;e<i.points.length;e++)f[e]=i.points[e];o=f[0];c=f[1];s=t.datavisualization.Diagram.Geometry.distance(o,c);s=s==0?1:s;l=n.lineWidth;h=t.datavisualization.Diagram.Point();h.x=o.x+l*(c.x-o.x)/s;h.y=o.y+l*(c.y-o.y)/s;i.type=="bezier"&&(h.x=o.x+(i._point1.x-o.x)/s,h.y=o.y+(i._point1.y-o.y)/s);u&&u.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,i.type!="bezier"?c:i._point1,!0,u.borderWidth/2));f[0]=h}else if(r){for(e=0;e<i.points.length;e++)f[e]=i.points[e];u&&u.borderColor!="none"&&(f[0]=t.datavisualization.Diagram.Util._adjustPoint(f[0],f[1],!0,u.borderWidth/2))}else{for(e=0;e<i.points.length;e++)f[e]=i.points[e];u&&u.borderColor!="none"&&(f[f.length-1]=t.datavisualization.Diagram.Util._adjustPoint(f[f.length-1],f[f.length-2],!0,u.borderWidth/2))}return f},_updateConnector:function(n,i,r){var f,u;r&&!r._isInit&&n._status!=="new"&&(n._status="update");f=this._findPath(n,r);i.path({id:n.name+"_segments",d:f});u={id:n.name+"_hitTest",d:f,"stroke-width":n.lineHitPadding};u["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,r)?n.isPhase||r.activeTool.name==="move"&&r.activeTool.inAction||r._selectedSymbol&&r.selectionList[0]&&r.selectionList[0].name==n.name?"none":n.visible?"stroke":"none":"none";i.path(u);n.shape&&n.shape.type=="umlactivity"&&n.shape.activityFlow=="exception"&&(u={id:n.name+"_Activityflow","class":"umlactivityflow",fill:"none",stroke:n.lineColor,"pointer-events":"none","stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,opacity:n.opacity,d:n._temppath},i.path(u))},updateConnector:function(n,i,r,u){var e,o,f;if(i&&(e=n.visible&&t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",r)?"visible":"hidden",o=t.datavisualization.Diagram.Util.canCrispEdges(n,r)?{id:n.name,visibility:e,opacity:n.opacity,transform:"translate("+.5+","+.5+")"}:{id:n.name,visibility:e,opacity:n.opacity},o.style=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,r)?"":"pointer-events:none",r._animatingLayout||i.g(o),this._updateConnector(n,i,r),this._updateLabels(n,i,r,u),this._updateDecorators(n,i,r),n.shape))for(t.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(n,r),f=0;f<n._inlineDecorators.length;f++)this.updateNode(n._inlineDecorators[f],i,r)},renderDecorators:function(n,t,i){var r=t.getElementById(n.name);this._renderDecorators(n,t,r,i)},clearDecorators:function(n,t,i){this._updateConnector(n,t,i);var u=t.getElementById(n.name),r=t.getElementById(n.name+"_targetDecorator");r&&t.removeChild(r,u);r=t.getElementById(n.name+"_sourceDecorator");r&&t.removeChild(r,u)},_renderDecorators:function(n,i,r,u){var e,o,s,f,h;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=n.segments[n.segments.length-1],e=f.points[f.points.length-2],o=n.targetPoint,f.type=="bezier"&&(e=f._point2),n.targetNode&&u&&(s=u._findNode(n.targetNode),s&&s.borderColor!="none"&&(o=t.datavisualization.Diagram.Util._adjustPoint(o,e,!0,s.borderWidth/2))),this._renderDecorator(n.name+"_targetDecorator",o,e,n,n.targetDecorator,i,r));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=n.segments[0],e=n.sourcePoint,o=f.points[1],f.type=="bezier"&&(o=f._point1),n.sourceNode&&u&&(h=u._findNode(n.sourceNode),h&&h.borderColor!="none"&&(e=t.datavisualization.Diagram.Util._adjustPoint(e,o,!0,h.borderWidth/2))),this._renderDecorator(n.name+"_sourceDecorator",e,o,n,n.sourceDecorator,i,r))},_renderIcons:function(n,t){var u=n.expandIcon,f=n.collapseIcon,l,i,a;if(u.shape!="none"||f.shape!="none"){var r,v=n.width?n.width:n._width||0,y=n.height?n.height:n._height||0,p=n.name,e=0,o=0,s=0,h=0,c=0,w=n.visible?"visible":"hidden";s=n.offsetX-v*n.pivot.x;h=n.offsetY-y*n.pivot.y;e=n.offsetX;o=n.offsetY;c=n.rotateAngle;l={id:p,transform:"rotate("+c+","+e+","+o+"),translate("+s+","+h+")",visibility:w};i=t._adornerSvg;r=i.g(l);a=i.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||t._expander;a.appendChild(r);u!=undefined&&n.isExpanded&&this._renderIcon(n,i,u,r,t);f==undefined||n.isExpanded||this._renderIcon(n,i,f,r,t)}},_renderIcon:function(n,i,r,u,f){var s,e,u,h,l,a,c,o;if(r!=undefined){if(e=t.datavisualization.Diagram.Util._getIconPosition(r,t.datavisualization.Diagram.Util.bounds(n,!0),!0),r.shape!="path")this._renderExpanderTemplate(n,i,r,u,f,e);else if(r.shape=="path")return u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",n.name+"_expander"),u.setAttribute("class","ej-d-icon-template"),h=t.datavisualization.Diagram.Geometry.updatePath(e.x-r.width/2,e.y-r.height/2,r.width,r.height,r.pathData,i),l=n.visible?"visible":"hidden",r._absolutePath=h,r.margin.left&&r.margin.right&&(r.width-=(r.margin.left||0)+(r.margin.right||0)),r.margin.top&&r.margin.bottom&&(r.height-=(r.margin.top||0)+(r.margin.bottom||0)),s={id:n.name+"_pathexpander",x:e.x,y:e.y,width:r.width,height:r.height,fill:r.borderColor,stroke:r.borderColor,"stroke-width":r.borderWidth,visibility:l,d:h},this._addCssClass(u,s),a=i.path(s),u.appendChild(a),u;return r.shape=="image"&&(c=new Image,c.src=r.source,o=i.image(s),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c.src),u.appendChild(o)),o}},_renderExpanderTemplate:function(n,t,i,r,u,f,e){var v=this.construct_template_iconshape(i,n.isExpanded,u),s,h,c,w,b;if(v!="undefined"){e&&r.removeChild(t.document.getElementById(n.name+"_expander"));s=document.createElement("div");s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+v+"<\/g><\/svg>";document.body.appendChild(s);h=document.getElementById("tempNative");c=h.cloneNode(!0);c.id=n.name+"_expander";var o=h.getBBox(),y=i.width,p=i.height,l=o.width?y/o.width:1,a=o.height?p/o.height:1;if(s.parentNode.removeChild(s),r.appendChild(c),w=Math.min(l,a),b=n.visible?"visible":"hidden",i.horizontalAlignment||i.verticalAlignment){var nt={x:i.offset.x,y:i.offset.y};switch(i.horizontalAlignment){case"left":f.x+=0;break;case"center":f.x-=i.width/2;break;case"right":f.x-=i.width}switch(i.verticalAlignment){case"top":f.y+=0;break;case"center":f.y-=i.height/2;break;case"bottom":f.y-=i.height}var k=f.x-o.x*l,d=f.y-o.y*a,g={id:n.name+"_expander","class":"ej-d-icon-template",transform:"translate("+k+","+d+"),scale("+l+","+a+")",x:f.x,y:f.y,width:i.width,height:i.height,fill:i.borderColor,stroke:i.borderColor,"stroke-width":i.borderWidth};t.g(g)}}},construct_template_iconshape:function(n,t,i){var r;if(n.shape){switch(n.shape){case"arrowup":r='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M8.7,7.2L8.9,7h2.2l0.2,0.2l0,0l4.8,4.8h-2.5L10,8.4L6.4,12H3.9L8.7,7.2L8.7,7.2z"/><\/path><\/rect>';break;case"arrowdown":r='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M9,12.2l0.1,0.1h1.7l0.1-0.1l0,0l3.8-3.8h-2L10,11.2L7.2,8.4h-2L9,12.2L9,12.2z"/><\/path><\/rect>';break;case"plus":r='<rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/><\/line><line style=" fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="10" y1="6.1" x2="10" y2="13.9"/><\/line><\/rect>';break;case"minus":r=' <rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/><\/line><\/rect>';break;case"template":r=i._renderEjTemplate("#"+n.templateId,n)}return r}},_updateIcons:function(n,t,i){var r=n.expandIcon,u=n.collapseIcon,l,t,w;if(r.shape!="none"||u.shape!="none"){var f,a=n.width?n.width:n._width||0,v=n.height?n.height:n._height||0,y=n.name,e=0,o=0,s=0,h=0,c=0,p=n.visible?"visible":"hidden";s=n.offsetX-a*n.pivot.x;h=n.offsetY-v*n.pivot.y;e=n.offsetX;o=n.offsetY;c=n.rotateAngle;l={id:y,transform:"rotate("+c+","+e+","+o+"),translate("+s+","+h+")",visibility:p};t=i._adornerSvg;f=t.g(l);w=t.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||i._expander;r!=undefined&&n.isExpanded&&this._updateIcon(n,i._adornerSvg,f,r,i);u==undefined||n.isExpanded||this._updateIcon(n,i._adornerSvg,f,u,i)}},_updateIcon:function(n,i,r,u,f){var o,e,s,l,h,c;u!=undefined&&(n._scaled||n._updateExpander)&&(e=t.datavisualization.Diagram.Util._getIconPosition(u,t.datavisualization.Diagram.Util.bounds(n,!0),!0),u.shape!="path"?(n._scaled||n._updateExpander)&&this._renderExpanderTemplate(n,i,u,r,f,e,!0):u.shape=="path"&&(s=t.datavisualization.Diagram.Geometry.updatePath(e.x-u.width/2,e.y-u.height/2,u.width,u.height,u.pathData,i),l=n.visible?"visible":"hidden",u._absolutePath=s,u.margin.left&&u.margin.right&&(u.width-=(u.margin.left||0)+(u.margin.right||0)),u.margin.top&&u.margin.bottom&&(u.height-=(u.margin.top||0)+(u.margin.bottom||0)),o={id:n.name+"_pathexpander",x:e.x,y:e.y,width:u.width,height:u.height,fill:u.borderColor,stroke:u.borderColor,"stroke-width":u.borderWidth,visibility:l,d:s},i.path(o)),u.shape=="image"&&(h=new Image,h.src=u.source,c=i.image(o),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),r.appendChild(c)),n._updateExpander=!1)},_renderDecorator:function(n,i,r,u,f,e,o){var c,s,l,a,h=t.datavisualization.Diagram.Size(f.width,f.height),p,w,v,y;switch(f.shape){case"arrow":l=this._constructArrow(i,h);s={id:n,"class":"decorator",d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=1.1*f.borderWidth;break;case"openarrow":l=this._constructArrow(i,h,!0);s={id:n,"class":"decorator",d:l,fill:"transparent",stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=1.1*f.borderWidth;break;case"circle":p=h.width/2;w=h.height/2;s={id:n,"class":"decorator",rx:p,ry:w,cx:i.x+h.width/2,cy:i.y,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.ellipse(s);a=.5*f.borderWidth;break;case"diamond":l=this._constructDiamond(i,h,e);s={id:n,"class":"decorator",x:i.x,y:i.y,width:h.width,height:h.height,d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=.7*f.borderWidth;break;case"path":l=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-h.height/2,h.width,h.height,f.pathData,e);f._absolutePath=l;s={id:n,"class":"decorator",x:i.x,y:i.y,width:h.width,height:h.height,d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=.5*f.borderWidth}c&&(f.borderColor!="none"?(v=t.datavisualization.Diagram.Geometry.findAngle(i,r),y=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},v,a),c.setAttribute("transform","translate("+y.x+","+y.y+"),rotate("+v+" "+i.x+" "+i.y+")")):c.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"),o.appendChild(c))},_updateDecorators:function(n,i,r){var f,e,s,u,o,h;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u=n.segments[n.segments.length-1],o=u.points,f=o[o.length-2],e=n.targetPoint,u.type=="bezier"&&(f=u._point2),n.targetNode&&r&&(s=r._findNode(n.targetNode),s&&s.borderColor!="none"&&(e=t.datavisualization.Diagram.Util._adjustPoint(n.targetPoint,f,!0,s.borderWidth/2))),this._updateDecorator(n.name+"_targetDecorator",e,f,n,n.targetDecorator,i));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u=n.segments[0],o=u.points,f=n.sourcePoint,e=o[1],u.type=="bezier"&&(e=u._point1),n.sourceNode&&r&&(h=r._findNode(n.sourceNode),h.borderColor!="none"&&(f=t.datavisualization.Diagram.Util._adjustPoint(n.sourcePoint,e,!0,h.borderWidth/2))),this._updateDecorator(n.name+"_sourceDecorator",f,e,n,n.sourceDecorator,i))},_updateDecorator:function(n,i,r,u,f,e){var c,s,h,l,o=t.datavisualization.Diagram.Size(f.width,f.height),y,p,a,v;switch(f.shape){case"arrow":h=this._constructArrow(i,o);s={id:n,d:h};c=e.path(s);l=1.1*f.borderWidth;break;case"openarrow":h=this._constructArrow(i,o,!0);s={id:n,d:h,fill:"transparent",stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=1.1*f.borderWidth;break;case"circle":y=o.width/2;p=o.height/2;s={id:n,rx:y,ry:p,cx:i.x+o.width/2,cy:i.y,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.ellipse(s);l=.5*f.borderWidth;break;case"diamond":h=this._constructDiamond(i,o,e);s={id:n,x:i.x,y:i.y,width:o.width,height:o.height,d:h,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=.7*f.borderWidth;break;case"path":h=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-o.height/2,o.width,o.height,f.pathData,e);f._absolutePath=h;s={id:n,d:h};c=e.path(s);l=.5*f.borderWidth}c&&(f.borderColor!="none"?(a=t.datavisualization.Diagram.Geometry.findAngle(i,r),v=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},a,l),c.setAttribute("transform","translate("+v.x+","+v.y+"),rotate("+a+" "+i.x+" "+i.y+")")):c.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"))},_constructArrow:function(n,i,r){var u=new t.datavisualization.Diagram.Path;return u.moveTo(n.x+i.width,n.y+i.height/2),u.lineTo(n.x,n.y),u.lineTo(n.x+i.width,n.y-i.height/2),r||u.close(),u.toString()},_constructDiamond:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x+i.width,n.y),r.lineTo(n.x+i.width/2,n.y+i.height/2),r.lineTo(n.x,n.y),r.lineTo(n.x+i.width/2,n.y-i.height/2),r.lineTo(n.x+i.width,n.y),r.toString()},_addLabel:function(i,r,u,f,e){var a,y,p,k,d,s,o,c,g,nt,w,l;if(f&&f.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){if(l=this._renderSVGLabel(i,r,u,f),e!=undefined&&e!=i.labels.length-1&&!(e>i.labels.length-1)&&(a=i.labels[e],a)){var h=f._svg.document.getElementById(i.name+"_"+a.name+"_lblbg"),b=f._svg.document.getElementById(i.name+"_"+r.name+"_lblbg"),v=f._svg.document.getElementById(i.name+"_"+r.name);h&&b&&h.parentNode.insertBefore(b,h);v&&v&&h.parentNode.insertBefore(v,h)}}else s=t.datavisualization.Diagram.Util.bounds(i),y=s.width,p=s.height,k=s.x,d=s.y,c=u.document.parentNode.getElementsByClassName("htmlLayer")[0],o=n(c).children("#"+i.name+"_label")[0],g=i._type==="node"?"ej-d-node":i._type==="group"?"ej-d-group":"ej-d-connector",o||(o=document.createElement("div"),nt="width:"+y+"px; height:"+p+"px; left:"+k+"px; top:"+d+"px; display: block; position: absolute; pointer-events: none; ; padding: inherit;",w=i._type==="node"?"ej-d-node":i._type==="group"?"ej-d-group":"ej-d-connector",i._isClassifier&&(w+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(o,{id:i.name,"class":w,style:nt}),i.rotateAngle&&(o.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",o.style.MozTransform="rotate("+i.rotateAngle+"deg) ",o.style.OTransform="rotate("+i.rotateAngle+"deg) ",o.style.msTransform="rotate("+i.rotateAngle+"deg)",o.style.transform="rotate("+i.rotateAngle+"deg) ",o.style["transform-origin"]=i.pivot.x*100+"% "+i.pivot.y*100+"%"),c&&c.appendChild(o)),t.datavisualization.Diagram.Util.attr(o,{id:i.name+"_label","class":g}),l=this._renderLabel(i,s,r,o,c,u,y,p,f),e!=undefined&&o.insertBefore(l,o.childNodes[e])},_getCharBoundsValues:function(n,t,i,r,u){var f={id:r.name+"_"+t.name+"temp","class":"ej-d-label","font-family":t.fontFamily,"font-size":t.fontSize},e=i.text(f),c,v,y,p,w,l,a;if(i.document.appendChild(e),c=i.tspan({id:r.name+"_"+t.name+"temp_snap"}),c.textContent=n,e.appendChild(c),v=e.childNodes[0].getComputedTextLength(),f["font-style"]="normal",f["font-weight"]="bold",i.text(f),y=e.childNodes[0].getComputedTextLength(),f["font-style"]="italic",f["font-weight"]="normal",i.text(f),p=e.childNodes[0].getComputedTextLength(),f["font-style"]="italic",f["font-weight"]="bold",i.text(f),w=e.childNodes[0].getComputedTextLength(),i.document.removeChild(e),n==" "){t.text&&(l=t.text[u-1]&&t.text[u-1]!="\n"?t.text[u-1]:"W",a=t.text[u+1]&&t.text[u+1]!="\n"?t.text[u+1]:"W");var o=this._getCharBoundsValues(l,t,i,r,u),s=this._getCharBoundsValues(a,t,i,r,u),h=this._getCharBoundsValues(l+" "+a,t,i,r,u);return{normal:h.normal-(o.normal+s.normal),bold:h.bold-(o.bold+s.bold),italic:h.italic-(o.italic+s.italic),boldItalic:h.boldItalic-(o.boldItalic+s.boldItalic)}}return{normal:v,bold:y,italic:p,boldItalic:w}},_updateHashTableValues:function(n,t,i,r,u){for(var e,f=0;f<n.length;f++)t[n[f]]||(e=n[f]=="\n"?"new_space_line":n[f],t[e]=this._getCharBoundsValues(n[f],i,u,r,f))},_updateHashTable:function(n,i,r,u,f){var e,o,h,s;if(n&&r&&u)if(n.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap||f)(n.text!=""||n.hyperlink!="")&&(o=n.text?n.text:n.hyperlink,e=u._labelHashTable[n.fontFamily+"_"+n.fontSize],e||(e=u._labelHashTable[n.fontFamily+"_"+n.fontSize]={}),this._updateHashTableValues(o,e,n,i,r,u));else if(n.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow&&(n.text!=""||n.hyperlink!="")){for(o=n.text?n.text:n.hyperlink,h=o.split("\n"),s=0;s<h.length;s++){var c=h[s],l=c.split(" "),e=u._labelHashTable[n.fontFamily+"_"+n.fontSize];e||(e=u._labelHashTable[n.fontFamily+"_"+n.fontSize]={});this._updateHashTableValues(l,e,n,i,r,u);this._updateHashTableValues([" "],e,n,i,r,u)}e.new_space_line=this._getCharBoundsValues(" ",n,r,i)}},_getSuitableLabelSize:function(n,t,i){if(t=t=="\n"||t==="."?"new_space_line":t,t!=""){var r=i._labelHashTable[n.fontFamily+"_"+n.fontSize][t];return n.bold&&n.italic?r.boldItalic:n.bold?r.bold:n.italic?r.italic:r.normal}return},_postionConnectorTextElement:function(n,i,r,u,f){var o=0,s=0,h=t.datavisualization.Diagram.Util.bounds(n),e=r.getBBox(),w=this._getCharBoundsValues("W",i,u,n),c=i.horizontalAlignment,l=i.verticalAlignment,p=!1,a,v,y;if(n.segments&&i.relativeMode=="segmentpath"){a=this._getConnectorHandlePosition(i,n,1,f);v=a.position;o=v.x;s=v.y;y=t.datavisualization.Diagram.Util._alignLabelOnSegments(n,i,f,a);l=y.vAlign;c=y.hAlign;p=!0;switch(c){case"left":o=0+i.margin.left;break;case"right":o=-e.width-i.margin.right;break;case"center":o=o+-e.width/2+(i.margin.left-i.margin.right);break;case"stretch":o=e.width/2}switch(l){case"top":s=0+i.margin.top;break;case"bottom":s=-e.height-i.margin.bottom;break;case"center":s=s+-e.height/2+(i.margin.top-i.margin.bottom);break;case"stretch":s=e.height/2}}else{switch(c){case"left":o=e.width/2;break;case"right":o=-e.width/2}switch(l){case"top":s=e.height/2;break;case"bottom":s=-e.height/2}n.segments&&(o+=h.left,s+=h.top);o=o+h.width*i.offset.x;s=s+h.height*i.offset.y-2}!i.relativeMode=="segmentpath"&&(o=o*(i.offset.x?i.offset.x/.5:0),s=s*(i.offset.y?i.offset.y/.5:0)+i.fontSize,o=o+(h.center.x-h.width/2),s=s+(h.center.y-h.height/2));this._updateLabelBackground(o,s+i.fontSize,e,n,i,r,u,f);n.segments&&n.segments.length>0?r.setAttribute("transform","translate("+o+","+(s-2)+") rotate("+i.rotateAngle+" "+(e.x+e.width/2)+" "+(e.y+e.height/2)+")"):r.setAttribute("transform","translate("+o+","+(s-2)+") rotate("+i.rotateAngle+" "+(e.x+e.width/2)+" "+(e.y+e.height/2)+")")},_postionNodeTextElement:function(n,i,r,u,f){var o=0,s=0,h=t.datavisualization.Diagram.Util.bounds(n),c=r.getBBox(),e=t.datavisualization.Diagram.Rectangle(c.x,c.y,c.width,c.height),a;e.height>=2&&(e.height-=2);a=this._getCharBoundsValues("W",i,u,n);switch(i.horizontalAlignment){case"left":o=0+i.margin.left;break;case"right":o=-e.width-i.margin.right;break;case"center":o=-e.width/2+(i.margin.left-i.margin.right);break;case"stretch":o=-(e.width/2)}switch(i.verticalAlignment){case"top":s=0+i.margin.top;break;case"bottom":s=-e.height-i.margin.bottom;break;case"center":s=-e.height/2+(i.margin.top-i.margin.bottom);break;case"stretch":s=-(e.height/2)}if(o=o+h.width*i.offset.x,s=s+h.height*i.offset.y-2,this._updateLabelBackground(o,s+i.fontSize,e,n,i,r,u,f),n.segments&&n.segments.length>0)r.setAttribute("transform","translate("+(h.center.x-e.width/2)+","+(h.center.y-e.height/2+i.fontSize)+")");else if(n.type==="group"||n.children&&n.children.length>0){var l=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),y=n.width?n.width:n._width,p=n.height?n.height:n._height,o=o+(n.offsetX-n.width/2),s=s+(n.offsetY-n.height/2),v=n.rotateAngle+i.rotateAngle;r.setAttribute("transform","rotate("+v+","+l.x+","+l.y+"),translate("+o+","+s+")")}else r.setAttribute("transform","translate("+o+","+s+") rotate("+i.rotateAngle+" "+(e.x+e.width/2)+" "+(e.y+e.height/2)+")")},_postionSpanElement:function(n,t,i,r,u){for(var e,o,f=0;f<i.childNodes.length;f++)e=i.childNodes[f],e&&(o=this._getSVGTextAlignPosition(e,n,t,i,r,u),e.setAttribute("x",o.x))},_getSVGTextAlignPosition:function(n,t,i,r){var e=0,u,f;if(n&&i){u=n.getAttribute("totalWidth");u=u?Number(u):n.getComputedTextLength();f=r.getBBox();switch(i.textAlign){case"left":e=f.x;break;case"right":e=f.x+f.width-u;break;case"center":case"justify":e=f.x+f.width/2-u/2}}return{x:e,y:0}},_updateTspanElement:function(n,t,i,r,u){this._postionSpanElement(n,t,i,r,u);n.segments&&n.segments.length>0?this._postionConnectorTextElement(n,t,i,r,u):this._postionNodeTextElement(n,t,i,r,u)},_updateLabelBackground:function(i,r,u,f,e,o,s){var c=e.verticalAlignment==="stretch"?f.height-2:u.height,l=e.horizontalAlignment==="stretch"?f.width-2:u.width,v,h;if(i=e.horizontalAlignment==="stretch"?1:i,r=e.verticalAlignment==="stretch"?1:r-e.fontSize,v=n("#"+f.name+"_"+e.name+"_lblbg")[0],h={id:f.name+"_"+e.name+"_lblbg",height:c,width:l,x:i,y:r,transform:"rotate("+e.rotateAngle+" "+(i+l/2)+" "+(r+c/2)+")"},f.type==="group"||f.children&&f.children.length>0){var a=t.datavisualization.Diagram.Point(f.offsetX,f.offsetY),i=i+(f.offsetX-f.width/2),r=r+(f.offsetY-f.height/2),y=f.rotateAngle+e.rotateAngle;h.x=0;h.y=0;h.transform="rotate("+y+","+a.x+","+a.y+"),translate("+i+","+r+")"}s.rect(h)},_renderLabelSpanElement:function(n,i,r,u,f,e){var o,s;r.templateId||(this._updateHashTable(r,i,u,f),n&&n.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),r.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?this._svgTextWrapping(n,i,r,u,f,e):r.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow?this._svgWordWrapping(n,i,r,u,f,e):(o=u.tspan(),n.appendChild(o),o.setAttribute("x","0px"),o.setAttribute("y","0px"),r.textOverflow?(s=this._getLabelSize(r,i,f),this._updateOverFlowTspan(n,i,r,u,f,e,r.text,o,s)):o.textContent=r.text),this._updateTspanElement(i,r,n,u,f))},_getLabelSize:function(n,i){var r=t.datavisualization.Diagram.Util.bounds(i);return Math.max(n.width,r.width)},_svgTextWrapping:function(n,i,r,u,f){var v=t.datavisualization.Diagram.Util.bounds(i),c=r.fontSize+2,e=u.tspan(),h,o,l,s,a;for(e.setAttribute("x","0px"),n.childNodes&&n.childNodes.length===0?e.setAttribute("dy",c-2):e.setAttribute("dy",c),n.appendChild(e),h=0,o=r.text?r.text:r.hyperlink,e.textContent+=o[0],l=this._getLabelSize(r,i,f),h+=this._getSuitableLabelSize(r,o[0],f)*(r.fontSize/r.fontSize),s=1;s<o.length;s++)if(o[s]=="\n"||h+this._getSuitableLabelSize(r,o[s],f)*(r.fontSize/r.fontSize)>=l){if(r.textOverflow)return r.overflowType=="ellipsis"&&(e.textContent=e.textContent.substr(0,e.textContent.length-3),e.textContent+="..."),!1;(textSeries.length-1>j||h>0)&&(e.setAttribute("totalWidth",h),e=u.tspan(),n.appendChild(e),a=n.getBBox(),e.setAttribute("x","0px"),e.setAttribute("y",c));o[s]!="\n"?(e.textContent+=o[s],h=this._getSuitableLabelSize(r,o[s],f)*(r.fontSize/r.fontSize)):h=0}else e.textContent+=o[s],h+=this._getSuitableLabelSize(r,o[s],f)*(r.fontSize/r.fontSize)},_updateOverFlowTspan:function(n,t,i,r,u,f,e,o,s){var l=e,h;this._updateHashTable(i,t,r,u,!0);var a=0,c="",v="",y=0;for(i.overflowType=="ellipsis"&&(y=this._getSuitableLabelSize(i,".",u)*(i.fontSize/12)*3),h=0;h<l.length;h++){if(c=l[h],a+=this._getSuitableLabelSize(i,c,u)*(i.fontSize/12),a+y>=s)break;v+=c}o.textContent=v+(i.overflowType=="ellipsis"?"...":"")},_svgWordWrapping:function(n,i,r,u,f,e){var d,h=0,w,l,a,v,y,p,b,k,c,s,o,g;for(d=t.datavisualization.Diagram.Util.bounds(i),w=r.text?r.text.split("\n"):r.hyperlink.split("\n"),l=r.fontSize+2,a=0;a<w.length;a++)if(g=n.getBBox(),o=u.tspan(),o.setAttribute("x","0px"),n.childNodes&&n.childNodes.length===0?o.setAttribute("dy",l-2):o.setAttribute("dy",l),n.appendChild(o),v=w[a],h=0,y=this._getLabelSize(r,i,f),i._isHeader&&r.rotateAngle&&(p=!1,f&&(b=f.nameTable[i.parent],b&&b.isLane&&(p=!0),k=f.nameTable[i.parent],k&&k.isPhaseStack&&!i.orientation=="vertical"&&(p=!0)),p&&(y=d.height)),v===" ")o.textContent=" ";else for(c=v.split(" "),s=0;s<c.length;s++)if(h+this._getSuitableLabelSize(r,c[s],f)*(r.fontSize/r.fontSize)>=y)if(r.textOverflow){this._updateOverFlowTspan(n,i,r,u,f,e,v,o,y);break}else(c.length-1>s||h>0)&&(o.setAttribute("totalWidth",h),o=u.tspan(),n.appendChild(o),g=n.getBBox(),o.setAttribute("x","0"),o.setAttribute("dy",l)),c[s]!="\n"?(o.textContent+=c[s],h=this._getSuitableLabelSize(r,c[s],f)*(r.fontSize/r.fontSize)):h=0;else h&&(o.textContent+=" ",h+=this._getSuitableLabelSize(r," ",f)*(r.fontSize/r.fontSize)),o.textContent+=c[s],h+=this._getSuitableLabelSize(r,c[s],f)*(r.fontSize/r.fontSize)},_renderLabelSVG:function(n,t,i,r){var e=i.getElementById(n.name),o=r._renderEjTemplate("#"+t.templateId,t),u=document.createElement("div"),f;return u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g class="ej-label-template" id='+n.name+"_"+t.name+">"+o+"<\/g><\/svg>",document.body.appendChild(u),f=document.getElementById(n.name+"_"+t.name).cloneNode(!0),e.appendChild(f),u.parentNode.removeChild(u),f},_renderSVGLabel:function(n,i,r,u,f){var h=r.getElementById(n.name),e,c,o,s;return i.templateId&&i.templateType===t.datavisualization.Diagram.TemplateType.Svg?(this._renderLabelSVG(n,i,r,u,f),this._updateSVGTemplate(n,i,r,u,f)):(e={id:n.name+"_"+i.name+"_lblbg",fill:n._isHeader?"transparent":i.fillColor,stroke:n._isHeader?"transparent":i.borderColor,"stroke-width":i.borderWidth,"pointer-events":"none",visibility:i.visible?"visible":"hidden","fill-opacity":i.opacity,"stroke-opacity":i.opacity},c=r.rect(e),h.appendChild(c),e={id:n.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.hyperlink!==""?"blue":i.fontColor,"text-decoration":i.hyperlink!==""?"underline":i.textDecoration,"font-weight":i.bold?"bold":"normal","font-style":i.italic?"italic":"normal",visibility:i.visible?"visible":"hidden","fill-opacity":i.opacity,"stroke-opacity":i.opacity},this._addCssClass(i,e),i.hyperlink?(o=document.createElementNS("http://www.w3.org/2000/svg","a"),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i.hyperlink),o.setAttribute("target","_blank"),o.setAttribute("class","ej-d-anchor"),s=r.text(e),o.appendChild(s),h.appendChild(o)):(s=r.text(e),h.appendChild(s)),this._renderLabelSpanElement(s,n,i,r,u,f)),h},_renderSVGLabels:function(n,t,i,r){var f,u;if(n.labels.length&&n.type!="text")for(f=n.labels,u=0;u<f.length;u++)this._renderSVGLabel(n,f[u],t,i,r)},_updateLabelSpanElement:function(i,r,u,f,e){var o=u.getElementById(i.name+"_"+r.name),s,h;i.textBlock&&(o=u.getElementById(i.name+"_shape_lblbg"));o&&(n(o).empty(),this._updateHashTable(r,i,u,f),r.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?this._svgTextWrapping(o,i,r,u,f,e):r.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow?this._svgWordWrapping(o,i,r,u,f,e):(s=u.tspan(),o.appendChild(s),s.setAttribute("x","0px"),s.setAttribute("y",r.fontSize),r.textOverflow?(h=this._getLabelSize(r,i,f),this._updateOverFlowTspan(o,i,r,u,f,e,r.text,s,h)):s.textContent=r.text),this._updateTspanElement(i,r,o,u,f))},_updateSVGTemplate:function(n,i,r,u){var e=0,o=0,s=t.datavisualization.Diagram.Util.bounds(n),h=r.document.getElementById(n.name+"_"+i.name),f,c,l;if(h){if(f=h.getBBox(),n.segments&&i.relativeMode=="segmentpath"){c=this._getConnectorHandlePosition(i,n,1,u);l=c.position;e=l.x;o=l.y;var a=t.datavisualization.Diagram.Util._alignLabelOnSegments(n,i,u,c),v=a.vAlign,y=a.hAlign;switch(y){case"left":e=e-f.x+i.margin.left;break;case"right":e=e-f.width-i.margin.right;break;case"stretch":case"center":e=e-f.width/2+i.margin.left-i.margin.right}switch(v){case"top":o=o-f.y+i.margin.top;break;case"bottom":o=o-f.height+i.margin.bottom;break;case"stretch":case"center":o=o-f.height/2+i.margin.top-i.margin.bottom}}else{switch(i.horizontalAlignment){case"left":e=s.width/2+i.margin.left;break;case"right":e=s.width/2-f.width;break;case"stretch":e=s.width/2-f.width/2;break;case"center":e=s.width/2-f.width/2}switch(i.verticalAlignment){case"top":o=s.height/2;break;case"bottom":o=s.height/2-f.height;break;case"stretch":o=s.height/2-f.height/2;break;case"center":o=s.height/2-f.height/2}e=e*(i.offset.x?i.offset.x/.5:0)+i.margin.left-i.margin.right;o=o*(i.offset.y?i.offset.y/.5:0)+i.margin.top-i.margin.bottom;n.segments&&(e+=s.left,o+=s.top)}h.setAttribute("transform","translate("+e+","+o+") rotate("+i.rotateAngle+" "+(f.x+f.width/2)+" "+(f.y+f.height/2)+")")}},_updateLabelTemplate:function(i,r,u,f,e){var o,s,h;if(r.templateId)if(f&&f.model.labelRenderingMode===t.datavisualization.Diagram.LabelRenderingMode.Svg)o=u.document.getElementById(i.name+"_"+r.name),o.parentNode.removeChild(o),s=this._renderLabelSVG(i,r,u,f,e),h={visibility:r.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",f)?"visible":"hidden",style:"opacity:"+r.opacity},t.datavisualization.Diagram.Util.attr(s,h);else{var c=u.document.parentNode.getElementsByClassName("htmlLayer")[0]||f._htmlLayer,l=this._findChild(c.childNodes,i),a=n(l).children("#"+i.name+"_"+r.name+"_lblbg")[0],v=f._renderEjTemplate("#"+r.templateId,r),y=a.childNodes[0];y.innerHTML=v}},_updateSVGLabel:function(n,i,r,u,f){var o,e;i.templateId?(o=document.getElementById(n.name+"_"+i.name),o&&(e={visibility:i.visible?"visible":"hidden",style:"opacity:"+i.opacity}),t.datavisualization.Diagram.Util.attr(o,e),this._updateSVGTemplate(n,i,r,u,f)):(e={id:n.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.hyperlink!==""?"blue":i.fontColor,"text-decoration":i.hyperlink!==""?"underline":i.textDecoration},r.text(e),this._updateLabelSpanElement(n,i,r,u,f))},_updateSVGLabels:function(n,t,i,r){var f,u;if(n.labels.length&&n.type!="text")for(f=n.labels,u=0;u<f.length;u++)this._updateSVGLabel(n,f[u],t,i,r)},_renderLabels:function(i,r,u,f){var o,s;if(u&&u.model.labelRenderingMode!=t.datavisualization.Diagram.LabelRenderingMode.Svg){if(i.labels.length&&i.type!="text"){var y=i.labels,h=t.datavisualization.Diagram.Util.bounds(i),c,l,a,v,e,p=!1;for(o=0;o<y.length;o++)if(i.labels[o].hyperlink)this._renderSVGLabel(i,i.labels[o],r,u,f);else{if(!p){p=!0;s=r.document.parentNode.getElementsByClassName("htmlLayer")[0];e=n(s).children("#"+i.name+"_label")[0];e&&s.removeChild(e);e=document.createElement("div");i.segments?(c=h.width,l=h.height,a=h.x,v=h.y):(c=i.width?i.width:i._width,l=i.height?i.height:i._height,a=i.offsetX-c*i.pivot.x,v=i.offsetY-l*i.pivot.y);f&&(a=0,v=0);var b=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",u)?"visible":"hidden",k="width:"+c+"px; height:"+l+"px; left:"+a+"px; top:"+v+"px; display: block; position: absolute; pointer-events: none; visibility:"+b+"; padding: inherit;",w=i._type==="node"?"ej-d-node":i._type==="group"?"ej-d-group":"ej-d-connector";i._isClassifier&&(w+=" ej-d-classifier");t.datavisualization.Diagram.Util.attr(e,{id:i.name+"_label","class":w,style:k});i.rotateAngle&&(e.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",e.style.MozTransform="rotate("+i.rotateAngle+"deg) ",e.style.OTransform="rotate("+i.rotateAngle+"deg) ",e.style.msTransform="rotate("+i.rotateAngle+"deg)",e.style.transform="rotate("+i.rotateAngle+"deg) ",e.style["transform-origin"]=i.pivot.x*100+"% "+i.pivot.y*100+"%");s&&s.appendChild(e)}this._renderLabel(i,h,y[o],e,s,r,c,l,u)}}}else this._renderSVGLabels(i,r,u,f)},_isParentVisible:function(n,t){for(var i=t.document.getElementById(n);i&&(i.getAttribute("class")!="DiagramLayer"||i.localName&&i.localName!=="svg");){if(i.localName&&i.localName!=="svg")break;if(i&&i.getAttribute("visibility")!=="visible")return!0;i=i.parentNode}},_renderLabel:function(n,i,r,u,f,e,o,s,h){var l=document.createElement("div"),c=document.createElement("span"),p,w,y,v,b,a;return r.templateId&&(p=h._renderEjTemplate("#"+r.templateId,r)),e.document&&e.document.getAttribute("class")==="overview_svg"?t.datavisualization.Diagram.Util.attr(c,this._addCssClass(r,{id:n.name+"_"+r.name,"class":"ej-d-label",style:"display: inline-block; position: absolute; line-height: normal; pointer-events: none"})):(w=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,h),y="ej-d-label",n._isClassifier&&(y+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(c,this._addCssClass(r,{id:n.name+"_"+r.name,"class":y,style:"display: inline-block; position: absolute; line-height: normal; pointer-events:"+(w?"all":"none")}))),(r.horizontalAlignment=="stretch"||r.verticalAlignment=="stretch")&&(v=this._rotateLabel(o,s,r),r.horizontalAlignment=="stretch"&&(c.style.width=Math.abs(v.x)+"px"),r.verticalAlignment=="stretch"&&(c.style.alignItems="center",c.style.display="flex",c.style.justifyContent="center",c.style.height=Math.abs(v.y)+"px"),r.textOverflow&&(c.style.display="inline-block",r.rotateAngle==0&&n._isHeader?(c.style.top=Math.abs(v.y)/2-r.fontSize/2+"px",c.style.left="0px"):n._isHeader&&(c.style.left=Math.abs(v.y)/2-r.fontSize/2+"px",c.style.top="0px"))),r.bold&&(c.style.fontWeight="bold"),r.italic&&(c.style.fontStyle="italic"),(!r.visible||this._isParentVisible(n.name,e))&&(c.style.visibility="hidden"),c.style.opacity=r.opacity,c.style.textDecoration=r.textDecoration,c.style.fontFamily=r.fontFamily,c.style.fontSize=r.fontSize+"px",c.style.color=r.fontColor,c.style.backgroundColor=r.fillColor,c.style.borderColor=r.borderColor,c.style.borderWidth=r.borderWidth+"px",n._isHeader&&(c.style.borderWidth="0px",c.style.backgroundColor="transparent"),c.style.borderStyle="solid",c.textContent=r.text,o=o>r.width?o:r.width,o-=r.padding.left+r.padding.right,s=s>r.height?s:r.height,r.margin.left&&r.margin.right&&(o-=(r.margin.left||0)+(r.margin.right||0)),r.margin.top&&r.margin.bottom&&(s-=(r.margin.top||0)+(r.margin.bottom||0)),b="display: inline-block; position: absolute; pointer-events: none; width:"+o+"px;height:"+s+"px;",t.datavisualization.Diagram.Util.attr(l,{id:n.name+"_"+r.name+"_lblbg",style:b}),r.templateId||(l.appendChild(c),u.appendChild(l),this._alignTextOnLabel(n,i,c,l,r,h,a)),r.templateId&&(a=document.createElement("div"),a.setAttribute("class","ej-label-template"),a.setAttribute("id",n.name+"_"+r.name),a.innerHTML=p,l.appendChild(a),u.appendChild(l),a.style.position="absolute",this._alignTextOnLabel(n,i,a,l,r,h)),l},_findChild:function(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i].id==t.name+"_label")return n[i]},_updateLabels:function(n,i,r,u){var f,g,nt,c,tt,l,it,p,h,e,o,k;if(r.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg)r._isSelectMode||this._updateSVGLabels(n,i,r);else if(n.labels&&n.type!="text"){var d=n.labels,a=t.datavisualization.Diagram.Util.bounds(n),s,v,w,b,y=u?i._htmlLayer:r._htmlLayer;for(y||(y=i.document.parentNode.getElementsByClassName("htmlLayer")[0]),y&&(f=y.childNodes[n.zOrder],f&&f.id==n.name||(g=y.childNodes,f=this._findChild(g,n,i))),f&&(n.segments?(s=a.width,v=a.height,w=a.x,b=a.y):(s=n.width?n.width:n._width,v=n.height?n.height:n._height,w=n.offsetX-s*n.pivot.x,b=n.offsetY-v*n.pivot.y),nt=n.visible&&t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",r)?"visible":"hidden",f.style.width=s+"px",f.style.height=v+"px",f.style.left=w+"px",f.style.top=b+"px",f.style.opacity=n.opacity,c="rotate("+n.rotateAngle+"deg) ",tt=n.pivot?n.pivot.x*100+"% "+n.pivot.y*100+"%":"50% 50%",f.style.webkitTransform=c,f.style.MozTransform=c,f.style.OTransform=c,f.style.msTransform=c,f.style.transform=c,f.style["transform-origin"]=f.style["ms-transform-origin"]=f.style["webkit-transform-origin"]=f.style["o-transform-origin"]=f.style["moz-transform-origin"]=tt,f.style.visibility=nt),h=0;h<d.length;h++)n.labels[h].hyperlink?this._updateSVGLabel(n,n.labels[h],i,r):f&&(e=d[h],l=f.childNodes[h],l&&(o=l.childNodes[0],e.text||o.textContent?(p=s>e.width?s:e.width,e.margin.left&&e.margin.right&&(p-=(e.margin.left||0)+(e.margin.right||0)),e.margin.top&&e.margin.bottom&&(it-=(e.margin.top||0)+(e.margin.bottom||0)),p-=e.padding.left+e.padding.right,l.style.height=it+"px",l.style.width=p+"px",e.templateId||(o.textContent=e.text),(e.horizontalAlignment=="stretch"||e.verticalAlignment=="stretch")&&(k=this._rotateLabel(s,v,e),e.horizontalAlignment=="stretch"&&(o.style.width=Math.abs(k.x)+"px"),e.verticalAlignment=="stretch"&&(o.style.alignItems="center",o.style.display="flex",o.style.justifyContent="center",o.style.height=Math.abs(k.y)+"px"),e.textOverflow&&(o.style.display="inline-block")),this._alignTextOnLabel(n,a,o,l,e,r)):n._isHeader&&(o.style["pointer-events"]=r&&r.activeTool&&r.activeTool.name==="move"&&r.activeTool.inAction?"none":"all")))}},_alignTextOnPhase:function(n,i,r,u,f){var o,e,s,h;f.getElementById(n.name)&&(o=f.getElementById(n.name).getBoundingClientRect());o&&(e=r.getBBox(),s=f.getElementById(n.name+"_"+u.name+"_lblbg"),r.setAttribute("transform","translate("+-e.width/2+",50), rotate(0,0,0)"),r.setAttribute("pointer-events","auto"),s&&(h={width:e.width,height:e.height,fill:u.fillColor,stroke:u.borderColor,"stroke-width":u.borderWidth,transform:"translate("+-e.width+","+o.top+"), rotate(0,0,0)"},t.datavisualization.Diagram.Util.attr(s,h)))},updateLabel:function(i,r,u,f){var e,a;if(typeof r.text=="string"){var o,v,h,s,c,l=t.datavisualization.Diagram.Util.bounds(i),y=f._htmlLayer||u.document.parentNode.getElementsByClassName("htmlLayer")[0],p=n(y).children("#"+i.name+"_label")[0];i.segments?(s=l.width,c=l.height):(s=i.width?i.width:i._width,c=i.height?i.height:i._height);o=n(p).children("#"+i.name+"_"+r.name+"_lblbg")[0];o?(e=o.childNodes[0],h=s>r.width?s:r.width,r.margin.left&&r.margin.right&&(h-=(r.margin.left||0)+(r.margin.right||0)),r.margin.top&&r.margin.bottom&&(v-=(r.margin.top||0)+(r.margin.bottom||0)),h-=r.padding.left+r.padding.right,o.style.height=v+"px",o.style.width=h+"px",o.style.opacity=i.opacity,r.templateId||(e.textContent=r.text),e.style.opacity=r.opacity,(r.horizontalAlignment=="stretch"||r.verticalAlignment=="stretch")&&(a=this._rotateLabel(s,c,r),r.horizontalAlignment=="stretch"&&(e.style.width=Math.abs(a.x)+"px"),r.verticalAlignment=="stretch"&&(e.style.alignItems="center",e.style.display="flex",e.style.justifyContent="center",e.style.height=Math.abs(a.y)+"px"),r.textOverflow&&(e.style.display="inline-block")),i.type!="node"||i.width||i.height||this.updateNode(i,u,f),this._alignTextOnLabel(i,l,e,o,r,f)):this._updateLabelSpanElement(i,r,u,f)}},_alignTextOnLabel:function(n,i,r,u,f,e){var c,p,w,b,k=e&&e.getNode?e.getNode(n.parent):null,h,l,a,d;if(n.segments&&f.relativeMode=="segmentpath"){b=this._getConnectorHandlePosition(f,n,1,e);var g=b.position,h={x:(g.x-i.x)/i.width,y:(g.y-i.y)/i.height},nt=t.datavisualization.Diagram.Util._alignLabelOnSegments(n,f,e,b);w=nt.vAlign;p=nt.hAlign}else h={x:f.offset.x,y:f.offset.y},p=f.horizontalAlignment,w=f.verticalAlignment;r.style["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,e)?e&&e.activeTool&&e.activeTool.name==="move"&&e.activeTool.inAction?"none":"all":"none";l=n.width?n.width:n._width;a=n.height?n.height:n._height;l-=f.margin.left+f.margin.right;a-=f.margin.top+f.margin.bottom;c={x:l,y:a};f.textOverflow&&(r.style.textOverflow=f.overflowType,r.style.overflow="hidden",r.style.whiteSpace="nowrap",n.isPhase&&n.orientation==="vertical"||k&&k.isLane&&k.orientation==="horizontal"&&n._isHeader?(r.style.width=a+"px",r.style.height=l+"px"):r.style.width=l+"px");f.rotateAngle&&(d=t.Matrix.identity(),t.Matrix.rotate(d,f.rotateAngle,h.x,h.y),c=t.Matrix.transform(d,{x:l,y:a}));var o=0,s=0,v,y,tt=t.datavisualization.Diagram.Util.canMoveLabel(n);f.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap?(r.style.whiteSpace="nowrap",r.style.wordWrap="normal",r.style.maxWidth="",r.style.maxHeight=""):f.templateId||(f.textOverflow||(r.style.whiteSpace=f.textAlign!="justify"?"pre-wrap":"pre-line"),f.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?(r.style.wordBreak="break-all",r.style.wordWrap="break-word",n.segments?f.textOverflow&&(r.style.maxWidth=(i.width>f.width?i.width:f.width)+"px"):(Math.abs(c.x)<f.width&&(c.x=f.width),f.textOverflow&&(r.style.maxWidth=Math.abs(c.x)+"px",r.style.maxHeight=Math.abs(c.y)+"px"))):(r.style.wordWrap="break-word",r.style.maxWidth="",r.style.maxHeight=""));switch(p){case t.datavisualization.Diagram.HorizontalAlignment.Left:o="0%";v=f.margin.left+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Center:o="-50%";v=f.margin.left-f.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Right:o="-100%";v=-f.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:o="-50%"}switch(w){case t.datavisualization.Diagram.VerticalAlignment.Top:s="0%";y=f.margin.top+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Center:s="-50%";y=f.margin.top-f.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Bottom:s="-100%";y=-f.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Stretch:s="-50%"}f.margin.left&&f.margin.right&&f.margin.top&&f.margin.bottom&&!n._isClassifier&&!n._isClassMember?(r.style.marginLeft=v,r.style.marginTop=y):(u.style.marginLeft=v,u.style.marginTop=y);h.x*=100;h.y*=100;r.style.textAlign=f.textAlign;r.style.webkitTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.MozTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.OTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.msTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.transform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";f.horizontalAlignment=="stretch"||f.verticalAlignment=="stretch"||f.templateId||(r.style.left="0px",r.style.top="0px");u&&(u.style.left=h.x+"%",u.style.top=h.y+"%")},_rotateLabel:function(n,i,r){var f={x:n,y:i},u;return r.rotateAngle&&(u=t.Matrix.identity(),t.Matrix.rotate(u,r.rotateAngle,0,0),f=t.Matrix.transform(u,{x:n,y:i})),f},_renderLabelGroup:function(n,t,i){var r,u;if(n._type=="group"){for(r=0;r<n.children.length;r++)u=i.nameTable[i._getChild(n.children[r])],u._type=="group"?this._renderLabelGroup(u,t,i):this._renderLabelsAsSvg(u,t,i);this._renderLabelsAsSvg(n,t,i)}},_renderLabelsAsSvg:function(n,t,i){var u=t.document.getElementById(n.name),r;if(n.type==="text")this._renderTextElementAsSvg(n,n.textBlock,u,t,i);else for(r=0;r<n.labels.length;r++)this._renderTextElementAsSvg(n,n.labels[r],u,t,i)},_renderTextElementAsSvg:function(n,i,r,u,f){var o={id:n.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.fontColor,"text-decoration":i.textDecoration,visibility:i.visible||n.type==="text"?"visible":"hidden","pointer-events":"none"},e,a,h,s,c,l;(i.bold&&(o["font-weight"]="bold"),i.italic&&(o["font-style"]="italic"),e=u.text(o),e.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),e.textContent=i.text,o={id:n.name+"_"+i.name+"_lblbg",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,transform:"translate(0,0)"},a=u.rect(o),i.text)&&(r.appendChild(e),r.insertBefore(a,e),h=t.datavisualization.Diagram.Util.bounds(n),s=!1,n._isHeader&&i.rotateAngle&&f&&(c=f.nameTable[n.parent],c&&c.isLane&&(s=!0),l=f.nameTable[n.parent],l&&l.isPhaseStack&&!n.orientation=="vertical"&&(s=!0)),this._wrapText(n,h,e,i,u,s),this._alignTextOnSvgLabel(n,h,e,i,u,f,s))},_alignTextOnSvgLabel:function(n,i,r,u,f,e,o){var l=r.getBBox(),s=t.datavisualization.Diagram.Util._getLabelPosition(u,i),h,c,y,a,v,p;o&&(l=t.datavisualization.Diagram.Util._rBounds(l,u.rotateAngle),s=t.datavisualization.Diagram.Util._getLabelPosition(u,i,null,null,o,r));h=o?s:this._adjustOffsetWithTextBounds(n,u,r,s,l,i,e);c=u.borderWidth||0;r.setAttribute("transform","translate("+(h.x+c)+","+(h.y+c)+"), rotate("+u.rotateAngle+","+(s.x-h.x)+","+(s.y-h.y)+")");y=f.getElementById(n.name+"_"+u.name+"_lblbg");y&&(a=h.x+l.x,v=h.y,a=a+c/2,v=v+c/2,p={width:l.width+c,height:l.height+c,transform:"translate("+a+","+v+"), rotate("+u.rotateAngle+","+(s.x-a)+","+(s.y-v)+")",fill:u.fillColor?u.fillColor:"transparent",stroke:u.borderColor,"stroke-width":u.borderWidth},o&&(p.fill="transparent"),t.datavisualization.Diagram.Util.attr(y,p))},_adjustOffsetWithTextBounds:function(n,i,r,u,f,e,o){var s={x:0,y:0},c=0,h,a,v;if(n.segments&&i.relativeMode==="segmentpath"){var y=this._getConnectorHandlePosition(i,n,1,o),p=y.position,l={x:(p.x-e.x)/e.width,y:(p.y-e.y)/e.height};l=t.datavisualization.Diagram.Util._getLabelPosition(i,e,l);u.x=l.x;u.y=l.y;v=t.datavisualization.Diagram.Util._alignLabelOnSegments(n,i,o,y);a=v.hAlign;h=v.vAlign}else a=i.horizontalAlignment,h=i.verticalAlignment;if(h==t.datavisualization.Diagram.VerticalAlignment.Top?c=u.y:h==t.datavisualization.Diagram.VerticalAlignment.Center?c=u.y-f.height/2:h==t.datavisualization.Diagram.VerticalAlignment.Bottom?c=u.y-f.height:h==t.datavisualization.Diagram.VerticalAlignment.Stretch&&(c=u.y-f.height/2),s.y=c,i.textAlign=="justify")s.x=r.childNodes.length>1?u.x-n.width/2:u.x;else switch(a){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x+f.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x+f.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x-f.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x+f.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x-f.width;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x-f.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x}break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x-e.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x+e.width/2}}return(n.segments||n._type=="group")&&(s.x=s.x+e.x,s.y=s.y+e.y,u.x+=e.x,u.y+=e.y),s},_wrapText:function(n,t,i,r,u,f){for(var d=r.text,s,y,b,a,h,w,k;i.hasChildNodes();)i.removeChild(i.lastChild);n.segments?(s=t.width,y=t.height):(s=t.width-r.margin.left-r.margin.right,y=t.height-r.margin.top-r.margin.bottom);f&&(b=s,s=y,y=b);s-=2*(r.borderWidth?r.borderWidth:1);s=s<r.width?r.width:s;var v=d.split("\n"),e,c,l,p,o;if(u.getElementById(i.id)&&(l=u.getElementById(i.id).childNodes),l){for(a=r.wrapping=="wrapwithoverflow"?!0:!1,c=0;c<v.length;c++)if(e=u.tspan(),e.style.fontSize=r.fontSize,i.appendChild(e),r.wrapping!="nowrap")if(v[c]===" ")e.textContent=" ";else for(h=r.wrapping=="wrapwithoverflow"?v[c].split(" "):v[c],o=0;o<h.length;o++)w=h[o],w.indexOf("-")>=0&&a?(e=this._splitHyphenWord(e,w,i,r,s,u),o==h.length-1?o==h.length-1||(e=u.tspan(),i.appendChild(e)):this._getTextLength(u,i,e.textContent+" "+(h[o+1]||"")).width>s&&(e=u.tspan(),i.appendChild(e))):(e.textContent+=(e.textContent&&a?" ":"")+h[o],p=l[l.length-1].getComputedTextLength(),p>=s?o==h.length-1||(e=u.tspan(),i.appendChild(e)):(a||r&&r.wrapping==="wrap")&&(k=e.textContent,o<h.length-1&&(h[o+1].indexOf("-")>=0&&a?(e=this._splitHyphenWord(e,h[o+1],i,r,s,u),this._getTextLength(u,i,e.textContent+" "+(h[o+1]||"")).width>s&&(e=u.tspan(),i.appendChild(e)),o++):(e.textContent+=(a?" ":"")+(h[o+1]||""),p=l[l.length-1].getComputedTextLength(),e.textContent=k,p>s&&(e=u.tspan(),i.appendChild(e))))));else e.textContent+=v[c];this._wrapTextAlign(i,l,r.fontSize,r.textAlign,n,r,u)}},_splitHyphenWord:function(n,t,i,r,u,f){for(var c,s=n.textContent,l=r.wrapping=="wrapwithoverflow"?!0:!1,e=n.textContent?n.textContent+" ":"",h=t.split("-"),o=0;o<h.length;o++)e+=h[o],c=this._getTextLength(f,i,e),c>=u?(n.textContent=s,n=f.tspan(),i.appendChild(n),e=o<h.length-1?h[o]+"-":h[o],s=e):(l||r&&r.wrapping==="wrap")&&(s=e,o<h.length-1&&(e+="-",this._getTextLength(f,i,e)>u?(n.textContent=s,n=f.tspan(),i.appendChild(n),e="-"):s=e));return n.textContent=s,n},_getTextLength:function(n,t,i){var u,r=n.tspan();return t.appendChild(r),r.textContent=i,u=r.getComputedTextLength(),t.removeChild(r),u},_getTSpanLength:function(n,t,i,r){var f=0,u;if(n&&n.textContent)for(u=0;u<n.textContent.length;u++)f+=this._getCharBoundsValues(n.textContent[u],t,i,r).bold;return f},_wrapTextAlign:function(n,i,r,u,f,e,o){for(var c,v,w,h,y,p,s,l=2,a=0;a<i.length;a++){c=i[a];u=="justify"&&a!=i.length-1?(s=c.textContent,s[s.length-1]==" "&&(s=s.slice(0,s.length-1)),s[0]==" "&&(s=s.slice(1,s.length)),c.textContent=s,h=c.getComputedTextLength(),y=f.width-h,p=y/(s.split(" ").length-1),c.setAttribute("word-spacing",p+"px"),h=c.getComputedTextLength()):(v=this._getTSpanLength(c,e,o,f),h=v?v:c.getComputedTextLength());u=="justify"&&(u=i.length>1?"left":"center");switch(u){case"left":h=0;break;case"center":h=-h/2;break;case"right":h=-h}w={x:Number(h),dy:l>2?r*l:r};h==0&&c.textContent==""?l++:l=2;t.datavisualization.Diagram.Util.attr(c,w)}},_renderPorts:function(n,i,r,u){var b=n.width?n.width:n._width||0,k=n.height?n.height:n._height||0,d=n.offsetX-b*n.pivot.x,g=n.offsetY-k*n.pivot.y,s=n.ports||[],y,p,e,h,o,c,f,a,v,l,w;for(n._ports&&n._ports.length>0&&(s=s.concat(n._ports)),f=r._currZoom,r.model.palettes||u?e=i.getElementById(n.name):(c={id:n.name+"_ej_ports","pointer-events":"all",padding:"inherit"},n._type!=="group"&&(a=n.flip!=="none"?n.flip:n._flip,a&&a!==t.datavisualization.Diagram.FlipDirection.None?(v=this.renderflipElement(n,r),v&&(c.transform="rotate("+n.rotateAngle+","+n.offsetX*f+","+n.offsetY*f+")"+v)):c.transform="rotate("+n.rotateAngle+","+n.offsetX*f+","+n.offsetY*f+"), translate("+d*f+","+g*f+")"),e=i.g(c)),l=0,w=s.length;l<w;++l)y=s[l],p=this._renderPort(n,y,i,r),e.appendChild(p);o=i.getElementById(n.parent+"_ej_ports");n.parent!=""&&(o||(h=i.g({id:n.parent+"_ej_ports","pointer-events":"all",padding:"inherit"}),r.model.palettes||u?i.getElementById(n.name).appendChild(h):i.getElementById(r._canvas.id+"_portLayer").appendChild(h),o=h));r.model.palettes||u||(o?o.appendChild(e):i.getElementById(r._canvas.id+"_portLayer").appendChild(e))},_renderPort:function(n,i,r,u){var h,f,c,s=t.datavisualization.Diagram.Size(i.size,i.size),e,o=u._currZoom?u._currZoom:1,l,a,v,y;c=i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect?"hidden":t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",u)?"visible":"hidden";e=n._type==="group"?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);n._type==="group"&&n.rotateAngle&&(l=t.Matrix.identity(),t.Matrix.rotate(l,n.rotateAngle,n.offsetX,n.offsetY),e=t.Matrix.transform(l,e),i._absolutePoint=e);switch(i.shape){case"x":a=this._constructX(e,i.size,o);f={id:n.name+"_"+i.name,"class":"ej-d-port",fill:i.fillColor,visibility:c,stroke:i.borderColor,"stroke-width":i.borderWidth,d:a};this._addCssClass(i,f);h=r.path(f);break;case"circle":v=s.width/2;y=s.height/2;f={id:n.name+"_"+i.name,"class":"ej-d-port",rx:v,ry:y,visibility:c,cx:e.x*o,cy:e.y*o,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};this._addCssClass(i,f);h=r.ellipse(f);break;case"square":f={id:n.name+"_"+i.name,"class":"ej-d-port",x:e.x*o-i.size/2,visibility:c,y:e.y*o-i.size/2,width:s.width,height:s.height,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};this._addCssClass(i,f);h=r.rect(f);break;case"path":var p=s.width,w=s.height,a=i._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(e.x*o-i.size/2,e.y*o-i.size/2,p,w,i.pathData,r);f={id:n.name+"_"+i.name,"class":"ej-d-port",width:p,height:w,d:a,stroke:i.borderColor,"stroke-width":i.borderWidth,fill:i.fillColor,visibility:c};this._addCssClass(i,f);h=r.path(f)}return h},deleteLabel:function(n,t,i){i._views.forEach(function(r){var u=i._views[r],f=u.svg||u._canvas;u.context._deleteLabel(n,t,i,f,u)})},deletePort:function(n,t,i){i._views.forEach(function(r){var u=i._views[r],f=u.svg||u._canvas;u.context._deletePort(n,t,i,u.type!=="overview"?i._adornerSvg:f,u)})},_insertPort:function(n,i,r,u,f,e){var o,h,s,c;for(o=e?r.getElementById(n.name):r.getElementById(n.name+"_ej_ports"),h=t.datavisualization.Diagram.SvgContext._renderPort(n,i,r,f),s=[],c=0;c<o.childNodes.length;c++)o.childNodes[c].className.animVal=="ej-d-port"&&s.push(o.childNodes[c]);u!=undefined?s.length==0?o.appendChild(h):o.insertBefore(h,s[u]?s[u]:s[s.length]):o.appendChild(h);(i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&h.setAttribute("visibility","hidden")},_updatePort:function(n,i,r,u,f){var c=t.datavisualization.Diagram.Size(i.size,i.size),e=null,s,o=f?1:u._currZoom,h,a,l,v,y;e=n._type==="group"?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);h=n.name+"_"+i.name;n._type==="group"&&n.rotateAngle&&(a=t.Matrix.identity(),t.Matrix.rotate(a,n.rotateAngle,n.offsetX,n.offsetY),e=t.Matrix.transform(a,e),i._absolutePoint=e);s=i.visibility&t.datavisualization.Diagram.PortVisibility.Visible&&t.datavisualization.Diagram.Util.enableLayerOption(n,"visible",u)?"visible":"hidden";switch(i.shape){case"x":l=this._constructX(e,i.size,o);r.path({id:h,d:l,visibility:s});break;case"circle":v=c.width/2;y=c.height/2;n.type==="group"?r.ellipse({id:h,rx:v,ry:y,cx:0,cy:0,visibility:s,transform:"rotate("+n.rotateAngle+","+e.x*o+","+e.y*o+"),translate("+e.x*o+","+e.y*o+")"}):r.ellipse({id:h,rx:v,ry:y,visibility:s,cx:e.x*o,cy:e.y*o});break;case"square":n.type==="group"?r.rect({id:h,x:0,y:0,visibility:s,transform:"rotate("+n.rotateAngle+","+e.x*o+","+e.y*o+"),translate("+(e.x*o-i.size/2)+","+(e.y*o-i.size/2)+")"}):r.rect({id:h,visibility:s,x:e.x*o-i.size/2,y:e.y*o-i.size/2});break;case"path":var w=c.width,b=c.height,l=i._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(e.x*o-i.size/2,e.y*o-i.size/2,w,b,i.pathData,r),p={id:h,visibility:s,d:l};n.type==="group"&&(p={id:h,d:l,visibility:s,transform:"rotate("+n.rotateAngle+","+e.x*o+","+e.y*o+")"});r.path(p)}},_updatePorts:function(n,i,r,u){var e,s,l,a,h,v;if(n.ports||n._ports){e=n.ports||[];n._ports&&n._ports.length>0&&(e=e.concat(n._ports));var f=r._currZoom,y=n.width?n.width:n._width,p=n.height?n.height:n._height,w=n.offsetX-y*n.pivot.x,b=n.offsetY-p*n.pivot.y,c,o;for(o=u?i.getElementById(n.name):i.getElementById(n.name+"_ej_ports"),s=0,l=e.length;s<l;++s)c=e[s],this._updatePort(n,c,i,r);o&&n._type!=="group"&&(u||(a=n.rotateAngle,h=n.flip!=="none"?n.flip:n._flip,h&&h!==t.datavisualization.Diagram.FlipDirection.None?(v=this.renderflipElement(n,r),v&&o.setAttribute("transform","rotate("+a+","+n.offsetX*f+","+n.offsetY*f+")"+this.renderflipElement(n,r))):o.setAttribute("transform","rotate("+n.rotateAngle+","+n.offsetX*f+","+n.offsetY*f+"), translate("+w*f+","+b*f+")")))}},_constructX:function(n,i,r){var u=new t.datavisualization.Diagram.Path;return u.moveTo(n.x*r-i/2,n.y*r-i/2),u.lineTo(n.x*r+i/2,n.y*r+i/2),u.moveTo(n.x*r+i/2,n.y*r-i/2),u.lineTo(n.x*r-i/2,n.y*r+i/2),u.toString()},_enableSelectedNode:function(t,i,r){var e,u,a,o,v,s,h,f,c,l;if(t){if(t.type=="pseudoGroup")for(e=t.children,u=0,a=e.length;u<a;u++)o=r.nameTable[r._getChild(e[u])],o&&this._enableSelectedNode(o,i,r);else v={id:t.name,"pointer-events":"auto",style:"pointer-events:block"},t.segments&&(s=i.document.getElementById(t.name+"_hitTest"),s&&s.setAttribute("pointer-events",t.visible?"stroke":"none")),i.g(v);t&&t.type==="html"&&(h=r._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],h&&(f=n(h).find("#"+t.name+"_parentdiv")[0]),f&&(f.style.pointerEvents="all",c=f.children[0],c&&(c.style.pointerEvents="all")));r._adornerSvg&&(l=r._adornerSvg.document.getElementById(r._adornerSvg.document.id+"handle_g"),l&&l.setAttribute("pointer-events","visible"));t.isLane&&(n("#diagram").find(".s-resize").css("pointer-events","visible"),n("#diagram").find(".e-resize").css("pointer-events","visible"));n("#diagram").find(".ej-d-seperator").css("pointer-events","visible")}},_disableSelectedNode:function(t,i,r){var e,u,l,o,a,v,s,h,f,c;if(t){if(t.type=="pseudoGroup")for(e=t.children,u=0,l=e.length;u<l;u++)o=r.nameTable[r._getChild(e[u])],o&&this._disableSelectedNode(o,i,r);else a={id:t.name,style:"pointer-events:none","pointer-events":"none"},t.segments&&(v=i.document.getElementById(t.name+"_hitTest"),v.setAttribute("pointer-events","none")),i.g(a);r._adornerSvg&&(s=r._adornerSvg.document.getElementById(r._adornerSvg.document.id+"handle_g"),s&&s.setAttribute("pointer-events","none"));t&&t.type==="html"&&(h=r._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],h&&(f=n(h).find("#"+t.name+"_parentdiv")[0]),f&&(f.style.pointerEvents="none",c=f.children[0],c&&(c.style.pointerEvents="none")));t.isLane&&(n("#diagram").find(".s-resize").css("pointer-events","none"),n("#diagram").find(".e-resize").css("pointer-events","none"));n("#diagram").find(".ej-d-seperator").css("pointer-events","none")}},_drawStackHighlighter:function(n,i,r,u,f,e){var c,s=[],o=t.datavisualization.Diagram.Util.bounds(n);e?f.y>=o.y&&f.y<o.center.y?(s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u+5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u+5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u})):(s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u-5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u-5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u})):f.x>=o.x&&f.x<o.center.x?(s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topLeft.x*u+5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u+5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u})):(s.push({x:o.topRight.x*u-5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u-5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}));var c=this._convertToSVGPoints(s),l={id:"nodeHighlighter",points:c,fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none",style:"pointer-events: none"},h=i.polyline(l);return r.appendChild(h),h},_drawNodeHighlighter:function(n,i,r,u){var f,e=n.width?n.width:n._width,o=n.height?n.height:n._height,h=n.offsetX-e*n.pivot.x,c=n.offsetY-o*n.pivot.y,s=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),l="rotate("+n.rotateAngle+","+s.x*u+","+s.y*u+")",a=n.isLane||n.isSwimlane?"red":"#0dc923",v={id:"nodeHighlighter","class":"ej-d-node",x:h*u,y:c*u,width:e*u,height:o*u,fill:"transparent",stroke:a,"stroke-width":2,"pointer-events":"none",transform:l,style:"pointer-events: none"};return f=i.rect(v),r.appendChild(f),f},_drawNavigationHighlighter:function(n,t,i,r){var u={id:"nodeHighlighter",x:n.x*r,y:n.y*r,width:n.width*r,height:n.height*r,fill:"transparent",stroke:"black","stroke-dasharray":"2 2","shape-rendering":"crispEdges",style:"pointer-events: none"};i.appendChild(t.rect(u))},_removeNodeHighlighter:function(n,t){var i=n.getElementById("nodeHighlighter");i&&n.removeChild(i,t)},_drawPortHighlighter:function(n,i,r,u,f,e){var a,s,o,c,l,v,g=i.width?i.width:i._width,nt=i.height?i.height:i._height,h,y="#8CC63F",b="#1A1A1A",k=.5,p,w,d;return n?(s=t.datavisualization.Diagram.Size(n.size*2,n.size*2),o=t.datavisualization.Diagram.Util._getPortPosition(n,t.datavisualization.Diagram.Util.bounds(i,!0)),w=t.Matrix.identity(),t.Matrix.rotate(w,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(w,o),c=(o.x-n.size)*f,l=(o.y-n.size)*f,v="rotate(0,"+(c+s.width/2)+","+(l+s.height/2)+")",e&&(e.portHighlight=!0)):(h=t.datavisualization.Diagram.Util.bounds(i,!0),s=t.datavisualization.Diagram.Size(h.width,h.height),o=t.datavisualization.Diagram.Point(h.x,h.y),c=o.x*f,l=o.y*f,b=y,y="transparent",k=2,p=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),v="rotate("+i.rotateAngle+","+p.x*f+","+p.y*f+")"),d={id:"portHighlighter","class":"ej-d-port",x:c,y:l,width:s.width*f,height:s.height*f,fill:y,stroke:b,"stroke-width":k,"pointer-events":"none",transform:v},a=r.rect(d),u.appendChild(a),a},_drawConnectorHighlighter:function(n,t,i){var u=t._adornerSvg,r=u.g({id:"connector_highlighter",visibility:"visible",transform:"scale("+i+")"});t._adornerLayer.appendChild(r);var f=this._findPath(n,t),e={id:"highlighter_segments",d:f,fill:"none",stroke:"#0dc923","stroke-width":n.lineWidth,"pointer-events":"none"},o=u.path(e);return r.appendChild(o),r},_removeConnectorHighlighter:function(n,t){var i=t.getElementById("connector_highlighter");i&&n.removeChild(i)},_removePortHighlighter:function(n,t){var i=n.getElementById("portHighlighter");i&&n.removeChild(i,t)},_renderPhaseResize:function(n,i,r,u,f){var s,e=[],l="",a=!1,v=!1,o=t.datavisualization.Diagram.Util.bounds(n),c,h;s;e=[];e.push({x:o.topLeft.x*r,y:o.topLeft.y*r});e.push({x:o.bottomLeft.x*r,y:o.bottomLeft.y*r});s=this._convertToSVGPoints(e);h={id:"w-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"};c=i.polyline(h);f.appendChild(c);s;e=[];e.push({x:o.topLeft.x*r,y:o.topLeft.y*r});e.push({x:o.topRight.x*r,y:o.topRight.y*r});s=this._convertToSVGPoints(e);h={id:"n-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"};c=i.polyline(h);f.appendChild(c);l="";n.orientation=="vertical"&&(l="e-resize",v=!0);s;e=[];e.push({x:o.topRight.x*r,y:o.topRight.y*r});e.push({x:o.bottomRight.x*r,y:o.bottomRight.y*r});s=this._convertToSVGPoints(e);v&&(h={id:"e-resize-hitTest","class":l,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":v?"stroke":"none"},c=i.polyline(h),f.appendChild(c));h={id:"e-resize","class":l,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":v?"stroke":"none"};c=i.polyline(h);f.appendChild(c);l="";n.orientation=="horizontal"&&(l="s-resize",a=!0);s;e=[];e.push({x:o.bottomLeft.x*r,y:o.bottomLeft.y*r});e.push({x:o.bottomRight.x*r,y:o.bottomRight.y*r});s=this._convertToSVGPoints(e);a&&(h={id:"s-resize-hitTest","class":l,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":a?"stroke":"none"},c=i.polyline(h),f.appendChild(c));h={id:"s-resize","class":l,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":a?"stroke":"none"};c=i.polyline(h);f.appendChild(c)},renderSelector:function(t,i,r,u,f,e,o){var l,a,h,s,c;n(".phaseSelector").remove();l=t.width?t.width:t._width;a=t.height?t.height:t._height;t.segments?(s=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible"}),r.appendChild(s),this._renderEndPointHandle(t,i,u)):t.type!="phase"?t.isLane||t.isSwimlane?(s=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible"}),r.appendChild(s),this._renderPhaseResize(t,i,u,f,s,e)):(h=this._selectorLocation(t,u,o),s=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:h}),r.appendChild(s),this._updateMultiSelectHandle(t,u,f,o),this._renderResizeHandle(t,i,u,f,o)):t.type=="phase"&&e&&(s=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+e.x*u+","+e.y*u+"),rotate(0,"+e.width/2*u+","+e.height/2*u+")"}),i.document.getElementById(i.document.id+"handle_g")||r.appendChild(s),c=i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:e.width<0?1:e.width*u,height:e.height<0?1:e.height*u,fill:"transparent",stroke:"red"}),s.appendChild(c))},_updateMultiSelectHandle:function(n,i,r,u){var s,h,c;if(n.type==="pseudoGroup"&&t.datavisualization.Diagram.Util.canDragHelper(u)){var f=n.width?n.width:n._width,e=n.height?n.height:n._height,o=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY);u._svg.getElementById(u.element[0].id+"_multiselector")?(s={id:u.element[0].id+"_multiselector",width:f,height:e,transform:"rotate("+n.rotateAngle+","+o.x+","+o.y+"),translate("+(n.offsetX-f*n.pivot.x)+","+(n.offsetY-e*n.pivot.y)+")"},u._svg.rect(s)):(s={id:u.element[0].id+"_multiselector","class":"ej-d-multiselector",width:f,height:e,transform:"rotate("+n.rotateAngle+","+o.x+","+o.y+"),translate("+(n.offsetX-f*n.pivot.x)+","+(n.offsetY-e*n.pivot.y)+")",fill:"transparent",opacity:".5"},h=u._svg.getElementById(u.element[0].id+"_canvas_diagramLayer"),c=u._svg.rect(s),h.insertBefore(c,h.firstChild))}},_renderResizeHandle:function(n,i,r,u,f){var s=n.width?n.width:n._width,h=n.height?n.height:n._height,a=n.pivot?n.pivot:{x:.5,y:.5},l=t.datavisualization.Diagram.Point(s*a.x,-20/r),e="visible",o,c;if(n._type!=="label"&&t.datavisualization.Diagram.Util.canShowResizeThumbs(f)){var v=t.datavisualization.Diagram.Rectangle(0,0,14,14),y=t.datavisualization.Diagram.Rectangle(s/2*r,0,14,14),p=t.datavisualization.Diagram.Rectangle(0,h/2*r,14,14);e=this._resizeHandleVisiblity(v,y,p)}u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&n.type!="umlclassifier"&&(c=0,e=="hidden"&&(c=-20),this._renderPivotLine(n,i,r,c),this._renderRotateThumb("rotateHandle",n,l.x,l.y+c,r,i));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._renderResizeBorder("resizeBorder",n,i,r),n.type!="umlclassifier"&&(n._type=="label"&&(o=!(n.constraints&t.datavisualization.Diagram.LabelConstraints.Resizable)),this._renderResizeCorner("nw-resize",n,0,0,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest),undefined,e),this._renderResizeCorner("ne-resize",n,s*r,0,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast),undefined,e),this._renderResizeCorner("sw-resize",n,0,h*r,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),undefined,e),this._renderResizeCorner("se-resize",n,s*r,h*r,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast),undefined,e),this._renderResizeCorner("n-resize",n,s/2*r,0,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth),undefined,e),this._renderResizeCorner("w-resize",n,0,h/2*r,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest),undefined,e),this._renderResizeCorner("e-resize",n,s*r,h/2*r,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast),undefined,e),this._renderResizeCorner("s-resize",n,s/2*r,h*r,i,n._type=="label"?o:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth),undefined,e)))},renderUserHandles:function(n,t,i,r,u,f,e){var h,s,o;if(t&&(t.type==="phase"&&e&&(h=e._getPhaseBounds(t)),n.length))for(s=i.g({id:i.document.id+"userHandle_g","class":"userHandle","pointer-events":"visible"}),f.appendChild(s),o=0;o<n.length;o++)(r&&n[o].enableMultiSelection||!r)&&this._renderUserHandle(n[o],t,i,u,s,h,e)},_renderUserHandle:function(n,i,r,u,f,e,o){var s,w=this._getHandlePosition(n,i,u,e,o),l=w.x*u,a=w.y*u,g=this._getHandleShape(n,l,a),k,v,y,it,d,c,h,p;n._size=n.size;var nt=f.appendChild(r.circle(g)),tt={id:n.name+"_title"},b=r.title(tt);b.innerHTML=n.name;nt.appendChild(b);switch(n.shape){case"path":k=n._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(0,0,n.size/2,n.size/2,n.pathData,r);s=this._getHandleIcon(n,l-n.size/4,a-n.size/4);s.d=k;f.appendChild(r.path(s));break;case"image":s=this._getHandleIcon(n,l-n.size/4,a-n.size/4);s.preserveAspectRatio="none";v=new Image;v.src=n.source;y=r.image(s);y.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v.src);f.appendChild(y);break;case"native":it=n.visible?"visible":"hidden";s=this._getHandleIcon(n,l-n.size/4,a-n.size/4);d=o._renderEjTemplate("#"+n.templateId,n);c=document.createElement("div");c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+d+"<\/g><\/svg>";document.body.appendChild(c);h=document.getElementById("tempNative").cloneNode(!0);h.id=n.name+"_shape";f.appendChild(h);var e=h.getBBox(),rt=s.width,ut=s.height,ft=e.width?rt/e.width:1,et=e.height?ut/e.height:1;h.setAttribute("transform","scale("+ft+","+et+")");c.parentNode.removeChild(c);p=r.g(s);p.appendChild(h);f.appendChild(p)}},_getHandleIcon:function(n,t,i){var r=n.visible?"visible":"hidden";return{id:n.name+"_icon","class":"userHandle-icon",fill:n.pathColor,transform:"translate("+t+","+i+")",visibility:r,width:n.size/2,height:n.size/2}},_getHandlePosition:function(n,i,r,u){var s,h,a;if(i&&(!i.segments||n.offset)){s=t.datavisualization.Diagram.Point();h=i.type==="phase"&&u?t.datavisualization.Diagram.Util.bounds(u):t.datavisualization.Diagram.Util.bounds(i,!0);var e=n.offset,c=n.size,f=n.margin,o=t.datavisualization.Diagram.Point(0,0),l=t.Matrix.identity();t.Matrix.rotate(l,i.rotateAngle,i.offsetX,i.offsetY);switch(n.position){case"topleft":e={x:0,y:0};f={left:-25,top:-25,bottom:0,right:0};break;case"topcenter":e={x:.5,y:0};f={left:0,top:-25,bottom:0,right:0};break;case"topright":e={x:1,y:0};f={left:0,top:-25,bottom:0,right:-25};break;case"middleleft":e={x:0,y:.5};f={left:-25,top:0,bottom:0,right:0};break;case"middleright":e={x:1,y:.5};f={left:0,top:0,bottom:0,right:-25};break;case"bottomleft":f={left:-25,top:0,bottom:-25,right:0};e={x:0,y:1};break;case"bottomcenter":e={x:.5,y:1};f={left:0,top:0,bottom:-25,right:0};break;case"bottomright":e={x:1,y:1};f={left:0,top:0,bottom:-25,right:-25}}o.x+=f.left-f.right;o.y+=f.top-f.bottom;switch(n.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:o.x+=c/2;break;case t.datavisualization.Diagram.HorizontalAlignment.Right:o.x-=c/2}switch(n.verticalAlignment){case t.datavisualization.Diagram.VerticalAlignment.Top:o.y+=c/2;break;case t.datavisualization.Diagram.VerticalAlignment.Bottom:o.y-=c/2}return s.x+=h.x+h.width*e.x+o.x/r,s.y+=h.y+h.height*e.y+o.y/r,i.segments||(a=t.datavisualization.Diagram.Point(s.x,s.y),s=t.Matrix.transform(l,a)),s}},_getConnectorHandlePosition:function(n,i,r,u){var e=t.datavisualization.Diagram.Util._findOffsetOnConnector(i,n,n.segmentOffset,u),o=e.segment,s=e.point,c=e.offset,a=i.segments[o],l=i.segments[o].points[s],f=t.datavisualization.Diagram.Geometry.findAngle(l,i.segments[o].points[s+1]),h;return n.alignment&&n.alignment!="auto"?(n.offset==1&&(f+=180),{position:t.datavisualization.Diagram.Geometry.transform(e.offset,n.offset!=0&&n.offset!=1?f+45:f,this._getAlignedPosition(i,n)),angle:f}):(h=this._avoidOverlapWithSourceAndTarget(i,n.offset,n.size,e.offset,f,o,s,u),c={position:h.position,angle:n.offset==1?(180+f)%360:f,direction:h.direction},c)},_getAlignedPosition:function(n,t){var i=t.text===undefined?10:0;switch(t.alignment){case"center":return 0;case"before":return-((t.size||0)/2+i);case"after":return(t.size||0)/2+i}return 0},_avoidOverlapWithSourceAndTarget:function(n,i,r,u,f,e,o,s){var y,p,w=u,nt=n.segments[e],h=90,l,k,c;if(i==0?(y=n.segments[e].points[o+2]?n.segments[e].points[o+2]:n.segments[e+1]?n.segments[e+1].points[1]:null,y&&(p=t.datavisualization.Diagram.Geometry.findAngle(n.segments[e].points[o],y)),n.sourceNode&&(h=45)):i==1&&(y=n.segments[e].points[o-1]?n.segments[e].points[o-1]:n.segments[e-1]?n.segments[e-1][n.segments[e].points.length-2]:null,y&&(p=t.datavisualization.Diagram.Geometry.findAngle(n.segments[e].points[o+1],y)),f+=180,f%=360,n.targetNode&&(h=45)),y)if(f%90==0)p>270&&f==0&&(f=360),f==90?p<f?(f+=h,l="right"):(f-=h,l="left"):f==270?p<f?(f+=h,l="left"):(f-=h,l="right"):f==180?p<f?(f+=h,l="bottom"):(f-=h,l="top"):p<f?(f+=h,l="top"):(f-=h,l="bottom"),w=t.datavisualization.Diagram.Geometry.transform(w,f,r!=undefined?Math.max(5,r/2+10):0);else{var d=45,a=135,b=225,g=315,v;(i==0&&n.sourceNode||i==1&&n.targetNode)&&(k=i==0&&n.sourceNode?s.nameTable[n.sourceNode]:s.nameTable[n.targetNode],k&&(v=t.datavisualization.Diagram.Util.bounds(k)),v&&(c=180/(2+2/(v.height/v.width)),d=c,a=180-c,b=a+2*c,g=360-c));h=f>=d&&f<=a||f>=b&&f<=g?f%180>90?-h:h:f>a&&f<b?f>180?-45:45:f>0?-45:45;w=t.datavisualization.Diagram.Geometry.transform(w,f+h,r!=undefined?Math.max(5,r/2+10):0)}else{var d=45,a=135,b=225,g=315,v;(i==0&&n.sourceNode||i==1&&n.targetNode)&&(k=i==0&&n.sourceNode?s.nameTable[n.sourceNode]:s.nameTable[n.targetNode],k&&(v=t.datavisualization.Diagram.Util.bounds(k)),v&&(c=180/(2+2/(v.height/v.width)),d=c,a=180-c,b=a+2*c,g=360-c));h=f>=d&&f<=a||f>=b&&f<=g?f%180>90?-h:h:f>a&&f<b?f>180?-45:45:f<=d?-45:45;f+=360;f%=360;w=t.datavisualization.Diagram.Geometry.transform(w,f+h,r!=undefined?Math.max(5,r/2+(Math.abs(h%45)>0?13:10)):0)}return{position:w,direction:l}},_getHandleShape:function(n,t,i){var r=n.visible?"visible":"hidden";return{id:n.name+"_shape","class":"userHandle",cx:t,cy:i,r:n.size/2,fill:n.backgroundColor,stroke:n.borderColor,"stroke-width":n.borderWidth||0,visibility:r}},_updateHandleShape:function(n,t,i,r){var u=n.visible?"visible":"hidden",f={id:n.name+"_shape",cx:t,cy:i,r:n.size/2,fill:n.backgroundColor,stroke:n.borderColor,"stroke-width":n.borderWidth||0,visibility:u};r.circle(f)},_updateHanleIcon:function(n,t,i,r,u){var f=n.visible?"visible":"hidden",e={id:n.name+"_icon",d:t,fill:n.pathColor,transform:"translate("+r+","+u+")",visibility:f};i.path(e)},_getHanleIcon:function(n,t){return{id:n.name,d:t,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:n.fillColor}},renderPivotPoint:function(n,i,r,u,f,e){var s=n.width*(n.pivot?n.pivot.x:.5),h=n.height*(n.pivot?n.pivot.y:.5),o="visible";if(t.datavisualization.Diagram.Util.canShowResizeThumbs(e)){var c=n.width?n.width:n._width,l=n.height?n.height:n._height,a=t.datavisualization.Diagram.Rectangle(0,0,14,14),v=t.datavisualization.Diagram.Rectangle(c/2*i,0,14,14),y=t.datavisualization.Diagram.Rectangle(0,l/2*i,14,14);o=this._resizeHandleVisiblity(a,v,y)}r.getElementById("pivot")?t.datavisualization.Diagram.SvgContext._updateResizeCorner("pivot",s*i,h*i,r,o,u,f,e,undefined):t.datavisualization.Diagram.SvgContext._renderResizeCorner("pivot",n,s*i,h*i,r,undefined,4,o);this._updatePivotLine(n,r,i,!0)},_removePivotPoint:function(n,t,i){var r=t.getElementById("pivot");r&&(r.parentNode.removeChild(r),this._updatePivotLine(n,t,i,!1))},_renderPivotLine:function(n,i,r,u){if(!n.container){var e=n.width?n.width:n._width,l=n.height?n.height:n._height,o=n.pivot?n.pivot:{x:.5,y:.5},f=t.datavisualization.Diagram.Point(e*o.x,-20/r);u&&(f.y+=u);var s=t.datavisualization.Diagram.Point(e*o.x,0),h=i.getElementById(i.document.id+"handle_g"),c=i.line({id:"pivotLine",x1:f.x*r,y1:f.y*r,x2:s.x*r,y2:s.y*r,stroke:n._type=="label"?"red":"black","stroke-width":1,"stroke-dasharray":"2,3",fill:"none"});h.appendChild(c)}},_renderResizeBorder:function(n,i,r,u){var e=r.getElementById(r.document.id+"handle_g"),o=i.width?i.width:i._width,s=i.height?i.height:i._height,f;f=i.type=="umlclassifier"?t.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(n,i,r,u):r.rect({id:n,"class":"resizeRect",width:o*u,height:s*u,stroke:i._type=="label"?"red":"#097F7F","stroke-width":.6,"stroke-dasharray":"6,3",fill:"none","pointer-events":"none"});e.appendChild(f)},_renderResizeCorner:function(n,i,r,u,f,e,o,s){var a=f.getElementById(f.document.id+"handle_g"),c,l="white",h;t.datavisualization.Diagram.Util.canResize(i)||(l="darkgray");e&&(l="darkgray",c="none");h={id:n,"class":"resizeCorners",fill:l,stroke:i._type=="label"?"#097F7F":"black","stroke-width":1,cx:r,cy:u,r:o||7,visibility:s};h=this._setPadding(h);a.appendChild(f.circle(h));h={id:n+"_transparent","class":n,fill:"transparent",cx:h.cx,cy:h.cy,r:o||10,visibility:h.visibility};c&&(h["pointer-events"]=c);a.appendChild(f.circle(h))},_setPadding:function(n){if((n.id==="n-resize"||n.id==="w-resize"||n.id==="e-resize"||n.id==="s-resize")&&n.visibility==="hidden"){var t=20;n.id==="n-resize"&&(n.cy=n.cy-t);n.id==="w-resize"&&(n.cx=n.cx-t);n.id==="e-resize"&&(n.cx=n.cx+t);n.id==="s-resize"&&(n.cy=n.cy+t);n.visibility="visible"}return n},_renderRotateThumb:function(n,i,r,u,f,e){if(!i.container){var h=e.getElementById(e.document.id+"handle_g"),c="#231f20";t.datavisualization.Diagram.Util.canRotate(i)||(c="darkgray");var o=20,s=20,l={id:"rotatehandle","class":n,fill:c,stroke:"black","stroke-width":.5,width:o,height:s,d:"M 16.856 10.239 L 18 3.438 l -2.189 0.817 c -0.974 -1.694 -2.482 -2.995 -4.326 -3.696 C 9.375 -0.245 7.071-0.18 5.01 0.744 C 2.942 1.668 1.365 3.342 0.558 5.453 c -0.803 2.115 -0.738 4.414 0.185 6.478 c 0.925 2.064 2.6 3.645 4.714 4.45 c 0.969 0.371 1.993 0.554 3.013 0.554 c 1.345 0 2.685 -0.317 3.897 -0.948 l -1.016 -1.962 c -1.584 0.822-3.445 0.929 -5.114 0.293 c -1.56 -0.596 -2.793 -1.762 -3.479 -3.289 C 2.078 9.502 2.031 7.803 2.622 6.244 C 3.216 4.68 4.387 3.443 5.914 2.761 C 7.437 2.079 9.137 2.03 10.7 2.626 c 1.246 0.475 2.271 1.328 2.986 2.424 L 11.54 5.851 L 16.856 10.239 Z",transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"},a=e.path(l),v=e.circle({id:"rotate","class":n,fill:"transparent",stroke:"none",cx:o/2,cy:s/2,r:13,transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"});h.appendChild(a);h.appendChild(v)}},_refreshEndPointHandles:function(n,t,i){var r,f,u;if(n&&n.segments){if(r=t.getElementById(t.document.id+"handle_g"),r&&r.childNodes.length>0)for(f=r.childNodes.length-1;f>=0;f--)u=r.childNodes[f],u.id!=="sourceEndPoint"&&u.id!=="targetEndPoint"&&u.parentNode.removeChild(u);this._renderEndPointHandle(n,t,i)}},_renderEndPointHandle:function(n,i,r){var e,f,u,o;if(!n.isPhase)for(e=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),f=0;f<n.segments.length;f++)u=n.segments[f],u.type=="bezier"&&(this._renderBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i,e),this._renderBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i,e),this._renderEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,e),this._renderEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,e)),o=u.points,f==0&&this._renderEndPointCorner("sourceEndPoint",u._startPoint.x*r,u._startPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),f==n.segments.length-1?(this._renderEndPointCorner("targetEndPoint",u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._renderTerminalOrthoThumbs(u,i,r,f,e)):u.type!="orthogonal"?this._renderSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._renderTerminalOrthoThumbs(u,i,r,f,e)},_renderTerminalOrthoThumbs:function(n,i,r,u,f){var o,e,h,s;if(n.points.length>2)for(e=0;e<n.points.length-1;e++)s=t.datavisualization.Diagram.Geometry.distance(n.points[e],n.points[e+1]),o=n.points[e].y.toFixed(2)==n.points[e+1].y.toFixed(2)?"horizontal":"vertical",h=s>=50?"visible":"hidden",this._renderOrthogonalThumb("OrthoThumb_"+e+"_"+u,(n.points[e].x+n.points[e+1].x)/2*r,(n.points[e].y+n.points[e+1].y)/2*r,i,h,o,f);else s=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),h=s>=50?"visible":"hidden",o=n._startPoint.y.toFixed(2)==n._endPoint.y.toFixed(2)?"horizontal":"vertical",this._renderOrthogonalThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,h,o,f)},_renderEndPointCorner:function(n,t,i,r,u,f){var s=u.getElementById(u.document.id+"handle_g"),o=r?"#8CC63F":"white",e;f||(o="darkgray");e={id:n,"class":n,opacity:.75,fill:o,stroke:"black","stroke-width":2,cx:t,cy:i,r:7};u.getElementById(n)?u.circle(e):s.appendChild(u.circle(e))},_renderSegmentEndThumb:function(n,t,i,r,u,f){var s=u.getElementById(u.document.id+"handle_g"),e="#e2e2e2",o;f||(e="darkgray");o={id:n,"class":"segmentEnd",fill:e,stroke:"black","stroke-width":2,cx:t,cy:i,r:5};s.appendChild(u.circle(o))},_renderOrthogonalThumb:function(n,t,i,r,u,f,e){var o,s,h,l,c,a;f=="horizontal"?(o="M0,7 L15,0 L30,7 L15,14 z",s=-15,h=-7):(o="M7,0 L0,15 L7,30 L14,15 z",s=-7,h=-15);l=r.getElementById(r.document.id+"handle_g");c="#e2e2e2";e||(c="darkgray");a={id:n,"class":"segmentEnd",fill:c,stroke:"black","stroke-width":1,d:o,transform:"translate("+(t+s)+","+(i+h)+")",visibility:u};l.appendChild(r.path(a))},_renderBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"3,3",fill:"none"}),e=u.getElementById(u.document.id+"handle_g");e.appendChild(f)},_renderControlPointCorner:function(n,t,i,r){var u=r.g({"class":n}),f;r.getElementById(r.document.id+"handle_g").appendChild(u);f={id:n+"_"+i,fill:"white",stroke:"black","stroke-width":2,cx:t.x,cy:t.y,r:5};u.appendChild(r.circle(f))},_selectorLocation:function(n,i,r){var o=n.width,f=n.height,s,e,u;return n._type!=="label"?s="translate("+(n.offsetX-o*n.pivot.x)*i+","+(n.offsetY-f*n.pivot.y)*i+"),rotate("+n.rotateAngle+","+o*n.pivot.x*i+","+f*n.pivot.y*i+")":(e=r.findNode(n._parent),f=f?f:e.height,u=r.activeTool._findLabelAtNode(e,n),e.segments?e.segments&&n.relativeMode!=="segmentpath"?s="translate("+u.x*i+","+u.y*i+"),rotate("+n.rotateAngle+","+o/2*i+","+f/2*i+")":(u=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(n,e,i,r),u.position.x=u.position.x+n.margin.left-n.margin.right,u.position.y=u.position.y+n.margin.top-n.margin.bottom,s="translate("+(u.position.x-o/2)*i+","+(u.position.y-f/2)*i+"),rotate("+n.rotateAngle+","+o/2*i+","+f/2*i+")"):s="translate("+u.x*i+","+u.y*i+"),rotate("+e.rotateAngle+"),rotate("+n.rotateAngle+","+o/2*i+","+f/2*i+")"),s},updateSelector:function(n,i,r,u,f,e,o){var b,k,a,s,d,h,p,w,l;if(n)if(b=n.width?n.width:n._width,k=n.height?n.height:n._height,n.segments)this._updateEndPointHandle(n,i,r),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(u.model.selectedItems.userHandles,n,i,!1,!1,r,u);else if(n.type==="phase")s=u._getPhaseBounds(n),i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+s.x*r+","+s.y*r+"),rotate(0,"+s.width/2*r+","+s.height/2*r+")"}),i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:s.width<0?1:s.width*r,height:s.height<0?1:s.height*r,fill:"transparent",stroke:"red"});else{if(n.isSwimlane||n.isLane||(a=this._selectorLocation(n,r,u),d=i.g({id:i.document.id+"handle_g",transform:a})),t.datavisualization.Diagram.Util.canShowResizeThumbs(u)){var v=i.document.parentNode.getElementsByClassName("resizeCorners"),y=i.document.getElementById("rotatehandle"),c=o?"hidden":"visible";for(h=0;h<v.length;h++)v[h].setAttribute("visibility",c);y!=null&&(p=i.document.getElementById("pivotLine"),y.setAttribute("visibility",c),p.setAttribute("visibility",c))}if(w=u.getObjectType(n),w!=="group"&&n.type!=="pseudoGroup"&&(u.activeTool.name=="move"||u.activeTool.name=="rotate"||u.activeTool.name=="labelMove"||u.activeTool.name=="labelRotate")&&u.activeTool.inAction||(this._updateMultiSelectHandle(n,r,f,u),this._updateResizeHandle(n,i,r,f,e,o,u)),(u.activeTool.name=="rotatetool"||u.activeTool.name=="labelRotate")&&u.activeTool.inAction&&this.renderPivotPoint(n,r,i,e,o,u),u.model.selectedItems.userHandles&&u.model.selectedItems.userHandles.length>0&&(l=!1,u.selectionList[0]&&u.selectionList[0].name=="multipleSelection"&&(l=!0),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles))return this.updateUserHandles(u.model.selectedItems.userHandles,n,i,l,!1,r,u),!0}},_updatePhaseResize:function(n,i,r){var e,u=[],o,f=t.datavisualization.Diagram.Util.bounds(n);e;u=[];u.push({x:f.topLeft.x*r,y:f.topLeft.y*r});u.push({x:f.bottomLeft.x*r,y:f.bottomLeft.y*r});e=this._convertToSVGPoints(u);o={id:"w-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.topLeft.x*r,y:f.topLeft.y*r});u.push({x:f.topRight.x*r,y:f.topRight.y*r});e=this._convertToSVGPoints(u);o={id:"n-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.topRight.x*r,y:f.topRight.y*r});u.push({x:f.bottomRight.x*r,y:f.bottomRight.y*r});e=this._convertToSVGPoints(u);o={id:"e-resize-hitTest",points:e};i.polyline(o);o={id:"e-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.bottomLeft.x*r,y:f.bottomLeft.y*r});u.push({x:f.bottomRight.x*r,y:f.bottomRight.y*r});e=this._convertToSVGPoints(u);o={id:"s-resize-hitTest",points:e};i.polyline(o);o={id:"s-resize",points:e};i.polyline(o)},_updateResizeHandle:function(n,i,r,u,f,e,o){var v,a;if(n.isSwimlane||n.isLane)this._updatePhaseResize(n,i,r,u);else{var c=n.width?n.width:n._width,l=n.height?n.height:n._height,y=n.pivot?n.pivot:{x:.5,y:.5},k=n._corners,s="visible",h;if(t.datavisualization.Diagram.Util.canShowResizeThumbs(o)){var p=t.datavisualization.Diagram.Rectangle(0,0,14,14),w=t.datavisualization.Diagram.Rectangle(c/2*r,0,14,14),b=t.datavisualization.Diagram.Rectangle(0,l/2*r,14,14);s=this._resizeHandleVisiblity(p,w,b)}v=t.datavisualization.Diagram.Point(c*y.x,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&n.type!="umlclassifier"&&(a=0,s=="hidden"&&(a=-20),this._updateRotateHandle("rotate",v.x,v.y+a,r,i,n),this._updatePivotLine(n,i,r,undefined,a));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(n.type!="umlclassifier"&&(n._type=="label"&&(h=!(n.constraints&t.datavisualization.Diagram.LabelConstraints.Resizable)),this._updateResizeCorner("nw-resize",0,0,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest)),this._updateResizeCorner("n-resize",c/2*r,0,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth)),this._updateResizeCorner("ne-resize",c*r,0,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast)),this._updateResizeCorner("w-resize",0,l/2*r,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest)),this._updateResizeCorner("e-resize",c*r,l/2*r,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast)),this._updateResizeCorner("sw-resize",0,l*r,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest)),this._updateResizeCorner("s-resize",c/2*r,l*r,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth)),this._updateResizeCorner("se-resize",c*r,l*r,i,s,f,e,o,n._type=="label"?h:!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast))),this._updateResizeBorder("resizeBorder",n,i,r))}},_resizeHandleVisiblity:function(n,i,r){var f=t.datavisualization.Diagram.Geometry.intersectsRect(n,i),e=t.datavisualization.Diagram.Geometry.intersectsRect(n,r),u="visible";return(f===!0||e===!0)&&(u="hidden"),u},_updateRotateHandle:function(n,t,i,r,u){var f=20,e=20,o={id:"rotatehandle",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"};u.path(o);u.circle({id:"rotate",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"})},_updatePivotLine:function(n,i,r,u,f){var o=n.width?n.width:n._width,c=n.height?n.height:n._height,e=n.pivot?n.pivot:{x:.5,y:.5},s=t.datavisualization.Diagram.Point(o*e.x,-20/r),h,l;f&&(s.y+=f);h=u?t.datavisualization.Diagram.Point(o*e.x,c*e.y):t.datavisualization.Diagram.Point(o*e.x,0);l=i.line({id:"pivotLine",x1:s.x*r,y1:s.y*r,x2:h.x*r,y2:h.y*r})},_updateResizeBorder:function(n,i,r,u){var f=i.width?i.width:i._width,e=i.height?i.height:i._height,o;i.type=="umlclassifier"?o=t.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(n,i,r,u):r.rect({id:n,width:f*u,height:e*u})},_updateResizeCorner:function(n,i,r,u,f,e,o,s,h){var c={id:n,cx:i,cy:r,visibility:f};c=this._setPadding(c);t.datavisualization.Diagram.Util.canShowResizeThumbs(s)&&(o&&e!=n?c.visibility="hidden":(c.visibility=="visible"||o)&&(c.visibility="visible"));u.circle(c);c={id:n+"_transparent",cx:c.cx,cy:c.cy,visibility:c.visibility};c["pointer-events"]=c.visibility==="hidden"||h?"none":"all";u.circle(c)},_updateEndPointHandle:function(n,i,r){for(var u,e,o=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),f=0;f<n.segments.length;f++)u=n.segments[f],e=u.points,f==n.segments.length-1?(this._updateEndPointCorner("targetEndPoint",e[e.length-1].x*r,e[e.length-1].y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._updateTerminalOrthoThumbs(u,i,r,f,o)):u.type!="orthogonal"?this._updateSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._updateTerminalOrthoThumbs(u,i,r,f,o),f==0&&this._updateEndPointCorner("sourceEndPoint",e[0].x*r,e[0].y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),u.type=="bezier"&&(this._updateEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,o),this._updateEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,o),this._updateBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i),this._updateBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i))},_updateEndPointCorner:function(n,t,i,r,u,f){var e=r?"#8CC63F":"white",o;f||(e="darkgray");o={id:n,fill:e,cx:t,cy:i};u.circle(o)},_updateSegmentEndThumb:function(n,t,i,r,u){var f={id:n,cx:t,cy:i};u.circle(f)},_updateOrthoThumb:function(n,t,i,r,u,f,e){var c="#e2e2e2",o,s,h,l;e||(c="darkgray");f=="horizontal"?(o="M0,7 L15,0 L30,7 L15,14 z",s=-15,h=-7):(o="M7,0 L0,15 L7,30 L14,15 z",s=-7,h=-15);l={id:n,visibility:u,transform:"translate("+(t+s)+","+(i+h)+")",d:o,fill:c};r.path(l)},_updateTerminalOrthoThumbs:function(n,i,r,u,f){var o,e,h,s;if(n.points.length>2)for(e=0;e<n.points.length-1;e++)s=t.datavisualization.Diagram.Geometry.distance(n.points[e],n.points[e+1]),o=n.points[e].y.toFixed(2)==n.points[e+1].y.toFixed(2)?"horizontal":"vertical",h=s>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+e+"_"+u,(n.points[e].x+n.points[e+1].x)/2*r,(n.points[e].y+n.points[e+1].y)/2*r,i,h,o,f);else s=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),o=n._startPoint.y.toFixed(2)==n._endPoint.y.toFixed(2)?"horizontal":"vertical",h=s>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,h,o,f)},_updateBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r})},_updateControlPointCorner:function(n,t,i,r){r.circle({id:n+"_"+i,cx:t.x,cy:t.y})},updateUserHandles:function(n,i,r,u,f,e,o){var h=r.document.getElementById(r.document.id+"userHandle_g"),s;if(o.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles)if(h){if(n&&n.length>0)for(s=0;s<n.length;s++)(u&&n[s].enableMultiSelection||!u)&&this._updateHandle(n[s],i,r,f,e,o)}else this.renderUserHandles(n,i,r,u,e,o._adornerLayer,o)},_updateHandle:function(n,i,r,u,f,e){var s,o,h,c;!u&&i&&n.visible?(s=this._getHandlePosition(n,i,f,null,e),o=n._absolutePath,o&&n.size==n._size||(o=n._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(0,0,n.size/2,n.size/2,n.pathData,r)),n._size=n._size,h=s.x*f,c=s.y*f,this._updateHandleShape(n,h,c,r),this._updateHanleIcon(n,o,r,h-n.size/4,c-n.size/4),r.getElementById(n.name+"_shape")&&n.visible&&(r.getElementById(n.name+"_shape").style.display="block",r.getElementById(n.name+"_icon").style.display="block")):r.getElementById(n.name+"_shape")&&(r.getElementById(n.name+"_shape").style.display="none",r.getElementById(n.name+"_icon").style.display="none")},clearSelector:function(n,t,i){var r=n.getElementById(n.document.id+"handle_g");r&&t.removeChild(r);r=n.getElementById(n.document.id+"userHandle_g");r&&t.removeChild(r);i&&(r=i._svg.getElementById(i.element[0].id+"_multiselector"),r&&r.parentNode.removeChild(r))},clearSegments:function(t){var i=t.getElementById(t.document.id+"handle_g");n(i).find(".segmentEnd").remove()},addSegments:function(n,t,i){var r=n.getElementById(n.document.id+"handle_g");this._renderSegmentHandle(t,n,i)},_renderSegmentHandle:function(n,i,r){var e,f,u,o;if(!n.isPhase)for(e=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),f=0;f<n.segments.length;f++)u=n.segments[f],u.type=="bezier"&&(this._renderBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i,e),this._renderBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i,e),this._renderEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,e),this._renderEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,e)),o=u.points,f===0||f===n.segments.length-1||(u.type!="orthogonal"?this._renderSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._renderTerminalOrthoThumbs(u,i,r,f,e))},_initializePageBreaks:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderVPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_renderPageSettingsRect:function(n,t,i,r,u,f,e){var o=i.rect({id:"pageback",x:n.x,y:n.y,width:t.x,height:t.y,style:"fill:"+f+";stroke:"+u+";stroke-width:"+e+""});r.appendChild(o)},_updatePageBakground:function(n,i,r,u,f,e,o){var s=r.document.getElementById("pageback"),h={x:n.x,y:n.y,width:i.x<0?0:i.x,height:i.y<0?0:i.y,style:"fill:"+e+";stroke:"+f+";stroke-width:"+o+""};s&&t.datavisualization.Diagram.Util.attr(s,h)},_renderHPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_removePageBreaks:function(n,t,i){t!=null&&i!=null&&i.removeChild(t)},removeChild:function(n,t){var u=t.svg.document.getElementById(n.name),f=t.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],e=this._findChild(f.childNodes,n),o=t.svg.document.parentNode.getElementsByClassName("AdornerLayer")[0],r,i;o&&(r=o.parentNode.getElementById(n.name+"_ej_ports"));u&&u.parentNode.removeChild(u);r&&r.parentNode.removeChild(r);e&&f.removeChild(e);n._type==="node"&&n.type==="html"&&(i=f.children[n.name+"_parentdiv"],i&&i.parentNode&&i.parentNode.removeChild(i))}};t.datavisualization.Diagram.DiagramContext={_renderNodes:function(n,t,i,r){var f,u,e,o,s;if(r.nodes())for(f=r.nodes(),u=0,e=f.length;u<e;++u)o=r.nameTable[f[u].name],s=n.svg||n._canvas,this._renderNodeObject(o,n,t,i,r)},_renderNodeObject:function(n,i,r,u,f){var e=i.svg||i._canvas;n._type!=="group"||n.parent?n.parent||i.context.renderNode(n,e,i.diagramLayer,null,f):(!n.container,i.context.renderGroup(n,e,i.diagramLayer,f.nameTable,f,r,u),t.datavisualization.Diagram.DiagramContext.update(n,f))},_renderConnectors:function(n,t){var r,e,u,i,f;if(t.connectors()){for(r=t.connectors(),e=n.svg||n._canvas,i=0,f=r.length;i<f;++i)u=r[i],t._setZorder(u);for(i=0,f=r.length;i<f;++i)u=r[i],this._renderConnectorObject(u,n,t)}},_renderConnectorObject:function(n,i,r){var u=i.svg||i._canvas;t.datavisualization.Diagram.Util.updateBridging(n,r);n.parent||i.context.renderConnector(n,u,i.diagramLayer,r)},updateViewPort:function(n){var i;n._svgParentDimention=null;n._views.forEach(function(r){i=n._views[r];i.context==t.datavisualization.Diagram.SvgContext&&i.type=="mainview"&&t.datavisualization.Diagram.PageUtil._updatePageSize(n)})},renderNode:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;i&&(i=u.document.getElementById(i.id));var e=r.type=="overview"?!0:!1;r.context.renderNode(n,u,i||r.diagramLayer,undefined,t,e)})},addLabel:function(n,t,i,r){var u,f;i._views&&i._views.forEach(function(e){u=i._views[e];f=u.svg||u.canvas;u.context._addLabel(n,t,f,i,r)})},renderPort:function(n,t,i,r){var u,e,f;i._views.forEach(function(o){u=i._views[o];f=u.type==="overview"?!0:!1;e=u.svg||u._canvas;u.context._insertPort(n,t,f?e:i._adornerSvg,r,i,f)})},renderConnector:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context.renderConnector(n,u,i||r.diagramLayer,t)})},renderGroup:function(n,t,i){var r,u;t._views.forEach(function(f){var e;r=t._views[f];u=r.svg||r._canvas;i=r.svg.getElementById(n.parent);r.type=="overview"&&(e=!0);r.context.renderGroup(n,u,i||r.diagramLayer,t.nameTable,t,null,e)})},update:function(n,t,i){var f=!0,r,u;n.isSwimlane&&t._disableSwimlaneUptate&&(f=!1);f&&t._views&&t._views.forEach(function(f){var e,o;r=t._views[f];u=r.svg||r._canvas;t&&!t._isInit&&n._status!=="new"&&(n._status="update");e=r.type=="overview"?!0:!1;n._type==="group"||n.type==="pseudoGroup"?r.context.updateGroup(n,u,t,i,e):n.segments?r.context.updateConnector(n,u,t,e):n._type=="label"?(o=t.findNode(n._parent),r.context.updateLabel(o,n,u,t)):r.context.updateNode(n,u,t,i,e)})},_refreshSegments:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;n.segments&&i.context._refreshSegments(n,r,t)})},_refreshOnlySegments:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;n.segments&&i.context._refreshOnlySegments(n,r,t)})},renderShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._renderShadow(n,r)})},updateShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._updateShadow(n,r)})},removeShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._removeShadow(n,r)})},addNodeLabel:function(n,t,i,r){var u,f;r._views&&r._views.forEach(function(e){u=r._views[e];f=u.svg||u.canvas;u.context.addNodeLabel(n,t,f,i,r)})},updateLabel:function(n,i,r){var u,f;r._views.forEach(function(e){u=r._views[e];f=u.svg||u.canvas;r.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg?u.context._updateSVGLabel(n,i,f,r):u.context.updateLabel(n,i,f,r)})},updatePort:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];var e=r.type==="overview"?!0:!1;u=e?r.svg||r.canvas:i._adornerSvg;r.context.updatePort(n,t,u,i)})},setLabelTemplate:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context._updateLabelTemplate(n,t,u,i)})},setNodeShape:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setNodeShape(n,u,i,t)})},setLine:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setLine(n,u,i,t)})},renderDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.renderDecorators(n,r,t)})},clearDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.clearDecorators(n,r,t)})},updateTargetDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateTargetDecoratorStyle(n,r)})},updateSourceDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateSourceDecoratorStyle(n,r)})},updateNodeStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateNodeStyle(n,r)})},updateLabelStyle:function(n,t,i){i._views.forEach(function(r){var u=i._views[r],f=u.svg||u.canvas;u.context.updateLabelStyle(n,t,f,i)})},updateConnectorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateConnectorStyle(n,r)})},updateTextBlock:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateTextBlock(n,t,u,i)})},updateBPMNNodeStyle:function(n,i){var f,u,r=0;if(n=t.datavisualization.Diagram.Util._updateBpmnChild(n,i),n.children)for(u=i._getChildren(n.children),r=0;r<u.length;r++)f=i.nameTable[u[r]],t.datavisualization.Diagram.DiagramContext.updateNodeStyle(f,i,n);else t.datavisualization.Diagram.DiagramContext.updateNodeStyle(n,i)},updateBPMNNodeShape:function(n,i){var f,r,u=0,e;if(n=t.datavisualization.Diagram.Util._updateBpmnChild(n,i),r=i._getChildren(n.children),r.length>0&&i.nameTable[r[0]])for(u=0;u<r.length;u++)f=i.nameTable[r[u]],f&&t.datavisualization.Diagram.DiagramContext.setNodeShape(f,i,n);else e=i._svg.getElementById(n.name),e.parentNode.removeChild(e),i.add(n)}}}(jQuery,Syncfusion),function(n,t,i){"use strict";t.widget("ejSymbolPalette","ej.datavisualization.SymbolPalette",{element:null,model:null,_requiresID:!0,validTags:["div"],nameTable:{},defaults:{width:"250px",height:"400px",labelRenderingMode:"html",paletteItemWidth:i,paletteItemHeight:i,previewWidth:i,previewHeight:i,previewOffset:{x:110,y:110},diagramId:"",headerHeight:30,selectedPaletteName:"",cssClass:"e-datavisualization-symbolpalette",showPaletteItemText:!0,allowDrag:!0,palettes:[],defaultSettings:{connector:null,node:null},selectionChange:null,create:null,destroy:null},_oldItem:null,_labelHashTable:{},dataTypes:{paletteItemWidth:"number",paletteItemHeight:"number",previewWidth:"number",previewHeight:"number",headerHeight:"number",showPaletteItemText:"boolean",allowDrag:"boolean",palettes:"array"},_canvas:null,_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this.nameTable={},this.selectedItem=null,this.activePalette=null,this._selectedElement=null,this._renderSymbolPalette(),this._wireEvents(),this.updateScrollerViewport())},_setModel:function(t){var i,r;for(i in t)switch(i){case"width":this._setWidth(t[i]);break;case"height":this._setHeight(t[i]);break;case"paletteItemWidth":this.model.paletteItemWidth=t[i];this._redrawContent();break;case"paletteItemHeight":this.model.paletteItemHeight=t[i];this._redrawContent();break;case"headerHeight":this._setHeaderHeight(t[i]);break;case"cssClass":this._setCssClass(t[i]);break;case"showPaletteItemText":this._showItemText(t[i]);break;case"allowDrag":this._setAllowDrag(t[i]);break;case"palettes":this._updatePalettes(t[i]);break;case"selectedPaletteName":r=this._getPalette(t.selectedPaletteName);r&&r!==this.activePalette&&(n(this._getPaletteHeaderDiv(this.activePalette.name)).removeClass("selected"),this.activePalette=r,n(this._getPaletteHeaderDiv(this.activePalette.name)).addClass("selected"))}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_renderSymbolPalette:function(){this._canvas=document.createElement("div");this._canvas.setAttribute("class","e-scanvas");this._canvas.setAttribute("id",this.element[0].id+"_canvas");this.element[0].setAttribute("style","height:"+this.model.height+"; width:"+this.model.width+";");this.element.append(this._canvas);this.element.ejScroller({width:this._setViewPortWidth(),height:this._setViewPortHeight(),enableTouchScroll:!1});this._renderPalettes()},_updatePalettes:function(t){this.model.palettes=t;n("#"+this.element[0].id+"_canvas").empty();this._renderPalettes();this.updateScrollerViewport()},_renderPalettes:function(){var i=this.model.palettes,n,r;if(i)for(n=0,r=i.length;n<r;n++)i[n]=t.datavisualization.Diagram.Palette(i[n]),this._initPaletteitems(i[n]),this._renderPalette(i[n])},_updatePaletteItemWidth:function(n){var i=t.datavisualization.Diagram.Util.bounds(n);n.segments?i.width>this.element.width()-40&&!n.paletteItem&&t.datavisualization.Diagram.Util.scale(n,(this.element.width()-45)/i.width,1,i.center):n.width>this.element.width()-40?n.width=this.element.width()-40:n.paletteItem&&n.paletteItem.width&&n.paletteItem.width>this.element.width()-40&&(n.paletteItem.width=this.element.width()-40)},_renderHtmlLayer:function(n,i){var r=document.createElement("div"),f={id:n.id+"_htmlLayer","class":"htmlLayer"},u;return t.datavisualization.Diagram.Util.attr(r,f),u=r,r.style.pointerEvents="none",r.style.position="absolute",r.style.left=i?i.style.paddingLeft:"0px",r.style.top=i?i.style.paddingTop:"0px",n.appendChild(u),u},_initPaletteitems:function(n){if(n.items)for(var t=0;t<n.items.length;t++)n.items[t]=this._extendPaletteItem(n.items[t])},_initGroupNode:function(i){for(var r=null,f=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,e=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null,u=0;u<i.children.length;u++)r=i.children[u],typeof r=="object"&&(r._type=="group"?(r=t.datavisualization.Diagram.Group(n.extend(!0,{},f,r)),r=t.datavisualization.Diagram.Util._updateBpmnChild(r,this),this._initGroupNode(r)):r=r.segments?t.datavisualization.Diagram.Connector(n.extend(!0,{},e,r)):t.datavisualization.Diagram.Node(n.extend(!0,{},f,r)),r=t.datavisualization.Diagram.NodeType(r,this),r.parent=i.name,i.children[u]=r,this.nameTable[r.name]=r)},_setViewPortWidth:function(){this.element[0].setAttribute("style","width:"+this.model.width+";");var n=this.element.width();return Math.abs(n)},_setViewPortHeight:function(){this.element[0].setAttribute("style","height:"+this.model.height+";");var n=this.element.height();return Math.abs(n)},_renderPalette:function(n){this._renderHeader(n);this._updateHeaderWrapper(n,this.model.headerHeight);this._renderContent(n);this._collapse(n);this._updatePaletteVisibility(n)},_renderHeader:function(i){var r=document.createElement("div"),u={id:i.name.replace(/\s/gi,"_")+"_header","class":"e-header",style:"height:"+this.model.headerHeight+"px;"};i.constraints&this._canHeaderVisible(i)||(u.style+="display:none");t.datavisualization.Diagram.Util.attr(r,u);this._renderHeaderArrow(r,i.expanded,i.name,this._canExpand(i));i.templateId&&n.templates?this._renderHeaderTemplate(r,i):this._renderHeaderText(r,i.name);this._addExpandedClass(r,i.expanded);this._disableClickClass(r,this._canExpand(i));this.model.selectedPaletteName===i.name&&(n(r).addClass("selected"),this.activePalette=i);this._canvas.appendChild(r)},_renderHeaderText:function(n,t){var i=document.createElement("span");i.setAttribute("class","e-header-text");i.innerHTML=t;n.appendChild(i)},_renderHeaderTemplate:function(n,i){var u=this._renderEjTemplate("#"+i.templateId,i),r=document.createElement("div"),f={id:i.name+"_Wrapper","class":"e-header-wrapper"};t.datavisualization.Diagram.Util.attr(r,f);this._renderTemplateContent(i,r,u);n.appendChild(r)},_renderTemplateContent:function(i,r,u){var f=document.createElement("div"),e;f.innerHTML=u;f.style.display="inline-block";document.body.appendChild(f);e=f.cloneNode(!0);e.id=i.name+"_templateHeader";var o=f.offsetWidth,h=f.offsetHeight,c=n("#"+this._id).width()-18/o,l=this.model.headerHeight/h,s=Math.min(c,l),a=(s-1)*o/2;t.datavisualization.Diagram.Util.attr(e,{style:"position: relative; left: "+a+"px; transform: scale("+s+")"});r.appendChild(e);f.parentNode.removeChild(f)},_renderHeaderArrow:function(t,i,r,u){var f,e;u?(f=t.getElementsByClassName("e-header-arrow e-icon")[0],f||(f=document.createElement("span"),f.setAttribute("class","e-header-arrow e-icon"),f.setAttribute("style","top:"+(this.model.headerHeight-16)/2+"px;"),this._addExpandedClass(f,i),this.model.selectedPaletteName===name&&n(f).addClass("selected"),t.appendChild(f))):(e=t.getElementsByClassName("e-header-arrow e-icon")[0],e&&e.parentNode.removeChild(e))},_renderContent:function(n){var r=this._getPaletteContentDiv(n.name),t,i,u;if(r||(r=document.createElement("div"),this._canvas.appendChild(r)),r.setAttribute("id",n.name.replace(/\s/gi,"_")+"_content"),r.setAttribute("class","e-scontent"),this.model.palettes.length-1===this.model.palettes.indexOf(n)&&r.setAttribute("style","border-bottom-width: 0px;"),t=n.items,t&&t.length>0)for(i=0,u=t.length;i<u;i++)t[i].parent?this.nameTable[t[i].name]=t[i]:(this._renderItem(t[i],r),this.nameTable[t[i].name]=t[i])},_getPaletteContentDiv:function(t){return n(this.element).find("#"+t.replace(/\s/gi,"_")+"_content")[0]},_getPaletteHeaderDiv:function(t){return n(this.element).find("#"+t.replace(/\s/gi,"_")+"_header")[0]},_updateRenderSize:function(n,i,r){var f,e,u;if(n.paletteItem&&(n.type!=="group"||n.isLane)&&(n._type!=="group"||n.type!=="bpmn"))if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase){var u=t.datavisualization.Diagram.Util.bounds(n),o=(n.paletteItem.width?n.paletteItem.width:this.model.paletteItemWidth)/u.width,s=(n.paletteItem.height?n.paletteItem.height:this.model.paletteItemHeight)/u.height;t.datavisualization.Diagram.Util.scale(n,o,s,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase||n.isPhase&&n.paletteItem.width!=n.paletteItem.height){var u=t.datavisualization.Diagram.Util.bounds(n),o=(n.paletteItem.width?n.paletteItem.width:this.model.paletteItemWidth)/u.width,s=(n.paletteItem.height?n.paletteItem.height:this.model.paletteItemHeight)/u.height;t.datavisualization.Diagram.Util.scale(n,o,s,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else n._type=="node"&&this._checkItemUpdate(n)&&(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2);else n.segments?(u=t.datavisualization.Diagram.Util.bounds(n),t.datavisualization.Diagram.Util._translate(n,i.width/2-u.center.x,i.height/2-u.center.y,this.nameTable)):n._type=="group"?this._checkItemUpdate(n)?(f=i.width/n.width,e=i.height/n.height,this.scale(n,f,e,n.pivot,r,null,null,null,this),t.datavisualization.Diagram.Util._translate(n,i.width/2-n.offsetX,i.height/2-n.offsetY,r,null,this)):t.datavisualization.Diagram.Util._translate(n,n.width/2-n.offsetX,n.height/2-n.offsetY,r,null,this):(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2)},_checkItemUpdate:function(n){return(n.paletteItem&&n.paletteItem.enableScale)?!1:!0},_updatePreviewSize:function(n,i){var u,f,r;if(n.paletteItem&&(n.type!=="group"||n.isLane))if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase){var r=t.datavisualization.Diagram.Util.bounds(n),e=(n.paletteItem.previewWidth?n.paletteItem.previewWidth:this.model.previewWidth)/r.width,o=(n.paletteItem.previewHeight?n.paletteItem.previewHeight:this.model.previewHeight)/r.height;t.datavisualization.Diagram.Util.scale(n,e,o,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase||n.isPhase&&n.paletteItem.previewWidth!=n.paletteItem.previewHeight){var r=t.datavisualization.Diagram.Util.bounds(n),e=(n.paletteItem.previewWidth?n.paletteItem.previewWidth:this.model.previewWidth)/r.width,o=(n.paletteItem.previewHeight?n.paletteItem.previewHeight:this.model.previewHeight)/r.height;t.datavisualization.Diagram.Util.scale(n,e,o,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else(n._type=="node"||n._type=="group")&&(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2);else n.segments?(r=t.datavisualization.Diagram.Util.bounds(n),t.datavisualization.Diagram.Util._translate(n,i.width/2-r.center.x,i.height/2-r.center.y,this.nameTable)):n.container&&!n.isLane?(u=i.width/n.width,f=i.height/n.height,this.scale(n,u,f,n.pivot,this.nameTable,null,null,null,this),t.datavisualization.Diagram.Util._translate(n,i.width/2-n.offsetX,i.height/2-n.offsetY,this.nameTable,null,this)):(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2)},_getRenderItemSize:function(n){var i=this.model.paletteItemWidth,r=this.model.paletteItemHeight,o,s,f,e,u;return n.segments?(u=t.datavisualization.Diagram.Util.bounds(n),n.paletteItem?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:n.width,r=r?r:n.height,n.paletteItem.width=i,n.paletteItem.height=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=i?i:u.width,r=r?r:u.height)):n.type==="group"?(u=t.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.paletteItem&&!n.isLane?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.width=i,n.paletteItem.height=r):n.paletteItem&&n.isLane?n.paletteItem.enableScale?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.width=i,n.paletteItem.height=r):(o=(n.paletteItem.width?n.paletteItem.width:this.model.paletteItemWidth)/n.width,s=(n.paletteItem.height?n.paletteItem.height:this.model.paletteItemHeight)/n.height,t.datavisualization.Diagram.Util.scale(n,o,s,{x:.5,y:.5},this.nameTable,!1,!1,!1,this),f=.0001,e=.001,n.isLane&&n.paletteItem&&!n.paletteItem.enableScale&&(n.orientation==="horizontal"?f-=2.2:f+=.8,e-=1),t.datavisualization.Diagram.Util._translate(n,f,e,this.nameTable,!1,this),i=n.width?n.width:i,r=n.height?n.height:r):(i=i?i:u.width,r=r?r:u.height)):n.paletteItem?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:n.width,r=r?r:n.height,n.paletteItem.width=i,n.paletteItem.height=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=u.width?u.width:i,r=u.height?u.height:r),{width:i,height:r}},_renderPetternDefinition:function(n,t){if(n&&t){var i=t.document.getElementById(n+"patterndefinition");i||(i=t.defs({id:n+"patterndefinition"}),t.appendChild(i))}},_cloneFromChildTable:function(i,r){for(var u,f=0;i.children&&f<i.children.length;f++)u=n.extend(!0,{},this.nameTable[t.datavisualization.Diagram.Util.getChild(i.children[f])]),u&&(r[t.datavisualization.Diagram.Util.getChild(i.children[f])]=u,u.children&&u.children.length>0&&this._cloneFromChildTable(u,r));return r},_renderItem:function(t,i){var r=n.extend(!0,{},t),u=this._getRenderItemSize(r),e=this._cloneFromChildTable(t,{}),f;return this._updateRenderSize(r,u,e),f=this._renderItemContainer(r.name,i,null,u,r),r.segments?this._renderConnector(r,f,u):r._type!="node"||r.children&&r.children.length>0?this._renderGroup(r,f,u,e):this._renderNode(r,f,u),r.isLane&&r.paletteItem&&!r.paletteItem.enableScale&&r.orientation==="vertical"&&f.document.setAttribute("height",u.height+2),r},_getPreviewItemSize:function(n){var i=this.model.previewWidth,r=this.model.previewHeight,u;return n.segments?(u=t.datavisualization.Diagram.Util.bounds(n),n.paletteItem?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:n.width,r=r?r:n.height,i=i?i:u.width,r=r?r:u.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=i?i:u.width,r=r?r:u.height)):n.type==="group"?(u=t.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.paletteItem&&!n.isLane?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):n.paletteItem&&n.isLane?n.paletteItem.enableScale?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r):(i=i?i:u.width,r=r?r:u.height)):n.paletteItem?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:n.width,r=r?r:n.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=u.width?u.width:i,r=u.height?u.height:r),{width:i,height:r}},_renderItemContainer:function(n,i,r,u,f){var e=document.createElement("div"),o=this.model.showPaletteItemText?u.height+18:u.height,s=u.width,h=f&&f.paletteItem?f.paletteItem.margin.left:4,c=f&&f.paletteItem?f.paletteItem.margin.top:4,l=f&&f.paletteItem?f.paletteItem.margin.right:4,a=f&&f.paletteItem?f.paletteItem.margin.bottom:4,v={id:n+"_paletteItem",draggable:"true",height:o+"px",width:s+"px","class":"e-paletteItem",style:"padding-left:"+h+"px;padding-right:"+(l+2)+"px;padding-top:"+(c+1)+"px;padding-bottom:"+(a+1)+"px;height:"+(o+1)+"px;width:"+(s+1)+"px;-ms-touch-action: none;touch-action: none;"};return t.datavisualization.Diagram.Util.attr(e,v),i.appendChild(e),this.model.allowDrag&&this._setItemDraggable(e),this._renderAnchor(e,n,u,f)},_renderAnchor:function(n,i,r,u){var f=document.createElement("div"),o={id:i+"_anchor",height:r.height+"px","class":"e-anchor"},e;return t.datavisualization.Diagram.Util.attr(f,o),n.appendChild(f),e=this._renderSvg(f,i,r),this._renderText(f,i,r,u),e},_renderSvg:function(i,r,u){var s,f=document.createElement("div"),e={id:r+"_svgWrapper",width:this.model.paletteItemWidth+"px;",height:+this.model.paletteItemHeight+"px;","class":"e-svg-container",style:"width:"+u.width+"px;height:"+u.height+"px;"},o;return t.datavisualization.Diagram.Util.attr(f,e),e={id:r+"_svg",width:u.width,height:u.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},o=new t.datavisualization.Diagram.Svg(e),f.appendChild(o.document),i.id.split("_clone").length>1&&(s=n(i).parents(".e-paletteItem")[0]),this._renderHtmlLayer(f,s),i.appendChild(f),o},_renderText:function(n,i,r,u){var e=document.createElement("div"),f,o,s;e.setAttribute("class","e-text-container");e.setAttribute("style","width:"+r.width+"px; text-align : center;overflow: hidden;text-overflow: ellipsis;font-size: 12px;");f=document.createElement("span");f.setAttribute("class","e-paletteItemText");u&&u.paletteItem&&(i=u.paletteItem.label?u.paletteItem.label:i);f.innerHTML=i.split("_clone").length>1?i.split("_clone")[0]:i;u&&u.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap&&(f.style.whiteSpace="nowrap",f.style.wordWrap="normal");u&&u.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap&&(f.style.whiteSpace="pre-wrap",f.style.wordBreak="break-all",f.style.wordWrap="break-word");u&&u.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow&&(f.style.whiteSpace="pre-wrap",f.style.wordWrap="break-word");e.appendChild(f);this.model.showPaletteItemText||(e.style.display="none");n.appendChild(e);u&&!u.paletteItem.enableScale&&(o=document.getElementById(u.name+"_paletteItem"),s=document.getElementById(u.name+"_anchor").lastChild.getBoundingClientRect(),o.style.height=r.height+s.height+"px")},_renderNode:function(n,i,r){this._renderPetternDefinition(i.id+"_"+n.name,i);var f=t.datavisualization.Diagram.SvgContext.renderNode(n,i,null,!0,this),u=!1;i.document.getAttribute("drag")!=null&&(u=!0);this._transformItem(f,n.width,n.height,n,u,r)},_updateChildBounds:function(n,i){var u=null,f,r;if(n._type=="group"){for(f=this._getChildren(n.children),r=0;r<f.length;r++)u=i[f[r]],u.shape=="group"&&this._updateChildBounds(u,i);t.datavisualization.Diagram.Util._updateChildBounds(n,this)}},_getChild:function(n){return t.datavisualization.Diagram.Util.getChild(n)},_getChildren:function(n){var i,r,t;if(n){for(i=[],r=0;r<n.length;r++)t=n[r],t&&(typeof t=="object"?i.push(t.name):typeof t=="string"&&i.push(t));return i}},_renderGroup:function(n,i,r,u){this._renderPetternDefinition(i.id+"_"+n.name,i);u||(u=this.nameTable);(!n.container||n.isLane)&&this._updateChildBounds(n,u);var e=t.datavisualization.Diagram.SvgContext.renderGroup(n,i,null,u,this,!1,!0),f=!1;i.document.getAttribute("drag")!=null&&(f=!0);this._transformItem(e,n.width,n.height,n,f,r)},_renderConnector:function(n,i,r){var e=t.datavisualization.Diagram.SvgContext.renderConnector(n,i,null,this),u=t.datavisualization.Diagram.Util.bounds(n),f=!1;i.document.getAttribute("drag")!=null&&(f=!0);this._transformItem(e,u.width,u.height,n,f,r)},_wireEvents:function(){this._on(this.element,t.eventType.click,".e-header",this._headerClick);this._on(this.element,t.eventType.mouseDown,".e-header",this._headerMouseDown);this._on(this.element,"mouseover",".e-header",this._headerMouseOver);this._on(this.element,"mouseout",".e-header",this._headerMouseOut);this._on(this.element,t.eventType.mouseDown,".e-paletteItem",this._itemMouseDown);this._on(this.element,"mouseover",".e-paletteItem",this._itemMouseOver);this._on(this.element,"mouseout",".e-paletteItem",this._itemMouseOut);this._on(this.element,t.eventType.click,".e-anchor",this._itemClick)},_headerClick:function(n){this._expandOrCollapsePalette("",n.currentTarget);var t=this._getActivePalette(n.currentTarget.id);t&&t!==this.activePalette&&(this.activePalette=t)},_headerMouseDown:function(n){n.preventDefault();n.stopPropagation()},_headerMouseOver:function(t){var i=this._getActivePalette(t.currentTarget.id);i&&this._canExpand(i)&&(n(t.currentTarget).addClass("hover"),n(t.currentTarget).find(".e-header-arrow").addClass("hover"))},_headerMouseOut:function(t){n(t.currentTarget).removeClass("hover");n(t.currentTarget).find(".e-header-arrow").removeClass("hover")},_itemMouseDown:function(i){var r,u,s,e,f,h,o;if(this.model.diagramId&&(r=n("#"+this.model.diagramId).ejDiagram("instance"),r.activeTool instanceof t.datavisualization.Diagram.LineTool&&(r.activeTool._showAllPorts(!0),r.deactivateTool())),this.model.allowDrag||(i.preventDefault(),i.stopPropagation()),this._selectedElement?this._selectedElement!==i.currentTarget&&(n(this._selectedElement).removeClass("selected"),this._selectedElement=i.currentTarget):this._selectedElement=i.currentTarget,n(i.currentTarget).hasClass("selected")||n(i.currentTarget).addClass("selected"),u=this._getActivePalette(i.currentTarget.parentElement.id),u&&u!==this.activePalette&&(this._clearHeaderSelection(),this._updateHeaderSelection(n(i.currentTarget.parentElement).prev()),this.activePalette=u),this.activePalette&&this._selectedElement)for(s=this._selectedElement.id.slice(0,this._selectedElement.id.lastIndexOf("_")),e=this.activePalette.items,f=0,h=e.length;f<h;f++)o=e[f],o.name===s&&(this.selectedItem=o)},_itemMouseOver:function(t){n(t.currentTarget).addClass("hover")},_itemMouseOut:function(t){n(t.currentTarget).removeClass("hover")},_itemDraStart:function(n){var t=n.originalEvent.dataTransfer;t.setData("Text",this.element[0].id);t.effectAllowed="copy"},_itemClick:function(i){var u,r,l,h,s,f,a,e,o,v,c,y;if((i.type==="click"||i.type==="touchend"&&!n(".dragClone")[0])&&this.model.diagramId){if(u=n("#"+this.model.diagramId).ejDiagram("instance"),r=n.extend(!0,{},this.selectedItem),r.name+=t.datavisualization.Diagram.Util.randomId(),r.type=="bpmn"&&(r.children=[]),l=u.getObjectType(r),l=="group"){for(h=this._getChildren(r.children),s=0;s<h.length;s++)f=n.extend(!0,{},this.nameTable[h[s]]),f.parent=r.name,f.name=r.name+f.name,r.children[s]=f.name,u.nameTable[f.name]=f,u.nodes().push(f),u._nodes=n.extend(!0,[],u.nodes()),u.nameTable[f]&&u._updateQuad(u.nameTable[f]);r.isLane||(r.height=r.width=0,u._updateChildBounds(r,u.nameTable))}r&&r.isLane&&(a=t.datavisualization.Diagram.Util.randomId(),u._cloneGroupNode(r,a),e=t.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(r,u.nameTable),e.isLane=r.isLane,e.orientation=r.orientation,e.height=120,e=t.datavisualization.Diagram.Lane(e),o=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(e,u,null,!0),o&&(o.offsetX+=10,o.offsetY+=40));v=n.extend(!0,{},this._oldItem);c=o?o:r;this._oldItem=n.extend(!0,{},c);y={oldElement:v,newElement:c};this._trigger("selectionChange",y)}},_updatePaletteVisibility:function(n){this._canHeaderVisible(n)&&(this._canPaletteVisible(n)?(this._getPaletteHeaderDiv(n.name).style.display="",this._getPaletteContentDiv(n.name).style.display=""):(this._getPaletteHeaderDiv(n.name).style.display="none",this._getPaletteContentDiv(n.name).style.display="none"))},_collectionChanged:function(n){var t,i,r;n.changeType=="insert"?this._renderPalette(n.element):n.changeType=="remove"&&(t=n.element,t!=null&&(i=this._getPaletteHeaderDiv(t.name),i&&i.parentNode.removeChild(i),r=this._getPaletteContentDiv(t.name),r&&r.parentNode.removeChild(r)))},_extendPaletteItem:function(i){var r=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,u=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null;return i.shape&&typeof i.shape=="object"?t.datavisualization.Diagram.Util._updateShapeProperties(i):i=t.datavisualization.Diagram.NodeType(i,this),i.type=="connector"?i=t.datavisualization.Diagram.Connector(n.extend(!0,{},u,i)):i.isLane?i=t.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(i,this.nameTable):i.type=="phase"?i=t.datavisualization.Diagram.Util._mapPalettePhase(i):i.container?i=t.datavisualization.Diagram.ContainerHelper._initContainer(this,i):i._type==="group"||i.children&&i.children.length>0?(i=t.datavisualization.Diagram.Group(n.extend(!0,{},r,i)),i=t.datavisualization.Diagram.Util._updateBpmnChild(i,this),this._getNewGroup(i),this._initGroupNode(i,this),t.datavisualization.Diagram.Util._updateGroupBounds(i,this)):i=t.datavisualization.Diagram.Node(n.extend(!0,{},r,i)),i},addPaletteItem:function(n,t){for(var i,u,r,o,f,e=0;e<this.model.palettes.length;e++)for(i=[],t.length?i=t:i.push(t),u=0;u<i.length;u++)f=this.model.palettes[e],f.name===n&&(r=this._extendPaletteItem(i[u]),f.items.push(r),o=this._getPaletteContentDiv(n),this.nameTable[r.name]=r,this._renderItem(r,o))},removePaletteItem:function(i,r){for(var f,o,u,s,e,a,h,c,l=0;l<this.model.palettes.length;l++)for(f=[],r.length?f=r:f.push(r),o=0;o<f.length;o++)if(c=this.model.palettes[l],c.name===i){if(u=f[o],t.datavisualization.Diagram.Util.removeItem(c.items,u),delete this.nameTable[u.name],u.children&&u.children.length)for(s=0;s<u.children.length;s++)e=u.children[s],e&&(typeof e=="object"?delete this.nameTable[e.name]:delete this.nameTable[e]);h=this._getPaletteContentDiv(i);a=n(h).find("#"+u.name+"_paletteItem")[0];a&&(h.removeChild(a),this.selectedItem=null)}},expandPalette:function(n){var t=this._findPalette(n);t&&!t.expanded&&this._canExpand(t)&&(t.expanded=!0,this._expandOrCollapsePalette(n))},collapsePalette:function(n){var t=this._findPalette(n);t&&t.expanded&&this._canExpand(t)&&(t.expanded=!1,this._expandOrCollapsePalette(n))},addPalette:function(n){this.model.palettes.push(n);this._renderPalette(n)},removePalette:function(n){for(var r,u,i,f=0;f<this.model.palettes.length;f++)i=this.model.palettes[f],i.name===n&&(t.datavisualization.Diagram.Util.removeItem(this.model.palettes,i),r=this._getPaletteHeaderDiv(i.name),r&&r.parentNode.removeChild(r),u=this._getPaletteContentDiv(i.name),u&&u.parentNode.removeChild(u))},setWidth:function(n){this.model.width=n;this._setWidth(n)},setHeight:function(n){this.model.height=n;this._setHeight(n)},setPaletteItemWidth:function(n){this.model.paletteItemWidth=n;this._redrawContent()},setPaletteItemHeight:function(n){this.model.paletteItemHeight=n;this._redrawContent()},setHeaderHeight:function(n){this.model.headerHeight=n;this._setHeaderHeight(n)},setCssClass:function(n){this._setCssClass(n);this.model.cssClass=n},showPaletteItemText:function(n){this._showItemText(n);this.model.showPaletteItemText=n},searchPalette:function(n,i){var r=new t.datavisualization.Diagram.Collection;return i!=""&&(n=this._getSearchPaletteItems(i),r.add(n)),r},updatePalette:function(n,t){var r=this._findPalette(n),u,f;r&&t&&(t.constraints&&r.constraints!=t.constraints&&(r.constraints=t.constraints,u=this._getPaletteHeaderDiv(r.name),this._renderHeaderArrow(u,r.expanded,r.name,this._canExpand(r)),this._disableClickClass(u,this._canExpand(r)),this._updatePaletteVisibility(r),u.style.display=this._canHeaderVisible(r)&&this._canPaletteVisible(r)?"":"none"),t.expanded!=i&&this._canExpand(r)&&(r.expanded=t.expanded,this._expandOrCollapsePalette(n)),t.items&&t.items.length>0&&(f=this._getPaletteContentDiv(r.name),f.innerHTML="",r.items=t.items,this._initPaletteitems(r),this._renderContent(r)));this.updateScrollerViewport()},_findPalette:function(n){for(var i,t=0;t<this.model.palettes.length;t++)if(this.model.palettes[t].name==n||this.model.palettes[t].name==n.replace(/\_/gi," ")){i=this.model.palettes[t];break}return i},_canExpand:function(n){return n.constraints&t.datavisualization.Diagram.PaletteConstraints.Expandable},_canHeaderVisible:function(n){return n.constraints&t.datavisualization.Diagram.PaletteConstraints.HeaderVisibility},_canPaletteVisible:function(n){return n.constraints&t.datavisualization.Diagram.PaletteConstraints.Visible},_canClick:function(n){var t,i;if(n&&(t=n.id.split("_header")[0],t&&(i=this._findPalette(t),this._canExpand(i))))return!0},_expandOrCollapsePalette:function(t,i){var i=i||(t?this._getPaletteHeaderDiv(t):null),r;if(i)if(this._canClick(i))r=this,n(i).next(".e-scontent").slideToggle(200,function(){r._refresh()}),this._updateHeaderState(i);else return!1},_getSearchPaletteItems:function(n){for(var f=new t.datavisualization.Diagram.Palette,u=this.model.palettes,r,i=0;i<u.length;i++)if(u[i].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0)for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display="block";else for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display=u[i].items[r].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0?"block":"none";return f},_disableClickClass:function(t,i){i?n(t).removeClass("e-disableclick"):n(t).addClass("e-disableclick")},_addExpandedClass:function(t,i){i?n(t).addClass("expanded"):n(t).addClass("collapsed")},_collapse:function(t){t.expanded||n(this._getPaletteHeaderDiv(t.name)).next(".e-scontent").slideToggle(10)},_transformItem:function(n,i,r,u,f,e){var h,v;if(!f)if(e&&!u.segments&&u.paletteItem&&u.paletteItem.width&&u.paletteItem.height&&u.paletteItem.enableScale){var k=30*e.width/100,d=30*e.height/100,o=(e.width-k)/u.width,s=(e.height-d)/u.height;o=s=Math.min(o,s);o=o>1?1:o;s=s>1?1:s;var c=e.width/2-i*o/2,l=e.height/2-r*s/2,a="";a+="translate("+c+","+l+")";a+="scale("+o+","+s+")";n.setAttribute("transform",a);h=n.parentNode.nextSibling;h||(h=document.getElementById(n.id+"_svgWrapper_htmlLayer"));h.style.webkitTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.MozTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.OTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.msTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.transform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";u&&t.browserInfo().name==="msie"&&u._type=="group"&&u.type==="html"&&(v=document.getElementById(u.name+"_html"),v.setAttribute("style","zoom:"+scale+";"))}else if(u.segments){if(e&&u.paletteItem&&u.paletteItem.width&&u.paletteItem.height||u.isPhase&&u.paletteItem&&u.paletteItem.enableScale){var k=e.width/10,d=e.height/10,o=(e.width-k)/i,s=(e.height-d)/r;o=s=Math.min(o,s);o=o>1?1:o;s=s>1?1:s;var c=e.width/2-i*o/2,l=e.height/2-r*s/2,a="";a+="translate("+c+","+l+")";a+="scale("+o+","+s+")";n.setAttribute("transform",a);h=document.getElementById(n.id+"_svgWrapper_htmlLayer");h.style.webkitTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.MozTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.OTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.msTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.transform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";u&&t.browserInfo().name==="msie"&&u._type=="group"&&u.type==="html"&&(v=document.getElementById(u.name+"_html"),v.setAttribute("style","zoom:"+scale+";"))}}else{var y=i/(i+u.borderWidth*3),p=r/(r+u.borderWidth*3),w=(i-i*y)/2,b=(r-r*p)/2;n.childNodes[0].setAttribute("transform","scale("+y+","+p+") translate("+w+","+b+")");u&&u.type==="image"&&n.childNodes[1]?n.childNodes[1].setAttribute("transform","scale("+y+","+p+") translate("+w+","+b+")"):u&&u._type==="group"&&n.setAttribute("transform","scale("+y+","+p+") translate("+w+","+b+")")}},_getScaleFactor:function(n,t){var u=30*this.model.paletteItemWidth/100,f=30*this.model.paletteItemHeight/100,i=(this.model.paletteItemWidth-u)/n,r=(this.model.paletteItemHeight-f)/t;return i=i>1?1:i,r=r>1?1:r,Math.min(i,r)},_getTranslateFactor:function(){var n=15/100*this.model.paletteItemWidth,t=15/100*this.model.paletteItemHeight;return Math.min(n,t)},_setWidth:function(n){this.element.css("width",n)},_setHeight:function(n){this.element.css("height",n)},_setHeaderHeight:function(n){var t,i;for(this.element.find(".e-header").css("height",n),this.element.find(".e-header-arrow").css("top",(n-16)/2),t=0;t<this.model.palettes.length;t++)i=this.model.palettes[t],i&&this._updateHeaderWrapper(i,n);this.updateScrollerViewport()},_updateHeaderWrapper:function(n,t){var i=document.getElementById(n.name+"_Wrapper"),r;i&&(r=i.getBoundingClientRect(),r.height>0&&(i.style.marginTop=t/2-r.height/2+"px"))},_setCssClass:function(n){this.element.removeClass(this.model.cssClass).addClass(n)},_showItemText:function(n){n!==this.model.showPaletteItemText&&(n?this.element.find(".e-text-container").show():this.element.find(".e-text-container").hide())},_setAllowDrag:function(t){var i,e,r,u,f;if(this.model.allowDrag=t,i=this.model.palettes,i)for(r=0;r<i.length;r++)if(u=i[r].items,u)for(f=0;f<u.length;f++)e=document.getElementById(u[f].name+"_paletteItem"),this.model.allowDrag?this._setItemDraggable(e):n(e).ejDraggable("instance").destroy()},_cloneNode:function(n){var u=t.datavisualization.Diagram.Util.randomId(),r,i;if(n.children&&n.children.length>0)for(i=0;i<n.children.length;i++)r=this._cloneChildren(n.children[i],u),this.nameTable[r.name]=r,n.children[i]=r.name;return n.name+=u,n},_cloneChildren:function(t,i){if(typeof t=="object")return r=n.extend(!0,{},t),r.parent+=i,r.name+=i,r;if(typeof t=="string"){var r=this.nameTable[t];if(r)return this._cloneChildren(r,i)}},_setItemDraggable:function(i){var u=this.element[0].id,r=this;n(i).ejDraggable({clone:!0,cursorAt:{top:r.model.previewOffset.y,left:r.model.previewOffset.x},helper:function(){var f=n("#"+r.model.diagramId).ejDiagram("instance"),h,c,i,u,e,s;if(h=r.model.paletteItemWidth,c=r.model.paletteItemHeight,f._selectedSymbol=r.selectedItem,f._symbolPalette=r.model,i=n.extend(!0,{},r.selectedItem),i=r._cloneNode(i),i.isLane&&(r.model.paletteItemWidth=i.paletteItem&&i.paletteItem.previewWidth?i.paletteItem.previewWidth:r.model.previewWidth,r.model.paletteItemHeight=i.paletteItem&&i.paletteItem.previewHeight?i.paletteItem.previewHeight:r.model.previewHeight),u=r._getPreviewItemSize(r.selectedItem),e=r._renderItemContainer(r.selectedItem.name+"_clone",document.body,!0,u),e.document.setAttribute("drag","true"),f._paletteTable=r.nameTable,f._palNameTable=n.extend(!0,{},r.nameTable),i.segments){var o=t.datavisualization.Diagram.Util.bounds(i),l=(u.width-10)/o.width,a=(u.height-10)/o.height;t.datavisualization.Diagram.Util.scale(i,l,a,o.topLeft,f.nameTable);r._renderConnector(i,e,u)}else{if(i.isLane&&i.paletteItem&&!i.paletteItem.enableScale)i.width=u.width,i.height=u.height,i.offsetX=i.width/2,i.offsetY=i.height/2;else if(i._type=="group"){var v=u.width/i.width,y=u.height/i.height;r.scale(i,v,y,i.pivot,r.nameTable,null,null,null,r);t.datavisualization.Diagram.Util._translate(i,i.width/2-i.offsetX,i.height/2-i.offsetY,r.nameTable,null,r)}else i.width=u.width-10,i.height=u.height-10,u&&(u.width=u.width-10,u.height=u.height-10),i.offsetX=i.width/2+10,i.offsetY=i.height/2+1;r._updatePreviewSize(i,u);i._type=="node"?r._renderNode(i,e,u):r._renderGroup(i,e)}return s=document.getElementById(r.selectedItem.name+"_clone_paletteItem"),n(s).addClass("dragClone"),r.model.paletteItemWidth=h,r.model.paletteItemHeight=c,n(s)},drag:function(){var t=this.helper[0];n("#"+r.selectedItem.name+"_clone_svg").css("padding","2px");n("#"+r.selectedItem.name+"_clone_svg").siblings(".htmlLayer").css("padding","2px");t&&t.setAttribute("paletteId",u)},dragStop:function(t){var u=!1,i;t.event&&t.event.originalEvent&&t.event.originalEvent.changedTouches?u=!0:t.event&&t.event.changedTouches&&(u=!0);i=n("#"+r.model.diagramId).ejDiagram("instance");u&&i._isDropOver&&(i._svgdrop(t.event,this),i._isDropped=!0);i._selectedSymbol=null;n(this.helper).remove()}})},_redrawContent:function(){for(var u,e,t,r,o,f=this.element.find(".e-scontent"),i=0,s=f.length;i<s;++i)if(u=f[i],n(u).empty(),e=this.model.palettes[i],t=e.items,t&&t.length>0)for(r=0,o=t.length;r<o;r++)this._renderItem(t[r],u)},_getPalette:function(n){for(var t,r=this.model.palettes,i=0,u=r.length;i<u;i++)if(t=r[i],(t.name===n||t.name===n.replace(/\_/gi," "))&&t!==this.activePalette)return t;return null},_getActivePalette:function(n){var t=n.slice(0,n.lastIndexOf("_"));return this._getPalette(t)},_updateHeaderState:function(n){this._clearHeaderSelection();this._updateExpandState(n);this._updateHeaderSelection(n)},_updateExpandState:function(t){n(t).hasClass("expanded")?(n(t).removeClass("expanded").addClass("collapsed"),n(t).find(".e-header-arrow").removeClass("expanded").addClass("collapsed"),n(t).attr("aria-expanded","false"),n(t).attr("aria-selected","false")):(n(t).removeClass("collapsed").addClass("expanded"),n(t).find(".e-header-arrow").removeClass("collapsed").addClass("expanded"),n(t).attr("aria-selected","true"),n(t).attr("aria-expanded","true"))},_updateHeaderSelection:function(t){n(t).hasClass("selected")||(n(t).addClass("selected"),n(t).find(".e-header-arrow").addClass("selected"))},_clearHeaderSelection:function(){this.element.find(".e-header").removeClass("selected");this.element.find(".e-header-arrow").removeClass("selected")},_addItem:function(n,t){var i=this._getPaletteContentDiv(n.name);this._renderItem(t,i)},_removeItem:function(n,t){var i=this._getPaletteContentDiv(n.name);i.removeChild(document.getElementById(t.name+"_paletteItem"));t===this._selectedElement&&(this._selectedElement=null)},updateScrollerViewport:function(){var n=this.element.ejScroller("instance");n.model.touchScroll=!1;n.model.width=this._setViewPortWidth();n.model.height=this._setViewPortHeight();this._refresh()},_refresh:function(){this.element.ejScroller("refresh")},_getNodeDimension:function(n){var f=n._width,e=n._height,o=n.width?n.width:n.maxWidth?n.maxWidth:n.minWidth,i=document.createElement("span"),s=0,h=0,r,u;if(n.labels.length){for(t.datavisualization.Diagram.Util.attr(i,{id:n.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(i),u=0;u<n.labels.length;u++)r=n.labels[u],r.bold&&(i.style.fontWeight="bold"),r.italic&&(i.style.fontStyle="italic"),i.style.textDecoration=r.textDecoration,i.style.fontFamily=r.fontFamily,i.style.fontSize=r.fontSize+"px",i.style.color=r.fontColor,i.style.backgroundColor=r.fillColor,i.style.borderColor=r.borderColor,i.style.borderWidth=r.borderWidth,i.textContent=r.text,i.style.wordWrap="break-word",i.style.whiteSpace="pre",o&&(i.style.maxWidth=o-(r.margin.left+r.margin.right)-r.fontSize+"px"),s+=i.offsetWidth+r.margin.left+r.margin.right,h+=i.offsetHeight+r.margin.top+r.margin.bottom;n._width=s;n._height=h;n.minWidth&&(n.minWidth>n._width||!n._width)&&(n._width=n.minWidth);n.maxWidth&&(n.maxWidth<n._width||!n._width)&&(n._width=n.maxWidth);n.minHeight&&(n.minHeight>n._height||!n._height)&&(n._height=n.minHeight);n.maxHeight&&(n.maxHeight<n._height||!n._height)&&(n._height=n.maxHeight);n.width||n.labels[0].horizontalAlignment!="left"||(n.offsetX+=(n._width-f)*(1-n.pivot.x));n.width||n.labels[0].horizontalAlignment!="right"||(n.offsetX-=(n._width-f)*n.pivot.x);n.height||n.labels[0].verticalAlignment!="top"||(n.offsetY+=(n._height-e)*(1-n.pivot.y));n.height||n.labels[0].verticalAlignment!="bottom"||(n.offsetY-=(n._height-e)*n.pivot.y);this.element[0].removeChild(i)}},_getNewNode:function(i){return i.shape&&typeof i.shape=="object"&&t.datavisualization.Diagram.Util._updateShapeProperties(i),t.datavisualization.Diagram.Node(n.extend(!0,{},this.model.defaultSettings.node,i))},_getNewGroup:function(i){var u,r;if(i.type=="bpmn"&&(i=t.datavisualization.Diagram.Util._updateBpmnChild(t.datavisualization.Diagram.Node(i),this)),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=i.children[u],r&&(i.children[u]=r.type==="bpmn"||r.type==="group"?this.nameTable[r.name]=this._getNewGroup(r):this.nameTable[r.name]=this._getNewNode(r));return t.datavisualization.Diagram.Group(n.extend(!0,{},this.model.defaultSettings.group,i))},scale:function(n,r,u,f,e,o,s,h,c){var v=t.Matrix.identity(),w,p,a,l,y;if(n.segments)for(t.Matrix.scale(v,r,u,f.x,f.y),a=0;a<n.segments.length;a++){for(l=n.segments[a],y=0;y<l.points.length;y++)l.points[y]=t.Matrix.transform(v,l.points[y]),a!=0||y!=0||n.sourceNode||(l._startPoint=l.points[0],l._endPoint=l.points[l.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(n,t.Matrix.transform(v,n.sourcePoint),!1)),a!=n.segments.length-1||y!=l.points.length-1||n.targetNode||(l._startPoint=l.points[0],l._endPoint=l.points[l.points.length-1],n.targetPoint=l._endPoint);l._startPoint=l.points[0];l._endPoint=l.points[l.points.length-1];l.type=="orthogonal"?l.length||l.length===0?l.length=l._length=t.datavisualization.Diagram.Geometry.distance(l._startPoint,l._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(l,n.segments[a-1],n.segments[a+1],n.sourcePoint,n.targetPoint):(l.point&&(l.point=l._endPoint),l._point=l._endPoint)}else{if(n._type==="group"){for(w=n.children,a=0;a<w.length;a++)p=e[typeof w[a]=="string"?w[a]:w[a].name],p&&(this.scale(p,r,u,f,e,i,i,i,c),p.parent&&p.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(e[p.parent],c));t.datavisualization.Diagram.Util._updateGroupBounds(n,c)}t.Matrix.rotate(v,-n.rotateAngle,f.x,f.y);t.Matrix.scale(v,r,u,f.x,f.y);t.Matrix.rotate(v,n.rotateAngle,f.x,f.y);var b=t.Matrix.transform(v,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),k=n.width*r,d=n.height*u;k>1&&(n.width=k,n.offsetX=b.x);d>1&&(n.height=d,n.offsetY=b.y)}},_translate:function(n,i,r,u,f,e){var h,o,s;if(n.segments)t.datavisualization.Diagram.Util._translateLine(n,i,r,n);else if(n.offsetX+=i,n.offsetY+=r,n._type==="group"&&!f){for(h=e._getChildren(n.children),s=0;s<h.length;s++)o=u[h[s]],this._translate(o,i,r,u,null,e),o.parent&&o.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(u[o.parent],e);n._type!="group"&&n.container&&t.datavisualization.Diagram.Util._updateGroupBounds(n,e)}}})}(jQuery,Syncfusion),function(n,t){"use strict";var i,u,f,e,o,s,h,r,c,l,a,v,y,p,w,b,k,d,g,nt;t.datavisualization.Diagram.extend=function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};i=function(){function i(n,i){this.name=n;this.diagram=i;this.helper=null;this.inAction=!1;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0);this.cursor="default";this._currentPossibleConnection=null;this._previousPossibleConnection=null;this._possibleConnectionPort=null;this.singleAction=!1;this.svgHelper=null;this.single=null;this._centralPoint=t.datavisualization.Diagram.Point(0,0);this._enableAutoNode=null;this._prevTool=null;this.activeLabel=null;this._adjustLines={lines:[]}}return i.prototype.abort=function(){this._endAction();this.diagram.selectionList&&this.diagram.selectionList[0]&&t.datavisualization.Diagram.SvgContext.updateSelector(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints);this.diagram._removeTooltip()},i.prototype._snapTop=function(n,i,r,u,f,e){var o=u,h,c,s;if(i.top=!0,n.left=n.right=!1,h=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(s=this.initialBounds.y-this.initialBounds.height*f.pivot.y+u-(f.offsetY-f.height*f.pivot.y),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,s,this.selectedObject,e)),i.snapped)o=u-s+i.offset;else if(h.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var l=this.initialBounds.y-this.initialBounds.height*f.pivot.y,a=l+u,v=t.datavisualization.Diagram.SnapUtil._round(a,t.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),c);o=v-l}return o},i.prototype._checkGroupChildren=function(n,i,r){for(var u,e,o=this.diagram._getChildren(i.children),f=0;f<o.length;f++)u=this.diagram.nameTable[o[f]],u&&t.datavisualization.Diagram.Util.canSelect(u)&&t.datavisualization.Diagram.Util.enableLayerOption(u,"lock",this.diagram)&&(e=t.datavisualization.Diagram.Util.bounds(u),t.datavisualization.Diagram.Geometry.containsRect(r,e)&&n.indexOf(u)<0?n.push(u):u._type==="group"&&this._checkGroupChildren(n,u,r))},i.prototype._getSwimLaneStackIndex=function(n){var u=null,i,r;return n.container.type=="canvas"&&(n.parent&&(i=this.diagram.nameTable[n.parent]),i&&(r=t.datavisualization.Diagram.Util.bounds(n),u=i.container.orientation==="vertical"?this.currentPoint.y>=r.y&&this.currentPoint.y<r.center.y?this._getIndex(i.children,n):this._getIndex(i.children,n)+1:this.currentPoint.x>=r.x&&this.currentPoint.x<r.center.x?this._getIndex(i.children,n):this._getIndex(i.children,n)+1)),u},i.prototype._getIndex=function(n,t){var r,i;if(n&&t){for(r=null,i=0;i<n.length;i++)if(r=this.diagram.nameTable[this.diagram._getChild(n[i])],r&&r.name==t.name)return i}else return-1},i.prototype._snapLeft=function(n,i,r,u,f,e){var o=r,h,c,s,a;if(n.left=!0,i.top=i.bottom=!1,h=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(s=this.initialBounds.x-this.initialBounds.width*f.pivot.x+r-(f.offsetX-f.width*f.pivot.x),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,s,u,this.selectedObject,e)),a=t.datavisualization.Diagram.Util.bounds(f),n.snapped)o=r-s+n.offset;else if(h.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var l=this.initialBounds.x-this.initialBounds.width*f.pivot.x,v=l+r,y=t.datavisualization.Diagram.SnapUtil._round(v,t.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),c);o=y-l}return o},i.prototype._snapBottom=function(n,i,r,u,f,e){var o=u,h,c,s,a;if(!this.diagram._disableSnap)if(i.bottom=!0,n.left=n.right=!1,h=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(s=this.initialBounds.y+this.initialBounds.height*(1-f.pivot.y)+u-(f.offsetY+f.height*(1-f.pivot.y)),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,s,this.selectedObject,e)),a=t.datavisualization.Diagram.Util.bounds(f),i.snapped)o=u-s+i.offset;else if(h.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var l=this.initialBounds.y+this.initialBounds.height*(1-f.pivot.y),v=l+u,y=t.datavisualization.Diagram.SnapUtil._round(v,t.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),c);o=y-l}return o},i.prototype._snapRight=function(n,i,r,u,f,e){var o=r,h,c,s;if(!this.diagram._disableSnap)if(n.right=!0,i.top=i.bottom=!1,h=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(s=this.initialBounds.x+this.initialBounds.width*(1-f.pivot.x)+r-(f.offsetX+f.width*(1-f.pivot.x)),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,s,u,this.selectedObject,e)),n.snapped)o=r-s+n.offset;else if(h.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var l=this.initialBounds.x+this.initialBounds.width*(1-f.pivot.x),a=l+r,v=t.datavisualization.Diagram.SnapUtil._round(a,t.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!0),c);o=v-l}return o},i.prototype.keydown=function(n){var i=n.keyCode?n.keyCode:n.which;i===27&&this.inAction?(this.diagram._selectedSymbol?(this.diagram._documentmouseup(n),this._removeHighLighter(),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._selectedSymbol=null):(this.seletedObject||this.selectedObject)&&(this.selectedObject&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this.seletedObject&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.seletedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.seletedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this._removeHighLighter(),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram)),this.abort()):i===46&&this.inAction?(this.diagram._selectedSymbol&&(this.diagram._documentmouseup(n),this.diagram._selectedSymbol=null),this.abort()):this.inAction||i!=27||this.diagram._clearSelection()},i.prototype._getSwimlaneHeader=function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.diagram.nameTable[this.diagram._getChild(n.children[0])]),t},i.prototype._removeHelpers=function(){t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer);t.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg);this._removeHighLighter()},i.prototype._cloneGroupNode=function(t,i){var o=null,r,u,e,f;if(u=n.extend(!0,{},t),u.name+=i,t&&t._type==="group")for(u.children=[],e=this.diagram._getChildren(t.children),f=0;f<e.length;f++)o=this.diagram.nameTable[this.diagram._getChild(e[f])],r=n.extend(!0,{},o),r.name+=i,r.parent&&(r.parent+=i),r._type==="group"&&this._cloneGroupNode(r,i),this.diagram.nameTable[r.name]=r,u.children.push(r);return u},i.prototype._updateNextPhases=function(n,i,r){var o=0,s,u,e,f;for(o=n.orientation=="horizontal"?i:r,s=this.diagram._getPhaseIndex(n.name),e=this.diagram.nameTable[n.parent],f=s+1;f<e.phases.length;f++)u=this.diagram.nameTable[this.diagram._getChild(e.phases[f])],u&&(u.offset+=o),t.datavisualization.Diagram.SvgContext._updatephase(u,this.diagram)},i.prototype._getphase=function(n){return this.diagram.nameTable[n]},i.prototype._containsSwimlane=function(n){for(var i,t=0;t<n.length;t++)if(i=this.diagram.nameTable[this.diagram._getChild(n[t])],i.isSwimlane||i.isLane)return!0;return!1},i.prototype._raiseEndPointDrag=function(n,t,i,r){if(t||i){var u,f,e,o;return f=this._currentPossibleConnection?this._currentPossibleConnection:null,e=this._possibleConnectionPort?this._possibleConnectionPort:null,o=this.currentPoint,u=t?"Target":"Source",this._raiseEvent("connector"+u+"Change",{element:n,node:f,port:e,point:o,dragState:r,cancel:!1})}},i.prototype._decideSelectedItem=function(n,t,i){var r=null,f,u;if(t)t.parent?this.diagram.selectionList&&this.diagram.selectionList[0]&&t.parent==this.diagram.selectionList[0].name&&!i?(r=t,this.diagram.selectionList[0].type=="bpmn"&&(r=this.diagram.selectionList[0])):i&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].name==t.name?r=t:(f=this.diagram.nameTable[t.parent],t.isPhase?(u=t.name.split("phaseStack")[1],u&&(t=this.diagram.nameTable[u]),r=t):(r=this._decideSelectedItem(n,f,i),this.diagram.selectionList&&this.diagram.selectionList[0]&&r&&this.diagram.selectionList[0].name==r.name&&!i&&(r=t))):r=t;else return null;return r},i.prototype._isParentAsLane=function(n){for(var i,t,u,r=0;n.children&&r<n.children.length>0;r++)if(i=this.diagram.nameTable[this.diagram._getChild(n.children[r])],i&&(t=this.diagram.nameTable[i.parent],t&&t.isLane))return u=this.diagram.nameTable[t.parent],this.diagram._activeSwimLane=this.diagram.nameTable[u.parent],!0;return null},i.prototype._getAdjustjecentLines=function(n){if(!n.segments){for(var t=0;n.inEdges&&n.inEdges.length>0&&t<n.inEdges.length;t++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[n.inEdges[t]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[n.inEdges[t]]));for(t=0;n.outEdges&&n.outEdges.length>0&&t<n.outEdges.length;t++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[n.outEdges[t]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[n.outEdges[t]]))}},i.prototype._containsCollection=function(n,t){for(var i=0;n&&n.length>0&&i<n.length;i++)if(t&&n[i].name===t.name)return!0},i.prototype._updateMultipleUndoObject=function(n){for(var t,r=[],i=0;n.children&&n.children.length>0&&i<n.children.length;i++)t=this.diagram.nameTable[this.diagram._getChild(n.children[i])],t&&(r.push(jQuery.extend(!0,{},t)),this._getAdjustjecentLines(t));this._undoObject||(this._undoObject={collection:r,adjustLines:jQuery.extend(!0,{},this._adjustLines)})},i.prototype._updateNameTable=function(n){this.diagram._updateNameTable(n)},i.prototype._getParentSwimlane=function(n){var t;return n&&n.isLane?(t=this.diagram.nameTable[n.parent],this.diagram.nameTable[t.parent]):null},i.prototype._removeHighLighter=function(){t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer)},i.prototype._getPadding=function(n){var i=0,r=0,t;return n&&n.parent&&(t=this.diagram.nameTable[n.parent],t&&(i=t.paddingRight,r=t.paddingBottom)),{x:i,y:r}},i.prototype._findStackOverNode=function(n,i){var u,o,r,s,c,h,f,e;if(n&&(u=this.diagram.nameTable[n.parent],o=null,u))for(c=u.children.length,h=0;h<c;h++)if(o=this.diagram.nameTable[this.diagram._getChild(u.children[h])],r=this.mousePosition(i),s=t.datavisualization.Diagram.Util.bounds(o),f=this.diagram.nameTable[this.diagram._getChild(u.children[c-1])],e=this.diagram.nameTable[this.diagram._getChild(u.children[0])],u.container.orientation=="vertical"){if(r.y>=s.y&&r.y<=s.bottom)return o;if(r.y<=e.offsetY-e.height/2)return e;if(r.y>=f.offsetY+f.height/2)return f}else{if(r.x>=s.x&&r.x<=s.right)return o;if(r.x<=e.offsetX-e.width/2)return e;if(r.x>=f.offsetX+f.width/2)return f}},i.prototype._getPageBounds=function(){var i=t.datavisualization.Diagram.Rectangle(0,0,0,0),n=this.diagram.model.pageSettings;return i.x=n.boundaryConstraints==="diagram"?Math.min(this.diagram._getDigramBounds().x,0):0,i.y=n.boundaryConstraints==="diagram"?Math.min(this.diagram._getDigramBounds().y,0):0,i.width=n.boundaryConstraints==="page"?n.pageWidth?n.pageWidth:this.diagram.element.width():this.diagram.element.width(),i.height=n.boundaryConstraints==="page"?n.pageHeight?n.pageHeight:this.diagram.element.height():this.diagram.element.height(),i},i.prototype._nodeHighLighter=function(n){var f=null,r=null,u=null,i,o,e;n&&this.selectedObject.parent?(i=this.diagram.nameTable[this.selectedObject.parent],i&&(i.container&&i.container.type=="stack"&&this.selectedObject.name!=n.name?(o=this._stackOverNode,t.datavisualization.Diagram.SvgContext._drawStackHighlighter(o,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,i.container.orientation==="vertical"?!0:!1)):i.container&&i.container.type=="canvas"&&this.selectedObject.parent!=n.name&&!n.isPhase&&t.datavisualization.Diagram.Util.canAllowDrop(n)?t.datavisualization.Diagram.Util._canBeTarget(this.diagram,n)&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter())):n&&n.container&&!n.isSwimlane?this.selectedObject.isLane?(i=this.diagram.nameTable[n.parent],i&&n.name.indexOf("phaseStack")===-1&&t.datavisualization.Diagram.Util.canDrawStackHighlighter(this.diagram,this.selectedObject,n)&&t.datavisualization.Diagram.SvgContext._drawStackHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,i.container.orientation==="vertical"?!0:!1)):t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):n.segments?this._removeHighLighter():t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom);this._nodeToHit&&n&&n.name!=this._nodeToHit.name&&(r=t.datavisualization.Diagram.Util.bounds(this._nodeToHit),u=this._getTargetNode(this._nodeToHit,r),this._raiseEvent("mouseLeave",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(this._nodeToHit),target:this.diagram.getNode(u)}));n?(this._nodeToHit&&this._nodeToHit.name!==n.name||!this._nodeToHit)&&(this._nodeToHit=n,this.selectedObject.parent&&(f=this.diagram.nameTable[this.selectedObject.parent]),this.selectedObject.type=="pseudoGroup"&&(e=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],e&&e.parent&&(f=this.diagram.nameTable[e.parent])),r=t.datavisualization.Diagram.Util.bounds(n),u=this._getTargetNode(n,r),this._raiseEvent("mouseEnter",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(f),target:this.diagram.getNode(u)})):this._nodeToHit=null;n&&(this.selectedObject.parent&&(f=this.diagram.nameTable[this.selectedObject.parent]),r=t.datavisualization.Diagram.Util.bounds(n),u=this._getTargetNode(n,r),this._raiseEvent("mouseOver",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(f),target:this.diagram.getNode(u)}))},i.prototype._doubleClick=function(n){var t,i;n&&n.parent&&(t=this.diagram.nameTable[n.parent],t&&(i=n.name,this.diagram.updateSelectedObject(i),t.isLane||t.isSwimlane||t.isPhaseStack||(this.diagram._clearSelection(!0),this.diagram.addSelection(n,!0))))},i.prototype._itemClick=function(n,t,i,r){var u,s,e,o,f;if(t&&t.parent){if(u=this.diagram.nameTable[t.parent],u)if(u.container)t&&!this.diagram._selectedSymbol&&(s=t.name,s.indexOf("_header_swimlane")!=-1?n&&this.diagram.updateSelectedObject(n.parent,u):s.indexOf("_Headerr_")!=-1?this.diagram.updateSelectedObject(t.parent):t&&t.isPhase?n.isPhase&&(f=this.diagram.nameTable[n.parent],f&&(this.diagram.selectionList.length===0||this.diagram.selectionList[0].name!=f.name)&&(this.diagram._clearSelection(!0),this.diagram.addSelection(n,!0),this.selectedObject=null)):this.diagram.updateSelectedObject(s)),this.diagram._selectedGNode=null;else if(u.type==="group"){if(u.parent){if(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)e=this.diagram.nameTable[u.parent];else while(u.parent)if(e=this.diagram.nameTable[u.parent],e&&e.isLane)break;else if(o=this.diagram.nameTable[u.parent],this.diagram._selectedGNode&&o)if(o.name===this.diagram._selectedGNode.name){this.diagram.updateSelectedObject(u.name);break}else u=o;else u=o;e&&e.isLane&&(f=this._getSelectedItem(t,r),f&&this.diagram.updateSelectedObject(f.name))}this.selectedObject&&this.selectedObject.parent&&(this.diagram._selectedGNode=this.selectedObject)}}else t?this.diagram._selectedSymbol||this.diagram.updateSelectedObject(t.name):this.diagram._selectedGNode=null;n&&(n.type=="pseudoGroup"||n.name=="multipleSelection")&&t&&!this._containsChild(n,t.name)&&this.diagram.updateSelectedObject(n.name)},i.prototype._getSelectedItem=function(n,t){var i;if(n&&n.parent)return i=this.diagram.nameTable[n.parent],t&&t.name==i.name?n:i.isLane?n:this._getSelectedItem(i)},i.prototype._getTargetNode=function(n,i){for(var e,o,u,s,h=null,f=[],c=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,i),r=0;r<c.length;r++)if(e=c[r],e.objects.length>0)for(o=0;o<e.objects.length;o++)u=e.objects[o],!u.segments&&u.visible&&(h=t.datavisualization.Diagram.Util.bounds(u),f.indexOf(u)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&f.push(u));for(s=[],s.push(n),r=0;r<f.length;r++)f[r].name!=n.name&&s.push(f[r]);return s},i.prototype._updateMargin=function(n,i){var o,s,f,r,u;if(n.type=="pseudoGroup")for(o=null,s=this.diagram._getChildren(n.children),f=0;f<s.length;f++)o=this.diagram.nameTable[s[f]],this._updateMargin(o,i);else if(i&&i.container&&i.container.type=="canvas"){var h=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util.bounds(n),c=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);n.marginLeft=c.x-(h.x+i.paddingLeft);n.marginTop=c.y-(h.y+i.paddingTop);i.isLane&&(r=0,u=0,i.orientation==="horizontal"?(r=50,u=0):(r=0,u=50),n.marginLeft=n.marginLeft>=r?n.marginLeft:r,n.marginTop=n.marginTop>=u?n.marginTop:u)}},i.prototype._getNodeUnderMouse=function(){var n=this.diagram._nodeUnderMouse,i,f,u,r;if(this.diagram._focusedElement&&(this.diagram._focusedElement.isPhase||this.diagram._focusedElement.isLane||this.diagram._focusedElement.isSwimlane)&&(f=!0),this.diagram._focusedElement&&n&&this._containsChild(this.diagram._focusedElement,n.name)&&n&&(f||!t.datavisualization.Diagram.Util.canAllowDrop(n)))if(u=this.diagram.getObjectType(n),u=="connector"||u==="group")i=n;else if(n.parent){if(r=this.diagram.nameTable[n.parent],r&&r.container&&r.container.type=="stack"&&t.datavisualization.Diagram.Util.canAllowDrop(n))return n;u=this.diagram.getObjectType(r);r&&u!="node"&&(i=r)}if(i){if(this.selectedObject!=i&&t.datavisualization.Diagram.Util.canAllowDrop(i)&&(i.type!="bpmn"||this.selectedObject.type=="bpmn"))return i}else if(n&&this.selectedObject!=n&&t.datavisualization.Diagram.Util.canAllowDrop(n))return n},i.prototype._isChange=function(n,t){var i=null;return n._type==="group"||n.type==="pseudoGroup"||t._type==="group"||t.type==="pseudoGroup"?(n._type!=="group"&&n.type!=="pseudoGroup"||t._type==="group"||t.type==="pseudoGroup"||(i=!this._containsChild(n,t.name)),n._type==="group"||n.type==="pseudoGroup"||t._type!=="group"&&t.type!=="pseudoGroup"?(n._type==="group"||n.type==="pseudoGroup")&&(t._type==="group"||t.type==="pseudoGroup")&&n.name==t.name&&(i=!0):i=!this._containsChild(t,n.name)):n.name==t.name&&(i=!0),i},i.prototype._containsChild=function(n,t){var u=!0,i=null,e,f,r;if(n.children)for(f=this.diagram._getChildren(n.children),r=0;r<f.length;r++)i=this.diagram.nameTable[f[r]],e=this.diagram.getObjectType(i),e==="group"?u=this._containsChild(i,t):i&&i.name==t&&(u=!1);return u},i.prototype._findNodeUnderMouse=function(i,r){var f=null,u=null,o,s=this.diagram._isForeignObject(i.target),e,h,c;return s&&(i.target=s),e=n(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],h=i.target.className,e&&(s||i.target.localName!="div")?(o=typeof e.className=="object"?e.className.baseVal:e.className,o&&(o==="ej-d-node"||o==="ej-d-group"||t.datavisualization.Diagram.Util.isClassifier(i))?(u=this.diagram._findNode(e.id),u||(u=this.diagram._findNode(e.id.split("_label")[0])),u||(u=this.diagram._findNode(e.id.split("_parentdiv")[0]))):o==="ej-d-connector"?(u=this.diagram._findConnector(e.id),u||(u=this.diagram._findConnector(e.id.split("_label")[0]))):h.animVal==="ej-d-multiselector"&&(u=this.diagram.selectionList[0])):!u&&i.target&&i.target.parentNode?(c=i.target.parentNode.id.split("_ej_ports"),u=this.diagram.findNode(c[0])):this.diagram._isLabelTemplate(i)&&(u=this.diagram._findNode(e.id),u||(u=this.diagram._findConnector(e.id))),f=u&&!u.parent?u:this._decideSelectedItem(i,u,r),this.prevSelectObject=f,r&&this.diagram.selectionList[0]&&(f&&f._type==="group"&&!this._containsChild(f,this.diagram.selectionList[0].name)?f=f:f&&this.diagram.selectionList[0].name!=f.name&&this._isChange(this.diagram.selectionList[0],f)?f=this.diagram.selectionList[0]:u&&u.name==this.diagram.selectionList[0].name&&!this._isChange(this.diagram.selectionList[0],f)&&(f=this.diagram.selectionList[0])),this.actualObject=u&&this.diagram._selectedSymbol&&u.name!=this.diagram._selectedSymbol.name&&this.diagram._symbolDrop?this.diagram._selectedSymbol:u,f},i.prototype._findLabelUnderMouse=function(i,r,u,f){var e,p=n(i.target),a=p[0].getAttribute("class"),d,w,k,v,c,b,h,l,g,y,s,o;if(this.diagram.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){if(!a||!a=="ej-d-label")if(p[0].parentNode&&(d=p[0].parentNode.getAttribute("class")),d==="ej-d-label"){for(w=p[0].parentNode.id.split("_"),k="",o=1;o<w.length;o++)k+=w[o],o!=w.length-1&&(k+="_");if(v=this.diagram.nameTable[w[0]],v&&v.labels.length>0)for(o=0;o<v.labels.length;o++)if(v.labels[o].name===k)return this.activeLabel=v.labels[o],v.labels[o]}else for(c=i.target.parentNode;c;){if(c&&(a=c.getAttribute("class")),a==="ej-label-template")for(s=c.id.split("_"),e=this.diagram._findNode(s[0]),e||(e=this.diagram._findConnector(s[0])),o=0;e&&o<e.labels.length;o++)if(l=e.labels[o].name.split("_"),s[s.length-1]==l[l.length-1])return h=e.labels[o],this.diagram._selectedSymbol||(this.activeLabel=h),h;if(c&&c.id===this.diagram.element[0].id+"_canvas_svg")break;else c=c.parentNode}}else if(a=="ej-d-label"){if(y=n(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),y&&(s=y[0].getAttribute("id"),b=y[0].getAttribute("class"),b))if(b==="ej-d-node"||b==="ej-d-group")e=this.diagram._findNode(s),e||(e=this.diagram._findNode(s.split("_label")[0])),h=this.diagram._findLabelAtPoint(u?u:this.currentPoint,e),this.diagram._selectedSymbol||(this.activeLabel=h);else if(b==="ej-d-connector"){if(e=this.diagram._findConnector(s),e||(e=this.diagram._findConnector(s.split("_label")[0])),h=this.diagram._findLabelAtPoint(u?u:this.currentPoint,e),t.datavisualization.Diagram.Util.canMoveLabel(e)||f){if(h==null&&(p=n(i.target),a=p[0].getAttribute("class"),a=="ej-d-label"))for(s=i.target.id.split("_"),o=0;o<e.labels.length;o++)l=e.labels[o].name.split("_"),s[s.length-1]==l[l.length-1]&&(h=e.labels[o])}else h=null;this.diagram._selectedSymbol||(this.activeLabel=h)}}else if(this.diagram._isLabelTemplate(i)){if(g=n(i.target).parents(".ej-label-template"),y=g[0],y){if(s=y.parentNode.id.split("_"),e=this.diagram._findNode(s[0]),e||(e=this.diagram._findConnector(s[0])),e)for(o=0;o<e.labels.length;o++)l=e.labels[o].name.split("_"),s[2]==l[l.length-1]&&(h=e.labels[o]);this.diagram._selectedSymbol||(this.activeLabel=h)}}else this.activeLabel=null;return e},i.prototype._findLabelAtNode=function(i,r){var v,u=null,f,p,w,l,y,s,a,b,h,c,k,e,o,d;if(i&&i.labels.length>0)for(l=t.datavisualization.Diagram.Util.bounds(i,!0),v=i.labels,a=0,b=v.length;a<b;a++)u=v[a],u.name==r.name&&(f=t.datavisualization.Diagram.Util._getLabelPosition(u,l),f.x=l.x+f.x,f.y=l.y+f.y,this.diagram.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg?(e=document.getElementById(i.name+"_"+u.name).getBBox(),h=e.width?e.width:0,c=e.height?e.height:0):(k=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(k).find("#"+i.name+"_"+u.name)[0],h=e?e.offsetWidth:0,c=e?e.offsetHeight:0),h||(h=i.width),c||(c=u.fontSize),o=t.datavisualization.Diagram.Size(h,c),u.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?f.y+=o.height/2:u.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Bottom&&(f.y-=o.height/2),u.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Left?f.x+=o.width/2:u.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Right&&(f.x-=o.width/2),p=f.x-(u.width?u.width/2:i.width/2),w=f.y-(u.height?u.height/2:i.height/2),s=t.datavisualization.Diagram.Point(p,w),i.segments||(y=t.Matrix.identity(),t.Matrix.rotate(y,i.rotateAngle,i.offsetX,i.offsetY),s=t.Matrix.transform(y,s)),d={x:s.x,y:s.y,width:o.width,height:o.height});return d},i.prototype._getLabelCenter=function(n){var i=this.diagram.findNode(n._parent),r=this._findLabelAtNode(i,n),f,u;if(i.segments)n.relativeMode=="segmentpath"?(r=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(n,i,1,this.diagram),u=t.datavisualization.Diagram.Point(r.position.x+n.margin.left-n.margin.right,r.position.y+n.margin.top-n.margin.bottom)):u=t.datavisualization.Diagram.Point(r.x+n.width/2,r.y+n.height/2);else{f=t.Matrix.identity();t.Matrix.rotate(f,-i.rotateAngle,i.offsetX,i.offsetY);var e=t.Matrix.transform(f,t.datavisualization.Diagram.Point(r.x,r.y)),o=t.datavisualization.Diagram.Point(e.x+n.width/2,e.y+n.height/2),s=t.Matrix.identity();t.Matrix.rotate(s,i.rotateAngle,i.offsetX,i.offsetY);u=t.Matrix.transform(s,t.datavisualization.Diagram.Point(o.x,o.y))}return u},i.prototype._resizeObject=function(n,i,r,u,f){var b,e,nt,g,l,a,h={snapped:!1,offset:0,left:!1,right:!1},c={snapped:!1,offset:0,top:!1,bottom:!1},o=this.previousPoint,s=this.currentPoint,v=t.datavisualization.Diagram.Point(0,0),y,p,k,d,w;nt=n._type!=="label"?n.rotateAngle:this.diagram._findLabelRotateAngle(n);y=t.Matrix.identity();t.Matrix.rotate(y,-nt);p=t.Matrix.identity();g=n.text?this._getLabelCenter(n):t.datavisualization.Diagram.Point(n.offsetX,n.offsetY);t.Matrix.rotate(p,nt,g.x,g.y);k=n.width;d=n.height;n._type!=="label"?(l=n.offsetX-k*n.pivot.x,a=n.offsetY-d*n.pivot.y):(l=g.x-n.width/2,a=g.y-n.height/2);switch(this._resizeDirection){case"n-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l+k/2,a+d));w=1;e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(r=this._snapTop(h,c,i,r,n,s==o));b=(this.initialBounds.height-r)/n.height;break;case"e-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l,a+d/2));e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(i=this._snapRight(h,c,i,r,n,s==o,f));r=0;w=(this.initialBounds.width+i)/n.width;b=1;break;case"w-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l+k,a+d/2));e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(i=this._snapLeft(h,c,i,r,n,s==o));r=0;w=(this.initialBounds.width-i)/n.width;b=1;break;case"s-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l+k/2,a));w=1;e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(r=this._snapBottom(h,c,e.x,e.y,n,s&&o&&s==o?!0:!1));b=(this.initialBounds.height+r)/n.height;break;case"ne-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l,a+d));e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(i=this._snapRight(h,c,i,r,n,s==o,f),r=this._snapTop(h,c,i,r,n,s==o));w=(this.initialBounds.width+i)/n.width;b=(this.initialBounds.height-r)/n.height;break;case"nw-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l+k,a+d));e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(r=this._snapTop(h,c,i,r,n,s==o),i=this._snapLeft(h,c,i,r,n,s==o));w=(this.initialBounds.width-i)/n.width;b=(this.initialBounds.height-r)/n.height;break;case"se-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l,a));e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(r=this._snapBottom(h,c,i,r,n,s==o,f),i=u?i:this._snapRight(h,c,i,r,n,s==o));w=(this.initialBounds.width+i)/n.width;b=(this.initialBounds.height+r)/n.height;break;case"sw-resize":v=t.Matrix.transform(p,t.datavisualization.Diagram.Point(l+k,a));e=t.Matrix.transform(y,t.datavisualization.Diagram.Point(i,r));i=e.x;r=e.y;n._type!=="label"&&(r=this._snapBottom(h,c,i,r,n,s==o,f),i=this._snapLeft(h,c,i,r,n,s==o));w=(this.initialBounds.width-i)/n.width;b=(this.initialBounds.height+r)/n.height}return t.datavisualization.Diagram.Rectangle(v.x,v.y,w,b)},i.prototype._selectionContainsChild=function(n){var i,t,r,u,f;if(this.diagram.selectionList[0].children){for(i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=null,r=0;r<i.length;r++)if(t=this.diagram.nameTable[i[r]],t&&t.name==n)return!0}else if(this.diagram.selectionList[0]._type==="group"&&this.diagram.selectionList[0].type!="pseudoGroup"){if(this.diagram.selectionList[0].name==n)return!0}else if(this.diagram.nameTable[n]&&this.diagram.nameTable[n]._type==="group"){for(i=this.diagram._getChildren(this.diagram.nameTable[n].children),u=0;u<i.length;u++)if(t=this.diagram.nameTable[i[u]],t&&(f=this._selectionContainsChild(t.name)),f)return f}else if(this.diagram.selectionList[0].name==n)return!0;return!1},i.prototype._isSelected=function(n){var u=null,i=this.diagram.nameTable[n],r,t;if(this._selectionContainsChild(i.name))return!0;if(i._type==="group")for(r=this.diagram._getChildren(i.children),t=0;t<r.length;t++)if(u=r[t],this._selectionContainsChild(u))return!0;return!1},i.prototype._isColleagueSelected=function(n){var u=this.diagram.nameTable[n],f=null,i,r,t;if(u.parent&&(i=this.diagram.nameTable[u.parent],i))for(r=this.diagram._getChildren(i.children),t=0;t<r.length;t++)if(f=r[t],this._isSelected(f))return!0;return!1},i.prototype._isInSelection=function(n){var i,r,t;if(this.diagram.selectionList[0].type=="pseudoGroup"&&this.diagram.selectionList[0].children)for(i=this.diagram._getChildren(this.diagram.selectionList[0].children),r=null,t=0;t<i.length;t++)if(r=this.diagram.nameTable[i[t]],r.name==n)return!0},i.prototype._getCloneNode=function(n){var t=null;return t=jQuery.extend(!0,{},n),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},i.prototype._getProcessedObject=function(n){var t=this.diagram.nameTable[n],i;if(t){if(this._isInSelection(n))return null;if(this._selectionContainsChild(t.name))return{add:t,remove:null};if(t.parent)if(this._selectionContainsChild(t.parent)){if(this._isInSelection(t.parent))return{add:t,remove:this.diagram.nameTable[t.parent]};if(i=this.diagram.nameTable[t.parent],i)return{add:i,remove:this.diagram.nameTable[i.parent]}}else return this._isColleagueSelected(t.parent)&&!this._selectionContainsChild(t.parent)?this._isSelected(t.parent)?{add:t,remove:null}:{add:this.diagram.nameTable[t.parent],remove:null}:this.diagram.selectionList[0]&&this._isInSelection(t.parent)?{add:this.diagram.nameTable[t.name],remove:this.diagram.nameTable[t.parent]}:this._getProcessedObject(t.parent);else return{add:t,remove:null}}},i.prototype.hasSameParent=function(){var n,t,u,r,i;if(this.selectedObject.type=="pseudoGroup"){if(n=this.selectedObject,t=null,this.diagram.nameTable[this.diagram._getChild(n.children[0])])for(u=this.diagram.nameTable[this.diagram._getChild(n.children[0])].parent,r=this.diagram._getChildren(n.children),i=0;i<r.length;i++)if(t=this.diagram.nameTable[r[i]],t.parent!=u||t.parent=="")return!1;return!0}return!1},i.prototype._fromDiagram=function(n){for(var r=!0,t=null,i=0;i<n.length;i++)if(t=this.diagram.nameTable[this.diagram._getChild(n[i])],t&&t.parent){r=!1;break}return r},i.prototype._fromContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[this.diagram._getChild(n[r])],t.parent&&(i=this.diagram.nameTable[t.parent],i&&i.container))return!0},i.prototype._fromSameContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[this.diagram._getChild(n[r])],!i&&t.parent&&(i=t.parent),t.parent&&t.parent!=i)return!1;return!0},i.prototype._anyFromContainer=function(n){for(var i=null,t=null,r=0;r<n.length;r++)if(i=this.diagram.nameTable[this.diagram._getChild(n[r])],i.parent&&(t=this.diagram.nameTable[i.parent]),t&&t.container&&t.container.type==="canvas")return!0;return!1},i.prototype._processCtrlKey=function(i){var s,r,e,b,l,f,u;if(this.diagram.selectionList.length>0&&t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)){var o=this.diagram.selectionList,a,f,c,v=[],y=[],p=[];o[0].type=="pseudoGroup"?(a=!0,s=this._findNodeUnderMouse(i)):s=this._findNodeUnderMouse(i);var w=this._findNodeUnderMouse(i,!0),k=this.selectedObject,h=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:w,cancel:!1,event:i});if(this._itemClick(this.selectedObject,this.actualObject,w),h.cancel&&(this.selectedObject=k),this.actualObject)if(this.actualObject.parent)a?(r=o[0],e=this._getProcessedObject(this.actualObject.name),e?(this.selectedObject?(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name)):e.remove&&(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,e.remove.name)),this.selectedObject?this._hasMultipleSelection(this.selectedObject)||r.children.push(this.selectedObject.name):e.add&&(this._hasMultipleSelection(e.add)||r.children.push(e.add.name))):(f=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name)):r.children.push(this.selectedObject.name):this._hasMultipleSelection(f)?(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,f.name)):r.children.push(f.name)),t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),r.children.length<=1?(b=this.diagram.nameTable[this.diagram._getChild(r.children[0])],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.selectedObject=b,this.diagram._addSelection(this.selectedObject)):(this.selectedObject=o[0],this.diagram.updateSelection())):(this.diagram.selectionList[0]._type==="group"&&this.diagram.selectionList[0].type!=="bpmn"?(o=this.diagram.selectionList[0],e=this._getProcessedObject(this.actualObject.name),f=e.add,e&&this.diagram._hasSelection()&&this.diagram._clearSelection()):(e=null,s._type==="group"&&(e=this._getProcessedObject(this.actualObject.name)),f=e?e.add:s,o=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection()),this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Keydown,u=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),o.name!=f.name&&u.children.push(o.name),this.selectedObject?u.children.push(this.selectedObject.name):this._containsChild(u,f.name)&&u.children.push(f.name),this._checkRepeatedChild(u.children),this.diagram.nodes().push(u),this.diagram._nodes=n.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[u.name]=u,t.datavisualization.Diagram.Util._updateGroupBounds(u,this.diagram),this.selectedObject=u,this.diagram._addSelection(this.selectedObject));else if(a){for(r=o[0],f=this.selectedObject?this.selectedObject:this.actualObject,c=this._hasMultipleSelection(f)?"remove":"insert",c=="insert"?(r.children.push(f.name),v.push(f)):(t.datavisualization.Diagram.Util.removeItem(r.children,f.name),y.push(f)),l=0;l<r.children.length;l++)p.push(this.diagram.nameTable[this.diagram._getChild(r.children[l])]);h={changeType:c,state:"changing",element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:y,newItems:v,cancel:!1};this._raiseEvent("selectionChange",h);h.cancel||(c=="remove"&&t.datavisualization.Diagram.Util.removeItem(this.diagram.model.selectedItems.children,f),this.diagram.updateSelection(this.selectedObject),t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),this.selectedObject=o[0],this.diagram.model.selectedItems.children.length?t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints):(t.datavisualization.Diagram.Util.clear(this.diagram.selectionList),t.datavisualization.Diagram.SvgContext.clearSelector(this.diagram._adornerSvg,this.diagram._adornerLayer,this)),h={changeType:c,state:"changed",element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:y,newItems:v,cancel:!1},this._raiseEvent("selectionChange",h))}else f=this.actualObject,this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Keydown,o=this.diagram.selectionList[0],f!=o&&(this.diagram._hasSelection()&&this.diagram._clearSelection(!0),u=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u.children.push(o.name),this.selectedObject?u.children.push(this.selectedObject.name):u.children.push(f.name),this.diagram.nodes().push(u),this.diagram._nodes=n.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[u.name]=u,t.datavisualization.Diagram.Util._updateGroupBounds(u,this.diagram,null,!0),this.selectedObject=u,this.diagram._addSelection(this.selectedObject));this.selectedObject=this.diagram.selectionList[0]}else s=this._findNodeUnderMouse(i),t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(this.selectedObject=s);return s},i.prototype._checkRepeatedChild=function(i){for(var e=null,r=n.extend(!0,{},i),u,r=this.diagram._getChildren(r),f=0;f<r.length;f++)if(e=this.diagram.nameTable[r.children[f]],e._type==="group")for(u=0;u<r.children.length;u++)this._containsChild(e,r.children[u])||(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,r.children[u]))},i.prototype._hasMultipleSelection=function(n){for(var i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=0;t<i.length;t++)if(n.name==i[t])return!0;return!1},i.prototype._getNextParent=function(n){if(n.parent){var t=this.diagram.nameTable[n.parent];return this._hasMultipleSelection(t)?n:this._getNextParent(t)}return n},i.prototype._findObj=function(n,t){var r,u=n.getAttribute("id"),i;return t?r=this.diagram._findChildren(t,u):(i=n.getAttribute("class"),i&&(i==="ej-d-node"||i==="ej-d-group"?r=this.diagram._findNode(u):i==="ej-d-connector"&&(r=this.diagram._findConnector(u)))),r},i.prototype.mousedown=function(n){this.startPoint=this.mousePosition(n);this.currentPoint=this.startPoint;this.previousPoint=this.startPoint;this.diagramBounds=this.diagram._getDigramBounds()},i.prototype._isPolyline=function(){if(this.diagram.model.drawType.type==="connector"&&this.diagram.model.drawType.segments&&this.diagram.model.drawType.segments.length>0&&this.diagram.model.drawType.segments[0].type==="polyline")return!0},i.prototype.mousemove=function(n){(!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this instanceof t.datavisualization.Diagram.LineTool||this._isPolyline()||this.diagram.model.rulerSettings.showRulers)&&(this.currentPoint=this.mousePosition(n));this._drawRulerMarkers(n)},i.prototype._removeRulerMarkers=function(){var n=document.getElementsByClassName("ej-d-ruler-marker"),t,i;if(n&&n.length>0)for(i=n.length-1;i>=0;i--)t=n[i],t&&t.parentNode.removeChild(t)},i.prototype._drawRulerMarker=function(n,i,r,u){var o,s,h,c,l,a,f,e,v,y;if(n){if(e=i[0].getElementsByTagName("svg"),e.length>0)for(l in e){o=e[l];break}o&&(s=t.datavisualization.Diagram.ScrollUtil._getRulerSize(this.diagram),a=u?{id:i[0].id+"_marker",x1:0,y1:0,x2:s.left,y2:0,stroke:n.markerColor,"stroke-width":1.5,"class":"ej-d-ruler-marker"}:{id:i[0].id+"_marker",x1:0,y1:0,x2:0,y2:s.top,stroke:n.markerColor,"stroke-width":1.5,"class":"ej-d-ruler-marker"},f=this._createMarkarLine(i,a),h=this.diagram._currZoom,c=r.model.offset-r._starValue,u?(y=this.currentPoint.y*h-this.diagram._vScrollOffset+c,f.setAttribute("transform","translate(0 "+y+")")):(v=this.currentPoint.x*h-this.diagram._hScrollOffset+c,f.setAttribute("transform","translate("+v+" 0)")),o.appendChild(f))}},i.prototype._createMarkarLine=function(n,i){if(n){var r=document.getElementById(n[0].id+"_marker");return r&&r.parentNode.removeChild(r),r=document.createElementNS("http://www.w3.org/2000/svg","line"),t.datavisualization.Diagram.Util.attr(r,i),r}},i.prototype._drawRulerMarkers=function(){this.diagram.model.rulerSettings.showRulers&&(this._drawRulerMarker(this.diagram.model.rulerSettings.horizontalRuler,this.diagram._hRuler,this.diagram._hRulerInstance,!1),this._drawRulerMarker(this.diagram.model.rulerSettings.verticalRuler,this.diagram._vRuler,this.diagram._vRulerInstance,!0))},i.prototype.mouseup=function(){this._endAction();this.diagram._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(this.diagram);this.singleAction&&this.diagram.activateTool("select");delete this.diagramBounds;this._adjustLines={lines:[]};this._undoObject=null;this._redoObject=null},i.prototype.mousePosition=function(n){return this.diagram._mousePosition(n)},i.prototype.updateCursor=function(n){this.diagram._currentCursor=n;this.diagram._updateCursor()},i.prototype.nearestGridPoint=function(n){var i=t.datavisualization.Diagram.Point();if(this.diagram.model.snap&t.datavisualization.Diagram.Snap.Grid){var o=this.diagram.model.magnification/100,r=this.diagram.model.grid.horizontalSpacing*o,u=this.diagram.model.grid.verticalSpacing*o,f=n.x%r,e=n.y%u;i.x=f>=r/2?n.x+r-f:n.x-f;i.y=e>=u/2?n.y+u-e:n.y-e}return i},i.prototype.snap=function(n){var i=this.diagram.model.snapSettings,r=this.diagram._currZoom;return i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(n.x=t.datavisualization.Diagram.SnapUtil._round(n.x,t.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!0),r)),i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(n.y=t.datavisualization.Diagram.SnapUtil._round(n.y,t.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),r)),n},i.prototype._endAction=function(){var i,r,s,u,h,f,o,c,e;if(this.inAction=!1,this.svgHelper)if(i=this.helper,r=this.diagram._spatialSearch,i._type!="group")t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(r,r.quadTable[i.name],i);else for(s=this.helper.children.length-1,u=s;u>=0;u--)t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(r,r.quadTable[i.children[u].name],i.children[u]);this.helper&&(this.svgHelper&&(h=this.diagram,f=this,this.diagram._views.forEach(function(t){var r=h._views[t];if(f.helper)var i=r.svg.getElementById(f.helper.name),u=r.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(u).find("#"+f.helper.name)[0];i&&i.parentNode&&i.parentNode.removeChild(i);e&&u.removeChild(e)})),this.helper.gradient&&(o=this.diagram._svg.getElementsByTagName("defs")[0],c=this.diagram._svg.getElementById(this.helper.name+"_gradient"),o&&c&&o.removeChild(this.diagram._svg.getElementById(this.helper.name+"_gradient"))),e=document.getElementById(this.helper.name+"_parentdiv"),e&&e.parentNode.removeChild(e));this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer));this._currentPossibleConnection=null;this._possibleConnectionPort=null;this.helper=null;this.svgHelper=null;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0)},i.prototype._isResizeCorner=function(n){var t=!1;switch(n){case"n-resize":case"e-resize":case"w-resize":case"s-resize":case"ne-resize":case"nw-resize":case"se-resize":case"sw-resize":case"targetEndPoint":case"sourceEndPoint":t=!0}return t},i.prototype._initHelper=function(){this.selectedObject&&(this.helper=n.extend(!0,{},this.selectedObject),this._updateHelperName(this.helper))},i.prototype._updateHelperName=function(n,t){var u,i,r,f,e;for(t?n.name+="helper":n.name="helper",n.opacity=.5,u=n.labels,i=0,r=u.length;i<r;++i)u[i].name+="helper";if(n.ports)for(f=n.ports,i=0,r=f.length;i<r;++i)f[i].name+="helper";if(n._type==="group")for(e=this.diagram._getChildren(n.children),i=0,r=e.length;i<r;i++)this._updateHelperName(e[i],!0)},i.prototype._raiseEvent=function(n,t){return this.diagram.model[n]&&(t.elementType=this.diagram.getObjectType(t.element),t.diagramId=this.diagram.element[0].id,this.diagram._trigger(n,t)),t},i.prototype._findPort=function(n,t){var f=this.diagram._findPortAtPoint(n,t),r,e,u,i;if(!f&&t._type==="group")for(e=this.diagram._getChildren(t.children),u=0;u<e.length;u++)if(i=this.diagram.nameTable[e[u]],i&&!i.segments&&!i._isInternalShape)if(r=this._findPort(n,i),r&&this.diagram.getObjectType(i)!="group")this._currentPossibleConnection=i,f=r;else if(r)return r;return f},i.prototype._checkConnectionPossible=function(n){var r=null,o=null,s=this._sourcePossibleConnection,b=t.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y),i=this.diagram._findConnectableNodeUnderMouse(n),e,a,v,u,h,c,f,p;if(i&&(this._sourcePossibleConnection||this.selectedObject)&&(this.selectedObject&&(this._endPoint=="targetEndPoint"&&this.selectedObject.sourceNode&&(s=this.diagram.nameTable[this.selectedObject.sourceNode]),this._endPoint=="sourceEndPoint"&&this.selectedObject.targetNode&&(s=this.diagram.nameTable[this.selectedObject.targetNode])),this.selectedObject&&!this.selectedObject._isAnnotationLine&&(i=t.datavisualization.Diagram.bpmnHelper.canAllowConnection(this.diagram,s,i))),i&&!i.segments)i.type=="pseudoGroup"||i.isLane||i.isSwimlane?(this._currentPossibleConnection=null,this._possibleConnectionPort=null):(this._showPorts(i),this._currentPossibleConnection=i,(this._previousPossibleConnection==null||this._previousPossibleConnection.name!==this._currentPossibleConnection.name)&&(this._previousPossibleConnection=this._currentPossibleConnection));else if(this.diagram.activeTool instanceof t.datavisualization.Diagram.LineTool)this._showPorts(),this._currentPossibleConnection=null,this._possibleConnectionPort=null;else{for(e=t.datavisualization.Diagram.Point(0,0),this._endPoint=="targetEndPoint"?(e.x=this.selectedObject.targetPoint.x-25,e.y=this.selectedObject.targetPoint.y-25):this._endPoint=="sourceEndPoint"&&(e.x=this.selectedObject.sourcePoint.x-25,e.y=this.selectedObject.sourcePoint.y-25),a=t.datavisualization.Diagram.Rectangle(e.x,e.y,50,50),v=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,a),u=0;this._nearestNodes&&u<this._nearestNodes.length;u++)this._showPort(this._nearestNodes[u],!0);for(this._nearestNodes=[],u=0;u<v.length;u++)if(h=v[u],h.objects.length>0)for(c=0;c<h.objects.length;c++)f=h.objects[c],p=t.datavisualization.Diagram.Util.bounds(f),t.datavisualization.Diagram.Geometry.intersectsRect(a,p)?!f.segments&&f.visible&&(this._showPort(f),this._nearestNodes.push(f)):f.segments||this._showPort(f,!0);this._currentPossibleConnection=null;this._possibleConnectionPort=null}if(this._currentPossibleConnection){if(r=this._findPort(b,this._currentPossibleConnection),this._currentPossibleConnection&&(this._sourcePossibleConnection||this.selectedObject)&&this.selectedObject&&!this.selectedObject._isAnnotationLine&&(o=t.datavisualization.Diagram.bpmnHelper.canAllowConnection(this.diagram,s,this._currentPossibleConnection),this._currentPossibleConnection!=o&&(this._showPort(this._currentPossibleConnection,!0),o&&this._showPort(o),r=null),this._currentPossibleConnection=o),r&&t.datavisualization.Diagram.Util.canConnect(r,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(r,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.diagram):t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=r,r&&t.datavisualization.Diagram.Util.canConnect(r,!0)){var l=this._currentPossibleConnection,y=t.datavisualization.Diagram.Util._getPortPosition(this._possibleConnectionPort,t.datavisualization.Diagram.Util.bounds(l,!0)),w=t.Matrix.identity();t.Matrix.rotate(w,l.rotateAngle,l.offsetX,l.offsetY);y=t.Matrix.transform(w,y);this.currentPoint=y}}else this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=null)},i.prototype._showPorts=function(n){n?(this._currentPossibleConnection&&this._currentPossibleConnection.name!==n.name&&this._showPort(this._currentPossibleConnection,!0),this._showPort(n)):this._currentPossibleConnection!=null&&this._showPort(this._currentPossibleConnection,!0)},i.prototype._showPort=function(n,i){var r,u,e,f,o;if(i){if(r=n.ports,r)for(f=0,o=r.length;f<o;++f)u=r[f],(u.visibility&t.datavisualization.Diagram.PortVisibility.Hover||u.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._adornerSvg.getElementById(n.name+"_"+u.name),e&&e.setAttribute("visibility","hidden"))}else if(n.visible&&(r=n.ports,r))for(f=0,o=r.length;f<o;++f)u=r[f],(u.visibility&t.datavisualization.Diagram.PortVisibility.Hover||u.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"&&this.inAction||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._adornerSvg.getElementById(n.name+"_"+u.name),e&&e.setAttribute("visibility","visible"))},i.prototype._getAllLaneChildren=function(n,t){var i=this.diagram.getNode(n.name),r,u;if(i&&i.lanes&&i.lanes.length>0)for(r=0;r<i.lanes.length;r++)for(u=0;u<i.lanes[r].children.length;u++)t.push(i.lanes[r].children[u]);return t},i.prototype._getAllChildren=function(n){for(var t=0;t<n.length;t++)n[t].isSwimlane&&n.concat(this._getAllLaneChildren(n[t],n));return n},i.prototype._showAllPorts=function(n){var i,u,r=this.diagram.nodes();if(r=r.slice(),r=this._getAllChildren(r),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)||(n=!0),n)for(i=0,u=r.length;i<u;i++)this._showPort(r[i],n);else for(i=0,u=r.length;i<u;++i)this._showPort(r[i])},i.prototype._disconnect=function(n){var r,i=this.diagram.nameTable[n.targetNode],u=null;i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.targetPort),r=this._raiseEvent("connectionChange",{element:n,connection:null,port:null,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(i.inEdges,n.name),r.cancel||(n.targetNode=null,n.targetPort=null));i=this.diagram.nameTable[n.sourceNode];i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.sourcePort),r=this._raiseEvent("connectionChange",{element:n,connection:null,port:null,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(i.outEdges,n.name),r.cancel||(n.sourceNode=null,n.sourcePort=null))},i.prototype.getLabelUnderMouse=function(){return this.diagram._findLabelEditing?null:this.activeLabel},i.prototype._getNodesfrombounds=function(n,i){for(var s=[],r,u,e,c,l=this.diagram._sortByZIndex(this.diagram.nodes()),a,o,f=0,h=l.length;f<h;f++)e=this.diagram.nameTable[l[f].name],t.datavisualization.Diagram.Util.canConnect(e)&&(r=t.datavisualization.Diagram.Util.bounds(e,!1),c=[r.points[0],r.points[1],r.points[2],r.points[3],r.points[0]],a=[{x:n.left,y:n.top},{x:n.right,y:n.top},{x:n.right,y:n.bottom},{x:n.left,y:n.bottom},{x:n.left,y:n.top}],this.diagram._autoConnectEndPoint=!0,u=t.datavisualization.Diagram.Util.interSect(c,a,null,this.diagram),delete this.diagram._autoConnectEndPoint,o=!1,u.length==0&&(o=t.datavisualization.Diagram.Geometry.containsPoint(r,i)),(u&&u.length||o)&&s.push(e));return this._getAllChildren(s)},i.prototype._slopDistance=function(n,t,i){var r,u,c,l,a,v,s,h,y,p;a=i.x;v=i.y;r=n.x;u=n.y;c=t.x;l=t.y;var b=a-r,k=v-u,e=c-r,o=l-u,d=b*e+k*o,w=e*e+o*o,f=-1;return w!=0&&(f=d/w),f<0?(s=r,h=u):f>1?(s=c,h=l):(s=r+f*e,h=u+f*o),y=a-s,p=v-h,Math.sqrt(y*y+p*p)},i.prototype._getNearestNodePorts=function(n,i,r,u){var o,s,f,c,h,v=null,e,y,l,p=null,a;for(u.x=u.left,u.y=u.top,u.width=u.right-u.left,u.height=u.bottom-u.top,o=0;o<i.length;o++)for(f=this.diagram.nameTable[i[o].name],y=t.datavisualization.Diagram.Util.bounds(f),s=0;f.ports&&f.ports.length>0&&s<f.ports.length;s++)c=f.ports[s],e=t.datavisualization.Diagram.Util._getPortPosition(c,y),a=t.Matrix.identity(),t.Matrix.rotate(a,f.rotateAngle,f.offsetX,f.offsetY),e=t.Matrix.transform(a,e),l=t.datavisualization.Diagram.Geometry.distance(e,this.currentPoint),(!h||h&&h>l)&&(h=l,t.datavisualization.Diagram.Geometry.containsPoint(u,e)&&(v=c,p=f));return{nearestNode:p,nearestPort:v}},i.prototype._updateConnectionTarget=function(n,i){var o=this._endPoint=="targetEndPoint"?!0:!1;if(n=i?n:this.diagram.nameTable[this.diagram._getChild(n)],n){var r=this.currentPoint,f={left:r.x-n._endPointHitPadding.left,top:r.y-n._endPointHitPadding.top,right:n._endPointHitPadding.right+r.x,bottom:n._endPointHitPadding.bottom+r.y},e=this._getNodesfrombounds(f,r),u=this._getNearestNodePorts(n,e,r,f);u.nearestNode&&(this._currentPossibleConnection=u.nearestNode,u.nearestPort&&(t.datavisualization.Diagram.Util.canConnect(u.nearestPort,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection))&&(this._possibleConnectionPort=u.nearestPort));this._removeHighLighter();t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer);this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(this._possibleConnectionPort,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._currentPossibleConnection&&t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom);this.diagram._dock(n,this.diagram.nameTable,!0)}},i.prototype._raiseConnectionChangeEvent=function(n,i){var u={element:n,endPoint:this._endPoint,connection:this._currentPossibleConnection,port:this._possibleConnectionPort,cancel:!1},f=u.connection?u.connection.name:null,e=u.port?u.port.name:null,r;return i?(f!=n.targetNode||e!=n.targetPort)&&(u=this._raiseEvent("connectionChange",u)):(f!=n.sourceNode||e!=n.sourcePort)&&(u=this._raiseEvent("connectionChange",u)),u.cancel?void 0:(i?(this._currentPossibleConnection&&n.targetNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.inEdges.push(n.name),n.targetNode&&(r=this.diagram.nameTable[n.targetNode],r&&t.datavisualization.Diagram.Util.removeItem(r.inEdges,n.name))),r=this.diagram.nameTable[n.targetNode],this.diagram._comparePropertyValues(n,"targetNode",{targetNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),n.targetNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,r&&r._ports&&this._updateInternalPorts(r,n,!0),this.diagram._comparePropertyValues(n,"targetPort",{targetPort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),n.targetPort=this._possibleConnectionPort?this._possibleConnectionPort.name:null):(this._currentPossibleConnection&&n.sourceNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.outEdges.push(n.name),n.sourceNode&&(r=this.diagram.nameTable[n.sourceNode],r&&t.datavisualization.Diagram.Util.removeItem(r.outEdges,n.name))),r=this.diagram.nameTable[n.sourceNode],this.diagram._comparePropertyValues(n,"sourceNode",{sourceNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),n.sourceNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,r&&r._ports&&this._updateInternalPorts(r,n,!1),this.diagram._comparePropertyValues(n,"sourcePort",{sourcePort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),n.sourcePort=this._possibleConnectionPort?this._possibleConnectionPort.name:null),!0)},i.prototype._updateInternalPorts=function(n,i,r){var u=t.datavisualization.Diagram.Util.findPortByName(n,r?i.targetPort:i.sourcePort),e,o,f;u&&u.type==="internal"&&u.name===(r?i.targetPort:i.sourcePort)&&(e=n._ports.indexOf(u),n._ports.splice(e,1),r?(i._removeTargetPort=u,i.targetPort=null):(i._removeSourcePort=u,i.sourcePort=null),o=t.datavisualization.Diagram.Util.getPoints(i),f=[],f.push({points:o,type:"orthogonal"}),this.diagram._isUndo=!0,this.diagram.updateConnector(i.name,{segments:f}),delete this.diagram._isUndo)},i}();t.datavisualization.Diagram.ToolBase=i;u=function(i){function r(n){i.call(this,"select",n);this.cursor="default";this._svgHelper=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);var r=this._findNodeUnderMouse(n);this.selectedObject=r&&t.datavisualization.Diagram.Util.canSelect(r)&&t.datavisualization.Diagram.Util.enableLayerOption(r,"lock",this.diagram)?r:null;this._itemClick(this.selectedObject,this.actualObject,this.selectedObject);this._nodeUnderMouseDown=this.diagram._findNodeUnderMouse(n)},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);var r=this._nodeUnderMouseDown;(!this.selectedObject&&!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||r&&r.isLane&&t.datavisualization.Diagram.Util.canMultiSelectOnLane(r)||r&&r._type!="connector"&&t.datavisualization.Diagram.Util.canMultiSelectOnNode(r))&&t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this._updateHelper():(this.inAction=!0,this._initHelper()))},r.prototype.mouseup=function(r){var o,u,s,f,e,h,l,c;if(this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction)if(this.currentPoint=this.mousePosition(r),o=t.datavisualization.Diagram.Geometry.rect([{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPoint.x,y:this.currentPoint.y}]),o.width!==0||o.height!==0){if(u=[],u=this.diagram._getNodesfrombounds(o),this.diagram._hasSelection()&&(u=this.diagram._getChildren(u),t.datavisualization.Diagram.Util.removeItem(u,"multipleSelection"),this.diagram._clearSelection(u.length?!0:!1)),u.length>0){if(s=u,this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.RubberBand,s.length>1){for(e=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),h=0;h<s.length;h++)e.children.push(this.diagram._getChild(s[h]));this.diagram.nodes().push(e);this.diagram._nodes=n.extend(!0,[],this.diagram.nodes());this.diagram.nameTable[e.name]=e;f=e}else t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(f=u[0]);f&&((f._type==="group"||f.type==="pseudoGroup")&&t.datavisualization.Diagram.Util._updateGroupBounds(f,this.diagram),this.diagram._addSelection(f))}}else this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();else this.selectedObject||this.diagram._hasSelection()?(r.ctrlKey||r.shiftKey?t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&this._processCtrlKey(r):this.diagram._hasSelection()&&(!this.selectedObject||this.diagram.selectionList[0].name!=this.selectedObject.name)&&this.diagram._clearSelection(this.selectedObject?!0:!1),this.diagram._enableAPIMethods=!1,this.diagram._addSelection(this.selectedObject),this.diagram._enableAPIMethods=!0):this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();this.diagram._isDropped=!1;this._nodeUnderMouseDown=null;(this.selectedObject||this.actualObject)&&(l=this._findNodeUnderMouse(r),c=this.diagram._mousePosition(r.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(l),actualObject:this.actualObject,count:this.diagram._getEventDetail(r),offsetX:c.x,offsetY:c.y,event:r}));i.prototype.mouseup.call(this,r)},r.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this.selectedObject=null,this._svgHelper=null);i.prototype._endAction.apply(this)},r.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper","class":"rubberBandSelection",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},r.prototype._updateHelper=function(){var t=this.diagram._adornerSvg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._adornerSvg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},r}(i);t.datavisualization.Diagram.SelectTool=u;f=function(i){function r(n){i.call(this,"move",n);this.cursor="move";this._isMouseDown=!1;this.diffx=0;this.diffy=0;this.helper=null;this.hoverNode=null;this.stackOverNode=null;this.undoObject=[];this.activeLabel=null;this._canMoveLabel=!1;this.dragState=""}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){if(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diffx=0,this.diffy=0,this._allowPan(this.selectedObject,"mousedown",n),i.prototype.mousedown.call(this,n),this._isMouseDown=!0,this._canMoveLabel=!1,this.activeLabel=null,n)var r=this._findNodeUnderMouse(n);r&&!t.datavisualization.Diagram.Util.canSelect(r)&&t.datavisualization.Diagram.Util.enableLayerOption(r,"lock",this.diagram)?this.updateCursor("default"):this.diagram._currentCursor!="pointer"&&this.updateCursor(this.cursor);this.dragState=t.datavisualization.Diagram.DragState.Starting},r.prototype.mousemove=function(r){var o,u,f,s,h,e,c;this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse;this._allowPan(this.selectedObject,"mousemove",r);i.prototype.mousemove.call(this,r);t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);o=!this.inAction;this._isMouseDown&&!this.inAction&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y||this.diagram._selectedSymbol)&&!this.selectedObject&&(this.diagram.selectionList&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].type==="pseudoGroup"||this.diagram._selectedSymbol||t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram))&&(this._updateSelectedObject(),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),this.selectedObject!=null&&(u=f=t.datavisualization.Diagram.Util.bounds(this.selectedObject),s={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},h={bounds:{x:u.x,y:u.y,width:u.width,height:u.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection(!0),this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:s,newValue:h,cancel:!1}),e={},this.selectedObject&&(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(e=this.diagram._getChildTable(this.selectedObject,e)),c=n.extend(!0,{},{childTable:e,node:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},c)));this._isMouseDown&&this.selectedObject&&t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&!this.diagram._isEditing&&t.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&(this.dragState=t.datavisualization.Diagram.DragState.Dragging,this.inAction||(this.inAction=!0,this.updateCursor("move"),this._updateSelection(),this.selectedObject.segments&&(t.datavisualization.Diagram.Util.isTargetConnected(this.selectedObject)||t.datavisualization.Diagram.Util.isSourceConnected(this.selectedObject))&&this._disconnect(this.selectedObject),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram)),this.diagram&&!this.diagram._isEditing&&(this._containerMouseMove(r),this.helper||this._updateObject(),this.selectedObject.segments||this.selectedObject.isLane||this.diagram._renderTooltip(this.selectedObject,o),this.diagram._updateSelectionHandle(!0)));this.previousPoint=this.currentPoint;this._stackOverNode=this._findStackOverNode(this.helper,r);delete this.diagram._notAllow},r.prototype._updateSelectedObject=function(){var n=this.diagram._focusedElement;n&&(this.diagram.selectionList[0]&&this.diagram.selectionList[0].type=="pseudoGroup"?this.selectedObject=this.diagram.selectionList[0]:this.diagram.selectionList[0]!=n?(this.diagram._clearSelection(!0),this.selectedObject=this.diagram.nameTable[n.name]):this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name])},r.prototype._nodeCanHighlight=function(n){var t=!1;return this.diagram._getChildren(n.children).indexOf(this.selectedObject.name)==-1&&(this.selectedObject._type!="group"?t=!0:n._type==="group"&&(this._containsChild(this.selectedObject,n.name)||(t=!0))),t},r.prototype._swimlanPhaseDrag=function(){if(this.selectedObject&&this.selectedObject.isPhase){var n=null,i=this._getNodeUnderMouse();i&&(n=this._getSwimLaneNode(i,this.selectedObject,!0));n&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom)}},r.prototype._containerMouseMove=function(n){var i,f,r=this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent],u;r&&r.container?(u=r.container,(u.type=="canvas"||u.type=="stack")&&(t.datavisualization.Diagram.canvasHelper._updateHelper(this.diagram),t.datavisualization.Diagram.canvasHelper._updateHighlighter(this.diagram,n))):(this.selectedObject.isSwimlane||(this.selectedObject.type=="pseudoGroup"&&this._isParentAsLane(this.selectedObject)?this._removeHighLighter():this.isDiagram(n)||this.selectedObject.segments?!this.isDiagram(n)&&this.selectedObject.isPhase?t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram):this._removeHighLighter():(i=this._getNodeUnderMouse(),i&&i.container&&(this.selectedObject.isSwimlane||this.selectedObject.isLane)?this._getSwimLaneNode(i,this.selectedObject)&&this._nodeHighLighter(i):i&&i.container&&i.container.type!="stack"?(this.selectedObject.name!=i.name&&this.selectedObject.type!="pseudoGroup"&&t.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.selectedObject,i)&&this._nodeHighLighter(i),i&&(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this._fromDiagram(this.selectedObject.children)&&this._nodeHighLighter(i)):i&&(this._removeHighLighter(),i.segments?t.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(i,this.diagram,this.diagram._currZoom):this._nodeHighLighter(i)))),f||(this.selectedObject.type=="pseudoGroup"?this._fromDiagram(this.diagram._getChildren(this.selectedObject.children))?(this._undoObject||t.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)):(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):t.datavisualization.Diagram.Util.canMove(this.selectedObject)&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)));this._swimlanPhaseDrag(n)},r.prototype.isDiagram=function(n){return n.target.id==this.diagram._id+"_canvas_svg"||n.target.id.match(this.selectedObject.name)?!0:!1},r.prototype._allowPan=function(n,i,r){i==="mousedown"&&this.diagram.tools.panTool.mousedown(r);n&&(n._type==="group"||n._type=="node")&&n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan&&(i==="mousemove"?this.diagram.tools.panTool.mousemove(r):i==="mouseup"&&this.diagram.tools.panTool.mouseup(r))},r.prototype._checkForDropEvent=function(n,i){var o;if(!this.diagram._selectedSymbol){var r=this.diagram,f=n,e=null,u=t.datavisualization.Diagram.ObjectTypes.Diagram;this.selectedObject&&this.selectedObject.parent&&(r=this.diagram.nameTable[this.selectedObject.parent],r.isLane?u=t.datavisualization.Diagram.ObjectTypes.Lane:r._type=="group"&&(u=t.datavisualization.Diagram.ObjectTypes.Group));n&&!i&&(e=t.datavisualization.Diagram.Util.bounds(n),f=this._getTargetNode(n,e));do if(n&&!t.datavisualization.Diagram.Util.canAllowDrop(n))if(n.parent)n=this.diagram.nameTable[n.parent];else if(n.container)break;else n=null;else break;while(n);if(n)return o=this._raiseEvent("drop",{cancel:!1,element:this.selectedObject,source:this.diagram.getNode(r),target:this.diagram.getNode(f),sourceType:u}),o.cancel}return!1},r.prototype._getSwimLaneNode=function(n,t,i){if(n.isSwimlane)if(i){if(this.diagram.nameTable[this.diagram._getChild(n.children[2])].container.orientation==t.orientation)return n}else if(this.diagram.nameTable[this.diagram._getChild(n.children[2])].container.orientation!=t.orientation)return n;if(n.parent){var r=this.diagram.nameTable[n.parent];if(r)return this._getSwimLaneNode(r,t,i)}return null},r.prototype._cloneGroupNode=function(t,i){var o=null,r,u,e,f;if(u=n.extend(!0,{},t),u.name+=i,t&&t._type==="group")for(u.children=[],e=this.diagram._getChildren(t.children),f=0;f<e.length;f++)o=this.diagram.nameTable[e[f]],r=n.extend(!0,{},o),r.name+=i,r.parent&&(r.parent+=i),r._type==="group"&&this._cloneGroupNode(r,i),this.diagram.nameTable[r.name]=r,u.children.push(r);return u},r.prototype._outOfBoundsLaneDrop=function(n,i){var r,o,s;if(n&&n.isLane&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var p=t.datavisualization.Diagram.Util.bounds(n),u=this._getPageBounds(),l=i.offsetX,a=i.offsetY,h=0,c=0,f=0,v=0,y=this.diagram.nameTable[this.diagram._getChild(i.children[2])],e=this.diagram.nameTable[this.diagram._getChild(i.children[0])];if((v=e?e.height:v,f=i.phaseSize?i.phaseSize:f,y&&(r=this.diagram.nameTable[this.diagram._getChild(y.children[0])],r&&(h=r.minHeight>100?r.minHeight:100,c=r.minWidth>100?r.minWidth:100)),n.orientation==="horizontal"?(o=c,s=h+e.height+f):(o=c+f,s=h+e.height),l+o/2+5>=u.width||l-o/2-5<=u.x)||a+s/2+5>=u.height||a-s/2-5<=u.y)return!1}return!0},r.prototype._getMouseOverElement=function(t,i){var r=null,h,e,f;if(t&&t.target)for(var o=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group,.ej-d-group ej-d-classifier,.ej-d-node ej-d-classifier,.ej-d-label ej-d-classifier"),u=o[0],s=1;u;)if(h=this.diagram._isForeignObject(t.target),h?r=this.diagram._findNode(u.getAttribute("id").split("_parentdiv")[0]):(r=this.diagram._findNode(u.getAttribute("id")),r||(r=this.diagram._findNode(u.getAttribute("id").split("_label")[0]))),r&&r.container)u=null;else{if(r&&i&&r._isHeader&&r.parent&&(e=this.diagram.nameTable[r.parent],e&&e.isSwimlane))break;u=o[s];!u&&r&&r.parent&&(f=this.diagram.nameTable[r.parent],f&&f.isLane&&(r=f));s++}return r},r.prototype._multiNodedrag=function(n){t.datavisualization.Diagram.canvasHelper&&!this._containsSwimlane(this.selectedObject.children)&&t.datavisualization.Diagram.canvasHelper._multiNodedrag(this.diagram,n,this.selectedObject)},r.prototype._changeNodeState=function(n,i,r){var v,o=null,u=this._getMouseOverElement(n,r),c,f,s,h,e,l,a,y;return u&&(u=this.selectedObject&&!this.selectedObject.isLane||u.isLane?u:null),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isLane&&!i?(this.diagram._isDragg=!0,u&&(o=this._getSwimLaneNode(u,this.selectedObject)),u&&o?t.datavisualization.Diagram.canvasHelper._addNewLane(this.diagram,u,o):(c=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],this.diagram._isUndo=!0,this.diagram.remove(this.selectedObject),t.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.selectedObject),this.diagram._selectedSymbol&&t.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.diagram._selectedSymbol),this.diagram._isUndo=!1,f=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(this.selectedObject,this.diagram,null,null,c),f&&(s={element:this.diagram.getNode(this.selectedObject),cancel:!1},this.diagram._selectedSymbol=null,this._outOfBoundsLaneDrop(this.selectedObject,f)?(this.diagram._raiseDropEvent(s),s.cancel?this.selectedObject=null:(this.diagram._eventCause.nodeCollectionChange=t.datavisualization.Diagram.CollectionChangeCause.Drop,this.diagram.add(f)?(f=this.diagram.nameTable[f.name]||f,this.diagram._selectedSymbol=f,this.diagram._updateDroppedSymbol(f),this.selectedObject=f):this.selectedObject=null)):this.selectedObject=null))):this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container?(h=this.diagram.nameTable[this.selectedObject.parent],h&&(e=h.container,this._removeHelpers(),e&&e.type=="canvas"?(t.datavisualization.Diagram.SvgContext._showNode(this.selectedObject,this.diagram._svg),this.selectedObject.type=="pseudoGroup"||this.diagram._isDragg||(this._swimlaneNodeDragged=t.datavisualization.Diagram.canvasHelper._singleNodedrag(this.diagram,n,u))):e.type=="stack"?t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer):(this.isDiagram(n)&&this._addToDiagram(),this.diffx=this.diffy=0))):this.selectedObject&&!this.selectedObject.isSwimlane&&(this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()?(this.currentPoint=this.previousPoint,this.diffx=0,this.diffy=0,this._removeHelpers(),this._multiNodedrag(n,u)):(this.selectedObject.type!="connector"||this.selectedObject.isPhase)&&!this.isDiagram(n)&&this.selectedObject.type!="pseudoGroup"?(u=this._getMouseOverElement(n),this.diagram._isDragg||(u&&u.container&&t.datavisualization.Diagram.Util.canAllowDrop(u)&&!this._checkForDropEvent(u)&&!u.isSwimlane&&t.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.selectedObject,u)?(l=this.helper?this.helper:this.selectedObject,t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,l,u)?(t.datavisualization.Diagram.canvasHelper._addNodeToContainer(this.diagram,this.selectedObject,u),a=this.diagram._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,this.diagram._raiseGroupChangeEvent(this.selectedObject,null,u,a)):(this.diagram._translate(this.selectedObject,this.undoObject.node.offsetX-this.selectedObject.offsetX,this.undoObject.node.offsetY-this.selectedObject.offsetY,this.diagram.nameTable),this.diagram._updateAssociatedConnectorEnds(this.selectedObject,this.diagram.nameTable))):u&&this.selectedObject.name!=u.name&&this._checkForDropEvent(u,!0))):this.selectedObject.type!="connector"||this.selectedObject.isPhase?(y="",(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this.diagram._activeSwimLane?(this._multiNodedrag(n,u),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,this.diagram._activeSwimLane,"group"),this.selectedObject=null):!this.diagram._activeSwimLane&&u&&u.isLane?(this.diagram._activeSwimLane=this._getParentSwimlane(u),this._multiNodedrag(n,u),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,u,"group"),this.selectedObject=null):u&&(u.type=="bpmn"||u.container)&&(this._multiNodedrag(n,u),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,u,"group"),this.selectedObject=null)):u&&(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this._fromDiagram(this.selectedObject.children)&&t.datavisualization.Diagram.Util.canAllowDrop(u)&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._multiNodedrag(n,u))),this._removeHelpers(),this._checkPhaseDrop(n),v},r.prototype._checkPhaseDrop=function(n){var i=null,r,u,f,e,s,o;this.selectedObject&&this.selectedObject.isPhase&&(f=this._findNodeUnderMouse(n),f&&(i=this._getSwimLaneNode(f,this.selectedObject,!0)),i?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),e=this._getSwimlaneHeader(i),this.selectedObject.orientation=="vertical"?(r=this.currentPoint.x-(i.offsetX-i.width/2),u="horizontal"):(r=this.currentPoint.y-(i.offsetY-i.height/2),r-=e?e.height:0,u="vertical"),s={element:this.selectedObject,cancel:!1,target:i},this.diagram._dropPhase=!0,this.diagram.remove(this.selectedObject),delete this.diagram._dropPhase,this.diagram._selectedSymbol=null,this.inAction=!1,o=this.selectedObject.labels&&this.selectedObject.labels.length>0?this.selectedObject.labels[0]:{text:"Phase"},this.diagram._addPhase(i.name,{name:t.datavisualization.Diagram.Util.randomId(),offset:r,orientation:u,label:o,lineColor:this.selectedObject.lineColor,lineDashArray:this.selectedObject.lineDashArray,lineWidth:this.selectedObject.lineWidth}),this.diagram._selectedSymbol=null):(this.diagram._remove(this.selectedObject),this.diagram._clearSelection(!0),this.selectedObject=null,this.diagram._selectedSymbol=null))},r.prototype._removeHelpers=function(){t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer);t.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg);this._removeHighLighter();this.diffx=0;this.diffy=0},r.prototype._updateNodeState=function(n,i){var f,u,s,c,l,e,r,v,a,o,h;if(this.diagram.nameTable[this.selectedObject.parent]&&(f=this.diagram.nameTable[this.selectedObject.parent].container),u=this._getNodeUnderMouse(),u&&(u=!this.selectedObject.isLane||u.isLane?u:null),f){if(f.type=="canvas")u&&i&&(s=this.selectedObject.parent,c=this.diagram._getSwimlane(s),c&&this.diagram._updateChildAdjacentConnectors(c,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram));else if(f.type=="stack"&&(l=this._checkForDropEvent(u),!l))if(e=this._stackOverNode,e){if(r=this.diagram.nameTable[e.parent],r||(r=u),v=t.datavisualization.Diagram.Util.bounds(r),a=r.rotateAngle,r.rotateAngle==0||a!=0||this.diagram._rotate(r,-r.rotateAngle,this.diagram.nameTable),r.children=this.diagram._getChildren(r.children),this.selectedObject.name!=e.name&&(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.canvasHelper._swapLane(this.diagram,r.children,this.selectedObject.name,e.name,r.container.orientation==="vertical"?!0:!1,r),r.children&&r.children.length>0))for(o=0;o<r.children.length;o++)r.children[o]=this.diagram.nameTable[r.children[o]]}else this.diffx=this.diffy=0}else this.selectedObject.type=="pseudoGroup"&&(h=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],h&&h.parent&&(f=this.diagram.nameTable[h.parent].container),f&&f.type=="canvas"&&u&&i&&(s=this.selectedObject.parent,this.diagram._updateChildAdjacentConnectors(s,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram)));this.selectedObject&&this.selectedObject.lebels&&this.selectedObject.lebels.length>0&&this.diagram.nameTable[this.selectedObject.name]&&this.diagram._updateQuad(this.selectedObject)},r.prototype.mouseup=function(r,u){var p=this.inAction,f,c,e,o,w,b,k,d,s,l,g,a,it,v,nt,h,y;if(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction?(this.dragState=t.datavisualization.Diagram.DragState.Completed,t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),c=this._changeNodeState(r,u,!0),this.inAction=!1,this.selectedObject&&(e=o=t.datavisualization.Diagram.Util.bounds(this.selectedObject),w={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},b={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.selectedObject.isLane||(this._swimlaneNodedragged||(k=this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)),this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container&&c||(this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:w,newValue:b,cancel:!1}),this.dragState=""),t.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&(this.undoObject.connectors={},this._redoConnectors={},this.diagram._updateAllEdges(this.selectedObject))),u||this._updateNodeState(r,c),this._updateObject(),s={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(s=this.diagram._getChildTable(this.selectedObject,s)),this.diagram._selectedSymbol||this.selectedObject.isPhase||this.selectedObject.isLane||this._isLane||this.diagram._isDragg||(l={childTable:s,node:this.selectedObject},t.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&this._redoConnectors&&(l.connectors=this._redoConnectors),d=n.extend(!0,{},l),g={type:"positionchanged",undoObject:jQuery.extend(!0,{},this.undoObject),redoObject:jQuery.extend(!0,{},d),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal",activeLabel:this.activeLabel},this._multipleUndo||this.diagram.addHistoryEntry(g),this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].type=="bpmn"&&this.diagram._isGroupActionEnabled&&(this.diagram._closeGroupAction(),delete this.diagram._isGroupActionEnabled)),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isSwimlane&&(this.diagram._selectedSymbol=null),this.diagram._updateSelectionHandle(),f=this.selectedObject,this._isLane=!1,this._multipleUndo=!1)):this.selectedObject?f=this._findNodeUnderMouse(r):(r.ctrlKey||r.shiftKey?f=this._processCtrlKey(r):(a=!0,it=r.target.className,v=t.datavisualization.Diagram.Util.isClassifier(r)?t.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(r,this.diagram):this._findNodeUnderMouse(r),r.which===3&&this.diagram.selectionList[0]&&(this.diagram.selectionList[0].type==="pseudoGroup"||this.diagram.selectionList[0]._type==="group")&&this._hasMultipleSelection(v)&&(a=!1),t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&this._isMouseDown&&(this.selectedObject=a?v:this.diagram.selectionList[0]),f=this.selectedObject),nt=this.diagram.selectionList.length>0?this.diagram.selectionList[0]:null,this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection(!0)),!k&&this.selectedObject){if(this.selectedObject&&this.selectedObject.type!="pseudoGroup"&&!p){var tt=this._findNodeUnderMouse(r,!0),rt=this.selectedObject,ut=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:tt,model:this.diagram.model,cancel:!1,event:r});this._itemClick(this.selectedObject,this.actualObject,tt,nt);ut.cancel&&(this.selectedObject=rt)}this.selectedObject&&(this._allowPan(this.selectedObject,"mouseup",r),this.selectedObject.isPhase||this._updateSelection(),this._enableLabel(this.selectedObject,this.activeLabel),this.selectedObject&&this.selectedObject.parent===""&&(this.selectedObject.isSwimlane?(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):this.diagram._isHyperLink(r)||t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),h=this.selectedObject,this.diagram._isDragg&&!this.diagram._selectionContains(h)&&(this.diagram._clearSelection(),h.isPhase||this.diagram._addSelection(h))));f&&!p&&(y=this.diagram._mousePosition(r.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(f),actualObject:this.diagram.getNode(this.actualObject),count:this.diagram._getEventDetail(r),offsetX:y.x,offsetY:y.y,event:r}))}this._multipleUndo=!1;delete this.diffx;delete this.diffy;delete this._isMouseDown;delete this.actualObject;delete this._swimlaneNodedragged;this.diagram._removeTooltip();this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit();delete this.hoverNode;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.diagram._activeSwimLane=null;i.prototype.mouseup.call(this,r)},r.prototype._updateObject=function(){var i,r,n,u;if(this.selectedObject)if(this.selectedObject.type=="pseudoGroup")for(r=this.diagram._getChildren(this.selectedObject.children),n=0,u=r.length;n<u;n++)i=this.diagram.nameTable[r[n]],i&&t.datavisualization.Diagram.DiagramContext.update(i,this.diagram);else this.selectedObject.parent&&(t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this.diagram._updateParentBounds(this.diagram.nameTable[this.selectedObject.parent])),this.selectedObject.isSwimlane?(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._isMouseDown=!1;this._mouseOffset=t.datavisualization.Diagram.Size(0,0)},r.prototype._updateHelperXY=function(n,i,r){var a=r.x<i.x,v=r.y<i.y,o=this.diffx+(r.x-i.x),s=this.diffy+(r.y-i.y),u,f,c,e,l,h;(this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines)&&this.diagram._enableSnapToObject()&&(u=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.helper,a,v,t.datavisualization.Diagram.Point(o,s),r,i));u||(u=t.datavisualization.Diagram.Point(o,s));this.diffx=o-u.x;this.diffy=s-u.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(u)||(f=t.datavisualization.Diagram.Util.bounds(n),f=t.datavisualization.Diagram.Rectangle(f.left,f.top,f.right-f.left,f.bottom-f.top),c={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},this._outOfBoundsDrag(n,u.x,u.y)&&this.diagram._translate(n,u.x,u.y,this.diagram.nameTable),e=t.datavisualization.Diagram.Util.bounds(n),e=t.datavisualization.Diagram.Rectangle(e.left,e.top,e.right-e.left,e.bottom-e.top),l={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},h=this._raiseDragEvent({element:this.diagram.getNode(this.helper),offset:u,oldValue:c,newValue:l,cancel:!1}),h&&!h.cancel?this.inAction||n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram):this.diagram._translate(n,-u.x,-u.y,this.diagram.nameTable))},r.prototype._outOfBoundsDrag=function(n,i,r,u){var f,e,o;if(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)&&(f=t.datavisualization.Diagram.Util.bounds(n),e=this._getPageBounds(),u&&(i=u==="horizontal"?0:i,r=u==="vertical"?0:r),f)){if(o=this._getPadding(n),n.isPhase)return!0;if((!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(f.right+i+o.x>e.width||f.left+i-o.x<e.x)||(!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(f.bottom+r+o.y>e.height||f.top+r-o.y<e.y))return this.updateCursor("not-allowed"),!1}return this.diagram._notAllow||this.updateCursor("move"),!0},r.prototype._updateXY=function(n,i,r,u){var v=r.x<i.x,y=r.y<i.y,h=this.diffx+(r.x-i.x),c=this.diffy+(r.y-i.y),f,s,e,l,o,a;if((this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines||this.diagram._enableSnapToObject())&&(f=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.selectedObject,v,y,t.datavisualization.Diagram.Point(h,c),r,i)),f||(f=t.datavisualization.Diagram.Point(h,c)),this.diffx=h-f.x,this.diffy=c-f.y,(!t.datavisualization.Diagram.Geometry.isEmptyPoint(f)||this.diagram._selectedSymbol&&!this.inAction)&&(e=t.datavisualization.Diagram.Util.bounds(n),e=t.datavisualization.Diagram.Rectangle(e.left,e.top,e.right-e.left,e.bottom-e.top),l={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},n.segments||t.datavisualization.Diagram.Util.canAllowPan(n)&&(this.diagram._hScrollOffset===0&&(f.x=0),this.diagram._vScrollOffset===0&&(f.y=0)),u&&!n.isSwimlane&&n.type!="pseudoGroup"&&(this.diagram._preventDocking=!0),this._outOfBoundsDrag(n,f.x,f.y))){if(this.diagram._raiseOffsetPropertyChange(n,f.x,f.y,!0),this.diagram._translate(n,f.x,f.y,this.diagram.nameTable),delete this.diagram._preventDocking,o=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Rectangle(o.left,o.top,o.right-o.left,o.bottom-o.top),a={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},this.diagram._selectedSymbol){if(s={element:this.diagram.getNode(this.selectedObject),allowDrop:!0,target:this._getNodeUnderMouse(),oldValue:l,newValue:a,cancel:!1},s.target&&s.target.segments&&t.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(s.target,this.diagram,this.diagram._currZoom),this._raiseEvent("dragOver",s),s.allowDrop)this.diagram._notAllow||this.updateCursor("move");else if(this.updateCursor("not-allowed"),!this.inAction)return this.diagram._removeSymbolFromDiagram(),!0}else s=this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:f,oldValue:l,newValue:a,cancel:!1});s&&!s.cancel||this.diagram._selectedSymbol?(n._type==="group"&&n.type!="bpmn"||n.type==="pseudoGroup")&&(t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject)):s&&s.cancel&&this.diagram._translate(n,-f.x,-f.y,this.diagram.nameTable)}},r.prototype._boundsInterSects=function(n,t){var i=[],r;return t&&(r=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height},{x:t.x,y:t.y}],i=this._intersect(n,r,i)),i},r.prototype._intersect=function(n,i,r){for(var u,e,o=[],f=0;f<n.length-1;f++){for(u=0;u<i.length-1;u++)e=t.datavisualization.Diagram.Util.interSect2(n[f],n[f+1],i[u],i[u+1]),t.datavisualization.Diagram.Geometry.isEqualPoint(t.datavisualization.Diagram.Point(0,0),e)||o.push(e);r&&i.length>=1}return o},r.prototype._getInterceptWithSegment=function(n,i){for(var l=[],a,r,e,u,h,c,o,s=t.datavisualization.Diagram.Util.findLength(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(this.diagram._viewPort.width,this.diagram._viewPort.height)),f=1;f<i.length;f++)for(u=[i[f-1],i[f]],e=[],r=Math.round(t.datavisualization.Diagram.Util.findAngle(u[0],u[1])%360,2),a=Math.round(t.datavisualization.Diagram.Util.findAngle(u[1],u[0])%360,2),h=r>0&&r<=90||r>180&&r<=270?90:-90,e.push(t.datavisualization.Diagram.Geometry.transform(n,r+h,s)),e.push(t.datavisualization.Diagram.Geometry.transform(n,a+h,s)),c=this._intersect(u,e,!1),o=0;o<c.length;o++)l.push(c[o]);return l},r.prototype._raiseDragEvent=function(n){if(!this.diagram._selectedSymbol&&!this.diagram._isDragg)return n.dragState=this.dragState,this._raiseEvent("drag",n)},r.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject))},r.prototype._disableLabel=function(t,i){if(t&&i){var u=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=t._shape=="text"?t.name:t.name+"_"+i.name,r=n(u).find("#"+f+".ej-d-label")[0];r&&(r.style.pointerEvents="none")}},r.prototype._enableLabel=function(t,i){if(t&&i){var u=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=t._shape=="text"?t.name:t.name+"_"+i.name,r=n(u).find("#"+f+".ej-d-label")[0];r&&(r.style.pointerEvents="all")}},r}(i);t.datavisualization.Diagram.MoveTool=f;e=function(n){function i(t){n.call(this,"Port",t);this.cursor="pointer";this._isMouseDown=!1}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){this._isMouseDown=!0;n.prototype.mousedown.call(this,t);this.activePort=this.diagram._getvalues(t)},i.prototype.mousemove=function(t){this.activePort&&(n.prototype.mousemove.call(this,t),this.inAction||(this.inAction=!0,this.selectedObject=this.diagram.nameTable[this.diagram._getChild(this.activePort.source.parent)],this.undoObject=jQuery.extend(!0,{},{node:this.selectedObject})),this._updatePortXY(this.activePort.source,this.previousPoint,this.currentPoint));this.previousPoint=this.currentPoint},i.prototype.mouseup=function(n){if(this._isMouseDown=!1,this.diagram.deactivateTool(n),this.inAction){this.inAction=!1;var t={type:"portpositionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},{node:this.selectedObject}),category:"internal",activePort:this.activePort.source};this._multipleUndo||this.diagram.addHistoryEntry(t)}},i.prototype._updatePortXY=function(n,t,i){var r=i.x-t.x,u=i.y-t.y;this.activePort&&(this.selectedObject||(this.selectedObject=this.diagram.nameTable[this.diagram._getChild(this.activePort.source.parent)]),this.diagram._translatePort(this.selectedObject,n,r,u))},i}(i);t.datavisualization.Diagram.PortTool=e;o=function(i){function r(n){i.call(this,"resize",n);this.cursor="default";this._resizeDirection=null;this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.diffx=0;this.diffy=0;this._startPoint=t.datavisualization.Diagram.Size(0,0);this.undoObject=null;this.pseudoGroupConstraints=null;this._mouseDown=!1;this.resizeState=""}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mousedown.call(this,n);this._mouseDown=!0;this.resizeState=t.datavisualization.Diagram.ResizeState.Starting},r.prototype.mousemove=function(r){var h,c,e,u,f,l,a,v,o,s;i.prototype.mousemove.call(this,r);h=!this.inAction;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name],e={},u=f=t.datavisualization.Diagram.Util.bounds(this.selectedObject),l={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},a={bounds:{x:u.x,y:u.y,width:u.width,height:u.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:l,newValue:a,cancel:!1,direction:this._resizeDirection}),(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(e=this.diagram._getChildTable(this.selectedObject,e)),v={childTable:e,node:this.selectedObject},this.selectedObject&&this.selectedObject.type==="pseudoGroup"&&(this.pseudoGroupConstraints=this.diagram.model.selectedItems.getConstraints&&n.isFunction(this.diagram.model.selectedItems.getConstraints)?this.diagram.model.selectedItems.getConstraints():t.datavisualization.Diagram.Util._getPseudoGroupConstraints(this.diagram,this.selectedObject,this.selectedObject)),c=n.extend(!0,{},v),this.undoObject=jQuery.extend(!0,{},c),this._resizeDirection=r.target.getAttribute("class"),this.selectedObject.width||(this.selectedObject.width=this.selectedObject._width),this.selectedObject.height||(this.selectedObject.height=this.selectedObject._height),this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX},t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._svg,this.diagram._currZoom),this.inAction=!0);this.selectedObject&&(this.resizeState=t.datavisualization.Diagram.DragState.Resizing,o=!1,this.selectedObject&&this.selectedObject.parent?(s=this.diagram.nameTable[this.selectedObject.parent],s.container&&(s.container.type=="canvas"||s.container.type=="stack")&&(o=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(o=!0),this.selectedObject&&o||this.selectedObject.type==="pseudoGroup"&&this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children))?this.selectedObject.type==="pseudoGroup"&&this._isParentAsLane(this.selectedObject)?t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject):t.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?t.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&this.diagram.nameTable[this.selectedObject.parent].container.type=="stack"?(this.helper||(this.helper=this._getCloneNode(this.selectedObject)),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.helper,this.diagram)):this.selectedObject.type!="pseudoGroup"?this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint):this.selectedObject.type=="pseudoGroup"&&!this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._undoObject||t.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint)),this.helper||(this.selectedObject.isSwimlane?this._isMouseDown||(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)),this.diagram._renderTooltip(this.selectedObject,h),this.diagram._updateSelectionHandle(!0));this.previousPoint=this.currentPoint},r.prototype.mouseup=function(r){var h=null,s,u,o,v,c,y,l,e,p,f,a,w;this._mouseDown=!1;this.inAction&&(this.resizeState=t.datavisualization.Diagram.ResizeState.Completed,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.inAction=!1,s=!1,o=t.datavisualization.Diagram.Util.bounds(this.undoObject.node),v={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:this.undoObject.node.offsetX,offsetY:this.undoObject.node.offsetY,width:this.undoObject.node.width,height:this.undoObject.node.height},u=t.datavisualization.Diagram.Util.bounds(this.selectedObject),this.selectedObject.parent&&(c=this.diagram.nameTable[this.selectedObject.parent],c&&c.container&&(u=t.datavisualization.Diagram.Util.bounds(this.helper))),y={bounds:{x:u.x,y:u.y,width:u.width,height:u.height},offsetX:u.x+u.width/2,offsetY:u.y+u.height/2,width:u.width,height:u.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:v,newValue:y,cancel:!1,direction:this._resizeDirection}),this.resizeState="",l=!0,(this.selectedObject.isLane||this.selectedObject.isSwimlane)&&(f={},f=this.diagram._getChildTable(this.selectedObject,f),h=n.extend(!0,{},{childTable:f,node:this.selectedObject})),this.selectedObject&&this.selectedObject.parent?(e=this.diagram.nameTable[this.selectedObject.parent],e.container&&(e.container.type=="canvas"||e.container.type=="stack")&&(s=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(s=!0),this.selectedObject&&s&&!e.isLaneStack?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,e)&&(this.selectedObject.isLane?t.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject):t.datavisualization.Diagram.canvasHelper._singleNodeResize(this.diagram,r,this.selectedObject),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram))):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject),l=!1):(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this.diagram._activeSwimLane&&t.datavisualization.Diagram.canvasHelper._multiNodeResize(this.diagram,r,this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this.diagram.nameTable[this.selectedObject.name].container||t.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&(this.undoObject.connectors={},this._redoConnectors={},this.diagram._updateAllEdges(this.selectedObject)),l&&t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(),f={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(f=this.diagram._getChildTable(this.selectedObject,f)),a={childTable:f,node:this.selectedObject},t.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&this._redoConnectors&&(a.connectors=this._redoConnectors),p=n.extend(!0,{},a),w={type:"sizechanged",undoObject:h?h:this.undoObject,redoObject:jQuery.extend(!0,{},p),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(w),this.diagram._removeTooltip(),this._multipleUndo=!1);i.prototype.mouseup.call(this,r)},r.prototype._updateSize=function(n,i,r,u,f,e,o,s,h){var it=u?u:this.currentPoint.x-this.startPoint.x,rt=f?f:this.currentPoint.y-this.startPoint.y,p=this._resizeObject(n,it,rt,s,h),w=t.datavisualization.Diagram.Point(p.x,p.y),a=p.width,v=p.height,g,b,y,c,nt,l,tt,k,d;if(n&&(this.pseudoGroupConstraints||(this.pseudoGroupConstraints=n.constraints)),this.pseudoGroupConstraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio&&(this._resizeDirection=="n-resize"||this._resizeDirection=="s-resize"||this._resizeDirection=="w-resize"||this._resizeDirection=="e-resize"?(g=t.Matrix.identity(),b=t.Matrix.transform(g,t.datavisualization.Diagram.Point(i.x-r.x,i.y-r.y)),Math.abs(b.x)>Math.abs(b.y)?v=a:a=v):v=i!=r?a=Math.max(v,a):a=0),y=t.datavisualization.Diagram.Size(),a<0&&(a=1),v<0&&(v=1),y.width=a,y.height=v,c=t.datavisualization.Diagram.Util.bounds(n),c=t.datavisualization.Diagram.Rectangle(c.left,c.top,c.right-c.left,c.bottom-c.top),nt={bounds:{x:c.x,y:c.y,width:c.width,height:c.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},!t.datavisualization.Diagram.Geometry.isEmptySize(y))if(this.resizeState=t.datavisualization.Diagram.ResizeState.Resizing,this._outOfBoundsDrag(n,a,v,w))this.diagram._raiseSizePropertyChange(n,a,v,!0),this.diagram.scale(n,a,v,w,this.diagram.nameTable,null,e,o),l=t.datavisualization.Diagram.Util.bounds(n),l=t.datavisualization.Diagram.Rectangle(l.left,l.top,l.right-l.left,l.bottom-l.top),tt={bounds:{x:l.x,y:l.y,width:l.width,height:l.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},k=n.pathData,(c.width!=l.width||c.height!=l.height)&&(d=this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:y,oldValue:nt,newValue:tt,direction:this._resizeDirection})),k&&n.pathData!=k&&(n._absoluteBounds=null,n._scaled=!0),d&&d.cancel&&!o&&this.diagram.scale(n,1/a,1/v,w,this.diagram.nameTable),n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),this.diagram._updateAssociatedConnectorEnds(n,this.diagram.nameTable);else return!0;this.pseudoGroupConstraints=null},r.prototype._getSwimLaneNode=function(n){var u,t,i,r;if(n&&(u=n.parent,t=this.diagram.nameTable[u],t&&(i=t.parent,i&&(r=this.diagram.nameTable[i],r))))return r},r.prototype._outOfBoundsDrag=function(n,i,r,u){var o;if(!this.diagram._skipoutOfBounds&&n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var f=this._getPageBounds(),c=n.height*r-n.height,l=n.width*i-n.width;if(!this.inAction&&n.isLane){var a=this._getSwimLaneNode(n),e=t.datavisualization.Diagram.Util.bounds(a),s=this._getPadding(n);if(!this.diagram._selectedSymbol&&e.right+l+s.x>f.width||!this.diagram._selectedSymbol&&e.bottom+c+s.y>f.height)return this.updateCursor("not-allowed"),!1}else{var e=t.datavisualization.Diagram.Util.bounds(n),s=this._getPadding(n),h=t.Matrix.identity();if((t.Matrix.rotate(h,-n.rotateAngle,u.x,u.y),t.Matrix.scale(h,i,r,u.x,u.y),t.Matrix.rotate(h,n.rotateAngle,u.x,u.y),o=t.Matrix.transform(h,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),!this.diagram._selectedSymbol&&(o.x+(e.width+l)/2+s.x>f.width||o.x-(e.width+l)/2<f.x))||!this.diagram._selectedSymbol&&(o.y+(e.height+c)/2+s.y>f.height||o.y-(e.height+c)/2<f.y))return this.updateCursor("not-allowed"),!1}this.updateCursor(this._resizeDirection)}return!0},r}(i);t.datavisualization.Diagram.ResizeTool=o;s=function(i){function r(n){i.call(this,"endPoint",n);this.cursor="move";this._endPoint=null;this._undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(r){var u;if(!this.inAction){i.prototype.mousedown.call(this,r);r.ctrlKey&&r.shiftKey&&(u=n(r.target).parents(".ej-d-connector"),u.length>0&&(this.selectedObject=this.diagram.nameTable[u[0].id],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject)));this._initialValue=null;this.diagram.selectionList[0]&&!this.selectedObject&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name]);this.undoObject=this._getClonedObject(this.selectedObject);this._endPoint=r.target.getAttribute("class");this.targetid=r.target.id;this._selectedSegment="";this._nearestNodes=[];var f=this._endPoint=="targetEndPoint"?!0:!1,e=this._endPoint=="sourceEndPoint"?!0:!1,o=this._raiseEndPointDrag(this.selectedObject,f,e,t.datavisualization.Diagram.DragState.Starting)}},r.prototype.mousemove=function(r){var g,c,l,v,y,p,o,e,w,a,k,d,s,h,b;if(i.prototype.mousemove.call(this,r),g=!this.inAction,this.selectedObject&&!(r.ctrlKey&&r.shiftKey)){c=!1;this.selectedObject.segments.length==2&&(c=!0);var u=this.currentPoint.x-this.previousPoint.x,f=this.currentPoint.y-this.previousPoint.y,nt=n.extend(!0,{},this.selectedObject.sourcePoint),tt=n.extend(!0,{},this.selectedObject.targetPoint),it=n.extend(!0,{},this.selectedObject.segments);if(this._outOfBoundsDrag(this.selectedObject,this.currentPoint.x,this.currentPoint.y))if(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)this.inAction&&(this.selectedSegment&&this._endPoint=="segmentEnd"?(d=this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Dragging),d.cancel||u==0&&f==0||(s=this.currentPoint.x-this.startPoint.x,h=this.currentPoint.y-this.startPoint.y,this._initialValue&&(s=this._initialValue.x+s-this.selectedSegment._endPoint.x,h=this._initialValue.y+h-this.selectedSegment._endPoint.y),u=u*s<0?0:s,f=f*h<0?0:h,this._updateAdjacentSegments(u,f))):this._endPoint!="segmentEnd"&&((this._endPoint=="targetEndPoint"||this._endPoint=="sourceEndPoint")&&this._checkConnectionPossible(r),b=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Dragging),b.cancel||(this._disconnect(this.selectedObject),this._updateConnection(this.selectedObject,b.updateSelection))),this.diagram._updateSelectionHandle(!0),this.diagram._updateQuad(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram));else{if(this.inAction=!0,this.selectedObject.segments.length>0)for(l=0;l<this.selectedObject.segments.length;l++)this.selectedObject.segments[l]._bridges=[];v=this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest");v&&v.setAttribute("pointer-events","none");y=this.diagram._svg.getElementById(this.selectedObject.name);y&&y.setAttribute("pointer-events","none");p=this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g");p&&p.setAttribute("pointer-events","none");o=this.targetid.split("_");o.reverse();e=Number(o[0]);this.selectedSegment=this.selectedObject.segments[e];w=this.selectedSegment;this.selectedSegment&&this.selectedSegment.type=="orthogonal"?(a=!1,e===0&&(k=!0),this.selectedSegment.length&&this.selectedSegment.direction?e==0?(this.insertFirstSegment(u,f,o),a=!0):this.nextSegment=this.selectedObject.segments[e+1]:(this._addTerminalSegment(u,f,o),a=!0)):this.nextSegment=this.selectedObject.segments[e+1];a&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,!(c||k||!this.selectedObject.sourcePort),!(c||!(w.length||w.length===0)||!this.selectedObject.targetPort),this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom));this.selectedSegment||this._endPoint!="targetEndPoint"||(this.selectedSegment=this.selectedObject.segments[this.selectedObject.segments.length-1]);this.selectedSegment||this._endPoint!="sourceEndPoint"||(this.selectedSegment=this.selectedObject.segments[0],this.nextSegment=this.selectedObject.segments[1]);this.selectedSegment&&(this._initialValue={x:this.selectedSegment._endPoint.x,y:this.selectedSegment._endPoint.y});this.diagram._updateSelectionHandle(!0);this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Starting)}this.diagram._comparePropertyValues(this.selectedObject,"sourcePoint",{sourcePoint:nt},!0);this.diagram._comparePropertyValues(this.selectedObject,"targetPoint",{targetPoint:tt},!0);this.diagram._comparePropertyValues(this.selectedObject,"segments",{segments:it},!0)}this.previousPoint=this.currentPoint},r.prototype._raiseSegmentEditEvent=function(n){return this._raiseEvent("segmentChange",{element:this.selectedObject,dragState:n,point:this.currentPoint,cancel:!1})},r.prototype._updateAdjacentSegments=function(n,i){var r=this.selectedSegment,u={x:n+r._endPoint.x,y:i+r._endPoint.y},e,f;u=this.snap(u);r.type=="orthogonal"?(r._direction=="left"||r._direction=="right"?(i=u.y-r._endPoint.y,r._startPoint.y+=i,r._endPoint.y=r._startPoint.y):(n=u.x-r._endPoint.x,r._startPoint.x+=n,r._endPoint.x=r._startPoint.x),r.points[0]=r._startPoint,r.points[r.points.length-1]=r._endPoint,e=this.selectedObject.segments.indexOf(this.selectedSegment),f=this.selectedObject.segments[e-1],f&&this.updatePreviousSegment(r,f,n,i)):r.type=="straight"?(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u):(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u,t.datavisualization.Diagram.Util._updateBezierPoints(r));this.nextSegment&&this.updateNextSegment(r,this.nextSegment,n,i)},r.prototype._addTerminalSegment=function(n,i,r){var u=this.selectedSegment,f,e,o,h,c,s;for(this.selectedObject.segments.pop(),f=this.selectedObject.segments[this.selectedObject.segments.length-1]&&this.selectedObject.segments[this.selectedObject.segments.length-1].type=="orthogonal"?this.selectedObject.segments[this.selectedObject.segments.length-1]:null,e=0;e<u.points.length-2;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=f.direction=="top"||f.direction=="bottom"?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),f=o,this.selectedObject.segments.push(o);if(h=Number(r[1]),(u.points.length==2||h==u.points.length-2)&&(f&&(f.length+=5,f._length=f.length),h!=0)){var l=t.datavisualization.Diagram.Geometry.distance(u.points[u.points.length-2],u._endPoint),a=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint),v=t.datavisualization.Diagram.Segment({type:"orthogonal",length:2*l/3,direction:a});this.selectedObject.segments.push(v)}c=t.datavisualization.Diagram.Segment({type:"orthogonal"});this.selectedObject.segments.push(c);s=Number(r[0])+(Number(r[1])||0);this.selectedSegment=this.selectedObject.segments[s];this.nextSegment=this.selectedObject.segments[s+1];s==this.selectedObject.segments.length-2?this.nextSegment._direction=Number(r[0])==0?t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint):u._direction:c._direction=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint);s==0&&this.insertFirstSegment(n,i,r)},r.prototype.insertFirstSegment=function(n,i,r){var u=this.selectedSegment,c,e,o,f,h,l,s,a;if(this.selectedObject.sourcePort&&u.length&&this.selectedObject.segments[0].points.length>2){for(this.selectedObject.segments.splice(0,1),f=[],e=0;e<u.points.length-1;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=c&&(c.direction=="top"||c.direction=="bottom")?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),c=o,f.push(o);this.selectedObject.segments=f.concat(this.selectedObject.segments);this.selectedSegment=this.selectedObject.segments[Number(r[1])];this.nextSegment=this.selectedObject.segments[Number(r[1])+1]}else u=this.selectedObject.segments[0],f=[],f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:u.direction,length:u.length/3})),u.direction=="bottom"||u.direction=="top"?(h=Math.max(5,Math.abs(n)),l=n>0?"right":"left"):(h=Math.max(5,Math.abs(i)),l=i>0?"bottom":"top"),f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:l,length:h})),s=this.selectedObject.segments[1],s&&s.length&&(l!=s.direction&&(h*=-1),s.length-=h,s._length=s.length),u.length=u._length=2*u._length/3,this.selectedObject.segments=f.concat(this.selectedObject.segments),a=Number(r[0])+Number(r[1]),this.selectedSegment=this.selectedObject.segments[2],this.nextSegment=this.selectedObject.segments[3]},r.prototype.updatePreviousSegment=function(n,i,r,u){i._endPoint=i.points[i.points.length-1]=n._startPoint;i.type=="orthogonal"?(i.direction=="bottom"?(i.length+=u,i.length<0&&(i._direction=i.direction="top",i.length*=-1)):i.direction=="top"?(i.length-=u,i.length<0&&(i._direction=i.direction="bottom",i.length*=-1)):i.direction=="right"?(i.length+=r,i.length<0&&(i._direction=i.direction="left",i.length*=-1)):i.direction=="left"&&(i.length-=r,i.length<0&&(i._direction=i.direction="right",i.length*=-1)),i._length=i.length):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i)},r.prototype.updateNextSegment=function(n,i,r,u){var o=n._endPoint,e,f;i._startPoint=i.points[0]=this.selectedSegment._endPoint;i&&(i.type=="orthogonal"?(i.length||i.length===0)&&(i._direction=="left"||i._direction=="right"?(r!=0&&(i._direction=="right"?i._length-=r:i._length+=r,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="left"?i.direction="right":i.direction=="right"&&(i.direction="left"),i.length*=-1,i._direction=i.direction,i._length=i.length))),u!=0&&n.type!="orthogonal"&&(i._startPoint.y=i.points[0].y=i._endPoint.y=i.points[i.points.length-1].y=o.y,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f._startPoint.y=f.points[0].y=i._endPoint.y,f.length&&(f.direction=="bottom"?(f.length-=u,f.length<0&&(f.direction="top",f.length*=-1)):(f.length+=u,f.length<0&&(f.direction="bottom",f.length*=-1))))):(u!=0&&(i._direction=="bottom"?i._length-=u:i._length+=u,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="top"?i.direction="bottom":i.direction=="bottom"&&(i.direction="top"),i.length*=-1,i._length=i.length,i._direction=i.direction))),r!=0&&n.type!="orthogonal"&&(i._startPoint.x=i.points[0].x=i._endPoint.x=i.points[i.points.length-1].x=o.x,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f.length&&(f.direction=="right"?(f.length+=r,f.length<0&&(f.direction="left",f.length*=-1)):(f.length-=r,f.length<0&&(f.direction="right",f.length*=-1)))))):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i))},r.prototype.mouseup=function(n){var a,u,l,v,e,o,y,s;if(n.shiftKey&&n.ctrlKey)this._addOrRemoveStraightSegments(n);else if(this.inAction){if(this.inAction=!1,this._endPoint=="segmentEnd"&&this.selectedSegment.type=="orthogonal"){if(l=this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Completed),!l.cancel){var f=this.selectedObject.segments.indexOf(this.selectedSegment),h=this.selectedObject.segments[f-1],r=this.selectedObject.segments[f+1],c=!1;h&&h.type=="orthogonal"&&Math.abs(h.length)<5?f!=1&&(c=this._removePrevSegment(f)):r&&r.type=="orthogonal"&&(a=r.length||r.length===0?r.length:t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]),Math.abs(a<=5)&&(c=this._removeNextSegment(f)));c&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))}}else this._endPoint!="segmentEnd"&&(u=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Completed),this.diagram.nameTable[this.selectedObject.name]||(this.selectedObject=null),this.selectedObject&&(u.cancel?u&&u.cancel&&u.eventType&&(u.eventType==="connectorSourceChange"&&(this.undoObject.sourceNode?(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.diagram.nameTable[this.undoObject.sourceNode].outEdges.push(this.selectedObject.name),this.selectedObject.sourcePort=this.undoObject.sourcePort):this.undoObject.sourceNode==null&&this.selectedObject.sourceNode?(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.selectedObject.sourcePort=this.undoObject.sourcePort,this.selectedObject.sourcePoint=this.undoObject.sourcePoint,this.selectedObject.segments=this.undoObject.segments):(this.selectedObject.sourcePoint=this.undoObject.sourcePoint,this.selectedObject.segments=this.undoObject.segments)),u.eventType==="connectorTargetChange"&&(this.undoObject.targetNode?(this.selectedObject.targetNode=this.undoObject.targetNode,this.diagram.nameTable[this.undoObject.targetNode].inEdges.push(this.selectedObject.name),this.selectedObject.targetPort=this.undoObject.targetPort):this.undoObject.targetNode==null&&this.selectedObject.targetNode?(this.selectedObject.targetNode=this.undoObject.targetNode,this.selectedObject.targetPort=this.undoObject.targetPort,this.selectedObject.targetPoint=this.undoObject.targetPoint,this.selectedObject.segments=this.undoObject.segments):(this.selectedObject.segments=this.undoObject.segments,this.selectedObject.targetPoint=this.undoObject.targetPoint))):(this._disconnect(this.selectedObject),this._currentPossibleConnection&&!this.inAction?this._updateConnection(this.selectedObject):(this.selectedObject.sourceNode||this.selectedObject.targetNode)&&this._updateConnection(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer))));this.selectedObject&&(this.selectedObject.annotation&&(v=this.diagram.nameTable[this.selectedObject.targetNode],t.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(this.selectedObject,this.undoObject.targetNode,v,null,this.diagram)),this.diagram._dock(this.selectedObject,this.diagram.nameTable,!0),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext.update(this.selectedObject,this.diagram),this.diagram._updateConnectorBridging(this.selectedObject),this.diagram._updateQuad(this.selectedObject),this.diagram._updateSelectionHandle(),this.selectedObject.annotation&&t.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(this.selectedObject,this.diagram),this.selectedObject&&(this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").setAttribute("pointer-events","stroke"),this.diagram._svg.getElementById(this.selectedObject.name).setAttribute("pointer-events","auto")),this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g").setAttribute("pointer-events","visible"),this._initialValue=null)}if(this.selectedObject)for(o=null,e="",this.selectedObject._removeTargetPort&&this.selectedObject._removeTargetPort.type&&this.selectedObject._removeTargetPort.type=="internal"&&(o=this.selectedObject._removeTargetPort,e="targetpoint",delete this.selectedObject._removeTargetPort),this.selectedObject._removeSourcePort&&this.selectedObject._removeSourcePort.type&&this.selectedObject._removeSourcePort.type=="internal"&&(o=this.selectedObject._removeSourcePort,e="sourcepoint",delete this.selectedObject._removeSourcePort),y={type:"endpointchanged",undoObject:this.undoObject,redoObject:this._getClonedObject(this.selectedObject),removedPort:e==""?null:o,removePortType:e,isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"},this.diagram.addHistoryEntry(y),s=0;s<this._nearestNodes.length;s++)this._showPort(this._nearestNodes[s],!0);delete this._nearestNodes;i.prototype.mouseup.call(this,n)},r.prototype._addOrRemoveStraightSegments=function(n){var s,e,r,f,i,u;if(this._endPoint=="segmentEnd")s=n.target.id,e=s.split("_"),e.reverse(),r=Number(e[0]),i=this.selectedObject.segments[r],i&&i.type=="straight"&&(f=this.selectedObject.segments[r+1],f&&(this.selectedObject.segments.splice(r,1),f._startPoint=f.points[0]=i._startPoint,o=!0));else{var h=n.target.getAttribute("class"),s=n.target.id,o=!1,r=this._findIndex();this.selectedObject.segments&&this.selectedObject.segments[r]&&this.selectedObject.segments[r].type=="straight"&&(i=this.selectedObject.segments[r],u=t.datavisualization.Diagram.Segment({type:"straight",_point:i._endPoint}),this.selectedObject.segments.splice(r+1,0,u),r+1!=this.selectedObject.segments.length-1&&(u.point=u._point),i._point=i.point=i.points[1]=i._endPoint=this.currentPoint,u.points[0]=u._startPoint=this.currentPoint,u.points[1]=u._endPoint=u._point,o=!0)}o&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))},r.prototype._findIndex=function(){for(var n,o,e,s,h,u,c,l,f,r=[],i=0;i<this.selectedObject.segments.length;i++)n=this.selectedObject.segments[i],o={x:Math.min(n._startPoint.x,n._endPoint.x),y:Math.min(n._startPoint.y,n._endPoint.y),width:Math.abs(n._startPoint.x-n._endPoint.x),height:Math.abs(n._startPoint.y-n._endPoint.y)},t.datavisualization.Diagram.Geometry.inflate(o,this.selectedObject.lineHitPadding/2,this.selectedObject.lineHitPadding/2),t.datavisualization.Diagram.Geometry.containsPoint(o,this.currentPoint)&&r.push(n);if(r.length==1)return this.selectedObject.segments.indexOf(r[0]);for(i=0;i<r.length;i++)u=r[i],f=this.currentPoint,c=(f.y-u._startPoint.y)/(u._endPoint.y-f.y),l=(f.x-u._startPoint.x)/(u._endPoint.x-f.x),e=Math.abs(c-l),i==0&&(s=e,h=0),e<s&&(s=e,h=i);return this.selectedObject.segments.indexOf(r[h])},r.prototype._removeNextSegment=function(n){var i=this.selectedObject.segments[n-1],r=this.selectedObject.segments[n+2],u=this.selectedObject.segments[n+1];return u.length||u.length===0?(this.selectedObject.segments.splice(n,2),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?(r._startPoint.y=this.selectedSegment._startPoint.y,i._endPoint.x=r._startPoint.x):(r._startPoint.x=this.selectedSegment._startPoint.x,i._endPoint.y=r._startPoint.y)):(this.selectedObject.segments.splice(n+1,1),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?i._endPoint.x=u._endPoint.x:i._endPoint.y=u._endPoint.y,i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)),this.selectedSegment.length=this.selectedSegment._length=this.selectedSegment.direction=null),i&&r&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,r._startPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,r._startPoint)),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(i._endPoint,r._endPoint),r.length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._endPoint,r._endPoint)))),!0},r.prototype._removePrevSegment=function(n){var i=this.selectedObject.segments[n-2],f=this.selectedObject.segments[n+1],o=f.length||f.length===0?f.length:t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]),r,u,e;return o<=5?(r=this.selectedObject.segments[n+2],f.length===o?this.selectedObject.segments.splice(n-1,4):this.selectedObject.segments.splice(n-1,3),r?(i.direction=="top"||i.direction=="bottom"?(i._endPoint.y=r._endPoint.y,r._startPoint.x=i._endPoint.x):(i._endPoint.x=r._endPoint.x,r._startPoint.y=i._endPoint.y),(i.length||i.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(r._startPoint,r._endPoint),r._length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(r._startPoint,r._endPoint)))):(i._endPoint=this.selectedObject.endPoint,i.direction=i.length=i._length=null,i._direction=f._direction)):(u=this.selectedObject.segments[n+1],this.selectedObject.segments.splice(n-1,2),e=this.selectedSegment,e.direction=="left"||e.direction=="right"?(i._endPoint.x=u._startPoint.x,u._startPoint.y=i._endPoint.y):(i._endPoint.y=u._startPoint.y,u._startPoint.x=i._endPoint.x),(this.selectedSegment.length||this.selectedSegment.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(u.length||u.length===0)&&(u._length=u.length=t.datavisualization.Diagram.Geometry.distance(u._startPoint,u._endPoint),u.length&&(u._direction=u.direction=t.datavisualization.Diagram.Util._getBezierDirection(u._startPoint,u._endPoint)))),!0},r.prototype._getClonedObject=function(t){if(t){var i=n.extend(!0,{},t);return i.targetNode=t.targetNode,i.sourceNode=t.sourceNode,i.targetPort=t.targetPort,i.sourcePort=t.sourcePort,i}},r.prototype._updateConnection=function(n,i){var r,u;this._updateConnectionTarget(n);this._endPoint=="targetEndPoint"?(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.targetNode!=this._currentPossibleConnection.name||n.targetPort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n,!0)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.targetNode!=this._currentPossibleConnection.name||n.targetPort)&&(r=this._raiseConnectionChangeEvent(n,!0)):this.selectedObject.targetNode&&(r=this._raiseConnectionChangeEvent(n,!0)),r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),(n.segments.length>2||n.segments[0].points.length==2)&&t.datavisualization.Diagram.Util._updatePreviousSegment(n),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))):this._endPoint=="sourceEndPoint"&&(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort)&&(r=this._raiseConnectionChangeEvent(n)):(this.selectedObject.sourceNode&&(r=this._raiseConnectionChangeEvent(n),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram)),r&&t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)));u=this.selectedSegment._endPoint;this.diagram._dock(n,this.diagram.nameTable,i);r&&this._endPoint=="sourceEndPoint"&&this.selectedObject.segments.length>1&&(this.selectedSegment.points.length==2&&!this.selectedObject.sourcePort&&this.selectedSegment.length?(this.selectedSegment.direction=="right"||this.selectedSegment.direction=="left"?(this.selectedSegment.direction=this.selectedSegment._startPoint.x<u.x?this.selectedSegment._direction="right":this.selectedSegment._direction="left",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.x-u.x)):(this.selectedSegment.direction=this.selectedSegment._startPoint.y<u.y?this.selectedSegment._direction="bottom":this.selectedSegment._direction="top",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.y-u.y)),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)):r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)))},r.prototype._disconnect=function(){},r.prototype._endAction=function(){this._showPorts();var n;this._currentPossibleConnection&&!this._possibleConnectionPort&&(n=this._currentPossibleConnection);i.prototype._endAction.apply(this);this._endPoint&&(this._endPoint=null,n&&(this.diagram._checkToolToActivate(n,this.currentPoint),this.diagram._updateCursor()))},r.prototype._outOfBoundsDrag=function(n,i,r){if(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var u=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=u.width||i<=u.x)||!this.diagram._selectedSymbol&&(r>=u.height||r<=u.y))return this.updateCursor("not-allowed"),!1}else if(!t.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,n,i,r))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},r.prototype._updatePoints=function(n,i){var h=!1,w="",f,c,e,y,r,b,l,a,p,u,o,s,v,k;if(this._endPoint&&this._endPoint!="segmentEnd"&&this.selectedSegment&&(f=this._endPoint=="targetEndPoint"?!0:!1,c=this._endPoint=="sourceEndPoint"?!0:!1,this._endPoint)){y=this._endPoint.match("bezierpoint1")?"bezierpoint1":this._endPoint.match("bezierpoint2")?"bezierpoint2":this._endPoint;switch(y){case"targetEndPoint":e=this.selectedSegment._endPoint;break;case"sourceEndPoint":e=this.selectedSegment._startPoint;break;case"bezierpoint1":e=this.selectedSegment._point1;break;case"bezierpoint2":e=this.selectedSegment._point2}if(r=this.currentPoint,this._possibleConnectionPort==null&&(r=this.snap(r)),b=t.datavisualization.Diagram.Point(e.x-r.x,e.y-r.y),l=this._raiseEndPointDrag(n,f,c,i),l&&(h=l.cancel,w=l.type),!t.datavisualization.Diagram.Geometry.isEmptyPoint(b)&&!h)if(f||c){if(a=this._currentPossibleConnection?t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection,!1):!1,this._outOfBoundsDrag(this.selectedObject,r.x,r.y,f)&&(this.selectedObject.segments.length>1&&(f||a||this.selectedSegment.type!="orthogonal"||!this.selectedSegment.length&&this.selectedSegment.length!==0?f&&!a&&this.selectedSegment.type=="orthogonal"&&this.selectedSegment.points.length==2&&(o=r.x-this.selectedSegment._endPoint.x,s=r.y-this.selectedSegment._endPoint.y,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?(this.selectedSegment._startPoint.y=this.selectedSegment.points[0].y+=s,this.selectedSegment._endPoint.y=this.selectedSegment.points[1].y=this.selectedSegment._startPoint.y):(this.selectedSegment._startPoint.x=this.selectedSegment.points[0].x+=o,this.selectedSegment._endPoint.x=this.selectedSegment.points[1].x=this.selectedSegment._startPoint.x),v=this.selectedObject.segments.length-1,this.selectedObject.segments[v-1]&&this.updatePreviousSegment(this.selectedObject.segments[v],this.selectedObject.segments[v-1],o,s)):(this.selectedObject.sourcePoint=r,o=r.x-this.selectedSegment._startPoint.x,s=r.y-this.selectedSegment._startPoint.y,this.selectedSegment.direction=="left"||this.selectedSegment.direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,this.selectedSegment._endPoint),this.selectedSegment._length&&(this.selectedSegment._direction=this.selectedSegment.direction=t.datavisualization.Diagram.Util._getBezierDirection(r,this.selectedSegment._endPoint)),this.updateNextSegment(this.selectedObject.segments[0],this.selectedObject.segments[1],o,s),u=this.selectedObject.segments[1],p=!1,u&&u.length&&(u.length=u._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,u._endPoint),u.length&&(u.direction=u._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,u._endPoint))),this.selectedSegment.length==0||u.length===0?(u.length==0&&this.selectedObject.segments.length>2?this.selectedObject.segments.splice(0,2):this.selectedObject.segments.length>1&&this.selectedObject.segments.splice(0,1),this.selectedSegment=this.selectedObject.segments[0],this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,u=this.selectedObject.segments[1],this.selectedObject.segments.length>1?(this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,u._startPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[1],n.segments[0],n.segments[2],n.sourcePoint,n.targetPoint),u._startPoint=u.points[0]=n.segments[0]._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),p=!0):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),u&&u.length&&(u.length=u._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,u._endPoint),u.length&&(u.direction=u._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,u._endPoint))))),(c||f)&&!a&&(k=this.selectedSegment.points.length,this.diagram._setEndPoint(n,t.datavisualization.Diagram.Point(r.x,r.y),f),k!=this.selectedSegment.points.length||p)))return{updateSelection:!0,cancel:h}}else t.datavisualization.Diagram.Util._setBezierPoint(this.selectedSegment,t.datavisualization.Diagram.Point(r.x,r.y),y)}return{cancel:h,eventType:w}},r}(i);t.datavisualization.Diagram.ConnectionEditTool=s;h=function(i){function r(n){i.call(this,"shapeTool",n);this.cursor="crosshair";this._drawingPolygon=!1;this._points=[]}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){var r,t;i.prototype.mousedown.call(this,n);this._isPolyline()&&n&&!this._sourcePossibleConnection&&(this._currentPossibleConnection&&(r=this.mousePosition(n),this._possibleConnectionPort=this.diagram._findPortAtPoint(r,this._currentPossibleConnection)),this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort));this._drawingPolygon?(t=this.helper.points[this.helper.points.length-1],t={x:t.x,y:t.y},this.helper.points.push(t),this._points.push(this.snap(this.currentPoint))):(this.selectedObject=this.createNode(),this.selectedObject.type=="bpmn"&&this.diagram._initGroupNode(this.selectedObject),this.selectedObject._type="node");this._prevPoint=this.currentPoint},r.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},r.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},r.prototype.createNode=function(){var u,i,r,f;return this._isPolyline()?(u=n.extend(!0,{},this.diagram.model.drawType),u.sourcePoint=this.currentPoint,u.targetPoint=this.currentPoint,u.segments=[{type:"straight"}],i=this.diagram._getNewConnector(u)):i=this.diagram._getNewNode(this.diagram.model.drawType),i.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+t.datavisualization.Diagram.Util.randomId():"node"+t.datavisualization.Diagram.Util.randomId(),r=this.snap(this.currentPoint),this._isPolyline()||(i.offsetX=r.x,i.offsetY=r.y,i.width=5,i.height=5),i.type=="text"||this._isPolyline()||(i.shape=this.diagram.model.drawType.shape?this.diagram.model.drawType.shape:i.shape),this.diagram.model.drawType.shape!="polygon"&&!this._isPolyline()||this.diagram.model.drawType.points&&this.diagram.model.drawType.points.length||(this._drawingPolygon=!0,f=this.snap(this.startPoint),i.points=[{x:f.x,y:f.y},{x:r.x,y:r.y}],this._points=[{x:f.x,y:f.y},{x:r.x,y:r.y}]),t.datavisualization.Diagram.NodeType(i,this.diagram)},r.prototype.mousemove=function(n){if(i.prototype.mousemove.call(this,n),this.selectedObject)if(this.inAction)this._updateHelper();else{if(this.inAction=!0,this.selectedObject.shape==="polygon"&&(!this.diagram.model.drawType.points||!this.diagram.model.drawType.points.length)&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)){var t=this.snap(this.startPoint),r=this.snap(this.currentPoint);this.selectedObject.points=[{x:t.x,y:t.y},{x:r.x,y:r.y}];this._points=[{x:t.x,y:t.y},{x:r.x,y:r.y}]}this._initHelper();this._renderHelper()}this._isPolyline()&&n&&this._checkConnectionPossible(n);this.previousPoint=this.currentPoint},r.prototype._addPolyline=function(n){var u,r,i,t;for(this._currentPossibleConnection&&(u=this.mousePosition(n),this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this.diagram._findPortAtPoint(u,this._currentPossibleConnection)),r=[],this._currentPossibleConnection&&this._sourcePossibleConnection&&(this._sourcePossibleConnection=this._sourcePossibleConnection.name===this._currentPossibleConnection.name?null:this._sourcePossibleConnection),i=1;i<this.selectedObject.points.length-2;i++)r.push({type:"straight",point:this.selectedObject.points[i]});t=this.diagram._getNewConnector(this.selectedObject);t.name=this.selectedObject.name;t.sourcePoint=this.selectedObject.points[0];t.targetPoint=this.selectedObject.points[this.selectedObject.points.length-1];t.segments=r;t.sourceNode=this._sourcePossibleConnection?this._sourcePossibleConnection.name:null;t.targetNode=this._targetPossibleConnection?this._targetPossibleConnection.name:null;t.sourcePort=this._sourcePort?this._sourcePort.name:null;t.targetPort=this._targetPort?this._targetPort.name:null;this.diagram.add(t);this._sourcePossibleConnection=null;this._targetPossibleConnection=null;this._sourcePort=null;this._targetPort=null},r.prototype.mouseup=function(n){var t=!1;!this._drawingPolygon||n.button==2||this.diagram._getEventDetail(n)==2||this._sourcePossibleConnection&&this._currentPossibleConnection&&this._sourcePossibleConnection.name!=this._currentPossibleConnection.name||this._sourcePort&&this._targetPort&&this._sourcePort.name!==this._targetPort.name?(this.inAction&&(this.inAction=!1,this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this._isPolyline()?this._addPolyline(n):this.diagram.add(this.selectedObject)),t=!0):this._currentPossibleConnection&&this.helper&&(this.selectedObject.points.length>0&&(this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this._isPolyline()&&this._addPolyline(n)),t=!0);t&&(this.diagram._toolToActivate="selectTool",this.diagram._drawingTool=!1,i.prototype.mouseup.call(this,n),this._drawingPolygon&&(this.diagram._disableDefaultContextMenu=!0,delete this._drawingPolygon,delete this._points))},r.prototype._renderHelper=function(){this.svgHelper||(this._isPolyline()?this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram):this.helper.type!="bpmn"?this.svgHelper=t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer,undefined,this.diagram):(this.helper._type="group",this.diagram._initGroupNode(this.helper),this.svgHelper=t.datavisualization.Diagram.SvgContext.renderGroup(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram.nameTable,this.diagram)),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},r.prototype._outOfBoundsDrag=function(n,i,r){if(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var u=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=u.width||i<=u.x)||!this.diagram._selectedSymbol&&(r>=u.height||r<=u.y))return this.updateCursor("not-allowed"),!1}else if(n.sourceNode!=null&&!t.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,n,i,r))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},r.prototype._updateHelper=function(){var e=this._getStartPoint(),o=this._getCurrentPoint(),f,u,i;if(this._drawingPolygon&&this._outOfBoundsDrag(this.helper,o.x,o.y)&&this._outOfBoundsDrag(this.helper,e.x,e.y)){var s=this.snap(this.currentPoint),h=this.snap(this.previousPoint),r={x:s.x-h.x,y:s.y-h.y};if(this.helper.points[this.helper.points.length-1].x+=r.x,this.helper.points[this.helper.points.length-1].y+=r.y,this._points[this._points.length-1].x+=r.x,this._points[this._points.length-1].y+=r.y,this._isPolyline()){for(f=[],u=0;u<this.helper.points.length-1;u++)f.push({type:"straight",point:this.helper.points[u]});this.helper.sourcePoint=this.helper.points[0];this.helper.targetPoint=this.helper.points[this.helper.points.length-1];this.helper.segments=f;this.helper=this.diagram._getNewConnector(this.helper);this.diagram._dock(this.helper,this.diagram.nameTable)}}i=n.extend(!0,{},this.helper);this._updateSize(this.helper,this.snap(this.startPoint),this.snap(this.currentPoint));this.diagram._comparePropertyValues(this.helper,"height",{height:i.height},!0);this.diagram._comparePropertyValues(this.helper,"width",{width:i.width},!0);this.diagram._comparePropertyValues(this.helper,"offsetX",{offsetX:i.offsetX},!0);this.diagram._comparePropertyValues(this.helper,"offsetY",{offsetY:i.offsetY},!0);this.helper.shape!="polygon"||this._drawingPolygon||(this.helper.width=this.helper.width!=0?this.helper.width:5,this.helper.height=this.helper.height!=0?this.helper.height:5);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._updateSize=function(n,i,r){if(this._outOfBoundsDrag(this.helper,r.x,r.y)&&this._outOfBoundsDrag(this.helper,i.x,i.y)){var o=this._drawingPolygon?this._points:[i,r],f=t.datavisualization.Diagram.Geometry.rect(o),u={width:f.width,height:f.height},e={x:f.x,y:f.y};t.datavisualization.Diagram.Geometry.isEmptySize(u)||(this.helper.type!="bpmn"?(n.offsetX=e.x+u.width/2,n.offsetY=e.y+u.height/2,n.width=u.width,n.height=u.height,n._shape==="path"&&(n._scaled=!0)):(n._type="group",this.diagram._translate(n,e.x+u.width/2-n.offsetX,e.y+u.height/2-n.offsetY,this.diagram.nameTable),this.diagram.scale(n,u.width/this.helper.width,u.height/this.helper.height,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),this.diagram.nameTable),t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram)))}},r}(i);t.datavisualization.Diagram.ShapeTool=h;r=function(i){function r(n,t){i.call(this,n,t);this.cursor="crosshair";this._isMouseDown=!1;this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){if(i.prototype.mousedown.call(this,n),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)){if(this._isMouseDown=!0,this.diagram._hasSelection()&&this.diagram._clearSelection(),n&&n.type==="touchstart"&&(this._currentPossibleConnection=this.diagram._findConnectableNodeUnderMouse(n),this._currentPossibleConnection)){var r=this.mousePosition(n);this._possibleConnectionPort=this.diagram._findPortAtPoint(r,this._currentPossibleConnection)}this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort);this._raiseEndPointDrag(this.helper,!0,!1,t.datavisualization.Diagram.DragState.Starting)}},r.prototype._updateConnection=function(n){n&&(this._updateConnectionTarget(this.helper,!0),this._raiseConnectionChangeEvent(n,this._endPoint=="sourceEndPoint"?!1:!0))},r.prototype.mousemove=function(r){if(i.prototype.mousemove.call(this,r),this._checkConnectionPossible(r),this._isMouseDown)if(this.inAction){if(this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this._possibleConnectionPort,this._updateConnection(this.helper),this.helper){var f=this._raiseEndPointDrag(this.helper,!0,!1,t.datavisualization.Diagram.DragState.Dragging),u=n.extend(!0,{},this.helper);f.cancel||this._updateHelper();this.diagram._comparePropertyValues(this.helper,"sourcePoint",{sourcePoint:u.sourcePoint},!0);this.diagram._comparePropertyValues(this.helper,"targetPoint",{targetPoint:u.targetPoint},!0);this.diagram._comparePropertyValues(this.helper,"segments",{segments:u.segments},!0);this.diagram._comparePropertyValues(this.helper,"targetNode",{targetNode:this._targetPossibleConnection},!0);this.diagram._comparePropertyValues(this.helper,"targetPort",{targetPort:this._targetPort},!0)}}else this.inAction=!0,this._initHelper(),this._renderHelper();this.previousPoint=this.currentPoint},r.prototype.mouseup=function(n){var r,u,f,s;if(this._targetPort=this._possibleConnectionPort||this._targetPort,this._targetPossibleConnection=this._targetPossibleConnection?this._targetPossibleConnection:this._currentPossibleConnection,this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._isMouseDown=!1,this.inAction){this.inAction=!1;var e=this._getStartPoint(),o=this._getCurrentPoint(),h=t.datavisualization.Diagram.Geometry.distance(e,o);this._outOfBoundsDrag(this.helper,o.x,o.y)&&this._outOfBoundsDrag(this.helper,e.x,e.y)&&(h>0?(r=this.createConnector(e,o),r.name="connector"+t.datavisualization.Diagram.Util.randomId(),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.sourceNode=this._sourcePossibleConnection.name,r.sourcePort=this._sourcePort.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.sourceNode=this._sourcePossibleConnection.name))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.targetNode=this._targetPossibleConnection.name,r.targetPort=this._targetPort.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.targetNode=this._targetPossibleConnection.name))),s=this.diagram.add(r),s&&(r=this.diagram.nameTable[r.name],t.datavisualization.Diagram.Util.updateBridging(r,this.diagram),t.datavisualization.Diagram.SvgContext.update(r,this.diagram),this.diagram._updateConnectorBridging(r))):(this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)||t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection))&&t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)||t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection))&&t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name)))}this.singleAction&&this.diagram.deactivateTool();this._prevTool&&(this._prevTool.inAction=!1);this._showPorts();i.prototype.mouseup.call(this,n)},r.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},r.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},r.prototype._initHelper=function(){this.helper=this.createConnector(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(0,0));this.diagram._setZorder(this.helper);this.helper.name="helper";this.helper._connectorType="helper"},r.prototype.createConnector=function(){return null},r.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram),this.svgHelper=this.diagram._svg.document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id)).attr("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id+"_hitTest")).attr("pointer-events","none"))},r.prototype._outOfBoundsDrag=function(n,i,r){if(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var u=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=u.width||i<=u.x)||!this.diagram._selectedSymbol&&(r>=u.height||r<=u.y))return this.updateCursor("not-allowed"),!1}else if(n.sourceNode!=null&&!t.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,n,i,r))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},r.prototype._updateHelper=function(){var r=[],n=this._getStartPoint(),i=this._getCurrentPoint();r.push(n);r.push(i);this._outOfBoundsDrag(this.helper,i.x,i.y)&&this._outOfBoundsDrag(this.helper,n.x,n.y)&&(this.diagram._setEndPoint(this.helper,n,!1),this.diagram._setEndPoint(this.helper,i,!0),this._disconnect(this.helper),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(this.helper.sourceNode=this._sourcePossibleConnection.name,this.helper.sourcePort=this._sourcePort.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(this.helper.sourceNode=this._sourcePossibleConnection.name,this._sourcePossibleConnection.outEdges.push(this.helper.name))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(this.helper.targetNode=this._targetPossibleConnection.name,this.helper.targetPort=this._targetPort.name,this._targetPossibleConnection.inEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(this.helper.targetNode=this._targetPossibleConnection.name,this._targetPossibleConnection.inEdges.push(this.helper.name))),this.diagram._dock(this.helper,this.diagram.nameTable));t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null;this._isMouseDown=!1},r.prototype._showPorts=function(){},r.prototype._showAllPorts=function(n){i.prototype._showAllPorts.call(this,n)},r}(i);t.datavisualization.Diagram.LineTool=r;c=function(i){function r(n){i.call(this,"straightLine",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createConnector=function(t,i){var r={segments:[{type:"straight"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(n.extend(!0,{},r,this.diagram.model.drawType))},r}(r);t.datavisualization.Diagram.StraightLineTool=c;l=function(i){function r(n){i.call(this,"orthogonalLine",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createConnector=function(t,i){var r={segments:[{type:"orthogonal"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(n.extend(!0,{},r,this.diagram.model.drawType))},r}(r);t.datavisualization.Diagram.OrthogonalLineTool=l;a=function(i){function r(n){i.call(this,"bezierLine",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createConnector=function(t,i){var r={segments:[{type:"bezier"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(n.extend(!0,{},r,this.diagram.model.drawType))},r}(r);t.datavisualization.Diagram.BezierLineTool=a;v=function(i){function r(n){i.call(this,"rotatetool",n);this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(t){var u,r,f,e;i.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0];r={};(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(r=this.diagram._getChildTable(this.selectedObject,r));f={childTable:r,node:this.selectedObject};u=n.extend(!0,{},f);this.undoObject=jQuery.extend(!0,{},u);e=this.diagram._currZoom},r.prototype.mousemove=function(n){var r,e,u,o,f,s;if(i.prototype.mousemove.call(this,n),r=!this.inAction,this.selectedObject){if(!this.inAction){if(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")for(e=this.diagram._getChildren(this.selectedObject.children),u=0;u<e.length;u++)if(o=this.diagram.nameTable[e[u]],!o.segments&&!t.datavisualization.Diagram.Util.canRotate(o))return;this._initialValue=this.selectedObject.rotateAngle;this.inAction=!0}f=!1;this.selectedObject.parent?(s=this.diagram.nameTable[this.selectedObject.parent],s.container&&(f=!0)):this.selectedObject.type=="pseudoGroup"&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(f=!0);f?this.selectedObject.type=="pseudoGroup"&&this._isParentAsLane(this.selectedObject)?(t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram)):(this.helper||(this.helper=this._getCloneNode(this.selectedObject),this.helper.inEdges=this.helper.outEdges=[],this.helper.type=null,this.helper.name="helper"),this._rotate(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this.diagram._renderTooltip(this.selectedObject,r)):this.selectedObject.type=="pseudoGroup"&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))?this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,r)):(this.selectedObject.type==="pseudoGroup"&&this._updateMultipleUndoObject(this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,r))}this.previousPoint=this.currentPoint},r.prototype._rotate=function(n){var u,f,e=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),c=this.currentPoint,r=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(e.x,e.y),c)+90,i,o,s,h;r=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,r)-n.rotateAngle;i=t.datavisualization.Diagram.Util.bounds(n);u=t.datavisualization.Diagram.Rectangle(i.left,i.top,i.right-i.left,i.bottom-i.top);o={bounds:u,offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height};this.diagram._comparePropertyValues(n,"rotateAngle",{rotateAngle:r},!0);this.diagram._rotate(n,r,this.diagram.nameTable);i=t.datavisualization.Diagram.Util.bounds(n);f=t.datavisualization.Diagram.Rectangle(i.left,i.top,i.right-i.left,i.bottom-i.top);s={bounds:f,offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height};h=this._raiseEvent("rotationChange",{element:this.diagram.getNode(n),angle:n.rotateAngle,oldValue:o,newValue:s,cancel:!1});h.cancel&&this.diagram._rotate(n,-r,this.diagram.nameTable)},r.prototype.mouseup=function(r){var u,c,l,f,o,a;if(this.inAction){this.inAction=!1;var e=!1,s=!0,h=!1;this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&(e=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(c=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],u=this.diagram.nameTable[c.parent],u.container&&(e=!0));(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this.diagram._activeSwimLane?t.datavisualization.Diagram.canvasHelper._multiNodeRotate(this.diagram,r,this.selectedObject):e&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),this._removeHighLighter(),u.container.type=="canvas"&&(h=!0),h&&(t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,u)?t.datavisualization.Diagram.canvasHelper._singleNodeRotate(this.diagram,r,this.selectedObject):s=!1));this.selectedObject.type!="pseudoGroup"?s&&this._rotate(this.selectedObject):this._fromContainer(this.diagram._getChildren(this.selectedObject.children))||this._rotate(this.selectedObject);t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);t.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&(this.undoObject.connectors={},this._redoConnectors={},this.diagram._updateAllEdges(this.selectedObject));f={};(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(f=this.diagram._getChildTable(this.selectedObject,f));o={childTable:f,node:this.selectedObject};t.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&this._redoConnectors&&(o.connectors=this._redoConnectors);l=n.extend(!0,{},o);a={type:"rotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},l),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"};this._multipleUndo||this.diagram.addHistoryEntry(a);this.selectedObject&&t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom);this.diagram._updateSelectionHandle();this.diagram._removeTooltip()}this._multipleUndo=!1;i.prototype.mouseup.call(this,r)},r}(i);t.datavisualization.Diagram.RotateTool=v;y=function(n){function i(i){n.call(this,"PivotTool",i);this._mouseOffset=t.datavisualization.Diagram.Size(0,0)}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0]},i.prototype.mousemove=function(i){if(n.prototype.mousemove.call(this,i),this.selectedObject)if(this.inAction){var r=this.currentPoint.x-this.previousPoint.x,u=this.currentPoint.y-this.previousPoint.y,f=t.Matrix.identity();t.Matrix.rotate(f,-this.selectedObject.rotateAngle);var e=t.Matrix.transform(f,t.datavisualization.Diagram.Point(r,u)),o=(this.selectedObject.width*this.selectedObject.pivot.x+e.x)/this.selectedObject.width,s=(this.selectedObject.height*this.selectedObject.pivot.y+e.y)/this.selectedObject.height;this.selectedObject.pivot.x=o;this.selectedObject.pivot.y=s;this.selectedObject.offsetX+=r;this.selectedObject.offsetY+=u;this.diagram._updateSelectionHandle()}else this.inAction=!0;this.previousPoint=this.currentPoint},i.prototype._rotate=function(n){var i=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),r=this.currentPoint,u=this.FindAngle(i,r);this.diagram._rotate(n,u-n.rotateAngle,i,this.diagram.nameTable)},i.prototype.mouseup=function(t){this.inAction&&(this.inAction=!1,this.diagram._updateSelectionHandle());n.prototype.mouseup.call(this,t)},i}(i);t.datavisualization.Diagram.PivotTool=y;p=function(n){function i(t){n.call(this,"panTool",t);this.diagram=t;this._isMouseDown=!1;this.cursor="pointer"}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){var r;n.prototype.mousedown.call(this,t);var u=this.diagram._svg.document,i=this.diagram._svg.document.createSVGPoint(),f=this.diagram._isTouchEvent(t);return i.x=f.clientX,i.y=f.clientY,r=i.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),u.lastMouseX=r.x,u.lastMouseY=r.y,this._isMouseDown=!0,!1},i.prototype.mousemove=function(i){if(n.prototype.mousemove.call(this,i),this._isMouseDown&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)){this.inAction=!0;var r=this.diagram._svg.document,u=this.diagram._svg.document.createSVGPoint(),h=this.diagram._isTouchEvent(i);u.x=h.clientX;u.y=h.clientY;var c=u.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),f=c.x,e=c.y,o,s;return o=f-r.lastMouseX,s=e-r.lastMouseY,this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||(o=0),this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY||(s=0),t.datavisualization.Diagram.ZoomUtil.zoomPan(this.diagram,1,o,s,t.datavisualization.Diagram.Point(f,e)),r.lastMouseX=f,r.lastMouseY=e,!1}},i.prototype.mouseup=function(i){this.inAction=!1;document.onmousemove=null;document.onmouseup=null;this._isMouseDown=!1;this.diagram._removeTooltip();this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit();delete this.hoverNode;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);n.prototype.mouseup.call(this,i)},i}(i);t.datavisualization.Diagram.PanTool=p;w=function(i){function r(n,r){i.call(this,n,r);this.boundingRect=t.datavisualization.Diagram.Rectangle();this.activeLabel=null;this._overNode="";this.cursor="crosshair"}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this._findNodeUnderMouse(n);var t=this._getNodeUnderMouse();t&&(this._overNode=this.selectedObject&&!this.selectedObject.isLane||t.isLane?t.name:"");this.diagram._isEditing&&this.diagram._endEdit()},r.prototype.createNode=function(){},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this.selectedObject||t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this.diagram._isEditing||(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper())))},r.prototype.mouseup=function(n){var r,u,i;this.activeLabel=null;r=12;this.inAction?(i=this.getBoundingRect(this.startPoint,this.currentPoint),this._endAction(),(i.width===0||i.height===0)&&(i.width=90,i.height=r),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,i.height),this.diagram._startEdit(this.selectedObject)):(u=this._findNodeUnderMouse(n),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(u==null||u.isSwimlane||u.isLane?(i=t.datavisualization.Diagram.Rectangle(this.currentPoint.x-45,this.currentPoint.y-r/2,90,r),this._endAction(),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,r),this.diagram._startEdit(this.selectedObject)):(this.selectedObject=u,this.diagram._startEdit(this.selectedObject))));this._overNode=""},r.prototype.getBoundingRect=function(n,t){var n=this.snap(this.startPoint),t=this.snap(this.currentPoint),i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),u=n.x>t.x?t.x:n.x,f=n.y>t.y?t.y:n.y;return{x:u,y:f,width:i,height:r}},r.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},r.prototype._updateHelper=function(){var n=this.snap(this.startPoint),t=this.snap(this.currentPoint),r=this.diagram._adornerSvg.getElementById("helper"),u=Math.abs(n.x-t.x),f=Math.abs(n.y-t.y),i=this.diagram._currZoom,e=(n.x>t.x?t.x:n.x)*i,o=(n.y>t.y?t.y:n.y)*i;r&&this.diagram._adornerSvg.rect({id:r.id,x:e,y:o,width:u*i,height:f*i})},r.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this._svgHelper=null);i.prototype._endAction.apply(this)},r.prototype._findNodeUnderMouse=function(t){var i,o=this.diagram._isForeignObject(t.target),e,s,r,f;if(o&&(t.target=o),e=t.target,e.getAttribute("class")=="ej-d-label")s=n(e).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],i=this._findObj(s),this.activeLabel=this.diagram._findLabelAtPoint(this.currentPoint,i);else if(r=n(t.target).parents("g"),r.length>3){var h=r[r.length-4],c=h.getAttribute("id"),u=h.getAttribute("class");u&&(u==="ej-d-node"||u==="ej-d-group"?(i=this.diagram._findNode(c),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f):u==="ej-d-connector"&&(i=this.diagram._findConnector(c),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f))}return i},r}(t.datavisualization.Diagram.ToolBase);t.datavisualization.Diagram.TextToolBase=w;b=function(i){function r(n){i.call(this,"textTool",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createNode=function(i,r,u,f){var s={offsetX:i,offsetY:r,width:u,height:f,parent:this._overNode,labels:[],ports:[],type:"text"},e=this.diagram._getNewNode(n.extend(!0,{},s,this.diagram.model.drawType)),o;return e.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+t.datavisualization.Diagram.Util.randomId():"text"+t.datavisualization.Diagram.Util.randomId(),(e._type="text")&&(e._type="node"),o=this.diagram.nameTable[e.parent],o&&o.container&&this._updateMargin(e,o),e},r}(t.datavisualization.Diagram.TextToolBase);t.datavisualization.Diagram.TextTool=function(n){return new b(n)};k=function(i){function r(n){i.call(this,"phase",n);this.selectedSeperator=null;this._svgHelper=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this.inAction=!0;this.diagram._selectedGNode=null},r.prototype._getSeperator=function(t){if(n(t.target).parents("g").first()[0]){var i=n(t.target).parents("g").first()[0].id;if(i)return this._getphase(i.split("_phase_g")[0])}},r.prototype._removePhasehelper=function(){t.datavisualization.Diagram.SvgContext._removePhasehelper(this.diagram)},r.prototype._outOfBoundsDrag=function(n){var f=this.currentPoint.x-this.startPoint.x,e=this.currentPoint.y-this.startPoint.y,i,r,u;if(n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){if(i=this._getPageBounds(),r=this.diagram.nameTable[n.parent],r&&((u=t.datavisualization.Diagram.Util.bounds(r),!this.diagram._selectedSymbol&&(u.right+f>=i.width||n.offset+f<i.x))||!this.diagram._selectedSymbol&&(u.bottom+e>=i.height||n.offset+e<i.y)))return this.updateCursor("not-allowed"),!1;n.orientation=="horizontal"?this.updateCursor("e-resize"):this.updateCursor("n-resize")}return!0},r.prototype._updatePhasehelper=function(i){var f=this._bounds?jQuery.extend(!0,{},this._bounds):this.diagram._getPhaseBounds(i),r,u,e=this.startPoint,o=this.currentPoint,s={snapped:!1,offset:0,left:!1,right:!1},h={snapped:!1,offset:0,top:!1,bottom:!1};this.selectedObject=this.diagram.nameTable[this.selectedSeperator.parent];this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX};i.orientation==="horizontal"?(r=o.x-e.x,r=this._snapRight(s,h,r,0,this.selectedObject,!1),u=0,this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+r},!0)):(r=0,u=o.y-e.y,u=this._snapBottom(s,h,0,u,this.selectedObject,!1),this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+u},!0));f&&(f.width+=r,f.height+=u,this._helperBounds=n.extend(!0,{},f),t.datavisualization.Diagram.SvgContext._updatePhaseHelper(this.diagram,i,f))},r.prototype._drawPhasehelper=function(n){var i=this.diagram._getPhaseBounds(n);n&&i&&t.datavisualization.Diagram.SvgContext._phasehelper(this.diagram,n,i)},r.prototype.mousemove=function(n){if(i.prototype.mousemove.call(this,n),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this._outOfBoundsDrag(this.selectedSeperator)){if(this.selectedSeperator)this.selectedSeperator&&(this._bounds||(this._bounds=this.diagram._getPhaseBounds(this.selectedSeperator)),this._updatePhasehelper(this.selectedSeperator));else{if(this.inAction){var r=this._getSeperator(n);r&&!this.selectedSeperator&&(this.selectedSeperator=r)}this._drawPhasehelper(this.selectedSeperator);this.diagram.selectionList[0]&&this.diagram.selectionList[0].type!="phase"?(this.diagram._clearSelection(!0),this.diagram.addSelection(this.selectedSeperator,!0)):this.diagram.addSelection(this.selectedSeperator,!0)}this.previousPoint=this.currentPoint}},r.prototype._getPadding=function(n){var r=20,u=20,f=this.diagram.nameTable[this.diagram._getChild(n.children[n.children.length-1])],i,t;return f&&(i=f.children,i.length>0&&(t=this.diagram.nameTable[this.diagram._getChild(i[0])],t&&t.isLane&&(r=t.paddingRight,u=t.paddingBottom))),{x:r,y:u}},r.prototype.mouseup=function(n){var u=this._getSeperator(n),e,r,h,c;if(this.diagram.selectionList.length>0&&u&&this.diagram.selectionList[0].name!=u.name&&this.diagram._clearSelection(!0),u&&!this.selectedSeperator)this.selectedSeperator=u,this.diagram.addSelection(this.selectedSeperator,!0);else if(this.selectedSeperator&&(e=this.selectedSeperator.parent.split("phaseStack")[0],e&&(r=this.diagram.nameTable[e],r&&this._helperBounds&&r.isSwimlane))){var o=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this.diagram,r),f=0,s=o.indexOf(this.selectedSeperator.name);s>0?f=this.diagram.nameTable[this.diagram._getChild(o[s-1])].offset:r.orientation==="horizontal"&&(f=50);h=jQuery.extend(!0,{},this.selectedSeperator);r.orientation==="horizontal"?this.diagram._updatePhase({name:this.selectedSeperator.name,offset:f+this._helperBounds.width}):this.diagram._updatePhase({name:this.selectedSeperator.name,offset:f+this._helperBounds.height});c={type:"phasepositionchanged",undoObject:jQuery.extend(!0,{},h),redoObject:jQuery.extend(!0,{},jQuery.extend(!0,{},this.selectedSeperator)),category:"internal"};this._multipleUndo||this.diagram.addHistoryEntry(c);this.diagram.addSelection(this.selectedSeperator,!0)}this._removePhasehelper();this._bounds=null;this.inAction=!1;this.selectedSeperator=null;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mouseup.call(this,n)},r.prototype._getOuterPhaseNodes=function(n,i){var f,r,e;if(n){var o=this.diagram.nameTable[this.diagram._getChild(n.children[2])],s=[],h=null,u=null;for(f=0;o&&f<o.children.length;f++)if(r=this.diagram.nameTable[this.diagram._getChild(o.children[f])],r&&r.children&&r.children.length>1)for(e=0;e<r.children.length;e++)u=this.diagram.nameTable[this.diagram._getChild(r.children[e])],u&&(h=t.datavisualization.Diagram.Util.bounds(u),i?h.y>n.offsetY-n.height/2+this.selectedSeperator.offset&&s.push(u):h.x>n.offsetX-n.width/2+this.selectedSeperator.offset&&s.push(u))}return s},r}(i);t.datavisualization.Diagram.PhaseTool=k;d=function(i){function r(n){i.call(this,"labelMove",n);this._isMouseDown=!1;this.undoObject=[];this.inAction=!1}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){var r,f,e,o,u,s,h;if(i.prototype.mousedown.call(this,n),this._isMouseDown=!0,n&&(n.target.className=="ej-d-label"||n.target.parentNode.getAttribute("class")==="ej-d-label")){for(r=this.diagram._nodeUnderMouse,f=n.target.id,f||(f=n.target.parentNode.id),e=f.split("_"),o="",u=1;u<e.length;u++)o+=e[u],u!=e.length-1&&(o+="_");s=this.diagram._findLabel(r,o);s||(s=r.labels[0]);this.selectedObject=s;r.segments||(this.selectedObject.width=this.selectedObject.width>r.width?this.selectedObject.width:r.width,this.selectedObject.height=this.selectedObject.height>r.height?this.selectedObject.height:r.height);r.segments&&(h=t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,r,this.selectedObject),this.selectedObject.width=this.selectedObject.width?this.selectedObject.width:h.width,this.selectedObject.height=this.selectedObject.height?this.selectedObject.height:h.height)}},r.prototype.mousemove=function(r){var u,f,e;i.prototype.mousemove.call(this,r);this.selectedObject&&this.selectedObject._parent&&(u=this.diagram.findNode(this.selectedObject._parent),this._isMouseDown&&!this.inAction&&!this.inAction&&this.selectedObject&&(this.inAction=!0,f={},e=n.extend(!0,{},{childTable:f,node:u,activeLabel:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},e)),this._isMouseDown&&this.selectedObject&&t.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&(t.datavisualization.Diagram.Util.canMove(this.selectedObject)||t.datavisualization.Diagram.Util.canMoveLabel(u))&&!this.diagram._isEditing&&(this.inAction||(this.inAction=!0),this.updateCursor("move"),this.selectedObject._type==="label"&&this._updateSelection(),this._updateLabelXY(this.selectedObject,this.previousPoint,this.currentPoint),this.selectedObject._type==="label"&&this.diagram._updateSelectionHandle(!0)));this.previousPoint=this.currentPoint},r.prototype.mouseup=function(r){var f,u,e;if(this.selectedObject&&this.selectedObject._parent&&(u=this.diagram.findNode(this.selectedObject._parent),(t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&t.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&t.datavisualization.Diagram.Util.canMove(this.selectedObject)||t.datavisualization.Diagram.Util.canMoveLabel(u))&&(t.datavisualization.Diagram.Util.canMoveLabel(u)&&!t.datavisualization.Diagram.Util.canSelect(this.selectedObject)?this.diagram._selectionContains(this.node)||(this.diagram._clearSelection(!0),this.diagram._addSelection(u,!1)):this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject,!1)),this.selectedObject._type==="label"&&this.diagram._updateSelectionHandle(!1),f=u,this.inAction))){this.inAction=!1;var o=n.extend(!0,{},{childTable:{},node:u,label:this.selectedObject}),s={type:"labelpositionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},o),category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(s)}f&&(e=this.diagram._mousePosition(r.originalEvent),this._raiseEvent("click",{element:f,actualObject:null,count:this.diagram._getEventDetail(r),offsetX:e.x,offsetY:e.y,event:r}));delete this._isMouseDown;i.prototype.mouseup.call(this,r)},r.prototype._updateLabelXY=function(n,i,r){var f=r.x-i.x,e=r.y-i.y,u=this.diagram.findNode(n._parent),o,s;u.segments||(o=t.Matrix.identity(),t.Matrix.rotate(o,-u.rotateAngle),s=t.Matrix.transform(o,t.datavisualization.Diagram.Point(f,e)),f=s.x,e=s.y);u.segments&&n.relativeMode=="segmentpath"&&t.datavisualization.Diagram.Util.isAllowDragLimit(u)?this._updateLabelOffset(u,n,f,e):this.diagram.translateLabel(u,n,f,e)},r.prototype._updateSelection=function(){this.selectedObject._type==="label"&&(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject,!0))},r.prototype._updateLabelOffset=function(i,r,u,f,e,o,s){var y={minDistance:null},v=null,p=0,g,h,w,b,l,c,k,e,nt,tt,d,ut,ft,a,it,rt;if(i.segments&&r.relativeMode==="segmentpath"){if(g=n.extend(!0,{},r),h={x:0,y:0,width:0,height:0,centerX:0,centerY:0},e?l=e:(h=t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,i,r),ut=this.diagram._currZoom,h.x=h.x+u,h.y=h.y+f,w=this.diagram.model.labelRenderingMode==="svg"?{x:h.centerX+u,y:h.centerY+f}:{x:h.x+h.width/2,y:h.y+h.height/2},b={x:this.currentPoint.x-w.x,y:this.currentPoint.y-w.y},l={x:this.currentPoint.x-b.x,y:this.currentPoint.y-b.y}),c=t.datavisualization.Diagram.Util.getPoints(i),k=this._getInterceptWithSegment(l,c),e=this._getRelativeOffset(l,c,y),nt=this._getLengthFromListOfPoints(c),ft=t.datavisualization.Diagram.Util.bounds(i),k.length>0){if(d={minDistance:null},tt=this._getRelativeOffset(l,k,d),y.minDistance!=null&&d.minDistance<y.minDistance&&(e=tt),e){for(a=0;a<c.length;a++){if(v!=null)if(it=t.datavisualization.Diagram.Geometry.rect([v,c[a]]),t.datavisualization.Diagram.Geometry.containsPoint(it,e)){p+=t.datavisualization.Diagram.Util.findLength(v,e);break}else p+=t.datavisualization.Diagram.Util.findLength(v,c[a]);v=c[a]}rt=t.datavisualization.Diagram.Point(p/nt,0)}this._updateLabelMargin(i,r,rt,l,u,f,o,s)}else this._updateLabelMargin(i,r,null,l,u,f);this.diagram._comparePropertyValues(i,"labels",g,!0)}},r.prototype._updateLabelMargin=function(n,i,r,u,f,e,o,s){var y,h,k,c,d,p,l,g,w,v,nt,b;if(r=r?r:{x:i.segmentOffset,y:0},i&&r&&(l=i.dragLimit,p=t.datavisualization.Diagram.Util.getPoints(n),d=this._getLengthFromListOfPoints(p),r.x>0&&r.x<1)){k={angle:null};c=this._getPointAtLength(d*r.x,p,k);var a=this.diagram._currZoom,tt=t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,n,i),h={x:0,y:0,width:0,height:0};if(h=t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,n,i,!0),h.x=h.x/a+f,h.y=h.y/a+e,h.width=h.width/a,h.height=h.height/a,y={x:c.x-l.left-h.width/2,y:c.y-l.top-h.height/2,width:l.left+l.right+h.width,height:l.top+l.bottom+h.height},t.datavisualization.Diagram.Geometry.containsPoint(y,u))u=u;else for(g=[c,u],w=this._boundsInterSects(g,y,!1),v=0;v<w.length;v++)nt=w[v],u=nt;b=this._checkCursorLimit(i,c,u,h);i.margin={left:b.x?u.x-c.x:i.margin.left,top:b.y?u.y-c.y:i.margin.top,right:0,bottom:0};i.segmentOffset=r.x;o&&s&&(i.width=o,i.height=s);t.datavisualization.Diagram.DiagramContext.updateLabel(n,i,this.diagram)}},r.prototype._getInterceptWithSegment=function(n,i){for(var l=[],a,r,e,u,h,c,o,s=t.datavisualization.Diagram.Util.findLength(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(this.diagram._viewPort.width,this.diagram._viewPort.height)),f=1;f<i.length;f++)for(u=[i[f-1],i[f]],e=[],r=Math.round(t.datavisualization.Diagram.Util.findAngle(u[0],u[1])%360,2),a=Math.round(t.datavisualization.Diagram.Util.findAngle(u[1],u[0])%360,2),h=r>0&&r<=90||r>180&&r<=270?90:-90,e.push(t.datavisualization.Diagram.Geometry.transform(n,r+h,s)),e.push(t.datavisualization.Diagram.Geometry.transform(n,a+h,s)),c=this._intersect(u,e,!1),o=0;o<c.length;o++)l.push(c[o]);return l},r.prototype._getRelativeOffset=function(n,t,i){for(var e,r,u,f=0;f<t.length;f++)u=t[f],r=Math.round(Math.sqrt(Math.pow(n.x-u.x,2)+Math.pow(n.y-u.y,2))),(i.minDistance==null||Math.min(Math.abs(i.minDistance),Math.abs(r))==Math.abs(r))&&(e=u,i.minDistance=r);return e},r.prototype._getLengthFromListOfPoints=function(n){for(var u=0,r=n[0],i=0;i<n.length;i++)u+=t.datavisualization.Diagram.Util.findLength(r,n[i]),r=n[i];return u},r.prototype._getPointAtLength=function(n,i,r){var h,c,o,a,v;r.angle=0;for(var s=0,u=null,l=t.datavisualization.Diagram.Point(0,0),f,e=0;e<i.length;e++){if(f=i[e],u)if(h=t.datavisualization.Diagram.Util.findLength(u,f),s+h>=n){c=n-s;o=t.datavisualization.Diagram.Util.findAngle(u,f);a=c*Math.cos(o*Math.PI/180);v=c*Math.sin(o*Math.PI/180);l=t.datavisualization.Diagram.Point(u.x+a,u.y+v);r.angle=o;break}else s+=h;else{u=f;continue}u=f}return l},r.prototype._checkCursorLimit=function(n,t,i,r){var u=!1,f=!1;return i.x>=t.x-n.dragLimit.left-r.width/2&&i.x<=t.x+n.dragLimit.right+r.width/2&&(u=!0),i.y>=t.y-n.dragLimit.top-r.height/2&&i.y<=t.y+n.dragLimit.bottom+r.height/2&&(f=!0),{x:u,y:f}},r.prototype._boundsInterSects=function(n,t){var i=[],r;return t&&(r=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height},{x:t.x,y:t.y}],i=this._intersect(n,r,i)),i},r.prototype._intersect=function(n,i,r){for(var u,e,o=[],f=0;f<n.length-1;f++){for(u=0;u<i.length-1;u++)e=t.datavisualization.Diagram.Util.interSect2(n[f],n[f+1],i[u],i[u+1]),t.datavisualization.Diagram.Geometry.isEqualPoint(t.datavisualization.Diagram.Point(0,0),e)||o.push(e);r&&i.length>=1}return o},r.prototype.getCenterOfLabel=function(n,i){var r=t.datavisualization.Diagram.Point(0,0);if(this.selectedObject&&this.selectedObject._parent){var u=t.datavisualization.Diagram.Util.getPoints(this.diagram.findNode(this.selectedObject._parent)),f=this._getLengthFromListOfPoints(u),r=this._getPointAtLength(f*i,u,{});r.x+=n.margin.left-n.margin.right;r.y+=n.margin.top-n.margin.bottom}return r},r}(i);t.datavisualization.Diagram.LabelMoveTool=d;g=function(i){function r(n){i.call(this,"labelResize",n);this._resizeDirection=null;this.undoObject=null;this._mouseDown=!1}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mousedown.call(this,n);this._mouseDown=!0;this.selectedObject=this.diagram.selectionList[0]},r.prototype.mousemove=function(r){var u;if(i.prototype.mousemove.call(this,r),!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown){this.selectedObject=this.diagram.selectionList[0];var f=this.diagram.findNode(this.selectedObject._parent),e=n.extend(!0,{},{childTable:{},node:f,activeLabel:this.selectedObject});this.undoObject=jQuery.extend(!0,{},e);this._resizeDirection=r.target.getAttribute("class");u=this._getLabelCenter(this.selectedObject);this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:u.y,x:u.x};this.inAction=!0}this.selectedObject&&this.inAction&&t.datavisualization.Diagram.Util.canResize(this.selectedObject)&&(this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0));this.previousPoint=this.currentPoint},r.prototype.mouseup=function(r){if(this._mouseDown=!1,this.inAction&&this.selectedObject){this.inAction=!1;var u=n.extend(!0,{},{childTable:{},node:this.diagram.findNode(this.selectedObject._parent),label:this.selectedObject}),f={type:"labelsizechanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},u),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(f);t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);this.diagram._updateSelectionHandle(!1)}i.prototype.mouseup.call(this,r)},r.prototype._updateSize=function(n){var r=this.diagram.findNode(n._parent),f,e,h=t.Matrix.identity(),b=this.currentPoint.x-this.startPoint.x,k=this.currentPoint.y-this.startPoint.y,v=this.diagram._findLabelRotateAngle(n),y=this._getLabelCenter(n),u=this._resizeObject(n,b,k),c,o,s,p,w;if(f=u.width,e=u.height,f<0&&(f=1),e<0&&(e=1),f&&f!=1||e&&e!=1){c=t.Matrix.identity();t.Matrix.rotate(c,-r.rotateAngle,r.offsetX,r.offsetY);o=t.datavisualization.Diagram.Util.bounds(r,!0);t.Matrix.rotate(h,-v,u.x,u.y);t.Matrix.scale(h,f,e,u.x,u.y);t.Matrix.rotate(h,v,u.x,u.y);var i=t.Matrix.transform(h,t.datavisualization.Diagram.Point(y.x,y.y)),l=n.height*e,a=n.width*f;r.segments&&n.relativeMode=="segmentpath"?this.diagram.tools.labelMove._updateLabelOffset(r,n,0,0,i,a,l):(r.segments||(i=t.Matrix.transform(c,i)),i.x=i.x-n.margin.left+n.margin.right,i.y=i.y-n.margin.top+n.margin.bottom,s=this._findLabelAtNode(r,n),n.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?i.y-=s.height/2:n.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Bottom&&(i.y+=s.height/2),n.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Left?i.x-=s.width/2:n.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Right&&(i.x+=s.width/2),p=o.width/(i.x-o.x),w=o.height/(i.y-o.y),a>1&&(n.width=a,n.offset.x=1/p),l>1&&(n.height=l,n.offset.y=1/w))}},r}(i);t.datavisualization.Diagram.LabelResizeTool=g;nt=function(i){function r(n){i.call(this,"labelRotate",n);this.inAction=!1;this.undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(t){i.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0];var r=this.diagram.findNode(this.selectedObject._parent),u=n.extend(!0,{},{childTable:{},node:r,activeLabel:this.selectedObject});this.undoObject=jQuery.extend(!0,{},u)},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);this.selectedObject&&t.datavisualization.Diagram.Util.canRotate(this.selectedObject)&&(this.inAction||(this.inAction=!0),this._rotate(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0));this.previousPoint=this.currentPoint},r.prototype._rotate=function(n){var f=t.Matrix.identity(),u,r,i;u=this.diagram._findLabelRotateAngle(n);r=this._getLabelCenter(n);i=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(r.x,r.y),this.currentPoint)+90;i=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,i)-u;n.rotateAngle+=i;n.rotateAngle%=360;n.rotateAngle<0&&(n.rotateAngle+=360)},r.prototype.mouseup=function(r){if(this.inAction){this.inAction=!1;this._rotate(this.selectedObject);t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);var u=n.extend(!0,{},{childTable:{},node:this.diagram.findNode(this.selectedObject._parent),activeLabel:this.selectedObject}),f={type:"labelrotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},u),category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(f);this.selectedObject&&t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom);this.diagram._updateSelectionHandle()}i.prototype.mouseup.call(this,r)},r}(i);t.datavisualization.Diagram.LabelRotateTool=nt}(jQuery,Syncfusion),function(n,t){"use strict";var i,r,u;t.datavisualization.Diagram.LayoutTypes={None:"none",HierarchicalTree:"hierarchicaltree",OrganizationalChart:"organizationalchart",RadialTree:"radialtree",SymmetricLayout:"symmetriclayout"};t.datavisualization.Diagram.ChartOrientations={Horizontal:"horizontal",Vertical:"vertical"};t.datavisualization.Diagram.ChartTypes={Left:"left",Right:"right",Alternate:"alternate",Center:"center"};t.datavisualization.Diagram.Layout={doLayout:function(i,r){var e=i.model,u={diagram:i,_anchorX:0,_anchorY:0,_graphNodes:{},_firstLevelNodes:[],_centerNode:null,levels:[],maxLevel:0,layoutNodes:[]},f,o,s;for(f in e.layout)f=="type"?u.type=i._layoutType():f=="orientation"?u.orientation=i._layoutOrientation():f=="fixedNode"?u.fixedNode=i._fixedNode():f=="horizontalSpacing"?u.horizontalSpacing=Number(i._horizontalSpacing()):f=="verticalSpacing"?u.verticalSpacing=Number(i._verticalSpacing()):f=="marginX"?u.marginX=Number(i._layoutMarginX()):f=="marginY"?u.marginY=Number(i._layoutMarginY()):f=="getLayoutInfo"?typeof e.layout.getLayoutInfo=="string"?u.getLayoutInfo=t.util.getObject(e.layout.getLayoutInfo,window):n.isFunction(e.layout.getLayoutInfo)&&(u.getLayoutInfo=e.layout.getLayoutInfo):f=="getConnectorSegments"?typeof e.layout.getConnectorSegments=="string"?u.getConnectorSegments=t.util.getObject(e.layout.getConnectorSegments,window):n.isFunction(e.layout.getConnectorSegments)&&(u.getConnectorSegments=e.layout.getConnectorSegments):u[f]=e.layout[f];return u.updateView=r===undefined?!0:u.updateView,u.objects=[],u.type==="symmetriclayout"?(o=new SymmetricLayoutManager(u.diagram,50),o.MaxIteration=u.maxIteration,o.SpringLength=u.springLength,o.SpringFactor=u.springFactor,s=new GraphLayoutManager,s.updateLayout(u.diagram,o)):u.type!="radialtree"?t.datavisualization.Diagram.HierarchicalLayout.doLayout(u):t.datavisualization.Diagram.RadialTreeLayout.doLayout(u),u.updateView?void 0:u.objects}};t.datavisualization.Diagram.HierarchicalLayout={doLayout:function(n){var u,g,o,f,b,v,y,k,d,i,r,p,w,h,c,l,a,s,e;if(u=n.diagram,g=u.model,o=u.nodes(),this._checkMultiparent(o,n))v=new t.datavisualization.Diagram.LineDistribution(this),n.avoidSegmentOverlapping&&v._initLineDistribution(n),t.datavisualization.Diagram.MultipleParentHierarchicalLayout.doLayout(n);else if(o.length>0){for(i=0;i<o.length;i++)f=o[i],f.excludeFromLayout||(b=n._graphNodes[f.name]=this._setUpLayoutInfo(n,f),b.tree.hasSubTree=!1,f.inEdges&&f.inEdges.length&&!this._isAnnotationShape(f,!1)||n._firstLevelNodes.push(f));if(n.root||u.model.dataSourceSettings.root){if(n.root)n.rootNode=y=u.nameTable[u._getChild(n.root)];else for(k=u.model.dataSourceSettings.root,d=u.model.dataSourceSettings.id,i=0;i<o.length;i++)o[i][d]===k&&(n.rootNode=y=u.nameTable[u._getChild(o[i].name)]);if(y&&n._firstLevelNodes.length===0){t.datavisualization.Diagram.MultipleParentHierarchicalLayout.doLayout(n);return}}for(i=0;i<n._firstLevelNodes.length;i++)f=n._firstLevelNodes[i],this._updateEdges(n,f,1);if(n._firstLevelNodes.length>0){for(n._rootNode=n._firstLevelNodes[0],p=0,w=0,i=0;i<n._firstLevelNodes.length;i++)r=this._updateTree(n,p,w,n._firstLevelNodes[i],0,n._firstLevelNodes[i-1]),s=n._graphNodes[n._firstLevelNodes[i].name],s.y<r.y&&(r.y=s.y),s.x<r.x&&(r.x=s.x),n.orientation=="lefttoright"||n.orientation=="righttoleft"?w=r.right+n.horizontalSpacing:p=r.right+n.horizontalSpacing,i==0?(h=r.x,l=r.y,c=r.right,a=r.bottom):(h=Math.min(h,r.x),l=Math.min(l,r.y),c=Math.max(c,r.right),a=Math.max(a,r.bottom));for(this._updateAnchor(n,{x:h,y:l,right:c,bottom:a}),u._layoutInAction=!0,i=0;i<n._firstLevelNodes.length;i++)this._updateNodes(n,n._firstLevelNodes[i],0);if(u._layoutInAction=!1,n.updateView||(u._internalLayout=n),n.updateView)for(i=0;i<n._firstLevelNodes.length;i++)this._updateConnectors(n,n._firstLevelNodes[i],1);for(e=0;e<n.diagram.model.connectors.length;e++)delete n.diagram.model.connectors[e]._visited;for(e=0;e<n.diagram.model.nodes.length;e++)delete n.diagram.model.nodes[e]._visited1,delete n.diagram.model.nodes[e]._isRightAdded}}n.avoidSegmentOverlapping&&v._distributeLines(n);delete n.diagram.minSpaceBetweenNode},_checkMultiparent:function(n,t){var r,i;if(n&&n.length>0)for(r=0;r<n.length;r++)if(i=n[r],t._processedNodes=[],i&&(i.inEdges&&i.inEdges.length>1&&!this._isAnnotationShape(i,!0)||this._checkCyclicNodes(i,t,i.name)))return delete t._processedNodes,!0;return delete t._processedNodes,!1},_checkCyclicNodes:function(n,t,i){var u,f,r,e;if(n.outEdges&&n.outEdges.length>0&&!this._isLoopProcessed(t,n.name))for(t._processedNodes.push(n.name),u=0;u<n.outEdges.length;u++)if(f=t.diagram.nameTable[n.outEdges[u]],f&&(f.targetNode===i||(r=t.diagram.nameTable[f.targetNode],r&&r.outEdges&&r.outEdges.length>0&&(e=this._checkCyclicNodes(r,t,i),e))))return!0;return!1},_isLoopProcessed:function(n,t){for(var r=n._processedNodes,i=0;i<r.length;i++)if(r[i]===t)return!0;return!1},_isAnnotationShape:function(n,t){if(n&&n.type==="bpmn"&&n._type==="group"&&n.annotation&&n.annotation.text)if(t){if(n.inEdges.length<=2)return!0}else if(n.inEdges.length<=1)return!0;return!1},_updateTree:function(n,t,i,r,u,f,e){var s,o,l,y,p,h,w,a,b,v,k,c;return r._visited1?r._treeBounds:(r._visited1=!0,s=this._getDimensions(n,r,t,i,u),o=n._graphNodes[r.name],n.maxLevel=Math.max(n.maxLevel,u),l=u,p=this._hasChild(n,r),p||o.tree.assistants.length?(c=s.y+s.height+n.verticalSpacing,o.tree.assistants.length&&(y=this._setDepthSpaceForAssistants(n,r,c,s.height,u,n.verticalSpacing),l=y.level,c=y.bottom),o.tree.assistants.length||o.tree.orientation=="horizontal"||(c=s.y+s.height+n.verticalSpacing/2),o.tree.children.length&&(h=o.tree.orientation=="horizontal"&&(o.tree.type!="balanced"||o.tree.children.length==1)?this._updateHorizontalTree(n,r,f,s.x,c,l):o.tree.type=="balanced"?this._updateHorizontalTreeWithMultipleRows(n,r,f,s.x,c,l):this._updateVerticalTree(n,r,s.x,c,l,e)),o.y&&o.y>s.y||(o.y=s.y),o.mid&&(t=o.mid),o.tree.assistants.length&&(k=t!==undefined?t:s.x,v=this._setBreadthSpaceForAssistants(n,r,s,k,c,u),p||(a=h=v,t=(a.x+a.right)/2-s.width/2,h=a),b=v?v.canMoveBy:undefined),o.x=t,o.translate||(o._treeWidth=h.right-h.x),w={x:t,y:s.y,right:t+s.width,bottom:s.y+s.height},this._translateSubTree(n,r,w,h,s,u,b,f!=undefined,e),typeof o.firstChild!="string"&&(o.firstChild.x+=o.subTreeTranslation),r._treeBounds=h,h):(r._treeBounds=this._updateLeafNode(n,r,f,s,u,e),r._treeBounds))},_updateLeafNode:function(n,t,i,r,u,f){var e,o;return e=n._graphNodes[t.name],e.x&&e.x>r.x||(e.x=r.x),e.y&&e.y>r.y||(e.y=r.y),e.maxLevel=Math.max(u,e.maxLevel||0),o={x:r.x,y:r.y,right:r.x+r.width,bottom:r.y+r.height},e.maxLevel=Math.max(e.maxLevel||0,u),this._translateSubTree(n,t,o,o,r,u,undefined,i!=undefined,f),{x:e.x,y:e.y,right:e.x+r.width,bottom:e.y+r.height}},_translateSubTree:function(n,t,i,r,u,f,e,o,s){var h=n._graphNodes[t.name],c=n.diagram.nameTable[h.firstChild?h.firstChild.child:h.tree.children[0]],l=c?n._graphNodes[c.name]:null,a=this._hasChild(n,t),v=this._findIntersectingLevels(n,i,f,h.actualLevel),p=this._findIntersectingLevels(n,r,f,h.actualLevel),y=[];v.length&&h.translate?(h.intersect=v,this._spaceLeftFromPrevSubTree(n,t,i),h.canMoveBy=h.diff,e!==undefined&&(h.canMoveBy=Math.min(e,h.canMoveBy)),c&&l.canMoveBy!==undefined&&(l.canMoveBy>=h.canMoveBy&&(h.translated=!0),h.canMoveBy=Math.min(h.canMoveBy,l.canMoveBy)),o&&(h.x-=h.canMoveBy,h.subTreeTranslation-=h.canMoveBy,a&&(this._shiftSubordinates(n,p,h.canMoveBy),r.x=Math.min(r.x,h.x),r.right=Math.max(r.right,h.x+u.width),r.bottom=Math.max(r.bottom,h.y+u.height),r.x-=h.canMoveBy,r.right-=h.canMoveBy),c&&l.canMoveBy>h.canMoveBy?h.canMoveBy=l.canMoveBy-h.canMoveBy:c&&h.canMoveBy!==undefined&&(h.canMoveBy=0))):(a&&(r.x=Math.min(r.x,i.x),r.right=Math.max(r.right,i.x+u.width),r.bottom=Math.max(r.bottom,h.y+u.height)),h.translate||(h.canMoveBy=0,h.subTreeTranslation=0));s||(i={x:h.x,y:u.y,right:h.x+u.width,bottom:u.y+u.height},y.push({rBounds:i}),this._updateRearBounds(n,t,y,f))},_updateRearBounds:function(n,t,i,r,u){var f,o,u,s,h,a=!0,c,l,e;if(t&&(c=n._graphNodes[t.name],u=c.intersect,a=!c.tree.children.length&&!c.tree.assistants.length),s=i[0].rBounds,h=i[i.length-1].rBounds,u&&u.length){for(f=n.levels[u[0]].rBounds,l=f.bottom,f.y<s.y&&(f.bottom=s.y,i.splice(0,0,{rBounds:f})),l>h.bottom?i.push({rBounds:{x:f.x,right:f.right,y:s.bottom,bottom:l}}):(f=n.levels[u[u.length-1]].rBounds,a&&f.bottom>h.bottom&&(f.y=h.bottom,i.push({rBounds:f}))),o=u[0],e=i.length-1;e>=0;e--)n.levels.splice(o,0,i[e]);o+=i.length;n.levels.splice(o,u.length)}else for(o=this._findLevel(n,i[i.length-1].rBounds,r),e=i.length-1;e>=0;e--)n.levels.splice(o,0,i[e])},_shiftSubordinates:function(n,t,i){var r;if(i!=0)for(r=0;r<t.length;r++)n.levels[t[r]].rBounds&&(n.levels[t[r]].rBounds.x-=i,n.levels[t[r]].rBounds.right-=i)},_setDepthSpaceForAssistants:function(n,t,i,r,u,f){for(var h=n._graphNodes[t.name],s,c,o,l=i,e=0;e<h.tree.assistants.length;e++)s=n._graphNodes[h.tree.assistants[e]],s&&(s.tree.children=s.tree.assistants=[],s.y=i,o=n.diagram.nameTable[h.tree.assistants[e]],c=o.height?o.height:o._height,(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(c=o.width?o.width:o._width),l=i+c+f/2,n.maxLevel=u+1,e%2==1&&e!=h.tree.assistants.length-1&&(i=l,u++));return{level:n.maxLevel,bottom:i+c+f}},_setBreadthSpaceForAssistants:function(n,t,i,r,u,f){for(var s,y,h,o,c=n._graphNodes[t.name],b=u,a=f,p,v,l,w,e=0;e<c.tree.assistants.length;e++)s=n._graphNodes[c.tree.assistants[e]],s&&(o=n.diagram.nameTable[c.tree.assistants[e]],y=o.width?o.width:o._width,(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(y=o.height?o.height:o._height),p=e%2==0?r+i.width/2-20-y:r+i.width/2+20,h=this._updateTree(n,p,s.y,n.diagram.nameTable[c.tree.assistants[e]],a+1),this._hasChild(n,t)||(e==0?l=h:this._uniteRects(l,h)),e%2==0&&s.prevBounds&&(v=v===undefined?s.canMoveBy:Math.min(v,s.canMoveBy)),(e%2==1||e==c.tree.assistants.length-1)&&(w=this._findIntersectingLevels(n,h,a+1),this._updateRearBounds(n,null,[{rBounds:h}],a+1,w),a++));return l&&(l.canMoveBy=v),l},_updateHorizontalTree:function(n,t,i,r,u,f){var s,e,h,nt,tt,y,et,p,c,w,it,rt=this._getDimensions(n,t,r,u,f),o=n._graphNodes[t.name],ut=o.tree.type,b=f,ft=r,ot=u,k,d,st=n.levels.slice(0,n.levels.length),g,l,a,v;if(this._hasChild(n,t)){for(g=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,l=0;l<o.tree.children.length;l++)s=n.diagram.nameTable[o.tree.children[l]],k=s.width?s.width:s._width,d=s.height?s.height:s._height,nt=g?d:k,tt=g?k:d,et=n.levels[b+1]?n.levels[b+1].rBounds:null,h=this._updateTree(n,ft,ot,s,b+1,n.diagram.nameTable[o.tree.children[l-1]]),e=n._graphNodes[s.name],o.maxLevel=Math.max(o.maxLevel||0,e.maxLevel||0),c={x:e.x,y:e.y,right:e.x+nt,bottom:e.y+tt},l==0&&(p={x:Math.min(e.x,h.x),y:Math.min(e.y,h.y),right:h.right,bottom:h.bottom},y=e),a?(a.x=c.x,a.y=c.y,c.right>a.right&&(a.right=c.right),a.bottom=c.bottom):a=c,l==0&&(o.firstChild={x:e.x,canMoveBy:e.canMoveBy,child:s.name}),this._hasChild(n,s)&&(!o.firstChild||o.firstChild.x>=e.firstChild.x?(e.firstChild&&o.firstChild.canMoveBy<e.canMoveBy&&(v=o.firstChild.canMoveBy,e.canMoveBy=v,n._graphNodes[o.firstChild.child].canMoveBy=v,o.firstChild.canMoveBy=v),o.firstChild={x:e.firstChild.x,canMoveBy:v!==undefined?v:e.canMoveBy,child:s.name}):e.firstChild&&e.translated&&o.firstChild.canMoveBy>e.canMoveBy&&(o.firstChild.canMoveBy=n._graphNodes[o.firstChild.child].canMoveBy=e.canMoveBy)),w=w?Math.max(e.maxLevel,w):e.maxLevel,s._isRightAdded||(this._uniteRects(p,h),ft=l!=0&&!this._hasChild(n,s)&&e.subTreeTranslation<0?h.right-e.subTreeTranslation+n.horizontalSpacing:h.right+n.horizontalSpacing),s._isRightAdded=!0;isNaN(it)||(y.canMoveBy=it);o.mid=(y.x+a.right)/2-rt.width/2;ut=="left"?o.mid=c.right-rt.width:ut=="right"&&(o.mid=r)}return p},_updateHorizontalTreeWithMultipleRows:function(n,t,i,r,u,f,e){var h,l,a,rt,kt,st,ut,ni,ft=this._getDimensions(n,t,r,u,f),b=n._graphNodes[t.name],fi=b.tree.type,g=f,nt=r,ht=u,et,ot,ei=n.levels.slice(0,n.levels.length),e=[],tt=0,bt,lt,p,it,d,ti,dt,gt,at,oi,v,o,vt,yt,pt,wt,s;if(this._hasChild(n,t)){var ct=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,w=this._splitChildrenInRows(n,t),k=b.tree.children.length==5&&w[0].length==3,y=[],c=[];if(k)c=w;else for(o=0;o<w.length;o++){if(y[o]=[],c[o]=[],bt=w[o].length,w[o].length%2!=1)for(bt=Math.ceil(w[o].length/2),lt=0;lt<bt;lt++)y[o].push(w[o][lt]);for(s=y[o].length;s<w[o].length;s++)c[o].push(w[o][s])}for(p=[],tt=0,o=0;o<y.length&&y[o].length;o++){for(nt=r,p[o-1]&&(ht=p[o-1].bottom+n.verticalSpacing),s=0;s<y[o].length;s++)h=n.diagram.nameTable[y[o][s]],et=h.width?h.width:h._width,ot=h.height?h.height:h._height,rt=ct?ot:et,kt=ct?et:ot,st=n.levels[g+1]?n.levels[g+1].rBounds:null,l=n._graphNodes[h.name],l.actualLevel=g+1+o,a=this._updateTree(n,nt,ht,h,g+1,n.diagram.nameTable[y[o][s-1]]),s==0?p[o]={x:a.x,y:a.y,right:a.right,bottom:a.bottom}:this._uniteRects(p[o],a),o==0&&s==0?(tt=l.canMoveBy,b.firstChild={x:l.x,child:h.name,canMoveBy:l.canMoveBy}):s==0&&l.canMoveBy!==undefined&&tt>l.canMoveBy&&(tt=Math.min(tt,l.canMoveBy||0),b.firstChild={x:l.x,child:h.name,canMoveBy:l.canMoveBy}),nt=a.right+n.horizontalSpacing;it=o==0?p[o].right:Math.max(it,p[o].right);st=ni}for(o=0;o<y.length&&y[o].length;o++){if(it!=p[o].right)for(d=it-p[o].right,s=0;s<y[o].length;s++)ti=n.diagram.nameTable[y[o][s]],dt=n._graphNodes[y[o][s]],dt.x+=d;o==0?ut={x:p[0].x,y:p[0].y,right:p[0].right,bottom:p[0].bottom}:this._uniteRects(ut,p[o]);st=a}for(gt=(it||0)+(it!==undefined?n.horizontalSpacing/2:0),it!==undefined&&(b.mid=gt-ft.width/2,at=it+n.horizontalSpacing),ht=u,v=[],o=0;o<c.length;o++){for(nt=w[o].length%2==1&&o==c.length-1||k?r:at||r,o!=0&&(ht=v[o-1].bottom+n.verticalSpacing),s=0;s<c[o].length;s++)h=n.diagram.nameTable[c[o][s]],et=h.width?h.width:h._width,ot=h.height?h.height:h._height,rt=ct?ot:et,kt=ct?et:ot,st=n.levels[g+1]?n.levels[g+1].rBounds:null,l=n._graphNodes[h.name],l.actualLevel=g+1+o,s==0&&y[o]&&y[o].length&&(l.translate=!1),k&&o==1&&(s==0&&yt+rt+n.horizontalSpacing<=pt&&(vt=!0,nt=yt-rt/2),vt&&s==1&&(nt=pt-rt/2)),a=this._updateTree(n,nt,ht,h,g+1,n.diagram.nameTable[c[o][s-1]]),k&&s<=2&&o==0&&s==1&&(yt=a.x-n.horizontalSpacing/2,pt=a.x+rt+n.horizontalSpacing/2),s==0?v[o]={x:a.x,y:a.y,right:a.right,bottom:a.bottom}:this._uniteRects(v[o],a),ut||(ut={x:v[o].x,y:v[o].y,right:v[o].right,bottom:v[o].bottom}),this._uniteRects(ut,v[o]),nt=a.right+n.horizontalSpacing,st=a,(!b.firstChild||(o==c.length-1&&w[o].length%2==1||k)&&s==0&&l.canMoveBy!==undefined&&tt>l.canMoveBy)&&(tt=Math.min(tt,l.canMoveBy||0),b.firstChild={x:l.x,child:h.name,canMoveBy:l.canMoveBy});if(k&&o==1&&(wt=v[0].right-v[0].x>=v[1].right-v[1].x?0:1),o==w.length-1&&(w[o].length%2==1||k&&o==1)){var e=c[o][Math.floor(c[o].length/2)],ii=n.diagram.nameTable[e],ri=this._getDimensions(n,ii,n._graphNodes[e].x,n._graphNodes[e].y,g+1);if(d=undefined,!vt&&k?(wt==1&&(o=0),d=(v[wt].x+v[wt].right)/2-(v[o].x+v[o].right)/2,o==0&&(b.mid+=d)):k||at===undefined||(d=at-n.horizontalSpacing/2-(n._graphNodes[e].x+ri.width/2)),d!==undefined)for(s=0;s<c[o].length;s++)if(n._graphNodes[c[o][s]].x+=d,n._graphNodes[c[o][s]].canMoveBy+=d,s==c[o].length-1){var si=this._getDimensions(n,n.diagram.nameTable[c[o][s]],n._graphNodes[c[o][s]].x,n._graphNodes[c[o][s]].y,n._graphNodes[c[o][s]].actualLevel),h=n._graphNodes[c[o][s]],ui=this._findIntersectingLevels(n,{x:h.x,y:h.y,right:h.x+ft.width,bottom:h.y+ft.height},n._graphNodes[c[o][s]].actualLevel);this._updateRearBounds(n,null,[{rBounds:{x:h.x,y:h.y,right:h.x+ft.width,bottom:h.y+ft.height}}],n._graphNodes[c[o][s]].actualLevel,ui)}k&&(b.mid=(pt+yt)/2+(o==0?d:0)-ft.width/2);b.mid==undefined&&n._graphNodes[e]&&(b.mid=n._graphNodes[e].x);vt=!1;o++}}}return ut},_updateVerticalTree:function(n,t,i,r,u,f){var s,o,a,k,nt,tt,v,y,ot,p,ct,e,st,it,rt,ut,d,w,h,ht,b=[],l=[],g,ft,et,c;for(ct=this._getDimensions(n,t,i,r,u),e=n._graphNodes[t.name],st=n.diagram.nameTable[e.tree.children[0]],it=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,rt=e.tree.type=="left"||e.tree.type=="leftoffset"?-1:0,ut=i,d=r,w=u,h=0;h<e.tree.children.length;h++)e.tree.type=="alternate"&&(ht=h%2==0&&e.tree.children.length>2?"left":"right",rt=h%2==0&&e.tree.children.length>2?-1:0),ut=i+this._findOffset(n,t,e,ht),s=n.diagram.nameTable[e.tree.children[h]],ft=s.width?s.width:s._width,et=s.height?s.height:s._height,k=it?et:ft,nt=it?ft:et,a=this._updateTree(n,ut+rt*k,d,s,u+1,undefined,!0),o=n._graphNodes[s.name],y={x:o.x,y:o.y,right:o.x+k,bottom:o.y+nt},h==0?(this._uniteRects(a,y),v=a):this._uniteRects(v,a),!o.prevBounds||e.tree.type=="alternate"&&h%2==1&&e.tree.children.length>2||(c=c!==undefined?Math.min(o.canMoveBy,c):o.canMoveBy),e.maxLevel=Math.max(e.maxLevel||0,o.maxLevel||0),e.tree.type=="alternate"&&e.tree.children.length>2&&h%2==0?(h!=0&&(d=tt.bottom+n.verticalSpacing/2),l.push({rBounds:y}),o.levelBounds&&(l=l.concat(o.levelBounds))):(d=e.tree.type=="alternate"&&e.tree.children.length>2?Math.max(a.bottom,tt.bottom)+n.verticalSpacing/2:a.bottom+n.verticalSpacing/2,u=e.maxLevel,b.push({rBounds:y}),p?this._uniteRects(p,y):p={x:o.x,y:o.y,right:o.x+k,bottom:o.y+nt},o.levelBounds&&(b=b.concat(o.levelBounds))),h==0&&(e.firstChild={x:o.x,canMoveBy:o.canMoveBy,child:s.name}),this._hasChild(n,s)&&(!e.firstChild||e.firstChild.x>=o.firstChild.x?(o.firstChild&&e.firstChild.canMoveBy<o.canMoveBy&&(c=e.firstChild.canMoveBy,o.canMoveBy=c,n._graphNodes[e.firstChild.child].canMoveBy=c,e.firstChild.canMoveBy=c),e.firstChild={x:o.firstChild.x,canMoveBy:c!==undefined?c:o.canMoveBy,child:s.name}):o.firstChild&&o.translated&&e.firstChild.canMoveBy>o.canMoveBy&&(e.firstChild.canMoveBy=n._graphNodes[e.firstChild.child].canMoveBy=o.canMoveBy)),tt=y;return f?e.levelBounds=b:(e.tree.type=="alternate"&&e.tree.children.length>2&&(ot={x:l[0].rBounds.x,y:l[0].rBounds.y,right:l[l.length-1].rBounds.right,bottom:l[l.length-1].rBounds.bottom},g=this._findIntersectingLevels(n,ot,w+1),this._updateRearBounds(n,null,l,w+1,g)),g=this._findIntersectingLevels(n,p||v,w+1),this._updateRearBounds(n,null,p?b:[{rBounds:v}],w+1,g)),isNaN(c)||(n._graphNodes[st.name].canMoveBy=c),e.childBounds=v,e.mid=i,v},_splitChildrenInRows:function(t,i){var r=t._graphNodes[i.name],u=4,o=[],f=r.tree.children.length,h=n.extend([],!0,r.tree.children),s,e;for(r.tree.rows?(s=r.tree.children.length,e=Math.ceil(s/r.tree.rows),u=e%2==0?e:e+1):r.tree.children.length==3||r.tree.children.length==4?u=2:r.tree.children.length==5&&(u=3);f>0;)o[o.length]=h.splice(0,u),f-=u,f<u&&(u=f);return o},_findOffset:function(n,t,i,r){var u=0,f=n.orientation=="lefttoright"||n.orientation=="righttoleft"?t.height?t.height:t._height:t.width?t.width:t._width,e=r?r:i.tree.type;u=i.tree.offset||(i.tree.offset===0?0:20);i.tree.type=="alternate"&&u>=n.horizontalSpacing&&(u=n.horizontalSpacing/2);switch(e){case"left":u=f/2-u;break;case"right":u=u+f/2}return u},_translateSiblings:function(n,t,i){var r,f,u,e;for(u=n._graphNodes[t.name],e=n._graphNodes[i.name].diff-n._graphNodes[i.name].canMoveBy,r=0;r<u.tree.children.length;r++){if(i.name==u.tree.children[r])break;f=n._graphNodes[u.tree.children[r]];f.x+=e}},_uniteRects:function(n,t){n.x=Math.min(n.x,t.x);n.right=Math.max(n.right,t.right);n.bottom=Math.max(n.bottom,t.bottom)},_spaceLeftFromPrevSubTree:function(n,t,i){for(var r=n._graphNodes[t.name],f,e,o=n.horizontalSpacing,u=0;u<r.intersect.length;u++)e=n.levels[r.intersect[u]].rBounds,f=i.x-(e.right+o),(r.diff==undefined||f<r.diff)&&(r.diff=f,r.prevBounds=n.levels[r.intersect[u]])},_findIntersectingLevels:function(n,t,i,r){var f={x:t.x,y:t.y,right:t.right,bottom:t.bottom},o,u,e;f.y-=n.verticalSpacing/2;f.bottom+=n.verticalSpacing/2;o=[];e=r!==undefined?r:i;u=n.levels[e]?n.levels[e].rBounds:null;do{if(u&&(f.y<u.y&&f.bottom>u.y||f.y<u.bottom&&u.bottom<f.bottom||f.y>=u.y&&f.bottom<=u.bottom||f.y<u.y&&f.bottom>u.bottom))o.splice(0,0,e);else if(u&&u.bottom<f.y)break;e--;u=n.levels[e]?n.levels[e].rBounds:null}while(e>=0);e=(r!==undefined?r:i)+1;u=n.levels[e]?n.levels[e].rBounds:null;do{if(u&&(f.y<u.y&&f.bottom>u.y||f.y<u.bottom&&u.bottom<f.bottom||f.y>=u.y&&f.bottom<=u.bottom||f.y<u.y&&f.bottom>u.bottom))o.push(e);else if(u&&u.y>f.bottom)break;e++;u=n.levels[e]?n.levels[e].rBounds:null}while(e<=n.levels.length);return o},_findLevel:function(n,t){for(var u=t,i=0,r=n.levels[i]?n.levels[i].rBounds:null;i<n.levels.length;){if(r&&u.bottom<r.y)return i;i++;r=n.levels[i]?n.levels[i].rBounds:null}return i},_updateEdges:function(n,i,r){var u=n._graphNodes[i.name],e,f;if(i.outEdges&&i.outEdges.length&&i.isExpanded)for(e=0;e<i.outEdges.length;e++)f=n.diagram.nameTable[n.diagram.nameTable[i.outEdges[e]].targetNode],f.excludeFromLayout||(t.datavisualization.Diagram.Util._collectionContains(f.name,u.tree.children)||u.tree.children.push(f.name),f.outEdges&&f.outEdges.length&&f.isExpanded&&(u.tree.hasSubTree=!0),this._updateEdges(n,f,r+1));u.tree.level=r;u.tree.hasSubTree&&(u.tree.orientation="horizontal");n.getLayoutInfo&&n.type=="organizationalchart"&&(n.getLayoutInfo(n.diagram,i,u.tree),u.tree.type=="balanced"&&u.tree.hasSubTree&&(u.tree.type="center",u.tree.orientation="horizontal"));n.level&&u.tree.type!="alternate"&&r>=n.level&&(u.tree.hasSubTree=!1)},_updateAnchor:function(n,i){var o,s,u,c,l,h,r,f,a,v,y,p,e;if(n.diagram.viewPort=s=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram,!0),s.x=0,s.y=0,r=n.bounds?n.bounds:s,f=n.diagram._layoutOrientation(),f=="toptobottom"||f=="bottomtotop"){switch(n.horizontalAlignment){case"left":n._anchorX=r.x-i.x+n.margin.left;break;case"right":n._anchorX=r.x+r.width-n.margin.right-i.right;break;case"center":n._anchorX=r.x+r.width/2-(i.x+i.right)/2}switch(n.verticalAlignment){case"top":a=r.y+n.margin.top;n._anchorY=f=="toptobottom"?a:i.bottom+a;break;case"bottom":v=r.y+r.height-n.margin.bottom;n._anchorY=f=="toptobottom"?v-i.bottom:v;break;case"center":e=r.y+r.height/2;n._anchorY=n.orientation=="toptobottom"?e-(i.y+i.bottom)/2:e+(i.y+i.bottom)/2}}else if(f=="lefttoright"||f=="righttoleft"){switch(n.horizontalAlignment){case"left":y=r.x+n.margin.left;n._anchorX=f=="lefttoright"?y:i.bottom+y;break;case"right":p=r.x+r.width-n.margin.right;n._anchorX=f=="lefttoright"?p-i.bottom:p;break;case"center":e=r.width/2+r.x;n._anchorX=n.orientation=="lefttoright"?e-(i.y+i.bottom)/2:e+(i.y+i.bottom)/2}switch(n.verticalAlignment){case"top":n._anchorY=r.y+n.margin.top-i.x;break;case"center":n._anchorY=r.y+r.height/2-(i.right+i.x)/2;break;case"bottom":n._anchorY=r.y+r.height-n.margin.bottom-i.right}}if(n.fixedNode){for(u=n.diagram.nameTable[n.fixedNode],c=u.width?u.width:u._width,l=u.height?u.height:u._height,n._anchorX=u.offsetX,n._anchorY=u.offsetY,n._anchorX+=n.orientation=="righttoleft"?c*u.pivot.x:-c*u.pivot.x,n._anchorY+=n.orientation=="bottomtotop"?l*u.pivot.y:-l*u.pivot.y,o=u,h=0;o.inEdges.length;)o=this._getParentNode(n,o),h+=n._graphNodes[o.name].subTreeTranslation||0;n.orientation=="lefttoright"||n.orientation=="righttoleft"?(n._anchorX-=n._graphNodes[u.name].y,n._anchorY-=n._graphNodes[u.name].x+h):(n._anchorX-=n._graphNodes[u.name].x+h,n._anchorY-=n._graphNodes[u.name].y)}},_updateConnectors:function(n,i,r){var l,s,u,f,c,y,e,v=0,a=0,p=0,w=0,o=0,b=0,h,k,d;if(f=n._graphNodes[i.name],i.outEdges.length)for(l=0;l<i.outEdges.length;l++)if(s=n.diagram.nameTable[i.outEdges[l]],u=n.diagram.nameTable[s.targetNode],s.visible&&!s._visited){if(s._visited=!0,n.getConnectorSegments)e=n.getConnectorSegments(n.diagram,s);else if(f&&f.tree.children.indexOf(s.targetNode)!=-1){var g=i.width?i.width:i._width,nt=i.height?i.height:i._height,tt=u.width?u.width:u._width,it=u.height?u.height:u._height;n.type=="organizationalchart"&&(n.orientation=="toptobottom"||n.orientation=="bottomtotop"?(a=n.orientation=="toptobottom"?nt:-nt,w=n.orientation=="toptobottom"?-it:it,c=n.orientation=="toptobottom"?"bottom":"top",f.tree.assistants.length?(o=Math.abs(u.offsetY+w/2-(i.offsetY+a/2))-n.verticalSpacing/2,e=[{type:"orthogonal",length:o,direction:c}]):f.tree.orientation=="horizontal"&&(s.segments.length==1||f.tree.type=="balanced")?f.tree.type=="balanced"?f.tree.children.length==5&&l>2?(h=f.tree.children[1],isNaN(n._graphNodes[h]._treeWidth)&&(n._graphNodes[h]._treeWidth=n.diagram.nameTable[h].width),k=l==3?n.diagram.nameTable[h].offsetX-n._graphNodes[h]._treeWidth/2-n.horizontalSpacing/2:n.diagram.nameTable[h].offsetX+n._graphNodes[h]._treeWidth/2+n.horizontalSpacing/2,e=[{type:"orthogonal",length:n.verticalSpacing/2,direction:"bottom"},{type:"orthogonal",length:i.offsetX-k,direction:"left"},{type:"orthogonal",length:u.offsetY+w/2-(i.offsetY+a/2)-n.verticalSpacing,direction:"bottom"}]):(d=Math.min(30,n.verticalSpacing/2)*(c=="bottom"?1:-1),o=Math.abs(u.offsetY+w*u.pivot.y-d-(i.offsetY+a*(1-u.pivot.y))),e=[{type:"orthogonal",length:o,direction:c}]):n.diagram._dock(s,n.diagram.nameTable):f.tree.orientation=="horizontal"?e=[{type:"orthogonal"}]:f.tree.enableRouting&&(o=Math.abs(u.offsetY-(i.offsetY+a/2)),e=[{type:"orthogonal",length:o,direction:c}],f.tree.offset<5&&(y=f.tree.type=="left"?"right":"left",o=n.verticalSpacing/4,b=Math.abs(f.tree.offset)+n.horizontalSpacing/2,e=[{type:"orthogonal",length:o,direction:c},{type:"orthogonal",length:b,direction:y}]))):(v=n.orientation=="lefttoright"?g:-g,p=n.orientation=="lefttoright"?-tt:tt,c=n.orientation=="lefttoright"?"right":"left",f.tree.assistants.length?(o=Math.abs(u.offsetX+p/2-(i.offsetX+v/2))-n.verticalSpacing/2,e=[{type:"orthogonal",length:o,direction:c}]):f.tree.orientation=="horizontal"&&(s.segments.length==1||f.tree.type=="balanced")?f.tree.type=="balanced"?f.tree.children.length==5&&l>2?(h=f.tree.children[1],isNaN(n._graphNodes[h]._treeWidth)&&(n._graphNodes[h]._treeWidth=n.diagram.nameTable[h].width),k=l==3?n.diagram.nameTable[h].offsetY-n._graphNodes[h]._treeWidth/2-n.verticalSpacing/2:n.diagram.nameTable[h].offsetY+n._graphNodes[h]._treeWidth/2+n.verticalSpacing/2,e=[{type:"orthogonal",length:n.horizontalSpacing/2,direction:"right"},{type:"orthogonal",length:i.offsetY-k,direction:"top"},{type:"orthogonal",length:u.offsetX+p/2-(i.offsetX+v/2)-n.horizontalSpacing,direction:"right"}]):(d=Math.min(30,n.horizontalSpacing/2)*(c=="right"?1:-1),o=Math.abs(u.offsetX+p*u.pivot.x-d-(i.offsetX+v*(1-u.pivot.x))),e=[{type:"orthogonal",length:o,direction:c}]):n.diagram._dock(s,n.diagram.nameTable):f.tree.orientation=="horizontal"?e=[{type:"orthogonal"}]:(o=Math.abs(u.offsetX-(i.offsetX+v/2)),e=[{type:"orthogonal",length:o,direction:c}],f.tree.offset<5&&(y=f.tree.type=="left"?"bottom":"top",o=n.verticalSpacing/4,b=Math.abs(f.tree.offset)+10,e=[{type:"orthogonal",length:o,direction:c},{type:"orthogonal",length:b,direction:y}]))))}e?n.diagram.updateConnector(s.name,{segments:e}):n.diagram._dock(s,n.diagram.nameTable);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(s,n.diagram);u&&!u.excludeFromLayout&&(u.isExpanded||this._hasChild(n,u))&&this._updateConnectors(n,u,r+1)}if(f&&f.tree.assistants.length)for(l=0;l<f.tree.assistants.length;l++)u=n.diagram.nameTable[f.tree.assistants[l]],s=n.diagram.nameTable[u.inEdges[0]],o=Math.abs(u.offsetY-(i.offsetY+a/2)),e=[{type:"orthogonal",length:o,direction:c}],e&&n.diagram.updateConnector(s.name,{segments:e}),n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(s,n.diagram),(u.isExpanded||this._hasChild(n,u))&&this._updateConnectors(n,u,r+1)},_updateNodes:function(n,i,r,u,f,e){var c,h,v,y,p;i._visited=!0;var l=i.width?i.width:i._width,a=i.height?i.height:i._height,o=i.offsetX,s=i.offsetY;if(i.excludeFromLayout||(o=n._anchorX,s=n._anchorY,n.orientation=="lefttoright"?(o+=n._graphNodes[i.name].y+l/2,s+=n._graphNodes[i.name].x+r+a/2):n.orientation=="righttoleft"?(o-=n._graphNodes[i.name].y+l/2,s+=n._graphNodes[i.name].x+r+a/2):n.orientation=="toptobottom"?(o+=n._graphNodes[i.name].x+r+l/2,s+=n._graphNodes[i.name].y+a/2):(o+=n._graphNodes[i.name].x+r+l/2,s-=n._graphNodes[i.name].y+a/2),n._graphNodes&&(v=n._graphNodes[i.name],v&&(y=v.tree,y.enableRouting||(n.diagram.minSpaceBetweenNode||(n.diagram.minSpaceBetweenNode=[]),n.diagram.minSpaceBetweenNode.push(i.name)))),f=f?f:0,e=e?e:0,o+=f,s+=e,n.updateView?n.diagram._translate(i,o-(i.offsetX||0),s-(i.offsetY||0),n.diagram.nameTable):(u=i.name==n.fixedNode||u,!u&&this._withinView(o,s,l,a,i,n)?(o!=i.offsetX||s!=i.offsetY)&&n.objects.push({object:i.name,diff:o-i.offsetX,diffy:s-i.offsetY}):n.diagram._translate(i,o-(i.offsetX||0),s-(i.offsetY||0),n.diagram.nameTable))),p=[],this._hasChild(n,i))for(h=0;h<n._graphNodes[i.name].tree.children.length;h++)c=n.diagram.nameTable[n._graphNodes[i.name].tree.children[h]],this._updateNodes(n,c,r+(n._graphNodes[i.name].subTreeTranslation||0),u,f,e),p.push(c);if(n._graphNodes[i.name].tree.assistants.length)for(h=0;h<n._graphNodes[i.name].tree.assistants.length;h++)c=n.diagram.nameTable[n._graphNodes[i.name].tree.assistants[h]],this._updateNodes(n,c,r+(n._graphNodes[i.name].subTreeTranslation||0),null,f,e);n.diagram._updateQuad(n.diagram.nameTable[i.name]);n.diagram._setBounds(i);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,n.diagram)},_withinView:function(n,t,i,r,u,f){var e=f.diagram.model.scrollSettings.horizontalOffset/f.diagram.model.scrollSettings.currentZoom,o=f.diagram.model.scrollSettings.verticalOffset/f.diagram.model.scrollSettings.currentZoom,s=f.diagram.model.scrollSettings.viewPortWidth/f.diagram.model.scrollSettings.currentZoom+e,h=f.diagram.model.scrollSettings.viewPortHeight/f.diagram.model.scrollSettings.currentZoom+o;return(n+i/2>e||u.offsetX+i/2>e)&&(n-i/2<s||u.offsetX-i/2<s)&&(t+r/2>o||u.offsetY+r/2>o)&&(t-r/2<h||u.offsetY-r/2<h)?!0:!1},_getDimensions:function(n,t,i,r,u){var f=t.width?t.width:t._width,e=t.height?t.height:t._height,o;return(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(u||(o=i,i=r,r=o),e=t.width?t.width:t._width,f=t.height?t.height:t._height),{x:i,y:r,width:f,height:e}},_getParentNode:function(n,t){if(t.inEdges&&t.inEdges.length)return n.diagram.nameTable[n.diagram.nameTable[t.inEdges[0]].sourceNode]},_hasChild:function(n,t){var t=n._graphNodes[t.name];return t.tree.children&&t.tree.children.length},_setUpLayoutInfo:function(n){var t={};return t.subTreeTranslation=0,n.type=="organizationalchart"?t.tree={orientation:"vertical",type:"alternate",offset:20,enableRouting:!0}:n.type=="hierarchicaltree"&&(t.tree={orientation:"horizontal",type:"center",enableRouting:!0}),t.tree.children=[],t.tree.assistants=[],t.tree.level=0,t.translate=!0,t}};t.datavisualization.Diagram.RadialTreeLayout={doLayout:function(n){var r,i,t;for(r=n.diagram,i=r.nodes(),t=0;t<i.length;t++)i[t].excludeFromLayout||(n._graphNodes[i[t].name]=this._setUpLayoutInfo(n,i[t]),i[t].inEdges&&i[t].inEdges.length||n._firstLevelNodes.push(i[t]));n.rootNode&&r.nameTable[n.rootNode]?n._centerNode=r.nameTable[n.rootNode]:n._firstLevelNodes.length&&(n._centerNode=n._firstLevelNodes[0],r.model.layout.rootNode=n._centerNode.name);n._centerNode&&(this._updateEdges(n,n._centerNode,0),this._depthFirstAllignment(n,n._centerNode,0,0),this._populateLevels(n),this._transformToCircleLayout(n),this._updateAnchor(n),this._updateNodes(n,n._centerNode))},_updateEdges:function(n,t,i){var u=n._graphNodes[t.name],f,r;for(n.layoutNodes.push(u),u.level=i,u.visited=!0,n.maxLevel=Math.max(n.maxLevel,i),f=0;f<t.outEdges.length;f++)r=n.diagram.nameTable[n.diagram.nameTable[t.outEdges[f]].targetNode],r.excludeFromLayout||r.visited||(u.children.push(r),this._updateEdges(n,r,i+1))},_depthFirstAllignment:function(n,t,i,r){var s,u,o,f,e;if(t){if(u=n._graphNodes[t.name],u.children.length){for(r+=300,e=0;e<u.children.length;e++)s=this._depthFirstAllignment(n,u.children[e],i,r),i=s.x,r=s.y;if(u.children=u.children.sort(function(t,i){return n._graphNodes[t.name].x-n._graphNodes[i.name].x}),o=n._graphNodes[u.children[0].name].min,f=n._graphNodes[u.children[u.children.length-1].name].max,u.x=o+(f-o)/2,i=f+n.horizontalSpacing,u.segmentOffset=f+n.horizontalSpacing,u.x-=u.width/2,u.y-=u.height/2,u.min=o,u.max=f,u.x<o&&u.visited){for(u.x=o,i=u.x+u.width/2-(f-o)/2,u.visited=!1,e=0;e<u.children.length;e++)s=this._depthFirstAllignment(n,u.children[e],i,r);u.visited=!0;i=u.x+u.width+n.horizontalSpacing}f=n._graphNodes[u.children[u.children.length-1].name].segmentOffset;i=i<f?f:i;r-=300;u.y=r}else u.x=i,u.y=r,u.min=i,u.max=i+u.width,i+=u.width+n.horizontalSpacing;return{x:i,y:r}}},_populateLevels:function(n){var i=[],e=Math.min.apply(Math,n.layoutNodes.map(function(n){return n.x})),o=Math.max.apply(Math,n.layoutNodes.map(function(t){return t.x+t.width+n.horizontalSpacing})),s=o-e,r,t,u,f;for(n.levels=[],r=0;r<=n.maxLevel;r++){for(i=n.layoutNodes.filter(function(n){if(n.level==r)return n}),t={},i=i.sort(function(n,t){return n.x-t.x}),t.min=i[0].x,t.max=i[i.length-1].x+i[i.length-1].width+n.horizontalSpacing,t._actualCircumference=0,t.height=0,u=0;u<i.length;u++)i[u].height>t.height&&(t.height=i[u].height),t._actualCircumference+=Math.max(i[u].width,i[u].height),u!=i.length-1&&(t._actualCircumference+=n.horizontalSpacing);for(t.circumference=t.max-t.min,t._actualCircumference<t.circumference&&(t.circumference=(t.circumference+t._actualCircumference)/2),t.radius=t.circumference/(2*Math.PI)+t.height,t.nodes=[],r>1&&n.levels[r-1].radius+n.levels[r-1].height>=t.radius&&(t.radius=n.levels[r-1].radius+n.levels[r-1].height),f=0;f<i.length;f++)i[f].ratio=Math.abs(i[f].x+i[f].width/2-e)/s,t.nodes.push(i[f]);n.levels.push(t)}},_transformToCircleLayout:function(n){var u=n._graphNodes[n._centerNode.name],t,r,i;for(u.x=0,u.y=0,t=1;t<n.levels.length;t++)for(r=0;r<n.levels[t].nodes.length;r++)i=n.levels[t].nodes[r],i.x=Math.cos(i.ratio*360*Math.PI/180)*(n.levels[t].radius+n.verticalSpacing*t),i.y=Math.sin(i.ratio*360*Math.PI/180)*(n.levels[t].radius+n.verticalSpacing*t),n._anchorX=Math.min(n._anchorX,i.x),n._anchorY=Math.min(n._anchorY,i.y)},_updateAnchor:function(n){var i=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram);n._centerNode?(n._anchorX=n._centerNode.offsetX||i.width/2,n._anchorY=n._centerNode.offsetY||i.height/2):(n._anchorX=i.width/2,n._anchorY=i.height/2)},_updateNodes:function(n,i){var r=n._graphNodes[i.name],e=r.x+n._anchorX,o=r.y+n._anchorY,u,f;for(n.diagram._translate(i,e-i.offsetX||0,o-i.offsetY||0,n.diagram.nameTable),u=0;u<r.children.length;u++)f=r.children[u],this._updateNodes(n,n.diagram.nameTable[f.name]);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,n.diagram)},_isValidLayout:function(n){if(n._centerNode){var t=Math.max.apply(Math,n.diagram.nodes().map(function(n){return n.inEdges.length}));if(t<2)return!0}return!1},_setUpLayoutInfo:function(n,t){var i={};return i.name=t.name,i.x=0,i.y=0,i.min=0,i.max=0,i.width=t.width?t.width:t._width,i.height=t.height?t.height:t._height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i}};t.datavisualization.Diagram.MultipleParentHierarchicalLayout={doLayout:function(n){var pt,p,ot,h,wt,ii,rt,ut,si,b,bt,ft,ri,f,a,dt,gt,ct,ni,i,s,nt,y,c,r,ti,et,w,v,o,u,yt,l;for(this.diagram=n.diagram,p=this.diagram.nodes(),this.nodes=[],ot={},h=new t.datavisualization.Diagram.LineDistribution(this),h.edgeMapper=[],i=0;i<p.length;i++){for(s=this._createVertex(p[i],p[i].name,0,0,p[i].width,p[i].height),wt=p[i].outEdges.slice(),c=0;c<wt.length;c++)ii=n.diagram.nameTable[wt[c]],h._setEdgeMapper({key:ii,value:[]});this.nodes.push(s);ot[s.name]=s}if(rt=[],this.roots==null&&parent!=null)for(ut=this._findRoots(ot,n),i=0;i<ut.length;i++)b=Object(),rt.push(b),this._traverse(ut[i],!0,null,b,rt,ot);for(si={marginX:0,marginY:0},i=0;i<rt.length;i++){b=rt[i];bt=[];for(w in b)bt.push(b[w]);ft=new t.datavisualization.Diagram.MultiParentModel(this,bt,ut,n);this._cycleStage(ft);this._layeringStage(ft,ut);this._crossingStage(ft);ri=new t.datavisualization.Diagram.MatrixModel({model:ft,matrix:[],rowOffset:[]});h._arrangeElements(ri)}var e=this._getModelBounds(this.nodes),ui=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram,!0),k=(ui.width-e.width)/2-e.x,d=(ui.height-e.height)/2-e.y;k=Math.round(k);d=Math.round(d);f=n.margin||{};f.left=f.left||0;f.right=f.right||0;f.top=f.top||0;f.bottom=f.bottom||0;var hi=n.orientation=="lefttoright"||n.orientation=="righttoleft",fi=hi?n.horizontalSpacing:n.verticalSpacing,kt=[];for(i=0;i<this.nodes.length;i++)if(a=this.nodes[i],a&&!a.source&&!a.target){var g=this.diagram.nameTable[a.name],ei=a.geometry.x+a.geometry.width/2,oi=a.geometry.y+a.geometry.height/2,st=ei,ht=oi;n.orientation==="bottomtotop"?ht=e.height-oi:n.orientation==="righttoleft"&&(st=e.width-ei);st+=f.left;ht+=f.top;st+=k;ht+=d;g!=null&&(this.diagram._translate(g,st-g.offsetX,ht-g.offsetY,n.diagram.nameTable),this.diagram._isInit||t.datavisualization.Diagram.DiagramContext.update(g,this.diagram),(a.inEdges.length>0||a.outEdges.length>0)&&kt.push(g))}if(n.updateView&&!n.avoidSegmentOverlapping)for(dt=n.diagram.connectors(),i=0;i<dt.length;i++)gt=dt[i],n.getConnectorSegments&&(pt=n.getConnectorSegments(n.diagram,gt)),pt&&n.diagram.updateConnector(gt.name,{segments:pt});if(n.avoidSegmentOverlapping)for(ct=[],ni=new t.datavisualization.Diagram.Rectangle(e.x+k,e.y+d,e.width,e.height),i=0;i<kt.length;i++){if(s=kt[i],s.outEdges!=null&&s.outEdges.length>0)for(nt=s.outEdges.length,c=0;c<nt;c++){if(r=n.diagram.nameTable[s.outEdges[c]],r._pointCollection=[],nt>1){var ti=fi/2,et=null,w,y=h._getEdgeMapper();for(v=0;v<y.length;v++)if(y[v].key==r){w=v;break}if(y[w].value.length>0){var lt=y[w].value[0],at=lt.x+f.left,vt=lt.y+f.top,tt=at,it=vt;n.orientation=="bottomtotop"?it=e.height-vt:n.orientation=="righttoleft"&&(tt=e.width-at);tt+=k;it+=d;et=new t.datavisualization.Diagram.Point(tt,it)}for(o=[],u=0;u<r.segments.length;u++){l=r.segments[u].points;for(yt in l)o.push(l[yt])}for(o=h._updateConnectorPoints(o,ti,et,ni),u=0;u<o.length;u++)l=o[u],r._pointCollection.push(new t.datavisualization.Diagram.Point(l.x,l.y));h._resetConnectorPoints(r,n.diagram)}ct.push(r)}if(s.inEdges!=null&&s.inEdges.length>1)for(nt=s.inEdges.length,y=h._getEdgeMapper(),c=0;c<nt;c++)if(r=n.diagram.nameTable[s.inEdges[c]],h._containsValue(ct,r)||(r._pointCollection=[]),nt>1){for(ti=fi/2,et=null,v=0;v<y.length;v++)if(y[v].key==r){w=v;break}if(y[w].value.length>0&&!h._containsValue(ct,r)){var lt=y[v].value[0],at=lt.x+f.left,vt=lt.y+f.top,tt=at,it=vt;n.orientation=="bottomtotop"?it=e.height-vt:n.orientation=="righttoleft"&&(tt=e.width-at);tt+=k;it+=d;et=new t.datavisualization.Diagram.Point(tt,it)}for(o=[],u=0;u<r.segments.length;u++){l=r.segments[u].points;for(yt in l)o.push(l[yt])}for(o.reverse(),o=h._updateConnectorPoints(o,ti,et,ni),o.reverse(),r._pointCollection=[],u=0;u<o.length;u++)l=o[u],r._pointCollection.push(new t.datavisualization.Diagram.Point(l.x,l.y));h._resetConnectorPoints(r,n.diagram)}}},_getModelBounds:function(n){var r,i,u;for(n=n.slice(),r=null,i=null,u=0;u<n.length;u++)r=n[u].geometry,i=i?t.datavisualization.Diagram.Geometry.union(i,r):r;return i},_placementStage:function(n,t,i,r){var u=this._coordinateAssignment(t,i,r,n);return u.model=n,u.widestRankValue=null,this._placementStageExecute(u,r),{marginX:u.marginX+n.layout.horizontalSpacing,marginY:u.marginY+n.layout.verticalSpacing}},_calculateWidestRank:function(n,i,r){var e=!1,h,v,f,u,a,y,p,o,w,b;for((n.model.layout.orientation==="lefttoright"||n.model.layout.orientation==="righttoleft")&&(e=!0),h=-n.verticalSpacing,v=0,n.rankSizes=[],n.rankOffset=[],f=r.maxRank;f>=0;f--){var c=0,l=r.ranks[f],s=e?n.marginY:n.marginX;for(o=0;o<l.length;o++)u=l[o],u.cell&&(u.cell.inEdges||u.cell.outEdges)?(a=t.datavisualization.Diagram.Util.bounds(this.diagram.nameTable[u.cell.name]),a!=null&&(u.width=a.width,u.height=a.height),c=Math.max(c,e?u.width:u.height)):t.datavisualization.Diagram.CrossReduction.prototype._isVertex(u)||(y=1,u.edges!=null&&(y=u.edges.length),u.width=(y-1)*10),e&&(u.height||(u.height=0)),s+=(e?u.height:u.width)/2,this._setXY(u,f,s,e?!0:!1),this._setTempVariable(u,f,s),s+=(e?u.height:u.width)/2+n.horizontalSpacing,s>n.widestRankValue&&(n.widestRankValue=s,n.widestRank=f),n.rankSizes[f]=s;for(n.rankOffset[f]=h,p=c/2+v/2+n.verticalSpacing,v=c,n.orientation=="north"||n.orientation=="west"?h+=p:h-=p,o=0;o<l.length;o++)w=l[o],b=this._getOffset(w,h,c,e?!1:!0),this._setXY(w,f,b,e?!1:!0)}},_getOffset:function(n,t,i,r){return t-(r?(i-n.height)/2:(i-n.width)/2)},_setTempVariable:function(n,i,r){t.datavisualization.Diagram.CrossReduction.prototype._isVertex(n)?n.temp[0]=r:n.temp[i-n.minRank-1]=r},_coordinateAssignment:function(n,t,i,r){var u={};return u.horizontalSpacing=r.layout.horizontalSpacing,u.verticalSpacing=r.layout.verticalSpacing,u.orientation="north",u.marginX=u.marginX=n?n:0,u.marginY=u.marginY=t?t:0,u},_getXY:function(n,i,r){return t.datavisualization.Diagram.CrossReduction.prototype._isVertex(n)?r?n.y[0]:n.x[0]:r?n.y[i-this.minRank-1]:n.x[i-this.minRank-1]},_setXY:function(n,t,i,r){n&&n.cell&&(n.cell.inEdges||n.cell.outEdges?r?n.y[0]=i:n.x[0]=i:r?n.y[t-n.minRank-1]=i:n.x[t-n.minRank-1]=i)},_rankCoordinates:function(n,i,r,u){var e=!1,s,f,h,c,l;(n.model.layout.orientation==="lefttoright"||n.model.layout.orientation==="righttoleft")&&(e=!0);var a=u.ranks[i],v=0,o=(e?n.marginY:n.marginX)+(n.widestRankValue-n.rankSizes[i])/2;for(s=0;s<a.length;s++)f=a[s],t.datavisualization.Diagram.CrossReduction.prototype._isVertex(f)?(h=t.datavisualization.Diagram.Util.bounds(this.diagram.nameTable[f.cell.name]),h!=null&&(f.width=h.width,f.height=h.height),v=Math.max(v,f.height)):t.datavisualization.Diagram.CrossReduction.prototype._isVertex(f)||(c=1,f.edges!=null&&(c=f.edges.length),e?f.height=(c-1)*10:f.width=(c-1)*10),l=(e?f.height:f.width)/2,o+=l,this._setXY(f,i,o,e?!0:!1),this._setTempVariable(f,i,o),o+=l+n.horizontalSpacing},_initialCoords:function(n,t,i){var r;for(this._calculateWidestRank(n,t,i),r=n.widestRank;r>=0;r--)r<i.maxRank&&this._rankCoordinates(n,r,t,i);for(r=n.widestRank+1;r<=i.maxRank;r++)r>0&&this._rankCoordinates(n,r,t,i)},_isAncestor:function(n,t){if(t!=null&&n.hashCode!=null&&t.hashCode!=null&&n.hashCode.length<t.hashCode.length){if(n.hashCode==t.hashCode)return!0;if(n.hashCode==null||n.hashCode==null)return!1;for(var i=0;i<n.hashCode.length;i++)if(n.hashCode[i]!=t.hashCode[i])return!1;return!0}return!1},_weightedCellSorter:function(n,t){var i={};return i.cell=n?n:null,i.weightedValue=t?t:0,i.visited=!1,i.rankIndex=null,i},_minNode:function(n,i){for(var v,d,y,e,o,it,l,st,rt,a,h=[],k={map:{}},c=[],s=0;s<=i.maxRank;s++)for(c[s]=i.ranks[s],v=0;v<c[s].length;v++)d=c[s][v],y=this._weightedCellSorter(d,s),y.rankIndex=v,y.visited=!0,h.push(y),t.datavisualization.Diagram.MultiParentModel.prototype._setDictionary(k,d,y,!0);for(var ht=h.length*10,ut=0,w=1;h.length>0&&ut<=ht;){var p=h.shift(),f=p.cell,r=p.weightedValue,b=parseInt(p.rankIndex),g=t.datavisualization.Diagram.CrossReduction.prototype._getConnectedCellsOnLayer(f,r),nt=t.datavisualization.Diagram.CrossReduction.prototype._getConnectedCellsOnLayer(f,r,!0),ft=g.length,et=nt.length,ct=this._medianXValue(n,g,r+1),lt=this._medianXValue(n,nt,r-1),ot=ft+et,tt=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(f,r),u=tt;ot>0&&(u=(ct*ft+lt*et)/ot);e=!1;o=null;u<tt-w?b==0?(o=u,e=!0):(it=c[r][b-1],l=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(it,r),l=l+it.width/2+n.intraCellSpacing+f.width/2,l<u?(o=u,e=!0):l<t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(f,r)-w&&(o=l,e=!0)):u>tt+w&&(st=c[r].length,b==st-1?(o=u,e=!0):(rt=c[r][b+1],a=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(rt,r),a=a-rt.width/2-n.intraCellSpacing-f.width/2,a>u?(o=u,e=!0):a>t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(f,r)+w&&(o=a,e=!0)));e&&(this._setTempVariable(f,r,o),this._updateNodeList(h,k,g),this._updateNodeList(h,k,nt));t.datavisualization.Diagram.CrossReduction.prototype._isVertex(p.cell)&&(p.visited=!1);ut++}},_updateNodeList:function(n,i,r){for(var e,u,f=0;f<r.length;f++)e=r[f],u=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionary(i,e),u!=null&&u.visited==!1&&(u.visited=!0,n.push(u))},_medianXValue:function(n,i,r){var u,f;if(i.length==0)return 0;for(u=[],f=0;f<i.length;f++)u[f]=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(i[f],r);if(u.sort(function(n,t){return n-t}),i.length%2==1)return u[Math.floor(i.length/2)];var e=i.length/2,o=u[e-1],s=u[e];return(o+s)/2},_placementStageExecute:function(n){var r=!1,i,e,o,u,s,f,h;for((n.model.layout.orientation==="lefttoright"||n.model.layout.orientation==="righttoleft")&&(r=!0),n.jettyPositions=Object(),i=n.model,r?n.currentYDelta=0:n.currentXDelta=0,this._initialCoords(n,{model:i},i),this._minNode(n,i),e=1e8,n.maxIterations||(n.maxIterations=8),o=0;o<n.maxIterations;o++){if((r?n.currentYDelta:n.currentXDelta)<e){for(u=0;u<i.ranks.length;u++)for(s=i.ranks[u],f=0;f<s.length;f++)h=s[f],this._setXY(h,u,t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(h,u),r?!0:!1);e=r?n.currentYDelta:n.currentXDelta}r?n.currentYDelta=0:n.currentXDelta=0}this._setCellLocations(n,i)},_setCellLocations:function(n,t){for(var r=this._getValues(t.vertexMapper),i=0;i<r.length;i++)this._setVertexLocation(n,r[i])},_garphModelsetVertexLocation:function(i,r,u,f){var s=i.model,e=r.geometry,o=null;return e!=null&&(o=new t.datavisualization.Diagram.Rectangle(u,f,e.width,e.height),(e.x!=u||e.y!=f)&&(e=n.extend(!0,{},e),e.x=u,e.y=f,r.geometry=e)),o},_setVertexLocation:function(n,t){var i=!1;(n.model.layout.orientation==="lefttoright"||n.model.layout.orientation==="righttoleft")&&(i=!0);var f=t.cell,r=t.x[0]-t.width/2,u=t.y[0]-t.height/2;this._garphModelsetVertexLocation(n,f,r,u);i?(n.marginY||(n.marginY=null),n.marginY=Math.max(n.marginY,u+t.height)):(n.marginX||(n.marginX=null),n.marginX=Math.max(n.marginX,r+t.width))},_getValues:function(n){var t=[],i;if(n.map)for(i in n.map)t.push(n.map[i]);return t},_createVertex:function(n,i,r,u,f,e){var o=new t.datavisualization.Diagram.Rectangle(r,u,f,e);return o.relative=!0,{value:i,geometry:o,name:i,vertex:!0,inEdges:n.inEdges.slice(),outEdges:n.outEdges.slice()}},_crossingStage:function(n){var i=new t.datavisualization.Diagram.CrossReduction(this);i._execute(n)},_layeringStage:function(n){this._initialRank(n);this._fixRanks(n)},_initialRank:function(n){for(var r=n._startNodes,l=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionaryValues(n.vertexMapper),a=r.slice(),y,i,h,f,e;r.length>0;){var u=r[0],o=u.connectsAsTarget,c=u.connectsAsSource,v=!0,s=1e8;for(i=0;i<o.length;i++)if(f=o[i],f.temp[0]==5270620)e=f.source,s=Math.min(s,e.temp[0]-1);else{v=!1;break}if(v){if(u.temp[0]=s,n.maxRank||(n.maxRank=1e8),n.maxRank=Math.min(n.maxRank,s),c!=null)for(i=0;i<c.length;i++)f=c[i],f.temp[0]=5270620,e=f.target,e.temp[0]==-1&&(r.push(e),e.temp[0]=-2);r.shift()}else if(y=r.shift(),r.push(u),y==u&&r.length==1)break}for(i=0;i<l.length;i++)l[i].temp[0]-=n.maxRank;for(i=0;i<a.length;i++){var u=a[i],p=0,o=u.connectsAsSource;for(h=0;h<o.length;h++)f=o[h],e=f.target,u.temp[0]=Math.max(p,e.temp[0]+1),p=u.temp[0]}n.maxRank=1e8-n.maxRank},_fixRanks:function(n){n._fixRanks()},_cycleStage:function(n){var e={},u,f,r,o,i,s;for(n._startNodes=[],u=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionaryValues(n.vertexMapper),f={},i=0;i<u.length;i++)u[i].temp[0]=-1,f[u[i].id]=u[i];if(window.model=n,window.objLayout=this,r=null,n.roots!=null)for(o=n.roots,r=[],i=0;i<o.length;i++)r[i]=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionary(n.vertexMapper,o[i]),r[i]!=null&&n._startNodes.push(r[i]);n._visit("removeParentConnection",r,!0,null,e,f);s=t.datavisualization.Diagram.MultiParentModel.prototype._clone(e,null,!0);n._visit("removeNodeConnection",f,!0,s,e,f)},_remove:function(n,i){var f=null,u,r;if(typeof i=="object")for(u=t.datavisualization.Diagram.Util.indexOf(i,n);u>=0;)i.splice(u,1),f=n,u=t.datavisualization.Diagram.Util.indexOf(i,n);for(r=0;r<i.length;r++)i[r]==n&&(delete i[r],f=n);return f},_invert:function(n){var t=n.source;n.source=n.target;n.target=t;n.isReversed=!n.isReversed},_traverse:function(n,t,i,r,u,f){var s,o,c,v,l,h,y,w,e,a,p;if(n!=null)if(s=n.name,f==null?!0:f[s]!=null){for(r[s]==null&&(r[s]=n),f!==null&&delete f[s],o=this._getEdges(n),c=[],e=0;e<o.length;e++)c[e]=this._getVisibleTerminal(o[e],!0)==n;for(e=0;e<o.length;e++)if(!t||c[e]){for(v=this._getVisibleTerminal(o[e],!c[e]),l=1,h=0;h<o.length;h++)if(h==e)continue;else y=c[h],w=this._getVisibleTerminal(o[h],!y),w==v&&(y?l++:l--);l>=0&&(r=this._traverse(v,t,o[e],r,u,f))}}else if(r[s]==null)for(e=0;e<u.length;e++)if(a=u[e],a[s]!=null){for(p in a)r[p]=a[p];return u.splice(e,1),r}return r},_findRoots:function(n,t){var i=[],c,f=null,l=-1e5,e,u,v,h;for(e in n){var r=n[e],a=this._getEdges(r),o=0,s=0;for(u=0;u<a.length;u++)v=this._getVisibleTerminal(a[u],!0),v.name==r.name?o++:s++;s==0&&o>0&&i.push(r);h=o-s;h>l&&(l=h,f=r);t.rootNode&&n[e].name===t.rootNode.name&&(c=r)}return i.length==0&&f!=null&&(t&&t.rootNode?i.push(c):i.push(f)),i},_getEdges:function(n){var i=[],t;if(n){for(t=0;n.inEdges.length>0&&t<n.inEdges.length;t++)i.push(this.diagram.nameTable[n.inEdges[t]]);for(t=0;n.outEdges.length>0&&t<n.outEdges.length;t++)this.diagram.nameTable[n.outEdges[t]].visible&&i.push(this.diagram.nameTable[n.outEdges[t]])}return i},_getVisibleTerminal:function(n,t){var r=this.diagram.nameTable[n.targetNode],i;for(t&&(r=this.diagram.nameTable[n.sourceNode]),i=0;i<this.nodes.length;i++)if(this.nodes[i].name===r.name)return this.nodes[i]},_getEdgesBetween:function(n,t,i){var u,f,r,e,o;for(i=i!=null?i:!1,u=this._getEdges(n),f=[],r=0;r<u.length;r++)e=this._getVisibleTerminal(u[r],!0),o=this._getVisibleTerminal(u[r],!1),(e!=n||o!=t)&&(i||e!=t||o!=n)||f.push(u[r]);return f}};i=function(){function i(n,i,r,u){var o,e,l,h,s,c;for(this.roots=r,this.vertexMapper={map:{}},o=[],this.layout=u,this.maxRank=1e8,this._createInternalCells(n,i,o),e=0;e<i.length;e++){for(l=o[e].connectsAsSource,h=0;h<l.length;h++)if(s=l[h],c=s.edges,c!=null&&c.length>0){var v=c[0],a=n._getVisibleTerminal(v,!1),f=this._getDictionary(this.vertexMapper,a);o[e]==f&&(a=n._getVisibleTerminal(v,!0),f=this._getDictionary(this.vertexMapper,a));f!=null&&o[e]!=f&&(s.target=f,f.connectsAsTarget.length==0&&(f.connectsAsTarget=[]),t.datavisualization.Diagram.Util.indexOf(f.connectsAsTarget,s)<0&&f.connectsAsTarget.push(s))}o[e].temp[0]=1}}return i.prototype.dfsCount=0,i.prototype._createInternalCells=function(n,i,r){for(var c,o,s,f,l,e,h,u=0;u<i.length;u++){for(r[u]={x:[],y:[],temp:[],cell:i[u],id:i[u].name,connectsAsTarget:[],connectsAsSource:[],identicalSibilings:null,type:"internalVertex"},this._setDictionary(this.vertexMapper,i[u],r[u]),c=t.datavisualization.Diagram.MultipleParentHierarchicalLayout._getEdges(i[u]),r[u].connectsAsSource=[],o=0;o<c.length;o++)if(s=n._getVisibleTerminal(c[o],!1),s!=i[u]&&(f=n._getEdgesBetween(i[u],s,!1),l=n._getEdgesBetween(i[u],s,!0),f!=null&&f.length>0&&l.length*2>=f.length)){for(e={x:[],y:[],temp:[],edges:f,ids:[],identicalSibilings:null,type:"internalEdge"},h=0;h<f.length;h++)e.ids.push(f[h].name);e.source=r[u];r[u].connectsAsSource||(r[u].connectsAsSource=[]);t.datavisualization.Diagram.Util.indexOf(r[u].connectsAsSource,e)<0&&r[u].connectsAsSource.push(e)}r[u].temp[0]=0}},i.prototype._getType=function(n){return n==="internalVertex"?"internalVertex":"internalEdge"},i.prototype._fixRanks=function(){var i=[],t,r,n,u,f;for(this.ranks=[],n=0;n<this.maxRank+1;n++)i[n]=[],this.ranks[n]=i[n];if(t=null,this.roots!=null)for(r=this.roots,t=[],n=0;n<r.length;n++)u=r[n],f=this._getDictionary(this.vertexMapper,u),t[n]=f;this._visit("updateMinMaxRank",t,!1,null,null,null,i)},i.prototype._updateMinMaxRank=function(n,i,r,u,f,e,o,s){var c,h;if(i.maxRank||i.maxRank==0||(i.maxRank=-1),i.minRank||i.minRank==0||(i.minRank=-1),f==0&&i.maxRank<0&&i.minRank<0&&(s[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=s[i.maxRank].length-1),n!=null&&r!=null&&(c=n.maxRank-i.maxRank,c>1))for(r.maxRank=n.maxRank,r.minRank=i.maxRank,r.temp=[],r.x=[],r.y=[],h=r.minRank+1;h<r.maxRank;h++)s[h].push(r),t.datavisualization.Diagram.MultipleParentHierarchicalLayout._setTempVariable(r,h,s[h].length-1)},i.prototype._setDictionary=function(n,t,i){var r=t.name,u;return r||(r=this._getDictionary(n,t)),u=n.map[r],n.map[r]=i,u},i.prototype._getDictionary=function(n,t){this.multiObjectIdentityCounter||this.multiObjectIdentityCounter==0||(this.multiObjectIdentityCounter=0);var i=t.name;return i?n.map[i]:t.layoutObjectId?n.map[t.layoutObjectId]:(t.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,t.layoutObjectId)},i.prototype._getDictionaryValues=function(n,t){var i=[];for(var t in n.map)i.push(n.map[t]);return i},i.prototype._visit=function(n,t,i,r,u,f,e){var s,o;if(t!=null){for(s=0;s<t.length;s++)o=t[s],o!=null&&(r==null&&(r={}),i?(o.hashCode=[],o.hashCode[0]=this.dfsCount,o.hashCode[1]=s,this._extendedDfs(null,o,null,n,r,o.hashCode,s,0,u,f,e)):this._depthFirstSearch(null,o,null,n,r,0,u,f,e));this.dfsCount++}},i.prototype._depthFirstSearch=function(n,t,i,r,u,f,e,o,s){var c,l,h,a,v;if(t!=null)if(c=t.id,u[c]==null)for(u[c]=t,this._updateConnectionRank(r,n,t,i,f,0,e,o,s),l=t.connectsAsSource.slice(),h=0;h<l.length;h++)a=l[h],v=a.target,this._depthFirstSearch(t,v,a,r,u,f+1,e,o,s);else this._updateConnectionRank(r,n,t,i,f,1,e,o,s)},i.prototype._updateConnectionRank=function(n,t,i,r,u,f,e,o,s){(n==="removeParentConnection"||n==="removeNodeConnection")&&this._removeConnectionEdge(t,i,r,u,f,e,o,s,n==="removeNodeConnection"?!0:!1);n==="updateMinMaxRank"&&this._updateMinMaxRank(t,i,r,u,f,e,o,s)},i.prototype._removeConnectionEdge=function(n,t,i,r,u,f,e,o){window.objLayout._isAncestor(t,n)&&(window.objLayout._invert(i),window.objLayout._remove(i,n.connectsAsSource),o?(t.connectsAsSource.push(i),n.connectsAsTarget.push(i),window.objLayout._remove(i,t.connectsAsTarget)):(n.connectsAsTarget.push(i),window.objLayout._remove(i,t.connectsAsTarget),t.connectsAsSource.push(i)));f[t.id]=t;delete e[t.id]},i.prototype._extendedDfs=function(n,t,i,r,u,f,e,o,s,h,c){var p,a,v,l,y,w;if(t!=null)if(n!=null&&(t.hashCode==null||t.hashCode[0]!=n.hashCode[0])&&(p=n.hashCode.length+1,t.hashCode=n.hashCode.slice(),t.hashCode[p-1]=e),a=t.id,u[a]==null)for(u[a]=t,this._updateConnectionRank(r,n,t,i,o,0,s,h,c),v=t.connectsAsSource.slice(),l=0;l<v.length;l++)y=v[l],w=y.target,this._extendedDfs(t,w,y,r,u,t.hashCode,l,o+1,s,h,c);else this._updateConnectionRank(r,n,t,i,o,1,s,h,c)},i.prototype._clone=function(i,r,u){var e,f;if(u=u!=null?u:!1,i!=null&&typeof i.constructor=="function"){e=new i.constructor;for(f in i)f!="layoutObjectId"&&(r==null||t.datavisualization.Diagram.Util.indexOf(r,f)<0)&&(e[f]=u||typeof i[f]!="object"?i[f]:n.extend(!0,{},i[f]))}return e},i}();t.datavisualization.Diagram.MultiParentModel=i;r=function(){function n(){}return n.prototype._calculateCrossings=function(n){for(var r=n.ranks.length,i=0,t=1;t<r;t++)i+=this._calculateRankCrossing(t,n);return i},n.prototype._getTempVariable=function(n,t){if(n)return this._isVertex(n)?n.temp[0]:n.temp[t-n.minRank-1]},n.prototype._calculateRankCrossing=function(n,t){for(var o,y,p,f,u,w,e,b,r,c=0,l=t.ranks[n],k=t.ranks[n-1],s=[],i=0;i<l.length;i++){var a=l[i],d=this._getTempVariable(a,n),v=this._getConnectedCellsOnLayer(a,n,!0),h=[];for(o=0;o<v.length;o++)y=v[o],p=this._getTempVariable(y,n-1),h.push(p);h.sort(function(n,t){return n-t});s[d]=h}for(f=[],i=0;i<s.length;i++)f=f.concat(s[i]);for(u=1;u<k.length;)u<<=1;for(w=2*u-1,u-=1,e=[],i=0;i<w;++i)e[i]=0;for(i=0;i<f.length;i++)for(b=f[i],r=b+u,++e[r];r>0;)r%2&&(c+=e[r+1]),r=r-1>>1,++e[r];return c},n.prototype._execute=function(n){var u,f,o,s,r,c,h,e,t,i;for(this.nestedBestRanks=[],t=0;t<n.ranks.length;t++)this.nestedBestRanks[t]=n.ranks[t].slice();for(u=0,f=this._calculateCrossings(n),t=0;t<24&&u<2;t++){if(this._weightedMedian(t,n),o=this._calculateCrossings(n),o<f)f=o,u=0;else for(u++,i=0;i<this.nestedBestRanks.length;i++)for(s=n.ranks[i],r=0;r<s.length;r++)c=s[r],this._setTempVariable(c,i,r);if(f==0)break}for(h=[],e=[],t=0;t<n.maxRank+1;t++)e[t]=[],h[t]=e[t];for(t=0;t<this.nestedBestRanks.length;t++)for(i=0;i<this.nestedBestRanks[t].length;i++)e[t].push(this.nestedBestRanks[t][i]);n.ranks=h},n.prototype._isVertex=function(n){return n&&n.cell&&(n.cell.inEdges||n.cell.outEdges)?!0:!1},n.prototype._weightedMedian=function(n,t){var r=n%2==0,i;if(r)for(i=t.maxRank-1;i>=0;i--)this._medianRank(i,r);else for(i=1;i<t.maxRank;i++)this._medianRank(i,r)},n.prototype._getConnectedCellsOnLayer=function(n,t,i){var r="nextLayerConnectedCells",e="connectsAsTarget",f,u;if(i&&(r="previousLayerConnectedCells",e="connectsAsSource"),n){if(this._isVertex(n)){if(n[r]==null)for(n[r]=[],n[r][0]=[],u=0;u<n[e].length;u++)f=n[e][u],f.maxRank==undefined&&(f.maxRank=-1),f.maxRank==-1||(i?f.minRank==t-1:f.maxRank==t+1)?n[r][0].push(i?f.target:f.source):n[r][0].push(f);return n[r][0]}if(n[r]==null)for(n[r]=[],u=0;u<n.temp.length;u++)n[r][u]=[],u==(i?0:n.temp.length-1)?n[r][u].push(i?n.target:n.source):n[r][u].push(n);return n[r][t-n.minRank-1]}},n.prototype._medianValue=function(n,t){for(var e,i=[],r=0,f=0;f<n.length;f++)e=n[f],i[r++]=this._getTempVariable(e,t);if(i.sort(function(n,t){return n-t}),r%2==1)return i[Math.floor(r/2)];if(r==2)return(i[0]+i[1])/2;var u=r/2,o=i[u-1]-i[0],s=i[r-1]-i[u];return(i[u-1]*s+i[u]*o)/(o+s)},n.prototype._setTempVariable=function(n,t,i){n&&(n.temp[0]=i)},n.prototype._medianRank=function(n,t){for(var u,f,h,r,o=this.nestedBestRanks[n].length,e=[],s=[],i=0;i<o;i++)r=this.nestedBestRanks[n][i],u={_medianValue:0,cell:!1},u.cell=r,f=t?this._getConnectedCellsOnLayer(r,n):this._getConnectedCellsOnLayer(r,n,!0),h=t?n+1:n-1,f!=null&&f.length!=0?(u._medianValue=this._medianValue(f,h),e.push(u)):s[this._getTempVariable(r,n)]=!0;for(e.sort(this._compare),i=0;i<o;i++)s[i]==null&&(r=e.shift().cell,this._setTempVariable(r,n,i))},n.prototype._compare=function(n,t){if(n!=null&&t!=null){if(t._medianValue>n._medianValue)return-1;if(t._medianValue<n._medianValue)return 1}return 0},n}();t.datavisualization.Diagram.CrossReduction=r;u=function(){function n(){this.edgeMapper=[]}return n.prototype._setEdgeMapper=function(n){this.edgeMapper.push(n)},n.prototype._getEdgeMapper=function(){return this.edgeMapper},n.prototype._initLineDistribution=function(n){var i="bottom",r="top",u,f,e;if(n.orientation==t.datavisualization.Diagram.LayoutOrientations.BottomToTop?(i="top",r="bottom"):n.orientation==t.datavisualization.Diagram.LayoutOrientations.RightToLeft?(i="left",r="right"):n.orientation==t.datavisualization.Diagram.LayoutOrientations.LeftToRight&&(i="right",r="left"),u=n.diagram._spatialSearch.parentQuad.objects,u.length>0)for(f=0;f<u.length;f++)e=u[f],this._addDynamicPortandDistrrbuteLine(n,e,i,r)},n.prototype._addDynamicPortandDistrrbuteLine=function(n,i,r,u){var k,e,nt,o,f,s;i._ports&&i._ports==null||(i._ports=[]);var tt=i._ports,b=[],d=i.outEdges,g=i.inEdges;for(k in d){var h=n.diagram.nameTable[d[k]],c=t.datavisualization.Diagram.Util.findPortByName(i,h.sourcePort),l=r;c==null&&(c=t.datavisualization.Diagram.Port({}),c.type="internal",i._ports.push(c),n.diagram.updateConnector(h.name,{sourcePort:c.name}));l==null&&(e=h.segments[0].points,l=t.datavisualization.Diagram.Util._getBezierDirection(e[0],e[1]));b.push({port:c,direction:l})}for(k in g){var h=n.diagram.nameTable[g[k]],a=t.datavisualization.Diagram.Util.findPortByName(i,h.targetPort),l=u;a==null&&(a=t.datavisualization.Diagram.Port({}),a.type="internal",i._ports.push(a),n.diagram.updateConnector(h.name,{targetPort:a.name}));l==null&&(e=h.segments[0].points,l=t.datavisualization.Diagram.Util._getBezierDirection(e[e.length-2],e[e.length-1]));b.push({port:a,direction:l})}var v=[],y=[],p=[],w=[];for(nt in b)o=b[nt],o.direction=="top"?v.push(o):o.direction=="left"?y.push(o):o.direction=="bottom"?p.push(o):w.push(o);if(v.length>0)for(f=0;f<v.length;f++)s=v[f].port,s.offset={x:(f+1)*(1/(v.length+1)),y:0};if(p.length>0)for(f=0;f<p.length;f++)s=p[f].port,s.offset={x:(f+1)*(1/(p.length+1)),y:1};if(y.length>0)for(f=0;f<y.length;f++)s=y[f].port,s.offset={x:0,y:(f+1)*(1/(y.length+1))};if(w.length>0)for(f=0;f<w.length;f++)s=w[f].port,s.offset={x:1,y:(f+1)*(1/(w.length+1))}},n.prototype._containsValue=function(n,t){for(var i=0;i<n.length;i++)if(n[i].key==t||n[i]==t)return!0;return!1},n.prototype._distributeLines=function(n){for(var ft,at,vt,yt,et,b,it,pt,ot,d,wt,y,bt,rt,nt,p,tt,gt,v,h,c,ni,i,ht,ct,ti,ii,ri,o,s,w,a,k,f,u,e,ut=n.orientation=="lefttoright"||n.orientation=="righttoleft",ui=ut?n.horizontalSpacing:n.verticalSpacing,kt=ui-18,g=[],lt=[],dt=n.diagram.connectors(),r=0;r<dt.length;r++){ft=dt[r];u=[];for(a in ft.segments){at=ft.segments[a];for(w in at.points)vt=at.points[w],u.length!=0&&t.datavisualization.Diagram.Geometry.isEqualPoint(vt,u[u.length-1])||u.push(vt)}for(yt=[],i=1;i<u.length;i++)b=t.datavisualization.Diagram.ObstacleSegment({startpt:u[i-1],endpt:u[i],id:ft.id}),yt.push(b);if(f={wrapper:ft,segments:yt},et=[],ut)for(a in f.segments)b=f.segments[a],b.orientation=="vertical"&&et.push(b);else for(a in f.segments)b=f.segments[a],b.orientation=="horizontal"&&et.push(b);for(i=0;i<et.length;i++){o=et[i];this._containsValue(g,o.coord)||g.push({key:o.coord,value:[]});for(w in g)if(a=g[w].key,a==o.coord){s=w;break}g[s].value.push(o)}lt.push(f)}for(it=[],k=0;k<g.length;k++){pt=g[k];ot=pt.value;ot.sort(function(n,t){return n.start-t.start});var l=[],s=0,st=Number.MIN_VALUE;for(l.push([]),d=0;d<ot.length;d++)o=ot[d],!(l[s].length>0)||st>=o.start?(l[s].push(o),st=Math.max(st,l[s][l[s].length-1].end)):(s++,l.push([]),l[s].push(o),st=l[s][l[s].length-1].end);for(d=0;d<l.length;d++){for(wt=l[d],y=[],i=0;i<wt.length;i++)p=wt[i],p.start&&y.push(p);for(bt=ut?"bottom":"right",rt=[],i=0;i<y.length;i++)p=y[i],p.direction==bt&&rt.push(p);for(nt=[],i=0;i<y.length;i++)p=y[i],p.direction!=bt&&nt.push(p);if(tt=[],rt.length>0)for(gt=rt[0].start,i=0;i<nt.length;)for(nt[i].end>gt?(tt.push(nt[i]),nt.splice(i,1)):i++,r=0;r<n.diagram.model.connectors.length;r++){for(delete n.diagram.model.connectors[r]._visited,i=0;i<n.diagram.model.connectors.length;i++)delete n.diagram.model.connectors[i]._visited;for(i=0;i<n.diagram.model.nodes.length;i++)delete n.diagram.model.nodes[i]._visited1,delete n.diagram.model.nodes[i]._isRightAdded}if(v=[],v=this._updateSegmentRow(tt,v),h=[],h=this._updateSegmentRow(nt,h),rt.reverse(),h=this._updateSegmentRow(rt,h),!v[v.length-1].length>0&&v.splice(v.length-1,1),!h[h.length-1].length>0&&h.splice(h.length-1,1),c=[],ni=tt.length>0&&(y[0].direction==tt[0].direction||y[y.length-1].direction==tt[tt.length-1].direction),ni){for(c=h,e=0;e<v.length;e++)ht=v[e],c[c.length]=ht;for(i=0;i<n.diagram.model.nodes.length;i++)delete n.diagram.model.nodes[i]._visited1,delete n.diagram.model.nodes[i]._isRightAdded}else for(c=v,e=0;e<h.length;e++)ht=h[e],c[c.length]=ht;if(c.length>1)for(ct=1,(n.orientation=="bottomtotop"||n.orientation=="righttoleft")&&(ct=-1),ti=pt.key-ct*kt/2,ii=kt/c.length,r=0;r<c.length;r++)for(ri=ti+r*ii*ct,e=0;e<c[r].length;e++){o=c[r][e];o.coord=ri;this._containsValue(it,o.coord)||it.push({key:o.coord,value:[]});for(w in it)if(a=it[w].key,a==o.coord){s=w;break}it[s].value.push(o)}}}for(k=0;k<lt.length;k++){for(f=lt[k],u=[],r=0;r<f.segments.length;r++)r==0?u.push(this._getObstacleStartPoint(f.segments[r])):ut?f.segments[r].orientation=="vertical"&&(u[u.length-1]=this._getObstacleStartPoint(f.segments[r])):ut||f.segments[r].orientation=="horizontal"&&(u[u.length-1]=this._getObstacleStartPoint(f.segments[r])),u.push(this._getObstacleEndPoint(f.segments[r]));for(f.wrapper._pointCollection=[],i=0;i<u.length;i++)e=u[i],(i==0||i>0&&!t.datavisualization.Diagram.Geometry.isEqualPoint(e,u[i-1]))&&f.wrapper._pointCollection.push(new t.datavisualization.Diagram.Point(e.x,e.y));this._resetConnectorPoints(f.wrapper,n.diagram);delete f.wrapper._pointCollection}},n.prototype._getObstacleStartPoint=function(n){return n.orientation=="horizontal"?n.direction=="left"?new t.datavisualization.Diagram.Point(n.end,n.coord):new t.datavisualization.Diagram.Point(n.start,n.coord):n.direction=="top"?new t.datavisualization.Diagram.Point(n.coord,n.end):new t.datavisualization.Diagram.Point(n.coord,n.start)},n.prototype._getObstacleEndPoint=function(n){return n.orientation=="horizontal"?n.direction=="left"?new t.datavisualization.Diagram.Point(n.start,n.coord):new t.datavisualization.Diagram.Point(n.end,n.coord):n.direction=="top"?new t.datavisualization.Diagram.Point(n.coord,n.start):new t.datavisualization.Diagram.Point(n.coord,n.end)},n.prototype._updateSegmentRow=function(n,t){var i=0,r,u;for(t.length>0||(t[0]=[]),r=0;r<n.length;r++)for(u=n[r];i<t.length;){if(i==t.length-1&&(t[i+1]=[]),!(t[i].length>0)||t[i][t[i].length-1].end<u.start){t[i].push(u);break}i++}return t},n.prototype._resetConnectorPoints=function(n,i){var r,s,f,u;if(n._pointCollection&&n._pointCollection.length>0){for(r=n,r.segments=[],r.sourcePoint=n._pointCollection[0],r.targetPoint=n._pointCollection[n._pointCollection.length-1],s=[],f=[],u=0;u<n._pointCollection.length-1;u++){var e=n._pointCollection[u],o=n._pointCollection[u+1],h=t.datavisualization.Diagram.Geometry.distance(e,o),c=t.datavisualization.Diagram.Util._getBezierDirection(e,o);f.push({length:h,direction:c,type:"orthogonal"})}i.updateConnector(r.name,{segments:f})}},n.prototype._updateConnectorPoints=function(n,i,r,u){var k=this.orientation=="lefttoright"||this.orientation=="righttoleft",f=n,v,w,l,o,s,h,y,p,e;if(f.length>2&&(v=t.datavisualization.Diagram.Geometry.transform(f[0],t.datavisualization.Diagram.Util.findAngle(f[0],f[1]),i),w=t.datavisualization.Diagram.Geometry.transform(v,t.datavisualization.Diagram.Util.findAngle(f[1],f[2]),t.datavisualization.Diagram.Util.findLength(f[1],f[2])),f.splice(1,2,v,w),r!=null)){var b=2,a=f.length,c=t.datavisualization.Diagram.Geometry.transform(f[a-1],t.datavisualization.Diagram.Util.findAngle(f[a-1],f[a-2]),i);for(f.splice(a-1,0,c);b<f.length-2;)f.splice(b,1);l=r;t.datavisualization.Diagram.Geometry.inflate(u,u.width,u.height);o=[];o[0]=new t.datavisualization.Diagram.Point(l.x,u.y);o[1]=new t.datavisualization.Diagram.Point(l.x,u.y+u.height);s=[];s[0]=new t.datavisualization.Diagram.Point(u.x,f[1].y);s[1]=new t.datavisualization.Diagram.Point(u.x+u.width,f[1].y);h=[];h[0]=new t.datavisualization.Diagram.Point(u.x,c.y);h[1]=new t.datavisualization.Diagram.Point(u.x+u.width,c.y);k&&(o[0]=new t.datavisualization.Diagram.Point(u.x,l.y),o[1]=new t.datavisualization.Diagram.Point(u.x+u.width,l.y),s[0]=new t.datavisualization.Diagram.Point(f[1].x,u.y),s[1]=new t.datavisualization.Diagram.Point(f[1].x,u.y+u.height),h[0]=new t.datavisualization.Diagram.Point(c.x,u.y),s[1]=new t.datavisualization.Diagram.Point(c.x,u.y+u.height));y=[t.datavisualization.Diagram.Util.interSect2(o[0],o[1],s[0],s[1])];p=[t.datavisualization.Diagram.Util.interSect2(o[0],o[1],h[0],h[1])];p.length>0&&f.splice(2,0,p[0]);y.length>0&&f.splice(2,0,y[0])}for(e=1;e<f.length-1;)t.datavisualization.Diagram.Geometry.isEqualPoint(f[e-1],f[e])?f.splice(e,1):t.datavisualization.Diagram.Util.findAngle(f[e-1],f[e])==t.datavisualization.Diagram.Util.findAngle(f[e],f[e+1])?f.splice(e,1):e++;return f},n.prototype._updateMutualSharing=function(n,t){n.identicalSibilings!=null?n.identicalSibilings.push(t):(n.identicalSibilings=[],n.identicalSibilings.push(t))},n.prototype._groupLayoutCells=function(n){for(var i,o,f,c,s,h,l,p,r,w,e=n.model.ranks,u=e.length-1;u>=0;u--){for(i=[],o=0;o<e[u].length;o++)s=e[u][o],h=t.datavisualization.Diagram.MultiParentModel.prototype._getType(s.type),h==="internalVertex"&&i.push(e[u][o]);for(f=[],c=0;c<e[u].length;c++)s=e[u][c],h=t.datavisualization.Diagram.MultiParentModel.prototype._getType(s.type),h==="internalEdge"&&f.push(s);while(i.length>1){for(var a=i[0],k=this._selectIds(a.connectsAsTarget,!0),d=this._selectIds(a.connectsAsSource,!1);i.length>1;){var v=i[1],g=this._selectIds(v.connectsAsTarget,!0),nt=this._selectIds(v.connectsAsSource,!1),tt=this._compareLists(k,g),it=this._compareLists(d,nt);if(tt&&it){this._updateMutualSharing(i[0],v.id);this._updateMutualSharing(i[1],a.id);i.splice(1,1);continue}break}i.splice(0,1)}while(f.length>1){var y=f[0],b=y.source,rt=y.target;if(b.identicalSibilings!=null){for(l=[],r=0;r<f.length;r++)p=f[r],p.target==rt&&l.push(p);for(r=0;r<l.length;r++)w=l[r],this._containsValue(b.identicalSibilings,w.source.id)&&(w.source.identicalSibilings=null);y.source.identicalSibilings=null}f.splice(0,1)}}},n.prototype._selectIds=function(n,t){for(var u,i=[],r=0;r<n.length;r++)u=n[r],t?i.push(u.source.id):i.push(u.target.id);return i},n.prototype._createMatrixCells=function(n){for(var tt,y,i,u,p,b,k,r,h,ht,ut,ft,l,ct,e,a,o,s,w=n.model.layout,d=w.orientation=="lefttoright"||w.orientation=="righttoleft",et=d?w.verticalSpacing:w.horizontalSpacing,it=d?w.horizontalSpacing:w.verticalSpacing,rt=n.model.ranks,v=[],ot=-it,g=rt.length-1;g>=0;g--){var nt=0,c=rt.length-1-g,f=rt[g].slice(),st=[];for(n.matrix.push({key:c,value:st}),tt=[],v.push({index:c,value:tt});f.length>0;)if(y=f[0],i=t.datavisualization.Diagram.MatrixCellGroup({level:c,parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],cells:[],size:0,offset:0,initialOffset:0}),st.push(i),p=t.datavisualization.Diagram.MultiParentModel.prototype._getType(y.type),p==="internalVertex"){if(i.cells.push(y),y.identicalSibilings!=null)for(r=0;r<f.length;r++)if(u=f[r],p=t.datavisualization.Diagram.MultiParentModel.prototype._getType(u.type),p==="internalVertex"&&this._containsValue(y.identicalSibilings,u.id)&&(i.cells.push(u),i.cells.length>y.identicalSibilings.length))break;for(r=0;r<i.cells.length;r++)if(u=i.cells[r],p=t.datavisualization.Diagram.MultiParentModel.prototype._getType(u.type),p==="internalVertex"){if(b=u.cell.geometry,i.size+=d?b.height:b.width,nt=Math.max(nt,d?b.width:b.height),tt.push({key:u.id,value:i}),u.connectsAsTarget.length>0)for(l=0;l<u.connectsAsTarget.length;l++)if(k=u.connectsAsTarget[l],e=null,this._containsValue(v[c-1].value,k.ids)?e=k.ids:this._containsValue(v[c-1].value,k.source.id)&&(e=k.source.id),e!=null){for(a=v[c-1].value,s=0;s<a.length;s++)if(a[s].key==e){o=a[s].value;break}this._containsValue(i.parents,o)||i.parents.push(o);this._containsValue(o.children,i)||o.children.push(i)}f.reverse();f.pop();f.reverse()}i.size+=(i.cells.length-1)*et}else if(p==="internalEdge"){for(i.cells.push(y),r=0;r<i.cells.length;r++){if(h=i.cells[r],ht=t.datavisualization.Diagram.MultiParentModel.prototype._getType(h.type),ht==="internalEdge"&&h.edges!=null){for(ut=5,ft=-ut,l=0;l<h.edges.length;l++)ct=h.edges[l],ft+=1+ut;i.size+=ft}if(tt.push({key:h.ids,value:i}),e=null,this._containsValue(v[c-1].value,h.ids)?e=h.ids:this._containsValue(v[c-1].value,h.source.id)&&(e=h.source.id),e!=null){for(a=v[c-1].value,s=0;s<a.length;s++)if(a[s].key==e){o=a[s].value;break}this._containsValue(i.parents,o)||i.parents.push(o);this._containsValue(o.children,i)||o.children.push(i)}f.reverse();f.pop();f.reverse()}i.size+=(i.cells.length-1)*et}n.rowOffset.push(ot+nt/2+it);ot+=nt+it}},n.prototype._setXYforMatrixCell=function(n){for(var w,c,i,u,l,k,d,e,o,y,ut,f,g,nt,ft,r,s=n.model.layout,h=s.orientation=="lefttoright"||s.orientation=="righttoleft",tt=h?s.verticalSpacing:s.horizontalSpacing,p=0;p<n.matrix.length;p++)for(w=n.matrix[p].value,c=0;c<w.length;c++)for(i=w[c],u=i.offset-i.size/2,l=0;l<i.cells.length;l++)if(e=i.cells[l],o=t.datavisualization.Diagram.MultiParentModel.prototype._getType(e.type),o==="internalVertex"){var b=e,a=b.cell.geometry.width,v=b.cell.geometry.height;b.cell.geometry=h?new t.datavisualization.Diagram.Rectangle(n.rowOffset[i.level]-a/2,u,a,v):new t.datavisualization.Diagram.Rectangle(u,n.rowOffset[i.level]-v/2,a,v);u+=(h?v:a)+tt}else if(o==="internalEdge"){var it=e,rt=i.visitedParents[0],et=!1;for(r=0;r<rt.visitedChildren.length;r++){for(k=rt.visitedChildren[r],d=[],f=0;f<k.cells.length;f++)e=k.cells[f],o=t.datavisualization.Diagram.MultiParentModel.prototype._getType(e.type),o==="internalVertex"&&d.push(e);if(d.length>0){et=!0;break}}for(y=1,ut=5,f=0;f<it.edges.length;f++){if(g=it.edges[f],nt=new t.datavisualization.Diagram.Point(u+y/2,n.rowOffset[i.Level]),h&&(nt=new t.datavisualization.Diagram.Point(n.rowOffset[i.level],u+y/2)),this._containsValue(this._getEdgeMapper(),g)){for(r=0;r<this._getEdgeMapper().length;r++)if(this._getEdgeMapper()[r].key==g){ft=r;break}this._getEdgeMapper()[ft].value.push(nt)}u+=y+ut}u+=tt}},n.prototype._arrangeElements=function(n){var f=n.model.layout,p=f.orientation==t.datavisualization.Diagram.LayoutOrientations.LeftToRight||f.orientation==t.datavisualization.Diagram.LayoutOrientations.RightToLeft,g=p?f.verticalSpacing:f.horizontalSpacing,nt=p?f.horizontalSpacing:f.verticalSpacing,w,s,v,u,b,h,y,r,i;for(this._groupLayoutCells(n),this._createMatrixCells(n),u=0;u<n.matrix.length;u++)for(w=n.matrix[u].key,s=n.matrix[w].value,r=1;r<s.length;r++)i=s[r],v=s[r-1],i.offset+=v.offset+v.size/2+g+i.size/2;for(u=0;u<n.matrix[0].value.length;u++)b=n.matrix[0].value[u],this._arrangeMatrix(b,null,n);for(h=0;h<n.matrix.length;h++)for(y=n.matrix[h].value,r=0;r<y.length;r++)if(i=y[r],i.visitedParents.length>1){var e=i.visitedParents[0],o=i.visitedParents[i.visitedParents.length-1],c=this._findParentVertexCellGroup(e),k=this._findParentVertexCellGroup(o);e!=c&&c.offset<e.offset&&(e=c);o!=k&&k.offset>o.offset&&(o=c);var l=(e.offset+o.offset)/2,a=i.initialOffset,d=i.offset;d==a||(l>=a&&l<=d?this._translateMatrixCells(l-i.offset,i):l<a&&this._translateMatrixCells(a-i.offset,i))}this._setXYforMatrixCell(n)},n.prototype._findParentVertexCellGroup=function(n){return n.cells[0]?n:n.parents.length>0?this._findParentVertexCellGroup(n.parents[0]):n},n.prototype._translateMatrixCells=function(n,t){var i,r;if(!(n==0)&&(t.offset+=n,t.visitedChildren.length>0))for(i=0;i<t.visitedChildren.length;i++)r=t.visitedChildren[i],this._translateMatrixCells(n,r)},n.prototype._arrangeMatrix=function(n,t,i){var u=i.model.layout,w=u.orientation=="lefttoright"||u.orientation=="righttoleft",b=w?u.verticalSpacing:u.horizontalSpacing,k=i.matrix,f=k[n.level].value,e=f.indexOf(n),v,h,c,o,l,r,y;if(n.visitedParents.length>0&&(n.visitedParents.length==1&&(n.initialOffset=n.offset),e+1<f.length&&(v=f[e+1],v.visitedParents.length>0&&!this._containsValue(n.visitedParents,t)))){n.visitedParents.push(t);t.ignoredChildren.push(n);return}if(n.children.length>0){for(r=0;r<n.children.length;r++)o=n.children[r],this._containsValue(n.visitedChildren,o)||(this._arrangeMatrix(o,n,i),n.visitedChildren.push(o));if(n.visitedChildren.length>0){for(l=n.visitedChildren.slice(),r=0;r<n.ignoredChildren.length;r++)y=n.ignoredChildren[r],l.splice(r,1,y);if(l.length>0){var a=n.visitedChildren[0],p=n.visitedChildren[n.visitedChildren.length-1],d=a.offset-a.size/2,g=p.offset+p.size/2,s=(d+g)/2;s<n.offset?this._shiftMatrixCells(n.offset-s,a,!0,n,i):s>n.offset&&this._shiftMatrixCells(s-n.offset,n,!1,null,i)}}}else h=n.offset,e>0&&(c=f[e-1],h=c.offset+c.size/2+b+n.size/2),this._shiftMatrixCells(h-n.offset,n,!1,null,i);this._containsValue(n.visitedParents,t)||n.visitedParents.push(t)},n.prototype._shiftMatrixCells=function(n,t,i,r,u){var f,o,s;if(!(n==0)){var c=u.matrix,e=c[t.level].value,h=e.indexOf(t);for(f=h;f<e.length;f++)e[f].offset+=n;if(i)if(t.visitedChildren.length>0)this._shiftMatrixCells(n,t.visitedChildren[0],!0,t,u);else{for(f=1,o=null;h+f<e.length;){if(s=e[h+f],r!=null&&this._containsValue(s.visitedParents,r))if(s.visitedChildren.length>0)o=s;else{f++;continue}break}o!=null&&this._shiftMatrixCells(n,o.visitedChildren[0],!0,o,u)}}},n.prototype._compareLists=function(n,t){var r=n.slice(),f=t.slice(),e,i,o,u;if(r.length==f.length){if(r.length==0)return!0;for(e=!0,i=0;i<f.length;i++)for(o=f[i],u=i;u<r.length;u++)if(!(r[u]==o)){e=!1;break}return e}return!1},n}();t.datavisualization.Diagram.LineDistribution=u;t.datavisualization.Diagram.ConnectorObstacleDefaults={wrapper:null,segments:[]};t.datavisualization.Diagram.ConnectorObstacle=function(i){return i.wrapper=i.wrapper,i.segments=i.segments,n.extend(!1,{},t.datavisualization.Diagram.ConnectorObstacleDefaults,i)};t.datavisualization.Diagram.ObstacleSegmentDefaults={start:Number,end:Number,coord:Number,direction:null,distance:Number,orientation:null,id:Number,startpoint:t.datavisualization.Diagram.Point,endpoint:t.datavisualization.Diagram.Point};t.datavisualization.Diagram.ObstacleSegment=function(i){return i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i.startpt,i.endpt),i.distance=t.datavisualization.Diagram.Util.findLength(i.startpt,i.endpt),i.orientation=i.direction=="left"||i.direction=="right"?"horizontal":"vertical",i.id=i.id,i.orientation=="horizontal"?(i.coord=i.startpt.y,i.direction=="left"?(i.start=i.endpt.x,i.end=i.startpt.x):(i.start=i.startpt.x,i.end=i.endpt.x)):(i.coord=i.startpt.x,i.direction=="top"?(i.start=i.endpt.y,i.end=i.startpt.y):(i.start=i.startpt.y,i.end=i.endpt.y)),n.extend(!1,{},t.datavisualization.Diagram.ObstacleSegmentDefaults,i)};t.datavisualization.Diagram.MatrixModelDefaults={model:null,matrix:[],rowOffset:[]};t.datavisualization.Diagram.MatrixModel=function(i){return i.model=i.model,i.matrix=i.matrix||[],i.rowOffset=i.rowOffset||[],n.extend(!1,{},t.datavisualization.Diagram.MatrixModelDefaults,i)};t.datavisualization.Diagram.MatrixCellGroupDefaults={parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],cells:[],size:Number,offset:Number,level:Number,initialOffset:Number};t.datavisualization.Diagram.MatrixCellGroup=function(i){return i.level=i.level,i.parents=i.parents,i.children=i.children,i.visitedChildren=i.visitedChildren,i.visitedParents=i.visitedParents,i.ignoredChildren=i.ignoredChildren,i.cells=i.cells,i.offset=i.offset,i.initialOffset=i.initialOffset,n.extend(!1,{},t.datavisualization.Diagram.MatrixCellGroupDefaults,i)}}(jQuery,Syncfusion);var SizeF=function(){function n(n,t){this.width=n;this.height=t}return n}(),GraphForceNode=function(){function n(n){this.m_fVelocityX=0;this.m_fVelocityY=0;this.nodes=[];this.velocityX=this.m_fVelocityX;this.velocityY=this.m_fVelocityY;this.graphNode=n;var t=ej.datavisualization.Diagram.Util.bounds(n);this.location=t._center;this.nodes=[];n._parents||(n._parents=[]);n._children||(n._children=[]);this.nodes=n._parents.concat(n._children)}return n.prototype.ApplyChanges=function(){this.graphNode._center=this.location},n}(),SymmetricLayoutManager=function(){function n(t){this.m_szMaxForceVelocity=new SizeF(n.c_fMAX_VELOCITY,n.c_fMAX_VELOCITY);this.m_fVertexDistance=0;this.m_dSpringFactor=n.c_dCOEF;this.m_nMaxIteraction=n.c_nMAX_ITERACTION;this.SpringLength=this.m_fVertexDistance;this.SpringFactor=this.m_dSpringFactor;this.MaxIteraction=this.m_nMaxIteraction;this.selectedNode=this.m_objSelectedNode;this.m_fVertexDistance=t.model.layout.springLength;this.m_dSpringFactor=t.model.layout.springFactor;this.m_nMaxIteraction=t.model.layout.maxIteration}return n.prototype.doGraphLayout=function(n){var r=this.selectedNode,u,f;this.diagram=n.diagram;r.Bounds=n._getModelBounds(this.diagram.nodes());var e=r.GraphNodes,t=this._convertGraphNodes(e),i=t.length;for(i=Math.min(this.m_nMaxIteraction,i*i*i),this._preLayoutNodes(t,r.Bounds),u=0,f=i;u<f;u++)this._makeSymmetricLayout(t),this._appendForces(t);this._resetGraphPosition(t,r)},n.prototype._preLayoutNodes=function(n,t){for(var o,s,i=Math.max(t?t.width:25,t?t.height:25),f={x:i/2,y:i/2},e=2*Math.PI/n.length,r=e,u=0;u<n.length;u++)o=n[u],s=this._getForceNode(o),s.location={x:f.x+i*Number(Math.cos(r).toFixed(2)),y:f.y+i*Number(Math.sin(r).toFixed(2))},r-=e},n.prototype.DoLayout=function(n){this.selectedNode=n.selectedNode;this.doGraphLayout(n)},n.prototype._collectionContains=function(n,t){for(var i=0;i<t.length;i++)if(t[i].name===n)return!0},n.prototype._makeSymmetricLayout=function(n){for(var h,t,f,r,e,o,i,u,c,s=0;s<n.length;s++){for(h=n[s],u=this._getForceNode(h),t=u.nodes,f=0;f<t.length;f++)i=t[f],this._collectionContains(i.name,n)&&this._calcNodesForce(u,this._getForceNode(i));for(r=0,e=t.length;r<e;r++){if(e<2)break;var l=this._getForceNode(t[r]),a=r+1>=e?this._getForceNode(t[0]):this._getForceNode(t[r+1]),v=180/t.length*Math.PI/180,y=2*this.m_fVertexDistance*Math.sin(v);this._calcRelatesForce(l,a,y)}for(o=0;o<n.length;o++)i=n[o],this._collectionContains(i.name,t)||i.name===h.name||(c=this._getForceNode(i),this._updateNeigbour(u,c))}},n.prototype._appendForces=function(n){for(var u,i,t=null,r=0;r<n.length;r++)u=n[r],t=this._getForceNode(u),i=t.location,i.x+=Math.min(t.velocityX,this.m_szMaxForceVelocity.width),i.y+=Math.min(t.velocityY,this.m_szMaxForceVelocity.height),t.velocityX=0,t.velocityY=0,t.location=i},n.prototype._resetGraphPosition=function(n,t){for(var e,u,f=new SizeF(Number.MAX_VALUE,Number.MAX_VALUE),i=null,r=0;r<n.length;r++)e=n[r],i=this._getForceNode(e),u={x:i.location.x-e.width/2,y:i.location.y-e.height/2},f.width=Math.min(f.width,u.x),f.height=Math.min(f.height,u.y);for(r=0;r<n.length;r++)e=n[r],i=this._getForceNode(e),u=i.location,u.x-=f.width-t.location?t.location.x:0,u.y-=f.height-t.location?t.location.y:0,i.location=u,i.ApplyChanges()},n.prototype._convertGraphNodes=function(n){var r=[],i,t,u;for(i in n)n[i]&&(t=n[i],u=new GraphForceNode(t),t._tag=u,r.push(t));return r},n.prototype._getForceNode=function(n){return n._tag},n.prototype._updateNeigbour=function(n,t){if(t!=null&&n!=null){var i=this._pointDistance(n.location,t.location),u=this._lineAngle(n.location,t.location),r=this.m_fVertexDistance*.9;i<r&&this._calcForce(i,r,u,t)}},n.prototype._lineAngle=function(n,t){var i=0,r=t.x-n.x,u=t.y-n.y;return r===0?i=u<=0?3*Math.PI/2:Math.PI/2:u===0?i=r<0?Math.PI:0:(i=Math.atan(u/r),r<0&&u>0?i=Math.PI+i:r<0&&u<0?i=Math.PI+i:r>0&&u<0&&(i=2*Math.PI+i)),i},n.prototype._pointDistance=function(n,t){var i=0,r=t.x-n.x,u=t.y-n.y,f=r*r+u*u;return f>0&&(i=Math.sqrt(f)),i},n.prototype._calcRelatesForce=function(n,t,i){var r=this._pointDistance(n.location,t.location),u=this._lineAngle(n.location,t.location);r<i&&this._calcForce(r,i,u,t)},n.prototype._calcNodesForce=function(n,t){var i=this._pointDistance(n.location,t.location),r=this._lineAngle(n.location,t.location);(i>this.m_fVertexDistance||i<this.m_fVertexDistance)&&this._calcForce(i,this.m_fVertexDistance,r,t)},n.prototype._calcForce=function(n,t,i,r){var u=r.nodes.length,f=n-t,o=this.m_dSpringFactor/(u*u)*Math.sqrt(u);if(f!==0){var s=f*o,e=s,h=Math.cos(i)*e,c=Math.sin(i)*e;r.velocityX-=h;r.velocityY-=c}},n.c_dCOEF=.442,n.c_fMAX_VELOCITY=50,n.c_nMAX_ITERACTION=1e3,n.c_nSPRING_LENGTH=100,n}(),GraphLayoutManager=function(){function n(){this.visitedStack=[];this.cycleEdgesCollection=[];this.passedNodes={}}return n.prototype.updateLayout=function(n,t){var o,f,r,e,s,h,c;for(this.diagram=n,o=n.nodes(),o.length>0&&(this.m_helperSelectedNode=$.extend(!0,{},o[0])),f=[],r=0;r<n.nodes().length;r++)f.push(n.nodes()[r]);for(r=0;r<n.connectors().length;r++)f.push(n.connectors()[r]);for(this._updateLayout1(f,t),e=this._getModelBounds(n.nodes()),s=ej.datavisualization.Diagram.ScrollUtil._viewPort(n,!0),r=0;r<n.nodes().length;r++){var i=n.nodes()[r],l=(s.width-e.width)/2,u=n.model.layout.margin||{};u.left=u.left||0;u.right=u.right||0;u.top=u.top||0;u.bottom=u.bottom||0;n.model.layout.marginX&&(u.left=n.model.layout.marginX);n.model.layout.marginY&&(u.top=n.model.layout.marginY);h=i._tag.location.x-(i.offsetX-i.width/2)-e.x+l+u.left;c=i._tag.location.y-(i.offsetY-i.height/2)-e.y+u.top;this.diagram._translate(i,h,c,n.nameTable);delete i._tag;delete i._center;delete i._children;delete i._isCycleEdge;delete i._parents;this.diagram._isInit||ej.datavisualization.Diagram.DiagramContext.update(i,this.diagram)}return},n.prototype._getModelBounds=function(n){var r,i,t,u,f;for(n=n.slice(),r=null,i=null,u=0;u<n.length;u++)t=n[u],f=ej.datavisualization.Diagram.Util.bounds(t),r={x:t._tag?t._tag.location.x:f.x,y:t._tag?t._tag.location.y:f.y,width:t.width,height:t.height},i=i?ej.datavisualization.Diagram.Geometry.union(i,r):r;return i},n.prototype._updateLayout1=function(n,t){var f,u,i;if(this._detectCyclesInGraph(n),f=n.length,f>0){var e=[],r=[],o=[];for(u=0;u<n.length;u++)i=n[u],i._isCycleEdge===undefined&&(i._isCycleEdge=!1),i.segments&&!i._isCycleEdge?r.push(i):i.segments?e.push(i):o.push(i);for(r=r.concat(o),r=e.concat(r);f>this._dictionaryLength(this.passedNodes);)(this._getNodesToPosition(r),this.selectedNode!=null)&&(t.DoLayout(this),this.selectedNode=null,this.visitedStack=[],this.cycleEdgesCollection.forEach(function(n){n._isCycleEdge=!1}));this.passedNodes=null;this.selectedNode=null}return!1},n.prototype._getNodesToPosition=function(n){for(var i,t=0;t<n.length;t++)if(i=n[t],!this._collectionContains(i.name,this.passedNodes)){i&&this._selectNodes(i);break}},n.prototype._selectNodes=function(n){var t=n;n.segments?this._exploreGraphEdge(n):t!=null&&this._addNode(n,"passed")&&(this._addNode(n,"selected"),this._isConnectedToAnotherNode(t)?(this.selectedNode={},this.selectedNode.LeftMargin=10,this.selectedNode.TopMargin=10,this._selectConnectedNodes(t)):this.selectedNode=n)},n.prototype._selectConnectedNodes=function(n){var i=this.selectedNode,t,u,f,r;i.GraphNodes||(i.GraphNodes={});t=n;t!=null&&this._addNode(t,"passed")&&(u=t.name,this._dictionaryContains(i.GraphNodes,t)?(r=i.GraphNodes[u],r.Added&&(r.Added=!1,this._getConnectedRelatives(r),this._exploreRelatives(n))):(f=this._addGraphNode(t),this._getConnectedRelatives(f),this._exploreRelatives(n)))},n.prototype._exploreRelatives=function(n){this._exploreRelatives1(n,"Parents");this._exploreRelatives1(n,"Children")},n.prototype._exploreRelatives1=function(n,t){var r=[],u,i,f,e;for(t==="Parents"?r=n.inEdges:t==="Children"&&(r=n.outEdges),u=0;u<r.length;u++)i=this.diagram.nameTable[r[u]],this._addNode(i,"passed")&&(f=this.diagram.nameTable[i.sourceNode],e=this.diagram.nameTable[i.targetNode],t==="Parents"&&f!=null&&this._collectionContains(f.name,this.diagram.nodes())?this._selectConnectedNodes(this.diagram.nameTable[i.sourceNode]):t==="Children"&&e!=null&&this._collectionContains(e.name,this.diagram.nodes())&&this._selectConnectedNodes(this.diagram.nameTable[i.targetNode]))},n.prototype._getConnectedRelatives=function(n){this._getConnectedParents(n);this._getConnectedChildren(n)},n.prototype._dictionaryContains=function(n,t){for(var r=Object.keys(n),i=0;i<r.length;i++)if(n[r[i]].name===t.name)return!0;return!1},n.prototype._dictionaryLength=function(n){var t=Object.keys(n);return t.length},n.prototype._getConnectedChildren=function(n){for(var u,i,t,f=this.selectedNode,e=n,r=0;r<e.outEdges.length;r++)u=this.diagram.nameTable[e.outEdges[r]],u._isCycleEdge||(i=this.diagram.nameTable[u.targetNode],this._collectionContains(i.name,this.diagram.nodes())&&i!=null&&i.visible&&(this._dictionaryContains(f.GraphNodes,i)?t=f.GraphNodes[i.name]:(t=this._addGraphNode(i),t.Added=!0),n._children||(n._children=[]),t._parents||(t._parents=[]),this._setNode(t._parents,n),this._findNode(n._children,t.name)<0&&n._children.push(t)))},n.prototype._getConnectedParents=function(n){for(var u,i,t,f=this.selectedNode,e=n,r=0;r<e.inEdges.length;r++)u=this.diagram.nameTable[e.inEdges[r]],u._isCycleEdge||(i=this.diagram.nameTable[u.sourceNode],this._collectionContains(i.name,this.diagram.nodes())&&i!=null&&i.visible&&(this._dictionaryContains(f.GraphNodes,i)?t=f.GraphNodes[i.name]:(t=this._addGraphNode(i),t.Added=!0),n._parents||(n._parents=[]),t._children||(t._children=[]),this._setNode(t._children,n),this._findNode(n._parents,t.name)<0&&n._parents.push(t)))},n.prototype._setNode=function(n,t){var i=this._findNode(n,t.name);i>=0&&i<n.length?n[i]=t:n.push(t)},n.prototype._findNode=function(n,t){var u=-1,i,f,r;if(n!=null&&t!=="")for(i=0,f=n.length;i<f;i++)if(r=n[i],typeof r=="string"&&r===t){u=i;break}else if(r!=null&&r.name===t){u=i;break}return u},n.prototype._addGraphNode=function(n){var i=this.selectedNode,t,r;return i.GraphNodes||(i.GraphNodes={}),t=n,i!=null&&(i.GraphNodes[t.name]=t,r=this.m_helperSelectedNode,r!=null&&n.name===r.name&&(this.m_helperSelectedNode=t)),t},n.prototype._isConnectedToAnotherNode=function(n){var t=!1,i=n.inEdges.concat(n.outEdges);return i.length>0&&(n.inEdges!=null&&n.inEdges.length>0&&(t=this._searchEdgeCollection(n.inEdges,"FromNode")),!t&&n.outEdges!=null&&n.outEdges.length>0&&(t=this._searchEdgeCollection(n.outEdges,"ToNode"))),t},n.prototype._searchEdgeCollection=function(n,t){for(var i,u=!1,r=0;r<n.length-1;r++)if((i=this.diagram.nameTable[n[r]],this._addNode(i,"passed"))&&!i._isCycleEdge&&(t==="FromNode"&&this.diagram.nameTable[i.sourceNode]!=null||t==="ToNode"&&this.diagram.nameTable[i.targetNode]!=null)){u=!0;break}return u},n.prototype._exploreGraphEdge=function(n){var t=n,i,r;t!=null&&!t._isCycleEdge&&this._addNode(n,"passed")&&(this._addNode(n,"selected"),i=this.diagram.nameTable[t.sourceNode],r=this.diagram.nameTable[t.targetNode],i!=null?this._selectNodes(i):r!=null?this._selectNodes(r):this.selectedNode=n)},n.prototype._addNode=function(n,t){var i=n;return(t!=="passed"&&i.visible||this._dictionaryContains(this.passedNodes,i)||(this.passedNodes[i.name]=i),!i.visible)?!1:!0},n.prototype._detectCyclesInGraph=function(n){for(var o,i,f,e,r=[],t=[],u=0;u<n.length;u++)n[u].segments||r.push(n[u]);if(r.length>0)for(t.push(r[0]),this.visitedStack.push(r[0]);t.length>0;)o=t[t.length-1],i=this._getUnVisitedChildNodes(o),i.length>0?(f=i[0],e=i[i.length-1],this._collectionContains(f.name,this.visitedStack)?(e._isCycleEdge=!0,this.cycleEdgesCollection.push(e)):(t.push(f),this.visitedStack.splice(0,0,f))):t.pop()},n.prototype._getUnVisitedChildNodes=function(n){var t=[],r,i,u;if(n.outEdges.length>0){for(r=0;r<n.outEdges.length;r++)if(i=this.diagram.nameTable[n.outEdges[r]],!this._collectionContains(i.name,this.visitedStack))return u=this.diagram.nameTable[i.targetNode],u!=null&&t.push(u),t.push(i),this.visitedStack.splice(0,0,i),t;return t}return t},n.prototype._collectionContains=function(n,t){for(var i=0;i<t.length;i++)if(t[i].name===n)return!0},n}(),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},ConnectionEnd;(function(n){n[n.Source=0]="Source";n[n.Target=1]="Target"})(ConnectionEnd||(ConnectionEnd={})),function(n){n[n.ImmediateLoading=0]="ImmediateLoading";n[n.DelayedDiagramLoading=1]="DelayedDiagramLoading";n[n.DelayedConnectorLoading=2]="DelayedConnectorLoading"}(LoadingPriority||(LoadingPriority={})),function(n){n[n.Routing=0]="Routing";n[n.Performance=1]="Performance";n[n.Default=2]="Default"}(RoutingPriority||(RoutingPriority={})),function(n){n[n.Horizontal=0]="Horizontal";n[n.Vertical=1]="Vertical"}(SegmentOrientation||(SegmentOrientation={})),function(n){n[n.Low=0]="Low";n[n.High=1]="High"}(ObstacleSideType||(ObstacleSideType={})),function(n){n[n.None=0]="None";n[n.Left=1]="Left";n[n.Right=2]="Right";n[n.Top=3]="Top";n[n.Bottom=4]="Bottom"}(PortDirection||(PortDirection={})),function(n){n[n.None=0]="None";n[n.Horizontal=1]="Horizontal";n[n.Vertical=2]="Vertical"}(Orientation||(Orientation={})),function(n){n[n.Right=0]="Right";n[n.Top=1]="Top"}(ScanDirection||(ScanDirection={})),function(n){n[n.Quick=0]="Quick";n[n.Best=1]="Best"}(RoutingSolution||(RoutingSolution={})),function(n){n[n.None=0]="None";n[n.North=1]="North";n[n.East=2]="East";n[n.South=4]="South";n[n.West=8]="West"}(Directions||(Directions={}));var Utility=function(){function n(){}return n.ToRoundedInt=function(n){return Math.round(n)},n.IntersectionWithRectangleBorder=function(t,i,r){switch(r){case Directions.North:case Directions.South:return new Point(n.ToRoundedInt(i.x),this.GetRectangleEdge(t,r));case Directions.East:case Directions.West:return new Point(this.GetRectangleEdge(t,r),n.ToRoundedInt(i.y))}return new Point},n.GetRectangleEdge=function(n,t){switch(t){case Directions.East:return n.right();case Directions.West:return n.left();case Directions.North:return n.bottom();case Directions.South:return n.top()}return 0},n.GetLengthFromListOfPoints=function(n){for(var t,u=0,i=n.get(0),r=0;r<n.size();r++)t=n.get(r),u+=Extensions.FindDistance(i,t,Extensions.GetOrientation(i.FindDirection(t))),i=t;return Number(u.toFixed(4))},n.GetIntersections=function(n,t){for(var f=new PointList,h=0,e,o,u=new Point,i=t,s=!1,r;i!=null&&s==!1;i=i.getNext())r=this.CrossTwoLineSegs(n.StartPoint,n.EndPoint,i.Point,i.getNext().Point,0,1,0,1,e,o,u),e=r.aSolution,o=r.bSolution,u=r.x,r.crossToLines&&(this.OldIntersection(u,f)||f.add(u)),h++,i.getNext()==t&&(s=!0);return f},n.OldIntersection=function(n,t){for(var i=0;i<t.size();i++)if(n.equals(t.get(i)))return!0;return!1},n.CrossTwoLineSegs=function(n,t,i,r,u,f,e,o,s,h,c){var a=t.subtract(n),y=i.subtract(r),p=i.subtract(n),v=this.Solve(a.x,y.x,p.x,a.y,y.y,p.y,s,h),w=v.solve,l;return s=v.x,h=v.y,l=!1,c=n.add(a.multiplyFactor(s)),w&&(s<u&&(l=!1),s=Math.max(s,u),s>f&&(l=!1),s=Math.min(s,f),h<e&&(l=!1),h=Math.max(h,e),h>o&&(l=!1),h=Math.min(h,o),l=!0),{crossToLines:l,aSolution:s,bSolution:h,x:c}},n.Solve=function(n,t,i,r,u,f,e,o){var s=n*u-r*t;return Math.abs(s)<1e-5?(e=o=0,{solve:!1,x:e,y:o}):(e=(i*u-f*t)/s,o=(n*f-r*i)/s,{solve:!0,x:e,y:o})},n.CheckWithScanDirection=function(n,t,i){return n==ScanDirection.Right?t.FindDirection(i)==Directions.East:t.FindDirection(i)==Directions.North},n.SegmentIntersects=function(n,t,i){var r=this.IntervalsIntersects(n,t,i);return{isInterSect:r.isInterSect,intersect:r.intersect}},n.IntervalsIntersects=function(n,t,i){return i=this.FindIntersection(n.StartPoint,n.EndPoint,t.StartPoint),{isInterSect:n.Contains(i)&&t.Contains(i),intersect:i}},n.FindIntersection=function(n,t,i){var r=n.FindDirection(t);return Extensions.IsVertical(r)?new Point(n.x,i.y):new Point(i.x,n.y)},n.AreEquivalentLines=function(n,t){return n.StartPoint.equals(t.StartPoint)&&n.EndPoint.equals(t.EndPoint)||n.StartPoint.equals(t.EndPoint)&&n.EndPoint.equals(t.StartPoint)?!0:!1},n.ListOrderBy=function(n,t){return n.sort(function(n,i){return n.key>i.key||n[t]<i[t]?1:n[t]<i[t]||n[t]>i[t]?-1:0})},n.OrderBy=function(n,t){return n.items.sort(function(n,i){return n._outerBounds[t]()<i._outerBounds[t]()?-1:n._outerBounds[t]()>i._outerBounds[t]()?1:0})},n.OrderByDescending=function(n,t){return n.items.sort(function(n,i){return n._outerBounds[t]()>i._outerBounds[t]()?-1:n._outerBounds[t]()<i._outerBounds[t]()?1:0})},n.ToList=function(n){var r=new List,i=Object.keys(n),t;for(i.sort(function(n,t){return n-t}),t=0;t<i.length;t++)r.add(n[i[t]]);return r},n}(),Extensions=function(){function n(){}return n.Left=function(n){switch(n){case Directions.None:return Directions.None;case Directions.North:return Directions.West;case Directions.East:return Directions.North;case Directions.South:return Directions.East;case Directions.West:return Directions.South}},n.Right=function(n){switch(n){case Directions.None:return Directions.None;case Directions.North:return Directions.East;case Directions.East:return Directions.South;case Directions.South:return Directions.West;case Directions.West:return Directions.North;default:return Directions.None}},n.Contains=function(n,t){return(t&n)!=0},n.ToIndex=function(n){switch(n){case Directions.North:return 0;case Directions.East:return 1;case Directions.South:return 2;case Directions.West:return 3}},n.IsAscending=function(n){return n==Directions.South||n==Directions.West?!1:!0},n.IsAscending_Direction=function(n){return n==PortDirection.Left||n==PortDirection.Top?!1:!0},n.IsVertical=function(n){return n==Directions.East||n==Directions.West?!1:!0},n.GetOrientation_PortDirection=function(n){switch(n){case PortDirection.Right:case PortDirection.Left:return Orientation.Horizontal;case PortDirection.Top:case PortDirection.Bottom:return Orientation.Vertical}return Orientation.None},n.GetOrientation=function(n){switch(n){case Directions.East:case Directions.West:return Orientation.Horizontal;case Directions.North:case Directions.South:return Orientation.Vertical}return Orientation.None},n.OppositeDirection_Port=function(n){switch(n){case PortDirection.Right:return PortDirection.Left;case PortDirection.Left:return PortDirection.Right;case PortDirection.Top:return PortDirection.Bottom;case PortDirection.Bottom:return PortDirection.Top}return PortDirection.None},n.OppositeDirection=function(n){switch(n){case Directions.North:return Directions.South;case Directions.West:return Directions.East;case Directions.South:return Directions.North;case Directions.East:return Directions.West;default:return Directions.None}},n.IsPureDirection=function(n){switch(n){case Directions.North:return!0;case Directions.East:return!0;case Directions.South:return!0;case Directions.West:return!0;default:return!1}},n.OppositeDirection_Direction=function(n){switch(n){case Directions.North:return Directions.South;case Directions.West:return Directions.East;case Directions.South:return Directions.North;case Directions.East:return Directions.West;default:return Directions.None}},n.OppositeOrientation=function(n){return n==Orientation.Horizontal?Orientation.Vertical:Orientation.Horizontal},n.ToAngle=function(n){switch(n){case Directions.East:return 0;case Directions.North:return 90;case Directions.West:return 180;case Directions.South:return 270}return 0},n.GetEquivalentDirection=function(n){switch(n){case PortDirection.Right:return Directions.East;case PortDirection.Left:return Directions.West;case PortDirection.Bottom:return Directions.North;case PortDirection.Top:return Directions.South}return Directions.None},n.FindDirection=function(n,t){var i=Directions.None,r=n.x,u=n.y,f=t.x,e=t.y;return r!=f&&(i=f>r?Directions.East:Directions.West),u!=e&&(i=e>u?i|Directions.North:i|Directions.South),i},n.FindDirection_orientation=function(n,t,i){var r=Directions.None,u,f;return i==Orientation.Horizontal?(u=t.x-n.x,u>0?r=Directions.East:u<0&&(r=Directions.West)):(f=t.y-n.y,f>0?r=r|Directions.North:f<0&&(r=r|Directions.South)),r},n.ManhattanDistance=function(n,t){return Math.abs(n.x-t.x)+Math.abs(n.y-t.y)},n.FindDistance=function(n,t,i){return i==Orientation.Horizontal?Math.abs(n.x-t.x):Math.abs(n.y-t.y)},n.Transform=function(n,t,i){var r=this.ToAngle(i);return new Point(Number(Math.round(n.x+t*Math.cos(r*Math.PI/180)).toFixed(4)),Number(Math.round(n.y+t*Math.sin(r*Math.PI/180)).toFixed(4)))},n.VectorDirection=function(n){var i=.0001,t=Directions.None;return n.x>i?t=Directions.East:n.x<-i&&(t=Directions.West),n.y>i?t=t|Directions.North:n.y<-i&&(t=t|Directions.South),t},n.GetLengthFromListOfPoints=function(t){for(var i,f=0,r=t.get(0),u=0;u<t.size();u++)i=t.get(Number(u)),f+=n.FindDistance(r,i,n.GetOrientation(n.FindDirection(r,i))),r=i;return Number(f.toFixed(4))},n.CompareTo=function(n,t){if(n<t)return-1;if(n>t)return 1;if(n!=t){if(!isNaN(n))return 1;if(!isNaN(t))return-1}return 0},n.FindDirectionOrientation=function(n,t,i){var r=Directions.None,u,f;return i==Orientation.Horizontal?(u=t.x-n.x,u>0?r=Directions.East:u<0&&(r=Directions.West)):(f=t.y-n.y,f>0?r=r||Directions.North:f<0&&(r=r||Directions.South)),r},n.add=function(n,t,i,r){var u=Object.keys(n),f={key:t,value:i};return n[u.length]=f,r||typeof n[0].key=="object"||this.sortOnKeys(n),n},n.sortOnKeys=function(t){var i=[],o,s,f,r,u,h,e,c;for(r in t)i[i.length]=t[r].key;for(i.sort(function(n,t){return n-t}),o=$.extend(!1,{},t),s=Object.keys(t),f=0;f<s.length;f++)r=s[f],t[r]&&delete t[r];for(u=0;u<i.length;u++)for(h=Object.keys(o),e=0;e<h.length;e++)c=o[h[e]],c.key==i[u]&&n.add(t,i[u],c.value,!0);return t},n.getFromDictionary123=function(n,t){for(var i,f,u=Object.keys(n),r=0;r<u.length;r++)if(i=n[u[r]],f=typeof i.key,f==="object")if(i.key&&i.key.x&&i.key.y){if(i.key.x===t.x&&i.key.y===t.y)return i.value}else if(i.key.name&&t.name&&i.key.name===t.name)return i.value;return null},n.getFromDictionary=function(n,t,i){var e=i?i:typeof t,u,r,f;if(e==="number"){for(u=Object.keys(n),r=0;r<u.length;r++)if(f=n[u[r]],f.key==t)return f.value}else return this.getFromDictionary123(n,t);return null},n.ElementAt=function(n,t){var i=Object.keys(n),r=n[i[t]];return r?r.value?n[i[t]].value:n[i[t]]:null},n.KeytAt=function(n,t){var i=Object.keys(n),r=n[i[t]];return r?n[i[t]].key:null},n.Clear=function(){return{}},n.IndexOfKey=function(n,t){for(var e,i,o,u=Object.keys(n),f=-1,r=0;r<u.length;r++)if(f++,e=typeof t,e=="string"||e=="number"){if(n[u[r]].key===t)return f}else if(i=n[u[r]],o=typeof i.key,o==="object"&&i.key&&i.key.x&&i.key.y&&i.key.x===t.x&&i.key.y===t.y)return f;return-1},n.Count=function(n){var t=Object.keys(n);return t.length},n.ContainsKey=function(n,t){var f=typeof t,u,r,i,e;if(f=="string"||f=="number"){for(u=Object.keys(n),r=0;r<u.length;r++)if(i=n[u[r]],i.key==t)return!0}else if(f=="object"&&t&&t.x&&t.y)for(u=Object.keys(n),r=0;r<u.length;r++)if(i=n[u[r]],e=typeof i.key,e=="object"&&i.key&&i.key.x&&i.key.y&&i.key.x===t.x&&i.key.y===t.y)return!0;return!1},n.ReAlignDictionary=function(t){var r=Object.keys(t),o,u,f,s,e,i;if(r.length>0&&(o=typeof t[r[0]].key,o=="string"||o=="number")){for(u=$.extend(!1,{},t),f=0;f<r.length;f++)s=r[f],t[s]&&delete t[s];for(e=Object.keys(u),i=0;i<e.length;i++)n.add(t,u[e[i]].key,u[e[i]].value,!0)}return t},n.Remove=function(n,t,i){var e,u,r,f,o;if(i!=undefined){if(n[i])return delete n[i],this.ReAlignDictionary(n),!0}else for(u=Object.keys(n),r=0;r<u.length;r++)if(f=n[u[r]],e=typeof t,e=="string"||e=="number"){if(f.key==t)return delete n[u[r]],this.ReAlignDictionary(n),!0}else if(t&&t.x&&t.y)for(u=Object.keys(n),r=0;r<u.length;r++)if(f=n[u[r]],o=typeof f.key,o=="object"&&f.key&&f.key.x&&f.key.y&&f.key.x===t.x&&f.key.y===t.y)return delete n[u[r]],n[u[r]],this.ReAlignDictionary(n),!0;return!1},n}(),Point=function(){function n(n,t){this.x=0;this.y=0;this.x=n?n:0;this.y=t?t:0}return n.equals=function(n,t){return n===t?!0:!n||!t?!1:!n||!t||n.x===t.x&&n.y===t.y},n.prototype.equals=function(n){return n===this?!0:!n||!this?!1:!n||!this||n.x===this.x&&n.y===this.y},n.prototype.OperatorNotEqual=function(n){var t=this;return t.CompareTo(n)!=0},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.multiplyFactor=function(t){return new n(this.x*t,this.y*t)},n.prototype.distance=function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},n.transform=function(n,t,i){var r={x:0,y:0};return r.x=Number(((n.x+i*Math.cos(t*Math.PI/180))/1).toFixed(4)),r.y=Number(((n.y+i*Math.sin(t*Math.PI/180))/1).toFixed(4)),r},n.findLength=function(n,t){var i=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));return Number(i.toFixed(4))},n.findAngle=function(n,t){var i=Math.atan2(t.y-n.y,t.x-n.x);return i=180*i/Math.PI,i%=360,i<0&&(i+=360),i},n.distancePoints=function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},n.prototype.OperatorLessThan=function(n){var t=this;return t.CompareTo(n)<0},n.prototype.OperatorGreaterThan=function(n){var t=this;return t.CompareTo(n)>0},n.prototype.CompareTo=function(n){var t=this.CompareTo_Number(this.x,n.x);return t!=0?t:this.CompareTo_Number(this.y,n.y)},n.prototype.CompareTo_Number=function(n,t){if(n<t)return-1;if(n>t)return 1;if(n!=t){if(!isNaN(n))return 1;if(!isNaN(t))return-1}return 0},n.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},n.prototype.FindDirection=function(n){var t=Directions.None,i=this.x,r=this.y,u=n.x,f=n.y;return i!=u&&(t=u>i?Directions.East:Directions.West),r!=f&&(t=f>r?t|Directions.North:t|Directions.South),t},n.prototype.ManhattanDistance=function(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)},n}(),List=function(){function n(){this._size=0;this.items=[]}return n.prototype.List=function(n){for(var t=0;t<n.size();t++)this.items.push(n.get(t))},n.prototype.size=function(){return this.items.length},n.prototype.sortByKey=function(n){return this.items.sort(function(t,i){var r=t[n],u=i[n];return r<u?-1:r>u?1:0})},n.prototype.Concat=function(t){for(var r=new n,i=0;i<this.items.length;i++)r.add(this.items[i]);for(i=0;i<t.size();i++)r.add(t.get(i));return r},n.prototype.GetRange=function(t,i){for(var u=new n,r=t;r<t+i;r++)u.add(this.items[r]);return u},n.prototype.AddRange=function(n){for(var t=0;t<n.size();t++)this.items.push(n.get(t))},n.prototype.Insert=function(n,t){n===void 0&&(n=this.size()+1);this.items.splice(n,0,t);this._size++},n.prototype.add=function(n){this.items.push(n);this._size++},n.prototype.get=function(n){return this.items[Number(n)]},n.prototype.Remove=function(n){var t=this.IndexOf(n);return t>=0?(this.RemoveAt(t),!0):!1},n.prototype.RemoveAt=function(n){n>=this._size;this._size--;this.items.splice(n,1)},n.prototype.Last=function(){return this.items[this.size()-1]},n.prototype.IndexOf=function(n){return this.items.indexOf(n)},n.prototype.Clear=function(){while(this.items.length>0)this.items.pop(),this._size=0},n.prototype.ElementAt=function(n){return this.items[n]},n.prototype.UpdateListValue=function(n,t){return t&&t?(this.items[n]=t,!0):!1},n.prototype.contains=function(n){var t;if(n==null){for(t=0;t<this._size;t++)if(this.items[t]==null)return!0;return!1}for(t=0;t<this._size;t++)if(this.items[t]==n)return!0},n}(),PointList=function(){function n(){this._size=0;this.items=[]}return n.prototype.PointList=function(n){for(var t=0;t<n.length;t++)this.items.push(n[t]);return this},n.prototype.size=function(){return this.items.length},n.prototype.Insert=function(n,t){n===void 0&&(n=this.size()+1);this.items.splice(n,0,t);this._size++},n.prototype.AddRange=function(n){for(var t=0;t<n.size();t++)this.items.push(n.get(t))},n.prototype.Concat=function(t){for(var r=new n,i=0;i<this.items.length;i++)r.add(this.items[i]);for(i=0;i<t.size();i++)r.add(t.get(i));return r},n.prototype.add=function(n){this.items.push(n);this._size++},n.prototype.get=function(n){return this.items[n]},n.prototype.RemoveAt=function(n){n>=this._size;this._size--;this.items.splice(n,1)},n.prototype.Last=function(){return this.items[this.size()-1]},n.prototype.IndexOf=function(n){return this.items.indexOf(n)},n.prototype.Clear=function(){while(this.items.length>0)this.items.pop()},n.prototype.ElementAt=function(n){return this.items[n]},n.prototype.contains=function(n){var t;if(n==null){for(t=0;t<this._size;t++)if(this.items[t]==null)return!0;return!1}for(t=0;t<this._size;t++)if(this.items[t]==n)return!0},n}(),Rect=function(){function n(n,t,i,r){this.x=Number.MAX_VALUE;this.y=Number.MAX_VALUE;this.width=0;this.height=0;n===undefined||t===undefined?(n=t=Number.MAX_VALUE,i=r=0):(i===undefined&&(i=0),r===undefined&&(r=0));this.x=n!==undefined?n:Number.MAX_VALUE;this.y=t!==undefined?t:Number.MAX_VALUE;this.width=i!==undefined?i:0;this.height=r!==undefined?r:0}return n.prototype.Rect=function(n,t){return this.x=Math.min(n.x,t.x),this.y=Math.min(n.y,t.y),this.width=Number(Math.max(n.x,t.x))-Number(this.x),this.height=Number(Math.max(n.y,t.y))-Number(this.y),this},n.Rect=function(n,t){return this.Rect(n,t)},n.prototype.left=function(){return this.x},n.prototype.right=function(){return this.x+this.width},n.prototype.top=function(){return this.y},n.prototype.bottom=function(){return Number((this.y+this.height).toFixed(4))},n.prototype.topLeft=function(){return new Point(this.left(),this.top())},n.prototype.topRight=function(){return new Point(this.right(),this.top())},n.prototype.bottomLeft=function(){return new Point(this.left(),this.bottom())},n.prototype.bottomRight=function(){return new Point(this.right(),this.bottom())},n.prototype.middleLeft=function(){return new Point(this.left(),this.y+this.height/2)},n.prototype.middleRight=function(){return new Point(this.right(),this.y+this.height/2)},n.prototype.topCenter=function(){return new Point(this.x+this.width/2,this.top())},n.prototype.bottomCenter=function(){return new Point(this.x+this.width/2,this.bottom())},n.prototype.center=function(){return new Point(this.x+this.width/2,this.y+this.height/2)},n.prototype.equals=function(n,t){return n.x===t.x&&n.y===t.y&&n.width===t.width&&n.height===t.height},n.prototype.uniteRect=function(n){var t=Math.max(Number.NaN===this.right()||this.x===Number.MAX_VALUE?n.right():this.right(),n.right()),i=Math.max(Number.NaN===this.bottom()||this.y===Number.MAX_VALUE?n.bottom():this.bottom(),n.bottom());return this.x=Math.min(this.left(),n.left()),this.y=Math.min(this.top(),n.top()),this.width=t-this.x,this.height=i-this.y,this},n.prototype.unitePoint=function(n){if(this.x===Number.MAX_VALUE){this.x=n.x;this.y=n.y;return}var t=Math.min(this.left(),n.x),i=Math.min(this.top(),n.y),r=Math.max(this.right(),n.x),u=Math.max(this.bottom(),n.y);this.x=t;this.y=i;this.width=r-this.x;this.height=u-this.y},n.prototype.Inflate=function(n){return this.x-=n,this.y-=n,this.width+=n*2,this.height+=n*2,this},n.prototype.intersects=function(n){return this.right()<n.left()||this.left()>n.right()||this.top()>n.bottom()||this.bottom()<n.top()?!1:!0},n.prototype.containsRect=function(n){return this.left()<=n.left()&&this.right>=n.right&&this.top()<=n.top()&&this.bottom>=n.bottom},n.prototype.containsPoint=function(n){return this.left()<=n.x&&this.right()>=n.x&&this.top()<=n.y&&this.bottom()>=n.y},n.toBounds=function(t){for(var f,r=new n,i=0,u=t;i<u.length;i++)f=u[i],r.unitePoint(f);return r},n.prototype.round=function(){return this.x=Math.round(this.x),this.width=Math.round(this.width),this.y=Math.round(this.y),this.height=Math.round(this.height),this},n.empty=new n(Number.MAX_VALUE,Number.MIN_VALUE,0,0),n}(),Stack=function(){function n(){this.items=[]}return n.prototype.Push=function(n){this.items.push(n)},n.prototype.Pop=function(){return this.items.pop()},n.prototype.Peek=function(){return this.items[this.items.length-1]},n.prototype.Clear=function(){this.items=[]},n.prototype.Count=function(){return this.items.length},n.prototype.get=function(n){return this.items[Number(n)]},n}(),Dictionary=function(){function n(){this.keys=[];this.items={};this.count=0}return n.prototype.Items=function(){return this.items},n.prototype.Dictionary=function(t,i,r){var u=new n;return u.items=$.extend(!1,{},t),u.count=i,u.keys=r,u},n.prototype.Add=function(n,t){if(t!=undefined&&n!=undefined){var i={key:t,value:n};this.items[this.count]=i;this.keys.push(t);this.count++}},n.prototype.Remove=function(n){if(this.ContainsKey(n)){var t=this.IndexOfKey(n);delete this.items[t];this.keys.splice(t,1);this.count--;this.updateDic()}},n.prototype.updateDic=function(){for(var t={},i=Object.keys(this.items),n=0;n<this.count;n++)t[n]=this.items[i[n]];this.items=t},n.prototype.Update=function(n,t){if(this.ContainsKey(n)){var i=this.IndexOfKey(n);this.items[i].value=t}},n.prototype.Clear=function(){this.items={};this.count=0;this.keys=[]},n.prototype.ContainsKey=function(n){var t=this.keys.indexOf(n);return t==-1?!1:!0},n.prototype.GetValue=function(n){if(n!=undefined&&this.ContainsKey(n)){var t=this.IndexOfKey(n);if(t!=-1)return this.items[t].value}return null},n.prototype.IndexOfKey=function(n){return this.keys.indexOf(n)},n.prototype.ElementAt=function(n){return n<this.keys.length&&this.items[n].value,null},n.prototype.KeyAt=function(n){return this.keys[n]},n.prototype.GetLength=function(){return this.keys.length},n.prototype.Count=function(){return this.keys.length},n.prototype.Clone=function(){return this.Dictionary(this.items,this.count,this.keys)},n}(),SortedList=function(){function n(){this.keys=[];this.items={};this.count=0}return n.prototype.Items=function(){return this.items},n.prototype.SortedList=function(t,i,r){var u=new n;return u.items=$.extend(!1,{},t),u.count=i,u.keys=r,u},n.prototype.Add=function(n,t){if(t!=undefined&&n!=undefined){var i={key:t,value:n};this.items[t]=i;this.keys=Object.keys(this.items);this.keys.sort(function(n,t){return n-t});this.count++}},n.prototype.Remove=function(n){this.ContainsKey(n)&&(delete this.items[n],this.keys=Object.keys(this.items),this.keys.sort(function(n,t){return n-t}),this.count--)},n.prototype.Update=function(n,t){this.ContainsKey(n)&&(this.items[n].value=t)},n.prototype.Clear=function(){this.items={};this.count=0;this.keys=[]},n.prototype.sortOnKeys=function(){var n=[],r,i,t;for(r in this.items)n[n.length]=r;for(n.sort(function(n,t){return n-t}),i={},t=0;t<n.length;t++)i[n[t]]=this.items[n[t]];this.items=i},n.prototype.ContainsKey=function(n){if(this.items.hasOwnProperty(n))return!0},n.prototype.GetValue=function(n){if(n!=undefined&&this.items.hasOwnProperty(n))return this.items[n].value},n.prototype.IndexOfKey=function(n){var t=0,i;this.keys.indexOf(n);for(i in this.keys){if(this.keys[i]==n)return t;t++}return-1},n.prototype.ElementAt=function(n){var t=0;for(var i in this.items){if(t===n||n===i)return this.items[i].value;t++}return null},n.prototype.KeyAt=function(n){return Number(this.keys[n])},n.prototype.GetLength=function(){return this.keys.length},n.prototype.Count=function(){return this.keys.length},n.prototype.Clone=function(){return this.SortedList(this.items,this.count,this.keys)},n}(),Tuple=function(){function n(n,t){this._mT1=n;this._mT2=t}return n.prototype.Item11=function(){return this._mT1},n.prototype.Item2=function(){return this._mT2},n}(),PolylinePoint=function(){function n(n){this.Point=n}return n.prototype.getPrev=function(){return this._mPrev},n.prototype.setPrev=function(n){this._mPrev=n},n.prototype.getNext=function(){return this._mNext},n.prototype.setNext=function(n){this._mNext=n},n}(),Segment=function(){function n(n,t){this.StartPoint=n;this.EndPoint=t}return n.prototype.Bounds=function(){return(new Rect).Rect(this.StartPoint,this.EndPoint)},n.prototype.Contains=function(n){var t=this.StartPoint.FindDirection(this.EndPoint);switch(t){case Directions.East:return this.StartPoint.x<=n.x&&n.x<=this.EndPoint.x;case Directions.West:return this.StartPoint.x>=n.x&&n.x>=this.EndPoint.x;case Directions.North:return this.StartPoint.y<=n.y&&n.y<=this.EndPoint.y;case Directions.South:return this.StartPoint.y>=n.y&&n.y>=this.EndPoint.y}return!1},n}(),SharedData=function(){function n(){}return n}(),ICoreGroupableInfo=function(){function n(){}return n}(),IObstacle=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(ICoreGroupableInfo),SpatialSearching=function(){function n(){this._pageLeft=0;this._pageRight=0;this._pageTop=0;this._pageBottom=0;this.childLeft=0;this.childTop=0;this.childRight=0;this.childBottom=0}return n.quadSize=500,n}(),ObstacleTree=function(){function n(){this.Rectangle=new Rect;this.ObstaclePadding=0;this.startNode=null;this.endNode=null;this.lookupSegment=null;this.canRoute=!0;this.hit=null}return n.prototype.InitObstacles=function(n,t,i){var f,r,u;for(this.spatialSearch=i,this.ObstaclePadding=t,f=0,u=0;u<n.size();u++)r=n.get(f),r._obstacle=(new Obstacle)._obstacle(r._outerBounds,t),this.Rectangle=u==0?r._obstacle.getPaddedBounds():this.Rectangle.uniteRect(r._obstacle.getPaddedBounds()),r._obstacle.CenterPort=new CenterPort(r._obstacle.getPaddedBounds().center()),f++},n.prototype.DisposeObstacles=function(n){var i,t;for(i in n)t=n.get(i),t._obstacle!=null&&(t._obstacle=null);this.spatialSearch=null},n.prototype.RestrictSegmentWithinFreeSpace=function(n,t,i,r){return r===void 0&&(r=null),this.FindMaximumVisibility(t,i,r)},n.prototype.FindNodesWhere=function(n,t){for(var u,i,f=new List,r=0;r<n.length;r++)i=n[r],i&&i._obstacle!=null&&(u=i._obstacle.getPaddedBounds?i._obstacle.getPaddedBounds():null,u!=null&&u.intersects(t)&&f.add(i));return f},n.prototype.FindNodes=function(n){for(var r,t=new List,u=new List,f=ej.datavisualization.Diagram.SpatialUtil.findQuads(this.spatialSearch,n),i=0;i<f.length;i++)r=f[i],r.objects.length>0&&(u=this.FindNodesWhere(r.objects,n)),t=t.Concat(u);return t},n.prototype.FindMaximumVisibility=function(n,t,i){var u,r;return i===void 0&&(i=null),this.canRoute=!0,r=this.FindMaximumVisibility_hitNode(n,t,i,u),u=r.hitNode,r.canRoute},n.prototype.FindMaximumVisibility_hitNode=function(n,t,i,r,u){var e,f;return u===void 0&&(u=!1),r=null,u||(this.lookupSegment=n),this.startNode=t,this.endNode=i,e=Extensions.FindDirection(n.StartPoint,n.EndPoint),e!=Directions.None&&(f=this.FindFirstHit(this.spatialSearch.parentQuad,e,n.Bounds()),f!=null&&f&&(r=f,this.GetSegmentEnd(n,e,f._obstacle))),this.startNode=null,this.lookupSegment=null,{canRoute:this.canRoute,hitNode:r}},n.prototype.GetSegmentEnd=function(n,t,i){var r=n.EndPoint;if(i!=null)switch(t){case Directions.East:r=new Point(i.getPaddedBounds().left(),r.y);break;case Directions.West:r=new Point(i.getPaddedBounds().right(),r.y);break;case Directions.North:r=new Point(r.x,i.getPaddedBounds().top());break;case Directions.South:r=new Point(r.x,i.getPaddedBounds().bottom())}n.EndPoint=r.round()},n.prototype.FindFirstHit=function(n,t,i){var r=null,u=n;switch(t){case Directions.East:r=this.FindIntersectingObjectsAtRight(u,i);break;case Directions.West:r=this.FindIntersectingObjectsAtLeft(u,i);break;case Directions.North:r=this.FindIntersectingObjectsAtBottom(u,i);break;case Directions.South:r=this.FindIntersectingObjectsAtTop(u,i)}return r!=null&&r.size()>0?this.FirstHitNode(r,t):null},n.prototype.FirstHitNode=function(n,t){var i=null;switch(t){case Directions.East:i=Utility.OrderBy(n,"left");break;case Directions.West:i=Utility.OrderByDescending(n,"right");break;case Directions.South:i=Utility.OrderByDescending(n,"bottom");break;case Directions.North:i=Utility.OrderBy(n,"top")}return Extensions.ElementAt(i,0)},n.prototype.FindIntersectingObjectsAtRight=function(n,t,i){i===void 0&&(i=null);var u=i!=null?i.size():0,r=!1;return(n.first!=null&&this.IsIntersects(n.first,t)&&(i=this.FindIntersectingObjectsAtRight(n.first,t,i)),n.third!=null&&this.IsIntersects(n.third,t)&&(i=this.FindIntersectingObjectsAtRight(n.third,t,i)),i!=null&&i.size()>0&&u!=i.size()&&(r=!0),i=this.GetIntersectingNodesInaQuad(n,t,i),i!=null&&i.size()>0&&(r||this.CheckForObjectsOnCenterline(n,i,Directions.East)))?i:(n.second!=null&&this.IsIntersects(n.second,t)&&(i=this.FindIntersectingObjectsAtRight(n.second,t,i)),n.fourth!=null&&this.IsIntersects(n.fourth,t)&&(i=this.FindIntersectingObjectsAtRight(n.fourth,t,i)),i!=null&&i.size()>0)?i:null},n.prototype.FindIntersectingObjectsAtLeft=function(n,t,i){i===void 0&&(i=null);var r=!1,u=i!=null?i.size():0;return(n.second!=null&&this.IsIntersects(n.second,t)&&(i=this.FindIntersectingObjectsAtLeft(n.second,t,i)),n.fourth!=null&&this.IsIntersects(n.fourth,t)&&(i=this.FindIntersectingObjectsAtLeft(n.fourth,t,i)),i!=null&&i.size()>0&&u!=i.size()&&(r=!0),i=this.GetIntersectingNodesInaQuad(n,t,i),i!=null&&i.size()>0&&(r||this.CheckForObjectsOnCenterline(n,i,Directions.West)))?i:(n.first!=null&&this.IsIntersects(n.first,t)&&(i=this.FindIntersectingObjectsAtLeft(n.first,t,i)),n.third!=null&&this.IsIntersects(n.third,t)&&(i=this.FindIntersectingObjectsAtLeft(n.third,t,i)),i!=null&&i.size()>0)?i:null},n.prototype.FindIntersectingObjectsAtBottom=function(n,t,i){i===void 0&&(i=null);var r=!1,u=i!=null?i.size():0;return(n.first!=null&&this.IsIntersects(n.first,t)&&(i=this.FindIntersectingObjectsAtBottom(n.first,t,i)),n.second!=null&&this.IsIntersects(n.second,t)&&(i=this.FindIntersectingObjectsAtBottom(n.second,t,i)),i!=null&&i.size()>0&&u!=i.size()&&(r=!0),i=this.GetIntersectingNodesInaQuad(n,t,i),i!=null&&i.size()>0&&(r||this.CheckForObjectsOnCenterline(n,i,Directions.North)))?i:(n.third!=null&&this.IsIntersects(n.third,t)&&(i=this.FindIntersectingObjectsAtBottom(n.third,t,i)),n.fourth!=null&&this.IsIntersects(n.fourth,t)&&(i=this.FindIntersectingObjectsAtBottom(n.fourth,t,i)),i!=null&&i.size()>0)?i:null},n.prototype.FindIntersectingObjectsAtTop=function(n,t,i){i===void 0&&(i=null);var u=i!=null?i.size():0,r=!1;return(n.third!=null&&this.IsIntersects(n.third,t)&&(i=this.FindIntersectingObjectsAtTop(n.third,t,i)),n.fourth!=null&&this.IsIntersects(n.fourth,t)&&(i=this.FindIntersectingObjectsAtTop(n.fourth,t,i)),i!=null&&i.size()>0&&(r=!0),i=this.GetIntersectingNodesInaQuad(n,t,i),i!=null&&i.size()>0&&u!=i.size()&&(r||this.CheckForObjectsOnCenterline(n,i,Directions.South)))?i:(n.first!=null&&this.IsIntersects(n.first,t)&&(i=this.FindIntersectingObjectsAtTop(n.first,t,i)),n.second!=null&&this.IsIntersects(n.second,t)&&(i=this.FindIntersectingObjectsAtTop(n.second,t,i)),i!=null&&i.size()>0)?i:null},n.prototype.CheckForObjectsOnCenterline=function(n,t,i){var u,o,s,f,r,e;if(i==Directions.North){for(o=n.top+n.height/2,f=0;f<t.size();f++)if(u=t.get(f),u&&(r=ej.datavisualization.Diagram.Util.bounds(u),e=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),u._obstacle?u._obstacle._outerBounds=e:u._obstacle={OuterBounds:e}),t.get(f)._obstacle._outerBounds.top()<=o)return!0}else if(i==Directions.South){for(o=n.top+n.height/2,f=0;f<t.size();f++)if(u=t.get(f),u&&(r=ej.datavisualization.Diagram.Util.bounds(u),e=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),u._obstacle?u._obstacle._outerBounds=e:u._obstacle={OuterBounds:e}),t.get(f)._obstacle._outerBounds.bottom>=o)return!0}else if(i==Directions.East){for(s=n.left+n.width/2,f=0;f<t.size();f++)if(u=t.get(f),u&&(r=ej.datavisualization.Diagram.Util.bounds(u),e=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),u._obstacle?u._obstacle._outerBounds=e:u._obstacle={OuterBounds:e}),t.get(f)._obstacle._outerBounds.left<=s)return!0}else for(s=n.left+n.width/2,f=0;f<t.size();f++)if(u=t.get(f),u&&(r=ej.datavisualization.Diagram.Util.bounds(u),e=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),u._obstacle?u._obstacle._outerBounds=e:u._obstacle={OuterBounds:e}),t.get(f)._obstacle._outerBounds.right>=s)return!0;return!1},n.prototype.GetIntersectingNodesInaQuad=function(n,t,i){var f,r,u;i===void 0&&(i=null);i==null&&(i=new List);for(f in n.objects)if(r=n.objects[f],r&&r._obstacle!=null&&(u=r._obstacle.getPaddedBounds?r._obstacle.getPaddedBounds():null,u!=null&&r!=this.startNode&&r!=this.endNode&&r._obstacle.getPaddedBounds().intersects(t))){if(this.lookupSegment!=null&&u.containsPoint(this.lookupSegment.StartPoint)){this.canRoute=!1;i=null;break}i.add(r)}return i},n.prototype.IsIntersects=function(n,t){return n.left>t.right||n.left+n.width<t.left||n.top>t.bottom||n.top+n.height<t.top()?!1:!0},n}(),LineRouting=function(){function n(){this.KnownObstacles=null;this.VisibleConnectors=null;this.consideredRegion=Rect.empty;this.IsDirt=!1;this.firstLoad=!1;this.ObstaclePadding=0;this.BendEquivalence=0;this.Priority=RoutingPriority.Routing;this.loadingPriority=LoadingPriority.ImmediateLoading;this.visibleVertices=new List;this.visibleEdges=new List;this.selectorBounds=Rect.empty}return n.prototype.SetLineRoutingSettings=function(){var n=this._mSharedData.lineRoutingSettings!=null?this._mSharedData.lineRoutingSettings:new LineRoutingSettings;(this.ObstaclePadding!=n.obstaclePadding||this.Priority!=n.priority||this.BendEquivalence!=n.bendEquivalence||this.loadingPriority!=n.loadingPriority)&&(this.IsDirt=!0);this.ObstaclePadding=n.obstaclePadding;this.BendEquivalence=n.bendEquivalence;this.Priority=n.priority;this.loadingPriority=n.loadingPriority},n.prototype.RerouteConnectors=function(n,t){var o,r,h,i,c;if(n.nodes().length>0&&n.connectors().length>0){var l=n,a=t!=null?t:l.activeTool.selectedObject,f=ej.datavisualization.Diagram.Util.bounds(a),v=new Rect(f.left,f.top,f.right-f.left,f.bottom-f.top),e,u,s="";for(o=0;o<n.connectors().length;o++){if(u=n.connectors()[o],u&&s!=u.name){for(e=ej.datavisualization.Diagram.Util.getPoints(u),r=[],i=0;i<e.length;i++)(i>0&&!(r[r.length-1].x==e[i].x&&r[r.length-1].y==e[i].y)||i==0)&&r.push(new Point(Math.round(e[i].x),Math.round(e[i].y)));if(u=n.connectors()[o],r.length>1)for(h=r[0],i=1;i<r.length;i++)if(c=(new Rect).Rect(h,r[i]),c.intersects(v)&&this.router.CanRoute(u)){this.routeEdge(u,n);s=u.name;break}}this.router!=null&&this.router.ForceInvalidateRouter()}}},n.prototype.Init=function(n){this._mSharedData=n;this.SetLineRoutingSettings()},n.prototype.cloneConnector=function(n,t){return this._mSharedData=t,n.sourceNode&&!n._sourceNodeInfo&&(n._sourceNodeInfo=t.nameTable[n.sourceNode]),n.targetNode&&!n._targetNodeInfo&&(n._targetNodeInfo=t.nameTable[n.targetNode]),n},n.prototype.updateAllQuadObjects=function(n){for(var t,r=0;r<n.objects.length;r++)if(t=n.objects[r],t){var i=ej.datavisualization.Diagram.Util.bounds(t),u=new Rect(i.left,i.top,i.right-i.left,i.bottom-i.top),f=new Rect(i.x-this.ObstaclePadding,i.y-this.ObstaclePadding,i.width+2*this.ObstaclePadding,i.height+2*this.ObstaclePadding);t.segments||(t._obstacle?t._obstacle._outerBounds=u:t._obstacle={OuterBounds:u},t._outerBounds=u,t._obstacle.CenterPort||(t._obstacle.CenterPort=new CenterPort(f.center())))}},n.prototype.routeEdge=function(n,t){n=this.cloneConnector(n,t);this.updateParentQuad(t,!0,n);this.router.RouteEdge(n,t);t._resetConnectorPoints(n,t)},n.prototype._checkFromSwimlane=function(n,t){return t._checkFromSwimlane(n)},n.prototype._removeGroupChild=function(n,t){for(var i,u=[],r=0;r<n.length;r++)i=t.nameTable[t._getChild(n[r])],i&&!this._checkFromSwimlane(i,t)&&u.push(i);return u},n.prototype.GenerateVisibilityGraph=function(n,t){var i,r;this.router=(new Router).Router(this.Priority,this.BendEquivalence,this.ObstaclePadding,n);i=t?n.nodes():n._spatialSearch.parentQuad.objects;this.updateParentQuad(n);i.length>0&&(r=this._removeGroupChild(i,n),this.router.GenerateVisibilityGraph(r,n._spatialSearch));VisibilityGraphGeneration.setRouter(this.router)},n.prototype.updateParentQuad=function(n,t,i){var d=this._mSharedData,o=$.extend(!1,[],n._spatialSearch.parentQuad),s,h,c,l,f,e,y,u;if(o.objects.length==0&&(o.objects=n.nodes()),t){if(i){i.targetNode&&(s=n.nameTable[i.targetNode],h=ej.datavisualization.Diagram.Util.bounds(s,!0));i.sourceNode&&(c=n.nameTable[i.sourceNode],l=ej.datavisualization.Diagram.Util.bounds(c,!0));var w=ej.datavisualization.Diagram.Util.findPortByName(c,i.sourcePort),b=ej.datavisualization.Diagram.Util.findPortByName(s,i.targetPort),a=ej.datavisualization.Diagram.Util._getPortPosition(b,h),v=ej.datavisualization.Diagram.Util._getPortPosition(w,l)}w&&(f=ej.datavisualization.Diagram.Util._swapDirection(c.rotateAngle,ej.datavisualization.Diagram.Util._getDirection(l,v?v:l.center)),i._sourcePortInfo=new IObstaclePort,f==="left"?i._sourcePortInfo.Direction=PortDirection.Left:f==="right"?i._sourcePortInfo.Direction=PortDirection.Right:f==="bottom"?i._sourcePortInfo.Direction=PortDirection.Bottom:f==="top"&&(i._sourcePortInfo.Direction=PortDirection.Top),i._sourcePortInfo.Location=new Point(Number(v.x.toFixed(4)),Number(v.y.toFixed(4))));b&&(e=ej.datavisualization.Diagram.Util._swapDirection(s.rotateAngle,ej.datavisualization.Diagram.Util._getDirection(h,a?a:h.center)),i._targetPortInfo=new IObstaclePort,e==="left"?i._targetPortInfo.Direction=PortDirection.Left:e==="right"?i._targetPortInfo.Direction=PortDirection.Right:e==="bottom"?i._targetPortInfo.Direction=PortDirection.Bottom:e==="top"&&(i._targetPortInfo.Direction=PortDirection.Top),i._targetPortInfo.Location=new Point(Number(a.x.toFixed(4)),Number(a.y.toFixed(4))))}else for(y=0;y<o.objects.length;y++)if(u=o.objects[y],u){var r=ej.datavisualization.Diagram.Util.bounds(u),p=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),k=new Rect(r.left-this.ObstaclePadding,r.top-this.ObstaclePadding,r.right-r.left+2*this.ObstaclePadding,r.bottom-r.top+2*this.ObstaclePadding);u._obstacle?u._obstacle._outerBounds=p:u._obstacle={OuterBounds:p};u._outerBounds=p;u._obstacle.CenterPort=new CenterPort(k.center())}},n.prototype.AddNode=function(n){this.router!=null&&this.router.AddNode(n)},n.prototype.RemoveNode=function(n){this.router!=null&&this.router.RemoveNode(n)},n.prototype.SetObstacles=function(n,t){this.KnownObstacles=n;this.VisibleConnectors=t},n}(),LineRoutingSettings=function(){function n(){this.bendEquivalence=0;this.obstaclePadding=0;this.bendEquivalence=5;this.priority=RoutingPriority.Routing;this.obstaclePadding=12;this.loadingPriority=LoadingPriority.DelayedDiagramLoading}return n}(),VertexQueue=function(){function n(){this.vertexQueue=new List;this.timeStamp=0}return n.prototype.getnextTimeStamp=function(){return++this.timeStamp},n.prototype.Enqueue=function(n){n.TimeStamp=this.getnextTimeStamp();this.Sort(n)},n.prototype.Sort=function(n){var t=this.vertexQueue.size(),i,r;if(this.vertexQueue.add(n),t>0)while(t>0&&this.vertexQueue.get(t>>1).CompareTo(this.vertexQueue.get(t))>0)i=t>>1,r=this.vertexQueue.get(i),this.vertexQueue.UpdateListValue(i,this.vertexQueue.get(t)),this.vertexQueue.UpdateListValue(t,r),t>>=1},n.prototype.Dequeue=function(){var n=this.vertexQueue.get(0);return this.MoveQueueOneStepForward(n),n},n.prototype.MoveQueueOneStepForward=function(){var u=this.vertexQueue.size()-2,f,t,n,i,r;if(this.vertexQueue.size()>1)for(f=this.vertexQueue.Last(),this.vertexQueue.RemoveAt(this.vertexQueue.size()-1),this.vertexQueue.UpdateListValue(0,f),t=0;;){if(n=t,i=t<<1,i<=u&&this.vertexQueue.get(i).CompareTo(this.vertexQueue.get(t))<0&&(n=i),r=i+1,r<=u&&this.vertexQueue.get(r).CompareTo(this.vertexQueue.get(n))<0&&(n=r),n!=t)this.SwapWithParent(n);else break;t=n}else this.vertexQueue.RemoveAt(0)},n.prototype.DecreasePriority=function(n,t){var r,u,i;if(t=Math.round(t),r=this.vertexQueue.IndexOf(n),r!=-1)for(u=this.vertexQueue.get(r),u.Cost=t,i=r;i>0;){if(this.vertexQueue.get(i).CompareTo(this.vertexQueue.get(i>>1))<0)this.SwapWithParent(i);else break;i>>=1}},n.prototype.SwapWithParent=function(n){var t=this.vertexQueue.get(n>>1);this.vertexQueue.UpdateListValue(n>>1,this.vertexQueue.get(n));this.vertexQueue.UpdateListValue(n,t)},n.prototype.Count=function(){return this.vertexQueue.size()},n.prototype.ToString=function(){for(var i,t="",n=0;n<this.vertexQueue.size();n++)i=this.vertexQueue[n],t+=i;return t},n}(),Neighbor=function(){function n(){this.Weight=0;this.Clear()}return n.prototype.Set=function(n,t){this.Vertex=n;this.Weight=t},n.prototype.Clear=function(){this.Vertex=null;this.Weight=Number.NaN},n}(),NeighborSides=function(){function n(){}return n}(),ShortestPath=function(){function n(n,t,i){this.cancel=!1;this.upperBoundCost=Number.MAX_VALUE;this.targetConnector=null;this.bendEquivalence=0;this.bendsImportance=1;this.lengthImportance=1;this.visitedVertices=new List;this.queue=new VertexQueue;this.mode=RoutingSolution.Quick;this.neighbors=[new Neighbor,new Neighbor,new Neighbor];this.visibilityGraph=n;this.targetConnector=i;this.bendEquivalence=t}return n.prototype.GetSingleStagePath=function(n){var t=this.FindPath(n),i=this.GetEntries(t);return this.GetPoints(i)},n.prototype.GetEntries=function(n){var t=new List,r=Directions.None,i=!1;if(n!=null)while(n!=null){if(n.Direction!=r?(t.Insert(0,n),r=n.Direction,i=!1):i=!0,n.PreviousEntry==null){i&&t.Insert(0,n);break}n=n.PreviousEntry}return t},n.prototype.GetPoints=function(n){var i=new PointList,f,t,l,o,s,h,u;if(n.size()>0){if(f=n.size()-1,n.size()>4&&(t=n.size(),n.get(t-2).Direction==n.get(t-4).Direction)){for(var c=n.get(t-4).Vertex,e=null,r=c.FindNextVertex(n.get(t-4).Direction);r!=null;)e=r,r=r.FindNextVertex(n.get(t-4).Direction);e!=null&&this.targetConnector.TargetEntrance!=null&&(l=new Segment(c.Point,e.Point),o=this.targetConnector.TargetEntrance.MaxVisibilitySegment,o!=null&&(h=Utility.SegmentIntersects(l,o,s),s=h.intersect,h.isInterSect&&(i.add(s),i.add(n.get(t-1).Vertex.Point),f=t-5)))}for(u=f;u>=0;u--)i.Insert(0,n.get(u).Vertex.Point)}return i},n.prototype.FindPath=function(n){for(var i,f,e,r,o=Number.POSITIVE_INFINITY,t=null,u=0;u<n.size();u++)if(i=n.get(u),!this.cancel&&(t==null||i.getMinimalBend()<t.NumberOfBends||i.getIsPreferred()&&i.getMinimalBend()==t.NumberOfBends))f=i.getSourceEntry().Point,e=i.getTargetEntry().Point,this.bendsImportance=Math.max(.01,f.ManhattanDistance(e)*this.bendEquivalence*.01),this.mode=RoutingSolution.Best,r=this.FindPath_Point(f,e),r!=null&&(t==null||o>r.Cost)&&(t=r,o=r.Cost);else break;return t},n.prototype.FindPath_Point=function(n,t){var o,i,s,h,r,u,f,e;for(n.round(),t.round(),this.InitializePath(n,t),o=this.visibilityGraph.FindVertex(t),h=0;this.queue.Count()>0;){if(this.cancel)break;if(h++,i=this.queue.Dequeue(),s=i.Vertex,o==s)return this.Cleanup(),i;for(i.Closed=!0,u=0;u<this.neighbors.length;u++)r=this.neighbors[u],r.Clear();if(f=Extensions.Right(i.Direction),f!=Directions.None)for(this.ExtendPathAlongInEdges(i,f),this.ExtendPathAlongOutEdges(i,f),e=0;e<this.neighbors.length;e++)r=this.neighbors[e],r.Vertex!=null&&this.ExtendPathToNeighborVertex(i,r.Vertex,r.Weight)}return this.Cleanup(),null},n.prototype.InitializePath=function(n,t){var i,u,r;this.queue=new VertexQueue;i=this.visibilityGraph.FindVertex(n);u=this.visibilityGraph.FindVertex(t);this.Source=i;this.InitEntryDirectionsAtTarget(u);i!=null&&(r=new VertexEntry(i,null,0,0,0),r.Closed=!0,this.EnqueueOutEdges(r),this.EnqueueInEdges(r))},n.prototype.ExtendPathAlongInEdges=function(n,t){var i=n.Vertex.getWestEdge();i!=null&&this.ExtendPathAlongEdge(n,i.getSource(),i,t);i=n.Vertex.getSouthEdge();i!=null&&this.ExtendPathAlongEdge(n,i.getSource(),i,t)},n.prototype.ExtendPathAlongOutEdges=function(n,t){var i=n.Vertex.getEastEdge();i!=null&&this.ExtendPathAlongEdge(n,i.getTarget(),i,t);i=n.Vertex.getNorthEdge();i!=null&&this.ExtendPathAlongEdge(n,i.getTarget(),i,t)},n.prototype.ExtendPathAlongEdge=function(n,t,i,r){if(n.PreviousEntry==null||t!=n.PreviousEntry.Vertex){var u=this.neighbors[2],f=n.Vertex.Point.FindDirection(t.Point);f!=n.Direction&&(u=this.neighbors[f==r?1:0]);u.Set(t,i.getWeight())}else t==n.PreviousEntry.Vertex&&(n.Vertex.getDegree()>1||n.Vertex!=this.Source)&&this.ExtendPathToNeighborVertex(n,t,i.getWeight())},n.prototype.EnqueueEdges=function(n,t,i){var u=t.getWeight(),r;(this.EntryDirectionsToTarget&t.getSourcePoint().FindDirection(t.getTargetPoint()))==0&&(u=1.5);r=null;switch(i){case Directions.East:case Directions.North:r=t.getTarget();break;case Directions.West:case Directions.South:r=t.getSource()}this.ExtendPathToNeighborVertex(n,r,u)},n.prototype.EnqueueOutEdges=function(n){var t=n.Vertex;t.getEastEdge()!=null&&this.EnqueueEdges(n,t.getEastEdge(),Directions.East);t.getNorthEdge()!=null&&this.EnqueueEdges(n,t.getNorthEdge(),Directions.North)},n.prototype.EnqueueInEdges=function(n){var t=n.Vertex;t.getWestEdge()!=null&&(n.PreviousEntry==null||t.getWestEdge().getSource()!=n.PreviousEntry.Vertex)&&this.EnqueueEdges(n,t.getWestEdge(),Directions.West);t.getSouthEdge()!=null&&(n.PreviousEntry==null||t.getSouthEdge().getSource()!=n.PreviousEntry.Vertex)&&this.EnqueueEdges(n,t.getSouthEdge(),Directions.South)},n.prototype.ExtendPathToNeighborVertex=function(n,t,i){var f=n.Vertex.Point.FindDirection(t.Point),r=null,u;t.VertexEntries!=null&&(r=t.VertexEntries[Extensions.ToIndex(f)]);r==null?this.CheckExistingReverseEntry(n,t,i)||this.CreateAndEnqueueEntryToNeighborVertex(n,t,i):r.Closed||this.mode==RoutingSolution.Quick||(u=this.UpdateEntryToNeighborVertexIfNeeded(n,r,i),i=u.weight)},n.prototype.UpdateEntryToNeighborVertexIfNeeded=function(n,t,i){var r=0,u=0,f=this.UpdatePathLength(n,t.Vertex,i,r,u),o=f.direction,e;return i=f.weight,r=f.bends,u=f.length,this.CombinedCost(u,r)<this.CombinedCost(t.Length,t.NumberOfBends)&&(e=this.CombinedCost(u,r)+this.HeuristicDistanceFromVertexToTarget(t.Vertex.Point,o),t.ResetEntry(n,e,r,u),this.queue.DecreasePriority(t,e)),{weight:i}},n.prototype.CreateAndEnqueueEntryToNeighborVertex=function(n,t,i){var r=0,u=0,f=this.UpdatePathLength(n,t,i,u,r),o=f.direction,e;i=f.weight;u=f.bends;r=f.length;e=this.CombinedCost(r,u)+this.HeuristicDistanceFromVertexToTarget(t.Point,o);e<this.upperBoundCost&&(t.VertexEntries==null&&this.visitedVertices.add(t),this.EnqueueVertex(t,n,r,e,u))},n.prototype.ToIndex=function(n){switch(n){case Directions.North:return 0;case Directions.East:return 1;case Directions.South:return 2;case Directions.West:return 3}},n.prototype.CheckExistingReverseEntry=function(n,t,i){var r,u;return n.Vertex.VertexEntries!=null&&(r=t.Point.FindDirection(n.Vertex.Point),r!=Directions.None&&(u=n.Vertex.VertexEntries[this.ToIndex(r)],u!=null))?(this.CheckTheNeedOfReverseEntry(n,u,i),!0):!1},n.prototype.CheckTheNeedOfReverseEntry=function(n,t,i){var r=0,u=0,e=t.PreviousEntry.Vertex,f=this.UpdatePathLength(n,e,i,r,u),o=f.direction,s;i=f.weight;r=f.bends;u=f.length;o!=Directions.None&&this.CombinedCost(u,r)<this.CombinedCost(t.Length,t.NumberOfBends)&&(s=this.CombinedCost(u,r)+this.HeuristicDistanceFromVertexToTarget(e.Point,o),this.EnqueueVertex(e,n,u,s,r))},n.prototype.CombinedCost=function(n,t){return Number((this.bendsImportance*t+this.lengthImportance*n).toFixed(4))},n.prototype.UpdatePathLength=function(n,t,i,r,u){var f=n.Vertex.Point.FindDirection(t.Point),o,e;return this.mode==RoutingSolution.Quick?(u=0,r=n.NumberOfBends,o=t.Point.FindDirection(this.Target.Point),e=0,n.Direction!=Directions.None&&(e=(f&o)!=Directions.None?n.Direction==f?0:0:2),r+=e):(u=n.Length+n.Vertex.Point.ManhattanDistance(t.Point)*i,r=n.NumberOfBends,n.Direction!=Directions.None&&n.Direction!=f&&r++),{direction:f,weight:i,bends:r,length:u}},n.prototype.EnqueueVertex=function(n,t,i,r,u){var f=new VertexEntry(n,t,i,u,r);return this.queue.Enqueue(f),n.SetVertexEntry(f),f},n.prototype.InitEntryDirectionsAtTarget=function(n){return this.Target=n,this.EntryDirectionsToTarget=Directions.None,n.getEastEdge()!=null&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.East),n.getNorthEdge()!=null&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.North),n.getWestEdge()!=null&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.West),n.getSouthEdge()!=null&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.South),this.EntryDirectionsToTarget!=Directions.None},n.prototype.HeuristicDistanceFromVertexToTarget=function(n,t){var r=this.Target.Point.subtract(n),u=Extensions.VectorDirection(r),i;return r.equals(new Point(0,0))?0:(i=0,t==Directions.None?(t=Directions.East|Directions.North|Directions.West|Directions.South,i=this.GetNumberOfBends(t,u)):i=this.GetNumberOfBends(t,u),this.CombinedCost(n.ManhattanDistance(this.Target.Point),i))},n.prototype.GetNumberOfBends=function(t,i){return Extensions.IsPureDirection(i)?this.GetNumberOfBendsForPureDirection(t,i):n.GetBendsForNotPureDirection(i,t,this.EntryDirectionsToTarget)},n.prototype.GetNumberOfBendsForPureDirection=function(t,i){return(i&t)==i?Extensions.Contains(this.EntryDirectionsToTarget,i)?0:Extensions.Contains(this.EntryDirectionsToTarget,Extensions.Left(i))||Extensions.Contains(this.EntryDirectionsToTarget,Extensions.Right(i))?2:4:this.GetNumberOfBendsForPureDirection(n.AddOneTurn[t],i)+1},n.GetBendsForNotPureDirection=function(t,i,r){var u=t&i,f;return i!=Directions.None?u==Directions.None?1:(f=t&r,f==Directions.None)?2:u==t?1:2:this.GetBendsForNotPureDirection(t,n.AddOneTurn[i],n.AddOneTurn[r])+1},n.prototype.Cleanup=function(){for(var n=0;n<this.visitedVertices.size();n++)this.visitedVertices.get(n).RemoveVertexEntries();this.visitedVertices.Clear();this.queue=null},n.prototype.CancelRouting=function(){this.cancel=!0},n.AddOneTurn=[Directions.None,Directions.North|Directions.East|Directions.West,Directions.North|Directions.East|Directions.South,15,Directions.East|Directions.South|Directions.West,15,15,15,13,15,15,15,15,15,15,15],n}(),Router=function(){function n(){this.obstaclesToAdd=new List;this.obstaclesToRemove=new List;this.BendEquivalence=0;this.ObstaclePadding=0;this.cancel=!1;this.graph=null;this.obstacleTree=null;this.portManager=null;this.isAddingObstacle=!1;this.isRemovingObstacle=!1;this.Priority=RoutingPriority.Default;this.BendEquivalence=5;this.ObstaclePadding=12;this.horizontalSegmentTree=new SegmentTree(!1,this);this.verticalSegmentTree=new SegmentTree(!0,this);this.horizontalSegmentTree.setPerpendicularTree(this.verticalSegmentTree);this.verticalSegmentTree.setPerpendicularTree(this.horizontalSegmentTree);this.vertexToRemove={}}return n.prototype.getHorizontalSegmentTree=function(){return this.horizontalSegmentTree},n.prototype.getVerticalSegmentTree=function(){return this.verticalSegmentTree},n.prototype.Router=function(n,t,i,r){return this.diagram=r,this.Priority=n,this.BendEquivalence=t,this.ObstaclePadding=i,this.horizontalSegmentTree=new SegmentTree(!1,this),this.verticalSegmentTree=new SegmentTree(!0,this),this.horizontalSegmentTree.setPerpendicularTree(this.verticalSegmentTree),this.verticalSegmentTree.setPerpendicularTree(this.horizontalSegmentTree),this},n.prototype.MinimumSegmentLength=function(n){if(n.size()>1){var t=n.ElementAt(0),i=n.ElementAt(n.size()-2),r=n.ElementAt(1),u=n.ElementAt(n.size()-1),f=Extensions.FindDistance(t,r,Extensions.GetOrientation(Extensions.FindDirection(t,r))),e=Extensions.FindDistance(i,u,Extensions.GetOrientation(Extensions.FindDirection(i,u)));return Math.min(Number(Math.round(f).toFixed(4)),Number(Math.round(e).toFixed(4)))}return 0},n.prototype.IsMinimalPointCollection=function(n){if(n.size()>1){var r=n.ElementAt(0),u=n.ElementAt(n.size()-2),f=n.ElementAt(1),e=n.ElementAt(n.size()-1),t=Extensions.GetOrientation(r.FindDirection(f)),i=Extensions.GetOrientation(u.FindDirection(e));if(t==i&&n.size()<=4||t!=i&&n.size()==3)return!0}return!1},n.prototype.GenerateVisibilityGraph=function(n,t){var u,r,i;if(this.currentBounds=Rect.empty,u=new List,this.obstacleTree=new ObstacleTree,this.obstacleTree.InitObstacles(u,this.ObstaclePadding,t),this.graph=new VisibilityGraph,r=new EdgeGeometry,this.portManager=new PortManager(this.horizontalSegmentTree,this.verticalSegmentTree,this.obstacleTree,this.graph,r,this.ObstaclePadding),this.pathfinder=new ShortestPath(this.graph,this.BendEquivalence,r),n.length>0){for(i=0;i<n.length;i++)n[i]._obstacle=null,this.AddNode(n[i]);this.InvalidateRouter()}},n.prototype.RouteEdge=function(n,t){var r,i,h,f,c,l,o,a,v,y,e,u,s;this.diagram=t;r=new PointList;i=new PointList;this.InvalidateRouter();h=this.portManager.IsCurrentConnectionSegmentsValid(n,r);r=h.points;this.CanRoute(n)&&n._sourceNodeInfo!=null&&n._targetNodeInfo!=null?(this.portManager.temporaryAddition=!0,f=this.portManager.GetPortVisibilityIntersection(n),f!=null&&f.size()>0?(i=f,i.size()==0&&(n._points=i)):this.portManager.AddControlPointsToGraph(n)&&(c=n._sourcePortInfo?n._sourcePortInfo:n._sourceNodeInfo._obstacle.CenterPort,l=n._targetPortInfo?n._targetPortInfo:n._targetNodeInfo._obstacle.CenterPort,i=this.pathfinder.GetSingleStagePath(this.GetPossibleEntries(c,l))),i.size()>0&&(r.size()>0?i.size()<r.size()?n._points=i:i.size()>r.size()?n._points=r:(o=this.MinimumSegmentLength(r),a=this.MinimumSegmentLength(i),o<this.ObstaclePadding&&o<a?n._points=i:(v=Extensions.GetLengthFromListOfPoints(i),y=Extensions.GetLengthFromListOfPoints(r),n._points=v<=y?i:r)):n._points=i)):this.CanRoute(n)&&(n._sourceNodeInfo!=null||n._targetNodeInfo!=null)?(this.portManager.temporaryAddition=!0,e=n._sourcePortInfo,u=n._targetPortInfo,e=e==null&&n._sourceNodeInfo instanceof IObstacle?n._sourceNodeInfo._obstacle.CenterPort:n._sourcePointInfo,u=u==null&&n._targetNodeInfo instanceof IObstacle?n._targetNodeInfo._obstacle.CenterPort:n._targetPointInfo,s=u.getLocation(),u.setLocation(this.portManager.GetValidPortLocation(s)),this.portManager.AddControlPointsToGraph(n)?(n._points=this.pathfinder.GetSingleStagePath(this.GetPossibleEntries(e,u)),n._points!=null&&n._points.Count>0&&(n._points.RemoveAt(n._points.Count-1),n._points.Insert(n._points.Count,s))):n._points=r):n._points=new PointList;this.portManager.RemoveEdgeGeometryFromGraph();this.portManager.temporaryAddition=!1},n.prototype.CanRoute=function(n){if(ej.datavisualization.Diagram.Util.canRouteConnector(n,this.diagram)){if(n.sourcePort!=null&&n.targetPort!=null){var f=n.sourcePort,e=n.sourcePort,t=new Point(n.sourcePoint.x,n.sourcePoint.y),i=new Point(n.targetPoint.x,n.targetPoint.y),r=(new Rect).Rect(new Point(t.x,t.y),new Point(t.x,t.y)),u=(new Rect).Rect(new Point(i.x,i.y),new Point(i.x,i.y));if(r=r.Inflate(this.ObstaclePadding),u=u.Inflate(this.ObstaclePadding),r.intersects(u))return!1}return!0}},n.prototype.AddVertex=function(n){var t=this.graph.AddVertex(n);return Extensions.Count(this.vertexToRemove)!=0&&Extensions.ContainsKey(this.vertexToRemove,t.Point)&&Extensions.Remove(this.vertexToRemove,t.Point),t},n.prototype.GetMaximumVisibility=function(n,t){var r,i;return t!=Directions.None&&(r=t==Directions.West?new Point(this.currentBounds.x,n.y):t==Directions.East?new Point(this.currentBounds.right(),n.y):t==Directions.South?new Point(n.x,this.currentBounds.top()):new Point(n.x,this.currentBounds.bottom()),i=new Segment(n,r),this.obstacleTree.FindMaximumVisibility(i,this.currentNode))?Extensions.IsAscending(t)?new Segment(i.StartPoint,i.EndPoint):new Segment(i.EndPoint,i.StartPoint):null},n.prototype.ResetDependentCollection=function(){var n,t;for(n in this.vertexToRemove)t=Extensions.ElementAt(this.vertexToRemove,n),this.graph.RemoveVertex(t);this.vertexToRemove=Extensions.Clear(this.vertexToRemove);this.horizontalSegmentTree.getCoordsToReconstruct().Clear();this.verticalSegmentTree.getCoordsToReconstruct().Clear()},n.prototype.InvalidateRouter=function(){for(var n;this.obstaclesToRemove.size();)n=this.obstaclesToRemove.get(0),this.obstaclesToRemove.RemoveAt(0),this.RemoveObstacleforNode(n);while(this.obstaclesToAdd.size())n=this.obstaclesToAdd.get(0),this.obstaclesToAdd.RemoveAt(0),this.AddObstacleforNode(n)},n.prototype.ForceInvalidateRouter=function(){this.InvalidateRouter()},n.prototype.AddNode=function(n){this.obstaclesToAdd.contains(n)||(n._obstacle==null||this.obstaclesToRemove.contains(n))&&this.obstaclesToAdd.add(n)},n.prototype.RemoveNode=function(n){n._obstacle==null||this.obstaclesToRemove.contains(n)||this.obstaclesToRemove.add(n)},n.prototype.AddObstacleforNode=function(n){var u;this.portManager.temporaryAddition=!1;this.isAddingObstacle=!0;this.ResetDependentCollection();var o=ej.datavisualization.Diagram.Util.bounds(n),t=new Rect(o.left,o.top,o.right-o.left,o.bottom-o.top),s=this.obstacleTree.Rectangle;if(n._obstacle==null&&!(t.width==0)&&!(t.height==0)){this.currentNode=n;n._obstacle=(new Obstacle)._obstacle(t,this.ObstaclePadding);var i=0,r=0,f=0,e=0;n._obstacle.getPaddedBounds()!=null&&(t=n._obstacle.getPaddedBounds().round(),i=Utility.ToRoundedInt(t.left()),r=Utility.ToRoundedInt(t.top()),f=Utility.ToRoundedInt(t.right()),e=Utility.ToRoundedInt(t.bottom()),u=0,u!=0&&(i+=i%u!=0?u-i%u:0,r+=r%u!=0?u-r%u:0,f-=f%u!=0?f%u:0,e-=e%u!=0?e%u:0,t=new Rect(i,r,f-i,e-r),n._obstacle.setPaddedBounds(t)),n._outerBounds=t,n._obstacle.CenterPort=new CenterPort(n._obstacle.getPaddedBounds().center()));this.verticalSegmentTree.getVectors().Count()!=0&&this.horizontalSegmentTree.getVectors().Count()!=0&&(i=Math.min(this.horizontalSegmentTree.getStart(),i),r=Math.min(this.verticalSegmentTree.getStart(),r),f=Math.max(this.horizontalSegmentTree.getEnd(),f),e=Math.max(this.verticalSegmentTree.getEnd(),e));(i<s.left()||f>s.right())&&this.horizontalSegmentTree.ExpandOrCollapseSegmentTree(i,f,!0);(r<s.top()||e>s.bottom())&&this.verticalSegmentTree.ExpandOrCollapseSegmentTree(r,e,!0);this.obstacleTree.Rectangle=new Rect(i,r,f-i,e-r);this.currentBounds=this.obstacleTree.Rectangle;this.horizontalSegmentTree.InitializeVectorCoordinate(t);this.verticalSegmentTree.InitializeVectorCoordinate(t);this.horizontalSegmentTree.InsertObstacle(t);this.verticalSegmentTree.InsertObstacle(t);this.horizontalSegmentTree.SplitSegments(t);this.verticalSegmentTree.SplitSegments(t);this.horizontalSegmentTree.RemoveUnUsedVector();this.verticalSegmentTree.RemoveUnUsedVector();this.ResetDependentCollection()}this.isAddingObstacle=!1;this.portManager.temporaryAddition=!0},n.prototype.RemoveObstacleforNode=function(n){var t,r,i,u;if(n._obstacle!=null){t={};r=n._obstacle.getPaddedBounds()&&n._obstacle?n._obstacle.getPaddedBounds().round():new Rect(0,0,0,0);t=Extensions.add(t,n,r);n._obstacle=null;this.GetIntersectionObstacle(r,t);for(i in t)this.RemoveObstacle(Extensions.getFromDictionary(t,Extensions.KeytAt(t,i))),delete n._obstacle;for(i in t)u=Extensions.KeytAt(t,i),u.name!==n.name&&this.AddNode(u)}},n.prototype.RemoveObstacle=function(n){var o;if(this.portManager.temporaryAddition=!1,this.isRemovingObstacle=!0,this.vertexToRemove={},this.horizontalSegmentTree.getCoordsToReconstruct().Clear(),this.verticalSegmentTree.getCoordsToReconstruct().Clear(),this.horizontalSegmentTree.InitializeVectorCoordinate(n),this.verticalSegmentTree.InitializeVectorCoordinate(n),this.ConnectSegmentDelegate(n,!0),this.ConnectSegmentDelegate(n,!1),this.horizontalSegmentTree.RemoveObstacle(n,this),this.verticalSegmentTree.RemoveObstacle(n,this),this.DisconnectVertexandEdges(this.horizontalSegmentTree),this.DisconnectVertexandEdges(this.verticalSegmentTree),this.horizontalSegmentTree.RemoveUnUsedVector(),this.verticalSegmentTree.RemoveUnUsedVector(),this.verticalSegmentTree.getVectors().Count()!=0){var r=this.verticalSegmentTree.getVectors().Count(),u=this.horizontalSegmentTree.getVectors().Count(),t=r>0?Number(this.verticalSegmentTree.getVectors().KeyAt(0)):0,i=u>0?Number(this.horizontalSegmentTree.getVectors().KeyAt(0)):0,f=r>0?Number(this.verticalSegmentTree.getVectors().KeyAt(this.verticalSegmentTree.getVectors().Count()-1)):0,e=u>0?Number(this.horizontalSegmentTree.getVectors().KeyAt(this.horizontalSegmentTree.getVectors().Count()-1)):0;this.obstacleTree.Rectangle=new Rect(t,i,f-t,e-i);this.horizontalSegmentTree.ExpandOrCollapseSegmentTree(t,f);this.verticalSegmentTree.ExpandOrCollapseSegmentTree(i,e)}else this.obstacleTree.Rectangle=Rect.empty;if(this.currentBounds=this.obstacleTree.Rectangle,Extensions.Count(this.vertexToRemove)!=0){for(o in this.vertexToRemove)this.graph.RemoveVertex(Extensions.getFromDictionary(this.vertexToRemove,Extensions.KeytAt(this.vertexToRemove,o)));this.vertexToRemove=Extensions.Clear(this.vertexToRemove)}this.isRemovingObstacle=!1;this.portManager.temporaryAddition=!0},n.prototype.GetIntersectionObstacle=function(n,t){for(var i,u,f=this.obstacleTree.FindNodes(n),r=0;r<f.size();r++)i=f.get(Number(r)),i._obstacle!=null&&(u=i._obstacle.getPaddedBounds().round(),t=Extensions.add(t,i,u),i._obstacle=null,this.GetIntersectionObstacle(u,t))},n.prototype.SplitSegment=function(n,t){var h=Utility.ToRoundedInt(n.top()),c=Utility.ToRoundedInt(n.bottom()),l=Utility.ToRoundedInt(n.left()),a=Utility.ToRoundedInt(n.right()),v=t.getParentTree().getPerpendicularTree(),f=t.FindSegment(t.getIsVertical()?h:l),e=t.FindSegment(t.getIsVertical()?c:a),o=t.getIsVertical()?new Point(t.getCoord(),h):new Point(l,t.getCoord()),s=t.getIsVertical()?new Point(t.getCoord(),c):new Point(a,t.getCoord()),i,r;if(f!=null){var y=v.getVectors().GetValue(t.getIsVertical()?h:l),p=y.FindSegment(t.getCoord()),u=t.getIsVertical()?Directions.North:Directions.East;if(p!=null)this.RemoveEdgesBetween(o,s,u);else for(i=this.graph.FindVertex(f.getStartPoint());i!=null;)if(r=i.FindNextVertex(u),r&&r.Point.OperatorLessThan(o))i=r;else{this.RemoveEdgesBetween(i.Point,s,u);f.UpdateSegmentPoint(i.Point,!1);f.RemoveNotInRangeSharedCoordinates();break}}if(e!=null){var w=v.getVectors().GetValue(t.getIsVertical()?c:a),b=w.FindSegment(t.getCoord()),u=t.getIsVertical()?Directions.South:Directions.West;if(b!=null)this.RemoveEdgesBetween(s,o,u);else for(i=this.graph.FindVertex(e.getEndPoint());i!=null;)if(r=i.FindNextVertex(u),r!=null&&r.Point.OperatorGreaterThan(s))i=r;else{this.RemoveEdgesBetween(i.Point,o,u);e.UpdateSegmentPoint(i.Point,!0);e.RemoveNotInRangeSharedCoordinates();break}}this.RemoveUnsharedSegmentsFromVector(t)},n.prototype.RemoveEdgesBetween=function(n,t,i){var u=this.graph.FindVertex(n),r,f,e;if(u!=null){for(r=u.FindNextVertex(i),f=n.OperatorLessThan(t)?!0:!1;r!=null&&(f&&r.Point.OperatorLessThan(t)||!f&&r.Point.OperatorGreaterThan(t));)Extensions.ContainsKey(this.vertexToRemove,r.Point)||(this.vertexToRemove=Extensions.add(this.vertexToRemove,r.Point,r)),e=this.graph.RemoveEdge(u,r),u=r,r=u.FindNextVertex(i);r!=null&&this.graph.RemoveEdge(u,r)}},n.prototype.ConnectSegmentDelegate=function(n,t){for(var a=t?this.verticalSegmentTree:this.horizontalSegmentTree,d=Utility.ToRoundedInt(n.top()),g=Utility.ToRoundedInt(n.bottom()),nt=Utility.ToRoundedInt(n.left()),tt=Utility.ToRoundedInt(n.right()),rt=a.getIsVertical()?Utility.ToRoundedInt(n.left()):Utility.ToRoundedInt(n.top()),ut=a.getIsVertical()?Utility.ToRoundedInt(n.right()):Utility.ToRoundedInt(n.bottom()),ft=a.getVectors().IndexOfKey(rt),et=a.getVectors().IndexOfKey(ut),w=ft+1,b,k,p,h,it,s,r,v,o,y,l,f;w<et;){var e=a.getVectors().GetValue(a.getVectors().KeyAt(w)),u=e.FindSegment(t?d:nt),i=e.FindSegment(t?g:tt),c=t?Directions.North:Directions.East;if(u!=i)if(u!=null&&(b=u.getEndPoint(),p=t?Utility.ToRoundedInt(b.y):Utility.ToRoundedInt(b.x),u.RemoveSharedCoordinates(p)),i!=null&&(k=i.getStartPoint(),p=t?Utility.ToRoundedInt(k.y):Utility.ToRoundedInt(k.x),i.RemoveSharedCoordinates(p)),u!=null&&i!=null){for(u.UpdateSegmentPoint(i.getEndPoint(),!1),f=0;f<i.getSharedCoordinates().Count();f++)h=i.getSharedCoordinates().KeyAt(f),it=i.getSharedCoordinates().GetValue(h),u.getSharedCoordinates().Add(it,h);i.getSharedCoordinates().Clear();this.RefreshSegmentEgdes(u);e.RemoveSegmentFromVector(i)}else if(u!=null){if(r=this.GetMaximumVisibility(u.getEndPoint(),c),r==null&&(v=c==Directions.East?new Point(tt,u.getEndPoint().y):new Point(u.getEndPoint().x,g),r=this.GetMaximumVisibility(v,Extensions.OppositeDirection(c)),r!=null&&(r.StartPoint.equals(u.getStartPoint())||r.StartPoint.equals(u.getEndPoint()))?(o=this.GetMaximumVisibility(v,c),o==null||o.StartPoint.equals(o.EndPoint)?r=null:r.EndPoint=o.EndPoint):r=null),r!=null)if(y=e.getSegments().IndexOf(u),s=null,y<e.getSegments().size()-1&&(s=e.getSegments().get(y+1)),s!=null&&s.getStartPoint().OperatorLessThan(r.EndPoint)){for(u.UpdateSegmentPoint(s.getEndPoint(),!1),f=0;f<s.getSharedCoordinates().Count();f++)h=s.getSharedCoordinates().KeyAt(f),u.getSharedCoordinates().Add(s.getSharedCoordinates().GetValue(h),h);s.getSharedCoordinates().Clear();this.RefreshSegmentEgdes(u);e.RemoveSegmentFromVector(s)}else u.UpdateSegmentPoint(r.EndPoint,!1),this.RefreshSegmentEgdes(u)}else if(i!=null&&(r=this.GetMaximumVisibility(i.getStartPoint(),Extensions.OppositeDirection(c)),r==null&&(v=c==Directions.East?new Point(nt,i.getEndPoint().y):new Point(i.getEndPoint().x,d),r=this.GetMaximumVisibility(v,Extensions.OppositeDirection(c)),r!=null&&(r.EndPoint.equals(i.getStartPoint())||r.EndPoint.equals(i.getEndPoint()))?(o=this.GetMaximumVisibility(v,c),o==null||o.StartPoint.equals(o.EndPoint)?r=null:r.StartPoint=o.StartPoint):r=null),r!=null))if(y=e.getSegments().IndexOf(i),l=null,y>0&&(l=e.getSegments().get(y-1)),l!=null&&l.getEndPoint().OperatorGreaterThan(r.StartPoint)){for(l.UpdateSegmentPoint(i.getEndPoint(),!1),f=0;f<i.getSharedCoordinates().Count();f++)h=i.getSharedCoordinates().KeyAt(f),l.getSharedCoordinates().Add(i.getSharedCoordinates().GetValue(h),h);i.getSharedCoordinates().Clear();this.RefreshSegmentEgdes(l);e.RemoveSegmentFromVector(i)}else i.UpdateSegmentPoint(r.StartPoint,!0),this.RefreshSegmentEgdes(i);w++}},n.prototype.ExtendScanSegment=function(n,t,i){var r=i?this.graph.FindVertex(n.getStartPoint()):this.graph.FindVertex(n.getEndPoint());r!=null&&(i?this.portManager.ConnectVertices_vertex(this.AddVertex(t),r):this.portManager.ConnectVertices_vertex(r,this.AddVertex(t)))},n.prototype.ConstructVertexandEdges=function(n){for(var t=0;t<n.size();t++)this.RefreshSegmentEgdes(n.get(t))},n.prototype.DisconnectVertexandEdges=function(n){for(var t=0;t<n.getCoordsToReconstruct().size();t++)this.RemoveUnsharedSegmentsFromVector(n.getVectors().GetValue(n.getCoordsToReconstruct().get(t)));n.getCoordsToReconstruct().Clear()},n.prototype.RemoveUnsharedSegmentsFromVector=function(n){for(var i=n.getIsVertical()?this.horizontalSegmentTree:this.verticalSegmentTree,h=0,u,y,r,l,a,c,o,s;h<n.getSegments().size();)if(u=n.getSegments().get(h),u.getSharedCoordinates().Count()!=0){h++;continue}else{for(var f=new List,t=this.graph.FindVertex(u.getStartPoint()),e=null,v=n.getIsVertical()?Directions.North:Directions.East;t!=null;)y=t.Point,r=n.getIsVertical()?Utility.ToRoundedInt(t.Point.y):Utility.ToRoundedInt(t.Point.x),i.getVectors().Count()!=0&&i.getVectors().ContainsKey(r)&&(l=n.getIsVertical()?Directions.East:Directions.North,this.portManager.DisconnectVertexInDirection(t,l)?f.add(r):(a=i.getVectors().GetValue(r),c=a.FindSegment(n.getCoord()),c!=null&&(this.portManager.RemoveVertexFromSegment_vertex(c,t),f.add(r)))),Extensions.ContainsKey(this.vertexToRemove,t.Point)||(this.vertexToRemove=Extensions.add(this.vertexToRemove,t.Point,t)),e!=null&&this.graph.RemoveEdge(e,t),e=t,t=t.FindNextVertex(v),e==t&&(t=null);for(n.RemoveSegmentFromVector(u),o=0;o<f.size();o++)s=f.get(o),i.getVectors().ContainsKey(s)&&!i.getCoordsToReconstruct().contains(s)&&this.RemoveUnsharedSegmentsFromVector(i.getVectors().GetValue(s))}},n.prototype.RefreshSegmentEgdes=function(n){var f,e,t,i,l,s,o;if(n!=null&&n.getSharedCoordinates().Count()!=0){var u=n.getIsVertical(),a=u?Directions.North:Directions.East,h=u?this.horizontalSegmentTree:this.verticalSegmentTree,c=h.FindIndexNumber(n.getStart()),v=h.FindIndexNumber(n.getEnd()),r=n.getParentVector().getCoord();if(c!=v)for(f=this.AddVertex(n.getStartPoint()),e=Utility.ToList(h.getVectors().Items()).GetRange(c,v-c+1),t=0;t<e.size();t++)i=e.get(t).value,l=i.FindSegment(r),l!=null?(o=u?new Point(r,i.getCoord()):new Point(i.getCoord(),r),s=this.AddVertex(o),this.portManager.AddVertexToSegment(l,s),t!=0&&this.portManager.ConnectVertices_vertex(f,s,1,a),f=s):t==e.size()-1&&(o=u?new Point(r,i.getCoord()):new Point(i.getCoord(),r),this.portManager.ConnectVertices_vertex(f,this.AddVertex(o),1,a))}},n.prototype.GetScanSegmentsFromBounds=function(n,t){var y=new List,c=t.getIsVertical()?this.horizontalSegmentTree:this.verticalSegmentTree,p=c.FindIndex(n.topLeft().round()),b=c.FindIndex(n.bottomRight().round()),f=Utility.ToRoundedInt(n.left()),e=t.getCoord()===f?n.topLeft():n.topRight(),o=t.getCoord()===f?n.bottomLeft():n.bottomRight(),s,w,i,k,h,r,v;if(t.getIsVertical()||(f=Utility.ToRoundedInt(n.top()),e=t.getCoord()===f?n.topLeft():n.bottomLeft(),o=t.getCoord()===f?n.topRight():n.bottomRight()),e=e.round(),o=o.round(),p!=b)for(s=p,w=new Point;s<b;){if(i=c.getVectors().GetValue(c.getVectors().KeyAt(s)),k=i.FindSegment(t.getCoord()),k!=null){var l=t.FindSegment(t.getIsVertical()?e.y:e.x),a=t.FindSegment(t.getIsVertical()?o.y:o.x),u=new Point(i.Coord,t.getCoord());t.getIsVertical()&&(u=new Point(t.getCoord(),i.Coord));l!=null&&l.Contains(u)||a!=null&&a.Contains(u)||(h=new Point(i.Coord+1,t.getCoord()),t.getIsVertical()&&(h=new Point(t.getCoord(),i.Coord+1)),l!=null&&l.Contains(h)||a!=null&&a.Contains(h)||(r=t.GetScanSegment(h),r==null||y.contains(r)?r==null&&s>p&&(v=new Point(i.Coord-1,t.getCoord()),t.getIsVertical()&&(v=new Point(t.getCoord(),i.Coord-1)),v.equals(w)&&t.GetScanSegment_startPoint(v,u)):r.getStartPoint().equals(u)?y.add(r):t.RemoveSegmentFromVector(r)));w=u}s++}return y},n.prototype.GetPossibleEntries=function(n,t){var u=2,e=new List,c=new List,o=new List,v=this.portManager.FindEntrances(n),y=this.portManager.FindEntrances(t),p=n.getLocation(),w=t.getLocation(),b,l,f,a,i;for(c.add(Extensions.FindDirection_orientation(p,w,Orientation.Horizontal)),c.add(Extensions.FindDirection_orientation(p,w,Orientation.Vertical)),l=0;l<c.size();l++)b=c.get(l),o.add(Extensions.OppositeDirection(b));for(l=0;l<v.size();l++)for(f=v.get(l),a=0;a<y.size();a++){var r=y.get(a),s=f.Point.y>r.Point.y,h=f.Point.x>r.Point.x;f.getEastEdge()!=null&&(i=c.contains(Directions.East),r.getEastEdge()!=null&&e.add(new ConnectablePath(u,f,r)),r.getWestEdge()!=null&&(i=i&&o.contains(Directions.West),u=h?4:2,e.add(new ConnectablePath(u,f,r,i))),r.getSouthEdge()!=null&&(i=i&&o.contains(Directions.South),u=!s&&!h?1:3,e.add(new ConnectablePath(u,f,r,i))),r.getNorthEdge()!=null&&(i=i&&o.contains(Directions.North),u=s&&!h?1:3,e.add(new ConnectablePath(u,f,r,i))));f.getWestEdge()!=null&&(i=c.contains(Directions.West),r.getWestEdge()!=null&&e.add(new ConnectablePath(u,f,r)),r.getEastEdge()!=null&&(i=i&&o.contains(Directions.East),u=h?2:4,e.add(new ConnectablePath(u,f,r,i))),r.getSouthEdge()!=null&&(i=i&&o.contains(Directions.South),u=!s&&h?1:3,e.add(new ConnectablePath(u,f,r,i))),r.getNorthEdge()!=null&&(i=i&&o.contains(Directions.North),u=s&&h?1:3,e.add(new ConnectablePath(u,f,r,i))));f.getNorthEdge()!=null&&(i=c.contains(Directions.North),r.getNorthEdge()!=null&&e.add(new ConnectablePath(u,f,r)),r.getSouthEdge()!=null&&(i=i&&o.contains(Directions.South),u=s?4:2,e.add(new ConnectablePath(u,f,r,i))),r.getEastEdge()!=null&&(i=i&&o.contains(Directions.East),u=!s&&h?1:3,e.add(new ConnectablePath(u,f,r,i))),r.getWestEdge()!=null&&(i=i&&o.contains(Directions.West),u=!s&&!h?1:3,e.add(new ConnectablePath(u,f,r,i))));f.getSouthEdge()!=null&&(i=c.contains(Directions.South),r.getSouthEdge()!=null&&e.add(new ConnectablePath(u,f,r)),r.getNorthEdge()!=null&&(i=i&&o.contains(Directions.North),u=s?2:4,e.add(new ConnectablePath(u,f,r,i))),r.getEastEdge()!=null&&(i=i&&o.contains(Directions.East),u=h&&s?1:3,e.add(new ConnectablePath(u,f,r,i))),r.getWestEdge()!=null&&(i=i&&o.contains(Directions.West),u=s&&!h?1:3,e.add(new ConnectablePath(u,f,r,i))))}return this.sortPossibleEntries(e)},n.prototype.sortPossibleEntries=function(n){for(var t,i=new List,r=new List,u=0;u<n.size();u++)t=n.get(u),t.getIsPreferred()?r.add(t):i.add(t);return i.sortByKey("MinimalBend"),r.sortByKey("MinimalBend"),n.Clear(),n.AddRange(r),n.AddRange(i),n},n}(),ConnectablePath=function(){function n(n,t,i,r){r===void 0&&(r=!1);this.m_MinimalBend=n;this.m_SourceEntry=t;this.m_TargetEntry=i;this.m_IsPreferred=r}return n.prototype.getMinimalBend=function(){return this.m_MinimalBend},n.prototype.getIsPreferred=function(){return this.m_IsPreferred},n.prototype.getSourceEntry=function(){return this.m_SourceEntry},n.prototype.getTargetEntry=function(){return this.m_TargetEntry},n}(),SegmentTree=function(){function n(n,t){this._mStart=Number.MAX_VALUE;this._mEnd=Number.MIN_VALUE;this._mIsVertical=!1;this.unUsedVectors=new List;this._mIsVertical=n;this._mOrientation=n?SegmentOrientation.Vertical:SegmentOrientation.Horizontal;this._mRouter=t;this._mVectors=new SortedList;this._mCoordsToReconstruct=new List}return n.prototype.getStart=function(){return this._mStart},n.prototype.setStart=function(n){this._mStart=Math.floor(n)},n.prototype.getEnd=function(){return this._mEnd},n.prototype.setEnd=function(n){this._mEnd=Math.floor(n)},n.prototype.getIsVertical=function(){return this._mIsVertical},n.prototype.getOrientation=function(){return this._mOrientation},n.prototype.getCoordsToReconstruct=function(){return this._mCoordsToReconstruct},n.prototype.setCoordsToReconstruct=function(n){this._mCoordsToReconstruct=n!=null?n:new List},n.prototype.getVectors=function(){return this._mVectors},n.prototype.setVectors=function(n){this._mVectors=n!=null?n:new SortedList},n.prototype.getPerpendicularTree=function(){return this._mPerpendicularTree},n.prototype.setPerpendicularTree=function(n){this._mPerpendicularTree=n},n.prototype.getRouter=function(){return this._mRouter},n.prototype.setRouter=function(n){this._mRouter=n},n.prototype.UpdateTreePoints=function(){if(this._mVectors.Count()!=0){var n=this._mVectors.GetValue(this._mVectors.KeyAt(0)),t=this._mVectors.GetValue(this._mVectors.KeyAt(this._mVectors.Count()-1));this.UpdateTreePoint(n.getStart(),!0);this.UpdateTreePoint(t.getEnd(),!1)}else this.UpdateTreePoint(Number.MAX_VALUE,!0),this.UpdateTreePoint(Number.MIN_VALUE,!1)},n.prototype.UpdateTreePoint=function(n,t,i){i===void 0&&(i=!1);t&&this._mStart!=n?this._mStart=n:t||this._mEnd==n||(this._mEnd=n);i||this._mVectors.Count()!=0||(t?this._mStart=Number.MAX_VALUE:this._mEnd=Number.MIN_VALUE)},n.prototype.ExpandOrCollapseSegmentTree=function(n,t,i){var u,r;if(i===void 0&&(i=!1),i)for(u in this._mVectors.Items())r=this._mVectors.ElementAt(u),this._mStart!=n&&r.ExpandSegmentVector(n,this._mStart,!0),this._mEnd!=t&&r.ExpandSegmentVector(t,this._mEnd,!1);this.UpdateTreePoint(n,!0,i);this.UpdateTreePoint(t,!1,i)},n.prototype.InitializeVectorCoordinate=function(n){var i=this._mIsVertical?Utility.ToRoundedInt(n.left()):Utility.ToRoundedInt(n.top()),t;this._mVectors.ContainsKey(i)||(this._mVectors.Add(new SegmentVector(i,this._mStart,this._mEnd,this._mOrientation,this),i),this.unUsedVectors.add(i));t=this._mIsVertical?Utility.ToRoundedInt(n.right()):Utility.ToRoundedInt(n.bottom());this._mVectors.ContainsKey(t)||(this._mVectors.Add(new SegmentVector(t,this._mStart,this._mEnd,this._mOrientation,this),t),this.unUsedVectors.add(t))},n.prototype.RemoveVectorCoordinate=function(n,t){t===void 0&&(t=!1);n.getSegments().size()==0&&(this._mVectors.Remove(n.getCoord()),n=null,t&&this.UpdateTreePoints())},n.prototype.InsertObstacle=function(n){var t=new List,i,r;for(t.add(this._mIsVertical?Utility.ToRoundedInt(n.left()):Utility.ToRoundedInt(n.top())),t.add(this._mIsVertical?Utility.ToRoundedInt(n.right()):Utility.ToRoundedInt(n.bottom())),i=0;i<t.size();i++){var u=t.get(i),e=this._mVectors.GetValue(u),f=e.InsertObstacle(n);if(e.UpdateVectorPoints(),f.size()!=0){for(r=0;r<f.size();r++)this._mRouter.RefreshSegmentEgdes(f.get(r));this.unUsedVectors.contains(u)&&this.unUsedVectors.Remove(u)}}},n.prototype.RemoveObstacle=function(n){var u=new List,f=new List,i=Math.floor(this._mIsVertical?n.left():n.top()),r=Math.floor(this._mIsVertical?n.right():n.bottom()),t;return this._mVectors.ContainsKey(i)&&(this._mCoordsToReconstruct.add(Math.floor(i)),t=this._mVectors.GetValue(i).RemoveObstacle(n,u),u=t.SegCollection),this._mVectors.ContainsKey(r)&&(this._mCoordsToReconstruct.add(Math.floor(r)),t=this._mVectors.GetValue(r).RemoveObstacle(n,f),f=t.SegCollection),null},n.prototype.SplitSegments=function(n){for(var i,r=this._mIsVertical?Utility.ToRoundedInt(n.left()):Utility.ToRoundedInt(n.top()),u=this._mIsVertical?Utility.ToRoundedInt(n.right()):Utility.ToRoundedInt(n.bottom()),f=this._mVectors.IndexOfKey(r),e=this._mVectors.IndexOfKey(u),t=f+1;t<e;t++)i=this._mVectors.GetValue(this._mVectors.KeyAt(t)),i.SplitSegment(n),this._mRouter.SplitSegment(n,i)},n.prototype.RemoveUnUsedVector=function(){for(var n=0;n<this.unUsedVectors.size();n++)this.RemoveVectorCoordinate(this._mVectors.GetValue(this.unUsedVectors.get(n)),null);this.unUsedVectors.Clear()},n.prototype.UpdateUnUsedVector=function(n){this.unUsedVectors.contains(n)||this.unUsedVectors.add(n)},n.prototype.FindLast=function(n){var u=0,t=0,i=this._mVectors.Count()-1,s=null,r,f,h,c,l,e,o;if(this._mIsVertical){for(f=n.x-1e-5;i-t>1;)u=Math.floor((t+i)/2),h=this._mVectors.ElementAt(u),h&&h.getCoord()<f?t=u:i=u;if(c=this._mVectors.ElementAt(i),c&&f>c.getCoord()&&(t=i),l=this._mVectors.ElementAt(t),l&&f>l.getCoord()){while(t>-1&&(this._mVectors.ElementAt(t).GetStart().y>n.y||this._mVectors.ElementAt(t).GetEnd().y<n.y))t--;t>-1&&(s=this._mVectors.ElementAt(t))}if(s!=null)for(e=t;e>=0;){if(o=this._mVectors.ElementAt(e).FindSegment(Utility.ToRoundedInt(n.y)),o!=null)return o;e--}}else{for(f=n.y-1e-5;i-t>1;)u=Math.floor((t+i)/2),r=this._mVectors.ElementAt(u),r&&r.getCoord()<f?t=Math.floor(u):i=Math.floor(u);if(r=this._mVectors.ElementAt(i),r&&f>r.getCoord()&&(t=Math.floor(i)),r=this._mVectors.ElementAt(t),r&&f>r.getCoord()){while(t>-1&&(this._mVectors.ElementAt(t).GetStart().x>n.x||this._mVectors.ElementAt(t).GetEnd().x<n.x))t--;t>-1&&(s=this._mVectors.ElementAt(t))}if(s!=null)for(e=t;e>=0;){if(o=this._mVectors.ElementAt(e).FindSegment(Utility.ToRoundedInt(n.x)),o!=null)return o;e--}}return null},n.prototype.FindFirst=function(n){var u=0,r=0,t=this._mVectors.Count()-1,s=null,f,i,e,o;if(this._mIsVertical){for(f=n.x+.0001;t-r>1;)u=Math.floor((r+t)/2),i=this._mVectors.ElementAt(u),i&&i.getCoord()<f?r=u:t=u;if(i=this._mVectors.ElementAt(r),i&&f<=i.getCoord()&&(t=r),i=this._mVectors.ElementAt(t),i&&f<=i.getCoord()){while(t<this._mVectors.Count()&&(this._mVectors.ElementAt(t).GetStart().y>n.y||this._mVectors.ElementAt(t).GetEnd().y<n.y))t++;t<this._mVectors.Count()&&(s=this._mVectors.ElementAt(t))}if(s!=null)for(e=t;e<this._mVectors.Count();){if(o=this._mVectors.ElementAt(e).FindSegment(Utility.ToRoundedInt(n.y)),o!=null)return o;e++}}else{for(f=n.y+1e-5;t-r>1;)u=Math.floor((r+t)/2),i=this._mVectors.ElementAt(u),i&&i.getCoord()<f?r=Math.floor(u):t=Math.floor(u);if(i=this._mVectors.ElementAt(r),i&&f<=i.getCoord()&&(t=Math.floor(r)),i=this._mVectors.ElementAt(t),i&&f<i.getCoord()){while(t<this._mVectors.Count()&&(this._mVectors.ElementAt(t).GetStart().x>n.x||this._mVectors.ElementAt(t).GetEnd().x<n.x))t++;t<this._mVectors.Count()&&(s=this._mVectors.ElementAt(t))}if(s!=null)for(e=t;e<this._mVectors.Count();){if(o=this._mVectors.ElementAt(e).FindSegment(Utility.ToRoundedInt(n.x)),o!=null)return o;e++}}return null},n.prototype.FindIndex=function(n){if(this._mIsVertical){if(this._mVectors.ContainsKey(Utility.ToRoundedInt(n.x)))return this._mVectors.IndexOfKey(Utility.ToRoundedInt(n.x))}else if(this._mVectors.ContainsKey(Utility.ToRoundedInt(n.y)))return this._mVectors.IndexOfKey(Utility.ToRoundedInt(n.y));return-1},n.prototype.FindIndexNumber=function(n){return this._mVectors.ContainsKey(n)?this._mVectors.IndexOfKey(n):0},n.prototype.FindFirstIndex=function(n){var r=0,i=0,t=this._mVectors.Count()-1,u;if(this._mIsVertical){for(u=n.x+.0001;t-i>1;)r=Math.floor((i+t)/2),this._mVectors.ElementAt(r).Coord<u?i=Math.floor(r):t=Math.floor(r);if(u<=this._mVectors.ElementAt(i).Coord&&(t=Math.floor(i)),u<=this._mVectors.ElementAt(t).Coord){while(t<this._mVectors.Count()&&(this._mVectors.ElementAt(t).GetStart().y>n.y||this._mVectors.ElementAt(t).GetEnd().y<n.y))t++;if(t<this._mVectors.Count())return t}}else{for(u=n.y+1e-5;t-i>1;)r=Math.floor((i+t)/2),this._mVectors.ElementAt(r).Coord<u?i=Math.floor(r):t=Math.floor(r);if(u<=this._mVectors.ElementAt(i).Coord&&(t=i),u<this._mVectors.ElementAt(t).Coord){while(t<this._mVectors.Count()&&(this._mVectors.ElementAt(t).GetStart().x>n.x||this._mVectors.ElementAt(t).GetEnd().x<n.x))t++;if(t<this._mVectors.Count())return t}}return-1},n.prototype.FindSegment=function(n,t,i){if(n<this._mVectors.Count()&&n>=0){var r=Utility.ToRoundedInt(t.y);return this._mIsVertical||(r=Utility.ToRoundedInt(t.x)),i=this._mVectors.ElementAt(n),this._mVectors[i].FindSegment(r)}return null},n.prototype.FindScanSegment=function(n){if(this._mIsVertical){if(this._mVectors.ContainsKey(Utility.ToRoundedInt(n.y)))return this._mVectors[Utility.ToRoundedInt(n.y)].FindSegment(Utility.ToRoundedInt(n.x))}else if(this._mVectors.ContainsKey(Utility.ToRoundedInt(n.x)))return this._mVectors[Utility.ToRoundedInt(n.x)].FindSegment(Utility.ToRoundedInt(n.y));return null},n.prototype.GetEdgePassingThroughVertex=function(n,t){var s=n.Point,o=this._mVectors.IndexOfKey(this._mIsVertical?Utility.ToRoundedInt(s.x):Utility.ToRoundedInt(s.y)),r,u;if(o!=-1){var h=this._mIsVertical?Directions.East:Directions.North,i=null,f=null,e=this._mRouter.graph;for(r=o-1;r>=0;r--)if(u=Number(this._mVectors.KeyAt(r)),i=this._mIsVertical?e.FindVertexNumber(u,t):e.FindVertexNumber(t,u),i!=null&&(f=i.FindNextVertex(h),f!=null))return this._mIsVertical?i.getEastEdge():i.getNorthEdge();for(r=o+1;r<=this._mVectors.Count()-1;r++)if(u=Number(this._mVectors.KeyAt(r)),f=this._mIsVertical?e.FindVertexNumber(u,t):e.FindVertexNumber(t,u),f!=null&&(i=f.FindNextVertex(Extensions.OppositeDirection(h)),i!=null))return this._mIsVertical?i.getEastEdge():i.getNorthEdge()}return null},n}(),SegmentVector=function(){function n(n,t,i,r,u){this._mStart=0;this._mEnd=0;this._mCoord=0;this._mIsVertical=!1;this._mCoord=n;this._mStart=t;this._mEnd=i;this._mParentTree=u;this._mOrientation=r;this._mIsVertical=this._mOrientation==SegmentOrientation.Vertical;this._mSegments=new List}return n.prototype.getStart=function(){return this._mStart},n.prototype.setStart=function(n){this._mStart=n},n.prototype.getEnd=function(){return this._mEnd},n.prototype.setEnd=function(n){this._mEnd=n},n.prototype.getCoord=function(){return this._mCoord},n.prototype.setCoord=function(n){this._mCoord=Math.floor(n)},n.prototype.getSegments=function(){return this._mSegments},n.prototype.setSegments=function(n){this._mSegments=n},n.prototype.getOrientation=function(){return this._mOrientation},n.prototype.getIsVertical=function(){return this._mIsVertical},n.prototype.getParentTree=function(){return this._mParentTree},n.prototype.UpdateVectorPoints=function(n){if(n===void 0&&(n=!1),this._mSegments.size()!=0){var t=this._mSegments.get(0),i=this._mSegments.get(this._mSegments.size()-1);this.UpdateVectorPoint(t.getStart(),!0,n);this.UpdateVectorPoint(i.getEnd(),!1,n)}},n.prototype.UpdateVectorPoint=function(n,t,i){i===void 0&&(i=!1);var r=!1;t&&this._mStart!=n?(this._mStart=n,r=!0):t||this._mEnd==n||(this._mEnd=n,r=!0);r&&this._mParentTree!=null&&!i&&this._mParentTree.UpdateTreePoints()},n.prototype.AddSegmentToVector=function(n,t){var f,e,o;if(t===void 0&&(t=-1),t==-1){t=0;var r=0,i=this._mSegments.size()-1,u=n.getStart();if(this._mSegments.size()==1)u>=this._mSegments.get(0).getStart()&&t++;else if(this._mSegments.size()>1){while(i-r>1)f=Math.floor((r+i)/2),u>=this._mSegments.get(f).getStart()?r=Math.floor(f):i=Math.floor(f);e=this._mSegments.get(r);o=this._mSegments.get(i);t=u<e.getStart()?Math.floor(r):u>o.getStart()?i+1:i}}this._mSegments.Insert(t,n);this.UpdateVectorPoints()},n.prototype.RemoveSegmentFromVector=function(n){this._mSegments.size()!=0&&(n.getSharedCoordinates().Count()==0||n.getStart()===n.getEnd())&&(this._mSegments.Remove(n),n=null,this.UpdateVectorPoints());this._mSegments.size()==0&&this._mParentTree.UpdateUnUsedVector(this._mCoord)},n.prototype.ExpandSegmentVector=function(n,t,i){var u;if(this._mSegments.size()!=0){var r=i?this._mSegments.get(0):this._mSegments.get(this._mSegments.size()-1),f=i?r.getStartPoint():r.getEndPoint(),e=i?r.getStart():r.getEnd();e===t&&e!==n&&(u=this._mIsVertical?new Point(f.x,n):new Point(n,f.y),this._mParentTree.getRouter().ExtendScanSegment(r,u,i),r.UpdateSegmentPoint(u,i,!0))}},n.prototype.InsertObstacle=function(n){var s=Utility.ToRoundedInt(n.top()),h=Utility.ToRoundedInt(n.bottom()),c=Utility.ToRoundedInt(n.left()),l=Utility.ToRoundedInt(n.right()),t=null,i=null,a=this._mIsVertical?new Point(this._mCoord,s):new Point(c,this._mCoord),v=this._mIsVertical?new Point(this._mCoord,h):new Point(l,this._mCoord),o=this._mIsVertical?s:c,f=this._mIsVertical?h:l,r,e,u;if(t=i=this.GetScanSegment(a),(t==null||t.getEnd()<f)&&(i=this.GetScanSegment(v)),t!=null&&(t.UpdateSharedCoordinates(o),(t.getEnd()<f||i==null&&t.getEnd()==f)&&t.UpdateSharedCoordinates(t.getEnd())),i!=null&&(i.UpdateSharedCoordinates(f),(i.getStart()>o||t==null&&i.getStart()==o)&&i.UpdateSharedCoordinates(i.getStart())),r=this.GetScanSegmentsFromBounds(n,t,i),r.size()!=0)for(e=0;e<r.size();e++)u=r.get(e),u!=t&&u!=i&&(u.UpdateSharedCoordinates(u.getStart()),u.UpdateSharedCoordinates(u.getEnd()));return t!=null&&r.Insert(0,t),t!=i&&r.Insert(r.size(),i),r},n.prototype.RemoveObstacle_Where=function(n,t,i){for(var e,f,u=[],o=this._mSegments.size(),r=0;r<o;r++)e=n.get(r),u.push(e);for(u.sort(function(n){return n.getStart()>t&&n.getEnd()<i?1:-1}),f=new List,r=0;r<u.length;r++)f.add(u[r]);return f},n.prototype.RemoveObstacle=function(n,t){var a=Utility.ToRoundedInt(n.top()),v=Utility.ToRoundedInt(n.bottom()),y=Utility.ToRoundedInt(n.left()),p=Utility.ToRoundedInt(n.right()),e,o,l;t=new List;var u=this._mIsVertical?a:y,f=this._mIsVertical?v:p,r=this.FindSegment(u),i=this.FindSegment(f);if(r!=null&&(t.add(r),r.RemoveSharedCoordinates(u),r.getEnd()<f&&r.RemoveSharedCoordinates(r.getEnd())),i!=null&&(t.contains(i)||t.add(i),i.RemoveSharedCoordinates(f),i.getStart()>u&&i.RemoveSharedCoordinates(i.getStart())),e=this.RemoveObstacle_Where(this._mSegments,u,f),e.size()!=0)for(o=0;o<e.size();o++)for(var h=e.get(o),s=0,c=Object.keys(h.getSharedCoordinates());s<c.length;)l=Number(c[s]),h.RemoveSharedCoordinates(l),s++;return{isRemove:!1,SegCollection:t}},n.prototype.SplitSegment=function(n){var e,o,r,u;if(this._mSegments.size()!=0){var s=Utility.ToRoundedInt(n.top()),h=Utility.ToRoundedInt(n.bottom()),c=Utility.ToRoundedInt(n.left()),l=Utility.ToRoundedInt(n.right()),a=this._mIsVertical?s:c,f=this._mIsVertical?h:l,t=null,i=null;if(t=i=this.FindSegment(a),(t==null||t.getEnd()<f)&&(i=this.FindSegment(f)),e=this._mIsVertical?new Point(this._mCoord,s):new Point(c,this._mCoord),o=this._mIsVertical?new Point(this._mCoord,h):new Point(l,this._mCoord),t!=null&&i!=null&&t==i?(i=this.GetScanSegment_startPoint(o,t.getEndPoint(),this._mSegments.IndexOf(t)+1),i.setSharedCoordinates(t.getSharedCoordinates().Clone()),t.UpdateSegmentPoint(e,!1)):(t!=null&&t.UpdateSegmentPoint(e,!1),i!=null&&i.UpdateSegmentPoint(o,!0)),t!=null&&t.RemoveNotInRangeSharedCoordinates(),i!=null&&i.RemoveNotInRangeSharedCoordinates(),r=this.SplitSegment_Where(a,f),r.size()!=0)for(u=0;u<r.size();u++)r.get(u).getSharedCoordinates().Clear()}},n.prototype.SplitSegment_Where=function(n,t){for(var i,u=new List,r=0;r<this._mSegments.size();r++)i=this._mSegments.get(r),i.getStart()>n&&i.getEnd()<t&&u.add(i);return u},n.prototype.GetScanSegmentsFromBounds=function(n,t,i){var o=new List,f,r,e,v,y,h,u,l;if(t!=null&&i!=null&&t==i)return o;if(f=this._mParentTree.getPerpendicularTree(),f.getVectors().Count()!=0)for(var a=f.FindIndex(n.topLeft().round()),p=f.FindIndex(n.bottomRight().round()),s=a,c=null;s<p;)r=Number(f.getVectors().KeyAt(s)),e=this._mIsVertical?new Point(this._mCoord,r):new Point(r,this._mCoord),t!=null&&t.Contains(e)||i!=null&&i.Contains(e)||(v=f.getVectors().GetValue(r),y=v.FindSegment(this._mCoord),y!=null&&(h=this._mIsVertical?new Point(this._mCoord,r+1):new Point(r+1,this._mCoord),t!=null&&t.Contains(h)||i!=null&&i.Contains(h)||(u=this.GetScanSegment(h),u==null||o.contains(u)?u==null&&s>a&&(l=this._mIsVertical?new Point(this._mCoord,r-1):new Point(r-1,this._mCoord),c!=null&&l.equals(c)&&this.GetScanSegment_startPoint(l,e)):u.getStartPoint().equals(e)?o.add(u):this.RemoveSegmentFromVector(u)),c=e)),s++;return o},n.prototype.GetScanSegment=function(n){var i=null,f,r,t,u;return this._mSegments.size()!=0&&(f=this._mIsVertical?Utility.ToRoundedInt(n.y):Utility.ToRoundedInt(n.x),i=this.FindSegment(f)),i==null&&this._mParentTree!=null&&(r=this._mIsVertical?Directions.South:Directions.West,t=this._mParentTree.getRouter().GetMaximumVisibility(n,r),t!=null&&(u=this._mParentTree.getRouter().GetMaximumVisibility(n,Extensions.OppositeDirection(r)),u!=null&&(t.EndPoint=u.EndPoint),t.StartPoint.OperatorNotEqual(t.EndPoint)&&(i=new ScanSegment(t.StartPoint,t.EndPoint,this._mOrientation,this),this.AddSegmentToVector(i)))),i},n.prototype.GetScanSegment_startPoint=function(n,t,i){i===void 0&&(i=-1);var r=null;return i==-1&&this._mSegments.size()!=0&&(r=this.FindSegment(this._mIsVertical?Utility.ToRoundedInt(n.y):Utility.ToRoundedInt(n.x)),r==null&&(r=this.FindSegment(this._mIsVertical?Utility.ToRoundedInt(t.y):Utility.ToRoundedInt(t.x)))),r==null&&this._mParentTree!=null&&(r=new ScanSegment(n,t,this._mOrientation,this),this.AddSegmentToVector(r,i)),r},n.prototype.FindSegment=function(n){var t=null,i;return this._mSegments.size()!=0&&(i=this.GetSegmentIndex(n,t),t=i.segment),t},n.prototype.GetSegmentIndex=function(n,t){if(t=null,this._mStart<=n&&this._mEnd>=n){for(var i=0,r=this._mSegments.size()-1,u=-1;r-i>1;)u=Math.floor((i+r)/2),n>=this._mSegments.get(u).getStart()?i=u:r=u;if(i>=0&&r>=0){if(this._mSegments.get(i).getEnd()>=n)return t=this._mSegments.get(i),{index:i,segment:t};if(this._mSegments.get(r).getStart()<=n)return t=this._mSegments.get(r),{index:r,segment:t}}}return{index:-1,segment:t}},n.prototype.GetStart=function(){return this._mIsVertical?new Point(this._mCoord,this._mStart):new Point(this._mStart,this._mCoord)},n.prototype.GetEnd=function(){return this._mIsVertical?new Point(this._mCoord,this._mEnd):new Point(this._mEnd,this._mCoord)},n}(),ScanSegment=function(){function n(n,t,i,r){this._mIsVertical=!1;this._mStart=0;this._mEnd=0;this._mStartPoint=n.round();this._mEndPoint=t.round();this._mSharedCoordinates=new SortedList;this._mParentVector=r;this._mOrientation=i;this._mIsVertical=this._mOrientation==SegmentOrientation.Vertical;this._mStart=this._mIsVertical?this._mStartPoint.y:this._mStartPoint.x;this._mEnd=this._mIsVertical?this._mEndPoint.y:this._mEndPoint.x}return n.prototype.getStart=function(){return Math.floor(this._mStart)},n.prototype.getEnd=function(){return Math.floor(this._mEnd)},n.prototype.getStartPoint=function(){return this._mStartPoint},n.prototype.getEndPoint=function(){return this._mEndPoint},n.prototype.getOrientation=function(){return this._mOrientation},n.prototype.getIsVertical=function(){return this._mIsVertical},n.prototype.getSharedCoordinates=function(){return this._mSharedCoordinates},n.prototype.setSharedCoordinates=function(n){this._mSharedCoordinates=n!=null?n:new SortedList},n.prototype.getParentVector=function(){return this._mParentVector},n.prototype.Contains=function(n){var t=this._mIsVertical?Utility.ToRoundedInt(n.y):Utility.ToRoundedInt(n.x);return t>=this._mStart&&t<=this._mEnd},n.prototype.UpdateSegmentPoint=function(n,t,i){i===void 0&&(i=!1);var r=!1;n=n.round();t&&!this._mStartPoint.equals(n)?(this._mStartPoint=n,this._mStart=this._mIsVertical?this._mStartPoint.y:this._mStartPoint.x,r=!0):t||this._mEndPoint.equals(n)||(this._mEndPoint=n,this._mEnd=this._mIsVertical?this._mEndPoint.y:this._mEndPoint.x,r=!0);r&&this._mParentVector!=null&&this._mParentVector.UpdateVectorPoints(i)},n.prototype.UpdateSharedCoordinates=function(n){this._mSharedCoordinates.ContainsKey(n)?this._mSharedCoordinates.Update(n,this._mSharedCoordinates.GetValue(n)+1):this._mSharedCoordinates.Add(1,n)},n.prototype.RemoveSharedCoordinates=function(n){this._mSharedCoordinates.ContainsKey(n)&&(this._mSharedCoordinates.Update(n,this._mSharedCoordinates.GetValue(n)-1),this._mSharedCoordinates.GetValue(n)==0&&this._mSharedCoordinates.Remove(n))},n.prototype.RemoveNotInRangeSharedCoordinates=function(){var r,n,f,e;if(this._mSharedCoordinates.Count()!=0){var t=this._mStart,i=this._mEnd,o=null,u=null;if(t===i)this._mSharedCoordinates.Clear();else{for(r=0;r<this._mSharedCoordinates.Count();)n=Number(this._mSharedCoordinates.KeyAt(r)),n<t||n>i?(this._mSharedCoordinates.ContainsKey(n)&&this._mSharedCoordinates.Remove(n),n<t?o=n:u==null&&(u=n)):r++;this._mSharedCoordinates.Count()%2!=0&&(o!=null&&(f=Number(this._mSharedCoordinates.KeyAt(0)),f>t?this.UpdateSharedCoordinates(t):f==t&&this.RemoveSharedCoordinates(t)),u!=null&&(e=Number(this._mSharedCoordinates.KeyAt(this._mSharedCoordinates.Count()-1)),e<i?this.UpdateSharedCoordinates(i):e==i&&this.RemoveSharedCoordinates(i)))}}},n}(),VisibilityGraphGeneration=function(){function n(){}return n.getRouter=function(){return this.router},n.setRouter=function(n){this.router=n},n.GetVertices=function(){var i=[],t,n;if(this.router.graph)for(t=this.router.graph.getVertices(),n=0;n<t.length;n++)i.push(new Point(t[n].Point.x,t[n].Point.y));return i},n.GetSegmentTree=function(){for(var i,n,u,f,o=new Point(this.router.getHorizontalSegmentTree().getStart(),this.router.getVerticalSegmentTree().getStart()),e=ej.util.getObject("drawLine",window),t=0;t<this.router.getHorizontalSegmentTree().getVectors().Count();t++)for(i=this.router.getHorizontalSegmentTree().getVectors().GetValue(this.router.getHorizontalSegmentTree().getVectors().KeyAt(t)),n=0;n<i.getSegments().size();n++){var r=i.getSegments().get(n),u=r.getStartPoint(),f=r.getEndPoint();e(new Tuple(new Point(u.x,u.y),new Point(f.x,f.y)))}for(t=0;t<this.router.getVerticalSegmentTree().getVectors().Count();t++)for(i=this.router.getVerticalSegmentTree().getVectors().GetValue(this.router.getVerticalSegmentTree().getVectors().KeyAt(t)),n=0;n<i.getSegments().size();n++)r=i.getSegments().get(n),u=r.getStartPoint(),f=r.getEndPoint(),e(new Tuple(new Point(u.x,u.y),new Point(f.x,f.y)));return[]},n.GetEdges=function(){var r=[],i,t,n;if(this.router.graph)for(i=this.router.graph.getEdges(),t=0;t<i.size();t++)n=i.get(t),r.push(new Tuple(new Point(n.getSource().Point.x,n.getSource().Point.y),new Point(n.getTarget().Point.x,n.getTarget().Point.y)));return r},n.router=new Router,n}(),IObstaclePort=function(){function n(){}return n.prototype.getLocation=function(){return this.Location},n.prototype.setLocation=function(n){this.Location=n},n.prototype.getDirection=function(){return this.Direction},n.prototype.setDirection=function(n){this.Direction=n},n}(),Obstacle=function(){function n(){this.isBorder=!1}return n.prototype.getPaddedBounds=function(){return this._mPaddedRegion},n.prototype.setPaddedBounds=function(n){var t,i;this._mPaddedRegion=n;this._mPaddedRegion!=null&&this._mPaddedRegion!=Rect.empty&&(t=this._mPaddedRegion,this.topLeft=new PolylinePoint(t.topLeft()),this.topRight=new PolylinePoint(t.topRight()),this.bottomLeft=new PolylinePoint(t.bottomLeft()),this.bottomRight=new PolylinePoint(t.bottomRight()),this._mActualBounds!=null&&(i=this._mActualBounds,i.width==0?(this.topLeft.setNext(this.bottomLeft),this.topLeft.setPrev(this.bottomLeft),this.topRight.setNext(this.bottomLeft),this.topRight.setPrev(this.bottomLeft),this.bottomLeft.setNext(this.topLeft),this.bottomLeft.setPrev(this.topLeft),this.bottomRight.setNext(this.topLeft),this.bottomRight.setPrev(this.topLeft)):i.height==0?(this.topLeft.setNext(this.topRight),this.topLeft.setPrev(this.topRight),this.bottomLeft.setNext(this.topRight),this.bottomLeft.setPrev(this.topRight),this.topRight.setNext(this.topLeft),this.topRight.setPrev(this.topLeft),this.bottomRight.setNext(this.topLeft),this.bottomRight.setPrev(this.topLeft)):(this.topLeft.setPrev(this.topRight),this.topRight.setPrev(this.bottomRight),this.bottomRight.setPrev(this.bottomLeft),this.bottomLeft.setPrev(this.topLeft),this.topLeft.setNext(this.bottomLeft),this.bottomLeft.setNext(this.bottomRight),this.bottomRight.setNext(this.topRight),this.topRight.setNext(this.topLeft)),this.StartVertex=this.topLeft))},n.prototype.getActualBounds=function(){return this._mActualBounds},n.prototype.setActualBounds=function(n){this._mActualBounds=n},n.prototype._obstacle=function(n,t,i){return t===void 0&&(t=12),i===void 0&&(i=!0),i==!1&&(this.isBorder=!0),this.SetRegion(n,t),this},n.prototype.CreateInitialSides=function(n,t){this.LowSide=new ObstacleSide(this,n,t,ScanDirection.Right==t);this.LowSide.SideType=ObstacleSideType.Low;this.HighSide=new ObstacleSide(this,n,t,ScanDirection.Top==t);this.HighSide.SideType=ObstacleSideType.High;Utility.CheckWithScanDirection(t,this.HighSide.getStart(),this.HighSide.getEnd())&&(this.HighSide=new ObstacleSide(this,t==ScanDirection.Right?this.topRight:this.bottomLeft,t,ScanDirection.Top==t),this.HighSide.SideType=ObstacleSideType.High)},n.prototype.SetRegion=function(n,t){t===void 0&&(t=12);this.setActualBounds(n);this.isBorder==!1&&n.Inflate(t).round();this.setPaddedBounds(new Rect(Math.round(n.x),Math.round(n.y),Math.round(n.width),Math.round(n.height)))},n}(),ObstacleSide=function(){function n(n,t,i,r){this.StartVertex=t;this._obstacle=n;this._mEndVertex=r?t.getNext():t.getPrev()}return n.prototype.getEndVertex=function(){return this._mEndVertex},n.prototype.setEndVertex=function(n){this._mEndVertex=n},n.prototype.getStart=function(){return this.StartVertex.Point},n.prototype.getEnd=function(){return this.getEndVertex().Point},n}(),CenterPort=function(){function n(n){this.Entrances=new List;this.VisibilityRectangle=Rect.empty;this.Location=n;this._mLocation=n}return n.prototype.AddPortEntrance=function(n,t,i,r){var u=new PortEntrance(this,t,i,r,n);u.getCanExtend()&&(this.Entrances.add(u),this.VisibilityRectangle.unitePoint(u.MaxVisibilitySegment.EndPoint))},n.prototype.getLocation=function(){return this.Location.round()},n.prototype.setLocation=function(n){this.Location=n},n.prototype.getDirection=function(){return this.Direction},n.prototype.setDirection=function(n){this.Direction=n},n}(),ObstaclePort=function(){function n(n,t){this.Location=this._mLocation=n;this.Direction=this._mPortDirection=t}return n.prototype.getLocation=function(){return this.Location.round()},n.prototype.setLocation=function(n){this.Location=n},n.prototype.getDirection=function(){return this.Direction},n.prototype.setDirection=function(n){this.Direction=n},n}(),PortEntrance=function(){function n(n,t,i,r,u){var o;this.Port=n;this.Location=t;this.Direction=r;var s=Extensions.GetEquivalentDirection(r),a=u.ObstaclePadding,h=t,c=Utility.IntersectionWithRectangleBorder(u.Rectangle,t,Extensions.GetEquivalentDirection(r)),f=new Segment(h,c),e,l=u.FindMaximumVisibility_hitNode(f,i,null,e,!0);e=l.hitNode;o=f.StartPoint.FindDirection(f.EndPoint);s!=o&&(f.EndPoint=t);this.FirstHit=e;this.MaxVisibilitySegment=f}return n.prototype.getCanExtend=function(){return Extensions.FindDirection(this.MaxVisibilitySegment.StartPoint,this.MaxVisibilitySegment.EndPoint)!=Directions.None},n.prototype.getWantVisibilityIntersection=function(){return this.getCanExtend()},n.prototype.getIsVertical=function(){return this.Direction==PortDirection.Top||this.Direction==PortDirection.Bottom},n}(),PortManager=function(){function n(n,t,i,r,u,f){this.visibilityGraph=null;this.padding=0;this.canRoute=!1;this.temporaryAddition=!0;this.InitialWeight=1;this.NormalWeight=1;this.edgesToRestore=new List;this.addedEdges=new List;this.addedVertices=new List;this.lastExtendedVertex=null;this.HorizontalScanSegmentTree=n;this.VerticalScanSegmentTree=t;this.visibilityGraph=r;this.targetGeometry=u;this.padding=f;this.ObstacleTree=i}return n.prototype.AddControlPointsToGraph=function(n){return this.addedEdges=new List,this.addedVertices=new List,this.canRoute=!0,this.targetGeometry.Connector=n,this.targetGeometry.CurrentEnd=ConnectionEnd.Source,n._sourceNodeInfo!=null?this.AddEndPointToGraph(n._sourcePortInfo,n._sourceNodeInfo):this.AddEndPointToGraph(n._sourcePointInfo,n._sourceNodeInfo),this.canRoute&&(this.targetGeometry.CurrentEnd=ConnectionEnd.Target,n._targetNodeInfo!=null?this.AddEndPointToGraph(n._targetPortInfo,n._targetNodeInfo):this.AddEndPointToGraph(n._targetPointInfo,n._targetNodeInfo)),this.canRoute},n.prototype.AddEndPointToGraph=function(n,t){(n==null||n instanceof IObstaclePort)&&(t instanceof IObstacle||t&&(t._type==="node"||t.type==="bpmn"))?n==null?this.AddFreePointToGraph(t):this.canRoute=this.AddPortToGraph(n,t):n!=null&&(this.canRoute=this.AddPortToGraph(n,t))},n.prototype.AddPortToGraph=function(n,t){return this.AddPortToGraph_portDirection(n.getLocation(),n.getDirection(),t)},n.prototype.AddPortToGraph_portDirection=function(n,t,i){var r=new Point(Utility.ToRoundedInt(n.x),Utility.ToRoundedInt(n.y)),o,u,f,e,c,l,h;if(this.ObstacleTree.Rectangle.containsPoint(r)){o=this.AddVertex(r);var v=t,s=null,a=!1;if(Extensions.GetOrientation_PortDirection(v)==Orientation.Horizontal&&(a=!0),s=this.FindTheClosestPerpendicularEdge(r,t),u=new Segment(r,Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,r,Extensions.GetEquivalentDirection(t))),this.ObstacleTree.RestrictSegmentWithinFreeSpace(this.targetGeometry.Connector,u,i)&&s!=null){if(e=this.GetIntersectingPoint(s,r,!a),u.Contains(e))return f=e,h=this.AddVertex(e),o.Point.OperatorNotEqual(e)&&this.ConnectVertices_vertex(o,h,this.InitialWeight),this.AddEdgeToClosestPerpSegment(s,e,!0),this.ExtendTheEdgeToAdjacentEdges(f,t,u,!a),!0;if(i!=null&&(c=Utility.IntersectionWithRectangleBorder(i._outerBounds,r,Extensions.GetEquivalentDirection(t)),l=Math.abs(c.distance(u.EndPoint)),u.Contains(c)&&l<2*this.padding&&l>=4))return f=Extensions.Transform(c,l/2,Extensions.GetEquivalentDirection(t)),h=this.AddVertex(f),o.Point.OperatorNotEqual(f)&&this.ConnectVertices_vertex(o,h,this.InitialWeight),this.AddEdgesToParallelSegments(f,Extensions.GetOrientation_PortDirection(t),u,i),!0}}return!1},n.prototype.AddCornerToVisibilityGraph=function(n,t,i){var e,l,u,c;i===void 0&&(i=null);this.lastExtendedVertex=null;var r=n.getLocation(),f=n.getDirection(),a=r,h;if(this.ObstacleTree.Rectangle.containsPoint(r)){this.SegmentStartPoint=this.SegmentEndPoint=r;h=this.AddVertex(r);var v=f,o=null,s=!1;if(Extensions.GetOrientation_PortDirection(v)==Orientation.Horizontal&&(s=!0),o=this.FindTheClosestPerpendicularEdge(r,f),e=new Segment(r,Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,r,Extensions.GetEquivalentDirection(f))),this.ObstacleTree.RestrictSegmentWithinFreeSpace(this.targetGeometry.Connector,e,t)){if(o!=null&&(u=this.GetIntersectingPoint(o,r,!s),e.Contains(u))){l=u;c=this.AddVertex(u);this.lastExtendedVertex=c;h.Point.OperatorNotEqual(u)&&this.ConnectVertices_vertex(h,c,this.InitialWeight);this.AddEdgeToClosestPerpSegment(o,u,!0);this.ExtendTheEdgeToAdjacentEdges(l,f,e,!s,i);this.lastExtendedVertex!=null&&(this.SegmentEndPoint=this.lastExtendedVertex.Point);return}this.ExtendTheEdgeToAdjacentEdges(a,f,e,!s,i);this.lastExtendedVertex!=null&&(this.SegmentEndPoint=this.lastExtendedVertex.Point)}}},n.prototype.GetStartVertexPoint=function(n,t){if(t){if(n.x==this.ObstacleTree.Rectangle.x-1)return new Point(n.x+1,n.y)}else if(n.y==this.ObstacleTree.Rectangle.y-1)return new Point(n.x,n.y+1);return n},n.prototype.GetEndVertexPoint=function(n,t){if(t){if(n.x==this.ObstacleTree.Rectangle.right()+1)return new Point(n.x-1,n.y)}else if(n.y==this.ObstacleTree.Rectangle.bottom()+1)return new Point(n.x,n.y-1);return n},n.prototype.GetStartSegmentPoint=function(n,t,i){if(i===void 0&&(i=!1),t){if(n.x==this.ObstacleTree.Rectangle.x||i)return new Point(n.x-1,n.y)}else if(n.y==this.ObstacleTree.Rectangle.y||i)return new Point(n.x,n.y-1);return n},n.prototype.GetEndSegmentPoint=function(n,t,i){if(i===void 0&&(i=!1),t){if(n.x==this.ObstacleTree.Rectangle.right()||i)return new Point(n.x+1,n.y)}else if(n.y==this.ObstacleTree.Rectangle.bottom()||i)return new Point(n.x,n.y+1);return n},n.prototype.FindTheClosestPerpendicularEdge=function(n,t){var u=null,r=Extensions.GetOrientation_PortDirection(t)==Orientation.Horizontal?this.VerticalScanSegmentTree:this.HorizontalScanSegmentTree,i;switch(t){case PortDirection.Bottom:case PortDirection.Right:i=r.FindFirst(n);u=i?i:r.FindScanSegment(n);break;case PortDirection.Left:case PortDirection.Top:i=r.FindLast(n);u=i?i:r.FindScanSegment(n)}return u},n.prototype.AddFreePointToGraph=function(n){var t=n._obstacle.CenterPort,i,r;for((t.Entrances==null||t.Entrances.size()==0)&&this.CreatePortEntrances(n,t,n._obstacle),this.canRoute=!1,i=0;i<t.Entrances.size();i++)r=t.Entrances.get(Number(i)),this.AddPortToGraph_portDirection(r.Location,r.Direction,n)&&(this.canRoute=!0)},n.prototype.AddEdgesToParallelSegments=function(n,t,i,r){var f,e,u=!1,h=t==Orientation.Horizontal?this.HorizontalScanSegmentTree:this.VerticalScanSegmentTree,o,s;f=h.FindLast(n);e=h.FindFirst(n);t==Orientation.Horizontal?(u=!0,o=PortDirection.Top,s=PortDirection.Bottom):(u=!1,o=PortDirection.Left,s=PortDirection.Right);f!=null&&this.ConnectToParallelEdge(f,n,o,u,r);e!=null&&this.ConnectToParallelEdge(e,n,s,u,r)},n.prototype.ConnectToParallelEdge=function(n,t,i,r,u){var f=this.GetIntersectingPoint(n,t,r),s=Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,f,Extensions.GetEquivalentDirection(i)),e=new Segment(t,s),o=this.targetGeometry.GetCurrentEntrance();o!=null&&this.ObstacleTree.RestrictSegmentWithinFreeSpace(this.targetGeometry.Connector,e,u,o.FirstHit)&&e.Contains(f)&&(this.AddVertexAndEdges(t,f,1),this.AddEdgeToClosestPerpSegment(n,f,!0),this.ExtendTheEdgeToAdjacentEdges(f,i,e,!1))},n.prototype.AddEdgeToClosestPerpSegment=function(n,t,i){var f,e;if(!n.getStartPoint().equals(t)&&!n.getEndPoint().equals(t))if(t.FindDirection(n.getStartPoint())==n.getStartPoint().FindDirection(n.getEndPoint()))this.AddVertexAndEdges(t,n.getStartPoint(),i?this.InitialWeight:this.NormalWeight);else if(n.getEndPoint().FindDirection(t)==n.getStartPoint().FindDirection(n.getEndPoint()))this.AddVertexAndEdges(n.getEndPoint(),t,i?this.InitialWeight:this.NormalWeight);else{for(var o=n.getIsVertical()?Directions.North:Directions.East,r=this.visibilityGraph.FindVertex(n.getStartPoint()),u=null;r!=null;){if(r.Point.equals(t))break;else if(u!=null&&u.Point.FindDirection(t)==t.FindDirection(r.Point)){f=this.visibilityGraph.FindEdge(u.Point,r.Point);f!=null&&(f instanceof DynamicEdge||!this.temporaryAddition||this.edgesToRestore.add(f),this.visibilityGraph.RemoveEdge_edge(f,!0));e=this.AddVertex(t);this.ConnectVertices_vertex(u,e,1);this.ConnectVertices_vertex(e,r,1);return}u=r;r=r.FindNextVertex(o)}this.AddVertexAndEdges(n.getStartPoint(),t,i?this.InitialWeight:this.NormalWeight)}},n.prototype.AddVertexToSegment=function(n,t){var i,r,u;if(!t.Point.equals(n.getStartPoint())&&!t.Point.equals(n.getEndPoint())&&(i=n.getIsVertical()?Directions.North:Directions.East,r=t.FindNextVertex(i),r==null&&(u=t.FindNextVertex(Extensions.OppositeDirection(i)),u==null))){var e=n.getParentVector(),o=e.getParentTree().getPerpendicularTree(),f=o.GetEdgePassingThroughVertex(t,e.getCoord());f!=null&&(u=f.getSource(),r=f.getTarget(),f.ResetFields(u,t,i,1),this.visibilityGraph.CreateEdge(t,r,i,1))}},n.prototype.RemoveVertexFromSegment=function(n,t){var e=n.getIsVertical()?Directions.North:Directions.East,f,u,i,r;if(t.equals(n.getStartPoint()))i=this.visibilityGraph.FindVertex(n.getStartPoint()),i!=null&&(r=i.FindNextVertex(e),r!=null&&(this.visibilityGraph.RemoveEdge(i,r),n.UpdateSegmentPoint(r.Point,!0)));else if(t.equals(n.getEndPoint()))i=this.visibilityGraph.FindVertex(n.getEndPoint()),i!=null&&(f=i.FindNextVertex(Extensions.OppositeDirection(e)),f!=null&&(this.visibilityGraph.RemoveEdge(f,i),n.UpdateSegmentPoint(f.Point,!1)));else for(u=null,i=this.visibilityGraph.FindVertex(n.getStartPoint());i!=null;){if(r=i.FindNextVertex(e),u!=null&&r!=null&&i.Point.equals(t)){this.visibilityGraph.RemoveEdge(u,i);this.visibilityGraph.RemoveEdge(i,r);this.ConnectVertices_vertex(u,r);break}u=i;i=r}},n.prototype.RemoveVertexFromSegment_vertex=function(n,t){var i,r,u;t!=null&&(i=n.getIsVertical()?Directions.North:Directions.East,t.Point.equals(n.getStartPoint())?(r=t.FindNextVertex(i),r!=null&&(this.visibilityGraph.RemoveEdge(t,r),n.UpdateSegmentPoint(r.Point,!0),n.RemoveNotInRangeSharedCoordinates())):t.Point.equals(n.getEndPoint())?(u=t.FindNextVertex(Extensions.OppositeDirection(i)),u!=null&&(this.visibilityGraph.RemoveEdge(u,t),n.UpdateSegmentPoint(u.Point,!1),n.RemoveNotInRangeSharedCoordinates())):this.DisconnectVertexInDirection(t,i))},n.prototype.DisconnectVertexInDirection=function(n,t){var r=n.FindNextVertex(t),u=n.FindNextVertex(Extensions.OppositeDirection(t)),i;return r!=null&&u!=null&&(this.visibilityGraph.RemoveEdge(u,n),i=this.visibilityGraph.FindEdge_vertex(n,r),i)?(i.ClearProperties(),i.ResetFields(u,r,t),!0):!1},n.prototype.ExtendTheEdgeToAdjacentEdges=function(n,t,i,r,u){var e,o,f,s,h;u===void 0&&(u=null);e=this.visibilityGraph.FindVertex(n);e!=null&&(o=Extensions.GetEquivalentDirection(t),f=u!=null?u:Extensions.Left(o),h=e.FindNextVertex(f),h==null&&(f=Extensions.OppositeDirection(f)),s=Extensions.OppositeDirection(f),this.ExtendEdge(e,o,f,s,r,i)||this.ExtendEdge(e,o,s,f,r,i))},n.prototype.AddVertexAndEdges=function(n,t,i){this.ConnectVertices_vertex(this.AddVertex(n),this.AddVertex(t),i)},n.prototype.ConnectVertices=function(n,t,i){i===void 0&&(i=1);this.ConnectVertices_vertex(this.AddVertex(n),this.AddVertex(t),1)},n.prototype.ExtendEdge=function(n,t,i,r,u,f){var c,e,s,a;u=!1;var v=t==Directions.East||t==Directions.West?!0:!1,h=n.FindNextVertex(i),l=null,o=null,y=0;if(h!=null)for(;;){if(c=this.GetNextSource(h,t,h),h=c.source,!c.nextSource)break;if(e=this.FindBendPoint(n,h,v),o=null,f.StartPoint.FindDirection(e)==e.FindDirection(f.EndPoint)||f.StartPoint.equals(e)||f.EndPoint.equals(e)?(o=this.AddVertex(e),this.lastExtendedVertex=o):t==Directions.East?(s=this.VerticalScanSegmentTree.FindLast(f.EndPoint),s!=null&&(e=new Point(s.getStartPoint().x,e.y),o=this.AddVertex(e),this.lastExtendedVertex=o)):t==Directions.West?(s=this.VerticalScanSegmentTree.FindFirst(f.EndPoint),s!=null&&(e=new Point(s.getStartPoint().x,e.y),o=this.AddVertex(e),this.lastExtendedVertex=o)):t==Directions.South?(s=this.HorizontalScanSegmentTree.FindFirst(f.EndPoint),s!=null&&(e=new Point(e.x,s.getStartPoint().y),o=this.AddVertex(e),this.lastExtendedVertex=o)):t==Directions.North&&(s=this.HorizontalScanSegmentTree.FindLast(f.EndPoint),s!=null&&(e=new Point(e.x,s.getStartPoint().y),o=this.AddVertex(e),this.lastExtendedVertex=o)),l=this.GetNextTarget(h,r,e),o!=null)a=h.FindNextVertex(h.Point.FindDirection(e)),a!=null&&this.ConnectVertices_vertex(h,o,u?this.InitialWeight:this.NormalWeight),this.ConnectVertices_vertex(n,o,1),n=o;else break;y++}return l!=null},n.prototype.GetNextSource=function(n,t,i){return i=n.FindNextVertex(t),{nextSource:i!=null,source:i}},n.prototype.GetNextTarget=function(n,t,i){for(var u=t,r=n;u==t;){if(n=r,r=n.FindNextVertex(t),r==null)break;if(r.Point.equals(i))return r.FindNextVertex(t);u=r.Point.FindDirection(i)}return r},n.prototype.FindBendPoint=function(n,t,i){return i?new Point(t.Point.x,n.Point.y):new Point(n.Point.x,t.Point.y)},n.prototype.AddEdgeToClosestPerpSegments=function(n,t){for(var f=n.getIsVertical()?Directions.North:Directions.East,i=this.visibilityGraph.FindVertex(n.getStartPoint()),u=null,r;i!=null;){if(i.Point.equals(t))break;else if(u!=null&&u.Point.FindDirection(t)==t.FindDirection(i.Point)){r=this.visibilityGraph.FindEdge(u.Point,i.Point);r!=null&&(r instanceof DynamicEdge||!this.temporaryAddition||this.edgesToRestore.add(r),this.visibilityGraph.RemoveEdge_edge(r,!0));return}u=i;i=i.FindNextVertex(f)}},n.prototype.FindOrAddEdge=function(n,t,i,r){var h=n.Point.FindDirection(t.Point),f,e,s=!1,a=n.FindNextVertex(h),u,c,o,l;if(a==null&&(r=!0,s=!1),u=this.FindExistingEdgeEnds(n,t,h,f,e,s,r),c=u.isBracketTarget,f=u.bracketSource,e=u.bracketTarget,s=u.sourceEnd,r=u.swap,c||s||(u=this.FindExistingEdgeEnds(f!=null?f:n,e!=null?e:t,h,f,e,s,!0),c=u.isBracketTarget,f=u.bracketSource,e=u.bracketTarget,s=u.sourceEnd,r=u.swap),c){if(o=this.visibilityGraph.FindEdge(f.Point,e.Point),o!=null&&o.getSource()==n&&o.getTarget()==t)return;o!=null?(o.getSourcePoint().OperatorLessThan(n.Point)&&o.getTargetPoint().OperatorGreaterThan(t.Point),l=s?n:t,this.SplitEdge(l,o)):this.CreateEdge(n,t,i)}else f!=null&&f!=n&&f.Point.FindDirection(t.Point)==h?this.CreateEdge(f,t,i):e!=null&&e!=t&&e.Point.FindDirection(n.Point)==Extensions.OppositeDirection(h)?this.CreateEdge(n,e,i):this.CreateEdge(n,t,i)},n.prototype.InsertEdge=function(n,t){this.InsertEdge_vertex(this.AddVertex(n),this.AddVertex(t))},n.prototype.InsertEdge_vertex=function(n,t){var u=n.Point.FindDirection(t.Point),i=n.FindNextVertex(u),r=n,f;if(i!=null)while(i!=null&&i!=t){if(i==t)break;if(i.Point.OperatorLessThan(t.Point))r=i;else{f=this.visibilityGraph.FindEdge(r.Point,i.Point);this.SplitEdge(t,f);break}r=i;i=r.FindNextVertex(u)}else this.CreateEdge(n,t,1)},n.prototype.GetIntersectingPoint=function(n,t,i){return i?new Point(Utility.ToRoundedInt(t.x),n.getStartPoint().y):new Point(n.getStartPoint().x,Utility.ToRoundedInt(t.y))},n.prototype.CreatePortEntrances=function(n,t,i){var h=new List,e,o,s,u,f,r;if(t!=null){if(e=t.getLocation(),o=this.ObstacleTree.Rectangle,t.Entrances.Clear(),s=new Segment(new Point(o.left(),e.y),new Point(o.right(),e.y)),u=Utility.GetIntersections(s,i.StartVertex),u.size()>0)for(f=0;f<u.size();f++)r=u.get(f),r.x<e.x?t.AddPortEntrance(this.ObstacleTree,new Point(r.x+this.ObstacleTree.ObstaclePadding,r.y),n,PortDirection.Left):t.AddPortEntrance(this.ObstacleTree,new Point(r.x-this.ObstacleTree.ObstaclePadding,r.y),n,PortDirection.Right);if(s=new Segment(new Point(e.x,o.top()),new Point(e.x,o.bottom())),u=Utility.GetIntersections(s,i.StartVertex),u.size()>0)for(f=0;f<u.size();f++)r=u.get(f),r.y<e.y?t.AddPortEntrance(this.ObstacleTree,new Point(r.x,r.y+this.ObstacleTree.ObstaclePadding),n,PortDirection.Top):t.AddPortEntrance(this.ObstacleTree,new Point(r.x,r.y-this.ObstacleTree.ObstaclePadding),n,PortDirection.Bottom);return t.Entrances}return h},n.prototype.FindEntrances=function(n){var i=new List,u,f,r,t;if(n instanceof CenterPort)for(u=n,t=0;t<u.Entrances.size();t++)f=u.Entrances.get(t),r=this.visibilityGraph.FindVertex(f.Location),i.add(r);else r=this.visibilityGraph.FindVertex(n.getLocation()),i.add(r);for(t=0;t<i.size();){if(i.get(t).getDegree()==0){i.RemoveAt(t);continue}t++}return i},n.prototype.GetPortVisibilityIntersection=function(n){var e=n._sourcePortInfo,o=n._targetPortInfo,t=n._sourceNodeInfo,i=n._targetNodeInfo,r,u,s,h,f;if(e!=null&&o!=null)return r=new PortEntrance(e,e.getLocation(),t,e.getDirection(),this.ObstacleTree),u=new PortEntrance(o,o.getLocation(),i,o.getDirection(),this.ObstacleTree),this.targetGeometry.SourceEntrance=r,this.targetGeometry.TargetEntrance=u,f=this.GetPathPoints(n,r,u),f!=null?f:this.CheckForLessDistanceBetweenSourceAndTarget(t,i,e,o);if(t!=null&&t._obstacle!=null&&i!=null&&i._obstacle!=null){var c=t._obstacle.CenterPort,l=i._obstacle.CenterPort,a=this.CreatePortEntrances(t,c,t._obstacle),v=this.CreatePortEntrances(i,l,i._obstacle);if(!c.VisibilityRectangle.intersects(l.VisibilityRectangle))return null;for(s=0;s<a.size();s++)if(r=a.get(Number(s)),r.getWantVisibilityIntersection())for(h=0;h<v.size();h++)if((u=v.get(Number(h)),u.getWantVisibilityIntersection())&&(f=this.GetPathPoints(n,r,u),f!=null))return f}return null},n.prototype.CheckForLessDistanceBetweenSourceAndTarget=function(n,t,i,r){var u;if(i.getDirection()==Extensions.OppositeDirection_Port(r.getDirection())){var o=Utility.IntersectionWithRectangleBorder(n._outerBounds,i.getLocation(),Extensions.GetEquivalentDirection(i.getDirection())),s=Utility.IntersectionWithRectangleBorder(t._outerBounds,r.getLocation(),Extensions.GetEquivalentDirection(r.getDirection())),f=Extensions.FindDistance(o,s,Extensions.GetOrientation_PortDirection(r.getDirection()));if(f<2*this.padding&&f>4){var a=Extensions.GetOrientation_PortDirection(i.getDirection()),e=Extensions.Transform(o,f/2,Extensions.GetEquivalentDirection(i.getDirection())),l=Extensions.GetOrientation_PortDirection(i.getDirection()),h=new Segment(e,Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,e,Extensions.FindDirectionOrientation(i.getLocation(),r.getLocation(),Extensions.OppositeOrientation(l)))),c=Extensions.Transform(s,f/2,Extensions.GetEquivalentDirection(Extensions.OppositeDirection_Port(i.getDirection())));if(this.ObstacleTree.FindMaximumVisibility(h,n)&&h.Contains(c))return u=new PointList,u.add(i.getLocation()),u.add(e),u.add(c),u.add(r.getLocation()),u}}return null},n.prototype.GetPathPoints=function(n,t,i){return t.Direction==Extensions.OppositeDirection_Port(i.Direction)&&t.FirstHit==n._targetNodeInfo&&i.FirstHit==n._sourceNodeInfo?new PointList:t.getIsVertical()==i.getIsVertical()?this.GetPathPointsFromCollinearPorts(t,i):this.GetPathPointsFromIntersectingPorts(t,i)},n.prototype.GetPathPointsFromCollinearPorts=function(n,t){if(!Utility.AreEquivalentLines(n.MaxVisibilitySegment,t.MaxVisibilitySegment)||n.MaxVisibilitySegment.StartPoint.equals(n.MaxVisibilitySegment.EndPoint))return null;var i=new PointList;return i.add(n.Location),i.add(t.Location),i},n.prototype.GetPathPointsFromIntersectingPorts=function(n,t){var r,u=Utility.SegmentIntersects(n.MaxVisibilitySegment,t.MaxVisibilitySegment,r),i;return(r=u.intersect,!u.isInterSect)?null:(i=new PointList,i.add(n.Location),i.add(r),i.add(t.Location),i)},n.prototype.CreateEdge=function(n,t,i,r){var f,u;r===void 0&&(r=Directions.None);this.temporaryAddition?(n.Point.OperatorGreaterThan(t.Point)&&(f=n,n=t,t=f),u=this.visibilityGraph.FindEdge_vertex(n,t),u==null&&(u=new DynamicEdge(n,t,i),this.addedEdges.add(u),VisibilityGraph.AddEdge(u))):this.visibilityGraph.AddEdge(n,t,r,i)},n.prototype.SplitEdge=function(n,t){n.Point.equals(t.getSourcePoint())||n.Point.equals(t.getTargetPoint())||(t instanceof DynamicEdge||!this.temporaryAddition||this.edgesToRestore.add(t),this.visibilityGraph.RemoveEdge_edge(t,!0),this.CreateEdge(n,t.getTarget(),t.getWeight()),this.CreateEdge(t.getSource(),n,t.getWeight()))},n.prototype.FindExistingEdgeEnds=function(n,t,i,r,u,f,e){var o;for(f=!1,e&&(f=!0,o=n,n=t,t=o,i=Extensions.OppositeDirection(i)),r=n;;){if(u=r.FindNextVertex(i),u==null)break;else if(u.Point.equals(t.Point))break;else if(i==t.Point.FindDirection(u.Point))break;r=u}return e?(o=r,r=u,u=o,{isBracketTarget:r!=null,bracketSource:r,bracketTarget:u,sourceEnd:f,swap:e}):{isBracketTarget:u!=null,bracketSource:r,bracketTarget:u,sourceEnd:f,swap:e}},n.prototype.AddVertex=function(n){var t=this.visibilityGraph.FindVertex(n);return t==null&&(t=this.visibilityGraph.AddVertex(n),this.temporaryAddition&&this.addedVertices.add(t)),t},n.prototype.RestoreEdges=function(){for(var n=0;n<this.edgesToRestore.size();n++)VisibilityGraph.AddEdge(this.edgesToRestore.get(n));this.edgesToRestore.Clear()},n.prototype.RemoveAddedEdges=function(){for(var n=0;n<this.addedEdges.size();n++)this.visibilityGraph.RemoveEdge_edge(this.addedEdges.get(n));this.addedEdges.Clear()},n.prototype.RemoveAddedVertices=function(){for(var n=0;n<this.addedVertices.size();n++)this.visibilityGraph.RemoveVertex(this.addedVertices.get(n));this.addedVertices.Clear()},n.prototype.RemoveEdgeGeometryFromGraph=function(){this.RemoveAddedVertices();this.RemoveAddedEdges();this.RestoreEdges()},n.prototype.GetValidPortLocation=function(n){var h,e,o,s,r;if(!this.ObstacleTree.Rectangle.containsPoint(n)){var t=this.ObstacleTree.Rectangle,u=t.left(),c=t.right(),f=t.top(),l=t.bottom(),a=(new PointList).PointList([new Point(u,f),new Point(c,f),new Point(c,l),new Point(u,l),new Point(u,f)]),v=(new PointList).PointList([n,new Point(u,n.y)]),y=(new PointList).PointList([n,new Point(n.x,f)]),i=LineExtensions.Intersect_PointCollection(v,a,!1);for(i=i.Concat(LineExtensions.Intersect_PointCollection(y,a,!1)),i.size()==0&&(i=(new PointList).PointList([t.topLeft,t.topRight,t.bottomLeft,t.bottomRight])),h=n,e=null,o=0;o<i.size();o++)s=i.get(o),r=Math.sqrt(Math.pow(n.x-s.x,2)+Math.pow(n.y-s.y,2)),r=Math.round(r),(e==null||Math.min(e,r)===r)&&(e=r,h=s);n=h}return n},n.prototype.IsCurrentConnectionSegmentsValid=function(n,t){var o=n,f,i,u;if(o!=null){for(f=ej.datavisualization.Diagram.Util.getPoints(o),i=0;i<f.length;i++)i>0&&t.get(t.size()-1)==f[i]&&i!=0||t.add(f[i]);var p=o._outerBounds,a=(new Rect).Rect(f[0],f[f.length-1]),h=this.ObstacleTree.FindNodes(a);if(h&&h.size()>0&&t.size()>0)for(i=0;i<h.size();i++){var c=h.get(i),r=c._obstacle.getPaddedBounds()?c._obstacle.getPaddedBounds():new Rect,e=new PointList;if(e.add(new Point(r.left(),r.top())),e.add(new Point(r.right(),r.top())),e.add(new Point(r.right(),r.bottom())),e.add(new Point(r.left(),r.bottom())),e.add(new Point(r.left(),r.top())),u=new PointList,u.AddRange(LineExtensions.Intersect_PointCollection(e,t,!1)),u.size()>0){if(o._sourceNodeInfo==c||o._targetNodeInfo==c)for(var s=0,l=t.size(),v=(new Rect).Rect(t.get(l-1),t.get(l-2)),y=(new Rect).Rect(t.get(0),t.get(1));s<u.size();)v.containsPoint(u.get(s))||y.containsPoint(u.get(s))?u.RemoveAt(s):s++;if(u.size()>0)return{canValid:!1,points:new PointList}}}return{canValid:!0,points:t}}return{canValid:!1,points:new PointList}},n.prototype.GetLineSegment=function(n,t,i,r,u){var s,h,e,o;u===void 0&&(u=!0);var c,l=Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,n,t),f=new Segment(n,l),a=this.ObstacleTree.FindMaximumVisibility_hitNode(f,i,r,c);return c=a.hitNode,u&&(s=0,h=0,Extensions.GetOrientation(t)==Orientation.Horizontal?h=5:s=5,e=this.GetLineSegment(new Point(n.x+s,n.y+h),t,i,r,!1),o=this.GetLineSegment(new Point(n.x-s,n.y-h),t,i,r,!1),Extensions.GetOrientation(t)==Orientation.Horizontal?(f.Bounds.width>e.Bounds().width&&(f=new Segment(n,new Point(e.EndPoint.x,f.EndPoint.y))),f.Bounds.width>o.Bounds().width&&(f=new Segment(n,new Point(o.EndPoint.x,f.EndPoint.y)))):(f.Bounds.height>e.Bounds().height&&(f=new Segment(n,new Point(f.EndPoint.x,e.EndPoint.y))),f.Bounds.height>o.Bounds().height&&(f=new Segment(n,new Point(f.EndPoint.x,o.EndPoint.y))))),f},n.prototype.IsEndPointChanged=function(n){var r=!0,t,i;return n._points!=null&&n._points.size()>0&&(n._points=n._points,t=new Point,i=new Point,n.sourcePoint&&(t=n.sourcePoint),n.targetPoint&&(i=n.targetPoint),n._points.ElementAt(0).equals(t)&&n._points.ElementAt(n._points.size()-1).equals(i)&&(r=!1)),r},n.prototype.ConnectVertices_vertex=function(n,t,i,r){var u,f;i===void 0&&(i=1);r===void 0&&(r=Directions.None);n!=t&&(this.temporaryAddition?(u=!1,n.Point.OperatorGreaterThan(t.Point)&&(f=t,t=n,n=f,u=!0),this.FindOrAddEdge(n,t,i,u)):this.CreateEdge(n,t,i,r))},n}(),LineUtil=function(){function n(n,t,i,r){this.X1=0;this.Y1=0;this.X2=0;this.Y2=0;this.X1=n;this.X2=i;this.Y1=t;this.Y2=r}return n}(),LineExtensions=function(){function n(){}return n.Intersect=function(n,t,i){var e=!1,f,s;i=new Point(0,0);var r=n,u=t,o=(u.Y2-u.Y1)*(r.X2-r.X1)-(u.X2-u.X1)*(r.Y2-r.Y1),h=(u.X2-u.X1)*(r.Y1-u.Y1)-(u.Y2-u.Y1)*(r.X1-u.X1),c=(r.X2-r.X1)*(r.Y1-u.Y1)-(r.Y2-r.Y1)*(r.X1-u.X1);return o==0&&(e=!1),f=h/o,s=c/o,f>=0&&f<=1&&s>=0&&s<=1&&(i.x=r.X1+f*(r.X2-r.X1),i.y=r.Y1+f*(r.Y2-r.Y1),e=!0),{isInterSect:e,POI:i}},n.Intersect_PointCollection=function(n,t,i){var u,r;for(i&&t.size()>=2&&(t.RemoveAt(0),t.RemoveAt(0)),u=new PointList,r=0;r<n.size()-1;r++)u.AddRange(this.Intersect_PointList(n.get(r),n.get(r+1),t)),i&&t.size()>=1&&t.RemoveAt(0);return u},n.Intersect_PointList=function(n,t,i){for(var u,f=new PointList,r=0;r<i.size()-1;r++)u=this.Intersect_Points(n,t,i.get(r),i.get(r+1)),u.equals(new Point(0,0))||f.add(u);return f},n.Intersect_Points=function(n,t,i,r){var f=new LineUtil(n.x,n.y,t.x,t.y),e=new LineUtil(i.x,i.y,r.x,r.y),u=this.Intersect(f,e,r);return r=u.POI,u.isInterSect?r:new Point(0,0)},n}(),Vertex=function(){function n(n){this._mEastEdge=null;this._mWestEdge=null;this._mSouthEdge=null;this._mNorthEdge=null;this.Point=n}return n.prototype.getEastEdge=function(){return this._mEastEdge},n.prototype.setEastEdge=function(n){this._mEastEdge=n},n.prototype.getWestEdge=function(){return this._mWestEdge},n.prototype.setWestEdge=function(n){this._mWestEdge=n},n.prototype.getSouthEdge=function(){return this._mSouthEdge},n.prototype.setSouthEdge=function(n){this._mSouthEdge=n},n.prototype.getNorthEdge=function(){return this._mNorthEdge},n.prototype.setNorthEdge=function(n){this._mNorthEdge=n},n.prototype.getDegree=function(){var n=0;return this._mEastEdge!=null&&n++,this._mWestEdge!=null&&n++,this._mNorthEdge!=null&&n++,this._mSouthEdge!=null&&n++,n},n.prototype.RemoveEdgeAt=function(n){switch(n){case Directions.East:this._mEastEdge=null;break;case Directions.West:this._mWestEdge=null;break;case Directions.North:this._mNorthEdge=null;break;case Directions.South:this._mSouthEdge=null}},n.prototype.TryGetOutEdge=function(n,t){return t=null,this._mEastEdge!=null&&this._mEastEdge.getTarget()==n?t=this._mEastEdge:this._mNorthEdge!=null&&this._mNorthEdge.getTarget()==n&&(t=this._mNorthEdge),{edge:t,canOut:t!=null?!0:!1}},n.prototype.TryGetInEdge=function(n,t){return t=null,this._mWestEdge!=null&&this._mWestEdge.getTarget()==n?t=this._mWestEdge:this._mSouthEdge!=null&&this._mSouthEdge.getTarget()==n&&(t=this._mSouthEdge),{edge:t,canIn:t!=null?!0:!1}},n.prototype.ClearEdges=function(){this._mEastEdge=null;this._mNorthEdge=null;this._mSouthEdge=null;this._mWestEdge=null},n.prototype.SetVertexEntry=function(n){this.VertexEntries==null&&(this.VertexEntries=new Array(4));this.VertexEntries[Extensions.ToIndex(n.Direction)]=n},n.prototype.RemoveVertexEntries=function(){this.VertexEntries=null},n.prototype.FindNextVertex=function(n){var t=null;return(n==Directions.East?t=this._mEastEdge:n==Directions.West?t=this._mWestEdge:n==Directions.North?t=this._mNorthEdge:n==Directions.South&&(t=this._mSouthEdge),t!=null)?n==Directions.East||n==Directions.North?t.getTarget():t.getSource():null},n.prototype.DisconnectEdges=function(){this._mEastEdge!=null&&this._mEastEdge.getTarget().RemoveEdgeAt(Directions.West);this._mNorthEdge!=null&&this._mNorthEdge.getTarget().RemoveEdgeAt(Directions.South);this._mWestEdge!=null&&this._mWestEdge.getSource().RemoveEdgeAt(Directions.East);this._mSouthEdge!=null&&this._mSouthEdge.getSource().RemoveEdgeAt(Directions.North)},n}(),Edge=function(){function n(n,t,i){this._mSource=null;this._mTarget=null;this._mSourcePoint=new Point;this._mTargetPoint=new Point;this._mLength=0;this._mWeight=0;this._mEdgeDirection=Directions.None;this.Edge(n,t);this._mWeight=i;this.SetEdgeDirection();switch(this._mEdgeDirection){case Directions.East:this._mSource.setEastEdge(this);this._mTarget.setWestEdge(this);break;case Directions.North:this._mSource.setNorthEdge(this);this._mTarget.setSouthEdge(this);break;case Directions.West:this._mSource.setWestEdge(this);this._mTarget.setEastEdge(this);break;case Directions.South:this._mSource.setSouthEdge(this);this._mTarget.setNorthEdge(this)}}return n.prototype.getSource=function(){return this._mSource},n.prototype.getTarget=function(){return this._mTarget},n.prototype.getSourcePoint=function(){return this._mSourcePoint},n.prototype.getTargetPoint=function(){return this._mTargetPoint},n.prototype.getLength=function(){return this._mLength},n.prototype.getWeight=function(){return this._mWeight},n.prototype.getEdgeDirection=function(){return this._mEdgeDirection},n.prototype.Edge=function(n,t){this._mSource=n;this._mTarget=t;this._mSourcePoint=this._mSource!=null?this._mSource.Point:new Point;this._mTargetPoint=this._mTarget!=null?this._mTarget.Point:new Point},n.prototype.EdgeWeight=function(n,t,i,r){this.Edge(n,t);this._mWeight=r;this._mEdgeDirection=i;switch(this._mEdgeDirection){case Directions.East:this._mSource.setEastEdge(this);this._mTarget.setWestEdge(this);break;case Directions.North:this._mSource.setNorthEdge(this);this._mTarget.setSouthEdge(this);break;case Directions.West:this._mSource.setWestEdge(this);this._mTarget.setEastEdge(this);break;case Directions.South:this._mSource.setSouthEdge(this);this._mTarget.setNorthEdge(this)}return this},n.prototype.ResetFields=function(n,t,i,r){i===void 0&&(i=Directions.None);r===void 0&&(r=1);this._mSource!=n&&(this._mSource=n,this._mSourcePoint=this._mSource!=null?this._mSource.Point:new Point);this._mTarget!=t&&(this._mTarget=t,this._mTargetPoint=this._mTarget!=null?this._mTarget.Point:new Point);this._mWeight=r;i==Directions.None?this.SetEdgeDirection():this._mEdgeDirection=i;switch(this._mEdgeDirection){case Directions.East:this._mSource.setEastEdge(this);this._mTarget.setWestEdge(this);break;case Directions.North:this._mSource.setNorthEdge(this);this._mTarget.setSouthEdge(this);break;case Directions.West:this._mSource.setWestEdge(this);this._mTarget.setEastEdge(this);break;case Directions.South:this._mSource.setSouthEdge(this);this._mTarget.setNorthEdge(this)}},n.prototype.ReversedClone=function(){return new this.Edge(this.getTarget(),this.getSource())},n.prototype.Clone=function(){return new this.Edge(this.getSource(),this.getTarget())},n.prototype.ClearProperties=function(){this._mSource!=null&&this._mTarget!=null&&(this._mSource.RemoveEdgeAt(this._mEdgeDirection),this._mTarget.RemoveEdgeAt(Extensions.OppositeDirection(this._mEdgeDirection)))},n.prototype.SetEdgeDirection=function(){var i=this._mSourcePoint.x,r=this._mTargetPoint.x,n,t;i!=r?this._mEdgeDirection=r>i?Directions.East:Directions.West:(n=this._mSourcePoint.y,t=this._mTargetPoint.y,n!=t&&(this._mEdgeDirection=t>n?Directions.North:Directions.South))},n}(),DynamicEdge=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(Edge),VertexEntry=function(){function n(n,t,i,r,u){this.TimeStamp=0;this.Length=0;this.Cost=0;this.NumberOfBends=0;this.Closed=!1;this.Vertex=n;this.PreviousEntry=t;this.Length=i;this.NumberOfBends=r;u=Math.round(u);this.Cost=u;this.Direction=t!=null?t.Vertex.Point.FindDirection(n.Point):Directions.None}return n.prototype.ResetEntry=function(n,t,i,r){this.PreviousEntry=n;t=Math.round(t);this.Cost=t;this.NumberOfBends=i;this.Length=r},n.prototype.CompareTo=function(n){var t=Extensions.CompareTo(this.Cost,n.Cost);return t!=0?t:Extensions.CompareTo(n.TimeStamp,this.TimeStamp)},n.prototype.ToString=function(){return this.PreviousEntry!=null?""+this.PreviousEntry.ToString()+" -> ("+this.Vertex.Point.x+", "+this.Vertex.Point.y+")":"("+this.Vertex.Point.x+", "+this.Vertex.Point.y+")"},n}(),VisibilityGraph=function(){function n(){this.Graph=new Dictionary;this.EdgesCache=new Stack;this.VertexFactory=function(n){return new Vertex(n)}}return n.prototype.getEdges=function(){var n=new List;return this.getVertices().forEach(function(t){t.EastEdge!=null&&n.add(t.EastEdge);t.NorthEdge!=null&&n.add(t.NorthEdge)}),n},n.prototype.getVertices=function(){var r=[],u,n,t,f,i,e;if(this.Graph)for(u=this.Graph.Count(),n=0;n<u;n++)for(t=this.Graph.GetValue(this.Graph.KeyAt(n)),f=t.Count(),i=0;i<f;i++)e=t.GetValue(t.KeyAt(i)),r.push(e);return r},n.prototype.FindVertex=function(n){return this.FindVertexNumber(Utility.ToRoundedInt(n.x),Utility.ToRoundedInt(n.y))},n.prototype.FindVertexNumber=function(n,t){if(this.Graph.ContainsKey(n)){var i=this.Graph.GetValue(n);if(i.ContainsKey(t))return i.GetValue(t)}return null},n.prototype.FindEdge=function(n,t){return this.FindEdge_vertex(this.FindVertex(n),this.FindVertex(t))},n.prototype.FindEdge_vertex=function(n,t){var i=null,r;return n!=null&&t!=null&&(r=n.TryGetOutEdge(t,i),i=r.edge),i},n.prototype.AddVertex=function(n){var t=null,u=Utility.ToRoundedInt(n.x),i=Utility.ToRoundedInt(n.y),r,f;return this.Graph.ContainsKey(u)?(r=this.Graph.GetValue(u),r.ContainsKey(i)?t=r.GetValue(i):(t=new Vertex(n),r.Add(t,i))):(t=new Vertex(n),f=new Dictionary,f.Add(t,i),this.Graph.Add(f,u)),t},n.prototype.ContainsVertex=function(n){var t=Utility.ToRoundedInt(n.x),i=Utility.ToRoundedInt(n.y);return this.Graph.ContainsKey(t)?this.Graph[this.Graph.IndexOfKey(t)].ContainsKey(i):!1},n.prototype.CreateEdge=function(n,t,i,r){i===void 0&&(i=Directions.None);r===void 0&&(r=1);var u=null;return this.EdgesCache.Count()!=0?(u=this.EdgesCache.Pop(),u.ResetFields(n,t,i,r)):u=i!=Directions.None?new Edge(n,t,r).EdgeWeight(n,t,i,r):new Edge(n,t,r),u},n.prototype.AddEdge_Point=function(n,t){var i=this.FindVertex(n),r=this.FindVertex(t);return i==null&&(i=this.AddVertex(n)),r==null&&(r=this.AddVertex(t)),this.AddEdge(i,r)},n.prototype.AddEdge=function(n,t,i,r){i===void 0&&(i=Directions.None);r===void 0&&(r=1);var u=this.FindEdge_vertex(n,t);return u?u:this.CreateEdge(n,t,i,r)},n.AddEdge=function(n){if(n.getSource()!=null&&n.getTarget()!=null)switch(n.getEdgeDirection()){case Directions.East:n.getSource().setEastEdge(n);n.getTarget().setWestEdge(n);break;case Directions.North:n.getSource().setNorthEdge(n);n.getTarget().setSouthEdge(n);break;case Directions.West:n.getSource().setWestEdge(n);n.getTarget().setEastEdge(n);break;case Directions.South:n.getSource().setSouthEdge(n);n.getTarget().setNorthEdge(n)}},n.prototype.RemoveVertex=function(n){var t,r,i;n!=null&&(n.DisconnectEdges(),t=Utility.ToRoundedInt(n.Point.x),r=Utility.ToRoundedInt(n.Point.y),this.Graph.ContainsKey(t)&&(i=this.Graph.GetValue(t),i.ContainsKey(r)&&i.Remove(r),i.Count()==0&&this.Graph.Remove(t)),n=null)},n.prototype.RemoveEdge=function(n,t){var i=this.FindEdge_vertex(n,t);return i!=null&&this.RemoveEdge_edge(i),i},n.prototype.RemoveEdge_point=function(n,t){var i=this.FindEdge(n,t);i!=null&&this.RemoveEdge_edge(i)},n.prototype.RemoveEdge_edge=function(n,t){t===void 0&&(t=!1);n.ClearProperties();t||n instanceof DynamicEdge||this.EdgesCache.Push(n);n=null},n.prototype.ClearEdges=function(){this.getVertices().forEach(function(n){n.ClearEdges()})},n.stackCapacity=1e3,n}(),EdgeGeometry=function(){function n(){}return n.prototype.GetCurrentEnd=function(){return this.CurrentEnd==ConnectionEnd.Source?this.SourceEntrance.Location:this.TargetEntrance.Location},n.prototype.GetOppositeEnd=function(){return this.CurrentEnd==ConnectionEnd.Target?this.Connector._sourceNodeInfo!=null?this.Connector._sourcePortInfo!=null?this.Connector._sourcePortInfo.getLocation():this.Connector._sourceNodeInfo._outerBounds.center():this.Connector._sourcePointInfo.getLocation():this.Connector._targetNodeInfo!=null?this.Connector._targetPortInfo!=null?this.Connector._targetPortInfo.getLocation():this.Connector._targetNodeInfo._outerBounds.center():this.Connector._targetPointInfo.getLocation()},n.prototype.GetCurrentEntrance=function(){return this.CurrentEnd==ConnectionEnd.Source?this.SourceEntrance:this.TargetEntrance},n}();(function(n,t){"use strict";t.datavisualization.Diagram.ZoomUtil={zoomPan:function(i,r,u,f,e,o){var h,c,a,v,y;if(o&&t.datavisualization.Diagram.Util.canZooming(i)||!o&&t.datavisualization.Diagram.Util.canPanning(i)){var l=t.datavisualization.Diagram.ScrollUtil._viewPort(i,!0),p={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:l},s=t.Matrix.identity();t.Matrix.scale(s,i._currZoom,i._currZoom);t.Matrix.translate(s,-i._hScrollOffset,-i._vScrollOffset);h=i._currZoom*r;h>i.model.scrollSettings.maxZoom?r=i.model.scrollSettings.maxZoom/i._currZoom:h<i.model.scrollSettings.minZoom&&(r=i.model.scrollSettings.minZoom/i._currZoom);c=t.Matrix.identity();a=e?t.Matrix.transform(s,e):t.datavisualization.Diagram.Point(n(i.element).width()/2,n(i.element).height()/2);t.Matrix.scale(c,r,r,a.x,a.y);h=i._currZoom*r;t.Matrix.translate(c,u,f);t.Matrix.multiply(s,c);v=t.Matrix.transform(s,t.datavisualization.Diagram.Point(0,0));i._compareModelProperty("scrollSettings",!0);this._applyTransform(i,h,v,o,l);y={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:l};i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Zoom;o||(i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan);i._raiseEvent("scrollChange",{newValues:y,oldValues:p})}},_applyTransform:function(n,i,r,u,f){n._currZoom=i;var e=r.x*-1,o=r.y*-1,s=n._getDigramBounds();if(!u&&n._scrollLimit()!==t.datavisualization.Diagram.ScrollLimit.Infinity)if(n._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Diagram){s.x-=n.model.scrollSettings.padding.left;s.y-=n.model.scrollSettings.padding.top;s.width+=n.model.scrollSettings.padding.left+n.model.scrollSettings.padding.right;s.height+=n.model.scrollSettings.padding.top+n.model.scrollSettings.padding.bottom;var h=s.width*n._currZoom>f.width,c=s.height*n._currZoom>f.height,l=(s.width+s.x)*n._currZoom-f.width,a=(s.height+s.y)*n._currZoom-f.height;!h&&e>n._hScrollOffset&&e>s.x*n._currZoom||h&&e<n._hScrollOffset&&e<s.x*n._currZoom?e=n._hScrollOffset:(!h&&e<n._hScrollOffset&&e<l||h&&e>n._hScrollOffset&&e>l)&&(e=n._hScrollOffset);!c&&o>n._vScrollOffset&&o>s.y*n._currZoom||c&&o<n._vScrollOffset&&o<s.y*n._currZoom?o=n._vScrollOffset:(!c&&o<n._vScrollOffset&&o<a||c&&o>n._vScrollOffset&&o>a)&&(o=n._vScrollOffset)}else e<n._hScrollbar.model.minimum&&!(n._hScrollbar.model.minimum==0&&-n._hScrollOffset>r.x)?e=n._hScrollOffset:e>n._hScrollbar.model.maximum&&(e=n._hScrollbar.model.maximum),o<n._vScrollbar.model.minimum&&!(n._vScrollbar.model.minimum==0&&-n._vScrollOffset>r.y)?o=n._vScrollOffset:o>n._vScrollbar.model.maximum&&(o=n._vScrollbar.model.maximum);n._updateScrollOffset(e,o,!0,u)}};t.datavisualization.Diagram.PageUtil={_createPageBreaks:function(n){this._removePageBreaks(n);var i={id:n._canvas.id+"pagebreaks","pointer-events":"none"},r=t.datavisualization.Diagram.SvgContext._initializePageBreaks(n._svg,i,n._pageBackgroundLayer);this._updatePageBreaks(r,n)},_removePageBreaks:function(n){var i=n._svg.getElementById(n._canvas.id+"pagebreaks");i&&t.datavisualization.Diagram.SvgContext._removePageBreaks(n._svg,i,n._pageBackgroundLayer)},_updatePageBreaks:function(n,i){var o=i._getDigramBounds(),k=i.model.pageSettings,r=o.x,w=o.width+o.x,u=o.y,b=o.height+o.y,f=i._currZoom,a=i._pageHeight(),v=i._pageWidth(),e=i._pageMargin(),y=parseInt(Math.ceil((w-r)/v)),p=parseInt(Math.ceil((b-u)/a)),s,h,c,l;for(r=-i._canvas.clientLeft+(e+r)*f,u=-i._canvas.clientTop+(e+u)*f,s=(v*y-e*2)*f,h=(a*p-e*2)*f,t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r+s,u),i._svg,n),t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r,u+h),i._svg,n),c=1;c<y;c++)t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+(v*c-e)*f,u),t.datavisualization.Diagram.Point(r+(v*c-e)*f,u+h),i._svg,n);for(l=1;l<p;l++)t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+(a*l-e)*f),t.datavisualization.Diagram.Point(r+s,u+(a*l-e)*f),i._svg,n);t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+s,u),t.datavisualization.Diagram.Point(r+s,u+h),i._svg,n);t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+h),t.datavisualization.Diagram.Point(r+s,u+h),i._svg,n)},_updatePageSize:function(n,i){var o=!1,y=typeof n.model.pageSettings.pageOrientation=="string"?n.model.pageSettings.pageOrientation:n._pageOrientation(),u=typeof n.model.pageSettings.pageWidth=="string"?n.model.pageSettings.pageWidth:n._pageWidth(),r=typeof n.model.pageSettings.pageHeight=="string"?n.model.pageSettings.pageHeight:n._pageHeight(),s,v;y==t.datavisualization.Diagram.PageOrientations.Landscape?r>u&&(o=!0):u>r&&(o=!0);o&&(s=u,n._pageWidth(r),n._pageHeight(s));var f=n._getDigramBounds(),e=n._currZoom,h=f.x*e,c=f.y*e,l=f.width*e,a=f.height*e,p=n.model.pageSettings;n._pageBackgroundLayer&&n._pageBackgroundLayer.firstChild?t.datavisualization.Diagram.SvgContext._updatePageBakground(t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(l,a),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth()):t.datavisualization.Diagram.SvgContext._renderPageSettingsRect(t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(l,a),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth());(n.model.backgroundColor!=="transparent"||n.model.backgroundImage&&n.model.backgroundImage.source)&&t.datavisualization.Diagram.SvgContext._updateBackground(n._hScrollOffset,n._vScrollOffset,n._currZoom,n);n._svg.document.style.left=0;n._svg.document.style.top=0;v=!1;u||r||(v=!0);p.pageWidth&&r&&(n._showPageBreak()?this._createPageBreaks(n):this._removePageBreaks(n));i||t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n)}};t.datavisualization.Diagram.ScrollUtil={_transform:function(n,i,r,u){t.datavisualization.Diagram.SvgContext.transformView(n,-i,-r);u&&t.datavisualization.Diagram.SvgContext.scaleContent(n,n._currZoom);this._updateRuler(n,i,r);t.datavisualization.Diagram.PageUtil._updatePageSize(n);t.datavisualization.Diagram.SvgContext._updateGrid(i,r,n._currZoom,n)},_updateRuler:function(i,r,u){if(i&&i.model.rulerSettings.showRulers){var e=this._getRulerSize(i),f=t.datavisualization.Diagram.ScrollUtil._getRulerGeometry(i,!0);r!=undefined&&i._hRuler&&(t.datavisualization.Diagram.SvgContext._updateRulerSpace(i,f,!0),n("#"+i._hRuler[0].id).ejRuler({offset:r,scale:i._currZoom,length:f.width+100}),i._hRuler[0].style.marginLeft=e.left-i._hRulerInstance._hRulerDiff+"px");u!=undefined&&i._vRuler&&(t.datavisualization.Diagram.SvgContext._updateRulerSpace(i,f,!1),n("#"+i._vRuler[0].id).ejRuler({offset:u,scale:i._currZoom,length:f.height+100}),i._vRuler[0].style.marginTop=-i._vRulerInstance._vRulerDiff+"px")}},_viewPort:function(n,i){var o,e;if(n._viewPort&&!i)return n._viewPort;var h=n.element[0],r=n.element[0].getBoundingClientRect(),u=r.width,f=r.height,s=window.screenX<0?window.screenX*-1:window.screenX;return u===0&&(u=Math.floor(window.innerWidth-s-Math.floor(r.left))),o=window.screenY<0?window.screenY*-1:window.screenY,f===0&&(f=Math.floor(window.innerHeight-o-Math.floor(r.window))),e=this._getRulerSize(n),t.datavisualization.Diagram.Size(u-e.left,f-e.top)},_getRulerSize:function(n){var t=0,i=0;return n.model.rulerSettings.showRulers&&(n.model.rulerSettings.horizontalRuler.thickness&&(i=n.model.rulerSettings.horizontalRuler.thickness),n.model.rulerSettings.verticalRuler.thickness&&(t=n.model.rulerSettings.verticalRuler.thickness)),{left:t,top:i}},_getRulerGeometry:function(n){var t=this._getRulerSize(n),i=n._viewPort.height,r=n._viewPort.width;return r<n._canvas.clientWidth-t.left&&(r=n._canvas.clientWidth-t.left),i<n._canvas.clientHeight-t.top&&(i=n._canvas.clientHeight-t.top),n.model.rulerSettings.horizontalRuler.length&&(r=n.model.rulerSettings.horizontalRuler.length),n.model.rulerSettings.verticalRuler.length&&(i=n.model.rulerSettings.verticalRuler.length),{width:r,height:i}},_union:function(n,t){var i,r,u,f;return n.width<=0?t:n.width>0?(i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),t.width===Infinity||n.width===Infinity?n.width=Infinity:(u=Math.max(n.x+n.width,t.x+t.width),n.width=Math.max(u-i,0)),t.height===Infinity||n.height===Infinity?n.height=Infinity:(f=Math.max(n.y+n.height,t.y+t.height),n.height=Math.max(f-r,0)),n.x=i,n.y=r,n):void 0},_setScrollContentSize:function(i){var s=i._currZoom,u=this._viewPort(i),a,v,r,b,y,w,k,p,l,d,g,rt,nt,ut,ft;u=t.datavisualization.Diagram.Rectangle(i._hScrollOffset,i._vScrollOffset,u.width,u.height);var o=i.model.scrollSettings.padding,f=i._spatialSearch.pageLeft,h=i._spatialSearch.pageRight,e=i._spatialSearch.pageTop,c=i._spatialSearch.pageBottom,tt=f,it=e;f>h&&(f=h=0);e>c&&(e=c=0);i.model.pageSettings&&(a=Number(i._pageWidth()),v=Number(i._pageHeight()),a>0&&v>0?(i._multiplePage()?(f=Math.floor(f/a)*a,e=Math.floor(e/v)*v,h=Math.ceil(h/a)*a,c=Math.ceil(c/v)*v):(f=0,e=0,h=a,c=v),f-=o.left,h+=o.right,e-=o.top,c+=o.bottom,tt=f,it=e):(f=f<0?f:0,e=e<0?e:0,i._spatialSearch.pageLeft-f<o.left&&(f+=i._spatialSearch.pageLeft-f-o.left),i._spatialSearch.pageTop-e<o.top&&(e+=i._spatialSearch.pageTop-e-o.top),i._spatialSearch.pageRight+o.right>u.width&&i._spatialSearch.pageRight<u.width?h+=o.right+i._spatialSearch.pageRight-u.width:i._spatialSearch.pageRight>u.width&&(h+=o.right),i._spatialSearch.pageBottom+o.bottom>u.height&&i._spatialSearch.pageBottom<u.height?c+=o.bottom+i._spatialSearch.pageBottom-u.height:i._spatialSearch.pageBottom>u.height&&(c+=o.bottom),tt-=o.left,it-=o.top));f=f*s;e=e*s;h=h*s;c=c*s;r=t.datavisualization.Diagram.Rectangle(0,0,0,0);r=this._union(r,t.datavisualization.Diagram.Rectangle(0,0,u.width,u.height));r=this._union(r,t.datavisualization.Diagram.Geometry.rect([{x:f,y:e},{x:h,y:c}]));r.width-=u.width-18;r.height-=u.height-18;r.x>i._hScrollOffset&&(w=r.x-i._hScrollOffset,r.x-=w,r.width+=w);i._hScrollOffset>r.x+r.width&&(r.width=i._hScrollOffset-r.x);b=r.x;y=Math.max(0,r.x+r.width);r.y>i._vScrollOffset&&(w=r.y-i._vScrollOffset,r.y-=w,r.height+=w);i._vScrollOffset>r.y+r.height&&(r.height=i._vScrollOffset-r.y);k=r.y;p=Math.max(0,r.y+r.height);r.width=u.width;r.height=u.height;i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited&&(l=i.model.pageSettings.scrollableArea,b=l.x*s,k=l.y*s,y=(l.x+l.width)*s-u.width,p=(l.y+l.height)*s-u.height,c=(l.y+l.height)*s,h=(l.x+l.width)*s,e=l.y*s,f=l.x*s);d=!0;g=!0;f>=i._hScrollOffset&&h<=u.width+i._hScrollOffset&&(d=!1,i._hScrollbar._remove(),i._hScrollbar.model.width=0,i._hScrollbar.model.minimum=i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,b):0,i._hScrollbar.model.maximum=0);e>=i._vScrollOffset&&c<=u.height+i._vScrollOffset&&(g=!1,i._vScrollbar._remove(),i._vScrollbar.model.height=0,i._vScrollbar.model.minimum=i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,k):0,i._vScrollbar.model.maximum=0);d&&(rt=g?u.width-18:u.width,y=g?y:y-18,i._preventScrollerUpdate?(i._hScrollbar.model.minimum=b,i._hScrollbar.model.maximum=y):(n("#"+i._canvas.id+"_hScrollbar").ejScrollBar({width:rt,viewportSize:rt,maximum:y,minimum:b}),n("#"+i._canvas.id+"_hScrollbar").ejScrollBar("scroll",i._hScrollOffset)),nt=document.getElementById(i._canvas.id+"_hScrollbar"),nt.style.marginTop=u.height-18+"px",Math.round(tt*s)>=Math.round(i._hScrollOffset)&&Math.round(h)<=Math.round(u.width+i._hScrollOffset)?nt.style.visibility="hidden":(nt.style.visibility="visible",r.height>=18&&(r.height-=18)));g&&(ut=d?u.height-18:u.height,p=d?p:p-18,i._preventScrollerUpdate?(i._vScrollbar.model.minimum=k,i._vScrollbar.model.maximum=p):(n("#"+i._canvas.id+"_vScrollbar").ejScrollBar({height:ut,viewportSize:ut,maximum:p,minimum:k}),n("#"+i._canvas.id+"_vScrollbar").ejScrollBar("scroll",i._vScrollOffset)),ft=document.getElementById(i._canvas.id+"_vScrollbar"),Math.round(it*s)>=Math.round(i._vScrollOffset)&&Math.round(c)<=Math.round(u.height+i._vScrollOffset)?ft.style.visibility="hidden":(ft.style.visibility="visible",r.width>=18&&(r.width-=18)));i._isMobile&&i._disableScrollbar();t.datavisualization.Diagram.SvgContext.setSize(i,r.width,r.height)},_setMinMaxValues:function(n,t,i,r,u,f,e){var o=n.model.pageSettings.scrollableArea;return t=Math.max(t,o.x*e),i=Math.max(i,o.y*e),r=Math.min((o.x+o.width)*e-f.width,r),u=Math.min((o.y+o.height)*e-f.height,u),r=r>0?r:0,u=u>0?u:0,{minX:t,minY:i,maxX:r,maxY:u}},_initScrollbar:function(i){var u=i._canvas,f=document.getElementById(u.id+"_hScrollbar"),e=document.getElementById(u.id+"_vScrollbar"),r=this._viewPort(i);n(f).ejScrollBar({orientation:t.ScrollBar.Orientation.Horizontal,width:r.width-18,viewportSize:r.width-18,scroll:function(n){var r,u;n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&(r={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(n.scrollLeft,i._vScrollOffset),u={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:u,oldValues:r}))}});i._hScrollbar=n(f).ejScrollBar("instance");n(e).ejScrollBar({orientation:t.ScrollBar.Orientation.Vertical,height:r.height-18,viewportSize:r.height-18,scroll:function(n){var r,u;n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&(r={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(i._hScrollOffset,n.scrollTop),u={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:u,oldValues:r}))}});i._vScrollbar=n(e).ejScrollBar("instance")}};t.datavisualization.Diagram.SnapUtil={_canConsider:function(n,t,i){var r=!1;return t!=i&&(t._type=="group"||t._type=="pseudoGroup"?r=i.isSwimlane&&!t.isSwimlane?!1:!this._contains(n,t,i):i._type=="group"&&i.type!="bpmn"||i.type=="pseudoGroup"?r=i.isSwimlane&&!t.isSwimlane?!1:!this._contains(n,i,t):t.segments||(r=!(t==i))),r},_contains:function(n,t,i){var e=i.name,o=null,f,u,r;if(t.children.indexOf(e)>=0){if(o=n[e],o==i)return!0}else if(t.children.indexOf(i)>=0)return!0;if(t._type=="group"||t._type=="pseudoGroup"){for(f=!1,u=0;u<t.children.length;u++)if(this.diagram&&(r=typeof t.children[u]=="string"?n[t.children[u]]:n[t.children[u].name],r&&(typeof r=="string"&&(r=n[r]),r._type=="group"&&(f=this._contains(n,r,i)),f)))return f;return f}return!1},_getSnapIntervals:function(n,t){var i=[],r,f,u;return n.model.rulerSettings.showRulers?(r=t?n.model.rulerSettings.horizontalRuler:n.model.rulerSettings.verticalRuler,f=r.segmentWidth/r.interval,i.push(Math.round(f*100)/100)):(u=n.model.snapSettings,i=t?u.verticalGridLines.snapInterval:u.horizontalGridLines.snapInterval),i},_round:function(n,t,i){var f,r;for(i=i>1?Math.pow(2,Math.floor(Math.log(i)/Math.log(2))):Math.pow(2,Math.ceil(Math.log(i)/Math.log(2))),f=0,r=0;r<t.length;r++)f+=t[r];f/=i;var o=Math.floor(Math.abs(n)/f),e=n%f,u=o*f;if(u!=n)if(n>=0)for(r=0;r<t.length;r++){if(e<=t[r]/i)return u+(e<t[r]/(2*i)?0:t[r]/i);u+=t[r]/i;e-=t[r]/i}else for(u=u*-1,r=t.length-1;r>=0;r--){if(Math.abs(e)<=t[r]/i)return u-(Math.abs(e)<t[r]/(2*i)?0:t[r]/i);u-=t[r]/i;e+=t[r]/i}return n},_findNodes:function(n,i,r,u,f){for(var c=[],o,e,l,h,a=t.datavisualization.Diagram.SpatialUtil.findQuads(n,f?u:r),s=0;s<a.length;s++)if(o=a[s],o.objects.length>0)for(h=0;h<o.objects.length;h++)e=o.objects[h],!e.segments&&e.visible&&(l=t.datavisualization.Diagram.Util.bounds(e),c.indexOf(e)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(r,l)&&c.push(e),f&&f.indexOf(e)&&t.datavisualization.Diagram.Geometry.intersectsRect(u,l)&&f.push(e));return c},_snapAngle:function(n,t){var i=n._snapAngle(),r=t%i;return r>=i/2?t+i-r:t-r},_snapPoint:function(n,i,r,u,f,e,o){var it=n.model.snapSettings,c=n._currZoom,h=t.datavisualization.Diagram.Point(),s=t.datavisualization.Diagram.Util.bounds(i),b={snapped:!1,offset:0},k={snapped:!1,offset:0};this.diagram=n;n._enableSnapToObject()&&this._snapObject(n,i,b,k,f,o==e);var d=s.x+f.x,g=s.y+f.y,nt=s.x+s.width+f.x,tt=s.y+s.height+f.y,l=this._round(nt,this._getSnapIntervals(n,!0),c),a=this._round(d,this._getSnapIntervals(n,!0),c),v=this._round(g,this._getSnapIntervals(n,!1),c),y=this._round(tt,this._getSnapIntervals(n,!1),c),p=s.x+s.width,w=s.y+s.height;return b.snapped?h.x=n._enableSnapToObject()?b.offset:e.x-o.x:n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines?Math.abs(f.x)>=1&&(h.x+=r?Math.abs(l-p)>Math.abs(a-s.x)?a-s.x:l-p:Math.abs(l-p)<Math.abs(a-s.x)?l-p:a-s.x):h.x=e.x-o.x,k.snapped?h.y=k.offset:n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines?Math.abs(f.y)>=1&&(h.y+=u?Math.abs(y-w)>Math.abs(v-s.y)?v-s.y:y-w:Math.abs(y-w)<Math.abs(v-s.y)?y-w:v-s.y):h.y=e.y-o.y,h},_snapObject:function(n,i,r,u,f,e){var v=null,y=null,w,b,d=[],g=[],it=[],rt=[],o=t.datavisualization.Diagram.Util.bounds(i),l=n._currZoom,ut=n._hScrollOffset,ft=n._vScrollOffset,h=n._snapObjectDistance(),p=n._viewPort,et=t.datavisualization.Diagram.Rectangle(ut/l,o.y-h-5,p.width/l,o.height+2*h+10),ot=t.datavisualization.Diagram.Rectangle(o.x-h-5,ft/l,o.width+2*h+10,p.height/l),k,a,c,s,nt,tt;for(p=t.datavisualization.Diagram.Rectangle(ut/l,ft/l,p.width/l,p.height/l),k=this._findNodes(n._spatialSearch,i,ot,p),nt=n.nameTable,a=0;a<k.length;a++)c=k[a],t.datavisualization.Diagram.Util._canBeTarget(n,c)&&!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.y+s.height<o.y+f.y?it.push({object:c,distance:Math.abs(o.y+f.y-s.y-s.height)}):s.y>o.y+f.y+o.height&&rt.push({object:c,distance:Math.abs(o.y+f.y+o.height-s.y)}),(v==null||v>Math.abs(s.y-o.y-f.y))&&(Math.abs(s.x+s.width/2-(o.x+o.width/2+f.x))<=h?(w=this._createSnapObject(s,o,"centerX"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"left"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+o.width+f.x))<=h?(w=this._createSnapObject(s,o,"right"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"leftRight"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+o.width+f.x))<=h&&(w=this._createSnapObject(s,o,"rightLeft"),v=Math.abs(s.y-o.y))));for(k=this._findNodes(n._spatialSearch,i,et,p),a=0;a<k.length;a++)c=k[a],t.datavisualization.Diagram.Util._canBeTarget(n,c)&&!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.x+s.width<o.x+f.x&&(d[d.length]={object:c,distance:Math.abs(o.x+f.x-s.x-s.width)}),s.x>o.x+f.x+o.width&&(g[g.length]={object:c,distance:Math.abs(o.x+f.x+o.width-s.x)}),(y==null||y>Math.abs(s.x-o.x-f.x))&&(Math.abs(s.y+s.height/2-(o.y+o.height/2+f.y))<=h?(b=this._createSnapObject(s,o,"centerY"),y=Math.abs(s.x-o.x)):Math.abs(s.y-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"top"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-(o.y+o.height+f.y))<=h?(b=this._createSnapObject(s,o,"bottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"topBottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y-(o.y+o.height+f.y))<=h&&(b=this._createSnapObject(s,o,"bottomTop"),y=Math.abs(s.x-o.x))));tt=this._createGuidelines(n,w,b,r,u,e);r.snapped||this._createHSpacingLines(n,i,d,g,r,u,e,tt,f,h);u.snapped||this._createVSpacingLines(n,i,it,rt,r,u,e,tt,f,h)},_snapSize:function(n,i,r,u,f,e,o){var p=null,w=null,d,g,s=t.datavisualization.Diagram.Util.bounds(e),ut=n.nameTable,nt=[],tt=[],l=n._currZoom,st=n._hScrollOffset,ht=n._vScrollOffset,v=n._snapObjectDistance(),y=n._viewPort,lt=t.datavisualization.Diagram.Rectangle(st/l,(s.y-5)/l,y.width/l,(s.height+10)/l),at=t.datavisualization.Diagram.Rectangle((s.x-5)/l,ht/l,(s.width+10)/l,y.height/l),it,b,a,c,h,et,ot;for(y=t.datavisualization.Diagram.Rectangle(st/l,ht/l,y.width/l,y.height/l),it=[],b=this._findNodes(n._spatialSearch,e,at,y,it),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(p==null||p>Math.abs(h.y-s.y))&&(i.left?Math.abs(s.x+u-h.x)<=v?(d=this._createSnapObject(h,s,"left"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u-h.x-h.width)<=v&&(d=this._createSnapObject(h,s,"leftRight"),p=Math.abs(h.y-s.y)):i.right&&(Math.abs(s.x+u+s.width-h.x-h.width)<=v?(d=this._createSnapObject(h,s,"right"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u+s.width-h.x)<=v&&(d=this._createSnapObject(h,s,"rightLeft"),p=Math.abs(h.y-s.y)))));for(b=this._findNodes(n._spatialSearch,e,lt,y),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(w==null||w>Math.abs(h.x-s.x))&&(r.top?Math.abs(s.y+f-h.y)<=v?(g=this._createSnapObject(h,s,"top"),w=Math.abs(h.x-s.x)):Math.abs(s.y+f-h.y-h.height)<=v&&(g=this._createSnapObject(h,s,"topBottom"),w=Math.abs(h.x-s.x)):r.bottom&&(Math.abs(s.y+s.height+f-h.y-h.height)<=v?(g=this._createSnapObject(h,s,"bottom"),w=Math.abs(h.x-s.x)):Math.abs(s.y+s.height+f-h.y)<=v&&(g=this._createSnapObject(h,s,"bottomTop"),w=Math.abs(h.x-s.x)))));for(a=0;a<it.length;a++)if(c=it[a],this._canConsider(ut,e,c)){var k=t.datavisualization.Diagram.Util.bounds(c),ft=i.left?-u:u,ct=Math.abs(s.width+ft-k.width),rt;ct<=v&&(rt=i.left?-k.width+s.width:k.width-s.width,nt[nt.length]={source:c,diff:ct,offset:rt});ft=r.top?-f:f;et=Math.abs(s.height+ft-k.height);et<=v&&(rt=r.top?-k.height+s.height:k.height-s.height,tt[tt.length]={source:c,diff:et,offset:rt})}n.activeTool.selectedSeperator||(ot=this._createGuidelines(n,d,g,i,r,o));!i.snapped&&nt.length>0&&(i.left||i.right)&&this._addSameWidthLines(n,nt,i,o,ot,e);!r.snapped&&tt.length>0&&(r.top||r.bottom)&&this._addSameHeightLines(n,tt,r,o,ot,e)},_createSnapObject:function(n,i,r){var u;switch(r){case"left":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x,offsetY:0,type:"sideAlign"};break;case"right":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"top":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y,offsetX:0,type:"sideAlign"};break;case"bottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"topBottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"leftRight":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"centerX":u={start:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width/2-(i.x+i.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height/2),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height/2),offsetY:n.y+n.height/2-(i.y+i.height/2),offsetX:0,type:"centerAlign"}}return u},_createGuidelines:function(n,i,r,u,f,e){var l={id:n._canvas.id+"guideline",style:"pointer-events:none;"},o=t.datavisualization.Diagram.SvgContext._initializeGuidelines(n._adornerSvg,l,n._adornerLayer),s=n._currZoom,h=n._hScrollOffset,c=n._vScrollOffset;return i&&(u.offset=i.offsetX,u.snapped=!0,e||(i.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(i.start,i.end,o,n._adornerSvg,s,h,c):i.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(i.start,i.end,o,n._adornerSvg,s,h,c))),r&&(f.offset=r.offsetY,f.snapped=!0,e||(r.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(r.start,r.end,o,n._adornerSvg,s,h,c):r.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(r.start,r.end,o,n._adornerSvg,s,h,c))),n._guideline=o,o},_removeGuidelines:function(n){var i=n._guideline?n._guideline:n._adornerSvg.getElementById(n._canvas.id+"guideline");i!=null&&(t.datavisualization.Diagram.SvgContext._removeGuidelines(n._adornerLayer,i),delete n._guideline)},_sortByDistance:function(n,t,i){var r,u,f;if(i)for(r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)n[r][t]>n[u][t]&&(f=n[r],n[r]=n[u],n[u]=f);else for(r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)n[r][t]<n[u][t]&&(f=n[r],n[r]=n[u],n[u]=f)},_createHSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,w,p,y,b,v,d,g,k;this._sortByDistance(r,"distance",!0);this._sortByDistance(u,"distance",!0);l=[];w=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],p=t.datavisualization.Diagram.Util.bounds(r[0].object),a=p.y,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),v=p.x-b.x-b.width,Math.abs(v-r[0].distance)<=c?a=this._findEquallySpacedNodesAtLeft(r,v,a,l):v=r[0].distance):v=r[0].distance);this._sortByDistance(l,"distance");l[l.length]={object:i,distance:0};a=w.y<a||!a?w.y:a;u.length>0&&(y=t.datavisualization.Diagram.Util.bounds(u[0].object),a=y.y<a?y.y:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.x-y.x-y.width),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?v-=g:v+=g,l[l.length]=u[0]):r.length==1&&(p=undefined,l.splice(0,1),l[l.length]=u[0],v=d):(v=d,l[l.length]=u[0]),u.length>1&&y.x+y.width<b.x&&(a=this._findEquallySpacedNodesAtRight(u,d,a,l,c)));l.length>2&&(this._addHSpacingLines(n,l,o,s,a),k=0,o&&(k=h.x),p?f.offset=v-Math.abs(w.x+k-p.x-p.width)+k:y&&(f.offset=Math.abs(w.x+w.width+k-y.x)-v+k),f.snapped=!0)},_createVSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,p,w,v,b,y,d,g,k;this._sortByDistance(r,"distance",!0);this._sortByDistance(u,"distance",!0);l=[];p=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],w=t.datavisualization.Diagram.Util.bounds(r[0].object),a=w.x+w.width,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),y=w.y-b.y-b.height,Math.abs(y-r[0].distance)<=c?a=this._findEquallySpacedNodesAtTop(r,y,a,l):y=r[0].distance):y=r[0].distance);this._sortByDistance(l,"distance");l[l.length]={object:i,distance:0};a=p.x+p.width>a||!a?p.x+p.width:a;u.length>0&&(v=t.datavisualization.Diagram.Util.bounds(u[0].object),a=v.x+v.width>a?v.x+v.width:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.y-v.y-v.height),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?y-=g:y+=g,l[l.length]=u[0]):r.length==1&&(w=undefined,l.splice(0,1),l[l.length]=u[0],y=d):(y=d,l[l.length]=u[0]),u.length>1&&b.y>v.y+v.height&&(a=this._findEquallySpacedNodesAtBottom(u,d,a,l,c)));l.length>2&&(this._addVSpacingLine(n,l,o,s,a),k=0,o&&(k=h.y),w?e.offset=y-Math.abs(p.y+k-w.y-w.height)+k:v&&(e.offset=Math.abs(p.y+p.height+k-v.y)-y+k),e.snapped=!0)},_addHSpacingLines:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,e,o,s;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width,f-15),t.datavisualization.Diagram.Point(s.x,f-15),u,n._adornerSvg,h,c,l)},_addVSpacingLine:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,o,s,e;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(f+15,o.y+o.height),t.datavisualization.Diagram.Point(f+15,s.y),u,n._adornerSvg,h,c,l)},_addSameWidthLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;this._sortByDistance(i,"offset");var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=1;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.width==p.width&&h.push(i[s]);if(h.length>0&&!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+c.offset,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width+c.offset,o.y-15),f,n._adornerSvg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width,o.y-15),f,n._adornerSvg,l,a,v);r.offset=c.offset;r.snapped=!0},_addSameHeightLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;this._sortByDistance(i,"offset");var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=0;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.height==p.height&&h.push(i[s]);if(h.length>0){if(!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+c.offset),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height+c.offset),f,n._adornerSvg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height),f,n._adornerSvg,l,a,v);r.offset=c.offset;r.snapped=!0}},_findEquallySpacedNodesAtLeft:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.x-f.x-f.width,Math.abs(s-i)<=1)u[u.length]=n[e],f.y<r&&(r=f.y);else break;return r},_findEquallySpacedNodesAtRight:function(n,i,r,u,f){var l=n[0].distance,s,h,o,c,e;if(Math.abs(i-l)<=f)for(e=0;e<n.length-1;e++)if(s=n[e].object,h=t.datavisualization.Diagram.Util.bounds(n[e+1].object),o=t.datavisualization.Diagram.Util.bounds(s),c=h.x-o.x-o.width,Math.abs(c-i)<=1)u[u.length]=n[e+1],o.y<r&&(r=o.y);else break;return r},_findEquallySpacedNodesAtTop:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.y-f.y-f.height,Math.abs(s-i)<=1)u[u.length]=n[e],f.x+f.width>r&&(r=f.x+f.width);else break;return r},_findEquallySpacedNodesAtBottom:function(n,i,r,u,f){var l=n[0].distance,s,h,e,c,o;if(Math.abs(i-l)<=f)for(o=0;o<n.length-1;o++)if(s=n[o].object,h=t.datavisualization.Diagram.Util.bounds(n[o+1].object),e=t.datavisualization.Diagram.Util.bounds(s),c=h.y-e.y-e.height,Math.abs(c-i)<=1)u[u.length]=n[o+1],e.x+e.width>r&&(r=e.x+e.width);else break;return r}};t.datavisualization.Diagram.SpatialUtil={findQuads:function(n,t){n.quads=[];var i=n.parentQuad;return this._findQuads(n,i,t),n.quads},_addIntoAQuad:function(n){for(var t=!1;!t;)t=this._add(n,n.parentQuad)},_setCurrentNode:function(n,i,r){var u,o,f,e,s;if(n.childnode=i,u=t.datavisualization.Diagram.Util.bounds(i),n.childLeft=u.left,n.childTop=u.top,n.childRight=u.right,n.childBottom=u.bottom,r)for(o=i.labels,f=0;f<o.length;f++)e=o[f],e&&e.visible&&!r.activeTool.inAction&&!r._isLayoutExecute&&(s=t.datavisualization.Diagram.Util.getLabelbounds(r,i,e),s&&(u=r._union(s,u),u=t.datavisualization.Diagram.Util.bounds(u),n.childLeft=u.left,n.childTop=u.top,n.childRight=u.right,n.childBottom=u.bottom))},_add:function(n,i){if(this._isContained(n,i))return this._selectQuad(n,i),!0;var r,u=!i.objects.length&&i.first==null&&i.second==null&&i.third==null&&i.fourth==null;return n.childLeft<i.left?n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top-i.height,i.width*2,i.height*2),u||(r.fourth=i)):(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top,i.width*2,i.height*2),u||(r.second=i)):n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left,i.top-i.height,i.width*2,i.height*2),u||(r.third=i)):(r=t.datavisualization.Diagram.Quad(i.left,i.top,i.width*2,i.height*2),u||(r.first=i)),i.parent=r,n.parentQuad=r,!1},_isContained:function(n,t){return n.childLeft>=t.left&&n.childRight<=t.left+t.width&&n.childTop>=t.top&&n.childBottom<=t.top+t.height?!0:!1},_selectQuad:function(n,t){for(var i=t;i!==null;)i=this._getQuad(n,i)},_getQuad:function(n,i){var u=i.width/2,f=i.height/2,o=n._isRouting&&n._viewPortHeight>0?n._viewPortHeight:100,s=n._isRouting&&n._viewPortWidth>0?n._viewPortWidth:100,e,r;if(u>=s&&f>=o)if(e=i.left+u,r=i.top+f,n.childRight<=e){if(n.childBottom<=r)return i.first?i.first:i.first=t.datavisualization.Diagram.Quad(i.left,i.top,u,f,i);if(n.childTop>=r)return i.third?i.third:i.third=t.datavisualization.Diagram.Quad(i.left,r,u,f,i)}else if(n.childLeft>=e){if(n.childBottom<=r)return i.second?i.second:i.second=t.datavisualization.Diagram.Quad(e,i.top,u,f,i);if(n.childTop>=r)return i.fourth?i.fourth:i.fourth=t.datavisualization.Diagram.Quad(e,r,u,f,i)}return i.objects.push(n.childnode),n.quadTable[n.childnode.name]=i,null},_findQuads:function(n,t,i){t.first&&this._isIntersect(t.first,i)&&this._findQuads(n,t.first,i);t.second&&this._isIntersect(t.second,i)&&this._findQuads(n,t.second,i);t.third&&this._isIntersect(t.third,i)&&this._findQuads(n,t.third,i);t.fourth&&this._isIntersect(t.fourth,i)&&this._findQuads(n,t.fourth,i);t.objects.length>0&&n.quads.push(t)},_isIntersect:function(n,t){return n.left+n.width<t.x||n.top+n.height<t.y||n.left>t.x+t.width||n.top>t.y+t.height?!1:!0},_update:function(n){if(n.parent!=null&&n.objects.length==0&&n.first==null&&n.second==null&&n.third==null&&n.fourth==null){var t=n.parent;t.first==n?t.first=null:t.second==n?t.second=null:t.third==n?t.third=null:t.fourth==n&&(t.fourth=null);this._update(n.parent)}else return},_isWithinPageBounds:function(n,t){return t.left>=n.pageLeft&&t.right<=n.pageRight&&t.top>=n.pageTop&&t.bottom<=n.pageBottom?!0:!1},_updateBounds:function(n,i,r,u){var f=!1;i.topElement&&r.name==i.topElement.name&&(f=!0,i.pageTop=null,this._findQuadElement(i,i.parentQuad,"top"));i.leftElement&&r.name==i.leftElement.name&&(f=!0,i.pageLeft=null,this._findQuadElement(i,i.parentQuad,"left"));i.rightElement&&r.name==i.rightElement.name&&(f=!0,i.pageRight=null,this._findQuadElement(i,i.parentQuad,"right"));i.bottomElement&&r.name==i.bottomElement.name&&(f=!0,i.pageBottom=null,this._findQuadElement(i,i.parentQuad,"bottom"));f&&n._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(n,u!==undefined?u:!0)},_findQuadElement:function(n,i,r){var u,f;switch(r){case"bottom":i.third!=null||i.fourth!=null?(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r));break;case"top":i.first!=null||i.second!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"left":i.first!=null||i.third!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.third!=null&&this._findQuadElement(n,i.third,r)):(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"right":i.second!=null||i.fourth!=null?(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.first!=null&&this._findQuadElement(n,i.first,r))}for(f=0;f<i.objects.length;f++)u=t.datavisualization.Diagram.Util.bounds(i.objects[f]),r==="bottom"&&(n.pageBottom<=u.bottom||n.pageBottom==null)?(n.pageBottom=u.bottom,n.bottomElement=i.objects[f]):r==="top"&&(n.pageTop>=u.top||n.pageTop==null)?(n.pageTop=u.top,n.topElement=i.objects[f]):r==="left"&&(n.pageLeft>=u.left||n.pageLeft==null)?(n.pageLeft=u.left,n.leftElement=i.objects[f]):r==="right"&&(n.pageRight<=u.right||n.pageRight==null)&&(n.pageRight=u.right,n.rightElement=i.objects[f])},_initializeNodes:function(n,t){for(var r,f,u=n.nodes(),i=0;i<u.length;i++)r=u[i],f=this.getObjectType(r),f!="group"&&this._updateQuad(n,t,r)},_initializeConnectors:function(n,t){for(var r=n.connectors(),i=0;i<r.length;i++)this._updateQuad(n,t,r[i])},_updateQuad:function(i,r,u){var h,s,f,o,e;this._setCurrentNode(r,u,i);h=t.datavisualization.Diagram.Util.bounds(u);s=r.quadTable[u.name];s?this._isContained(r,s)||(this._removeFromaQuad(r,s,u),this._addIntoAQuad(r)):(r.parentQuad||(r.parentQuad=t.datavisualization.Diagram.Quad(0,0,200,200)),this._addIntoAQuad(r));this._isWithinPageBounds(r,h)&&r.leftElement!=u&&r.topElement!=u&&r.rightElement!=u&&r.bottomElement!=u||(f=!1,o=!1,r.pageLeft>=r.childLeft||r.pageLeft==null?(r.pageLeft=r.childLeft,r.leftElement=u,f=!0):u==r.leftElement&&(r.pageLeft=null,this._findQuadElement(r,r.parentQuad,"left"),o=f=!0),r.pageTop>=r.childTop||r.pageTop==null?(r.pageTop=r.childTop,r.topElement=u,f=!0):u==r.topElement&&(r.pageTop=null,this._findQuadElement(r,r.parentQuad,"top"),o=f=!0),r.pageBottom<=r.childBottom||r.pageBottom==null?(f=!0,r.pageBottom=r.childBottom,r.bottomElement=u):u==r.bottomElement&&(r.pageBottom=null,this._findQuadElement(r,r.parentQuad,"bottom"),o=f=!0),r.pageRight<=r.childRight||r.pageRight==null?(r.pageRight=r.childRight,r.rightElement=u,f=!0):u==r.rightElement&&(r.pageRight=null,this._findQuadElement(r,r.parentQuad,"right"),o=f=!0));e=i.activeTool.diagramBounds;f&&i.model.pageSettings.multiplePage&&(i.model.pageSettings.pageWidth||i.model.pageSettings.pageHeight)&&e&&(f=!1,(o||r.pageLeft<e.x||r.pageTop<e.y||r.pageRight>e.x+e.width||r.pageBottom>e.y+e.height)&&(f=!0,i.activeTool.diagramBounds=i._getDigramBounds()));f&&(i._views.forEach(function(t){var u=i._views[t],r;u.type=="overview"&&(r=n("#"+t).ejOverview("instance"),r&&r._updateOverview(u))}),!i._layoutInAction&&i._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(i,i.activeTool.inAction||i._selectedSymbol))},_removeFromaQuad:function(n,t,i){if(t){var r=t.objects.indexOf(i);t.objects.splice(r,1);this._update(t);delete n.quadTable[i.name]}}};t.datavisualization.Diagram.Quad=function(n,t,i,r,u){return{left:n,top:t,width:i,height:r,parent:u,first:null,second:null,third:null,fourth:null,objects:[]}};t.datavisualization.Diagram.SpatialSearch=function(n){var i=t.datavisualization.Diagram.ScrollUtil._viewPort(n),r=0,u=0,f=200,e=200;return t.datavisualization.Diagram.Util.canRouteDiagram(n)&&(r=-100,u=-100,f=i.height>0?i.height:1e3,e=i.width>0?i.width:1e3),{pageLeft:null,pageRight:null,pageTop:null,pageBottom:null,topElement:null,bottomElement:null,rightElement:null,leftElement:null,childLeft:null,childTop:null,childRight:null,childBottom:null,childNode:null,quads:null,parentQuad:t.datavisualization.Diagram.Quad(r,u,e,f),quadTable:{}}};t.datavisualization.Diagram.ClassifierHelper={getEditableElementUnderMouse:function(n,t){var i=t._findNodeUnderMouse(n),r;return i&&(r=i.name.match("_attribute")?"attribute":i.name.match("_method")?"method":i.name.match("_member")?"member":"header",r&&i.parent&&(i=t.nameTable[i.parent])),i},getMovableElementUnderMouse:function(n,t){var i=t._findNodeUnderMouse(n),r=n.target.className;return!i||!i.parent||i.type=="umlclassifier"||(i=t.nameTable[i.parent]),i},getSelectableElementUnderMouse:function(n,t){var i=t._findNodeUnderMouse(n);return!i||!i.parent||i.type=="umlclassifier"||(i=t.nameTable[i.parent]),i},getDropableElementUnderMouse:function(n,i){var r=i._findNodeUnderMouse(n);return i._nodeUnderMouse||(i._nodeUnderMouse=r),r&&t.datavisualization.Diagram.Util.canAllowDrop(r)?r:!0},renderResizeBorder:function(n,t,i,r){var u=t.width?t.width:t._width,f=t.height?t.height:t._height;return i.rect({id:n,width:u*r+t.borderWidth+4,height:f*r+t.borderWidth+4,x:-(t.borderWidth/2+2),y:-(t.borderWidth/2+2),stroke:"#f93732","stroke-width":2,"stroke-dasharray":"0",fill:"none","pointer-events":"none"})},getEditboxValue:function(i,r,u){for(var v,s,y,o,p,c,w,a,f,e=0;e<r.children.length;e++)typeof r.children[e]=="string"&&(r.children[e]=u.nameTable[u._getChild(r.children[e])]),v=r.children[e].name.match("_attribute")?"attribute":r.children[e].name.match("_method")?"method":r.children[e].name.match("_member")?"member":"header";for(s=i.split("\n"),f=0;f<s.length;f++)s[f]=s[f].trim().replace(/\s+/g," "),!s[f].indexOf("---")>-1&&s[f].charAt(0)=="+"||s[f].charAt(0)=="-"||s[f].charAt(0)=="#"||s[f].charAt(0)=="~"?s[f]=s[f]:f!=s[f].length-s[f].length&&!s[f].indexOf("---")>-1&&s[f].length>0&&v!="member"&&!r.enumeration&&(s[f]="+ "+s[f]),s[f].indexOf("---")>-1&&s[f].match(/\w|\d|\D|\s/g)&&(y=s[f].match(/---/g),s[f]=y[0]);for(i=s.join("\n"),o=i.split("\n---\n"),f=0;f<o.length;f++)o[f]=o[f].replace(/^\n+/g,"");for(o[0].indexOf("+")>-1&&(o[0]=o[0].replace(/[+]/g,"")),o[0].length>0&&(r.children[0].labels[0].text=o[0]),r.children[1]&&!o[2]?r.children[1].labels[0].text=o[1]:r.children[1]&&o[2]&&(r.children[1].name.indexOf("method")>-1?r.children[1].labels[0].text.indexOf(o[1])>-1?(r.children[1].labels[0].text=o[1],o.pop()):r.children[1].labels[0].text=o[2]:(p=r.children[1].name.indexOf("attribute")>-1?o[1]:r.children[1].name.indexOf("member")>-1?o[1]:o[2],r.children[1].labels[0].text=p)),r.children[2]&&(r.children[2].labels[0].text=o[2]),e=0;e<r.children.length;e++)c=r.children[e].labels[0].text,c&&c.indexOf("--")>-1&&(c=c.replace(/---\n*/g,""),r.children[e].labels[0].text=c),c&&c.endsWith("\n")&&(w=c.replace(/\n+$/g,""),r.children[e].labels[0].text=w),a=r.children[e].labels[0].text?r.children[e].labels[0].text.length:null,!a&&a<=0&&(u._remove(r.children[e]),e--),u.nameTable[r.children[e].name]=r.children[e];if(o[2]&&!r.children[2]||o[1]&&!r.children[1]){var h=[],l=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast),b={width:r.width,offsetX:r.offsetX,parent:r.name,ports:[],fillColor:"transparent",borderColor:r.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0};for(e=0;e<r.children.length;e++)e!=0&&r.children[e].name.indexOf("_attribute")>-1&&o[2].length>0?h.push({name:r.name+"_method_classifier",labels:[{text:o[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l}):e!=0&&r.children[e].name.indexOf("_method")>-1&&o[1].length>0&&h.push({name:r.name+"_attribute_classifier",labels:[{text:o[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l});for(r.children.length<2&&(o[1]&&h.push({name:r.name+"_attribute_classifier",labels:[{text:o[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l}),o[2]&&h.push({name:r.name+"_method_classifier",labels:[{text:o[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l})),f=0;f<h.length;f++)h[f].labels[0]=n.extend(!0,{},r.labels[0],h[f].labels[0]),h[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},b,h[f])),u._getNodeDimension(h[f],h[f].labels[0]),h[f].offsetY+=r.offsetY-r.height/2,u.add(h[f]),u.nameTable[h[f].name]=h[f];r.children[2]&&r.children[2].match("_attribute")&&(r.children.splice(1,0,r.children[2]),r.children.pop());typeof r.children[1]=="string"&&(r.children[1]=u.nameTable[r.children[1]]);typeof r.children[2]=="string"&&(r.children[2]=u.nameTable[r.children[2]])}for(e=0;e<r.children.length;e++)r.children.length==1&&(r["class"]&&(delete r["class"].attributes,delete r["class"].methods),r["interface"]&&(delete r["interface"].attributes,delete r["interface"].methods),r.enumeration&&delete r.enumeration.members),r.children.length==2&&(r["class"]&&(r.children[e].name.match("attribute")&&delete r["class"].methods,r.children[e].name.match("method")&&delete r["class"].attributes),r["interface"]&&(r.children[e].name.match("attribute")&&delete r["interface"].methods,r.children[e].name.match("method")&&delete r["interface"].attributes)),this._updateClassNode(r.children[e],r);return i},getUMLConnectorValue:function(t,i,r){var o,f,e,u;return(r.name===t.name+"_sourcelabel"||r.name===t.name+"_targetlabel")&&((t.shape.multiplicity.type=="onetoone"||t.shape.multiplicity.type=="manytoone"||t.shape.multiplicity.type=="onetomany")&&(i.length==1&&(i.indexOf("1")>-1||i.indexOf("*")>-1)&&(o=!0),f=!1,r.name===t.name+"_sourcelabel"&&(t.shape.multiplicity.type=="onetoone"||t.shape.multiplicity.type=="onetomany")?(i="1",t.shape.multiplicity=n.extend(!0,{},t.shape.multiplicity,{source:{optional:f,lowerBounds:null,upperBounds:null}})):r.name===t.name+"_targetlabel"&&(t.shape.multiplicity.type=="manytoone"||t.shape.multiplicity.type=="onetoone")&&(i="1",t.shape.multiplicity=n.extend(!0,{},t.shape.multiplicity,{target:{optional:f,lowerBounds:null,upperBounds:null}}))),i=this.umlConnectorEditBox(i),i.match(/\d\.{3}\d/g)?u=i.split("..."):o||(e=this.umlConnectorMultiplicity(t),r.name==t.name+"_sourcelabel"?(u=e[0].text.split("..."),i=e[0].text):(u=e[1].text.split("..."),i=e[1].text)),u&&(t.shape.multiplicity=r.name==t.name+"_sourcelabel"?n.extend(!0,{},t.shape.multiplicity,{source:{optional:f,lowerBounds:u[0],upperBounds:u[1]}}):n.extend(!0,{},t.shape.multiplicity,{target:{optional:f,lowerBounds:u[0],upperBounds:u[1]}}))),r.text=i,t},umlConnectorMultiplicity:function(n){var o=[],t,i,r,u,f,e;return n.shape.multiplicity.source&&(n.shape.multiplicity.source.lowerBounds=this.umlConnectorEditBox(n.shape.multiplicity.source.lowerBounds),n.shape.multiplicity.source.upperBounds=this.umlConnectorEditBox(n.shape.multiplicity.source.upperBounds)),n.shape.multiplicity.target&&(n.shape.multiplicity.target.lowerBounds=this.umlConnectorEditBox(n.shape.multiplicity.target.lowerBounds),n.shape.multiplicity.target.upperBounds=this.umlConnectorEditBox(n.shape.multiplicity.target.upperBounds)),f=n.shape.multiplicity.source,e=n.shape.multiplicity.target,t=f.upperBounds?f.lowerBounds+"..."+f.upperBounds:f.lowerBounds,i=e.upperBounds?e.lowerBounds+"..."+e.upperBounds:e.lowerBounds,n.shape.multiplicity.type=="manytoone"&&(n.shape.multiplicity.target.optional=!1,r=t?t:"*",u="1"),n.shape.multiplicity.type=="onetomany"&&(n.shape.multiplicity.source.optional=!1,u=i?i:"*",r="1"),n.shape.multiplicity.type=="manytomany"&&(r=t?t:"*",u=i?i:"*"),n.shape.multiplicity.type=="onetoone"&&(n.shape.multiplicity.target.optional=!1,n.shape.multiplicity.source.optional=!1,r="1",u="1"),o.push({name:n.name+"_sourcelabel",text:r,segmentOffset:0,alignment:"before",margin:{left:5,top:5}},{name:n.name+"_targetlabel",text:u,segmentOffset:1,alignment:"before",margin:{right:5,bottom:5}}),o},umlConnectorEditBox:function(n){return typeof n=="string"&&n.match(/[a-zA-Z]/g)&&(n=n.replace(/[a-zA-Z]/g,"")),n},EnableorDisableConnection:function(n,t,i){return i.shape&&i.shape.type=="umlclassifier"&&i.shape.relationship!="association"&&(i.shape.relationship!="dependency"&&i.shape.relationship!="inheritance"&&i.shape.relationship!="realization"&&t&&n&&n["interface"]&&t["class"]&&(n=null),i.shape.relationship=="dependency"&&t&&n&&n["class"]&&t["interface"]&&(n=null)),n},getClassifierNodeDimension:function(n,t){for(var f,r,u,i=0;i<n.children.length;i++)t._getNodeDimension(n.children[i]);for(n._height=0,i=0;i<n.children.length;i++)f=n.children[i].height?n.children[i].height:n.children[i]._height,n.children[i].offsetY=n._height+f/2,n._height+=f,n.height=n._height;for(r=n.children[0]._width,n.children[1]&&(r=n.children[0]._width>n.children[1]._width?n.children[0]._width:n.children[1]._width),n.children[2]&&(r=n.children[2]._width>r?n.children[2]._width:r),n.children[0].width=r,n.children[1]&&(n.children[1].width=r),n.children[2]&&(n.children[2].width=r),n.width=r,u=0;u<n.children.length;u++)n.children[u].offsetY+=n.offsetY-n.height/2;return t._updateAssociatedConnectorEnds(n,t.nameTable),n},_updateClassNode:function(n,i){var s,a;if(n.name.match("_header"))i["class"]?i["class"].name=n.labels[0].text:i["interface"]?i["interface"].name=n.labels[0].text:i.enumeration.name=n.labels[0].text;else{for(var v=n.name.match("_attribute")?"attribute":n.name.match("_method")?"method":"member",y=n.labels[0],h,u,l=[],c,f=y.text.split("\n"),e=[],o,r=0;r<f.length;r++){f[r].indexOf("+")>-1?h="public":f[r].indexOf("-")>-1?h="private":f[r].indexOf("#")>-1?h="protected":f[r].indexOf("~")>-1&&(h="package");(f[r].indexOf("+")>-1||f[r].indexOf("-")>-1||f[r].indexOf("#")>-1||f[r].indexOf("~")>-1)&&(f[r]=f[r].replace(/[+|~|#|-]\s/g,""));switch(v){case"attribute":o=f[r].split(/:[ ]*/g);e.push(t.datavisualization.Diagram.ClassAttribute({name:o[0],type:o[1],scope:h}));break;case"method":for(u=f[r].split(/["("|")"]/g),s=0;s<u.length;s++)u[s].indexOf(",")>-1&&(o=u[s].split(",")),s==u.length-1&&(u[s]=u[s].replace(/[:\s]|:/g,""));if(o)for(a=0;a<o.length;a++)c=o[a].split(":"),l.push(t.datavisualization.Diagram.ClassmethodArguments({name:c[0],type:c[1]}));u.length!=3||o||(u[1].indexOf(":")>-1?(c=u[1].split(":"),l.push(t.datavisualization.Diagram.ClassmethodArguments({name:c[0],type:c[1]}))):l.push(t.datavisualization.Diagram.ClassmethodArguments({name:u[1]})));e.push(t.datavisualization.Diagram.ClassMethod({name:u[0],arguments:l,type:u[u.length-1],scope:h}));break;case"member":e.push(t.datavisualization.Diagram.ClassMember({name:f[r]}))}}v=="attribute"?i["class"]?i["class"].attributes=e:i["interface"]&&(i["interface"].attributes=e):v=="method"?i["class"]?i["class"].methods=e:i["interface"]&&(i["interface"].methods=e):i.enumeration.members=e}}};t.datavisualization.Diagram.SwimLaneContainerHelper={_initSwimLane:function(n,i){var i=t.datavisualization.Diagram.SwimLane(i);return i=this._initLaneCollection(n,i),this._swapPhaseSize(i),i=this._setPhaseMinValues(n,i),this._initPhaseCollection(n,i)},_initLaneCollection:function(n,i){var r,u,f,e;for(i.lanes.length===0&&(i.lanes=[t.datavisualization.Diagram.Lane({orientation:i.orientation})]),r=0;r<i.lanes.length;r++){if(i.lanes[r]=t.datavisualization.Diagram.Lane(i.lanes[r]),i.lanes[r].container={type:"canvas",orientation:i.orientation},i.lanes[r].borderColor=i.lanes[r].borderColor?i.lanes[r].borderColor:"black",i.lanes[r].orientation=i.orientation?i.orientation:"horizontal",i.lanes[r].horizontalAlign=i.orientation==="horizontal"?"stretch":"left",i.lanes[r].verticalAlign=i.orientation==="vertical"?"stretch":"top",i.lanes[r].addInfo=i.lanes[r].addInfo?i.lanes[r].addInfo:{},i.lanes[r].fillColor=i.lanes[r].fillColor,i.lanes[r].paddingTop=20,i.lanes[r].paddingRight=20,i.lanes[r].paddingBottom=20,i.lanes[r].paddingLeft=20,i.lanes[r].constraints=i.lanes[r].constraints?i.lanes[r].constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,i.lanes[r].cssClass=i.lanes[r].cssClass,i.lanes[r]._laneHeader=i.lanes[r]._laneHeader?i.lanes[r]._laneHeader:null,i.lanes[r].labels&&i.lanes[r].labels.length>0)for(u=0;u<i.lanes[r].labels.length;u++)i.lanes[r].labels[u]=t.datavisualization.Diagram.Label(i.lanes[r].labels[u]);f=i.lanes[r]._laneHeader=i.lanes[r]._laneHeader?i.lanes[r]._laneHeader:i.lanes[r].header;e=this._initLaneHeader(n,i.lanes[r],f,i);i.lanes[r].children.splice(0,0,e)}return i},_initLaneHeader:function(n,i,r,u){var f=i.header,s=u.orientation,e,o,u;return s==="horizontal"?(e="left",o="stretch",f.rotateAngle=270):(e="stretch",o="top",f.rotateAngle=0),u=t.datavisualization.Diagram.Node({_hidePorts:!0,_isHeader:!0,name:n._isUndo&&r.name?r.name:i.name+"_Headerr_",type:"node",labels:[f],height:r.height?r.height:50,width:r.width?r.width:50,fillColor:f.fillColor?f.fillColor:"white",rotateAngle:0,horizontalAlign:e,verticalAlign:o,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20}),u.labels[0].name=f&&f._labelName&&n._isUndo?f._labelName:u.name+"_label",u},_initPhaseCollection:function(n,i){var u=0,f=0,r;for(i.phases.length===0&&(i.phases=[t.datavisualization.Diagram.Phase({orientation:i.orientation})]),r=0;r<i.phases.length;r++)i.phases[r]._UndoRedo=n._UndoRedo,i.phases[r]._isUndo=n._isUndo,i.phases[r]=t.datavisualization.Diagram.Phase(i.phases[r]),i.phases[r].isPhase=!0,i.phases[r]._hidePorts=!0,i.phases[r].constraints=t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,i.phases[r].parent="",i.phases[r]._isHeader=!0,i.phases[r]._type="node",i.phases[r].orientation=i.orientation,n._isLoad?i.phases[r].labels&&i.phases[r].labels.length>0&&(i.phases[r].label=[i.phases[r].labels[0]]):i.phases[r].label&&i.phaseSize!=0&&(i.phases[r].label.rotateAngle=i.orientation==="vertical"?270:0,i.phases[r].labels=[i.phases[r].label]),i.orientation==="horizontal"?(i.phases[r].width=i.phases[r].offset-f,i.phases[r].height=i.phaseSize,f=i.phases[r].offset):(i.phases[r].height=i.phases[r].offset-u,i.phases[r].width=i.phaseSize,u=i.phases[r].offset);return i},_setPhaseMinValues:function(n,t){var u,i,r;if(i=t.phases[0],i)for(i.offset<70&&(i.offset=70),r=1;r<t.phases.length;r++)u=t.phases[r],i=t.phases[r-1],i.offset+20>=u.offset&&(u.offset=i.offset+20);return t},_swapPhaseSize:function(n){if(n.phases.length>0)for(var i=n.phases,t,u,r=0;r<i.length;r++)for(t=0;t<i.length-r-1;t++)i[t].offset>i[t+1].offset&&(u=i[t],i[t]=i[t+1],i[t+1]=u)},_setLastPhaseSize:function(n){if(n.phases.length>0){var t=n.phases[n.phases.length-1];t.offset=n.orientation==="horizontal"?n.width:n.height}},_createSwimlane:function(n,i){var e=this._createSwimlaneHeader(n,i),l=i.orientation==="horizontal"?"vertical":"horizontal",s=i.orientation,h,c,f,o;s==="horizontal"?(h=Math.round(e.height+i.phaseSize),c=0):(h=e.height,c=Math.round(i.phaseSize));var u={name:i.name+"phaseStack",isPhaseStack:!0,container:{type:"stack",orientation:s},minHeight:10,minWidth:10,children:i.phases,marginTop:e.height,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect&~t.datavisualization.Diagram.NodeConstraints.AllowDrop},a={name:i.name+"laneStack",isLaneStack:!0,container:{type:"stack",orientation:l},children:i.lanes,marginTop:h,marginLeft:c,verticalAlign:"stretch",horizontalAlign:"stretch",constraints:(t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop)&~t.datavisualization.Diagram.NodeConstraints.Connect},r={_hidePorts:!0,name:i.name,container:{type:"canvas"},children:[e,a],addInfo:i.addInfo?i.addInfo:null,paletteItem:i.paletteItem?i.paletteItem:null,constraints:i.constraints,cssClass:i.cssClass,offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,orientation:i.orientation,phaseSize:i.phaseSize,isSwimlane:!0,height:i.height?i.height:100,width:i.width?i.width:100};return r.offsetX=i.offsetX?i.offsetX:100,r.offsetY=i.offsetY?i.offsetY:100,f=t.datavisualization.Diagram.containerCommon._cloneObject(n,r,t.datavisualization.Diagram.Util.randomId()),f=t.datavisualization.Diagram.ContainerHelper._initContainer(n,f),o=t.datavisualization.Diagram.Util.bounds(f),o=this._setSwimlaneSize(n,r,o),t.datavisualization.Diagram.containerCommon._removeObject(n,f),s==="horizontal"?(u.maxHeight=i.phaseSize,u.minWidth=10):(u.minHeight=10,u.maxWidth=i.phaseSize),r.children.splice(1,0,u),this._setPhaseValues(n,r,o),t.datavisualization.Diagram.ContainerHelper._initContainer(n,r)},_setSwimlaneSize:function(n,t,i){var f,r,u;if(t.orientation==="horizontal"){if(t.width>i.width){for(r=t.children[1].children,u=0;u<r.length;u++)r[u].minWidth=t.width;i.width=t.width}t.height>i.height&&(r=t.children[1].children,f=r[r.length-1],f.minHeight+=t.height-i.height,i.height=t.height)}else if(t.width>i.width&&(r=t.children[1].children,f=r[r.length-1],f.minWidth+=t.width-i.width,i.height=t.height),t.height>i.height){for(r=t.children[1].children,u=0;u<r.length;u++)r[u].minHeight=t.height-2*t.children[0].height;i.height=t.height}return i},_setPhaseValues:function(n,t,i){var f=t.children[1].children,u=f[f.length-1],c=t.orientation,s,h,o,e,r;if(c==="horizontal")if(u.offset<=i.width)for(f.length==1?(u.offset=i.width,u.width=i.width):(h=f[f.indexOf(u)-1],u.offset=i.width,u.width=i.width-h.offset),e=t.children[2].children,r=0;r<e.length;r++)e[r].minWidth=u.offset;else{for(o=0,r=0;r<f.length;r++)f[r].offset>=o&&(o=f[r].offset);for(e=t.children[2].children,r=0;r<e.length;r++)e[r].minWidth=o}else if(s=t.children[0],u.offset<=i.height-s.height)for(f.length==1?(u.offset=i.height-s.height,u.height=u.offset):(h=f[f.indexOf(u)-1],u.offset=i.height-s.height,u.height=i.height-h.offset-s.height),e=t.children[2].children,r=0;r<e.length;r++)e[r].minHeight=u.offset;else{for(o=0,r=0;r<f.length;r++)f[r].offset>=o&&(o=f[r].offset);for(e=t.children[2].children,r=0;r<e.length;r++)e[r].minHeight=o}},_createSwimlaneHeader:function(n,i){var r=i.header,f=i.lanes[0]._laneHeader?i.lanes[0]._laneHeader:null,u;return r.name=i.name+"_header_swimlane_label",u=t.datavisualization.Diagram.Node({_type:"node",_hidePorts:!0,_isHeader:!0,name:i.name+"_header_swimlane",labels:[r],height:r.height!=undefined?r.height:50,width:r.width!=undefined?r.width:50,fillColor:i.header.fillColor?i.header.fillColor:f?f.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name}),u.labels[0].fillColor="transparent",n._isLoad&&(u.fillColor=i.header.fillColor),u},_updateSwimlane:function(n,i){this._updateLaneStack(n,i);this._updatePhaseStack(n,i);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,i)},_updateLaneStack:function(n,t){for(var r,f,e=this.getLanes(n,t),i,u=0;u<e.length;u++)if(i=n.nameTable[n._getChild(e[u])],i){for(r=1;r<i.children.length;r++)f=typeof i.children[r]=="string"?n.nameTable[i.children[r]]:i.children[r],f.marginBottom=f.marginRight=0;this._updateLane(n,i)}},_updatePhaseStack:function(n,i){var r=n.nameTable[n._getChild(i.children[1])];t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r)},_updateLane:function(n,i){t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,i)},getPhases:function(n,t,i){var u,r;if(t&&(t.children[1]&&(u=i?i[n._getChild(t.children[1])]:n.nameTable[n._getChild(t.children[1])]),u&&(r=n._getChildren(u.children),r&&r.length>0)))return r},getLanes:function(n,t){var r,i;return t&&t.isSwimlane&&t.children[2]&&(r=n.nameTable[n._getChild(t.children[2])]),r&&(i=r.children,i&&i.length>0)?i:void 0},_updateLanesMinValue:function(n,t,i,r){for(var e=this.getLanes(n,t),u,f=0;f<e.length;f++)u=n.nameTable[n._getChild(e[f])],u&&(u[i]=r)},_resizeLastPhase:function(){},_getPhaseBounds:function(n,i){var r=null,e,l,o,u=0,h=0,s=0,c=0,f,a,v,y;return i&&i.type=="phase"&&i.parent&&(f=this._getPrevPhase(n,i),a=this._getNextPhase(n,i),e=n.nameTable[i.parent.split("phaseStack")[0]],e&&e.orientation&&(r=t.datavisualization.Diagram.Util.bounds(e),e.orientation=="horizontal"?(o=this._getPrevOffset(n,i,f,a,e,r),f&&f.name===i.name?(u=o.left+r.left,h=u+(i.offset-u-o.left)):(f&&(u=r.left+f.offset),h=i.offset-u+r.left),s=o.top+r.top,c=r.bottom-s,l=t.datavisualization.Diagram.Rectangle(u,s,h,c)):(o=this._getPrevOffset(n,i,f,a,e,r),f===i?(u=o.left+r.left,c=i.offset+s,s=o.top+r.top):(v=n.nameTable[n._getChild(e.children[0])],y=v?v.height:0,u=o.left+r.left,f&&(s=f.offset+r.top+y),c=r.top+i.offset-s+y),h=r.right-u,l=t.datavisualization.Diagram.Rectangle(u,s,h,c)))),l},_getPrevPhase:function(n,i){var f=null,u,e=n.nameTable[i.parent.split("phaseStack")[0]],r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,e);return e&&r&&r.length>0&&(u=this._getPhaseIndex(n,i.name),f=u===0?n.nameTable[n._getChild(r[0])]:n.nameTable[n._getChild(r[u-1])]),f},_getPrevOffset:function(n,t,i,r,u){var f,e,h=0,c=0,s,o;return u.children[0]&&(s=n.nameTable[n._getChild(u.children[0])],s&&(c=s.height)),u.orientation=="horizontal"&&(u.children[2]&&(f=n.nameTable[n._getChild(u.children[2])]),f&&f.children&&f.children.length>0&&(e=n.nameTable[n._getChild(f.children[0])],e&&e.children&&e.children.length>0&&(o=n.nameTable[n._getChild(e.children[0])],o&&o.name.indexOf("_Headerr")!=-1&&(h=o.width)))),{left:h,top:c}},_getNextPhase:function(n,i){var f=null,u,e=n.nameTable[i.parent.split("phaseStack")[0]],r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,e);return e&&r&&r.length>0&&(u=n._getPhaseIndex(i.name),f=u===r.length-1?n.nameTable[n._getChild(r[u])]:n.nameTable[n._getChild(r[u+1])]),f},_getPhaseIndex:function(n,i){var r,f,e=-1,u;return r=n.nameTable[i],r&&r.parent&&(f=n.nameTable[r.parent.split("phaseStack")[0]],u=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,f),u&&u.length>0&&(e=u.indexOf(i))),e},_cloneLaneObj:function(t,i,r,u){var s=u?u:t.nameTable,e,o,f;if(i=n.extend(!0,{},i),e=i.children,e&&e.length>0)for(o=0;o<e.length;o++)f=s[t._getChild(e[o])],f&&(f=jQuery.extend(!0,{},f),f&&f.children&&f.children.length&&(f=t._cloneLaneObj(f,r,u)),f.name+=r,f.parent=r,i.children[o]=f,u&&t._preserveConnection(u,f));return i&&i.header&&(i.header.name+=r),i.name+=r,i},_cloneSwimlaneObj:function(t,i,r,u){var f;if(i=n.extend(!0,{},i),i&&i.isSwimlane){if(i=jQuery.extend(!0,{},i),i.name+=r,i.lanes&&i.lanes.length>0)for(f=0;f<i.lanes.length;f++)i.lanes[f]&&(i.lanes[f]=t._cloneLaneObj(i.lanes[f],r,u&&u.childTable?u.childTable:null));if(i.phases&&i.phases.length>0)for(f=0;f<i.phases.length;f++)i.phases[f]&&(i.phases[f].name+=r,i.phases[f].parent="")}return i},_pasteSwimlaneObj:function(n,i,r){if(i=n._pasteSwimlane(i,r),i){var u=n._isUndo?0:n._pasteIndex*10;n._translate(i,u,u,n.nameTable);t.datavisualization.Diagram.DiagramContext.update(i,n)}return i},_pasteSwimlane:function(n,i,r){if(n._pasteObj=!0,i&&i.isSwimlane){var f=n._isUndo?0:n._pasteIndex*10,u=n._cloneSwimlaneObj(n._getNode(i.name,r?r.childTable:null),n._swimlanePaste?"":t.datavisualization.Diagram.Util.randomId(),r);if(u=t.datavisualization.Diagram.ContainerHelper._initContainer(n,u,r),n._outOfBoundsOnNudge(u,f,f))n.add(u);else return t.datavisualization.Diagram.containerCommon._removeObject(n,u),null;return n._pasteObj=!1,u}},_updateNextPhase:function(n,i,r,u){for(var o=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),f,e=u+1;e<o.length;e++)f=n.nameTable[n._getChild(o[e])],f&&(f.offset+=r)},_getOuterNodes:function(n,i,r,u){for(var f,e,o,l,h=[],c=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,i),a=i.orientation==="horizontal"?"left":"top",v=i.orientation==="horizontal"?r:u,s=0;s<c.length;s++)if(f=n.nameTable[n._getChild(c[s])],f&&f.children.length>1)for(e=0;e<f.children.length;e++)o=n.nameTable[n._getChild(f.children[e])],o&&(l=t.datavisualization.Diagram.Util.bounds(o),l[a]>v&&h.push(o));return h},_getInnerNodes:function(n,i,r,u){for(var f,e,o,h,c=[],l=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,i),a=i.orientation==="horizontal"?"left":"top",v=i.orientation==="horizontal"?"right":"bottom",s=0;s<l.length;s++)if(f=n.nameTable[n._getChild(l[s])],f&&f.children.length>1)for(e=0;e<f.children.length;e++)o=n.nameTable[n._getChild(f.children[e])],o&&(h=t.datavisualization.Diagram.Util.bounds(o),h[a]>=r&&h[v]<=u&&c.push(o));return c},_moveOuterNodes:function(n,i,r,u){var v=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),s=n.nameTable[n._getChild(v[u])],h=t.datavisualization.Diagram.Util.bounds(i),y=n.nameTable[n._getChild(i.children[0])],c=h.left+s.offset,l=h.top+s.offset+y.height,a=i.orientation==="horizontal"?"offsetX":"offsetY",w=i.orientation==="horizontal"?c:l,p=i.orientation==="horizontal"?"marginLeft":"marginTop",f=n._getOuterNodes(i,c,l),e,o;if(f&&f.length>0)for(e=0;e<f.length;e++)o=n.nameTable[n._getChild(f[e])],n._translate(o,a==="offsetX"?r:0,a==="offsetY"?r:0,n.nameTable),o[p]+=r},_moveOnPhaseChange:function(n,i,r){var u,s=i.parent.split("phaseStack")[0],f,o,h,e;if(s&&(f=n.nameTable[s]),f){for(o=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,f),h=n.nameTable[n._getChild(f.children[0])],e=0;e<o.length;e++)u=n.nameTable[n._getChild(o[e])],u&&(i.orientation==="horizontal"?(u.width+=r,u.minWidth=u.width):(u.height+=r,u.minHeight=u.height));i.orientation==="horizontal"?f.minWidth+=r:f.minHeight=u.height;t.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(n,f)}},_getPhaseDifferece:function(n,i,r,u){var p=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),f=n.nameTable[n._getChild(p[r])],e=t.datavisualization.Diagram.Util.bounds(i),y=i.orientation==="horizontal"?"left":"top",v=n.nameTable[n._getChild(i.children[0])],c=0,a,s,l,o,h;return i.orientation==="vertical"&&(c=v.height),r===0?(s=n._getInnerNodes(i,e[y]+c,e[y]+f.offset+c),s&&s.length>0?(l=t.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),t.datavisualization.Diagram.Util._updateGroupBounds(l,n),o=t.datavisualization.Diagram.Util.bounds(l)):(o=t.datavisualization.Diagram.Util.bounds(),o.right=e.left+50),i.orientation==="horizontal"?(e.left+(f.offset+u)>=o.right+20||(h=o.right+20-(e.left+(f.offset+u)),u=u+h),f.offset+u<100&&(u=0)):(e.top+v.height+(f.offset+u)>=o.bottom+20||(h=o.bottom+20-(e.top+c+(f.offset+u)),u=u+h),f.offset+u<100&&(u=0))):(a=n.nameTable[n._getChild(p[r-1])],s=n._getInnerNodes(i,e[y]+a.offset+c,e[y]+f.offset+c),s&&s.length>0?(l=t.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),t.datavisualization.Diagram.Util._updateGroupBounds(l,n),o=t.datavisualization.Diagram.Util.bounds(l)):(o=t.datavisualization.Diagram.Util.bounds(),o.bottom=e.top+v.height+a.offset),i.orientation==="horizontal"?e.left+(f.offset+u)>=o.right+20||(h=o.right+20-(e.left+(f.offset+u)),u=u+h):e.top+v.height+(f.offset+u)>=o.bottom+20||(h=o.bottom+20-(e.top+v.height+(f.offset+u)),u=u+h)),a&&f.offset-a.offset+u<20&&(u-=f.offset-a.offset+u-20),u}};t.datavisualization.Diagram.ContainerHelper={_initContainer:function(n,i){if(i.container)switch(i.container.type){default:case"canvas":if(i=t.datavisualization.Diagram.canvasHelper._initCanvas(n,i),i.type=="bpmn"){var r=t.datavisualization.Diagram.ContainerHelper.updateparent(i,n);r||t.datavisualization.Diagram.bpmnHelper.updateCanvas(i,n)}break;case"stack":i=t.datavisualization.Diagram.stackHelper._initStack(n,i)}else(i.type==="swimlane"||i.isSwimlane)&&(i=t.datavisualization.Diagram.SwimLaneContainerHelper._initSwimLane(n,i),i=t.datavisualization.Diagram.SwimLaneContainerHelper._createSwimlane(n,i));return i},_add:function(i,r){var u,f,s,e,h,o;if(i.getObjectType(r)!=="connector"&&(u=r.parent?i.nameTable[r.parent]:null,u&&u.container)){for(f=u.children.length-1;f>=0;f--)s=i.nameTable[i._getChild(u.children[f])],s.name===r.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(u.children,u.children[f]);e=i._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop;i._isLaneApi&&(e=t.datavisualization.Diagram.GroupChangeCause.Unknown);i._raiseGroupChangeEvent(r,null,u,e);u.children.push(r);i._disableSwimlaneUptate=!0;t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(i);h=n.extend(!0,{},u);this._updateCollectionChange(i,u,!0);t.datavisualization.Diagram.canvasHelper._updateAddRemoveNodeConnectors(i,u,h);delete i._disableSwimlaneUptate;t.datavisualization.Diagram.canvasHelper._updateLastSwimlanePhase(i,r);o=i._svg.document.getElementById(r.parent);r._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(r,i,o):t.datavisualization.Diagram.DiagramContext.renderNode(r,i,o);t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(i,r)}},updateparent:function(n,t){var i=n;if(t)while(i&&i.parent)if(i=t.nameTable[i.parent],i&&i.isLane)return i;return!1},_updateCollectionChange:function(n,i,r,u){var f,e,o,s,u,h;n._diagramClear||(o=!0,i&&(s=t.datavisualization.Diagram.Util.bounds(i),f={x:s.x,y:s.y},i.container&&(i.container.type==="canvas"?i._isBpmn?(u=this.updateparent(i,n),u?t.datavisualization.Diagram.canvasHelper._updateCollectionChange(n,i):t.datavisualization.Diagram.bpmnHelper.updateCanvas(i,n)):t.datavisualization.Diagram.canvasHelper._updateCollectionChange(n,i):t.datavisualization.Diagram.stackHelper._updateCollectionChange(n,i,null,u)),(r&&!i.isLane&&!i._isBpmn||i.isSwimlane)&&(n._disableSwimlaneUptate&&(o=!1),h=t.datavisualization.Diagram.Util.bounds(i),e={x:h.x,y:h.y},n._translate(i,f.x-e.x,f.y-e.y,n.nameTable),o&&t.datavisualization.Diagram.DiagramContext.update(i,n))),!i||!i.container||i.isLane||i.isSwimlane||i.isLaneStack||i.isPhaseStack||t.datavisualization.Diagram.DiagramContext.update(i,n))}};t.datavisualization.Diagram.stackHelper={_initStack:function(n,i){return i=t.datavisualization.Diagram.Group(i),i=this._initGroupNode(n,i),i=this._initChildren(n,i),this._setSize(n,i),this._alignChildren(n,i),i},_initGroupNode:function(n,i){return t.datavisualization.Diagram.containerCommon._initGroupNode(n,i)},_initChildren:function(n,i){return t.datavisualization.Diagram.containerCommon._initChildren(n,i)},_setSize:function(n,t){var i=this._getStackBoundsBounds(n,t);i.width>=t.minWidth&&i.width<=t.maxWidth?t.width=i.width:i.width<=t.minWidth?t.width=t.minWidth:i.width>=t.maxWidth&&(t.width=t.maxWidth);i.height>=t.minHeight&&i.height<=t.maxHeight?t.height=i.height:i.height<=t.minHeight?t.height=t.minHeight:i.height>=t.maxHeight&&(t.height=t.maxHeight)},_getStackBoundsBounds:function(n,i){var f=t.datavisualization.Diagram.Rectangle(),e,u,r,c=0,l=0,s=0,h=0,a=i.container.orientation?i.container.orientation:"vertical",o;if(i.children&&i.children.length>0)for(o=i.children,e=0;e<o.length;e++)u=typeof o[e]=="string"?n.nameTable[o[e]]:o[e],u&&(r=t.datavisualization.Diagram.Util.bounds(u),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),r&&(a==="vertical"?(l=r.width+=u.marginLeft+u.marginRight,l>s&&(s=r.width=l),r.width=u.horizontalAlign==="stretch"?r.width>u.minWidth?r.width:s:s,r.height+=u.marginTop+u.marginBottom,r.height+=f.height):(c=r.height+=u.marginTop+u.marginBottom,c>h&&(h=r.height=c),r.height=u.verticalAlign==="stretch"?r.height>u.minHeight?r.height:h:h,r.width+=u.marginLeft+u.marginRight,r.width+=f.width),r.x=0,r.y=0),f=n._union(f,r));return f.width+=i.paddingLeft+i.paddingRight,f.height+=i.paddingTop+i.paddingBottom,f},_alignChildren:function(n,t){for(var f,i,e=0,o=0,u=t.children,r=0;r<u.length;r++)i=typeof u[r]=="string"?n.nameTable[u[r]]:u[r],i&&(f=this._getStackPosition(n,i,t,e,o),this._translate(n,i,f.x,f.y),t.container.orientation=="vertical"?o+=(i.height?i.height:i._height)+i.marginTop+i.marginBottom:e+=(i.width?i.width:i._width)+i.marginLeft+i.marginRight)},_getStackPosition:function(n,i,r,u,f){var s=0,h=0,e=t.datavisualization.Diagram.Util.bounds(r),o=t.datavisualization.Diagram.Util.bounds(i),y=r.container.orientation?r.container.orientation:"vertical",a=i.width?i.width:i._width,v=i.height?i.height:i._height,c,l;if(r.container.orientation=="vertical"){h=e.y-o.y+f+i.marginTop+r.paddingTop;switch(i.horizontalAlign){case"left":s=e.x-o.x+i.marginLeft+r.paddingLeft;break;case"center":s=e.center.x-o.center.x;break;case"right":s=e.x+e.width-(o.x+o.width+r.paddingRight);break;case"stretch":c=(r.width-(r.paddingLeft+r.paddingRight)-(i.marginLeft+i.marginRight))/a;n.scale(i,c,1,r.pivot,n.nameTable);e=t.datavisualization.Diagram.Util.bounds(r);o=t.datavisualization.Diagram.Util.bounds(i,n);s=e.x+r.paddingLeft+i.marginLeft-o.x}}else{s=e.x-o.x+u+i.marginLeft+r.paddingLeft;switch(i.verticalAlign){case"top":h=e.y-o.y+i.marginTop+r.paddingTop;break;case"center":h=e.center.y-o.center.y;break;case"bottom":h=e.y+e.height-(o.y+o.height+r.paddingBottom);break;case"stretch":l=(r.height-(r.paddingTop+r.paddingBottom)-(i.marginTop+i.marginBottom))/v;n.scale(i,1,l,r.pivot,n.nameTable);e=t.datavisualization.Diagram.Util.bounds(r);o=t.datavisualization.Diagram.Util.bounds(i,n);h=e.y+r.paddingTop+i.marginTop-o.y}}return{x:s,y:h}},_translate:function(n,i,r,u){var f,o,e;if(r||u)if(i.segments)t.datavisualization.Diagram.Util._translateLine(i,r,u,i);else{if(i.offsetX+=r,i.offsetY+=u,i._type==="group"||i.type==="pseudoGroup"||i.type=="umlclassifier")for(f=i.children,e=0;f&&e<f.length;e++)o=n.nameTable[n._getChild(f[e])],o&&this._translate(n,o,r,u);t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,r,u,null,n)}},_updateCollectionChange:function(n,i,r,u){if(this._setSize(n,i),this._alignChildren(n,i),i.parent){var f=n.nameTable[i.parent];f||u&&i.isPhaseStack&&(f=u);f&&f.container&&!r&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f)}}};t.datavisualization.Diagram.canvasHelper={_initCanvas:function(n,i){return i._type="group",i.type||(i.type="group"),i=t.datavisualization.Diagram.Group(i),i=this._initGroupNode(n,i),i=this._initChildren(n,i),this._setSize(n,i),this._alignChildren(n,i),i},_initGroupNode:function(n,i){return t.datavisualization.Diagram.containerCommon._initGroupNode(n,i)},_initChildren:function(n,i){return t.datavisualization.Diagram.containerCommon._initChildren(n,i)},_setSize:function(i,r,u,f){var e=this._getCanvasBounds(i,r,f),o=t.datavisualization.Diagram.Util.bounds(r),c,h,s;if(o=t.datavisualization.Diagram.Geometry.rect([o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]),e.width>=r.minWidth&&e.width<=r.maxWidth?e.width=e.width:e.width<=r.minWidth?e.width=r.minWidth:e.width>=r.maxWidth&&(e.width=r.maxWidth),e.height>=r.minHeight&&e.height<=r.maxHeight?e.height=e.height:e.height<=r.minHeight?e.height=r.minHeight:e.height>=r.maxHeight&&(e.height=r.maxHeight),u){var l=e.width/o.width,a=e.height/o.height,v=e.x+e.width/2-(o.x+o.width/2),y=e.y+e.height/2-(o.y+o.height/2),p=t.datavisualization.Diagram.Point(r.offsetX,r.offsetY);if(i._translate(r,v,y,i.nameTable,!0),i.scale(r,l,a,t.datavisualization.Diagram.Point(r.offsetX,r.offsetY),i.nameTable),r._isBpmn){for(c=i._getChildren(r.children),h=0;h<c.length;h++)s=i.nameTable[c[h]],s&&s._isInternalShape&&t.datavisualization.Diagram.Util.canResize(s)&&(s=n.extend(!0,s,{offsetX:r.offsetX,offsetY:r.offsetY,width:r.width,height:r.height}));t.datavisualization.Diagram.Util._updateBPMNProperties(r,i,i.nameTable,!0)}t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(r,1/l,1/a,p,i)}else r.width=e.width,r.height=e.height},_alignChildren:function(i,r){for(var o,u,s=!0,e=r.children,f=0;f<e.length;f++)u=typeof e[f]=="string"?i.nameTable[e[f]]:e[f],u&&!u._isInternalShape&&(i._disablePhaseUpdate&&u.isPhaseStack&&(s=!1),s&&(o=this._getCanvasPosition(i,u,r),this._translate(i,u,o.x,o.y))),u&&u._isInternalShape&&t.datavisualization.Diagram.Util.canResize(u)&&(u=n.extend(!0,u,{offsetX:r.offsetX,offsetY:r.offsetY,width:r.width,height:r.height}),t.datavisualization.Diagram.Util._updateBPMNProperties(r,i,i.nameTable,!0))},_translate:function(n,i,r,u){var o,f,e;if(r||u)if(i.segments)t.datavisualization.Diagram.Util._translateLine(i,r,u,i);else{if(i.offsetX+=r,i.offsetY+=u,i._type==="group"||i.type==="pseudoGroup")for(o=i.children,e=0;e<o.length;e++)f=n.nameTable[n._getChild(o[e])],f&&(this._translate(n,f,r,u),n._updateQuad(f));t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,r,u,null,n)}},_getCanvasPosition:function(n,i,r){var e=0,o=0,u=t.datavisualization.Diagram.Util.bounds(r),f=t.datavisualization.Diagram.Util.bounds(i),s,h;switch(i.horizontalAlign){case"left":e=u.x-f.x+i.marginLeft+r.paddingLeft;break;case"center":e=u.x+u.width/2-(f.x+f.width/2)+i.marginLeft+r.paddingLeft;break;case"right":e=u.x+u.width-i.marginRight-(f.x+f.width+r.paddingRight);break;case"stretch":s=(u.width-r.paddingLeft-r.paddingRight-i.marginLeft-i.marginRight)/i.width;n.scale(i,s,0,r.pivot,n.nameTable);f=t.datavisualization.Diagram.Util.bounds(i,n);e=u.x+r.paddingLeft-f.x+i.marginLeft}switch(i.verticalAlign){case"top":o=u.y-f.y+i.marginTop+r.paddingTop;break;case"center":o=u.y+u.height/2-(f.y+f.height/2)+i.marginTop+r.paddingTop;break;case"bottom":o=u.y+u.height-i.marginBottom-(f.y+f.height+r.paddingBottom);break;case"stretch":h=(u.height-r.paddingTop-r.paddingBottom-i.marginTop-i.marginBottom)/i.height;n.scale(i,0,h,r.pivot,n.nameTable);f=t.datavisualization.Diagram.Util.bounds(i,n);o=u.y+r.paddingTop-f.y+i.marginTop}return{x:e,y:o}},_getCanvasBounds:function(n,i,r){var e=t.datavisualization.Diagram.Rectangle(),o=0,f,u,h,c,l,a,s;if(i.children&&i.children.length>0)for(s=i.children;o<s.length;o++)f=typeof s[o]=="string"?n.nameTable[s[o]]:s[o],f&&!f._isInternalShape&&(u=t.datavisualization.Diagram.Util.bounds(f),u=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),f.horizontalAlign==="stretch"&&(u.width=u.width>=i.minWidth?u.width:1,(i.isLane||i.isSwimlane)&&o==0&&(u.width=1)),f.verticalAlign==="stretch"&&(u.height=u.height>=i.minHeight?u.height:1,i.isLane&&o==0&&(u.height=1)),u&&(l=f.marginLeft>0?u.x-f.marginLeft:u.x,a=f.marginTop>0?u.y-f.marginTop:u.y,h=h==undefined?l:Math.min(h,l),c=c==undefined?a:Math.min(c,a),u.width+=f.marginLeft+(r?0:f.marginRight),u.height+=f.marginTop+(r?0:f.marginBottom),u.x=0,u.y=0,i.type=="bpmn"&&(f.marginLeft<0&&(u.width-=f.marginLeft),f.marginTop<0&&(u.height-=f.marginTop))),e=t.datavisualization.Diagram.Geometry.union(e,u));return i.type=="bpmn"&&t.datavisualization.Diagram.Geometry.isEmptyRect(e)?(e=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft])):(e.width+=i.paddingLeft+i.paddingRight,e.height+=i.paddingTop+i.paddingBottom,e.x=h-i.paddingLeft,e.y=c-i.paddingTop),e},_updateCollectionChange:function(n,i){var u=!1,r;n.activeTool.name==="resize"&&i.container&&(u=!0);this._setSize(n,i,null,u);this._alignChildren(n,i);i.parent&&(r=n.nameTable[i.parent],r&&r.container&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r))},_getSwimlane:function(n,t){var i=n.nameTable[n._getChild(t)],r,u;if(i&&i.isLane&&(r=n.nameTable[i.parent],r&&(u=n.nameTable[r.parent],u)))return n.getNode(u.name)},_laneConnectors:function(n,t,i){var r,f,t,u;if(t&&t.isLane)for(f=0;f<t.children.length;f++)if(u=n.nameTable[n._getChild(t.children[f])],u){if(u.inEdges&&u.inEdges.length>0)for(r=0;r<t.children.length;r++)n._collectionContains(u.inEdges[r],i)||i.push(u.inEdges[r]);if(u.outEdges&&u.outEdges.length>0)for(r=0;r<t.children.length;r++)n._collectionContains(u.outEdges[r],i)||i.push(u.outEdges[r])}},_connectorRelateTolaneCollection:function(n,t,i){if(t){var r,u,e,o,f;if(o=t.sourceNode?n.nameTable[t.sourceNode]:null,e=t.targetNode?n.nameTable[t.targetNode]:null,o&&o.parent&&(r=n.nameTable[o.parent]),e&&e.parent&&(u=n.nameTable[e.parent]),r&&u&&u.name===r.name)return!1;for(f=0;f<i.length;f++)if(r&&r.name===i[f]||u&&u.name===i[f])return!0}return!1},_recreateConnectorSegments:function(n,i,r,u,f){if(n&&i){var h=[],c=[],v,o,e,s,l,a;if(i=n.nameTable[n._getChild(i)],(i&&i.isLane||i.isSwimlane)&&i.isLane&&Array.isArray(r)){for(a=this._getIntermediateLanes(n,r,u,f),e=0;e<a.length;e++)s=n.nameTable[n._getChild(a[e])],this._laneConnectors(n,s,h);for(v=this._getSwimlane(n,i.name),l=v.lanes,e=0;e<l.length;e++)s=n.nameTable[n._getChild(l[e])],this._laneConnectors(n,s,c);for(e=0;e<h.length;e++)o=n.nameTable[n._getChild(h[e])],o&&this._connectorRelateTolaneCollection(n,o,[u,f])&&(o.segments=[],t.datavisualization.Diagram.Util._initializeSegments(o,"orthogonal"));for(e=0;e<c.length;e++)o=n.nameTable[n._getChild(c[e])],o&&this._updateConnectorEndPoints(n,o)}}},_isLineInterSectingNode:function(n,i,r){var f=!1,u,h,e,c,l,a,v,y,p,w,o,s;if(i&&r&&(u=t.datavisualization.Diagram.Util.bounds(r),h=[{x:u.topLeft.x,y:u.topLeft.y},{x:u.topRight.x,y:u.topRight.y},{x:u.bottomRight.x,y:u.bottomRight.y},{x:u.bottomLeft.x,y:u.bottomLeft.y},{x:u.topLeft.x,y:u.topLeft.y}]),e=i.segments,e&&e.length>0)for(c=0;!f&&c<e.length;c++)if(l=e[c],l&&l.points.length>0)for(a=l.points,o=0;!f&&o<a.length-1;o++)for(v=a[o],y=a[o+1],s=0;!f&&s<h.length-1;s++)if(p=h[s],w=h[s+1],this._isInterSecting(v.x,v.y,y.x,y.y,p.x,p.y,w.x,w.y,!0)){f=!0;break}return f},_updateConnectorEndPoints:function(n,i){var r,u,f;n&&i&&(r=!1,i.sourcePoint=t.datavisualization.Diagram.Point(),i.targetPoint=t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initConnectionEnds(i,n),t.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),n._dock(i,n.nameTable),i.sourceNode&&(u=n.nameTable[i.sourceNode]),u&&this._isLineInterSectingNode(n,i,u)&&(r=!0),i.targetNode&&(f=n.nameTable[i.targetNode]),f&&this._isLineInterSectingNode(n,i,f)&&(r=this._anySegmentOrtho(i)?!1:!0),r&&(i.segments=[],t.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),n._dock(i,n.nameTable)),t.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),n._dock(i,n.nameTable))},_anySegmentOrtho:function(n){var r=!1,i,t;if(n&&n.segments&&n.segments.length>0)for(t=0;t<n.segments.length;t++)if(i=n.segments[t],i&&i.type!=="orthogonal"){r=!0;break}return r},_getIntermediateLanes:function(n,t,i,r){var f=[],u;if(t){var e=t.indexOf(i),o=t.indexOf(r),s=Math.min(e,o),h=Math.max(e,o);for(u=s;u<=h;u++)f.push(t[u])}return f},_swapLane:function(i,r,u,f,e,o){var l=i.nameTable[f],w=r.slice(),s=i.tools.move,a=this._getSwimlane(i,u),y,p;if(s._undoObject=n.extend(!0,{},{name1:u,name2:f}),l){var c=t.datavisualization.Diagram.Util.bounds(l),v=r.indexOf(u),h=r.indexOf(f);r.splice(r.indexOf(u),1);h+=v>h?0:-1;h+=e?s.currentPoint.y>=c.y&&s.currentPoint.y<c.center.y?0:1:s.currentPoint.x>=c.x&&s.currentPoint.x<c.center.x?0:1;r.splice(h,0,u)}s._redoObject=n.extend(!0,{},{name1:f,name2:u});y={type:"swapLane",undoObject:jQuery.extend(!0,{},s._undoObject),redoObject:jQuery.extend(!0,{},s._redoObject),currentIndex:v,moveIndex:h,category:"internal"};p=this._getSwimlane(i,u);a&&i._comparePropertyValues(p,"lanes",{lanes:a.lanes},!0);i.addHistoryEntry(y);s._multipleUndo=!0;o&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o,!1);i.activeTool.selectedObject&&(t.datavisualization.Diagram.canvasHelper._recreateConnectorSegments(i,i.activeTool.selectedObject.name,w,u,f),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(i,i.activeTool.selectedObject))},_updateHelper:function(n){n.activeTool.helper?(this._updateHelperXY(n,n.activeTool.helper,n.activeTool.previousPoint,n.activeTool.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(n)):this._initHelper(n)},_updateHelperXY:function(n,i,r,u){var h=u.x<r.x,c=u.y<r.y,e=n.activeTool.diffx+(u.x-r.x),o=n.activeTool.diffy+(u.y-r.y),f,l=n.activeTool.diagram._enableSnapToObject(),s;n.activeTool.diagram._enableSnapToObject(!0);f=t.datavisualization.Diagram.SnapUtil._snapPoint(n,n.activeTool.helper,h,c,t.datavisualization.Diagram.Point(e,o),u,r);n.activeTool.diagram._enableSnapToObject(l);f||(f=t.datavisualization.Diagram.Point(e,o));n.activeTool.diffx=e-f.x;n.activeTool.diffy=o-f.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(f)||(s=n.activeTool._raiseDragEvent({element:n.getNode(n.activeTool.helper),offset:f,cancel:!1}),s&&!s.cancel&&(n.activeTool._outOfBoundsDrag(i,f.x,f.y)&&n._translate(i,f.x,f.y,n.nameTable),i._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(i,n)))},_initHelper:function(n){n.activeTool.helper=this._getCloneNode(n.activeTool.selectedObject);n.activeTool.helper._name=n.activeTool.selectedObject.name;n.activeTool.helper.name="helper";n.activeTool.startPoint=n.activeTool.currentPoint;t.datavisualization.Diagram.SvgContext._drawContainerHelper(n)},_getCloneNode:function(n){var t=null;return t=jQuery.extend(!0,{},n),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},_updateHighlighter:function(n,t){var i=n.activeTool._getMouseOverElement(t);i&&!i.segments&&(!n.activeTool.selectedObject.isLane||i.isLane)?n.activeTool._nodeHighLighter(i,t):n.activeTool._removeHighLighter()},_updateNodeMargin:function(i,r,u){var h,c,a,o,s;if(r._type=="group")for(h=0;h<r.children.length;h++)c=r.children[h],this._updateNodeMargin(i,typeof c=="string"?i.nameTable[c]:c,r);if(r&&u){var l=n.extend(!1,{},r),f=t.datavisualization.Diagram.Util.bounds(r),e=t.datavisualization.Diagram.Util.bounds(u),y=u.container&&u.container.type&&u.container.type=="stack"?!0:!1;y?u.container.orientation==="horizontal"?r.marginTop=f.top-e.top-u.paddingTop:r.marginLeft=f.left-e.left-u.paddingLeft:(r.marginLeft=f.left-e.left-u.paddingLeft,r.marginTop=f.top-e.top-u.paddingTop);var p=f.right-f.left,w=f.bottom-f.top,v=e.x+e.width-(f.x+p)-u.paddingRight;r.marginRight=v<0?0:v;a=e.y+e.height-(f.y+w)-u.paddingBottom;r.marginBottom=a<0?0:a;u.isLane&&(o=0,s=0,u.orientation==="horizontal"?(o=50,s=0):(o=0,s=50),r.marginLeft=r.marginLeft>=o?r.marginLeft:o,r.marginTop=r.marginTop>=s?r.marginTop:s,i._comparePropertyValues(r,"marginLeft",{marginLeft:l.marginLeft},!0),i._comparePropertyValues(r,"marginRight",{marginLeft:l.marginRight},!0),i._comparePropertyValues(r,"marginBottom",{marginLeft:l.marginBottom},!0),i._comparePropertyValues(r,"marginRight",{marginLeft:l.marginRight},!0))}},_singleNodedrag:function(i,r,u){var l=!i.activeTool._checkForDropEvent(u),f,s,h,c,o;if(l)if(u){if((t.datavisualization.Diagram.Util.canAllowDrop(u)||u.name==i.activeTool.selectedObject.parent)&&u.container&&u.container.type=="canvas")if(s=!u._isBpmn||u._isBpmn&&i.activeTool.selectedObject.parent!=u.name?!0:!1,t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(i,i.activeTool.helper,u)&&s)(u.isLane||u.container.type=="canvas")&&this._disableConnectorUpdate(i),i.activeTool.seletedObject=i.nameTable[i.activeTool.selectedObject.name],i.activeTool.selectedObject.parent&&(f=i.nameTable[i.activeTool.selectedObject.parent]),i._disablePhaseUpdate=!0,i._disableSwimlaneUptate=!0,this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,u,null,!0),h=i._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,i._raiseGroupChangeEvent(i.activeTool.selectedObject,f,u,h),i._comparePropertyValues(i.activeTool.selectedObject,"parent",{parent:f.name},!0),delete i._disablePhaseUpdate,delete i._disableSwimlaneUptate,this._updateLastSwimlanePhase(i,i.activeTool.selectedObject),(u.isLane||u.container.type=="canvas")&&this._enableConnectorUpdateNode(i,i.activeTool.selectedObject);else if(u._isBpmn){var e=i.nameTable[i.activeTool.selectedObject.parent],a=e.width,v=e.height,y={x:e.offsetX,y:e.offsetY};i._translate(i.activeTool.selectedObject,i.activeTool.helper.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.helper.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable);i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable);c=t.datavisualization.Diagram.ContainerHelper.updateparent(u,i);c?(this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,u,null,!0)):t.datavisualization.Diagram.bpmnHelper.updateCanvas(e,i)}else i._translate(i.activeTool.selectedObject,i.activeTool.undoObject.node.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.undoObject.node.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable),i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable),this._updateLastSwimlanePhase(i,u)}else o=n.extend(!0,{},i.activeTool.selectedObject),i.activeTool.selectedObject.type!="pseudoGroup"&&this._disableConnectorUpdate(i),i.activeTool.selectedObject.parent&&(f=i.nameTable[i.activeTool.selectedObject.parent]),this._removeNodeFromContainer(i,i.activeTool.selectedObject),i._raiseGroupChangeEvent(i.activeTool.selectedObject,f,null,"group"),this._addMultiNodeToDiagram(i,i.activeTool.selectedObject),this._enableConnectorUpdateNode(i,o),i._updateAssociatedConnectorEnds(o,i.nameTable);return!0},_updateLastSwimlanePhase:function(n,i){var r=t.datavisualization.Diagram.ContainerHelper.updateparent(i,n),u,f;r&&r.isLane&&(u=n.nameTable[r.parent],u&&(f=n.nameTable[u.parent],f&&this._updateLastPhase(n,f)))},_updateLastPhase:function(n,i){var f,r;if(i&&i.isSwimlane){var h=n.nameTable[n._getChild(i.children[2])],c=n.nameTable[n._getChild(i.children[1])],o=t.datavisualization.Diagram.stackHelper._getStackBoundsBounds(n,h),s=t.datavisualization.Diagram.stackHelper._getStackBoundsBounds(n,c),e=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),l=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,i),u;u=n.nameTable[n._getChild(l[0])];e.length>0&&(f=n.nameTable[e[e.length-1]],f&&(i.orientation==="horizontal"?(r=o.width-s.width,f.width+=r,f.offset+=r,u&&u.isLane&&(u.minWidth+=r)):(r=o.height-s.height,f.height+=r,f.offset+=r,u&&u.isLane&&(u.minHeight+=r))),t.datavisualization.Diagram.SwimLaneContainerHelper._updatePhaseStack(n,i))}},_disableConnectorUpdate:function(n){n._disableSegmentChange=!0},_enableConnectorUpdate:function(n,t,i){delete n._disableSegmentChange;t&&(n._updateChildAdjacentConnectors(t,!0),i||(n._disableSegmentChange=!0,this._updateSwimalneAssociatedConnectors(n,t,n._svg),delete n._disableSegmentChange),this._updateChildAdjacentConnectors(n,t))},_updateChildAdjacentConnectors:function(n,i){var f=n._getChildTable(i,{}),u,r;for(u in f)r=n.nameTable[n._getChild(u)],r&&r.segments&&i.children.indexOf(u)==-1&&t.datavisualization.Diagram.DiagramContext.update(r,n)},_updateSwimalneAssociatedConnectors:function(n,i,r,u){var e=n._getChildren(i.children),o,s,f;if(e&&e.length>0)for(o=0,s=e.length;o<s;o++)f=n.nameTable[e[o]],f&&(f._type==="group"?this._updateSwimalneAssociatedConnectors(n,f,r,u):this._updateSwimalneAssociatedConnectors(n,f,r,u));i.type!="group"&&t.datavisualization.Diagram.SvgContext._updateAssociatedConnector(i,r,n)},_enableConnectorUpdateNode:function(n,t){var i=null,r;t&&t.parent&&(i=n.nameTable[t.parent]);i&&(i.isLane?(r=n.nameTable[i.parent.split("laneStack")[0]],r&&r.isSwimlane&&this._enableConnectorUpdate(n,r)):i.type=="bpmn"?this._enableConnectorUpdate(n,i):i.container&&i.container.type==="canvas"&&this._enableConnectorUpdate(n,i))},_enableConnectorUpdatePhase:function(n,t){if(t&&(t.isPhase||t.type==="phase")){var i=n.nameTable[t.parent.split("phaseStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(n,i)}},_enableConnectorUpdateLane:function(n,t){if(t&&t.isLane){var i=n.nameTable[t.parent.split("laneStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(n,i)}},_outOfBoundaryMultiNodeDrop:function(n,i){var r,u,e,o,f;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)&&i&&i.type==="pseudoGroup")for(o=i.children,f=0;f<o.length;f++)if(r=n.nameTable[n._getChild(o[f])],u=this._getTargets(n,r),u&&u.length>0&&!r.segments&&(e=this._getContainerFromTarget(n,u,r),e&&!this._isExeedBounds(n,r,e)))return!1;return!0},_multiNodedrag:function(n,i,r){var u,e,c,l,o,s,h,f,a;if(this._outOfBoundaryMultiNodeDrop(n,r)){if(r){if(n._disableSwimlaneUptate=!0,this._disableConnectorUpdate(n),r.children.length>0)for(l=r.children,o=0;o<l.length;o++)u=n.nameTable[n._getChild(l[o])],!u||u.type==="connector"||u.segments||(e=this._getTargets(n,u),e&&e.length>0?(c=this._getContainerFromTarget(n,e,u),c?this._addNodeToContainer(n,u,c):this._addMultiNodeToDiagram(n,u)):this._addMultiNodeToDiagram(n,u)),u.parent&&(s=n.nameTable[u.parent],s&&s.isLane&&(h=n.nameTable[s.parent.split("laneStack")[0]],h&&(n._updateSwimlanes||(n._updateSwimlanes=[]),n._collectionContains(h.name,n._updateSwimlanes)||n._updateSwimlanes.push(h.name))));if(delete n._disableSwimlaneUptate,n._updateSwimlanes&&n._updateSwimlanes.length>0)for(f=0;f<n._updateSwimlanes.length;f++)t.datavisualization.Diagram.DiagramContext.update(n.nameTable[n._updateSwimlanes[f]],n),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(n,n.nameTable[n._updateSwimlanes[f]]);else delete n._disableSegmentChange;delete n._updateSwimlanes;this._getRedoObject(n,r);a={type:"positionchanged",node:jQuery.extend(!0,{},r),undoObject:jQuery.extend(!0,{},n.activeTool._undoObject),redoObject:jQuery.extend(!0,{},n.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(a);n.activeTool._multipleUndo=!0;t.datavisualization.Diagram.Util._updateGroupBounds(r,n);n.updateSelection()}}else this._updateBoundsExceedNodes(n,r,"move")},_updateBoundsExceedNodes:function(n,i,r){var h=n.tools[r].undoObject,s=i.children,e,f,u,c,o;for(i.rotateAngle=h.node.rotateAngle,e=0;e<s.length;e++)f=h.childTable[s[e]],u=n.nameTable[n._getChild(s[e])],f&&u&&(r==="move"?n._translate(u,f.offsetX-u.offsetX,f.offsetY-u.offsetY,n.nameTable):r==="resize"?(n._translate(u,f.offsetX-u.offsetX,f.offsetY-u.offsetY,n.nameTable),n.scale(u,f.width/u.width,f.height/u.height,t.datavisualization.Diagram.Point(u.offsetX,u.offsetY),n.nameTable)):r==="rotate"&&(n._translate(u,f.offsetX-u.offsetX,f.offsetY-u.offsetY,n.nameTable),c=f.rotateAngle-u.rotateAngle,u.rotateAngle+=c),u._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(u,n),n._updateAssociatedConnectorEnds(f,n.nameTable),f.parent&&(o=n.nameTable[f.parent],o&&o.children.length>0&&(o.children.push(f.name),u.parent=f.parent)),t.datavisualization.Diagram.DiagramContext.update(f,n));t.datavisualization.Diagram.Util._updateGroupBounds(i,n);n.updateSelection()},_getContainerFromTarget:function(n,i,r){for(var f,e,u=0;u<i.length;u++)if(i[u].container&&i[u].container.type==="canvas"&&(f=t.datavisualization.Diagram.Util.bounds(r),e=t.datavisualization.Diagram.Util.bounds(i[u]),f.center.x>e.left&&f.center.x<e.right&&f.center.y>e.top&&f.center.y<e.bottom))return i[u]},_getTargets:function(n,i){var a=null,s,u=[],h,c,f,e,o,r,l,v;if(i)for(s=t.datavisualization.Diagram.Util.bounds(i),c=t.datavisualization.Diagram.SpatialUtil.findQuads(n._spatialSearch,s),f=0;f<c.length;f++)if(e=c[f],e.objects.length>0)for(o=0;o<e.objects.length;o++)if(r=e.objects[o],!r.segments&&r.visible&&(a=t.datavisualization.Diagram.Util.bounds(r),u.indexOf(r)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(s,a)))if(r.isSwimlane){l=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,r);for(v in l)h=n.nameTable[n._getChild(l[v])],h&&u.splice(0,0,h)}else u.push(r);return u},_removeFromParentContainer:function(n,t){this._removeNodeFromContainer(n,t)},_removeNodeFromContainer:function(n,i,r){var s,h,f,o,u,e;if(n._removedFromContiner=!0,i.type!=="pseudoGroup"){if(e=n.nameTable[i.parent],e){for(f=e.children,s=f,s=s.slice(0),o=0;o<f.length;o++)u=n.nameTable[n._getChild(f[o])],u.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(e.children,f[o]);t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(n._spatialSearch,n._spatialSearch.quadTable[u.name],u);h={element:e,cause:n.activeTool.inAction?t.datavisualization.Diagram.ActionType.Mouse:t.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:s,newValue:f};n._raisePropertyChange(h);n._comparePropertyValues(i,"parent",{parent:""},h.cause);i.parent="";u._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(u,n._svg,n._diagramLayer,n.nameTable,n):u.segments?t.datavisualization.Diagram.SvgContext.renderConnector(u,n._svg,n._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(u,n._svg,n._diagramLayer,undefined,n);r||t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,e,!0)}}else if(f=i.children,f.length>0){for(this._getUndoObject(n,i),o=0;o<f.length;o++)u=n.nameTable[n._getChild(f[o])],u&&this._removeNodeFromContainer(n,u,!0);u.parent&&(e=n.nameTable[u.parent]);e&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,e,!0)}},_addDrgaHistoryEntry:function(n,t){var i={},i=n._getChildTable(t,i),r;n.activeTool._multipleUndo=!0;r={type:"positionchanged",node:jQuery.extend(!0,{},t),childTable:i,category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(r)},_cloneNode:function(t,i,r){var f,e,u;if(i){if(i=n.extend(!0,{},i),i.name+=r,i.parent+=r,i.children&&i.children.length>0)for(e=i.children,u=0;u<e.length;u++)f=t.nameTable[t._getChild(e[u])],f&&(i.children[u]=this._cloneNode(t,f,r));return i}},_isExeedBounds:function(n,i,r){var s,o,f,u,e,h,c;if(n._disableUpdateQuad=!0,i&&r&&r.isLane&&(s=n.nameTable[r.parent.split("laneStack")[0]],s)){if(o=t.datavisualization.Diagram.Util.randomId(),f=n._cloneSwimlaneObj(n._getNode(s.name),o),f=t.datavisualization.Diagram.ContainerHelper._initContainer(n,f),u=this._cloneNode(n,i,o),n.nameTable[u.name]=u,e=n.nameTable[r.name+o],e){if((e.children.push(u.name),this._updateNodeMargin(n,u,n.nameTable[r.name+o]),n._disableSwimlaneUptate=!0,this._disableConnectorUpdate(n),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,e),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f),delete n._disableSegmentChange,delete n._disableSwimlaneUptate,h=t.datavisualization.Diagram.Util.bounds(f),t.datavisualization.Diagram.containerCommon._removeObject(n,e),t.datavisualization.Diagram.containerCommon._removeObject(n,f),delete n._disableUpdateQuad,c=n.activeTool._getPageBounds(),h.bottom>c.height)||h.right>c.width)return!1;e.children.pop(u.name)}n.nameTable[u.name]}return delete n._disableUpdateQuad,!0},_outOfBoundaryNodeDrop:function(n,i,r){return t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)?this._isExeedBounds(n,i,r):!0},_getAssociatedConnectors:function(t,i,r){var r=r||[],u=0,f;if(i&&!i.segments){if(i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)this._getAssociatedConnectors(t,t.nameTable[t._getChild(i.children[u])],r);for(u=0;u<i.inEdges.length;u++)f=t.nameTable[t._getChild(i.inEdges[u])],f&&r.push(n.extend(!0,{},f));for(u=0;u<i.outEdges.length;u++)f=t.nameTable[t._getChild(i.outEdges[u])],f&&r.push(n.extend(!0,{},f))}return r},_addNodeToContainer:function(i,r,u,f,e){var l,k,a,p,s,w,it,rt,ut,v,h,ft,y,o,c,b;if(i.getObjectType(r)!=="connector"&&r&&u&&!r.isPhase)if(r.parent&&(l=i.nameTable[r.parent],l.container||(k=l.children,t.datavisualization.Diagram.Util.removeFromCollection(i,k,r),t.datavisualization.Diagram.Util._updateGroupBounds(l,i))),r.type!=="pseudoGroup"){var d=t.datavisualization.Diagram.Util.bounds(i.activeTool.helper),g=t.datavisualization.Diagram.Util.bounds(i.activeTool.selectedObject),nt=i.activeTool.helper?d.x-g.x:0,tt=i.activeTool.helper?d.y-g.y:0;if(i._raiseOffsetPropertyChange(r,r.offsetX+nt,r.offsetY+tt,!0),i._translate(r,nt,tt,i.activeTool.diagram.nameTable),a=u.children,a=a.slice(0),u.children.push(r),t.datavisualization.Diagram.Util.removeItem(i.nodes(),r),p={element:u,cause:i.activeTool.inAction?t.datavisualization.Diagram.ActionType.Mouse:t.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:a,newValue:u.children},i._raisePropertyChange(p),i._comparePropertyValues(r,"parent",{parent:u.name},p.cause),r.parent=u.name,this._updateNodeMargin(i,r,u),i._isDragg&&(s=i._historyList,s&&s.currentEntry&&s.currentEntry.object&&s.currentEntry.object.parent===""&&(s.currentEntry.object=n.extend(!0,{},r))),w=i._svg.getElementById(u.name),r._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(r,i,w):r.segments||t.datavisualization.Diagram.DiagramContext.renderNode(r,i,w),this._disableConnectorUpdate(i),f||(u.type=="bpmn"&&(it=n.extend(!0,{},{node:u})),rt=jQuery.extend(!0,{},u),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0),this._updateAddRemoveNodeConnectors(i,u,rt),u.type=="bpmn"&&(i._isGroupActionEnabled=!0,i._startGroupAction(),ut={type:"sizechanged",node:jQuery.extend(!0,{},u),undoObject:it,redoObject:n.extend(!0,{},{node:u}),category:"internal"},i.addHistoryEntry(ut))),v=this._getAssociatedConnectors(i,r),v.length>0)for(o=0;o<v.length;o++)h=v[o],ft=i._svg.getElementById(h.name),i._removeElement(h),i._zOrder++,i.nameTable[h.name]&&(i.nameTable[h.name].zOrder=i._zOrder),t.datavisualization.Diagram.DiagramContext.renderConnector(h,i);this._updateLastSwimlanePhase(i,r);e||this._enableConnectorUpdateNode(i,r);i._findLabelEditing&&u.children.splice(u.children.indexOf(r.name),1)}else if(y=r.children,y.length>0){for(o=0;o<y.length;o++)c=i.nameTable[i._getChild(y[o])],c&&this._addNodeToContainer(i,c,u,!0);c&&c.parent&&(b=i.nameTable[c.parent]);b&&(t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,b,!0),t.datavisualization.Diagram.Util._updateGroupBounds(r,i),t.datavisualization.Diagram.SvgContext.updateSelector(r,i._adornerSvg,i._currZoom,i,i.model.selectedItems.constraints))}},_addMultiNodeToDiagram:function(n,i){var r,u,o;if(n.activeTool.helper){var f=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),e=t.datavisualization.Diagram.Util.bounds(i),s=n.activeTool.helper?f.x-e.x:0,h=n.activeTool.helper?f.y-e.y:0;n._translate(i,s,h,n.nameTable)}for(r=n.nodes(),u=r.length-1;u>=0;u--)o=n.nameTable[n._getChild(r[u])],i.name===o.name&&t.datavisualization.Diagram.Util.removeItem(r,r[u]);n.nodes().push(i);n._removedFromContiner&&(i._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(i,n._svg,n._diagramLayer,n.nameTable,n):i.segments?t.datavisualization.Diagram.SvgContext.renderConnector(i,n._svg,n._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(i,n._svg,n._diagramLayer,undefined,n));delete n._removedFromContiner;n.activeTool.helper&&this._updateLastSwimlanePhase(n,n.activeTool.helper)},_singleNodeResize:function(n,t,i){n.activeTool.selectedObject&&this._resizeNode(n,i)},_resizeNode:function(n,i){var r;if(i){var f=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),u=!0;i.isLane||(i.parent==""&&i._parent&&(i.parent=i._parent,delete i._parent,u=!1),i.segments||(i.parent&&(r=n.nameTable[i.parent]),r&&r.isLane&&this._disableConnectorUpdate(n),u&&n.activeTool._updateSize(i,n.activeTool.startPoint,n.activeTool.currentPoint),r&&(this._updateNodeMargin(n,i,r),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0),this._updateLastSwimlanePhase(n,i)),this._enableConnectorUpdateNode(n,i)))}},_updateResizeHelper:function(n){var i,r;n.activeTool.helper?(i=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),n._resizeStack=!0,n.activeTool._updateSize(n.activeTool.helper,n.activeTool.previousPoint,n.activeTool.currentPoint,null,null,null,!0),delete n._resizeStack,r=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),n.activeTool.selectedObject.container&&!n.activeTool.helper._isBpmn&&n._translate(n.activeTool.helper,i.topLeft.x-r.topLeft.x,i.topLeft.y-r.topLeft.y,n.nameTable),t.datavisualization.Diagram.SvgContext._updateContainerHelper(n)):(n.activeTool.helper=n.activeTool._getCloneNode(n.activeTool.selectedObject),n.activeTool.helper.inEdges=n.activeTool.helper.outEdges=[],n.activeTool.helper.type=null,n.activeTool.helper.name="helper",t.datavisualization.Diagram.SvgContext._drawContainerHelper(n),n.activeTool._startPoint=n.activeTool.currentPoint,n._resizeStack=!0,n.activeTool._updateSize(n.activeTool.helper,n.activeTool.previousPoint,n.activeTool.currentPoint,null,null,null,!0),delete n._resizeStack)},_multiNodeResize:function(n,i,r){var u,f,o,s,e,h;if(r)if(this._outOfBoundaryMultiNodeDrop(n,r)){if(r.children.length>0)for(s=r.children,e=0;e<s.length;e++)u=n.nameTable[n._getChild(s[e])],f=this._getTargets(n,u),f&&f.length>0?(o=this._getContainerFromTarget(n,f,u),o?this._addNodeToContainer(n,u,o):this._addMultiNodeToDiagram(n,u)):this._addMultiNodeToDiagram(n,u);this._getRedoObject(n,r);h={type:"sizechanged",node:jQuery.extend(!0,{},r),undoObject:jQuery.extend(!0,{},n.activeTool._undoObject),redoObject:jQuery.extend(!0,{},n.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(h);n.activeTool._multipleUndo=!0;t.datavisualization.Diagram.Util._updateGroupBounds(r,n);n.updateSelection()}else this._updateBoundsExceedNodes(n,r,"resize")},_singleNodeRotate:function(n,t,i){n.activeTool.selectedObject&&this._rotateNode(n,i)},_rotateNode:function(n,i){var u,r,e,f;i&&(u=!0,i.container||(i.parent==""&&i._parent&&(i.parent=i._parent,delete i._parent,u=!1),i.parent&&(r=n.nameTable[i.parent]),r&&r.isLane&&this._disableConnectorUpdate(n),i.segments||(u&&(e=n.nameTable[n.activeTool.selectedObject.name],n.activeTool.helper&&(f=n.activeTool.helper.rotateAngle-n.nameTable[n.activeTool.selectedObject.name].rotateAngle,n._comparePropertyValues(i,"rotateAngle",{rotateAngle:n.activeTool.helper.rotateAngle},!0),n._rotate(n.activeTool.selectedObject,f,n.nameTable))),r&&(this._updateNodeMargin(n,i,r),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0),this._updateLastSwimlanePhase(n,i)),this._enableConnectorUpdateNode(n,i))))},_multiNodeRotate:function(n,i,r){var u,f,o,s,e,h;if(r)if(this._outOfBoundaryMultiNodeDrop(n,r)){if(r.children.length>0)for(s=r.children,e=0;e<s.length;e++)u=n.nameTable[n._getChild(s[e])],f=this._getTargets(n,u),f&&f.length>0?(o=this._getContainerFromTarget(n,f,u),o?this._addNodeToContainer(n,u,o):this._addMultiNodeToDiagram(n,u)):this._addMultiNodeToDiagram(n,u);this._getRedoObject(n,r);h={type:"rotationchanged",node:jQuery.extend(!0,{},r),undoObject:jQuery.extend(!0,{},n.activeTool._undoObject),redoObject:jQuery.extend(!0,{},n.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(h);n.activeTool._multipleUndo=!0;t.datavisualization.Diagram.Util._updateGroupBounds(r,n);n.updateSelection()}else this._updateBoundsExceedNodes(n,r,"rotate")},_updateDropLaneProperties:function(n,i,r){if(i&&r){i.orientation=r.orientation;i.horizontalAlign=r.orientation==="horizontal"?"stretch":"left";i.verticalAlign=r.orientation==="vertical"?"stretch":"top";i.paddingBottom=20;i.paddingTop=20;i.paddingLeft=20;i.paddingRight=20;var u=n.nameTable[n._getChild(i.children[0])];u&&(u.marginLeft=-20,u.marginTop=-20,u.marginRight=-20,u.marginBottom=-20,u.constraints=t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,u._isHeader=!0)}return i},_updateAddRemoveNodeConnectors:function(n,t,i){if(t&&t.isLane&&i&&i.isLane){var r=0,u=0;r=t.width-i.width;u=t.height-i.height;(r||u)&&this._updateOverlappedConnectorSegment(n,i,r,u)}},_updateAddRemoveLaneConnectors:function(n,t){if(t&&t.isLane){var r=[],u,e,f,i,t;for(e=this._getSwimlane(n,t.name),f=e.lanes,i=0;i<f.length;i++)t=n.nameTable[n._getChild(f[i])],this._laneConnectors(n,t,r);for(i=0;i<r.length;i++)u=n.nameTable[n._getChild(r[i])],u&&this._updateConnectorEndPoints(n,u)}},_outOfBoundaryAddLane:function(i,r,u,f){var e,o,s,h,c;return t.datavisualization.Diagram.Util.canMoveOutofBoundary(i)&&((e=i._cloneSwimlaneObj(i._getNode(r.name),t.datavisualization.Diagram.Util.randomId()),e=t.datavisualization.Diagram.ContainerHelper._initContainer(i,e),o=i.activeTool._cloneGroupNode(n.extend(!0,{},u),t.datavisualization.Diagram.Util.randomId()),i.nameTable[o.name]=o,s=i.nameTable[i._getChild(e.children[2])],f||f===0?s.children.splice(f,0,o.name):s.children.push(o.name),o.parent=s.name,i._disableSwimlaneUptate=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,e),this._enableConnectorUpdate(i,e),delete i._disableSwimlaneUptate,h=t.datavisualization.Diagram.Util.bounds(e),t.datavisualization.Diagram.containerCommon._removeObject(i,o),t.datavisualization.Diagram.containerCommon._removeObject(i,e),c=i.activeTool._getPageBounds(),h.bottom>c.height)||h.right>c.width)?!1:!0},_addNewLane:function(n,i,r,u,f){var a,o,e,v,l,f,h,c,y,p,w,s;if(n.activeTool._removeHelpers(),o=n.nameTable[n._getChild(r.children[2])],o){if(e=n.activeTool._cloneGroupNode(n.activeTool.selectedObject,u?"":t.datavisualization.Diagram.Util.randomId()),e=this._updateDropLaneProperties(n,e,r),v=n._isUndo,n._isUndo=!0,n.activeTool.selectedObject=null,n.remove(n.activeTool.selectedObject),n._isUndo=v,n._isUndo||this._outOfBoundaryAddLane(n,r,e,f)){if(l=!1,s={element:n.getNode(e),cancel:!1,target:i},i&&(f=f!==undefined?f:n.activeTool._getSwimLaneStackIndex(i)),f||f===0?o.children.splice(f,0,e):o.children.push(e),e.parent=o.name,n._isUndo||n._raiseDropEvent(s),n.remove(e),!s.cancel){if(n.activeTool._isLane=!0,e.isLane&&(h=n.nameTable[n._getChild(e.children[0])],h&&e.labels&&h.labels.length>0))for(c=0;c<h.labels.length;c++)h.labels[c].visible=!0;n._isUndo||(y=n._getChildTable(e,{}),p={type:"collectionchanged",object:jQuery.extend(!0,{},e),childTable:jQuery.extend(!0,{},y),index:f,changeType:"insert",category:"internal"},n.addHistoryEntry(p));n._preventHistoryEntry=!0;n.add(e)&&(l=!0,n._updateDroppedSymbol(e));delete n._preventHistoryEntry}this._disableConnectorUpdate(n);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,o);this._updateAddRemoveLaneConnectors(n,e);t.datavisualization.Diagram.canvasHelper._updateLastPhase(n,r);this._enableConnectorUpdateLane(n,e);l&&(w=n._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,s={changeType:"insert",element:n.getNode(e),state:"changed",cause:w},n._raiseEvent("nodeCollectionChange",s));a=!0}n._clearSelection(!0);a&&n._addSelection(r,!0);n.activeTool.selectedObject=null}},_outOfBoundsOnLaneResize:function(n,i,r){var u,h,f;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)&&(u=r?n.nameTable[i.parent.split("laneStack")[0]]:i,h=t.datavisualization.Diagram.Util.randomId(),u)){var e=t.datavisualization.Diagram.Util.bounds(u),o=0,s=0;if((i.height!=n.activeTool.helper.height&&(s=n.activeTool.helper.height-i.height),i.width!=n.activeTool.helper.width&&(o=n.activeTool.helper.width-i.width),f=n.activeTool._getPageBounds(),e.bottom+s>f.height)||e.right+o>f.width)return!1}return!0},_getLaneIndex:function(n,t){for(var r=n.lanes,i=0;i<r.length;i++)if(t.name===r[i].name)return i;return null},_isCanAddNodeToSegmentUpdate:function(n,t,i){if(i)if(i&&i.parent){var r=n.nameTable[i.parent],u,f;if(r&&r.isLane){if(u=this._getSwimlane(n,r.name),f=this._getLaneIndex(u,r),f>t)return!0}else return!1}else return!1;return!1},_getUpdateConnectorByEdges:function(n,t,i,r){t&&(this._getUpdateSegmentConnectors(n,t,i,r,t.inEdges),this._getUpdateSegmentConnectors(n,t,i,r,t.outEdges))},_getUpdateSegmentConnectors:function(n,t,i,r,u){var f,o,s,e;if(u&&u.length>0)for(e=0;e<u.length;e++)f=n.nameTable[u[e]],f.sourceNode&&(o=n.nameTable[f.sourceNode]),f.targetNode&&(s=n.nameTable[f.targetNode]),o&&s&&this._isCanAddNodeToSegmentUpdate(n,i,o)&&this._isCanAddNodeToSegmentUpdate(n,i,s)&&!n._collectionContains(f.name,r)&&r.push(f)},_updateConnectorSegments:function(n,i,r,u){var l=this._getSwimlane(n,i.name),o,e,h,f,c,s;if(o=this._getLaneIndex(l,i),o!=null)for(e=[],h=l.lanes,f=o+1;f<h.length;f++)for(c=h[f].children,s=0;s<c.length;s++)this._getUpdateConnectorByEdges(n,c[s],o,e);if(e&&e.length>0&&r!=null&&u!=null)for(f=0;f<e.length;f++)t.datavisualization.Diagram.Util._translateLine(e[f],r,u,e[f])},_resizeLane:function(i,r){var u=i.nameTable[r.name],a=!0,v,c,l,y,p,h,e,f,s;if(u)if(u.isLane||u._isBpmn){if(this._outOfBoundsOnLaneResize(i,u,!0)){if(u.type=="bpmn"&&u.container){var o=i.activeTool.helper,w=o.width/r.width,b=o.height/r.height,k={x:r.offsetX,y:r.offsetY};i._raiseSizePropertyChange(r,o.width/r.width,o.height/r.height,!0);i.activeTool._undoObject=n.extend(!0,{},{node:u});u=n.extend(!0,u,{width:o.width,height:o.height,offsetX:o.offsetX,offsetY:o.offsetY,minWidth:o.width,minHeight:o.height});u.parent?(v=t.datavisualization.Diagram.ContainerHelper.updateparent(u,i),v?(u.minWidth=i.activeTool.helper.width,u.minHeight=i.activeTool.helper.height,t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0),this._updateLastSwimlanePhase(i,u)):t.datavisualization.Diagram.bpmnHelper.updateCanvas(u,i)):t.datavisualization.Diagram.bpmnHelper.updateCanvas(u,i);t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(u,1/w,1/b,k,i);i.activeTool._redoObject=n.extend(!0,{},{node:u})}else u.container&&(i._raiseSizePropertyChange(r,i.activeTool.helper.width/r.width,i.activeTool.helper.height/r.height,!0),i.activeTool._undoObject=n.extend(!0,{},{node:u}),i._comparePropertyValues(r,"minWidth",{minWidth:i.activeTool.helper.width},!0),i._comparePropertyValues(r,"offsetX",{offsetX:r.offsetX+i.activeTool.helper.width/2},!0),u.minWidth=i.activeTool.helper.width<=100?100:i.activeTool.helper.width,i._comparePropertyValues(r,"minHeight",{minHeight:i.activeTool.helper.height},!0),i._comparePropertyValues(r,"offsetY",{offsetY:r.offsetY+i.activeTool.helper.height/2},!0),u.minHeight=i.activeTool.helper.height<=100?100:i.activeTool.helper.height,i.activeTool._redoObject=n.extend(!0,{},{node:u}));s={type:"sizechanged",node:jQuery.extend(!0,{},u),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"};i.addHistoryEntry(s);i.activeTool._multipleUndo=!0;u.isLane&&(this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0),c=u.width-i.activeTool._undoObject.node.width,l=u.height-i.activeTool._undoObject.node.height,y=i._preventDocking,p=i._disableSegmentChange,delete i._preventDocking,delete i._disableSegmentChange,this._updateOverlappedConnectorSegment(i,i.activeTool._undoObject.node,c,l),i._preventDocking=y,i._disableSegmentChange=p,this._updateConnectorSegments(i,u,c,l),this._enableConnectorUpdateLane(i,u))}}else u.isSwimlane?(h=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,u),h.length>0&&(f=i.nameTable[i._getChild(h[h.length-1])],f&&(i.activeTool._undoObject=n.extend(!0,{},{node:f}),i._raiseSizePropertyChange(u,i.activeTool.helper.width/u.width,i.activeTool.helper.height/u.height,!0),u.orientation==="vertical"?(e=f.width+i.activeTool.helper.width-u.width,i._comparePropertyValues(f,"minWidth",{minWidth:e},!0),i._comparePropertyValues(f,"offsetX",{offsetX:r.offsetX+e/2},!0),f.minWidth=e<=100?100:e):(e=f.height+i.activeTool.helper.height-u.height,e==f.minHeight?a=!1:(i._comparePropertyValues(f,"minHeight",{minHeight:e},!0),i._comparePropertyValues(f,"offsetY",{offsetY:r.offsetY+e/2},!0),f.minHeight=e<=100?100:e)),a&&(this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0),this._enableConnectorUpdateLane(i,u),i.activeTool._redoObject=n.extend(!0,{},{node:f}),s={type:"sizechanged",node:jQuery.extend(!0,{},u),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(s),i.activeTool._multipleUndo=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0),this._enableConnectorUpdateLane(i,u))))):u.container&&(u.minWidth=i.activeTool.helper.width,u.minHeight=i.activeTool.helper.height,t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0))},_updateOverlappedConnectorSegment:function(n,i,r,u){var y,p,w,l,e,o,a,s,f,v,h,c,b;if(i&&(r!=undefined&&u!=undefined&&(h=this._overLappedConnectros(n,i)),h&&h.length>0))for(c=t.datavisualization.Diagram.Util.bounds(i),i.orientation==="horizontal"?(y=c.bottomLeft,p=c.bottomRight):(y=c.topRight,p=c.bottomRight),w=[],l=0;l<h.length;l++)if(e=this._lineSegmentsIntersect(n,i,h[l],{start:y,end:p}),e&&e.length>0)for(o=0;o<e.length;o++)a=Object.keys(e[o])[0],s=e[o][a].index,b=e[o][a].point,f=n.nameTable[n._getChild(a)],f&&f.segments&&f.segments.length>0&&(i.orientation==="horizontal"?(f.segments[s]&&(v=f.segments[s].length),v&&(f.segments[s].length+=u)):(v=f.segments[s].length,v&&(f.segments[s].length+=r)),this._updateConnectorEndPoints(n,f))},_lineSegmentsIntersect:function(n,t,i,r){var c,l,y,p,o,u,f,e,s,w,b,k,d,a,v,g,h;if(c=r.start.x,l=r.start.y,y=r.end.x,p=r.end.y,v=[],g=t&&t.orientation?t.orientation:"horizontal",i=n.nameTable[n._getChild(i)],i&&i.segments&&i.segments.length>0&&i.segments.length!==1)for(o=0;o<i.segments.length;o++)if(u=i.segments[o],u&&u.points.length>0)for(f=0;f<u.points.length-1;f++)e=u.points[f],s=u.points[f+1],e&&s&&(w=e.x,b=e.y,k=s.x,d=s.y,this._isInterSecting(c,l,y,p,w,b,k,d)&&(a={},h=f,g==="horizontal"?e.y>l&&(h=-1):e.x>c&&(h=-1),a[i.name]={index:o,point:h},v.push(a)));return v},_isInterSecting:function(n,t,i,r,u,f,e,o,s){var l=i-n,a=r-t,v=e-u,y=o-f,h=(-a*(n-u)+l*(t-f))/(-v*a+l*y),c=(+v*(t-f)-y*(n-u))/(-v*a+l*y);return s?h>0&&h<1&&c>0&&c<1:h>=0&&h<=1&&c>=0&&c<=1},_overLappedConnectros:function(n,t){var f=this._getSwimlane(n,t.name),o,i,e,r,u;if(f&&f.isSwimlane&&(o=this._getLaneIndex(f,t),i=n.nameTable[t.parent],e=[],i&&i.isLaneStack&&i&&i.children.length>0))for(r=o;r>=0;r--)u=n.nameTable[n._getChild(i.children[r])],u&&u.isLane&&this._laneConnectors(n,u,e);return e},_getUndoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._undoObject=n.extend(!0,{},{node:i,childTable:r})},_getRedoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._redoObject=n.extend(!0,{},{node:i,childTable:r})},_undoRemoveNodeFromContainer:function(n,i){var u,f,e,r;if(i.type!=="pseudoGroup"&&(u=n.nameTable[i.parent],u)){for(i.parent="",f=u.children,r=0;r<f.length;r++)e=n.nameTable[n._getChild(f[r])],e&&e.name===i.name&&(n.nodes().push(f[r]),t.datavisualization.Diagram.Util.removeChildFromGroup(u.children,f[r]));t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,u,!0)}},_undoAddNodeToContainer:function(i,r,u){var f,e,o,s;r&&r.type!=="pseudoGroup"&&(f=i.nameTable[u.parent],u.segments?r.sourceNode||r.targetNode||(o=t.datavisualization.Diagram.Util.bounds(r,!0),s=t.datavisualization.Diagram.Util.bounds(u,!0),t.datavisualization.Diagram.Util._translateLine(r,s.center.x-o.center.x,s.center.y-o.center.y)):i._translate(r,u.offsetX-r.offsetX,u.offsetY-r.offsetY,i.nameTable),f?(r.parent=f.name,f.children.push(r),t.datavisualization.Diagram.Util.removeItem(i.nodes(),r),e=i._svg.getElementById(f.name),f._isBpmn?(t.datavisualization.Diagram.bpmnHelper.resetNodeMargin(r,f,i),r=n.extend(!0,r,{marginLeft:u.marginLeft,marginRight:u.marginRight,marginTop:u.marginTop,marginBottom:u.marginBottom})):this._updateNodeMargin(i,r,f),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0)):(i._swimlaneOuterNodes||(i._swimlaneOuterNodes=[]),i._swimlaneOuterNodes.push(r)),r._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(r,i,e):r.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(r,i,e):t.datavisualization.Diagram.DiagramContext.renderNode(r,i,e))},_undoDragNode:function(t,i,r,u){if(r=n.extend(!0,{},r),i&&r&&i.type!=="pseudoGroup"){var e=n.extend(!0,{},r),f=n.extend(!0,{},i);u||(this._disableConnectorUpdate(t),t._disableSwimlaneUptate=!0);this._undoRemoveNodeFromContainer(t,i);this._undoAddNodeToContainer(t,i,r);u||delete t._disableSwimlaneUptate;t._clearSelection(!0);t._addSelection(i,!0);this._updateLastSwimlanePhase(t,i);u||(f.parent?(this._enableConnectorUpdateNode(t,f),i.parent&&i.parent!==f.parent&&(this._enableConnectorUpdateNode(t,i),this._updateLastSwimlanePhase(t,f))):this._enableConnectorUpdateNode(t,e));i.parent||this._updateAssociatedConnectorEnds(t,i,t.nameTable)}},_undoMultiDragNode:function(i,r){var e=n.extend(!0,{},r.node),l,p,o,c,a,v,f,h,u,y,s;if(e&&e.type==="pseudoGroup"){for(p=e.children,i._disableSwimlaneUptate=!0,u=0;u<p.length;u++)this._disableConnectorUpdate(i),o=i.nameTable[i._getChild(p[u])],c=o.parent,l=r.undo&&o?r.undoObject.childTable?r.undoObject.childTable[o.name]:null:r.redoObject.childTable?r.redoObject.childTable[o.name]:null,this._undoDragNode(i,o,l,!0),c||l.parent&&(c=l.parent),c?(a=i.nameTable[c],a&&a.isLane&&(v=i.nameTable[a.parent.split("laneStack")[0]],v&&(i._updateSwimlanes||(i._updateSwimlanes=[]),i._collectionContains(v.name,i._updateSwimlanes)||i._updateSwimlanes.push(v.name)))):(delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,o,i.nameTable)),delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,o,i.nameTable);if(delete i._disableSwimlaneUptate,i._updateSwimlanes&&i._updateSwimlanes.length>0)for(f=0;f<i._updateSwimlanes.length;f++)t.datavisualization.Diagram.DiagramContext.update(i.nameTable[i._updateSwimlanes[f]],i),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(i,i.nameTable[i._updateSwimlanes[f]]);if(i._swimlaneOuterNodes&&i._swimlaneOuterNodes.length>0){for(f=0;f<i._swimlaneOuterNodes.length;f++)if(h=i._swimlaneOuterNodes[f],h&&h.type!=="connector"){for(u=0,y=h.inEdges.length;u<y;u++)s=i.nameTable[h.inEdges[u]],s&&(i._dock(s,i.nameTable),t.datavisualization.Diagram.DiagramContext.update(s,i));for(u=0,y=h.outEdges.length;u<y;u++)s=i.nameTable[h.outEdges[u]],s&&(i._dock(s,i.nameTable),t.datavisualization.Diagram.DiagramContext.update(s,i))}delete i._swimlaneOuterNodes}delete i._updateSwimlanes;i._clearSelection(!0);t.datavisualization.Diagram.Util._updateGroupBounds(e,i);i._addSelection(e,!0);delete i.nameTable[e.name];i.nameTable[e.name]=e}},_updateAssociatedConnectorEnds:function(n,i,r){var f,o,u,c,e,h,s;if(n.getObjectType(i)!=="connector"&&(i.inEdges.length||i.outEdges.length)){for(c=n._isNodeToNodeConnection(i),e=i,i.type=="bpmn"&&i._type=="group"&&(e=typeof i.children[0]=="object"?i.children[0]:n.nameTable[i.children[0]]),c&&(h=t.datavisualization.Diagram.Util._findSegmentPoints(e)),s={},n._parentNode&&(s=n._getChildTable(n._parentNode,{})),f=0,o=i.inEdges.length;f<o;f++)u=r[i.inEdges[f]],!u||n._parentNode&&s[u.sourceNode]||(u.targetPadding?delete e._segmentPoints:e._segmentPoints=h,n._dock(u,r),t.datavisualization.Diagram.DiagramContext.update(u,n));for(f=0,o=i.outEdges.length;f<o;f++)u=r[i.outEdges[f]],!u||n._parentNode&&s[u.targetNode]||(u.sourcePadding?delete e._segmentPoints:e._segmentPoints=h,n._dock(u,r));delete e._segmentPoints}},_undoRemoveResizeNodeFromContainer:function(n,i){var r,f,e,u;if(i.type!=="pseudoGroup"&&(r=n.nameTable[i.parent],r)){for(i.parent="",f=r.children,u=0;u<f.length;u++)e=n.nameTable[n._getChild(f[u])],e&&e.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(r.children,f[u]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0)}},_undoAddResizeNodeToContainer:function(i,r,u){if(r.type!=="pseudoGroup"){var f=i.nameTable[u.parent],e;r.segments||(i._translate(r,u.offsetX-r.offsetX,u.offsetY-r.offsetY,i.nameTable),i.scale(r,u.width/r.width,u.height/r.height,t.datavisualization.Diagram.Point(r.offsetX,r.offsetY),i.nameTable),r._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(r,i),r.container&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,r,!0));f&&(r.parent=f.name,f.children.push(r.name),e=i._svg.getElementById(f.name),f._isBpmn?(t.datavisualization.Diagram.bpmnHelper.resetNodeMargin(r,f,i),r=n.extend(!0,r,{marginLeft:u.marginLeft,marginRight:u.marginRight,marginTop:u.marginTop,marginBottom:u.marginBottom})):this._updateNodeMargin(i,r,f),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0));r._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(r,i,e):r.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(r,i,e):t.datavisualization.Diagram.DiagramContext.renderNode(r,i,e)}},_undoResizeNode:function(t,i,r,u){r=n.extend(!0,{},r);i&&r&&i.type!=="pseudoGroup"&&(u||this._disableConnectorUpdate(t),this._undoRemoveResizeNodeFromContainer(t,i),this._undoAddResizeNodeToContainer(t,i,r),t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),u||this._enableConnectorUpdateNode(t,i))},_undoMultiResizeNode:function(i,r){var u=n.extend(!0,{},r.node),s,o,e,f;if(u&&u.type==="pseudoGroup"){for(o=u.children,e=0;e<o.length;e++)f=i.nameTable[i._getChild(o[e])],s=r.undo&&f?r.undoObject.childTable?r.undoObject.childTable[f.name]:null:r.redoObject.childTable?r.redoObject.childTable[f.name]:null,this._undoResizeNode(i,f,s);i._clearSelection(!0);t.datavisualization.Diagram.Util._updateGroupBounds(u,i);i._addSelection(u,!0);delete i.nameTable[u.name];i.nameTable[u.name]=u}},_undoResizeLane:function(i,r,u){var f=i.nameTable[r.name],o,e,s,h,c,l;f&&(u&&u.node&&u.node.isSwimlane?(o=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,u.node),o.length>0&&(e=i.nameTable[i._getChild(o[o.length-1])],e&&(r=u.undo?u.undoObject&&u.undoObject.node?u.undoObject.node:e:u.undoObject&&u.redoObject.node?u.redoObject.node:e,i._comparePropertyValues(e,"minWidth",{minWidth:r.minWidth}),e.minWidth=r.minWidth,i._comparePropertyValues(e,"minHeight",{minHeight:r.minHeight}),e.minHeight=r.minHeight,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0),this._enableConnectorUpdateLane(i,f)))):f.isLane&&(f.container&&(i.activeTool._undonode=n.extend(!0,{},{node:f}),i._comparePropertyValues(f,"minWidth",{minWidth:r.minWidth}),f.minWidth=r.minWidth,i._comparePropertyValues(f,"minHeight",{minHeight:r.minHeight}),f.minHeight=r.minHeight),this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0),s=f.width-i.activeTool._undonode.node.width,h=f.height-i.activeTool._undonode.node.height,c=i._preventDocking,l=i._disableSegmentChange,delete i._preventDocking,delete i._disableSegmentChange,this._updateOverlappedConnectorSegment(i,i.activeTool._undonode.node,s,h),i._preventDocking=c,i._disableSegmentChange=l,this._updateConnectorSegments(i,f,s,h),this._enableConnectorUpdateLane(i,f)))},_undoRemoveRotateNodeFromContainer:function(n,i){var r,f,e,u;if(i.type!=="pseudoGroup"&&(r=n.nameTable[i.parent],r)){for(i.parent="",f=r.children,u=0;u<f.length;u++)e=n.nameTable[n._getChild(f[u])],e&&e.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(r.children,f[u]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0)}},_undoAddRotateNodeToContainer:function(i,r,u){var f,e,o;r.type!=="pseudoGroup"&&(f=i.nameTable[u.parent],r.segments||(o=u.rotateAngle-r.rotateAngle,i._rotate(r,o,i.nameTable)),f&&(r.parent=f.name,f.children.push(r.name),e=i._svg.getElementById(f.name),f._isBpmn?(t.datavisualization.Diagram.bpmnHelper.resetNodeMargin(r,f,i),r=n.extend(!0,r,{marginLeft:u.marginLeft,marginRight:u.marginRight,marginTop:u.marginTop,marginBottom:u.marginBottom})):this._updateNodeMargin(i,r,f),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0)),r._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(r,i,e):r.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(r,i,e):t.datavisualization.Diagram.DiagramContext.renderNode(r,i,e))},_undoRotateNode:function(t,i,r,u){r=n.extend(!0,{},r);i&&r&&i.type!=="pseudoGroup"&&(u||this._disableConnectorUpdate(t),this._undoRemoveRotateNodeFromContainer(t,i),this._undoAddRotateNodeToContainer(t,i,r),t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),u||this._enableConnectorUpdateNode(t,i))},_undoMultiRotateNode:function(i,r){var u=n.extend(!0,{},r.node),o,s,e,f;if(u&&u.type==="pseudoGroup"){for(s=u.children,e=0;e<s.length;e++)f=i.nameTable[i._getChild(s[e])],o=r.undo&&f?r.undoObject.childTable?r.undoObject.childTable[f.name]:null:r.redoObject.childTable?r.redoObject.childTable[f.name]:null,this._undoRotateNode(i,f,o,!0);i._clearSelection(!0);u.rotateAngle=o.rotateAngle;t.datavisualization.Diagram.Util._updateGroupBounds(u,i);i._addSelection(u,!0);delete i.nameTable[u.name];i.nameTable[u.name]=u}},_undoSwap:function(n,i){var r,e,o,s;n.activeTool._removeHelpers();n._clearSelection(!0);var h=i.undo?i.insertIndex:i.moveIndex,u=n.nameTable[i.undoObject.name1],f=u&&u.parent?n.nameTable[u.parent]:null;f&&f.children.length>0&&(r=f.children);e=r.slice();o=this._getSwimlane(n,r[0]);r&&r.length>0&&(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(n),this._undoSwapLane(n,r,h,u,null),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f,!1),t.datavisualization.Diagram.canvasHelper._recreateConnectorSegments(n,u.name,e,i.undoObject.name2,i.undoObject.name1),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(n,u));s=this._getSwimlane(n,r[0]);n._comparePropertyValues(s,"lanes",{lanes:o.lanes})},_undoSwapLane:function(n,t,i,r){t&&t.length>0&&(t.splice(t.indexOf(r),1),t.splice(i,0,r))}};t.datavisualization.Diagram.containerCommon={_initGroupNode:function(n,i){var r=null,u;for(i=n._getNewGroup(i),u=0;u<i.children.length;u++)r=i.children[u],r&&typeof r=="object"&&(typeof r.shape!="object"&&(r=t.datavisualization.Diagram.NodeType(r,n)),r._type=="group"||r.children||r.segments||r.type=="connector"?r.segments||r.type=="connector"?(r=n._getNewConnector(r),r.name==""&&(r.name=t.datavisualization.Diagram.Util.randomId())):(r=n._getNewGroup(r),r.name==""&&(r.name=t.datavisualization.Diagram.Util.randomId()),r=this._initGroupNode(n,r)):(i.type!="bpmn"&&(r=n._getNewNode(r)),r.name==""&&(r.name=t.datavisualization.Diagram.Util.randomId()),r._type=="node"&&r.labels.length&&(r.width==0||r.height==0)&&n._getNodeDimension(r)),i.children[u]=r,r.parent=i.name);return i},_initChildren:function(n,i){var f,u,r;if(i.children&&i.children.length>0)for(f=i.children,u=0;u<f.length;u++)r=typeof f[u]=="string"?n.nameTable[f[u]]:f[u],r&&((!r._isInternalShape||r._isInternalShape&&r.type==="group")&&(r.container?r=t.datavisualization.Diagram.ContainerHelper._initContainer(n,r):r.children?(r=t.datavisualization.Diagram.Group(r),r=this._initGroupNode(n,f[u]),r=n._getNewGroup(f[u]),r=this._initChildren(n,f[u]),n._isLoad&&f[u].type!=="bpmn"&&this._updateGroupBounds(n,f[u])):r.segments?(r=t.datavisualization.Diagram.Connector(r),r=n._getNewConnector(r)):(r=t.datavisualization.Diagram.NodeType(r,n),r=n._getNewNode(r)),i.container&&r.type==="bpmn"&&i.shape!=="group"&&n._translate(r,0-r.offsetX,0-r.offsetY,n.nameTable)),n.nameTable[r.name]=r,i.children[u]=r,n._spatialSearch&&n._updateQuad(r));return i},_getChildrenBounds:function(n,i){var u=i.children,f,e=t.datavisualization.Diagram.Rectangle(),r,o,s;for(u.length>0&&(r=n.nameTable[n._getChild(u[0])],r&&(e=t.datavisualization.Diagram.Util._rotateChildBounds(r,i,n))),o=0,s=u.length;o<s;o++)r=n.nameTable[n._getChild(u[o])],r&&(r._type==="group"?(t.datavisualization.Diagram.Util._updateGroupBounds(r,n),f=t.datavisualization.Diagram.Util._rotateChildBounds(r,i,n)):f=t.datavisualization.Diagram.Util._rotateChildBounds(r,i,n)),f&&(e=t.datavisualization.Diagram.Geometry.union(e,f));return e},_updateGroupBounds:function(n,i,r){var o,s,h,c,e;if(i&&!i.container&&i&&(i.type==="pseudoGroup"||i.children&&i.children.length>0)){o=i.width;s=i.height;h=i.offsetX;c=i.offsetY;r&&t.datavisualization.Diagram.Util._updateRotateAngle(i,n.nameTable);var u=this._getChildrenBounds(n,i),l=u.x+u.width*i.pivot.x,a=u.y+u.height*i.pivot.y,f={x:l,y:a};i.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle),f=t.Matrix.transform(e,f));u&&(i.offsetX=f.x,i.offsetY=f.y,i.width=u.width,i.height=u.height)}},_cloneObject:function(t,i,r){var u,f;if(i){if(u=n.extend(!0,{},i),u.children&&u.children.length>0)for(f=0;f<u.children.length;f++)u.children[f]=this._cloneObject(t,u.children[f],r);u.name+=r}return u},_removeObject:function(n,t){var i;if(t){if(typeof t=="string"&&(t=n.nameTable[t]),t&&t.children&&t.children.length>0)for(i=0;i<t.children.length;i++)this._removeObject(n,t.children[i]);t&&delete n.nameTable[t.name]}}}})(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejRuler","ej.datavisualization.ejRuler",{element:null,validTags:["div"],model:null,defaults:{offset:0,orientation:"horizontal",scale:1,interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25},_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this._wireEvents(),this._renderRuler())},_renderRuler:function(){this._updateRulerGeometry()},_updateRulerGeometry:function(){var t=this.model.length;t||(t=this.orientation==="horizontal"?n(this.element[0]).width():n(this.element[0]).height());this.element[0].style.height=(this.model.orientation==="horizontal"?this.model.thickness:t)+"px";this.element[0].style.width=(this.model.orientation==="horizontal"?t:this.model.thickness)+"px";this.element[0].style.textAlign="left";this._renderRulerSpace();this._updateRuler()},_renderRulerSpace:function(){var t=this._getRulerGeometry(),n=document.getElementById(this.element[0].id+"_ruler_space");return n||(n=document.createElement("div"),n.setAttribute("id",this.element[0].id+"_ruler_space"),n.setAttribute("class","ej-ruler-space"),n.style.height=t.height+"px",n.style.width=t.width+"px",n.style.float="left",this.element[0].appendChild(n)),n},_updateRuler:function(){var i=this._getRulerSize(),e=this._getRulerGeometry(),n=0,r=0,u=this._getRulerSVG(e),f,t;u&&(n=this.model.length,{}.height=i,r=this.model.offset,n&&n!=Infinity&&(f=n+this.model.segmentWidth,t=r,this._updateSegments(t,f+Math.abs(t),u,i)))},_updateSegments:function(n,t,i,r){for(var u=n,e={trans:0},f;u<t;)f=this._getNewSegment(u,i),f&&(i.document.appendChild(f.segment),u=this._updateSegment(n,t,f,u,e,i,r))},_updateSegment:function(n,t,i,r,u,f,e){var o=this._updateSegmentWidth(this.model.scale);return r==n?(this.model.startValue=Math.floor(n/o)*o/this.model.scale,this.model.startValue=this.model.startValue%1!=0?Number(this.model.startValue.toFixed(1)):this.model.startValue,i.label.textContent=this.model.startValue,this._starValue=r=this.model.startValue*this.model.scale,this.model.orientation==="horizontal"?this._hRulerDiff=n-r:this._vRulerDiff=n-r):r>t||r>t||(this.model.startValue=r/this.model.scale,this.model.startValue=this.model.startValue%1!=0?Number(this.model.startValue.toFixed(1)):this.model.startValue,i.label.textContent=this.model.startValue),this._updateTickLabel(i,e),this.model.orientation==="horizontal"?i.segment.setAttribute("transform","translate("+u.trans+" 0)"):i.segment.setAttribute("transform","translate(0 "+u.trans+")"),u.trans+=o,r+o},_updateTickLabel:function(n,i){var u,r;this.model.orientation==="horizontal"?u=this.model.tickAlignment==="rightorbottom"?{x:2,y:i/2+11/2-11/2}:{x:2,y:i/2+11/2}:(r=n.segment.lastChild.getBBox(),u=this.model.tickAlignment==="rightorbottom"?{x:0,y:r.height,"font-size":"11",transform:"rotate(270)translate("+-(r.width+2)+" "+(i/2-r.height)+")"}:{x:0,y:r.height,"font-size":"11",transform:"rotate(270)translate("+-(r.width+2)+" "+(i/2-r.height/2)+")"});t.datavisualization.Diagram.Util.attr(n.segment.lastChild,u)},_getNewSegment:function(n,t){var i=this._createNewTicks(n,t),r=this._createTickLabel(t,i);return{segment:i,label:r}},_createNewTicks:function(n,t){for(var r,u,e=this._updateSegmentWidth(this.model.scale),f=t.g({"class":"ej-ruler-segment"}),i=0;i<this.model.interval;i++)u=e/this.model.interval,r=this._createTick(t,u,i+1,n),f.appendChild(r);return f},_getLinePoint:function(n,t,i){var u=this._updateSegmentWidth(this.model.scale),r=this._getRulerSize(),i;return t=t*(i-1),t%u==0?r:r*.3},_createTick:function(i,r,u,f){var y,i,l,o=this._getLinePoint(i,r,u),e=this._getRulerSize(),v,a,s=this.model.arrangeTick,h,c;return typeof s=="string"&&(s=t.util.getObject(s,window)),n.isFunction(s)&&(v={ruler:y,tickLength:o,tickInterval:Number((f+r*(u-1)).toFixed(1))},s(v),o=v.tickLength),this.model.orientation==="horizontal"?(h=r*(u-1),a=this.model.tickAlignment==="rightorbottom"?{x1:h,y1:e,x2:h,y2:e-o,"stroke-width":"1"}:{x1:h,y1:e-(e-o),x2:h,y2:0,"stroke-width":"1"},l=i.line(a)):(c=r*(u-1),a=this.model.tickAlignment==="rightorbottom"?{x1:e,y1:c,x2:e-o,y2:c,"stroke-width":"1"}:{x1:0,y1:c,x2:e-(e-o),y2:c,"stroke-width":"1"},l=i.line(a)),l.setAttribute("class","ej-ruler-tick"),l},_createTickLabel:function(n,t){if(t){var i=n.text({"class":"ej-ruler-tick-label"});t.appendChild(i)}return i},_updateSegmentWidth:function(n){if(this.model.segmentWidth!=100)return this.model.segmentWidth;var i=25,r=1,t,u,f=100;for(u=Math.pow(2,Math.round(Math.log(n)/Math.log(2))),t=f,t=f/u;t>100;)r/=10,t/=10;while(t<25)r*=10,t*=10;return t>=i&&t%i!=0&&(t=Math.round(t/i)*i),t*n/r},_getRulerGeometry:function(){return{width:n(this.element[0]).width(),height:n(this.element[0]).height()}},_getRulerSize:function(){return this.model.thickness},_getRulerSVG:function(n){var i,r,f=this._getRulerSize(),u;if(i=document.getElementById(this.element[0].id+"_ruler_space"),i){if(u=new t.datavisualization.Diagram.Svg({id:this.element[0].id+"_Ruler_svg",width:this.model.orientation==="horizontal"?n.width:f,height:this.model.orientation==="horizontal"?f:n.height,style:"position:inherit;"}),i.childNodes.length>0)for(r=i.childNodes.length-1;r>=0;r--)i.childNodes[r].parentNode.removeChild(i.childNodes[r]);i.appendChild(u.document)}return u},_setModel:function(n){for(var t in n)switch(t){case"offset":case"length":case"interval":case"segmentWidth":case"tickAlignment":case"markerColor":case"thickness":this._updateRuler();break;case"arrangeTick":this._updateRuler();this.model.arrangeTick=n.arrangeTick}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){}})}(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejOverview","ej.datavisualization.Overview",{element:null,validTags:["div"],model:null,defaults:{sourceID:"",width:null,height:null},_canvas:null,_actionName:"",_startPoint:null,_currentPoint:null,_prevPoint:null,_helper:null,_viewPortRatio:1,_resizeDirection:"",_inAction:!1,_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this._wireEvents(),this._renderCanvas(),this._setParent(this.model.sourceID))},_renderCanvas:function(){var t=n("#"+this.element[0].id+"_canvas")[0];t||(t=document.createElement("div"),this.element.append(t));t.setAttribute("id",this.element[0].id+"_canvas");t.setAttribute("class","drawing");t.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";style:-ms-touch-action: none;touch-action: none;");this.element[0].setAttribute("tabindex","0");this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this._canvas=t},_renderDocument:function(i){var o,r,h,c;if(i.canvas=this._canvas,window.SVGSVGElement){r=n("#"+this._canvas.id+"_svg")[0];r&&r.parentNode.removeChild(r);o={id:this._canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:i.style,"class":"overview_svg"};r=new t.datavisualization.Diagram.Svg(o);this._svg=r;i.svg=r;var l=document.getElementById(this._id),e=l,u=n(e).width(),f=n(e).height(),s=e.getBoundingClientRect(),a=window.screenX<0?window.screenX*-1:window.screenX;u===0&&(u=Math.floor(window.innerWidth-a-Math.floor(s.left)));h=window.screenY<0?window.screenY*-1:window.screenY;f===0&&(f=Math.floor(window.innerHeight-h-Math.floor(s.top)));r.document.setAttribute("width",u);r.document.setAttribute("height",f);this.width=u;this.height=f;i.diagramLayer=t.datavisualization.Diagram.SvgContext._renderDiagramLayer(i.canvas,i.svg,i.svg);c=r.defs({id:i.canvas.id+"patterndefinition"});r.appendChild(c);i.canvas.appendChild(r.document);r._htmlLayer=this._renderHtmlLayer(i.canvas);this._addOverviewRectPanel(i)}},_removeDocument:function(){var t=document.getElementById(this._canvas.id+"_svg"),n;this._canvas.removeChild(t);n=document.getElementById(this._canvas.id+"_htmlLayer");this._canvas.removeChild(n)},_renderHtmlLayer:function(n){var i=document.createElement("div"),u={id:n.id+"_htmlLayer","class":"htmlLayer"},r;return t.datavisualization.Diagram.Util.attr(i,u),r=i,i.style.pointerEvents="none",i.style.position="absolute",i.style.left="0px",i.style.top="0px",n.appendChild(r),r},_setModel:function(n){var t=!1;for(var i in n)switch(i){case"sourceID":this._setParent(n[i]);break;case"width":case"height":t||(this._renderCanvas(),this._setParent(this.model.sourceID));t=!0}},_setParent:function(t){if(this._parent){var i=n("#"+this._parent._id).ejDiagram("instance");this._parent=null;i._setOverview(null,this._id)}t&&(this.model.sourceID=t,this._parent=n("#"+t).ejDiagram("instance"),this._parent&&this._parent._setOverview(this))},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){var i=n(this._canvas);this._on(i,t.eventType.mouseDown,this._mousedown);this._on(i,t.eventType.mouseMove,this._mousemove);this._on(i,t.eventType.mouseUp,this._mouseup);this._on(i,t.eventType.mouseLeave,this._documentmouseup);this._on(i,"touchstart",this.handleTouchStart);this._on(i,"touchmove",this.handleTouchMove);this._on(i,"touchend",this.handleTouchEnd)},_mouseup:function(n){var f,e,t,u;if(this._currentPoint=this._mouseposition(n),f=this.width,e=this.height,this._actionName)if(this._startPoint.x!=this._currentPoint.x||this._startPoint.y!=this._currentPoint.y){if(this._actionName!="pan"&&this._helper){t=this._helper.getBBox();this._resizeDirection=this._resizeDirection||"";var o=t.x,s=t.y,i=t.width,r=t.height,h=this._resizeDirection=="topleft"||this._resizeDirection=="topright"||this._resizeDirection=="bottomleft"||this._resizeDirection=="bottomright";this._renderOverviewRect(o,s,i,r)}}else if((n.target.id==this._canvas.id+"overviewbackrect"||n.target.id=="helper")&&this._startPoint.x==this._currentPoint.x&&this._startPoint.y==this._currentPoint.y){var u=document.getElementById(this._canvas.id+"overviewrect"),t=u.getBBox(),i=t.width||100,r=t.height||100/this._viewPortRatio;this.inAction=!0;this._actionName="pan";this._renderOverviewRect(this._currentPoint.x-i/2,this._currentPoint.y-r/2,i,r);this.inAction=!1}this._helper&&(u=document.getElementById(this._canvas.id+"overviewhandle"),u.removeChild(this._helper),this._helper=null);this._actionName="";this._startPoint=null;this._currentPoint=null;this._prevPoint=null;this._helper=null;this._viewPortRatio=1;this._resizeDirection="";this._inAction=!1},_mousedown:function(n){if(n.target.className.animVal=="overviewbackrect"&&(this._actionName="draw"),n.target.id==this._canvas.id+"overviewrect"&&(this._actionName="pan"),n.target.className.animVal=="overviewresizer"){this._actionName="scale";switch(n.target.id){case this._canvas.id+"left":this._resizeDirection="left";break;case this._canvas.id+"right":this._resizeDirection="right";break;case this._canvas.id+"top":this._resizeDirection="top";break;case this._canvas.id+"bottom":this._resizeDirection="bottom";break;case this._canvas.id+"topleft":this._resizeDirection="topleft";break;case this._canvas.id+"topright":this._resizeDirection="topright";break;case this._canvas.id+"bottomleft":this._resizeDirection="bottomleft";break;case this._canvas.id+"bottomright":this._resizeDirection="bottomright"}}this._startPoint=this._prevPoint=this._mouseposition(n);var i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent);this._viewPortRatio=i.width/i.height},_mouseposition:function(n){var i=this._parent._isTouchEvent(n);i||(i=n);var u=this._canvas.scrollLeft,f=this._canvas.scrollTop,r=this._canvas.getBoundingClientRect(),e=i.clientX+u-r.left,o=f+i.clientY-r.top;return new t.datavisualization.Diagram.Point(e,o)},_updateCursor:function(n){if(n.target.className.animVal=="overviewresizer")switch(n.target.id){case this._canvas.id+"left":this._canvas.style.cursor="w-resize";break;case this._canvas.id+"right":this._canvas.style.cursor="e-resize";break;case this._canvas.id+"top":this._canvas.style.cursor="n-resize";break;case this._canvas.id+"bottom":this._canvas.style.cursor="s-resize";break;case this._canvas.id+"topleft":this._canvas.style.cursor="nw-resize";break;case this._canvas.id+"topright":this._canvas.style.cursor="ne-resize";break;case this._canvas.id+"bottomleft":this._canvas.style.cursor="sw-resize";break;case this._canvas.id+"bottomright":this._canvas.style.cursor="se-resize"}else this._canvas.style.cursor="default"},_mousemove:function(n){if(this._updateCursor(n),this._currentPoint=this._mouseposition(n),this._actionName)switch(this._actionName){case"draw":this._inAction||this._startPoint.x==this._currentPoint.x&&this._startPoint.y!=this._currentPoint.y||(this._initHelper(),this._inAction=!0);this._inAction&&this._updateHelper();break;case"scale":this._inAction||(this._initHelper(),this._inAction=!0);this._updateOverviewRectangle();break;case"pan":(this._startPoint.x!=this._currentPoint.x||this._startPoint.y==this._currentPoint.y||this._inAction)&&(this._inAction=!0,this._translateOverviewRectangle())}this._prevPoint=this._currentPoint},_documentmouseup:function(){if(this._inAction=!1,this._actionName="",this._helper){var n=document.getElementById(this._canvas.id+"overviewhandle");n.removeChild(this._helper);this._helper=null}},_addOverviewRectPanel:function(){var r=n("#"+this._canvas.id+"_overviewsvg")[0],f,e,u,i,o;r&&r.parentNode.removeChild(r);r=new t.datavisualization.Diagram.Svg({id:this._canvas.id+"_overviewsvg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute;left:0px;top:0px",width:this.width,height:this.height});this._canvas.appendChild(r.document);f=r.g({id:this._id+"_overviewlayer"});r.appendChild(f);e=r.rect({fill:"transparent",width:"100%",height:"100%","class":"overviewbackrect",id:this._canvas.id+"overviewbackrect"});f.appendChild(e);u=n(f);this._on(u,t.eventType.mouseDown,this._mousedown);this._on(u,t.eventType.mouseMove,this._mousemove);this._on(u,t.eventType.mouseUp,this._mouseup);this._on(u,t.eventType.mouseLeave,this._documentmouseup);this._on(u,"touchstart",this.handleTouchStart);this._on(u,"touchmove",this.handleTouchMove);this._on(u,"touchend",this.handleTouchEnd);i=r.g({id:this._canvas.id+"overviewhandle"});f.appendChild(i);o=r.rect({id:this._canvas.id+"overviewrect",fill:"transparent"});i.appendChild(o);this._renderOverviewCorner("left",i);this._renderOverviewCorner("right",i);this._renderOverviewCorner("top",i);this._renderOverviewCorner("bottom",i);this._renderOverviewCorner("topleft",i);this._renderOverviewCorner("topright",i);this._renderOverviewCorner("bottomleft",i);this._renderOverviewCorner("bottomright",i)},_updateOverview:function(n){var c,l,i,f,e,v,r,u,y,h;n=n||this._parent._views[this._id];i=this._parent._getDigramBounds();c=i.width;l=i.height;var a=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),o=this.width,s=this.height;n.context==t.datavisualization.Diagram.SvgContext?(f=Math.max(c,a.width),e=Math.max(l,a.height),this.contentWidth=f=Math.max(f,o/s*e),this.contentHeight=e=Math.max(e,s/o*f),v=document.getElementById(this._canvas.id+"_diagramLayer"),r=Math.min(o/f,s/e),this.scale=r,v.setAttribute("transform","scale("+r+","+r+"),translate("+-i.x+","+-i.y+")"),u=document.getElementById(this._canvas.id+"_htmlLayer"),u.style.webkitTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.MozTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.OTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.msTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.transform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",y=document.getElementById(this._id+"_overviewlayer"),y.setAttribute("transform","translate("+-i.x*r+","+-i.y*r+")")):(h=n._canvas.document.getContext("2d"),n.scale&&h.scale(1/n.scale.x,1/n.scale.y),n.scale={x:r,y:r},h.scale(r,r),t.datavisualization.Diagram.CanvasContext.refreshCanvas(this._parent.model,n));this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom)},_updateOverviewRectangle:function(){var n=this._currentPoint.x-this._prevPoint.x,t=this._currentPoint.y-this._prevPoint.y;if(this._actionName=="scale"){var i={width:0,height:0},r=0,u=0,f,e;switch(this._resizeDirection){case"left":i.width-=n;i.height-=n/this._viewPortRatio;r=n;u=n/this._viewPortRatio/2;break;case"right":i.width+=n;i.height+=n/this._viewPortRatio;u=n/this._viewPortRatio/-2;break;case"top":i.height-=t;i.width-=t*this._viewPortRatio;u=t;r=t*this._viewPortRatio/2;break;case"bottom":i.height+=t;i.width+=t*this._viewPortRatio;r=t*this._viewPortRatio/-2;break;case"topleft":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width-=n;i.height-=t;r=n;u=t;break;case"topright":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-(n/this._viewPortRatio);u=t;i.width+=n;i.height-=t;break;case"bottomleft":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-n/this._viewPortRatio;r=n;i.width-=n;i.height+=t;break;case"bottomright":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width+=n;i.height+=t}this._updateHelper(r,u,i,f,e)}},_initHelper:function(){var e,n,t;if(!this._helper){var o=this._svg,s=document.getElementById(this._canvas.id+"overviewhandle"),h=this._parent._currZoom,i=this._startPoint.x,r=this._startPoint.y,u=1,f=1;this._actionName=="scale"&&(e=document.getElementById(this._canvas.id+"overviewrect"),n=e.getBBox(),i=n.x,r=n.y,u=n.width,f=n.height);t=o.rect({id:"helper",x:i,y:r,width:u,height:f,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"});s.appendChild(t);this._helper=t}},_updateHelper:function(n,i,r){var n,i,o,s;if(r)var u=this._helper.getBBox(),h=u.x+n,c=u.y+i,f=u.width+r.width,e=u.height+r.height;else{n=this._currentPoint.x>this._startPoint.x?this._currentPoint.x-this._prevPoint.x:this._prevPoint.x-this._currentPoint.x;i=this._currentPoint.y>this._startPoint.y?this._currentPoint.y-this._prevPoint.y:this._prevPoint.y-this._currentPoint.y;Math.abs(i)>Math.abs(n)?(n=this._viewPortRatio*i,s=!0,o=!1):(i=n/this._viewPortRatio,o=!0,s=!1);var u=this._helper.getBBox(),h=this._startPoint.x>this._currentPoint.x?u.x-n:u.x,c=this._startPoint.y>this._currentPoint.y?u.y-i:u.y,f=u.width+n,e=u.height+i}this._helper&&t.datavisualization.Diagram.Util.attr(this._helper,{id:this._helper.id,x:h,y:c,width:f<0?0:f,height:e<0?0:e})},_renderOverviewCorner:function(n,t){var i=this._svg,r,u;n=="top"||n=="bottom"||n=="right"||n=="left"?(r=i.rect({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.rect({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u)):(r=i.circle({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.circle({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u))},_updateOverviewrect:function(n,i,r,u){if(r&&u){var f=document.getElementById(this._canvas.id+"overviewrect"),e={x:n,y:i,width:Math.max(1,r),height:Math.max(1,u)};t.datavisualization.Diagram.Util.attr(f,e);this._updateOverviewCorner("top",n+8,i-2,Math.max(0,r-16),2);this._updateOverviewCorner("bottom",n+8,i+u,Math.max(0,r-16),2);this._updateOverviewCorner("left",n-2,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("right",n+r,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("topleft",n,i,5,5);this._updateOverviewCorner("topright",n+r,i,5,5);this._updateOverviewCorner("bottomleft",n,i+u,5,5);this._updateOverviewCorner("bottomright",n+r,i+u,5,5)}},_scrollOverviewRect:function(n,i,r,u){if(!this._actionName||u){var a=this.width,v=this.height,f=Math.min(this.contentWidth/a,this.contentHeight/v),e={},s=e.x=n/r/f,h=e.y=i/r/f,o=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),c=e.width=o.width/r/f,l=e.height=o.height/r/f,y=o.width/o.height;if(u)return{x:s,y:h,width:c,height:l};this._updateOverviewrect(s,h,c,l)}},_updateOverviewCorner:function(n,i,r,u,f){var h="visible"+n,c=document.getElementById(this._canvas.id+h),e,o,s;n=="top"||n=="bottom"||n=="right"||n=="left"?(e={x:i,y:r,width:u,height:f,fill:"#ED1C24"},o={x:i-2,y:r-2,width:u==2?4:u,height:f==2?4:f}):(e={cx:i,cy:r,r:4,fill:"#ED1C24"},o={cx:i,cy:r,r:6,fill:"transparent"});t.datavisualization.Diagram.Util.attr(c,e);s=document.getElementById(this._canvas.id+n);t.datavisualization.Diagram.Util.attr(s,o)},_translateOverviewRectangle:function(){var o=this.width,s=this.height,h=this._currentPoint.x-this._prevPoint.x,c=this._currentPoint.y-this._prevPoint.y,i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),a=Math.min(i.width/o,i.height/s),l=document.getElementById(this._canvas.id+"overviewrect"),n=l.getBBox(),r=n.x+h,u=n.y+c,f=n.width,e=n.height;this._updateOverviewrect(r,u,f,e);this._updateView(this._parent._currZoom,r,u,f,e,null)},_updateView:function(i,r,u,f,e,o){var b=this.width,k=this.height,d=this.contentWidth/b,g=this.contentHeight/k,y=r*d*i,p=u*g*i,h=this._parent._getDigramBounds(),v,s;if(i!=1||this._actionName=="pan"){var a=n("#"+this._parent._canvas.id+"_hScrollbar").ejScrollBar("instance").model,w=-y+a.maximum,c=-y+this._parent._hScrollOffset,l=-p+this._parent._vScrollOffset;h.width*i<w&&(s=h.width*i-w,Math.abs(s)<Math.abs(c)&&(c=c-s));a=n("#"+this._parent._canvas.id+"_vScrollbar").ejScrollBar("instance").model;v=-p+a.maximum;h.height*i<v&&(s=h.height*i-v,Math.abs(s)<Math.abs(l)&&(l=l-s))}t.datavisualization.Diagram.ZoomUtil.zoomPan(this._parent,i/this._parent._currZoom,c,l,o,!1)},_renderOverviewRect:function(n,i,r,u){var s=this.width,h=this.height,o=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),c=r/s*this.contentWidth,l=u/h*this.contentHeight,e=Math.max(o.width/c,o.height/l),f;e>=.25&&e<=30&&(this._updateView(e,n,i,r,u,new t.datavisualization.Diagram.Point(0,0)),f=this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom,!0),this._updateOverviewrect(f.x,f.y,f.width,f.height))},handleTouchStart:function(n){n.preventDefault()},handleTouchMove:function(n){n.preventDefault()},handleTouchEnd:function(n){n.preventDefault()},handleTouchLeave:function(n){n.preventDefault()}})}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function i(n){return this.document=document.createElement("canvas"),this.id=n.id,this._scaleX=1,this._scaleY=1,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return i.prototype.rect=function(n,t,i,r,u,f){var e=this.document.getContext("2d");e.beginPath();u&&u.angle&&this.rotateContext(u,e);f&&(this.setStyle(f,e),f.dashArray&&this.dashedRectangle(n,t,i,r,f.dashArray));e.fillRect(n,t,i,r);e.strokeRect(n,t,i,r);e.closePath();u&&u.angle&&e.restore()},i.prototype.roundedRect=function(n,t,i,r,u,f,e){var h=this.document.getContext("2d"),o;h.beginPath();f&&f.angle&&this.rotateContext(f,h);var s=[{x:n+u,y:t},{x:n+i-u,y:t},{x:n+i,y:t+u},{x:n+i,y:t+r-u},{x:n+i-u,y:t+r},{x:n+u,y:t+r},{x:n,y:t+r-u},{x:n,y:t+u}],l=[{x:n+i,y:t},{x:n+i,y:t+r},{x:n,y:t+r},{x:n,y:t}],c=0,a,v;for(e&&this.setStyle(e,h),h.moveTo(s[0].x,s[0].y),o=0;o<s.length;o=o+2)a=s[o+1],h.lineTo(a.x,a.y),v=s[o+2]||s[0],h.quadraticCurveTo(l[c].x,l[c].y,v.x,v.y),c++;if(h.fill(),e&&e.dashArray)for(c=0,o=0;o<s.length;o=o+2)this.dashedLine(s[o].x,s[o].y,s[o+1].x,s[o+1].y,e.dashArray),this.quadraticCurve(s[o+1],l[c],s[o+2]||s[0],e),c++;h.stroke();h.closePath();f&&f.angle&&h.restore()},i.prototype.ellipse=function(n,i,r,u,f,e){var s=this.document.getContext("2d"),o;e&&this.setStyle(e,s);o=4*((Math.sqrt(2)-1)/3);s.beginPath();f&&f.angle&&this.rotateContext(f,s);s.moveTo(n,i-u);s.bezierCurveTo(n+o*r,i-u,n+r,i-o*u,n+r,i);s.bezierCurveTo(n+r,i+o*u,n+o*r,i+u,n,i+u);s.bezierCurveTo(n-o*r,i+u,n-r,i+o*u,n-r,i);s.bezierCurveTo(n-r,i-o*u,n-o*r,i-u,n,i-u);s.fill();e&&e.dashArray&&(this.bezierCurve(t.datavisualization.Diagram.Point(n,i-u),new t.datavisualization.Diagram.Point(n+o*r,i-u),new t.datavisualization.Diagram.Point(n+r,i-o*u),new t.datavisualization.Diagram.Point(n+r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n+r,i),new t.datavisualization.Diagram.Point(n+r,i+o*u),new t.datavisualization.Diagram.Point(n+o*r,i+u),new t.datavisualization.Diagram.Point(n,i+u),e),this.bezierCurve(t.datavisualization.Diagram.Point(n,i+u),new t.datavisualization.Diagram.Point(n-o*r,i+u),new t.datavisualization.Diagram.Point(n-r,i+o*u),new t.datavisualization.Diagram.Point(n-r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n-r,i),new t.datavisualization.Diagram.Point(n-r,i-o*u),new t.datavisualization.Diagram.Point(n-o*r,i-u),new t.datavisualization.Diagram.Point(n,i-u),e));s.stroke();s.closePath();f&&f.angle&&s.restore()},i.prototype.circle=function(n,t,i,r,u){var f=this.document.getContext("2d");u&&this.setStyle(u,f);r&&r.angle&&this.rotateContext(r,f);u&&u.dashArray?(f.beginPath(),f.arc(n,t,i,0,2*Math.PI),f.fill(),f.stroke(),f.closePath()):this.ellipse(n,t,i*2,i*2,r,u);r&&r.angle&&f.restore()},i.prototype.arc=function(n,t,i,r,u,f){var o={angle:r,x:n,y:t},e=this.document.getContext("2d"),s,h;f&&this.setStyle(f,e);o&&o.angle&&this.rotateContext(o,e);e.beginPath();s=0;h=Math.PI;u||(s=Math.PI,h=0);f&&f.dashArray?e.arc(n,t,i,s,h):e.arc(n,t,i,s,h);e.stroke();e.closePath();o&&o.angle&&e.restore()},i.prototype.path=function(n,i,r,u,f,e,o){var h=this.document.getContext("2d"),pt,tt,it,s,wt,g;o&&this.setStyle(o,h);h.beginPath();pt=i;tt=r;h.translate(pt,tt);e&&e.angle&&this.rotateContext(e,h);it=document.createElementNS("http://www.w3.org/2000/svg","path");it.setAttribute("d",n);this.document.appendChild(it);for(var ti=this.getSegments(it),fi=i,ei=r,et,ot,k,d,st,ht,ct=ti,i=0,r=0,lt=0,ii=ct.length;lt<ii;++lt){s=ct[lt];wt=s.command;"x1"in s&&(k=s.x1);"x2"in s&&(st=s.x2);"y1"in s&&(d=s.y1);"y2"in s&&(ht=s.y2);"x"in s&&(i=s.x);"y"in s&&(r=s.y);switch(wt){case"M":h.moveTo(i,r);s.x=i;s.y=r;break;case"L":h.lineTo(i,r);s.x=i;s.y=r;break;case"C":h.bezierCurveTo(k,d,st,ht,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;s.x2=st;s.y2=ht;break;case"Q":h.quadraticCurveTo(k,d,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;break;case"A":var w=new t.datavisualization.Diagram.Point(et,ot),c=s.r1,l=s.r2,v=s.angle*(Math.PI/180),ri=s.largeArcFlag,rt=s.sweepFlag,b=new t.datavisualization.Diagram.Point(i,r),a=new t.datavisualization.Diagram.Point(Math.cos(v)*(w.x-b.x)/2+Math.sin(v)*(w.y-b.y)/2,-Math.sin(v)*(w.x-b.x)/2+Math.cos(v)*(w.y-b.y)/2),at=Math.pow(a.x,2)/Math.pow(c,2)+Math.pow(a.y,2)/Math.pow(l,2);at>1&&(c*=Math.sqrt(at),l*=Math.sqrt(at));g=(ri==rt?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(l,2)-Math.pow(c,2)*Math.pow(a.y,2)-Math.pow(l,2)*Math.pow(a.x,2))/(Math.pow(c,2)*Math.pow(a.y,2)+Math.pow(l,2)*Math.pow(a.x,2)));isNaN(g)&&(g=0);var y=new t.datavisualization.Diagram.Point(g*c*a.y/l,g*-l*a.x/c),p=new t.datavisualization.Diagram.Point((w.x+b.x)/2+Math.cos(v)*y.x-Math.sin(v)*y.y,(w.y+b.y)/2+Math.sin(v)*y.x+Math.cos(v)*y.y),bt=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))},ut=function(n,t){return(n[0]*t[0]+n[1]*t[1])/(bt(n)*bt(t))},kt=function(n,t){return(n[0]*t[1]<n[1]*t[0]?-1:1)*Math.acos(ut(n,t))},ft=kt([1,0],[(a.x-y.x)/c,(a.y-y.y)/l]),vt=[(a.x-y.x)/c,(a.y-y.y)/l],yt=[(-a.x-y.x)/c,(-a.y-y.y)/l],nt=kt(vt,yt);ut(vt,yt)<=-1&&(nt=Math.PI);ut(vt,yt)>=1&&(nt=0);var ui=1-rt?1:-1,dt=ft+ui*(nt/2),oi=new t.datavisualization.Diagram.Point(p.x+c*Math.cos(dt),p.y+l*Math.sin(dt));if(s.centp=p,s.xAxisRotation=v,s.rx=c,s.ry=l,s.a1=ft,s.ad=nt,s.sweepFlag=rt,h!=null){var ut=c>l?c:l,gt=c>l?1:c/l,ni=c>l?l/c:1;h.save();h.translate(p.x,p.y);h.rotate(v);h.scale(gt,ni);h.arc(0,0,ut,ft,ft+nt,1-rt);h.scale(1/gt,1/ni);h.rotate(-v);h.translate(-p.x,-p.y);h.restore()}break;case"Z":case"z":h.closePath();i=et;r=ot}et=i;ot=r}h.fill();o&&o.dashArray?this.drawDashedPath(ct,o):h.stroke();h.translate(-tt,-tt);e&&e.angle&&h.restore()},i.prototype.getSegments=function(i){for(var r,a,c,l,k,u,e,o,v,y,p,w,d,g,nt=t.datavisualization.Diagram.Util.convertPathToArray(i.getAttribute("d")),f=[],s=0,h=0,b=0,tt=nt.length;b<tt;++b){r=nt[b];a=r.pathSegTypeAsLetter;"x1"in r&&(v=r.x1);"x2"in r&&(p=r.x2);"y1"in r&&(y=r.y1);"y2"in r&&(w=r.y2);"x"in r&&(s=r.x);"y"in r&&(h=r.y);switch(a){case"M":f.push({command:"M",x:s,y:h});break;case"L":f.push({command:"L",x0:e,y0:o,x:s,y:h});break;case"H":f.push({command:"L",x0:e,y0:o,x:s,y:o});break;case"V":f.push({command:"L",x0:e,y0:o,x:e,y:h});break;case"C":f.push({command:"C",x0:e,y0:o,x1:v,y1:y,x2:p,y2:w,x:s,y:h});break;case"S":u&&(c=u.command=="C"||u.command=="S"?{x:u.x2,y:u.y2}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*e-c.x,2*o-c.y),f.push({command:"C",x0:e,y0:o,x1:l.x,y1:l.y,x2:p,y2:w,x:s,y:h}));break;case"Q":f.push({command:"Q",x0:e,y0:o,x1:v,y1:y,x:s,y:h});break;case"T":u&&(c=u.command=="Q"?{x:u.x1,y:u.y1}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*e-c.x,2*o-c.y),f.push({command:"Q",x0:e,y0:o,x1:l.x,y1:l.y,x:s,y:h}));break;case"A":k=n.extend(!0,{},r);k.command="A";f.push(k);break;case"Z":case"z":f.push({command:"L",x0:s,y0:h,x:d,y:g});s=e;h=o}u=f[f.length-1];(a==="M"||a==="m")&&(d=s,g=h);e=s;o=h}return f},i.prototype.drawDashedPath=function(n,i){for(var r,p,u,h,c,v,y,o,s,l,f=0,e=0,a=0,k=n.length;a<k;++a){r=n[a];p=r.command;"x1"in r&&(h=r.x1);"x2"in r&&(v=r.x2);"y1"in r&&(c=r.y1);"y2"in r&&(y=r.y2);"x"in r&&(f=r.x);"y"in r&&(e=r.y);switch(p){case"M":l={x:f,y:e};break;case"L":this.dashedLine(o,s,f,e,i.dashArray);break;case"H":this.dashedLine(o,s,f,s,i.dashArray);break;case"V":this.dashedLine(o,s,o,e,i.dashArray);break;case"C":this.bezierCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(f,e),i);break;case"Q":this.quadraticCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(f,e),i);break;case"A":if(u=this.document.getContext("2d"),u!=null){var d=r.rx>r.ry?r.rx:r.ry,w=r.rx>r.ry?1:r.rx/r.ry,b=r.rx>r.ry?r.ry/r.rx:1;u.save();u.translate(r.centp.x,r.centp.y);u.rotate(r.xAxisRotation);u.scale(w,b);this.dashedArc(d,0,0,r.a1,r.a1+r.ad,1-r.sweepFlag,i.dashArray);u.scale(1/w,1/b);u.rotate(-r.xAxisRotation);u.translate(-r.centp.x,-r.centp.y);u.restore()}break;case"Z":case"z":this.dashedLine(f,e,l.x,l.y,i.dashArray);f=o;e=s}o=f;s=e}},i.prototype.calculateCirclePoints=function(n,i,r,u,f,e){var h,o,s,c;for(u=u*180/Math.PI,f=f*180/Math.PI,h=2*Math.PI*n*(Math.abs(u-f)/360)*.7,o=Math.abs(u-f)/h,o=e?o*-1:o,s=0,c=[];s<h;)c.push(t.datavisualization.Diagram.Geometry.transform({x:i,y:r},u+o*s,n)),s++;return c},i.prototype.polygon=function(n,t,i){var u=this.document.getContext("2d"),r;for(u.beginPath(),t&&t.angle&&this.rotateContext(t,u),i&&this.setStyle(i,u),u.moveTo(n[0].x,n[0].y),r=1;r<n.length;r++)u.lineTo(n[r].x,n[r].y);if(u.lineTo(n[0].x,n[0].y),u.fill(),i&&i.dashArray){for(r=1;r<n.length;r++)this.line(n[r-1],n[r],i);this.line(n[r-1],n[0],i)}u.stroke();u.closePath();t&&t.angle&&u.restore()},i.prototype.image=function(n,t,i,r,u,f,e,o){var s=this.document.getContext("2d"),g,nt,w,b,rt;if(s.beginPath(),f&&f.angle&&this.rotateContext(f,s),e&&this.setStyle(e,s),r&&u){var l=n.width,a=n.height,h=r,c=u,v,y;if(o&&o.alignment!=="none")if(g=o.alignment.substr(1,3),nt=o.alignment.substr(5,3),o.scale==="slice"){w=function(){v=h;y=a*h/l};b=function(){v=l*c/a;y=c};h>c?(w(),c>y&&b()):h===c?l>a?b():w():(b(),h>v&&w());var tt=this.getSliceOffset(g,v,h,l),it=this.getSliceOffset(nt,y,c,a),p={sx:tt,sy:it,swidth:l-tt,sheight:a-it,dx:0,dy:0,dwidth:v-tt*(v/l),dheight:y-it*(y/a)},k=document.createElement("canvas");k.setAttribute("width",r);k.setAttribute("height",u);rt=k.getContext("2d");rt.drawImage(n,p.sx,p.sy,p.swidth,p.sheight,p.dx,p.dy,p.dwidth,p.dheight);s.drawImage(k,t,i,r,u)}else if(o.scale==="meet"){var d=a/l,ut=c/h,v=ut>d?h:c/d,y=ut>d?h*d:c;t+=this.getMeetOffset(g,v,h);i+=this.getMeetOffset(nt,y,c);s.drawImage(n,0,0,l,a,t,i,v,y)}else s.drawImage(n,t,i,r,u);else s.drawImage(n,t,i,r,u)}else s.drawImage(n,t,i);s.closePath();f&&f.angle&&s.restore()},i.prototype.getSliceOffset=function(n,t,i,r){switch(n){case"min":return 0;case"mid":return(t-i)/2*r/t;case"max":return(t-i)*r/t;default:return"invalid"}},i.prototype.getMeetOffset=function(n,t,i){var r=Math.max(t,i),u=Math.min(t,i);switch(n){case"min":return 0;case"mid":return(r-u)/2;case"max":return r-u;default:return"invalid"}},i.prototype.text=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();r&&r.angle&&this.rotateContext(r,f);u&&this.setStyle(u,f);f.fillText(n.text,t,i);f.closePath();r&&r.angle&&f.restore()},i.prototype.line=function(n,t,i,r,u){var f=this.document.getContext("2d");r||(f.beginPath(),i&&this.setStyle(i,f));i&&i.dashArray?this.dashedLine(n.x,n.y,t.x,t.y,i.dashArray):(r||f.moveTo(n.x,n.y),f.lineTo(t.x,t.y),f.stroke());u||f.closePath()},i.prototype.polyline=function(n,t){var r=this.document.getContext("2d"),i;for(r.beginPath(),t&&this.setStyle(t,r),i=1;i<n.length;i++)this.line(n[i-1],n[i],t);r.stroke()},i.prototype.bezierCurve=function(n,t,i,r,u){var f=this.document.getContext("2d"),e,c,o,h;if(f.beginPath(),f.moveTo(n.x,n.y),u&&this.setStyle(u,f),u&&u.dashArray){for(e=[],this.flattenCubicBezier(e,n,t,i,r),c=0,o=0;o<u.dashArray.length;o++)c+=Number(u.dashArray[o]);var a=e.length/c,l=!0,s=0;for(o=0;o<a;o++)for(h=0;h<u.dashArray.length;h++)s+=Number(u.dashArray[h]),s<e.length&&(l?f.lineTo(e[s].x,e[s].y):f.moveTo(e[s].x,e[s].y)),l=!l}else f.moveTo(n.x,n.y),f.bezierCurveTo(t.x,t.y,i.x,i.y,r.x,r.y);f.stroke()},i.prototype.quadraticCurve=function(n,t,i,r){var u=this.document.getContext("2d"),f,h,e,s;if(u.beginPath(),u.moveTo(n.x,n.y),r&&this.setStyle(r,u),r&&r.dashArray){for(f=[],this.flattenQuadraticBezier(f,n,t,i),h=0,e=0;e<r.dashArray.length;e++)h+=Number(r.dashArray[e]);var l=f.length/h,c=!0,o=0;for(e=0;e<l;e++)for(s=0;s<r.dashArray.length;s++)o+=Number(r.dashArray[s]),o<f.length&&(c?u.lineTo(f[o].x,f[o].y):u.moveTo(f[o].x,f[o].y)),c=!c}else u.moveTo(n.x,n.y),u.quadraticCurveTo(t.x,t.y,i.x,i.y);u.stroke()},i.prototype.arrow=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();u&&this.setStyle(u,f);t&&t.angle&&this.rotateContext(t,f);f.moveTo(n.x+i.width,n.y+i.height/2);f.lineTo(n.x,n.y);f.lineTo(n.x+i.width,n.y-i.height/2);r||(f.closePath(),f.fill());f.stroke();t&&t.angle&&f.restore()},i.prototype.diamond=function(n,t,i,r){var u=this.document.getContext("2d");u.beginPath();r&&this.setStyle(r,u);t&&t.angle&&this.rotateContext(t,u);u.moveTo(n.x+i.width,n.y);u.lineTo(n.x+i.width/2,n.y+i.height/2);u.lineTo(n.x,n.y);u.lineTo(n.x+i.width/2,n.y-i.height/2);u.lineTo(n.x+i.width,n.y);u.stroke();u.fill();u.closePath();t&&t.angle&&u.restore()},i.prototype.dashedLine=function(n,t,i,r,u){var f=this.document.getContext("2d");f.save();var o=i-n,s=r-t,h=Math.sqrt(o*o+s*s),l=Math.atan2(s,o);f.beginPath();f.translate(n,t);f.moveTo(0,0);f.rotate(l);for(var a=u.length,v=0,c=!0,e=0;h>e;)e+=Number(u[v++%a]),e>h&&(e=h),c?f.lineTo(e,0):f.moveTo(e,0),c=!c,f.stroke();f.restore()},i.prototype.dashedRectangle=function(n,t,i,r,u){this.dashedLine(n,t,n+i,t,u);this.dashedLine(n+i,t,n+i,t+r,u);this.dashedLine(n+i,t+r,n,t+r,u);this.dashedLine(n,t+r,n,t,u)},i.prototype.dashedArc=function(n,t,i,r,u,f,e){for(var o,h,l,a=0,s=0;s<e.length;s++)a+=Number(e[s]);o=this.calculateCirclePoints(n,t,i,r,u,f,a);h=this.document.getContext("2d");h.beginPath();var y=o.length/a,v=!0,c=0;for(s=0;s<y;s++)for(l=0;l<e.length;l++)c+=Number(e[l]),c<o.length&&(v?(h.lineTo(o[c].x,o[c].y),h.stroke()):h.moveTo(o[c].x,o[c].y)),v=!v;h.closePath()},i.prototype.absolutePath=function(n){for(var r,h,e,y,p,c,l,a,v,o=t.datavisualization.Diagram.Util.convertPathToArray(n.getAttribute("d")),u=0,f=0,s=0,w=o.length;s<w;++s){if(r=o[s],h=r.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(h))"x"in r&&(u=r.x),"y"in r&&(f=r.y);else{"x1"in r&&(c=u+r.x1);"x2"in r&&(a=u+r.x2);"y1"in r&&(l=f+r.y1);"y2"in r&&(v=f+r.y2);"x"in r&&(u+=r.x);"y"in r&&(f+=r.y);switch(h){case"m":e={pathSegTypeAsLetter:"M",x:u,y:f};break;case"l":e={pathSegTypeAsLetter:"L",x:u,y:f};break;case"h":e={pathSegTypeAsLetter:"H",x:u};break;case"v":e={pathSegTypeAsLetter:"V",y:f};break;case"c":e={pathSegTypeAsLetter:"C",x:u,y:f,x1:c,y1:l,x2:a,y2:v};break;case"s":e={pathSegTypeAsLetter:"S",x:u,y:f,x2:a,y2:v};break;case"q":e={pathSegTypeAsLetter:"Q",x:u,y:f,x1:c,y1:l};break;case"t":e={pathSegTypeAsLetter:"T",x:u,y:f};break;case"a":e={pathSegTypeAsLetter:"A",x:u,y:f,r1:r1,r2:r2,angle:angle,largeArcFlag:largeArcFlag,sweepFlag:sweepFlag};break;case"z":case"Z":u=y;f=p;e=o[s]}e&&(o[s]=e)}(h==="M"||h==="m")&&(y=u,p=f)}return n.setAttribute("d",t.datavisualization.Diagram.Util.pathSegArrayAsString(o)),i.prototype._scalePathData=function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},n},i.prototype.setStyle=function(n,t){n.fill&&(t.fillStyle=n.fill);n.stroke&&(t.strokeStyle=n.stroke=="none"?"transparent":n.stroke);n.font&&(t.font=n.font);n.lineWidth&&(t.lineWidth=n.lineWidth)},i.prototype.rotateContext=function(n,t){t.save();t.translate(n.x,n.y);t.rotate(n.angle*Math.PI/180);t.translate(-n.x,-n.y)},i.prototype.pathBounds=function(n){for(var i,b,r,v,y,p,w,c,l,u,f,e,o,s=0,h=0,a=0,k=n.length;a<k;++a){i=n[a];b=i.command;a==0&&i.x&&i.y&&(u=e=i.x,f=o=i.y);"x1"in i&&(v=i.x1);"x2"in i&&(p=i.x2);"y1"in i&&(y=i.y1);"y2"in i&&(w=i.y2);"x"in i&&(s=i.x);"y"in i&&(h=i.y);switch(b){case"M":c=s;l=h;case"L":case"H":case"V":s&&(u=Math.min(s,u),e=Math.max(s,e));h&&(f=Math.min(h,f),o=Math.max(h,o));break;case"C":case"S":r=this.getBezierBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(p,w),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Q":case"q":case"T":r=this.getQuadraticBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Z":case"z":s=c;h=l}}return{x:u,y:f,width:e-u,height:o-f}},i.prototype.flattenCubicBezier=function(n,i,r,u,f,e){for(var e=1.5,h=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r)+t.datavisualization.Diagram.Geometry.distance(f,u))/e),s=0;s<=h;s++){var o=s/h,c=(1-o)*(1-o)*(1-o)*i.x+3*o*(1-o)*(1-o)*r.x+3*o*o*(1-o)*u.x+o*o*o*f.x,l=(1-o)*(1-o)*(1-o)*i.y+3*o*(1-o)*(1-o)*r.y+3*o*o*(1-o)*u.y+o*o*o*f.y;n.push(new t.datavisualization.Diagram.Point(c,l))}},i.prototype.flattenQuadraticBezier=function(n,i,r,u,f){for(var f=1.5,s=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),o=0;o<=s;o++){var e=o/s,h=(1-e)*(1-e)*i.x+2*e*(1-e)*r.x+e*e*u.x,c=(1-e)*(1-e)*i.y+2*e*(1-e)*r.y+e*e*u.y;n.push(new t.datavisualization.Diagram.Point(h,c))}},i.prototype.getBezierBounds=function(n,i,r,u,f){for(var f=3,o,s,h,c,y=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),l=0;l<=y;l++){var e=l/y,a=(1-e)*(1-e)*(1-e)*n.x+3*e*(1-e)*(1-e)*i.x+3*e*e*(1-e)*r.x+e*e*e*u.x,v=(1-e)*(1-e)*(1-e)*n.y+3*e*(1-e)*(1-e)*i.y+3*e*e*(1-e)*r.y+e*e*e*u.y;l==0?(o=h=a,s=c=v):(o=Math.min(a,o),s=Math.min(v,s),h=Math.max(a,h),c=Math.max(v,c))}return{x:o,y:s,width:h-o,height:c-s}},i.prototype.getQuadraticBounds=function(n,i,r,u){for(var u=3,e,o,s,h,v=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i))/u),c=0;c<=v;c++){var f=c/v,l=(1-f)*(1-f)*n.x+2*f*(1-f)*i.x+f*f*r.x,a=(1-f)*(1-f)*n.y+2*f*(1-f)*i.y+f*f*r.y;c==0?(e=s=l,o=h=a):(e=Math.min(l,e),o=Math.min(a,o),s=Math.max(l,s),h=Math.max(a,h))}return{x:e,y:o,width:s-e,height:h-o}},i}();t.datavisualization.Diagram.Canvas=i;t.datavisualization.Diagram.CanvasContext={_renderDocument:function(n,i){var r={id:n.canvas.id+"_canvas",width:i._canvas.clientWidth,height:i._canvas.clientHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:n.style,"pointer-events":"none"};n._canvas=new t.datavisualization.Diagram.Canvas(r);i._view=n.canvas;n.canvas.appendChild(n._canvas.document);n.type=="mainview"&&(this._canvas=n.canvas,i._svg=this._svg=n._canvas)},_renderGroupBackground:function(n,i,r){var u,f,e,h,o,s;n.pivot||(n.pivot={},n.pivot.x=.5,n.pivot.y=.5);u=i.document.getContext("2d");n.visible&&(f={angle:n.rotateAngle,x:n.offsetX*i._scaleX,y:n.offsetY*i._scaleY},u.save(),u.translate(f.x,f.y),u.rotate(f.angle*Math.PI/180),u.translate(-f.x,-f.y),u.fillStyle=n.type!="bpmn"?n.fillColor:"transparent",u.strokeStyle=n.type!="bpmn"?n.borderColor:"transparent",u.lineWidth=n.borderWidth,n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?e=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?e=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(e=n.borderDashArray.split(" ")),u.setLineDash?u.setLineDash(e):u.mozDash?u.mozDash=e:h={dashArray:e}));o=n.offsetX*i._scaleX-n.width*i._scaleX*n.pivot.x;s=n.offsetY*i._scaleY-n.height*i._scaleY*n.pivot.y;t.datavisualization.Diagram.Util.canCrispEdges(n,r)&&(o=Math.floor(o)+.5,s=Math.floor(s)+.5);i.rect(o,s,n.width*i._scaleX,n.height*i._scaleY,null,h);u.restore()},renderGroup:function(n,t,i){var u,f,o,r,c,l,e,s,h;if(n.visible){for(u=t.document.getContext("2d"),f={angle:n.rotateAngle,x:n.offsetX*t._scaleX,y:n.offsetY*t._scaleY},u.save(),this._renderGroupBackground(n,t,i),o=0;o<n.children.length;o++)r=i.nameTable[i._getChild(n.children[o])],r&&(r._type==="group"?this.renderGroup(r,t,i):r._type==="node"?this.renderNode(r,t):r.segments&&this.renderConnector(r,t));if(u.translate(f.x,f.y),u.rotate(f.angle*Math.PI/180),u.translate(-f.x,-f.y),c=n.offsetX*t._scaleX-n.width*t._scaleX*n.pivot.x,l=n.offsetY*t._scaleY-n.height*t._scaleY*n.pivot.y,n.isLane||(this.renderLabels(n,t),this.renderPorts(n,t,c,l)),n.isSwimlane&&i._renderCanvasPhase(n,t),n.annotation&&n._annotation&&n._annotation.length)for(e=0;e<n._annotation.length;e++)i.nameTable[n._annotation[e]]&&(s=i.nameTable[n._annotation[e]],h=i.getObjectType(s),h=="node"?this.renderNode(s,t):h=="connector"&&this.renderConnector(s,t));u.restore()}},_isExportable:function(n,i){var f=!0,e,i,r,u;if(n.type==="image")try{i=new t.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100});r=i.document.getContext("2d");r.save();i.rect(0,0,n.width*i._scaleX,n.height*i._scaleY);u=new Image;u.src=n.source;i.image(u,0,0,n.width*i._scaleX,n.height*i._scaleY,undefined,undefined,{scale:n.scale,alignment:n.contentAlignment});r.restore();e=i.document.toDataURL()}catch(o){f=!1}return f},_isImageExportable:function(n){var f=!0,e,i,r,u;if(n.source)try{i=new t.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100});r=i.document.getContext("2d");r.save();u=new Image;u.src=n.source;i.image(u,0,0,100,100,undefined,undefined,{scale:n.scale,alignment:n.alignment});r.restore();e=i.document.toDataURL()}catch(o){f=!1}return f},renderNode:function(n,i,r){var u=i.document.getContext("2d"),f,e,v,o,s,nt,h,y,l,a,c,tt,p,b,w,k,it;if(n.visible&&this._isExportable(n,i)){f=n.width||n._width||0;e=n.height||n._height||0;f*=i._scaleX;e*=i._scaleY;var d=n.offsetX*i._scaleX,g=n.offsetY*i._scaleY,c={angle:n.rotateAngle,x:d,y:g};if(u.save(),u.translate(c.x,c.y),u.rotate(c.angle*Math.PI/180),u.translate(-c.x,-c.y),v=n.flip!=="none"?n.flip:n._flip,v&&v!==t.datavisualization.Diagram.FlipDirection.None&&n.flip!==n._flip&&(u.translate(c.x,c.y),v===t.datavisualization.Diagram.FlipDirection.Horizontal?u.scale(-1,1):v===t.datavisualization.Diagram.FlipDirection.Vertical?u.scale(1,-1):v===t.datavisualization.Diagram.FlipDirection.Both&&u.scale(-1,-1),u.translate(-c.x,-c.y)),u.save(),u.fillStyle=n.fillColor,u.strokeStyle=n.borderColor=="none"||!n.borderWidth?"transparent":n.borderColor,u.lineWidth=n.borderWidth,u.globalAlpha=n.opacity,o=d-f*n.pivot.x,s=g-e*n.pivot.y,t.datavisualization.Diagram.Util.canCrispEdges(n,i._diagram)&&(o=Math.floor(o)+.5,s=Math.floor(s)+.5),n._shape=="path"?this._renderGradient(n,u,0,0):this._renderGradient(n,u,o,s),nt=n.fillColor,n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){u.save();u.strokeStyle="lightgrey";h=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance);u.fillStyle=nt!="none"||nt!="transparent"?"lightgrey":"none";switch(n._shape){case"image":case"rectangle":n.cornerRadius?i.roundedRect(o+h.x,s+h.y,f,e,n.cornerRadius,null):i.rect(o+h.x,s+h.y,f,e,null);break;case"ellipse":i.ellipse(o+f/2+h.x,s+e/2+h.y,f/2,e/2,null);break;case"path":a=n._absolutePath;(i._scaleX!==1||i._scaleY!==1)&&(a=t.datavisualization.Diagram.Geometry.updatePath(o,s,f,e,a,i._diagram._svg,null,null));i.path(a,o+h.x,s+h.y,f,e,null);break;case"polygon":b=this._updatePolygonPoints(n,i);u.translate(h.x,h.y);i.polygon(b,null,l)}u.restore()}n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?y=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?y=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(y=n.borderDashArray.split(" ")),u.setLineDash?u.setLineDash(y):u.mozDash?u.mozDash=y:l={dashArray:y});switch(n._shape){case"rectangle":n.cornerRadius?i.roundedRect(o,s,f,e,n.cornerRadius,null,l):i.rect(o,s,f,e,null,l);break;case"ellipse":i.ellipse(o+f/2,s+e/2,f/2,e/2,null,l);break;case"path":a=n._absolutePath;(i._scaleX!==1||i._scaleY!==1)&&(a=t.datavisualization.Diagram.Geometry.updatePath(0,0,f,e,a,i._diagram._svg,null,null));i.path(a,o,s,f,e,null,l);break;case"image":c={angle:n.rotateAngle,x:d,y:g};i.rect(o,s,f,e,null,l);tt=new Image;tt.src=n.source;i.image(tt,o,s,f,e,undefined,undefined,{scale:n.scale,alignment:n.contentAlignment});break;case"text":i.rect(o,s,f,e,null,l);n.textBlock&&(p="",n.textBlock.italic&&(p+="italic "),n.textBlock.bold&&(p+="bold "),p+=n.textBlock.fontSize+" ",p+=n.textBlock.fontFamily,u.font=p,this._renderTextElement(n,n.textBlock,i));break;case"polygon":b=this._updatePolygonPoints(n,i);i.polygon(b,null,l);break;case"native":case"html":r._raiseEvent("templateNodeRendering",{element:n,canvas:i})}if(u.restore(),this.renderPorts(n,i,o,s),n.type!="text"&&this.renderLabels(n,i),n.annotation&&n._annotation&&n._annotation.length)for(w=0;w<n._annotation.length;w++)r.nameTable[n._annotation[w]]&&(k=r.nameTable[n._annotation[w]],it=r.getObjectType(k),it=="node"?this.renderNode(k,i):it=="connector"&&this.renderConnector(k,i));u.restore()}},renderPhases:function(n,t,i){var f,r,u;n&&t&&(r=t.document.getContext("2d"),r.save(),r.strokeStyle=n.lineColor?n.lineColor:"black",r.lineWidth=n.lineWidth?n.lineWidth:1,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?u=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?u=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(u=n.lineDashArray.split(" ")),r.setLineDash?r.setLineDash(u):r.mozDash?r.mozDash=u:f={dashArray:u}),i&&i.length>0&&t.line(i[0],i[1],f));r.restore()},renderConnector:function(n,t){var i,r,f,u;if(n.visible&&(i=t.document.getContext("2d"),i.save(),i.strokeStyle=n.lineColor,i.lineWidth=n.lineWidth,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?r=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?r=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(r=n.lineDashArray.split(" ")),i.setLineDash?i.setLineDash(r):i.mozDash?i.mozDash=r:f={dashArray:r}),n.segments&&this._renderSegments(n,t,f),i.restore(),this._renderDecorators(n,t),this.renderLabels(n,t),n.shape))for(u=0;u<n._inlineDecorators.length;u++)this.renderNode(n._inlineDecorators[u],t)},_renderSegments:function(n,i,r){for(var f,d,ut,u,w,b,g,nt,v,c,a,it,h,l,e,p,rt,o,s=0;s<n.segments.length;s++){if(f=n.segments[s],f._bridges.length>0)for(d=0;d<f._bridges.length;d++)ut=f._bridges[d],ut._rendered=!1;if(u=f.points,w=i._diagram,s==0?(w&&n.sourceNode&&(g=w._findNode(n.sourceNode)),u=t.datavisualization.Diagram.SvgContext._clipDecorators(n,f,!0,g),f.type=="bezier"&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u[0]=t.datavisualization.Diagram.Util._adjustPoint(u[0],f._point1,!0,n.lineWidth)),a=u[0],b=!0):b=!1,s==n.segments.length-1&&(w&&n.targetNode&&(g=w._findNode(n.targetNode)),u=t.datavisualization.Diagram.SvgContext._clipDecorators(n,f,!1,g),a&&n.segments.length<2&&(u[0]=a,a=null),nt=!0),n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&s==0){v={x:f.points[0].x,y:f.points[0].y};c=t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]);c=Math.min(30,c/2);var y=t.datavisualization.Diagram.Geometry.findAngle(f.points[0],f.points[1]),tt=t.datavisualization.Diagram.Geometry.transform({x:v.x,y:v.y},y,c),k=t.datavisualization.Diagram.Geometry.transform({x:tt.x,y:tt.y},y+135,-12),ft=t.datavisualization.Diagram.Geometry.transform({x:k.x,y:k.y},y+135,24)}if(n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&s==0){v={x:f.points[0].x,y:f.points[0].y};c=t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]);c=Math.min(30,c/2);var y=t.datavisualization.Diagram.Geometry.findAngle(f.points[0],f.points[1]),tt=t.datavisualization.Diagram.Geometry.transform({x:v.x,y:v.y},y,c),k=t.datavisualization.Diagram.Geometry.transform({x:tt.x,y:tt.y},y+135,-12),ft=t.datavisualization.Diagram.Geometry.transform({x:k.x,y:k.y},y+135,24)}if(f.type=="bezier")a=u[0],it=f._endPoint,n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(it=t.datavisualization.Diagram.Util._adjustPoint(f._endPoint,f._point2,!0,n.lineWidth)),i.bezierCurve(a,f._point1,f._point2,it,r);else if(n.cornerRadius>0)for(e=0;e<u.length-1;e++)p=t.datavisualization.Diagram.Geometry.distance(u[e],u[e+1]),p>0&&(rt=l||h,l=s<n.segments.length-1||e<u.length-2?p<n.cornerRadius*2?this._adjustPoint(u[e],u[e+1],!1,p/2):this._adjustPoint(u[e],u[e+1],!1,n.cornerRadius):u[e+1],(s>0||e>0)&&(p<n.cornerRadius*2?(h=this._adjustPoint(u[e],u[e+1],!0,p/2),(s<n.segments.length-1||e<u.length-2)&&(l=null)):h=this._adjustPoint(u[e],u[e+1],!0,n.cornerRadius)),rt&&h?i.quadraticCurve(rt,u[e],h,r):h=u[e],f._bridges.length>0&&this._updateBridging(f,i,e+1,h?h:u[e],l?l:u[e+1],n.bridgeSpace,r,b&&o==1?!0:!1,nt&&o==u.length-1?!0:!1),l&&(f._bridges.length>0||i.line(h,l,r)));else for(o=1;o<u.length;o++)f._bridges.length>0?this._updateBridging(f,i,o,u[o-1],u[o],n.bridgeSpace,r,b&&o==1?!0:!1,nt&&o==u.length-1?!0:!1):i.line(this._scalePointforStretch(u[o-1],i,n),this._scalePointforStretch(u[o],i,n),r,b&&o==1?!1:!0,nt&&o==u.length-1?!1:!0)}n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&i.line(this._scalePointforStretch(k,i,n),this._scalePointforStretch(ft,i,n),r)},_scalePointforStretch:function(n,i,r){var u={x:n.x,y:n.y};return r&&t.datavisualization.Diagram.Util.canCrispEdges(r,i._diagram)&&(u.x=Math.floor(u.x),u.y=Math.floor(u.y)),u.x*=i._scaleX,u.y*=i._scaleY,u},_updateBridging:function(n,i,r,u,f,e,o,s,h){var a,v=this._findAngle(u,f),p=i._diagram.bridgeDirection(),y,l,c;if(n._bridges.length>0)if(n.type==="straight"){for(l=0;l<n._bridges.length;l++)if(c=n._bridges[l],!c._rendered){a=n._bridges[l-1]!=null&&n._bridges[l-1].segmentPointIndex==c.segmentPointIndex?n._bridges[l-1].endPoint:u;i.line(a,c.startPoint,o,!(s||l==0),!0);var w=c.startPoint.x+(c.endPoint.x-c.startPoint.x)/2,b=c.startPoint.y+(c.endPoint.y-c.startPoint.y)/2,k=t.datavisualization.Diagram.Util.sweepDirection(v,p,null,i._diagram);i.arc(w,b,e/2,v,k,o);n._bridges[l+1]!=null&&n._bridges[l+1].segmentPointIndex==c.segmentPointIndex?i.line(c.endPoint,n._bridges[l+1].startPoint,o,!1):i.line(c.endPoint,f,o,!1,!h);c._rendered=!0}}else if(n.type==="orthogonal"){for(y=u,l=0;l<n._bridges.length;l++)if(c=n._bridges[l],c.segmentPointIndex===r&&!c._rendered){a=n._bridges[l-1]!=null&&n._bridges[l-1].segmentPointIndex==c.segmentPointIndex?n._bridges[l-1].endPoint:u;i.line(a,c.startPoint,o,!(s||l==0),!0);var w=c.startPoint.x+(c.endPoint.x-c.startPoint.x)/2,b=c.startPoint.y+(c.endPoint.y-c.startPoint.y)/2,k=t.datavisualization.Diagram.Util.sweepDirection(v,p,null,i._diagram);i.arc(w,b,e/2,v,k,o);n._bridges[l+1]!=null&&n._bridges[l+1].segmentPointIndex==c.segmentPointIndex?i.line(c.endPoint,n._bridges[l+1].startPoint,o,!1):y=c.endPoint;c._rendered=!0}i.line(y,f,o,!1,!h)}},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},renderLabels:function(n,t){for(var i,r,u=0;u<n.labels.length;u++)i=n.labels[u],r=t.document.getContext("2d"),r.save(),r.globalAlpha=i.opacity,r.lineWidth=i.borderWidth,r.strokeStyle=i.borderColor,i.text&&i.visible&&this._renderTextElement(n,i,t),r.restore()},renderPorts:function(n,i,r,u){for(var e,o,f,a,v,l,h,s=i.document.getContext("2d"),c=0;c<n.ports.length;c++)if(e=n.ports[c],!(e.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||e.visibility&t.datavisualization.Diagram.PortVisibility.Hover||e.visibility&t.datavisualization.Diagram.PortVisibility.Connect)){o=t.datavisualization.Diagram.Util._getPortPosition(e,t.datavisualization.Diagram.Util.bounds(n,!0));o=this._scalePointforStretch(o,i);f=e.size*i._scaleY;s.fillStyle=e.fillColor;s.strokeStyle=e.borderColor;s.lineWidth=e.borderWidth;switch(e.shape){case"x":s.beginPath();s.moveTo(o.x-f/2,o.y-f/2);s.lineTo(o.x+f/2,o.y+f/2);s.moveTo(o.x+f/2,o.y-f/2);s.lineTo(o.x-f/2,o.y+f/2);s.stroke();s.fill();s.closePath();break;case"circle":a=f/2;v=f/2;i.ellipse(o.x,o.y,a,v);break;case"square":i.rect(o.x-f/2,o.y-f/2,f,f);break;case"path":s.save();n._type=="group"?(s.translate(offsetX,n.offsetY),s.rotate(-n.rotateAngle*Math.PI/180),s.translate(-offsetX,-n.offsetY),n.rotateAngle&&(l={angle:n.rotateAngle,x:e._absolutePoint.x,y:e._absolutePoint.y}),h=e._absolutePath,(i._scaleX!==1||i._scaleY!==1)&&(h=t.datavisualization.Diagram.Geometry.updatePath(e._absolutePoint.x,e._absolutePoint.y,f,f,h,i._diagram._svg,null,null)),i.path(h,0,0,f,f,l)):(r=o.x-n.width*e.offset.x,u=o.y-n.height*e.offset.y,h=e._absolutePath,(i._scaleX!==1||i._scaleY!==1)&&(h=t.datavisualization.Diagram.Geometry.updatePath(r,u,f,f,h,i._diagram._svg,null,null)),i.path(h,r,u,f,f,l));s.restore()}}},_renderTextElement:function(n,t,i){var f,u,r,e;t&&(f={childNodes:[]},u=i.document.getContext("2d"),u.save(),r="",t.italic&&(r+="italic "),t.bold&&(r+="bold "),r+=t.fontSize*i._scaleY+"px ",r+=t.fontFamily,u.font=r,e=this._wrapText(n,f,t,i),this._alignTextOnLabel(t,n,f,i,e),u.restore())},_alignTextOnLabel:function(n,i,r,u,f){var g=i.width||i._width||0,yt=i.height||i._height||0,s,h,e,rt,k,ut,ft,et,ot,o,y,nt,tt,ht,w,b,l,lt,it,at,vt;g*=u._scaleX;yt*=u._scaleY;s={width:f&&f.width||n.width,height:r.childNodes.length*n.fontSize*u._scaleY};h=t.datavisualization.Diagram.Util.bounds(i);h.width*=u._scaleX;h.height*=u._scaleY;h.x*=u._scaleX;h.y*=u._scaleY;ut=u._diagram;i.segments&&n.relativeMode=="segmentpath"?(ft=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(n,i,1,ut),et=this._scalePointforStretch(ft.position,u),e={x:(et.x-h.x)/h.width,y:(et.y-h.y)/h.height},ot=t.datavisualization.Diagram.Util._alignLabelOnSegments(i,n,ut,ft),k=ot.vAlign,rt=ot.hAlign):(rt=n.horizontalAlignment,k=n.verticalAlignment);e=t.datavisualization.Diagram.Util._getLabelPosition(n,h,e);var c={x:0,y:0},p={x:e.x,y:e.y},d=0;d=k==t.datavisualization.Diagram.VerticalAlignment.Top?e.y+s.height/2:k==t.datavisualization.Diagram.VerticalAlignment.Center||k==t.datavisualization.Diagram.VerticalAlignment.Stretch?e.y:e.y-s.height/2;c.y=d;c.x=e.x;p.y=d;o=u.document.getContext("2d");n.textAlign=="justify"?r.childNodes.length>1?(o.textAlign="left",s.width=g-2*n.borderWidth):o.textAlign="center":o.textAlign=n.textAlign;switch(rt){case t.datavisualization.Diagram.HorizontalAlignment.Left:p.x=e.x+s.width/2;switch(o.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=e.x;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=e.x+s.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=e.x+s.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:p.x=e.x;switch(o.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=e.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=e.x;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=e.x+s.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:p.x=e.x-s.width/2;switch(o.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=e.x-s.width;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=e.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=e.x}break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:p.x=e.x;c.x=e.x}nt=h.x;tt=h.y;i.segments||(nt=i.offsetX*u._scaleX-g*i.pivot.x,tt=i.offsetY*u._scaleY-yt*i.pivot.y);var a=n.borderWidth||0,st=nt+c.x+(f?f.x:0)-a/2,d=tt+c.y-s.height/2-a/2;for(n.verticalAlignment=="stretch"?u.rect(st,h.y,s.width+a,h.height+a,null,{fill:n.fillColor&&!i._isHeader?n.fillColor:"transparent",stroke:a&&!i._isHeader?n.borderColor||"transparent":"transparent",lineWidth:a}):u.rect(st,d,s.width+a,s.height+a,null,{fill:n.fillColor?n.fillColor:"transparent",stroke:a?n.borderColor||"transparent":"transparent",lineWidth:a}),y={angle:n.rotateAngle,x:nt+p.x,y:tt+p.y},n.textAlign=="justify"&&(ht=Math.max(g,n.width)-2*n.borderWidth),o.save(),o.translate(y.x,y.y),o.rotate(y.angle*Math.PI/180),o.translate(-y.x,-y.y),w=i.flip!=="none"?i.flip:i._flip,w&&w!==t.datavisualization.Diagram.FlipDirection.None&&i.flip!==i._flip&&(o.translate(y.x,y.y),w===t.datavisualization.Diagram.FlipDirection.Horizontal?o.scale(-1,1):w===t.datavisualization.Diagram.FlipDirection.Vertical?o.scale(1,-1):w===t.datavisualization.Diagram.FlipDirection.Both&&o.scale(-1,-1),o.translate(-y.x,-y.y)),b=0;b<r.childNodes.length;b++){var v=r.childNodes[b],pt=st+v.x-f.x+a/2,wt=d+v.dy*b+n.fontSize*u._scaleY*.8+a/2,ct=o.measureText(v.text).width;if(ht>ct&&b<r.childNodes.length-1&&(l=v.text,l[l.length-1]==" "&&(l=l.slice(0,l.length-1)),l[0]==" "&&(l=l.slice(1,l.length)),ct=o.measureText(l).width,lt=l.split(" "),lt.length>1)){for(it=(ht-ct)/o.measureText(" ").width/(lt.length-1),it=Math.round(it),at="",vt=0;vt<it;vt++)at+=" ";v.text=l.replace(" ",at)}if(n.horizontalAlignment=="stretch")switch(n.textAlign){case"left":v.x=e.x-s.width/2;break;case"center":v.x=-s.width/2;break;case"right":v.x=-e.x-s.width/2}u.text({text:v.text},pt-v.x,wt,null,{fill:n.fontColor});n.textDecoration!="none"&&this._renderTextDecoration(pt-v.x,wt,o.measureText(v.text).width,n,u)}o.restore()},_wrapText:function(n,i,r,u){var nt=r.text,w,e,s,d,f,h,b,k,y,p;r.rotateAngle!=undefined?u&&u._diagram?(w=u._diagram.nameTable[n.parent],w&&w.isLane&&r.rotateAngle!==0?(e=t.datavisualization.Diagram.Util.bounds(n),y=e.width,e.width=e.height,e.height=y):e=t.datavisualization.Diagram.Util.bounds(n)):e=t.datavisualization.Diagram.Util.bounds(n):e=t.datavisualization.Diagram.Util.bounds(n);e.width*=u._scaleX;e.height*=u._scaleY;e.x*=u._scaleX;e.y*=u._scaleY;n.segments?(s=e.width,d=e.height):(s=e.width-r.margin.left-r.margin.right,d=e.height-r.margin.top-r.margin.bottom);s-=2*(r.borderWidth?r.borderWidth:1);s=s<r.width?r.width:s;for(var a=nt.split("\n"),g,o,c=u.document.getContext("2d"),v=r.wrapping=="wrapwithoverflow"?!0:!1,l=0;l<a.length;l++)if(f="",r.wrapping=="nowrap"||r.textOverflow)r.textOverflow?(p=diagram&&diagram.getNode?diagram.getNode(n.parent):null,y=n.isPhase&&n.orientation==="vertical"||p&&p.isLane&&p.orientation==="horizontal"&&n._isHeader?n.height:n.width,f+=this._getOverflowTypeText(c,a[l],y,r.overflowType)):f+=a[l],i.childNodes[i.childNodes.length]={text:f};else for(h=r.wrapping=="wrapwithoverflow"?a[l].split(" "):a[l],o=0;o<h.length;o++)b=h[o],b.indexOf("-")>=0&&v?(f=this._splitHyphenWord(f,b,i,r,c,s),o==h.length-1?(i.childNodes[i.childNodes.length]={text:f},f=""):c.measureText(f+" "+(h[o+1]||"")).width>s&&(i.childNodes[i.childNodes.length]={text:f},f="")):(f+=(f&&v?" ":"")+h[o],g=c.measureText(f).width,g>=s?(i.childNodes[i.childNodes.length]={text:f},f=""):((v||r&&r.wrapping==="wrap")&&(k=f,o<h.length-1&&(h[o+1].indexOf("-")>=0&&v?(f=this._splitHyphenWord(f,h[o+1],i,r,c,s),c.measureText(f+" "+(h[o+1]||"")).width>s&&(i.childNodes[i.childNodes.length]={text:f},f=""),o++):(k+=(v?" ":"")+(h[o+1]||""),c.measureText(k).width>s&&(i.childNodes[i.childNodes.length]={text:f},f="")))),o==h.length-1&&(i.childNodes[i.childNodes.length]={text:f},f="")));return this._wrapTextAlign(i,i.childNodes,r.fontSize*u._scaleY,r.textAlign,c,n,r,u)},_getOverflowTypeText:function(n,t,i,r){var u=n.measureText(t).width,e="…",s=n.measureText(e).width,f,o;if(u<=i)return t;for(f=t.length,o=r==="ellipsis"?i-s:i;u>=o&&f-->0;)t=t.substring(0,f),u=n.measureText(t).width;return r==="ellipsis"?t+e:t},_splitHyphenWord:function(n,t,i,r,u,f){for(var h,c=r.wrapping=="wrapwithoverflow"?!0:!1,e=n?n+" ":"",s=t.split("-"),o=0;o<s.length;o++)e+=s[o],h=u.measureText(e).width,h>=f?(i.childNodes[i.childNodes.length]={text:n},e=o<s.length-1?s[o]+"-":s[o],n=e):(c||r&&r.wrapping==="wrap")&&(n=e,o<s.length-1&&(e+="-",u.measureText(e).width>f?(i.childNodes[i.childNodes.length]={text:n},e="-"):n=e));return n},_wrapTextAlign:function(n,i,r,u,f,e,o,s){var a,c,v=t.datavisualization.Diagram.Util.bounds(e),l,h;for(v.width*=s._scaleX,v.height*=s._scaleY,v.x*=s._scaleX,v.y*=s._scaleY,l=0;l<i.length;l++){if(h=f.measureText(i[l].text).width,a=h,o.horizontalAlignment=="stretch")a=v.width,h=-a/2;else switch(u){case"left":h=0;break;case"center":h=-h/2;break;case"right":h=-h;break;case"justify":h=i.length>1?0:-h/2}i[l].x=Number(h);i[l].dy=r;c?(c.x=Math.min(c.x,h),c.width=Math.max(c.width,a)):c={x:h,width:a}}return c},_renderTextDecoration:function(n,t,i,r,u){var f=u.document.getContext("2d"),e,o;f.save();f.strokeStyle=r.fontColor;f.lineWidth=1;switch(f.textAlign){case"center":n-=i/2;break;case"right":n-=i}t+=2;switch(r.textDecoration){case"overline":t-=r.fontSize*u._scaleY;break;case"line-through":t-=r.fontSize/2*u._scaleY}e={x:n,y:t};o={x:n+i,y:t};u.line(e,o,null);f.restore()},_renderGradient:function(n,t,i,r){var f,o,s,u,e,h;if(n.gradient){for(u=0;u<n.gradient.stops.length;u++)f=f?Math.max(f,n.gradient.stops[u].offset):n.gradient.stops[u].offset,o=o?Math.min(o,n.gradient.stops[u].offset):n.gradient.stops[u].offset;if(n.gradient.type=="linear")for(s=t.createLinearGradient(i+n.gradient.x1,r+n.gradient.y1,i+n.gradient.x2,r+n.gradient.y2),u=0;u<n.gradient.stops.length;u++)e=n.gradient.stops[u],h=o<0?(f+e.offset)/(2*f):e.offset/f,s.addColorStop(h,e.color);else if(n.gradient.type=="radial")for(s=t.createRadialGradient(i+n.gradient.fx,r+n.gradient.fy,0,i+n.gradient.cx,r+n.gradient.cy,n.gradient.r),u=0;u<n.gradient.stops.length;u++)e=n.gradient.stops[u],h=o<0?(f+e.offset)/(2*f):e.offset/f,s.addColorStop(h,e.color);t.fillStyle=s}},_renderDecorators:function(n,i){var u,f,e=i._diagram,o,r,s;n.targetDecorator&&n.targetDecorator.shape&&(r=n.segments[n.segments.length-1],u=r.points[r.points.length-2],f=n.targetPoint,r.type=="bezier"&&(u=r._point2),n.targetNode&&e&&(o=e._findNode(n.targetNode),o&&o.borderColor!="none"&&(f=t.datavisualization.Diagram.Util._adjustPoint(f,u,!0,o.borderWidth/2))),this._renderDecorator(n.name+"_targetDecorator",f,u,n.targetDecorator,i));n.sourceDecorator&&n.sourceDecorator.shape&&(r=n.segments[0],u=n.sourcePoint,f=r.points[1],r.type=="bezier"&&(f=r._point1),n.sourceNode&&e&&(s=e._findNode(n.sourceNode),s&&s.borderColor!="none"&&(u=t.datavisualization.Diagram.Util._adjustPoint(u,f,!0,s.borderWidth/2))),this._renderDecorator(n.name+"_sourceDecorator",u,f,n.sourceDecorator,i))},_renderDecorator:function(n,i,r,u,f){var v,e=this._scalePointforStretch(i,f),y=this._scalePointforStretch(r,f),o=new t.datavisualization.Diagram.Size(Number(u.width*f._scaleY),Number(u.height*f._scaleY)),h=f.document.getContext("2d"),c,s,l,a;h.fillStyle=u.fillColor;h.strokeStyle=u.borderColor=="none"?"transparent":u.borderColor;h.lineWidth=u.borderWidth;c=t.datavisualization.Diagram.Geometry.findAngle(e,y);s={angle:c,x:e.x,y:e.y};switch(u.shape){case"arrow":f.arrow(e,s,o);break;case"openarrow":f.arrow(e,s,o,!0);break;case"circle":l=o.width/2;a=o.height/2;f.ellipse(e.x+o.width/2,e.y,l,a,s);break;case"diamond":f.diamond(e,s,o);break;case"path":f.path(u._absolutePath,0,0,o.width,o.height,s)}return v},_updatePolygonPoints:function(n,i){var u=[],f,e,o,r,h,c;if(n.points){for(f=n.width||n._width||0,e=n.height||n._height||0,f*=i._scaleX,e*=i._scaleY,r=0;r<n.points.length;r++)o=n.points[r],u.push({x:o.x,y:o.y});if(u.length){this._scalePoints(u,n,i);var s=t.datavisualization.Diagram.Geometry.rect(u),l=n.offsetX*i._scaleX-f*n.pivot.x-s.x,a=n.offsetY*i._scaleY-e*n.pivot.y-s.y;for(r=0,h=u.length;r<h;++r)c=t.datavisualization.Diagram.Geometry.translate(u[r],l,a),u[r]=c}}return u},_scalePoints:function(n,i,r){var f=t.datavisualization.Diagram.Geometry.rect(n),e,o,s,h,u,c;if(f.width>0&&f.height>0)for(e=i.width||i._width||0,o=i.height||i._height||0,e*=r._scaleX,o*=r._scaleY,s=e/f.width,h=o/f.height,u=0,c=n.length;u<c;++u)n[u].x=n[u].x*s,n[u].y=n[u].y*h},updateNode:function(n,t){this.refreshCanvas(n,t)},updateConnector:function(n,t){this.refreshCanvas(n,t)},updateGroup:function(n,t){this.refreshCanvas(n,t)},refreshCanvas:function(n,t){var r=t.document.getContext("2d"),u,i;for(r.save(),view.scale&&r.scale(1/view.scale.x,1/view.scale.y),u={x:t.document.offsetLeft,y:t.document.offsetTop,width:t.document.offsetWidth,height:t.document.offsetHeight},r.clearRect(u.x,u.y,u.width,u.height),view.scale&&r.scale(view.scale.x,view.scale.y),r.restore(),i=0;i<n.nodes.length;i++)n.nodes[i]._type==="node"?this.renderNode(n.nodes[i],t):n.nodes[i]._type==="group"&&this.renderGroup(n.nodes[i],t);for(i=0;i<n.connectors.length;i++)this.renderConnector(n.connectors[i],t)},updateViewport:function(){},addNodeLabel:function(n,t){this.refreshCanvas(n,t)},updateLabel:function(n,t){this.refreshCanvas(n,t)},setNodeShape:function(n,t){this.refreshCanvas(n,t)},setLine:function(n,t){this.refreshCanvas(n,t)},renderDecorators:function(n,t){this.refreshCanvas(n,t)},clearDecorators:function(n,t){this.refreshCanvas(n,t)},updateTargetDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},updateSourceDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},_updateNodeStyle:function(n,t){this.refreshCanvas(n,t)},updateLabelStyle:function(n,t){this.refreshCanvas(n,t)},updateConnectorStyle:function(n,t){this.refreshCanvas(n,t)},updateTextBlock:function(n,t,i){this.refreshCanvas(n,i)},removeChild:function(){this.refreshCanvas(model,canvas)}}}(jQuery,Syncfusion)});
