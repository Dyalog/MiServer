/*!
*  filename: ej.pivotschemadesigner.min.js
*  version : 13.3.0.18
*  Copyright Syncfusion Inc. 2001 - 2015. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.button.min","./ej.checkbox.min","./ej.dialog.min","./ej.maskedit.min","./ej.waitingpopup.min","./ej.treeview.min","./../datavisualization/ej.vmlrenderer.min","./../datavisualization/ej.svgrenderer.min","./../datavisualization/ej.axisrenderer.min","./../datavisualization/ej.legendrender.min","./../datavisualization/ej.seriesrender.min","./../datavisualization/ej.chart.min","./../datavisualization/ej.synchart.min"],n):n()})(function(){(function(n,t,i){t.widget("ejPivotSchemaDesigner","ej.PivotSchemaDesigner",{_rootCSS:"e-pivotschemadesigner",element:null,model:null,validTags:["div","span"],defaults:{url:"",cssClass:"",height:"630px",width:"415px",locale:"en-US",layout:"normal",pivotControl:null,pivotTableFields:[],pivotCalculations:[],pivotColumns:[],pivotRows:[],filters:[],enableWrapper:!1,serviceMethods:{fetchMembers:"FetchMembers",nodeStateModified:"NodeStateModified",nodeDropped:"NodeDropped",removeButton:"RemoveButton",memberExpand:"MemberExpanded",filtering:"filtering"},customObject:{},beforeServiceInvoke:null,afterServiceInvoke:null},dataTypes:{serviceMethods:"data",customObject:"data",pivotControl:"data",pivotTableFieldList:"array",pivotCalculationList:"array",pivotColumnList:"array",pivotRowList:"array",filterList:"array"},locale:t.util.valueFunction("locale"),_init:function(){this._initPrivateProperties();this._load()},_destroy:function(){this.element.empty().removeClass("e-pivotschemadesigner"+this.model.cssClass)},_initPrivateProperties:function(){this._id=this.element.attr("id");this._dialogTitle="";this._currentMembers=[];this._memberTreeObj=null;this._tableTreeObj=null;this._dialogOKBtnObj=null;this._curFilteredText="";this._curFilteredAxis="";this._tempFilterData=null;this._droppedClass="";this._selectedTreeNode=null;this._selectedMember="";this._isDragging=!1;this._dataModel="";this._droppedPosition="";this._currentCubeName="";this._errorDialog="";_pivotProxy=this;this._nodeDropedParams="";this._contextMenuObj=null;this._removeButtonDeferUpdate=!1},_load:function(){var e="",r,u,i,o,s,h,f;if(this.model.pivotControl!=null&&(this.model.pivotControl._schemaData=this),this.model.pivotControl==null||jQuery.isEmptyObject(this.model.pivotControl.getOlapReport())||(e=JSON.parse(JSON.parse(this.model.pivotControl.getOlapReport()).ItemsProperties),r=JSON.parse(this.model.pivotControl.getOlapReport()),this._setTableFields(e),this._setPivotRows(r.PivotRows),this._setPivotColumns(r.PivotColumns),this._setPivotCalculations(r.PivotCalculations),this._setFilters(r.Filters),this._dataModel=r.DataModel,this._currentCubeName=r.CurrentCube,n("#"+this._id).ejWaitingPopup({showOnInit:!0}),pschemaDesignerWaitingPopup=n("#"+this._id).data("ejWaitingPopup"),pschemaDesignerWaitingPopup.hide()),this.model.enableWrapper==!1){var c=t.buildTag("table.headerTable",t.buildTag("tr",t.buildTag("td",t.buildTag("div.listHeader",t.buildTag("span.headerText",_pivotProxy._getLocalizedLabels("PivotTableFieldList"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.listSubhead",t.buildTag("span.subheadText",_pivotProxy._getLocalizedLabels("ChooseFieldsToAddToReport"),{})[0].outerHTML,{})[0].outerHTML,{}).attr("valign","top")[0].outerHTML,{})[0].outerHTML,{}).attr("width","100%").attr("height","10%")[0].outerHTML+t.buildTag("table.fieldTable",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.schemaFieldList",t.buildTag("div.schemaFieldTree#schemaFieldTree")[0].outerHTML)[0].outerHTML).attr("valign","top")[0].outerHTML,{})[0].outerHTML,{})[0].outerHTML,{}).attr("width","95%").attr("height","30%")[0].outerHTML,l=t.buildTag("table.axisTable",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",_pivotProxy._getLocalizedLabels("ReportFilter"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaFilter",this._createPivotButtons(this.model.filters,"filter"))[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML+t.buildTag("td",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",_pivotProxy._getLocalizedLabels("ColumnLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaColumn",this._createPivotButtons(this.model.pivotColumns,"column"),{})[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML,{})[0].outerHTML+t.buildTag("tr",t.buildTag("td",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",_pivotProxy._getLocalizedLabels("RowLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaRow",this._createPivotButtons(this.model.pivotRows,"row"),{})[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML+t.buildTag("td",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",_pivotProxy._getLocalizedLabels("Values"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaValue",this._createPivotButtons(this.model.pivotCalculations,"values"),{})[0].outerHTML,{}).attr("width","50%").attr("height","50%").attr("valign","top")[0].outerHTML,{})[0].outerHTML,{})[0].outerHTML,{}).attr("width","100%").attr("height","46%")[0].outerHTML,a=t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",_pivotProxy._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML,v=c+t.buildTag("div.centerDiv")[0].outerHTML+t.buildTag("div.centerHead",_pivotProxy._getLocalizedLabels("DragFieldBetweenAreasBelow"))[0].outerHTML+l+t.buildTag("span.responsiveSchema","")[0].outerHTML+a;n(v).appendTo("#"+this._id)}else this.model.enableWrapper==!0&&(this._setFilters(r.Filters),this.element.find(".axisTable .schemaFilter").append(this._createPivotButtons(this.model.filters,"filter")),this.element.find(".axisTable .schemaRow").append(this._createPivotButtons(this.model.pivotRows,"row")),this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons(this.model.pivotColumns,"column")),this.element.find(".axisTable .schemaValue").append(this._createPivotButtons(this.model.pivotCalculations,"values")),this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal"}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)}));for(this.element.width(this.model.width).height(this.model.height),this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal"}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)}),this.element.find(".pivotButton .filterBtn").ejButton({size:"normal",contentType:"imageonly",prefixIcon:"filter"}),this.element.find(".pivotButton input").ejToggleButton({size:"normal",contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._onSortBtnClick,this)}),this.element.find(".schemaFieldTree").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:"name",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:this.model.pivotTableFields},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._onNodeDropped,this),nodeDragStart:t.proxy(this._onNodeDrag,this)}),this._tableTreeObj=this.element.find(".schemaFieldTree").data("ejTreeView"),this._tableTreeObj.element.find(".measureGroupCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".folderCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".dimensionCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".measureGroupCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML),this._tableTreeObj.element.find(".dimensionCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML),u=this._tableTreeObj.element.find("li"),i=0;i<u.length;i++)u[i].setAttribute("tag",this.model.pivotTableFields[i].tag),o=n(u[i]).find(".e-chkbox-wrap"),o[0].attributes[4].value=="true"&&n(n(u[i])).find(".folderCDB").length<=0&&n(u[i]).attr("tag").indexOf("[Measures]")==-1&&(s=t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML,n(n(u[i]).find(".e-text")[0]).after(s));this._tableTreeObj.model.nodeCheck=t.proxy(this._onCheckedStateModified,this);this._tableTreeObj.model.nodeUncheck=t.proxy(this._onCheckedStateModified,this);this._tableTreeObj.element.find(".attributeCDB").parent().siblings("ul").remove();this._tableTreeObj.element.find(".attributeCDB").siblings(".e-plus").remove();this._tableTreeObj.element.find(".hierarchyCDB").parent().parent().siblings("ul").find(".e-chkbox-wrap").remove();this._tableTreeObj.element.find(".e-plus").length==0&&this._tableTreeObj.element.find(".e-item").css("padding","0px");this.element.find(".schemaFilter, .schemaColumn, .schemaRow, .schemaValue").ejDroppable({});h=t.buildTag("ul.pivotTreeContext#pivotTreeContext",t.buildTag("li",t.buildTag("a","Add to Filter")[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a","Add to Row")[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a","Add to Column")[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a","Add to Values")[0].outerHTML)[0].outerHTML)[0].outerHTML;n(this.element).append(h);n("#pivotTreeContext").ejMenu({menuType:t.MenuType.ContextMenu,openOnClick:!1,contextMenuTarget:this._tableTreeObj.element[0],click:t.proxy(this._onTreeContextClick,this),beforeOpen:t.proxy(this._onContextOpen,this)});this.model.pivotControl!=null&&this.model.pivotControl.model.isResponsive==!0&&(n(window).width()<750?(n("#"+this._id).css("position","absolute"),this.element.find(".responsiveSchema").addClass("expandSchema").removeClass("responsiveSchema"),n("#"+this.model.pivotControl._id).width("100%"),this._hideSchemaDesigner()):n(window).width()>750&&(n("#"+this._id).css({position:"static"}),n("#"+this.model.pivotControl._id).width(parseInt(100-n("#"+this._id).width()/n(window).width()*100)-2+"%"),this._showSchemaDesigner()));this.model.pivotControl!=null&&(f=!1,this.model.pivotControl.model.enableDeferUpdate&&(f=!0),this.element.find(".btnDeferUpdate").ejButton({size:"mini",enabled:f,click:t.proxy(this.model.pivotControl._deferUpdate,this.model.pivotControl)}),this.element.find(".chkDeferUpdate").ejCheckBox({text:_pivotProxy._getLocalizedLabels("DeferLayoutUpdate"),change:this._checkedChange,size:"normal",checked:f}));this._unWireEvents();this._wireEvents()},_setFirst:!0,_setModel:function(n){for(var t in n)switch(t){case"OlapReport":this.setOlapReport(n[t]);break;case"locale":this._load()}},_wireEvents:function(){this.model.layout!="excel"?(this._on(this.element,"mouseover",".pivotButton .pvtBtn",t.proxy(function(t){n(t.target.parentNode).find("span.removePivotBtn").css("display","inline-block")},this)),this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(){this.element.find(".pivotButton > span.removePivotBtn").css("display","none")},this))):(this._on(this.element,"mouseover",".pivotButton .pvtBtn",t.proxy(function(t){this._isDragging&&(this.element.find(".dropIndicator").removeClass("dropIndicatorHover"),n(t.target).siblings(".dropIndicator").addClass("dropIndicatorHover"))},this)),this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(t){this._isDragging&&n(t.target).siblings(".dropIndicator").removeClass("dropIndicatorHover")},this)));this._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){var i=n(t.target).siblings("span.e-icon.filter:eq(0)").length>0||n(t.target).find("span.e-icon.filter:eq(0)").length>0||n(t.target).parentsUntil("li").find("span.e-icon.filter:eq(0)").length>0?navigator.userAgent.indexOf("MSIE")>0?"-20px":"-35px":"-20px";n(t.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(t.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute",color:"#5c5c5c","margin-left":i,"margin-top":"3px"}):n(t.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(t.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute",color:"#5c5c5c"}):n(t.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({color:"#5c5c5c",display:"inline-block",position:"absolute"});n(t.target).parent().find(".measureGroupCDB, .dimensionCDB, .folderCDB").length>0&&n(t.target).css("cursor","default")},this)).mouseout(t.proxy(function(){n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"})},this));this._on(this.element,"click",".filterBtn",t.proxy(this._onFilterBtnClick,this));this._on(this.element,"click",".removePivotBtn",t.proxy(this._onRemoveBtnClick,this));this._on(this._tableTreeObj.element,"click",".treeDrop",t.proxy(this._onFilterBtnClick,this));this._on(this.element,"click",".collapseSchema",t.proxy(this._hideSchemaDesigner,this));this._on(this.element,"click",".expandSchema",t.proxy(this._showSchemaDesigner,this));n(window).bind("resize",n.proxy(this._reSizeHandler,this))},_unWireEvents:function(){this._off(this.element,"click",".filterBtn, .collapseSchema,.expandSchema");this._off(this.element,"mouseover",".pivotButton");this._off(this.element,"mouseover",".pivotButton .pvtBtn");this._off(this.element,"mouseleave",".pivotButton");this._off(this.element,"mouseover",".schemaFieldTree li");this._off(this.element,"mouseout",".schemaFieldTree li");this._off(this._tableTreeObj.element,"click",".treeDrop");this._off(this._tableTreeObj.element,"click","li");n(window).unbind("resize",n.proxy(this._reSizeHandler,this))},_getLocalizedLabels:function(n){return t.PivotSchemaDesigner.locale[this.locale()][n]===i?t.PivotSchemaDesigner.locale["en-US"][n]:t.PivotSchemaDesigner.locale[this.locale()][n]},_setTableFields:function(n){t.isNullOrUndefined(n)||(this.model.pivotTableFields=n)},_setPivotRows:function(n){t.isNullOrUndefined(n)||(this.model.pivotRows=n)},_setPivotColumns:function(n){t.isNullOrUndefined(n)||(this.model.pivotColumns=n)},_setPivotCalculations:function(n){t.isNullOrUndefined(n)||(this.model.pivotCalculations=n)},_setFilters:function(n){t.isNullOrUndefined(n)||(this.model.filters=n)},_getSortedHeaders:function(){for(var i=this.element.find(".descending").parents("label"),r="",t=0;t<i.length;t++)r+=n(i[t]).attr("for").replace("toggleBtn","")+"##";return r},_onContextOpen:function(t){if(n(t.target.parentElement).find(".measureGroupCDB").length>0||n(t.target.parentElement).find(".folderCDB").length>0||n(t.target.parentElement).find(".dimensionCDB").length>0)return!1;this._dataModel=="Olap"?this._selectedMember=n(t.target).parents("li:eq(0)").attr("tag"):this._dataModel=="Pivot"&&(this._selectedMember=t.target.text)},_onNodeDrag:function(t){return this._isDragging=!0,n(t.dragTarget.parentElement).find(".measureGroupCDB").length>0||n(t.dragTarget.parentElement).find(".folderCDB").length>0||n(t.dragTarget.parentElement).find(".dimensionCDB").length>0?!1:void 0},_onTreeContextClick:function(i){var a,y="",u=this.element.find(".pivotButton:contains("+this._selectedMember+")"),p=n(u).find(".filterIndicator").length>0?!0:!1,w=n(u).find("~ span:eq(0) span.descending").length>0?!0:!1,e,v,f,o,h,c,l,r,s;for(selectedTreeNode=this._dataModel=="Olap"?_pivotProxy._getNodeByUniqueName(this._selectedMember):n(this._tableTreeObj.element).find("div:contains("+this._selectedMember+")>span").parents("li"),this._droppedClass=i.events.text=="Add to Filter"?"schemaFilter":i.events.text=="Add to Row"?"schemaRow":i.events.text=="Add to Column"?"schemaColumn":i.events.text=="Add to Values"?"schemaValue":"",r=0;r<this.model.pivotTableFields.length;r++)this.model.pivotTableFields[r].name==this._selectedMember&&(this.model.pivotTableFields[r].isSelected=!0,a=this.model.pivotTableFields[r]);if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)if(!t.isNullOrUndefined(this._tempFilterData[r][this._selectedMember]))for(o=0;o<this._tempFilterData[r][this._selectedMember].length;o++)y+="##"+this._tempFilterData[r][this._selectedMember][o];if(u.length>1)for(r=0;r<selectedElement.length;r++)n(u[r]).text()==this._selectedMember&&n(u[r]).remove();else n(u).remove();try{e=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(b){e=this.model.pivotControl.getOlapReport()}if(this._dataModel=="Olap"){for(_pivotProxy._nodeDropedParams=this._droppedClass=="schemaFilter"?"Slicer":this._droppedClass=="schemaColumn"?"Categorical":this._droppedClass=="schemaRow"?"Series":"",this._droppedClass=="schemaValue"&&(h=this.element.find(".pivotButton:contains('Measures')").parents(".e-droppable").attr("class").split(" ")[0],_pivotProxy._nodeDropedParams=h=="schemaColumn"?"Categorical":h=="schemaRow"?"Series":""),c=!1,l="",r=0;r<this.element.find(".pivotButton").length;r++)if(n(this.element.find(".pivotButton")[r]).attr("tag").split(":")[1]==selectedTreeNode.attr("tag").replace(/\[/g,"").replace(/\]/g,"")){c=!0;l=n(n(".pivotButton")[r]).attr("tag");break}c?(v=this._currentCubeName+"--"+l+"--"+_pivotProxy._nodeDropedParams+"--",this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),s=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:v,currentReport:e,layout:this.model.pivotControl.model.layout,customObject:s}),this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show(),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._onDroppedSuccess)):this._tableTreeObj.checkNode(selectedTreeNode);_pivotProxy._nodeDropedParams=""}else selectedTreeNode.find(".e-chk-inact").length>0?this._tableTreeObj.checkNode(selectedTreeNode):(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),s=JSON.stringify(this.model.customObject),this._createPivotButton(this._selectedMember,this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",p,w,""),f=JSON.stringify({action:"nodeDropped",dropAxis:this._droppedClass+"::",headerTag:JSON.stringify(a),sortedHeaders:this.model.pivotControl._ascdes,currentReport:e,customObject:s}),this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show(),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._pvtNodeDroppedSuccess))},_checkedChange:function(t){var i=n(".btnDeferUpdate").data("ejButton");t.isChecked?(_pivotProxy.model.pivotControl.model.enableDeferUpdate=!0,i.enable()):(_pivotProxy.model.pivotControl.model.enableDeferUpdate=!1,i.disable())},_onSortBtnClick:function(){var i=JSON.stringify(this.model.customObject),n=this._getSortedHeaders(),r=this.model.customObject!={}&&n!=""?JSON.stringify({action:"sorting",sortedHeaders:n,currentReport:this.model.pivotControl.getOlapReport(),customObject:i}):this.model.customObject!={}?JSON.stringify({action:"sorting",currentReport:this.model.pivotControl.getOlapReport(),customObject:i}):n!=""?JSON.stringify({action:"sorting",sortedHeaders:n,currentReport:this.model.pivotControl.getOlapReport()}):JSON.stringify({action:"sorting"});t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show();this.model.pivotControl.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.pivotControl.model.serviceMethods.sorting,r,this.model.pivotControl._renderControlSuccess)},_onFilterBtnClick:function(i){var r,u,f;if(n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"}),this._selectedTreeNode=n(n(i.target).parent()).parent(),i.target.tagName.toLowerCase()=="span"){if(this._curFilteredText=this.model.layout!="excel"?n(n(i.target).parents(".pivotButton")).find(".pvtBtn").text():n(i.target).parent().text(),n(i.target).parents("li:eq(1)").children().children("span").hasClass("hierarchyCDB")&&(this._curFilteredText=n(n(i.target).parents("li:eq(1)")).children().find(".e-text")[0].innerHTML),this._dataModel=="Pivot"&&(this._curFilteredAxis=t.isNullOrUndefined(this.element.find(".e-btn:contains('"+this._curFilteredText+"')").parents(".e-droppable")[0])?"":this.element.find(".e-btn:contains('"+this._curFilteredText+"')").parents(".e-droppable")[0].className.split(" ")[0]),this._dialogTitle=this._dataModel=="Olap"?n(this.element.find(".pivotButton:contains('"+n(i.target).parent().text()+"')")[0]).attr("tag"):n(i.target).parent().text()||i.target.id.replace("filterBtn","")||n(i.target).parents(".filterBtn")[0].id.replace("filterBtn",""),this._dataModel=="Olap")for(r=0;r<this.element.find(".e-btn").length;r++)!t.isNullOrUndefined(n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag"))&&n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag").indexOf(this._curFilteredText)>-1&&(this._curFilteredAxis=t.isNullOrUndefined(n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0])?"":n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0].className.split(" ")[0],this._dialogTitle=n(n(n(this.element.find(".e-btn"))[r]).parent()[0]).attr("tag"));try{u=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(e){u=this.model.pivotControl.getOlapReport()}sortedHeaders=this._getSortedHeaders();this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject});f=JSON.stringify(this.model.customObject);eventArgs=JSON.stringify({action:"fetchMembers",headerTag:this._dialogTitle||"UniqueName##"+n(n(i.target).parents("li")[0]).attr("tag"),sortedHeaders:this.model.pivotControl._ascdes,currentReport:u,customObject:f});t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.show();this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.fetchMembers,eventArgs,this._fetchMemberSuccess)}},_onRemoveBtnClick:function(i){var u=n(i.target.parentElement).text(),f=n(n(this._tableTreeObj.element).find("div:contains("+u+")>span")[1]).find(".e-chk-act"),e,r,o,s;for(n(f).removeClass("e-chk-act").addClass("e-chk-inact"),n(f).children("e-chk-activeicon").removeClass("e-chk-activeicon"),r=0;r<this.model.pivotTableFields.length;r++)this.model.pivotTableFields[r].FieldHeader==u&&(this.model.pivotTableFields[r].IsSelected=!1,e=this.model.pivotTableFields[r]);n(i.target.parentElement).remove();this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});o=JSON.stringify(this.model.customObject);s=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(e),sortedHeaders:this._getSortedHeaders(),currentReport:this.model.pivotControl.getOlapReport(),customObject:o});t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show();this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,s,this._nodeStateModifiedSuccess)},_onNodeCheckChanges:function(i){if(i.value=="(All)"&&i.type=="nodeUncheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("unCheckAll"),this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this),this._dialogOKBtnObj.disable();else if(i.value=="(All)"&&i.type=="nodeCheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("checkAll"),n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-chk-indetericon"),this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this),this._dialogOKBtnObj.enable();else if(i.value!="(All)"){var r=this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),u=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)");r.length==0||r.length==1&&r[0].id[r[0].id.length-1]==0?(n(u).parent().removeClass("e-chk-inact").removeClass("e-chk-ind").addClass("e-chk-act"),u.removeClass("e-chk-indetericon").addClass("e-chk-activeicon")):i.type=="nodeCheck"&&r.length==1&&r[0].id[r[0].id.length-1]==0?u.removeClass("e-chk-indetericon").addClass("e-chk-activeicon"):r.length>0&&u.removeClass("e-chk-activeicon").addClass("e-chk-indetericon");this._dialogOKBtnObj.enable();i.type=="nodeUncheck"&&r.length+1==this._memberTreeObj.element.find("li").length&&(u.removeClass("e-chk-activeicon").removeClass("e-chk-indetericon"),this._dialogOKBtnObj.disable())}},_onCheckedStateModified:function(i){var e=n(i.currentElement).find("a")[0].textContent,l="",nt="",h="",u="",b="",k,d,a,c,v,y,p,s,f,g,tt,r,w,o;if(this._dataModel=="Olap")if(!i.currentElement[0].id.indexOf("[Measures]")>-1){for(r=0;r<_pivotProxy.element.find(".pivotButton").length;r++)if(u=n(_pivotProxy.element.find(".pivotButton")[r]).attr("tag"),b="",b=u.indexOf("[Measures]")>-1||u.indexOf("[")>-1?u.split(":")[1]:this._getNodeUniqueName(u),n(i.currentElement).attr("tag")==b){h=n(_pivotProxy.element.find(".pivotButton")[r]);break}}else h=_pivotProxy.element.find(".pivotButton:contains("+e+")"),u,s;else h=_pivotProxy.element.find(".pivotButton:contains("+e+")"),u,s;for(k=h.length>0&&n(h).siblings(".filterIndicator").length>0?!0:!1,d=i.currentElement.find("~ span:eq(0) span.descending").length>0?!0:!1,r=0;r<_pivotProxy.model.pivotTableFields.length;r++)_pivotProxy.model.pivotTableFields[r].name==e&&i.type=="nodeCheck"?(_pivotProxy.model.pivotTableFields[r].isSelected=!0,u=_pivotProxy.model.pivotTableFields[r]):this.model.pivotTableFields[r].name==e&&i.type=="nodeUncheck"&&(_pivotProxy.model.pivotTableFields[r].isSelected=!1,u=_pivotProxy.model.pivotTableFields[r]);if(t.isNullOrUndefined(u)&&(u=n(i.currentElement).attr("tag")),i.type=="nodeUncheck")if(h.length>1)for(r=0;r<h.length;r++)n(h[r]).text()==e&&n(h[r]).remove();else n(h).remove();else this._droppedClass!=""?this._createPivotButton(e,this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaValue"?"value":this._droppedClass=="schemaFilter"?"filter":"",k,d,""):this._createPivotButton(e,this._dataModel=="Olap"&&n(i.currentElement).attr("tag").indexOf("[Measures]")<0||this._dataModel=="Pivot"&&u.pivotType=="PivotItem"?"row":"value",k,d,"");if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)if(!t.isNullOrUndefined(this._tempFilterData[r][e]))for(a=0;a<this._tempFilterData[r][e].length;a++)nt+="##"+this._tempFilterData[r][e][a];try{s=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(it){s=this.model.pivotControl.getOlapReport()}if(l="schemaRow::"+e+"::FILTERED"+nt,c=this._droppedClass!=""?this._droppedClass:u.pivotType=="PivotItem"?"schemaRow":"schemaValue",this._droppedClass="",this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show(),i.type=="nodeCheck"||i.type=="nodeUncheck"||c==""){if(i.type=="nodeCheck")this._dataModel=="Olap"?(n(i.currentElement).attr("tag").indexOf("[Measures]")==-1&&(p=t.buildTag("span.e-icon").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(p).hide())),_pivotProxy._nodeDropedParams=c=="schemaColumn"?"Categorical":c=="schemaRow"?"Series":c=="schemaFilter"?"Slicer":"",u=n(i.currentElement).attr("tag"),v=this._nodeDropedParams==""?n(i.currentElement).attr("tag").indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,y=this._currentCubeName+"--"+u+"--"+v+"--",s,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:y,currentReport:s,customObject:o}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._onDroppedSuccess)):(n(i.currentElement.find(".e-text")[0]).after(n(t.buildTag("span.e-icon").addClass("treeDrop")[0].outerHTML).hide()),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:c+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:l,currentReport:s,customObject:o}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess));else if(i.type=="nodeUncheck")if(this._dataModel=="Olap"){if(n(i.currentElement.find(".treeDrop")).remove(),n(i.currentElement.find(".e-icon:not(.e-chk-image, .e-plus,.e-minus)")).remove(),n(i.currentElement).removeClass("filter"),u=n(h).attr("tag"),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:s,customObject:o}),t.isNullOrUndefined(u))return!1;u.indexOf("[Measures]")>=0&&_pivotProxy.element.find(".schemaValue .pivotButton").length==0?(g=u.split(":"),tt=g[0]=="Rows"?".schemaRow":g[0]=="Columns"?".schemaColumn":"",_pivotProxy.element.find(tt+" .pivotButton:contains('Measures')").remove()):u.indexOf("[Measures]")<0&&u.indexOf("Measures")>=0&&_pivotProxy.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",_pivotProxy.model.pivotControl.model.url+"/"+_pivotProxy.model.serviceMethods.removeButton,f.replace("removeButton","removeButtonDeferUpdate"),this._onDroppedSuccess)):this.doAjaxPost("POST",_pivotProxy.model.pivotControl.model.url+"/"+_pivotProxy.model.serviceMethods.removeButton,f,this._pvtBtnDroppedSuccess)}else{if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)for(w in this._tempFilterData[r])w==e&&(this._tempFilterData[r][e]=[]);if(!t.isNullOrUndefined(this.model.pivotControl._tempFilterData))for(r=0;r<this.model.pivotControl._tempFilterData.length;r++)for(w in this.model.pivotControl._tempFilterData[r])w==e&&(this.model.pivotControl._tempFilterData[r][e]=[]);n(i.currentElement).removeClass("filter").find(".filter").remove();n(i.currentElement).removeClass("filter").find(".treeDrop").remove();this.model.pivotControl._ascdes=this.model.pivotControl._ascdes.replace(e+"##","");this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});o=JSON.stringify(this.model.customObject);f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:c+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:l,currentReport:s,customObject:o});this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",_pivotProxy.model.pivotControl.model.url+"/"+_pivotProxy.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)}}else _pivotProxy._dataModel=="Pivote"?(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:c+"::"+this._droppedPosition,sortedHeaders:this.model.pivotControl._ascdes,filterParams:l,currentReport:s,customObject:o}),_pivotProxy._droppedPosition="",this.model.pivotControl.model.enableDeferUpdate?_pivotProxy.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+_pivotProxy.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess):_pivotProxy.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)):(n(i.currentElement).attr("tag").indexOf("[Measures]")==-1&&(p=t.buildTag("span.e-icon").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(p).hide())),u=n(i.currentElement).attr("tag"),v=this._nodeDropedParams==""?n(i.currentElement).attr("tag").indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,y=this._currentCubeName+"--"+u+"--"+v+"--",s,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:y,currentReport:s,customObject:o}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._onDroppedSuccess))},_onNodeDropped:function(r){var c,b,k,y,l,u,a,w,p,h;if(r.dropTarget.context!=i||r.dropTarget.className!=i){if(c=!1,this._dataModel=="Pivot")for(b=n(r.dropTarget).parents(),u=0;u<b.length;u++)b[u].className.split(" ")[0]=="e-pivotgrid"&&(c=!0);if(r.dropTarget.context!=i&&r.dropTarget.context.className.indexOf("e-droppable")>=0||r.dropTarget.className!=i&&r.dropTarget.className.indexOf("e-droppable")>=0||c){this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var f=n(r.droppedElement).attr("tag"),e=r.droppedElement.text(),d="",v,o=this.element.find(".pivotButton:contains("+e+")"),s=this._tableTreeObj.element.find("li:contains('"+e+"'):last"),g=n(o).find(".filterIndicator").length>0?!0:!1,nt=n(o).find("~ span:eq(0) span.descending").length>0?!0:!1;if(this._droppedClass=c?r.event.target.tagName=="TH"||r.event.target.tagName=="TD"?r.event.target.className.split(" ")[0]=="rowheader"?"schemaRow":r.event.target.className.split(" ")[0]=="colheader"?"schemaColumn":n(r.event.target).hasClass("value")?"schemaValue":"":r.event.target.className.split(" ")[0]=="rows"||r.event.target.className.split(" ")[0]=="emptyRows"?"schemaRow":r.event.target.className.split(" ")[0]=="columns"?"schemaColumn":r.event.target.className.split(" ")[0]=="values"?"schemaValue":r.event.target.className.split(" ")[0]=="drag"?"schemaFilter":"":r.event.target.className.split(" ")[0],this._dataModel=="Olap"&&(s=this._tableTreeObj.element.find("li[tag='"+f+"']")),f.split(".").length>2&&(k=f.split(".")[0]+"."+f.split(".")[1],s=this._tableTreeObj.element.find("li[tag='"+k+"']")),s.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue"))return this._tableTreeObj.checkNode(s),!1;if(t.isNullOrUndefined(f))for(u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==e&&(this.model.pivotTableFields[u].isSelected=!0,f=this.model.pivotTableFields[u]);if(!t.isNullOrUndefined(this._tempFilterData))for(u=0;u<this._tempFilterData.length;u++)if(!t.isNullOrUndefined(this._tempFilterData[u][e]))for(y=0;y<this._tempFilterData[u][e].length;y++)d+="##"+this._tempFilterData[u][e][y];if(r.droppedElement[0].tagName.toLowerCase()=="button")if(o.length>1)for(u=0;u<o.length;u++)n(o[u]).text()==e&&n(o[u]).remove();else n(o).remove();try{v=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(it){v=this.model.pivotControl.getOlapReport()}if(this._dataModel=="Pivot"){if(l="",l=c?this._droppedPosition="":this._droppedPosition=this._setSplitBtnTargetPos(r.event),t.isNullOrUndefined(f)||f=="undefined")for(u=0;u<this.model.pivotTableFields.length;u++)if(this.model.pivotTableFields[u].name==e){this.model.pivotTableFields[u].isSelected=!0;f=this.model.pivotTableFields[u];n(o).remove();break}s.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue")?this._tableTreeObj.checkNode(s):(this._createPivotButton(e,this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",g,nt,l),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),p=JSON.stringify(this.model.customObject),h=JSON.stringify({action:"nodeDropped",dropAxis:this._droppedClass+"::"+l,headerTag:JSON.stringify(f),sortedHeaders:this.model.pivotControl._ascdes,currentReport:v,customObject:p}),t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show(),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,h.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,h,this._pvtNodeDroppedSuccess))}else{a=r.dropTarget[0]!=i&&r.dropTarget[0].className=="pivotButton"?n(r.dropTarget).parents()[0]:r.dropTarget[0]!=i&&r.dropTarget[0].tagName.toLowerCase()=="td"?r.dropTarget.children(":last")[0]:r.dropTarget;this._droppedClass=a[0].className.split(" ")[0];w=a[0].className.split(" ")[0]=="schemaColumn"?"Categorical":a[0].className.split(" ")[0]=="schemaRow"?"Series":a[0].className.split(" ")[0]=="schemaFilter"?"Slicer":"";w==""&&r.droppedElement.parents("li:eq(0)").attr("tag").toUpperCase().indexOf("[MEASURES]")>-1&&(w=this.element.find(".schemaRow .pivotButton:contains('Measures')").length>0||this.element.find(".schemaRow .pivotButton:contains('MEASURES')").length>0?"Series":"Categorical");var l=this._setSplitBtnTargetPos(r.event),tt=this._currentCubeName+"--"+f+"--"+w+"--"+l;this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});p=JSON.stringify(this.model.customObject);h=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:tt,filterParams:"",currentReport:v,layout:this.model.pivotControl.model.layout,customObject:p});this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show();this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,h.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,h,this._onDroppedSuccess)}}}},_onPvtBtnDropped:function(i){var f,h,p,c,e,l;this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var o=null,s="",u="",a,r,v=!1,y=!1;if(this._dataModel=="Olap")o=i.target.className.indexOf("pvtBtn")>-1?n(i.target).parents(".e-droppable")[0]:i.target.className.indexOf("e-droppable")?i.target:i.target[0].tagName.toLowerCase()=="td"?i.target.children(":last")[0]:i.target,s=o.className.split(" ")[0]=="schemaColumn"?"Categorical":o.className.split(" ")[0]=="schemaRow"?"Series":o.className.split(" ")[0]=="schemaFilter"?"Slicer":"",s==""&&i.element.parent().attr("tag").indexOf("[Measures]")>-1&&(s=this.element.find(".schemaRow .pivotButton:contains('Measures')").length>0?"Series":"Categorical"),u=n(i.element.parent()[0]).attr("tag"),r=o.className.split(" ")[0];else for(a=i.element.text(),r=i.target.className.indexOf("e-droppable")>=0?i.target.className.split(" ")[0]:i.target.className.split(" ")[0]=="pvtBtn"?n(i.target).parents("div.e-droppable").attr("class").split(" ")[0]:"",u,v=i.element.find("~ .filterIndicator").length>0?!0:!1,y=i.element.find("~ span:eq(0) span.descending").length>0?!0:!1,f=0;f<this.model.pivotTableFields.length;f++)this.model.pivotTableFields[f].name==a&&(this.model.pivotTableFields[f].isSelected=!0,u=this.model.pivotTableFields[f]);if(this.element.find(".dragClone").remove(),this._dataModel=="Olap"&&(u.split(":")[1].toLocaleUpperCase()=="MEASURES"&&(r!="schemaColumn"||r!="schemaRow")&&(r=="schemaFilter"||r=="schemaValue")||u.toUpperCase().indexOf("[MEASURES]")>-1&&r!="schemaValue"&&(r=="schemaRow"||r=="schemaColumn"||r=="schemaFilter")||u.toUpperCase().indexOf("[MEASURES]")==-1&&r=="schemaValue"))return this._createErrorDialog(),!1;if(r=="schemaValue"||r=="schemaRow"||r=="schemaColumn"||r=="schemaFilter"){h=this._setSplitBtnTargetPos(i.event);try{c=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(w){c=this.model.pivotControl.getOlapReport()}n(i.element.parent()).remove();this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show();this._dataModel=="Olap"?(p=this._currentCubeName+"--"+u+"--"+s+"--"+h,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),l=JSON.stringify(this.model.customObject),e=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:p,currentReport:c,customObject:l}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,e.replace("nodeDropped","nodeDroppedDeferUpdate"),this._onDroppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,e,this._onDroppedSuccess)):(this._createPivotButton(a,r=="schemaRow"?"row":r=="schemaColumn"?"column":r=="schemaFilter"?"filter":r=="schemaValue"?"value":"",v,y,h),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),l=JSON.stringify(this.model.customObject),e=JSON.stringify({action:"nodeDropped",dropAxis:r+"::"+h,headerTag:JSON.stringify(u),sortedHeaders:this.model.pivotControl._ascdes,currentReport:c,customObject:l}),successMethod=this.model.pivotControl._renderControlSuccess,this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,e.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,e,this._pvtNodeDroppedSuccess))}else this._removePvtBtn(i)},_createErrorDialog:function(){if(this.element.find(".errorDialog").length==0){var i=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent","The field you are moving cannot be placed in that area of the report.")[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title","Warning")[0].outerHTML;this.element.append(i);this.element.find(".errorDialog").ejDialog({target:"#"+this._id,enableResize:!1,width:"400px"});this._errorDialog=this.element.find(".errorDialog").data("ejDialog");n("#"+this._errorDialog._id+"_wrapper").css({left:"50%",top:"50%"});this.element.find(".errOKBtn").ejButton({click:t.proxy(this._errOKBtnClick,this)})}else this._errorDialog.open()},_errOKBtnClick:function(){this._errorDialog._ejDialog.find("button.e-dialog-icon").trigger("click")},_hideSchemaDesigner:function(){n("#PivotSchemaDesigner").animate({left:"-"+n("#"+this._id).width()+"px"},500,function(){});this.element.find(".collapseSchema").addClass("expandSchema").removeClass("collapseSchema")},_showSchemaDesigner:function(){n("#PivotSchemaDesigner").animate({left:"5px"});this.element.find(".expandSchema").addClass("collapseSchema").removeClass("expandSchema")},_reSizeHandler:function(){if(this.model.pivotControl!=null&&this.model.pivotControl.model.isResponsive){var t=!0,i=n("#"+this._id).parent().width();i<750&&t?(n("#"+this._id).css({position:"absolute"}),n("#"+this.model.pivotControl._id).width("100%"),t=!1,this.element.find(".responsiveSchema").addClass("expandSchema").removeClass("responsiveSchema"),this._hideSchemaDesigner(),this._tableTreeObj.option("allowDragAndDrop",!1)):i>750&&(n("#"+this._id).css({position:"static"}),n("#"+this.model.pivotControl._id).width(parseInt(100-n("#"+this._id).width()/n(window).width()*100)-4+"%"),this.element.find(".expandSchema, .collapseSchema").addClass("responsiveSchema").removeClass("expandSchema").removeClass("collapseSchema"),this._tableTreeObj.option("allowDragAndDrop",!0),t=!0)}},_dialogBtnClick:function(i){var v,c,r,w,b,y,e,a,p;if(this.element.find(".e-dialog, .clientDialog").hide(),v="",i.model.text.toLowerCase()!="cancel"){var f=this._dataModel=="Olap"?v=this._getUnSelectedNodes()+"FILTERED"+this._getSelectedNodes(this._curFilteredAxis=="schemaFilter"?!0:!1):this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),o=!1,u=this._dataModel=="Olap"?f:this._curFilteredAxis+"::"+this._curFilteredText+"::FILTERED",l=this._curFilteredText,s=[],h={};if(c=this._getUnSelectedNodes()!=""?!0:!1,this._dataModel=="Pivot"){for(r=0;r<f.length;r++)s.push(n(f[r].parentElement).siblings("a").text());for(h[l]=s,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),r=0;r<this._tempFilterData.length;r++)t.isNullOrUndefined(this._tempFilterData[r][l])||(this._tempFilterData[r][l]=s,o=!0);if(o||this._tempFilterData.push(h),this.model.pivotControl._tempFilterData=this._tempFilterData,t.isNullOrUndefined(this._curFilteredAxis)||this._curFilteredAxis!="")for(r=0;r<f.length;r++)u+="##"+n(f[r].parentElement).siblings("a").text()}else{for(h[this._curFilteredText]=u,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),r=0;r<this._tempFilterData.length;r++)t.isNullOrUndefined(this._tempFilterData[r][this._curFilteredText])||(this._tempFilterData[r][this._curFilteredText]=s,o=!0);o||this._tempFilterData.push(h)}if(w=this._getSortedHeaders(),b=this.model.layout=="excel"?this.element.find(".schemaFieldTree li:contains('"+this._curFilteredText+"')"):this.element.find("."+this._curFilteredAxis+" .pivotButton:contains("+this._curFilteredText+") .filterBtn"),this.model.layout=="excel"&&(n(_pivotProxy._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(_pivotProxy._selectedTreeNode=n(n(_pivotProxy._selectedTreeNode).parents("li:eq(0)"))),c&&n(n(_pivotProxy._selectedTreeNode)).find(".filter").length<=0?(y=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,n(n(_pivotProxy._selectedTreeNode).find(".e-text")[0]).after(y)):c||n(_pivotProxy._selectedTreeNode).find(".filter").remove(),this._curFilteredAxis==""))return!1;try{e=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(k){e=this.model.pivotControl.getOlapReport()}this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject});a=JSON.stringify(this.model.customObject);p=this.model.pivotControl.model.customObject!={}&&u!=""?JSON.stringify({action:"filtering",filterParams:u,sortedHeaders:this.model.pivotControl._ascdes,currentReport:e,customObject:a}):this.model.pivotControl.model.customObject!={}?JSON.stringify({action:"filtering",currentReport:e,customObject:a}):u!=""?JSON.stringify({action:"filtering",filterParams:u,sortedHeaders:this.model.pivotControl._ascdes,currentReport:e}):JSON.stringify({action:"filtering"});t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.show();this.model.pivotControl.model.enableDeferUpdate?(this.model.pivotControl._filterUpdate.push(u),t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,p,this._filterElementSuccess)}_pivotProxy._selectedTreeNode=null},_onNodeExpand:function(t){var r=t.event.originalEvent!=i&&t.event.originalEvent.target!=i?t.event.originalEvent.target:t.event.target,s="",l=n(r).parents("li").first().children().find("li").length,h,e,o,f,u,c;if(r.className.indexOf("e-plus")>-1&&l==0){h=n(r).parent().find("input[type=checkbox]").prop("checked");o=n(r).parents("li").first().attr("tag");this.pNode=r;try{e=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(a){e=this.model.pivotControl.getOlapReport()}for(f=this.element.find(".pivotButton"),u=0;u<f.length>0;u++)n(f[u]).attr("tag").indexOf(this._curFilteredText)>-1&&(s=n(f[u]).attr("tag"));this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject});c=JSON.stringify(this.model.customObject);this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.memberExpand,JSON.stringify({action:"memberExpanded",checkedStatus:h,parentNode:n(r).parents("li")[0].id,tag:o,cubeName:this._currentCubeName+"##"+s,currentReport:e,customObject:c}),this._fetchChildNodeSuccess)}},_nodeStateModifiedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(n):this.model.pivotControl._renderControlSuccess(n)},_pvtNodeDroppedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(n):this.model.pivotControl._renderControlSuccess(n)},_pvtBtnDroppedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject});this.model.pivotControl._renderControlSuccess(n)},_filterElementSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject});this.model.pivotControl._renderControlSuccess(n)},_fetchChildNodeSuccess:function(t){var r,u,f;t.length>1&&t[0]!=i?(r=JSON.parse(t[0].Value),t[1]!=null&&t[1]!=i&&(this.model.customObject=t[1].Value)):t.d!=i?(r=JSON.parse(t.d[0].Value),t.d[1]!=null&&t.d[1]!=i&&(this.model.customObject=t.d[1].Value)):(r=JSON.parse(t.ChildNodes),t.customObject!=null&&t.customObject!=i&&(this.model.customObject=t.customObject));f={id:"id",parentId:"pid",hasChild:"hasChildren",text:"name",isChecked:"checkedStatus"};u=n(this.pNode).parents("li").length>1?n(this.pNode).parents("li").first():n(this.pNode).parents("li");n(n(u).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this._memberTreeObj._createSubNodesWhenLoadOnDemand(r,this.pNode,f);n.each(n(u).children().find("li"),function(n,t){t.setAttribute("tag",r[n].tag)});this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject})},_fetchMemberSuccess:function(n){n[0]!=i&&n.length>0?(this._currentMembers=n[0].Value,n[1]!=null&&n[1]!=i&&(this.model.customObject=n[1].Value)):n.d!=i&&n.d.length>0?(this._currentMembers=n.d[0].Value,n.d[1]!=null&&n.d[1]!=i&&(this.model.customObject=n.d[1].Value)):n!=i&&n.length>0?(this._currentMembers=n.EditorTreeInfo,n!=null&&n.customObject!=i&&(this.model.customObject=n.customObject)):n!=i&&(this._currentMembers=n.EditorTreeInfo,n!=null&&n.customObject!=i&&(this.model.customObject=n.customObject));this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject});this._createDialog(this._dialogTitle,this._currentMembers)},_onDroppedSuccess:function(r){var u=null;this.model.pivotControl.model.enableDeferUpdate?u=this._removeButtonDeferUpdate==!1?t.isNullOrUndefined(r.OlapReport)?JSON.parse(r.d[0].Value):JSON.parse(r.OlapReport):u=t.isNullOrUndefined(r.OlapReport)?r.d[0].Value:r.OlapReport:(!t.isNullOrUndefined(r[0])&&r.length>0?(u=JSON.parse(r[1].Value),r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value)):!t.isNullOrUndefined(r.d)&&r.d.length>0?(u=JSON.parse(r.d[1].Value),r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value)):t.isNullOrUndefined(r)||t.isNullOrUndefined(r.OlapReport)||(u=JSON.parse(r.OlapReport)),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject));this._removeButtonDeferUpdate==!1&&(this.element.find(".axisTable .pivotButton").remove(),this._setPivotRows(u.PivotRows),this._setPivotColumns(u.PivotColumns),this._setPivotCalculations(u.PivotCalculations),this._setFilters(u.Filters),this.element.find(".axisTable .schemaFilter").append(this._createPivotButtons(this.model.filters,"filter")),this.element.find(".axisTable .schemaRow").append(this._createPivotButtons(this.model.pivotRows,"row")),this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons(this.model.pivotColumns,"column")),this.element.find(".axisTable .schemaValue").append(this._createPivotButtons(this.model.pivotCalculations,"values")),this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal"}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)}),this._unWireEvents(),this._wireEvents());this.model.pivotControl.model.enableDeferUpdate?(t.isNullOrUndefined(ogridWaitingPopup)||ogridWaitingPopup.hide(),t.isNullOrUndefined(r.OlapReport)?this.model.pivotControl.setOlapReport(r.d[0].Value):this.model.pivotControl.setOlapReport(r.OlapReport),this._removeButtonDeferUpdate=!1):this.model.pivotControl._renderControlSuccess(r);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject})},_removePvtBtn:function(n){var u=n.element.text(),t=n.element.parent().attr("tag"),i,r;try{i=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(f){i=this.model.pivotControl.getOlapReport()}this._dataModel=="Olap"?(r=t.indexOf("[Measures]")>-1||t.indexOf("[")>-1?t.split(":")[1]:this._getNodeUniqueName(t),selectedTreeNode=this._getNodeByUniqueName(r),this._tableTreeObj.uncheckNode(selectedTreeNode)):(selectedTreeNode=this._tableTreeObj.element.find("li:contains('"+u+"')"),this._tableTreeObj.uncheckNode(selectedTreeNode))},_createDialog:function(i,r){var f,o,u,s,h,c;this.element.find(".e-dialog, .clientDialog").remove();var l=t.buildTag("div#EditorDiv.editorDiv",t.buildTag("div",t.buildTag("div.memberEditorDiv",t.buildTag("div#editorTreeView.editorTreeView")[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML+"<\/br>",a=t.buildTag("div",t.buildTag("button#OKBtn.dialogOKBtn","OK")[0].outerHTML+t.buildTag("button#CancelBtn.dialogCancelBtn","Cancel")[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,v=t.buildTag("div#clientDialog.clientDialog",l+a,{opacity:"1"}).attr("title",i)[0].outerHTML,r=JSON.parse(r),e;if(!t.isNullOrUndefined(this._tempFilterData)){for(u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][i])||(e=this._tempFilterData[u][i]);if(!t.isNullOrUndefined(e))for(u=0;u<e.length;u++)for(f=0;f<r.length;f++)e[u]==r[f].name&&(r[f].checkedStatus=!1)}for(n(v).appendTo("#"+this._id),this.element.find(".editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,height:n(".memberEditorDiv").height(),fields:{id:"id",text:"name",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:r},nodeClick:t.proxy(this._onNodeExpand,this)}),o=this.element.find(".editorTreeView").find("li"),u=0;u<o.length;u++)o[u].setAttribute("tag",r[u].tag);this.element.find(".dialogOKBtn, .dialogCancelBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._dialogBtnClick,this)});this._dialogOKBtnObj=this.element.find(".dialogOKBtn").data("ejButton");this._memberTreeObj=this.element.find(".editorTreeView").data("ejTreeView");s=this.element.find(".editorTreeView li:gt(0)");h=n(s).find(":input.nodecheckbox:not(:checked)");h.length>0&&(c=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),n(c).removeClass("e-chk-activeicon").addClass("e-chk-indetericon"));this.element.find(".clientDialog").ejDialog({width:265,target:"#"+this._id,enableResize:!1});this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this);this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this);this._memberTreeObj.element.find(".e-plus").length==0&&this._memberTreeObj.element.find(".e-item").css("padding","0px");this._unWireEvents();this._wireEvents();t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.hide()},_createPivotButton:function(i,r,u,f,e){var s=r=="row"?".schemaRow":r=="column"?".schemaColumn":r=="value"?".schemaValue":".schemaFilter",c=(r=="column"||r=="row")&&this.model.layout!="excel"?t.buildTag("input#toggleBtn"+i,{}).attr("type","checkbox")[0].outerHTML:"",l=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"?t.buildTag("button.filterBtn#filterBtn"+i,{}).addClass(u?"filterIndicator":"")[0].outerHTML:"",o=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+i,i)[0].outerHTML+c+l+t.buildTag("span.removePivotBtn","",{display:"none"}).addClass("e-icon")[0].outerHTML)[0].outerHTML,h;typeof e=="number"&&n(this.element.find(s+" .pivotButton")[e]).length>0?r=="row"?n(this.element.find(".schemaRow .pivotButton")[e]).before(o):r=="column"?n(this.element.find(".schemaColumn .pivotButton")[e]).before(o):r=="value"?n(this.element.find(".schemaValue .pivotButton")[e]).before(o):r=="filter"?n(this.element.find(".schemaFilter .pivotButton")[e]).before(o):"":r=="row"?this.element.find(".schemaRow").append(o):r=="column"?this.element.find(".schemaColumn").append(o):r=="value"?this.element.find(".schemaValue").append(o):r=="filter"?this.element.find(".schemaFilter").append(o):"";h=typeof e!="number"&&e==""?" .pivotButton .pvtBtn:last":" .pivotButton .pvtBtn:eq("+e+")";this.element.find(s+h).ejButton({size:"normal"}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)});this.element.find(s+" .pivotButton .filterBtn:last").ejButton({size:"normal",contentType:"imageonly",prefixIcon:"filter"});this.element.find(s+" .pivotButton input:last").ejToggleButton({size:"normal",contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._onSortBtnClick,this)});f&&(this.element.find(s+" .pivotButton:contains("+i+") span:eq(0) span").removeClass("ascending").addClass("descending"),this.element.find(s+" .pivotButton:contains("+i+") span:eq(0) button").addClass("e-active"));this.element.find(".dropIndicator").removeClass("dropIndicatorHover")},_createPivotButtons:function(n,i){var f,u,e,r,o,s;if(!t.isNullOrUndefined(n)){for(f="",u=i=="column"?"Columns":i=="row"?"Rows":i=="filter"?"Slicers":"",u==""&&i=="values"&&(e=this.element.find(".pivotButton:contains('Measures')").length>0?this.element.find(".pivotButton:contains('Measures')").parent()[0].className.split(" ")[0]:"schemaColumn",u=e=="schemaColumn"?"Columns":"Rows"),r=0;r<n.length;r++)o=(i=="column"||i=="row")&&this.model.layout!="excel"?t.buildTag("input#toggleBtn"+n[r].FieldHeader||n[r].FieldName,{}).attr("type","checkbox")[0].outerHTML:"",s=(i=="column"||i=="row"||i=="filter")&&this.model.layout!="excel"?t.buildTag("button.filterBtn#filterBtn"+(n[r].FieldHeader||n[r].FieldName||n[r].Name||n[r].DimensionName),{})[0].outerHTML:"",f+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+n[r].FieldHeader||n[r].FieldName||n[r].Name||n[r].DimensionName,n[r].FieldHeader||n[r].FieldName||n[r].Name||n[r].DimensionName)[0].outerHTML+o+s+t.buildTag("span.removePivotBtn","",{display:"none"}).addClass("e-icon")[0].outerHTML).attr("tag",u+":"+n[r].Tag)[0].outerHTML;return f}},_setSplitBtnTargetPos:function(t){var o="",e,r,u,f;if(t.event!=i&&t.event.type=="touchend"?(r=t.event.originalEvent.target!=null?n(t.event.originalEvent.target).parents(".pivotButton"):n(t.event.originalEvent.srcElement).parents(".pivotButton"),u=t.event.originalEvent.target!=null?t.event.originalEvent.target.className:t.event.originalEvent.srcElement.className):(r=t.originalEvent.target!=null?n(t.originalEvent.target).parents(".pivotButton"):n(t.originalEvent.srcElement).parents(".pivotButton"),u=t.originalEvent.target!=null?t.originalEvent.target.className:t.originalEvent.srcElement.className),this._droppedClass=r.length>0?n(r[0]).parent()[0].className.split(" ")[0]:u.split(" ")[0],r[0]||u!=i&&u!=null&&jQuery.type(u)=="string"&&u.indexOf("pivotButton")>-1)for(r=r[0]?r[0]:t.originalEvent.target!=null?t.originalEvent.target:t.originalEvent.srcElement,e=t.event!=i&&t.event.type=="touchend"?t.target:this._droppedClass!=null&&this._droppedClass!=i&&this._droppedClass!=""?this.element.find("."+this._droppedClass)[0]:r.parentNode,f=0;f<e.children.length;f++)n(e.childNodes[f]).attr("tag")==n(r).attr("tag")&&(o=f);return o},_getUnSelectedNodes:function(){for(var r,f=this.element.find(".editorTreeView")[0],u="",i=n(f).find(":input.nodecheckbox:not(:checked)"),t=0;t<i.length;t++)n(i[t].parentElement).find("span:nth-child(1)").attr("class").indexOf("e-chk-act")>-1||n(i[t].parentElement).attr("aria-checked")=="mixed"||(r=n(i[t]).parents("li:eq(0)"),u+="::"+r[0].id+"||"+n(r).attr("tag"));return u},_getSelectedNodes:function(t){var o,s,e,r,i;if(t){var h=this.element.find(".editorTreeView")[0].childNodes[0],f=[],u=n(h).children();for(r=0;r<u.length;r++){if(i=u[r],o={caption:n(i.firstChild).find("a").text(),parentId:i.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(i).parents()[1].id,id:i.id,checked:n(i).find(":input.nodecheckbox")[0].checked||n(i).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(i.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(i).attr("tag")},n(i).find("ul:first").children().length>0)for(s=n(i).find("ul:first").children(),e=0;e<s.length;e++)o.childNodes.push(this._getNodeInfo(s[e]));f.push(o)}return JSON.stringify(f)}var h=n(".editorTreeView"),f="",u=n(h).find(":input.nodecheckbox");for(r=0;r<u.length;r++)(u[r].checked||n(u[r].parentElement).attr("aria-checked")=="mixed")&&(i=n(u[r]).parents("li:eq(0)"),f+="::"+i[0].id+"||"+n(i).attr("tag"));return f},_getNodeInfo:function(t){var u={caption:n(t.firstChild).find("a").text(),parentId:t.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(t).parents()[1].id,id:t.id,checked:n(t).find(":input.nodecheckbox")[0].checked||n(t).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(t.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(t).attr("tag")},r,i;if(n(t).find("ul:first").children().length>0)for(r=n(t).find("ul:first").children(),i=0;i<r.length;i++)u.childNodes.push(this._getNodeInfo(r[i]));return u},_getNodeUniqueName:function(n){for(var t="",i=0;i<n.split(":")[1].split(".").length;i++)t!=""&&(t+="."),t+="["+n.split(":")[1].split(".")[i]+"]";return t},_getNodeByUniqueName:function(t){for(var i=0;i<n(_pivotProxy._tableTreeObj.element.find("li")).length;i++)n(_pivotProxy._tableTreeObj.element.find("li")[i]).attr("tag")==t&&(selectedTreeNode=n(_pivotProxy._tableTreeObj.element.find("li")[i]));return selectedTreeNode},doAjaxPost:function(t,i,r,u,f){n.ajax({type:t,url:i,contentType:"application/json; charset=utf-8",dataType:"json",data:r,success:n.proxy(u,this),complete:n.proxy(f,this),error:function(t,i,r){_proxy.model.progressMode!="infinite"?(window.clearInterval(oGridTimer),_proxy.model.progressMode=="progress"&&(n("#"+_proxy._id+"progressText")[0].innerHTML=_proxy._getLocalizedLabels("MDXqueryExecutionFailed")+"!!!"),n("#"+ogridProgressBar._id).show(),ogridProgressBar.setModel({value:0,text:r})):ogridWaitingPopup.hide()}})}});t.PivotSchemaDesigner.locale={};t.PivotSchemaDesigner.locale["en-US"]={PivotTableFieldList:"PivotTable Field List",ChooseFieldsToAddToReport:"Choose fields to add to report:",DragFieldBetweenAreasBelow:"Drag fields between areas below:",ReportFilter:"Report Filter",ColumnLabel:"Column Label",RowLabel:"Row Label",Values:"Values",DeferLayoutUpdate:"Defer Layout Update",Update:"Update"};t.PivotSchemaDesigner.Layouts={Excel:"excel",Normal:"normal"}})(jQuery,Syncfusion)});